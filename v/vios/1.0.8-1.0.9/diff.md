# Comparing `tmp/vios-1.0.8-py3-none-any.whl.zip` & `tmp/vios-1.0.9-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,25 +1,25 @@
-Zip file size: 33995 bytes, number of entries: 23
--rw-rw-rw-  2.0 fat      781 b- defN 23-Jul-15 06:38 vios/__init__.py
--rw-rw-rw-  2.0 fat     6314 b- defN 23-Jul-13 12:34 vios/collection/__init__.py
+Zip file size: 34610 bytes, number of entries: 23
+-rw-rw-rw-  2.0 fat      853 b- defN 23-Aug-03 12:19 vios/__init__.py
+-rw-rw-rw-  2.0 fat     6969 b- defN 23-Aug-05 13:55 vios/collection/__init__.py
 -rw-rw-rw-  2.0 fat     3515 b- defN 23-Jul-04 13:33 vios/collection/support.py
 -rw-rw-rw-  2.0 fat    11254 b- defN 23-Jun-19 15:11 vios/collection/tasks.py
 -rw-rw-rw-  2.0 fat    10198 b- defN 23-Jun-28 07:10 vios/collection/uapi.py
 -rw-rw-rw-  2.0 fat     4756 b- defN 23-Jul-15 07:53 vios/driver/VirtualDevice.py
 -rw-rw-rw-  2.0 fat     2962 b- defN 23-Jun-19 15:11 vios/driver/__init__.py
 -rw-rw-rw-  2.0 fat      209 b- defN 23-Jun-26 11:28 vios/driver/common/__init__.py
 -rw-rw-rw-  2.0 fat     4192 b- defN 23-Jun-28 07:10 vios/driver/common/basedriver.py
 -rw-rw-rw-  2.0 fat     4666 b- defN 23-Jun-19 15:11 vios/driver/common/quantity.py
 -rw-rw-rw-  2.0 fat     5546 b- defN 23-Jun-19 15:11 vios/driver/common/visadriver.py
--rw-rw-rw-  2.0 fat      979 b- defN 23-Jul-15 07:14 vios/envelope/__init__.py
--rw-rw-rw-  2.0 fat    13446 b- defN 23-Jul-06 02:54 vios/envelope/assembler.py
+-rw-rw-rw-  2.0 fat      999 b- defN 23-Aug-03 12:19 vios/envelope/__init__.py
+-rw-rw-rw-  2.0 fat    13446 b- defN 23-Aug-03 02:45 vios/envelope/assembler.py
 -rw-rw-rw-  2.0 fat    10541 b- defN 23-Jun-26 11:28 vios/envelope/calculator.py
 -rw-rw-rw-  2.0 fat     1047 b- defN 23-Jun-19 15:11 vios/envelope/device.py
--rw-rw-rw-  2.0 fat     1719 b- defN 23-Jul-15 07:54 vios/envelope/processor.py
--rw-rw-rw-  2.0 fat     2980 b- defN 23-Jun-26 12:50 vios/envelope/rule.py
+-rw-rw-rw-  2.0 fat     1814 b- defN 23-Aug-05 13:50 vios/envelope/processor.py
+-rw-rw-rw-  2.0 fat     3622 b- defN 23-Aug-04 13:33 vios/envelope/rule.py
 -rw-rw-rw-  2.0 fat      522 b- defN 23-Jun-26 11:28 vios/tools/__init__.py
--rw-rw-rw-  2.0 fat     1089 b- defN 23-Jul-15 07:56 vios-1.0.8.dist-info/LICENSE
--rw-rw-rw-  2.0 fat     1000 b- defN 23-Jul-15 07:56 vios-1.0.8.dist-info/METADATA
--rw-rw-rw-  2.0 fat       92 b- defN 23-Jul-15 07:56 vios-1.0.8.dist-info/WHEEL
--rw-rw-rw-  2.0 fat        5 b- defN 23-Jul-15 07:56 vios-1.0.8.dist-info/top_level.txt
--rw-rw-r--  2.0 fat     1857 b- defN 23-Jul-15 07:56 vios-1.0.8.dist-info/RECORD
-23 files, 89670 bytes uncompressed, 31015 bytes compressed:  65.4%
+-rw-rw-rw-  2.0 fat     1089 b- defN 23-Aug-06 22:14 vios-1.0.9.dist-info/LICENSE
+-rw-rw-rw-  2.0 fat      996 b- defN 23-Aug-06 22:14 vios-1.0.9.dist-info/METADATA
+-rw-rw-rw-  2.0 fat       92 b- defN 23-Aug-06 22:14 vios-1.0.9.dist-info/WHEEL
+-rw-rw-rw-  2.0 fat        5 b- defN 23-Aug-06 22:14 vios-1.0.9.dist-info/top_level.txt
+-rw-rw-r--  2.0 fat     1856 b- defN 23-Aug-06 22:14 vios-1.0.9.dist-info/RECORD
+23 files, 91149 bytes uncompressed, 31630 bytes compressed:  65.3%
```

## zipnote {}

```diff
@@ -48,23 +48,23 @@
 
 Filename: vios/envelope/rule.py
 Comment: 
 
 Filename: vios/tools/__init__.py
 Comment: 
 
-Filename: vios-1.0.8.dist-info/LICENSE
+Filename: vios-1.0.9.dist-info/LICENSE
 Comment: 
 
-Filename: vios-1.0.8.dist-info/METADATA
+Filename: vios-1.0.9.dist-info/METADATA
 Comment: 
 
-Filename: vios-1.0.8.dist-info/WHEEL
+Filename: vios-1.0.9.dist-info/WHEEL
 Comment: 
 
-Filename: vios-1.0.8.dist-info/top_level.txt
+Filename: vios-1.0.9.dist-info/top_level.txt
 Comment: 
 
-Filename: vios-1.0.8.dist-info/RECORD
+Filename: vios-1.0.9.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## vios/__init__.py

```diff
@@ -6,15 +6,17 @@
 
 # 二、envelope：执行流程，见各模块说明
 
 # 三、collection：一些工具、函数、类或其他
 
 
 import json
+import sys
 from pathlib import Path
 
 try:
     with open(Path.home()/'quark/startup.json', 'r') as f:
         startup = json.loads(f.read())
+    sys.path.append(startup['site'])  # for python>=3.11.4
 except Exception as e:
     print(e)
     startup = {}
```

## vios/collection/__init__.py

```diff
@@ -1,13 +1,14 @@
 """本模块主要由工具函数构成, 且依赖server
 >>> tasks：实验描述
 >>> support：兼容层，如与Scanner格式转换
 >>> uapi：与前端进行交互，如matplotlib画图、数据库查询、实时画图等，详见各函数说明。
 """
 import asyncio
+import inspect
 import json
 import os
 import time
 from collections import OrderedDict
 from functools import cached_property
 from pathlib import Path
 
@@ -66,41 +67,53 @@
 
     @cached_property
     def name(self):
         return self.task['metainfo'].get('name', 'Unknown')
 
     def run(self):
         self.stime = time.time() # start time
+        circuit = self.task['taskinfo']['CIRQ']
+        if callable(circuit[0]):
+            circuit[0] = inspect.getsource(circuit[0])
         self.taskid = s.submit(self.task)
 
     def cancel(self):
         s.cancel(self.taskid)
         self.stop(self.taskid, False)
+    
+    def save(self):
+        s.save(self.taskid)
 
     def result(self):
         meta = True if not self.meta else False
         res = s.fetch(self.taskid, start=self.index, meta=meta)
 
         if isinstance(res, str):
             return self.data
         elif isinstance(res, tuple):
             if isinstance(res[0], str):
                 return self.data
             data, self.meta = res
         else:
             data = res
         self.index += len(data)
+        # data.clear()
         self.process(data)
 
         return self.data
 
-    def status(self):
-        return s.track(self.taskid)
+    def status(self, key: str = 'runtime'):
+        if key == 'runtime':
+            return s.track(self.taskid)
+        elif key == 'compile':
+            return s.apply('status', user='task')
+        else:
+            return 'supported arguments are: {rumtime, compile}'
 
-    def error(self):
+    def report(self):
         return s.report(self.taskid)
 
     def step(self, index: int):
         if index not in self.cmds:
             self.cmds[index] = s.review(self.taskid, index)
         return self.cmds[index]
 
@@ -116,26 +129,31 @@
         try:
             self.result()
         except Exception as e:
             print(e)
 
         try:
             status = self.status()
-            self.progress.max = status['size']
+            if status['status'] in ['Pending']:
+                # print(status['status'])
+                time.sleep(2)
+                self.join()
+            self.progress.max =self.report()['size']
         except Exception as e:
-            print(e,status)
+            print(e,status,self.report())
+            time.sleep(1)
             self.join()
 
-        if status['status'] in ['Pending']:
-            time.sleep(0.5)
-            self.join()
-        elif status['status'] in ['Failed', 'Canceled']:
+        if status['status'] in ['Failed', 'Canceled']:
             return self.stop(self.taskid, False)
         elif status['status'] in ['Running']:
-            self.progress.goto(self.index)
+            if self.index == self.progress.max:
+                self.save()
+            else:
+                self.progress.goto(self.index)
         elif status['status'] in ['Finished', 'Archived']:
             self.progress.goto(self.progress.max)
 
         # if self.index and self.index == self.progress.max:
             return self.stop(self.taskid)
         
         if isinstance(self.timeout, float):
```

## vios/envelope/__init__.py

```diff
@@ -5,24 +5,20 @@
         ↓           ↑    ↓            ↑  ↓             ↑     ↓          ↑   ↓ 
         &ccompile   ↑    &calculate -->  &read|write -->     &process -->   &postprocess --->
         ↓           ↑
         &assemble -->
 """
 
 
-import time
+from .assembler import MAPPING, assemble, ccompile, decode, initialize
+from .calculator import calculate
+from .device import read, write
+from .processor import process
+from .rule import postprocess
 
 
 class Future(object):
     def __init__(self, index: int = -1) -> None:
         self.index = index
 
-    def result(self):
-        return self.quark.result(self.index)
-
-
-
-from .assembler import MAPPING, assemble, ccompile, decode, initialize
-from .calculator import calculate
-from .device import read, write
-from .processor import process
-from .rule import postprocess
+    def result(self, timeout: float = 3.0):
+        return self.quark.result(self.index, timeout=timeout)
```

## vios/envelope/processor.py

```diff
@@ -22,14 +22,16 @@
         dict: 处理后的数据，形式为{'key1':np.array,'key2':np.array, ...}
     """
     # print('ddddddddddoooooooooooooooooooooo', kwds)
     # print("=============================================",raw_data)
 
     dataMap = kwds.get('dataMap', {'arch': 'baqis'})
     result = {}
+    import numpy as np
+    return {'data': np.ones((1000, 1000)),'data2': np.ones((10, 10))}
 
     try:
 
         if 'arch' in dataMap and dataMap['arch'] == 'general':
             return raw_data['READ']['AD']
         elif list(dataMap.keys()) == ['arch']:  # for NA
             if 'READ' in raw_data:
```

## vios/envelope/rule.py

```diff
@@ -10,37 +10,57 @@
 
 from .. import startup
 
 try:
     with open(Path(startup.get('site', ''))/'etc/cloud.json', 'r') as f:
         CLOUD = json.loads(f.read())
 except Exception as e:
-    print(e)
+    # print(e)
     CLOUD = {}
 
 
+def savefig(result):
+    import matplotlib
+    import matplotlib.pyplot as plt
+    matplotlib.use('agg')
+
+
+    fig, ax = plt.subplots(2, 2, figsize=[9, 9])
+    ax = ax.flatten()
+    for a in ax:
+        a.plot([1,2,3])
+    plt.savefig(('test.png'))
+
+
+
 def postprocess(result: dict):
     """任务执行完后对数据的操作，如存储到自定义路径或回传到云平台等
 
     Args:
-        result (dict): 任务结果，包含数据段和基本描述信息
+        result (dict): 任务结果，包含
+          - meta: task中metainfo字段的内容，执行时会扩充坐标轴、id、priority、执行状态等信息
+          - data: 值为np.array, 形如{'iq':np.array,'count':np.array}
+          - info: 任务执行过程中记录下的系统信息，包括CPU、内存、网络等
+          - task: 原始任务
+          - snapshot: 当前任务对应的cfg表快照
     """
     def _delete_dict(ret: dict, num: int = 0):
         while num > 0:
             tmp = np.cumsum(list(ret.values()))
             ran_num = np.random.randint(tmp[-1]+1)
             ran_pos = np.searchsorted(tmp, ran_num)
             ret[list(ret.keys())[ran_pos]] -= 1
             if ret[list(ret.keys())[ran_pos]] == 0:
                 ret.pop(list(ret.keys())[ran_pos], 0)
             num -= 1
 
     # print(result.keys(),result['meta'].keys())
 
     meta = result['meta']
+    # savefig(result)
     print('Send result back  to', meta['user'])
     if not meta['user'].startswith('quafu'):
         return
     
     if not CLOUD:
         return
```

## Comparing `vios-1.0.8.dist-info/LICENSE` & `vios-1.0.9.dist-info/LICENSE`

 * *Files identical despite different names*

## Comparing `vios-1.0.8.dist-info/METADATA` & `vios-1.0.9.dist-info/METADATA`

 * *Files 11% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: vios
-Version: 1.0.8
+Version: 1.0.9
 Summary: runtime requirements for systemq
 Author-email: YL <fengyl@baqis.ac.cn>
 Project-URL: homepage, https://gitee.com
 Project-URL: bugs, https://gitee.com
 Classifier: Development Status :: 5 - Production/Stable
 Classifier: Intended Audience :: Developers
 Classifier: Intended Audience :: Science/Research
@@ -15,15 +15,15 @@
 Classifier: Operating System :: POSIX :: Linux
 Classifier: Operating System :: MacOS :: MacOS X
 Classifier: Programming Language :: Python :: 3.10
 Classifier: Topic :: Scientific/Engineering :: Physics
 Requires-Python: >=3.10
 Description-Content-Type: text/markdown
 License-File: LICENSE
-Requires-Dist: quarkstudio[full] (>=6.5.0rc15)
+Requires-Dist: quarkstudio[full] (>=6.5.0)
 Requires-Dist: waveforms
 Requires-Dist: pyvisa
 Requires-Dist: blinker
 
 ...
```

## Comparing `vios-1.0.8.dist-info/RECORD` & `vios-1.0.9.dist-info/RECORD`

 * *Files 14% similar despite different names*

```diff
@@ -1,23 +1,23 @@
-vios/__init__.py,sha256=pQ_BUjQ_ZCki4pI_wid9yJbQi_YK2uWG3rixAEbC670,781
-vios/collection/__init__.py,sha256=cKUpYHEREjZVHr6PZy_b1DL9c-dF--hAcVW1Wpc2OQM,6314
+vios/__init__.py,sha256=gP4SMTZ-lQ7GeFo-_KMMbwNjsq4WiuYHlq6_Qd2qAkc,853
+vios/collection/__init__.py,sha256=QQAiPGqjbhgP8eNltYCoT2V9WjhQavp_YT072gaWh20,6969
 vios/collection/support.py,sha256=78G1G0vyDInEfW4j4RGdt7uM8gt_M3_Ucm_3_zm7jB0,3515
 vios/collection/tasks.py,sha256=FUAGla2yjy4apdM5PLZ7yJP0YsbMajat1gm8bt7y7QI,11254
 vios/collection/uapi.py,sha256=bmjnw6XokSU-0Zkt7XTldjAY0kF48RbHuFVVnE-EkSI,10198
 vios/driver/VirtualDevice.py,sha256=sf87LAcRvJIVZW-OyP8Hw-CWu7isonbr2-TjFGZHYSk,4756
 vios/driver/__init__.py,sha256=rvTlhtDHO_l1rHNsgb3PA9LnEirl4TIm0bvlgRseRnY,2962
 vios/driver/common/__init__.py,sha256=rwnAg6V2hY1vinIHlvGwKTXn34SRQHX8bnIleycTM6k,209
 vios/driver/common/basedriver.py,sha256=jQ3svU_t1v0Zt8lRX8ij8MhwilmIwziozwuTFeRxRnE,4192
 vios/driver/common/quantity.py,sha256=70feNhld2lF04KHQ3zWDliS_cmD1q97Yi0oFqlwYijs,4666
 vios/driver/common/visadriver.py,sha256=WY6TqGmow_K5ePAYIYkG12IxjHfAczuxYTvPk4VmVG4,5546
-vios/envelope/__init__.py,sha256=1XevWes-wBaeEaSsJEG3OMJglYsKrdTf06--dfIXE5Y,979
+vios/envelope/__init__.py,sha256=85LF2bKl4k1Q1ck5muEQBpgsS9tqsb7kj0NkSKeBXhI,999
 vios/envelope/assembler.py,sha256=KE4Fcrid5UfBsbpOPz7eV2WJY1f7jXwVY0VtjwMvPBk,13446
 vios/envelope/calculator.py,sha256=eE7730YFzArrukuDh0dI0JabG2PiEz3eo3N4Czqgk88,10541
 vios/envelope/device.py,sha256=rQeLe_Y9MTwLZfJsSK9MhvZxdOnrtJNcOZriS6Rm1Io,1047
-vios/envelope/processor.py,sha256=4py3AwLurBTrhXXJCvdfHrMeKGzOFl-gICQTNjpoyQM,1719
-vios/envelope/rule.py,sha256=ANiUVCtozVP6B6m8En55VLqOHWdeMkuA7KqiAiFyAnQ,2980
+vios/envelope/processor.py,sha256=p3tCwcsvatrDovmShl02GabzW-i5ql1QMO2SLjAYLlc,1814
+vios/envelope/rule.py,sha256=qP034wQhzofTI77JPFXOws8u2koD6am_-VfvM1aL94k,3622
 vios/tools/__init__.py,sha256=vq-1N9Zjm_ZYcD9_lwX9fKlcMT9Rx7Kd3BDRqmKhMT0,522
-vios-1.0.8.dist-info/LICENSE,sha256=N0ypn_97IUjlPVBH8az2Wt02D-9ROQafRq1D6tcqorE,1089
-vios-1.0.8.dist-info/METADATA,sha256=dZ0ABAoFTGLWnh46duBuSFYsYRs0nno2uAQ_UbJawwU,1000
-vios-1.0.8.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
-vios-1.0.8.dist-info/top_level.txt,sha256=4DHqoaYuzp4X6-_w1r1lk0039QUzXe7OVi76KeUqjZM,5
-vios-1.0.8.dist-info/RECORD,,
+vios-1.0.9.dist-info/LICENSE,sha256=N0ypn_97IUjlPVBH8az2Wt02D-9ROQafRq1D6tcqorE,1089
+vios-1.0.9.dist-info/METADATA,sha256=uDFhjjZhGMIMdWSdrIIMTZlaY1v8exvekhMW2e5FhWc,996
+vios-1.0.9.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
+vios-1.0.9.dist-info/top_level.txt,sha256=4DHqoaYuzp4X6-_w1r1lk0039QUzXe7OVi76KeUqjZM,5
+vios-1.0.9.dist-info/RECORD,,
```

