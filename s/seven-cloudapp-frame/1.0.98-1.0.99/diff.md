# Comparing `tmp/seven_cloudapp_frame-1.0.98.tar.gz` & `tmp/seven_cloudapp_frame-1.0.99.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "dist/seven_cloudapp_frame-1.0.98.tar", last modified: Sun Jul 30 02:13:08 2023, max compression
+gzip compressed data, was "E:\Project\Gao7Git\seven_cloudapp_frame\dist\.tmp-z5wz02q9\seven_cloudapp_frame-1.0.99.tar", last modified: Sun Jul 30 07:59:16 2023, max compression
```

## Comparing `seven_cloudapp_frame-1.0.98.tar` & `seven_cloudapp_frame-1.0.99.tar`

### file list

```diff
@@ -1,244 +1,245 @@
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-30 02:13:08.639446 seven_cloudapp_frame-1.0.98/
--rw-r--r--   0 root         (0) root         (0)    10094 2023-07-30 02:13:08.638446 seven_cloudapp_frame-1.0.98/PKG-INFO
--rw-rw-rw-   0 root         (0) root         (0)     7561 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/README.md
--rw-r--r--   0 root         (0) root         (0)       38 2023-07-30 02:13:08.639446 seven_cloudapp_frame-1.0.98/setup.cfg
--rw-rw-rw-   0 root         (0) root         (0)     1469 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/setup.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-30 02:13:08.532446 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/
--rw-rw-rw-   0 root         (0) root         (0)      156 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/__init__.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-30 02:13:08.537447 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/handlers/
--rw-rw-rw-   0 root         (0) root         (0)      174 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/handlers/__init__.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-30 02:13:08.544447 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/handlers/client/
--rw-rw-rw-   0 root         (0) root         (0)      254 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/handlers/client/__init__.py
--rw-rw-rw-   0 root         (0) root         (0)    13740 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/handlers/client/act.py
--rw-rw-rw-   0 root         (0) root         (0)   398891 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/handlers/client/address.py
--rw-rw-rw-   0 root         (0) root         (0)     7051 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/handlers/client/app.py
--rw-rw-rw-   0 root         (0) root         (0)     3768 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/handlers/client/goods.py
--rw-rw-rw-   0 root         (0) root         (0)     1782 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/handlers/client/ip_c.py
--rw-rw-rw-   0 root         (0) root         (0)    16954 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/handlers/client/order.py
--rw-rw-rw-   0 root         (0) root         (0)    34434 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/handlers/client/pay.py
--rw-rw-rw-   0 root         (0) root         (0)     4920 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/handlers/client/stat.py
--rw-rw-rw-   0 root         (0) root         (0)    60139 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/handlers/client/task.py
--rw-rw-rw-   0 root         (0) root         (0)     4936 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/handlers/client/theme.py
--rw-rw-rw-   0 root         (0) root         (0)    19920 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/handlers/client/user.py
--rw-rw-rw-   0 root         (0) root         (0)      951 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/handlers/core.py
--rw-rw-rw-   0 root         (0) root         (0)     2928 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/handlers/filter_base.py
--rw-rw-rw-   0 root         (0) root         (0)    40438 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/handlers/frame_base.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-30 02:13:08.553446 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/handlers/server/
--rw-rw-rw-   0 root         (0) root         (0)      322 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/handlers/server/__init__.py
--rw-rw-rw-   0 root         (0) root         (0)    21965 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/handlers/server/act_s.py
--rw-rw-rw-   0 root         (0) root         (0)    19693 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/handlers/server/app_s.py
--rw-rw-rw-   0 root         (0) root         (0)     7054 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/handlers/server/base_s.py
--rw-rw-rw-   0 root         (0) root         (0)    10939 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/handlers/server/cms_s.py
--rw-rw-rw-   0 root         (0) root         (0)     9390 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/handlers/server/goods_s.py
--rw-rw-rw-   0 root         (0) root         (0)    14522 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/handlers/server/ip_s.py
--rw-rw-rw-   0 root         (0) root         (0)    14071 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/handlers/server/launch_s.py
--rw-rw-rw-   0 root         (0) root         (0)    15858 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/handlers/server/module_s.py
--rw-rw-rw-   0 root         (0) root         (0)    34252 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/handlers/server/order_s.py
--rw-rw-rw-   0 root         (0) root         (0)     8329 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/handlers/server/price_s.py
--rw-rw-rw-   0 root         (0) root         (0)    19115 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/handlers/server/prize_s.py
--rw-rw-rw-   0 root         (0) root         (0)     5473 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/handlers/server/report_s.py
--rw-rw-rw-   0 root         (0) root         (0)     6985 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/handlers/server/task_s.py
--rw-rw-rw-   0 root         (0) root         (0)     2547 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/handlers/server/theme_s.py
--rw-rw-rw-   0 root         (0) root         (0)    23361 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/handlers/server/user_s.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-30 02:13:08.553446 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/libs/
--rw-rw-rw-   0 root         (0) root         (0)      132 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/libs/__init__.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-30 02:13:08.555446 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/libs/common/
--rw-rw-rw-   0 root         (0) root         (0)      182 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/libs/common/__init__.py
--rw-rw-rw-   0 root         (0) root         (0)      424 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/libs/common/frame_console.py
--rw-rw-rw-   0 root         (0) root         (0)      429 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/libs/common/frame_tornado.py
--rw-rw-rw-   0 root         (0) root         (0)     1793 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/libs/common/share_config.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-30 02:13:08.564446 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/libs/customize/
--rw-rw-rw-   0 root         (0) root         (0)      155 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/libs/customize/__init__.py
--rw-rw-rw-   0 root         (0) root         (0)     5644 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/libs/customize/action_helper.py
--rw-rw-rw-   0 root         (0) root         (0)    10647 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/libs/customize/alipay_helper.py
--rw-rw-rw-   0 root         (0) root         (0)     8617 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/libs/customize/baidubce_helper.py
--rw-rw-rw-   0 root         (0) root         (0)     3124 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/libs/customize/bloomfilter_helper.py
--rw-rw-rw-   0 root         (0) root         (0)     7390 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/libs/customize/counter_helper.py
--rw-rw-rw-   0 root         (0) root         (0)     6276 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/libs/customize/cryptography_helper.py
--rw-rw-rw-   0 root         (0) root         (0)     2372 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/libs/customize/email_helper.py
--rw-rw-rw-   0 root         (0) root         (0)     8819 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/libs/customize/logistics_helper.py
--rw-rw-rw-   0 root         (0) root         (0)     4011 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/libs/customize/oss2_helper.py
--rw-rw-rw-   0 root         (0) root         (0)    35821 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/libs/customize/queue_up_helper.py
--rw-rw-rw-   0 root         (0) root         (0)     4517 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/libs/customize/redis_helper.py
--rw-rw-rw-   0 root         (0) root         (0)     9499 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/libs/customize/riskmanage_helper.py
--rw-rw-rw-   0 root         (0) root         (0)    22234 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/libs/customize/seven_helper.py
--rw-rw-rw-   0 root         (0) root         (0)    31547 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/libs/customize/tiktok_helper.py
--rw-rw-rw-   0 root         (0) root         (0)     3517 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/libs/customize/time_helper.py
--rw-rw-rw-   0 root         (0) root         (0)    89319 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/libs/customize/wechat_helper.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-30 02:13:08.579446 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/
--rw-rw-rw-   0 root         (0) root         (0)      132 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/__init__.py
--rw-rw-rw-   0 root         (0) root         (0)    21961 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/act_base_model.py
--rw-rw-rw-   0 root         (0) root         (0)    18619 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/app_base_model.py
--rw-rw-rw-   0 root         (0) root         (0)    47632 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/asset_base_model.py
--rw-rw-rw-   0 root         (0) root         (0)    30891 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/cache_model.py
--rw-rw-rw-   0 root         (0) root         (0)    12522 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/cms_base_model.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-30 02:13:08.582446 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/console_models/
--rw-rw-rw-   0 root         (0) root         (0)        0 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/console_models/__init__.py
--rw-rw-rw-   0 root         (0) root         (0)    15563 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/console_models/asset_console_model.py
--rw-rw-rw-   0 root         (0) root         (0)    19517 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/console_models/erp_console_model.py
--rw-rw-rw-   0 root         (0) root         (0)    10614 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/console_models/launch_console_model.py
--rw-rw-rw-   0 root         (0) root         (0)    23822 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/console_models/stat_console_model.py
--rw-rw-rw-   0 root         (0) root         (0)     2482 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/console_models/task_console_model.py
--rw-rw-rw-   0 root         (0) root         (0)     5257 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/console_models/timing_work_model.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-30 02:13:08.583446 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/
--rw-rw-rw-   0 root         (0) root         (0)        0 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/__init__.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-30 02:13:08.585446 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/act/
--rw-rw-rw-   0 root         (0) root         (0)       81 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/act/__init__.py
--rw-rw-rw-   0 root         (0) root         (0)     3683 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/act/act_info_model.py
--rw-rw-rw-   0 root         (0) root         (0)     2976 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/act/act_module_model.py
--rw-rw-rw-   0 root         (0) root         (0)     3750 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/act/act_prize_model.py
--rw-rw-rw-   0 root         (0) root         (0)     2552 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/act/act_type_model.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-30 02:13:08.586446 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/app/
--rw-rw-rw-   0 root         (0) root         (0)       27 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/app/__init__.py
--rw-rw-rw-   0 root         (0) root         (0)     3132 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/app/app_info_model.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-30 02:13:08.589446 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/asset/
--rw-rw-rw-   0 root         (0) root         (0)       97 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/asset/__init__.py
--rw-rw-rw-   0 root         (0) root         (0)     2152 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/asset/asset_inventory_model.py
--rw-rw-rw-   0 root         (0) root         (0)     3022 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/asset/asset_log_model.py
--rw-rw-rw-   0 root         (0) root         (0)     1521 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/asset/asset_only_model.py
--rw-rw-rw-   0 root         (0) root         (0)     1951 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/asset/asset_warn_notice_model.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-30 02:13:08.590446 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/base/
--rw-rw-rw-   0 root         (0) root         (0)       28 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/base/__init__.py
--rw-rw-rw-   0 root         (0) root         (0)     2964 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/base/base_info_model.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-30 02:13:08.591446 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/browse/
--rw-rw-rw-   0 root         (0) root         (0)       29 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/browse/__init__.py
--rw-rw-rw-   0 root         (0) root         (0)     1539 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/browse/browse_log_model.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-30 02:13:08.593446 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/cms/
--rw-rw-rw-   0 root         (0) root         (0)       45 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/cms/__init__.py
--rw-rw-rw-   0 root         (0) root         (0)     2674 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/cms/cms_info_model.py
--rw-rw-rw-   0 root         (0) root         (0)     1702 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/cms/cms_place_model.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-30 02:13:08.594446 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/collect/
--rw-rw-rw-   0 root         (0) root         (0)       30 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/collect/__init__.py
--rw-rw-rw-   0 root         (0) root         (0)     1534 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/collect/collect_log_model.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-30 02:13:08.595446 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/counter/
--rw-rw-rw-   0 root         (0) root         (0)       32 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/counter/__init__.py
--rw-rw-rw-   0 root         (0) root         (0)     1630 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/counter/counter_config_model.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-30 02:13:08.595446 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/dict/
--rw-rw-rw-   0 root         (0) root         (0)      183 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/dict/__init__.py
--rw-rw-rw-   0 root         (0) root         (0)     1758 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/dict/dict_info_model.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-30 02:13:08.597446 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/erp/
--rw-rw-rw-   0 root         (0) root         (0)       31 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/erp/__init__.py
--rw-rw-rw-   0 root         (0) root         (0)     1572 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/erp/erp_relation_model.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-30 02:13:08.598446 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/friend/
--rw-rw-rw-   0 root         (0) root         (0)       30 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/friend/__init__.py
--rw-rw-rw-   0 root         (0) root         (0)     1804 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/friend/friend_link_model.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-30 02:13:08.601446 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/function/
--rw-rw-rw-   0 root         (0) root         (0)      131 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/function/__init__.py
--rw-rw-rw-   0 root         (0) root         (0)     1680 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/function/function_info_model.py
--rw-rw-rw-   0 root         (0) root         (0)     1929 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/function/function_module_model.py
--rw-rw-rw-   0 root         (0) root         (0)     1537 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/function/function_product_model.py
--rw-rw-rw-   0 root         (0) root         (0)     2691 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/function/function_shop_model.py
--rw-rw-rw-   0 root         (0) root         (0)     1666 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/function/function_skin_model.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-30 02:13:08.602446 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/invite/
--rw-rw-rw-   0 root         (0) root         (0)       48 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/invite/__init__.py
--rw-rw-rw-   0 root         (0) root         (0)     2299 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/invite/invite_help_model.py
--rw-rw-rw-   0 root         (0) root         (0)     1886 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/invite/invite_log_model.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-30 02:13:08.604446 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/ip/
--rw-rw-rw-   0 root         (0) root         (0)       42 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/ip/__init__.py
--rw-rw-rw-   0 root         (0) root         (0)     1960 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/ip/ip_info_model.py
--rw-rw-rw-   0 root         (0) root         (0)     1553 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/ip/ip_type_model.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-30 02:13:08.606446 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/launch/
--rw-rw-rw-   0 root         (0) root         (0)       51 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/launch/__init__.py
--rw-rw-rw-   0 root         (0) root         (0)     1706 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/launch/launch_goods_model.py
--rw-rw-rw-   0 root         (0) root         (0)     1686 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/launch/launch_plan_model.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-30 02:13:08.607446 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/marketing/
--rw-rw-rw-   0 root         (0) root         (0)       36 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/marketing/__init__.py
--rw-rw-rw-   0 root         (0) root         (0)     1639 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/marketing/marketing_program_model.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-30 02:13:08.608446 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/middler/
--rw-rw-rw-   0 root         (0) root         (0)       34 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/middler/__init__.py
--rw-rw-rw-   0 root         (0) root         (0)     1797 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/middler/middler_product_model.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-30 02:13:08.610446 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/operation/
--rw-rw-rw-   0 root         (0) root         (0)       60 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/operation/__init__.py
--rw-rw-rw-   0 root         (0) root         (0)     1312 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/operation/operation_config_model.py
--rw-rw-rw-   0 root         (0) root         (0)     2525 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/operation/operation_log_model.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-30 02:13:08.611446 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/pay/
--rw-rw-rw-   0 root         (0) root         (0)       28 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/pay/__init__.py
--rw-rw-rw-   0 root         (0) root         (0)     2568 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/pay/pay_order_model.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-30 02:13:08.612446 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/price/
--rw-rw-rw-   0 root         (0) root         (0)       29 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/price/__init__.py
--rw-rw-rw-   0 root         (0) root         (0)     1789 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/price/price_gear_model.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-30 02:13:08.614446 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/prize/
--rw-rw-rw-   0 root         (0) root         (0)       51 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/prize/__init__.py
--rw-rw-rw-   0 root         (0) root         (0)     3834 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/prize/prize_order_model.py
--rw-rw-rw-   0 root         (0) root         (0)     3906 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/prize/prize_roster_model.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-30 02:13:08.615446 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/product/
--rw-rw-rw-   0 root         (0) root         (0)       32 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/product/__init__.py
--rw-rw-rw-   0 root         (0) root         (0)     1963 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/product/product_price_model.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-30 02:13:08.616446 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/refund/
--rw-rw-rw-   0 root         (0) root         (0)       31 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/refund/__init__.py
--rw-rw-rw-   0 root         (0) root         (0)     2136 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/refund/refund_order_model.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-30 02:13:08.617446 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/saas/
--rw-rw-rw-   0 root         (0) root         (0)       30 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/saas/__init__.py
--rw-rw-rw-   0 root         (0) root         (0)     1841 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/saas/saas_custom_model.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-30 02:13:08.618446 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/skin/
--rw-rw-rw-   0 root         (0) root         (0)       28 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/skin/__init__.py
--rw-rw-rw-   0 root         (0) root         (0)     1687 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/skin/skin_info_model.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-30 02:13:08.619446 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/special/
--rw-rw-rw-   0 root         (0) root         (0)       32 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/special/__init__.py
--rw-rw-rw-   0 root         (0) root         (0)     1413 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/special/special_goods_model.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-30 02:13:08.623446 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/stat/
--rw-rw-rw-   0 root         (0) root         (0)      130 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/stat/__init__.py
--rw-rw-rw-   0 root         (0) root         (0)     1666 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/stat/stat_log_model.py
--rw-rw-rw-   0 root         (0) root         (0)     2061 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/stat/stat_orm_model.py
--rw-rw-rw-   0 root         (0) root         (0)     1685 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/stat/stat_queue_model.py
--rw-rw-rw-   0 root         (0) root         (0)     1643 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/stat/stat_report_model.py
--rw-rw-rw-   0 root         (0) root         (0)     1699 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/stat/stat_user_log_model.py
--rw-rw-rw-   0 root         (0) root         (0)     2604 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/stat/stat_user_report_model.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-30 02:13:08.624446 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/store/
--rw-rw-rw-   0 root         (0) root         (0)       54 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/store/__init__.py
--rw-rw-rw-   0 root         (0) root         (0)     2823 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/store/store_asset_log_model.py
--rw-rw-rw-   0 root         (0) root         (0)     1872 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/store/store_asset_model.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-30 02:13:08.627446 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/tao/
--rw-rw-rw-   0 root         (0) root         (0)       73 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/tao/__init__.py
--rw-rw-rw-   0 root         (0) root         (0)     2098 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/tao/tao_coupon_model.py
--rw-rw-rw-   0 root         (0) root         (0)     1563 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/tao/tao_login_log_model.py
--rw-rw-rw-   0 root         (0) root         (0)     3008 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/tao/tao_pay_order_model.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-30 02:13:08.630446 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/task/
--rw-rw-rw-   0 root         (0) root         (0)       93 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/task/__init__.py
--rw-rw-rw-   0 root         (0) root         (0)     1999 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/task/task_count_model.py
--rw-rw-rw-   0 root         (0) root         (0)     1861 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/task/task_gear_count_model.py
--rw-rw-rw-   0 root         (0) root         (0)     2110 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/task/task_info_model.py
--rw-rw-rw-   0 root         (0) root         (0)     2238 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/task/task_log_model.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-30 02:13:08.631446 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/theme/
--rw-rw-rw-   0 root         (0) root         (0)       47 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/theme/__init__.py
--rw-rw-rw-   0 root         (0) root         (0)     1725 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/theme/theme_info_model.py
--rw-rw-rw-   0 root         (0) root         (0)     1444 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/theme/theme_ver_model.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-30 02:13:08.632446 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/third/
--rw-rw-rw-   0 root         (0) root         (0)       34 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/third/__init__.py
--rw-rw-rw-   0 root         (0) root         (0)     2720 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/third/third_pay_order_model.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-30 02:13:08.636446 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/user/
--rw-rw-rw-   0 root         (0) root         (0)      108 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/user/__init__.py
--rw-rw-rw-   0 root         (0) root         (0)     2292 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/user/user_account_model.py
--rw-rw-rw-   0 root         (0) root         (0)     1779 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/user/user_address_model.py
--rw-rw-rw-   0 root         (0) root         (0)     1983 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/user/user_asset_model.py
--rw-rw-rw-   0 root         (0) root         (0)     1929 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/user/user_black_model.py
--rw-rw-rw-   0 root         (0) root         (0)     2917 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/user/user_info_model.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-30 02:13:08.637446 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/version/
--rw-rw-rw-   0 root         (0) root         (0)       31 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/version/__init__.py
--rw-rw-rw-   0 root         (0) root         (0)     1807 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/version/version_info_model.py
--rw-rw-rw-   0 root         (0) root         (0)     9504 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/enum.py
--rw-rw-rw-   0 root         (0) root         (0)    25479 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/frame_base_model.py
--rw-rw-rw-   0 root         (0) root         (0)    11486 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/goods_base_model.py
--rw-rw-rw-   0 root         (0) root         (0)    14055 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/ip_base_model.py
--rw-rw-rw-   0 root         (0) root         (0)    28425 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/launch_base_model.py
--rw-rw-rw-   0 root         (0) root         (0)    11914 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/module_base_model.py
--rw-rw-rw-   0 root         (0) root         (0)    20741 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/mp_base_model.py
--rw-rw-rw-   0 root         (0) root         (0)    14439 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/operate_base_model.py
--rw-rw-rw-   0 root         (0) root         (0)    63952 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/order_base_model.py
--rw-rw-rw-   0 root         (0) root         (0)    10462 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/price_base_model.py
--rw-rw-rw-   0 root         (0) root         (0)    15242 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/prize_base_model.py
--rw-rw-rw-   0 root         (0) root         (0)     4500 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/push_base_model.py
--rw-rw-rw-   0 root         (0) root         (0)    13979 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/seven_model.py
--rw-rw-rw-   0 root         (0) root         (0)    12725 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/shakeshop_base_model.py
--rw-rw-rw-   0 root         (0) root         (0)    22903 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/stat_base_model.py
--rw-rw-rw-   0 root         (0) root         (0)   258119 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/task_base_model.py
--rw-rw-rw-   0 root         (0) root         (0)    13156 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/theme_base_model.py
--rw-rw-rw-   0 root         (0) root         (0)    90824 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/top_base_model.py
--rw-rw-rw-   0 root         (0) root         (0)    45754 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/user_base_model.py
--rw-rw-rw-   0 root         (0) root         (0)    14672 2023-07-30 02:12:37.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/route.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-30 02:13:08.535447 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame.egg-info/
--rw-r--r--   0 root         (0) root         (0)    10094 2023-07-30 02:13:08.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame.egg-info/PKG-INFO
--rw-r--r--   0 root         (0) root         (0)    10792 2023-07-30 02:13:08.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame.egg-info/SOURCES.txt
--rw-r--r--   0 root         (0) root         (0)        1 2023-07-30 02:13:08.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame.egg-info/dependency_links.txt
--rw-r--r--   0 root         (0) root         (0)      139 2023-07-30 02:13:08.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame.egg-info/requires.txt
--rw-r--r--   0 root         (0) root         (0)       21 2023-07-30 02:13:08.000000 seven_cloudapp_frame-1.0.98/seven_cloudapp_frame.egg-info/top_level.txt
+drwxrwxrwx   0        0        0        0 2023-07-30 07:59:16.817317 seven_cloudapp_frame-1.0.99/
+-rw-rw-rw-   0        0        0     1081 2021-04-09 01:22:35.000000 seven_cloudapp_frame-1.0.99/LICENSE
+-rw-rw-rw-   0        0        0     8582 2023-07-30 07:59:16.814319 seven_cloudapp_frame-1.0.99/PKG-INFO
+-rw-rw-rw-   0        0        0     7779 2023-03-22 04:00:14.000000 seven_cloudapp_frame-1.0.99/README.md
+-rw-rw-rw-   0        0        0       42 2023-07-30 07:59:16.817317 seven_cloudapp_frame-1.0.99/setup.cfg
+-rw-rw-rw-   0        0        0     1516 2023-07-30 07:58:24.000000 seven_cloudapp_frame-1.0.99/setup.py
+drwxrwxrwx   0        0        0        0 2023-07-30 07:59:15.253210 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/
+-rw-rw-rw-   0        0        0      164 2023-07-26 11:29:42.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/__init__.py
+drwxrwxrwx   0        0        0        0 2023-07-30 07:59:15.318174 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/handlers/
+-rw-rw-rw-   0        0        0      182 2023-07-26 11:29:42.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/handlers/__init__.py
+drwxrwxrwx   0        0        0        0 2023-07-30 07:59:15.482080 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/handlers/client/
+-rw-rw-rw-   0        0        0      263 2023-07-26 11:29:42.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/handlers/client/__init__.py
+-rw-rw-rw-   0        0        0    14013 2023-07-26 11:29:42.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/handlers/client/act.py
+-rw-rw-rw-   0        0        0   411248 2023-07-26 11:29:42.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/handlers/client/address.py
+-rw-rw-rw-   0        0        0     7208 2023-07-26 11:29:42.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/handlers/client/app.py
+-rw-rw-rw-   0        0        0     3849 2023-07-26 11:29:42.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/handlers/client/goods.py
+-rw-rw-rw-   0        0        0     1825 2023-07-26 11:29:42.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/handlers/client/ip_c.py
+-rw-rw-rw-   0        0        0    17290 2023-07-26 11:29:42.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/handlers/client/order.py
+-rw-rw-rw-   0        0        0    34999 2023-07-30 07:54:28.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/handlers/client/pay.py
+-rw-rw-rw-   0        0        0     5038 2023-07-26 11:29:42.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/handlers/client/stat.py
+-rw-rw-rw-   0        0        0    61113 2023-07-26 11:29:42.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/handlers/client/task.py
+-rw-rw-rw-   0        0        0     5070 2023-07-26 11:29:42.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/handlers/client/theme.py
+-rw-rw-rw-   0        0        0    20371 2023-07-26 11:29:42.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/handlers/client/user.py
+-rw-rw-rw-   0        0        0      986 2023-07-26 11:29:42.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/handlers/core.py
+-rw-rw-rw-   0        0        0     3005 2023-07-26 11:29:42.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/handlers/filter_base.py
+-rw-rw-rw-   0        0        0    41284 2023-07-26 11:29:42.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/handlers/frame_base.py
+drwxrwxrwx   0        0        0        0 2023-07-30 07:59:15.628996 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/handlers/server/
+-rw-rw-rw-   0        0        0      331 2023-07-26 11:29:42.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/handlers/server/__init__.py
+-rw-rw-rw-   0        0        0    22416 2023-07-26 11:29:42.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/handlers/server/act_s.py
+-rw-rw-rw-   0        0        0    20114 2023-07-26 11:29:42.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/handlers/server/app_s.py
+-rw-rw-rw-   0        0        0     7213 2023-07-26 11:29:42.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/handlers/server/base_s.py
+-rw-rw-rw-   0        0        0    11160 2023-07-26 11:29:42.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/handlers/server/cms_s.py
+-rw-rw-rw-   0        0        0     9607 2023-07-26 11:29:42.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/handlers/server/goods_s.py
+-rw-rw-rw-   0        0        0    14810 2023-07-26 11:29:42.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/handlers/server/ip_s.py
+-rw-rw-rw-   0        0        0    14383 2023-07-26 11:29:42.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/handlers/server/launch_s.py
+-rw-rw-rw-   0        0        0    16183 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/handlers/server/module_s.py
+-rw-rw-rw-   0        0        0    34887 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/handlers/server/order_s.py
+-rw-rw-rw-   0        0        0     8509 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/handlers/server/price_s.py
+-rw-rw-rw-   0        0        0    19482 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/handlers/server/prize_s.py
+-rw-rw-rw-   0        0        0     5568 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/handlers/server/report_s.py
+-rw-rw-rw-   0        0        0     7123 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/handlers/server/task_s.py
+-rw-rw-rw-   0        0        0     2622 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/handlers/server/theme_s.py
+-rw-rw-rw-   0        0        0    23860 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/handlers/server/user_s.py
+drwxrwxrwx   0        0        0        0 2023-07-30 07:59:15.636991 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/libs/
+-rw-rw-rw-   0        0        0      139 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/libs/__init__.py
+drwxrwxrwx   0        0        0        0 2023-07-30 07:59:15.667974 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/libs/common/
+-rw-rw-rw-   0        0        0      190 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/libs/common/__init__.py
+-rw-rw-rw-   0        0        0      437 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/libs/common/frame_console.py
+-rw-rw-rw-   0        0        0      443 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/libs/common/frame_tornado.py
+-rw-rw-rw-   0        0        0     1864 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/libs/common/share_config.py
+drwxrwxrwx   0        0        0        0 2023-07-30 07:59:15.795901 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/libs/customize/
+-rw-rw-rw-   0        0        0      162 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/libs/customize/__init__.py
+-rw-rw-rw-   0        0        0     5792 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/libs/customize/action_helper.py
+-rw-rw-rw-   0        0        0    10880 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/libs/customize/alipay_helper.py
+-rw-rw-rw-   0        0        0     8816 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/libs/customize/baidubce_helper.py
+-rw-rw-rw-   0        0        0     3195 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/libs/customize/bloomfilter_helper.py
+-rw-rw-rw-   0        0        0     7562 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/libs/customize/counter_helper.py
+-rw-rw-rw-   0        0        0     6437 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/libs/customize/cryptography_helper.py
+-rw-rw-rw-   0        0        0     2430 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/libs/customize/email_helper.py
+-rw-rw-rw-   0        0        0     8982 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/libs/customize/logistics_helper.py
+-rw-rw-rw-   0        0        0     4116 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/libs/customize/oss2_helper.py
+-rw-rw-rw-   0        0        0    36523 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/libs/customize/queue_up_helper.py
+-rw-rw-rw-   0        0        0     4638 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/libs/customize/redis_helper.py
+-rw-rw-rw-   0        0        0     9745 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/libs/customize/riskmanage_helper.py
+-rw-rw-rw-   0        0        0    22874 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/libs/customize/seven_helper.py
+-rw-rw-rw-   0        0        0    32214 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/libs/customize/tiktok_helper.py
+-rw-rw-rw-   0        0        0     3623 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/libs/customize/time_helper.py
+-rw-rw-rw-   0        0        0    91008 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/libs/customize/wechat_helper.py
+drwxrwxrwx   0        0        0        0 2023-07-30 07:59:15.965805 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/
+-rw-rw-rw-   0        0        0      139 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/__init__.py
+-rw-rw-rw-   0        0        0    22422 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/act_base_model.py
+-rw-rw-rw-   0        0        0    19019 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/app_base_model.py
+-rw-rw-rw-   0        0        0    48537 2023-07-30 07:54:28.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/asset_base_model.py
+-rw-rw-rw-   0        0        0    31515 2023-07-30 07:54:28.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/cache_model.py
+-rw-rw-rw-   0        0        0    12778 2023-07-30 07:54:28.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/cms_base_model.py
+drwxrwxrwx   0        0        0        0 2023-07-30 07:59:16.013777 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/console_models/
+-rw-rw-rw-   0        0        0        0 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/console_models/__init__.py
+-rw-rw-rw-   0        0        0    15849 2023-07-30 07:54:28.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/console_models/asset_console_model.py
+-rw-rw-rw-   0        0        0    19804 2023-07-30 07:54:28.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/console_models/erp_console_model.py
+-rw-rw-rw-   0        0        0    10806 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/console_models/launch_console_model.py
+-rw-rw-rw-   0        0        0    24234 2023-07-30 07:54:28.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/console_models/stat_console_model.py
+-rw-rw-rw-   0        0        0     2545 2023-07-30 07:54:28.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/console_models/task_console_model.py
+-rw-rw-rw-   0        0        0     5379 2023-07-30 07:54:28.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/console_models/timing_work_model.py
+drwxrwxrwx   0        0        0        0 2023-07-30 07:59:16.019773 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/
+-rw-rw-rw-   0        0        0        0 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/__init__.py
+drwxrwxrwx   0        0        0        0 2023-07-30 07:59:16.058751 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/act/
+-rw-rw-rw-   0        0        0       81 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/act/__init__.py
+-rw-rw-rw-   0        0        0     3768 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/act/act_info_model.py
+-rw-rw-rw-   0        0        0     3050 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/act/act_module_model.py
+-rw-rw-rw-   0        0        0     3834 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/act/act_prize_model.py
+-rw-rw-rw-   0        0        0     2611 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/act/act_type_model.py
+drwxrwxrwx   0        0        0        0 2023-07-30 07:59:16.069744 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/app/
+-rw-rw-rw-   0        0        0       27 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/app/__init__.py
+-rw-rw-rw-   0        0        0     3207 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/app/app_info_model.py
+drwxrwxrwx   0        0        0        0 2023-07-30 07:59:16.104725 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/asset/
+-rw-rw-rw-   0        0        0       97 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/asset/__init__.py
+-rw-rw-rw-   0        0        0     2208 2023-07-30 07:54:28.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/asset/asset_inventory_model.py
+-rw-rw-rw-   0        0        0     3088 2023-07-30 07:54:28.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/asset/asset_log_model.py
+-rw-rw-rw-   0        0        0     1568 2023-07-30 07:54:28.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/asset/asset_only_model.py
+-rw-rw-rw-   0        0        0     1999 2023-07-30 07:54:28.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/asset/asset_warn_notice_model.py
+drwxrwxrwx   0        0        0        0 2023-07-30 07:59:16.119716 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/base/
+-rw-rw-rw-   0        0        0       28 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/base/__init__.py
+-rw-rw-rw-   0        0        0     3034 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/base/base_info_model.py
+drwxrwxrwx   0        0        0        0 2023-07-30 07:59:16.131709 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/browse/
+-rw-rw-rw-   0        0        0       29 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/browse/__init__.py
+-rw-rw-rw-   0        0        0     1588 2023-07-30 07:54:28.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/browse/browse_log_model.py
+drwxrwxrwx   0        0        0        0 2023-07-30 07:59:16.151698 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/cms/
+-rw-rw-rw-   0        0        0       45 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/cms/__init__.py
+-rw-rw-rw-   0        0        0     2743 2023-07-30 07:54:28.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/cms/cms_info_model.py
+-rw-rw-rw-   0        0        0     1752 2023-07-30 07:54:28.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/cms/cms_place_model.py
+drwxrwxrwx   0        0        0        0 2023-07-30 07:59:16.167689 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/collect/
+-rw-rw-rw-   0        0        0       30 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/collect/__init__.py
+-rw-rw-rw-   0        0        0     1581 2023-07-30 07:54:28.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/collect/collect_log_model.py
+drwxrwxrwx   0        0        0        0 2023-07-30 07:59:16.186677 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/counter/
+-rw-rw-rw-   0        0        0       32 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/counter/__init__.py
+-rw-rw-rw-   0        0        0     1679 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/counter/counter_config_model.py
+drwxrwxrwx   0        0        0        0 2023-07-30 07:59:16.205667 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/dict/
+-rw-rw-rw-   0        0        0      191 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/dict/__init__.py
+-rw-rw-rw-   0        0        0     1811 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/dict/dict_info_model.py
+drwxrwxrwx   0        0        0        0 2023-07-30 07:59:16.228654 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/erp/
+-rw-rw-rw-   0        0        0       31 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/erp/__init__.py
+-rw-rw-rw-   0        0        0     1613 2023-07-30 07:54:28.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/erp/erp_relation_model.py
+drwxrwxrwx   0        0        0        0 2023-07-30 07:59:16.248642 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/friend/
+-rw-rw-rw-   0        0        0       30 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/friend/__init__.py
+-rw-rw-rw-   0        0        0     1855 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/friend/friend_link_model.py
+drwxrwxrwx   0        0        0        0 2023-07-30 07:59:16.287620 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/function/
+-rw-rw-rw-   0        0        0      132 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/function/__init__.py
+-rw-rw-rw-   0        0        0     1730 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/function/function_info_model.py
+-rw-rw-rw-   0        0        0     1980 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/function/function_module_model.py
+-rw-rw-rw-   0        0        0     1584 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/function/function_product_model.py
+-rw-rw-rw-   0        0        0     2752 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/function/function_shop_model.py
+-rw-rw-rw-   0        0        0     1716 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/function/function_skin_model.py
+drwxrwxrwx   0        0        0        0 2023-07-30 07:59:16.310607 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/invite/
+-rw-rw-rw-   0        0        0       48 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/invite/__init__.py
+-rw-rw-rw-   0        0        0     2359 2023-07-30 07:54:28.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/invite/invite_help_model.py
+-rw-rw-rw-   0        0        0     1938 2023-07-30 07:54:28.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/invite/invite_log_model.py
+drwxrwxrwx   0        0        0        0 2023-07-30 07:59:16.329595 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/ip/
+-rw-rw-rw-   0        0        0       42 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/ip/__init__.py
+-rw-rw-rw-   0        0        0     2016 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/ip/ip_info_model.py
+-rw-rw-rw-   0        0        0     1602 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/ip/ip_type_model.py
+drwxrwxrwx   0        0        0        0 2023-07-30 07:59:16.350583 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/launch/
+-rw-rw-rw-   0        0        0       51 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/launch/__init__.py
+-rw-rw-rw-   0        0        0     1755 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/launch/launch_goods_model.py
+-rw-rw-rw-   0        0        0     1734 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/launch/launch_plan_model.py
+drwxrwxrwx   0        0        0        0 2023-07-30 07:59:16.363577 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/marketing/
+-rw-rw-rw-   0        0        0       36 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/marketing/__init__.py
+-rw-rw-rw-   0        0        0     1687 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/marketing/marketing_program_model.py
+drwxrwxrwx   0        0        0        0 2023-07-30 07:59:16.378567 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/middler/
+-rw-rw-rw-   0        0        0       34 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/middler/__init__.py
+-rw-rw-rw-   0        0        0     1847 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/middler/middler_product_model.py
+drwxrwxrwx   0        0        0        0 2023-07-30 07:59:16.399557 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/operation/
+-rw-rw-rw-   0        0        0       61 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/operation/__init__.py
+-rw-rw-rw-   0        0        0     1357 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/operation/operation_config_model.py
+-rw-rw-rw-   0        0        0     2588 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/operation/operation_log_model.py
+drwxrwxrwx   0        0        0        0 2023-07-30 07:59:16.412549 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/pay/
+-rw-rw-rw-   0        0        0       28 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/pay/__init__.py
+-rw-rw-rw-   0        0        0     2629 2023-07-30 07:54:28.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/pay/pay_order_model.py
+drwxrwxrwx   0        0        0        0 2023-07-30 07:59:16.425542 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/price/
+-rw-rw-rw-   0        0        0       29 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/price/__init__.py
+-rw-rw-rw-   0        0        0     1835 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/price/price_gear_model.py
+drwxrwxrwx   0        0        0        0 2023-07-30 07:59:16.448528 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/prize/
+-rw-rw-rw-   0        0        0       51 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/prize/__init__.py
+-rw-rw-rw-   0        0        0     3920 2023-07-30 07:54:28.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/prize/prize_order_model.py
+-rw-rw-rw-   0        0        0     3994 2023-07-30 07:54:28.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/prize/prize_roster_model.py
+drwxrwxrwx   0        0        0        0 2023-07-30 07:59:16.460521 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/product/
+-rw-rw-rw-   0        0        0       32 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/product/__init__.py
+-rw-rw-rw-   0        0        0     2012 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/product/product_price_model.py
+drwxrwxrwx   0        0        0        0 2023-07-30 07:59:16.477511 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/refund/
+-rw-rw-rw-   0        0        0       31 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/refund/__init__.py
+-rw-rw-rw-   0        0        0     2191 2023-07-30 07:54:28.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/refund/refund_order_model.py
+drwxrwxrwx   0        0        0        0 2023-07-30 07:59:16.491504 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/saas/
+-rw-rw-rw-   0        0        0       30 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/saas/__init__.py
+-rw-rw-rw-   0        0        0     1891 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/saas/saas_custom_model.py
+drwxrwxrwx   0        0        0        0 2023-07-30 07:59:16.505495 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/skin/
+-rw-rw-rw-   0        0        0       28 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/skin/__init__.py
+-rw-rw-rw-   0        0        0     1737 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/skin/skin_info_model.py
+drwxrwxrwx   0        0        0        0 2023-07-30 07:59:16.518490 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/special/
+-rw-rw-rw-   0        0        0       32 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/special/__init__.py
+-rw-rw-rw-   0        0        0     1458 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/special/special_goods_model.py
+drwxrwxrwx   0        0        0        0 2023-07-30 07:59:16.576454 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/stat/
+-rw-rw-rw-   0        0        0      130 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/stat/__init__.py
+-rw-rw-rw-   0        0        0     1717 2023-07-30 07:54:28.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/stat/stat_log_model.py
+-rw-rw-rw-   0        0        0     2119 2023-07-30 07:54:28.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/stat/stat_orm_model.py
+-rw-rw-rw-   0        0        0     1730 2023-07-30 07:54:28.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/stat/stat_queue_model.py
+-rw-rw-rw-   0        0        0     1693 2023-07-30 07:54:28.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/stat/stat_report_model.py
+-rw-rw-rw-   0        0        0     1750 2023-07-30 07:54:28.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/stat/stat_user_log_model.py
+-rw-rw-rw-   0        0        0     2682 2023-07-30 07:54:28.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/stat/stat_user_report_model.py
+drwxrwxrwx   0        0        0        0 2023-07-30 07:59:16.595444 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/store/
+-rw-rw-rw-   0        0        0       54 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/store/__init__.py
+-rw-rw-rw-   0        0        0     2887 2023-07-30 07:54:28.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/store/store_asset_log_model.py
+-rw-rw-rw-   0        0        0     1923 2023-07-30 07:54:28.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/store/store_asset_model.py
+drwxrwxrwx   0        0        0        0 2023-07-30 07:59:16.620430 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/tao/
+-rw-rw-rw-   0        0        0       73 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/tao/__init__.py
+-rw-rw-rw-   0        0        0     2152 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/tao/tao_coupon_model.py
+-rw-rw-rw-   0        0        0     1610 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/tao/tao_login_log_model.py
+-rw-rw-rw-   0        0        0     3082 2023-07-30 07:54:28.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/tao/tao_pay_order_model.py
+drwxrwxrwx   0        0        0        0 2023-07-30 07:59:16.651412 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/task/
+-rw-rw-rw-   0        0        0       94 2023-07-26 11:29:43.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/task/__init__.py
+-rw-rw-rw-   0        0        0     2052 2023-07-30 07:54:28.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/task/task_count_model.py
+-rw-rw-rw-   0        0        0     1914 2023-07-30 07:54:28.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/task/task_gear_count_model.py
+-rw-rw-rw-   0        0        0     2167 2023-07-30 07:54:28.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/task/task_info_model.py
+-rw-rw-rw-   0        0        0     2299 2023-07-30 07:54:28.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/task/task_log_model.py
+drwxrwxrwx   0        0        0        0 2023-07-30 07:59:16.713377 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/theme/
+-rw-rw-rw-   0        0        0       47 2023-07-26 11:29:44.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/theme/__init__.py
+-rw-rw-rw-   0        0        0     1775 2023-07-26 11:29:44.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/theme/theme_info_model.py
+-rw-rw-rw-   0        0        0     1490 2023-07-26 11:29:44.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/theme/theme_ver_model.py
+drwxrwxrwx   0        0        0        0 2023-07-30 07:59:16.727369 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/third/
+-rw-rw-rw-   0        0        0       34 2023-07-26 11:29:44.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/third/__init__.py
+-rw-rw-rw-   0        0        0     2785 2023-07-30 07:54:28.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/third/third_pay_order_model.py
+drwxrwxrwx   0        0        0        0 2023-07-30 07:59:16.796328 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/user/
+-rw-rw-rw-   0        0        0      108 2023-07-26 11:29:44.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/user/__init__.py
+-rw-rw-rw-   0        0        0     2352 2023-07-30 07:54:28.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/user/user_account_model.py
+-rw-rw-rw-   0        0        0     1832 2023-07-30 07:54:28.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/user/user_address_model.py
+-rw-rw-rw-   0        0        0     2035 2023-07-30 07:54:28.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/user/user_asset_model.py
+-rw-rw-rw-   0        0        0     1982 2023-07-30 07:54:28.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/user/user_black_model.py
+-rw-rw-rw-   0        0        0     2992 2023-07-30 07:54:28.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/user/user_info_model.py
+drwxrwxrwx   0        0        0        0 2023-07-30 07:59:16.808323 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/version/
+-rw-rw-rw-   0        0        0       31 2023-07-26 11:29:44.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/version/__init__.py
+-rw-rw-rw-   0        0        0     1849 2023-07-26 11:29:44.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/version/version_info_model.py
+-rw-rw-rw-   0        0        0     9631 2023-07-26 11:29:44.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/enum.py
+-rw-rw-rw-   0        0        0    26015 2023-07-26 11:29:44.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/frame_base_model.py
+-rw-rw-rw-   0        0        0    11676 2023-07-26 11:29:44.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/goods_base_model.py
+-rw-rw-rw-   0        0        0    14366 2023-07-26 11:29:44.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/ip_base_model.py
+-rw-rw-rw-   0        0        0    28969 2023-07-26 11:29:44.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/launch_base_model.py
+-rw-rw-rw-   0        0        0    12189 2023-07-26 11:29:44.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/module_base_model.py
+-rw-rw-rw-   0        0        0    21120 2023-07-30 07:57:46.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/mp_base_model.py
+-rw-rw-rw-   0        0        0    14717 2023-07-26 11:29:44.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/operate_base_model.py
+-rw-rw-rw-   0        0        0    65106 2023-07-30 07:54:28.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/order_base_model.py
+-rw-rw-rw-   0        0        0    10690 2023-07-26 11:29:44.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/price_base_model.py
+-rw-rw-rw-   0        0        0    15569 2023-07-26 11:29:44.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/prize_base_model.py
+-rw-rw-rw-   0        0        0     4592 2023-07-26 11:29:44.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/push_base_model.py
+-rw-rw-rw-   0        0        0    14491 2023-07-26 11:29:44.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/seven_model.py
+-rw-rw-rw-   0        0        0    13015 2023-07-26 11:29:44.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/shakeshop_base_model.py
+-rw-rw-rw-   0        0        0    23371 2023-07-30 07:54:28.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/stat_base_model.py
+-rw-rw-rw-   0        0        0   262022 2023-07-30 07:54:28.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/task_base_model.py
+-rw-rw-rw-   0        0        0    13440 2023-07-26 11:29:44.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/theme_base_model.py
+-rw-rw-rw-   0        0        0    92615 2023-07-26 11:29:44.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/top_base_model.py
+-rw-rw-rw-   0        0        0    46669 2023-07-30 07:54:28.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/user_base_model.py
+-rw-rw-rw-   0        0        0    14845 2023-07-26 11:29:44.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/route.py
+drwxrwxrwx   0        0        0        0 2023-07-30 07:59:15.289191 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame.egg-info/
+-rw-rw-rw-   0        0        0     8582 2023-07-30 07:59:14.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame.egg-info/PKG-INFO
+-rw-rw-rw-   0        0        0    10800 2023-07-30 07:59:14.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame.egg-info/SOURCES.txt
+-rw-rw-rw-   0        0        0        1 2023-07-30 07:59:14.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame.egg-info/dependency_links.txt
+-rw-rw-rw-   0        0        0      139 2023-07-30 07:59:14.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame.egg-info/requires.txt
+-rw-rw-rw-   0        0        0       21 2023-07-30 07:59:14.000000 seven_cloudapp_frame-1.0.99/seven_cloudapp_frame.egg-info/top_level.txt
```

### Comparing `seven_cloudapp_frame-1.0.98/README.md` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame.egg-info/PKG-INFO`

 * *Files 11% similar despite different names*

```diff
@@ -1,219 +1,240 @@
-# seven_cloudapp_frame
-
-## 天志互联Python云应用框架库
-
-### 1.0.65.2 更新内容
-* 如果是测试环境，则默认取最新的活动，用于前端测试使用
-
-### 1.0.65.1 更新内容
-* 大数据表支持分表模式
-
-### 1.0.52.19 更新内容
-* 操作日志模块
-
-### 1.0.50.6 更新内容
-* 排队系统加踢人日志记录到info里
-
-### 1.0.33.4 更新内容
-* 废弃get_source_app_id，统一使用get_app_id
-
-### 1.0.19.1 更新内容
-* 登录接口用户信息走缓存
-
-### 1.0.15 更新内容
-* 调整保存淘宝优惠券
-
-### 1.0.14 更新内容
-* 修复ERP控制台基类bug
-
-### 1.0.13 更新内容
-* 调整事务sql加入到日志里
-
-### 1.0.12.17 更新内容
-* 对可能存在大数据的表，进行分表模式并可配置，目前支持的表stat_log_tb、stat_report_tb、asset_log_tb、user_asset_tb、task_count_tb、user_info_tb、prize_order_tb、prize_roster_tb
-
-### 1.0.12.11 更新内容
-* 修复任务模块浏览和收藏商品任务异常报错
-
-### 1.0.12.9 更新内容
-* 微信帮助类添加获取小程序码的方法
-
-### 1.0.12.8 更新内容
-* 调整删除ip信息方法，删除的同时会进行下架
-* 添加定时作业基类timing_work_model.py，用于控制台项目定时执行函数，只需继承并重写execute，定时时间在配置文件配置
-* 添加清理统计流水控制台和统计队列添加日志便于排查主键重置问题
-* FrameBaseModel添加处理恶意请求方法process_malice_request，可以针对用户和ip进行限制某个handler请求操作
-
-### 1.0.12.3 更新内容
-* 增加执行帮助类action_helper，用于控制台项目操作数据库等的连接超时的重新执行，避免请求中断
-
-### 1.0.12.1 更新内容
-* 对请求的加密参数和输出的加密数据添加日志，方便在后台查看明文信息
-* 去掉string_helper类，增加attch_helper类
-* 修改任务里没赋值log_title的方法
-* 把原本string_helper里的 check_under_age和get_birthday移到seven_helper
-
-### 1.0.11.151 更新内容
-* 缓存模块失败重试机制，邀请新用户和邀请入会任务模块增加可重写参数close_invite_limit
-
-### 1.0.11.146 更新内容
-* 调整所有的测试配置的默认test_user_nick、test_open_id、test_source_app_id、test_client_ver统一到配置key(test_config)里，名字对应为user_nick、open_id、source_app_id、client_ver，新增access_token使得测试的时候可以调用top接口
-
-### 1.0.11.143 更新内容
-* 调整InstantiateAppHandler淘宝实例化接口，增加执行前后事件并在返回里加了字段是否变更了project_code字段
-
-### 1.0.11.142 更新内容
-* UpdatePrizeOrderStatusHandler修改返回字典{"express_company":"物流公司","express_no":"快递单号","deliver_date":"发货时间"}
-
-### 1.0.11.141 更新内容
-* AssetBaseModel优化修改资产方法
-* StringHelper增加根据身份证号获取生日及检验是否未成年的方法
-* CacheModel优化数据缓存模块，增加缓存key前缀，使其在一个文件夹里方便查看
-* SevenHelper优化连续请求限制方法，利用redis incr的原子性，避免取到脏数据
-* FrameBaseModel增加分数算法（获取分数 = 权重 * 分数因子 + 时间极大值  - 当前时间）用于redis有序集合socre按多字段排序
-
-### 1.0.11.134 更新内容
-* ip表加is_del字段，相关的接口进行调整
-
-### 1.0.11.122 更新内容
-* 缓存模块删除依赖建实现重试机制
-* top模块调整
-
-### 1.0.11.115 更新内容
-* 变更资产加日志,top会员积分模块封装
-
-### 1.0.11.113 更新内容
-* b端增加高级权限模块
-
-### 1.0.11.112 更新内容
-* c端增加价格档位列表接口
-
-### 1.0.11.109 更新内容
-* 资产系统增加清理资产唯一值的方法，用于测试使用
-
-### 1.0.11.100 更新内容
-* 用户表增加昵称加密值字段和get_dict默认取1条
-
-### 1.0.11.82 更新内容
-* 任务模块加入会员任务请求top接口判断是否入会
-
-### 1.0.11.78 更新内容
-* ErpConsoleModel对接遁甲处理模型增加api处理方式
-
-### 1.0.11.71 更新内容
-* 任务模块增加统一的统计key, JoinTaskUserCount参与任务完成人数,JoinTaskCount参与任务完成次数,JoinTaskRewardCount参与任务奖励值
-
-### 1.0.11.63 更新内容
-* 增加去掉参数尾部多余0的帮助方法SevenHelper.remove_exponent
-
-### 1.0.11.59 更新内容
-* 缓存模块返回字段类型和数据库返回的统一
-
-### 1.0.11.50 更新内容
-* 修改ip列表
-
-### 1.0.11.49 更新内容
-* seven_model增加条件拼接实体ConditionWhere，可以不用去判断是否添加and
-
-### 1.0.11.47 更新内容
-* 增加获取产品续费价格信息handler
-
-### 1.0.11.45 更新内容
-* 修改import_prize_order方法，兼容json格式和base64格式
-
-### 1.0.11.41 更新内容
-* 增加导出活动奖品列表handler
-* top_base_model 增加获取短链接
-* seven_helper增加get_condition_in方法自动拼接in查询条件
-
-### 1.0.11.36 更新内容
-* 修改order_s.py导出奖品订单和中奖记录的handler并增加淘宝支付订单导出的handler
-
-### 1.0.11.32 更新内容
-* 修改淘宝升级版本参数少传
-
-### 1.0.11.16 更新内容
-* 淘宝top_base_model兼容控制台调用
-
-### 1.0.11.13 更新内容
-* 调整控制台队列数，默认是1，当数据量大来不及处理再调整为10，多线程处理
-
-### 1.0.11.11 更新内容
-* 任务系统增加分享奖励任务
-* framebasehandler添加get_param_int方法,获取参数自动转整形，转换失败不会报错，返回默认值
-
-### 1.0.11.9 更新内容
-* 活动表增加字段lc_order_id小部件orderId
-
-### 1.0.11.8 更新内容
-* 兼容淘宝小部件及其他平台 get_source_app_id方法优先取参数app_id 没有才是source_app_id
-
-### 1.0.11.6 更新内容
-* 控制台模型 erp_console_model 联调修复异常
-
-### 1.0.11.2 更新内容
-* 任务系统指定的任务模块添加了info_json参数，便于业务记录资产详细信息
-
-### 1.0.11 更新内容
-* 文件帮助类修改
-
-### 1.0.10.42 更新内容
-* 修改变更资产方法，去掉每日进销存,从控制台生成,加快处理速度  
-* 新增统计处理方式，可以从redis处理，对性能要求高的走redis，对数据安全性，完整性要求高的走mysql 
-
-### 1.0.10.39 更新内容
-* 添加client接口 获取黑名单解封申请记录
-
-### 1.0.10.38 更新内容
-* 资产模块 asset_base_model.py 修改方法get_user_asset_list去掉排序参数
-
-### 1.0.10 更新内容
-* 排队系统 修改update_time
-
-### 1.0.9 更新内容
-* 微信昵称emoji处理
-
-### 1.0.5 更新内容
-* 排队系统帮助类加队列增加头像字段
-
-### 1.0.3 更新内容
-* prize_order_tb表新增字段freight_pay_order_no
-
-### 1.0.2 更新内容
-* 字符串序列化异常修复
-
-### 1.0.0.222 更新内容
-* 接口加解密异常修复
-
-### 1.0.0.217 更新内容
-* 排队系统异常修复
-
-### 1.0.0.209 更新内容
-* 免费领取任务奖励上报写死bug修复
-
-### 1.0.0.205 更新内容
-* 统计控制台bug修复
-
-### 1.0.0.204 更新内容
-* 添加加密帮助类及server添加ActPrizeListHandler事件重写
-
-### 1.0.0.200 更新内容
-* 修改pay.py中的请求参数转换成xml
-
-### 1.0.0.197 更新内容
-* 修改pay.py异步通知handler继承
-
-### 1.0.0.196 更新内容
-* 修改微信支付
-
-### 1.0.0.193 更新内容
-* 修改微信预订单Ip获取异常
-
-### 1.0.0.191 更新内容
-* 修改排队系统帮助类
-
-### 1.0.0.190 更新内容
-* 修改任务配置的整形字段强制转换
-
-### 1.0.0.189 更新内容
-* 云应用框架初始版
+Metadata-Version: 2.1
+Name: seven-cloudapp-frame
+Version: 1.0.99
+Summary: seven cloudapp frame
+Home-page: http://gitlab.tdtech.gao7.com/TaoBaoCloud/seven_cloudapp_frame.git
+Author: seven
+Author-email: tech@gao7.com
+License: MIT
+Classifier: Topic :: Software Development :: Libraries :: Python Modules
+Classifier: Programming Language :: Python
+Classifier: Programming Language :: Python :: 3.4
+Classifier: Programming Language :: Python :: 3.5
+Classifier: Programming Language :: Python :: 3.5
+Classifier: Programming Language :: Python :: 3.6
+Classifier: Programming Language :: Python :: 3.7
+Classifier: Programming Language :: Python :: 3.8
+Classifier: Programming Language :: Python :: 3.9
+Requires-Python: ~=3.4
+Description-Content-Type: text/markdown
+License-File: LICENSE
+
+# seven_cloudapp_frame
+
+## 天志互联Python云应用框架库
+
+### 1.0.65.2 更新内容
+* 如果是测试环境，则默认取最新的活动，用于前端测试使用
+
+### 1.0.65.1 更新内容
+* 大数据表支持分表模式
+
+### 1.0.52.19 更新内容
+* 操作日志模块
+
+### 1.0.50.6 更新内容
+* 排队系统加踢人日志记录到info里
+
+### 1.0.33.4 更新内容
+* 废弃get_source_app_id，统一使用get_app_id
+
+### 1.0.19.1 更新内容
+* 登录接口用户信息走缓存
+
+### 1.0.15 更新内容
+* 调整保存淘宝优惠券
+
+### 1.0.14 更新内容
+* 修复ERP控制台基类bug
+
+### 1.0.13 更新内容
+* 调整事务sql加入到日志里
+
+### 1.0.12.17 更新内容
+* 对可能存在大数据的表，进行分表模式并可配置，目前支持的表stat_log_tb、stat_report_tb、asset_log_tb、user_asset_tb、task_count_tb、user_info_tb、prize_order_tb、prize_roster_tb
+
+### 1.0.12.11 更新内容
+* 修复任务模块浏览和收藏商品任务异常报错
+
+### 1.0.12.9 更新内容
+* 微信帮助类添加获取小程序码的方法
+
+### 1.0.12.8 更新内容
+* 调整删除ip信息方法，删除的同时会进行下架
+* 添加定时作业基类timing_work_model.py，用于控制台项目定时执行函数，只需继承并重写execute，定时时间在配置文件配置
+* 添加清理统计流水控制台和统计队列添加日志便于排查主键重置问题
+* FrameBaseModel添加处理恶意请求方法process_malice_request，可以针对用户和ip进行限制某个handler请求操作
+
+### 1.0.12.3 更新内容
+* 增加执行帮助类action_helper，用于控制台项目操作数据库等的连接超时的重新执行，避免请求中断
+
+### 1.0.12.1 更新内容
+* 对请求的加密参数和输出的加密数据添加日志，方便在后台查看明文信息
+* 去掉string_helper类，增加attch_helper类
+* 修改任务里没赋值log_title的方法
+* 把原本string_helper里的 check_under_age和get_birthday移到seven_helper
+
+### 1.0.11.151 更新内容
+* 缓存模块失败重试机制，邀请新用户和邀请入会任务模块增加可重写参数close_invite_limit
+
+### 1.0.11.146 更新内容
+* 调整所有的测试配置的默认test_user_nick、test_open_id、test_source_app_id、test_client_ver统一到配置key(test_config)里，名字对应为user_nick、open_id、source_app_id、client_ver，新增access_token使得测试的时候可以调用top接口
+
+### 1.0.11.143 更新内容
+* 调整InstantiateAppHandler淘宝实例化接口，增加执行前后事件并在返回里加了字段是否变更了project_code字段
+
+### 1.0.11.142 更新内容
+* UpdatePrizeOrderStatusHandler修改返回字典{"express_company":"物流公司","express_no":"快递单号","deliver_date":"发货时间"}
+
+### 1.0.11.141 更新内容
+* AssetBaseModel优化修改资产方法
+* StringHelper增加根据身份证号获取生日及检验是否未成年的方法
+* CacheModel优化数据缓存模块，增加缓存key前缀，使其在一个文件夹里方便查看
+* SevenHelper优化连续请求限制方法，利用redis incr的原子性，避免取到脏数据
+* FrameBaseModel增加分数算法（获取分数 = 权重 * 分数因子 + 时间极大值  - 当前时间）用于redis有序集合socre按多字段排序
+
+### 1.0.11.134 更新内容
+* ip表加is_del字段，相关的接口进行调整
+
+### 1.0.11.122 更新内容
+* 缓存模块删除依赖建实现重试机制
+* top模块调整
+
+### 1.0.11.115 更新内容
+* 变更资产加日志,top会员积分模块封装
+
+### 1.0.11.113 更新内容
+* b端增加高级权限模块
+
+### 1.0.11.112 更新内容
+* c端增加价格档位列表接口
+
+### 1.0.11.109 更新内容
+* 资产系统增加清理资产唯一值的方法，用于测试使用
+
+### 1.0.11.100 更新内容
+* 用户表增加昵称加密值字段和get_dict默认取1条
+
+### 1.0.11.82 更新内容
+* 任务模块加入会员任务请求top接口判断是否入会
+
+### 1.0.11.78 更新内容
+* ErpConsoleModel对接遁甲处理模型增加api处理方式
+
+### 1.0.11.71 更新内容
+* 任务模块增加统一的统计key, JoinTaskUserCount参与任务完成人数,JoinTaskCount参与任务完成次数,JoinTaskRewardCount参与任务奖励值
+
+### 1.0.11.63 更新内容
+* 增加去掉参数尾部多余0的帮助方法SevenHelper.remove_exponent
+
+### 1.0.11.59 更新内容
+* 缓存模块返回字段类型和数据库返回的统一
+
+### 1.0.11.50 更新内容
+* 修改ip列表
+
+### 1.0.11.49 更新内容
+* seven_model增加条件拼接实体ConditionWhere，可以不用去判断是否添加and
+
+### 1.0.11.47 更新内容
+* 增加获取产品续费价格信息handler
+
+### 1.0.11.45 更新内容
+* 修改import_prize_order方法，兼容json格式和base64格式
+
+### 1.0.11.41 更新内容
+* 增加导出活动奖品列表handler
+* top_base_model 增加获取短链接
+* seven_helper增加get_condition_in方法自动拼接in查询条件
+
+### 1.0.11.36 更新内容
+* 修改order_s.py导出奖品订单和中奖记录的handler并增加淘宝支付订单导出的handler
+
+### 1.0.11.32 更新内容
+* 修改淘宝升级版本参数少传
+
+### 1.0.11.16 更新内容
+* 淘宝top_base_model兼容控制台调用
+
+### 1.0.11.13 更新内容
+* 调整控制台队列数，默认是1，当数据量大来不及处理再调整为10，多线程处理
+
+### 1.0.11.11 更新内容
+* 任务系统增加分享奖励任务
+* framebasehandler添加get_param_int方法,获取参数自动转整形，转换失败不会报错，返回默认值
+
+### 1.0.11.9 更新内容
+* 活动表增加字段lc_order_id小部件orderId
+
+### 1.0.11.8 更新内容
+* 兼容淘宝小部件及其他平台 get_source_app_id方法优先取参数app_id 没有才是source_app_id
+
+### 1.0.11.6 更新内容
+* 控制台模型 erp_console_model 联调修复异常
+
+### 1.0.11.2 更新内容
+* 任务系统指定的任务模块添加了info_json参数，便于业务记录资产详细信息
+
+### 1.0.11 更新内容
+* 文件帮助类修改
+
+### 1.0.10.42 更新内容
+* 修改变更资产方法，去掉每日进销存,从控制台生成,加快处理速度  
+* 新增统计处理方式，可以从redis处理，对性能要求高的走redis，对数据安全性，完整性要求高的走mysql 
+
+### 1.0.10.39 更新内容
+* 添加client接口 获取黑名单解封申请记录
+
+### 1.0.10.38 更新内容
+* 资产模块 asset_base_model.py 修改方法get_user_asset_list去掉排序参数
+
+### 1.0.10 更新内容
+* 排队系统 修改update_time
+
+### 1.0.9 更新内容
+* 微信昵称emoji处理
+
+### 1.0.5 更新内容
+* 排队系统帮助类加队列增加头像字段
+
+### 1.0.3 更新内容
+* prize_order_tb表新增字段freight_pay_order_no
+
+### 1.0.2 更新内容
+* 字符串序列化异常修复
+
+### 1.0.0.222 更新内容
+* 接口加解密异常修复
+
+### 1.0.0.217 更新内容
+* 排队系统异常修复
+
+### 1.0.0.209 更新内容
+* 免费领取任务奖励上报写死bug修复
+
+### 1.0.0.205 更新内容
+* 统计控制台bug修复
+
+### 1.0.0.204 更新内容
+* 添加加密帮助类及server添加ActPrizeListHandler事件重写
+
+### 1.0.0.200 更新内容
+* 修改pay.py中的请求参数转换成xml
+
+### 1.0.0.197 更新内容
+* 修改pay.py异步通知handler继承
+
+### 1.0.0.196 更新内容
+* 修改微信支付
+
+### 1.0.0.193 更新内容
+* 修改微信预订单Ip获取异常
+
+### 1.0.0.191 更新内容
+* 修改排队系统帮助类
+
+### 1.0.0.190 更新内容
+* 修改任务配置的整形字段强制转换
+
+### 1.0.0.189 更新内容
+* 云应用框架初始版
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/handlers/client/act.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/handlers/client/act.py`

 * *Ordering differences only*

 * *Files 14% similar despite different names*

```diff
@@ -1,273 +1,273 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-08-02 14:03:12
-@LastEditTime: 2023-07-11 14:24:59
-@LastEditors: HuangJianYi
-@Description: 
-"""
-from seven_cloudapp_frame.models.enum import PageCountMode
-from seven_cloudapp_frame.handlers.frame_base import *
-from seven_cloudapp_frame.models.app_base_model import *
-from seven_cloudapp_frame.models.act_base_model import *
-from seven_cloudapp_frame.models.cms_base_model import *
-from seven_cloudapp_frame.models.prize_base_model import *
-from seven_cloudapp_frame.models.price_base_model import *
-
-
-class ActInfoHandler(ClientBaseHandler):
-    """
-    :description: 获取活动信息
-    """
-    def get_async(self):
-        """
-        :description: 获取活动信息
-        :param act_id：活动标识
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        if not invoke_result_data.data:
-            invoke_result_data.data = {}
-        ver_no = invoke_result_data.data["ver_no"] if invoke_result_data.data.__contains__("ver_no") else '1'
-        if ver_no == "1":
-            self.get_act_info()
-        else:
-            self.get_act_info_v2()
-
-    def get_act_info(self):
-        """
-        :description: 获取活动信息V1版本
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        app_base_model = AppBaseModel(context=self)
-        act_base_model = ActBaseModel(context=self)
-        app_info_dict = app_base_model.get_app_info_dict(app_id)
-        if not app_info_dict:
-            return self.response_json_error("error", "小程序不存在")
-        act_info_dict = act_base_model.get_act_info_dict(act_id, True, False)
-        if not act_info_dict or act_info_dict["is_del"] == 1 or act_info_dict["app_id"] != app_id:
-            return self.response_json_error("error", "活动不存在")
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-
-        act_info_dict["seller_id"] = app_info_dict["seller_id"]
-        act_info_dict["store_id"] = app_info_dict["store_id"]
-        act_info_dict["store_name"] = app_info_dict["store_name"]
-        act_info_dict["store_icon"] = app_info_dict["store_icon"]
-        act_info_dict["app_icon"] = app_info_dict["app_icon"]
-        act_info_dict["store_user_nick"] = app_info_dict["store_user_nick"]
-
-        act_info_dict = self.business_process_executed(act_info_dict, ref_params={})
-        return self.response_json_success(act_info_dict)
-
-    def get_act_info_v2(self):
-        """
-        :description: 获取活动信息V2版本
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        app_base_model = AppBaseModel(context=self)
-        act_base_model = ActBaseModel(context=self)
-        app_info_dict = app_base_model.get_app_info_dict(app_id, field="id,seller_id,store_id,store_name,store_icon,app_icon,store_user_nick")
-        if not app_info_dict:
-            return self.response_json_error("error", "小程序不存在")
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        if not invoke_result_data.data:
-            invoke_result_data.data = {}
-        exclude_fields = invoke_result_data.data["exclude_fields"] if invoke_result_data.data.__contains__("exclude_fields") else "is_visit_store,store_url,theme_id,is_release,close_word,start_date,end_date,is_del,finish_menu_config_json,agreement_json,is_fictitious,task_asset_type_json,refund_count,is_finish,is_launch,brand_json,share_desc_json,rule_desc_json,release_date,sort_index,create_date,modify_date,i1,i2,i3,i4,i5,s1,s2,s3,s4,s5,d1,d2"
-        act_info_dict = act_base_model.get_act_info_dict(act_id, True, False)
-        if not act_info_dict or act_info_dict["is_del"] == 1 or act_info_dict["app_id"] != app_id:
-            return self.response_json_error("error", "活动不存在")
-
-        # 店铺配置
-        act_info_dict['store'] = {}
-        act_info_dict['store']['id'] = app_info_dict['id']
-        act_info_dict['store']['seller_id'] = app_info_dict['seller_id']
-        act_info_dict['store']['store_id'] = app_info_dict['store_id']
-        act_info_dict['store']['seller_nick'] = app_info_dict['store_user_nick']
-        act_info_dict['store']['is_open'] = act_info_dict['is_visit_store']
-        act_info_dict['store']['store_url'] = act_info_dict['store_url']
-
-
-
-        # 主题配置
-        act_info_dict['theme'] = {}
-        act_info_dict['theme']['id'] = act_info_dict['theme_id']
-        # 小程序配置
-        act_info_dict['mini_program'] = {}
-        act_info_dict['mini_program']['is_open'] = act_info_dict['is_release']
-        act_info_dict['mini_program']['close_word'] = act_info_dict['close_word']
-        act_info_dict['mini_program']['start_date'] = act_info_dict['start_date']
-        act_info_dict['mini_program']['end_date'] = act_info_dict['end_date']
-        # 分享配置 {"taoword": "", "icon": "", "title": "", "desc": ""}
-        act_info_dict["shares"] = {}
-        act_info_dict["shares"]["default"] = {"taoword": "", "icon": "", "title": "", "desc": ""}
-        if act_info_dict.__contains__("share_desc_json") and act_info_dict["share_desc_json"] not in ['', '{}']:
-            share_desc = SevenHelper.json_loads(act_info_dict["share_desc_json"])
-            if share_desc.__contains__("default"):
-                act_info_dict["shares"] = share_desc
-            else:
-                act_info_dict["shares"]["default"] = share_desc
-        # 规则配置 [{"title":"购买规则","desc":"在此填写规则"}]
-        act_info_dict["rules"] = SevenHelper.json_loads(act_info_dict["rule_desc_json"]) if act_info_dict["rule_desc_json"] else []
-        # 用户协议或隐私条款配置 [{"title":"购买规则","explain":"在此填写规则"}]
-        act_info_dict["purchase_agreement"] = SevenHelper.json_loads(act_info_dict["agreement_json"]) if act_info_dict["agreement_json"] else []
-        #品牌配置
-        act_info_dict["brands"] = SevenHelper.json_loads(act_info_dict["brand_json"]) if act_info_dict["brand_json"] else {}
-
-        act_info_dict = self.business_process_executed(act_info_dict, ref_params={})
-        if act_info_dict:
-            for item in exclude_fields.split(','):
-                try:
-                    del act_info_dict[item]
-                except:
-                    pass
-
-        return self.response_json_success(act_info_dict)
-
-
-class ActPrizeListHandler(ClientBaseHandler):
-    """
-    :description: 活动奖品列表
-    """
-    def get_async(self):
-        """
-        :description: 活动奖品列表
-        :param act_id: 活动标识
-        :param module_id: 活动模块标识
-        :param prize_name: 奖品名称
-        :param ascription_type: 奖品归属类型（0-活动奖品1-任务奖品）
-        :param page_size: 条数
-        :param page_index: 页数
-        :param page_count_mode：分页模式(0-none 1-total 2-next)
-        :return: PageInfo
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        module_id = self.get_param_int("module_id", 0)
-        prize_name = self.get_param("prize_name")
-        page_index = self.get_param_int("page_index", 0)
-        page_size = self.get_param_int("page_size", 10)
-        page_count_mode = self.get_param_int("page_count_mode", 1)
-
-        if not app_id or not act_id:
-            return self.response_json_success({"data": []})
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_success({"data": []})
-        prize_base_model = PrizeBaseModel(context=self)
-        page_count_mode = SevenHelper.get_enum_key(PageCountMode, page_count_mode)
-        page_list = prize_base_model.get_act_prize_list(app_id, act_id, module_id, prize_name, 0, 0, page_size, page_index, condition="is_release=1", page_count_mode=page_count_mode)
-        if page_count_mode == "total":
-            total = page_list[1]
-            page_list = self.business_process_executed(page_list[0], ref_params={})
-            return_info = PageInfo(page_index, page_size, total, page_list)
-        elif page_count_mode == "next":
-            is_next = page_list[1]
-            page_list = self.business_process_executed(page_list[0], ref_params={})
-            return_info = WaterPageInfo(page_list, is_next)
-        else:
-            return_info = self.business_process_executed(page_list, ref_params={})
-        return self.response_json_success(return_info)
-
-
-class CmsInfoListHandler(ClientBaseHandler):
-    """
-    :description: 获取位置信息列表
-    """
-    @filter_check_params("place_id")
-    def get_async(self):
-        """
-        :description: 获取位置信息列表
-        :params place_id:位置标识
-        :param page_count_mode：分页模式(0-none 1-total 2-next)
-        :return 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        place_id = self.get_param_int("place_id", 0)
-        page_size = self.get_param_int("page_size", 20)
-        page_index = self.get_param_int("page_index", 0)
-        page_count_mode = self.get_param_int("page_count_mode", 1)
-
-
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_success({"data": []})
-        if not invoke_result_data.data:
-            invoke_result_data.data = {}
-        condition = invoke_result_data.data["condition"] if invoke_result_data.data.__contains__("condition") else None
-        params = invoke_result_data.data["params"] if invoke_result_data.data.__contains__("params") else None
-        order_by = invoke_result_data.data["order_by"] if invoke_result_data.data.__contains__("order_by") else "id desc"
-        field = invoke_result_data.data["field"] if invoke_result_data.data.__contains__("field") else "*"
-        cms_base_model = CmsBaseModel(context=self)
-        page_count_mode = SevenHelper.get_enum_key(PageCountMode, page_count_mode)
-        if condition and params:
-            page_list = cms_base_model.get_cms_info_list_v2(place_id=place_id, page_size=page_size, page_index=page_index, order_by=order_by, field=field, condition=condition, params=params, is_cache=True, page_count_mode=page_count_mode)
-        else:
-            page_list = cms_base_model.get_cms_info_list(place_id=place_id, page_size=page_size, page_index=page_index, order_by=order_by, field=field, app_id=app_id, act_id=act_id, is_cache=True, page_count_mode=page_count_mode)
-        if page_count_mode == "total":
-            total = page_list[1]
-            page_list = self.business_process_executed(page_list[0], ref_params={})
-            return_info = PageInfo(page_index, page_size, total, page_list)
-        elif page_count_mode == "next":
-            is_next = page_list[1]
-            page_list = self.business_process_executed(page_list[0], ref_params={})
-            return_info = WaterPageInfo(page_list, is_next)
-        else:
-            return_info = self.business_process_executed(page_list, ref_params={})
-        return self.response_json_success(return_info)
-
-
-class PriceGearListHandler(ClientBaseHandler):
-    """
-    :description: 获取价格档位列表
-    """
-    def get_async(self):
-        """
-        :description: 获取价格档位列表
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param page_index：页索引
-        :param page_size：页大小
-        :param page_count_mode：分页模式(0-none 1-total 2-next)
-        :return: list
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        page_size = self.get_param_int("page_size", 20)
-        page_index = self.get_param_int("page_index", 0)
-        page_count_mode = self.get_param_int("page_count_mode", 1)
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_success({"data": []})
-        if not invoke_result_data.data:
-            invoke_result_data.data = {}
-        order_by = invoke_result_data.data["order_by"] if invoke_result_data.data.__contains__("order_by") else "sort_index desc"
-        page_count_mode = SevenHelper.get_enum_key(PageCountMode, page_count_mode)
-        page_list = PriceBaseModel(context=self).get_price_gear_list(app_id, act_id, page_size, page_index, order_by, page_count_mode=page_count_mode)
-        if page_count_mode == "total":
-            total = page_list[1]
-            page_list = self.business_process_executed(page_list[0], ref_params={})
-            return_info = PageInfo(page_index, page_size, total, page_list)
-        elif page_count_mode == "next":
-            is_next = page_list[1]
-            page_list = self.business_process_executed(page_list[0], ref_params={})
-            return_info = WaterPageInfo(page_list, is_next)
-        else:
-            return_info = self.business_process_executed(page_list, ref_params={})
-        return self.response_json_success(return_info)
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-08-02 14:03:12
+@LastEditTime: 2023-07-11 14:24:59
+@LastEditors: HuangJianYi
+@Description: 
+"""
+from seven_cloudapp_frame.models.enum import PageCountMode
+from seven_cloudapp_frame.handlers.frame_base import *
+from seven_cloudapp_frame.models.app_base_model import *
+from seven_cloudapp_frame.models.act_base_model import *
+from seven_cloudapp_frame.models.cms_base_model import *
+from seven_cloudapp_frame.models.prize_base_model import *
+from seven_cloudapp_frame.models.price_base_model import *
+
+
+class ActInfoHandler(ClientBaseHandler):
+    """
+    :description: 获取活动信息
+    """
+    def get_async(self):
+        """
+        :description: 获取活动信息
+        :param act_id：活动标识
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        ver_no = invoke_result_data.data["ver_no"] if invoke_result_data.data.__contains__("ver_no") else '1'
+        if ver_no == "1":
+            self.get_act_info()
+        else:
+            self.get_act_info_v2()
+
+    def get_act_info(self):
+        """
+        :description: 获取活动信息V1版本
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        app_base_model = AppBaseModel(context=self)
+        act_base_model = ActBaseModel(context=self)
+        app_info_dict = app_base_model.get_app_info_dict(app_id)
+        if not app_info_dict:
+            return self.response_json_error("error", "小程序不存在")
+        act_info_dict = act_base_model.get_act_info_dict(act_id, True, False)
+        if not act_info_dict or act_info_dict["is_del"] == 1 or act_info_dict["app_id"] != app_id:
+            return self.response_json_error("error", "活动不存在")
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+
+        act_info_dict["seller_id"] = app_info_dict["seller_id"]
+        act_info_dict["store_id"] = app_info_dict["store_id"]
+        act_info_dict["store_name"] = app_info_dict["store_name"]
+        act_info_dict["store_icon"] = app_info_dict["store_icon"]
+        act_info_dict["app_icon"] = app_info_dict["app_icon"]
+        act_info_dict["store_user_nick"] = app_info_dict["store_user_nick"]
+
+        act_info_dict = self.business_process_executed(act_info_dict, ref_params={})
+        return self.response_json_success(act_info_dict)
+
+    def get_act_info_v2(self):
+        """
+        :description: 获取活动信息V2版本
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        app_base_model = AppBaseModel(context=self)
+        act_base_model = ActBaseModel(context=self)
+        app_info_dict = app_base_model.get_app_info_dict(app_id, field="id,seller_id,store_id,store_name,store_icon,app_icon,store_user_nick")
+        if not app_info_dict:
+            return self.response_json_error("error", "小程序不存在")
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        exclude_fields = invoke_result_data.data["exclude_fields"] if invoke_result_data.data.__contains__("exclude_fields") else "is_visit_store,store_url,theme_id,is_release,close_word,start_date,end_date,is_del,finish_menu_config_json,agreement_json,is_fictitious,task_asset_type_json,refund_count,is_finish,is_launch,brand_json,share_desc_json,rule_desc_json,release_date,sort_index,create_date,modify_date,i1,i2,i3,i4,i5,s1,s2,s3,s4,s5,d1,d2"
+        act_info_dict = act_base_model.get_act_info_dict(act_id, True, False)
+        if not act_info_dict or act_info_dict["is_del"] == 1 or act_info_dict["app_id"] != app_id:
+            return self.response_json_error("error", "活动不存在")
+
+        # 店铺配置
+        act_info_dict['store'] = {}
+        act_info_dict['store']['id'] = app_info_dict['id']
+        act_info_dict['store']['seller_id'] = app_info_dict['seller_id']
+        act_info_dict['store']['store_id'] = app_info_dict['store_id']
+        act_info_dict['store']['seller_nick'] = app_info_dict['store_user_nick']
+        act_info_dict['store']['is_open'] = act_info_dict['is_visit_store']
+        act_info_dict['store']['store_url'] = act_info_dict['store_url']
+
+
+
+        # 主题配置
+        act_info_dict['theme'] = {}
+        act_info_dict['theme']['id'] = act_info_dict['theme_id']
+        # 小程序配置
+        act_info_dict['mini_program'] = {}
+        act_info_dict['mini_program']['is_open'] = act_info_dict['is_release']
+        act_info_dict['mini_program']['close_word'] = act_info_dict['close_word']
+        act_info_dict['mini_program']['start_date'] = act_info_dict['start_date']
+        act_info_dict['mini_program']['end_date'] = act_info_dict['end_date']
+        # 分享配置 {"taoword": "", "icon": "", "title": "", "desc": ""}
+        act_info_dict["shares"] = {}
+        act_info_dict["shares"]["default"] = {"taoword": "", "icon": "", "title": "", "desc": ""}
+        if act_info_dict.__contains__("share_desc_json") and act_info_dict["share_desc_json"] not in ['', '{}']:
+            share_desc = SevenHelper.json_loads(act_info_dict["share_desc_json"])
+            if share_desc.__contains__("default"):
+                act_info_dict["shares"] = share_desc
+            else:
+                act_info_dict["shares"]["default"] = share_desc
+        # 规则配置 [{"title":"购买规则","desc":"在此填写规则"}]
+        act_info_dict["rules"] = SevenHelper.json_loads(act_info_dict["rule_desc_json"]) if act_info_dict["rule_desc_json"] else []
+        # 用户协议或隐私条款配置 [{"title":"购买规则","explain":"在此填写规则"}]
+        act_info_dict["purchase_agreement"] = SevenHelper.json_loads(act_info_dict["agreement_json"]) if act_info_dict["agreement_json"] else []
+        #品牌配置
+        act_info_dict["brands"] = SevenHelper.json_loads(act_info_dict["brand_json"]) if act_info_dict["brand_json"] else {}
+
+        act_info_dict = self.business_process_executed(act_info_dict, ref_params={})
+        if act_info_dict:
+            for item in exclude_fields.split(','):
+                try:
+                    del act_info_dict[item]
+                except:
+                    pass
+
+        return self.response_json_success(act_info_dict)
+
+
+class ActPrizeListHandler(ClientBaseHandler):
+    """
+    :description: 活动奖品列表
+    """
+    def get_async(self):
+        """
+        :description: 活动奖品列表
+        :param act_id: 活动标识
+        :param module_id: 活动模块标识
+        :param prize_name: 奖品名称
+        :param ascription_type: 奖品归属类型（0-活动奖品1-任务奖品）
+        :param page_size: 条数
+        :param page_index: 页数
+        :param page_count_mode：分页模式(0-none 1-total 2-next)
+        :return: PageInfo
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        module_id = self.get_param_int("module_id", 0)
+        prize_name = self.get_param("prize_name")
+        page_index = self.get_param_int("page_index", 0)
+        page_size = self.get_param_int("page_size", 10)
+        page_count_mode = self.get_param_int("page_count_mode", 1)
+
+        if not app_id or not act_id:
+            return self.response_json_success({"data": []})
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_success({"data": []})
+        prize_base_model = PrizeBaseModel(context=self)
+        page_count_mode = SevenHelper.get_enum_key(PageCountMode, page_count_mode)
+        page_list = prize_base_model.get_act_prize_list(app_id, act_id, module_id, prize_name, 0, 0, page_size, page_index, condition="is_release=1", page_count_mode=page_count_mode)
+        if page_count_mode == "total":
+            total = page_list[1]
+            page_list = self.business_process_executed(page_list[0], ref_params={})
+            return_info = PageInfo(page_index, page_size, total, page_list)
+        elif page_count_mode == "next":
+            is_next = page_list[1]
+            page_list = self.business_process_executed(page_list[0], ref_params={})
+            return_info = WaterPageInfo(page_list, is_next)
+        else:
+            return_info = self.business_process_executed(page_list, ref_params={})
+        return self.response_json_success(return_info)
+
+
+class CmsInfoListHandler(ClientBaseHandler):
+    """
+    :description: 获取位置信息列表
+    """
+    @filter_check_params("place_id")
+    def get_async(self):
+        """
+        :description: 获取位置信息列表
+        :params place_id:位置标识
+        :param page_count_mode：分页模式(0-none 1-total 2-next)
+        :return 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        place_id = self.get_param_int("place_id", 0)
+        page_size = self.get_param_int("page_size", 20)
+        page_index = self.get_param_int("page_index", 0)
+        page_count_mode = self.get_param_int("page_count_mode", 1)
+
+
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_success({"data": []})
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        condition = invoke_result_data.data["condition"] if invoke_result_data.data.__contains__("condition") else None
+        params = invoke_result_data.data["params"] if invoke_result_data.data.__contains__("params") else None
+        order_by = invoke_result_data.data["order_by"] if invoke_result_data.data.__contains__("order_by") else "id desc"
+        field = invoke_result_data.data["field"] if invoke_result_data.data.__contains__("field") else "*"
+        cms_base_model = CmsBaseModel(context=self)
+        page_count_mode = SevenHelper.get_enum_key(PageCountMode, page_count_mode)
+        if condition and params:
+            page_list = cms_base_model.get_cms_info_list_v2(place_id=place_id, page_size=page_size, page_index=page_index, order_by=order_by, field=field, condition=condition, params=params, is_cache=True, page_count_mode=page_count_mode)
+        else:
+            page_list = cms_base_model.get_cms_info_list(place_id=place_id, page_size=page_size, page_index=page_index, order_by=order_by, field=field, app_id=app_id, act_id=act_id, is_cache=True, page_count_mode=page_count_mode)
+        if page_count_mode == "total":
+            total = page_list[1]
+            page_list = self.business_process_executed(page_list[0], ref_params={})
+            return_info = PageInfo(page_index, page_size, total, page_list)
+        elif page_count_mode == "next":
+            is_next = page_list[1]
+            page_list = self.business_process_executed(page_list[0], ref_params={})
+            return_info = WaterPageInfo(page_list, is_next)
+        else:
+            return_info = self.business_process_executed(page_list, ref_params={})
+        return self.response_json_success(return_info)
+
+
+class PriceGearListHandler(ClientBaseHandler):
+    """
+    :description: 获取价格档位列表
+    """
+    def get_async(self):
+        """
+        :description: 获取价格档位列表
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param page_index：页索引
+        :param page_size：页大小
+        :param page_count_mode：分页模式(0-none 1-total 2-next)
+        :return: list
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        page_size = self.get_param_int("page_size", 20)
+        page_index = self.get_param_int("page_index", 0)
+        page_count_mode = self.get_param_int("page_count_mode", 1)
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_success({"data": []})
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        order_by = invoke_result_data.data["order_by"] if invoke_result_data.data.__contains__("order_by") else "sort_index desc"
+        page_count_mode = SevenHelper.get_enum_key(PageCountMode, page_count_mode)
+        page_list = PriceBaseModel(context=self).get_price_gear_list(app_id, act_id, page_size, page_index, order_by, page_count_mode=page_count_mode)
+        if page_count_mode == "total":
+            total = page_list[1]
+            page_list = self.business_process_executed(page_list[0], ref_params={})
+            return_info = PageInfo(page_index, page_size, total, page_list)
+        elif page_count_mode == "next":
+            is_next = page_list[1]
+            page_list = self.business_process_executed(page_list[0], ref_params={})
+            return_info = WaterPageInfo(page_list, is_next)
+        else:
+            return_info = self.business_process_executed(page_list, ref_params={})
+        return self.response_json_success(return_info)
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/handlers/client/app.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/handlers/client/app.py`

 * *Ordering differences only*

 * *Files 14% similar despite different names*

```diff
@@ -1,157 +1,157 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-08-02 13:51:10
-@LastEditTime: 2023-06-14 19:11:23
-@LastEditors: HuangJianYi
-@Description: 
-"""
-from asq.initiators import query
-from seven_cloudapp_frame.models.app_base_model import *
-from seven_cloudapp_frame.handlers.frame_base import *
-from seven_cloudapp_frame.models.mp_base_model import *
-from seven_cloudapp_frame.models.push_base_model import *
-from seven_cloudapp_frame.libs.customize.baidubce_helper import *
-
-
-class AppExpireHandler(ClientBaseHandler):
-    """
-    :description: 获取小程序是否过期未续费
-    """
-    def get_async(self):
-        """
-        :description: 获取小程序是否过期未续费
-        :return info
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-
-        app_base_model = AppBaseModel(context=self)
-        invoke_result_data = app_base_model.get_app_expire(app_id)
-        if invoke_result_data.success ==False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-
-        return self.response_json_success(self.business_process_executed(invoke_result_data.data, ref_params={}))
-
-
-class CreateWeChatQrCodeHandler(ClientBaseHandler):
-    """
-    :description: 创建微信小程序码
-    """
-    def get_async(self):
-        """
-        :description: 创建微信小程序码
-        :param page：跳转地址
-        :param scene：参数，不限制小程序码才支持
-        :param env_version：要打开的小程序版本。正式版为 "release"，体验版为 "trial"，开发版为 "develop"。默认是正式版。不限制小程序码才支持
-        :param width：宽度
-        :param no_limit_code：是否不限制小程序码（1-是0否）
-        :return: 二进制流
-        :last_editors: HuangJianYi
-        """
-        page = self.get_param("page", "pages/index/index")
-        scene = self.get_param("scene", "a=1")
-        width = self.get_param_int("width", 430)
-        env_version = self.get_param("env_version", "release")
-        no_limit_code = self.get_param_int("no_limit_code", 1)
-        if no_limit_code == 1:
-            invoke_result_data = WeChatHelper.create_qr_code_unlimit(page=page, scene=scene, width=width, env_version=env_version)
-        else:
-            invoke_result_data = WeChatHelper.create_qr_code(path=page, width=width)
-        self.set_header("Content-type", "image/png")
-        if invoke_result_data.success == True:
-            self.write(invoke_result_data.data)
-        else:
-            self.write("")
-
-
-class UploadFileHandler(ClientBaseHandler):
-    """
-    :description: 上传文件
-    """
-    def get_async(self):
-        """
-        :description: 上传文件
-        :last_editors: HuangJianYi
-        """
-        is_auto_name = self.get_param_int("is_auto_name")
-        is_auto_name = True if is_auto_name == 1 else False
-        # 上传图片到资源服务器
-        if not self.request.files:
-            return self.response_json_error("error", "未获取到文件")
-        # 上传图片到资源服务器
-        files_data = self.request.files
-        if not files_data or not files_data["image"] or not files_data["image"][0] or not files_data["image"][0]['body']:
-            return self.response_json_error("error", "未获取到文件")
-        file_name = files_data["image"][0]['filename']
-        file_path = BaidubceHelper.upload(file_name=file_name, is_auto_name=is_auto_name, data=files_data["image"][0]['body'])
-        if not file_path:
-            return self.response_json_error("error", "上传文件出错")
-        return self.response_json_success(file_path)
-
-
-class AddWechatSubscribeHandler(ClientBaseHandler):
-    """
-    :description: 添加微信订阅次数
-    """
-    def get_async(self):
-        """
-        :description: 添加微信订阅次数
-        :param template_id：template_id
-        :param open_id：open_id
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        template_id = self.get_param("template_id")
-        open_id = self.get_param("open_id")
-        push_base_model = PushBaseModel(context=self)
-        invoke_result_data = push_base_model.add_wechat_subscribe(share_config.get_value("app_id"), template_id, open_id)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success()
-
-
-class GetHighPowerListHandler(ClientBaseHandler):
-    """
-    :description: 获取中台配置的高级权限列表
-    """
-    def get_async(self):
-        """
-        :description: 获取中台配置的高级权限列表
-        :return: list
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        app_base_model = AppBaseModel(context=self)
-        app_info_dict = app_base_model.get_app_info_dict(app_id)
-        if not app_info_dict:
-            return self.response_json_error("Error", "小程序不存在")
-        store_user_nick = app_info_dict["store_user_nick"]
-        access_token = app_info_dict["access_token"]
-        config_data = {}
-        config_data["is_customized"] = 0
-        top_base_model = TopBaseModel(context=self)
-        mp_base_model = MPBaseModel(context=self)
-        invoke_result_data = mp_base_model.get_custom_function_list(store_user_nick)
-        if invoke_result_data.success == True:
-            custom_function_list = invoke_result_data.data if invoke_result_data.data else []
-        else:
-            custom_function_list = mp_base_model.get_api_custom_function_list(store_user_nick)
-        if len(custom_function_list) == 0:
-            app_key, app_secret = self.get_app_key_secret()
-            #获取项目编码
-            project_code = top_base_model.get_project_code(store_user_nick, access_token, app_key, app_secret)
-            invoke_result_data = mp_base_model.get_public_function_list(project_code)
-            if invoke_result_data.success == True:
-                public_function_list = invoke_result_data.data if invoke_result_data.data else []
-            else:
-                public_function_list = mp_base_model.get_api_public_function_list(project_code)
-            if len(public_function_list) > 0:
-                config_data["function_config_list"] = query(public_function_list[0]["function_info_second_list"]).select(lambda x: {"name": x["name"], "key_name": x["key_name"]}).to_list()
-        else:
-            config_data["is_customized"] = 1
-            config_data["function_config_list"] = []
-            custom_function_list = list(filter(lambda custom_function: custom_function["app_id"] == app_id, custom_function_list))
-            if len(custom_function_list) > 0:
-                config_data["function_config_list"] = query(custom_function_list[0]["function_info_second_list"]).select(lambda x: {"name": x["name"], "key_name": x["key_name"]}).to_list()
-        self.response_json_success(self.business_process_executed(config_data, ref_params={}))
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-08-02 13:51:10
+@LastEditTime: 2023-06-14 19:11:23
+@LastEditors: HuangJianYi
+@Description: 
+"""
+from asq.initiators import query
+from seven_cloudapp_frame.models.app_base_model import *
+from seven_cloudapp_frame.handlers.frame_base import *
+from seven_cloudapp_frame.models.mp_base_model import *
+from seven_cloudapp_frame.models.push_base_model import *
+from seven_cloudapp_frame.libs.customize.baidubce_helper import *
+
+
+class AppExpireHandler(ClientBaseHandler):
+    """
+    :description: 获取小程序是否过期未续费
+    """
+    def get_async(self):
+        """
+        :description: 获取小程序是否过期未续费
+        :return info
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+
+        app_base_model = AppBaseModel(context=self)
+        invoke_result_data = app_base_model.get_app_expire(app_id)
+        if invoke_result_data.success ==False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+
+        return self.response_json_success(self.business_process_executed(invoke_result_data.data, ref_params={}))
+
+
+class CreateWeChatQrCodeHandler(ClientBaseHandler):
+    """
+    :description: 创建微信小程序码
+    """
+    def get_async(self):
+        """
+        :description: 创建微信小程序码
+        :param page：跳转地址
+        :param scene：参数，不限制小程序码才支持
+        :param env_version：要打开的小程序版本。正式版为 "release"，体验版为 "trial"，开发版为 "develop"。默认是正式版。不限制小程序码才支持
+        :param width：宽度
+        :param no_limit_code：是否不限制小程序码（1-是0否）
+        :return: 二进制流
+        :last_editors: HuangJianYi
+        """
+        page = self.get_param("page", "pages/index/index")
+        scene = self.get_param("scene", "a=1")
+        width = self.get_param_int("width", 430)
+        env_version = self.get_param("env_version", "release")
+        no_limit_code = self.get_param_int("no_limit_code", 1)
+        if no_limit_code == 1:
+            invoke_result_data = WeChatHelper.create_qr_code_unlimit(page=page, scene=scene, width=width, env_version=env_version)
+        else:
+            invoke_result_data = WeChatHelper.create_qr_code(path=page, width=width)
+        self.set_header("Content-type", "image/png")
+        if invoke_result_data.success == True:
+            self.write(invoke_result_data.data)
+        else:
+            self.write("")
+
+
+class UploadFileHandler(ClientBaseHandler):
+    """
+    :description: 上传文件
+    """
+    def get_async(self):
+        """
+        :description: 上传文件
+        :last_editors: HuangJianYi
+        """
+        is_auto_name = self.get_param_int("is_auto_name")
+        is_auto_name = True if is_auto_name == 1 else False
+        # 上传图片到资源服务器
+        if not self.request.files:
+            return self.response_json_error("error", "未获取到文件")
+        # 上传图片到资源服务器
+        files_data = self.request.files
+        if not files_data or not files_data["image"] or not files_data["image"][0] or not files_data["image"][0]['body']:
+            return self.response_json_error("error", "未获取到文件")
+        file_name = files_data["image"][0]['filename']
+        file_path = BaidubceHelper.upload(file_name=file_name, is_auto_name=is_auto_name, data=files_data["image"][0]['body'])
+        if not file_path:
+            return self.response_json_error("error", "上传文件出错")
+        return self.response_json_success(file_path)
+
+
+class AddWechatSubscribeHandler(ClientBaseHandler):
+    """
+    :description: 添加微信订阅次数
+    """
+    def get_async(self):
+        """
+        :description: 添加微信订阅次数
+        :param template_id：template_id
+        :param open_id：open_id
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        template_id = self.get_param("template_id")
+        open_id = self.get_param("open_id")
+        push_base_model = PushBaseModel(context=self)
+        invoke_result_data = push_base_model.add_wechat_subscribe(share_config.get_value("app_id"), template_id, open_id)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success()
+
+
+class GetHighPowerListHandler(ClientBaseHandler):
+    """
+    :description: 获取中台配置的高级权限列表
+    """
+    def get_async(self):
+        """
+        :description: 获取中台配置的高级权限列表
+        :return: list
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        app_base_model = AppBaseModel(context=self)
+        app_info_dict = app_base_model.get_app_info_dict(app_id)
+        if not app_info_dict:
+            return self.response_json_error("Error", "小程序不存在")
+        store_user_nick = app_info_dict["store_user_nick"]
+        access_token = app_info_dict["access_token"]
+        config_data = {}
+        config_data["is_customized"] = 0
+        top_base_model = TopBaseModel(context=self)
+        mp_base_model = MPBaseModel(context=self)
+        invoke_result_data = mp_base_model.get_custom_function_list(store_user_nick)
+        if invoke_result_data.success == True:
+            custom_function_list = invoke_result_data.data if invoke_result_data.data else []
+        else:
+            custom_function_list = mp_base_model.get_api_custom_function_list(store_user_nick)
+        if len(custom_function_list) == 0:
+            app_key, app_secret = self.get_app_key_secret()
+            #获取项目编码
+            project_code = top_base_model.get_project_code(store_user_nick, access_token, app_key, app_secret)
+            invoke_result_data = mp_base_model.get_public_function_list(project_code)
+            if invoke_result_data.success == True:
+                public_function_list = invoke_result_data.data if invoke_result_data.data else []
+            else:
+                public_function_list = mp_base_model.get_api_public_function_list(project_code)
+            if len(public_function_list) > 0:
+                config_data["function_config_list"] = query(public_function_list[0]["function_info_second_list"]).select(lambda x: {"name": x["name"], "key_name": x["key_name"]}).to_list()
+        else:
+            config_data["is_customized"] = 1
+            config_data["function_config_list"] = []
+            custom_function_list = list(filter(lambda custom_function: custom_function["app_id"] == app_id, custom_function_list))
+            if len(custom_function_list) > 0:
+                config_data["function_config_list"] = query(custom_function_list[0]["function_info_second_list"]).select(lambda x: {"name": x["name"], "key_name": x["key_name"]}).to_list()
+        self.response_json_success(self.business_process_executed(config_data, ref_params={}))
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/handlers/client/goods.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/handlers/client/goods.py`

 * *Ordering differences only*

 * *Files 14% similar despite different names*

```diff
@@ -1,81 +1,81 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-08-03 09:24:50
-@LastEditTime: 2022-07-19 10:50:34
-@LastEditors: HuangJianYi
-@Description: 
-"""
-from seven_cloudapp_frame.models.top_base_model import *
-from seven_cloudapp_frame.models.app_base_model import *
-from seven_cloudapp_frame.handlers.frame_base import *
-from seven_cloudapp_frame.models.db_models.prize.prize_roster_model import *
-
-
-class SkuInfoHandler(ClientBaseHandler):
-    """
-    :description: 获取SKU信息
-    """
-    def get_async(self):
-        """
-        :description: 获取SKU信息
-        :param num_iid：num_iid
-        :return
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        is_log = int(self.get_param("is_log", 0))
-        is_log = True if is_log == 1 else False
-        num_iid = self.get_param("num_iid")
-        if not num_iid:
-            num_iid = self.get_param("num_iids")
-        if not num_iid:
-            return self.response_json_error("param_error", "参数错误,缺少必传参数")
-        top_base_model = TopBaseModel(context=self)
-        app_base_model = AppBaseModel(context=self)
-        app_info_dict = app_base_model.get_app_info_dict(app_id)
-        if not app_info_dict:
-            return self.response_json_error("error", "小程序不存在")
-        app_key, app_secret = self.get_app_key_secret()
-        invoke_result_data = top_base_model.get_goods_list_by_goodsids(num_iid, app_info_dict["access_token"], app_key, app_secret, is_log=is_log)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        if "items_seller_list_get_response" in invoke_result_data.data.keys():
-            if "items" in invoke_result_data.data["items_seller_list_get_response"].keys():
-                return self.response_json_success(invoke_result_data.data["items_seller_list_get_response"])
-        else:
-            act_prize = ActPrizeModel(context=self).get_dict("goods_id=%s and sku_json<>'' and is_sku=1 ", limit="1", field="sku_json", params=[num_iid])
-            if not act_prize:
-                return self.response_json_error("error", "对不起，找不到该商品的sku")
-            sku_detail = self.json_loads(act_prize['sku_json'])
-            return self.response_json_success(self.business_process_executed(sku_detail["items_seller_list_get_response"], ref_params={}))
-
-
-class GoodsListHandler(ClientBaseHandler):
-    """
-    :description: 获取商品列表
-    """
-    def get_async(self):
-        """
-        :description: 获取商品列表
-        :param page_index：页索引
-        :param page_size：页大小
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        page_index = int(self.get_param("page_index", 0))
-        page_size = self.get_param("page_size", 10)
-        is_log = int(self.get_param("is_log", 0))
-        is_log = True if is_log == 1 else False
-
-        top_base_model = TopBaseModel(context=self)
-        app_base_model = AppBaseModel(context=self)
-        app_info_dict = app_base_model.get_app_info_dict(app_id)
-        if not app_info_dict:
-            return self.response_json_error("error", "小程序不存在")
-        app_key, app_secret = self.get_app_key_secret()
-        invoke_result_data = top_base_model.get_goods_list(page_index, page_size, "", "", "", app_info_dict["access_token"], app_key, app_secret, is_log=is_log)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success(self.business_process_executed(invoke_result_data.data, ref_params={}))
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-08-03 09:24:50
+@LastEditTime: 2022-07-19 10:50:34
+@LastEditors: HuangJianYi
+@Description: 
+"""
+from seven_cloudapp_frame.models.top_base_model import *
+from seven_cloudapp_frame.models.app_base_model import *
+from seven_cloudapp_frame.handlers.frame_base import *
+from seven_cloudapp_frame.models.db_models.prize.prize_roster_model import *
+
+
+class SkuInfoHandler(ClientBaseHandler):
+    """
+    :description: 获取SKU信息
+    """
+    def get_async(self):
+        """
+        :description: 获取SKU信息
+        :param num_iid：num_iid
+        :return
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        is_log = int(self.get_param("is_log", 0))
+        is_log = True if is_log == 1 else False
+        num_iid = self.get_param("num_iid")
+        if not num_iid:
+            num_iid = self.get_param("num_iids")
+        if not num_iid:
+            return self.response_json_error("param_error", "参数错误,缺少必传参数")
+        top_base_model = TopBaseModel(context=self)
+        app_base_model = AppBaseModel(context=self)
+        app_info_dict = app_base_model.get_app_info_dict(app_id)
+        if not app_info_dict:
+            return self.response_json_error("error", "小程序不存在")
+        app_key, app_secret = self.get_app_key_secret()
+        invoke_result_data = top_base_model.get_goods_list_by_goodsids(num_iid, app_info_dict["access_token"], app_key, app_secret, is_log=is_log)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if "items_seller_list_get_response" in invoke_result_data.data.keys():
+            if "items" in invoke_result_data.data["items_seller_list_get_response"].keys():
+                return self.response_json_success(invoke_result_data.data["items_seller_list_get_response"])
+        else:
+            act_prize = ActPrizeModel(context=self).get_dict("goods_id=%s and sku_json<>'' and is_sku=1 ", limit="1", field="sku_json", params=[num_iid])
+            if not act_prize:
+                return self.response_json_error("error", "对不起，找不到该商品的sku")
+            sku_detail = self.json_loads(act_prize['sku_json'])
+            return self.response_json_success(self.business_process_executed(sku_detail["items_seller_list_get_response"], ref_params={}))
+
+
+class GoodsListHandler(ClientBaseHandler):
+    """
+    :description: 获取商品列表
+    """
+    def get_async(self):
+        """
+        :description: 获取商品列表
+        :param page_index：页索引
+        :param page_size：页大小
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        page_index = int(self.get_param("page_index", 0))
+        page_size = self.get_param("page_size", 10)
+        is_log = int(self.get_param("is_log", 0))
+        is_log = True if is_log == 1 else False
+
+        top_base_model = TopBaseModel(context=self)
+        app_base_model = AppBaseModel(context=self)
+        app_info_dict = app_base_model.get_app_info_dict(app_id)
+        if not app_info_dict:
+            return self.response_json_error("error", "小程序不存在")
+        app_key, app_secret = self.get_app_key_secret()
+        invoke_result_data = top_base_model.get_goods_list(page_index, page_size, "", "", "", app_info_dict["access_token"], app_key, app_secret, is_log=is_log)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success(self.business_process_executed(invoke_result_data.data, ref_params={}))
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/handlers/client/order.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/handlers/client/order.py`

 * *Ordering differences only*

 * *Files 10% similar despite different names*

```diff
@@ -1,337 +1,337 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-08-09 15:00:05
-@LastEditTime: 2023-02-10 10:52:08
-@LastEditors: HuangJianYi
-@Description: 
-"""
-from seven_cloudapp_frame.models.enum import PageCountMode
-from seven_cloudapp_frame.handlers.frame_base import *
-from seven_cloudapp_frame.models.order_base_model import *
-from seven_cloudapp_frame.models.stat_base_model import *
-
-
-class HorseracelampListHandler(ClientBaseHandler):
-    """
-    :description: 获取跑马灯奖品列表
-    """
-    def get_async(self):
-        """
-        :description: 获取跑马灯奖品列表
-        :param act_id: 活动标识
-        :param module_id: 活动模块标识
-        :param page_size: 条数
-        :param is_search_module: 是否查询活动模块
-        :return:
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        module_id = int(self.get_param("module_id", -1))
-        page_size = int(self.get_param("page_size", 30))
-        is_search_module = int(self.get_param("is_search_module", 0))
-        if is_search_module == 0:
-            is_search_module = False
-        else:
-            is_search_module = True
-
-        if not app_id or not act_id:
-            return self.response_json_success({"data": []})
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_success({"data": []})
-        if not invoke_result_data.data:
-            invoke_result_data.data = {}
-        condition = invoke_result_data.data["condition"] if invoke_result_data.data.__contains__("condition") else f"create_date>'{TimeHelper.add_hours_by_format_time(hour=-1)}'"
-        params = invoke_result_data.data["params"] if invoke_result_data.data.__contains__("params") else []
-        order_base_model = OrderBaseModel(context=self)
-        horseracelamp_list = self.business_process_executed(order_base_model.get_horseracelamp_list(app_id, act_id, module_id, is_search_module, condition, params, page_size), ref_params={})
-        return self.response_json_success(horseracelamp_list)
-
-
-class SyncPayOrderHandler(ClientBaseHandler):
-    """
-    :description: 同步淘宝支付订单给用户加资产
-    """
-    @filter_check_params("login_token",check_user_code=True)
-    def get_async(self):
-        """
-        :description: 同步淘宝支付订单给用户加资产
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_code:用户标识
-        :param login_token:访问令牌
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        open_id = self.get_param("open_id")
-        act_id = self.get_act_id()
-        user_id = self.get_user_id()
-        module_id = int(self.get_param("module_id", 0))
-        login_token = self.get_param("login_token")
-        is_log = int(self.get_param("is_log", 0))
-        is_log = True if is_log == 1 else False
-
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        if not invoke_result_data.data:
-            invoke_result_data.data = {}
-        app_key, app_secret = self.get_app_key_secret()
-        order_base_model = OrderBaseModel(context=self)
-        asset_type = invoke_result_data.data["asset_type"] if invoke_result_data.data.__contains__("asset_type") else 3
-        goods_id = invoke_result_data.data["goods_id"] if invoke_result_data.data.__contains__("goods_id") else ""
-        sku_id = invoke_result_data.data["sku_id"] if invoke_result_data.data.__contains__("sku_id") else ""
-        ascription_type = invoke_result_data.data["ascription_type"] if invoke_result_data.data.__contains__("ascription_type") else 1
-        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
-        continue_request_expire = invoke_result_data.data["continue_request_expire"] if invoke_result_data.data.__contains__("continue_request_expire") else 5
-        invoke_result_data = order_base_model.sync_tao_pay_order(app_id, act_id, module_id, user_id, login_token, self.__class__.__name__, self.request_code, asset_type, goods_id, sku_id, ascription_type, app_key, app_secret, is_log, check_user_nick, continue_request_expire)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        ref_params = {}
-        ref_params["app_id"] = app_id
-        ref_params["act_id"] = act_id
-        ref_params["module_id"] = module_id
-        ref_params["user_id"] = user_id
-        ref_params["open_id"] = open_id
-
-        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success(invoke_result_data.data)
-
-
-    def business_process_executed(self, result_data, ref_params):
-        """
-        :description: 执行后事件
-        :param result_data:result_data
-        :param ref_params: 关联参数
-        :return:
-        :last_editors: HuangJianYi
-        """
-        stat_base_model = StatBaseModel(context=self)
-        key_list_dict = {}
-        key_list_dict["PayUserCount"] = 1
-        key_list_dict["PayCount"] = result_data.data["pay_num"]
-        key_list_dict["PayMoneyCount"] = result_data.data["pay_price"]
-        stat_base_model.add_stat_list(ref_params["app_id"], ref_params["act_id"], ref_params["module_id"], ref_params["user_id"], ref_params["open_id"], key_list_dict)
-        return result_data
-
-
-class PrizeOrderListHandler(ClientBaseHandler):
-    """
-    :description: 用户奖品订单列表
-    """
-    filter_check_params(check_user_code=True)
-    def get_async(self):
-        """
-        :description: 用户奖品订单列表
-        :param act_id：活动标识
-        :param order_no：订单号
-        :param user_code：用户标识
-        :param user_open_id：open_id
-        :param order_status：订单状态（-1未付款-2付款中0未发货1已发货2不予发货3已退款4交易成功）
-        :param create_date_start：订单创建时间开始
-        :param create_date_end：订单创建时间结束
-        :param page_size：页大小
-        :param page_index：页索引
-        :param order_by：排序
-        :param is_search_roster：是否查询订单关联中奖记录
-        :param page_count_mode：分页模式(0-none 1-total 2-next)
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        user_id = self.get_user_id()
-        user_open_id = self.get_param("user_open_id")
-        order_status = self.get_param_int("order_status", -10)
-        create_date_start = self.get_param("create_date_start")
-        create_date_end = self.get_param("create_date_end")
-        order_by = self.get_param("order_by","id desc")
-        is_search_roster = self.get_param_int("is_search_roster", 0)
-        is_search_roster = False if is_search_roster == 0 else True
-        page_index = self.get_param_int("page_index", 0)
-        page_size = self.get_param_int("page_size", 10)
-        page_count_mode = self.get_param_int("page_count_mode", 1)
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_success({"data": []})
-        if not invoke_result_data.data:
-            invoke_result_data.data = {}
-        page_count_mode = SevenHelper.get_enum_key(PageCountMode, page_count_mode)
-        condition = invoke_result_data.data["condition"] if invoke_result_data.data.__contains__("condition") else ""
-        params = invoke_result_data.data["params"] if invoke_result_data.data.__contains__("params") else []
-        order_by = invoke_result_data.data["order_by"] if invoke_result_data.data.__contains__("order_by") else "create_date desc"
-        field = invoke_result_data.data["field"] if invoke_result_data.data.__contains__("field") else "*"
-        prize_roster_sub_table = invoke_result_data.data["prize_roster_sub_table"] if invoke_result_data.data.__contains__("prize_roster_sub_table") else None
-
-        order_base_model = OrderBaseModel(context=self)
-        page_list = order_base_model.get_prize_order_list(app_id, act_id, user_id, user_open_id, "", "", "", "", "", order_status, create_date_start, create_date_end, page_size, page_index, order_by, field, is_search_roster=is_search_roster, is_cache=True, condition=condition, params=params, prize_roster_sub_table=prize_roster_sub_table, page_count_mode=page_count_mode)
-        ref_params = {}
-        if page_count_mode == "total":
-            total = page_list[1]
-            page_list = self.business_process_executed(page_list[0], ref_params=ref_params)
-            return_info = PageInfo(page_index, page_size, total, page_list)
-        elif page_count_mode == "next":
-            is_next = page_list[1]
-            page_list = self.business_process_executed(page_list[0], ref_params=ref_params)
-            return_info = WaterPageInfo(page_list, is_next)
-        else:
-            return_info = self.business_process_executed(page_list, ref_params=ref_params)
-        return self.response_json_success(return_info)
-
-
-class PrizeRosterListHandler(ClientBaseHandler):
-    """
-    :description: 用户中奖记录列表
-    """
-    filter_check_params(check_user_code=True)
-    def get_async(self):
-        """
-        :description: 用户中奖记录列表
-        :param act_id：活动标识
-        :param module_id：活动模块标识
-        :param user_code：用户标识
-        :param order_no：订单号
-        :param goods_type：物品类型（1虚拟2实物）
-        :param prize_type：奖品类型(1现货2优惠券3红包4参与奖5预售)
-        :param logistics_status：物流状态（0未发货1已发货2不予发货）
-        :param prize_status：奖品状态（0未下单（未领取）1已下单（已领取）2已回购10已隐藏（删除）11无需发货）
-        :param pay_status：支付状态(0未支付1已支付2已退款3处理中)
-        :param page_size：页大小
-        :param page_index：页索引
-        :param page_count_mode：分页模式(0-none 1-total 2-next)
-        :return PageInfo
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        open_id = self.get_param("open_id")
-        act_id = self.get_act_id()
-        module_id = int(self.get_param("module_id", 0))
-        user_id = self.get_user_id()
-        order_no = self.get_param("order_no")
-        goods_type = int(self.get_param("goods_type", -1))
-        prize_type = int(self.get_param("prize_type", -1))
-        logistics_status = int(self.get_param("logistics_status", -1))
-        prize_status = int(self.get_param("prize_status", -1))
-        pay_status = int(self.get_param("pay_status", -1))
-        page_index = int(self.get_param("page_index", 0))
-        page_size = int(self.get_param("page_size", 20))
-        page_count_mode = self.get_param_int("page_count_mode", 1)
-
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_success({"data": []})
-        if not invoke_result_data.data:
-            invoke_result_data.data = {}
-        page_count_mode = SevenHelper.get_enum_key(PageCountMode,page_count_mode)
-        ref_params = {}
-        order_base_model = OrderBaseModel(context=self)
-        page_list = order_base_model.get_prize_roster_list(app_id=app_id, act_id=act_id, module_id=module_id, user_id=user_id, open_id=open_id, order_no=order_no, goods_type=goods_type, prize_type=prize_type, logistics_status=logistics_status, prize_status=prize_status, pay_status=pay_status, page_size=page_size, page_index=page_index, page_count_mode=page_count_mode)
-        if page_count_mode == "total":
-            if len(page_list) > 0:
-                total = page_list[1]
-                page_list = self.business_process_executed(page_list[0], ref_params=ref_params)
-            else:
-                total = 0
-                page_list = []
-            return_info = PageInfo(page_index, page_size, total, page_list)
-        elif page_count_mode == "next":
-            if len(page_list) > 0:
-                is_next = page_list[1]
-                page_list = self.business_process_executed(page_list[0], ref_params=ref_params)
-            else:
-                is_next = False
-                page_list = []
-            return_info = WaterPageInfo(page_list, is_next)
-        else:
-            return_info = self.business_process_executed(page_list, ref_params=ref_params)
-        return self.response_json_success(return_info)
-
-
-class SubmitSkuHandler(ClientBaseHandler):
-    """
-    :description: 中奖记录选择SKU提交
-    """
-    @filter_check_params("user_prize_id,sku_id")
-    def get_async(self):
-        """
-        :description: 提交SKU
-        :param user_prize_id：用户中奖信息标识
-        :param sku_name：sku属性名称
-        :param sku_id：sku_id
-        :return 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        open_id = self.get_param("open_id")
-        user_prize_id = int(self.get_param("user_prize_id"))
-        sku_name = self.get_param("sku_name")
-        sku_id = self.get_param("sku_id")
-
-        prize_roster_model = PrizeRosterModel(sub_table=FrameBaseModel(context=self).get_business_sub_table("prize_roster_tb", {"app_id": app_id}), context=self)
-        prize_roster = prize_roster_model.get_entity_by_id(user_prize_id)
-        if not prize_roster or prize_roster.open_id != open_id or prize_roster.app_id != app_id:
-            return self.response_json_error("no_user_prize", "对不起，找不到该奖品")
-        if prize_roster.is_sku > 0:
-            prize_roster.sku_id = sku_id
-            prize_roster.sku_name = sku_name
-            goods_code_list = self.json_loads(prize_roster.goods_code_list)
-            goods_codes = [i for i in goods_code_list if str(i["sku_id"]) == sku_id]
-            if goods_codes and len(goods_codes) > 0 and ("goods_code" in goods_codes[0].keys()):
-                prize_roster.goods_code = goods_codes[0]["goods_code"]
-        prize_roster_model.update_entity(prize_roster, "sku_id,sku_name,goods_code")
-
-        return self.response_json_success()
-
-
-class SelectPrizeOrderHandler(ClientBaseHandler):
-    """
-    :description: 中奖记录下单
-    """
-    @filter_check_params("login_token,real_name,telephone", check_user_code=True)
-    def get_async(self):
-        """
-        :param act_id：活动标识
-        :param user_code：用户标识
-        :param login_token:用户访问令牌
-        :param prize_ids:用户奖品id串，逗号分隔（为空则将所有未下单的奖品进行下单）
-        :param real_name:用户名
-        :param telephone:电话
-        :param province:省
-        :param city:市
-        :param county:区县
-        :param street:街道
-        :param address:地址
-        :return
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        user_id = self.get_user_id()
-        login_token = self.get_param("login_token")
-        prize_ids = self.get_param("prize_ids")
-        real_name = self.get_param("real_name")
-        telephone = self.get_param("telephone")
-        province = self.get_param("province")
-        city = self.get_param("city")
-        county = self.get_param("county")
-        street = self.get_param("street")
-        address = self.get_param("address")
-
-        order_base_model = OrderBaseModel(context=self)
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        if not invoke_result_data.data:
-            invoke_result_data.data = {}
-        prize_ids = invoke_result_data.data["prize_ids"] if invoke_result_data.data.__contains__("prize_ids") else prize_ids
-        invoke_result_data = order_base_model.select_prize_order(app_id, act_id, user_id, login_token, prize_ids, real_name, telephone, province, city, county, street,address)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        else:
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-08-09 15:00:05
+@LastEditTime: 2023-02-10 10:52:08
+@LastEditors: HuangJianYi
+@Description: 
+"""
+from seven_cloudapp_frame.models.enum import PageCountMode
+from seven_cloudapp_frame.handlers.frame_base import *
+from seven_cloudapp_frame.models.order_base_model import *
+from seven_cloudapp_frame.models.stat_base_model import *
+
+
+class HorseracelampListHandler(ClientBaseHandler):
+    """
+    :description: 获取跑马灯奖品列表
+    """
+    def get_async(self):
+        """
+        :description: 获取跑马灯奖品列表
+        :param act_id: 活动标识
+        :param module_id: 活动模块标识
+        :param page_size: 条数
+        :param is_search_module: 是否查询活动模块
+        :return:
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        module_id = int(self.get_param("module_id", -1))
+        page_size = int(self.get_param("page_size", 30))
+        is_search_module = int(self.get_param("is_search_module", 0))
+        if is_search_module == 0:
+            is_search_module = False
+        else:
+            is_search_module = True
+
+        if not app_id or not act_id:
+            return self.response_json_success({"data": []})
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_success({"data": []})
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        condition = invoke_result_data.data["condition"] if invoke_result_data.data.__contains__("condition") else f"create_date>'{TimeHelper.add_hours_by_format_time(hour=-1)}'"
+        params = invoke_result_data.data["params"] if invoke_result_data.data.__contains__("params") else []
+        order_base_model = OrderBaseModel(context=self)
+        horseracelamp_list = self.business_process_executed(order_base_model.get_horseracelamp_list(app_id, act_id, module_id, is_search_module, condition, params, page_size), ref_params={})
+        return self.response_json_success(horseracelamp_list)
+
+
+class SyncPayOrderHandler(ClientBaseHandler):
+    """
+    :description: 同步淘宝支付订单给用户加资产
+    """
+    @filter_check_params("login_token",check_user_code=True)
+    def get_async(self):
+        """
+        :description: 同步淘宝支付订单给用户加资产
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param user_code:用户标识
+        :param login_token:访问令牌
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        open_id = self.get_param("open_id")
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        module_id = int(self.get_param("module_id", 0))
+        login_token = self.get_param("login_token")
+        is_log = int(self.get_param("is_log", 0))
+        is_log = True if is_log == 1 else False
+
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        app_key, app_secret = self.get_app_key_secret()
+        order_base_model = OrderBaseModel(context=self)
+        asset_type = invoke_result_data.data["asset_type"] if invoke_result_data.data.__contains__("asset_type") else 3
+        goods_id = invoke_result_data.data["goods_id"] if invoke_result_data.data.__contains__("goods_id") else ""
+        sku_id = invoke_result_data.data["sku_id"] if invoke_result_data.data.__contains__("sku_id") else ""
+        ascription_type = invoke_result_data.data["ascription_type"] if invoke_result_data.data.__contains__("ascription_type") else 1
+        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
+        continue_request_expire = invoke_result_data.data["continue_request_expire"] if invoke_result_data.data.__contains__("continue_request_expire") else 5
+        invoke_result_data = order_base_model.sync_tao_pay_order(app_id, act_id, module_id, user_id, login_token, self.__class__.__name__, self.request_code, asset_type, goods_id, sku_id, ascription_type, app_key, app_secret, is_log, check_user_nick, continue_request_expire)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        ref_params = {}
+        ref_params["app_id"] = app_id
+        ref_params["act_id"] = act_id
+        ref_params["module_id"] = module_id
+        ref_params["user_id"] = user_id
+        ref_params["open_id"] = open_id
+
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success(invoke_result_data.data)
+
+
+    def business_process_executed(self, result_data, ref_params):
+        """
+        :description: 执行后事件
+        :param result_data:result_data
+        :param ref_params: 关联参数
+        :return:
+        :last_editors: HuangJianYi
+        """
+        stat_base_model = StatBaseModel(context=self)
+        key_list_dict = {}
+        key_list_dict["PayUserCount"] = 1
+        key_list_dict["PayCount"] = result_data.data["pay_num"]
+        key_list_dict["PayMoneyCount"] = result_data.data["pay_price"]
+        stat_base_model.add_stat_list(ref_params["app_id"], ref_params["act_id"], ref_params["module_id"], ref_params["user_id"], ref_params["open_id"], key_list_dict)
+        return result_data
+
+
+class PrizeOrderListHandler(ClientBaseHandler):
+    """
+    :description: 用户奖品订单列表
+    """
+    filter_check_params(check_user_code=True)
+    def get_async(self):
+        """
+        :description: 用户奖品订单列表
+        :param act_id：活动标识
+        :param order_no：订单号
+        :param user_code：用户标识
+        :param user_open_id：open_id
+        :param order_status：订单状态（-1未付款-2付款中0未发货1已发货2不予发货3已退款4交易成功）
+        :param create_date_start：订单创建时间开始
+        :param create_date_end：订单创建时间结束
+        :param page_size：页大小
+        :param page_index：页索引
+        :param order_by：排序
+        :param is_search_roster：是否查询订单关联中奖记录
+        :param page_count_mode：分页模式(0-none 1-total 2-next)
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        user_open_id = self.get_param("user_open_id")
+        order_status = self.get_param_int("order_status", -10)
+        create_date_start = self.get_param("create_date_start")
+        create_date_end = self.get_param("create_date_end")
+        order_by = self.get_param("order_by","id desc")
+        is_search_roster = self.get_param_int("is_search_roster", 0)
+        is_search_roster = False if is_search_roster == 0 else True
+        page_index = self.get_param_int("page_index", 0)
+        page_size = self.get_param_int("page_size", 10)
+        page_count_mode = self.get_param_int("page_count_mode", 1)
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_success({"data": []})
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        page_count_mode = SevenHelper.get_enum_key(PageCountMode, page_count_mode)
+        condition = invoke_result_data.data["condition"] if invoke_result_data.data.__contains__("condition") else ""
+        params = invoke_result_data.data["params"] if invoke_result_data.data.__contains__("params") else []
+        order_by = invoke_result_data.data["order_by"] if invoke_result_data.data.__contains__("order_by") else "create_date desc"
+        field = invoke_result_data.data["field"] if invoke_result_data.data.__contains__("field") else "*"
+        prize_roster_sub_table = invoke_result_data.data["prize_roster_sub_table"] if invoke_result_data.data.__contains__("prize_roster_sub_table") else None
+
+        order_base_model = OrderBaseModel(context=self)
+        page_list = order_base_model.get_prize_order_list(app_id, act_id, user_id, user_open_id, "", "", "", "", "", order_status, create_date_start, create_date_end, page_size, page_index, order_by, field, is_search_roster=is_search_roster, is_cache=True, condition=condition, params=params, prize_roster_sub_table=prize_roster_sub_table, page_count_mode=page_count_mode)
+        ref_params = {}
+        if page_count_mode == "total":
+            total = page_list[1]
+            page_list = self.business_process_executed(page_list[0], ref_params=ref_params)
+            return_info = PageInfo(page_index, page_size, total, page_list)
+        elif page_count_mode == "next":
+            is_next = page_list[1]
+            page_list = self.business_process_executed(page_list[0], ref_params=ref_params)
+            return_info = WaterPageInfo(page_list, is_next)
+        else:
+            return_info = self.business_process_executed(page_list, ref_params=ref_params)
+        return self.response_json_success(return_info)
+
+
+class PrizeRosterListHandler(ClientBaseHandler):
+    """
+    :description: 用户中奖记录列表
+    """
+    filter_check_params(check_user_code=True)
+    def get_async(self):
+        """
+        :description: 用户中奖记录列表
+        :param act_id：活动标识
+        :param module_id：活动模块标识
+        :param user_code：用户标识
+        :param order_no：订单号
+        :param goods_type：物品类型（1虚拟2实物）
+        :param prize_type：奖品类型(1现货2优惠券3红包4参与奖5预售)
+        :param logistics_status：物流状态（0未发货1已发货2不予发货）
+        :param prize_status：奖品状态（0未下单（未领取）1已下单（已领取）2已回购10已隐藏（删除）11无需发货）
+        :param pay_status：支付状态(0未支付1已支付2已退款3处理中)
+        :param page_size：页大小
+        :param page_index：页索引
+        :param page_count_mode：分页模式(0-none 1-total 2-next)
+        :return PageInfo
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        open_id = self.get_param("open_id")
+        act_id = self.get_act_id()
+        module_id = int(self.get_param("module_id", 0))
+        user_id = self.get_user_id()
+        order_no = self.get_param("order_no")
+        goods_type = int(self.get_param("goods_type", -1))
+        prize_type = int(self.get_param("prize_type", -1))
+        logistics_status = int(self.get_param("logistics_status", -1))
+        prize_status = int(self.get_param("prize_status", -1))
+        pay_status = int(self.get_param("pay_status", -1))
+        page_index = int(self.get_param("page_index", 0))
+        page_size = int(self.get_param("page_size", 20))
+        page_count_mode = self.get_param_int("page_count_mode", 1)
+
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_success({"data": []})
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        page_count_mode = SevenHelper.get_enum_key(PageCountMode,page_count_mode)
+        ref_params = {}
+        order_base_model = OrderBaseModel(context=self)
+        page_list = order_base_model.get_prize_roster_list(app_id=app_id, act_id=act_id, module_id=module_id, user_id=user_id, open_id=open_id, order_no=order_no, goods_type=goods_type, prize_type=prize_type, logistics_status=logistics_status, prize_status=prize_status, pay_status=pay_status, page_size=page_size, page_index=page_index, page_count_mode=page_count_mode)
+        if page_count_mode == "total":
+            if len(page_list) > 0:
+                total = page_list[1]
+                page_list = self.business_process_executed(page_list[0], ref_params=ref_params)
+            else:
+                total = 0
+                page_list = []
+            return_info = PageInfo(page_index, page_size, total, page_list)
+        elif page_count_mode == "next":
+            if len(page_list) > 0:
+                is_next = page_list[1]
+                page_list = self.business_process_executed(page_list[0], ref_params=ref_params)
+            else:
+                is_next = False
+                page_list = []
+            return_info = WaterPageInfo(page_list, is_next)
+        else:
+            return_info = self.business_process_executed(page_list, ref_params=ref_params)
+        return self.response_json_success(return_info)
+
+
+class SubmitSkuHandler(ClientBaseHandler):
+    """
+    :description: 中奖记录选择SKU提交
+    """
+    @filter_check_params("user_prize_id,sku_id")
+    def get_async(self):
+        """
+        :description: 提交SKU
+        :param user_prize_id：用户中奖信息标识
+        :param sku_name：sku属性名称
+        :param sku_id：sku_id
+        :return 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        open_id = self.get_param("open_id")
+        user_prize_id = int(self.get_param("user_prize_id"))
+        sku_name = self.get_param("sku_name")
+        sku_id = self.get_param("sku_id")
+
+        prize_roster_model = PrizeRosterModel(sub_table=FrameBaseModel(context=self).get_business_sub_table("prize_roster_tb", {"app_id": app_id}), context=self)
+        prize_roster = prize_roster_model.get_entity_by_id(user_prize_id)
+        if not prize_roster or prize_roster.open_id != open_id or prize_roster.app_id != app_id:
+            return self.response_json_error("no_user_prize", "对不起，找不到该奖品")
+        if prize_roster.is_sku > 0:
+            prize_roster.sku_id = sku_id
+            prize_roster.sku_name = sku_name
+            goods_code_list = self.json_loads(prize_roster.goods_code_list)
+            goods_codes = [i for i in goods_code_list if str(i["sku_id"]) == sku_id]
+            if goods_codes and len(goods_codes) > 0 and ("goods_code" in goods_codes[0].keys()):
+                prize_roster.goods_code = goods_codes[0]["goods_code"]
+        prize_roster_model.update_entity(prize_roster, "sku_id,sku_name,goods_code")
+
+        return self.response_json_success()
+
+
+class SelectPrizeOrderHandler(ClientBaseHandler):
+    """
+    :description: 中奖记录下单
+    """
+    @filter_check_params("login_token,real_name,telephone", check_user_code=True)
+    def get_async(self):
+        """
+        :param act_id：活动标识
+        :param user_code：用户标识
+        :param login_token:用户访问令牌
+        :param prize_ids:用户奖品id串，逗号分隔（为空则将所有未下单的奖品进行下单）
+        :param real_name:用户名
+        :param telephone:电话
+        :param province:省
+        :param city:市
+        :param county:区县
+        :param street:街道
+        :param address:地址
+        :return
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        login_token = self.get_param("login_token")
+        prize_ids = self.get_param("prize_ids")
+        real_name = self.get_param("real_name")
+        telephone = self.get_param("telephone")
+        province = self.get_param("province")
+        city = self.get_param("city")
+        county = self.get_param("county")
+        street = self.get_param("street")
+        address = self.get_param("address")
+
+        order_base_model = OrderBaseModel(context=self)
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        prize_ids = invoke_result_data.data["prize_ids"] if invoke_result_data.data.__contains__("prize_ids") else prize_ids
+        invoke_result_data = order_base_model.select_prize_order(app_id, act_id, user_id, login_token, prize_ids, real_name, telephone, province, city, county, street,address)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        else:
             return self.response_json_success(self.business_process_executed(invoke_result_data, ref_params={}))
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/handlers/client/pay.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/handlers/client/pay.py`

 * *Ordering differences only*

 * *Files 9% similar despite different names*

```diff
@@ -1,565 +1,565 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-09-13 16:49:46
-@LastEditTime: 2023-02-10 09:52:14
-@LastEditors: HuangJianYi
-@Description: 
-"""
-from seven_cloudapp_frame.libs.common import *
-from seven_cloudapp_frame.libs.customize.seven_helper import SevenHelper
-from seven_cloudapp_frame.libs.customize.wechat_helper import WeChatPayRequest, WeChatPayReponse, WeChatRefundReponse
-from seven_cloudapp_frame.libs.customize.tiktok_helper import TikTokPayRequest, TikTokReponse
-from seven_cloudapp_frame.libs.customize.alipay_helper import AliPayRequest
-from seven_cloudapp_frame.models.shakeshop_base_model import *
-from seven_cloudapp_frame.models.price_base_model import *
-from seven_cloudapp_frame.models.asset_base_model import *
-from seven_cloudapp_frame.handlers.frame_base import *
-from seven_cloudapp_frame.models.db_models.pay.pay_order_model import *
-from seven_cloudapp_frame.models.db_models.refund.refund_order_model import *
-from seven_cloudapp_frame.models.db_models.third.third_pay_order_model import *
-
-
-class WechatVoucherOrderHandler(ClientBaseHandler):
-    """
-    :description: 创建微信预订单
-    """
-    @filter_check_params("pay_order_no",check_user_code=True)
-    def get_async(self):
-        """
-        :description: 创建微信预订单
-        :param pay_order_no:支付单号
-        :param user_code:用户标识
-        :return: 请求接口获取客户端需要的支付密钥数据
-        :last_editors: HuangJianYi
-        """
-        user_id = self.get_user_id()
-        pay_order_no = self.get_param("pay_order_no")
-        invoke_result_data = InvokeResultData()
-
-        if SevenHelper.is_continue_request(f"WechatVoucherOrderHandler_{str(user_id)}") == True:
-            return self.response_json_error("error", "对不起,请求太频繁")
-        pay_order_model = PayOrderModel(context=self)
-        pay_order = pay_order_model.get_entity("pay_order_no=%s", params=[pay_order_no])
-        if not pay_order or pay_order.order_status != 0:
-            return self.response_json_error("error", "抱歉!未查询到订单信息,请联系客服")
-        pay_config = share_config.get_value("wechat_pay")
-        pay_notify_url = pay_config["pay_notify_url"]
-
-        # 商品说明
-        body = pay_order.order_name
-        # 金额
-        total_fee = pay_order.pay_amount
-        # ip
-        ip = SevenHelper.get_first_ip(self.get_remote_ip())
-
-        try:
-            invoke_result_data = self.business_process_executing()
-            if invoke_result_data.success == False:
-                return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-            pay_notify_url = invoke_result_data.data["pay_notify_url"] if invoke_result_data.data.__contains__("pay_notify_url") else pay_notify_url
-            time_expire = invoke_result_data.data["time_expire"] if invoke_result_data.data.__contains__("time_expire") else str(SevenHelper.get_now_int(hours=1))  #交易结束时间,设置1小时
-            invoke_result_data = WeChatPayRequest().create_order(pay_order_no, body, total_fee, ip, pay_notify_url, pay_order.open_id, time_expire)
-            if invoke_result_data.success == False:
-                return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-
-            # self.logging_link_info('小程序支付返回前端参数:' + str(invoke_result_data.data))
-            ref_params = {}
-            invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
-            return self.response_json_success(self.business_process_executed(invoke_result_data.data,ref_params={}))
-        except Exception as ex:
-            self.logging_link_error("【创建微信预订单异常】" + traceback.format_exc())
-            return self.response_json_error("fail", "请重新支付")
-
-
-class WechatPayNotifyHandler(FrameBaseHandler):
-    """
-    :description: 微信支付异步通知
-    """
-    @filter_check_params()
-    def post_async(self):
-        """
-        :description:支付异步通知
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        xml_params = self.request.body.decode('utf-8')
-        wechat_pay_reponse = None
-        try:
-            wechat_pay_reponse = WeChatPayReponse(xml_params)  # 创建对象
-            response_result = wechat_pay_reponse.get_data()
-            return_code = response_result["return_code"]
-            result_code = response_result["result_code"]
-            if return_code == "FAIL":
-                return self.write(wechat_pay_reponse.convert_response_xml(response_result["return_msg"], False))
-            if result_code == "FAIL":
-                return self.write(wechat_pay_reponse.convert_response_xml(response_result["err_code_des"], False))
-            if wechat_pay_reponse.check_sign() != True:  # 校验签名,成功则继续后续操作
-                return self.write(wechat_pay_reponse.convert_response_xml("签名验证失败", False))
-            total_fee = response_result["total_fee"]
-            pay_order_no = response_result["out_trade_no"]
-
-            pay_order_model = PayOrderModel(context=self)
-            pay_order = pay_order_model.get_entity("pay_order_no=%s", params=[pay_order_no])
-            if not pay_order:
-                return self.write(wechat_pay_reponse.convert_response_xml("未查询到订单信息", False))
-            # 判断金额是否匹配
-            if int(decimal.Decimal(str(pay_order.pay_amount)) * 100) != int(total_fee):
-                self.logging_link_error(f"微信支付订单[{pay_order_no}] 金额不匹配疑似刷单.数据库金额:{str(pay_order.pay_amount)} 平台回调金额:{str(total_fee)}")
-                return self.write(wechat_pay_reponse.convert_response_xml("金额异常", False))
-
-            invoke_result_data = self.business_process_executing()
-            if invoke_result_data.success == False:
-                return self.write(wechat_pay_reponse.convert_response_xml(invoke_result_data.error_message, False))
-            ref_params = {}
-            ref_params["pay_order"] = pay_order
-            ref_params["response_result"] = response_result
-            self.business_process_executed(invoke_result_data, ref_params)
-
-            return self.write(wechat_pay_reponse.convert_response_xml("SUCCESS", True))
-
-        except Exception as ex:
-            self.logging_link_error("【微信支付异步通知】" + traceback.format_exc() + ":" + str(xml_params))
-            return self.write(wechat_pay_reponse.convert_response_xml("数据异常", False))
-
-
-    def business_process_executed(self, result_data, ref_params):
-        """
-        :description: 执行后事件
-        :param result_data: result_data
-        :param ref_params: 关联参数
-        :return:
-        :last_editors: HuangJianYi
-        """
-        response_result = ref_params["response_result"]
-        pay_order = ref_params["pay_order"]
-        pay_order_model = PayOrderModel(context=self)
-        transaction_id = response_result["transaction_id"]
-        time_string = response_result["time_end"]
-        if pay_order.order_status == 0:
-            pay_order.out_order_no = transaction_id
-            pay_order.order_status = 1
-            pay_order.pay_date = time.strftime("%Y-%m-%d %H:%M:%S", time.strptime(time_string, "%Y%m%d%H%M%S"))
-            pay_order_model.update_entity(pay_order, "out_order_no,order_status,pay_date")
-
-        return result_data
-
-
-class WechatRefundNotifyHandler(FrameBaseHandler):
-    """
-    :description: 微信退款异步通知
-    """
-    @filter_check_params()
-    def post_async(self):
-        invoke_result_data = InvokeResultData()
-        xml_params = self.request.body.decode('utf-8')
-        wechat_refund_reponse = None
-        try:
-            wechat_refund_reponse = WeChatRefundReponse(xml_params)  # 创建对象
-            response_result = wechat_refund_reponse.get_data()
-            return_code = response_result["return_code"]
-            if return_code == "FAIL":
-                return self.write(wechat_refund_reponse.convert_response_xml(response_result["return_msg"], False))
-            invoke_result_data = self.business_process_executing()
-            if invoke_result_data.success == False:
-                return self.write(wechat_refund_reponse.convert_response_xml(invoke_result_data.error_message, False))
-            # 解密
-            req_info_dict = wechat_refund_reponse.decode_req_info(response_result["req_info"])
-            req_info_dict = req_info_dict["root"]
-            ref_params = {}
-            ref_params["req_info_dict"] = req_info_dict
-            self.business_process_executed(invoke_result_data, ref_params)
-            return self.write(wechat_refund_reponse.convert_response_xml("SUCCESS", True))
-        except Exception as ex:
-            self.logging_link_error("【微信退款异步通知】" + traceback.format_exc() + ":" + str(xml_params))
-            return self.write(wechat_refund_reponse.convert_response_xml("数据异常", False))
-
-
-    def business_process_executed(self, result_data, ref_params):
-        """
-        :description: 执行后事件
-        :param result_data: result_data
-        :param ref_params: 关联参数
-        :return:
-        :last_editors: HuangJianYi
-        """
-        req_info_dict = ref_params["req_info_dict"]
-        db_transaction = DbTransaction(db_config_dict=config.get_value("db_cloudapp"), context=self)
-        pay_order_model = PayOrderModel(db_transaction=db_transaction, context=self)
-        refund_order_model = RefundOrderModel(db_transaction=db_transaction, context=self)
-        try:
-            db_transaction.begin_transaction()
-            if req_info_dict["refund_status"] == "SUCCESS":
-                self.logging_link_info(f'pay_order_no:{str(req_info_dict["out_trade_no"])},微信退款异步通知:' + str(req_info_dict))
-                # 退款成功(相关表处理)
-                refund_order_model.update_table("refund_status=3,out_refund_no=%s,refund_date=%s", where="refund_no=%s", params=[req_info_dict["refund_id"], req_info_dict["success_time"], req_info_dict["out_refund_no"]])
-                pay_order_model.update_table("order_status=20,refund_amount=%s", where="pay_order_no=%s", params=[int(req_info_dict["settlement_refund_fee"]) / 100, req_info_dict["out_trade_no"]])
-            else:
-                # 退款失败(只更新退款表)
-                refund_order_model.update_table("refund_status=4", where="out_refund_no=%s", params=req_info_dict["refund_id"])
-            result,message = db_transaction.commit_transaction(True)
-            if result == False:
-                self.logging_link_error("【微信退款异步通知执行事务失败】" + message)
-        except Exception as ex:
-            db_transaction.rollback_transaction()
-            self.logging_link_error("【微信退款异步通知数据处理异常】" + traceback.format_exc())
-
-        return result_data
-
-
-class TiktokVoucherOrderHandler(ClientBaseHandler):
-    """
-    :description: 创建抖音预订单（直购模式使用，即在抖音小程序直接吊起支付）
-    """
-    @filter_check_params("pay_order_no",check_user_code=True)
-    def get_async(self):
-        """
-        :description: 创建抖音预订单
-        :param pay_order_no:支付单号
-        :param user_code:用户标识
-        :return: 请求接口获取客户端需要的支付密钥数据
-        :last_editors: HuangJianYi
-        """
-        user_id = self.get_user_id()
-        pay_order_no = self.get_param("pay_order_no")
-        invoke_result_data = InvokeResultData()
-
-        if SevenHelper.is_continue_request(f"TiktokVoucherOrderHandler_{str(user_id)}") == True:
-            return self.response_json_error("error", "对不起,请求太频繁")
-        pay_order_model = PayOrderModel(context=self)
-        pay_order = pay_order_model.get_entity("pay_order_no=%s", params=[pay_order_no])
-        if not pay_order or pay_order.order_status != 0:
-            return self.response_json_error("error", "抱歉!未查询到订单信息,请联系客服")
-        pay_config = share_config.get_value("tiktok_pay")
-        pay_notify_url = pay_config["pay_notify_url"]
-        # 商品描述
-        subject = pay_order.order_name
-        # 商品详情
-        body = pay_order.order_desc
-        # 金额
-        total_amount = pay_order.pay_amount
-
-        try:
-            invoke_result_data = self.business_process_executing()
-            if invoke_result_data.success == True:
-                pay_notify_url = invoke_result_data.data["pay_notify_url"] if invoke_result_data.data.__contains__("pay_notify_url") else pay_notify_url
-                time_expire = invoke_result_data.data["time_expire"] if invoke_result_data.data.__contains__("time_expire") else 3600  #交易结束时间,设置1小时,单位秒
-            invoke_result_data = TikTokPayRequest().create_order(pay_order_no=pay_order_no, notify_url=pay_notify_url, total_amount=total_amount, subject=subject, body=body, valid_time=time_expire)
-            if invoke_result_data.success == False:
-                return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-            # self.logging_link_info('小程序支付返回前端参数:' + str(invoke_result_data.data))
-            pay_order_model.update_table("out_order_no=%s", "pay_order_no=%s", params=[invoke_result_data.data["order_id"], pay_order_no])
-            ref_params = {}
-            invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
-            return self.response_json_success(invoke_result_data.data)
-        except Exception as ex:
-            self.logging_link_error("【创建抖音预订单异常】" + traceback.format_exc())
-            return self.response_json_error("fail", "请重新支付")
-
-
-class TiktokPayNotifyHandler(FrameBaseHandler):
-    """
-    :description: 抖音支付异步通知（直购模式使用，即在抖音小程序直接吊起支付）
-    """
-    @filter_check_params()
-    def post_async(self):
-        """
-        :description:抖音支付异步通知
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        json_params = self.request.body.decode('utf-8')
-        tiktok_reponse = None
-        try:
-            tiktok_reponse = TikTokReponse(json_params)
-            response_result = tiktok_reponse.get_data()
-            if tiktok_reponse.check_sign() != True:  # 校验签名,成功则继续后续操作
-                return self.write(tiktok_reponse.convert_response_json(-1, "签名验证失败"))
-            if response_result["type"] != "payment":
-                return self.write(tiktok_reponse.convert_response_json(-1, "回调类型标记错误"))
-            response_data = SevenHelper.json_loads(response_result["msg"])
-            total_fee = response_data["total_amount"] if response_data.__contains__("total_amount") else 0
-            pay_order_no = response_data["cp_orderno"]
-            pay_order_model = PayOrderModel(context=self)
-            pay_order = pay_order_model.get_entity("pay_order_no=%s", params=[pay_order_no])
-            if not pay_order:
-                return self.write(tiktok_reponse.convert_response_json(-1, "未查询到支付订单信息"))
-            # 判断金额是否匹配
-            if int(decimal.Decimal(str(pay_order.pay_amount)) * 100) != int(total_fee):
-                self.logging_link_error(f"抖音支付订单[{pay_order_no}] 金额不匹配疑似刷单.数据库金额:{str(pay_order.pay_amount)} 平台回调金额:{str(total_fee)}")
-                return self.write(tiktok_reponse.convert_response_json(-1, "金额异常"))
-
-            invoke_result_data = self.business_process_executing()
-            if invoke_result_data.success == False:
-                return self.write(tiktok_reponse.convert_response_json(-1, invoke_result_data.error_message))
-
-            ref_params = {}
-            ref_params["pay_order"] = pay_order
-            ref_params["response_data"] = response_data
-            self.business_process_executed(invoke_result_data, ref_params)
-
-            return self.write(tiktok_reponse.convert_response_json())
-
-        except Exception as ex:
-            self.logging_link_error("【抖音支付异步通知】" + traceback.format_exc() + ":" + str(json_params))
-            return self.write(tiktok_reponse.convert_response_json(-1, "数据异常"))
-
-
-    def business_process_executed(self, result_data, ref_params):
-        """
-        :description: 执行后事件
-        :param result_data: result_data
-        :param ref_params: 关联参数
-        :return:
-        :last_editors: HuangJianYi
-        """
-        pay_order = ref_params["pay_order"]
-        pay_order_model = PayOrderModel(context=self)
-        if pay_order.order_status == 0 or pay_order.order_status == 2:
-            pay_time = SevenHelper.get_now_datetime()
-            order_id = ""
-            tiktok_pay_request = TikTokPayRequest()
-            query_invoke_result_data = tiktok_pay_request.query_order(pay_order.pay_order_no)
-            if query_invoke_result_data.success == True:
-                pay_time = query_invoke_result_data.data["payment_info"]["pay_time"]
-                order_id = query_invoke_result_data.data["order_id"]
-            pay_order.order_status = 1
-            pay_order.pay_date = pay_time
-            pay_order.out_order_no = order_id if order_id else pay_order.out_order_no
-            pay_order_model.update_entity(pay_order, "out_order_no,order_status,pay_date")
-
-        return result_data
-
-
-class TiktokRefundNotifyHandler(FrameBaseHandler):
-    """
-    :description: 抖音退款异步通知（直购模式使用，即在抖音小程序直接吊起支付）
-    """
-    @filter_check_params()
-    def post_async(self):
-        invoke_result_data = InvokeResultData()
-        json_params = self.request.body.decode('utf-8')
-        tiktok_reponse = None
-        try:
-            tiktok_reponse = TikTokReponse(json_params)
-            response_result = tiktok_reponse.get_data()
-            if tiktok_reponse.check_sign() != True:  # 校验签名,成功则继续后续操作
-                return self.write(tiktok_reponse.convert_response_json(-1, "签名验证失败"))
-            if response_result["type"] != "refund":
-                return self.write(tiktok_reponse.convert_response_json(-1, "回调类型标记错误"))
-            response_data = SevenHelper.json_loads(response_result["msg"])
-            cp_refundno = response_data["cp_refundno"]
-            refund_order_model = RefundOrderModel(context=self)
-            refund_order = refund_order_model.get_entity("refund_no=%s", params=[cp_refundno])
-            if not refund_order:
-                return self.write(tiktok_reponse.convert_response_json(-1, "未查询到退款订单信息"))
-            invoke_result_data = self.business_process_executing()
-            if invoke_result_data.success == False:
-                return self.write(tiktok_reponse.convert_response_json(-1, invoke_result_data.error_message))
-            ref_params = {}
-            ref_params["refund_order"] = refund_order
-            ref_params["response_data"] = response_data
-            self.business_process_executed(invoke_result_data, ref_params)
-
-            return self.write(tiktok_reponse.convert_response_json())
-
-        except Exception as ex:
-            self.logging_link_error("【抖音退款异步通知】" + traceback.format_exc() + ":" + str(json_params))
-            return self.write(tiktok_reponse.convert_response_json(-1, "数据异常"))
-
-
-    def business_process_executed(self, result_data, ref_params):
-        """
-        :description: 执行后事件
-        :param result_data: result_data
-        :param ref_params: 关联参数
-        :return:
-        :last_editors: HuangJianYi
-        """
-        refund_order = ref_params["refund_order"]
-        response_data = ref_params["response_data"]
-        db_transaction = DbTransaction(db_config_dict=config.get_value("db_cloudapp"), context=self)
-        pay_order_model = PayOrderModel(db_transaction=db_transaction, context=self)
-        refund_order_model = RefundOrderModel(db_transaction=db_transaction, context=self)
-        try:
-            db_transaction.begin_transaction()
-            if response_data["status"] == "SUCCESS":
-                self.logging_link_info(f'refund_no:{str(response_data["cp_refundno"])},抖音退款异步通知:' + str(response_data))
-                # 退款成功(相关表处理)
-                refund_order_model.update_table("refund_status=3,refund_date=%s", where="refund_no=%s", params=[SevenHelper.get_now_datetime(), response_data["cp_refundno"]])
-                pay_order_model.update_table("order_status=20,refund_amount=%s", where="pay_order_no=%s", params=[int(response_data["refund_amount"]) / 100, refund_order.pay_order_no])
-            else:
-                # 退款失败(只更新退款表)
-                refund_order_model.update_table("refund_status=4", where="refund_no=%s", params=[response_data["cp_refundno"]])
-            result,message = db_transaction.commit_transaction(True)
-            if result == False:
-                self.logging_link_error("【抖音退款异步通知执行事务失败】" + message)
-        except Exception as ex:
-            db_transaction.rollback_transaction()
-            self.logging_link_error("【抖音退款异步通知数据处理异常】" + traceback.format_exc())
-        return result_data
-
-
-class ShakeshopNotifyHandler(FrameBaseHandler):
-    """
-    :description: 抖店异步通知（读取抖店订单模式使用，即跳到抖店购买商品）
-    """
-    def post_async(self):
-        """
-        :description:抖店异步通知
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        result = None
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        if not invoke_result_data.data:
-            invoke_result_data.data = {}
-        asset_type = invoke_result_data.data["asset_type"] if invoke_result_data.data.__contains__("asset_type") else 3  #资产类型，默认价格档位，
-        goods_id = invoke_result_data.data["goods_id"] if invoke_result_data.data.__contains__("goods_id") else ""  #商品id，当资产类型为价格档位，可不填
-        sku_id = invoke_result_data.data["sku_id"] if invoke_result_data.data.__contains__("sku_id") else ""  #skuid，当资产类型为价格档位，可不填
-        reward_order_status_list = invoke_result_data.data["reward_order_status_list"] if invoke_result_data.data.__contains__("reward_order_status_list") else [2]  #订单奖励类型，默认2已支付
-        sub_b_type_list = invoke_result_data.data["sub_b_type_list"] if invoke_result_data.data.__contains__("sub_b_type_list") else [] #下单场景，默认全部
-        try:
-            third_pay_order_model = ThirdPayOrderModel(context=self)
-            shop_id = share_config.get_value("shake_shop")["shop_id"]
-            app_key = share_config.get_value("shake_shop")["app_key"]
-            app_secret = share_config.get_value("shake_shop")["app_secret"]
-            shakeshop_base_model = ShakeShopBaseModel(self, app_key, app_secret, "SELF", None, shop_id)
-            result = shakeshop_base_model.callback(self.request.headers, self.request.body, is_log=False)
-            if result:
-                result = result[0]
-                result["data"] = json.loads(result["data"])
-                if str(result["data"]["shop_id"]) != str(shop_id):
-                    return self.write({'code': 0, 'msg': 'success'})
-                tag = result.get('tag')
-                if tag == '0':  # 抖店推送服务验证消息，需立即返回success
-                    return self.write({'code': 0, 'msg': 'success'})
-                if tag == '101':  # 订单支付成功，根据推送的消息参数进行必要的业务处理，5秒内返回success
-                    params = {}
-                    params["shop_order_id"] = result["data"]["p_id"] #店铺订单编号
-                    order_detail_result = shakeshop_base_model.request(path="/order/orderDetail", params=params, is_log=False)
-                    if order_detail_result and order_detail_result["code"] == 10000:
-                        open_id = order_detail_result["data"]["shop_order_detail"]["open_id"]
-                        act_info_model = ActInfoModel(context=self)
-                        act_info_dict = act_info_model.get_cache_dict(order_by="id desc")
-                        if act_info_dict:
-                            frame_base_model = FrameBaseModel(context=self)
-                            user_info_model = UserInfoModel(sub_table=frame_base_model.get_business_sub_table("user_info_tb", {"app_id": act_info_dict["app_id"]}), context=self)
-                            user_info_dict = user_info_model.get_cache_dict("act_id=%s and open_id=%s", limit="1", order_by="id desc", params=[act_info_dict["id"],open_id])
-                            if user_info_dict:
-                                tiktok_goods_id_list = []
-                                if asset_type == 3:
-                                    price_base_model = PriceBaseModel(context=self)
-                                    price_gear_dict_list = price_base_model.get_price_gear_list(user_info_dict["app_id"], user_info_dict["act_id"], 100, 0, page_count_mode='none')
-                                    for price_gear_dict in price_gear_dict_list:
-                                        tiktok_goods_id_list.append(price_gear_dict["goods_id"])
-                                else:
-                                    tiktok_goods_id_list.append(str(goods_id))
-                                pay_order_no_list, redis_init, pay_order_cache_key = self.get_pay_order_no_list(user_info_dict["app_id"], user_info_dict["user_id"])
-                                third_pay_order_list = []
-                                total_buy_num = 0
-                                total_pay_price = 0
-                                for sku_order in order_detail_result["data"]["shop_order_detail"]["sku_order_list"]:
-                                    asset_object_id = ""
-                                    if len(sub_b_type_list) > 0 and sku_order["sub_b_type"] not in sub_b_type_list:
-                                        continue
-                                    if str(sku_order["product_id"]) in tiktok_goods_id_list and sku_order["order_status"] in reward_order_status_list and sku_order["order_id"] not in pay_order_no_list:
-                                        if asset_type == 3:
-                                            now_price_gear_dict = None
-                                            for price_gear_dict in price_gear_dict_list:
-                                                if (price_gear_dict["effective_date"] == '1900-01-01 00:00:00' or TimeHelper.format_time_to_datetime(price_gear_dict["effective_date"]) < TimeHelper.format_time_to_datetime(TimeHelper.timestamp_to_format_time(sku_order["pay_time"]))) and price_gear_dict["goods_id"] == str(sku_order["product_id"]):
-                                                    #关联类型：1商品skuid关联2商品id关联
-                                                    if price_gear_dict["relation_type"] == 1 and price_gear_dict["sku_id"] != str(sku_order["sku_id"]):
-                                                        continue
-                                                    now_price_gear_dict = price_gear_dict
-                                            if not now_price_gear_dict:
-                                                continue
-                                            asset_object_id = now_price_gear_dict["id"]
-                                        else:
-                                            if str(goods_id) != str(sku_order["product_id"]):
-                                                continue
-                                            if sku_id and str(sku_id) != str(sku_order["sku_id"]):
-                                                continue
-                                        third_pay_order = ThirdPayOrder()
-                                        third_pay_order.app_id = user_info_dict["app_id"]
-                                        third_pay_order.act_id = user_info_dict["act_id"]
-                                        third_pay_order.user_id = user_info_dict["user_id"]
-                                        third_pay_order.open_id = open_id
-                                        third_pay_order.user_nick = user_info_dict["user_nick"]
-                                        third_pay_order.goods_code = sku_order["product_id"]
-                                        third_pay_order.goods_name = sku_order["product_name"]
-                                        third_pay_order.order_status = sku_order["order_status"]
-                                        third_pay_order.sku_id = sku_order["sku_id"]
-                                        third_pay_order.sku_name = json.dumps(sku_order["spec"])
-                                        third_pay_order.buy_num = sku_order["item_num"]
-                                        third_pay_order.pay_price = decimal.Decimal(sku_order["pay_amount"] / 100)
-                                        third_pay_order.main_pay_order_no = sku_order["parent_order_id"]
-                                        third_pay_order.sub_pay_order_no = sku_order["order_id"]
-                                        third_pay_order.pay_date = TimeHelper.timestamp_to_format_time(sku_order["pay_time"])
-                                        third_pay_order.asset_type = asset_type
-                                        third_pay_order.asset_object_id = asset_object_id
-                                        third_pay_order.surplus_count = sku_order["item_num"]
-                                        third_pay_order.create_date = SevenHelper.get_now_datetime()
-                                        total_buy_num += int(sku_order["item_num"])
-                                        total_pay_price += decimal.Decimal(sku_order["pay_amount"] / 100)
-                                        third_pay_order_list.append(third_pay_order)
-                                if len(third_pay_order_list) > 0:
-                                    third_pay_order_result = third_pay_order_model.add_list(third_pay_order_list)
-                                    if third_pay_order_result == True and total_buy_num > 0:
-                                        #更新用户表
-                                        user_info_model.update_table("pay_price=pay_price+%s,pay_num=pay_num+%s", "user_id=%s", params=[total_pay_price, total_buy_num, user_info_dict["user_id"]])
-                                        asset_base_model = AssetBaseModel(context=self)
-                                        for item in third_pay_order_list:
-                                            only_id = "shakeshop_" + str(item.sub_pay_order_no)
-                                            asset_invoke_result_data = asset_base_model.update_user_asset(user_info_dict["app_id"], user_info_dict["act_id"], 0, user_info_dict["user_id"], user_info_dict["open_id"], user_info_dict["user_nick"], item.asset_type, item.buy_num, item.asset_object_id, 1, "", "", "抖店购买", only_id, self.__class__.__name__, self.request_code, info_json={})
-                                            if asset_invoke_result_data.success == True:
-                                                redis_init.lpush(pay_order_cache_key, item.sub_pay_order_no)
-                                                redis_init.expire(pay_order_cache_key, 30 * 24 * 3600)
-                                        self.business_process_executed(third_pay_order_list, ref_params={"total_buy_num": total_buy_num, "total_pay_price": total_pay_price, "sku_order_list": order_detail_result["data"]["shop_order_detail"]["sku_order_list"]})
-                    else:
-                        self.logging_link_info("【抖店异步通知结果】" + str(result) + ":" + str(order_detail_result))
-                return self.write({'code': 0, 'msg': 'success'})
-            else:
-                return self.write({'code': 40041, 'message': '解析推送数据失败'})
-        except Exception as ex:
-            self.logging_link_error("【抖店异步通知】" + traceback.format_exc() + ":" + str(result))
-            return self.write({'code': 40041, 'message': '解析推送数据失败'})
-
-    def business_process_executed(self, result_data, ref_params):
-        """
-        :description: 执行后事件
-        :param result_data: result_data
-        :param ref_params: 关联参数
-        :return:
-        :last_editors: HuangJianYi
-        """
-        return result_data
-
-    def get_pay_order_no_list(self,app_id,user_id):
-        """
-        :description: 获取已获取奖励的订单子编号列表
-        :param app_id:应用标识
-        :param user_id:用户标识
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        redis_init = SevenHelper.redis_init()
-        pay_order_cache_key = f"sub_pay_order_no_list:appid_{app_id}_userid_{user_id}"
-        pay_order_no_list = redis_init.lrange(pay_order_cache_key,0,-1)
-        pay_order_list = []
-        is_add = False
-        if not pay_order_no_list or len(pay_order_no_list)<=0:
-            third_pay_order_model = ThirdPayOrderModel(context=self)
-            pay_order_list = third_pay_order_model.get_dict_list("app_id=%s and user_id=%s", field="sub_pay_order_no", params=[app_id, user_id])
-            is_add = True
-        if len(pay_order_list) >0:
-            for item in pay_order_list:
-                pay_order_no_list.append(item["sub_pay_order_no"])
-                if is_add == True:
-                    redis_init.lpush(pay_order_cache_key,item["sub_pay_order_no"])
-                    redis_init.expire(pay_order_cache_key, 30 * 24 * 3600)
-        return pay_order_no_list,redis_init,pay_order_cache_key
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-09-13 16:49:46
+@LastEditTime: 2023-02-10 09:52:14
+@LastEditors: HuangJianYi
+@Description: 
+"""
+from seven_cloudapp_frame.libs.common import *
+from seven_cloudapp_frame.libs.customize.seven_helper import SevenHelper
+from seven_cloudapp_frame.libs.customize.wechat_helper import WeChatPayRequest, WeChatPayReponse, WeChatRefundReponse
+from seven_cloudapp_frame.libs.customize.tiktok_helper import TikTokPayRequest, TikTokReponse
+from seven_cloudapp_frame.libs.customize.alipay_helper import AliPayRequest
+from seven_cloudapp_frame.models.shakeshop_base_model import *
+from seven_cloudapp_frame.models.price_base_model import *
+from seven_cloudapp_frame.models.asset_base_model import *
+from seven_cloudapp_frame.handlers.frame_base import *
+from seven_cloudapp_frame.models.db_models.pay.pay_order_model import *
+from seven_cloudapp_frame.models.db_models.refund.refund_order_model import *
+from seven_cloudapp_frame.models.db_models.third.third_pay_order_model import *
+
+
+class WechatVoucherOrderHandler(ClientBaseHandler):
+    """
+    :description: 创建微信预订单
+    """
+    @filter_check_params("pay_order_no",check_user_code=True)
+    def get_async(self):
+        """
+        :description: 创建微信预订单
+        :param pay_order_no:支付单号
+        :param user_code:用户标识
+        :return: 请求接口获取客户端需要的支付密钥数据
+        :last_editors: HuangJianYi
+        """
+        user_id = self.get_user_id()
+        pay_order_no = self.get_param("pay_order_no")
+        invoke_result_data = InvokeResultData()
+
+        if SevenHelper.is_continue_request(f"WechatVoucherOrderHandler_{str(user_id)}") == True:
+            return self.response_json_error("error", "对不起,请求太频繁")
+        pay_order_model = PayOrderModel(context=self)
+        pay_order = pay_order_model.get_entity("pay_order_no=%s", params=[pay_order_no])
+        if not pay_order or pay_order.order_status != 0:
+            return self.response_json_error("error", "抱歉!未查询到订单信息,请联系客服")
+        pay_config = share_config.get_value("wechat_pay")
+        pay_notify_url = pay_config["pay_notify_url"]
+
+        # 商品说明
+        body = pay_order.order_name
+        # 金额
+        total_fee = pay_order.pay_amount
+        # ip
+        ip = SevenHelper.get_first_ip(self.get_remote_ip())
+
+        try:
+            invoke_result_data = self.business_process_executing()
+            if invoke_result_data.success == False:
+                return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+            pay_notify_url = invoke_result_data.data["pay_notify_url"] if invoke_result_data.data.__contains__("pay_notify_url") else pay_notify_url
+            time_expire = invoke_result_data.data["time_expire"] if invoke_result_data.data.__contains__("time_expire") else str(SevenHelper.get_now_int(hours=1))  #交易结束时间,设置1小时
+            invoke_result_data = WeChatPayRequest().create_order(pay_order_no, body, total_fee, ip, pay_notify_url, pay_order.open_id, time_expire)
+            if invoke_result_data.success == False:
+                return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+
+            # self.logging_link_info('小程序支付返回前端参数:' + str(invoke_result_data.data))
+            ref_params = {}
+            invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+            return self.response_json_success(self.business_process_executed(invoke_result_data.data,ref_params={}))
+        except Exception as ex:
+            self.logging_link_error("【创建微信预订单异常】" + traceback.format_exc())
+            return self.response_json_error("fail", "请重新支付")
+
+
+class WechatPayNotifyHandler(FrameBaseHandler):
+    """
+    :description: 微信支付异步通知
+    """
+    @filter_check_params()
+    def post_async(self):
+        """
+        :description:支付异步通知
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        xml_params = self.request.body.decode('utf-8')
+        wechat_pay_reponse = None
+        try:
+            wechat_pay_reponse = WeChatPayReponse(xml_params)  # 创建对象
+            response_result = wechat_pay_reponse.get_data()
+            return_code = response_result["return_code"]
+            result_code = response_result["result_code"]
+            if return_code == "FAIL":
+                return self.write(wechat_pay_reponse.convert_response_xml(response_result["return_msg"], False))
+            if result_code == "FAIL":
+                return self.write(wechat_pay_reponse.convert_response_xml(response_result["err_code_des"], False))
+            if wechat_pay_reponse.check_sign() != True:  # 校验签名,成功则继续后续操作
+                return self.write(wechat_pay_reponse.convert_response_xml("签名验证失败", False))
+            total_fee = response_result["total_fee"]
+            pay_order_no = response_result["out_trade_no"]
+
+            pay_order_model = PayOrderModel(context=self)
+            pay_order = pay_order_model.get_entity("pay_order_no=%s", params=[pay_order_no])
+            if not pay_order:
+                return self.write(wechat_pay_reponse.convert_response_xml("未查询到订单信息", False))
+            # 判断金额是否匹配
+            if int(decimal.Decimal(str(pay_order.pay_amount)) * 100) != int(total_fee):
+                self.logging_link_error(f"微信支付订单[{pay_order_no}] 金额不匹配疑似刷单.数据库金额:{str(pay_order.pay_amount)} 平台回调金额:{str(total_fee)}")
+                return self.write(wechat_pay_reponse.convert_response_xml("金额异常", False))
+
+            invoke_result_data = self.business_process_executing()
+            if invoke_result_data.success == False:
+                return self.write(wechat_pay_reponse.convert_response_xml(invoke_result_data.error_message, False))
+            ref_params = {}
+            ref_params["pay_order"] = pay_order
+            ref_params["response_result"] = response_result
+            self.business_process_executed(invoke_result_data, ref_params)
+
+            return self.write(wechat_pay_reponse.convert_response_xml("SUCCESS", True))
+
+        except Exception as ex:
+            self.logging_link_error("【微信支付异步通知】" + traceback.format_exc() + ":" + str(xml_params))
+            return self.write(wechat_pay_reponse.convert_response_xml("数据异常", False))
+
+
+    def business_process_executed(self, result_data, ref_params):
+        """
+        :description: 执行后事件
+        :param result_data: result_data
+        :param ref_params: 关联参数
+        :return:
+        :last_editors: HuangJianYi
+        """
+        response_result = ref_params["response_result"]
+        pay_order = ref_params["pay_order"]
+        pay_order_model = PayOrderModel(context=self)
+        transaction_id = response_result["transaction_id"]
+        time_string = response_result["time_end"]
+        if pay_order.order_status == 0:
+            pay_order.out_order_no = transaction_id
+            pay_order.order_status = 1
+            pay_order.pay_date = time.strftime("%Y-%m-%d %H:%M:%S", time.strptime(time_string, "%Y%m%d%H%M%S"))
+            pay_order_model.update_entity(pay_order, "out_order_no,order_status,pay_date")
+
+        return result_data
+
+
+class WechatRefundNotifyHandler(FrameBaseHandler):
+    """
+    :description: 微信退款异步通知
+    """
+    @filter_check_params()
+    def post_async(self):
+        invoke_result_data = InvokeResultData()
+        xml_params = self.request.body.decode('utf-8')
+        wechat_refund_reponse = None
+        try:
+            wechat_refund_reponse = WeChatRefundReponse(xml_params)  # 创建对象
+            response_result = wechat_refund_reponse.get_data()
+            return_code = response_result["return_code"]
+            if return_code == "FAIL":
+                return self.write(wechat_refund_reponse.convert_response_xml(response_result["return_msg"], False))
+            invoke_result_data = self.business_process_executing()
+            if invoke_result_data.success == False:
+                return self.write(wechat_refund_reponse.convert_response_xml(invoke_result_data.error_message, False))
+            # 解密
+            req_info_dict = wechat_refund_reponse.decode_req_info(response_result["req_info"])
+            req_info_dict = req_info_dict["root"]
+            ref_params = {}
+            ref_params["req_info_dict"] = req_info_dict
+            self.business_process_executed(invoke_result_data, ref_params)
+            return self.write(wechat_refund_reponse.convert_response_xml("SUCCESS", True))
+        except Exception as ex:
+            self.logging_link_error("【微信退款异步通知】" + traceback.format_exc() + ":" + str(xml_params))
+            return self.write(wechat_refund_reponse.convert_response_xml("数据异常", False))
+
+
+    def business_process_executed(self, result_data, ref_params):
+        """
+        :description: 执行后事件
+        :param result_data: result_data
+        :param ref_params: 关联参数
+        :return:
+        :last_editors: HuangJianYi
+        """
+        req_info_dict = ref_params["req_info_dict"]
+        db_transaction = DbTransaction(db_config_dict=config.get_value("db_cloudapp"), context=self)
+        pay_order_model = PayOrderModel(db_transaction=db_transaction, context=self)
+        refund_order_model = RefundOrderModel(db_transaction=db_transaction, context=self)
+        try:
+            db_transaction.begin_transaction()
+            if req_info_dict["refund_status"] == "SUCCESS":
+                self.logging_link_info(f'pay_order_no:{str(req_info_dict["out_trade_no"])},微信退款异步通知:' + str(req_info_dict))
+                # 退款成功(相关表处理)
+                refund_order_model.update_table("refund_status=3,out_refund_no=%s,refund_date=%s", where="refund_no=%s", params=[req_info_dict["refund_id"], req_info_dict["success_time"], req_info_dict["out_refund_no"]])
+                pay_order_model.update_table("order_status=20,refund_amount=%s", where="pay_order_no=%s", params=[int(req_info_dict["settlement_refund_fee"]) / 100, req_info_dict["out_trade_no"]])
+            else:
+                # 退款失败(只更新退款表)
+                refund_order_model.update_table("refund_status=4", where="out_refund_no=%s", params=req_info_dict["refund_id"])
+            result,message = db_transaction.commit_transaction(True)
+            if result == False:
+                self.logging_link_error("【微信退款异步通知执行事务失败】" + message)
+        except Exception as ex:
+            db_transaction.rollback_transaction()
+            self.logging_link_error("【微信退款异步通知数据处理异常】" + traceback.format_exc())
+
+        return result_data
+
+
+class TiktokVoucherOrderHandler(ClientBaseHandler):
+    """
+    :description: 创建抖音预订单（直购模式使用，即在抖音小程序直接吊起支付）
+    """
+    @filter_check_params("pay_order_no",check_user_code=True)
+    def get_async(self):
+        """
+        :description: 创建抖音预订单
+        :param pay_order_no:支付单号
+        :param user_code:用户标识
+        :return: 请求接口获取客户端需要的支付密钥数据
+        :last_editors: HuangJianYi
+        """
+        user_id = self.get_user_id()
+        pay_order_no = self.get_param("pay_order_no")
+        invoke_result_data = InvokeResultData()
+
+        if SevenHelper.is_continue_request(f"TiktokVoucherOrderHandler_{str(user_id)}") == True:
+            return self.response_json_error("error", "对不起,请求太频繁")
+        pay_order_model = PayOrderModel(context=self)
+        pay_order = pay_order_model.get_entity("pay_order_no=%s", params=[pay_order_no])
+        if not pay_order or pay_order.order_status != 0:
+            return self.response_json_error("error", "抱歉!未查询到订单信息,请联系客服")
+        pay_config = share_config.get_value("tiktok_pay")
+        pay_notify_url = pay_config["pay_notify_url"]
+        # 商品描述
+        subject = pay_order.order_name
+        # 商品详情
+        body = pay_order.order_desc
+        # 金额
+        total_amount = pay_order.pay_amount
+
+        try:
+            invoke_result_data = self.business_process_executing()
+            if invoke_result_data.success == True:
+                pay_notify_url = invoke_result_data.data["pay_notify_url"] if invoke_result_data.data.__contains__("pay_notify_url") else pay_notify_url
+                time_expire = invoke_result_data.data["time_expire"] if invoke_result_data.data.__contains__("time_expire") else 3600  #交易结束时间,设置1小时,单位秒
+            invoke_result_data = TikTokPayRequest().create_order(pay_order_no=pay_order_no, notify_url=pay_notify_url, total_amount=total_amount, subject=subject, body=body, valid_time=time_expire)
+            if invoke_result_data.success == False:
+                return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+            # self.logging_link_info('小程序支付返回前端参数:' + str(invoke_result_data.data))
+            pay_order_model.update_table("out_order_no=%s", "pay_order_no=%s", params=[invoke_result_data.data["order_id"], pay_order_no])
+            ref_params = {}
+            invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+            return self.response_json_success(invoke_result_data.data)
+        except Exception as ex:
+            self.logging_link_error("【创建抖音预订单异常】" + traceback.format_exc())
+            return self.response_json_error("fail", "请重新支付")
+
+
+class TiktokPayNotifyHandler(FrameBaseHandler):
+    """
+    :description: 抖音支付异步通知（直购模式使用，即在抖音小程序直接吊起支付）
+    """
+    @filter_check_params()
+    def post_async(self):
+        """
+        :description:抖音支付异步通知
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        json_params = self.request.body.decode('utf-8')
+        tiktok_reponse = None
+        try:
+            tiktok_reponse = TikTokReponse(json_params)
+            response_result = tiktok_reponse.get_data()
+            if tiktok_reponse.check_sign() != True:  # 校验签名,成功则继续后续操作
+                return self.write(tiktok_reponse.convert_response_json(-1, "签名验证失败"))
+            if response_result["type"] != "payment":
+                return self.write(tiktok_reponse.convert_response_json(-1, "回调类型标记错误"))
+            response_data = SevenHelper.json_loads(response_result["msg"])
+            total_fee = response_data["total_amount"] if response_data.__contains__("total_amount") else 0
+            pay_order_no = response_data["cp_orderno"]
+            pay_order_model = PayOrderModel(context=self)
+            pay_order = pay_order_model.get_entity("pay_order_no=%s", params=[pay_order_no])
+            if not pay_order:
+                return self.write(tiktok_reponse.convert_response_json(-1, "未查询到支付订单信息"))
+            # 判断金额是否匹配
+            if int(decimal.Decimal(str(pay_order.pay_amount)) * 100) != int(total_fee):
+                self.logging_link_error(f"抖音支付订单[{pay_order_no}] 金额不匹配疑似刷单.数据库金额:{str(pay_order.pay_amount)} 平台回调金额:{str(total_fee)}")
+                return self.write(tiktok_reponse.convert_response_json(-1, "金额异常"))
+
+            invoke_result_data = self.business_process_executing()
+            if invoke_result_data.success == False:
+                return self.write(tiktok_reponse.convert_response_json(-1, invoke_result_data.error_message))
+
+            ref_params = {}
+            ref_params["pay_order"] = pay_order
+            ref_params["response_data"] = response_data
+            self.business_process_executed(invoke_result_data, ref_params)
+
+            return self.write(tiktok_reponse.convert_response_json())
+
+        except Exception as ex:
+            self.logging_link_error("【抖音支付异步通知】" + traceback.format_exc() + ":" + str(json_params))
+            return self.write(tiktok_reponse.convert_response_json(-1, "数据异常"))
+
+
+    def business_process_executed(self, result_data, ref_params):
+        """
+        :description: 执行后事件
+        :param result_data: result_data
+        :param ref_params: 关联参数
+        :return:
+        :last_editors: HuangJianYi
+        """
+        pay_order = ref_params["pay_order"]
+        pay_order_model = PayOrderModel(context=self)
+        if pay_order.order_status == 0 or pay_order.order_status == 2:
+            pay_time = SevenHelper.get_now_datetime()
+            order_id = ""
+            tiktok_pay_request = TikTokPayRequest()
+            query_invoke_result_data = tiktok_pay_request.query_order(pay_order.pay_order_no)
+            if query_invoke_result_data.success == True:
+                pay_time = query_invoke_result_data.data["payment_info"]["pay_time"]
+                order_id = query_invoke_result_data.data["order_id"]
+            pay_order.order_status = 1
+            pay_order.pay_date = pay_time
+            pay_order.out_order_no = order_id if order_id else pay_order.out_order_no
+            pay_order_model.update_entity(pay_order, "out_order_no,order_status,pay_date")
+
+        return result_data
+
+
+class TiktokRefundNotifyHandler(FrameBaseHandler):
+    """
+    :description: 抖音退款异步通知（直购模式使用，即在抖音小程序直接吊起支付）
+    """
+    @filter_check_params()
+    def post_async(self):
+        invoke_result_data = InvokeResultData()
+        json_params = self.request.body.decode('utf-8')
+        tiktok_reponse = None
+        try:
+            tiktok_reponse = TikTokReponse(json_params)
+            response_result = tiktok_reponse.get_data()
+            if tiktok_reponse.check_sign() != True:  # 校验签名,成功则继续后续操作
+                return self.write(tiktok_reponse.convert_response_json(-1, "签名验证失败"))
+            if response_result["type"] != "refund":
+                return self.write(tiktok_reponse.convert_response_json(-1, "回调类型标记错误"))
+            response_data = SevenHelper.json_loads(response_result["msg"])
+            cp_refundno = response_data["cp_refundno"]
+            refund_order_model = RefundOrderModel(context=self)
+            refund_order = refund_order_model.get_entity("refund_no=%s", params=[cp_refundno])
+            if not refund_order:
+                return self.write(tiktok_reponse.convert_response_json(-1, "未查询到退款订单信息"))
+            invoke_result_data = self.business_process_executing()
+            if invoke_result_data.success == False:
+                return self.write(tiktok_reponse.convert_response_json(-1, invoke_result_data.error_message))
+            ref_params = {}
+            ref_params["refund_order"] = refund_order
+            ref_params["response_data"] = response_data
+            self.business_process_executed(invoke_result_data, ref_params)
+
+            return self.write(tiktok_reponse.convert_response_json())
+
+        except Exception as ex:
+            self.logging_link_error("【抖音退款异步通知】" + traceback.format_exc() + ":" + str(json_params))
+            return self.write(tiktok_reponse.convert_response_json(-1, "数据异常"))
+
+
+    def business_process_executed(self, result_data, ref_params):
+        """
+        :description: 执行后事件
+        :param result_data: result_data
+        :param ref_params: 关联参数
+        :return:
+        :last_editors: HuangJianYi
+        """
+        refund_order = ref_params["refund_order"]
+        response_data = ref_params["response_data"]
+        db_transaction = DbTransaction(db_config_dict=config.get_value("db_cloudapp"), context=self)
+        pay_order_model = PayOrderModel(db_transaction=db_transaction, context=self)
+        refund_order_model = RefundOrderModel(db_transaction=db_transaction, context=self)
+        try:
+            db_transaction.begin_transaction()
+            if response_data["status"] == "SUCCESS":
+                self.logging_link_info(f'refund_no:{str(response_data["cp_refundno"])},抖音退款异步通知:' + str(response_data))
+                # 退款成功(相关表处理)
+                refund_order_model.update_table("refund_status=3,refund_date=%s", where="refund_no=%s", params=[SevenHelper.get_now_datetime(), response_data["cp_refundno"]])
+                pay_order_model.update_table("order_status=20,refund_amount=%s", where="pay_order_no=%s", params=[int(response_data["refund_amount"]) / 100, refund_order.pay_order_no])
+            else:
+                # 退款失败(只更新退款表)
+                refund_order_model.update_table("refund_status=4", where="refund_no=%s", params=[response_data["cp_refundno"]])
+            result,message = db_transaction.commit_transaction(True)
+            if result == False:
+                self.logging_link_error("【抖音退款异步通知执行事务失败】" + message)
+        except Exception as ex:
+            db_transaction.rollback_transaction()
+            self.logging_link_error("【抖音退款异步通知数据处理异常】" + traceback.format_exc())
+        return result_data
+
+
+class ShakeshopNotifyHandler(FrameBaseHandler):
+    """
+    :description: 抖店异步通知（读取抖店订单模式使用，即跳到抖店购买商品）
+    """
+    def post_async(self):
+        """
+        :description:抖店异步通知
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        result = None
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        asset_type = invoke_result_data.data["asset_type"] if invoke_result_data.data.__contains__("asset_type") else 3  #资产类型，默认价格档位，
+        goods_id = invoke_result_data.data["goods_id"] if invoke_result_data.data.__contains__("goods_id") else ""  #商品id，当资产类型为价格档位，可不填
+        sku_id = invoke_result_data.data["sku_id"] if invoke_result_data.data.__contains__("sku_id") else ""  #skuid，当资产类型为价格档位，可不填
+        reward_order_status_list = invoke_result_data.data["reward_order_status_list"] if invoke_result_data.data.__contains__("reward_order_status_list") else [2]  #订单奖励类型，默认2已支付
+        sub_b_type_list = invoke_result_data.data["sub_b_type_list"] if invoke_result_data.data.__contains__("sub_b_type_list") else [] #下单场景，默认全部
+        try:
+            third_pay_order_model = ThirdPayOrderModel(context=self)
+            shop_id = share_config.get_value("shake_shop")["shop_id"]
+            app_key = share_config.get_value("shake_shop")["app_key"]
+            app_secret = share_config.get_value("shake_shop")["app_secret"]
+            shakeshop_base_model = ShakeShopBaseModel(self, app_key, app_secret, "SELF", None, shop_id)
+            result = shakeshop_base_model.callback(self.request.headers, self.request.body, is_log=False)
+            if result:
+                result = result[0]
+                result["data"] = json.loads(result["data"])
+                if str(result["data"]["shop_id"]) != str(shop_id):
+                    return self.write({'code': 0, 'msg': 'success'})
+                tag = result.get('tag')
+                if tag == '0':  # 抖店推送服务验证消息，需立即返回success
+                    return self.write({'code': 0, 'msg': 'success'})
+                if tag == '101':  # 订单支付成功，根据推送的消息参数进行必要的业务处理，5秒内返回success
+                    params = {}
+                    params["shop_order_id"] = result["data"]["p_id"] #店铺订单编号
+                    order_detail_result = shakeshop_base_model.request(path="/order/orderDetail", params=params, is_log=False)
+                    if order_detail_result and order_detail_result["code"] == 10000:
+                        open_id = order_detail_result["data"]["shop_order_detail"]["open_id"]
+                        act_info_model = ActInfoModel(context=self)
+                        act_info_dict = act_info_model.get_cache_dict(order_by="id desc")
+                        if act_info_dict:
+                            frame_base_model = FrameBaseModel(context=self)
+                            user_info_model = UserInfoModel(sub_table=frame_base_model.get_business_sub_table("user_info_tb", {"app_id": act_info_dict["app_id"]}), context=self)
+                            user_info_dict = user_info_model.get_cache_dict("act_id=%s and open_id=%s", limit="1", order_by="id desc", params=[act_info_dict["id"],open_id])
+                            if user_info_dict:
+                                tiktok_goods_id_list = []
+                                if asset_type == 3:
+                                    price_base_model = PriceBaseModel(context=self)
+                                    price_gear_dict_list = price_base_model.get_price_gear_list(user_info_dict["app_id"], user_info_dict["act_id"], 100, 0, page_count_mode='none')
+                                    for price_gear_dict in price_gear_dict_list:
+                                        tiktok_goods_id_list.append(price_gear_dict["goods_id"])
+                                else:
+                                    tiktok_goods_id_list.append(str(goods_id))
+                                pay_order_no_list, redis_init, pay_order_cache_key = self.get_pay_order_no_list(user_info_dict["app_id"], user_info_dict["user_id"])
+                                third_pay_order_list = []
+                                total_buy_num = 0
+                                total_pay_price = 0
+                                for sku_order in order_detail_result["data"]["shop_order_detail"]["sku_order_list"]:
+                                    asset_object_id = ""
+                                    if len(sub_b_type_list) > 0 and sku_order["sub_b_type"] not in sub_b_type_list:
+                                        continue
+                                    if str(sku_order["product_id"]) in tiktok_goods_id_list and sku_order["order_status"] in reward_order_status_list and sku_order["order_id"] not in pay_order_no_list:
+                                        if asset_type == 3:
+                                            now_price_gear_dict = None
+                                            for price_gear_dict in price_gear_dict_list:
+                                                if (price_gear_dict["effective_date"] == '1900-01-01 00:00:00' or TimeHelper.format_time_to_datetime(price_gear_dict["effective_date"]) < TimeHelper.format_time_to_datetime(TimeHelper.timestamp_to_format_time(sku_order["pay_time"]))) and price_gear_dict["goods_id"] == str(sku_order["product_id"]):
+                                                    #关联类型：1商品skuid关联2商品id关联
+                                                    if price_gear_dict["relation_type"] == 1 and price_gear_dict["sku_id"] != str(sku_order["sku_id"]):
+                                                        continue
+                                                    now_price_gear_dict = price_gear_dict
+                                            if not now_price_gear_dict:
+                                                continue
+                                            asset_object_id = now_price_gear_dict["id"]
+                                        else:
+                                            if str(goods_id) != str(sku_order["product_id"]):
+                                                continue
+                                            if sku_id and str(sku_id) != str(sku_order["sku_id"]):
+                                                continue
+                                        third_pay_order = ThirdPayOrder()
+                                        third_pay_order.app_id = user_info_dict["app_id"]
+                                        third_pay_order.act_id = user_info_dict["act_id"]
+                                        third_pay_order.user_id = user_info_dict["user_id"]
+                                        third_pay_order.open_id = open_id
+                                        third_pay_order.user_nick = user_info_dict["user_nick"]
+                                        third_pay_order.goods_code = sku_order["product_id"]
+                                        third_pay_order.goods_name = sku_order["product_name"]
+                                        third_pay_order.order_status = sku_order["order_status"]
+                                        third_pay_order.sku_id = sku_order["sku_id"]
+                                        third_pay_order.sku_name = json.dumps(sku_order["spec"])
+                                        third_pay_order.buy_num = sku_order["item_num"]
+                                        third_pay_order.pay_price = decimal.Decimal(sku_order["pay_amount"] / 100)
+                                        third_pay_order.main_pay_order_no = sku_order["parent_order_id"]
+                                        third_pay_order.sub_pay_order_no = sku_order["order_id"]
+                                        third_pay_order.pay_date = TimeHelper.timestamp_to_format_time(sku_order["pay_time"])
+                                        third_pay_order.asset_type = asset_type
+                                        third_pay_order.asset_object_id = asset_object_id
+                                        third_pay_order.surplus_count = sku_order["item_num"]
+                                        third_pay_order.create_date = SevenHelper.get_now_datetime()
+                                        total_buy_num += int(sku_order["item_num"])
+                                        total_pay_price += decimal.Decimal(sku_order["pay_amount"] / 100)
+                                        third_pay_order_list.append(third_pay_order)
+                                if len(third_pay_order_list) > 0:
+                                    third_pay_order_result = third_pay_order_model.add_list(third_pay_order_list)
+                                    if third_pay_order_result == True and total_buy_num > 0:
+                                        #更新用户表
+                                        user_info_model.update_table("pay_price=pay_price+%s,pay_num=pay_num+%s", "user_id=%s", params=[total_pay_price, total_buy_num, user_info_dict["user_id"]])
+                                        asset_base_model = AssetBaseModel(context=self)
+                                        for item in third_pay_order_list:
+                                            only_id = "shakeshop_" + str(item.sub_pay_order_no)
+                                            asset_invoke_result_data = asset_base_model.update_user_asset(user_info_dict["app_id"], user_info_dict["act_id"], 0, user_info_dict["user_id"], user_info_dict["open_id"], user_info_dict["user_nick"], item.asset_type, item.buy_num, item.asset_object_id, 1, "", "", "抖店购买", only_id, self.__class__.__name__, self.request_code, info_json={})
+                                            if asset_invoke_result_data.success == True:
+                                                redis_init.lpush(pay_order_cache_key, item.sub_pay_order_no)
+                                                redis_init.expire(pay_order_cache_key, 30 * 24 * 3600)
+                                        self.business_process_executed(third_pay_order_list, ref_params={"total_buy_num": total_buy_num, "total_pay_price": total_pay_price, "sku_order_list": order_detail_result["data"]["shop_order_detail"]["sku_order_list"]})
+                    else:
+                        self.logging_link_info("【抖店异步通知结果】" + str(result) + ":" + str(order_detail_result))
+                return self.write({'code': 0, 'msg': 'success'})
+            else:
+                return self.write({'code': 40041, 'message': '解析推送数据失败'})
+        except Exception as ex:
+            self.logging_link_error("【抖店异步通知】" + traceback.format_exc() + ":" + str(result))
+            return self.write({'code': 40041, 'message': '解析推送数据失败'})
+
+    def business_process_executed(self, result_data, ref_params):
+        """
+        :description: 执行后事件
+        :param result_data: result_data
+        :param ref_params: 关联参数
+        :return:
+        :last_editors: HuangJianYi
+        """
+        return result_data
+
+    def get_pay_order_no_list(self,app_id,user_id):
+        """
+        :description: 获取已获取奖励的订单子编号列表
+        :param app_id:应用标识
+        :param user_id:用户标识
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        redis_init = SevenHelper.redis_init()
+        pay_order_cache_key = f"sub_pay_order_no_list:appid_{app_id}_userid_{user_id}"
+        pay_order_no_list = redis_init.lrange(pay_order_cache_key,0,-1)
+        pay_order_list = []
+        is_add = False
+        if not pay_order_no_list or len(pay_order_no_list)<=0:
+            third_pay_order_model = ThirdPayOrderModel(context=self)
+            pay_order_list = third_pay_order_model.get_dict_list("app_id=%s and user_id=%s", field="sub_pay_order_no", params=[app_id, user_id])
+            is_add = True
+        if len(pay_order_list) >0:
+            for item in pay_order_list:
+                pay_order_no_list.append(item["sub_pay_order_no"])
+                if is_add == True:
+                    redis_init.lpush(pay_order_cache_key,item["sub_pay_order_no"])
+                    redis_init.expire(pay_order_cache_key, 30 * 24 * 3600)
+        return pay_order_no_list,redis_init,pay_order_cache_key
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/handlers/client/stat.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/handlers/client/stat.py`

 * *Ordering differences only*

 * *Files 12% similar despite different names*

```diff
@@ -1,118 +1,118 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-09-10 11:29:31
-@LastEditTime: 2023-04-11 15:19:25
-@LastEditors: HuangJianYi
-@Description: 处理数据统计上报
-"""
-from seven_cloudapp_frame.handlers.frame_base import *
-from seven_cloudapp_frame.models.stat_base_model import *
-
-
-
-class StatReportHandler(ClientBaseHandler):
-    """
-    :description: 统计上报
-    """
-    @filter_check_params(check_user_code=True)
-    def post_async(self):
-        """
-        :description: 统计上报
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param object_id:对象标识
-        :param user_code:用户标识
-        :param open_id:open_id
-        :param data:统计数据json 格式：[{"key":"key1","value":1},{"key":"key2","value":1},{"key":"key3","value":1}] 或 {"key1":1,"key2":1,"key3":1}
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        user_id = self.get_user_id()
-        open_id = self.get_param("open_id")
-        module_id = self.get_param_int("module_id", 0)
-        object_id = self.get_param("object_id")
-        stat_data = self.get_param("data",[])
-        if stat_data:
-            stat_data = self.json_loads(stat_data)
-        stat_base_model = StatBaseModel(context=self)
-        stat_base_model.add_stat_list(app_id, act_id, module_id, user_id, open_id, stat_data, object_id=object_id)
-        return self.response_json_success()
-
-
-class ShareReportHandler(ClientBaseHandler):
-    """
-    :description: 处理分享统计上报
-    """
-    @filter_check_params(check_user_code=True)
-    def get_async(self):
-        """
-        :description: 处理分享统计上报
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_code:用户标识
-        :param login_token:访问令牌
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        user_id = self.get_user_id()
-        open_id = self.get_param("open_id")
-        module_id = self.get_param_int("module_id", 0)
-        stat_base_model = StatBaseModel(context=self)
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        if not invoke_result_data.data:
-            invoke_result_data.data = {}
-        invoke_result_data = stat_base_model.process_share_report(app_id, act_id, module_id, user_id, open_id)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        ref_params = {}
-        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success()
-
-
-class InviteReportHandler(ClientBaseHandler):
-    """
-    :description: 处理邀请进入统计上报
-    """
-    @filter_check_params(check_user_code=True)
-    def get_async(self):
-        """
-        :description: 处理邀请进入统计上报
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_code:用户标识
-        :param invite_user_id:邀请人用户标识
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        user_id = self.get_user_id()
-        from_user_id = int(self.get_param("invite_user_id", 0))
-        open_id = self.get_param("open_id")
-        module_id = int(self.get_param("module_id", 0))
-        stat_base_model = StatBaseModel(context=self)
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        if not invoke_result_data.data:
-            invoke_result_data.data = {}
-        invoke_result_data = stat_base_model.process_invite_report(app_id, act_id, module_id, user_id, open_id, from_user_id)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        ref_params = {}
-        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success()
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-09-10 11:29:31
+@LastEditTime: 2023-04-11 15:19:25
+@LastEditors: HuangJianYi
+@Description: 处理数据统计上报
+"""
+from seven_cloudapp_frame.handlers.frame_base import *
+from seven_cloudapp_frame.models.stat_base_model import *
+
+
+
+class StatReportHandler(ClientBaseHandler):
+    """
+    :description: 统计上报
+    """
+    @filter_check_params(check_user_code=True)
+    def post_async(self):
+        """
+        :description: 统计上报
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param object_id:对象标识
+        :param user_code:用户标识
+        :param open_id:open_id
+        :param data:统计数据json 格式：[{"key":"key1","value":1},{"key":"key2","value":1},{"key":"key3","value":1}] 或 {"key1":1,"key2":1,"key3":1}
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        open_id = self.get_param("open_id")
+        module_id = self.get_param_int("module_id", 0)
+        object_id = self.get_param("object_id")
+        stat_data = self.get_param("data",[])
+        if stat_data:
+            stat_data = self.json_loads(stat_data)
+        stat_base_model = StatBaseModel(context=self)
+        stat_base_model.add_stat_list(app_id, act_id, module_id, user_id, open_id, stat_data, object_id=object_id)
+        return self.response_json_success()
+
+
+class ShareReportHandler(ClientBaseHandler):
+    """
+    :description: 处理分享统计上报
+    """
+    @filter_check_params(check_user_code=True)
+    def get_async(self):
+        """
+        :description: 处理分享统计上报
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param user_code:用户标识
+        :param login_token:访问令牌
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        open_id = self.get_param("open_id")
+        module_id = self.get_param_int("module_id", 0)
+        stat_base_model = StatBaseModel(context=self)
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        invoke_result_data = stat_base_model.process_share_report(app_id, act_id, module_id, user_id, open_id)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success()
+
+
+class InviteReportHandler(ClientBaseHandler):
+    """
+    :description: 处理邀请进入统计上报
+    """
+    @filter_check_params(check_user_code=True)
+    def get_async(self):
+        """
+        :description: 处理邀请进入统计上报
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param user_code:用户标识
+        :param invite_user_id:邀请人用户标识
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        from_user_id = int(self.get_param("invite_user_id", 0))
+        open_id = self.get_param("open_id")
+        module_id = int(self.get_param("module_id", 0))
+        stat_base_model = StatBaseModel(context=self)
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        invoke_result_data = stat_base_model.process_invite_report(app_id, act_id, module_id, user_id, open_id, from_user_id)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success()
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/handlers/client/task.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/handlers/client/task.py`

 * *Ordering differences only*

 * *Files 8% similar despite different names*

```diff
@@ -1,974 +1,974 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-08-17 11:19:05
-@LastEditTime: 2023-07-07 10:25:27
-@LastEditors: HuangJianYi
-@Description: 
-"""
-from seven_cloudapp_frame.handlers.frame_base import *
-from seven_cloudapp_frame.models.task_base_model import *
-
-
-class TaskInfoListHandler(ClientBaseHandler):
-    """
-    :description: 获取任务列表
-    """
-    @filter_check_params(check_user_code=True)
-    def get_async(self):
-        """
-        :description: 获取任务列表
-        :param act_id：活动标识
-        :param module_id：活动模块标识
-        :param user_code：用户标识
-        :param task_types:任务类型 多个逗号,分隔
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        user_id = self.get_user_id()
-        mix_nick = self.get_param("mix_nick")
-        module_id = self.get_param_int("module_id")
-        task_types = self.get_param("task_types")
-        is_log = self.get_param_int("is_log", 0)
-        is_log = True if is_log == 1 else False
-        task_base_model = TaskBaseModel(context=self)
-        app_key, app_secret = self.get_app_key_secret()
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        if not invoke_result_data.data:
-            invoke_result_data.data = {}
-        daily_repeat_browse = invoke_result_data.data["daily_repeat_browse"] if invoke_result_data.data.__contains__("daily_repeat_browse") else False
-        ver_no = invoke_result_data.data["ver_no"] if invoke_result_data.data.__contains__("ver_no") else '1'
-        if ver_no == "1":
-            result_list,task_info_list,task_count_list = task_base_model.get_client_task_list(app_id, act_id, module_id, user_id, task_types, app_key, app_secret, is_log, daily_repeat_browse, mix_nick)
-        else:
-            result_list,task_info_list,task_count_list = task_base_model.get_client_task_list_v2(app_id, act_id, module_id, user_id, task_types, daily_repeat_browse)
-        ref_params = {}
-        ref_params["task_info_list"] = task_info_list
-        ref_params["task_count_list"] = task_count_list
-        return self.response_json_success(self.business_process_executed(result_list, ref_params))
-
-
-class ReceiveRewardHandler(ClientBaseHandler):
-    """
-    :description: 处理领取任务奖励
-    """
-    @filter_check_params("login_token", check_user_code=True)
-    def get_async(self):
-        """
-        :description: 处理领取任务奖励
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_code:用户标识
-        :param login_token:访问令牌
-        :param task_id:任务标识
-        :param task_sub_type:子任务类型
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        user_id = self.get_user_id()
-        module_id = self.get_param_int("module_id")
-        login_token = self.get_param("login_token")
-        task_id = self.get_param_int("task_id")
-        task_type = self.get_param_int("task_type")
-        task_sub_type = str(self.get_param("task_sub_type"))
-        task_base_model = TaskBaseModel(context=self)
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        if not invoke_result_data.data:
-            invoke_result_data.data = {}
-        check_new_user = invoke_result_data.data["check_new_user"] if invoke_result_data.data.__contains__("check_new_user") else False
-        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
-        check_act_info_release = invoke_result_data.data["check_act_info_release"] if invoke_result_data.data.__contains__("check_act_info_release") else True
-        check_act_module_release = invoke_result_data.data["check_act_module_release"] if invoke_result_data.data.__contains__("check_act_module_release") else True
-        is_stat = invoke_result_data.data["is_stat"] if invoke_result_data.data.__contains__("is_stat") else True
-        info_json = invoke_result_data.data["info_json"] if invoke_result_data.data.__contains__("info_json") else None
-        invoke_result_data = task_base_model.process_receive_reward(app_id, act_id, module_id, user_id, login_token, task_id, task_sub_type, self.__class__.__name__, self.request_code, task_type, check_new_user, check_user_nick, 5, is_stat, info_json, check_act_info_release=check_act_info_release, check_act_module_release=check_act_module_release)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        ref_params = {}
-        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success(invoke_result_data.data["reward_value"])
-
-
-class FreeGiftHandler(ClientBaseHandler):
-    """
-    :description: 处理掌柜有礼、新人有礼、免费领取等相似任务
-    """
-    @filter_check_params("login_token", check_user_code=True)
-    def get_async(self):
-        """
-        :description: 处理掌柜有礼、新人有礼、免费领取等相似任务
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_code:用户标识
-        :param login_token:访问令牌
-        :return: 直接发放奖励，返回奖励值
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        user_id = self.get_user_id()
-        module_id = self.get_param_int("module_id")
-        login_token = self.get_param("login_token")
-
-        task_base_model = TaskBaseModel(context=self)
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        if not invoke_result_data.data:
-            invoke_result_data.data = {}
-
-        check_new_user = invoke_result_data.data["check_new_user"] if invoke_result_data.data.__contains__("check_new_user") else True
-        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
-        is_stat = invoke_result_data.data["is_stat"] if invoke_result_data.data.__contains__("is_stat") else True
-        info_json = invoke_result_data.data["info_json"] if invoke_result_data.data.__contains__("info_json") else None
-        invoke_result_data = task_base_model.process_free_gift(app_id, act_id, module_id, user_id, login_token, self.__class__.__name__, self.request_code, check_new_user, check_user_nick, 5, is_stat, info_json)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        ref_params = {}
-        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success(invoke_result_data.data["reward_value"])
-
-
-class OneSignHandler(ClientBaseHandler):
-    """
-    :description: 处理单次签到任务
-    """
-    @filter_check_params("login_token", check_user_code=True)
-    def get_async(self):
-        """
-        :description: 处理单次签到任务
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_code:用户标识
-        :param login_token:访问令牌
-        :return: 直接发放奖励，返回奖励值
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        user_id = self.get_user_id()
-        module_id = self.get_param_int("module_id")
-        login_token = self.get_param("login_token")
-        task_base_model = TaskBaseModel(context=self)
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        if not invoke_result_data.data:
-            invoke_result_data.data = {}
-
-        check_new_user = invoke_result_data.data["check_new_user"] if invoke_result_data.data.__contains__("check_new_user") else False
-        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
-        is_stat = invoke_result_data.data["is_stat"] if invoke_result_data.data.__contains__("is_stat") else True
-        info_json = invoke_result_data.data["info_json"] if invoke_result_data.data.__contains__("info_json") else {}
-        invoke_result_data = task_base_model.process_one_sign(app_id, act_id, module_id, user_id, login_token, self.__class__.__name__, self.request_code, check_new_user, check_user_nick, 5, is_stat, info_json)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        ref_params = {}
-        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success(invoke_result_data.data["reward_value"])
-
-
-class WeeklySignHandler(ClientBaseHandler):
-    """
-    :description: 处理每周签到任务
-    """
-    @filter_check_params("login_token", check_user_code=True)
-    def get_async(self):
-        """
-        :description: 处理每周签到任务
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_code:用户标识
-        :param login_token:访问令牌
-        :return: 直接发放奖励，返回奖励值
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        user_id = self.get_user_id()
-        module_id = self.get_param_int("module_id")
-        login_token = self.get_param("login_token")
-        task_base_model = TaskBaseModel(context=self)
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        if not invoke_result_data.data:
-            invoke_result_data.data = {}
-        check_new_user = invoke_result_data.data["check_new_user"] if invoke_result_data.data.__contains__("check_new_user") else False
-        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
-        check_act_info_release = invoke_result_data.data["check_act_info_release"] if invoke_result_data.data.__contains__("check_act_info_release") else True
-        check_act_module_release = invoke_result_data.data["check_act_module_release"] if invoke_result_data.data.__contains__("check_act_module_release") else True
-        is_stat = invoke_result_data.data["is_stat"] if invoke_result_data.data.__contains__("is_stat") else True
-        info_json = invoke_result_data.data["info_json"] if invoke_result_data.data.__contains__("info_json") else None
-        invoke_result_data = task_base_model.process_weekly_sign(app_id, act_id, module_id, user_id, login_token, self.__class__.__name__, self.request_code, check_new_user, check_user_nick, 5, is_stat, info_json, check_act_info_release=check_act_info_release, check_act_module_release=check_act_module_release)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        ref_params = {}
-        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success(invoke_result_data.data["reward_value"])
-
-
-class CumulativeSignHandler(ClientBaseHandler):
-    """
-    :description: 处理累计签到任务
-    """
-    @filter_check_params("login_token",check_user_code=True)
-    def get_async(self):
-        """
-        :description: 处理累计签到任务
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_code:用户标识
-        :param login_token:访问令牌
-        :return: 直接发放奖励，返回奖励值
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        user_id = self.get_user_id()
-        module_id = self.get_param_int("module_id")
-        login_token = self.get_param("login_token")
-        task_base_model = TaskBaseModel(context=self)
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        if not invoke_result_data.data:
-            invoke_result_data.data = {}
-        check_new_user = invoke_result_data.data["check_new_user"] if invoke_result_data.data.__contains__("check_new_user") else False
-        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
-        is_stat = invoke_result_data.data["is_stat"] if invoke_result_data.data.__contains__("is_stat") else True
-        info_json = invoke_result_data.data["info_json"] if invoke_result_data.data.__contains__("info_json") else None
-        task_type = invoke_result_data.data["task_type"] if invoke_result_data.data.__contains__("task_type") else 0
-        invoke_result_data = task_base_model.process_cumulative_sign(app_id, act_id, module_id, user_id, login_token, self.__class__.__name__, self.request_code, check_new_user, check_user_nick, 5, is_stat, info_json, task_type)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        ref_params = {}
-        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success(invoke_result_data.data["reward_value"])
-
-
-class SuccessiveSignHandler(ClientBaseHandler):
-    """
-    :description: 处理连续签到任务（天数是连续递增）
-    """
-    @filter_check_params("login_token",check_user_code=True)
-    def get_async(self):
-        """
-        :description: 处理连续签到任务（天数是连续递增）
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_code:用户标识
-        :param login_token:访问令牌
-        :return: 直接发放奖励，返回奖励值
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        user_id = self.get_user_id()
-        module_id = self.get_param_int("module_id")
-        login_token = self.get_param("login_token")
-        task_base_model = TaskBaseModel(context=self)
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        if not invoke_result_data.data:
-            invoke_result_data.data = {}
-        check_new_user = invoke_result_data.data["check_new_user"] if invoke_result_data.data.__contains__("check_new_user") else False
-        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
-        is_stat = invoke_result_data.data["is_stat"] if invoke_result_data.data.__contains__("is_stat") else True
-        info_json = invoke_result_data.data["info_json"] if invoke_result_data.data.__contains__("info_json") else None
-        task_type = TaskType.successive_sign.value
-        invoke_result_data = task_base_model.process_cumulative_sign(app_id, act_id, module_id, user_id, login_token, self.__class__.__name__, self.request_code, check_new_user, check_user_nick, 5, is_stat, info_json, task_type)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        ref_params = {}
-        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success(invoke_result_data.data["reward_value"])
-
-
-class InviteNewUserHandler(ClientBaseHandler):
-    """
-    :description: 处理邀请用户任务(被邀请人进入调用)
-    """
-    @filter_check_params("invite_user_id,login_token", check_user_code=True)
-    def get_async(self):
-        """
-        :description: 处理邀请用户任务(被邀请人进入调用)
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_code:用户标识
-        :param invite_user_id:邀请人用户标识
-        :param login_token:访问令牌
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        user_id = self.get_user_id()
-        module_id = self.get_param_int("module_id")
-        task_type = TaskType.invite_new_user.value
-        login_token = self.get_param("login_token")
-        from_user_id = int(self.get_param("invite_user_id", 0))
-        task_base_model = TaskBaseModel(context=self)
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        if not invoke_result_data.data:
-            invoke_result_data.data = {}
-        check_new_user = invoke_result_data.data["check_new_user"] if invoke_result_data.data.__contains__("check_new_user") else True
-        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
-        check_act_info_release = invoke_result_data.data["check_act_info_release"] if invoke_result_data.data.__contains__("check_act_info_release") else True
-        check_act_module_release = invoke_result_data.data["check_act_module_release"] if invoke_result_data.data.__contains__("check_act_module_release") else True
-        close_invite_limit = invoke_result_data.data["close_invite_limit"] if invoke_result_data.data.__contains__("close_invite_limit") else False #是否关闭邀请限制
-        is_stat = invoke_result_data.data["is_stat"] if invoke_result_data.data.__contains__("is_stat") else False #是否统计
-        is_receive_reward = invoke_result_data.data["is_receive_reward"] if invoke_result_data.data.__contains__("is_receive_reward") else False #是否直接领取奖励
-        response_data_type = invoke_result_data.data["response_data_type"] if invoke_result_data.data.__contains__("response_data_type") else 2  #输出值类型（1-对象 2-奖励值）
-        info_json = invoke_result_data.data["info_json"] if invoke_result_data.data.__contains__("info_json") else None
-
-        stat_base_model = StatBaseModel(context=self)
-        if is_stat == True:
-            stat_base_model.add_stat_list(app_id, act_id, module_id, user_id, "", {"BeInvitedUserCount": 1, "BeInvitedCount": 1})
-
-        invoke_result_data = task_base_model.process_invite_user(app_id, act_id, module_id, user_id, login_token, from_user_id, self.__class__.__name__, check_user_nick, check_new_user, 5, close_invite_limit, check_act_info_release=check_act_info_release, check_act_module_release=check_act_module_release)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        if is_stat == True:
-            stat_base_model.add_stat_list(app_id, act_id, module_id, user_id, "", {"AddBeInvitedUserCount": 1})
-        invoke_result_data.data = invoke_result_data.data if invoke_result_data.data else {}
-        invoke_result_data.data["reward_value"] = 0
-        if is_receive_reward == True:
-            reward_invoke_result_data = task_base_model.process_receive_reward(app_id=app_id, act_id=act_id, module_id=module_id, user_id=from_user_id, login_token='', task_id=0, task_sub_type='', handler_name=self.__class__.__name__, request_code=self.request_code, task_type=task_type, check_new_user=False, check_user_nick=False, continue_request_expire=0, is_stat=is_stat, info_json=info_json, check_act_info_release=False, check_act_module_release=False)
-            if reward_invoke_result_data.success == True:
-                invoke_result_data.data["reward_value"] = reward_invoke_result_data.data["reward_value"]
-        ref_params = {}
-        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        if response_data_type == 1:
-            return self.response_json_success(invoke_result_data.data)
-        else:
-            return self.response_json_success(invoke_result_data.data["reward_value"])
-
-
-class InviteJoinMemberHandler(ClientBaseHandler):
-    """
-    :description: 处理邀请加入会员任务
-    """
-    @filter_check_params("invite_user_id,login_token", check_user_code=True)
-    def get_async(self):
-        """
-        :description: 处理邀请加入会员任务
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_code:用户标识
-        :param invite_user_id:邀请人用户标识
-        :param login_token:访问令牌
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        user_id = self.get_user_id()
-        module_id = self.get_param_int("module_id")
-        task_type = TaskType.invite_join_member.value
-        login_token = self.get_param("login_token")
-        from_user_id = self.get_param_int("invite_user_id", 0)
-        task_base_model = TaskBaseModel(context=self)
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        if not invoke_result_data.data:
-            invoke_result_data.data = {}
-        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
-        close_invite_limit = invoke_result_data.data["close_invite_limit"] if invoke_result_data.data.__contains__("close_invite_limit") else False
-        is_stat = invoke_result_data.data["is_stat"] if invoke_result_data.data.__contains__("is_stat") else False  #是否统计
-        is_receive_reward = invoke_result_data.data["is_receive_reward"] if invoke_result_data.data.__contains__("is_receive_reward") else False  #是否直接领取奖励
-        response_data_type = invoke_result_data.data["response_data_type"] if invoke_result_data.data.__contains__("response_data_type") else 2  #输出值类型（1-对象 2-奖励值）
-        info_json = invoke_result_data.data["info_json"] if invoke_result_data.data.__contains__("info_json") else None
-
-        invoke_result_data = task_base_model.process_invite_join_member(app_id, act_id, module_id, user_id, login_token, from_user_id, self.__class__.__name__, check_user_nick, 5, close_invite_limit)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        invoke_result_data.data = invoke_result_data.data if invoke_result_data.data else {}
-        invoke_result_data.data["reward_value"] = 0
-        if is_receive_reward == True:
-            reward_invoke_result_data = task_base_model.process_receive_reward(app_id=app_id, act_id=act_id, module_id=module_id, user_id=from_user_id, login_token='', task_id=0, task_sub_type='', handler_name=self.__class__.__name__, request_code=self.request_code, task_type=task_type, check_new_user=False, check_user_nick=False, continue_request_expire=0, is_stat=is_stat, info_json=info_json, check_act_info_release=False, check_act_module_release=False)
-            if reward_invoke_result_data.success == True:
-                invoke_result_data.data["reward_value"] = reward_invoke_result_data.data["reward_value"]
-        ref_params = {}
-        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        if response_data_type == 1:
-            return self.response_json_success(invoke_result_data.data)
-        else:
-            return self.response_json_success(invoke_result_data.data["reward_value"])
-
-
-class CollectGoodsHandler(ClientBaseHandler):
-    """
-    :description: 处理收藏商品任务
-    """
-    @filter_check_params("login_token,goods_id", check_user_code=True)
-    def get_async(self):
-        """
-        :description: 处理收藏商品任务
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_code:用户标识
-        :param goods_id:商品ID
-        :param login_token:访问令牌
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        user_id = self.get_user_id()
-        module_id = self.get_param_int("module_id")
-        task_type = TaskType.collect_goods.value
-        goods_id = self.get_param("goods_id")
-        login_token = self.get_param("login_token")
-        task_base_model = TaskBaseModel(context=self)
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        if not invoke_result_data.data:
-            invoke_result_data.data = {}
-        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
-        is_stat = invoke_result_data.data["is_stat"] if invoke_result_data.data.__contains__("is_stat") else False  #是否统计
-        is_receive_reward = invoke_result_data.data["is_receive_reward"] if invoke_result_data.data.__contains__("is_receive_reward") else False #是否直接领取奖励
-        info_json = invoke_result_data.data["info_json"] if invoke_result_data.data.__contains__("info_json") else None
-        invoke_result_data = task_base_model.process_collect_goods(app_id, act_id, module_id, user_id, login_token, goods_id, self.__class__.__name__, check_user_nick, 5)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        invoke_result_data.data = invoke_result_data.data if invoke_result_data.data else {}
-        invoke_result_data.data["reward_value"] = 0
-        if is_receive_reward == True:
-            reward_invoke_result_data = task_base_model.process_receive_reward(app_id=app_id, act_id=act_id, module_id=module_id, user_id=user_id, login_token='', task_id=0, task_sub_type='', handler_name=self.__class__.__name__, request_code=self.request_code, task_type=task_type, check_new_user=False, check_user_nick=False, continue_request_expire=0, is_stat=is_stat, info_json=info_json, check_act_info_release=False, check_act_module_release=False)
-            if reward_invoke_result_data.success == True:
-                invoke_result_data.data["reward_value"] = reward_invoke_result_data.data["reward_value"]
-        ref_params = {}
-        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-
-        return self.response_json_success(invoke_result_data.data["reward_value"])
-
-
-class BrowseGoodsHandler(ClientBaseHandler):
-    """
-    :description: 处理浏览商品任务
-    """
-    @filter_check_params("login_token,goods_id", check_user_code=True)
-    def get_async(self):
-        """
-        :description: 处理浏览商品任务
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_code:用户标识
-        :param goods_id:商品ID
-        :param login_token:访问令牌
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        user_id = self.get_user_id()
-        module_id = self.get_param_int("module_id")
-        task_type = TaskType.browse_goods.value
-        goods_id = self.get_param("goods_id")
-        login_token = self.get_param("login_token")
-        task_base_model = TaskBaseModel(context=self)
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        if not invoke_result_data.data:
-            invoke_result_data.data = {}
-        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
-        daily_repeat_browse = invoke_result_data.data["daily_repeat_browse"] if invoke_result_data.data.__contains__("daily_repeat_browse") else False
-        is_stat = invoke_result_data.data["is_stat"] if invoke_result_data.data.__contains__("is_stat") else False  #是否统计
-        is_receive_reward = invoke_result_data.data["is_receive_reward"] if invoke_result_data.data.__contains__("is_receive_reward") else False  #是否直接领取奖励
-        info_json = invoke_result_data.data["info_json"] if invoke_result_data.data.__contains__("info_json") else None
-        invoke_result_data = task_base_model.process_browse_goods(app_id, act_id, module_id, user_id, login_token, goods_id, self.__class__.__name__, daily_repeat_browse, check_user_nick, 5)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        invoke_result_data.data = invoke_result_data.data if invoke_result_data.data else {}
-        invoke_result_data.data["reward_value"] = 0
-        if is_receive_reward == True:
-            reward_invoke_result_data = task_base_model.process_receive_reward(app_id=app_id, act_id=act_id, module_id=module_id, user_id=user_id, login_token='', task_id=0, task_sub_type='', handler_name=self.__class__.__name__, request_code=self.request_code, task_type=task_type, check_new_user=False, check_user_nick=False, continue_request_expire=0, is_stat=is_stat, info_json=info_json, check_act_info_release=False, check_act_module_release=False)
-            if reward_invoke_result_data.success == True:
-                invoke_result_data.data["reward_value"] = reward_invoke_result_data.data["reward_value"]
-        ref_params = {}
-        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-
-        return self.response_json_success(invoke_result_data.data["reward_value"])
-
-
-class FavorStoreHandler(ClientBaseHandler):
-    """
-    :description: 处理关注店铺
-    """
-    @filter_check_params("login_token", check_user_code=True)
-    def get_async(self):
-        """
-        :description: 处理关注店铺
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_code:用户标识
-        :param login_token:访问令牌
-        :return: 直接发放奖励，返回奖励值
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        user_id = self.get_user_id()
-        module_id = self.get_param_int("module_id")
-        login_token = self.get_param("login_token")
-        task_base_model = TaskBaseModel(context=self)
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        if not invoke_result_data.data:
-            invoke_result_data.data = {}
-        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
-        is_stat = invoke_result_data.data["is_stat"] if invoke_result_data.data.__contains__("is_stat") else True
-        info_json = invoke_result_data.data["info_json"] if invoke_result_data.data.__contains__("info_json") else None
-        invoke_result_data = task_base_model.process_favor_store(app_id, act_id, module_id, user_id, login_token, self.__class__.__name__, self.request_code, check_user_nick, 5, is_stat, info_json)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        ref_params = {}
-        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success(invoke_result_data.data["reward_value"])
-
-
-class JoinMemberHandler(ClientBaseHandler):
-    """
-    :description: 处理加入店铺会员
-    """
-    @filter_check_params("login_token", check_user_code=True)
-    def get_async(self):
-        """
-        :description: 处理加入店铺会员
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_code:用户标识
-        :param login_token:访问令牌
-        :return: 直接发放奖励，返回奖励值
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        user_id = self.get_user_id()
-        module_id = self.get_param_int("module_id")
-        login_token = self.get_param("login_token")
-        task_base_model = TaskBaseModel(context=self)
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        if not invoke_result_data.data:
-            invoke_result_data.data = {}
-        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
-        is_stat = invoke_result_data.data["is_stat"] if invoke_result_data.data.__contains__("is_stat") else True
-        info_json = invoke_result_data.data["info_json"] if invoke_result_data.data.__contains__("info_json") else None
-        invoke_result_data = task_base_model.process_join_member(app_id, act_id, module_id, user_id, login_token, self.__class__.__name__, self.request_code, check_user_nick, 5, is_stat, info_json)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        ref_params = {}
-        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success(invoke_result_data.data["reward_value"])
-
-
-class BrowseSiteHandler(ClientBaseHandler):
-    """
-    :description: 处理浏览网址相关任务 如：浏览会场/专题
-    """
-    @filter_check_params("login_token", check_user_code=True)
-    def get_async(self):
-        """
-        :description: 处理浏览商品任务
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param task_type:活动模块标识
-        :param module_id:活动模块标识
-        :param user_code:用户标识
-        :param task_sub_type:子任务类型
-        :param login_token:访问令牌
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        user_id = self.get_user_id()
-        module_id = self.get_param_int("module_id")
-        task_type = self.get_param_int("task_type", TaskType.browse_special_topic.value)
-        task_sub_type = self.get_param("task_sub_type")
-        login_token = self.get_param("login_token")
-        task_base_model = TaskBaseModel(context=self)
-        invoke_result_data = InvokeResultData()
-        if task_type not in [TaskType.browse_special_topic.value, TaskType.browse_store.value, TaskType.browse_live_room.value]:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "非法操作"
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        if not invoke_result_data.data:
-            invoke_result_data.data = {}
-        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
-        is_stat = invoke_result_data.data["is_stat"] if invoke_result_data.data.__contains__("is_stat") else False  #是否统计
-        is_receive_reward = invoke_result_data.data["is_receive_reward"] if invoke_result_data.data.__contains__("is_receive_reward") else False  #是否直接领取奖励
-        info_json = invoke_result_data.data["info_json"] if invoke_result_data.data.__contains__("info_json") else None
-        invoke_result_data = task_base_model.process_browse_site(app_id, act_id, module_id, user_id, login_token, task_type, task_sub_type, self.__class__.__name__, check_user_nick, 5)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        invoke_result_data.data = invoke_result_data.data if invoke_result_data.data else {}
-        invoke_result_data.data["reward_value"] = 0
-        if is_receive_reward == True:
-            reward_invoke_result_data = task_base_model.process_receive_reward(app_id=app_id, act_id=act_id, module_id=module_id, user_id=user_id, login_token='', task_id=0, task_sub_type='', handler_name=self.__class__.__name__, request_code=self.request_code, task_type=task_type, check_new_user=False, check_user_nick=False, continue_request_expire=0, is_stat=is_stat, info_json=info_json, check_act_info_release=False, check_act_module_release=False)
-            if reward_invoke_result_data.success == True:
-                invoke_result_data.data["reward_value"] = reward_invoke_result_data.data["reward_value"]
-        ref_params = {}
-        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-
-        return self.response_json_success(invoke_result_data.data["reward_value"])
-
-
-class ShareHandler(ClientBaseHandler):
-    """
-    :description: 分享任务
-    """
-    @filter_check_params("login_token", check_user_code=True)
-    def get_async(self):
-        """
-        :description: 分享任务
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_code:用户标识
-        :param login_token:访问令牌
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        user_id = self.get_user_id()
-        module_id = self.get_param_int("module_id")
-        task_type = TaskType.share.value
-        login_token = self.get_param("login_token")
-        task_base_model = TaskBaseModel(context=self)
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        if not invoke_result_data.data:
-            invoke_result_data.data = {}
-        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
-        is_stat = invoke_result_data.data["is_stat"] if invoke_result_data.data.__contains__("is_stat") else False  #是否统计
-        is_receive_reward = invoke_result_data.data["is_receive_reward"] if invoke_result_data.data.__contains__("is_receive_reward") else False  #是否直接领取奖励
-        info_json = invoke_result_data.data["info_json"] if invoke_result_data.data.__contains__("info_json") else None
-        invoke_result_data = task_base_model.process_share(app_id, act_id, module_id, user_id, login_token, self.__class__.__name__, False, check_user_nick, 5)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        invoke_result_data.data = invoke_result_data.data if invoke_result_data.data else {}
-        invoke_result_data.data["reward_value"] = 0
-        if is_receive_reward == True:
-            reward_invoke_result_data = task_base_model.process_receive_reward(app_id=app_id, act_id=act_id, module_id=module_id, user_id=user_id, login_token='', task_id=0, task_sub_type='', handler_name=self.__class__.__name__, request_code=self.request_code, task_type=task_type, check_new_user=False, check_user_nick=False, continue_request_expire=0, is_stat=is_stat, info_json=info_json, check_act_info_release=False, check_act_module_release=False)
-            if reward_invoke_result_data.success == True:
-                invoke_result_data.data["reward_value"] = reward_invoke_result_data.data["reward_value"]
-        ref_params = {}
-        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-
-        return self.response_json_success(invoke_result_data.data["reward_value"])
-
-
-class BrowseStoreHandler(ClientBaseHandler):
-    """
-    :description: 浏览店铺任务
-    """
-    @filter_check_params("login_token", check_user_code=True)
-    def get_async(self):
-        """
-        :description: 浏览店铺任务
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_code:用户标识
-        :param login_token:访问令牌
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        user_id = self.get_user_id()
-        module_id = self.get_param_int("module_id")
-        login_token = self.get_param("login_token")
-        task_type = TaskType.browse_store.value
-        task_sub_type = self.get_param("task_sub_type")
-        task_base_model = TaskBaseModel(context=self)
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        if not invoke_result_data.data:
-            invoke_result_data.data = {}
-        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
-        is_stat = invoke_result_data.data["is_stat"] if invoke_result_data.data.__contains__("is_stat") else False  #是否统计
-        is_receive_reward = invoke_result_data.data["is_receive_reward"] if invoke_result_data.data.__contains__("is_receive_reward") else False  #是否直接领取奖励
-        info_json = invoke_result_data.data["info_json"] if invoke_result_data.data.__contains__("info_json") else None
-        invoke_result_data = task_base_model.process_routine_task(app_id, act_id, module_id, user_id, login_token, self.__class__.__name__, task_type, task_sub_type, False, check_user_nick)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        invoke_result_data.data = invoke_result_data.data if invoke_result_data.data else {}
-        invoke_result_data.data["reward_value"] = 0
-        if is_receive_reward == True:
-            reward_invoke_result_data = task_base_model.process_receive_reward(app_id=app_id, act_id=act_id, module_id=module_id, user_id=user_id, login_token='', task_id=0, task_sub_type=task_sub_type, handler_name=self.__class__.__name__, request_code=self.request_code, task_type=task_type, check_new_user=False, check_user_nick=False, continue_request_expire=0, is_stat=is_stat, info_json=info_json, check_act_info_release=False, check_act_module_release=False)
-            if reward_invoke_result_data.success == True:
-                invoke_result_data.data["reward_value"] = reward_invoke_result_data.data["reward_value"]
-        ref_params = {}
-        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-
-        return self.response_json_success(invoke_result_data.data["reward_value"])
-
-
-class BrowseLiveRoomHandler(ClientBaseHandler):
-    """
-    :description: 浏览直播间任务
-    """
-    @filter_check_params("login_token", check_user_code=True)
-    def get_async(self):
-        """
-        :description: 浏览直播间任务
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_code:用户标识
-        :param login_token:访问令牌
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        user_id = self.get_user_id()
-        module_id = self.get_param_int("module_id")
-        login_token = self.get_param("login_token")
-        task_type = TaskType.browse_live_room.value
-        task_sub_type = self.get_param("task_sub_type")
-        task_base_model = TaskBaseModel(context=self)
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        if not invoke_result_data.data:
-            invoke_result_data.data = {}
-        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
-        is_stat = invoke_result_data.data["is_stat"] if invoke_result_data.data.__contains__("is_stat") else False  #是否统计
-        is_receive_reward = invoke_result_data.data["is_receive_reward"] if invoke_result_data.data.__contains__("is_receive_reward") else False  #是否直接领取奖励
-        info_json = invoke_result_data.data["info_json"] if invoke_result_data.data.__contains__("info_json") else None
-        invoke_result_data = task_base_model.process_routine_task(app_id, act_id, module_id, user_id, login_token, self.__class__.__name__, task_type, task_sub_type, False, check_user_nick)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        invoke_result_data.data = invoke_result_data.data if invoke_result_data.data else {}
-        invoke_result_data.data["reward_value"] = 0
-        if is_receive_reward == True:
-            reward_invoke_result_data = task_base_model.process_receive_reward(app_id=app_id, act_id=act_id, module_id=module_id, user_id=user_id, login_token='', task_id=0, task_sub_type=task_sub_type, handler_name=self.__class__.__name__, request_code=self.request_code, task_type=task_type, check_new_user=False, check_user_nick=False, continue_request_expire=0, is_stat=is_stat, info_json=info_json, check_act_info_release=False, check_act_module_release=False)
-            if reward_invoke_result_data.success == True:
-                invoke_result_data.data["reward_value"] = reward_invoke_result_data.data["reward_value"]
-        ref_params = {}
-        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-
-        return self.response_json_success(invoke_result_data.data["reward_value"])
-
-
-class InviteUserHelpHandler(ClientBaseHandler):
-    """
-    :description: 处理邀请用户助力任务(被邀请人进入调用)
-    """
-    @filter_check_params("invite_user_id,login_token", check_user_code=True)
-    def get_async(self):
-        """
-        :description: 处理邀请用户助力任务(被邀请人进入调用)
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_code:用户标识
-        :param invite_user_id:邀请人用户标识
-        :param login_token:访问令牌
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        user_id = self.get_user_id()
-        module_id = self.get_param_int("module_id")
-        task_type = TaskType.invite_user_help.value
-        login_token = self.get_param("login_token")
-        from_user_id = int(self.get_param("invite_user_id", 0))
-        task_base_model = TaskBaseModel(context=self)
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        if not invoke_result_data.data:
-            invoke_result_data.data = {}
-        check_new_user = invoke_result_data.data["check_new_user"] if invoke_result_data.data.__contains__("check_new_user") else False
-        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
-        is_stat = invoke_result_data.data["is_stat"] if invoke_result_data.data.__contains__("is_stat") else False #是否统计
-        is_receive_reward = invoke_result_data.data["is_receive_reward"] if invoke_result_data.data.__contains__("is_receive_reward") else False #是否直接领取奖励
-        info_json = invoke_result_data.data["info_json"] if invoke_result_data.data.__contains__("info_json") else None
-
-        stat_base_model = StatBaseModel(context=self)
-        if is_stat == True:
-            stat_base_model.add_stat_list(app_id, act_id, module_id, user_id, "", {"BeInvitedHelpUserCount": 1, "BeInvitedHelpCount": 1})
-
-        invoke_result_data = task_base_model.process_invite_user_help(app_id, act_id, module_id, user_id, login_token, from_user_id, self.__class__.__name__, check_new_user, check_user_nick, 5, True, True)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        if is_stat == True:
-            stat_base_model.add_stat_list(app_id, act_id, module_id, user_id, "", {"AddBeInvitedHelpUserCount": 1})
-
-        invoke_result_data.data = invoke_result_data.data if invoke_result_data.data else {}
-        invoke_result_data.data["reward_value"] = 0
-        if is_receive_reward == True:
-            reward_invoke_result_data = task_base_model.process_receive_reward(app_id=app_id, act_id=act_id, module_id=module_id, user_id=from_user_id, login_token='', task_id=0, task_sub_type='', handler_name=self.__class__.__name__, request_code=self.request_code, task_type=task_type, check_new_user=False, check_user_nick=False, continue_request_expire=0, is_stat=is_stat, info_json=info_json, check_act_info_release=False, check_act_module_release=False)
-            if reward_invoke_result_data.success == True:
-                invoke_result_data.data["reward_value"] = reward_invoke_result_data.data["reward_value"]
-        ref_params = {}
-        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-
-        return self.response_json_success(invoke_result_data.data["reward_value"])
-
-
-class SecretCodeHandler(ClientBaseHandler):
-    """
-    :description: 神秘暗号任务
-    """
-    @filter_check_params("login_token,secret_code", check_user_code=True)
-    def get_async(self):
-        """
-        :description: 神秘暗号任务
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_code:用户标识
-        :param login_token:访问令牌
-        :param secret_code:暗号
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        user_id = self.get_user_id()
-        module_id = self.get_param_int("module_id")
-        login_token = self.get_param("login_token")
-        secret_code = self.get_param("secret_code")
-        task_base_model = TaskBaseModel(context=self)
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        if not invoke_result_data.data:
-            invoke_result_data.data = {}
-        check_new_user = invoke_result_data.data["check_new_user"] if invoke_result_data.data.__contains__("check_new_user") else False
-        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
-        is_stat = invoke_result_data.data["is_stat"] if invoke_result_data.data.__contains__("is_stat") else True
-        info_json = invoke_result_data.data["info_json"] if invoke_result_data.data.__contains__("info_json") else None
-        invoke_result_data = task_base_model.process_secret_code(app_id, act_id, module_id, user_id, login_token, self.__class__.__name__, self.request_code, secret_code, check_new_user, check_user_nick, 5, is_stat, info_json)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        ref_params = {}
-        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success(invoke_result_data.data["reward_value"])
-
-
-class CrmPointExchangeAssetHandler(ClientBaseHandler):
-    """
-    :description: 店铺积分兑换资产
-    """
-    @filter_check_params("login_token", check_user_code=True)
-    def get_async(self):
-        """
-        :description: 神秘暗号任务
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_code:用户标识
-        :param login_token:访问令牌
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        user_id = self.get_user_id()
-        module_id = self.get_param_int("module_id")
-        login_token = self.get_param("login_token")
-        mix_nick = self.get_param("mix_nick", "")
-        task_base_model = TaskBaseModel(context=self)
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        if not invoke_result_data.data:
-            invoke_result_data.data = {}
-        check_new_user = invoke_result_data.data["check_new_user"] if invoke_result_data.data.__contains__("check_new_user") else False
-        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
-        is_stat = invoke_result_data.data["is_stat"] if invoke_result_data.data.__contains__("is_stat") else True
-        info_json = invoke_result_data.data["info_json"] if invoke_result_data.data.__contains__("info_json") else None
-        app_base_model = AppBaseModel(context=self)
-        app_info_dict = app_base_model.get_app_info_dict(app_id,field="access_token")
-        if not app_info_dict:
-            return self.response_json_error("error", "对不起，找不到该应用")
-        access_token = app_info_dict["access_token"]
-        app_key, app_secret = self.get_app_key_secret()
-        invoke_result_data = task_base_model.process_crm_point_exchange_asset(app_id, act_id, module_id, user_id, login_token, self.__class__.__name__, self.request_code, mix_nick, access_token, app_key, app_secret, check_new_user, check_user_nick, 5, is_stat, info_json)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        ref_params = {}
-        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success(invoke_result_data.data["reward_value"])
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-08-17 11:19:05
+@LastEditTime: 2023-07-07 10:25:27
+@LastEditors: HuangJianYi
+@Description: 
+"""
+from seven_cloudapp_frame.handlers.frame_base import *
+from seven_cloudapp_frame.models.task_base_model import *
+
+
+class TaskInfoListHandler(ClientBaseHandler):
+    """
+    :description: 获取任务列表
+    """
+    @filter_check_params(check_user_code=True)
+    def get_async(self):
+        """
+        :description: 获取任务列表
+        :param act_id：活动标识
+        :param module_id：活动模块标识
+        :param user_code：用户标识
+        :param task_types:任务类型 多个逗号,分隔
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        mix_nick = self.get_param("mix_nick")
+        module_id = self.get_param_int("module_id")
+        task_types = self.get_param("task_types")
+        is_log = self.get_param_int("is_log", 0)
+        is_log = True if is_log == 1 else False
+        task_base_model = TaskBaseModel(context=self)
+        app_key, app_secret = self.get_app_key_secret()
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        daily_repeat_browse = invoke_result_data.data["daily_repeat_browse"] if invoke_result_data.data.__contains__("daily_repeat_browse") else False
+        ver_no = invoke_result_data.data["ver_no"] if invoke_result_data.data.__contains__("ver_no") else '1'
+        if ver_no == "1":
+            result_list,task_info_list,task_count_list = task_base_model.get_client_task_list(app_id, act_id, module_id, user_id, task_types, app_key, app_secret, is_log, daily_repeat_browse, mix_nick)
+        else:
+            result_list,task_info_list,task_count_list = task_base_model.get_client_task_list_v2(app_id, act_id, module_id, user_id, task_types, daily_repeat_browse)
+        ref_params = {}
+        ref_params["task_info_list"] = task_info_list
+        ref_params["task_count_list"] = task_count_list
+        return self.response_json_success(self.business_process_executed(result_list, ref_params))
+
+
+class ReceiveRewardHandler(ClientBaseHandler):
+    """
+    :description: 处理领取任务奖励
+    """
+    @filter_check_params("login_token", check_user_code=True)
+    def get_async(self):
+        """
+        :description: 处理领取任务奖励
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param user_code:用户标识
+        :param login_token:访问令牌
+        :param task_id:任务标识
+        :param task_sub_type:子任务类型
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        module_id = self.get_param_int("module_id")
+        login_token = self.get_param("login_token")
+        task_id = self.get_param_int("task_id")
+        task_type = self.get_param_int("task_type")
+        task_sub_type = str(self.get_param("task_sub_type"))
+        task_base_model = TaskBaseModel(context=self)
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        check_new_user = invoke_result_data.data["check_new_user"] if invoke_result_data.data.__contains__("check_new_user") else False
+        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
+        check_act_info_release = invoke_result_data.data["check_act_info_release"] if invoke_result_data.data.__contains__("check_act_info_release") else True
+        check_act_module_release = invoke_result_data.data["check_act_module_release"] if invoke_result_data.data.__contains__("check_act_module_release") else True
+        is_stat = invoke_result_data.data["is_stat"] if invoke_result_data.data.__contains__("is_stat") else True
+        info_json = invoke_result_data.data["info_json"] if invoke_result_data.data.__contains__("info_json") else None
+        invoke_result_data = task_base_model.process_receive_reward(app_id, act_id, module_id, user_id, login_token, task_id, task_sub_type, self.__class__.__name__, self.request_code, task_type, check_new_user, check_user_nick, 5, is_stat, info_json, check_act_info_release=check_act_info_release, check_act_module_release=check_act_module_release)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success(invoke_result_data.data["reward_value"])
+
+
+class FreeGiftHandler(ClientBaseHandler):
+    """
+    :description: 处理掌柜有礼、新人有礼、免费领取等相似任务
+    """
+    @filter_check_params("login_token", check_user_code=True)
+    def get_async(self):
+        """
+        :description: 处理掌柜有礼、新人有礼、免费领取等相似任务
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param user_code:用户标识
+        :param login_token:访问令牌
+        :return: 直接发放奖励，返回奖励值
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        module_id = self.get_param_int("module_id")
+        login_token = self.get_param("login_token")
+
+        task_base_model = TaskBaseModel(context=self)
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+
+        check_new_user = invoke_result_data.data["check_new_user"] if invoke_result_data.data.__contains__("check_new_user") else True
+        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
+        is_stat = invoke_result_data.data["is_stat"] if invoke_result_data.data.__contains__("is_stat") else True
+        info_json = invoke_result_data.data["info_json"] if invoke_result_data.data.__contains__("info_json") else None
+        invoke_result_data = task_base_model.process_free_gift(app_id, act_id, module_id, user_id, login_token, self.__class__.__name__, self.request_code, check_new_user, check_user_nick, 5, is_stat, info_json)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success(invoke_result_data.data["reward_value"])
+
+
+class OneSignHandler(ClientBaseHandler):
+    """
+    :description: 处理单次签到任务
+    """
+    @filter_check_params("login_token", check_user_code=True)
+    def get_async(self):
+        """
+        :description: 处理单次签到任务
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param user_code:用户标识
+        :param login_token:访问令牌
+        :return: 直接发放奖励，返回奖励值
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        module_id = self.get_param_int("module_id")
+        login_token = self.get_param("login_token")
+        task_base_model = TaskBaseModel(context=self)
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+
+        check_new_user = invoke_result_data.data["check_new_user"] if invoke_result_data.data.__contains__("check_new_user") else False
+        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
+        is_stat = invoke_result_data.data["is_stat"] if invoke_result_data.data.__contains__("is_stat") else True
+        info_json = invoke_result_data.data["info_json"] if invoke_result_data.data.__contains__("info_json") else {}
+        invoke_result_data = task_base_model.process_one_sign(app_id, act_id, module_id, user_id, login_token, self.__class__.__name__, self.request_code, check_new_user, check_user_nick, 5, is_stat, info_json)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success(invoke_result_data.data["reward_value"])
+
+
+class WeeklySignHandler(ClientBaseHandler):
+    """
+    :description: 处理每周签到任务
+    """
+    @filter_check_params("login_token", check_user_code=True)
+    def get_async(self):
+        """
+        :description: 处理每周签到任务
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param user_code:用户标识
+        :param login_token:访问令牌
+        :return: 直接发放奖励，返回奖励值
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        module_id = self.get_param_int("module_id")
+        login_token = self.get_param("login_token")
+        task_base_model = TaskBaseModel(context=self)
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        check_new_user = invoke_result_data.data["check_new_user"] if invoke_result_data.data.__contains__("check_new_user") else False
+        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
+        check_act_info_release = invoke_result_data.data["check_act_info_release"] if invoke_result_data.data.__contains__("check_act_info_release") else True
+        check_act_module_release = invoke_result_data.data["check_act_module_release"] if invoke_result_data.data.__contains__("check_act_module_release") else True
+        is_stat = invoke_result_data.data["is_stat"] if invoke_result_data.data.__contains__("is_stat") else True
+        info_json = invoke_result_data.data["info_json"] if invoke_result_data.data.__contains__("info_json") else None
+        invoke_result_data = task_base_model.process_weekly_sign(app_id, act_id, module_id, user_id, login_token, self.__class__.__name__, self.request_code, check_new_user, check_user_nick, 5, is_stat, info_json, check_act_info_release=check_act_info_release, check_act_module_release=check_act_module_release)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success(invoke_result_data.data["reward_value"])
+
+
+class CumulativeSignHandler(ClientBaseHandler):
+    """
+    :description: 处理累计签到任务
+    """
+    @filter_check_params("login_token",check_user_code=True)
+    def get_async(self):
+        """
+        :description: 处理累计签到任务
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param user_code:用户标识
+        :param login_token:访问令牌
+        :return: 直接发放奖励，返回奖励值
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        module_id = self.get_param_int("module_id")
+        login_token = self.get_param("login_token")
+        task_base_model = TaskBaseModel(context=self)
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        check_new_user = invoke_result_data.data["check_new_user"] if invoke_result_data.data.__contains__("check_new_user") else False
+        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
+        is_stat = invoke_result_data.data["is_stat"] if invoke_result_data.data.__contains__("is_stat") else True
+        info_json = invoke_result_data.data["info_json"] if invoke_result_data.data.__contains__("info_json") else None
+        task_type = invoke_result_data.data["task_type"] if invoke_result_data.data.__contains__("task_type") else 0
+        invoke_result_data = task_base_model.process_cumulative_sign(app_id, act_id, module_id, user_id, login_token, self.__class__.__name__, self.request_code, check_new_user, check_user_nick, 5, is_stat, info_json, task_type)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success(invoke_result_data.data["reward_value"])
+
+
+class SuccessiveSignHandler(ClientBaseHandler):
+    """
+    :description: 处理连续签到任务（天数是连续递增）
+    """
+    @filter_check_params("login_token",check_user_code=True)
+    def get_async(self):
+        """
+        :description: 处理连续签到任务（天数是连续递增）
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param user_code:用户标识
+        :param login_token:访问令牌
+        :return: 直接发放奖励，返回奖励值
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        module_id = self.get_param_int("module_id")
+        login_token = self.get_param("login_token")
+        task_base_model = TaskBaseModel(context=self)
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        check_new_user = invoke_result_data.data["check_new_user"] if invoke_result_data.data.__contains__("check_new_user") else False
+        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
+        is_stat = invoke_result_data.data["is_stat"] if invoke_result_data.data.__contains__("is_stat") else True
+        info_json = invoke_result_data.data["info_json"] if invoke_result_data.data.__contains__("info_json") else None
+        task_type = TaskType.successive_sign.value
+        invoke_result_data = task_base_model.process_cumulative_sign(app_id, act_id, module_id, user_id, login_token, self.__class__.__name__, self.request_code, check_new_user, check_user_nick, 5, is_stat, info_json, task_type)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success(invoke_result_data.data["reward_value"])
+
+
+class InviteNewUserHandler(ClientBaseHandler):
+    """
+    :description: 处理邀请用户任务(被邀请人进入调用)
+    """
+    @filter_check_params("invite_user_id,login_token", check_user_code=True)
+    def get_async(self):
+        """
+        :description: 处理邀请用户任务(被邀请人进入调用)
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param user_code:用户标识
+        :param invite_user_id:邀请人用户标识
+        :param login_token:访问令牌
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        module_id = self.get_param_int("module_id")
+        task_type = TaskType.invite_new_user.value
+        login_token = self.get_param("login_token")
+        from_user_id = int(self.get_param("invite_user_id", 0))
+        task_base_model = TaskBaseModel(context=self)
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        check_new_user = invoke_result_data.data["check_new_user"] if invoke_result_data.data.__contains__("check_new_user") else True
+        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
+        check_act_info_release = invoke_result_data.data["check_act_info_release"] if invoke_result_data.data.__contains__("check_act_info_release") else True
+        check_act_module_release = invoke_result_data.data["check_act_module_release"] if invoke_result_data.data.__contains__("check_act_module_release") else True
+        close_invite_limit = invoke_result_data.data["close_invite_limit"] if invoke_result_data.data.__contains__("close_invite_limit") else False #是否关闭邀请限制
+        is_stat = invoke_result_data.data["is_stat"] if invoke_result_data.data.__contains__("is_stat") else False #是否统计
+        is_receive_reward = invoke_result_data.data["is_receive_reward"] if invoke_result_data.data.__contains__("is_receive_reward") else False #是否直接领取奖励
+        response_data_type = invoke_result_data.data["response_data_type"] if invoke_result_data.data.__contains__("response_data_type") else 2  #输出值类型（1-对象 2-奖励值）
+        info_json = invoke_result_data.data["info_json"] if invoke_result_data.data.__contains__("info_json") else None
+
+        stat_base_model = StatBaseModel(context=self)
+        if is_stat == True:
+            stat_base_model.add_stat_list(app_id, act_id, module_id, user_id, "", {"BeInvitedUserCount": 1, "BeInvitedCount": 1})
+
+        invoke_result_data = task_base_model.process_invite_user(app_id, act_id, module_id, user_id, login_token, from_user_id, self.__class__.__name__, check_user_nick, check_new_user, 5, close_invite_limit, check_act_info_release=check_act_info_release, check_act_module_release=check_act_module_release)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if is_stat == True:
+            stat_base_model.add_stat_list(app_id, act_id, module_id, user_id, "", {"AddBeInvitedUserCount": 1})
+        invoke_result_data.data = invoke_result_data.data if invoke_result_data.data else {}
+        invoke_result_data.data["reward_value"] = 0
+        if is_receive_reward == True:
+            reward_invoke_result_data = task_base_model.process_receive_reward(app_id=app_id, act_id=act_id, module_id=module_id, user_id=from_user_id, login_token='', task_id=0, task_sub_type='', handler_name=self.__class__.__name__, request_code=self.request_code, task_type=task_type, check_new_user=False, check_user_nick=False, continue_request_expire=0, is_stat=is_stat, info_json=info_json, check_act_info_release=False, check_act_module_release=False)
+            if reward_invoke_result_data.success == True:
+                invoke_result_data.data["reward_value"] = reward_invoke_result_data.data["reward_value"]
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if response_data_type == 1:
+            return self.response_json_success(invoke_result_data.data)
+        else:
+            return self.response_json_success(invoke_result_data.data["reward_value"])
+
+
+class InviteJoinMemberHandler(ClientBaseHandler):
+    """
+    :description: 处理邀请加入会员任务
+    """
+    @filter_check_params("invite_user_id,login_token", check_user_code=True)
+    def get_async(self):
+        """
+        :description: 处理邀请加入会员任务
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param user_code:用户标识
+        :param invite_user_id:邀请人用户标识
+        :param login_token:访问令牌
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        module_id = self.get_param_int("module_id")
+        task_type = TaskType.invite_join_member.value
+        login_token = self.get_param("login_token")
+        from_user_id = self.get_param_int("invite_user_id", 0)
+        task_base_model = TaskBaseModel(context=self)
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
+        close_invite_limit = invoke_result_data.data["close_invite_limit"] if invoke_result_data.data.__contains__("close_invite_limit") else False
+        is_stat = invoke_result_data.data["is_stat"] if invoke_result_data.data.__contains__("is_stat") else False  #是否统计
+        is_receive_reward = invoke_result_data.data["is_receive_reward"] if invoke_result_data.data.__contains__("is_receive_reward") else False  #是否直接领取奖励
+        response_data_type = invoke_result_data.data["response_data_type"] if invoke_result_data.data.__contains__("response_data_type") else 2  #输出值类型（1-对象 2-奖励值）
+        info_json = invoke_result_data.data["info_json"] if invoke_result_data.data.__contains__("info_json") else None
+
+        invoke_result_data = task_base_model.process_invite_join_member(app_id, act_id, module_id, user_id, login_token, from_user_id, self.__class__.__name__, check_user_nick, 5, close_invite_limit)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        invoke_result_data.data = invoke_result_data.data if invoke_result_data.data else {}
+        invoke_result_data.data["reward_value"] = 0
+        if is_receive_reward == True:
+            reward_invoke_result_data = task_base_model.process_receive_reward(app_id=app_id, act_id=act_id, module_id=module_id, user_id=from_user_id, login_token='', task_id=0, task_sub_type='', handler_name=self.__class__.__name__, request_code=self.request_code, task_type=task_type, check_new_user=False, check_user_nick=False, continue_request_expire=0, is_stat=is_stat, info_json=info_json, check_act_info_release=False, check_act_module_release=False)
+            if reward_invoke_result_data.success == True:
+                invoke_result_data.data["reward_value"] = reward_invoke_result_data.data["reward_value"]
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if response_data_type == 1:
+            return self.response_json_success(invoke_result_data.data)
+        else:
+            return self.response_json_success(invoke_result_data.data["reward_value"])
+
+
+class CollectGoodsHandler(ClientBaseHandler):
+    """
+    :description: 处理收藏商品任务
+    """
+    @filter_check_params("login_token,goods_id", check_user_code=True)
+    def get_async(self):
+        """
+        :description: 处理收藏商品任务
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param user_code:用户标识
+        :param goods_id:商品ID
+        :param login_token:访问令牌
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        module_id = self.get_param_int("module_id")
+        task_type = TaskType.collect_goods.value
+        goods_id = self.get_param("goods_id")
+        login_token = self.get_param("login_token")
+        task_base_model = TaskBaseModel(context=self)
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
+        is_stat = invoke_result_data.data["is_stat"] if invoke_result_data.data.__contains__("is_stat") else False  #是否统计
+        is_receive_reward = invoke_result_data.data["is_receive_reward"] if invoke_result_data.data.__contains__("is_receive_reward") else False #是否直接领取奖励
+        info_json = invoke_result_data.data["info_json"] if invoke_result_data.data.__contains__("info_json") else None
+        invoke_result_data = task_base_model.process_collect_goods(app_id, act_id, module_id, user_id, login_token, goods_id, self.__class__.__name__, check_user_nick, 5)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        invoke_result_data.data = invoke_result_data.data if invoke_result_data.data else {}
+        invoke_result_data.data["reward_value"] = 0
+        if is_receive_reward == True:
+            reward_invoke_result_data = task_base_model.process_receive_reward(app_id=app_id, act_id=act_id, module_id=module_id, user_id=user_id, login_token='', task_id=0, task_sub_type='', handler_name=self.__class__.__name__, request_code=self.request_code, task_type=task_type, check_new_user=False, check_user_nick=False, continue_request_expire=0, is_stat=is_stat, info_json=info_json, check_act_info_release=False, check_act_module_release=False)
+            if reward_invoke_result_data.success == True:
+                invoke_result_data.data["reward_value"] = reward_invoke_result_data.data["reward_value"]
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+
+        return self.response_json_success(invoke_result_data.data["reward_value"])
+
+
+class BrowseGoodsHandler(ClientBaseHandler):
+    """
+    :description: 处理浏览商品任务
+    """
+    @filter_check_params("login_token,goods_id", check_user_code=True)
+    def get_async(self):
+        """
+        :description: 处理浏览商品任务
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param user_code:用户标识
+        :param goods_id:商品ID
+        :param login_token:访问令牌
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        module_id = self.get_param_int("module_id")
+        task_type = TaskType.browse_goods.value
+        goods_id = self.get_param("goods_id")
+        login_token = self.get_param("login_token")
+        task_base_model = TaskBaseModel(context=self)
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
+        daily_repeat_browse = invoke_result_data.data["daily_repeat_browse"] if invoke_result_data.data.__contains__("daily_repeat_browse") else False
+        is_stat = invoke_result_data.data["is_stat"] if invoke_result_data.data.__contains__("is_stat") else False  #是否统计
+        is_receive_reward = invoke_result_data.data["is_receive_reward"] if invoke_result_data.data.__contains__("is_receive_reward") else False  #是否直接领取奖励
+        info_json = invoke_result_data.data["info_json"] if invoke_result_data.data.__contains__("info_json") else None
+        invoke_result_data = task_base_model.process_browse_goods(app_id, act_id, module_id, user_id, login_token, goods_id, self.__class__.__name__, daily_repeat_browse, check_user_nick, 5)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        invoke_result_data.data = invoke_result_data.data if invoke_result_data.data else {}
+        invoke_result_data.data["reward_value"] = 0
+        if is_receive_reward == True:
+            reward_invoke_result_data = task_base_model.process_receive_reward(app_id=app_id, act_id=act_id, module_id=module_id, user_id=user_id, login_token='', task_id=0, task_sub_type='', handler_name=self.__class__.__name__, request_code=self.request_code, task_type=task_type, check_new_user=False, check_user_nick=False, continue_request_expire=0, is_stat=is_stat, info_json=info_json, check_act_info_release=False, check_act_module_release=False)
+            if reward_invoke_result_data.success == True:
+                invoke_result_data.data["reward_value"] = reward_invoke_result_data.data["reward_value"]
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+
+        return self.response_json_success(invoke_result_data.data["reward_value"])
+
+
+class FavorStoreHandler(ClientBaseHandler):
+    """
+    :description: 处理关注店铺
+    """
+    @filter_check_params("login_token", check_user_code=True)
+    def get_async(self):
+        """
+        :description: 处理关注店铺
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param user_code:用户标识
+        :param login_token:访问令牌
+        :return: 直接发放奖励，返回奖励值
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        module_id = self.get_param_int("module_id")
+        login_token = self.get_param("login_token")
+        task_base_model = TaskBaseModel(context=self)
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
+        is_stat = invoke_result_data.data["is_stat"] if invoke_result_data.data.__contains__("is_stat") else True
+        info_json = invoke_result_data.data["info_json"] if invoke_result_data.data.__contains__("info_json") else None
+        invoke_result_data = task_base_model.process_favor_store(app_id, act_id, module_id, user_id, login_token, self.__class__.__name__, self.request_code, check_user_nick, 5, is_stat, info_json)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success(invoke_result_data.data["reward_value"])
+
+
+class JoinMemberHandler(ClientBaseHandler):
+    """
+    :description: 处理加入店铺会员
+    """
+    @filter_check_params("login_token", check_user_code=True)
+    def get_async(self):
+        """
+        :description: 处理加入店铺会员
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param user_code:用户标识
+        :param login_token:访问令牌
+        :return: 直接发放奖励，返回奖励值
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        module_id = self.get_param_int("module_id")
+        login_token = self.get_param("login_token")
+        task_base_model = TaskBaseModel(context=self)
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
+        is_stat = invoke_result_data.data["is_stat"] if invoke_result_data.data.__contains__("is_stat") else True
+        info_json = invoke_result_data.data["info_json"] if invoke_result_data.data.__contains__("info_json") else None
+        invoke_result_data = task_base_model.process_join_member(app_id, act_id, module_id, user_id, login_token, self.__class__.__name__, self.request_code, check_user_nick, 5, is_stat, info_json)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success(invoke_result_data.data["reward_value"])
+
+
+class BrowseSiteHandler(ClientBaseHandler):
+    """
+    :description: 处理浏览网址相关任务 如：浏览会场/专题
+    """
+    @filter_check_params("login_token", check_user_code=True)
+    def get_async(self):
+        """
+        :description: 处理浏览商品任务
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param task_type:活动模块标识
+        :param module_id:活动模块标识
+        :param user_code:用户标识
+        :param task_sub_type:子任务类型
+        :param login_token:访问令牌
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        module_id = self.get_param_int("module_id")
+        task_type = self.get_param_int("task_type", TaskType.browse_special_topic.value)
+        task_sub_type = self.get_param("task_sub_type")
+        login_token = self.get_param("login_token")
+        task_base_model = TaskBaseModel(context=self)
+        invoke_result_data = InvokeResultData()
+        if task_type not in [TaskType.browse_special_topic.value, TaskType.browse_store.value, TaskType.browse_live_room.value]:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "非法操作"
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
+        is_stat = invoke_result_data.data["is_stat"] if invoke_result_data.data.__contains__("is_stat") else False  #是否统计
+        is_receive_reward = invoke_result_data.data["is_receive_reward"] if invoke_result_data.data.__contains__("is_receive_reward") else False  #是否直接领取奖励
+        info_json = invoke_result_data.data["info_json"] if invoke_result_data.data.__contains__("info_json") else None
+        invoke_result_data = task_base_model.process_browse_site(app_id, act_id, module_id, user_id, login_token, task_type, task_sub_type, self.__class__.__name__, check_user_nick, 5)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        invoke_result_data.data = invoke_result_data.data if invoke_result_data.data else {}
+        invoke_result_data.data["reward_value"] = 0
+        if is_receive_reward == True:
+            reward_invoke_result_data = task_base_model.process_receive_reward(app_id=app_id, act_id=act_id, module_id=module_id, user_id=user_id, login_token='', task_id=0, task_sub_type='', handler_name=self.__class__.__name__, request_code=self.request_code, task_type=task_type, check_new_user=False, check_user_nick=False, continue_request_expire=0, is_stat=is_stat, info_json=info_json, check_act_info_release=False, check_act_module_release=False)
+            if reward_invoke_result_data.success == True:
+                invoke_result_data.data["reward_value"] = reward_invoke_result_data.data["reward_value"]
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+
+        return self.response_json_success(invoke_result_data.data["reward_value"])
+
+
+class ShareHandler(ClientBaseHandler):
+    """
+    :description: 分享任务
+    """
+    @filter_check_params("login_token", check_user_code=True)
+    def get_async(self):
+        """
+        :description: 分享任务
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param user_code:用户标识
+        :param login_token:访问令牌
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        module_id = self.get_param_int("module_id")
+        task_type = TaskType.share.value
+        login_token = self.get_param("login_token")
+        task_base_model = TaskBaseModel(context=self)
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
+        is_stat = invoke_result_data.data["is_stat"] if invoke_result_data.data.__contains__("is_stat") else False  #是否统计
+        is_receive_reward = invoke_result_data.data["is_receive_reward"] if invoke_result_data.data.__contains__("is_receive_reward") else False  #是否直接领取奖励
+        info_json = invoke_result_data.data["info_json"] if invoke_result_data.data.__contains__("info_json") else None
+        invoke_result_data = task_base_model.process_share(app_id, act_id, module_id, user_id, login_token, self.__class__.__name__, False, check_user_nick, 5)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        invoke_result_data.data = invoke_result_data.data if invoke_result_data.data else {}
+        invoke_result_data.data["reward_value"] = 0
+        if is_receive_reward == True:
+            reward_invoke_result_data = task_base_model.process_receive_reward(app_id=app_id, act_id=act_id, module_id=module_id, user_id=user_id, login_token='', task_id=0, task_sub_type='', handler_name=self.__class__.__name__, request_code=self.request_code, task_type=task_type, check_new_user=False, check_user_nick=False, continue_request_expire=0, is_stat=is_stat, info_json=info_json, check_act_info_release=False, check_act_module_release=False)
+            if reward_invoke_result_data.success == True:
+                invoke_result_data.data["reward_value"] = reward_invoke_result_data.data["reward_value"]
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+
+        return self.response_json_success(invoke_result_data.data["reward_value"])
+
+
+class BrowseStoreHandler(ClientBaseHandler):
+    """
+    :description: 浏览店铺任务
+    """
+    @filter_check_params("login_token", check_user_code=True)
+    def get_async(self):
+        """
+        :description: 浏览店铺任务
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param user_code:用户标识
+        :param login_token:访问令牌
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        module_id = self.get_param_int("module_id")
+        login_token = self.get_param("login_token")
+        task_type = TaskType.browse_store.value
+        task_sub_type = self.get_param("task_sub_type")
+        task_base_model = TaskBaseModel(context=self)
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
+        is_stat = invoke_result_data.data["is_stat"] if invoke_result_data.data.__contains__("is_stat") else False  #是否统计
+        is_receive_reward = invoke_result_data.data["is_receive_reward"] if invoke_result_data.data.__contains__("is_receive_reward") else False  #是否直接领取奖励
+        info_json = invoke_result_data.data["info_json"] if invoke_result_data.data.__contains__("info_json") else None
+        invoke_result_data = task_base_model.process_routine_task(app_id, act_id, module_id, user_id, login_token, self.__class__.__name__, task_type, task_sub_type, False, check_user_nick)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        invoke_result_data.data = invoke_result_data.data if invoke_result_data.data else {}
+        invoke_result_data.data["reward_value"] = 0
+        if is_receive_reward == True:
+            reward_invoke_result_data = task_base_model.process_receive_reward(app_id=app_id, act_id=act_id, module_id=module_id, user_id=user_id, login_token='', task_id=0, task_sub_type=task_sub_type, handler_name=self.__class__.__name__, request_code=self.request_code, task_type=task_type, check_new_user=False, check_user_nick=False, continue_request_expire=0, is_stat=is_stat, info_json=info_json, check_act_info_release=False, check_act_module_release=False)
+            if reward_invoke_result_data.success == True:
+                invoke_result_data.data["reward_value"] = reward_invoke_result_data.data["reward_value"]
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+
+        return self.response_json_success(invoke_result_data.data["reward_value"])
+
+
+class BrowseLiveRoomHandler(ClientBaseHandler):
+    """
+    :description: 浏览直播间任务
+    """
+    @filter_check_params("login_token", check_user_code=True)
+    def get_async(self):
+        """
+        :description: 浏览直播间任务
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param user_code:用户标识
+        :param login_token:访问令牌
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        module_id = self.get_param_int("module_id")
+        login_token = self.get_param("login_token")
+        task_type = TaskType.browse_live_room.value
+        task_sub_type = self.get_param("task_sub_type")
+        task_base_model = TaskBaseModel(context=self)
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
+        is_stat = invoke_result_data.data["is_stat"] if invoke_result_data.data.__contains__("is_stat") else False  #是否统计
+        is_receive_reward = invoke_result_data.data["is_receive_reward"] if invoke_result_data.data.__contains__("is_receive_reward") else False  #是否直接领取奖励
+        info_json = invoke_result_data.data["info_json"] if invoke_result_data.data.__contains__("info_json") else None
+        invoke_result_data = task_base_model.process_routine_task(app_id, act_id, module_id, user_id, login_token, self.__class__.__name__, task_type, task_sub_type, False, check_user_nick)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        invoke_result_data.data = invoke_result_data.data if invoke_result_data.data else {}
+        invoke_result_data.data["reward_value"] = 0
+        if is_receive_reward == True:
+            reward_invoke_result_data = task_base_model.process_receive_reward(app_id=app_id, act_id=act_id, module_id=module_id, user_id=user_id, login_token='', task_id=0, task_sub_type=task_sub_type, handler_name=self.__class__.__name__, request_code=self.request_code, task_type=task_type, check_new_user=False, check_user_nick=False, continue_request_expire=0, is_stat=is_stat, info_json=info_json, check_act_info_release=False, check_act_module_release=False)
+            if reward_invoke_result_data.success == True:
+                invoke_result_data.data["reward_value"] = reward_invoke_result_data.data["reward_value"]
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+
+        return self.response_json_success(invoke_result_data.data["reward_value"])
+
+
+class InviteUserHelpHandler(ClientBaseHandler):
+    """
+    :description: 处理邀请用户助力任务(被邀请人进入调用)
+    """
+    @filter_check_params("invite_user_id,login_token", check_user_code=True)
+    def get_async(self):
+        """
+        :description: 处理邀请用户助力任务(被邀请人进入调用)
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param user_code:用户标识
+        :param invite_user_id:邀请人用户标识
+        :param login_token:访问令牌
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        module_id = self.get_param_int("module_id")
+        task_type = TaskType.invite_user_help.value
+        login_token = self.get_param("login_token")
+        from_user_id = int(self.get_param("invite_user_id", 0))
+        task_base_model = TaskBaseModel(context=self)
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        check_new_user = invoke_result_data.data["check_new_user"] if invoke_result_data.data.__contains__("check_new_user") else False
+        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
+        is_stat = invoke_result_data.data["is_stat"] if invoke_result_data.data.__contains__("is_stat") else False #是否统计
+        is_receive_reward = invoke_result_data.data["is_receive_reward"] if invoke_result_data.data.__contains__("is_receive_reward") else False #是否直接领取奖励
+        info_json = invoke_result_data.data["info_json"] if invoke_result_data.data.__contains__("info_json") else None
+
+        stat_base_model = StatBaseModel(context=self)
+        if is_stat == True:
+            stat_base_model.add_stat_list(app_id, act_id, module_id, user_id, "", {"BeInvitedHelpUserCount": 1, "BeInvitedHelpCount": 1})
+
+        invoke_result_data = task_base_model.process_invite_user_help(app_id, act_id, module_id, user_id, login_token, from_user_id, self.__class__.__name__, check_new_user, check_user_nick, 5, True, True)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if is_stat == True:
+            stat_base_model.add_stat_list(app_id, act_id, module_id, user_id, "", {"AddBeInvitedHelpUserCount": 1})
+
+        invoke_result_data.data = invoke_result_data.data if invoke_result_data.data else {}
+        invoke_result_data.data["reward_value"] = 0
+        if is_receive_reward == True:
+            reward_invoke_result_data = task_base_model.process_receive_reward(app_id=app_id, act_id=act_id, module_id=module_id, user_id=from_user_id, login_token='', task_id=0, task_sub_type='', handler_name=self.__class__.__name__, request_code=self.request_code, task_type=task_type, check_new_user=False, check_user_nick=False, continue_request_expire=0, is_stat=is_stat, info_json=info_json, check_act_info_release=False, check_act_module_release=False)
+            if reward_invoke_result_data.success == True:
+                invoke_result_data.data["reward_value"] = reward_invoke_result_data.data["reward_value"]
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+
+        return self.response_json_success(invoke_result_data.data["reward_value"])
+
+
+class SecretCodeHandler(ClientBaseHandler):
+    """
+    :description: 神秘暗号任务
+    """
+    @filter_check_params("login_token,secret_code", check_user_code=True)
+    def get_async(self):
+        """
+        :description: 神秘暗号任务
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param user_code:用户标识
+        :param login_token:访问令牌
+        :param secret_code:暗号
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        module_id = self.get_param_int("module_id")
+        login_token = self.get_param("login_token")
+        secret_code = self.get_param("secret_code")
+        task_base_model = TaskBaseModel(context=self)
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        check_new_user = invoke_result_data.data["check_new_user"] if invoke_result_data.data.__contains__("check_new_user") else False
+        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
+        is_stat = invoke_result_data.data["is_stat"] if invoke_result_data.data.__contains__("is_stat") else True
+        info_json = invoke_result_data.data["info_json"] if invoke_result_data.data.__contains__("info_json") else None
+        invoke_result_data = task_base_model.process_secret_code(app_id, act_id, module_id, user_id, login_token, self.__class__.__name__, self.request_code, secret_code, check_new_user, check_user_nick, 5, is_stat, info_json)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success(invoke_result_data.data["reward_value"])
+
+
+class CrmPointExchangeAssetHandler(ClientBaseHandler):
+    """
+    :description: 店铺积分兑换资产
+    """
+    @filter_check_params("login_token", check_user_code=True)
+    def get_async(self):
+        """
+        :description: 神秘暗号任务
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param user_code:用户标识
+        :param login_token:访问令牌
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        module_id = self.get_param_int("module_id")
+        login_token = self.get_param("login_token")
+        mix_nick = self.get_param("mix_nick", "")
+        task_base_model = TaskBaseModel(context=self)
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        check_new_user = invoke_result_data.data["check_new_user"] if invoke_result_data.data.__contains__("check_new_user") else False
+        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
+        is_stat = invoke_result_data.data["is_stat"] if invoke_result_data.data.__contains__("is_stat") else True
+        info_json = invoke_result_data.data["info_json"] if invoke_result_data.data.__contains__("info_json") else None
+        app_base_model = AppBaseModel(context=self)
+        app_info_dict = app_base_model.get_app_info_dict(app_id,field="access_token")
+        if not app_info_dict:
+            return self.response_json_error("error", "对不起，找不到该应用")
+        access_token = app_info_dict["access_token"]
+        app_key, app_secret = self.get_app_key_secret()
+        invoke_result_data = task_base_model.process_crm_point_exchange_asset(app_id, act_id, module_id, user_id, login_token, self.__class__.__name__, self.request_code, mix_nick, access_token, app_key, app_secret, check_new_user, check_user_nick, 5, is_stat, info_json)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success(invoke_result_data.data["reward_value"])
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/handlers/client/theme.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/handlers/client/theme.py`

 * *Ordering differences only*

 * *Files 12% similar despite different names*

```diff
@@ -1,134 +1,134 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-28 09:15:49
-@LastEditTime: 2023-03-13 11:37:23
-@LastEditors: HuangJianYi
-@Description: 
-"""
-from seven_cloudapp_frame.handlers.frame_base import *
-from seven_cloudapp_frame.models.theme_base_model import *
-from seven_cloudapp_frame.models.act_base_model import *
-
-
-class ThemeInfoHandler(ClientBaseHandler):
-    """
-    :description: 获取主题（皮肤）信息
-    """
-    def get_async(self):
-        """
-        :description: 获取主题（皮肤）信息
-        :param act_id：活动标识
-        :param ver_no：客户端版本号
-        :return 主题信息
-        :last_editors: HuangJianYi
-        """
-        act_id = self.get_act_id()
-        ver_no = self.get_param("ver_no")
-
-        act_base_model = ActBaseModel(context=self)
-        act_info_dict = act_base_model.get_act_info_dict(act_id)
-        if not act_info_dict:
-            return self.response_json_error("no_act", "对不起，找不到该活动")
-        theme_id = act_info_dict["theme_id"]
-        theme_base_model = ThemeBaseModel(context=self)
-        theme_info = theme_base_model.get_theme_info(theme_id, ver_no)
-        return self.response_json_success(self.business_process_executed(theme_info,ref_params={}))
-
-
-class SaveThemeHandler(ClientBaseHandler):
-    """
-    :description: 保存主题
-    """
-    @filter_check_params("out_id")
-    def post_async(self):
-        """
-        :description: 保存主题
-        :param app_id：应用标识
-        :param theme_name：主题名称
-        :param client_json：客户端内容json
-        :param server_json：服务端内容json
-        :param out_id：外部id
-        :param ver_no：客户端版本号
-        :param style_type：样式类型
-        :param ascription_type：归属类型(1公共)
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        theme_name = self.get_param("theme_name")
-        client_json = self.get_param("client_json")
-        server_json = self.get_param("server_json")
-        out_id = self.get_param("out_id")
-        ver_no = self.get_param("ver_no")
-        style_type = int(self.get_param("style_type",0))
-        ascription_type = self.get_param_int("ascription_type",1)
-
-        theme_base_model = ThemeBaseModel(context=self)
-        theme_base_model.save_theme(app_id, theme_name, client_json, server_json, out_id, ver_no, style_type, ascription_type)
-        return self.response_json_success()
-
-
-class SaveSkinHandler(ClientBaseHandler):
-    """
-    :description: 保存皮肤
-    """
-    @filter_check_params("theme_out_id,skin_out_id")
-    def post_async(self):
-        """
-        :description: 保存皮肤
-        :param app_id：应用标识
-        :param skin_name：皮肤名称
-        :param client_json：客户端内容json
-        :param server_json：服务端内容json
-        :param theme_out_id：样式外部id
-        :param skin_out_id：皮肤外部id
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        skin_name = self.get_param("skin_name")
-        client_json = self.get_param("client_json")
-        server_json = self.get_param("server_json")
-        theme_out_id = self.get_param("theme_out_id")
-        skin_out_id = self.get_param("skin_out_id")
-        style_type = self.get_param_int("style_type")
-
-        theme_base_model = ThemeBaseModel(context=self)
-        invoke_result_data = theme_base_model.save_skin(app_id, skin_name, client_json, server_json, theme_out_id, skin_out_id, style_type)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success(self.business_process_executed(invoke_result_data.data, ref_params={}))
-
-
-class ThemeInfoListHandler(ClientBaseHandler):
-    """
-    :description: 获取主题信息列表
-    """
-    def get_async(self):
-        """
-        :description: 保存皮肤
-        :param app_id：应用标识
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        theme_base_model = ThemeBaseModel(context=self)
-        return self.response_json_success(self.business_process_executed(theme_base_model.get_theme_list(app_id), ref_params={}))
-
-
-class SkinInfoListHandler(ClientBaseHandler):
-    """
-    :description: 获取皮肤信息列表
-    """
-    @filter_check_params("theme_out_id")
-    def get_async(self):
-        """
-        :description: 保存皮肤
-        :param app_id：应用标识
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        theme_out_id = self.get_param("theme_out_id")
-        theme_base_model = ThemeBaseModel(context=self)
-        return self.response_json_success(self.business_process_executed(theme_base_model.get_skin_list(theme_out_id), ref_params={}))
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-28 09:15:49
+@LastEditTime: 2023-03-13 11:37:23
+@LastEditors: HuangJianYi
+@Description: 
+"""
+from seven_cloudapp_frame.handlers.frame_base import *
+from seven_cloudapp_frame.models.theme_base_model import *
+from seven_cloudapp_frame.models.act_base_model import *
+
+
+class ThemeInfoHandler(ClientBaseHandler):
+    """
+    :description: 获取主题（皮肤）信息
+    """
+    def get_async(self):
+        """
+        :description: 获取主题（皮肤）信息
+        :param act_id：活动标识
+        :param ver_no：客户端版本号
+        :return 主题信息
+        :last_editors: HuangJianYi
+        """
+        act_id = self.get_act_id()
+        ver_no = self.get_param("ver_no")
+
+        act_base_model = ActBaseModel(context=self)
+        act_info_dict = act_base_model.get_act_info_dict(act_id)
+        if not act_info_dict:
+            return self.response_json_error("no_act", "对不起，找不到该活动")
+        theme_id = act_info_dict["theme_id"]
+        theme_base_model = ThemeBaseModel(context=self)
+        theme_info = theme_base_model.get_theme_info(theme_id, ver_no)
+        return self.response_json_success(self.business_process_executed(theme_info,ref_params={}))
+
+
+class SaveThemeHandler(ClientBaseHandler):
+    """
+    :description: 保存主题
+    """
+    @filter_check_params("out_id")
+    def post_async(self):
+        """
+        :description: 保存主题
+        :param app_id：应用标识
+        :param theme_name：主题名称
+        :param client_json：客户端内容json
+        :param server_json：服务端内容json
+        :param out_id：外部id
+        :param ver_no：客户端版本号
+        :param style_type：样式类型
+        :param ascription_type：归属类型(1公共)
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        theme_name = self.get_param("theme_name")
+        client_json = self.get_param("client_json")
+        server_json = self.get_param("server_json")
+        out_id = self.get_param("out_id")
+        ver_no = self.get_param("ver_no")
+        style_type = int(self.get_param("style_type",0))
+        ascription_type = self.get_param_int("ascription_type",1)
+
+        theme_base_model = ThemeBaseModel(context=self)
+        theme_base_model.save_theme(app_id, theme_name, client_json, server_json, out_id, ver_no, style_type, ascription_type)
+        return self.response_json_success()
+
+
+class SaveSkinHandler(ClientBaseHandler):
+    """
+    :description: 保存皮肤
+    """
+    @filter_check_params("theme_out_id,skin_out_id")
+    def post_async(self):
+        """
+        :description: 保存皮肤
+        :param app_id：应用标识
+        :param skin_name：皮肤名称
+        :param client_json：客户端内容json
+        :param server_json：服务端内容json
+        :param theme_out_id：样式外部id
+        :param skin_out_id：皮肤外部id
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        skin_name = self.get_param("skin_name")
+        client_json = self.get_param("client_json")
+        server_json = self.get_param("server_json")
+        theme_out_id = self.get_param("theme_out_id")
+        skin_out_id = self.get_param("skin_out_id")
+        style_type = self.get_param_int("style_type")
+
+        theme_base_model = ThemeBaseModel(context=self)
+        invoke_result_data = theme_base_model.save_skin(app_id, skin_name, client_json, server_json, theme_out_id, skin_out_id, style_type)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success(self.business_process_executed(invoke_result_data.data, ref_params={}))
+
+
+class ThemeInfoListHandler(ClientBaseHandler):
+    """
+    :description: 获取主题信息列表
+    """
+    def get_async(self):
+        """
+        :description: 保存皮肤
+        :param app_id：应用标识
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        theme_base_model = ThemeBaseModel(context=self)
+        return self.response_json_success(self.business_process_executed(theme_base_model.get_theme_list(app_id), ref_params={}))
+
+
+class SkinInfoListHandler(ClientBaseHandler):
+    """
+    :description: 获取皮肤信息列表
+    """
+    @filter_check_params("theme_out_id")
+    def get_async(self):
+        """
+        :description: 保存皮肤
+        :param app_id：应用标识
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        theme_out_id = self.get_param("theme_out_id")
+        theme_base_model = ThemeBaseModel(context=self)
+        return self.response_json_success(self.business_process_executed(theme_base_model.get_skin_list(theme_out_id), ref_params={}))
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/handlers/client/user.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/handlers/client/user.py`

 * *Ordering differences only*

 * *Files 10% similar despite different names*

```diff
@@ -1,451 +1,451 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-26 18:31:06
-@LastEditTime: 2023-03-03 14:54:15
-@LastEditors: HuangJianYi
-@Description: 
-"""
-from seven_cloudapp_frame.models.enum import *
-from seven_cloudapp_frame.handlers.frame_base import *
-from seven_cloudapp_frame.models.user_base_model import *
-from seven_cloudapp_frame.models.order_base_model import *
-from seven_cloudapp_frame.models.stat_base_model import *
-from seven_cloudapp_frame.models.app_base_model import *
-from seven_cloudapp_frame.models.asset_base_model import *
-from seven_cloudapp_frame.models.top_base_model import *
-from seven_cloudapp_frame.libs.customize.wechat_helper import *
-from seven_cloudapp_frame.libs.customize.tiktok_helper import *
-from seven_cloudapp_frame.libs.customize.riskmanage_helper import *
-
-class LoginHandler(ClientBaseHandler):
-    """
-    :description: 登录处理
-    """
-    @filter_check_current_limit()
-    def get_async(self):
-        """
-        :description: 登录处理
-        :param act_id：活动标识
-        :param module_id：活动模块标识
-        :param avatar：头像
-        :return:
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        open_id = self.get_param("open_id")
-        user_nick = self.get_user_nick()
-        mix_nick = self.get_param("mix_nick")
-        act_id = self.get_act_id()
-        module_id = int(self.get_param("module_id", 0))
-        avatar = self.get_param("avatar")
-        code = self.get_param("code", "")
-        anonymous_code = self.get_param("anonymous_code", "")
-        pt = self.get_param("pt", "tb")  #tb淘宝 tt抖音 wx微信 jd京东 qq h5
-
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        if not invoke_result_data.data:
-            invoke_result_data.data = {}
-        is_update_user_nick = invoke_result_data.data["is_update_user_nick"] if invoke_result_data.data.__contains__("is_update_user_nick") else True
-        login_ip = self.get_remote_ip()
-        union_id = ""
-        if pt == "wx" and code:
-            invoke_result_data = WeChatHelper.code2_session(code, app_id=share_config.get_value("app_id"), app_secret=share_config.get_value("app_secret"))
-            if invoke_result_data.success == False:
-                return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-            open_id =  invoke_result_data.data["openid"]
-            union_id =  invoke_result_data.data.get("unionid","")
-        elif pt == "tt" and code:
-            invoke_result_data = TikTokHelper.code2_session(code, anonymous_code, app_id=share_config.get_value("app_id"), app_secret=share_config.get_value("app_secret"))
-            if invoke_result_data.success == False:
-                return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-            open_id = invoke_result_data.data["openid"]
-        else:
-            login_ip = self.get_param("source_ip")
-
-        user_base_model = UserBaseModel(context=self)
-        invoke_result_data = user_base_model.save_user_by_openid(app_id, act_id, open_id, user_nick, avatar, union_id, login_ip, is_update_user_nick, mix_nick)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        invoke_result_data.data["user_nick"] = CryptographyHelper.emoji_base64_to_emoji(invoke_result_data.data["user_nick"])
-        if invoke_result_data.data["user_nick_encrypt"]:
-            invoke_result_data.data["user_nick"] = CryptographyHelper.base64_decrypt(invoke_result_data.data["user_nick_encrypt"])
-        ref_params = {}
-        ref_params["app_id"] = app_id
-        ref_params["act_id"] = act_id
-        ref_params["module_id"] = module_id
-        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success(invoke_result_data.data)
-
-    def business_process_executed(self, result_data, ref_params):
-        """
-        :description: 执行后事件
-        :param result_data:result_data
-        :param ref_params: 关联参数
-        :return:
-        :last_editors: HuangJianYi
-        """
-        user_info_dict = result_data.data
-        stat_base_model = StatBaseModel(context=self)
-        key_list_dict = {}
-        key_list_dict["VisitCountEveryDay"] = 1
-        key_list_dict["VisitManCountEveryDay"] = 1
-        key_list_dict["VisitManCountEveryDayIncrease"] = 1
-        stat_base_model.add_stat_list(ref_params["app_id"], ref_params["act_id"], ref_params["module_id"], user_info_dict["user_id"], user_info_dict["open_id"], key_list_dict)
-        return result_data
-
-
-class UpdateUserInfoHandler(ClientBaseHandler):
-    """
-    :description: 更新用户信息
-    """
-    @filter_check_params(check_user_code=True)
-    def get_async(self):
-        """
-        :description: 更新用户信息
-        :param act_id：活动标识
-        :param user_code：用户标识
-        :param avatar：头像
-        :param is_member_before：初始会员状态
-        :param is_favor_before：初始关注状态
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        open_id = self.get_param("open_id")
-        user_nick = self.get_user_nick()
-        act_id = self.get_act_id()
-        user_id = self.get_user_id()
-        avatar = self.get_param("avatar")
-        is_member_before = int(self.get_param("is_member_before", -1))
-        is_favor_before = int(self.get_param("is_favor_before", -1))
-        invoke_result_data = InvokeResultData()
-        user_base_model = UserBaseModel(context=self)
-        invoke_result_data = user_base_model.update_user_info(app_id, act_id, user_id, open_id, user_nick, avatar, is_member_before, is_favor_before)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        else:
-            ref_params = {}
-            invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
-            if invoke_result_data.success == False:
-                return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-            return self.response_json_success("更新成功")
-
-
-class CheckIsMemberHandler(ClientBaseHandler):
-    """
-    :description: 校验是否是店铺会员
-    """
-    def get_async(self):
-        """
-        :description: 校验是否是店铺会员
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        mix_nick = self.get_param("mix_nick")
-        is_log = int(self.get_param("is_log", 0))
-        is_log = True if is_log == 1 else False
-        app_base_model = AppBaseModel(context=self)
-        app_info_dict = app_base_model.get_app_info_dict(app_id=app_id,is_cache=True,field="access_token")
-        if not app_info_dict:
-            return self.response_json_error("error", "小程序不存在")
-        access_token = app_info_dict["access_token"]
-        if access_token == "":
-            return self.response_json_error("error", "未授权请联系客服授权")
-        top_base_model = TopBaseModel(context=self)
-        app_key,app_secret = self.get_app_key_secret()
-        return self.response_json_success(top_base_model.check_is_member(mix_nick,"", access_token, app_key, app_secret, is_log))
-
-
-class GetCrmIntegralHandler(ClientBaseHandler):
-    """
-    :description: 获取店铺会员积分
-    """
-    @filter_check_params()
-    def get_async(self):
-        """
-        :description: 获取店铺会员积分
-        :return: 店铺会员积分
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        open_id = self.get_open_id()
-        mix_nick = self.get_param("mix_nick")
-        is_log = int(self.get_param("is_log", 0))
-        is_log = True if is_log == 1 else False
-        app_base_model = AppBaseModel(context=self)
-        app_info_dict = app_base_model.get_app_info_dict(app_id=app_id,is_cache=True,field="access_token")
-        if not app_info_dict:
-            return self.response_json_error("error", "小程序不存在")
-        access_token = app_info_dict["access_token"]
-        if access_token == "":
-            return self.response_json_error("error", "未授权请联系客服授权")
-        top_base_model = TopBaseModel(context=self)
-        app_key, app_secret = self.get_app_key_secret()
-        invoke_result_data = top_base_model.get_crm_point_available(mix_nick, access_token, app_key, app_secret, is_log, open_id)
-        if invoke_result_data.success == False:
-            return self.reponse_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        shop_member_integral = invoke_result_data.data
-        return self.reponse_json_success(shop_member_integral)
-
-
-class ApplyBlackUnbindHandler(ClientBaseHandler):
-    """
-    :description: 提交黑名单解封申请
-    """
-    @filter_check_params(check_user_code=True)
-    def get_async(self):
-        """
-        :description: 提交黑名单解封申请
-        :param act_id:活动标识
-        :param user_code:用户标识
-        :param reason:解封理由
-        :return 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        open_id = self.get_param("open_id")
-        act_id = self.get_act_id()
-        user_id = self.get_user_id()
-        reason = self.get_param("reason", "误封号,申请解封")
-        invoke_result_data = InvokeResultData()
-        user_base_model = UserBaseModel(context=self)
-        invoke_result_data = user_base_model.apply_black_unbind(app_id, act_id, user_id, open_id, reason)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        else:
-            return self.response_json_success()
-
-
-class GetUnbindApplyHandler(ClientBaseHandler):
-    """
-    :description: 获取黑名单解封申请记录
-    """
-    @filter_check_params(check_user_code=True)
-    def get_async(self):
-        """
-        :description: 获取黑名单解封申请记录
-        :param act_id:活动标识
-        :param user_code:用户标识
-        :param reason:解封理由
-        :return 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        user_id = self.get_user_id()
-        user_base_model = UserBaseModel(context=self)
-        return self.response_json_success(user_base_model.get_black_info_dict(app_id, act_id, user_id))
-
-
-class GetCouponPrizeHandler(ClientBaseHandler):
-    """
-    :description: 领取淘宝优惠券
-    """
-    @filter_check_params("user_prize_id", check_user_code=True)
-    def get_async(self):
-        """
-        :description: 领取淘宝优惠券（发奖接口）
-        :param user_prize_id:用户奖品标识
-        :param user_code:用户标识
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        user_id = self.get_user_id()
-        user_prize_id = int(self.get_param("user_prize_id", 0))
-        is_log = int(self.get_param("is_log", 0))
-        is_log = True if is_log == 1 else False
-        order_base_model = OrderBaseModel(context=self)
-        app_key, app_secret = self.get_app_key_secret()
-        invoke_result_data = order_base_model.get_coupon_prize(app_id, act_id, user_id, user_prize_id, app_key, app_secret, is_log)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message, invoke_result_data.data)
-        else:
-            return self.response_json_success(self.business_process_executed(invoke_result_data.data, ref_params={}))
-
-
-class GetUserAssetHandler(ClientBaseHandler):
-    """
-    :description: 获取单条用户资产
-    """
-    @filter_check_params("asset_type", check_user_code=True)
-    def get_async(self):
-        """
-        :description: 获取单条用户资产
-        :param act_id：活动标识
-        :param user_code：用户标识
-        :param asset_type：资产类型(1-次数2-积分3-价格档位)
-        :param asset_object_id：资产对象标识
-        :return list
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        user_id = self.get_user_id()
-        asset_type = int(self.get_param("asset_type", 0))
-        asset_object_id = self.get_param("asset_object_id", "")
-        asset_base_model = AssetBaseModel(context=self)
-        return self.response_json_success(self.business_process_executed(asset_base_model.get_user_asset(app_id, act_id, user_id, asset_type, asset_object_id), ref_params={}))
-
-
-class UserAssetListHandler(ClientBaseHandler):
-    """
-    :description: 获取用户资产列表
-    """
-    @filter_check_params(check_user_code=True)
-    def get_async(self):
-        """
-        :description: 获取用户资产列表
-        :param act_id：活动标识
-        :param user_code：用户标识
-        :param asset_type：资产类型(1-次数2-积分3-价格档位)
-        :return list
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        user_id = self.get_user_id()
-        asset_type = int(self.get_param("asset_type", 0))
-        asset_base_model = AssetBaseModel(context=self)
-        return self.response_json_success(self.business_process_executed(asset_base_model.get_user_asset_list(app_id, act_id, user_id, asset_type), ref_params={}))
-
-
-class AssetLogListHandler(ClientBaseHandler):
-    """
-    :description: 资产流水记录
-    """
-    @filter_check_params("asset_type", check_user_code=True)
-    def get_async(self):
-        """
-        :description: 资产流水记录
-        :param act_id：活动标识
-        :param module_id：模块标识
-        :param user_code：用户标识
-        :param asset_type：资产类型(1-次数2-积分3-价格档位))
-        :param asset_object_id：资产对象标识
-        :param operate_type：操作类型(0累计 1消耗
-        :param page_size：条数
-        :param page_index：页数
-        :param page_count_mode：分页模式(0-none 1-total 2-next)
-        :return list
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        user_id = self.get_user_id()
-        module_id = self.get_param_int("module_id", 0)
-        page_index = self.get_param_int("page_index", 0)
-        page_size = self.get_param_int("page_size", 20)
-        asset_type = self.get_param_int("asset_type", 0)
-        asset_object_id = self.get_param("asset_object_id")
-        operate_type = self.get_param_int("operate_type", -1)
-        page_count_mode = self.get_param_int("page_count_mode", 1)
-
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_success({"data": []})
-        if not invoke_result_data.data:
-            invoke_result_data.data = {}
-        field = invoke_result_data.data["field"] if invoke_result_data.data.__contains__("field") else "*"
-        asset_base_model = AssetBaseModel(context=self)
-        page_count_mode = SevenHelper.get_enum_key(PageCountMode, page_count_mode)
-        page_list = asset_base_model.get_asset_log_list(app_id, act_id, asset_type, page_size, page_index, user_id, asset_object_id, field=field, is_cache=True, operate_type=operate_type, page_count_mode=page_count_mode, module_id=module_id)
-        if page_count_mode == "total":
-            total = page_list[1]
-            page_list = self.business_process_executed(page_list[0], ref_params={})
-            return_info = PageInfo(page_index, page_size, total, page_list)
-        elif page_count_mode == "next":
-            is_next = page_list[1]
-            page_list = self.business_process_executed(page_list[0], ref_params={})
-            return_info = WaterPageInfo(page_list, is_next)
-        else:
-            return_info = self.business_process_executed(page_list, ref_params={})
-        return self.response_json_success(return_info)
-
-
-class GetJoinMemberUrlHandler(ClientBaseHandler):
-    """
-    :description: 获取加入会员地址
-    """
-    def get_async(self):
-        """
-        :description: 获取加入会员地址
-        :return
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        is_log = int(self.get_param("is_log", 0))
-        is_log = True if is_log == 1 else False
-        app_base_model = AppBaseModel(context=self)
-        app_info_dict = app_base_model.get_app_info_dict(app_id=app_id,is_cache=True,field="access_token")
-        if not app_info_dict:
-            return self.response_json_error("error", "小程序不存在")
-        app_key, app_secret = self.get_app_key_secret()
-        user_base_model = UserBaseModel(context=self)
-        invoke_result_data = user_base_model.get_join_member_url(app_info_dict["access_token"], app_key, app_secret, is_log=is_log)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success(invoke_result_data.data)
-
-
-class UserAddressListHandler(ClientBaseHandler):
-    """
-    :description: 收货地址列表
-    """
-    @filter_check_params(check_user_code=True)
-    def get_async(self):
-        """
-        :param act_id：活动标识
-        :param user_code：用户标识
-        :return: list
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        user_id = self.get_user_id()
-        user_base_model = UserBaseModel(context=self)
-        return self.response_json_success(user_base_model.get_user_address_list(app_id, act_id, user_id))
-
-
-class SaveUserAddressHandler(ClientBaseHandler):
-    """
-    :description: 保存收货地址
-    """
-    @filter_check_params("real_name,telephone", check_user_code=True)
-    def get_async(self):
-        """
-        :param act_id：活动标识
-        :param user_code：用户标识
-        :param is_default：是否默认地址（1是0否）
-        :param real_name：真实姓名
-        :param telephone：手机号码
-        :param province：省
-        :param city：市
-        :param county：区
-        :param street：街道
-        :param adress：地址
-        :return: dict
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        user_id = self.get_user_id()
-        open_id = self.get_param("open_id")
-        user_address_id = int(self.get_param("user_address_id", 0))
-        real_name = self.get_param("real_name")
-        telephone = self.get_param("telephone")
-        province = self.get_param("province")
-        city = self.get_param("city")
-        county = self.get_param("county")
-        street = self.get_param("street")
-        address = self.get_param("address")
-        is_default = int(self.get_param("is_default", 0))
-        user_base_model = UserBaseModel(context=self)
-        return self.response_json_success(user_base_model.save_user_address(app_id, act_id, user_id, open_id, user_address_id, real_name, telephone, province, city, county, street, address, is_default))
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-26 18:31:06
+@LastEditTime: 2023-03-03 14:54:15
+@LastEditors: HuangJianYi
+@Description: 
+"""
+from seven_cloudapp_frame.models.enum import *
+from seven_cloudapp_frame.handlers.frame_base import *
+from seven_cloudapp_frame.models.user_base_model import *
+from seven_cloudapp_frame.models.order_base_model import *
+from seven_cloudapp_frame.models.stat_base_model import *
+from seven_cloudapp_frame.models.app_base_model import *
+from seven_cloudapp_frame.models.asset_base_model import *
+from seven_cloudapp_frame.models.top_base_model import *
+from seven_cloudapp_frame.libs.customize.wechat_helper import *
+from seven_cloudapp_frame.libs.customize.tiktok_helper import *
+from seven_cloudapp_frame.libs.customize.riskmanage_helper import *
+
+class LoginHandler(ClientBaseHandler):
+    """
+    :description: 登录处理
+    """
+    @filter_check_current_limit()
+    def get_async(self):
+        """
+        :description: 登录处理
+        :param act_id：活动标识
+        :param module_id：活动模块标识
+        :param avatar：头像
+        :return:
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        open_id = self.get_param("open_id")
+        user_nick = self.get_user_nick()
+        mix_nick = self.get_param("mix_nick")
+        act_id = self.get_act_id()
+        module_id = int(self.get_param("module_id", 0))
+        avatar = self.get_param("avatar")
+        code = self.get_param("code", "")
+        anonymous_code = self.get_param("anonymous_code", "")
+        pt = self.get_param("pt", "tb")  #tb淘宝 tt抖音 wx微信 jd京东 qq h5
+
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        is_update_user_nick = invoke_result_data.data["is_update_user_nick"] if invoke_result_data.data.__contains__("is_update_user_nick") else True
+        login_ip = self.get_remote_ip()
+        union_id = ""
+        if pt == "wx" and code:
+            invoke_result_data = WeChatHelper.code2_session(code, app_id=share_config.get_value("app_id"), app_secret=share_config.get_value("app_secret"))
+            if invoke_result_data.success == False:
+                return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+            open_id =  invoke_result_data.data["openid"]
+            union_id =  invoke_result_data.data.get("unionid","")
+        elif pt == "tt" and code:
+            invoke_result_data = TikTokHelper.code2_session(code, anonymous_code, app_id=share_config.get_value("app_id"), app_secret=share_config.get_value("app_secret"))
+            if invoke_result_data.success == False:
+                return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+            open_id = invoke_result_data.data["openid"]
+        else:
+            login_ip = self.get_param("source_ip")
+
+        user_base_model = UserBaseModel(context=self)
+        invoke_result_data = user_base_model.save_user_by_openid(app_id, act_id, open_id, user_nick, avatar, union_id, login_ip, is_update_user_nick, mix_nick)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        invoke_result_data.data["user_nick"] = CryptographyHelper.emoji_base64_to_emoji(invoke_result_data.data["user_nick"])
+        if invoke_result_data.data["user_nick_encrypt"]:
+            invoke_result_data.data["user_nick"] = CryptographyHelper.base64_decrypt(invoke_result_data.data["user_nick_encrypt"])
+        ref_params = {}
+        ref_params["app_id"] = app_id
+        ref_params["act_id"] = act_id
+        ref_params["module_id"] = module_id
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success(invoke_result_data.data)
+
+    def business_process_executed(self, result_data, ref_params):
+        """
+        :description: 执行后事件
+        :param result_data:result_data
+        :param ref_params: 关联参数
+        :return:
+        :last_editors: HuangJianYi
+        """
+        user_info_dict = result_data.data
+        stat_base_model = StatBaseModel(context=self)
+        key_list_dict = {}
+        key_list_dict["VisitCountEveryDay"] = 1
+        key_list_dict["VisitManCountEveryDay"] = 1
+        key_list_dict["VisitManCountEveryDayIncrease"] = 1
+        stat_base_model.add_stat_list(ref_params["app_id"], ref_params["act_id"], ref_params["module_id"], user_info_dict["user_id"], user_info_dict["open_id"], key_list_dict)
+        return result_data
+
+
+class UpdateUserInfoHandler(ClientBaseHandler):
+    """
+    :description: 更新用户信息
+    """
+    @filter_check_params(check_user_code=True)
+    def get_async(self):
+        """
+        :description: 更新用户信息
+        :param act_id：活动标识
+        :param user_code：用户标识
+        :param avatar：头像
+        :param is_member_before：初始会员状态
+        :param is_favor_before：初始关注状态
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        open_id = self.get_param("open_id")
+        user_nick = self.get_user_nick()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        avatar = self.get_param("avatar")
+        is_member_before = int(self.get_param("is_member_before", -1))
+        is_favor_before = int(self.get_param("is_favor_before", -1))
+        invoke_result_data = InvokeResultData()
+        user_base_model = UserBaseModel(context=self)
+        invoke_result_data = user_base_model.update_user_info(app_id, act_id, user_id, open_id, user_nick, avatar, is_member_before, is_favor_before)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        else:
+            ref_params = {}
+            invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+            if invoke_result_data.success == False:
+                return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+            return self.response_json_success("更新成功")
+
+
+class CheckIsMemberHandler(ClientBaseHandler):
+    """
+    :description: 校验是否是店铺会员
+    """
+    def get_async(self):
+        """
+        :description: 校验是否是店铺会员
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        mix_nick = self.get_param("mix_nick")
+        is_log = int(self.get_param("is_log", 0))
+        is_log = True if is_log == 1 else False
+        app_base_model = AppBaseModel(context=self)
+        app_info_dict = app_base_model.get_app_info_dict(app_id=app_id,is_cache=True,field="access_token")
+        if not app_info_dict:
+            return self.response_json_error("error", "小程序不存在")
+        access_token = app_info_dict["access_token"]
+        if access_token == "":
+            return self.response_json_error("error", "未授权请联系客服授权")
+        top_base_model = TopBaseModel(context=self)
+        app_key,app_secret = self.get_app_key_secret()
+        return self.response_json_success(top_base_model.check_is_member(mix_nick,"", access_token, app_key, app_secret, is_log))
+
+
+class GetCrmIntegralHandler(ClientBaseHandler):
+    """
+    :description: 获取店铺会员积分
+    """
+    @filter_check_params()
+    def get_async(self):
+        """
+        :description: 获取店铺会员积分
+        :return: 店铺会员积分
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        open_id = self.get_open_id()
+        mix_nick = self.get_param("mix_nick")
+        is_log = int(self.get_param("is_log", 0))
+        is_log = True if is_log == 1 else False
+        app_base_model = AppBaseModel(context=self)
+        app_info_dict = app_base_model.get_app_info_dict(app_id=app_id,is_cache=True,field="access_token")
+        if not app_info_dict:
+            return self.response_json_error("error", "小程序不存在")
+        access_token = app_info_dict["access_token"]
+        if access_token == "":
+            return self.response_json_error("error", "未授权请联系客服授权")
+        top_base_model = TopBaseModel(context=self)
+        app_key, app_secret = self.get_app_key_secret()
+        invoke_result_data = top_base_model.get_crm_point_available(mix_nick, access_token, app_key, app_secret, is_log, open_id)
+        if invoke_result_data.success == False:
+            return self.reponse_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        shop_member_integral = invoke_result_data.data
+        return self.reponse_json_success(shop_member_integral)
+
+
+class ApplyBlackUnbindHandler(ClientBaseHandler):
+    """
+    :description: 提交黑名单解封申请
+    """
+    @filter_check_params(check_user_code=True)
+    def get_async(self):
+        """
+        :description: 提交黑名单解封申请
+        :param act_id:活动标识
+        :param user_code:用户标识
+        :param reason:解封理由
+        :return 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        open_id = self.get_param("open_id")
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        reason = self.get_param("reason", "误封号,申请解封")
+        invoke_result_data = InvokeResultData()
+        user_base_model = UserBaseModel(context=self)
+        invoke_result_data = user_base_model.apply_black_unbind(app_id, act_id, user_id, open_id, reason)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        else:
+            return self.response_json_success()
+
+
+class GetUnbindApplyHandler(ClientBaseHandler):
+    """
+    :description: 获取黑名单解封申请记录
+    """
+    @filter_check_params(check_user_code=True)
+    def get_async(self):
+        """
+        :description: 获取黑名单解封申请记录
+        :param act_id:活动标识
+        :param user_code:用户标识
+        :param reason:解封理由
+        :return 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        user_base_model = UserBaseModel(context=self)
+        return self.response_json_success(user_base_model.get_black_info_dict(app_id, act_id, user_id))
+
+
+class GetCouponPrizeHandler(ClientBaseHandler):
+    """
+    :description: 领取淘宝优惠券
+    """
+    @filter_check_params("user_prize_id", check_user_code=True)
+    def get_async(self):
+        """
+        :description: 领取淘宝优惠券（发奖接口）
+        :param user_prize_id:用户奖品标识
+        :param user_code:用户标识
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        user_prize_id = int(self.get_param("user_prize_id", 0))
+        is_log = int(self.get_param("is_log", 0))
+        is_log = True if is_log == 1 else False
+        order_base_model = OrderBaseModel(context=self)
+        app_key, app_secret = self.get_app_key_secret()
+        invoke_result_data = order_base_model.get_coupon_prize(app_id, act_id, user_id, user_prize_id, app_key, app_secret, is_log)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message, invoke_result_data.data)
+        else:
+            return self.response_json_success(self.business_process_executed(invoke_result_data.data, ref_params={}))
+
+
+class GetUserAssetHandler(ClientBaseHandler):
+    """
+    :description: 获取单条用户资产
+    """
+    @filter_check_params("asset_type", check_user_code=True)
+    def get_async(self):
+        """
+        :description: 获取单条用户资产
+        :param act_id：活动标识
+        :param user_code：用户标识
+        :param asset_type：资产类型(1-次数2-积分3-价格档位)
+        :param asset_object_id：资产对象标识
+        :return list
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        asset_type = int(self.get_param("asset_type", 0))
+        asset_object_id = self.get_param("asset_object_id", "")
+        asset_base_model = AssetBaseModel(context=self)
+        return self.response_json_success(self.business_process_executed(asset_base_model.get_user_asset(app_id, act_id, user_id, asset_type, asset_object_id), ref_params={}))
+
+
+class UserAssetListHandler(ClientBaseHandler):
+    """
+    :description: 获取用户资产列表
+    """
+    @filter_check_params(check_user_code=True)
+    def get_async(self):
+        """
+        :description: 获取用户资产列表
+        :param act_id：活动标识
+        :param user_code：用户标识
+        :param asset_type：资产类型(1-次数2-积分3-价格档位)
+        :return list
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        asset_type = int(self.get_param("asset_type", 0))
+        asset_base_model = AssetBaseModel(context=self)
+        return self.response_json_success(self.business_process_executed(asset_base_model.get_user_asset_list(app_id, act_id, user_id, asset_type), ref_params={}))
+
+
+class AssetLogListHandler(ClientBaseHandler):
+    """
+    :description: 资产流水记录
+    """
+    @filter_check_params("asset_type", check_user_code=True)
+    def get_async(self):
+        """
+        :description: 资产流水记录
+        :param act_id：活动标识
+        :param module_id：模块标识
+        :param user_code：用户标识
+        :param asset_type：资产类型(1-次数2-积分3-价格档位))
+        :param asset_object_id：资产对象标识
+        :param operate_type：操作类型(0累计 1消耗
+        :param page_size：条数
+        :param page_index：页数
+        :param page_count_mode：分页模式(0-none 1-total 2-next)
+        :return list
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        module_id = self.get_param_int("module_id", 0)
+        page_index = self.get_param_int("page_index", 0)
+        page_size = self.get_param_int("page_size", 20)
+        asset_type = self.get_param_int("asset_type", 0)
+        asset_object_id = self.get_param("asset_object_id")
+        operate_type = self.get_param_int("operate_type", -1)
+        page_count_mode = self.get_param_int("page_count_mode", 1)
+
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_success({"data": []})
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        field = invoke_result_data.data["field"] if invoke_result_data.data.__contains__("field") else "*"
+        asset_base_model = AssetBaseModel(context=self)
+        page_count_mode = SevenHelper.get_enum_key(PageCountMode, page_count_mode)
+        page_list = asset_base_model.get_asset_log_list(app_id, act_id, asset_type, page_size, page_index, user_id, asset_object_id, field=field, is_cache=True, operate_type=operate_type, page_count_mode=page_count_mode, module_id=module_id)
+        if page_count_mode == "total":
+            total = page_list[1]
+            page_list = self.business_process_executed(page_list[0], ref_params={})
+            return_info = PageInfo(page_index, page_size, total, page_list)
+        elif page_count_mode == "next":
+            is_next = page_list[1]
+            page_list = self.business_process_executed(page_list[0], ref_params={})
+            return_info = WaterPageInfo(page_list, is_next)
+        else:
+            return_info = self.business_process_executed(page_list, ref_params={})
+        return self.response_json_success(return_info)
+
+
+class GetJoinMemberUrlHandler(ClientBaseHandler):
+    """
+    :description: 获取加入会员地址
+    """
+    def get_async(self):
+        """
+        :description: 获取加入会员地址
+        :return
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        is_log = int(self.get_param("is_log", 0))
+        is_log = True if is_log == 1 else False
+        app_base_model = AppBaseModel(context=self)
+        app_info_dict = app_base_model.get_app_info_dict(app_id=app_id,is_cache=True,field="access_token")
+        if not app_info_dict:
+            return self.response_json_error("error", "小程序不存在")
+        app_key, app_secret = self.get_app_key_secret()
+        user_base_model = UserBaseModel(context=self)
+        invoke_result_data = user_base_model.get_join_member_url(app_info_dict["access_token"], app_key, app_secret, is_log=is_log)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success(invoke_result_data.data)
+
+
+class UserAddressListHandler(ClientBaseHandler):
+    """
+    :description: 收货地址列表
+    """
+    @filter_check_params(check_user_code=True)
+    def get_async(self):
+        """
+        :param act_id：活动标识
+        :param user_code：用户标识
+        :return: list
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        user_base_model = UserBaseModel(context=self)
+        return self.response_json_success(user_base_model.get_user_address_list(app_id, act_id, user_id))
+
+
+class SaveUserAddressHandler(ClientBaseHandler):
+    """
+    :description: 保存收货地址
+    """
+    @filter_check_params("real_name,telephone", check_user_code=True)
+    def get_async(self):
+        """
+        :param act_id：活动标识
+        :param user_code：用户标识
+        :param is_default：是否默认地址（1是0否）
+        :param real_name：真实姓名
+        :param telephone：手机号码
+        :param province：省
+        :param city：市
+        :param county：区
+        :param street：街道
+        :param adress：地址
+        :return: dict
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        open_id = self.get_param("open_id")
+        user_address_id = int(self.get_param("user_address_id", 0))
+        real_name = self.get_param("real_name")
+        telephone = self.get_param("telephone")
+        province = self.get_param("province")
+        city = self.get_param("city")
+        county = self.get_param("county")
+        street = self.get_param("street")
+        address = self.get_param("address")
+        is_default = int(self.get_param("is_default", 0))
+        user_base_model = UserBaseModel(context=self)
+        return self.response_json_success(user_base_model.save_user_address(app_id, act_id, user_id, open_id, user_address_id, real_name, telephone, province, city, county, street, address, is_default))
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/handlers/filter_base.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/handlers/filter_base.py`

 * *Ordering differences only*

 * *Files 20% similar despite different names*

```diff
@@ -1,77 +1,77 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2022-04-24 15:15:19
-@LastEditTime: 2022-11-29 10:47:59
-@LastEditors: HuangJianYi
-@Description: 
-"""
-
-from seven_framework.web_tornado.base_handler.base_api_handler import *
-from seven_cloudapp_frame.libs.customize.seven_helper import *
-from seven_cloudapp_frame.libs.customize.cryptography_helper import *
-from seven_cloudapp_frame.libs.customize.riskmanage_helper import *
-from seven_cloudapp_frame.models.app_base_model import *
-from urllib.parse import parse_qs
-
-
-def filter_check_params(must_params=None, check_user_code=False):
-    """
-    :description: 参数过滤装饰器 仅限handler使用,
-                  提供参数的检查及获取参数功能
-                  装饰器使用方法:
-                  @client_filter_check_params("param_a,param_b,param_c")  或
-                  @client_filter_check_params(["param_a","param_b,param_c"])
-                  参数获取方法:
-                  self.request_params[param_key]
-    :param must_params: 必须传递的参数集合
-    :param check_user_code: 是否校验用户标识必传
-    :last_editors: HuangJianYi
-    """
-    def check_params(handler):
-        def wrapper(self, **args):
-            finally_must_params = must_params
-            if hasattr(self, "must_params"):
-                finally_must_params = self.must_params
-            if type(finally_must_params) == str:
-                must_array = finally_must_params.split(",")
-            if type(finally_must_params) == list:
-                must_array = finally_must_params
-
-            if finally_must_params:
-                for must_param in must_array:
-                    if not must_param in self.request_params or self.request_params[must_param] == "":
-                        self.response_json_error("param_error", f"参数错误,缺少必传参数{must_param}")
-                        return
-            if check_user_code == True and not self.get_user_id():
-                self.response_json_error("param_error", f"参数错误,缺少必传参数user_code")
-                return
-
-            return handler(self, **args)
-
-        return wrapper
-
-    return check_params
-
-
-def filter_check_current_limit():
-    """
-    :description: 流量限制过滤装饰器 仅限handler使用
-    :last_editors: HuangJianYi
-    """
-    def check_current(handler):
-        def wrapper(self, **args):
-            app_base_model = AppBaseModel(context=self)
-            app_id = self.get_app_id()
-            app_info_dict = app_base_model.get_app_info_dict(app_id,True,"current_limit_count")
-            if app_info_dict and RiskManageHelper.check_current_limit(app_id, app_info_dict["current_limit_count"]) == True:
-                self.response_json_error("current_limit", "当前人数过多,请稍后再试")
-                return
-
-            return handler(self, **args)
-
-        return wrapper
-
-    return check_current
-
-
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2022-04-24 15:15:19
+@LastEditTime: 2022-11-29 10:47:59
+@LastEditors: HuangJianYi
+@Description: 
+"""
+
+from seven_framework.web_tornado.base_handler.base_api_handler import *
+from seven_cloudapp_frame.libs.customize.seven_helper import *
+from seven_cloudapp_frame.libs.customize.cryptography_helper import *
+from seven_cloudapp_frame.libs.customize.riskmanage_helper import *
+from seven_cloudapp_frame.models.app_base_model import *
+from urllib.parse import parse_qs
+
+
+def filter_check_params(must_params=None, check_user_code=False):
+    """
+    :description: 参数过滤装饰器 仅限handler使用,
+                  提供参数的检查及获取参数功能
+                  装饰器使用方法:
+                  @client_filter_check_params("param_a,param_b,param_c")  或
+                  @client_filter_check_params(["param_a","param_b,param_c"])
+                  参数获取方法:
+                  self.request_params[param_key]
+    :param must_params: 必须传递的参数集合
+    :param check_user_code: 是否校验用户标识必传
+    :last_editors: HuangJianYi
+    """
+    def check_params(handler):
+        def wrapper(self, **args):
+            finally_must_params = must_params
+            if hasattr(self, "must_params"):
+                finally_must_params = self.must_params
+            if type(finally_must_params) == str:
+                must_array = finally_must_params.split(",")
+            if type(finally_must_params) == list:
+                must_array = finally_must_params
+
+            if finally_must_params:
+                for must_param in must_array:
+                    if not must_param in self.request_params or self.request_params[must_param] == "":
+                        self.response_json_error("param_error", f"参数错误,缺少必传参数{must_param}")
+                        return
+            if check_user_code == True and not self.get_user_id():
+                self.response_json_error("param_error", f"参数错误,缺少必传参数user_code")
+                return
+
+            return handler(self, **args)
+
+        return wrapper
+
+    return check_params
+
+
+def filter_check_current_limit():
+    """
+    :description: 流量限制过滤装饰器 仅限handler使用
+    :last_editors: HuangJianYi
+    """
+    def check_current(handler):
+        def wrapper(self, **args):
+            app_base_model = AppBaseModel(context=self)
+            app_id = self.get_app_id()
+            app_info_dict = app_base_model.get_app_info_dict(app_id,True,"current_limit_count")
+            if app_info_dict and RiskManageHelper.check_current_limit(app_id, app_info_dict["current_limit_count"]) == True:
+                self.response_json_error("current_limit", "当前人数过多,请稍后再试")
+                return
+
+            return handler(self, **args)
+
+        return wrapper
+
+    return check_current
+
+
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/handlers/frame_base.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/handlers/frame_base.py`

 * *Ordering differences only*

 * *Files 16% similar despite different names*

```diff
@@ -1,847 +1,847 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2022-04-24 15:15:19
-@LastEditTime: 2023-06-06 09:49:55
-@LastEditors: HuangJianYi
-@Description: 
-"""
-
-import ast
-import random
-import decimal
-import hashlib
-from copy import deepcopy
-from unittest import result
-from asq.initiators import query
-from urllib.parse import parse_qs, urlparse
-
-from seven_framework.redis import *
-from seven_framework.web_tornado.base_handler.base_api_handler import *
-
-from seven_cloudapp_frame.handlers.filter_base import *
-from seven_cloudapp_frame.libs.common import *
-from seven_cloudapp_frame.libs.customize.seven_helper import *
-from seven_cloudapp_frame.libs.customize.cryptography_helper import *
-from seven_cloudapp_frame.libs.customize.riskmanage_helper import *
-from seven_cloudapp_frame.models.enum import PlatType
-from seven_cloudapp_frame.models.seven_model import *
-from seven_cloudapp_frame.models.operate_base_model import *
-from seven_cloudapp_frame.models.user_base_model import *
-from seven_cloudapp_frame.models.db_models.app.app_info_model import *
-from seven_cloudapp_frame.models.db_models.act.act_info_model import *
-from seven_cloudapp_frame.models.db_models.operation.operation_log_model import *
-
-
-class FrameBaseHandler(BaseApiHandler):
-    """
-    :description: 公共handler基类
-    """
-
-    def get_http_log_extra_dict(self):
-        """
-        :Description: 获取http日志参数字典
-        :last_editors: HuangJianYi
-        """
-        dict_param = {}
-        if share_config.get_value("plat_type", PlatType.tb.value) != PlatType.web.value:  #平台类型：如果是web站点，从cookie取
-            dict_param["open_id"] = self.get_open_id()
-            if not dict_param["open_id"]:
-                dict_param["open_id"] = self.get_user_id()
-        else:
-            dict_param["open_id"] = self.get_cooke_user_id()
-        dict_param["nick_name"] = self.get_user_nick()
-        dict_param["app_id"] = self.get_app_id()
-        dict_param["source_type"] = self._request_source_type()
-        return dict_param
-
-    def prepare(self):
-        """
-        :Description: 置于任何请求方法前被调用(请勿重写此函数,可重写prepare_ext)
-        :last_editors: HuangJianYi
-        """
-        try:
-            if self.__class__.__name__ == "IndexHandler":
-                return
-            self.is_encrypt = False
-            #获取请求参数
-            self._convert_request_params()
-            # 标记日志请求关联
-            dict_param = self.get_http_log_extra_dict()
-            self._build_http_log(dict_param)
-            # 记录请求参数明文
-            if share_config.get_value("log_plain", True) == True and self.is_api_encrypt() == True:
-                self.logging_link_info(f"plain_request_params:{self.json_dumps(self.request_params)}")
-
-        except Exception as ex:
-            if not hasattr(self, "request_code"):
-                self.request_code = UUIDHelper.get_uuid()
-            self.logging_link_error("【公共handler基类】" + traceback.format_exc())
-
-    def options_async(self):
-        self.response_json_success()
-
-    def check_xsrf_cookie(self):
-        return
-
-    def set_default_headers(self):
-        allow_origin_list = share_config.get_value("allow_origin_list")
-        if allow_origin_list:
-            origin = self.request.headers.get("Origin")
-            if origin in allow_origin_list:
-                self.set_header("Access-Control-Allow-Origin", origin)
-
-        self.set_header("Access-Control-Allow-Headers", "Origin,X-Requested-With,Content-Type,Accept,User-Token,Manage-ProductID,Manage-PageID,PYCKET_ID")
-        self.set_header("Access-Control-Allow-Methods", "POST,GET,OPTIONS,PUT,DELETE")
-        self.set_header("Access-Control-Allow-Credentials", "true")
-
-    def json_dumps(self, rep_dic):
-        """
-        :description: 将字典转化为字符串
-        :param rep_dic：字典对象
-        :return: str
-        :last_editors: HuangJianYi
-        """
-        return SevenHelper.json_dumps(rep_dic)
-
-    def json_loads(self, rep_str):
-        """
-        :description: 将字符串转化为字典
-        :param rep_str：str
-        :return: dict
-        :last_editors: HuangJianYi
-        """
-        return SevenHelper.json_loads(rep_str)
-
-    def get_param(self, param_name, default="", strip=True, filter_sql=False, filter_special_key=False):
-        """
-        :description: 二次封装获取参数
-        :param param_name: 参数名
-        :param default: 如果无此参数，则返回默认值
-        :param filter_sql: 是否过滤sql关键字
-        :param filter_special_key: 是否过滤sql特殊字符
-        :return: 参数值
-        :last_editors: HuangJianYi
-        """
-        param_ret = ""
-
-        if self.request_params:
-            param_ret = self.request_params[param_name] if self.request_params.__contains__(param_name) else ""
-        else:
-            param_ret = self.get_argument(param_name, default, strip=strip)
-        if param_ret in ["undefined",None,""]:
-            param_ret = default
-        param_ret = RiskManageHelper.filter_routine_key(param_ret)
-        if filter_sql == True:
-            param_ret = RiskManageHelper.filter_sql(param_ret)
-        if filter_special_key == True:
-            param_ret = RiskManageHelper.filter_special_key(param_ret)
-        return param_ret
-
-    def get_param_int(self, param_name, default=0, strip=True, filter_sql=False, filter_special_key=False, throw_response_error=True, contain_list=[], range_list=[]):
-        """
-        :description: 二次封装获取参数转整形
-        :param param_name: 参数名
-        :param default: 如果无此参数，则返回默认值
-        :param filter_sql: 是否过滤sql关键字
-        :param filter_special_key: 是否过滤sql特殊字符
-        :param throw_response_error: 是否直接输出错误响应
-        :param contain_list: 包含列表，举例：[1,2,3,4]
-        :param range_list: 区间列表，只能有两个元素，举例：[1,10]
-        :param filter_special_key: 是否过滤sql特殊字符
-        :return: 转换后的参数值
-        :last_editors: HuangJianYi
-        """
-        from tornado.web import Finish
-        if not hasattr(self, "param_error_list"):
-            self.param_error_list = []
-        param = self.get_param(param_name, default, strip, filter_sql, filter_special_key)
-        param, status = SevenHelper.to_int(param, default, True)
-        if status == False:
-            log_info = {"param": param_name, "type": "int", "info": "参数格式错误"}
-            if throw_response_error == True:
-                self.response_json_error("param_error", log_info["info"], log_info)
-                raise Finish()
-            else:
-                self.param_error_list.append(log_info)
-        else:
-            if len(contain_list) > 0 and not param in contain_list:
-                log_info = {"param": param_name, "type": "int", "info": "参数不在包含范围内"}
-                if throw_response_error == True:
-                    self.response_json_error("param_error", log_info["info"], log_info)
-                    raise Finish()
-                else:
-                    self.param_error_list.append(log_info)
-
-            if len(range_list) == 2 and (param < range_list[0] or param > range_list[1]):
-                log_info = {"param": param_name, "type": "int", "info": "参数不在区间范围内"}
-                if throw_response_error == True:
-                    self.response_json_error("param_error", log_info["info"], log_info)
-                    raise Finish()
-                else:
-                    self.param_error_list.append(log_info)
-        return param
-
-    def get_param_decimal(self, param_name, default=0, strip=True, filter_sql=False, filter_special_key=False, throw_response_error=True):
-        """
-        :description: 二次封装获取参数转浮点
-        :param param_name: 参数名
-        :param default: 如果无此参数，则返回默认值
-        :param filter_sql: 是否过滤sql关键字
-        :param filter_special_key: 是否过滤sql特殊字符
-        :param throw_response_error: 是否直接输出错误响应
-        :return: 转换后的参数值
-        :last_editors: HuangJianYi
-        """
-        from tornado.web import Finish
-        if not hasattr(self, "param_error_list"):
-            self.param_error_list = []
-        param = self.get_param(param_name, default, strip, filter_sql, filter_special_key)
-        param, status = SevenHelper.to_decimal(param, default, True)
-        if status == False:
-            log_info = {"param": param_name, "type": "decimal", "info": "参数格式错误"}
-            if throw_response_error == True:
-                self.response_json_error("param_error", log_info["info"], log_info)
-                raise Finish()
-            else:
-                self.param_error_list.append(log_info)
-        return param
-
-    def get_param_datetime(self, param_name, default='1900-01-01 00:00:00', strip=True, filter_sql=False, filter_special_key=False, throw_response_error=True, fmt='%Y-%m-%d %H:%M:%S'):
-        """
-        :description: 二次封装获取参数转时间
-        :param param_name: 参数名
-        :param default: 如果无此参数，则返回默认值
-        :param filter_sql: 是否过滤sql关键字
-        :param filter_special_key: 是否过滤sql特殊字符
-        :param throw_response_error: 是否直接输出错误响应
-        :param fmt:时间格式化
-        :return: 转换后的参数值
-        :last_editors: HuangJianYi
-        """
-        from tornado.web import Finish
-        if not hasattr(self, "param_error_list"):
-            self.param_error_list = []
-        param = self.get_param(param_name, default, strip, filter_sql, filter_special_key)
-        param, status = SevenHelper.to_date_time(param, fmt, default, True)
-        if status == False:
-            log_info = {"param": param_name, "type": "datetime", "info": "参数格式错误"}
-            if throw_response_error == True:
-                self.response_json_error("param_error", log_info["info"], log_info)
-                raise Finish()
-            else:
-                self.param_error_list.append(log_info)
-        return param
-
-    def is_api_encrypt(self):
-        """
-        :Description: 校验是否加密
-        :last_editors: HuangJianYi
-        """
-        client_encrypt_type = share_config.get_value("client_encrypt_type", 0)  #客户端加密类型 0-无，1-aes加密
-        server_encrypt_type = share_config.get_value("server_encrypt_type", 0)  #千牛端或后台加密类型 0-无，1-aes加密
-        is_encrypt = False if hasattr(self, "is_encrypt") and self.is_encrypt == False else True
-        request_source_type = self._request_source_type()
-        if is_encrypt == True and (request_source_type == 2 and server_encrypt_type == 1) or (request_source_type == 1 and client_encrypt_type == 1):
-            return True
-        else:
-            return False
-
-    def _request_source_type(self):
-        """
-        :Description: 请求来源类型 0-未知 1-client(客户端) 2-server(服务端)
-        :last_editors: HuangJianYi
-        """
-        uri = self.request.uri
-        if "/client/" in uri:
-            return 1
-        elif "/server/" in uri:
-            return 2
-        else:
-            return share_config.get_value("source_type", 0)
-
-    def _get_encrypt_appkey(self, json_params):
-        """
-        :Description: 获取加解密appkey,取值顺序：app_id ——> source_app_id ——> app_key ——> app_id
-        :param json_params: json参数字典
-        :last_editors: HuangJianYi
-        """
-        app_key = None
-        if json_params:
-            app_key = json_params.get("app_id", "")
-            app_key = app_key if app_key else json_params.get("source_app_id", "")
-        if not app_key:
-            app_key = self.get_argument("app_id", "", strip=True)
-            app_key = app_key if app_key else self.get_argument("source_app_id", "", strip=True)
-            app_key = app_key if app_key else share_config.get_value("app_key")
-            app_key = app_key if app_key else share_config.get_value("app_id")
-        return app_key
-
-    def _convert_request_params(self):
-        """
-        :Description: 转换请求参数 post请求：Content-type必须为application/json，前端必须对对象进行序列化转成json字符串，不能直接传对象,否则无法接收参数,存在特殊字符的参数必须进行url编码，否则+会被变成空值
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        self.request_params = {}
-        self.content_type = ""
-        if self.is_api_encrypt() == True:
-            encrypt_key = share_config.get_value("encrypt_key", "r8C1JpyAXxrFV26V")
-            if hasattr(self, "encrypt_key"):
-                encrypt_key = self.encrypt_key
-            json_params = None
-            if "Content-Type" in self.request.headers and self.request.headers["Content-type"].lower().find("application/json") >= 0 and self.request.body:
-                self.content_type = "application/json"
-                json_params = json.loads(self.request.body)
-            app_id = self._get_encrypt_appkey(json_params)
-            if not app_id:
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "param_error"
-                invoke_result_data.error_message = "缺少必传参数"
-                return invoke_result_data
-            password = str(encrypt_key).replace("1", "l")
-            if self.content_type == "application/json":
-                try:
-                    if json_params:
-                        for field in json_params:
-                            self.request_params[field] = json_params[field]
-                        par = json_params["par"] if json_params.__contains__("par") else ""
-                        if self.request.headers and self.request.headers.get("Referer","").lower().find("/devtools/") >= 0:
-                            par = CodingHelper.url_decode(par)
-                        dv = json_params["dv"] if json_params.__contains__("dv") else ""
-                        if not par or not dv:
-                            invoke_result_data.success = False
-                            invoke_result_data.error_code = "error"
-                            invoke_result_data.error_message = "参数解析错误"
-                            return invoke_result_data
-                        iv = app_id[0:10] + str(dv)[0:6] if len(str(dv)) >= 6 else ""
-                        body_params = json.loads(CryptographyHelper.aes_decrypt(str(par), password, iv))
-                        for field in body_params:
-                            self.request_params[field] = body_params[field]
-                except:
-                    invoke_result_data.success = False
-                    invoke_result_data.error_code = "error"
-                    invoke_result_data.error_message = "参数解析错误"
-                    return invoke_result_data
-            else:
-                for field in self.request.arguments:
-                    self.request_params[field] = self.get_argument(field, "", strip=True)
-                if "par" in self.request.arguments and "dv" in self.request.arguments:
-                    par = self.get_argument("par", "", strip=True)
-                    if self.request.headers and self.request.headers.get("Referer","").lower().find("/devtools/") >= 0:
-                        par = CodingHelper.url_decode(par)
-                    dv = self.get_argument("dv", "", strip=True)
-                    iv = app_id[0:10] + str(dv)[0:6] if len(str(dv)) >= 6 else ""
-                    try:
-                        body_params = json.loads(CryptographyHelper.aes_decrypt(par, password, iv))
-                        for field in body_params:
-                            self.request_params[field] = body_params[field]
-                    except:
-                        invoke_result_data.success = False
-                        invoke_result_data.error_code = "error"
-                        invoke_result_data.error_message = "参数解析错误"
-                        return invoke_result_data
-                else:
-                    invoke_result_data.success = False
-                    invoke_result_data.error_code = "error"
-                    invoke_result_data.error_message = "参数解析错误"
-                    return invoke_result_data
-
-        else:
-            if "Content-Type" in self.request.headers and self.request.headers["Content-type"].lower().find("application/json") >= 0 and self.request.body:
-                try:
-                    self.content_type = "application/json"
-                    json_params = json.loads(self.request.body)
-                    if json_params:
-                        for field in json_params:
-                            self.request_params[field] = json_params[field]
-                except:
-                    pass
-            else:
-                for field in self.request.arguments:
-                    self.request_params[field] = self.get_argument(field, "", strip=True)
-
-        return invoke_result_data
-
-    def response_custom(self, rep_dic):
-        """
-        :description: 输出公共json模型
-        :param rep_dic: 字典类型数据
-        :return: 将dumps后的数据字符串返回给客户端
-        :last_editors: HuangJianYi
-        """
-        self.http_response(self.json_dumps(rep_dic))
-
-    def response_common(self, success=True, data=None, error_code="", error_message="", is_close_encrypt=False):
-        """
-        :description: 输出公共json模型
-        :param success: 布尔值，表示本次调用是否成功
-        :param data: 类型不限，调用成功（success为true）时，服务端返回的数据
-        :param errorCode: 字符串，调用失败（success为false）时，服务端返回的错误码
-        :param errorMessage: 字符串，调用失败（success为false）时，服务端返回的错误信息
-        :param is_close_encrypt: 是否关闭输出加密（True-是 False-否）
-        :return: 将dumps后的数据字符串返回给客户端   
-        :last_editors: HuangJianYi
-        """
-        if hasattr(data, '__dict__'):
-            data = data.__dict__
-        template_value = {}
-        template_value['success'] = success
-        is_encrypt = False if hasattr(self, "is_encrypt") and self.is_encrypt == False else True
-        if is_encrypt == False:
-            template_value['data'] = data
-        else:
-            if self.is_api_encrypt() == True:
-                json_params = None
-                if hasattr(self, "content_type") and self.content_type == "application/json":
-                    json_params = json.loads(self.request.body)
-                app_id = self._get_encrypt_appkey(json_params)
-                if app_id and is_close_encrypt == False:
-                    dv = SevenHelper.get_random(16)
-                    encrypt_key = share_config.get_value("encrypt_key", "r8C1JpyAXxrFV26V")
-                    if hasattr(self, "encrypt_key"):
-                        encrypt_key = self.encrypt_key
-                    password = str(encrypt_key).replace("1", "l")
-                    iv = app_id[0:10] + str(dv)[0:6] if len(str(dv)) >= 6 else ""
-                    template_value['data'] = CryptographyHelper.aes_encrypt(self.json_dumps(data), password, iv)
-                    template_value['dv'] = dv
-                    if share_config.get_value("log_plain", True) == True:
-                        self.logging_link_info(f"plain_response_data:{self.json_dumps(data)}")
-                else:
-                    template_value['data'] = data
-            else:
-                template_value['data'] = data
-        template_value['error_code'] = "error" if not error_code and success == False else error_code
-        template_value['error_message'] = "系统异常" if not error_message and success == False else error_message
-
-        rep_dic = {}
-        rep_dic['success'] = True
-        rep_dic['data'] = template_value
-
-        log_extra_dict = {}
-        log_extra_dict["is_success"] = 1
-        if success == False:
-            log_extra_dict["is_success"] = 0
-
-        self.http_reponse(self.json_dumps(rep_dic), log_extra_dict)
-
-    def response_json_success(self, data=None, is_close_encrypt=False):
-        """
-        :description: 通用成功返回json结构
-        :param data: 返回结果对象，即为数组，字典
-        :param is_close_encrypt: 是否关闭输出加密（True-是 False-否）
-        :return: 将dumps后的数据字符串返回给客户端
-        :last_editors: HuangJianYi
-        """
-        self.response_common(data=data, is_close_encrypt=is_close_encrypt)
-
-    def response_json_error(self, error_code="", error_message="", data=None, log_type=0):
-        """
-        :description: 通用错误返回json结构
-        :param errorCode: 字符串，调用失败（success为false）时，服务端返回的错误码
-        :param errorMessage: 字符串，调用失败（success为false）时，服务端返回的错误信息
-        :param data: 返回结果对象，即为数组，字典
-        :param log_type: 日志记录类型（0-不记录，1-info，2-error）
-        :return: 将dumps后的数据字符串返回给客户端
-        :last_editors: HuangJianYi
-        """
-        if log_type == 1:
-            self.logging_link_info(f"{error_code}\n{error_message}\n{data}\n{self.request}")
-        elif log_type == 2:
-            self.logging_link_error(f"{error_code}\n{error_message}\n{data}\n{self.request}")
-        self.response_common(False, data, error_code, error_message)
-
-    def response_json_error_params(self):
-        """
-        :description: 通用参数错误返回json结构
-        :param desc: 返错误描述
-        :return: 将dumps后的数据字符串返回给客户端
-        :last_editors: HuangJianYi
-        """
-        self.response_common(False, None, "params error", "参数错误")
-
-    def return_dict_error(self, error_code="", error_message=""):
-        """
-        :description: 返回error信息字典模型
-        :param errorCode: 字符串，服务端返回的错误码
-        :param errorMessage: 字符串，服务端返回的错误信息
-        :return: dict
-        :last_editors: HuangJianYi
-        """
-        rep_dic = {}
-        rep_dic['error_code'] = error_code
-        rep_dic['error_message'] = error_message
-
-        self.logging_link_error(f"{error_code}\n{error_message}\n{self.request}")
-
-        return rep_dic
-
-    def get_now_datetime(self):
-        """
-        :description: 获取当前时间
-        :return: str
-        :last_editors: HuangJianYi
-        """
-        return SevenHelper.get_now_datetime()
-
-    def create_order_id(self, ran=5):
-        """
-        :description: 生成订单号
-        :param ran：随机数位数，默认5位随机数（0-5）
-        :return: 25位的订单号
-        :last_editors: HuangJianYi
-        """
-        return SevenHelper.create_order_id(ran)
-
-    def get_app_key_secret(self):
-        """
-        :description: 获取app_key和app_secret
-        :param 
-        :return app_key, app_secret
-        :last_editors: HuangJianYi
-        """
-        app_key = share_config.get_value("app_key")
-        app_secret = share_config.get_value("app_secret")
-        return app_key, app_secret
-
-    def get_user_nick(self):
-        """
-        :description: 获取用户昵称
-        淘宝小程序 如果要在test和online环境指定账号打开后台测试，需由前端写死传入
-        :return str
-        :last_editors: HuangJianYi
-        """
-        user_nick = self.get_param("nick_name")
-        if not user_nick:
-            user_nick = self.get_param("user_nick")
-        plat_type = share_config.get_value("plat_type", PlatType.tb.value)  # 平台类型
-        if plat_type == PlatType.tb.value:
-            #淘宝小程序 source_app_id在本地环境返回空；在test和online环境返回后端模板id，无论在IDE还是千牛端
-            if self.get_param("source_app_id") == "":
-                test_config = share_config.get_value("test_config", {})
-                user_nick = test_config.get("user_nick", "")
-        return user_nick
-
-    def get_open_id(self):
-        """
-        :description: 获取open_id
-        :return str
-        :last_editors: HuangJianYi
-        """
-        open_id = self.get_param("open_id")
-        plat_type = share_config.get_value("plat_type", PlatType.tb.value)  # 平台类型
-        if plat_type == PlatType.tb.value:
-            if self.get_param("source_app_id") == "":
-                test_config = share_config.get_value("test_config", {})
-                open_id = test_config.get("open_id", "")
-        return open_id
-
-    def get_user_id(self):
-        """
-        :description: 获取user_id,后续新项目统一使用user_code,tb_user_id和user_id只做兼容旧项目使用保留
-        :param self
-        :return str
-        :last_editors: HuangJianYi
-        """
-        user_id = self.get_param_int("user_code")
-        if user_id == 0:
-            user_id = self.get_param_int("tb_user_id")
-            if user_id == 0:
-                user_id = self.get_param_int("user_id")
-        return user_id
-
-    def get_cooke_user_id(self):
-        """
-        :description: 获取cookie中的用户信息,适用场景H5
-        :return:
-        :last_editors: HuangJianYi
-        """
-        test_config = share_config.get_value("test_config", {})
-        user_id = test_config.get("user_id", 0)
-        if user_id <= 0:
-            cookie_user_id = int(self.get_cookie("user_id", 0))
-            cookie_user_id_md5 = self.get_cookie("user_id_md5", "")
-            check_user_id_md5 = CryptoHelper.md5_encrypt(str(cookie_user_id), share_config.get_value("cookie_encrypt_key", "r8C1JpyAXxrFV26V"))
-            if cookie_user_id <= 0 or cookie_user_id_md5 != check_user_id_md5:
-                user_id = 0
-            else:
-                user_id = cookie_user_id
-        return user_id
-
-    def set_cooke_user_id(self, user_id, expires_days=30):
-        """
-        :description: 设置user_id cookie
-        :param user_id: 用户标识
-        :param expires_days: 过期时间，单位天
-        :return:
-        :last_editors: HuangJianYi
-        """
-        user_id_md5 = CryptoHelper.md5_encrypt(str(user_id), share_config.get_value("cookie_encrypt_key", "r8C1JpyAXxrFV26V"))
-        self.set_cookie("user_id", str(user_id), expires_days=expires_days)
-        self.set_cookie("user_id_md5", user_id_md5, expires_days=expires_days)
-        self.set_cookie("user_token", UUIDHelper.get_uuid(), expires_days=expires_days)
-
-    def get_source_app_id(self):
-        """
-        :description: 废弃使用,获取source_app_id(客户端client使用)，旧项目有用到要换成get_app_id
-        :return str
-        :last_editors: HuangJianYi
-        """
-        #当有参数app_id时，优先取app_id，然后在是source_app_id
-        source_app_id = self.get_param("app_id")
-        if source_app_id:
-            return source_app_id
-        source_app_id = self.get_param("source_app_id")
-        plat_type = share_config.get_value("plat_type", PlatType.tb.value)  # 平台类型
-        if plat_type == PlatType.tb.value:
-            #淘宝小程序 在IDE上返回前端模板id，无论哪个环境；在千牛端上返回正确的小程序id
-            if source_app_id == share_config.get_value("client_template_id") or source_app_id == "":
-                test_config = share_config.get_value("test_config", {})
-                source_app_id = test_config.get("source_app_id", "")
-        if not source_app_id:
-            source_app_id = share_config.get_value("app_id")
-        return source_app_id
-
-    def get_app_id(self):
-        """
-        :description: 获取app_id
-        :return str
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_param("app_id")
-        if app_id:
-            return app_id
-        plat_type = share_config.get_value("plat_type", PlatType.tb.value)  # 平台类型
-        if plat_type == PlatType.tb.value:
-            if self._request_source_type() == 2:
-                user_nick = self.get_user_nick()
-                if user_nick:
-                    store_user_nick = user_nick.split(':')[0]
-                    if store_user_nick:
-                        app_info_model = AppInfoModel(context=self)
-                        app_info_dict = app_info_model.get_cache_dict(where="store_user_nick=%s", limit="0,1", field="app_id", params=store_user_nick)
-                        if app_info_dict:
-                            app_id = app_info_dict["app_id"]
-            elif self._request_source_type() == 1:
-                app_id = self.get_param("source_app_id")
-                #淘宝小程序 在IDE上返回前端模板id，无论哪个环境
-                if app_id == share_config.get_value("client_template_id") or app_id == "":
-                    test_config = share_config.get_value("test_config", {})
-                    app_id = test_config.get("source_app_id", "")
-        if not app_id:
-            app_id = share_config.get_value("app_id")
-        return app_id
-
-    def get_access_token(self):
-        """
-        :description: 获取access_token
-        :return str
-        :last_editors: HuangJianYi
-        """
-        access_token = self.get_param("access_token")
-        plat_type = share_config.get_value("plat_type", PlatType.tb.value)  # 平台类型
-        if plat_type == PlatType.tb.value:
-            env = self.get_param("env") if self.get_param("env") else config.get_value("env", "")
-            test_config = share_config.get_value("test_config", {})
-            if self.get_param("source_app_id") == "":  #使用场景：通过IDE工具进行测试
-                access_token = test_config.get("access_token", "")
-            elif env and env != 'online':  #使用场景：通过千牛端在测试环境进行测试
-                user_nick = self.get_param("user_nick", '')
-                store_user_nick = user_nick.split(':')[0]
-                if store_user_nick and store_user_nick == test_config.get("user_nick", ""):
-                    access_token = test_config.get("access_token", "")
-
-        return access_token
-
-    def get_act_id(self):
-        """
-        :description: 获取act_id 如果是测试环境，则默认取最新的活动，用于前端测试使用;如果都没有取配置文件的值，配置文件没配置设置默认值1;
-        :return int
-        :last_editors: HuangJianYi
-        """
-        act_id = self.get_param_int("act_id", -1)
-        if act_id >= 0:
-            return act_id
-        app_id = self.get_app_id()
-        env = self.get_param("env") if self.get_param("env") else config.get_value("env", "")
-        if env and env != 'online' and app_id:
-            act_info_model = ActInfoModel(context=self)
-            condition_where = ConditionWhere()
-            condition_where.add_condition("app_id=%s and is_release=1")
-            params = [app_id]
-            act_type = self.get_param_int("act_type", 0)
-            if act_type > 0:
-                condition_where.add_condition("act_type=%s")
-                params.append(act_type)
-            act_info_dict = act_info_model.get_cache_dict(where=condition_where.to_string(), order_by="id desc", field="id", params=params)
-            if act_info_dict:
-                act_id = act_info_dict["id"]
-                return act_id
-        act_id = share_config.get_value("act_id", 1)
-        return act_id
-
-    def create_operation_log(self, operation_type=1, model_name="", handler_name="", old_detail=None, update_detail=None, operate_user_id="", operate_user_name="", operate_role_id="", title="", operation_desc=""):
-        """
-        :description: 创建操作日志
-        :param operation_type：操作类型（查看枚举类OperationType）
-        :param model_name：模块或表名称（跟配置表对应）
-        :param handler_name：handler名称
-        :param old_detail：变更前对象
-        :param update_detail：变更后对象
-        :param operate_user_id：操作人标识
-        :param operate_user_name：操作人名称
-        :param operate_role_id：操作人角色标识
-        :param title：标题(对象)
-        :param operation_desc：描述
-        :param operation_ways：操作方式(1单一操作2批量操作)
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        plat_type = share_config.get_value("plat_type", PlatType.tb.value)
-        if plat_type == PlatType.tb.value:
-            if not operate_user_id:
-                operate_user_id = self.get_open_id()
-            if not operate_user_name:
-                operate_user_name = self.get_user_nick()
-        if not handler_name:
-            handler_name = self.__class__.__name__
-        operate_base_model = OperateBaseModel(context=self)
-        operate_base_model.add_operation_log(operation_type, title, operation_desc, model_name, handler_name, old_detail, update_detail, self.get_app_id(), self.get_act_id(), operate_user_id, operate_user_name, operate_role_id, {"request_params": self.request_params, "request": self.request}, self.get_remote_ip(), self.request_code)
-
-    def check_continue_request(self, handler_name, app_id, object_id, expire=100):
-        """
-        :description: 一个用户同一handler频繁请求校验，只对同用户同接口同请求参数进行限制
-        :param handler_name: handler名称
-        :param app_id: 应用标识
-        :param object_id: object_id(user_id或open_id)
-        :param expire: 间隔时间，单位毫秒
-        :return:满足频繁请求条件直接输出拦截
-        :last_editors: HuangJianYi
-        """
-        result = False, ""
-        if object_id and handler_name and app_id:
-            sign = CryptographyHelper.signature_md5(self.request_params)
-            if SevenHelper.is_continue_request(f"continue_request:{handler_name}_{app_id}_{object_id}_{sign}", expire) == True:
-                result = True, f"操作太频繁,请{expire}毫秒后再试"
-        return result
-
-    def business_process_executing(self):
-        """
-        :description: 执行前事件
-        :return:
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        invoke_result_data.data = {}
-        return invoke_result_data
-
-    def business_process_executed(self, result_data, ref_params):
-        """
-        :description: 执行后事件
-        :param result_data: result_data
-        :param ref_params: 关联参数
-        :return:
-        :last_editors: HuangJianYi
-        """
-        return result_data
-
-
-class ClientBaseHandler(FrameBaseHandler):
-    """
-    :description: 客户端handler基类
-    """
-
-    def prepare(self):
-        """
-        :Description: 置于任何请求方法前被调用(请勿重写此函数,可重写prepare_ext)
-        :last_editors: HuangJianYi
-        """
-        if self.__class__.__name__ == "IndexHandler":
-            return
-        try:
-            #获取并转换请求参数
-            invoke_result_data = self._convert_request_params()
-            if invoke_result_data.success == False:
-                self.request_code = UUIDHelper.get_uuid()
-                self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-                self.finish()
-                return
-            # 标记日志请求关联
-            dict_param = self.get_http_log_extra_dict()
-            self._build_http_log(dict_param)
-            # 是否加密模式
-            is_api_encrypt = self.is_api_encrypt()
-            # 记录请求参数明文
-            if share_config.get_value("log_plain", True) == True and is_api_encrypt == True:
-                self.logging_link_info(f"plain_request_params:{self.json_dumps(self.request_params)}")
-            # 验证超时 10秒过期
-            if is_api_encrypt == True:
-                now_time = TimeHelper.get_now_timestamp(True)
-                if self.request_params.__contains__("timestamp") and (now_time - int(self.request_params["timestamp"]) > int(1000 * 10)):
-                    self.response_json_error("timestamp", "超时操作")
-                    self.finish()
-                    return
-            # 防攻击校验
-            invoke_result_data = RiskManageHelper.check_attack_request(context=self)
-            if invoke_result_data.success == False:
-                self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-                self.finish()
-                return
-            # 频繁请求校验
-            if dict_param["open_id"] and self._request_source_type() == 1:
-                is_continue_request, error_message = self.check_continue_request(self.__class__.__name__, dict_param["app_id"], dict_param["open_id"])
-                if is_continue_request:
-                    self.response_json_error("error", error_message)
-                    self.finish()
-                    return
-                #每分钟流量UV计数,用于登录接口限制登录
-                RiskManageHelper.add_current_limit_count(str(dict_param["app_id"]), str(dict_param["open_id"]))
-            # 获取设备信息
-            self.device_info_dict = self.get_device_info_dict()
-
-        except Exception as ex:
-            if not hasattr(self, "request_code"):
-                self.request_code = UUIDHelper.get_uuid()
-            self.logging_link_error("【客户端handler基类】" + traceback.format_exc())
-
-    def get_device_info_dict(self):
-        """
-        :description: 获取头部参数字典
-        :last_editors: HuangJianYi
-        """
-        device_info_dict = {}
-        clientheaderinfo_string = self.request.headers._dict.get("Clientheaderinfo")
-        if clientheaderinfo_string:
-            info_model = parse_qs(clientheaderinfo_string)
-            device_info_dict["pid"] = (info_model["pid"][0])  # 产品标识
-            device_info_dict["chid"] = 0 if "chid" not in info_model.keys() else int(info_model["chid"][0])  # 渠道标识
-            device_info_dict["height"] = 0 if "height" not in info_model.keys() else int(float(info_model["height"][0]))  # 高度
-            device_info_dict["width"] = 0 if "width" not in info_model.keys() else int(float(info_model["width"][0]))  # 宽度
-            device_info_dict["version"] = "" if "version" not in info_model.keys() else info_model["version"][0]  # 客户端版本号
-            device_info_dict["app_version"] = "" if "app_version" not in info_model.keys() else info_model["app_version"][0]  # 小程序版本号
-            device_info_dict["net"] = "" if "net" not in info_model.keys() else info_model["net"][0]  # 网络
-            device_info_dict["model_p"] = "" if "model" not in info_model.keys() else info_model["model"][0]  # 机型
-            device_info_dict["lang"] = "" if "lang" not in info_model.keys() else info_model["lang"][0]  #语言
-            device_info_dict["ver_no"] = "" if "ver_no" not in info_model.keys() else info_model["ver_no"][0]  #接口版本号
-            device_info_dict["timestamp"] = 0 if "timestamp" not in info_model.keys() else int(info_model["timestamp"][0])  # 时间搓毫秒
-            device_info_dict["signature_md5"] = "" if "signature_md5" not in info_model.keys() else info_model["signature_md5"][0]  # 签名md5
-        return device_info_dict
-
-    def emoji_base64_to_emoji(self, text_str):
-        """
-        :description: 把加密后的表情还原
-        :param text_str: 加密后的字符串
-        :return: 解密后的表情字符串
-        :last_editors: HuangJianYi 
-        """
-        return CryptographyHelper.emoji_base64_to_emoji(text_str)
-
-    def emoji_to_emoji_base64(self, text_str):
-        """
-        :description: emoji表情转为[em_xxx]形式存于数据库,打包每一个emoji
-        :description: 性能遇到问题时重新设计转换程序
-        :param text_str: 未加密的字符串
-        :return: 解密后的表情字符串
-        :last_editors: HuangJianYi 
-        """
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2022-04-24 15:15:19
+@LastEditTime: 2023-06-06 09:49:55
+@LastEditors: HuangJianYi
+@Description: 
+"""
+
+import ast
+import random
+import decimal
+import hashlib
+from copy import deepcopy
+from unittest import result
+from asq.initiators import query
+from urllib.parse import parse_qs, urlparse
+
+from seven_framework.redis import *
+from seven_framework.web_tornado.base_handler.base_api_handler import *
+
+from seven_cloudapp_frame.handlers.filter_base import *
+from seven_cloudapp_frame.libs.common import *
+from seven_cloudapp_frame.libs.customize.seven_helper import *
+from seven_cloudapp_frame.libs.customize.cryptography_helper import *
+from seven_cloudapp_frame.libs.customize.riskmanage_helper import *
+from seven_cloudapp_frame.models.enum import PlatType
+from seven_cloudapp_frame.models.seven_model import *
+from seven_cloudapp_frame.models.operate_base_model import *
+from seven_cloudapp_frame.models.user_base_model import *
+from seven_cloudapp_frame.models.db_models.app.app_info_model import *
+from seven_cloudapp_frame.models.db_models.act.act_info_model import *
+from seven_cloudapp_frame.models.db_models.operation.operation_log_model import *
+
+
+class FrameBaseHandler(BaseApiHandler):
+    """
+    :description: 公共handler基类
+    """
+
+    def get_http_log_extra_dict(self):
+        """
+        :Description: 获取http日志参数字典
+        :last_editors: HuangJianYi
+        """
+        dict_param = {}
+        if share_config.get_value("plat_type", PlatType.tb.value) != PlatType.web.value:  #平台类型：如果是web站点，从cookie取
+            dict_param["open_id"] = self.get_open_id()
+            if not dict_param["open_id"]:
+                dict_param["open_id"] = self.get_user_id()
+        else:
+            dict_param["open_id"] = self.get_cooke_user_id()
+        dict_param["nick_name"] = self.get_user_nick()
+        dict_param["app_id"] = self.get_app_id()
+        dict_param["source_type"] = self._request_source_type()
+        return dict_param
+
+    def prepare(self):
+        """
+        :Description: 置于任何请求方法前被调用(请勿重写此函数,可重写prepare_ext)
+        :last_editors: HuangJianYi
+        """
+        try:
+            if self.__class__.__name__ == "IndexHandler":
+                return
+            self.is_encrypt = False
+            #获取请求参数
+            self._convert_request_params()
+            # 标记日志请求关联
+            dict_param = self.get_http_log_extra_dict()
+            self._build_http_log(dict_param)
+            # 记录请求参数明文
+            if share_config.get_value("log_plain", True) == True and self.is_api_encrypt() == True:
+                self.logging_link_info(f"plain_request_params:{self.json_dumps(self.request_params)}")
+
+        except Exception as ex:
+            if not hasattr(self, "request_code"):
+                self.request_code = UUIDHelper.get_uuid()
+            self.logging_link_error("【公共handler基类】" + traceback.format_exc())
+
+    def options_async(self):
+        self.response_json_success()
+
+    def check_xsrf_cookie(self):
+        return
+
+    def set_default_headers(self):
+        allow_origin_list = share_config.get_value("allow_origin_list")
+        if allow_origin_list:
+            origin = self.request.headers.get("Origin")
+            if origin in allow_origin_list:
+                self.set_header("Access-Control-Allow-Origin", origin)
+
+        self.set_header("Access-Control-Allow-Headers", "Origin,X-Requested-With,Content-Type,Accept,User-Token,Manage-ProductID,Manage-PageID,PYCKET_ID")
+        self.set_header("Access-Control-Allow-Methods", "POST,GET,OPTIONS,PUT,DELETE")
+        self.set_header("Access-Control-Allow-Credentials", "true")
+
+    def json_dumps(self, rep_dic):
+        """
+        :description: 将字典转化为字符串
+        :param rep_dic：字典对象
+        :return: str
+        :last_editors: HuangJianYi
+        """
+        return SevenHelper.json_dumps(rep_dic)
+
+    def json_loads(self, rep_str):
+        """
+        :description: 将字符串转化为字典
+        :param rep_str：str
+        :return: dict
+        :last_editors: HuangJianYi
+        """
+        return SevenHelper.json_loads(rep_str)
+
+    def get_param(self, param_name, default="", strip=True, filter_sql=False, filter_special_key=False):
+        """
+        :description: 二次封装获取参数
+        :param param_name: 参数名
+        :param default: 如果无此参数，则返回默认值
+        :param filter_sql: 是否过滤sql关键字
+        :param filter_special_key: 是否过滤sql特殊字符
+        :return: 参数值
+        :last_editors: HuangJianYi
+        """
+        param_ret = ""
+
+        if self.request_params:
+            param_ret = self.request_params[param_name] if self.request_params.__contains__(param_name) else ""
+        else:
+            param_ret = self.get_argument(param_name, default, strip=strip)
+        if param_ret in ["undefined",None,""]:
+            param_ret = default
+        param_ret = RiskManageHelper.filter_routine_key(param_ret)
+        if filter_sql == True:
+            param_ret = RiskManageHelper.filter_sql(param_ret)
+        if filter_special_key == True:
+            param_ret = RiskManageHelper.filter_special_key(param_ret)
+        return param_ret
+
+    def get_param_int(self, param_name, default=0, strip=True, filter_sql=False, filter_special_key=False, throw_response_error=True, contain_list=[], range_list=[]):
+        """
+        :description: 二次封装获取参数转整形
+        :param param_name: 参数名
+        :param default: 如果无此参数，则返回默认值
+        :param filter_sql: 是否过滤sql关键字
+        :param filter_special_key: 是否过滤sql特殊字符
+        :param throw_response_error: 是否直接输出错误响应
+        :param contain_list: 包含列表，举例：[1,2,3,4]
+        :param range_list: 区间列表，只能有两个元素，举例：[1,10]
+        :param filter_special_key: 是否过滤sql特殊字符
+        :return: 转换后的参数值
+        :last_editors: HuangJianYi
+        """
+        from tornado.web import Finish
+        if not hasattr(self, "param_error_list"):
+            self.param_error_list = []
+        param = self.get_param(param_name, default, strip, filter_sql, filter_special_key)
+        param, status = SevenHelper.to_int(param, default, True)
+        if status == False:
+            log_info = {"param": param_name, "type": "int", "info": "参数格式错误"}
+            if throw_response_error == True:
+                self.response_json_error("param_error", log_info["info"], log_info)
+                raise Finish()
+            else:
+                self.param_error_list.append(log_info)
+        else:
+            if len(contain_list) > 0 and not param in contain_list:
+                log_info = {"param": param_name, "type": "int", "info": "参数不在包含范围内"}
+                if throw_response_error == True:
+                    self.response_json_error("param_error", log_info["info"], log_info)
+                    raise Finish()
+                else:
+                    self.param_error_list.append(log_info)
+
+            if len(range_list) == 2 and (param < range_list[0] or param > range_list[1]):
+                log_info = {"param": param_name, "type": "int", "info": "参数不在区间范围内"}
+                if throw_response_error == True:
+                    self.response_json_error("param_error", log_info["info"], log_info)
+                    raise Finish()
+                else:
+                    self.param_error_list.append(log_info)
+        return param
+
+    def get_param_decimal(self, param_name, default=0, strip=True, filter_sql=False, filter_special_key=False, throw_response_error=True):
+        """
+        :description: 二次封装获取参数转浮点
+        :param param_name: 参数名
+        :param default: 如果无此参数，则返回默认值
+        :param filter_sql: 是否过滤sql关键字
+        :param filter_special_key: 是否过滤sql特殊字符
+        :param throw_response_error: 是否直接输出错误响应
+        :return: 转换后的参数值
+        :last_editors: HuangJianYi
+        """
+        from tornado.web import Finish
+        if not hasattr(self, "param_error_list"):
+            self.param_error_list = []
+        param = self.get_param(param_name, default, strip, filter_sql, filter_special_key)
+        param, status = SevenHelper.to_decimal(param, default, True)
+        if status == False:
+            log_info = {"param": param_name, "type": "decimal", "info": "参数格式错误"}
+            if throw_response_error == True:
+                self.response_json_error("param_error", log_info["info"], log_info)
+                raise Finish()
+            else:
+                self.param_error_list.append(log_info)
+        return param
+
+    def get_param_datetime(self, param_name, default='1900-01-01 00:00:00', strip=True, filter_sql=False, filter_special_key=False, throw_response_error=True, fmt='%Y-%m-%d %H:%M:%S'):
+        """
+        :description: 二次封装获取参数转时间
+        :param param_name: 参数名
+        :param default: 如果无此参数，则返回默认值
+        :param filter_sql: 是否过滤sql关键字
+        :param filter_special_key: 是否过滤sql特殊字符
+        :param throw_response_error: 是否直接输出错误响应
+        :param fmt:时间格式化
+        :return: 转换后的参数值
+        :last_editors: HuangJianYi
+        """
+        from tornado.web import Finish
+        if not hasattr(self, "param_error_list"):
+            self.param_error_list = []
+        param = self.get_param(param_name, default, strip, filter_sql, filter_special_key)
+        param, status = SevenHelper.to_date_time(param, fmt, default, True)
+        if status == False:
+            log_info = {"param": param_name, "type": "datetime", "info": "参数格式错误"}
+            if throw_response_error == True:
+                self.response_json_error("param_error", log_info["info"], log_info)
+                raise Finish()
+            else:
+                self.param_error_list.append(log_info)
+        return param
+
+    def is_api_encrypt(self):
+        """
+        :Description: 校验是否加密
+        :last_editors: HuangJianYi
+        """
+        client_encrypt_type = share_config.get_value("client_encrypt_type", 0)  #客户端加密类型 0-无，1-aes加密
+        server_encrypt_type = share_config.get_value("server_encrypt_type", 0)  #千牛端或后台加密类型 0-无，1-aes加密
+        is_encrypt = False if hasattr(self, "is_encrypt") and self.is_encrypt == False else True
+        request_source_type = self._request_source_type()
+        if is_encrypt == True and (request_source_type == 2 and server_encrypt_type == 1) or (request_source_type == 1 and client_encrypt_type == 1):
+            return True
+        else:
+            return False
+
+    def _request_source_type(self):
+        """
+        :Description: 请求来源类型 0-未知 1-client(客户端) 2-server(服务端)
+        :last_editors: HuangJianYi
+        """
+        uri = self.request.uri
+        if "/client/" in uri:
+            return 1
+        elif "/server/" in uri:
+            return 2
+        else:
+            return share_config.get_value("source_type", 0)
+
+    def _get_encrypt_appkey(self, json_params):
+        """
+        :Description: 获取加解密appkey,取值顺序：app_id ——> source_app_id ——> app_key ——> app_id
+        :param json_params: json参数字典
+        :last_editors: HuangJianYi
+        """
+        app_key = None
+        if json_params:
+            app_key = json_params.get("app_id", "")
+            app_key = app_key if app_key else json_params.get("source_app_id", "")
+        if not app_key:
+            app_key = self.get_argument("app_id", "", strip=True)
+            app_key = app_key if app_key else self.get_argument("source_app_id", "", strip=True)
+            app_key = app_key if app_key else share_config.get_value("app_key")
+            app_key = app_key if app_key else share_config.get_value("app_id")
+        return app_key
+
+    def _convert_request_params(self):
+        """
+        :Description: 转换请求参数 post请求：Content-type必须为application/json，前端必须对对象进行序列化转成json字符串，不能直接传对象,否则无法接收参数,存在特殊字符的参数必须进行url编码，否则+会被变成空值
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        self.request_params = {}
+        self.content_type = ""
+        if self.is_api_encrypt() == True:
+            encrypt_key = share_config.get_value("encrypt_key", "r8C1JpyAXxrFV26V")
+            if hasattr(self, "encrypt_key"):
+                encrypt_key = self.encrypt_key
+            json_params = None
+            if "Content-Type" in self.request.headers and self.request.headers["Content-type"].lower().find("application/json") >= 0 and self.request.body:
+                self.content_type = "application/json"
+                json_params = json.loads(self.request.body)
+            app_id = self._get_encrypt_appkey(json_params)
+            if not app_id:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "param_error"
+                invoke_result_data.error_message = "缺少必传参数"
+                return invoke_result_data
+            password = str(encrypt_key).replace("1", "l")
+            if self.content_type == "application/json":
+                try:
+                    if json_params:
+                        for field in json_params:
+                            self.request_params[field] = json_params[field]
+                        par = json_params["par"] if json_params.__contains__("par") else ""
+                        if self.request.headers and self.request.headers.get("Referer","").lower().find("/devtools/") >= 0:
+                            par = CodingHelper.url_decode(par)
+                        dv = json_params["dv"] if json_params.__contains__("dv") else ""
+                        if not par or not dv:
+                            invoke_result_data.success = False
+                            invoke_result_data.error_code = "error"
+                            invoke_result_data.error_message = "参数解析错误"
+                            return invoke_result_data
+                        iv = app_id[0:10] + str(dv)[0:6] if len(str(dv)) >= 6 else ""
+                        body_params = json.loads(CryptographyHelper.aes_decrypt(str(par), password, iv))
+                        for field in body_params:
+                            self.request_params[field] = body_params[field]
+                except:
+                    invoke_result_data.success = False
+                    invoke_result_data.error_code = "error"
+                    invoke_result_data.error_message = "参数解析错误"
+                    return invoke_result_data
+            else:
+                for field in self.request.arguments:
+                    self.request_params[field] = self.get_argument(field, "", strip=True)
+                if "par" in self.request.arguments and "dv" in self.request.arguments:
+                    par = self.get_argument("par", "", strip=True)
+                    if self.request.headers and self.request.headers.get("Referer","").lower().find("/devtools/") >= 0:
+                        par = CodingHelper.url_decode(par)
+                    dv = self.get_argument("dv", "", strip=True)
+                    iv = app_id[0:10] + str(dv)[0:6] if len(str(dv)) >= 6 else ""
+                    try:
+                        body_params = json.loads(CryptographyHelper.aes_decrypt(par, password, iv))
+                        for field in body_params:
+                            self.request_params[field] = body_params[field]
+                    except:
+                        invoke_result_data.success = False
+                        invoke_result_data.error_code = "error"
+                        invoke_result_data.error_message = "参数解析错误"
+                        return invoke_result_data
+                else:
+                    invoke_result_data.success = False
+                    invoke_result_data.error_code = "error"
+                    invoke_result_data.error_message = "参数解析错误"
+                    return invoke_result_data
+
+        else:
+            if "Content-Type" in self.request.headers and self.request.headers["Content-type"].lower().find("application/json") >= 0 and self.request.body:
+                try:
+                    self.content_type = "application/json"
+                    json_params = json.loads(self.request.body)
+                    if json_params:
+                        for field in json_params:
+                            self.request_params[field] = json_params[field]
+                except:
+                    pass
+            else:
+                for field in self.request.arguments:
+                    self.request_params[field] = self.get_argument(field, "", strip=True)
+
+        return invoke_result_data
+
+    def response_custom(self, rep_dic):
+        """
+        :description: 输出公共json模型
+        :param rep_dic: 字典类型数据
+        :return: 将dumps后的数据字符串返回给客户端
+        :last_editors: HuangJianYi
+        """
+        self.http_response(self.json_dumps(rep_dic))
+
+    def response_common(self, success=True, data=None, error_code="", error_message="", is_close_encrypt=False):
+        """
+        :description: 输出公共json模型
+        :param success: 布尔值，表示本次调用是否成功
+        :param data: 类型不限，调用成功（success为true）时，服务端返回的数据
+        :param errorCode: 字符串，调用失败（success为false）时，服务端返回的错误码
+        :param errorMessage: 字符串，调用失败（success为false）时，服务端返回的错误信息
+        :param is_close_encrypt: 是否关闭输出加密（True-是 False-否）
+        :return: 将dumps后的数据字符串返回给客户端   
+        :last_editors: HuangJianYi
+        """
+        if hasattr(data, '__dict__'):
+            data = data.__dict__
+        template_value = {}
+        template_value['success'] = success
+        is_encrypt = False if hasattr(self, "is_encrypt") and self.is_encrypt == False else True
+        if is_encrypt == False:
+            template_value['data'] = data
+        else:
+            if self.is_api_encrypt() == True:
+                json_params = None
+                if hasattr(self, "content_type") and self.content_type == "application/json":
+                    json_params = json.loads(self.request.body)
+                app_id = self._get_encrypt_appkey(json_params)
+                if app_id and is_close_encrypt == False:
+                    dv = SevenHelper.get_random(16)
+                    encrypt_key = share_config.get_value("encrypt_key", "r8C1JpyAXxrFV26V")
+                    if hasattr(self, "encrypt_key"):
+                        encrypt_key = self.encrypt_key
+                    password = str(encrypt_key).replace("1", "l")
+                    iv = app_id[0:10] + str(dv)[0:6] if len(str(dv)) >= 6 else ""
+                    template_value['data'] = CryptographyHelper.aes_encrypt(self.json_dumps(data), password, iv)
+                    template_value['dv'] = dv
+                    if share_config.get_value("log_plain", True) == True:
+                        self.logging_link_info(f"plain_response_data:{self.json_dumps(data)}")
+                else:
+                    template_value['data'] = data
+            else:
+                template_value['data'] = data
+        template_value['error_code'] = "error" if not error_code and success == False else error_code
+        template_value['error_message'] = "系统异常" if not error_message and success == False else error_message
+
+        rep_dic = {}
+        rep_dic['success'] = True
+        rep_dic['data'] = template_value
+
+        log_extra_dict = {}
+        log_extra_dict["is_success"] = 1
+        if success == False:
+            log_extra_dict["is_success"] = 0
+
+        self.http_reponse(self.json_dumps(rep_dic), log_extra_dict)
+
+    def response_json_success(self, data=None, is_close_encrypt=False):
+        """
+        :description: 通用成功返回json结构
+        :param data: 返回结果对象，即为数组，字典
+        :param is_close_encrypt: 是否关闭输出加密（True-是 False-否）
+        :return: 将dumps后的数据字符串返回给客户端
+        :last_editors: HuangJianYi
+        """
+        self.response_common(data=data, is_close_encrypt=is_close_encrypt)
+
+    def response_json_error(self, error_code="", error_message="", data=None, log_type=0):
+        """
+        :description: 通用错误返回json结构
+        :param errorCode: 字符串，调用失败（success为false）时，服务端返回的错误码
+        :param errorMessage: 字符串，调用失败（success为false）时，服务端返回的错误信息
+        :param data: 返回结果对象，即为数组，字典
+        :param log_type: 日志记录类型（0-不记录，1-info，2-error）
+        :return: 将dumps后的数据字符串返回给客户端
+        :last_editors: HuangJianYi
+        """
+        if log_type == 1:
+            self.logging_link_info(f"{error_code}\n{error_message}\n{data}\n{self.request}")
+        elif log_type == 2:
+            self.logging_link_error(f"{error_code}\n{error_message}\n{data}\n{self.request}")
+        self.response_common(False, data, error_code, error_message)
+
+    def response_json_error_params(self):
+        """
+        :description: 通用参数错误返回json结构
+        :param desc: 返错误描述
+        :return: 将dumps后的数据字符串返回给客户端
+        :last_editors: HuangJianYi
+        """
+        self.response_common(False, None, "params error", "参数错误")
+
+    def return_dict_error(self, error_code="", error_message=""):
+        """
+        :description: 返回error信息字典模型
+        :param errorCode: 字符串，服务端返回的错误码
+        :param errorMessage: 字符串，服务端返回的错误信息
+        :return: dict
+        :last_editors: HuangJianYi
+        """
+        rep_dic = {}
+        rep_dic['error_code'] = error_code
+        rep_dic['error_message'] = error_message
+
+        self.logging_link_error(f"{error_code}\n{error_message}\n{self.request}")
+
+        return rep_dic
+
+    def get_now_datetime(self):
+        """
+        :description: 获取当前时间
+        :return: str
+        :last_editors: HuangJianYi
+        """
+        return SevenHelper.get_now_datetime()
+
+    def create_order_id(self, ran=5):
+        """
+        :description: 生成订单号
+        :param ran：随机数位数，默认5位随机数（0-5）
+        :return: 25位的订单号
+        :last_editors: HuangJianYi
+        """
+        return SevenHelper.create_order_id(ran)
+
+    def get_app_key_secret(self):
+        """
+        :description: 获取app_key和app_secret
+        :param 
+        :return app_key, app_secret
+        :last_editors: HuangJianYi
+        """
+        app_key = share_config.get_value("app_key")
+        app_secret = share_config.get_value("app_secret")
+        return app_key, app_secret
+
+    def get_user_nick(self):
+        """
+        :description: 获取用户昵称
+        淘宝小程序 如果要在test和online环境指定账号打开后台测试，需由前端写死传入
+        :return str
+        :last_editors: HuangJianYi
+        """
+        user_nick = self.get_param("nick_name")
+        if not user_nick:
+            user_nick = self.get_param("user_nick")
+        plat_type = share_config.get_value("plat_type", PlatType.tb.value)  # 平台类型
+        if plat_type == PlatType.tb.value:
+            #淘宝小程序 source_app_id在本地环境返回空；在test和online环境返回后端模板id，无论在IDE还是千牛端
+            if self.get_param("source_app_id") == "":
+                test_config = share_config.get_value("test_config", {})
+                user_nick = test_config.get("user_nick", "")
+        return user_nick
+
+    def get_open_id(self):
+        """
+        :description: 获取open_id
+        :return str
+        :last_editors: HuangJianYi
+        """
+        open_id = self.get_param("open_id")
+        plat_type = share_config.get_value("plat_type", PlatType.tb.value)  # 平台类型
+        if plat_type == PlatType.tb.value:
+            if self.get_param("source_app_id") == "":
+                test_config = share_config.get_value("test_config", {})
+                open_id = test_config.get("open_id", "")
+        return open_id
+
+    def get_user_id(self):
+        """
+        :description: 获取user_id,后续新项目统一使用user_code,tb_user_id和user_id只做兼容旧项目使用保留
+        :param self
+        :return str
+        :last_editors: HuangJianYi
+        """
+        user_id = self.get_param_int("user_code")
+        if user_id == 0:
+            user_id = self.get_param_int("tb_user_id")
+            if user_id == 0:
+                user_id = self.get_param_int("user_id")
+        return user_id
+
+    def get_cooke_user_id(self):
+        """
+        :description: 获取cookie中的用户信息,适用场景H5
+        :return:
+        :last_editors: HuangJianYi
+        """
+        test_config = share_config.get_value("test_config", {})
+        user_id = test_config.get("user_id", 0)
+        if user_id <= 0:
+            cookie_user_id = int(self.get_cookie("user_id", 0))
+            cookie_user_id_md5 = self.get_cookie("user_id_md5", "")
+            check_user_id_md5 = CryptoHelper.md5_encrypt(str(cookie_user_id), share_config.get_value("cookie_encrypt_key", "r8C1JpyAXxrFV26V"))
+            if cookie_user_id <= 0 or cookie_user_id_md5 != check_user_id_md5:
+                user_id = 0
+            else:
+                user_id = cookie_user_id
+        return user_id
+
+    def set_cooke_user_id(self, user_id, expires_days=30):
+        """
+        :description: 设置user_id cookie
+        :param user_id: 用户标识
+        :param expires_days: 过期时间，单位天
+        :return:
+        :last_editors: HuangJianYi
+        """
+        user_id_md5 = CryptoHelper.md5_encrypt(str(user_id), share_config.get_value("cookie_encrypt_key", "r8C1JpyAXxrFV26V"))
+        self.set_cookie("user_id", str(user_id), expires_days=expires_days)
+        self.set_cookie("user_id_md5", user_id_md5, expires_days=expires_days)
+        self.set_cookie("user_token", UUIDHelper.get_uuid(), expires_days=expires_days)
+
+    def get_source_app_id(self):
+        """
+        :description: 废弃使用,获取source_app_id(客户端client使用)，旧项目有用到要换成get_app_id
+        :return str
+        :last_editors: HuangJianYi
+        """
+        #当有参数app_id时，优先取app_id，然后在是source_app_id
+        source_app_id = self.get_param("app_id")
+        if source_app_id:
+            return source_app_id
+        source_app_id = self.get_param("source_app_id")
+        plat_type = share_config.get_value("plat_type", PlatType.tb.value)  # 平台类型
+        if plat_type == PlatType.tb.value:
+            #淘宝小程序 在IDE上返回前端模板id，无论哪个环境；在千牛端上返回正确的小程序id
+            if source_app_id == share_config.get_value("client_template_id") or source_app_id == "":
+                test_config = share_config.get_value("test_config", {})
+                source_app_id = test_config.get("source_app_id", "")
+        if not source_app_id:
+            source_app_id = share_config.get_value("app_id")
+        return source_app_id
+
+    def get_app_id(self):
+        """
+        :description: 获取app_id
+        :return str
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_param("app_id")
+        if app_id:
+            return app_id
+        plat_type = share_config.get_value("plat_type", PlatType.tb.value)  # 平台类型
+        if plat_type == PlatType.tb.value:
+            if self._request_source_type() == 2:
+                user_nick = self.get_user_nick()
+                if user_nick:
+                    store_user_nick = user_nick.split(':')[0]
+                    if store_user_nick:
+                        app_info_model = AppInfoModel(context=self)
+                        app_info_dict = app_info_model.get_cache_dict(where="store_user_nick=%s", limit="0,1", field="app_id", params=store_user_nick)
+                        if app_info_dict:
+                            app_id = app_info_dict["app_id"]
+            elif self._request_source_type() == 1:
+                app_id = self.get_param("source_app_id")
+                #淘宝小程序 在IDE上返回前端模板id，无论哪个环境
+                if app_id == share_config.get_value("client_template_id") or app_id == "":
+                    test_config = share_config.get_value("test_config", {})
+                    app_id = test_config.get("source_app_id", "")
+        if not app_id:
+            app_id = share_config.get_value("app_id")
+        return app_id
+
+    def get_access_token(self):
+        """
+        :description: 获取access_token
+        :return str
+        :last_editors: HuangJianYi
+        """
+        access_token = self.get_param("access_token")
+        plat_type = share_config.get_value("plat_type", PlatType.tb.value)  # 平台类型
+        if plat_type == PlatType.tb.value:
+            env = self.get_param("env") if self.get_param("env") else config.get_value("env", "")
+            test_config = share_config.get_value("test_config", {})
+            if self.get_param("source_app_id") == "":  #使用场景：通过IDE工具进行测试
+                access_token = test_config.get("access_token", "")
+            elif env and env != 'online':  #使用场景：通过千牛端在测试环境进行测试
+                user_nick = self.get_param("user_nick", '')
+                store_user_nick = user_nick.split(':')[0]
+                if store_user_nick and store_user_nick == test_config.get("user_nick", ""):
+                    access_token = test_config.get("access_token", "")
+
+        return access_token
+
+    def get_act_id(self):
+        """
+        :description: 获取act_id 如果是测试环境，则默认取最新的活动，用于前端测试使用;如果都没有取配置文件的值，配置文件没配置设置默认值1;
+        :return int
+        :last_editors: HuangJianYi
+        """
+        act_id = self.get_param_int("act_id", -1)
+        if act_id >= 0:
+            return act_id
+        app_id = self.get_app_id()
+        env = self.get_param("env") if self.get_param("env") else config.get_value("env", "")
+        if env and env != 'online' and app_id:
+            act_info_model = ActInfoModel(context=self)
+            condition_where = ConditionWhere()
+            condition_where.add_condition("app_id=%s and is_release=1")
+            params = [app_id]
+            act_type = self.get_param_int("act_type", 0)
+            if act_type > 0:
+                condition_where.add_condition("act_type=%s")
+                params.append(act_type)
+            act_info_dict = act_info_model.get_cache_dict(where=condition_where.to_string(), order_by="id desc", field="id", params=params)
+            if act_info_dict:
+                act_id = act_info_dict["id"]
+                return act_id
+        act_id = share_config.get_value("act_id", 1)
+        return act_id
+
+    def create_operation_log(self, operation_type=1, model_name="", handler_name="", old_detail=None, update_detail=None, operate_user_id="", operate_user_name="", operate_role_id="", title="", operation_desc=""):
+        """
+        :description: 创建操作日志
+        :param operation_type：操作类型（查看枚举类OperationType）
+        :param model_name：模块或表名称（跟配置表对应）
+        :param handler_name：handler名称
+        :param old_detail：变更前对象
+        :param update_detail：变更后对象
+        :param operate_user_id：操作人标识
+        :param operate_user_name：操作人名称
+        :param operate_role_id：操作人角色标识
+        :param title：标题(对象)
+        :param operation_desc：描述
+        :param operation_ways：操作方式(1单一操作2批量操作)
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        plat_type = share_config.get_value("plat_type", PlatType.tb.value)
+        if plat_type == PlatType.tb.value:
+            if not operate_user_id:
+                operate_user_id = self.get_open_id()
+            if not operate_user_name:
+                operate_user_name = self.get_user_nick()
+        if not handler_name:
+            handler_name = self.__class__.__name__
+        operate_base_model = OperateBaseModel(context=self)
+        operate_base_model.add_operation_log(operation_type, title, operation_desc, model_name, handler_name, old_detail, update_detail, self.get_app_id(), self.get_act_id(), operate_user_id, operate_user_name, operate_role_id, {"request_params": self.request_params, "request": self.request}, self.get_remote_ip(), self.request_code)
+
+    def check_continue_request(self, handler_name, app_id, object_id, expire=100):
+        """
+        :description: 一个用户同一handler频繁请求校验，只对同用户同接口同请求参数进行限制
+        :param handler_name: handler名称
+        :param app_id: 应用标识
+        :param object_id: object_id(user_id或open_id)
+        :param expire: 间隔时间，单位毫秒
+        :return:满足频繁请求条件直接输出拦截
+        :last_editors: HuangJianYi
+        """
+        result = False, ""
+        if object_id and handler_name and app_id:
+            sign = CryptographyHelper.signature_md5(self.request_params)
+            if SevenHelper.is_continue_request(f"continue_request:{handler_name}_{app_id}_{object_id}_{sign}", expire) == True:
+                result = True, f"操作太频繁,请{expire}毫秒后再试"
+        return result
+
+    def business_process_executing(self):
+        """
+        :description: 执行前事件
+        :return:
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        invoke_result_data.data = {}
+        return invoke_result_data
+
+    def business_process_executed(self, result_data, ref_params):
+        """
+        :description: 执行后事件
+        :param result_data: result_data
+        :param ref_params: 关联参数
+        :return:
+        :last_editors: HuangJianYi
+        """
+        return result_data
+
+
+class ClientBaseHandler(FrameBaseHandler):
+    """
+    :description: 客户端handler基类
+    """
+
+    def prepare(self):
+        """
+        :Description: 置于任何请求方法前被调用(请勿重写此函数,可重写prepare_ext)
+        :last_editors: HuangJianYi
+        """
+        if self.__class__.__name__ == "IndexHandler":
+            return
+        try:
+            #获取并转换请求参数
+            invoke_result_data = self._convert_request_params()
+            if invoke_result_data.success == False:
+                self.request_code = UUIDHelper.get_uuid()
+                self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+                self.finish()
+                return
+            # 标记日志请求关联
+            dict_param = self.get_http_log_extra_dict()
+            self._build_http_log(dict_param)
+            # 是否加密模式
+            is_api_encrypt = self.is_api_encrypt()
+            # 记录请求参数明文
+            if share_config.get_value("log_plain", True) == True and is_api_encrypt == True:
+                self.logging_link_info(f"plain_request_params:{self.json_dumps(self.request_params)}")
+            # 验证超时 10秒过期
+            if is_api_encrypt == True:
+                now_time = TimeHelper.get_now_timestamp(True)
+                if self.request_params.__contains__("timestamp") and (now_time - int(self.request_params["timestamp"]) > int(1000 * 10)):
+                    self.response_json_error("timestamp", "超时操作")
+                    self.finish()
+                    return
+            # 防攻击校验
+            invoke_result_data = RiskManageHelper.check_attack_request(context=self)
+            if invoke_result_data.success == False:
+                self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+                self.finish()
+                return
+            # 频繁请求校验
+            if dict_param["open_id"] and self._request_source_type() == 1:
+                is_continue_request, error_message = self.check_continue_request(self.__class__.__name__, dict_param["app_id"], dict_param["open_id"])
+                if is_continue_request:
+                    self.response_json_error("error", error_message)
+                    self.finish()
+                    return
+                #每分钟流量UV计数,用于登录接口限制登录
+                RiskManageHelper.add_current_limit_count(str(dict_param["app_id"]), str(dict_param["open_id"]))
+            # 获取设备信息
+            self.device_info_dict = self.get_device_info_dict()
+
+        except Exception as ex:
+            if not hasattr(self, "request_code"):
+                self.request_code = UUIDHelper.get_uuid()
+            self.logging_link_error("【客户端handler基类】" + traceback.format_exc())
+
+    def get_device_info_dict(self):
+        """
+        :description: 获取头部参数字典
+        :last_editors: HuangJianYi
+        """
+        device_info_dict = {}
+        clientheaderinfo_string = self.request.headers._dict.get("Clientheaderinfo")
+        if clientheaderinfo_string:
+            info_model = parse_qs(clientheaderinfo_string)
+            device_info_dict["pid"] = (info_model["pid"][0])  # 产品标识
+            device_info_dict["chid"] = 0 if "chid" not in info_model.keys() else int(info_model["chid"][0])  # 渠道标识
+            device_info_dict["height"] = 0 if "height" not in info_model.keys() else int(float(info_model["height"][0]))  # 高度
+            device_info_dict["width"] = 0 if "width" not in info_model.keys() else int(float(info_model["width"][0]))  # 宽度
+            device_info_dict["version"] = "" if "version" not in info_model.keys() else info_model["version"][0]  # 客户端版本号
+            device_info_dict["app_version"] = "" if "app_version" not in info_model.keys() else info_model["app_version"][0]  # 小程序版本号
+            device_info_dict["net"] = "" if "net" not in info_model.keys() else info_model["net"][0]  # 网络
+            device_info_dict["model_p"] = "" if "model" not in info_model.keys() else info_model["model"][0]  # 机型
+            device_info_dict["lang"] = "" if "lang" not in info_model.keys() else info_model["lang"][0]  #语言
+            device_info_dict["ver_no"] = "" if "ver_no" not in info_model.keys() else info_model["ver_no"][0]  #接口版本号
+            device_info_dict["timestamp"] = 0 if "timestamp" not in info_model.keys() else int(info_model["timestamp"][0])  # 时间搓毫秒
+            device_info_dict["signature_md5"] = "" if "signature_md5" not in info_model.keys() else info_model["signature_md5"][0]  # 签名md5
+        return device_info_dict
+
+    def emoji_base64_to_emoji(self, text_str):
+        """
+        :description: 把加密后的表情还原
+        :param text_str: 加密后的字符串
+        :return: 解密后的表情字符串
+        :last_editors: HuangJianYi 
+        """
+        return CryptographyHelper.emoji_base64_to_emoji(text_str)
+
+    def emoji_to_emoji_base64(self, text_str):
+        """
+        :description: emoji表情转为[em_xxx]形式存于数据库,打包每一个emoji
+        :description: 性能遇到问题时重新设计转换程序
+        :param text_str: 未加密的字符串
+        :return: 解密后的表情字符串
+        :last_editors: HuangJianYi 
+        """
         return CryptographyHelper.emoji_to_emoji_base64(text_str)
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/handlers/server/act_s.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/handlers/server/act_s.py`

 * *Ordering differences only*

 * *Files 18% similar despite different names*

```diff
@@ -1,452 +1,452 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-08-03 15:42:53
-@LastEditTime: 2023-05-09 09:34:08
-@LastEditors: HuangJianYi
-@Description: 活动模块
-"""
-from seven_cloudapp_frame.models.enum import *
-from seven_cloudapp_frame.handlers.frame_base import *
-from seven_cloudapp_frame.models.act_base_model import *
-from seven_cloudapp_frame.models.seven_model import PageInfo
-
-
-class ActTypeListHandler(ClientBaseHandler):
-    """
-    :description: 获取活动类型列表
-    """
-    def get_async(self):
-        """
-        :description: 获取活动类型列表
-        :param marketing_id：营销方案标识
-        :param is_act：当前类型是否创建过活动
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        is_act = int(self.get_param("is_act", 0))
-        marketing_id = int(self.get_param("marketing_id", 0))
-        condition_where = ConditionWhere()
-        if marketing_id > 0:
-            condition_where.add_condition("market_ids LIKE '%," + str(marketing_id) + ",%'")
-        condition_where.add_condition("is_release=1")
-        act_type_list = ActTypeModel(context=self).get_cache_list(where=condition_where.to_string())
-        new_list = []
-        for act_type in act_type_list:
-            act_type.play_process_json = self.json_loads(act_type.play_process_json) if act_type.play_process_json else {}
-            act_type.suit_behavior_json = self.json_loads(act_type.suit_behavior_json) if act_type.suit_behavior_json else {}
-            act_type.market_function_json = self.json_loads(act_type.market_function_json) if act_type.market_function_json else {}
-            act_type.type_desc = self.json_loads(act_type.type_desc) if act_type.type_desc else []
-            act_type.task_asset_type_json = self.json_loads(act_type.task_asset_type_json) if act_type.task_asset_type_json else []
-            if is_act > 0 and app_id:
-                act_dict = ActInfoModel(context=self).get_cache_dict("app_id=%s and act_type=%s", limit="1", field="id", params=[app_id, act_type.id])
-                if act_dict:
-                    act_type.act_id = act_dict['id']
-                else:
-                    act_type.act_id = 0
-            new_list.append(act_type.__dict__)
-        return self.response_json_success(new_list)
-
-
-class AddActInfoHandler(ClientBaseHandler):
-    """
-    :description: 添加活动信息
-    """
-    @filter_check_params("act_type")
-    def get_async(self):
-        """
-        :description: 添加活动信息
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param act_name：活动名称
-        :param is_release：是否发布
-        :param theme_id: 主题标识
-        :param is_share: 是否开启分享
-        :param share_desc_json: 分享配置
-        :param is_rule: 是否开启规则
-        :param rule_desc_json: 规则配置
-        :param start_date: 开始时间
-        :param end_date: 结束时间
-        :param close_word: 关闭文案
-        :param is_black：是否开启退款惩罚
-        :param refund_count：退款成功次数
-        :param join_ways: 活动参与条件（0所有1关注店铺2加入会员3指定用户）
-        :param is_fictitious: 是否开启虚拟中奖（1是0否）
-        :param i1: i1
-        :param i2: i2
-        :param i3: i3
-        :param i4: i4
-        :param i5: i5
-        :param s1: s1
-        :param s2: s2
-        :param s3: s3
-        :param s4: s4
-        :param s5: s5
-        :param d1: d1
-        :param d2: d2
-        :param agreement_json: 协议配置（用户协议或隐私条款）
-        :param brand_json: 品牌配置
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_name = self.get_param("act_name")
-        act_type = int(self.get_param("act_type", 0))
-        theme_id = int(self.get_param("theme_id", 0))
-        close_word = self.get_param("close_word","抱歉，程序维护中")
-        share_desc_json = self.get_param("share_desc_json", None)
-        rule_desc_json = self.get_param("rule_desc_json", None)
-        is_share = self.get_param_int("is_share", 0)
-        is_rule = self.get_param_int("is_rule", 0)
-        is_release = self.get_param_int("is_release", 0)
-        start_date = self.get_param("start_date", None)
-        end_date = self.get_param("end_date", None)
-        is_black = int(self.get_param("is_black", -1))
-        refund_count = int(self.get_param("refund_count", -1))
-        join_ways = int(self.get_param("join_ways", -1))
-        is_fictitious = int(self.get_param("is_fictitious", -1))
-        store_url = self.get_param("store_url", None)
-        i1 = int(self.get_param("i1", -1))
-        i2 = int(self.get_param("i2", -1))
-        i3 = int(self.get_param("i3", -1))
-        i4 = int(self.get_param("i4", -1))
-        i5 = int(self.get_param("i5", -1))
-        s1 = self.get_param("s1", None)
-        s2 = self.get_param("s2", None)
-        s3 = self.get_param("s3", None)
-        s4 = self.get_param("s4", None)
-        s5 = self.get_param("s5", None)
-        d1 = self.get_param("d1", None)
-        d2 = self.get_param("d2", None)
-        is_visit_store = int(self.get_param("is_visit_store", -1))
-        agreement_json = self.get_param("agreement_json", None)
-        brand_json = self.get_param("brand_json", None)
-
-
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        if not invoke_result_data.data:
-            invoke_result_data.data = {}
-        title_prefix = invoke_result_data.data["title_prefix"] if invoke_result_data.data.__contains__("title_prefix") else "活动"
-        act_base_model = ActBaseModel(context=self)
-        invoke_result_data = act_base_model.add_act_info(app_id, act_name, act_type, theme_id, share_desc_json, rule_desc_json, close_word, is_share, is_rule, is_release, start_date, end_date, is_black, refund_count, join_ways, is_fictitious, store_url, i1, i2, i3, i4, i5, s1, s2, s3, s4, s5, d1, d2, is_visit_store, agreement_json, brand_json)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        self.create_operation_log(operation_type=OperationType.add.value, model_name="act_info_tb", old_detail=None, update_detail=invoke_result_data.data, title= title_prefix + ";" + act_name)
-        ref_params = {}
-        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success(invoke_result_data.data.id)
-
-
-class UpdateActInfoHandler(ClientBaseHandler):
-    """
-    :description: 修改活动信息
-    """
-    def post_async(self):
-        """
-        :description: 修改活动信息
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param act_name：活动名称
-        :param is_release：是否发布
-        :param theme_id: 主题标识
-        :param is_share: 是否开启分享
-        :param share_desc_json: 分享配置
-        :param is_rule: 是否开启规则
-        :param rule_desc_json: 规则配置
-        :param start_date: 开始时间
-        :param end_date: 结束时间
-        :param close_word: 关闭文案
-        :param is_black：是否开启退款惩罚
-        :param refund_count：退款成功次数
-        :param join_ways: 活动参与条件（0所有1关注店铺2加入会员3指定用户）
-        :param is_fictitious: 是否开启虚拟中奖（1是0否）
-        :param i1: i1
-        :param i2: i2
-        :param i3: i3
-        :param i4: i4
-        :param i5: i5
-        :param s1: s1
-        :param s2: s2
-        :param s3: s3
-        :param s4: s4
-        :param s5: s5
-        :param d1: d1
-        :param d2: d2
-        :param agreement_json: 协议配置（用户协议或隐私条款）
-        :param brand_json: 品牌配置
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        act_name = self.get_param("act_name", None)
-        theme_id = int(self.get_param("theme_id", -1))
-        is_share = int(self.get_param("is_share", -1))
-        share_desc_json = self.get_param("share_desc_json", None)
-        is_rule = int(self.get_param("is_rule", -1))
-        rule_desc_json = self.get_param("rule_desc_json", None)
-        is_release = int(self.get_param("is_release", -1))
-        start_date = self.get_param("start_date", None)
-        end_date = self.get_param("end_date", None)
-        is_black = int(self.get_param("is_black", -1))
-        refund_count = int(self.get_param("refund_count", -1))
-        join_ways = int(self.get_param("join_ways", -1))
-        is_fictitious = int(self.get_param("is_fictitious", -1))
-        close_word = self.get_param("close_word", None)
-        is_visit_store = int(self.get_param("is_visit_store", -1))
-        store_url = self.get_param("store_url", None)
-        i1 = int(self.get_param("i1", -1))
-        i2 = int(self.get_param("i2", -1))
-        i3 = int(self.get_param("i3", -1))
-        i4 = int(self.get_param("i4", -1))
-        i5 = int(self.get_param("i5", -1))
-        s1 = self.get_param("s1", None)
-        s2 = self.get_param("s2", None)
-        s3 = self.get_param("s3", None)
-        s4 = self.get_param("s4", None)
-        s5 = self.get_param("s5", None)
-        d1 = self.get_param("d1", None)
-        d2 = self.get_param("d2", None)
-        agreement_json = self.get_param("agreement_json", None)
-        brand_json = self.get_param("brand_json", None)
-
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        if not invoke_result_data.data:
-            invoke_result_data.data = {}
-        title_prefix = invoke_result_data.data["title_prefix"] if invoke_result_data.data.__contains__("title_prefix") else "活动"
-        act_base_model = ActBaseModel(context=self)
-        invoke_result_data = act_base_model.update_act_info(app_id, act_id, act_name, theme_id, is_share, share_desc_json, is_rule, rule_desc_json, is_release, start_date, end_date, is_black, refund_count, join_ways, is_fictitious, close_word, store_url, i1, i2, i3, i4, i5, s1, s2, s3, s4, s5, d1, d2, is_visit_store, agreement_json, brand_json)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        act_name = act_name if act_name else ''
-        self.create_operation_log(operation_type=OperationType.update.value, model_name="act_info_tb", old_detail=invoke_result_data.data["old"], update_detail=invoke_result_data.data["new"], title=title_prefix + ";" + act_name)
-        ref_params = {}
-        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success()
-
-
-class ActInfoListHandler(ClientBaseHandler):
-    """
-    :description: 活动列表
-    """
-    def get_async(self):
-        """
-        :description: 获取活动列表
-        :param app_id：应用标识
-        :param act_name: 活动名称
-        :param is_del: 是否回收站1是0否
-        :param is_release: 是否发布1是0否
-        :param page_size: 条数
-        :param page_index: 页数
-        :return: PageInfo
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        page_index = self.get_param_int("page_index", 0)
-        page_size = self.get_param_int("page_size", 20)
-        is_del = self.get_param_int("is_del", 0)
-        is_release = self.get_param_int("is_release", -1)
-        act_type = self.get_param_int("act_type", -1)
-        act_name = self.get_param("act_name")
-
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_success({"data": []})
-        if not app_id:
-            return self.response_json_success({"data": []})
-        if not invoke_result_data.data:
-            invoke_result_data.data = {}
-        order_by = invoke_result_data.data["order_by"] if invoke_result_data.data.__contains__("order_by") else "id asc"
-        app_base_model = AppBaseModel(context=self)
-        act_base_model = ActBaseModel(context=self)
-        page_list, total = act_base_model.get_act_info_list(app_id, act_name, is_del, page_size, page_index, False, act_type, is_release, order_by)
-        for page in page_list:
-            page["online_url"] = app_base_model.get_online_url(act_id=page['id'], app_id=app_id, act_type=page['act_type'])
-            page["live_url"] = app_base_model.get_live_url(app_id)
-        ref_params = {}
-        page_info = PageInfo(page_index, page_size, total, self.business_process_executed(page_list, ref_params))
-        return self.response_json_success(page_info)
-
-
-class ActInfoHandler(ClientBaseHandler):
-    """
-    :description: 获取活动信息
-    """
-    def get_async(self):
-        """
-        :description: 获取活动信息
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :return:
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        act_base_model = ActBaseModel(context=self)
-        app_base_model = AppBaseModel(context=self)
-        act_info_dict = act_base_model.get_act_info_dict(act_id, False, False)
-        if act_info_dict:
-            if act_info_dict["app_id"] != app_id:
-                act_info_dict = {}
-                return self.response_json_success(act_info_dict)
-            act_info_dict["finish_menu_config_json"] = self.json_loads(act_info_dict["finish_menu_config_json"]) if act_info_dict["finish_menu_config_json"] else []
-            act_info_dict["share_desc_json"] = self.json_loads(act_info_dict["share_desc_json"]) if act_info_dict["share_desc_json"] else {}
-            act_info_dict["rule_desc_json"] = self.json_loads(act_info_dict["rule_desc_json"]) if act_info_dict["rule_desc_json"] else []
-            act_info_dict["agreement_json"] = self.json_loads(act_info_dict["agreement_json"]) if act_info_dict["agreement_json"] else []
-            act_info_dict["brand_json"] = self.json_loads(act_info_dict["brand_json"]) if act_info_dict["brand_json"] else {}
-            act_info_dict['online_url'] = app_base_model.get_online_url(act_id=act_info_dict['id'], app_id=act_info_dict['app_id'], act_type=act_info_dict["act_type"])
-            act_info_dict['live_url'] = app_base_model.get_live_url(act_info_dict['app_id'])
-        ref_params = {}
-        return self.response_json_success(self.business_process_executed(act_info_dict, ref_params))
-
-
-class DeleteActInfoHandler(ClientBaseHandler):
-    """
-    :description: 删除活动
-    """
-    def get_async(self):
-        """
-        :description: 删除活动
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        if not invoke_result_data.data:
-            invoke_result_data.data = {}
-        title_prefix = invoke_result_data.data["title_prefix"] if invoke_result_data.data.__contains__("title_prefix") else "活动"
-        act_base_model = ActBaseModel(context=self)
-        invoke_result_data = act_base_model.update_act_info_status(app_id, act_id, 1)
-        if invoke_result_data.success ==False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        self.create_operation_log(operation_type=OperationType.delete.value, model_name="act_info_tb", title= title_prefix + ";" + invoke_result_data.data["act_name"])
-        ref_params = {}
-        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success()
-
-
-class ReviewActInfoHandler(ClientBaseHandler):
-    """
-    :description: 还原活动
-    """
-    def get_async(self):
-        """
-        :description: 还原活动
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        if not invoke_result_data.data:
-            invoke_result_data.data = {}
-        title_prefix = invoke_result_data.data["title_prefix"] if invoke_result_data.data.__contains__("title_prefix") else "活动"
-        act_base_model = ActBaseModel(context=self)
-        invoke_result_data = act_base_model.update_act_info_status(app_id, act_id, 0)
-        if invoke_result_data.success ==False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        self.create_operation_log(operation_type=OperationType.review.value, model_name="act_info_tb", title= title_prefix + ";" + invoke_result_data.data["act_name"])
-        ref_params = {}
-        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success()
-
-
-class ReleaseActInfoHandler(ClientBaseHandler):
-    """
-    :description: 上下架活动
-    """
-    def get_async(self):
-        """
-        :description: 上下架活动
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param is_release: 是否发布 1-是 0-否
-        :return:
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        is_release = int(self.get_param("is_release", 0))
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        if not invoke_result_data.data:
-            invoke_result_data.data = {}
-        title_prefix = invoke_result_data.data["title_prefix"] if invoke_result_data.data.__contains__("title_prefix") else "活动"
-        act_base_model = ActBaseModel(context=self)
-        invoke_result_data = act_base_model.release_act_info(app_id, act_id, is_release)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        operation_type = OperationType.release.value if is_release == 1 else OperationType.un_release.value
-        self.create_operation_log(operation_type=operation_type, model_name="act_info_tb", title= title_prefix + ";" + invoke_result_data.data["act_name"])
-        ref_params = {}
-        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success()
-
-
-class CreateActQrCodeHandler(ClientBaseHandler):
-    """
-    :description: 创建活动二维码
-    """
-    @filter_check_params("url")
-    def get_async(self):
-        """
-        :description: 创建活动二维码
-        :return: 活动二维码图片
-        :last_editors: HuangJianYi
-        """
-        url = self.get_param("url")
-        img, img_bytes = QRCodeHelper.create_qr_code(url, fill_color="black")
-        img_base64 = base64.b64encode(img_bytes).decode()
-        return self.response_json_success(f"data:image/jpeg;base64,{img_base64}")
-
-
-class NextProgressHandler(ClientBaseHandler):
-    """
-    :description: 下一步配置
-    """
-    @filter_check_params("finish_key")
-    def get_async(self):
-        """
-        :description: 下一步配置
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param finish_key：完成key，由前端控制是否完成配置，完成时需传参数值finish_config 代表最后一步
-        :return 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        finish_key = self.get_param("finish_key")
-
-        act_base_model = ActBaseModel(context=self)
-        invoke_result_data = act_base_model.next_progress(app_id, act_id, finish_key)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-08-03 15:42:53
+@LastEditTime: 2023-05-09 09:34:08
+@LastEditors: HuangJianYi
+@Description: 活动模块
+"""
+from seven_cloudapp_frame.models.enum import *
+from seven_cloudapp_frame.handlers.frame_base import *
+from seven_cloudapp_frame.models.act_base_model import *
+from seven_cloudapp_frame.models.seven_model import PageInfo
+
+
+class ActTypeListHandler(ClientBaseHandler):
+    """
+    :description: 获取活动类型列表
+    """
+    def get_async(self):
+        """
+        :description: 获取活动类型列表
+        :param marketing_id：营销方案标识
+        :param is_act：当前类型是否创建过活动
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        is_act = int(self.get_param("is_act", 0))
+        marketing_id = int(self.get_param("marketing_id", 0))
+        condition_where = ConditionWhere()
+        if marketing_id > 0:
+            condition_where.add_condition("market_ids LIKE '%," + str(marketing_id) + ",%'")
+        condition_where.add_condition("is_release=1")
+        act_type_list = ActTypeModel(context=self).get_cache_list(where=condition_where.to_string())
+        new_list = []
+        for act_type in act_type_list:
+            act_type.play_process_json = self.json_loads(act_type.play_process_json) if act_type.play_process_json else {}
+            act_type.suit_behavior_json = self.json_loads(act_type.suit_behavior_json) if act_type.suit_behavior_json else {}
+            act_type.market_function_json = self.json_loads(act_type.market_function_json) if act_type.market_function_json else {}
+            act_type.type_desc = self.json_loads(act_type.type_desc) if act_type.type_desc else []
+            act_type.task_asset_type_json = self.json_loads(act_type.task_asset_type_json) if act_type.task_asset_type_json else []
+            if is_act > 0 and app_id:
+                act_dict = ActInfoModel(context=self).get_cache_dict("app_id=%s and act_type=%s", limit="1", field="id", params=[app_id, act_type.id])
+                if act_dict:
+                    act_type.act_id = act_dict['id']
+                else:
+                    act_type.act_id = 0
+            new_list.append(act_type.__dict__)
+        return self.response_json_success(new_list)
+
+
+class AddActInfoHandler(ClientBaseHandler):
+    """
+    :description: 添加活动信息
+    """
+    @filter_check_params("act_type")
+    def get_async(self):
+        """
+        :description: 添加活动信息
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param act_name：活动名称
+        :param is_release：是否发布
+        :param theme_id: 主题标识
+        :param is_share: 是否开启分享
+        :param share_desc_json: 分享配置
+        :param is_rule: 是否开启规则
+        :param rule_desc_json: 规则配置
+        :param start_date: 开始时间
+        :param end_date: 结束时间
+        :param close_word: 关闭文案
+        :param is_black：是否开启退款惩罚
+        :param refund_count：退款成功次数
+        :param join_ways: 活动参与条件（0所有1关注店铺2加入会员3指定用户）
+        :param is_fictitious: 是否开启虚拟中奖（1是0否）
+        :param i1: i1
+        :param i2: i2
+        :param i3: i3
+        :param i4: i4
+        :param i5: i5
+        :param s1: s1
+        :param s2: s2
+        :param s3: s3
+        :param s4: s4
+        :param s5: s5
+        :param d1: d1
+        :param d2: d2
+        :param agreement_json: 协议配置（用户协议或隐私条款）
+        :param brand_json: 品牌配置
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_name = self.get_param("act_name")
+        act_type = int(self.get_param("act_type", 0))
+        theme_id = int(self.get_param("theme_id", 0))
+        close_word = self.get_param("close_word","抱歉，程序维护中")
+        share_desc_json = self.get_param("share_desc_json", None)
+        rule_desc_json = self.get_param("rule_desc_json", None)
+        is_share = self.get_param_int("is_share", 0)
+        is_rule = self.get_param_int("is_rule", 0)
+        is_release = self.get_param_int("is_release", 0)
+        start_date = self.get_param("start_date", None)
+        end_date = self.get_param("end_date", None)
+        is_black = int(self.get_param("is_black", -1))
+        refund_count = int(self.get_param("refund_count", -1))
+        join_ways = int(self.get_param("join_ways", -1))
+        is_fictitious = int(self.get_param("is_fictitious", -1))
+        store_url = self.get_param("store_url", None)
+        i1 = int(self.get_param("i1", -1))
+        i2 = int(self.get_param("i2", -1))
+        i3 = int(self.get_param("i3", -1))
+        i4 = int(self.get_param("i4", -1))
+        i5 = int(self.get_param("i5", -1))
+        s1 = self.get_param("s1", None)
+        s2 = self.get_param("s2", None)
+        s3 = self.get_param("s3", None)
+        s4 = self.get_param("s4", None)
+        s5 = self.get_param("s5", None)
+        d1 = self.get_param("d1", None)
+        d2 = self.get_param("d2", None)
+        is_visit_store = int(self.get_param("is_visit_store", -1))
+        agreement_json = self.get_param("agreement_json", None)
+        brand_json = self.get_param("brand_json", None)
+
+
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        title_prefix = invoke_result_data.data["title_prefix"] if invoke_result_data.data.__contains__("title_prefix") else "活动"
+        act_base_model = ActBaseModel(context=self)
+        invoke_result_data = act_base_model.add_act_info(app_id, act_name, act_type, theme_id, share_desc_json, rule_desc_json, close_word, is_share, is_rule, is_release, start_date, end_date, is_black, refund_count, join_ways, is_fictitious, store_url, i1, i2, i3, i4, i5, s1, s2, s3, s4, s5, d1, d2, is_visit_store, agreement_json, brand_json)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        self.create_operation_log(operation_type=OperationType.add.value, model_name="act_info_tb", old_detail=None, update_detail=invoke_result_data.data, title= title_prefix + ";" + act_name)
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success(invoke_result_data.data.id)
+
+
+class UpdateActInfoHandler(ClientBaseHandler):
+    """
+    :description: 修改活动信息
+    """
+    def post_async(self):
+        """
+        :description: 修改活动信息
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param act_name：活动名称
+        :param is_release：是否发布
+        :param theme_id: 主题标识
+        :param is_share: 是否开启分享
+        :param share_desc_json: 分享配置
+        :param is_rule: 是否开启规则
+        :param rule_desc_json: 规则配置
+        :param start_date: 开始时间
+        :param end_date: 结束时间
+        :param close_word: 关闭文案
+        :param is_black：是否开启退款惩罚
+        :param refund_count：退款成功次数
+        :param join_ways: 活动参与条件（0所有1关注店铺2加入会员3指定用户）
+        :param is_fictitious: 是否开启虚拟中奖（1是0否）
+        :param i1: i1
+        :param i2: i2
+        :param i3: i3
+        :param i4: i4
+        :param i5: i5
+        :param s1: s1
+        :param s2: s2
+        :param s3: s3
+        :param s4: s4
+        :param s5: s5
+        :param d1: d1
+        :param d2: d2
+        :param agreement_json: 协议配置（用户协议或隐私条款）
+        :param brand_json: 品牌配置
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        act_name = self.get_param("act_name", None)
+        theme_id = int(self.get_param("theme_id", -1))
+        is_share = int(self.get_param("is_share", -1))
+        share_desc_json = self.get_param("share_desc_json", None)
+        is_rule = int(self.get_param("is_rule", -1))
+        rule_desc_json = self.get_param("rule_desc_json", None)
+        is_release = int(self.get_param("is_release", -1))
+        start_date = self.get_param("start_date", None)
+        end_date = self.get_param("end_date", None)
+        is_black = int(self.get_param("is_black", -1))
+        refund_count = int(self.get_param("refund_count", -1))
+        join_ways = int(self.get_param("join_ways", -1))
+        is_fictitious = int(self.get_param("is_fictitious", -1))
+        close_word = self.get_param("close_word", None)
+        is_visit_store = int(self.get_param("is_visit_store", -1))
+        store_url = self.get_param("store_url", None)
+        i1 = int(self.get_param("i1", -1))
+        i2 = int(self.get_param("i2", -1))
+        i3 = int(self.get_param("i3", -1))
+        i4 = int(self.get_param("i4", -1))
+        i5 = int(self.get_param("i5", -1))
+        s1 = self.get_param("s1", None)
+        s2 = self.get_param("s2", None)
+        s3 = self.get_param("s3", None)
+        s4 = self.get_param("s4", None)
+        s5 = self.get_param("s5", None)
+        d1 = self.get_param("d1", None)
+        d2 = self.get_param("d2", None)
+        agreement_json = self.get_param("agreement_json", None)
+        brand_json = self.get_param("brand_json", None)
+
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        title_prefix = invoke_result_data.data["title_prefix"] if invoke_result_data.data.__contains__("title_prefix") else "活动"
+        act_base_model = ActBaseModel(context=self)
+        invoke_result_data = act_base_model.update_act_info(app_id, act_id, act_name, theme_id, is_share, share_desc_json, is_rule, rule_desc_json, is_release, start_date, end_date, is_black, refund_count, join_ways, is_fictitious, close_word, store_url, i1, i2, i3, i4, i5, s1, s2, s3, s4, s5, d1, d2, is_visit_store, agreement_json, brand_json)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        act_name = act_name if act_name else ''
+        self.create_operation_log(operation_type=OperationType.update.value, model_name="act_info_tb", old_detail=invoke_result_data.data["old"], update_detail=invoke_result_data.data["new"], title=title_prefix + ";" + act_name)
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success()
+
+
+class ActInfoListHandler(ClientBaseHandler):
+    """
+    :description: 活动列表
+    """
+    def get_async(self):
+        """
+        :description: 获取活动列表
+        :param app_id：应用标识
+        :param act_name: 活动名称
+        :param is_del: 是否回收站1是0否
+        :param is_release: 是否发布1是0否
+        :param page_size: 条数
+        :param page_index: 页数
+        :return: PageInfo
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        page_index = self.get_param_int("page_index", 0)
+        page_size = self.get_param_int("page_size", 20)
+        is_del = self.get_param_int("is_del", 0)
+        is_release = self.get_param_int("is_release", -1)
+        act_type = self.get_param_int("act_type", -1)
+        act_name = self.get_param("act_name")
+
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_success({"data": []})
+        if not app_id:
+            return self.response_json_success({"data": []})
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        order_by = invoke_result_data.data["order_by"] if invoke_result_data.data.__contains__("order_by") else "id asc"
+        app_base_model = AppBaseModel(context=self)
+        act_base_model = ActBaseModel(context=self)
+        page_list, total = act_base_model.get_act_info_list(app_id, act_name, is_del, page_size, page_index, False, act_type, is_release, order_by)
+        for page in page_list:
+            page["online_url"] = app_base_model.get_online_url(act_id=page['id'], app_id=app_id, act_type=page['act_type'])
+            page["live_url"] = app_base_model.get_live_url(app_id)
+        ref_params = {}
+        page_info = PageInfo(page_index, page_size, total, self.business_process_executed(page_list, ref_params))
+        return self.response_json_success(page_info)
+
+
+class ActInfoHandler(ClientBaseHandler):
+    """
+    :description: 获取活动信息
+    """
+    def get_async(self):
+        """
+        :description: 获取活动信息
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :return:
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        act_base_model = ActBaseModel(context=self)
+        app_base_model = AppBaseModel(context=self)
+        act_info_dict = act_base_model.get_act_info_dict(act_id, False, False)
+        if act_info_dict:
+            if act_info_dict["app_id"] != app_id:
+                act_info_dict = {}
+                return self.response_json_success(act_info_dict)
+            act_info_dict["finish_menu_config_json"] = self.json_loads(act_info_dict["finish_menu_config_json"]) if act_info_dict["finish_menu_config_json"] else []
+            act_info_dict["share_desc_json"] = self.json_loads(act_info_dict["share_desc_json"]) if act_info_dict["share_desc_json"] else {}
+            act_info_dict["rule_desc_json"] = self.json_loads(act_info_dict["rule_desc_json"]) if act_info_dict["rule_desc_json"] else []
+            act_info_dict["agreement_json"] = self.json_loads(act_info_dict["agreement_json"]) if act_info_dict["agreement_json"] else []
+            act_info_dict["brand_json"] = self.json_loads(act_info_dict["brand_json"]) if act_info_dict["brand_json"] else {}
+            act_info_dict['online_url'] = app_base_model.get_online_url(act_id=act_info_dict['id'], app_id=act_info_dict['app_id'], act_type=act_info_dict["act_type"])
+            act_info_dict['live_url'] = app_base_model.get_live_url(act_info_dict['app_id'])
+        ref_params = {}
+        return self.response_json_success(self.business_process_executed(act_info_dict, ref_params))
+
+
+class DeleteActInfoHandler(ClientBaseHandler):
+    """
+    :description: 删除活动
+    """
+    def get_async(self):
+        """
+        :description: 删除活动
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        title_prefix = invoke_result_data.data["title_prefix"] if invoke_result_data.data.__contains__("title_prefix") else "活动"
+        act_base_model = ActBaseModel(context=self)
+        invoke_result_data = act_base_model.update_act_info_status(app_id, act_id, 1)
+        if invoke_result_data.success ==False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        self.create_operation_log(operation_type=OperationType.delete.value, model_name="act_info_tb", title= title_prefix + ";" + invoke_result_data.data["act_name"])
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success()
+
+
+class ReviewActInfoHandler(ClientBaseHandler):
+    """
+    :description: 还原活动
+    """
+    def get_async(self):
+        """
+        :description: 还原活动
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        title_prefix = invoke_result_data.data["title_prefix"] if invoke_result_data.data.__contains__("title_prefix") else "活动"
+        act_base_model = ActBaseModel(context=self)
+        invoke_result_data = act_base_model.update_act_info_status(app_id, act_id, 0)
+        if invoke_result_data.success ==False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        self.create_operation_log(operation_type=OperationType.review.value, model_name="act_info_tb", title= title_prefix + ";" + invoke_result_data.data["act_name"])
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success()
+
+
+class ReleaseActInfoHandler(ClientBaseHandler):
+    """
+    :description: 上下架活动
+    """
+    def get_async(self):
+        """
+        :description: 上下架活动
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param is_release: 是否发布 1-是 0-否
+        :return:
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        is_release = int(self.get_param("is_release", 0))
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        title_prefix = invoke_result_data.data["title_prefix"] if invoke_result_data.data.__contains__("title_prefix") else "活动"
+        act_base_model = ActBaseModel(context=self)
+        invoke_result_data = act_base_model.release_act_info(app_id, act_id, is_release)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        operation_type = OperationType.release.value if is_release == 1 else OperationType.un_release.value
+        self.create_operation_log(operation_type=operation_type, model_name="act_info_tb", title= title_prefix + ";" + invoke_result_data.data["act_name"])
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success()
+
+
+class CreateActQrCodeHandler(ClientBaseHandler):
+    """
+    :description: 创建活动二维码
+    """
+    @filter_check_params("url")
+    def get_async(self):
+        """
+        :description: 创建活动二维码
+        :return: 活动二维码图片
+        :last_editors: HuangJianYi
+        """
+        url = self.get_param("url")
+        img, img_bytes = QRCodeHelper.create_qr_code(url, fill_color="black")
+        img_base64 = base64.b64encode(img_bytes).decode()
+        return self.response_json_success(f"data:image/jpeg;base64,{img_base64}")
+
+
+class NextProgressHandler(ClientBaseHandler):
+    """
+    :description: 下一步配置
+    """
+    @filter_check_params("finish_key")
+    def get_async(self):
+        """
+        :description: 下一步配置
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param finish_key：完成key，由前端控制是否完成配置，完成时需传参数值finish_config 代表最后一步
+        :return 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        finish_key = self.get_param("finish_key")
+
+        act_base_model = ActBaseModel(context=self)
+        invoke_result_data = act_base_model.next_progress(app_id, act_id, finish_key)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
         return self.response_json_success()
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/handlers/server/app_s.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/handlers/server/app_s.py`

 * *Ordering differences only*

 * *Files 9% similar despite different names*

```diff
@@ -1,422 +1,422 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-08-03 10:43:58
-@LastEditTime: 2023-07-03 17:42:44
-@LastEditors: HuangJianYi
-@Description: 应用模块
-"""
-from seven_cloudapp_frame.models.enum import *
-from seven_cloudapp_frame.handlers.frame_base import *
-from seven_cloudapp_frame.models.top_base_model import *
-from seven_cloudapp_frame.models.app_base_model import *
-from seven_cloudapp_frame.models.mp_base_model import *
-from seven_cloudapp_frame.models.asset_base_model import *
-from asq.initiators import query
-
-
-class InstantiateAppHandler(ClientBaseHandler):
-    """
-    :description: 实例化小程序
-    """
-    def get_async(self):
-        """
-        :description: 实例化小程序
-        :param app_id:应用标识
-        :param user_nick:用户昵称
-        :param access_token:access_token
-        :param is_log：是否记录返回信息
-        :return app_info
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        user_nick = self.get_user_nick()
-        access_token = self.get_access_token()
-        main_user_open_id = self.get_param("main_user_open_id")
-        is_log = int(self.get_param("is_log", 0))
-        is_log = True if is_log == 1 else False
-
-        cache_key = f"instantiate:{user_nick}"
-        if SevenHelper.is_continue_request(cache_key, 10000) == True:
-            return self.response_json_error("error","操作太频繁,请10秒后再试")
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message,invoke_result_data.data)
-        app_key, app_secret = self.get_app_key_secret()
-        top_base_model = TopBaseModel(context=self)
-        invoke_result_data = top_base_model.instantiate(app_id, user_nick, access_token, app_key, app_secret, is_log, main_user_open_id)
-        if invoke_result_data.success == False:
-            SevenHelper.redis_init().delete(cache_key)
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message,invoke_result_data.data)
-        ref_params = {}
-        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
-        if invoke_result_data.success == False:
-            SevenHelper.redis_init().delete(cache_key)
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        SevenHelper.redis_init().delete(cache_key)
-        return self.response_json_success(invoke_result_data.data)
-
-
-class UpdateTelephoneHandler(ClientBaseHandler):
-    """
-    :description: 更新手机号
-    """
-    @filter_check_params("telephone")
-    def get_async(self):
-        """
-        :description: 更新手机号
-        :param app_id:应用标识
-        :param telephone：手机号
-        :param check_code：验证码
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        open_id = self.get_open_id()
-        app_id = self.get_app_id()
-        telephone = self.get_param("telephone")
-        check_code = self.get_param("check_code")
-        modify_date = self.get_now_datetime()
-
-        check_code_re = SevenHelper.redis_init().get(f"user_bind_phone_code:{open_id}")
-        if check_code_re == None:
-            return self.response_json_error("error", "验证码已过期")
-        if check_code != check_code_re:
-            return self.response_json_error("error", "验证码错误")
-        app_info_model = AppInfoModel(context=self)
-        app_info_model.update_table("app_telephone=%s,modify_date=%s", "app_id=%s", [telephone, modify_date, app_id])
-        app_info_model.delete_dependency_key(DependencyKey.app_info(app_id))
-        return self.response_json_success()
-
-
-class VersionUpgradeHandler(ClientBaseHandler):
-    """
-    :description: 前端版本更新
-    """
-    def get_async(self):
-        """
-        :description: 前端版本更新
-        :param app_id:应用标识
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        access_token = self.get_access_token()
-        user_nick = self.get_user_nick()
-        is_log = int(self.get_param("is_log", 0))
-        is_log = True if is_log == 1 else False
-
-        base_info = BaseInfoModel(context=self).get_entity()
-        client_ver = base_info.client_ver
-        store_user_nick = user_nick.split(':')[0]
-
-        app_info = AppInfoModel(context=self).get_entity("app_id=%s", params=app_id)
-        if not app_info:
-            return self.response_json_error("no_app", "小程序不存在")
-        test_config = share_config.get_value("test_config", {})
-        test_client_ver = test_config.get("client_ver","")
-        client_template_id = share_config.get_value("client_template_id")
-        #配置文件指定账号升级
-        if test_client_ver and store_user_nick and store_user_nick == test_config.get("user_nick",""):
-            client_ver = test_client_ver
-        else:
-            #中台指定账号升级
-            version_info = VersionInfoModel(context=self).get_entity(where="type_id=1",order_by="id desc")
-            if version_info:
-                if version_info.update_scope == 2 and version_info.white_lists:
-                    white_lists = SevenHelper.json_loads(version_info.white_lists)
-                    if isinstance(white_lists, str):
-                        white_lists = white_lists.split(',')
-                    if store_user_nick in white_lists:
-                        client_ver = version_info.version_number
-
-        top_base_model = TopBaseModel(context=self)
-        app_key, app_secret = self.get_app_key_secret()
-        invoke_result_data = top_base_model.version_upgrade(app_id, client_template_id, client_ver, access_token,app_key, app_secret, app_info, is_log)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success(invoke_result_data.data)
-
-
-class AppInfoHandler(ClientBaseHandler):
-    """
-    :description: 获取小程序信息
-    """
-    @filter_check_params()
-    def get_async(self):
-        """
-        :description: 获取小程序信息
-        :return app_info
-        :last_editors: HuangJianYi
-        """
-        main_user_open_id = self.get_param("main_user_open_id")
-        app_base_model = AppBaseModel(context=self)
-        app_key, app_secret = self.get_app_key_secret()
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        if not invoke_result_data.data:
-            invoke_result_data.data = {}
-        invoke_result_data = app_base_model.get_app_info_result(self.get_user_nick(), self.get_open_id(), self.get_access_token(), app_key, app_secret, main_user_open_id)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        invoke_result_data = self.business_process_executed(invoke_result_data, {})
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success(invoke_result_data.data)
-
-
-class CheckGmPowerHandler(ClientBaseHandler):
-    """
-    :description: 校验是否有GM工具权限
-    """
-    def get_async(self):
-        """
-        :description: 校验是否有GM工具权限
-        :param 
-        :return: True是 False否
-        :last_editors: HuangJianYi
-        """
-        is_power = False
-        user_nick = self.get_user_nick()
-        if not user_nick:
-            return self.response_json_error("error", "对不起,请先授权登录")
-        store_user_nick = user_nick.split(':')[0]
-        app_info_dict = AppInfoModel(context=self).get_dict("store_user_nick=%s", field="is_gm", params=store_user_nick)
-        if not app_info_dict:
-            is_power = False
-        if app_info_dict["is_gm"] == 1:
-            is_power = True
-        return self.response_json_success(is_power)
-
-
-class GetAppidByGmHandler(ClientBaseHandler):
-    """
-    :description: GM工具获取应用标识
-    """
-    @filter_check_params("store_name")
-    def get_async(self):
-        """
-        :description: 获取应用标识
-        :param store_name:店铺名称
-        :return app_id
-        :last_editors: HuangJianYi
-        """
-        app_id = ""
-        store_name = self.get_param("store_name")
-        user_nick = self.get_user_nick()
-        if not user_nick:
-            return self.response_json_error("error", "对不起,请先授权登录")
-        store_user_nick = user_nick.split(':')[0]
-        is_power = False
-
-        app_info_dict = AppInfoModel(context=self).get_dict("store_user_nick=%s", field="is_gm", params=store_user_nick)
-        if app_info_dict and app_info_dict["is_gm"] == 1:
-            is_power = True
-        if is_power == True:
-            app_info_dict = AppInfoModel(context=self).get_dict("store_name=%s", field="app_id", params=[store_name])
-            if app_info_dict:
-                app_id = app_info_dict["app_id"]
-        return self.response_json_success(app_id)
-
-
-class GetShortUrlHandler(ClientBaseHandler):
-    """
-    :description: 获取淘宝短链接
-    """
-    def get_async(self):
-        """
-        :description: 获取淘宝短链接
-        :param url:链接地址
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        access_token = self.get_access_token()
-        is_log = int(self.get_param("is_log", 0))
-        is_log = True if is_log == 1 else False
-        url = self.get_param("url")
-        top_base_model = TopBaseModel(context=self)
-        app_key, app_secret = self.get_app_key_secret()
-        invoke_result_data = top_base_model.get_short_url(url, access_token, app_key, app_secret, is_log)
-        if invoke_result_data.success == False:
-            return self.response_json_success("")
-        else:
-            return self.response_json_success(invoke_result_data.data)
-
-
-class GetHighPowerListHandler(ClientBaseHandler):
-    """
-    :description: 获取中台配置的高级权限列表
-    """
-    def get_async(self):
-        """
-        :description: 获取中台配置的高级权限列表
-        :return: list
-        :last_editors: HuangJianYi
-        """
-        user_nick = self.get_user_nick()
-        if not user_nick:
-            return self.response_json_error("Error", "对不起,请先授权登录")
-        store_user_nick = user_nick.split(':')[0]
-        access_token = self.get_access_token()
-        top_base_model = TopBaseModel(context=self)
-        mp_base_model = MPBaseModel(context=self)
-        # 如果登录账号的主账号等于配置文件指定的测试账号，则取子账号进行权限的获取，方便不同子账号进到不同的SaaS定制
-        test_config = share_config.get_value("test_config", {})
-        invoke_result_data = mp_base_model.get_custom_function_list(user_nick) if store_user_nick and store_user_nick == test_config.get("user_nick", "") else mp_base_model.get_custom_function_list(store_user_nick)
-        if invoke_result_data.success == True:
-            custom_function_list = invoke_result_data.data if invoke_result_data.data else []
-        else:
-            custom_function_list = mp_base_model.get_api_custom_function_list(user_nick) if store_user_nick and store_user_nick == test_config.get("user_nick", "") else mp_base_model.get_api_custom_function_list(store_user_nick)
-        config_data_list = []
-        if len(custom_function_list) == 0:
-            config_data = {}
-            config_data["is_customized"] = 0
-            config_data["name"] = ""
-            config_data["project_code"] = ""
-            config_data["cloud_app_id"] = 0
-            config_data["function_config_list"] = []
-            config_data["skin_config_list"] = []
-            app_key, app_secret = self.get_app_key_secret()
-            #获取项目编码
-            project_code = top_base_model.get_project_code(store_user_nick, access_token, app_key, app_secret)
-            invoke_result_data = mp_base_model.get_public_function_list(project_code)
-            if invoke_result_data.success == True:
-                public_function_list = invoke_result_data.data if invoke_result_data.data else []
-            else:
-                public_function_list = mp_base_model.get_api_public_function_list(project_code)
-            if len(public_function_list) > 0:
-                config_data["function_config_list"] = query(public_function_list[0]["function_info_second_list"]).select(lambda x: {"name": x["name"], "key_name": x["key_name"]}).to_list()
-                config_data["skin_config_list"] = query(public_function_list[0]["skin_ids_second_list"]).select(lambda x: {"name": x["name"], "theme_id": x["theme_id"]}).to_list()
-                config_data["name"] = public_function_list[0]["name"]
-                config_data["project_code"] = public_function_list[0]["project_code"]
-            config_data_list.append(config_data)
-        else:
-            for custom_function in custom_function_list:
-                config_data = {}
-                config_data["is_customized"] = 1
-                config_data["name"] = "定制版"
-                config_data["project_code"] = ""
-                config_data["cloud_app_id"] = custom_function["cloud_app_id"]
-                config_data["function_config_list"] = query(custom_function["function_info_second_list"]).select(lambda x: {"name": x["name"], "key_name": x["key_name"]}).to_list()
-                config_data["skin_config_list"] = query(custom_function["skin_ids_second_list"]).select(lambda x: {"name": x["name"], "theme_id": x["theme_id"]}).to_list()
-                config_data["module_name"] = custom_function["module_name"]
-                config_data["module_pic"] = custom_function["module_pic"]
-                config_data_list.append(config_data)
-        self.response_json_success(config_data_list)
-
-
-
-class UpdateStoreAssetHandler(ClientBaseHandler):
-    """
-    :description: 变更商家资产
-    """
-    @filter_check_params("asset_type,asset_value")
-    def post_async(self):
-        """
-        :description: 变更资产
-        :param app_id：应用标识
-        :param asset_type：资产类型
-        :param asset_value：变更的资产值
-        :param asset_object_id：资产对象标识
-        :param store_id：商家ID
-        :param store_name：商家名称
-        :return: response_json_success
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        asset_type = int(self.get_param("asset_type", 0))
-        asset_value = int(self.get_param("asset_value", 0))
-        asset_object_id = self.get_param("asset_object_id")
-        store_id = self.get_param("store_id")
-        store_name = self.get_param("store_name")
-
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code,invoke_result_data.error_message)
-
-        asset_base_model = AssetBaseModel(context=self)
-        invoke_result_data = asset_base_model.update_store_asset(app_id, store_id, store_name, asset_type, asset_value, asset_object_id, 3, "", "手动配置", "手动配置")
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code,invoke_result_data.error_message)
-        title = "资产配置；"
-        if asset_type == 1:
-            title = "次数配置；"
-        elif asset_type == 2:
-            title = "积分配置；"
-        elif asset_type == 3:
-            title = "档位配置；"
-        title = title + "店铺名称：" + store_name + "，store_id：" + store_id
-        self.create_operation_log(operation_type=OperationType.operate.value, model_name="store_asset_tb", title=title)
-        ref_params = {}
-        self.business_process_executed(invoke_result_data, ref_params)
-        return self.response_json_success()
-
-
-class StoreAssetListHandler(ClientBaseHandler):
-    """
-    :description: 获取商家资产列表
-    """
-    def get_async(self):
-        """
-        :description: 获取商家资产列表
-        :param app_id：应用标识
-        :param asset_type：资产类型(1-次数2-积分3-价格档位)
-        :return list
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        asset_type = int(self.get_param("asset_type", 0))
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_success({"data": []})
-        asset_base_model = AssetBaseModel(context=self)
-        ref_params = {}
-        return self.response_json_success(self.business_process_executed(asset_base_model.get_store_asset_list(app_id, asset_type), ref_params))
-
-
-class StoreAssetLogListHandler(ClientBaseHandler):
-    """
-    :description: 商家资产流水记录
-    """
-    def get_async(self):
-        """
-        :description: 商家资产流水记录
-        :param app_id：应用标识
-        :param asset_type：资产类型(1-次数2-积分3-价格档位)
-        :param page_size：条数
-        :param page_index：页数
-        :param asset_object_id：资产对象标识
-        :param start_date：开始时间
-        :param end_date：结束时间
-        :param source_type：来源类型（1-购买2-任务3-手动配置4-抽奖5-回购）
-        :param source_object_id：来源对象标识(比如来源类型是任务则对应任务类型)
-        :param operate_type：操作类型(0累计 1消耗)
-        :return list
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        page_index = int(self.get_param("page_index", 0))
-        page_size = int(self.get_param("page_size", 20))
-        start_date = self.get_param("start_date")
-        end_date = self.get_param("end_date")
-        store_id = self.get_param_int("store_id", 0)
-        store_name = self.get_param("store_name")
-        source_type = int(self.get_param("source_type", 0))
-        source_object_id = self.get_param("source_object_id")
-        asset_type = int(self.get_param("asset_type", 0))
-        asset_object_id = self.get_param("asset_object_id")
-        operate_type = int(self.get_param("operate_type", -1))
-
-        field = "*"
-        db_connect_key = "db_cloudapp"
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_success({"data": []})
-        else:
-            field = invoke_result_data.data["field"] if invoke_result_data.data.__contains__("field") else "*"
-            db_connect_key = invoke_result_data.data["db_connect_key"] if invoke_result_data.data.__contains__("db_connect_key") else "db_cloudapp"
-        asset_base_model = AssetBaseModel(context=self)
-        page_list, total = asset_base_model.get_store_asset_log_list(app_id, asset_type, db_connect_key, page_size, page_index, store_id, store_name, asset_object_id, start_date, end_date, source_type, source_object_id, field, is_cache=False, operate_type=operate_type)
-        ref_params = {}
-        page_info = PageInfo(page_index, page_size, total, self.business_process_executed(page_list, ref_params))
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-08-03 10:43:58
+@LastEditTime: 2023-07-03 17:42:44
+@LastEditors: HuangJianYi
+@Description: 应用模块
+"""
+from seven_cloudapp_frame.models.enum import *
+from seven_cloudapp_frame.handlers.frame_base import *
+from seven_cloudapp_frame.models.top_base_model import *
+from seven_cloudapp_frame.models.app_base_model import *
+from seven_cloudapp_frame.models.mp_base_model import *
+from seven_cloudapp_frame.models.asset_base_model import *
+from asq.initiators import query
+
+
+class InstantiateAppHandler(ClientBaseHandler):
+    """
+    :description: 实例化小程序
+    """
+    def get_async(self):
+        """
+        :description: 实例化小程序
+        :param app_id:应用标识
+        :param user_nick:用户昵称
+        :param access_token:access_token
+        :param is_log：是否记录返回信息
+        :return app_info
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        user_nick = self.get_user_nick()
+        access_token = self.get_access_token()
+        main_user_open_id = self.get_param("main_user_open_id")
+        is_log = int(self.get_param("is_log", 0))
+        is_log = True if is_log == 1 else False
+
+        cache_key = f"instantiate:{user_nick}"
+        if SevenHelper.is_continue_request(cache_key, 10000) == True:
+            return self.response_json_error("error","操作太频繁,请10秒后再试")
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message,invoke_result_data.data)
+        app_key, app_secret = self.get_app_key_secret()
+        top_base_model = TopBaseModel(context=self)
+        invoke_result_data = top_base_model.instantiate(app_id, user_nick, access_token, app_key, app_secret, is_log, main_user_open_id)
+        if invoke_result_data.success == False:
+            SevenHelper.redis_init().delete(cache_key)
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message,invoke_result_data.data)
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            SevenHelper.redis_init().delete(cache_key)
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        SevenHelper.redis_init().delete(cache_key)
+        return self.response_json_success(invoke_result_data.data)
+
+
+class UpdateTelephoneHandler(ClientBaseHandler):
+    """
+    :description: 更新手机号
+    """
+    @filter_check_params("telephone")
+    def get_async(self):
+        """
+        :description: 更新手机号
+        :param app_id:应用标识
+        :param telephone：手机号
+        :param check_code：验证码
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        open_id = self.get_open_id()
+        app_id = self.get_app_id()
+        telephone = self.get_param("telephone")
+        check_code = self.get_param("check_code")
+        modify_date = self.get_now_datetime()
+
+        check_code_re = SevenHelper.redis_init().get(f"user_bind_phone_code:{open_id}")
+        if check_code_re == None:
+            return self.response_json_error("error", "验证码已过期")
+        if check_code != check_code_re:
+            return self.response_json_error("error", "验证码错误")
+        app_info_model = AppInfoModel(context=self)
+        app_info_model.update_table("app_telephone=%s,modify_date=%s", "app_id=%s", [telephone, modify_date, app_id])
+        app_info_model.delete_dependency_key(DependencyKey.app_info(app_id))
+        return self.response_json_success()
+
+
+class VersionUpgradeHandler(ClientBaseHandler):
+    """
+    :description: 前端版本更新
+    """
+    def get_async(self):
+        """
+        :description: 前端版本更新
+        :param app_id:应用标识
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        access_token = self.get_access_token()
+        user_nick = self.get_user_nick()
+        is_log = int(self.get_param("is_log", 0))
+        is_log = True if is_log == 1 else False
+
+        base_info = BaseInfoModel(context=self).get_entity()
+        client_ver = base_info.client_ver
+        store_user_nick = user_nick.split(':')[0]
+
+        app_info = AppInfoModel(context=self).get_entity("app_id=%s", params=app_id)
+        if not app_info:
+            return self.response_json_error("no_app", "小程序不存在")
+        test_config = share_config.get_value("test_config", {})
+        test_client_ver = test_config.get("client_ver","")
+        client_template_id = share_config.get_value("client_template_id")
+        #配置文件指定账号升级
+        if test_client_ver and store_user_nick and store_user_nick == test_config.get("user_nick",""):
+            client_ver = test_client_ver
+        else:
+            #中台指定账号升级
+            version_info = VersionInfoModel(context=self).get_entity(where="type_id=1",order_by="id desc")
+            if version_info:
+                if version_info.update_scope == 2 and version_info.white_lists:
+                    white_lists = SevenHelper.json_loads(version_info.white_lists)
+                    if isinstance(white_lists, str):
+                        white_lists = white_lists.split(',')
+                    if store_user_nick in white_lists:
+                        client_ver = version_info.version_number
+
+        top_base_model = TopBaseModel(context=self)
+        app_key, app_secret = self.get_app_key_secret()
+        invoke_result_data = top_base_model.version_upgrade(app_id, client_template_id, client_ver, access_token,app_key, app_secret, app_info, is_log)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success(invoke_result_data.data)
+
+
+class AppInfoHandler(ClientBaseHandler):
+    """
+    :description: 获取小程序信息
+    """
+    @filter_check_params()
+    def get_async(self):
+        """
+        :description: 获取小程序信息
+        :return app_info
+        :last_editors: HuangJianYi
+        """
+        main_user_open_id = self.get_param("main_user_open_id")
+        app_base_model = AppBaseModel(context=self)
+        app_key, app_secret = self.get_app_key_secret()
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        invoke_result_data = app_base_model.get_app_info_result(self.get_user_nick(), self.get_open_id(), self.get_access_token(), app_key, app_secret, main_user_open_id)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        invoke_result_data = self.business_process_executed(invoke_result_data, {})
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success(invoke_result_data.data)
+
+
+class CheckGmPowerHandler(ClientBaseHandler):
+    """
+    :description: 校验是否有GM工具权限
+    """
+    def get_async(self):
+        """
+        :description: 校验是否有GM工具权限
+        :param 
+        :return: True是 False否
+        :last_editors: HuangJianYi
+        """
+        is_power = False
+        user_nick = self.get_user_nick()
+        if not user_nick:
+            return self.response_json_error("error", "对不起,请先授权登录")
+        store_user_nick = user_nick.split(':')[0]
+        app_info_dict = AppInfoModel(context=self).get_dict("store_user_nick=%s", field="is_gm", params=store_user_nick)
+        if not app_info_dict:
+            is_power = False
+        if app_info_dict["is_gm"] == 1:
+            is_power = True
+        return self.response_json_success(is_power)
+
+
+class GetAppidByGmHandler(ClientBaseHandler):
+    """
+    :description: GM工具获取应用标识
+    """
+    @filter_check_params("store_name")
+    def get_async(self):
+        """
+        :description: 获取应用标识
+        :param store_name:店铺名称
+        :return app_id
+        :last_editors: HuangJianYi
+        """
+        app_id = ""
+        store_name = self.get_param("store_name")
+        user_nick = self.get_user_nick()
+        if not user_nick:
+            return self.response_json_error("error", "对不起,请先授权登录")
+        store_user_nick = user_nick.split(':')[0]
+        is_power = False
+
+        app_info_dict = AppInfoModel(context=self).get_dict("store_user_nick=%s", field="is_gm", params=store_user_nick)
+        if app_info_dict and app_info_dict["is_gm"] == 1:
+            is_power = True
+        if is_power == True:
+            app_info_dict = AppInfoModel(context=self).get_dict("store_name=%s", field="app_id", params=[store_name])
+            if app_info_dict:
+                app_id = app_info_dict["app_id"]
+        return self.response_json_success(app_id)
+
+
+class GetShortUrlHandler(ClientBaseHandler):
+    """
+    :description: 获取淘宝短链接
+    """
+    def get_async(self):
+        """
+        :description: 获取淘宝短链接
+        :param url:链接地址
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        access_token = self.get_access_token()
+        is_log = int(self.get_param("is_log", 0))
+        is_log = True if is_log == 1 else False
+        url = self.get_param("url")
+        top_base_model = TopBaseModel(context=self)
+        app_key, app_secret = self.get_app_key_secret()
+        invoke_result_data = top_base_model.get_short_url(url, access_token, app_key, app_secret, is_log)
+        if invoke_result_data.success == False:
+            return self.response_json_success("")
+        else:
+            return self.response_json_success(invoke_result_data.data)
+
+
+class GetHighPowerListHandler(ClientBaseHandler):
+    """
+    :description: 获取中台配置的高级权限列表
+    """
+    def get_async(self):
+        """
+        :description: 获取中台配置的高级权限列表
+        :return: list
+        :last_editors: HuangJianYi
+        """
+        user_nick = self.get_user_nick()
+        if not user_nick:
+            return self.response_json_error("Error", "对不起,请先授权登录")
+        store_user_nick = user_nick.split(':')[0]
+        access_token = self.get_access_token()
+        top_base_model = TopBaseModel(context=self)
+        mp_base_model = MPBaseModel(context=self)
+        # 如果登录账号的主账号等于配置文件指定的测试账号，则取子账号进行权限的获取，方便不同子账号进到不同的SaaS定制
+        test_config = share_config.get_value("test_config", {})
+        invoke_result_data = mp_base_model.get_custom_function_list(user_nick) if store_user_nick and store_user_nick == test_config.get("user_nick", "") else mp_base_model.get_custom_function_list(store_user_nick)
+        if invoke_result_data.success == True:
+            custom_function_list = invoke_result_data.data if invoke_result_data.data else []
+        else:
+            custom_function_list = mp_base_model.get_api_custom_function_list(user_nick) if store_user_nick and store_user_nick == test_config.get("user_nick", "") else mp_base_model.get_api_custom_function_list(store_user_nick)
+        config_data_list = []
+        if len(custom_function_list) == 0:
+            config_data = {}
+            config_data["is_customized"] = 0
+            config_data["name"] = ""
+            config_data["project_code"] = ""
+            config_data["cloud_app_id"] = 0
+            config_data["function_config_list"] = []
+            config_data["skin_config_list"] = []
+            app_key, app_secret = self.get_app_key_secret()
+            #获取项目编码
+            project_code = top_base_model.get_project_code(store_user_nick, access_token, app_key, app_secret)
+            invoke_result_data = mp_base_model.get_public_function_list(project_code)
+            if invoke_result_data.success == True:
+                public_function_list = invoke_result_data.data if invoke_result_data.data else []
+            else:
+                public_function_list = mp_base_model.get_api_public_function_list(project_code)
+            if len(public_function_list) > 0:
+                config_data["function_config_list"] = query(public_function_list[0]["function_info_second_list"]).select(lambda x: {"name": x["name"], "key_name": x["key_name"]}).to_list()
+                config_data["skin_config_list"] = query(public_function_list[0]["skin_ids_second_list"]).select(lambda x: {"name": x["name"], "theme_id": x["theme_id"]}).to_list()
+                config_data["name"] = public_function_list[0]["name"]
+                config_data["project_code"] = public_function_list[0]["project_code"]
+            config_data_list.append(config_data)
+        else:
+            for custom_function in custom_function_list:
+                config_data = {}
+                config_data["is_customized"] = 1
+                config_data["name"] = "定制版"
+                config_data["project_code"] = ""
+                config_data["cloud_app_id"] = custom_function["cloud_app_id"]
+                config_data["function_config_list"] = query(custom_function["function_info_second_list"]).select(lambda x: {"name": x["name"], "key_name": x["key_name"]}).to_list()
+                config_data["skin_config_list"] = query(custom_function["skin_ids_second_list"]).select(lambda x: {"name": x["name"], "theme_id": x["theme_id"]}).to_list()
+                config_data["module_name"] = custom_function["module_name"]
+                config_data["module_pic"] = custom_function["module_pic"]
+                config_data_list.append(config_data)
+        self.response_json_success(config_data_list)
+
+
+
+class UpdateStoreAssetHandler(ClientBaseHandler):
+    """
+    :description: 变更商家资产
+    """
+    @filter_check_params("asset_type,asset_value")
+    def post_async(self):
+        """
+        :description: 变更资产
+        :param app_id：应用标识
+        :param asset_type：资产类型
+        :param asset_value：变更的资产值
+        :param asset_object_id：资产对象标识
+        :param store_id：商家ID
+        :param store_name：商家名称
+        :return: response_json_success
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        asset_type = int(self.get_param("asset_type", 0))
+        asset_value = int(self.get_param("asset_value", 0))
+        asset_object_id = self.get_param("asset_object_id")
+        store_id = self.get_param("store_id")
+        store_name = self.get_param("store_name")
+
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code,invoke_result_data.error_message)
+
+        asset_base_model = AssetBaseModel(context=self)
+        invoke_result_data = asset_base_model.update_store_asset(app_id, store_id, store_name, asset_type, asset_value, asset_object_id, 3, "", "手动配置", "手动配置")
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code,invoke_result_data.error_message)
+        title = "资产配置；"
+        if asset_type == 1:
+            title = "次数配置；"
+        elif asset_type == 2:
+            title = "积分配置；"
+        elif asset_type == 3:
+            title = "档位配置；"
+        title = title + "店铺名称：" + store_name + "，store_id：" + store_id
+        self.create_operation_log(operation_type=OperationType.operate.value, model_name="store_asset_tb", title=title)
+        ref_params = {}
+        self.business_process_executed(invoke_result_data, ref_params)
+        return self.response_json_success()
+
+
+class StoreAssetListHandler(ClientBaseHandler):
+    """
+    :description: 获取商家资产列表
+    """
+    def get_async(self):
+        """
+        :description: 获取商家资产列表
+        :param app_id：应用标识
+        :param asset_type：资产类型(1-次数2-积分3-价格档位)
+        :return list
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        asset_type = int(self.get_param("asset_type", 0))
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_success({"data": []})
+        asset_base_model = AssetBaseModel(context=self)
+        ref_params = {}
+        return self.response_json_success(self.business_process_executed(asset_base_model.get_store_asset_list(app_id, asset_type), ref_params))
+
+
+class StoreAssetLogListHandler(ClientBaseHandler):
+    """
+    :description: 商家资产流水记录
+    """
+    def get_async(self):
+        """
+        :description: 商家资产流水记录
+        :param app_id：应用标识
+        :param asset_type：资产类型(1-次数2-积分3-价格档位)
+        :param page_size：条数
+        :param page_index：页数
+        :param asset_object_id：资产对象标识
+        :param start_date：开始时间
+        :param end_date：结束时间
+        :param source_type：来源类型（1-购买2-任务3-手动配置4-抽奖5-回购）
+        :param source_object_id：来源对象标识(比如来源类型是任务则对应任务类型)
+        :param operate_type：操作类型(0累计 1消耗)
+        :return list
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        page_index = int(self.get_param("page_index", 0))
+        page_size = int(self.get_param("page_size", 20))
+        start_date = self.get_param("start_date")
+        end_date = self.get_param("end_date")
+        store_id = self.get_param_int("store_id", 0)
+        store_name = self.get_param("store_name")
+        source_type = int(self.get_param("source_type", 0))
+        source_object_id = self.get_param("source_object_id")
+        asset_type = int(self.get_param("asset_type", 0))
+        asset_object_id = self.get_param("asset_object_id")
+        operate_type = int(self.get_param("operate_type", -1))
+
+        field = "*"
+        db_connect_key = "db_cloudapp"
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_success({"data": []})
+        else:
+            field = invoke_result_data.data["field"] if invoke_result_data.data.__contains__("field") else "*"
+            db_connect_key = invoke_result_data.data["db_connect_key"] if invoke_result_data.data.__contains__("db_connect_key") else "db_cloudapp"
+        asset_base_model = AssetBaseModel(context=self)
+        page_list, total = asset_base_model.get_store_asset_log_list(app_id, asset_type, db_connect_key, page_size, page_index, store_id, store_name, asset_object_id, start_date, end_date, source_type, source_object_id, field, is_cache=False, operate_type=operate_type)
+        ref_params = {}
+        page_info = PageInfo(page_index, page_size, total, self.business_process_executed(page_list, ref_params))
         return self.response_json_success(page_info)
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/handlers/server/base_s.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/handlers/server/base_s.py`

 * *Ordering differences only*

 * *Files 19% similar despite different names*

```diff
@@ -1,159 +1,159 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-26 17:00:55
-@LastEditTime: 2023-07-10 15:41:13
-@LastEditors: HuangJianYi
-@Description: 基础模块
-"""
-
-from seven_cloudapp_frame.libs.common import *
-from seven_cloudapp_frame.handlers.frame_base import *
-from seven_cloudapp_frame.models.enum import *
-from seven_cloudapp_frame.models.app_base_model import *
-from seven_cloudapp_frame.models.db_models.marketing.marketing_program_model import *
-from aliyunsdkcore.client import AcsClient
-from aliyunsdkcore.request import CommonRequest
-#从Python SDK导入SMS配置管理模块以及安全认证模块
-from baidubce.bce_client_configuration import BceClientConfiguration
-from baidubce.auth.bce_credentials import BceCredentials
-import baidubce.services.sms.sms_client as sms
-import baidubce.exception as ex
-
-
-class LeftNavigationHandler(ClientBaseHandler):
-    """
-    :description: 左侧导航栏
-    """
-    def get_async(self):
-        """
-        :description: 左侧导航栏
-        :return:
-        :last_editors: HuangJianYi
-        """
-        app_base_model = AppBaseModel(context=self)
-        access_token = self.get_access_token()
-        app_key, app_secret = self.get_app_key_secret()
-        invoke_result_data = app_base_model.get_left_navigation(self.get_user_nick(), access_token, app_key, app_secret, self.get_app_id())
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success(invoke_result_data.data)
-
-
-class FriendLinkListHandler(ClientBaseHandler):
-    """
-    :description: 获取友情链接产品互推列表
-    """
-    def get_async(self):
-        """
-        :description: 获取友情链接产品互推列表
-        :param {*}
-        :return list
-        :last_editors: HuangJianYi
-        """
-        friend_link_model = FriendLinkModel(context=self)
-        friend_link_list = friend_link_model.get_cache_list(where="is_release=1")
-        return self.response_json_success(friend_link_list)
-
-
-class SendSmsHandler(ClientBaseHandler):
-    """
-    :description: 发送短信
-    """
-    @filter_check_params("telephone")
-    def get_async(self):
-        """
-        :description: 发送短信
-        :param thelephone：电话号码
-        :param sms_type：短信渠道1-阿里 2-百度
-        :return 
-        :last_editors: HuangJianYi
-        """
-        open_id = self.get_open_id()
-        telephone = self.get_param("telephone")
-        sms_type = self.get_param_int("sms_type",2)
-        result_code = str(random.randint(100000, 999999))
-        if sms_type == 1:
-            sms_ali_config = share_config.get_value("sms_ali_config", {"host": "", "ak": "", "secret": "", "region_id": "", "sign_name": "", "template_code": ""})
-            client = AcsClient(sms_ali_config["ak"], sms_ali_config["secret"], sms_ali_config["region_id"])
-            request = CommonRequest()
-            request.set_accept_format('json')
-            request.set_domain(sms_ali_config["host"])
-            request.set_method('POST')
-            request.set_protocol_type('https')  # https | http
-            request.set_version('2017-05-25')
-            request.set_action_name('SendSms')
-
-            request.add_query_param('RegionId', sms_ali_config["region_id"])
-            request.add_query_param('PhoneNumbers', telephone)
-            request.add_query_param('SignName', sms_ali_config["sign_name"])
-            request.add_query_param('TemplateCode', sms_ali_config["template_code"])
-            request.add_query_param('TemplateParam', "{\"code\":" + result_code + "}")
-            response = client.do_action(request)
-            result = dict(json.loads(response))
-            result["result_code"] = result_code
-            #记录验证码
-            SevenHelper.redis_init().set(f"user_bind_phone_code:{open_id}", result_code, ex=300)
-            return self.response_json_success()
-        else:
-            #设置SmsClient的Host，Access Key ID和Secret Access Key
-            sms_bce_config = share_config.get_value("sms_bce_config", {"host": "", "ak": "", "sk": "", "signature_id": "", "template_id": ""})
-            sms_config = BceClientConfiguration(credentials=BceCredentials(sms_bce_config["ak"], sms_bce_config["sk"]), endpoint=sms_bce_config["host"])
-            #新建SmsClient
-            sms_client = sms.SmsClient(sms_config)
-            try:
-                response = sms_client.send_message(signature_id=sms_bce_config["signature_id"], template_id=sms_bce_config["template_id"], mobile=telephone, content_var_dict={'code': result_code, 'time': '30'})
-                #记录验证码
-                SevenHelper.redis_init().set(f"user_bind_phone_code:{open_id}", result_code, ex=300)
-                return self.response_json_success()
-            except ex.BceHttpClientError as e:
-                if isinstance(e.last_error, ex.BceServerError):
-                    self.logger_error.error(f"发送短信失败。Response:{e.last_error.status_code},code:{e.last_error.code},request_id:{e.last_error.request_id}")
-                else:
-                    self.logger_error.error(f"发送短信失败。Unknown exception:{e}")
-                return self.response_json_error("error","发送失败")
-
-
-class MarketingProgramListHandler(ClientBaseHandler):
-    """
-    :description: 获取营销方案列表获取营销方案列表
-    """
-    def get_async(self):
-        """
-        :description: 获取营销方案列表
-        :return: 列表
-        :last_editors: HuangJianYi
-        """
-        marketing_program_list = MarketingProgramModel(context=self).get_cache_dict_list()
-        return self.response_json_success(marketing_program_list)
-
-
-class GetProductPriceHandler(ClientBaseHandler):
-    """
-    :description: 获取产品价格信息
-    """
-    def get_async(self):
-        """
-        :description: 获取产品价格信息
-        :param project_code：项目编码
-        :return 
-        :last_editors: HuangJianYi
-        """
-        project_code = self.get_param("project_code")
-        product_price_model = ProductPriceModel(context=self)
-        now_date = SevenHelper.get_now_datetime()
-        condition_where = ConditionWhere()
-        condition_where.add_condition("%s>=begin_time and %s<=end_time and is_release=1")
-        params = [now_date, now_date]
-        if project_code:
-            condition_where.add_condition("project_code=%s")
-            params.append(project_code)
-        product_price = product_price_model.get_dict(where=condition_where.to_string(), order_by="create_time desc", limit="1", params=params)
-        if not product_price:
-            return self.response_json_error("error", "找不到产品价格信息")
-        try:
-            product_price["content"] = SevenHelper.json_loads(product_price["content"])
-        except:
-            return self.response_json_error("error", "产品价格信息格式有误")
-
-        return self.response_json_success(product_price)
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-26 17:00:55
+@LastEditTime: 2023-07-10 15:41:13
+@LastEditors: HuangJianYi
+@Description: 基础模块
+"""
+
+from seven_cloudapp_frame.libs.common import *
+from seven_cloudapp_frame.handlers.frame_base import *
+from seven_cloudapp_frame.models.enum import *
+from seven_cloudapp_frame.models.app_base_model import *
+from seven_cloudapp_frame.models.db_models.marketing.marketing_program_model import *
+from aliyunsdkcore.client import AcsClient
+from aliyunsdkcore.request import CommonRequest
+#从Python SDK导入SMS配置管理模块以及安全认证模块
+from baidubce.bce_client_configuration import BceClientConfiguration
+from baidubce.auth.bce_credentials import BceCredentials
+import baidubce.services.sms.sms_client as sms
+import baidubce.exception as ex
+
+
+class LeftNavigationHandler(ClientBaseHandler):
+    """
+    :description: 左侧导航栏
+    """
+    def get_async(self):
+        """
+        :description: 左侧导航栏
+        :return:
+        :last_editors: HuangJianYi
+        """
+        app_base_model = AppBaseModel(context=self)
+        access_token = self.get_access_token()
+        app_key, app_secret = self.get_app_key_secret()
+        invoke_result_data = app_base_model.get_left_navigation(self.get_user_nick(), access_token, app_key, app_secret, self.get_app_id())
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success(invoke_result_data.data)
+
+
+class FriendLinkListHandler(ClientBaseHandler):
+    """
+    :description: 获取友情链接产品互推列表
+    """
+    def get_async(self):
+        """
+        :description: 获取友情链接产品互推列表
+        :param {*}
+        :return list
+        :last_editors: HuangJianYi
+        """
+        friend_link_model = FriendLinkModel(context=self)
+        friend_link_list = friend_link_model.get_cache_list(where="is_release=1")
+        return self.response_json_success(friend_link_list)
+
+
+class SendSmsHandler(ClientBaseHandler):
+    """
+    :description: 发送短信
+    """
+    @filter_check_params("telephone")
+    def get_async(self):
+        """
+        :description: 发送短信
+        :param thelephone：电话号码
+        :param sms_type：短信渠道1-阿里 2-百度
+        :return 
+        :last_editors: HuangJianYi
+        """
+        open_id = self.get_open_id()
+        telephone = self.get_param("telephone")
+        sms_type = self.get_param_int("sms_type",2)
+        result_code = str(random.randint(100000, 999999))
+        if sms_type == 1:
+            sms_ali_config = share_config.get_value("sms_ali_config", {"host": "", "ak": "", "secret": "", "region_id": "", "sign_name": "", "template_code": ""})
+            client = AcsClient(sms_ali_config["ak"], sms_ali_config["secret"], sms_ali_config["region_id"])
+            request = CommonRequest()
+            request.set_accept_format('json')
+            request.set_domain(sms_ali_config["host"])
+            request.set_method('POST')
+            request.set_protocol_type('https')  # https | http
+            request.set_version('2017-05-25')
+            request.set_action_name('SendSms')
+
+            request.add_query_param('RegionId', sms_ali_config["region_id"])
+            request.add_query_param('PhoneNumbers', telephone)
+            request.add_query_param('SignName', sms_ali_config["sign_name"])
+            request.add_query_param('TemplateCode', sms_ali_config["template_code"])
+            request.add_query_param('TemplateParam', "{\"code\":" + result_code + "}")
+            response = client.do_action(request)
+            result = dict(json.loads(response))
+            result["result_code"] = result_code
+            #记录验证码
+            SevenHelper.redis_init().set(f"user_bind_phone_code:{open_id}", result_code, ex=300)
+            return self.response_json_success()
+        else:
+            #设置SmsClient的Host，Access Key ID和Secret Access Key
+            sms_bce_config = share_config.get_value("sms_bce_config", {"host": "", "ak": "", "sk": "", "signature_id": "", "template_id": ""})
+            sms_config = BceClientConfiguration(credentials=BceCredentials(sms_bce_config["ak"], sms_bce_config["sk"]), endpoint=sms_bce_config["host"])
+            #新建SmsClient
+            sms_client = sms.SmsClient(sms_config)
+            try:
+                response = sms_client.send_message(signature_id=sms_bce_config["signature_id"], template_id=sms_bce_config["template_id"], mobile=telephone, content_var_dict={'code': result_code, 'time': '30'})
+                #记录验证码
+                SevenHelper.redis_init().set(f"user_bind_phone_code:{open_id}", result_code, ex=300)
+                return self.response_json_success()
+            except ex.BceHttpClientError as e:
+                if isinstance(e.last_error, ex.BceServerError):
+                    self.logger_error.error(f"发送短信失败。Response:{e.last_error.status_code},code:{e.last_error.code},request_id:{e.last_error.request_id}")
+                else:
+                    self.logger_error.error(f"发送短信失败。Unknown exception:{e}")
+                return self.response_json_error("error","发送失败")
+
+
+class MarketingProgramListHandler(ClientBaseHandler):
+    """
+    :description: 获取营销方案列表获取营销方案列表
+    """
+    def get_async(self):
+        """
+        :description: 获取营销方案列表
+        :return: 列表
+        :last_editors: HuangJianYi
+        """
+        marketing_program_list = MarketingProgramModel(context=self).get_cache_dict_list()
+        return self.response_json_success(marketing_program_list)
+
+
+class GetProductPriceHandler(ClientBaseHandler):
+    """
+    :description: 获取产品价格信息
+    """
+    def get_async(self):
+        """
+        :description: 获取产品价格信息
+        :param project_code：项目编码
+        :return 
+        :last_editors: HuangJianYi
+        """
+        project_code = self.get_param("project_code")
+        product_price_model = ProductPriceModel(context=self)
+        now_date = SevenHelper.get_now_datetime()
+        condition_where = ConditionWhere()
+        condition_where.add_condition("%s>=begin_time and %s<=end_time and is_release=1")
+        params = [now_date, now_date]
+        if project_code:
+            condition_where.add_condition("project_code=%s")
+            params.append(project_code)
+        product_price = product_price_model.get_dict(where=condition_where.to_string(), order_by="create_time desc", limit="1", params=params)
+        if not product_price:
+            return self.response_json_error("error", "找不到产品价格信息")
+        try:
+            product_price["content"] = SevenHelper.json_loads(product_price["content"])
+        except:
+            return self.response_json_error("error", "产品价格信息格式有误")
+
+        return self.response_json_success(product_price)
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/handlers/server/cms_s.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/handlers/server/cms_s.py`

 * *Ordering differences only*

 * *Files 16% similar despite different names*

```diff
@@ -1,221 +1,221 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-26 17:00:55
-@LastEditTime: 2023-02-16 17:52:26
-@LastEditors: HuangJianYi
-@Description: 资讯模块
-"""
-
-from seven_cloudapp_frame.libs.common import *
-from seven_cloudapp_frame.handlers.frame_base import *
-from seven_cloudapp_frame.models.enum import *
-from seven_cloudapp_frame.models.cms_base_model import *
-from seven_cloudapp_frame.models.db_models.cms.cms_info_model import *
-
-
-class SaveCmsInfoHandler(ClientBaseHandler):
-    """
-    :description: 保存资讯信息
-    """
-    @filter_check_params("info_title")
-    def get_async(self):
-        """
-        :description: 保存资讯信息
-        :params info_title:标题
-        :return 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        place_id = self.get_param_int("place_id", 0)
-        cms_id = self.get_param_int("cms_id", 0)
-        info_title = self.get_param("info_title")
-        simple_title = self.get_param("simple_title")
-        simple_title_url = self.get_param("simple_title_url")
-        info_type = self.get_param_int("info_type", 0)
-        info_summary = self.get_param("info_summary")
-        info_tag = self.get_param("info_tag")
-        info_mark = self.get_param("info_mark")
-        target_url = self.get_param("target_url")
-        min_pic = self.get_param("min_pic")
-        mid_pic = self.get_param("mid_pic")
-        max_pic = self.get_param("max_pic")
-        info_data = self.get_param("info_data")
-        pic_collect_json = self.get_param("pic_collect_json")
-        sort_index = self.get_param_int("sort_index", 0)
-        is_release = self.get_param_int("is_release", 0)
-        i1 = self.get_param_int("i1", 0)
-        i2 = self.get_param_int("i2", 0)
-        i3 = self.get_param_int("i3", 0)
-        i4 = self.get_param_int("i4", 0)
-        s1 = self.get_param("s1")
-        s2 = self.get_param("s2")
-        s3 = self.get_param("s3")
-        s4 = self.get_param("s4")
-
-        cms_base_model = CmsBaseModel(context=self)
-        invoke_result_data = cms_base_model.save_cms_info(place_id, cms_id, app_id, act_id, info_title, simple_title, simple_title_url, info_type, info_summary, info_tag, info_mark, target_url, min_pic, mid_pic, max_pic, info_data, pic_collect_json, sort_index, is_release, i1, i2, i3, i4, s1, s2, s3, s4)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        if invoke_result_data.data["is_add"] == True:
-            # 记录日志
-            self.create_operation_log(operation_type=OperationType.add.value, model_name=invoke_result_data.data["new"].__str__(), old_detail=None, update_detail=invoke_result_data.data["new"], title=info_title)
-        else:
-            self.create_operation_log(operation_type=OperationType.update.value, model_name=invoke_result_data.data["new"].__str__(), old_detail=invoke_result_data.data["old"], update_detail=invoke_result_data.data["new"], title=info_title)
-
-        return self.response_json_success(invoke_result_data.data["new"].id)
-
-
-class UpdateCmsInfoHandler(ClientBaseHandler):
-    """
-    :description: 更新资讯信息
-    """
-
-    @filter_check_params("cms_id")
-    def get_async(self):
-        """
-        :description: 更新资讯信息
-        :params cms_id:资讯标识
-        :return 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        place_id = self.get_param_int("place_id", 0)
-        cms_id = self.get_param_int("cms_id", 0)
-        info_title = self.get_param("info_title",None)
-        simple_title = self.get_param("simple_title", None)
-        simple_title_url = self.get_param("simple_title_url", None)
-        info_type = self.get_param_int("info_type", -1)
-        info_summary = self.get_param("info_summary", None)
-        info_tag = self.get_param("info_tag", None)
-        info_mark = self.get_param("info_mark", None)
-        target_url = self.get_param("target_url", None)
-        min_pic = self.get_param("min_pic", None)
-        mid_pic = self.get_param("mid_pic", None)
-        max_pic = self.get_param("max_pic", None)
-        info_data = self.get_param("info_data", None)
-        pic_collect_json = self.get_param("pic_collect_json", None)
-        sort_index = self.get_param_int("sort_index", -1)
-        is_release = self.get_param_int("is_release", -1)
-        i1 = self.get_param_int("i1", -1)
-        i2 = self.get_param_int("i2", -1)
-        i3 = self.get_param_int("i3", -1)
-        i4 = self.get_param_int("i4", -1)
-        s1 = self.get_param("s1", None)
-        s2 = self.get_param("s2", None)
-        s3 = self.get_param("s3", None)
-        s4 = self.get_param("s4", None)
-
-        cms_base_model = CmsBaseModel(context=self)
-        invoke_result_data = cms_base_model.save_cms_info(place_id, cms_id, app_id, act_id, info_title, simple_title, simple_title_url, info_type, info_summary, info_tag, info_mark, target_url, min_pic, mid_pic, max_pic, info_data, pic_collect_json, sort_index, is_release, i1, i2, i3, i4, s1, s2, s3, s4)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        self.create_operation_log(operation_type=OperationType.update.value, model_name=invoke_result_data.data["new"].__str__(), old_detail=invoke_result_data.data["old"], update_detail=invoke_result_data.data["new"], title=info_title)
-        return self.response_json_success(invoke_result_data.data["new"].id)
-
-
-class CmsInfoListHandler(ClientBaseHandler):
-    """
-    :description: 获取资讯列表
-    """
-    def get_async(self):
-        """
-        :description: 获取位置信息列表
-        :params place_id:位置标识
-        :return 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        place_id = self.get_param_int("place_id", 0)
-        page_size = self.get_param_int("page_size", 20)
-        page_index = self.get_param_int("page_index", 0)
-
-        condition = None
-        params = None
-        order_by = "id desc"
-        field = "*"
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_success({"data": []})
-        else:
-            condition = invoke_result_data.data["condition"] if invoke_result_data.data.__contains__("condition") else None
-            params = invoke_result_data.data["params"] if invoke_result_data.data.__contains__("params") else None
-            order_by = invoke_result_data.data["order_by"] if invoke_result_data.data.__contains__("order_by") else "id desc"
-            field = invoke_result_data.data["field"] if invoke_result_data.data.__contains__("field") else "*"
-        cms_base_model = CmsBaseModel(context=self)
-        if condition and params:
-            page_list, total = cms_base_model.get_cms_info_list_v2(place_id=place_id, page_size=page_size, page_index=page_index, order_by=order_by, field=field, condition=condition, params=params, is_cache=False)
-        else:
-            page_list, total = cms_base_model.get_cms_info_list(place_id=place_id, page_size=page_size, page_index=page_index, order_by=order_by, field=field, app_id=app_id, act_id=act_id, is_cache=False)
-        page_info = PageInfo(page_index, page_size, total, self.business_process_executed(page_list, ref_params={}))
-        return self.response_json_success(page_info)
-
-
-class DeleteCmsInfoHandler(ClientBaseHandler):
-    """
-    :description: 删除资讯
-    """
-
-    @filter_check_params("cms_id")
-    def get_async(self):
-        """
-        :description: 删除资讯
-        :param app_id：应用标识
-        :param cms_id：资讯标识
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        cms_id = self.get_param_int("cms_id", 0)
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        title_prefix = invoke_result_data.data["title_prefix"] if invoke_result_data.data.__contains__("title_prefix") else "资讯"
-        cms_base_model = CmsBaseModel(context=self)
-        invoke_result_data = cms_base_model.delete_cms_info(app_id, cms_id)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        self.create_operation_log(operation_type=OperationType.delete.value, model_name="cms_info_tb", title=title_prefix + ";" + invoke_result_data.data["info_title"])
-        ref_params = {}
-        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success()
-
-
-class ReleaseCmsInfoHandler(ClientBaseHandler):
-    """
-    :description: 上下架资讯
-    """
-
-    @filter_check_params("cms_id")
-    def get_async(self):
-        """
-        :description: 上下架资讯
-        :param app_id：应用标识
-        :param cms_id：资讯标识
-        :param is_release: 是否发布 1-是 0-否
-        :return:
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        cms_id = self.get_param_int("cms_id", 0)
-        is_release = self.get_param_int("is_release", 0)
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        title_prefix = invoke_result_data.data["title_prefix"] if invoke_result_data.data.__contains__("title_prefix") else "资讯"
-        cms_base_model = CmsBaseModel(context=self)
-        invoke_result_data = cms_base_model.release_cms_info(app_id, cms_id, is_release)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        operation_type = OperationType.release.value if is_release == 1 else OperationType.un_release.value
-        self.create_operation_log(operation_type=operation_type, model_name="cms_info_tb", title=title_prefix + ";" + invoke_result_data.data["info_title"])
-        ref_params = {}
-        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success()
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-26 17:00:55
+@LastEditTime: 2023-02-16 17:52:26
+@LastEditors: HuangJianYi
+@Description: 资讯模块
+"""
+
+from seven_cloudapp_frame.libs.common import *
+from seven_cloudapp_frame.handlers.frame_base import *
+from seven_cloudapp_frame.models.enum import *
+from seven_cloudapp_frame.models.cms_base_model import *
+from seven_cloudapp_frame.models.db_models.cms.cms_info_model import *
+
+
+class SaveCmsInfoHandler(ClientBaseHandler):
+    """
+    :description: 保存资讯信息
+    """
+    @filter_check_params("info_title")
+    def get_async(self):
+        """
+        :description: 保存资讯信息
+        :params info_title:标题
+        :return 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        place_id = self.get_param_int("place_id", 0)
+        cms_id = self.get_param_int("cms_id", 0)
+        info_title = self.get_param("info_title")
+        simple_title = self.get_param("simple_title")
+        simple_title_url = self.get_param("simple_title_url")
+        info_type = self.get_param_int("info_type", 0)
+        info_summary = self.get_param("info_summary")
+        info_tag = self.get_param("info_tag")
+        info_mark = self.get_param("info_mark")
+        target_url = self.get_param("target_url")
+        min_pic = self.get_param("min_pic")
+        mid_pic = self.get_param("mid_pic")
+        max_pic = self.get_param("max_pic")
+        info_data = self.get_param("info_data")
+        pic_collect_json = self.get_param("pic_collect_json")
+        sort_index = self.get_param_int("sort_index", 0)
+        is_release = self.get_param_int("is_release", 0)
+        i1 = self.get_param_int("i1", 0)
+        i2 = self.get_param_int("i2", 0)
+        i3 = self.get_param_int("i3", 0)
+        i4 = self.get_param_int("i4", 0)
+        s1 = self.get_param("s1")
+        s2 = self.get_param("s2")
+        s3 = self.get_param("s3")
+        s4 = self.get_param("s4")
+
+        cms_base_model = CmsBaseModel(context=self)
+        invoke_result_data = cms_base_model.save_cms_info(place_id, cms_id, app_id, act_id, info_title, simple_title, simple_title_url, info_type, info_summary, info_tag, info_mark, target_url, min_pic, mid_pic, max_pic, info_data, pic_collect_json, sort_index, is_release, i1, i2, i3, i4, s1, s2, s3, s4)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if invoke_result_data.data["is_add"] == True:
+            # 记录日志
+            self.create_operation_log(operation_type=OperationType.add.value, model_name=invoke_result_data.data["new"].__str__(), old_detail=None, update_detail=invoke_result_data.data["new"], title=info_title)
+        else:
+            self.create_operation_log(operation_type=OperationType.update.value, model_name=invoke_result_data.data["new"].__str__(), old_detail=invoke_result_data.data["old"], update_detail=invoke_result_data.data["new"], title=info_title)
+
+        return self.response_json_success(invoke_result_data.data["new"].id)
+
+
+class UpdateCmsInfoHandler(ClientBaseHandler):
+    """
+    :description: 更新资讯信息
+    """
+
+    @filter_check_params("cms_id")
+    def get_async(self):
+        """
+        :description: 更新资讯信息
+        :params cms_id:资讯标识
+        :return 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        place_id = self.get_param_int("place_id", 0)
+        cms_id = self.get_param_int("cms_id", 0)
+        info_title = self.get_param("info_title",None)
+        simple_title = self.get_param("simple_title", None)
+        simple_title_url = self.get_param("simple_title_url", None)
+        info_type = self.get_param_int("info_type", -1)
+        info_summary = self.get_param("info_summary", None)
+        info_tag = self.get_param("info_tag", None)
+        info_mark = self.get_param("info_mark", None)
+        target_url = self.get_param("target_url", None)
+        min_pic = self.get_param("min_pic", None)
+        mid_pic = self.get_param("mid_pic", None)
+        max_pic = self.get_param("max_pic", None)
+        info_data = self.get_param("info_data", None)
+        pic_collect_json = self.get_param("pic_collect_json", None)
+        sort_index = self.get_param_int("sort_index", -1)
+        is_release = self.get_param_int("is_release", -1)
+        i1 = self.get_param_int("i1", -1)
+        i2 = self.get_param_int("i2", -1)
+        i3 = self.get_param_int("i3", -1)
+        i4 = self.get_param_int("i4", -1)
+        s1 = self.get_param("s1", None)
+        s2 = self.get_param("s2", None)
+        s3 = self.get_param("s3", None)
+        s4 = self.get_param("s4", None)
+
+        cms_base_model = CmsBaseModel(context=self)
+        invoke_result_data = cms_base_model.save_cms_info(place_id, cms_id, app_id, act_id, info_title, simple_title, simple_title_url, info_type, info_summary, info_tag, info_mark, target_url, min_pic, mid_pic, max_pic, info_data, pic_collect_json, sort_index, is_release, i1, i2, i3, i4, s1, s2, s3, s4)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        self.create_operation_log(operation_type=OperationType.update.value, model_name=invoke_result_data.data["new"].__str__(), old_detail=invoke_result_data.data["old"], update_detail=invoke_result_data.data["new"], title=info_title)
+        return self.response_json_success(invoke_result_data.data["new"].id)
+
+
+class CmsInfoListHandler(ClientBaseHandler):
+    """
+    :description: 获取资讯列表
+    """
+    def get_async(self):
+        """
+        :description: 获取位置信息列表
+        :params place_id:位置标识
+        :return 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        place_id = self.get_param_int("place_id", 0)
+        page_size = self.get_param_int("page_size", 20)
+        page_index = self.get_param_int("page_index", 0)
+
+        condition = None
+        params = None
+        order_by = "id desc"
+        field = "*"
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_success({"data": []})
+        else:
+            condition = invoke_result_data.data["condition"] if invoke_result_data.data.__contains__("condition") else None
+            params = invoke_result_data.data["params"] if invoke_result_data.data.__contains__("params") else None
+            order_by = invoke_result_data.data["order_by"] if invoke_result_data.data.__contains__("order_by") else "id desc"
+            field = invoke_result_data.data["field"] if invoke_result_data.data.__contains__("field") else "*"
+        cms_base_model = CmsBaseModel(context=self)
+        if condition and params:
+            page_list, total = cms_base_model.get_cms_info_list_v2(place_id=place_id, page_size=page_size, page_index=page_index, order_by=order_by, field=field, condition=condition, params=params, is_cache=False)
+        else:
+            page_list, total = cms_base_model.get_cms_info_list(place_id=place_id, page_size=page_size, page_index=page_index, order_by=order_by, field=field, app_id=app_id, act_id=act_id, is_cache=False)
+        page_info = PageInfo(page_index, page_size, total, self.business_process_executed(page_list, ref_params={}))
+        return self.response_json_success(page_info)
+
+
+class DeleteCmsInfoHandler(ClientBaseHandler):
+    """
+    :description: 删除资讯
+    """
+
+    @filter_check_params("cms_id")
+    def get_async(self):
+        """
+        :description: 删除资讯
+        :param app_id：应用标识
+        :param cms_id：资讯标识
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        cms_id = self.get_param_int("cms_id", 0)
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        title_prefix = invoke_result_data.data["title_prefix"] if invoke_result_data.data.__contains__("title_prefix") else "资讯"
+        cms_base_model = CmsBaseModel(context=self)
+        invoke_result_data = cms_base_model.delete_cms_info(app_id, cms_id)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        self.create_operation_log(operation_type=OperationType.delete.value, model_name="cms_info_tb", title=title_prefix + ";" + invoke_result_data.data["info_title"])
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success()
+
+
+class ReleaseCmsInfoHandler(ClientBaseHandler):
+    """
+    :description: 上下架资讯
+    """
+
+    @filter_check_params("cms_id")
+    def get_async(self):
+        """
+        :description: 上下架资讯
+        :param app_id：应用标识
+        :param cms_id：资讯标识
+        :param is_release: 是否发布 1-是 0-否
+        :return:
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        cms_id = self.get_param_int("cms_id", 0)
+        is_release = self.get_param_int("is_release", 0)
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        title_prefix = invoke_result_data.data["title_prefix"] if invoke_result_data.data.__contains__("title_prefix") else "资讯"
+        cms_base_model = CmsBaseModel(context=self)
+        invoke_result_data = cms_base_model.release_cms_info(app_id, cms_id, is_release)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        operation_type = OperationType.release.value if is_release == 1 else OperationType.un_release.value
+        self.create_operation_log(operation_type=operation_type, model_name="cms_info_tb", title=title_prefix + ";" + invoke_result_data.data["info_title"])
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success()
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/handlers/server/goods_s.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/handlers/server/goods_s.py`

 * *Ordering differences only*

 * *Files 9% similar despite different names*

```diff
@@ -1,218 +1,218 @@
-# -*- coding: utf-8 -*-
-"""
-:Author: HuangJianYi
-:Date: 2021-08-03 10:11:39
-@LastEditTime: 2023-05-12 10:40:23
-@LastEditors: HuangJianYi
-:description: 商品模块
-"""
-from seven_cloudapp_frame.handlers.frame_base import *
-from seven_cloudapp_frame.models.top_base_model import *
-from seven_cloudapp_frame.models.goods_base_model import *
-
-
-class GoodsListHandler(ClientBaseHandler):
-    """
-    :description: 商品列表（获取当前会话用户出售中的商品列表）
-    """
-    def get_async(self):
-        """
-        :description: 导入商品列表（获取当前会话用户出售中的商品列表）
-        :param goods_name：商品名称
-        :param order_tag：order_tag
-        :param order_by：排序类型
-        :param page_index：页索引
-        :param page_size：页大小
-        :return: 列表
-        :last_editors: HuangJianYi
-        """
-        access_token = self.get_access_token()
-        goods_name = self.get_param("goods_name")
-        order_tag = self.get_param("order_tag", "list_time")
-        order_by = self.get_param("order_by", "desc")
-        page_index = self.get_param_int("page_index", 0)
-        page_size = self.get_param_int("page_size", 20)
-        is_log = self.get_param_int("is_log", 0)
-        is_log = True if is_log == 1 else False
-
-        top_base_model = TopBaseModel(context=self)
-        app_key, app_secret = self.get_app_key_secret()
-        invoke_result_data = top_base_model.get_goods_list(page_index, page_size, goods_name, order_tag, order_by, access_token, app_key, app_secret, is_log=is_log)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success(invoke_result_data.data)
-
-
-class GoodsListByGoodsIDHandler(ClientBaseHandler):
-    """
-    :description: 根据商品ID串获取商品列表
-    """
-    @filter_check_params("goods_ids")
-    def get_async(self):
-        """
-        :description: 根据商品ID获取商品列表
-        :param goods_ids：商品ID串，多个逗号,分隔
-        :return: list
-        :last_editors: HuangJianYi
-        """
-        access_token = self.get_access_token()
-        goods_ids = self.get_param("goods_ids")
-        is_log = self.get_param_int("is_log", 0)
-        is_log = True if is_log == 1 else False
-
-        top_base_model = TopBaseModel(context=self)
-        app_key, app_secret = self.get_app_key_secret()
-        invoke_result_data = top_base_model.get_goods_list_by_goodsids(goods_ids, access_token, app_key,app_secret, is_log=is_log)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success(invoke_result_data.data)
-
-
-class GoodsInfoHandler(ClientBaseHandler):
-    """
-    :description: 获取商品信息
-    """
-    @filter_check_params("goods_id")
-    def get_async(self):
-        """
-        :description: 获取商品信息
-        :param goods_id：商品ID
-        :return: 商品信息
-        :last_editors: HuangJianYi
-        """
-        access_token = self.get_access_token()
-        goods_id = self.get_param("goods_id")
-        is_log = self.get_param_int("is_log", 0)
-        is_log = True if is_log == 1 else False
-
-        top_base_model = TopBaseModel(context=self)
-        app_key, app_secret = self.get_app_key_secret()
-        invoke_result_data = top_base_model.get_goods_info(goods_id, access_token, app_key, app_secret, is_log=is_log)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success(invoke_result_data.data)
-
-
-class BenefitDetailHandler(ClientBaseHandler):
-    """
-    :description: 获取优惠券详情信息
-    """
-    def get_async(self):
-        """
-        :description: 获取优惠券详情信息
-        :param right_ename:奖池ID
-        :return: dict
-        :last_editors: HuangJianYi
-        """
-        access_token = self.get_access_token()
-        right_ename = self.get_param("right_ename")
-        is_log = self.get_param_int("is_log", 0)
-        is_log = True if is_log == 1 else False
-
-        top_base_model = TopBaseModel(context=self)
-        app_key, app_secret = self.get_app_key_secret()
-        invoke_result_data = top_base_model.alibaba_benefit_query(right_ename, access_token,app_key, app_secret, is_log=is_log)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success(invoke_result_data.data)
-
-
-class InventoryGoodsListHandler(ClientBaseHandler):
-    """
-    :description: 导入商品列表（获取当前用户作为卖家的仓库中的商品列表）
-    """
-    def get_async(self):
-        """
-        :description: 导入商品列表（获取当前用户作为卖家的仓库中的商品列表）
-        :param goods_name：商品名称
-        :param order_tag：order_tag
-        :param order_by：排序类型
-        :param page_index：页索引
-        :param page_size：页大小
-        :return: 列表
-        :last_editors: HuangJianYi
-        """
-        access_token = self.get_access_token()
-        goods_name = self.get_param("goods_name")
-        order_tag = self.get_param("order_tag", "list_time")
-        order_by = self.get_param("order_by", "desc")
-        page_index = self.get_param_int("page_index", 0)
-        page_size = self.get_param_int("page_size", 20)
-        top_base_model = TopBaseModel(context=self)
-        app_key, app_secret = self.get_app_key_secret()
-        invoke_result_data = top_base_model.get_goods_inventory_list(page_index, page_size, goods_name, order_tag, order_by, access_token, app_key, app_secret)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success(invoke_result_data.data)
-
-
-class SpecialGoodsListHandler(ClientBaseHandler):
-    """
-    :description: 专属下单商品列表
-    """
-    @filter_check_params("app_id")
-    def get_async(self):
-        """
-        :description: 专属下单商品列表
-        :param app_id：应用标识
-        :param page_index：页索引
-        :param page_size：页大小
-        :param goods_name：商品名称
-        :param goods_id：商品ID
-        :return:
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        page_index = self.get_param_int("page_index", 0)
-        page_size = self.get_param_int("page_size", 20)
-        goods_name = self.get_param("goods_name")
-        goods_id = self.get_param("goods_id")
-        access_token = self.get_access_token()
-        is_log = self.get_param_int("is_log", 0)
-        is_log = True if is_log == 1 else False
-
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        if not invoke_result_data.data:
-            invoke_result_data.data = {}
-        is_top_data = invoke_result_data.data["is_top_data"] if invoke_result_data.data.__contains__("is_top_data") else False #是否直接取淘宝top数据
-        goods_base_model = GoodsBaseModel(context=self)
-        app_key, app_secret = self.get_app_key_secret()
-        if is_top_data == False:
-            invoke_result_data = goods_base_model.get_special_goods_list(app_id, goods_name, access_token, app_key, app_secret, is_log, page_index, page_size)
-        else:
-            invoke_result_data = goods_base_model.get_special_goods_list_for_tb(app_id, goods_id, access_token, app_key, app_secret, is_log, page_index, page_size)
-
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        ref_params = {}
-        return self.response_json_success(self.business_process_executed(invoke_result_data.data, ref_params))
-
-
-class BindSpecialGoodsHandler(ClientBaseHandler):
-    """
-    :description: 专属下单商品绑定(单个商品)
-    """
-    @filter_check_params("goods_id")
-    def get_async(self):
-        """
-        :description: 专属下单商品绑定(单个商品)
-        :param goods_id：商品ID
-        :param goods_name: 商品名称
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        access_token = self.get_access_token()
-        goods_id = self.get_param("goods_id")
-        goods_name = self.get_param("goods_name")
-        is_log = self.get_param_int("is_log", 0)
-        is_log = True if is_log == 1 else False
-
-        goods_base_model = GoodsBaseModel(context=self)
-        app_key, app_secret = self.get_app_key_secret()
-        invoke_result_data = goods_base_model.bind_special_goods(app_id, goods_id, goods_name, access_token, app_key, app_secret, is_log)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+# -*- coding: utf-8 -*-
+"""
+:Author: HuangJianYi
+:Date: 2021-08-03 10:11:39
+@LastEditTime: 2023-05-12 10:40:23
+@LastEditors: HuangJianYi
+:description: 商品模块
+"""
+from seven_cloudapp_frame.handlers.frame_base import *
+from seven_cloudapp_frame.models.top_base_model import *
+from seven_cloudapp_frame.models.goods_base_model import *
+
+
+class GoodsListHandler(ClientBaseHandler):
+    """
+    :description: 商品列表（获取当前会话用户出售中的商品列表）
+    """
+    def get_async(self):
+        """
+        :description: 导入商品列表（获取当前会话用户出售中的商品列表）
+        :param goods_name：商品名称
+        :param order_tag：order_tag
+        :param order_by：排序类型
+        :param page_index：页索引
+        :param page_size：页大小
+        :return: 列表
+        :last_editors: HuangJianYi
+        """
+        access_token = self.get_access_token()
+        goods_name = self.get_param("goods_name")
+        order_tag = self.get_param("order_tag", "list_time")
+        order_by = self.get_param("order_by", "desc")
+        page_index = self.get_param_int("page_index", 0)
+        page_size = self.get_param_int("page_size", 20)
+        is_log = self.get_param_int("is_log", 0)
+        is_log = True if is_log == 1 else False
+
+        top_base_model = TopBaseModel(context=self)
+        app_key, app_secret = self.get_app_key_secret()
+        invoke_result_data = top_base_model.get_goods_list(page_index, page_size, goods_name, order_tag, order_by, access_token, app_key, app_secret, is_log=is_log)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success(invoke_result_data.data)
+
+
+class GoodsListByGoodsIDHandler(ClientBaseHandler):
+    """
+    :description: 根据商品ID串获取商品列表
+    """
+    @filter_check_params("goods_ids")
+    def get_async(self):
+        """
+        :description: 根据商品ID获取商品列表
+        :param goods_ids：商品ID串，多个逗号,分隔
+        :return: list
+        :last_editors: HuangJianYi
+        """
+        access_token = self.get_access_token()
+        goods_ids = self.get_param("goods_ids")
+        is_log = self.get_param_int("is_log", 0)
+        is_log = True if is_log == 1 else False
+
+        top_base_model = TopBaseModel(context=self)
+        app_key, app_secret = self.get_app_key_secret()
+        invoke_result_data = top_base_model.get_goods_list_by_goodsids(goods_ids, access_token, app_key,app_secret, is_log=is_log)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success(invoke_result_data.data)
+
+
+class GoodsInfoHandler(ClientBaseHandler):
+    """
+    :description: 获取商品信息
+    """
+    @filter_check_params("goods_id")
+    def get_async(self):
+        """
+        :description: 获取商品信息
+        :param goods_id：商品ID
+        :return: 商品信息
+        :last_editors: HuangJianYi
+        """
+        access_token = self.get_access_token()
+        goods_id = self.get_param("goods_id")
+        is_log = self.get_param_int("is_log", 0)
+        is_log = True if is_log == 1 else False
+
+        top_base_model = TopBaseModel(context=self)
+        app_key, app_secret = self.get_app_key_secret()
+        invoke_result_data = top_base_model.get_goods_info(goods_id, access_token, app_key, app_secret, is_log=is_log)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success(invoke_result_data.data)
+
+
+class BenefitDetailHandler(ClientBaseHandler):
+    """
+    :description: 获取优惠券详情信息
+    """
+    def get_async(self):
+        """
+        :description: 获取优惠券详情信息
+        :param right_ename:奖池ID
+        :return: dict
+        :last_editors: HuangJianYi
+        """
+        access_token = self.get_access_token()
+        right_ename = self.get_param("right_ename")
+        is_log = self.get_param_int("is_log", 0)
+        is_log = True if is_log == 1 else False
+
+        top_base_model = TopBaseModel(context=self)
+        app_key, app_secret = self.get_app_key_secret()
+        invoke_result_data = top_base_model.alibaba_benefit_query(right_ename, access_token,app_key, app_secret, is_log=is_log)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success(invoke_result_data.data)
+
+
+class InventoryGoodsListHandler(ClientBaseHandler):
+    """
+    :description: 导入商品列表（获取当前用户作为卖家的仓库中的商品列表）
+    """
+    def get_async(self):
+        """
+        :description: 导入商品列表（获取当前用户作为卖家的仓库中的商品列表）
+        :param goods_name：商品名称
+        :param order_tag：order_tag
+        :param order_by：排序类型
+        :param page_index：页索引
+        :param page_size：页大小
+        :return: 列表
+        :last_editors: HuangJianYi
+        """
+        access_token = self.get_access_token()
+        goods_name = self.get_param("goods_name")
+        order_tag = self.get_param("order_tag", "list_time")
+        order_by = self.get_param("order_by", "desc")
+        page_index = self.get_param_int("page_index", 0)
+        page_size = self.get_param_int("page_size", 20)
+        top_base_model = TopBaseModel(context=self)
+        app_key, app_secret = self.get_app_key_secret()
+        invoke_result_data = top_base_model.get_goods_inventory_list(page_index, page_size, goods_name, order_tag, order_by, access_token, app_key, app_secret)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success(invoke_result_data.data)
+
+
+class SpecialGoodsListHandler(ClientBaseHandler):
+    """
+    :description: 专属下单商品列表
+    """
+    @filter_check_params("app_id")
+    def get_async(self):
+        """
+        :description: 专属下单商品列表
+        :param app_id：应用标识
+        :param page_index：页索引
+        :param page_size：页大小
+        :param goods_name：商品名称
+        :param goods_id：商品ID
+        :return:
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        page_index = self.get_param_int("page_index", 0)
+        page_size = self.get_param_int("page_size", 20)
+        goods_name = self.get_param("goods_name")
+        goods_id = self.get_param("goods_id")
+        access_token = self.get_access_token()
+        is_log = self.get_param_int("is_log", 0)
+        is_log = True if is_log == 1 else False
+
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        is_top_data = invoke_result_data.data["is_top_data"] if invoke_result_data.data.__contains__("is_top_data") else False #是否直接取淘宝top数据
+        goods_base_model = GoodsBaseModel(context=self)
+        app_key, app_secret = self.get_app_key_secret()
+        if is_top_data == False:
+            invoke_result_data = goods_base_model.get_special_goods_list(app_id, goods_name, access_token, app_key, app_secret, is_log, page_index, page_size)
+        else:
+            invoke_result_data = goods_base_model.get_special_goods_list_for_tb(app_id, goods_id, access_token, app_key, app_secret, is_log, page_index, page_size)
+
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        ref_params = {}
+        return self.response_json_success(self.business_process_executed(invoke_result_data.data, ref_params))
+
+
+class BindSpecialGoodsHandler(ClientBaseHandler):
+    """
+    :description: 专属下单商品绑定(单个商品)
+    """
+    @filter_check_params("goods_id")
+    def get_async(self):
+        """
+        :description: 专属下单商品绑定(单个商品)
+        :param goods_id：商品ID
+        :param goods_name: 商品名称
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        access_token = self.get_access_token()
+        goods_id = self.get_param("goods_id")
+        goods_name = self.get_param("goods_name")
+        is_log = self.get_param_int("is_log", 0)
+        is_log = True if is_log == 1 else False
+
+        goods_base_model = GoodsBaseModel(context=self)
+        app_key, app_secret = self.get_app_key_secret()
+        invoke_result_data = goods_base_model.bind_special_goods(app_id, goods_id, goods_name, access_token, app_key, app_secret, is_log)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
         return self.response_json_success()
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/handlers/server/ip_s.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/handlers/server/ip_s.py`

 * *Ordering differences only*

 * *Files 19% similar despite different names*

```diff
@@ -1,288 +1,288 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-08-02 11:03:56
-@LastEditTime: 2023-01-12 09:44:36
-@LastEditors: HuangJianYi
-@Description: ip模块
-"""
-
-from seven_cloudapp_frame.models.ip_base_model import *
-from seven_cloudapp_frame.handlers.frame_base import *
-from seven_cloudapp_frame.models.enum import *
-
-
-class SaveIpInfoHandler(ClientBaseHandler):
-    """
-    :description: 保存IP信息
-    """
-    @filter_check_params("ip_name")
-    def get_async(self):
-        """
-        :description: 保存IP信息
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param ip_id: ip标识
-        :param ip_name：ip名称
-        :param ip_pic：ip图片
-        :param show_pic：展示图片
-        :param sort_index：排序
-        :param is_release：是否发布
-        :param mode_type：模式类型
-        :param ip_config_json：ip配置
-        :return: response_json_success
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        ip_id = int(self.get_param("ip_id", 0))
-        act_id = self.get_act_id()
-        ip_name = self.get_param("ip_name")
-        ip_pic = self.get_param("ip_pic")
-        show_pic = self.get_param("show_pic")
-        sort_index = int(self.get_param("sort_index", 0))
-        is_release = int(self.get_param("is_release", 1))
-        ip_type = int(self.get_param("ip_type", 0))
-        mode_type = int(self.get_param("mode_type", 0))
-        ip_config_json = self.get_param("ip_config_json")
-        ip_summary = self.get_param("ip_summary")
-
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        title_prefix = invoke_result_data.data["title_prefix"] if invoke_result_data.data.__contains__("title_prefix") else "IP"
-        ip_base_model = IpBaseModel(context=self)
-        invoke_result_data = ip_base_model.save_ip_info(app_id, act_id, ip_id, ip_name, ip_pic, show_pic, sort_index, is_release, ip_type, ip_summary, mode_type, ip_config_json)
-        if invoke_result_data.success ==False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        if invoke_result_data.data["is_add"] == True:
-            # 记录日志
-            self.create_operation_log(operation_type=OperationType.add.value, model_name=invoke_result_data.data["new"].__str__(), old_detail=None, update_detail=invoke_result_data.data["new"], title= title_prefix + ip_name)
-        else:
-            self.create_operation_log(operation_type=OperationType.update.value, model_name=invoke_result_data.data["new"].__str__(), old_detail=invoke_result_data.data["old"], update_detail=invoke_result_data.data["new"], title= title_prefix + ";" + ip_name)
-        ref_params = {}
-        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success(invoke_result_data.data["new"].id)
-
-
-class IpInfoListHandler(ClientBaseHandler):
-    """
-    :description: 获取ip列表
-    """
-    def get_async(self):
-        """
-        :description: 获取ip列表
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param is_del: 是否回收站1是0否
-        :param is_release: 是否发布1是0否
-        :param page_index：页索引
-        :param page_size：页大小
-        :return: list
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        is_del = self.get_param_int("is_del", 0)
-        is_release = self.get_param_int("is_release", -1)
-        page_index = self.get_param_int("page_index", 0)
-        page_size = self.get_param_int("page_size", 20)
-
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_success({"data": []})
-        if not invoke_result_data.data:
-            invoke_result_data.data = {}
-        field = invoke_result_data.data["field"] if invoke_result_data.data.__contains__("field") else "*"
-        condition = invoke_result_data.data["condition"] if invoke_result_data.data.__contains__("condition") else ""
-        params = invoke_result_data.data["params"] if invoke_result_data.data.__contains__("params") else []
-        order_by = invoke_result_data.data["order_by"] if invoke_result_data.data.__contains__("order_by") else "sort_index desc"
-        page_list, total = IpBaseModel(context=self).get_ip_info_list(app_id, act_id, page_size, page_index, is_del, is_release, field, condition, params, order_by, is_cache=False)
-        ref_params = {}
-        page_info = PageInfo(page_index, page_size, total, self.business_process_executed(page_list, ref_params))
-        return self.response_json_success(page_info)
-
-
-class DeleteIpInfoHandler(ClientBaseHandler):
-    """
-    :description: 删除ip
-    """
-    @filter_check_params("ip_id")
-    def get_async(self):
-        """
-        :description: 删除ip
-        :param app_id：应用标识
-        :param ip_id: ip标识
-        :return: response_json_success
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        ip_id = int(self.get_param("ip_id", 0))
-
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        title_prefix = invoke_result_data.data["title_prefix"] if invoke_result_data.data.__contains__("title_prefix") else "IP"
-        ip_base_model = IpBaseModel(context=self)
-        invoke_result_data = ip_base_model.update_ip_info_status(app_id, ip_id, 1)
-        if invoke_result_data.success ==False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        self.create_operation_log(operation_type=OperationType.delete.value, model_name="ip_info_tb", title= title_prefix + ";" + invoke_result_data.data["ip_name"])
-        ref_params = {}
-        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success()
-
-
-class ReleaseIpInfoHandler(ClientBaseHandler):
-    """
-    :description: 上下架ip
-    """
-    @filter_check_params("ip_id")
-    def get_async(self):
-        """
-        :description: 上下架ip
-        :param app_id：应用标识
-        :param ip_id: ip标识
-        :param is_release: 是否发布 1-是 0-否
-        :return: response_json_success
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        ip_id = int(self.get_param("ip_id", 0))
-        is_release = int(self.get_param("is_release", 0))
-
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        title_prefix = invoke_result_data.data["title_prefix"] if invoke_result_data.data.__contains__("title_prefix") else "IP"
-        ip_base_model = IpBaseModel(context=self)
-        invoke_result_data = ip_base_model.release_ip_info(app_id, ip_id, is_release)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        operation_type = OperationType.release.value if is_release == 1 else OperationType.un_release.value
-        self.create_operation_log(operation_type=operation_type, model_name="ip_info_tb", title= title_prefix + ";" + invoke_result_data.data["ip_name"])
-        ref_params = {}
-        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success()
-
-
-class SaveIpTypeHandler(ClientBaseHandler):
-    """
-    :description: 保存IP类型
-    """
-    @filter_check_params("type_name")
-    def get_async(self):
-        """
-        :description: 保存IP类型
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param ip_type_id: ip类型标识
-        :param type_name：类型名称
-        :param type_pic：类型图片
-        :param sort_index：排序
-        :param is_release：是否发布
-        :return: response_json_success
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        ip_type_id = self.get_param_int("ip_type_id", 0)
-        type_name = self.get_param("type_name")
-        type_pic = self.get_param("type_pic")
-        sort_index = self.get_param_int("sort_index", 0)
-        is_release = self.get_param_int("is_release", 1)
-
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        title_prefix = invoke_result_data.data["title_prefix"] if invoke_result_data.data.__contains__("title_prefix") else "IP类型"
-        ip_base_model = IpBaseModel(context=self)
-        invoke_result_data = ip_base_model.save_ip_type(app_id, act_id, ip_type_id, type_name, sort_index, is_release, type_pic)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        if invoke_result_data.data["is_add"] == True:
-            # 记录日志
-            self.create_operation_log(operation_type=OperationType.add.value, model_name=invoke_result_data.data["new"].__str__(), old_detail=None, update_detail=invoke_result_data.data["new"], title= title_prefix + ";" + type_name)
-        else:
-            self.create_operation_log(operation_type=OperationType.update.value, model_name=invoke_result_data.data["new"].__str__(), old_detail=invoke_result_data.data["old"], update_detail=invoke_result_data.data["new"], title= title_prefix + ";" + type_name)
-        ref_params = {}
-        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success(invoke_result_data.data["new"].id)
-
-
-class IpTypeListHandler(ClientBaseHandler):
-    """
-    :description: 获取ip类型列表
-    """
-    def get_async(self):
-        """
-        :description: 获取ip列表
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param is_release: 是否发布1是0否
-        :param page_index：页索引
-        :param page_size：页大小
-        :return: list
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        is_release = self.get_param_int("is_release", -1)
-        page_index = self.get_param_int("page_index", 0)
-        page_size = self.get_param_int("page_size", 20)
-
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_success({"data": []})
-        if not invoke_result_data.data:
-            invoke_result_data.data = {}
-        field = invoke_result_data.data["field"] if invoke_result_data.data.__contains__("field") else "*"
-        condition = invoke_result_data.data["condition"] if invoke_result_data.data.__contains__("condition") else ""
-        params = invoke_result_data.data["params"] if invoke_result_data.data.__contains__("params") else []
-        order_by = invoke_result_data.data["order_by"] if invoke_result_data.data.__contains__("order_by") else "sort_index desc"
-        page_list, total = IpBaseModel(context=self).get_ip_type_list(app_id, act_id, page_size, page_index, is_release, field, condition, params, order_by, is_cache=False)
-        ref_params = {}
-        page_info = PageInfo(page_index, page_size, total, self.business_process_executed(page_list, ref_params))
-        return self.response_json_success(page_info)
-
-
-class ReleaseIpTypeHandler(ClientBaseHandler):
-    """
-    :description: 上下架ip类型
-    """
-    @filter_check_params("ip_type_id")
-    def get_async(self):
-        """
-        :description: 上下架ip类型
-        :param app_id：应用标识
-        :param ip_type_id: ip类型标识
-        :param is_release: 是否发布 1-是 0-否
-        :return: response_json_success
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        ip_type_id = self.get_param_int("ip_type_id", 0)
-        is_release = self.get_param_int("is_release", 0)
-
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        title_prefix = invoke_result_data.data["title_prefix"] if invoke_result_data.data.__contains__("title_prefix") else "IP类型"
-        ip_base_model = IpBaseModel(context=self)
-        invoke_result_data = ip_base_model.release_ip_type(app_id, ip_type_id, is_release)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        operation_type = OperationType.release.value if is_release == 1 else OperationType.un_release.value
-        self.create_operation_log(operation_type=operation_type, model_name="ip_type_tb", title= title_prefix + ";" + invoke_result_data.data["type_name"])
-        ref_params = {}
-        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success()
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-08-02 11:03:56
+@LastEditTime: 2023-01-12 09:44:36
+@LastEditors: HuangJianYi
+@Description: ip模块
+"""
+
+from seven_cloudapp_frame.models.ip_base_model import *
+from seven_cloudapp_frame.handlers.frame_base import *
+from seven_cloudapp_frame.models.enum import *
+
+
+class SaveIpInfoHandler(ClientBaseHandler):
+    """
+    :description: 保存IP信息
+    """
+    @filter_check_params("ip_name")
+    def get_async(self):
+        """
+        :description: 保存IP信息
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param ip_id: ip标识
+        :param ip_name：ip名称
+        :param ip_pic：ip图片
+        :param show_pic：展示图片
+        :param sort_index：排序
+        :param is_release：是否发布
+        :param mode_type：模式类型
+        :param ip_config_json：ip配置
+        :return: response_json_success
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        ip_id = int(self.get_param("ip_id", 0))
+        act_id = self.get_act_id()
+        ip_name = self.get_param("ip_name")
+        ip_pic = self.get_param("ip_pic")
+        show_pic = self.get_param("show_pic")
+        sort_index = int(self.get_param("sort_index", 0))
+        is_release = int(self.get_param("is_release", 1))
+        ip_type = int(self.get_param("ip_type", 0))
+        mode_type = int(self.get_param("mode_type", 0))
+        ip_config_json = self.get_param("ip_config_json")
+        ip_summary = self.get_param("ip_summary")
+
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        title_prefix = invoke_result_data.data["title_prefix"] if invoke_result_data.data.__contains__("title_prefix") else "IP"
+        ip_base_model = IpBaseModel(context=self)
+        invoke_result_data = ip_base_model.save_ip_info(app_id, act_id, ip_id, ip_name, ip_pic, show_pic, sort_index, is_release, ip_type, ip_summary, mode_type, ip_config_json)
+        if invoke_result_data.success ==False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if invoke_result_data.data["is_add"] == True:
+            # 记录日志
+            self.create_operation_log(operation_type=OperationType.add.value, model_name=invoke_result_data.data["new"].__str__(), old_detail=None, update_detail=invoke_result_data.data["new"], title= title_prefix + ip_name)
+        else:
+            self.create_operation_log(operation_type=OperationType.update.value, model_name=invoke_result_data.data["new"].__str__(), old_detail=invoke_result_data.data["old"], update_detail=invoke_result_data.data["new"], title= title_prefix + ";" + ip_name)
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success(invoke_result_data.data["new"].id)
+
+
+class IpInfoListHandler(ClientBaseHandler):
+    """
+    :description: 获取ip列表
+    """
+    def get_async(self):
+        """
+        :description: 获取ip列表
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param is_del: 是否回收站1是0否
+        :param is_release: 是否发布1是0否
+        :param page_index：页索引
+        :param page_size：页大小
+        :return: list
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        is_del = self.get_param_int("is_del", 0)
+        is_release = self.get_param_int("is_release", -1)
+        page_index = self.get_param_int("page_index", 0)
+        page_size = self.get_param_int("page_size", 20)
+
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_success({"data": []})
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        field = invoke_result_data.data["field"] if invoke_result_data.data.__contains__("field") else "*"
+        condition = invoke_result_data.data["condition"] if invoke_result_data.data.__contains__("condition") else ""
+        params = invoke_result_data.data["params"] if invoke_result_data.data.__contains__("params") else []
+        order_by = invoke_result_data.data["order_by"] if invoke_result_data.data.__contains__("order_by") else "sort_index desc"
+        page_list, total = IpBaseModel(context=self).get_ip_info_list(app_id, act_id, page_size, page_index, is_del, is_release, field, condition, params, order_by, is_cache=False)
+        ref_params = {}
+        page_info = PageInfo(page_index, page_size, total, self.business_process_executed(page_list, ref_params))
+        return self.response_json_success(page_info)
+
+
+class DeleteIpInfoHandler(ClientBaseHandler):
+    """
+    :description: 删除ip
+    """
+    @filter_check_params("ip_id")
+    def get_async(self):
+        """
+        :description: 删除ip
+        :param app_id：应用标识
+        :param ip_id: ip标识
+        :return: response_json_success
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        ip_id = int(self.get_param("ip_id", 0))
+
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        title_prefix = invoke_result_data.data["title_prefix"] if invoke_result_data.data.__contains__("title_prefix") else "IP"
+        ip_base_model = IpBaseModel(context=self)
+        invoke_result_data = ip_base_model.update_ip_info_status(app_id, ip_id, 1)
+        if invoke_result_data.success ==False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        self.create_operation_log(operation_type=OperationType.delete.value, model_name="ip_info_tb", title= title_prefix + ";" + invoke_result_data.data["ip_name"])
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success()
+
+
+class ReleaseIpInfoHandler(ClientBaseHandler):
+    """
+    :description: 上下架ip
+    """
+    @filter_check_params("ip_id")
+    def get_async(self):
+        """
+        :description: 上下架ip
+        :param app_id：应用标识
+        :param ip_id: ip标识
+        :param is_release: 是否发布 1-是 0-否
+        :return: response_json_success
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        ip_id = int(self.get_param("ip_id", 0))
+        is_release = int(self.get_param("is_release", 0))
+
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        title_prefix = invoke_result_data.data["title_prefix"] if invoke_result_data.data.__contains__("title_prefix") else "IP"
+        ip_base_model = IpBaseModel(context=self)
+        invoke_result_data = ip_base_model.release_ip_info(app_id, ip_id, is_release)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        operation_type = OperationType.release.value if is_release == 1 else OperationType.un_release.value
+        self.create_operation_log(operation_type=operation_type, model_name="ip_info_tb", title= title_prefix + ";" + invoke_result_data.data["ip_name"])
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success()
+
+
+class SaveIpTypeHandler(ClientBaseHandler):
+    """
+    :description: 保存IP类型
+    """
+    @filter_check_params("type_name")
+    def get_async(self):
+        """
+        :description: 保存IP类型
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param ip_type_id: ip类型标识
+        :param type_name：类型名称
+        :param type_pic：类型图片
+        :param sort_index：排序
+        :param is_release：是否发布
+        :return: response_json_success
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        ip_type_id = self.get_param_int("ip_type_id", 0)
+        type_name = self.get_param("type_name")
+        type_pic = self.get_param("type_pic")
+        sort_index = self.get_param_int("sort_index", 0)
+        is_release = self.get_param_int("is_release", 1)
+
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        title_prefix = invoke_result_data.data["title_prefix"] if invoke_result_data.data.__contains__("title_prefix") else "IP类型"
+        ip_base_model = IpBaseModel(context=self)
+        invoke_result_data = ip_base_model.save_ip_type(app_id, act_id, ip_type_id, type_name, sort_index, is_release, type_pic)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if invoke_result_data.data["is_add"] == True:
+            # 记录日志
+            self.create_operation_log(operation_type=OperationType.add.value, model_name=invoke_result_data.data["new"].__str__(), old_detail=None, update_detail=invoke_result_data.data["new"], title= title_prefix + ";" + type_name)
+        else:
+            self.create_operation_log(operation_type=OperationType.update.value, model_name=invoke_result_data.data["new"].__str__(), old_detail=invoke_result_data.data["old"], update_detail=invoke_result_data.data["new"], title= title_prefix + ";" + type_name)
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success(invoke_result_data.data["new"].id)
+
+
+class IpTypeListHandler(ClientBaseHandler):
+    """
+    :description: 获取ip类型列表
+    """
+    def get_async(self):
+        """
+        :description: 获取ip列表
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param is_release: 是否发布1是0否
+        :param page_index：页索引
+        :param page_size：页大小
+        :return: list
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        is_release = self.get_param_int("is_release", -1)
+        page_index = self.get_param_int("page_index", 0)
+        page_size = self.get_param_int("page_size", 20)
+
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_success({"data": []})
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        field = invoke_result_data.data["field"] if invoke_result_data.data.__contains__("field") else "*"
+        condition = invoke_result_data.data["condition"] if invoke_result_data.data.__contains__("condition") else ""
+        params = invoke_result_data.data["params"] if invoke_result_data.data.__contains__("params") else []
+        order_by = invoke_result_data.data["order_by"] if invoke_result_data.data.__contains__("order_by") else "sort_index desc"
+        page_list, total = IpBaseModel(context=self).get_ip_type_list(app_id, act_id, page_size, page_index, is_release, field, condition, params, order_by, is_cache=False)
+        ref_params = {}
+        page_info = PageInfo(page_index, page_size, total, self.business_process_executed(page_list, ref_params))
+        return self.response_json_success(page_info)
+
+
+class ReleaseIpTypeHandler(ClientBaseHandler):
+    """
+    :description: 上下架ip类型
+    """
+    @filter_check_params("ip_type_id")
+    def get_async(self):
+        """
+        :description: 上下架ip类型
+        :param app_id：应用标识
+        :param ip_type_id: ip类型标识
+        :param is_release: 是否发布 1-是 0-否
+        :return: response_json_success
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        ip_type_id = self.get_param_int("ip_type_id", 0)
+        is_release = self.get_param_int("is_release", 0)
+
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        title_prefix = invoke_result_data.data["title_prefix"] if invoke_result_data.data.__contains__("title_prefix") else "IP类型"
+        ip_base_model = IpBaseModel(context=self)
+        invoke_result_data = ip_base_model.release_ip_type(app_id, ip_type_id, is_release)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        operation_type = OperationType.release.value if is_release == 1 else OperationType.un_release.value
+        self.create_operation_log(operation_type=operation_type, model_name="ip_type_tb", title= title_prefix + ";" + invoke_result_data.data["type_name"])
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success()
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/handlers/server/launch_s.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/handlers/server/launch_s.py`

 * *Ordering differences only*

 * *Files 13% similar despite different names*

```diff
@@ -1,313 +1,313 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-30 15:46:34
-@LastEditTime: 2022-07-14 10:08:14
-@LastEditors: HuangJianYi
-@Description: 投放模块
-"""
-from seven_cloudapp_frame.handlers.frame_base import *
-from seven_cloudapp_frame.models.act_base_model import *
-from seven_cloudapp_frame.models.top_base_model import *
-from seven_cloudapp_frame.models.launch_base_model import *
-from seven_cloudapp_frame.models.db_models.act.act_info_model import *
-from seven_cloudapp_frame.models.db_models.act.act_prize_model import *
-from seven_cloudapp_frame.models.db_models.launch.launch_goods_model import *
-from seven_cloudapp_frame.models.db_models.price.price_gear_model import *
-from seven_cloudapp_frame.models.db_models.launch.launch_plan_model import *
-
-
-class InitLaunchGoodsHandler(ClientBaseHandler):
-    """
-    :description: 初始化商品投放
-    """
-    def get_async(self):
-        """
-        :description: 初始化商品投放
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param module_id：活动模块标识
-        :param source_types：商品来源，指定哪些位置的商品要进行投放（1活动奖品商品2价格档位商品） 多个逗号,分隔
-        :return
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        module_id = int(self.get_param("module_id", 0))
-        source_types = self.get_param("source_types","1,2")
-
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        app_base_model = AppBaseModel(context=self)
-        launch_base_model = LaunchBaseModel(context=self)
-        online_url = app_base_model.get_online_url(act_id, app_id, module_id)
-        invoke_result_data = launch_base_model.init_launch_goods(app_id, act_id, source_types, online_url)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        ref_params = {}
-        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success(invoke_result_data.data)
-
-
-class ResetLaunchGoodsHandler(ClientBaseHandler):
-    """
-    :description: 重置商品投放 删除已投放的记录并将活动投放状态改为未投放
-    """
-    def get_async(self):
-        """
-        :description: 重置商品投放 删除已投放的记录并将活动投放状态改为未投放
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param close_goods_id：投放失败时关闭投放的商品ID  多个逗号,分隔
-        :return 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-
-        close_goods_id = self.get_param("close_goods_id")
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        launch_base_model = LaunchBaseModel(context=self)
-        invoke_result_data = launch_base_model.reset_launch_goods(app_id, act_id, close_goods_id)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        ref_params = {}
-        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success()
-
-
-class InitLaunchGoodsCallBackHandler(ClientBaseHandler):
-    """
-    :description: 初始化投放商品回调接口
-    """
-    def get_async(self):
-        """
-        :description: 初始化投放商品回调接口
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param close_goods_id：投放失败时关闭投放的商品ID  多个逗号,分隔
-        :param call_back_info：回调信息
-        :return 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        close_goods_id = self.get_param("close_goods_id")
-        call_back_info = self.get_param("call_back_info")
-
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        launch_base_model = LaunchBaseModel(context=self)
-        invoke_result_data = launch_base_model.init_launch_goods_callback(app_id, act_id, close_goods_id, call_back_info)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        ref_params = {}
-        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success()
-
-
-class UpdateLaunchGoodsStatusHandler(ClientBaseHandler):
-    """
-    :description: 更改投放商品的状态
-    """
-    def get_async(self):
-        """
-        :description: 保存更改投放商品的状态
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param update_goods_id：更新商品ID（例：1）
-        :return 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        goods_id = self.get_param("update_goods_id")
-
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        if goods_id != "":
-            LaunchGoodsModel(context=self).update_table("is_launch=abs(is_launch-1),is_sync=0,launch_date=%s", "app_id=%s and act_id=%s and goods_id=%s", [self.get_now_datetime(), app_id, act_id, goods_id])
-        ref_params = {}
-        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success()
-
-
-class LaunchGoodsListHandler(ClientBaseHandler):
-    """
-    :description: 投放商品列表
-    """
-    def get_async(self):
-        """
-        :description: 投放商品列表
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param page_index：页索引
-        :param page_size：页大小
-        :return 列表
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        page_index = int(self.get_param("page_index", 0))
-        page_size = int(self.get_param("page_size", 20))
-        goods_id = self.get_param("goods_id")
-        launch_status = self.get_param_int("launch_status", -1)
-        access_token = self.get_access_token()
-
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        launch_base_model = LaunchBaseModel(context=self)
-        app_key, app_secret = self.get_app_key_secret()
-        invoke_result_data = launch_base_model.get_launch_goods_list(app_id, act_id, page_size, page_index, access_token, app_key, app_secret,goods_id,launch_status)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        ref_params = {}
-        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success(invoke_result_data.data)
-
-
-class AsyncLaunchGoodsHandler(ClientBaseHandler):
-    """
-    :description: 同步投放商品（小程序投放-商品绑定/解绑）
-    """
-    def get_async(self):
-        """
-        :description: 同步投放商品（小程序投放-商品绑定/解绑）
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param module_id：活动模块标识
-        :return 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        module_id = int(self.get_param("module_id", 0))
-        access_token = self.get_access_token()
-
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        app_base_model = AppBaseModel(context=self)
-        online_url = app_base_model.get_online_url(act_id, app_id, module_id)
-        launch_base_model = LaunchBaseModel(context=self)
-
-        app_key, app_secret = self.get_app_key_secret()
-        launch_plan_model = LaunchPlanModel(context=self)
-        launch_plan = launch_plan_model.get_entity("act_id=%s", order_by="id desc", params=[act_id])
-        if launch_plan:
-            invoke_result_data = launch_base_model.async_launch_goods(app_id, act_id, launch_plan.launch_url, access_token, app_key, app_secret)
-        else:
-            invoke_result_data = launch_base_model.async_launch_goods(app_id, act_id, online_url, access_token, app_key, app_secret)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        ref_params = {}
-        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success()
-
-
-class GetLaunchPlanStatusHandler(ClientBaseHandler):
-    """
-    :description: 获取投放计划状态
-    :param act_id：活动标识
-    :return 
-    :last_editors: HuangJianYi
-    """
-    def get_async(self):
-        act_id = self.get_param_int("act_id")
-        access_token = self.get_access_token()
-        app_key, app_secret = self.get_app_key_secret()
-        launch_base_model = LaunchBaseModel(context=self)
-        launch_status = launch_base_model.get_launch_plan_status(act_id, access_token, app_key, app_secret)
-        return self.response_json_success(launch_status)
-
-
-class AsyncLaunchGoodsStatusHandler(ClientBaseHandler):
-    """
-    :description: 同步投放商品（小程序投放-商品绑定）
-    :return
-    :last_editors: HuangJianYi
-    """
-    def get_async(self):
-        act_id = self.get_act_id()
-        redis_init = SevenHelper.redis_init()
-        redis_init.rpush("queue_async_lauch", act_id)
-        return self.response_json_success()
-
-
-class AddLaunchGoodsHandler(ClientBaseHandler):
-    """
-    :description: 添加投放商品
-    :param goods_ids：商品id串 逗号分隔
-    :return
-    :last_editors: HuangJianYi
-    """
-    def get_async(self):
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        goods_ids = self.get_param("goods_ids")
-        launch_base_model = LaunchBaseModel(context=self)
-        launch_base_model.add_launch_goods_v2(app_id, act_id, goods_ids)
-        return self.response_json_success()
-
-
-class CanLaunchGoodsListHandler(ClientBaseHandler):
-    """
-    :description: 获取可投放商品列表（获取当前会话用户出售中的商品列表）
-    """
-    def get_async(self):
-        """
-        :description: 导入商品列表（获取当前会话用户出售中的商品列表）
-        :param goods_name：商品名称
-        :param order_tag：order_tag
-        :param order_by：排序类型
-        :param page_index：页索引
-        :param page_size：页大小
-        :return: 列表
-        :last_editors: HuangJianYi
-        """
-        access_token = self.get_access_token()
-        goods_name = self.get_param("goods_name")
-        order_tag = self.get_param("order_tag", "list_time")
-        order_by = self.get_param("order_by", "desc")
-        page_index = int(self.get_param("page_index", 0))
-        page_size = self.get_param("page_size", 20)
-        is_log = int(self.get_param("is_log", 0))
-        is_log = True if is_log == 1 else False
-
-        access_token = self.get_access_token()
-        app_key, app_secret = self.get_app_key_secret()
-        launch_base_model = LaunchBaseModel(context=self)
-        invoke_result_data = launch_base_model.can_launch_goods_list(page_index,page_size,goods_name,order_tag,order_by,access_token,app_key,app_secret,is_log)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success(invoke_result_data.data)
-
-
-class GetLaunchProgressHandler(ClientBaseHandler):
-    """
-    :description: 获取投放进度
-    :return 投放进度 0未完成  1：已完成
-    :last_editors: HuangJianYi
-    """
-    def get_async(self):
-        act_id = self.get_act_id()
-        launch_base_model = LaunchBaseModel(context=self)
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-30 15:46:34
+@LastEditTime: 2022-07-14 10:08:14
+@LastEditors: HuangJianYi
+@Description: 投放模块
+"""
+from seven_cloudapp_frame.handlers.frame_base import *
+from seven_cloudapp_frame.models.act_base_model import *
+from seven_cloudapp_frame.models.top_base_model import *
+from seven_cloudapp_frame.models.launch_base_model import *
+from seven_cloudapp_frame.models.db_models.act.act_info_model import *
+from seven_cloudapp_frame.models.db_models.act.act_prize_model import *
+from seven_cloudapp_frame.models.db_models.launch.launch_goods_model import *
+from seven_cloudapp_frame.models.db_models.price.price_gear_model import *
+from seven_cloudapp_frame.models.db_models.launch.launch_plan_model import *
+
+
+class InitLaunchGoodsHandler(ClientBaseHandler):
+    """
+    :description: 初始化商品投放
+    """
+    def get_async(self):
+        """
+        :description: 初始化商品投放
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param module_id：活动模块标识
+        :param source_types：商品来源，指定哪些位置的商品要进行投放（1活动奖品商品2价格档位商品） 多个逗号,分隔
+        :return
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        module_id = int(self.get_param("module_id", 0))
+        source_types = self.get_param("source_types","1,2")
+
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        app_base_model = AppBaseModel(context=self)
+        launch_base_model = LaunchBaseModel(context=self)
+        online_url = app_base_model.get_online_url(act_id, app_id, module_id)
+        invoke_result_data = launch_base_model.init_launch_goods(app_id, act_id, source_types, online_url)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success(invoke_result_data.data)
+
+
+class ResetLaunchGoodsHandler(ClientBaseHandler):
+    """
+    :description: 重置商品投放 删除已投放的记录并将活动投放状态改为未投放
+    """
+    def get_async(self):
+        """
+        :description: 重置商品投放 删除已投放的记录并将活动投放状态改为未投放
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param close_goods_id：投放失败时关闭投放的商品ID  多个逗号,分隔
+        :return 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+
+        close_goods_id = self.get_param("close_goods_id")
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        launch_base_model = LaunchBaseModel(context=self)
+        invoke_result_data = launch_base_model.reset_launch_goods(app_id, act_id, close_goods_id)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success()
+
+
+class InitLaunchGoodsCallBackHandler(ClientBaseHandler):
+    """
+    :description: 初始化投放商品回调接口
+    """
+    def get_async(self):
+        """
+        :description: 初始化投放商品回调接口
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param close_goods_id：投放失败时关闭投放的商品ID  多个逗号,分隔
+        :param call_back_info：回调信息
+        :return 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        close_goods_id = self.get_param("close_goods_id")
+        call_back_info = self.get_param("call_back_info")
+
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        launch_base_model = LaunchBaseModel(context=self)
+        invoke_result_data = launch_base_model.init_launch_goods_callback(app_id, act_id, close_goods_id, call_back_info)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success()
+
+
+class UpdateLaunchGoodsStatusHandler(ClientBaseHandler):
+    """
+    :description: 更改投放商品的状态
+    """
+    def get_async(self):
+        """
+        :description: 保存更改投放商品的状态
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param update_goods_id：更新商品ID（例：1）
+        :return 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        goods_id = self.get_param("update_goods_id")
+
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if goods_id != "":
+            LaunchGoodsModel(context=self).update_table("is_launch=abs(is_launch-1),is_sync=0,launch_date=%s", "app_id=%s and act_id=%s and goods_id=%s", [self.get_now_datetime(), app_id, act_id, goods_id])
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success()
+
+
+class LaunchGoodsListHandler(ClientBaseHandler):
+    """
+    :description: 投放商品列表
+    """
+    def get_async(self):
+        """
+        :description: 投放商品列表
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param page_index：页索引
+        :param page_size：页大小
+        :return 列表
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        page_index = int(self.get_param("page_index", 0))
+        page_size = int(self.get_param("page_size", 20))
+        goods_id = self.get_param("goods_id")
+        launch_status = self.get_param_int("launch_status", -1)
+        access_token = self.get_access_token()
+
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        launch_base_model = LaunchBaseModel(context=self)
+        app_key, app_secret = self.get_app_key_secret()
+        invoke_result_data = launch_base_model.get_launch_goods_list(app_id, act_id, page_size, page_index, access_token, app_key, app_secret,goods_id,launch_status)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success(invoke_result_data.data)
+
+
+class AsyncLaunchGoodsHandler(ClientBaseHandler):
+    """
+    :description: 同步投放商品（小程序投放-商品绑定/解绑）
+    """
+    def get_async(self):
+        """
+        :description: 同步投放商品（小程序投放-商品绑定/解绑）
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param module_id：活动模块标识
+        :return 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        module_id = int(self.get_param("module_id", 0))
+        access_token = self.get_access_token()
+
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        app_base_model = AppBaseModel(context=self)
+        online_url = app_base_model.get_online_url(act_id, app_id, module_id)
+        launch_base_model = LaunchBaseModel(context=self)
+
+        app_key, app_secret = self.get_app_key_secret()
+        launch_plan_model = LaunchPlanModel(context=self)
+        launch_plan = launch_plan_model.get_entity("act_id=%s", order_by="id desc", params=[act_id])
+        if launch_plan:
+            invoke_result_data = launch_base_model.async_launch_goods(app_id, act_id, launch_plan.launch_url, access_token, app_key, app_secret)
+        else:
+            invoke_result_data = launch_base_model.async_launch_goods(app_id, act_id, online_url, access_token, app_key, app_secret)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success()
+
+
+class GetLaunchPlanStatusHandler(ClientBaseHandler):
+    """
+    :description: 获取投放计划状态
+    :param act_id：活动标识
+    :return 
+    :last_editors: HuangJianYi
+    """
+    def get_async(self):
+        act_id = self.get_param_int("act_id")
+        access_token = self.get_access_token()
+        app_key, app_secret = self.get_app_key_secret()
+        launch_base_model = LaunchBaseModel(context=self)
+        launch_status = launch_base_model.get_launch_plan_status(act_id, access_token, app_key, app_secret)
+        return self.response_json_success(launch_status)
+
+
+class AsyncLaunchGoodsStatusHandler(ClientBaseHandler):
+    """
+    :description: 同步投放商品（小程序投放-商品绑定）
+    :return
+    :last_editors: HuangJianYi
+    """
+    def get_async(self):
+        act_id = self.get_act_id()
+        redis_init = SevenHelper.redis_init()
+        redis_init.rpush("queue_async_lauch", act_id)
+        return self.response_json_success()
+
+
+class AddLaunchGoodsHandler(ClientBaseHandler):
+    """
+    :description: 添加投放商品
+    :param goods_ids：商品id串 逗号分隔
+    :return
+    :last_editors: HuangJianYi
+    """
+    def get_async(self):
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        goods_ids = self.get_param("goods_ids")
+        launch_base_model = LaunchBaseModel(context=self)
+        launch_base_model.add_launch_goods_v2(app_id, act_id, goods_ids)
+        return self.response_json_success()
+
+
+class CanLaunchGoodsListHandler(ClientBaseHandler):
+    """
+    :description: 获取可投放商品列表（获取当前会话用户出售中的商品列表）
+    """
+    def get_async(self):
+        """
+        :description: 导入商品列表（获取当前会话用户出售中的商品列表）
+        :param goods_name：商品名称
+        :param order_tag：order_tag
+        :param order_by：排序类型
+        :param page_index：页索引
+        :param page_size：页大小
+        :return: 列表
+        :last_editors: HuangJianYi
+        """
+        access_token = self.get_access_token()
+        goods_name = self.get_param("goods_name")
+        order_tag = self.get_param("order_tag", "list_time")
+        order_by = self.get_param("order_by", "desc")
+        page_index = int(self.get_param("page_index", 0))
+        page_size = self.get_param("page_size", 20)
+        is_log = int(self.get_param("is_log", 0))
+        is_log = True if is_log == 1 else False
+
+        access_token = self.get_access_token()
+        app_key, app_secret = self.get_app_key_secret()
+        launch_base_model = LaunchBaseModel(context=self)
+        invoke_result_data = launch_base_model.can_launch_goods_list(page_index,page_size,goods_name,order_tag,order_by,access_token,app_key,app_secret,is_log)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success(invoke_result_data.data)
+
+
+class GetLaunchProgressHandler(ClientBaseHandler):
+    """
+    :description: 获取投放进度
+    :return 投放进度 0未完成  1：已完成
+    :last_editors: HuangJianYi
+    """
+    def get_async(self):
+        act_id = self.get_act_id()
+        launch_base_model = LaunchBaseModel(context=self)
         return self.response_json_success(launch_base_model.get_launch_progress(act_id))
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/handlers/server/module_s.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/handlers/server/module_s.py`

 * *Ordering differences only*

 * *Files 12% similar despite different names*

```diff
@@ -1,326 +1,326 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-08-03 15:42:53
-@LastEditTime: 2023-03-13 11:48:10
-@LastEditors: HuangJianYi
-@Description: 小活动模块（机台）
-"""
-from seven_cloudapp_frame.models.enum import *
-from seven_cloudapp_frame.handlers.frame_base import *
-from seven_cloudapp_frame.models.module_base_model import *
-from seven_cloudapp_frame.models.seven_model import PageInfo
-
-
-class SaveActModuleHandler(ClientBaseHandler):
-    """
-    :description: 保存活动模块信息
-    """
-    def post_async(self):
-        """
-        :description: 添加活动信息
-        :param app_id: 应用标识
-        :param act_id: 活动标识
-        :param business_type: 业务类型(0无1机台2活动)
-        :param module_id: 活动模块标识
-        :param module_name: 模块名称
-        :param module_sub_name: 模块短名称
-        :param module_type: 模块类型
-        :param start_date: 开始时间
-        :param end_date: 结束时间
-        :param module_pic: 模块图片
-        :param module_desc: 描述信息
-        :param price: 价格
-        :param price_gear_id: 档位标识
-        :param ip_id: IP标识
-        :param join_ways: 活动参与条件（0所有1关注店铺2加入会员3指定用户）
-        :param is_fictitious: 是否开启虚拟中奖（1是0否）
-        :param sort_index: 排序
-        :param is_release: 是否发布（1是0否）
-        :param i1: i1
-        :param i2: i2
-        :param i3: i3
-        :param i4: i4
-        :param i5: i5
-        :param s1: s1
-        :param s2: s2
-        :param s3: s3
-        :param s4: s4
-        :param s5: s5
-        :param d1: d1
-        :param d2: d2
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        business_type = int(self.get_param("business_type",0))
-        module_id = int(self.get_param("module_id",0))
-        module_name = self.get_param("module_name")
-        module_sub_name = self.get_param("module_sub_name")
-        module_type = self.get_param_int("module_type",0)
-        start_date = self.get_param("start_date", "1900-01-01 00:00:00")
-        end_date = self.get_param("end_date", "1900-01-01 00:00:00")
-        module_pic = self.get_param("module_pic")
-        module_desc = self.get_param("module_desc")
-        price = self.get_param("price")
-        price_gear_id = int(self.get_param("price_gear_id",0))
-        ip_id = int(self.get_param("ip_id", 0))
-        join_ways = int(self.get_param("join_ways",0))
-        is_fictitious = int(self.get_param("is_fictitious",0))
-        sort_index = int(self.get_param("sort_index",0))
-        is_release = int(self.get_param("is_release",0))
-        i1 = int(self.get_param("i1",0))
-        i2 = int(self.get_param("i2",0))
-        i3 = int(self.get_param("i3",0))
-        i4 = int(self.get_param("i4",0))
-        i5 = int(self.get_param("i5",0))
-        s1 = self.get_param("s1")
-        s2 = self.get_param("s2")
-        s3 = self.get_param("s3")
-        s4 = self.get_param("s4")
-        s5 = self.get_param("s5")
-        d1 = self.get_param("d1", "1900-01-01 00:00:00")
-        d2 = self.get_param("d2", "1900-01-01 00:00:00")
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        default_prefix = ""
-        if business_type == 1:
-            default_prefix = "机台"
-        elif business_type == 2:
-            default_prefix = "活动"
-        title_prefix = invoke_result_data.data["title_prefix"] if invoke_result_data.data.__contains__("title_prefix") else default_prefix
-        module_base_model = ModuleBaseModel(context=self)
-        invoke_result_data = module_base_model.save_act_module(app_id, act_id, module_id, module_name, module_sub_name, start_date, end_date, module_pic, module_desc, price, price_gear_id, ip_id, join_ways, is_fictitious, sort_index, is_release, i1, i2, i3, i4, i5, s1, s2, s3, s4, s5, d1, d2, business_type, module_type)
-        if invoke_result_data.success ==False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        if invoke_result_data.data["is_add"] == True:
-            # 记录日志
-            self.create_operation_log(operation_type=OperationType.add.value, model_name=invoke_result_data.data["new"].__str__(), old_detail=None, update_detail=invoke_result_data.data["new"], title= title_prefix + ";" + module_name)
-        else:
-            self.create_operation_log(operation_type=OperationType.update.value, model_name=invoke_result_data.data["new"].__str__(), old_detail=invoke_result_data.data["old"], update_detail=invoke_result_data.data["new"], title= title_prefix + ";" + module_name)
-        ref_params = {}
-        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        self.response_json_success(invoke_result_data.data["new"].id)
-
-
-class ActModuleHandler(ClientBaseHandler):
-    """
-    :description: 单条活动模块信息
-    """
-    def get_async(self):
-        """
-        :description: 活动模块列表
-        :param app_id：应用标识
-        :param module_id：活动模块标识
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        module_id = int(self.get_param("module_id", 0))
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        module_base_model = ModuleBaseModel(context=self)
-        act_module_dict = module_base_model.get_act_module_dict(module_id, False)
-        if act_module_dict:
-            if act_module_dict["app_id"] != app_id:
-                act_module_dict = {}
-                return self.response_json_success(act_module_dict)
-        ref_params = {}
-        return self.response_json_success(self.business_process_executed(act_module_dict, ref_params))
-
-
-class ActModuleListHandler(ClientBaseHandler):
-    """
-    :description: 活动模块列表
-    """
-    def get_async(self):
-        """
-        :description: 活动模块列表
-        :param app_id：应用标识
-        :param business_type：业务类型(0无1机台2活动)
-        :param act_name：模块名称
-        :param start_date：开始时间
-        :param end_date：结束时间
-        :param page_index：页索引
-        :param page_size：页大小
-        :return: PageInfo
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        page_index = self.get_param_int("page_index", 0)
-        page_size = self.get_param_int("page_size", 10)
-        is_del = self.get_param_int("is_del", 0)
-        business_type = self.get_param_int("business_type", -1)
-        module_name = self.get_param("module_name")
-        start_date = self.get_param("start_date")
-        end_date = self.get_param("end_date")
-
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_success({"data": []})
-        if not invoke_result_data.data:
-            invoke_result_data.data = {}
-        condition = invoke_result_data.data["condition"] if invoke_result_data.data.__contains__("condition") else ""
-        params = invoke_result_data.data["params"] if invoke_result_data.data.__contains__("params") else []
-        order_by = invoke_result_data.data["order_by"] if invoke_result_data.data.__contains__("order_by") else "sort_index desc,id asc"
-        condition_where = ConditionWhere()
-        if condition:
-            condition_where.add_condition(condition)
-        if business_type != -1:
-            condition_where.add_condition("business_type=%s")
-            params.append(business_type)
-
-        if not app_id or not act_id:
-            return self.response_json_success({"data": []})
-        module_base_model = ModuleBaseModel(context=self)
-        page_list, total = module_base_model.get_act_module_list(app_id, act_id, module_name, start_date, end_date, is_del, page_size, page_index, order_by=order_by, condition=condition_where.to_string(), params=params, is_cache=False)
-        ref_params = {}
-        page_info = PageInfo(page_index, page_size, total, self.business_process_executed(page_list, ref_params))
-        return self.response_json_success(page_info)
-
-
-class DeleteActModuleHandler(ClientBaseHandler):
-    """
-    :description: 删除活动模块
-    """
-    @filter_check_params("module_id")
-    def get_async(self):
-        """
-        :description: 删除活动模块
-        :param app_id：应用标识
-        :param module_id：模块标识
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        module_id = int(self.get_param("module_id", 0))
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        module_base_model = ModuleBaseModel(context=self)
-        invoke_result_data = module_base_model.update_act_module_status(app_id, module_id, 1)
-        if invoke_result_data.success ==False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        default_prefix = ""
-        if invoke_result_data.data["business_type"] == 1:
-            default_prefix = "机台"
-        elif invoke_result_data.data["business_type"] == 2:
-            default_prefix = "活动"
-        title_prefix = invoke_result_data.data["title_prefix"] if invoke_result_data.data.__contains__("title_prefix") else default_prefix
-        self.create_operation_log(operation_type=OperationType.delete.value, model_name="act_module_tb", title= title_prefix + ";" + invoke_result_data.data["module_name"])
-        ref_params = {}
-        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
-        if invoke_result_data.success ==False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success()
-
-
-class ReviewActModuleHandler(ClientBaseHandler):
-    """
-    :description: 还原活动模块
-    """
-    @filter_check_params("module_id")
-    def get_async(self):
-        """
-        :description: 还原活动模块
-        :param app_id：应用标识
-        :param module_id：模块标识
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        module_id = int(self.get_param("module_id", 0))
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        module_base_model = ModuleBaseModel(context=self)
-        invoke_result_data = module_base_model.update_act_module_status(app_id, module_id, 0)
-        if invoke_result_data.success ==False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        default_prefix = ""
-        if invoke_result_data.data["business_type"] == 1:
-            default_prefix = "机台"
-        elif invoke_result_data.data["business_type"] == 2:
-            default_prefix = "活动"
-        title_prefix = invoke_result_data.data["title_prefix"] if invoke_result_data.data.__contains__("title_prefix") else default_prefix
-        self.create_operation_log(operation_type=OperationType.review.value, model_name="act_module_tb", title= title_prefix + ";" + invoke_result_data.data["module_name"])
-        ref_params = {}
-        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
-        if invoke_result_data.success ==False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success()
-
-
-class ReleaseActModuleHandler(ClientBaseHandler):
-    """
-    :description: 上下架活动模块
-    """
-    @filter_check_params("module_id")
-    def get_async(self):
-        """
-        :description: 上下架活动模块
-        :param app_id：应用标识
-        :param module_id：模块标识
-        :param is_release: 是否发布 1-是 0-否
-        :return:
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        module_id = int(self.get_param("module_id", 0))
-        is_release = int(self.get_param("is_release", 0))
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        module_base_model = ModuleBaseModel(context=self)
-        invoke_result_data = module_base_model.release_act_module(app_id, module_id, is_release)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        operation_type = OperationType.release.value if is_release == 1 else OperationType.un_release.value
-        default_prefix = ""
-        if invoke_result_data.data["business_type"] == 1:
-            default_prefix = "机台"
-        elif invoke_result_data.data["business_type"] == 2:
-            default_prefix = "活动"
-        title_prefix = invoke_result_data.data["title_prefix"] if invoke_result_data.data.__contains__("title_prefix") else default_prefix
-        self.create_operation_log(operation_type=operation_type, model_name="act_module_tb", title= title_prefix + ";" + invoke_result_data.data["module_name"])
-        ref_params = {}
-        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
-        if invoke_result_data.success ==False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success()
-
-
-class UpdateActModulePriceHandler(ClientBaseHandler):
-    """
-    :description: 更新活动模块价格
-    """
-    @filter_check_params("prize_gear_id")
-    def get_async(self):
-        """
-        :description:更新活动模块价格
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param prize_gear_id：档位标识
-        :return:
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        prize_gear_id = int(self.get_param("prize_gear_id", 0))
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        module_base_model = ModuleBaseModel(context=self)
-        invoke_result_data = module_base_model.update_act_module_price(app_id, act_id, prize_gear_id)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        ref_params = {}
-        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
-        if invoke_result_data.success ==False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-08-03 15:42:53
+@LastEditTime: 2023-03-13 11:48:10
+@LastEditors: HuangJianYi
+@Description: 小活动模块（机台）
+"""
+from seven_cloudapp_frame.models.enum import *
+from seven_cloudapp_frame.handlers.frame_base import *
+from seven_cloudapp_frame.models.module_base_model import *
+from seven_cloudapp_frame.models.seven_model import PageInfo
+
+
+class SaveActModuleHandler(ClientBaseHandler):
+    """
+    :description: 保存活动模块信息
+    """
+    def post_async(self):
+        """
+        :description: 添加活动信息
+        :param app_id: 应用标识
+        :param act_id: 活动标识
+        :param business_type: 业务类型(0无1机台2活动)
+        :param module_id: 活动模块标识
+        :param module_name: 模块名称
+        :param module_sub_name: 模块短名称
+        :param module_type: 模块类型
+        :param start_date: 开始时间
+        :param end_date: 结束时间
+        :param module_pic: 模块图片
+        :param module_desc: 描述信息
+        :param price: 价格
+        :param price_gear_id: 档位标识
+        :param ip_id: IP标识
+        :param join_ways: 活动参与条件（0所有1关注店铺2加入会员3指定用户）
+        :param is_fictitious: 是否开启虚拟中奖（1是0否）
+        :param sort_index: 排序
+        :param is_release: 是否发布（1是0否）
+        :param i1: i1
+        :param i2: i2
+        :param i3: i3
+        :param i4: i4
+        :param i5: i5
+        :param s1: s1
+        :param s2: s2
+        :param s3: s3
+        :param s4: s4
+        :param s5: s5
+        :param d1: d1
+        :param d2: d2
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        business_type = int(self.get_param("business_type",0))
+        module_id = int(self.get_param("module_id",0))
+        module_name = self.get_param("module_name")
+        module_sub_name = self.get_param("module_sub_name")
+        module_type = self.get_param_int("module_type",0)
+        start_date = self.get_param("start_date", "1900-01-01 00:00:00")
+        end_date = self.get_param("end_date", "1900-01-01 00:00:00")
+        module_pic = self.get_param("module_pic")
+        module_desc = self.get_param("module_desc")
+        price = self.get_param("price")
+        price_gear_id = int(self.get_param("price_gear_id",0))
+        ip_id = int(self.get_param("ip_id", 0))
+        join_ways = int(self.get_param("join_ways",0))
+        is_fictitious = int(self.get_param("is_fictitious",0))
+        sort_index = int(self.get_param("sort_index",0))
+        is_release = int(self.get_param("is_release",0))
+        i1 = int(self.get_param("i1",0))
+        i2 = int(self.get_param("i2",0))
+        i3 = int(self.get_param("i3",0))
+        i4 = int(self.get_param("i4",0))
+        i5 = int(self.get_param("i5",0))
+        s1 = self.get_param("s1")
+        s2 = self.get_param("s2")
+        s3 = self.get_param("s3")
+        s4 = self.get_param("s4")
+        s5 = self.get_param("s5")
+        d1 = self.get_param("d1", "1900-01-01 00:00:00")
+        d2 = self.get_param("d2", "1900-01-01 00:00:00")
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        default_prefix = ""
+        if business_type == 1:
+            default_prefix = "机台"
+        elif business_type == 2:
+            default_prefix = "活动"
+        title_prefix = invoke_result_data.data["title_prefix"] if invoke_result_data.data.__contains__("title_prefix") else default_prefix
+        module_base_model = ModuleBaseModel(context=self)
+        invoke_result_data = module_base_model.save_act_module(app_id, act_id, module_id, module_name, module_sub_name, start_date, end_date, module_pic, module_desc, price, price_gear_id, ip_id, join_ways, is_fictitious, sort_index, is_release, i1, i2, i3, i4, i5, s1, s2, s3, s4, s5, d1, d2, business_type, module_type)
+        if invoke_result_data.success ==False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if invoke_result_data.data["is_add"] == True:
+            # 记录日志
+            self.create_operation_log(operation_type=OperationType.add.value, model_name=invoke_result_data.data["new"].__str__(), old_detail=None, update_detail=invoke_result_data.data["new"], title= title_prefix + ";" + module_name)
+        else:
+            self.create_operation_log(operation_type=OperationType.update.value, model_name=invoke_result_data.data["new"].__str__(), old_detail=invoke_result_data.data["old"], update_detail=invoke_result_data.data["new"], title= title_prefix + ";" + module_name)
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        self.response_json_success(invoke_result_data.data["new"].id)
+
+
+class ActModuleHandler(ClientBaseHandler):
+    """
+    :description: 单条活动模块信息
+    """
+    def get_async(self):
+        """
+        :description: 活动模块列表
+        :param app_id：应用标识
+        :param module_id：活动模块标识
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        module_id = int(self.get_param("module_id", 0))
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        module_base_model = ModuleBaseModel(context=self)
+        act_module_dict = module_base_model.get_act_module_dict(module_id, False)
+        if act_module_dict:
+            if act_module_dict["app_id"] != app_id:
+                act_module_dict = {}
+                return self.response_json_success(act_module_dict)
+        ref_params = {}
+        return self.response_json_success(self.business_process_executed(act_module_dict, ref_params))
+
+
+class ActModuleListHandler(ClientBaseHandler):
+    """
+    :description: 活动模块列表
+    """
+    def get_async(self):
+        """
+        :description: 活动模块列表
+        :param app_id：应用标识
+        :param business_type：业务类型(0无1机台2活动)
+        :param act_name：模块名称
+        :param start_date：开始时间
+        :param end_date：结束时间
+        :param page_index：页索引
+        :param page_size：页大小
+        :return: PageInfo
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        page_index = self.get_param_int("page_index", 0)
+        page_size = self.get_param_int("page_size", 10)
+        is_del = self.get_param_int("is_del", 0)
+        business_type = self.get_param_int("business_type", -1)
+        module_name = self.get_param("module_name")
+        start_date = self.get_param("start_date")
+        end_date = self.get_param("end_date")
+
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_success({"data": []})
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        condition = invoke_result_data.data["condition"] if invoke_result_data.data.__contains__("condition") else ""
+        params = invoke_result_data.data["params"] if invoke_result_data.data.__contains__("params") else []
+        order_by = invoke_result_data.data["order_by"] if invoke_result_data.data.__contains__("order_by") else "sort_index desc,id asc"
+        condition_where = ConditionWhere()
+        if condition:
+            condition_where.add_condition(condition)
+        if business_type != -1:
+            condition_where.add_condition("business_type=%s")
+            params.append(business_type)
+
+        if not app_id or not act_id:
+            return self.response_json_success({"data": []})
+        module_base_model = ModuleBaseModel(context=self)
+        page_list, total = module_base_model.get_act_module_list(app_id, act_id, module_name, start_date, end_date, is_del, page_size, page_index, order_by=order_by, condition=condition_where.to_string(), params=params, is_cache=False)
+        ref_params = {}
+        page_info = PageInfo(page_index, page_size, total, self.business_process_executed(page_list, ref_params))
+        return self.response_json_success(page_info)
+
+
+class DeleteActModuleHandler(ClientBaseHandler):
+    """
+    :description: 删除活动模块
+    """
+    @filter_check_params("module_id")
+    def get_async(self):
+        """
+        :description: 删除活动模块
+        :param app_id：应用标识
+        :param module_id：模块标识
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        module_id = int(self.get_param("module_id", 0))
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        module_base_model = ModuleBaseModel(context=self)
+        invoke_result_data = module_base_model.update_act_module_status(app_id, module_id, 1)
+        if invoke_result_data.success ==False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        default_prefix = ""
+        if invoke_result_data.data["business_type"] == 1:
+            default_prefix = "机台"
+        elif invoke_result_data.data["business_type"] == 2:
+            default_prefix = "活动"
+        title_prefix = invoke_result_data.data["title_prefix"] if invoke_result_data.data.__contains__("title_prefix") else default_prefix
+        self.create_operation_log(operation_type=OperationType.delete.value, model_name="act_module_tb", title= title_prefix + ";" + invoke_result_data.data["module_name"])
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success ==False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success()
+
+
+class ReviewActModuleHandler(ClientBaseHandler):
+    """
+    :description: 还原活动模块
+    """
+    @filter_check_params("module_id")
+    def get_async(self):
+        """
+        :description: 还原活动模块
+        :param app_id：应用标识
+        :param module_id：模块标识
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        module_id = int(self.get_param("module_id", 0))
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        module_base_model = ModuleBaseModel(context=self)
+        invoke_result_data = module_base_model.update_act_module_status(app_id, module_id, 0)
+        if invoke_result_data.success ==False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        default_prefix = ""
+        if invoke_result_data.data["business_type"] == 1:
+            default_prefix = "机台"
+        elif invoke_result_data.data["business_type"] == 2:
+            default_prefix = "活动"
+        title_prefix = invoke_result_data.data["title_prefix"] if invoke_result_data.data.__contains__("title_prefix") else default_prefix
+        self.create_operation_log(operation_type=OperationType.review.value, model_name="act_module_tb", title= title_prefix + ";" + invoke_result_data.data["module_name"])
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success ==False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success()
+
+
+class ReleaseActModuleHandler(ClientBaseHandler):
+    """
+    :description: 上下架活动模块
+    """
+    @filter_check_params("module_id")
+    def get_async(self):
+        """
+        :description: 上下架活动模块
+        :param app_id：应用标识
+        :param module_id：模块标识
+        :param is_release: 是否发布 1-是 0-否
+        :return:
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        module_id = int(self.get_param("module_id", 0))
+        is_release = int(self.get_param("is_release", 0))
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        module_base_model = ModuleBaseModel(context=self)
+        invoke_result_data = module_base_model.release_act_module(app_id, module_id, is_release)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        operation_type = OperationType.release.value if is_release == 1 else OperationType.un_release.value
+        default_prefix = ""
+        if invoke_result_data.data["business_type"] == 1:
+            default_prefix = "机台"
+        elif invoke_result_data.data["business_type"] == 2:
+            default_prefix = "活动"
+        title_prefix = invoke_result_data.data["title_prefix"] if invoke_result_data.data.__contains__("title_prefix") else default_prefix
+        self.create_operation_log(operation_type=operation_type, model_name="act_module_tb", title= title_prefix + ";" + invoke_result_data.data["module_name"])
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success ==False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success()
+
+
+class UpdateActModulePriceHandler(ClientBaseHandler):
+    """
+    :description: 更新活动模块价格
+    """
+    @filter_check_params("prize_gear_id")
+    def get_async(self):
+        """
+        :description:更新活动模块价格
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param prize_gear_id：档位标识
+        :return:
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        prize_gear_id = int(self.get_param("prize_gear_id", 0))
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        module_base_model = ModuleBaseModel(context=self)
+        invoke_result_data = module_base_model.update_act_module_price(app_id, act_id, prize_gear_id)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success ==False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
         return self.response_json_success()
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/handlers/server/order_s.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/handlers/server/order_s.py`

 * *Ordering differences only*

 * *Files 19% similar despite different names*

```diff
@@ -1,635 +1,635 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-08-09 14:11:52
-@LastEditTime: 2023-04-20 19:06:26
-@LastEditors: HuangJianYi
-@Description: 订单模块
-"""
-from seven_cloudapp_frame.models.enum import *
-from seven_cloudapp_frame.libs.customize.oss2_helper import *
-from seven_cloudapp_frame.handlers.frame_base import *
-from seven_cloudapp_frame.models.order_base_model import *
-
-
-class PayOrderListHandler(ClientBaseHandler):
-    """
-    :description: 用户购买订单列表
-    """
-    def get_async(self):
-        """
-        :description: 用户购买订单列表
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param user_id：用户标识
-        :param user_open_id：open_id
-        :param nick_name：用户昵称
-        :param pay_date_start：订单支付时间开始
-        :param pay_date_end：订单支付时间结束
-        :param main_pay_order_no：淘宝主订单号
-        :param sub_pay_order_no：淘宝子订单号
-        :param page_size：页大小
-        :param page_index：页索引
-        :return:
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        user_id = self.get_user_id()
-        user_open_id = self.get_param("user_open_id")
-        user_nick = self.get_param("nick_name")
-        pay_date_start = self.get_param("pay_date_start")
-        pay_date_end = self.get_param("pay_date_end")
-        main_pay_order_no = self.get_param("main_pay_order_no")
-        sub_pay_order_no = self.get_param("sub_pay_order_no")
-        page_index = int(self.get_param("page_index", 0))
-        page_size = int(self.get_param("page_size", 20))
-
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_success({"data": []})
-        if not invoke_result_data.data:
-            invoke_result_data.data = {}
-        condition = invoke_result_data.data["condition"] if invoke_result_data.data.__contains__("condition") else ""
-        params = invoke_result_data.data["params"] if invoke_result_data.data.__contains__("params") else []
-        order_by = invoke_result_data.data["order_by"] if invoke_result_data.data.__contains__("order_by") else "create_date desc"
-        field = invoke_result_data.data["field"] if invoke_result_data.data.__contains__("field") else "*"
-
-        if main_pay_order_no:
-            condition += " and " if condition else ""
-            condition += "main_pay_order_no=%s"
-            params.append(main_pay_order_no)
-        if sub_pay_order_no:
-            condition += " and " if condition else ""
-            condition += "sub_pay_order_no=%s"
-            params.append(sub_pay_order_no)
-
-        order_base_model = OrderBaseModel(context=self)
-        page_info = order_base_model.get_tao_pay_order_list(app_id, act_id, user_id, user_open_id, user_nick, pay_date_start, pay_date_end, page_size=page_size, page_index=page_index, field=field, order_by=order_by, condition=condition, params=params)
-        ref_params = {}
-        page_info.data = self.business_process_executed(page_info.data, ref_params)
-        return self.response_json_success(page_info)
-
-
-class PrizeOrderListHandler(ClientBaseHandler):
-    """
-    :description: 用户奖品订单列表
-    """
-    def get_async(self):
-        """
-        :description: 用户奖品订单列表
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param user_id：用户标识
-        :param user_open_id：open_id
-        :param order_no：订单号
-        :param nick_name：用户昵称
-        :param real_name：用户名字
-        :param telephone：联系电话
-        :param address：收货地址
-        :param order_status：订单状态（-1未付款-2付款中0未发货1已发货2不予发货3已退款4交易成功）
-        :param create_date_start：订单创建时间开始
-        :param create_date_end：订单创建时间结束
-        :param is_search_roster：是否查询订单关联中奖记录
-        :param page_size：页大小
-        :param page_index：页索引
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        user_id = self.get_user_id()
-        user_open_id = self.get_param("user_open_id")
-        user_nick = self.get_param("nick_name")
-        order_no = self.get_param("order_no")
-        real_name = self.get_param("real_name")
-        telephone = self.get_param("telephone")
-        address = self.get_param("address")
-        order_status = int(self.get_param("order_status",-10))
-        create_date_start = self.get_param("create_date_start")
-        create_date_end = self.get_param("create_date_end")
-        order_by = self.get_param("order_by","create_date desc")
-        is_search_roster = self.get_param_int("is_search_roster", 0)
-        is_search_roster = False if is_search_roster == 0 else True
-        page_index = int(self.get_param("page_index", 0))
-        page_size = int(self.get_param("page_size", 20))
-
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_success({"data": []})
-        if not invoke_result_data.data:
-            invoke_result_data.data = {}
-        condition = invoke_result_data.data["condition"] if invoke_result_data.data.__contains__("condition") else ""
-        params = invoke_result_data.data["params"] if invoke_result_data.data.__contains__("params") else []
-        order_by = invoke_result_data.data["order_by"] if invoke_result_data.data.__contains__("order_by") else "create_date desc"
-        field = invoke_result_data.data["field"] if invoke_result_data.data.__contains__("field") else "*"
-        prize_roster_sub_table = invoke_result_data.data["prize_roster_sub_table"] if invoke_result_data.data.__contains__("prize_roster_sub_table") else None
-
-        order_base_model = OrderBaseModel(context=self)
-        page_list, total = order_base_model.get_prize_order_list(app_id, act_id, user_id, user_open_id, user_nick, order_no, real_name, telephone, address, order_status, create_date_start, create_date_end, page_size, page_index, order_by, field=field, is_search_roster=is_search_roster, is_cache=False, condition=condition, params=params, prize_roster_sub_table=prize_roster_sub_table)
-        ref_params = {}
-        page_info = PageInfo(page_index, page_size, total, self.business_process_executed(page_list, ref_params))
-        return self.response_json_success(page_info)
-
-
-class PrizeRosterListHandler(ClientBaseHandler):
-    """
-    :description: 用户中奖记录列表
-    """
-    def get_async(self):
-        """
-        :description: 用户中奖记录列表
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param module_id：活动模块标识
-        :param user_code：用户标识
-        :param user_open_id：open_id
-        :param nick_name：用户昵称
-        :param module_name：模块名称
-        :param prize_name：奖品名称
-        :param order_no：订单号
-        :param goods_type：物品类型（1虚拟2实物）
-        :param prize_type：奖品类型(1现货2优惠券3红包4参与奖5预售)
-        :param logistics_status：物流状态（0未发货1已发货2不予发货）
-        :param prize_status：奖品状态（0未下单（未领取）1已下单（已领取）2已回购10已隐藏（删除）11无需发货）
-        :param pay_status：支付状态(0未支付1已支付2已退款3处理中)
-        :param create_date_start：开始时间
-        :param create_date_end：结束时间
-        :param page_size：页大小
-        :param page_index：页索引
-        :return 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        module_id = int(self.get_param("module_id", 0))
-        user_id = self.get_user_id()
-        user_open_id = self.get_param("user_open_id")
-        order_no = self.get_param("order_no")
-        user_nick = self.get_param("nick_name")
-        module_name = self.get_param("module_name")
-        prize_name = self.get_param("prize_name")
-        goods_type = int(self.get_param("goods_type", -1))
-        prize_type = int(self.get_param("prize_type", -1))
-        logistics_status = int(self.get_param("logistics_status", -1))
-        prize_status = int(self.get_param("prize_status", -1))
-        pay_status = int(self.get_param("pay_status", -1))
-        create_date_start = self.get_param("create_date_start")
-        create_date_end = self.get_param("create_date_end")
-        page_index = int(self.get_param("page_index", 0))
-        page_size = int(self.get_param("page_size", 500))
-
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_success({"data": []})
-        if not invoke_result_data.data:
-            invoke_result_data.data = {}
-        condition = invoke_result_data.data["condition"] if invoke_result_data.data.__contains__("condition") else ""
-        params = invoke_result_data.data["params"] if invoke_result_data.data.__contains__("params") else []
-        order_by = invoke_result_data.data["order_by"] if invoke_result_data.data.__contains__("order_by") else "create_date desc"
-        field = invoke_result_data.data["field"] if invoke_result_data.data.__contains__("field") else "*"
-        condition_where = ConditionWhere()
-        if condition:
-            condition_where.add_condition(condition)
-        if module_name:
-            condition_where.add_condition("module_name=%s")
-            params.append(module_name)
-        if prize_name:
-            condition_where.add_condition("prize_name=%s")
-            params.append(prize_name)
-
-        order_base_model = OrderBaseModel(context=self)
-        page_list, total = order_base_model.get_prize_roster_list(app_id, act_id, module_id, user_id, user_open_id, user_nick, order_no, goods_type, prize_type, logistics_status, prize_status, pay_status, page_size, page_index, create_date_start, create_date_end, order_by=order_by, field=field, condition=condition_where.to_string(), params=params, is_cache=False)
-        ref_params = {}
-        page_info = PageInfo(page_index, page_size, total, self.business_process_executed(page_list, ref_params=ref_params))
-        return self.response_json_success(page_info)
-
-
-class UpdatePrizeOrderSellerRemarkHandler(ClientBaseHandler):
-    """
-    :description: 更新奖品订单卖家备注
-    """
-    @filter_check_params("prize_order_id")
-    def get_async(self):
-        """
-        :description: 更新奖品订单卖家备注
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param prize_order_id：奖品订单标识
-        :param seller_remark：卖家备注
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        prize_order_id = int(self.get_param("prize_order_id", 0))
-        seller_remark = self.get_param("seller_remark")
-        order_base_model = OrderBaseModel(context=self)
-        invoke_result_data = order_base_model.update_prize_order_seller_remark(app_id, act_id, prize_order_id, seller_remark)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        title = "修改订单备注；用户昵称：" + invoke_result_data.data["user_nick"] + "，openid：" + invoke_result_data.data["open_id"]
-        self.create_operation_log(operation_type=OperationType.operate.value, model_name="prize_order_tb", title=title)
-        return self.response_json_success()
-
-
-class UpdatePrizeOrderStatusHandler(ClientBaseHandler):
-    """
-    :description: 更新用户奖品订单状态
-    """
-    @filter_check_params("prize_order_id,order_status")
-    def get_async(self):
-        """
-        :description: 更新用户奖品订单状态
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param prize_order_id：奖品订单标识
-        :param order_status：订单状态
-        :param express_company：快递公司
-        :param express_no：快递单号
-        :return: 实体模型InvokeResultData
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        prize_order_id = int(self.get_param("prize_order_id", 0))
-        order_status = int(self.get_param("order_status", 0))
-        express_company = self.get_param("express_company")
-        express_no = self.get_param("express_no")
-
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        if not invoke_result_data.data:
-            invoke_result_data.data = {}
-        prize_roster_sub_table = invoke_result_data.data["prize_roster_sub_table"] if invoke_result_data.data.__contains__("prize_roster_sub_table") else None
-        order_base_model = OrderBaseModel(context=self)
-        invoke_result_data = order_base_model.update_prize_order_status(app_id, act_id, prize_order_id, order_status, express_company, express_no, prize_roster_sub_table)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        title = "修改订单状态；"
-        if order_status == 1:
-            title = "发货；"
-        elif  order_status == 2:
-            title = "不予发货；"
-        title = title + "用户昵称：" + invoke_result_data.data["user_nick"] + "，openid：" + invoke_result_data.data["open_id"]
-        self.create_operation_log(operation_type=OperationType.operate.value, model_name="prize_order_tb", title=title)
-        ref_params = {}
-        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
-        if invoke_result_data.success ==False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success(invoke_result_data.data)
-
-
-class ImportPrizeOrderHandler(ClientBaseHandler):
-    """
-    :description: 导入奖品订单进行发货
-    """
-    @filter_check_params("content")
-    def post_async(self):
-        """
-        :description: 导入奖品订单进行发货
-        :param app_id：应用标识
-        :param content_type：内容类型 1-base64字符串内容 2-json字符串内容
-        :param content：字符串内容
-        :param act_id：活动标识
-        :param ref_head_name：关联表头名称，可不传
-        :return 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        content = self.get_param("content")
-        content_type = int(self.get_param("content_type", 1))
-        ref_head_name = self.get_param("ref_head_name", "小程序订单号")
-
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        if not invoke_result_data.data:
-            invoke_result_data.data = {}
-        prize_roster_sub_table = invoke_result_data.data["prize_roster_sub_table"] if invoke_result_data.data.__contains__("prize_roster_sub_table") else None
-        operate_title = invoke_result_data.data["operate_title"] if invoke_result_data.data.__contains__("operate_title") else "发货列表"
-        order_base_model = OrderBaseModel(context=self)
-        invoke_result_data = order_base_model.import_prize_order(app_id, act_id, content_type, content, ref_head_name, prize_roster_sub_table)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        self.create_operation_log(operation_type=OperationType.import_data.value, model_name="prize_order_tb", title=operate_title)
-        ref_params = {}
-        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
-        if invoke_result_data.success ==False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success(invoke_result_data.data)
-
-
-class PrizeOrderExportHandler(ClientBaseHandler):
-    """
-    :description: 导出奖品订单列表
-    """
-    def get_async(self):
-        """
-        :description: 导出奖品订单列表
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param user_code：用户标识
-        :param open_id：open_id
-        :param order_no：订单号
-        :param nick_name：用户昵称
-        :param real_name：用户名字
-        :param telephone：联系电话
-        :param address：收货地址
-        :param order_status：订单状态（-1未付款-2付款中0未发货1已发货2不予发货3已退款4交易成功）
-        :param create_date_start：订单创建时间开始
-        :param create_date_end：订单创建时间结束
-        :param page_size：页大小
-        :param page_index：页索引
-        :return
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        user_id = self.get_user_id()
-        user_open_id = self.get_param("user_open_id")
-        user_nick = self.get_param("nick_name")
-        order_no = self.get_param("order_no")
-        real_name = self.get_param("real_name")
-        telephone = self.get_param("telephone")
-        address = self.get_param("address")
-        order_status = int(self.get_param("order_status", -10))
-        create_date_start = self.get_param("create_date_start")
-        create_date_end = self.get_param("create_date_end")
-        page_index = int(self.get_param("page_index", 0))
-        page_size = int(self.get_param("page_size", 500))
-
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_success("")
-        if not invoke_result_data.data:
-            invoke_result_data.data = {}
-        condition = invoke_result_data.data["condition"] if invoke_result_data.data.__contains__("condition") else ""
-        params = invoke_result_data.data["params"] if invoke_result_data.data.__contains__("params") else []
-        order_by = invoke_result_data.data["order_by"] if invoke_result_data.data.__contains__("order_by") else "create_date desc"
-        field = invoke_result_data.data["field"] if invoke_result_data.data.__contains__("field") else "*"
-        operate_title = invoke_result_data.data["operate_title"] if invoke_result_data.data.__contains__("operate_title") else "发货列表"
-        prize_roster_sub_table = invoke_result_data.data["prize_roster_sub_table"] if invoke_result_data.data.__contains__("prize_roster_sub_table") else None
-
-        order_base_model = OrderBaseModel(context=self)
-        prize_order_list_dict = []
-        if page_size <= 500:
-            prize_order_list_dict = order_base_model.get_prize_order_list(app_id, act_id, user_id, user_open_id, user_nick, order_no, real_name, telephone, address, order_status, create_date_start, create_date_end, page_size, page_index, order_by, field=field, is_search_roster=True, is_cache=False, condition=condition, params=params, prize_roster_sub_table=prize_roster_sub_table, page_count_mode='none')
-        else:
-            max_page_size = 500
-            repeat_count = page_size // max_page_size  # 循环次数
-            begin_page_index = page_index * repeat_count  # 开始页码
-            for i in range(repeat_count):
-                list_dict = order_base_model.get_prize_order_list(app_id, act_id, user_id, user_open_id, user_nick, order_no, real_name, telephone, address, order_status, create_date_start, create_date_end, max_page_size, begin_page_index + i, order_by, field=field, is_search_roster=True, is_cache=False, condition=condition, params=params, prize_roster_sub_table=prize_roster_sub_table, page_count_mode='none')
-                if len(list_dict) <= 0:
-                    break
-                prize_order_list_dict.extend(list_dict)
-
-        ref_params = {}
-        result_data = self.business_process_executed(prize_order_list_dict, ref_params)
-        resource_path = OSS2Helper.export_excel(result_data)
-        self.create_operation_log(operation_type=OperationType.export.value, model_name="prize_order_tb", title=operate_title)
-        return self.response_json_success(resource_path)
-
-    def business_process_executed(self, result_data,ref_params):
-        """
-        :description: 执行后事件
-        :param result_data:result_data
-        :param ref_params: 关联参数
-        :return:
-        :last_editors: HuangJianYi
-        """
-        result_list = []
-        if len(result_data) > 0:
-            frame_base_model = FrameBaseModel(context=self)
-            for prize_order_dict in result_data:
-                for prize_roster_dict in prize_order_dict["roster_list"]:
-                    data_row = {}
-                    data_row["小程序订单号"] = prize_order_dict["order_no"]
-                    data_row["淘宝子订单号"] = prize_roster_dict["sub_pay_order_no"]
-                    data_row["淘宝名"] = prize_order_dict["user_nick"]
-                    data_row["openid"] = prize_order_dict["open_id"]
-                    data_row["模块名称"] = prize_roster_dict["module_name"]
-                    data_row["奖品名称"] = prize_roster_dict["prize_name"]
-                    data_row["商家编码"] = prize_roster_dict["goods_code"]
-                    data_row["姓名"] = prize_order_dict["real_name"]
-                    data_row["手机号"] = prize_order_dict["telephone"]
-                    data_row["省份"] = prize_order_dict["province"]
-                    data_row["城市"] = prize_order_dict["city"]
-                    data_row["区县"] = prize_order_dict["county"]
-                    data_row["街道"] = prize_order_dict["street"]
-                    data_row["收货地址"] = prize_order_dict["address"]
-                    data_row["物流单号"] = prize_order_dict["express_no"]
-                    data_row["物流公司"] = prize_order_dict["express_company"]
-                    if str(prize_order_dict["deliver_date"]) == "1900-01-01 00:00:00":
-                        data_row["发货时间"] = ""
-                    else:
-                        data_row["发货时间"] = str(prize_order_dict["deliver_date"])
-                    data_row["订单状态"] = frame_base_model.get_order_status_name(prize_order_dict["order_status"])
-                    data_row["奖品价值"] = str(prize_roster_dict["prize_price"])
-                    data_row["奖品规格"] = prize_roster_dict["sku_name"]
-                    data_row["备注"] = prize_order_dict["seller_remark"]
-                    result_list.append(data_row)
-        return result_list
-
-
-class PrizeRosterExportHandler(ClientBaseHandler):
-    """
-    :description: 导出用户中奖记录列表
-    """
-    def get_async(self):
-        """
-        :description: 导出用户中奖记录列表
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param module_id：活动模块标识
-        :param user_id：用户标识
-        :param open_id：open_id
-        :param nick_name：用户昵称
-        :param order_no：订单号
-        :param goods_type：物品类型（1虚拟2实物）
-        :param prize_type：奖品类型(1现货2优惠券3红包4参与奖5预售)
-        :param logistics_status：物流状态（0未发货1已发货2不予发货）
-        :param prize_status：奖品状态（0未下单（未领取）1已下单（已领取）2已回购10已隐藏（删除）11无需发货）
-        :param pay_status：支付状态(0未支付1已支付2已退款3处理中)
-        :param page_size：页大小
-        :param page_index：页索引
-        :param create_date_start：开始时间
-        :param create_date_end：结束时间
-        :return 
-        :last_editors: HuangJianYi
-        """
-        app_id =self.get_app_id()
-        act_id = self.get_act_id()
-        module_id = int(self.get_param("module_id", 0))
-        order_no = self.get_param("order_no")
-        user_id = self.get_user_id()
-        user_nick = self.get_param("nick_name")
-        user_open_id = self.get_param("user_open_id")
-        goods_type = int(self.get_param("goods_type", -1))
-        prize_type = int(self.get_param("prize_type", -1))
-        logistics_status = int(self.get_param("logistics_status", -1))
-        prize_status = int(self.get_param("prize_status", -1))
-        pay_status = int(self.get_param("pay_status", -1))
-        create_date_start = self.get_param("create_date_start")
-        create_date_end = self.get_param("create_date_end")
-        page_index = int(self.get_param("page_index", 0))
-        page_size = int(self.get_param("page_size", 500))
-
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_success("")
-        if not invoke_result_data.data:
-            invoke_result_data.data = {}
-        condition = invoke_result_data.data["condition"] if invoke_result_data.data.__contains__("condition") else ""
-        params = invoke_result_data.data["params"] if invoke_result_data.data.__contains__("params") else []
-        order_by = invoke_result_data.data["order_by"] if invoke_result_data.data.__contains__("order_by") else "create_date desc"
-        field = invoke_result_data.data["field"] if invoke_result_data.data.__contains__("field") else "*"
-        operate_title = invoke_result_data.data["operate_title"] if invoke_result_data.data.__contains__("operate_title") else "中奖记录列表"
-
-        order_base_model = OrderBaseModel(context=self)
-        prize_roster_list_dict = []
-        if page_size <= 500:
-            prize_roster_list_dict = order_base_model.get_prize_roster_list(app_id, act_id, module_id, user_id, user_open_id, user_nick, order_no, goods_type, prize_type, logistics_status, prize_status, pay_status, page_size, page_index, create_date_start, create_date_end, order_by=order_by, field=field, condition=condition, params=params, is_cache=False, page_count_mode='none')
-        else:
-            max_page_size = 500
-            repeat_count = page_size // max_page_size  # 循环次数
-            begin_page_index = page_index * repeat_count  # 开始页码
-            for i in range(repeat_count):
-                list_dict = order_base_model.get_prize_roster_list(app_id, act_id, module_id, user_id, user_open_id, user_nick, order_no, goods_type, prize_type, logistics_status, prize_status, pay_status, max_page_size, begin_page_index + i, create_date_start, create_date_end, order_by=order_by, field=field, condition=condition, params=params, is_cache=False, page_count_mode='none')
-                if len(list_dict) <= 0:
-                    break
-                prize_roster_list_dict.extend(list_dict)
-        ref_params = {}
-        result_data = self.business_process_executed(prize_roster_list_dict, ref_params)
-        resource_path = OSS2Helper.export_excel(result_data)
-        self.create_operation_log(operation_type=OperationType.export.value, model_name="prize_roster_tb", title=operate_title)
-        return self.response_json_success(resource_path)
-
-    def business_process_executed(self, result_data, ref_params):
-        """
-        :description: 执行后事件
-        :param result_data:result_data
-        :param ref_params: 关联参数
-        :return:
-        :last_editors: HuangJianYi
-        """
-        result_list = []
-        for prize_roster_dict in result_data:
-            data_row = {}
-            data_row["行为编号"] = prize_roster_dict["id"]
-            data_row["小程序订单号"] = prize_roster_dict["order_no"]
-            data_row["淘宝子订单号"] = prize_roster_dict["sub_pay_order_no"]
-            data_row["淘宝名"] = prize_roster_dict["user_nick"]
-            data_row["openid"] = prize_roster_dict["open_id"]
-            data_row["模块名称"] = prize_roster_dict["module_name"]
-            data_row["奖品名称"] = prize_roster_dict["prize_name"]
-            data_row["奖品价值"] = str(prize_roster_dict["prize_price"])
-            data_row["奖品规格"] = prize_roster_dict["sku_name"]
-            data_row["商家编码"] = prize_roster_dict["goods_code"]
-            data_row["获得时间"] = prize_roster_dict["create_date"]
-            if prize_roster_dict["order_no"] == "":
-                data_row["状态"] = "未下单"
-            else:
-                data_row["状态"] = "已下单"
-            result_list.append(data_row)
-        return result_list
-
-
-class TaoPayOrderExportHandler(ClientBaseHandler):
-    """
-    :description: 淘宝支付订单批量导出
-    """
-    def get_async(self):
-        """
-        :description: 淘宝支付订单批量导出
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param user_code：用户标识
-        :param user_open_id：open_id
-        :param nick_name：用户昵称
-        :param pay_date_start：订单支付时间开始
-        :param pay_date_end：订单支付时间结束
-        :param main_pay_order_no：淘宝主订单号
-        :param sub_pay_order_no：淘宝子订单号
-        :param page_size：页大小
-        :param page_index：页索引
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        user_id = self.get_user_id()
-        user_open_id = self.get_param("user_open_id")
-        user_nick = self.get_param("nick_name")
-        pay_date_start = self.get_param("pay_date_start")
-        pay_date_end = self.get_param("pay_date_end")
-        main_pay_order_no = self.get_param("main_pay_order_no")
-        sub_pay_order_no = self.get_param("sub_pay_order_no")
-        page_index = int(self.get_param("page_index", 0))
-        page_size = int(self.get_param("page_size", 500))
-
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_success("")
-        if not invoke_result_data.data:
-            invoke_result_data.data = {}
-        condition = invoke_result_data.data["condition"] if invoke_result_data.data.__contains__("condition") else ""
-        params = invoke_result_data.data["params"] if invoke_result_data.data.__contains__("params") else []
-        order_by = invoke_result_data.data["order_by"] if invoke_result_data.data.__contains__("order_by") else "create_date desc"
-        field = invoke_result_data.data["field"] if invoke_result_data.data.__contains__("field") else "*"
-        operate_title = invoke_result_data.data["operate_title"] if invoke_result_data.data.__contains__("operate_title") else "支付订单列表"
-
-        if main_pay_order_no:
-            condition += " and " if condition else ""
-            condition += "main_pay_order_no=%s"
-            params.append(main_pay_order_no)
-        if sub_pay_order_no:
-            condition += " and " if condition else ""
-            condition += "sub_pay_order_no=%s"
-            params.append(sub_pay_order_no)
-
-        order_base_model = OrderBaseModel(context=self)
-        tao_pay_order_list_dict = []
-        if page_size <= 500:
-            tao_pay_order_list_dict = order_base_model.get_tao_pay_order_list(app_id, act_id, user_id, user_open_id, user_nick, pay_date_start, pay_date_end, page_size, page_index, field=field, order_by=order_by, condition=condition, params=params).data
-        else:
-            max_page_size = 500
-            repeat_count = page_size // max_page_size  # 循环次数
-            begin_page_index = page_index * repeat_count  # 开始页码
-            for i in range(repeat_count):
-                list_dict = order_base_model.get_tao_pay_order_list(app_id, act_id, user_id, user_open_id, user_nick, pay_date_start, pay_date_end, max_page_size, begin_page_index + i, field=field, order_by=order_by, condition=condition, params=params).data
-                if len(list_dict) <= 0:
-                    break
-                tao_pay_order_list_dict.extend(list_dict)
-
-        ref_params = {}
-        result_data = self.business_process_executed(tao_pay_order_list_dict, ref_params)
-        resource_path = OSS2Helper.export_excel(result_data)
-        self.create_operation_log(operation_type=OperationType.export.value, model_name="tao_pay_order_tb", title=operate_title)
-        return self.response_json_success(resource_path)
-
-    def business_process_executed(self, result_data, ref_params):
-        """
-        :description: 执行后事件
-        :param result_data:result_data
-        :param ref_params: 关联参数
-        :return:
-        :last_editors: HuangJianYi
-        """
-        result_list = []
-        for tao_pay_order_dict in result_data:
-            data_row = {}
-            data_row["淘宝主订单号"] = tao_pay_order_dict["main_pay_order_no"]
-            data_row["淘宝子订单号"] = tao_pay_order_dict["sub_pay_order_no"]
-            data_row["淘宝名"] = tao_pay_order_dict["user_nick"]
-            data_row["openid"] = tao_pay_order_dict["open_id"]
-            data_row["商家编码"] = tao_pay_order_dict["goods_code"]
-            data_row["商品名称"] = tao_pay_order_dict["goods_name"]
-            data_row["购买数量"] = tao_pay_order_dict["buy_num"]
-            data_row["支付金额"] = tao_pay_order_dict["pay_price"]
-            data_row["支付时间"] = TimeHelper.datetime_to_format_time(tao_pay_order_dict["pay_date"])
-            result_list.append(data_row)
-        return result_list
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-08-09 14:11:52
+@LastEditTime: 2023-04-20 19:06:26
+@LastEditors: HuangJianYi
+@Description: 订单模块
+"""
+from seven_cloudapp_frame.models.enum import *
+from seven_cloudapp_frame.libs.customize.oss2_helper import *
+from seven_cloudapp_frame.handlers.frame_base import *
+from seven_cloudapp_frame.models.order_base_model import *
+
+
+class PayOrderListHandler(ClientBaseHandler):
+    """
+    :description: 用户购买订单列表
+    """
+    def get_async(self):
+        """
+        :description: 用户购买订单列表
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param user_id：用户标识
+        :param user_open_id：open_id
+        :param nick_name：用户昵称
+        :param pay_date_start：订单支付时间开始
+        :param pay_date_end：订单支付时间结束
+        :param main_pay_order_no：淘宝主订单号
+        :param sub_pay_order_no：淘宝子订单号
+        :param page_size：页大小
+        :param page_index：页索引
+        :return:
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        user_open_id = self.get_param("user_open_id")
+        user_nick = self.get_param("nick_name")
+        pay_date_start = self.get_param("pay_date_start")
+        pay_date_end = self.get_param("pay_date_end")
+        main_pay_order_no = self.get_param("main_pay_order_no")
+        sub_pay_order_no = self.get_param("sub_pay_order_no")
+        page_index = int(self.get_param("page_index", 0))
+        page_size = int(self.get_param("page_size", 20))
+
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_success({"data": []})
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        condition = invoke_result_data.data["condition"] if invoke_result_data.data.__contains__("condition") else ""
+        params = invoke_result_data.data["params"] if invoke_result_data.data.__contains__("params") else []
+        order_by = invoke_result_data.data["order_by"] if invoke_result_data.data.__contains__("order_by") else "create_date desc"
+        field = invoke_result_data.data["field"] if invoke_result_data.data.__contains__("field") else "*"
+
+        if main_pay_order_no:
+            condition += " and " if condition else ""
+            condition += "main_pay_order_no=%s"
+            params.append(main_pay_order_no)
+        if sub_pay_order_no:
+            condition += " and " if condition else ""
+            condition += "sub_pay_order_no=%s"
+            params.append(sub_pay_order_no)
+
+        order_base_model = OrderBaseModel(context=self)
+        page_info = order_base_model.get_tao_pay_order_list(app_id, act_id, user_id, user_open_id, user_nick, pay_date_start, pay_date_end, page_size=page_size, page_index=page_index, field=field, order_by=order_by, condition=condition, params=params)
+        ref_params = {}
+        page_info.data = self.business_process_executed(page_info.data, ref_params)
+        return self.response_json_success(page_info)
+
+
+class PrizeOrderListHandler(ClientBaseHandler):
+    """
+    :description: 用户奖品订单列表
+    """
+    def get_async(self):
+        """
+        :description: 用户奖品订单列表
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param user_id：用户标识
+        :param user_open_id：open_id
+        :param order_no：订单号
+        :param nick_name：用户昵称
+        :param real_name：用户名字
+        :param telephone：联系电话
+        :param address：收货地址
+        :param order_status：订单状态（-1未付款-2付款中0未发货1已发货2不予发货3已退款4交易成功）
+        :param create_date_start：订单创建时间开始
+        :param create_date_end：订单创建时间结束
+        :param is_search_roster：是否查询订单关联中奖记录
+        :param page_size：页大小
+        :param page_index：页索引
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        user_open_id = self.get_param("user_open_id")
+        user_nick = self.get_param("nick_name")
+        order_no = self.get_param("order_no")
+        real_name = self.get_param("real_name")
+        telephone = self.get_param("telephone")
+        address = self.get_param("address")
+        order_status = int(self.get_param("order_status",-10))
+        create_date_start = self.get_param("create_date_start")
+        create_date_end = self.get_param("create_date_end")
+        order_by = self.get_param("order_by","create_date desc")
+        is_search_roster = self.get_param_int("is_search_roster", 0)
+        is_search_roster = False if is_search_roster == 0 else True
+        page_index = int(self.get_param("page_index", 0))
+        page_size = int(self.get_param("page_size", 20))
+
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_success({"data": []})
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        condition = invoke_result_data.data["condition"] if invoke_result_data.data.__contains__("condition") else ""
+        params = invoke_result_data.data["params"] if invoke_result_data.data.__contains__("params") else []
+        order_by = invoke_result_data.data["order_by"] if invoke_result_data.data.__contains__("order_by") else "create_date desc"
+        field = invoke_result_data.data["field"] if invoke_result_data.data.__contains__("field") else "*"
+        prize_roster_sub_table = invoke_result_data.data["prize_roster_sub_table"] if invoke_result_data.data.__contains__("prize_roster_sub_table") else None
+
+        order_base_model = OrderBaseModel(context=self)
+        page_list, total = order_base_model.get_prize_order_list(app_id, act_id, user_id, user_open_id, user_nick, order_no, real_name, telephone, address, order_status, create_date_start, create_date_end, page_size, page_index, order_by, field=field, is_search_roster=is_search_roster, is_cache=False, condition=condition, params=params, prize_roster_sub_table=prize_roster_sub_table)
+        ref_params = {}
+        page_info = PageInfo(page_index, page_size, total, self.business_process_executed(page_list, ref_params))
+        return self.response_json_success(page_info)
+
+
+class PrizeRosterListHandler(ClientBaseHandler):
+    """
+    :description: 用户中奖记录列表
+    """
+    def get_async(self):
+        """
+        :description: 用户中奖记录列表
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param module_id：活动模块标识
+        :param user_code：用户标识
+        :param user_open_id：open_id
+        :param nick_name：用户昵称
+        :param module_name：模块名称
+        :param prize_name：奖品名称
+        :param order_no：订单号
+        :param goods_type：物品类型（1虚拟2实物）
+        :param prize_type：奖品类型(1现货2优惠券3红包4参与奖5预售)
+        :param logistics_status：物流状态（0未发货1已发货2不予发货）
+        :param prize_status：奖品状态（0未下单（未领取）1已下单（已领取）2已回购10已隐藏（删除）11无需发货）
+        :param pay_status：支付状态(0未支付1已支付2已退款3处理中)
+        :param create_date_start：开始时间
+        :param create_date_end：结束时间
+        :param page_size：页大小
+        :param page_index：页索引
+        :return 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        module_id = int(self.get_param("module_id", 0))
+        user_id = self.get_user_id()
+        user_open_id = self.get_param("user_open_id")
+        order_no = self.get_param("order_no")
+        user_nick = self.get_param("nick_name")
+        module_name = self.get_param("module_name")
+        prize_name = self.get_param("prize_name")
+        goods_type = int(self.get_param("goods_type", -1))
+        prize_type = int(self.get_param("prize_type", -1))
+        logistics_status = int(self.get_param("logistics_status", -1))
+        prize_status = int(self.get_param("prize_status", -1))
+        pay_status = int(self.get_param("pay_status", -1))
+        create_date_start = self.get_param("create_date_start")
+        create_date_end = self.get_param("create_date_end")
+        page_index = int(self.get_param("page_index", 0))
+        page_size = int(self.get_param("page_size", 500))
+
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_success({"data": []})
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        condition = invoke_result_data.data["condition"] if invoke_result_data.data.__contains__("condition") else ""
+        params = invoke_result_data.data["params"] if invoke_result_data.data.__contains__("params") else []
+        order_by = invoke_result_data.data["order_by"] if invoke_result_data.data.__contains__("order_by") else "create_date desc"
+        field = invoke_result_data.data["field"] if invoke_result_data.data.__contains__("field") else "*"
+        condition_where = ConditionWhere()
+        if condition:
+            condition_where.add_condition(condition)
+        if module_name:
+            condition_where.add_condition("module_name=%s")
+            params.append(module_name)
+        if prize_name:
+            condition_where.add_condition("prize_name=%s")
+            params.append(prize_name)
+
+        order_base_model = OrderBaseModel(context=self)
+        page_list, total = order_base_model.get_prize_roster_list(app_id, act_id, module_id, user_id, user_open_id, user_nick, order_no, goods_type, prize_type, logistics_status, prize_status, pay_status, page_size, page_index, create_date_start, create_date_end, order_by=order_by, field=field, condition=condition_where.to_string(), params=params, is_cache=False)
+        ref_params = {}
+        page_info = PageInfo(page_index, page_size, total, self.business_process_executed(page_list, ref_params=ref_params))
+        return self.response_json_success(page_info)
+
+
+class UpdatePrizeOrderSellerRemarkHandler(ClientBaseHandler):
+    """
+    :description: 更新奖品订单卖家备注
+    """
+    @filter_check_params("prize_order_id")
+    def get_async(self):
+        """
+        :description: 更新奖品订单卖家备注
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param prize_order_id：奖品订单标识
+        :param seller_remark：卖家备注
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        prize_order_id = int(self.get_param("prize_order_id", 0))
+        seller_remark = self.get_param("seller_remark")
+        order_base_model = OrderBaseModel(context=self)
+        invoke_result_data = order_base_model.update_prize_order_seller_remark(app_id, act_id, prize_order_id, seller_remark)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        title = "修改订单备注；用户昵称：" + invoke_result_data.data["user_nick"] + "，openid：" + invoke_result_data.data["open_id"]
+        self.create_operation_log(operation_type=OperationType.operate.value, model_name="prize_order_tb", title=title)
+        return self.response_json_success()
+
+
+class UpdatePrizeOrderStatusHandler(ClientBaseHandler):
+    """
+    :description: 更新用户奖品订单状态
+    """
+    @filter_check_params("prize_order_id,order_status")
+    def get_async(self):
+        """
+        :description: 更新用户奖品订单状态
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param prize_order_id：奖品订单标识
+        :param order_status：订单状态
+        :param express_company：快递公司
+        :param express_no：快递单号
+        :return: 实体模型InvokeResultData
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        prize_order_id = int(self.get_param("prize_order_id", 0))
+        order_status = int(self.get_param("order_status", 0))
+        express_company = self.get_param("express_company")
+        express_no = self.get_param("express_no")
+
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        prize_roster_sub_table = invoke_result_data.data["prize_roster_sub_table"] if invoke_result_data.data.__contains__("prize_roster_sub_table") else None
+        order_base_model = OrderBaseModel(context=self)
+        invoke_result_data = order_base_model.update_prize_order_status(app_id, act_id, prize_order_id, order_status, express_company, express_no, prize_roster_sub_table)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        title = "修改订单状态；"
+        if order_status == 1:
+            title = "发货；"
+        elif  order_status == 2:
+            title = "不予发货；"
+        title = title + "用户昵称：" + invoke_result_data.data["user_nick"] + "，openid：" + invoke_result_data.data["open_id"]
+        self.create_operation_log(operation_type=OperationType.operate.value, model_name="prize_order_tb", title=title)
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success ==False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success(invoke_result_data.data)
+
+
+class ImportPrizeOrderHandler(ClientBaseHandler):
+    """
+    :description: 导入奖品订单进行发货
+    """
+    @filter_check_params("content")
+    def post_async(self):
+        """
+        :description: 导入奖品订单进行发货
+        :param app_id：应用标识
+        :param content_type：内容类型 1-base64字符串内容 2-json字符串内容
+        :param content：字符串内容
+        :param act_id：活动标识
+        :param ref_head_name：关联表头名称，可不传
+        :return 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        content = self.get_param("content")
+        content_type = int(self.get_param("content_type", 1))
+        ref_head_name = self.get_param("ref_head_name", "小程序订单号")
+
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        prize_roster_sub_table = invoke_result_data.data["prize_roster_sub_table"] if invoke_result_data.data.__contains__("prize_roster_sub_table") else None
+        operate_title = invoke_result_data.data["operate_title"] if invoke_result_data.data.__contains__("operate_title") else "发货列表"
+        order_base_model = OrderBaseModel(context=self)
+        invoke_result_data = order_base_model.import_prize_order(app_id, act_id, content_type, content, ref_head_name, prize_roster_sub_table)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        self.create_operation_log(operation_type=OperationType.import_data.value, model_name="prize_order_tb", title=operate_title)
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success ==False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success(invoke_result_data.data)
+
+
+class PrizeOrderExportHandler(ClientBaseHandler):
+    """
+    :description: 导出奖品订单列表
+    """
+    def get_async(self):
+        """
+        :description: 导出奖品订单列表
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param user_code：用户标识
+        :param open_id：open_id
+        :param order_no：订单号
+        :param nick_name：用户昵称
+        :param real_name：用户名字
+        :param telephone：联系电话
+        :param address：收货地址
+        :param order_status：订单状态（-1未付款-2付款中0未发货1已发货2不予发货3已退款4交易成功）
+        :param create_date_start：订单创建时间开始
+        :param create_date_end：订单创建时间结束
+        :param page_size：页大小
+        :param page_index：页索引
+        :return
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        user_open_id = self.get_param("user_open_id")
+        user_nick = self.get_param("nick_name")
+        order_no = self.get_param("order_no")
+        real_name = self.get_param("real_name")
+        telephone = self.get_param("telephone")
+        address = self.get_param("address")
+        order_status = int(self.get_param("order_status", -10))
+        create_date_start = self.get_param("create_date_start")
+        create_date_end = self.get_param("create_date_end")
+        page_index = int(self.get_param("page_index", 0))
+        page_size = int(self.get_param("page_size", 500))
+
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_success("")
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        condition = invoke_result_data.data["condition"] if invoke_result_data.data.__contains__("condition") else ""
+        params = invoke_result_data.data["params"] if invoke_result_data.data.__contains__("params") else []
+        order_by = invoke_result_data.data["order_by"] if invoke_result_data.data.__contains__("order_by") else "create_date desc"
+        field = invoke_result_data.data["field"] if invoke_result_data.data.__contains__("field") else "*"
+        operate_title = invoke_result_data.data["operate_title"] if invoke_result_data.data.__contains__("operate_title") else "发货列表"
+        prize_roster_sub_table = invoke_result_data.data["prize_roster_sub_table"] if invoke_result_data.data.__contains__("prize_roster_sub_table") else None
+
+        order_base_model = OrderBaseModel(context=self)
+        prize_order_list_dict = []
+        if page_size <= 500:
+            prize_order_list_dict = order_base_model.get_prize_order_list(app_id, act_id, user_id, user_open_id, user_nick, order_no, real_name, telephone, address, order_status, create_date_start, create_date_end, page_size, page_index, order_by, field=field, is_search_roster=True, is_cache=False, condition=condition, params=params, prize_roster_sub_table=prize_roster_sub_table, page_count_mode='none')
+        else:
+            max_page_size = 500
+            repeat_count = page_size // max_page_size  # 循环次数
+            begin_page_index = page_index * repeat_count  # 开始页码
+            for i in range(repeat_count):
+                list_dict = order_base_model.get_prize_order_list(app_id, act_id, user_id, user_open_id, user_nick, order_no, real_name, telephone, address, order_status, create_date_start, create_date_end, max_page_size, begin_page_index + i, order_by, field=field, is_search_roster=True, is_cache=False, condition=condition, params=params, prize_roster_sub_table=prize_roster_sub_table, page_count_mode='none')
+                if len(list_dict) <= 0:
+                    break
+                prize_order_list_dict.extend(list_dict)
+
+        ref_params = {}
+        result_data = self.business_process_executed(prize_order_list_dict, ref_params)
+        resource_path = OSS2Helper.export_excel(result_data)
+        self.create_operation_log(operation_type=OperationType.export.value, model_name="prize_order_tb", title=operate_title)
+        return self.response_json_success(resource_path)
+
+    def business_process_executed(self, result_data,ref_params):
+        """
+        :description: 执行后事件
+        :param result_data:result_data
+        :param ref_params: 关联参数
+        :return:
+        :last_editors: HuangJianYi
+        """
+        result_list = []
+        if len(result_data) > 0:
+            frame_base_model = FrameBaseModel(context=self)
+            for prize_order_dict in result_data:
+                for prize_roster_dict in prize_order_dict["roster_list"]:
+                    data_row = {}
+                    data_row["小程序订单号"] = prize_order_dict["order_no"]
+                    data_row["淘宝子订单号"] = prize_roster_dict["sub_pay_order_no"]
+                    data_row["淘宝名"] = prize_order_dict["user_nick"]
+                    data_row["openid"] = prize_order_dict["open_id"]
+                    data_row["模块名称"] = prize_roster_dict["module_name"]
+                    data_row["奖品名称"] = prize_roster_dict["prize_name"]
+                    data_row["商家编码"] = prize_roster_dict["goods_code"]
+                    data_row["姓名"] = prize_order_dict["real_name"]
+                    data_row["手机号"] = prize_order_dict["telephone"]
+                    data_row["省份"] = prize_order_dict["province"]
+                    data_row["城市"] = prize_order_dict["city"]
+                    data_row["区县"] = prize_order_dict["county"]
+                    data_row["街道"] = prize_order_dict["street"]
+                    data_row["收货地址"] = prize_order_dict["address"]
+                    data_row["物流单号"] = prize_order_dict["express_no"]
+                    data_row["物流公司"] = prize_order_dict["express_company"]
+                    if str(prize_order_dict["deliver_date"]) == "1900-01-01 00:00:00":
+                        data_row["发货时间"] = ""
+                    else:
+                        data_row["发货时间"] = str(prize_order_dict["deliver_date"])
+                    data_row["订单状态"] = frame_base_model.get_order_status_name(prize_order_dict["order_status"])
+                    data_row["奖品价值"] = str(prize_roster_dict["prize_price"])
+                    data_row["奖品规格"] = prize_roster_dict["sku_name"]
+                    data_row["备注"] = prize_order_dict["seller_remark"]
+                    result_list.append(data_row)
+        return result_list
+
+
+class PrizeRosterExportHandler(ClientBaseHandler):
+    """
+    :description: 导出用户中奖记录列表
+    """
+    def get_async(self):
+        """
+        :description: 导出用户中奖记录列表
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param module_id：活动模块标识
+        :param user_id：用户标识
+        :param open_id：open_id
+        :param nick_name：用户昵称
+        :param order_no：订单号
+        :param goods_type：物品类型（1虚拟2实物）
+        :param prize_type：奖品类型(1现货2优惠券3红包4参与奖5预售)
+        :param logistics_status：物流状态（0未发货1已发货2不予发货）
+        :param prize_status：奖品状态（0未下单（未领取）1已下单（已领取）2已回购10已隐藏（删除）11无需发货）
+        :param pay_status：支付状态(0未支付1已支付2已退款3处理中)
+        :param page_size：页大小
+        :param page_index：页索引
+        :param create_date_start：开始时间
+        :param create_date_end：结束时间
+        :return 
+        :last_editors: HuangJianYi
+        """
+        app_id =self.get_app_id()
+        act_id = self.get_act_id()
+        module_id = int(self.get_param("module_id", 0))
+        order_no = self.get_param("order_no")
+        user_id = self.get_user_id()
+        user_nick = self.get_param("nick_name")
+        user_open_id = self.get_param("user_open_id")
+        goods_type = int(self.get_param("goods_type", -1))
+        prize_type = int(self.get_param("prize_type", -1))
+        logistics_status = int(self.get_param("logistics_status", -1))
+        prize_status = int(self.get_param("prize_status", -1))
+        pay_status = int(self.get_param("pay_status", -1))
+        create_date_start = self.get_param("create_date_start")
+        create_date_end = self.get_param("create_date_end")
+        page_index = int(self.get_param("page_index", 0))
+        page_size = int(self.get_param("page_size", 500))
+
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_success("")
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        condition = invoke_result_data.data["condition"] if invoke_result_data.data.__contains__("condition") else ""
+        params = invoke_result_data.data["params"] if invoke_result_data.data.__contains__("params") else []
+        order_by = invoke_result_data.data["order_by"] if invoke_result_data.data.__contains__("order_by") else "create_date desc"
+        field = invoke_result_data.data["field"] if invoke_result_data.data.__contains__("field") else "*"
+        operate_title = invoke_result_data.data["operate_title"] if invoke_result_data.data.__contains__("operate_title") else "中奖记录列表"
+
+        order_base_model = OrderBaseModel(context=self)
+        prize_roster_list_dict = []
+        if page_size <= 500:
+            prize_roster_list_dict = order_base_model.get_prize_roster_list(app_id, act_id, module_id, user_id, user_open_id, user_nick, order_no, goods_type, prize_type, logistics_status, prize_status, pay_status, page_size, page_index, create_date_start, create_date_end, order_by=order_by, field=field, condition=condition, params=params, is_cache=False, page_count_mode='none')
+        else:
+            max_page_size = 500
+            repeat_count = page_size // max_page_size  # 循环次数
+            begin_page_index = page_index * repeat_count  # 开始页码
+            for i in range(repeat_count):
+                list_dict = order_base_model.get_prize_roster_list(app_id, act_id, module_id, user_id, user_open_id, user_nick, order_no, goods_type, prize_type, logistics_status, prize_status, pay_status, max_page_size, begin_page_index + i, create_date_start, create_date_end, order_by=order_by, field=field, condition=condition, params=params, is_cache=False, page_count_mode='none')
+                if len(list_dict) <= 0:
+                    break
+                prize_roster_list_dict.extend(list_dict)
+        ref_params = {}
+        result_data = self.business_process_executed(prize_roster_list_dict, ref_params)
+        resource_path = OSS2Helper.export_excel(result_data)
+        self.create_operation_log(operation_type=OperationType.export.value, model_name="prize_roster_tb", title=operate_title)
+        return self.response_json_success(resource_path)
+
+    def business_process_executed(self, result_data, ref_params):
+        """
+        :description: 执行后事件
+        :param result_data:result_data
+        :param ref_params: 关联参数
+        :return:
+        :last_editors: HuangJianYi
+        """
+        result_list = []
+        for prize_roster_dict in result_data:
+            data_row = {}
+            data_row["行为编号"] = prize_roster_dict["id"]
+            data_row["小程序订单号"] = prize_roster_dict["order_no"]
+            data_row["淘宝子订单号"] = prize_roster_dict["sub_pay_order_no"]
+            data_row["淘宝名"] = prize_roster_dict["user_nick"]
+            data_row["openid"] = prize_roster_dict["open_id"]
+            data_row["模块名称"] = prize_roster_dict["module_name"]
+            data_row["奖品名称"] = prize_roster_dict["prize_name"]
+            data_row["奖品价值"] = str(prize_roster_dict["prize_price"])
+            data_row["奖品规格"] = prize_roster_dict["sku_name"]
+            data_row["商家编码"] = prize_roster_dict["goods_code"]
+            data_row["获得时间"] = prize_roster_dict["create_date"]
+            if prize_roster_dict["order_no"] == "":
+                data_row["状态"] = "未下单"
+            else:
+                data_row["状态"] = "已下单"
+            result_list.append(data_row)
+        return result_list
+
+
+class TaoPayOrderExportHandler(ClientBaseHandler):
+    """
+    :description: 淘宝支付订单批量导出
+    """
+    def get_async(self):
+        """
+        :description: 淘宝支付订单批量导出
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param user_code：用户标识
+        :param user_open_id：open_id
+        :param nick_name：用户昵称
+        :param pay_date_start：订单支付时间开始
+        :param pay_date_end：订单支付时间结束
+        :param main_pay_order_no：淘宝主订单号
+        :param sub_pay_order_no：淘宝子订单号
+        :param page_size：页大小
+        :param page_index：页索引
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        user_open_id = self.get_param("user_open_id")
+        user_nick = self.get_param("nick_name")
+        pay_date_start = self.get_param("pay_date_start")
+        pay_date_end = self.get_param("pay_date_end")
+        main_pay_order_no = self.get_param("main_pay_order_no")
+        sub_pay_order_no = self.get_param("sub_pay_order_no")
+        page_index = int(self.get_param("page_index", 0))
+        page_size = int(self.get_param("page_size", 500))
+
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_success("")
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        condition = invoke_result_data.data["condition"] if invoke_result_data.data.__contains__("condition") else ""
+        params = invoke_result_data.data["params"] if invoke_result_data.data.__contains__("params") else []
+        order_by = invoke_result_data.data["order_by"] if invoke_result_data.data.__contains__("order_by") else "create_date desc"
+        field = invoke_result_data.data["field"] if invoke_result_data.data.__contains__("field") else "*"
+        operate_title = invoke_result_data.data["operate_title"] if invoke_result_data.data.__contains__("operate_title") else "支付订单列表"
+
+        if main_pay_order_no:
+            condition += " and " if condition else ""
+            condition += "main_pay_order_no=%s"
+            params.append(main_pay_order_no)
+        if sub_pay_order_no:
+            condition += " and " if condition else ""
+            condition += "sub_pay_order_no=%s"
+            params.append(sub_pay_order_no)
+
+        order_base_model = OrderBaseModel(context=self)
+        tao_pay_order_list_dict = []
+        if page_size <= 500:
+            tao_pay_order_list_dict = order_base_model.get_tao_pay_order_list(app_id, act_id, user_id, user_open_id, user_nick, pay_date_start, pay_date_end, page_size, page_index, field=field, order_by=order_by, condition=condition, params=params).data
+        else:
+            max_page_size = 500
+            repeat_count = page_size // max_page_size  # 循环次数
+            begin_page_index = page_index * repeat_count  # 开始页码
+            for i in range(repeat_count):
+                list_dict = order_base_model.get_tao_pay_order_list(app_id, act_id, user_id, user_open_id, user_nick, pay_date_start, pay_date_end, max_page_size, begin_page_index + i, field=field, order_by=order_by, condition=condition, params=params).data
+                if len(list_dict) <= 0:
+                    break
+                tao_pay_order_list_dict.extend(list_dict)
+
+        ref_params = {}
+        result_data = self.business_process_executed(tao_pay_order_list_dict, ref_params)
+        resource_path = OSS2Helper.export_excel(result_data)
+        self.create_operation_log(operation_type=OperationType.export.value, model_name="tao_pay_order_tb", title=operate_title)
+        return self.response_json_success(resource_path)
+
+    def business_process_executed(self, result_data, ref_params):
+        """
+        :description: 执行后事件
+        :param result_data:result_data
+        :param ref_params: 关联参数
+        :return:
+        :last_editors: HuangJianYi
+        """
+        result_list = []
+        for tao_pay_order_dict in result_data:
+            data_row = {}
+            data_row["淘宝主订单号"] = tao_pay_order_dict["main_pay_order_no"]
+            data_row["淘宝子订单号"] = tao_pay_order_dict["sub_pay_order_no"]
+            data_row["淘宝名"] = tao_pay_order_dict["user_nick"]
+            data_row["openid"] = tao_pay_order_dict["open_id"]
+            data_row["商家编码"] = tao_pay_order_dict["goods_code"]
+            data_row["商品名称"] = tao_pay_order_dict["goods_name"]
+            data_row["购买数量"] = tao_pay_order_dict["buy_num"]
+            data_row["支付金额"] = tao_pay_order_dict["pay_price"]
+            data_row["支付时间"] = TimeHelper.datetime_to_format_time(tao_pay_order_dict["pay_date"])
+            result_list.append(data_row)
+        return result_list
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/handlers/server/price_s.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/handlers/server/price_s.py`

 * *Ordering differences only*

 * *Files 8% similar despite different names*

```diff
@@ -1,180 +1,180 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-08-02 14:25:02
-@LastEditTime: 2023-01-12 09:48:32
-@LastEditors: HuangJianYi
-@Description: 价格档位模块
-"""
-from seven_cloudapp_frame.models.price_base_model import *
-from seven_cloudapp_frame.handlers.frame_base import *
-from seven_cloudapp_frame.models.enum import *
-from seven_cloudapp_frame.models.db_models.price.price_gear_model import *
-
-
-class SavePriceGearHandler(ClientBaseHandler):
-    """
-    :description: 保存价格档位信息
-    """
-    @filter_check_params("price")
-    def get_async(self):
-        """
-        :description: 保存价格档位
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param price_gear_id：价格档位标识
-        :param relation_type：关联类型：1商品skuid关联2商品id关联
-        :param price_gear_name：档位名称
-        :param price_gear_pic：档位图片
-        :param price：价格
-        :param goods_id：商品ID
-        :param sku_id：sku_id
-        :param remark：备注
-        :param sort_index：排序
-        :return:
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        price_gear_id = int(self.get_param("price_gear_id", 0))
-        relation_type = int(self.get_param("relation_type", 1))
-        price = self.get_param("price")
-        price_gear_name = self.get_param("price_gear_name")
-        price_gear_pic = self.get_param("price_gear_pic")
-        goods_id = self.get_param("goods_id")
-        sku_id = self.get_param("sku_id")
-        remark = self.get_param("remark")
-        sort_index = int(self.get_param("sort_index", 0))
-
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        title_prefix = invoke_result_data.data["title_prefix"] if invoke_result_data.data.__contains__("title_prefix") else "价格档位"
-        price_base_model = PriceBaseModel(context=self)
-        invoke_result_data = price_base_model.save_price_gear(app_id, act_id, price_gear_id, relation_type, price_gear_name, price_gear_pic, price, goods_id, sku_id, remark, sort_index)
-        if invoke_result_data.success ==False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        if invoke_result_data.data["is_add"] == True:
-            # 记录日志
-            self.create_operation_log(operation_type=OperationType.add.value, model_name=invoke_result_data.data["new"].__str__(), old_detail=None, update_detail=invoke_result_data.data["new"], title= title_prefix + ";" + price_gear_name)
-        else:
-            self.create_operation_log(operation_type=OperationType.update.value, model_name=invoke_result_data.data["new"].__str__(), old_detail=invoke_result_data.data["old"], update_detail=invoke_result_data.data["new"], title= title_prefix + ";" + price_gear_name)
-        ref_params = {}
-        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success(invoke_result_data.data["new"].id)
-
-
-class PriceGearListHandler(ClientBaseHandler):
-    """
-    :description: 获取价格档位列表
-    """
-    def get_async(self):
-        """
-        :description: 获取价格档位列表
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param page_index：页索引
-        :param page_size：页大小
-        :param is_del：是否回收站1是0否
-        :return: list
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        page_index = self.get_param_int("page_index", 0)
-        page_size = self.get_param_int("page_size", 20)
-        is_del = self.get_param_int("is_del", 0)
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_success({"data": []})
-        if not invoke_result_data.data:
-            invoke_result_data.data = {}
-        order_by = invoke_result_data.data["order_by"] if invoke_result_data.data.__contains__("order_by") else "sort_index desc"
-        page_list, total = PriceBaseModel(context=self).get_price_gear_list(app_id, act_id, page_size, page_index, order_by, is_del=is_del, is_cache=False)
-        page_info = PageInfo(page_index, page_size, total, self.business_process_executed(page_list, ref_params={}))
-        return self.response_json_success(page_info)
-
-
-class DeletePriceGearHandler(ClientBaseHandler):
-    """
-    :description: 删除档位
-    """
-    @filter_check_params("price_gear_id")
-    def get_async(self):
-        """
-        :description: 删除档位
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param price_gear_id：价格档位标识
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        price_gear_id = int(self.get_param("price_gear_id", 0))
-
-        price_base_model = PriceBaseModel(context=self)
-        invoke_result_data = price_base_model.update_price_gear_status(app_id, act_id, price_gear_id, 1)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        title_prefix = invoke_result_data.data["title_prefix"] if invoke_result_data.data.__contains__("title_prefix") else "价格档位"
-        self.create_operation_log(operation_type=OperationType.delete.value, model_name="price_gear_tb", title= title_prefix + ";" + invoke_result_data.data["price_gear_name"])
-        return self.response_json_success()
-
-
-class ReviewPriceGearHandler(ClientBaseHandler):
-    """
-    :description: 恢复价格档位
-    """
-    @filter_check_params("price_gear_id")
-    def get_async(self):
-        """
-        :description: 恢复价格档位
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param price_gear_id：价格档位标识
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        price_gear_id = int(self.get_param("price_gear_id", 0))
-
-        price_base_model = PriceBaseModel(context=self)
-        invoke_result_data = price_base_model.update_price_gear_status(app_id, act_id, price_gear_id, 0)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        title_prefix = invoke_result_data.data["title_prefix"] if invoke_result_data.data.__contains__("title_prefix") else "价格档位"
-        self.create_operation_log(operation_type=OperationType.review.value, model_name="price_gear_tb", title= title_prefix + ";" + invoke_result_data.data["price_gear_name"])
-        return self.response_json_success()
-
-
-class CheckPriceGearHandler(ClientBaseHandler):
-    """
-    :description: 验证价格档位
-    """
-    @filter_check_params("goods_id")
-    def get_async(self):
-        """
-        :description: 验证价格档位
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param price_gear_id：价格档位标识
-        :param goods_id：商品ID
-        :param sku_id：sku_id
-        :return: response_json_success
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        price_gear_id = int(self.get_param("price_gear_id", 0))
-        goods_id = self.get_param("goods_id")
-        sku_id = self.get_param("sku_id")
-
-        price_base_model = PriceBaseModel(context=self)
-        invoke_result_data = price_base_model.check_price_gear(app_id, act_id, price_gear_id, goods_id, sku_id)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success()
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-08-02 14:25:02
+@LastEditTime: 2023-01-12 09:48:32
+@LastEditors: HuangJianYi
+@Description: 价格档位模块
+"""
+from seven_cloudapp_frame.models.price_base_model import *
+from seven_cloudapp_frame.handlers.frame_base import *
+from seven_cloudapp_frame.models.enum import *
+from seven_cloudapp_frame.models.db_models.price.price_gear_model import *
+
+
+class SavePriceGearHandler(ClientBaseHandler):
+    """
+    :description: 保存价格档位信息
+    """
+    @filter_check_params("price")
+    def get_async(self):
+        """
+        :description: 保存价格档位
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param price_gear_id：价格档位标识
+        :param relation_type：关联类型：1商品skuid关联2商品id关联
+        :param price_gear_name：档位名称
+        :param price_gear_pic：档位图片
+        :param price：价格
+        :param goods_id：商品ID
+        :param sku_id：sku_id
+        :param remark：备注
+        :param sort_index：排序
+        :return:
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        price_gear_id = int(self.get_param("price_gear_id", 0))
+        relation_type = int(self.get_param("relation_type", 1))
+        price = self.get_param("price")
+        price_gear_name = self.get_param("price_gear_name")
+        price_gear_pic = self.get_param("price_gear_pic")
+        goods_id = self.get_param("goods_id")
+        sku_id = self.get_param("sku_id")
+        remark = self.get_param("remark")
+        sort_index = int(self.get_param("sort_index", 0))
+
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        title_prefix = invoke_result_data.data["title_prefix"] if invoke_result_data.data.__contains__("title_prefix") else "价格档位"
+        price_base_model = PriceBaseModel(context=self)
+        invoke_result_data = price_base_model.save_price_gear(app_id, act_id, price_gear_id, relation_type, price_gear_name, price_gear_pic, price, goods_id, sku_id, remark, sort_index)
+        if invoke_result_data.success ==False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if invoke_result_data.data["is_add"] == True:
+            # 记录日志
+            self.create_operation_log(operation_type=OperationType.add.value, model_name=invoke_result_data.data["new"].__str__(), old_detail=None, update_detail=invoke_result_data.data["new"], title= title_prefix + ";" + price_gear_name)
+        else:
+            self.create_operation_log(operation_type=OperationType.update.value, model_name=invoke_result_data.data["new"].__str__(), old_detail=invoke_result_data.data["old"], update_detail=invoke_result_data.data["new"], title= title_prefix + ";" + price_gear_name)
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success(invoke_result_data.data["new"].id)
+
+
+class PriceGearListHandler(ClientBaseHandler):
+    """
+    :description: 获取价格档位列表
+    """
+    def get_async(self):
+        """
+        :description: 获取价格档位列表
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param page_index：页索引
+        :param page_size：页大小
+        :param is_del：是否回收站1是0否
+        :return: list
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        page_index = self.get_param_int("page_index", 0)
+        page_size = self.get_param_int("page_size", 20)
+        is_del = self.get_param_int("is_del", 0)
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_success({"data": []})
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        order_by = invoke_result_data.data["order_by"] if invoke_result_data.data.__contains__("order_by") else "sort_index desc"
+        page_list, total = PriceBaseModel(context=self).get_price_gear_list(app_id, act_id, page_size, page_index, order_by, is_del=is_del, is_cache=False)
+        page_info = PageInfo(page_index, page_size, total, self.business_process_executed(page_list, ref_params={}))
+        return self.response_json_success(page_info)
+
+
+class DeletePriceGearHandler(ClientBaseHandler):
+    """
+    :description: 删除档位
+    """
+    @filter_check_params("price_gear_id")
+    def get_async(self):
+        """
+        :description: 删除档位
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param price_gear_id：价格档位标识
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        price_gear_id = int(self.get_param("price_gear_id", 0))
+
+        price_base_model = PriceBaseModel(context=self)
+        invoke_result_data = price_base_model.update_price_gear_status(app_id, act_id, price_gear_id, 1)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        title_prefix = invoke_result_data.data["title_prefix"] if invoke_result_data.data.__contains__("title_prefix") else "价格档位"
+        self.create_operation_log(operation_type=OperationType.delete.value, model_name="price_gear_tb", title= title_prefix + ";" + invoke_result_data.data["price_gear_name"])
+        return self.response_json_success()
+
+
+class ReviewPriceGearHandler(ClientBaseHandler):
+    """
+    :description: 恢复价格档位
+    """
+    @filter_check_params("price_gear_id")
+    def get_async(self):
+        """
+        :description: 恢复价格档位
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param price_gear_id：价格档位标识
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        price_gear_id = int(self.get_param("price_gear_id", 0))
+
+        price_base_model = PriceBaseModel(context=self)
+        invoke_result_data = price_base_model.update_price_gear_status(app_id, act_id, price_gear_id, 0)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        title_prefix = invoke_result_data.data["title_prefix"] if invoke_result_data.data.__contains__("title_prefix") else "价格档位"
+        self.create_operation_log(operation_type=OperationType.review.value, model_name="price_gear_tb", title= title_prefix + ";" + invoke_result_data.data["price_gear_name"])
+        return self.response_json_success()
+
+
+class CheckPriceGearHandler(ClientBaseHandler):
+    """
+    :description: 验证价格档位
+    """
+    @filter_check_params("goods_id")
+    def get_async(self):
+        """
+        :description: 验证价格档位
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param price_gear_id：价格档位标识
+        :param goods_id：商品ID
+        :param sku_id：sku_id
+        :return: response_json_success
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        price_gear_id = int(self.get_param("price_gear_id", 0))
+        goods_id = self.get_param("goods_id")
+        sku_id = self.get_param("sku_id")
+
+        price_base_model = PriceBaseModel(context=self)
+        invoke_result_data = price_base_model.check_price_gear(app_id, act_id, price_gear_id, goods_id, sku_id)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success()
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/handlers/server/prize_s.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/handlers/server/prize_s.py`

 * *Ordering differences only*

 * *Files 12% similar despite different names*

```diff
@@ -1,368 +1,368 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-08-03 15:42:53
-@LastEditTime: 2023-05-09 09:37:11
-@LastEditors: HuangJianYi
-@Description: 奖品模块
-"""
-from seven_cloudapp_frame.models.enum import *
-from seven_cloudapp_frame.handlers.frame_base import *
-from seven_cloudapp_frame.models.act_base_model import *
-from seven_cloudapp_frame.models.prize_base_model import *
-from seven_cloudapp_frame.models.seven_model import PageInfo
-from seven_cloudapp_frame.libs.customize.oss2_helper import *
-
-
-class SaveActPrizeHandler(ClientBaseHandler):
-    """
-    :description: 保存活动奖品
-    """
-    def post_async(self):
-        """
-        :description: 保存活动奖品
-        :param app_id：应用标识
-        :param act_id: 活动标识
-        :param module_id: 活动模块标识
-        :param prize_id: 奖品标识
-        :param prize_name: 奖品名称
-        :param prize_title: 奖品子标题
-        :param prize_pic: 奖品图
-        :param prize_detail_json: 奖品详情图（json）
-        :param goods_id: 商品ID
-        :param goods_code: 商品编码
-        :param goods_code_list: 多个sku商品编码
-        :param goods_type: 物品类型（1虚拟2实物）
-        :param prize_type: 奖品类型(1现货2优惠券3红包4参与奖、谢谢参与5预售)
-        :param prize_price: 奖品价值
-        :param probability: 奖品权重
-        :param chance: 概率
-        :param prize_limit: 中奖限制数
-        :param is_prize_notice: 是否显示跑马灯(1是0否)
-        :param prize_total: 奖品总数
-        :param is_surplus: 是否显示奖品库存（1显示0-不显示）
-        :param lottery_type: 出奖类型（1概率出奖 2强制概率）
-        :param tag_name: 标签名称(奖项名称)
-        :param tag_id: 标签ID(奖项标识)
-        :param is_sku: 是否有SKU
-        :param sku_json: sku详情json 注意：所有的参数只能是整形或字符串，如果是对象的参数必须先序列化
-        :param sort_index: 排序
-        :param is_release: 是否发布（1是0否）
-        :param ascription_type: 奖品归属类型（0-活动奖品1-任务奖品）
-        :param i1: i1
-        :param i2: i2
-        :param i3: i3
-        :param i4: i4
-        :param i5: i5
-        :param s1: s1
-        :param s2: s2
-        :param s3: s3
-        :param s4: s4
-        :param s5: s5
-        :param d1: d1
-        :param d2: d2
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        module_id = int(self.get_param("module_id", 0))
-        prize_id = int(self.get_param("prize_id", 0))
-        prize_name = self.get_param("prize_name")
-        prize_title = self.get_param("prize_title")
-        prize_pic = self.get_param("prize_pic")
-        prize_detail_json = self.get_param("prize_detail_json")
-        goods_id = self.get_param("goods_id")
-        goods_code = self.get_param("goods_code")
-        goods_code_list = self.get_param("goods_code_list")
-        goods_type = int(self.get_param("goods_type", 0))
-        prize_type = int(self.get_param("prize_type", 0))
-        prize_price = self.get_param("prize_price")
-        probability = self.get_param("probability")
-        chance = self.get_param("chance")
-        prize_limit = int(self.get_param("prize_limit", 0))
-        is_prize_notice = int(self.get_param("is_prize_notice", 0))
-        prize_total = int(self.get_param("prize_total", 0))
-        is_surplus = int(self.get_param("is_surplus", 0))
-        lottery_type = int(self.get_param("lottery_type", 0))
-        tag_name = self.get_param("tag_name")
-        tag_id = int(self.get_param("tag_id", 0))
-        is_sku = int(self.get_param("is_sku", 0))
-        sku_json = self.get_param("sku_json")
-        ascription_type = int(self.get_param("ascription_type", 0))
-        sort_index = int(self.get_param("sort_index", 0))
-        is_release = int(self.get_param("is_release", 0))
-        i1 = int(self.get_param("i1", 0))
-        i2 = int(self.get_param("i2", 0))
-        i3 = int(self.get_param("i3", 0))
-        i4 = int(self.get_param("i4", 0))
-        i5 = int(self.get_param("i5", 0))
-        s1 = self.get_param("s1")
-        s2 = self.get_param("s2")
-        s3 = self.get_param("s3")
-        s4 = self.get_param("s4")
-        s5 = self.get_param("s5")
-        d1 = self.get_param("d1", "1900-01-01 00:00:00")
-        d2 = self.get_param("d2", "1900-01-01 00:00:00")
-
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        if not invoke_result_data.data:
-            invoke_result_data.data = {}
-        prize_total = invoke_result_data.data["prize_total"] if invoke_result_data.data.__contains__("prize_total") else prize_total
-        title_prefix = invoke_result_data.data["title_prefix"] if invoke_result_data.data.__contains__("title_prefix") else "奖品"
-        prize_base_model = PrizeBaseModel(context=self)
-        invoke_result_data = prize_base_model.save_act_prize(app_id, act_id, module_id, prize_id, prize_name, prize_title, prize_pic, prize_detail_json, goods_id, goods_code, goods_code_list, goods_type, prize_type, prize_price, probability, chance, prize_limit, is_prize_notice, prize_total, is_surplus, lottery_type, tag_name, tag_id, is_sku, sku_json, sort_index, is_release, ascription_type, i1, i2, i3, i4, i5, s1, s2, s3, s4, s5, d1, d2)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        if invoke_result_data.data["is_add"] == True:
-            # 记录日志
-            self.create_operation_log(operation_type=OperationType.add.value, model_name=invoke_result_data.data["new"].__str__(), old_detail=None, update_detail=invoke_result_data.data["new"], title= title_prefix + ";" + prize_name)
-        else:
-            self.create_operation_log(operation_type=OperationType.update.value, model_name=invoke_result_data.data["new"].__str__(), old_detail=invoke_result_data.data["old"], update_detail=invoke_result_data.data["new"], title= title_prefix + ";" + prize_name)
-        ref_params = {}
-        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success(invoke_result_data.data["new"].id)
-
-
-class ActPrizeListHandler(ClientBaseHandler):
-    """
-    :description: 活动奖品列表
-    """
-    def get_async(self):
-        """
-        :description: 活动奖品列表
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param module_id：活动模块标识
-        :param prize_name：奖品名称
-        :param is_del：是否回收站1是0否
-        :param ascription_type：归属类型
-        :param page_index：页索引
-        :param page_size：页大小
-        :return: PageInfo
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        module_id = self.get_param_int("module_id", 0)
-        prize_name = self.get_param("prize_name")
-        is_del = self.get_param_int("is_del", 0)
-        ascription_type = self.get_param_int("ascription_type", -1)
-        page_index = self.get_param_int("page_index", 0)
-        page_size = self.get_param_int("page_size", 20)
-
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_success({"data": []})
-        if not invoke_result_data.data:
-            invoke_result_data.data = {}
-        condition = invoke_result_data.data["condition"] if invoke_result_data.data.__contains__("condition") else ""
-        params = invoke_result_data.data["params"] if invoke_result_data.data.__contains__("params") else []
-        order_by = invoke_result_data.data["order_by"] if invoke_result_data.data.__contains__("order_by") else "sort_index desc,id asc"
-        field = invoke_result_data.data["field"] if invoke_result_data.data.__contains__("field") else "*"
-        if not app_id or not act_id:
-            return self.response_json_success({"data": []})
-        prize_base_model = PrizeBaseModel(context=self)
-        page_list, total = prize_base_model.get_act_prize_list(app_id, act_id, module_id, prize_name, ascription_type, is_del, page_size, page_index, order_by=order_by, condition=condition, params=params, field=field, is_cache=False)
-        for page in page_list:
-            if page.__contains__("prize_detail_json"):
-                page["prize_detail_json"] = SevenHelper.json_loads(page["prize_detail_json"]) if page["prize_detail_json"] else []
-            if page.__contains__("sku_json"):
-                page["sku_json"] = SevenHelper.json_loads(page["sku_json"]) if page["sku_json"] else []
-        ref_params = {}
-        page_info = PageInfo(page_index, page_size, total, self.business_process_executed(page_list, ref_params))
-        return self.response_json_success(page_info)
-
-
-class DeleteActPrizeHandler(ClientBaseHandler):
-    """
-    :description: 删除活动奖品
-    """
-    @filter_check_params("prize_id")
-    def get_async(self):
-        """
-        :description: 删除活动奖品
-        :param app_id：应用标识
-        :param prize_id：奖品标识
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        prize_id = int(self.get_param("prize_id", 0))
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        title_prefix = invoke_result_data.data["title_prefix"] if invoke_result_data.data.__contains__("title_prefix") else "奖品"
-        prize_base_model = PrizeBaseModel(context=self)
-        invoke_result_data = prize_base_model.update_act_prize_status(app_id, prize_id, 1)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        self.create_operation_log(operation_type=OperationType.delete.value, model_name="act_prize_tb", title= title_prefix + ";" + invoke_result_data.data["prize_name"])
-        ref_params = {}
-        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success()
-
-
-class ReviewActPrizeHandler(ClientBaseHandler):
-    """
-    :description: 还原活动奖品
-    """
-    @filter_check_params("prize_id")
-    def get_async(self):
-        """
-        :description: 还原活动奖品
-        :param app_id：应用标识
-        :param prize_id：奖品标识
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        prize_id = int(self.get_param("prize_id", 0))
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        title_prefix = invoke_result_data.data["title_prefix"] if invoke_result_data.data.__contains__("title_prefix") else "奖品"
-        prize_base_model = PrizeBaseModel(context=self)
-        invoke_result_data = prize_base_model.update_act_prize_status(app_id, prize_id, 0)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        self.create_operation_log(operation_type=OperationType.review.value, model_name="act_prize_tb", title= title_prefix + ";" + invoke_result_data.data["prize_name"])
-        ref_params = {}
-        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success()
-
-
-class ReleaseActPrizeHandler(ClientBaseHandler):
-    """
-    :description: 上下架活动奖品
-    """
-    @filter_check_params("prize_id")
-    def get_async(self):
-        """
-        :description: 上下架活动奖品
-        :param app_id：应用标识
-        :param prize_id 奖品标识
-        :param is_release: 是否发布 1-是 0-否
-        :return:
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        prize_id = int(self.get_param("prize_id", 0))
-        is_release = int(self.get_param("is_release", 0))
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        title_prefix = invoke_result_data.data["title_prefix"] if invoke_result_data.data.__contains__("title_prefix") else "奖品"
-        prize_base_model = PrizeBaseModel(context=self)
-        invoke_result_data = prize_base_model.release_act_prize(app_id, prize_id, is_release)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        operation_type = OperationType.release.value if is_release == 1 else OperationType.un_release.value
-        self.create_operation_log(operation_type=operation_type, model_name="act_prize_tb", title= title_prefix + ";" + invoke_result_data.data["prize_name"])
-        ref_params = {}
-        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success()
-
-
-class ActPrizeExportHandler(ClientBaseHandler):
-    """
-    :description: 导出活动奖品列表
-    """
-    def get_async(self):
-        """
-        :description: 导出活动奖品列表
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param module_id：活动模块标识
-        :param prize_name：奖品名称
-        :param is_del：是否回收站1是0否
-        :param page_size：页大小
-        :param page_index：页索引
-        :return 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        module_id = int(self.get_param("module_id", 0))
-        prize_name = self.get_param("prize_name")
-        is_del = int(self.get_param("is_del", -1))
-        page_index = int(self.get_param("page_index", 0))
-        page_size = int(self.get_param("page_size", 500))
-
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_success("")
-        if not invoke_result_data.data:
-            invoke_result_data.data = {}
-        condition = invoke_result_data.data["condition"] if invoke_result_data.data.__contains__("condition") else ""
-        params = invoke_result_data.data["params"] if invoke_result_data.data.__contains__("params") else []
-        order_by = invoke_result_data.data["order_by"] if invoke_result_data.data.__contains__("order_by") else "create_date desc"
-        field = invoke_result_data.data["field"] if invoke_result_data.data.__contains__("field") else "*"
-        operate_title = invoke_result_data.data["operate_title"] if invoke_result_data.data.__contains__("operate_title") else "奖品列表"
-
-
-        prize_base_model = PrizeBaseModel(context=self)
-        act_prize_list_dict = []
-        if page_size <= 500:
-            act_prize_list_dict = prize_base_model.get_act_prize_list(app_id, act_id, module_id, prize_name, 0, is_del, page_size, page_index, order_by=order_by, condition=condition, params=params, field=field, is_cache=False).data
-        else:
-            max_page_size = 100
-            repeat_count = page_size // max_page_size  # 循环次数
-            begin_page_index = page_index * repeat_count  # 开始页码
-            for i in range(repeat_count):
-                list_dict = prize_base_model.get_act_prize_list(app_id, act_id, module_id, prize_name, 0, is_del, max_page_size, begin_page_index + i, order_by=order_by, condition=condition, params=params, field=field, is_cache=False).data
-                if len(list_dict) <= 0:
-                    break
-                act_prize_list_dict.extend(list_dict)
-        ref_params = {}
-        result_data = self.business_process_executed(act_prize_list_dict, ref_params)
-        resource_path = OSS2Helper.export_excel(result_data)
-        self.create_operation_log(operation_type=OperationType.export.value, model_name="act_prize_tb", title=operate_title)
-        return self.response_json_success(resource_path)
-
-    def business_process_executed(self, result_data, ref_params):
-        """
-        :description: 执行后事件
-        :param result_data:result_data
-        :param ref_params: 关联参数
-        :return:
-        :last_editors: HuangJianYi
-        """
-        result_list = []
-        for act_prize_dict in result_data:
-            data_row = {}
-            data_row["奖品名称"] = act_prize_dict["prize_name"]
-            data_row["奖品子标题"] = act_prize_dict["prize_title"]
-            data_row["奖品图"] = act_prize_dict["prize_pic"]
-            data_row["商品ID"] = act_prize_dict["goods_id"]
-            data_row["商家编码"] = act_prize_dict["goods_code"]
-            data_row["奖品类型"] = act_prize_dict["prize_type"]
-            data_row["奖品价值"] = str(act_prize_dict["prize_price"])
-            data_row["奖品库存"] = act_prize_dict["surplus"]
-            data_row["奖品总库存"] = act_prize_dict["prize_total"]
-            if act_prize_dict["prize_type"] == 1:
-                data_row["奖品类型"] = "现货"
-            elif act_prize_dict["prize_type"] == 2:
-                data_row["奖品类型"] = "优惠券"
-            elif act_prize_dict["prize_type"] == 3:
-                data_row["奖品类型"] = "红包"
-            elif act_prize_dict["prize_type"] == 4:
-                data_row["奖品类型"] = "参与奖"
-            else:
-                data_row["奖品类型"] = "预售"
-            data_row["创建时间"] = TimeHelper.datetime_to_format_time(act_prize_dict["create_date"])
-            data_row["是否发布"] = "未发布"
-            if act_prize_dict["is_release"] == 1:
-                data_row["是否发布"] = "已发布"
-            result_list.append(data_row)
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-08-03 15:42:53
+@LastEditTime: 2023-05-09 09:37:11
+@LastEditors: HuangJianYi
+@Description: 奖品模块
+"""
+from seven_cloudapp_frame.models.enum import *
+from seven_cloudapp_frame.handlers.frame_base import *
+from seven_cloudapp_frame.models.act_base_model import *
+from seven_cloudapp_frame.models.prize_base_model import *
+from seven_cloudapp_frame.models.seven_model import PageInfo
+from seven_cloudapp_frame.libs.customize.oss2_helper import *
+
+
+class SaveActPrizeHandler(ClientBaseHandler):
+    """
+    :description: 保存活动奖品
+    """
+    def post_async(self):
+        """
+        :description: 保存活动奖品
+        :param app_id：应用标识
+        :param act_id: 活动标识
+        :param module_id: 活动模块标识
+        :param prize_id: 奖品标识
+        :param prize_name: 奖品名称
+        :param prize_title: 奖品子标题
+        :param prize_pic: 奖品图
+        :param prize_detail_json: 奖品详情图（json）
+        :param goods_id: 商品ID
+        :param goods_code: 商品编码
+        :param goods_code_list: 多个sku商品编码
+        :param goods_type: 物品类型（1虚拟2实物）
+        :param prize_type: 奖品类型(1现货2优惠券3红包4参与奖、谢谢参与5预售)
+        :param prize_price: 奖品价值
+        :param probability: 奖品权重
+        :param chance: 概率
+        :param prize_limit: 中奖限制数
+        :param is_prize_notice: 是否显示跑马灯(1是0否)
+        :param prize_total: 奖品总数
+        :param is_surplus: 是否显示奖品库存（1显示0-不显示）
+        :param lottery_type: 出奖类型（1概率出奖 2强制概率）
+        :param tag_name: 标签名称(奖项名称)
+        :param tag_id: 标签ID(奖项标识)
+        :param is_sku: 是否有SKU
+        :param sku_json: sku详情json 注意：所有的参数只能是整形或字符串，如果是对象的参数必须先序列化
+        :param sort_index: 排序
+        :param is_release: 是否发布（1是0否）
+        :param ascription_type: 奖品归属类型（0-活动奖品1-任务奖品）
+        :param i1: i1
+        :param i2: i2
+        :param i3: i3
+        :param i4: i4
+        :param i5: i5
+        :param s1: s1
+        :param s2: s2
+        :param s3: s3
+        :param s4: s4
+        :param s5: s5
+        :param d1: d1
+        :param d2: d2
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        module_id = int(self.get_param("module_id", 0))
+        prize_id = int(self.get_param("prize_id", 0))
+        prize_name = self.get_param("prize_name")
+        prize_title = self.get_param("prize_title")
+        prize_pic = self.get_param("prize_pic")
+        prize_detail_json = self.get_param("prize_detail_json")
+        goods_id = self.get_param("goods_id")
+        goods_code = self.get_param("goods_code")
+        goods_code_list = self.get_param("goods_code_list")
+        goods_type = int(self.get_param("goods_type", 0))
+        prize_type = int(self.get_param("prize_type", 0))
+        prize_price = self.get_param("prize_price")
+        probability = self.get_param("probability")
+        chance = self.get_param("chance")
+        prize_limit = int(self.get_param("prize_limit", 0))
+        is_prize_notice = int(self.get_param("is_prize_notice", 0))
+        prize_total = int(self.get_param("prize_total", 0))
+        is_surplus = int(self.get_param("is_surplus", 0))
+        lottery_type = int(self.get_param("lottery_type", 0))
+        tag_name = self.get_param("tag_name")
+        tag_id = int(self.get_param("tag_id", 0))
+        is_sku = int(self.get_param("is_sku", 0))
+        sku_json = self.get_param("sku_json")
+        ascription_type = int(self.get_param("ascription_type", 0))
+        sort_index = int(self.get_param("sort_index", 0))
+        is_release = int(self.get_param("is_release", 0))
+        i1 = int(self.get_param("i1", 0))
+        i2 = int(self.get_param("i2", 0))
+        i3 = int(self.get_param("i3", 0))
+        i4 = int(self.get_param("i4", 0))
+        i5 = int(self.get_param("i5", 0))
+        s1 = self.get_param("s1")
+        s2 = self.get_param("s2")
+        s3 = self.get_param("s3")
+        s4 = self.get_param("s4")
+        s5 = self.get_param("s5")
+        d1 = self.get_param("d1", "1900-01-01 00:00:00")
+        d2 = self.get_param("d2", "1900-01-01 00:00:00")
+
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        prize_total = invoke_result_data.data["prize_total"] if invoke_result_data.data.__contains__("prize_total") else prize_total
+        title_prefix = invoke_result_data.data["title_prefix"] if invoke_result_data.data.__contains__("title_prefix") else "奖品"
+        prize_base_model = PrizeBaseModel(context=self)
+        invoke_result_data = prize_base_model.save_act_prize(app_id, act_id, module_id, prize_id, prize_name, prize_title, prize_pic, prize_detail_json, goods_id, goods_code, goods_code_list, goods_type, prize_type, prize_price, probability, chance, prize_limit, is_prize_notice, prize_total, is_surplus, lottery_type, tag_name, tag_id, is_sku, sku_json, sort_index, is_release, ascription_type, i1, i2, i3, i4, i5, s1, s2, s3, s4, s5, d1, d2)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if invoke_result_data.data["is_add"] == True:
+            # 记录日志
+            self.create_operation_log(operation_type=OperationType.add.value, model_name=invoke_result_data.data["new"].__str__(), old_detail=None, update_detail=invoke_result_data.data["new"], title= title_prefix + ";" + prize_name)
+        else:
+            self.create_operation_log(operation_type=OperationType.update.value, model_name=invoke_result_data.data["new"].__str__(), old_detail=invoke_result_data.data["old"], update_detail=invoke_result_data.data["new"], title= title_prefix + ";" + prize_name)
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success(invoke_result_data.data["new"].id)
+
+
+class ActPrizeListHandler(ClientBaseHandler):
+    """
+    :description: 活动奖品列表
+    """
+    def get_async(self):
+        """
+        :description: 活动奖品列表
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param module_id：活动模块标识
+        :param prize_name：奖品名称
+        :param is_del：是否回收站1是0否
+        :param ascription_type：归属类型
+        :param page_index：页索引
+        :param page_size：页大小
+        :return: PageInfo
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        module_id = self.get_param_int("module_id", 0)
+        prize_name = self.get_param("prize_name")
+        is_del = self.get_param_int("is_del", 0)
+        ascription_type = self.get_param_int("ascription_type", -1)
+        page_index = self.get_param_int("page_index", 0)
+        page_size = self.get_param_int("page_size", 20)
+
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_success({"data": []})
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        condition = invoke_result_data.data["condition"] if invoke_result_data.data.__contains__("condition") else ""
+        params = invoke_result_data.data["params"] if invoke_result_data.data.__contains__("params") else []
+        order_by = invoke_result_data.data["order_by"] if invoke_result_data.data.__contains__("order_by") else "sort_index desc,id asc"
+        field = invoke_result_data.data["field"] if invoke_result_data.data.__contains__("field") else "*"
+        if not app_id or not act_id:
+            return self.response_json_success({"data": []})
+        prize_base_model = PrizeBaseModel(context=self)
+        page_list, total = prize_base_model.get_act_prize_list(app_id, act_id, module_id, prize_name, ascription_type, is_del, page_size, page_index, order_by=order_by, condition=condition, params=params, field=field, is_cache=False)
+        for page in page_list:
+            if page.__contains__("prize_detail_json"):
+                page["prize_detail_json"] = SevenHelper.json_loads(page["prize_detail_json"]) if page["prize_detail_json"] else []
+            if page.__contains__("sku_json"):
+                page["sku_json"] = SevenHelper.json_loads(page["sku_json"]) if page["sku_json"] else []
+        ref_params = {}
+        page_info = PageInfo(page_index, page_size, total, self.business_process_executed(page_list, ref_params))
+        return self.response_json_success(page_info)
+
+
+class DeleteActPrizeHandler(ClientBaseHandler):
+    """
+    :description: 删除活动奖品
+    """
+    @filter_check_params("prize_id")
+    def get_async(self):
+        """
+        :description: 删除活动奖品
+        :param app_id：应用标识
+        :param prize_id：奖品标识
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        prize_id = int(self.get_param("prize_id", 0))
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        title_prefix = invoke_result_data.data["title_prefix"] if invoke_result_data.data.__contains__("title_prefix") else "奖品"
+        prize_base_model = PrizeBaseModel(context=self)
+        invoke_result_data = prize_base_model.update_act_prize_status(app_id, prize_id, 1)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        self.create_operation_log(operation_type=OperationType.delete.value, model_name="act_prize_tb", title= title_prefix + ";" + invoke_result_data.data["prize_name"])
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success()
+
+
+class ReviewActPrizeHandler(ClientBaseHandler):
+    """
+    :description: 还原活动奖品
+    """
+    @filter_check_params("prize_id")
+    def get_async(self):
+        """
+        :description: 还原活动奖品
+        :param app_id：应用标识
+        :param prize_id：奖品标识
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        prize_id = int(self.get_param("prize_id", 0))
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        title_prefix = invoke_result_data.data["title_prefix"] if invoke_result_data.data.__contains__("title_prefix") else "奖品"
+        prize_base_model = PrizeBaseModel(context=self)
+        invoke_result_data = prize_base_model.update_act_prize_status(app_id, prize_id, 0)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        self.create_operation_log(operation_type=OperationType.review.value, model_name="act_prize_tb", title= title_prefix + ";" + invoke_result_data.data["prize_name"])
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success()
+
+
+class ReleaseActPrizeHandler(ClientBaseHandler):
+    """
+    :description: 上下架活动奖品
+    """
+    @filter_check_params("prize_id")
+    def get_async(self):
+        """
+        :description: 上下架活动奖品
+        :param app_id：应用标识
+        :param prize_id 奖品标识
+        :param is_release: 是否发布 1-是 0-否
+        :return:
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        prize_id = int(self.get_param("prize_id", 0))
+        is_release = int(self.get_param("is_release", 0))
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        title_prefix = invoke_result_data.data["title_prefix"] if invoke_result_data.data.__contains__("title_prefix") else "奖品"
+        prize_base_model = PrizeBaseModel(context=self)
+        invoke_result_data = prize_base_model.release_act_prize(app_id, prize_id, is_release)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        operation_type = OperationType.release.value if is_release == 1 else OperationType.un_release.value
+        self.create_operation_log(operation_type=operation_type, model_name="act_prize_tb", title= title_prefix + ";" + invoke_result_data.data["prize_name"])
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success()
+
+
+class ActPrizeExportHandler(ClientBaseHandler):
+    """
+    :description: 导出活动奖品列表
+    """
+    def get_async(self):
+        """
+        :description: 导出活动奖品列表
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param module_id：活动模块标识
+        :param prize_name：奖品名称
+        :param is_del：是否回收站1是0否
+        :param page_size：页大小
+        :param page_index：页索引
+        :return 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        module_id = int(self.get_param("module_id", 0))
+        prize_name = self.get_param("prize_name")
+        is_del = int(self.get_param("is_del", -1))
+        page_index = int(self.get_param("page_index", 0))
+        page_size = int(self.get_param("page_size", 500))
+
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_success("")
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        condition = invoke_result_data.data["condition"] if invoke_result_data.data.__contains__("condition") else ""
+        params = invoke_result_data.data["params"] if invoke_result_data.data.__contains__("params") else []
+        order_by = invoke_result_data.data["order_by"] if invoke_result_data.data.__contains__("order_by") else "create_date desc"
+        field = invoke_result_data.data["field"] if invoke_result_data.data.__contains__("field") else "*"
+        operate_title = invoke_result_data.data["operate_title"] if invoke_result_data.data.__contains__("operate_title") else "奖品列表"
+
+
+        prize_base_model = PrizeBaseModel(context=self)
+        act_prize_list_dict = []
+        if page_size <= 500:
+            act_prize_list_dict = prize_base_model.get_act_prize_list(app_id, act_id, module_id, prize_name, 0, is_del, page_size, page_index, order_by=order_by, condition=condition, params=params, field=field, is_cache=False).data
+        else:
+            max_page_size = 100
+            repeat_count = page_size // max_page_size  # 循环次数
+            begin_page_index = page_index * repeat_count  # 开始页码
+            for i in range(repeat_count):
+                list_dict = prize_base_model.get_act_prize_list(app_id, act_id, module_id, prize_name, 0, is_del, max_page_size, begin_page_index + i, order_by=order_by, condition=condition, params=params, field=field, is_cache=False).data
+                if len(list_dict) <= 0:
+                    break
+                act_prize_list_dict.extend(list_dict)
+        ref_params = {}
+        result_data = self.business_process_executed(act_prize_list_dict, ref_params)
+        resource_path = OSS2Helper.export_excel(result_data)
+        self.create_operation_log(operation_type=OperationType.export.value, model_name="act_prize_tb", title=operate_title)
+        return self.response_json_success(resource_path)
+
+    def business_process_executed(self, result_data, ref_params):
+        """
+        :description: 执行后事件
+        :param result_data:result_data
+        :param ref_params: 关联参数
+        :return:
+        :last_editors: HuangJianYi
+        """
+        result_list = []
+        for act_prize_dict in result_data:
+            data_row = {}
+            data_row["奖品名称"] = act_prize_dict["prize_name"]
+            data_row["奖品子标题"] = act_prize_dict["prize_title"]
+            data_row["奖品图"] = act_prize_dict["prize_pic"]
+            data_row["商品ID"] = act_prize_dict["goods_id"]
+            data_row["商家编码"] = act_prize_dict["goods_code"]
+            data_row["奖品类型"] = act_prize_dict["prize_type"]
+            data_row["奖品价值"] = str(act_prize_dict["prize_price"])
+            data_row["奖品库存"] = act_prize_dict["surplus"]
+            data_row["奖品总库存"] = act_prize_dict["prize_total"]
+            if act_prize_dict["prize_type"] == 1:
+                data_row["奖品类型"] = "现货"
+            elif act_prize_dict["prize_type"] == 2:
+                data_row["奖品类型"] = "优惠券"
+            elif act_prize_dict["prize_type"] == 3:
+                data_row["奖品类型"] = "红包"
+            elif act_prize_dict["prize_type"] == 4:
+                data_row["奖品类型"] = "参与奖"
+            else:
+                data_row["奖品类型"] = "预售"
+            data_row["创建时间"] = TimeHelper.datetime_to_format_time(act_prize_dict["create_date"])
+            data_row["是否发布"] = "未发布"
+            if act_prize_dict["is_release"] == 1:
+                data_row["是否发布"] = "已发布"
+            result_list.append(data_row)
         return result_list
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/handlers/server/report_s.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/handlers/server/report_s.py`

 * *Ordering differences only*

 * *Files 10% similar despite different names*

```diff
@@ -1,95 +1,95 @@
-# -*- coding: utf-8 -*-
-"""
-:Author: HuangJianYi
-:Date: 2020-11-16 13:44:20
-@LastEditTime: 2023-04-04 16:41:30
-@LastEditors: HuangJianYi
-:description: 报表模块
-"""
-from seven_cloudapp_frame.handlers.frame_base import *
-from seven_cloudapp_frame.models.stat_base_model import *
-
-
-class StatReportListHandler(ClientBaseHandler):
-    """
-    :description: 报表数据列表(表格)
-    """
-    def get_async(self):
-        """
-        :description: 报表数据列表(表格) 
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param module_id：活动模块标识
-        :param start_date：开始时间
-        :param end_date：结束时间 比如：查当天的数据 传过来开始时间是2021-09-02 00:00:00 结束时间则是2021-09-03 00:00:00 前端自动把结束时间加一天
-        :param object_id：对象标识
-        :return list
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        module_id = int(self.get_param("module_id", 0))
-        start_date = self.get_param("start_date")
-        end_date = self.get_param("end_date")
-        object_id = self.get_param("object_id")
-
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        if not invoke_result_data.data:
-            invoke_result_data.data = {}
-        report_condition = invoke_result_data.data["report_condition"] if invoke_result_data.data.__contains__("report_condition") else None
-        report_params = invoke_result_data.data["report_params"] if invoke_result_data.data.__contains__("report_params") else None
-        orm_condition = invoke_result_data.data["orm_condition"] if invoke_result_data.data.__contains__("orm_condition") else None
-        orm_params = invoke_result_data.data["orm_params"] if invoke_result_data.data.__contains__("orm_params") else None
-        order_by = invoke_result_data.data["order_by"] if invoke_result_data.data.__contains__("order_by") else "sort_index asc"
-        is_only_module = invoke_result_data.data["is_only_module"] if invoke_result_data.data.__contains__("is_only_module") else False
-
-        stat_base_model = StatBaseModel(context=self)
-        stat_report_list = stat_base_model.get_stat_report_list(app_id=app_id, act_id=act_id, module_id=module_id, start_date=start_date, end_date=end_date, order_by=order_by, is_only_module=is_only_module, orm_condition=orm_condition, orm_params=orm_params, report_condition=report_condition, report_params=report_params, object_id=object_id)
-        ref_params = {}
-        stat_report_list = self.business_process_executed(stat_report_list, ref_params)
-        return self.response_json_success(stat_report_list)
-
-
-
-class TrendReportListHandler(ClientBaseHandler):
-    """
-    :description: 报表数据列表(趋势图) 
-    """
-    def get_async(self):
-        """
-        :description: 报表数据列表(趋势图) 
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param module_id：活动模块标识
-        :param start_date：开始时间
-        :param end_date：结束时间 比如：查当天的数据 传过来开始时间是2021-09-02 00:00:00 结束时间则是2021-09-03 00:00:00 前端自动把结束时间加一天
-        :param object_id：对象标识
-        :return list
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        module_id = int(self.get_param("module_id", 0))
-        start_date = self.get_param("start_date")
-        end_date = self.get_param("end_date")
-        object_id = self.get_param("object_id")
-
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        if not invoke_result_data.data:
-            invoke_result_data.data = {}
-        report_condition = invoke_result_data.data["report_condition"] if invoke_result_data.data.__contains__("report_condition") else None
-        report_params = invoke_result_data.data["report_params"] if invoke_result_data.data.__contains__("report_params") else None
-        orm_condition = invoke_result_data.data["orm_condition"] if invoke_result_data.data.__contains__("orm_condition") else None
-        orm_params = invoke_result_data.data["orm_params"] if invoke_result_data.data.__contains__("orm_params") else None
-        order_by = invoke_result_data.data["order_by"] if invoke_result_data.data.__contains__("order_by") else "sort_index asc"
-        is_only_module = invoke_result_data.data["is_only_module"] if invoke_result_data.data.__contains__("is_only_module") else False
-
-        stat_base_model = StatBaseModel(context=self)
-        trend_report_list = stat_base_model.get_trend_report_list(app_id=app_id, act_id=act_id, module_id=module_id, start_date=start_date, end_date=end_date, order_by=order_by, is_only_module=is_only_module, orm_condition=orm_condition, orm_params=orm_params, report_condition=report_condition, report_params=report_params, object_id=object_id)
-        ref_params = {}
-        trend_report_list = self.business_process_executed(trend_report_list, ref_params)
-        return self.response_json_success(trend_report_list)
+# -*- coding: utf-8 -*-
+"""
+:Author: HuangJianYi
+:Date: 2020-11-16 13:44:20
+@LastEditTime: 2023-04-04 16:41:30
+@LastEditors: HuangJianYi
+:description: 报表模块
+"""
+from seven_cloudapp_frame.handlers.frame_base import *
+from seven_cloudapp_frame.models.stat_base_model import *
+
+
+class StatReportListHandler(ClientBaseHandler):
+    """
+    :description: 报表数据列表(表格)
+    """
+    def get_async(self):
+        """
+        :description: 报表数据列表(表格) 
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param module_id：活动模块标识
+        :param start_date：开始时间
+        :param end_date：结束时间 比如：查当天的数据 传过来开始时间是2021-09-02 00:00:00 结束时间则是2021-09-03 00:00:00 前端自动把结束时间加一天
+        :param object_id：对象标识
+        :return list
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        module_id = int(self.get_param("module_id", 0))
+        start_date = self.get_param("start_date")
+        end_date = self.get_param("end_date")
+        object_id = self.get_param("object_id")
+
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        report_condition = invoke_result_data.data["report_condition"] if invoke_result_data.data.__contains__("report_condition") else None
+        report_params = invoke_result_data.data["report_params"] if invoke_result_data.data.__contains__("report_params") else None
+        orm_condition = invoke_result_data.data["orm_condition"] if invoke_result_data.data.__contains__("orm_condition") else None
+        orm_params = invoke_result_data.data["orm_params"] if invoke_result_data.data.__contains__("orm_params") else None
+        order_by = invoke_result_data.data["order_by"] if invoke_result_data.data.__contains__("order_by") else "sort_index asc"
+        is_only_module = invoke_result_data.data["is_only_module"] if invoke_result_data.data.__contains__("is_only_module") else False
+
+        stat_base_model = StatBaseModel(context=self)
+        stat_report_list = stat_base_model.get_stat_report_list(app_id=app_id, act_id=act_id, module_id=module_id, start_date=start_date, end_date=end_date, order_by=order_by, is_only_module=is_only_module, orm_condition=orm_condition, orm_params=orm_params, report_condition=report_condition, report_params=report_params, object_id=object_id)
+        ref_params = {}
+        stat_report_list = self.business_process_executed(stat_report_list, ref_params)
+        return self.response_json_success(stat_report_list)
+
+
+
+class TrendReportListHandler(ClientBaseHandler):
+    """
+    :description: 报表数据列表(趋势图) 
+    """
+    def get_async(self):
+        """
+        :description: 报表数据列表(趋势图) 
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param module_id：活动模块标识
+        :param start_date：开始时间
+        :param end_date：结束时间 比如：查当天的数据 传过来开始时间是2021-09-02 00:00:00 结束时间则是2021-09-03 00:00:00 前端自动把结束时间加一天
+        :param object_id：对象标识
+        :return list
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        module_id = int(self.get_param("module_id", 0))
+        start_date = self.get_param("start_date")
+        end_date = self.get_param("end_date")
+        object_id = self.get_param("object_id")
+
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        report_condition = invoke_result_data.data["report_condition"] if invoke_result_data.data.__contains__("report_condition") else None
+        report_params = invoke_result_data.data["report_params"] if invoke_result_data.data.__contains__("report_params") else None
+        orm_condition = invoke_result_data.data["orm_condition"] if invoke_result_data.data.__contains__("orm_condition") else None
+        orm_params = invoke_result_data.data["orm_params"] if invoke_result_data.data.__contains__("orm_params") else None
+        order_by = invoke_result_data.data["order_by"] if invoke_result_data.data.__contains__("order_by") else "sort_index asc"
+        is_only_module = invoke_result_data.data["is_only_module"] if invoke_result_data.data.__contains__("is_only_module") else False
+
+        stat_base_model = StatBaseModel(context=self)
+        trend_report_list = stat_base_model.get_trend_report_list(app_id=app_id, act_id=act_id, module_id=module_id, start_date=start_date, end_date=end_date, order_by=order_by, is_only_module=is_only_module, orm_condition=orm_condition, orm_params=orm_params, report_condition=report_condition, report_params=report_params, object_id=object_id)
+        ref_params = {}
+        trend_report_list = self.business_process_executed(trend_report_list, ref_params)
+        return self.response_json_success(trend_report_list)
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/handlers/server/task_s.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/handlers/server/task_s.py`

 * *Ordering differences only*

 * *Files 8% similar despite different names*

```diff
@@ -1,138 +1,138 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-08-10 10:05:38
-@LastEditTime: 2023-01-12 09:51:44
-@LastEditors: HuangJianYi
-@Description: 任务模块
-"""
-
-from seven_cloudapp_frame.handlers.frame_base import *
-from seven_cloudapp_frame.models.task_base_model import *
-from seven_cloudapp_frame.models.enum import *
-from seven_cloudapp_frame.models.db_models.task.task_info_model import *
-
-
-class TaskInfoListHandler(ClientBaseHandler):
-    """
-    :description: 获取任务列表
-    """
-    def get_async(self):
-        """
-        :description: 获取任务列表
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param module_id：活动模块标识
-        :param is_release：是否发布
-        :return list
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        module_id = int(self.get_param("module_id", 0))
-        is_release = int(self.get_param("is_release", -1))
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_success({"data": []})
-        task_base_model = TaskBaseModel(context=self)
-        return self.response_json_success(self.business_process_executed(task_base_model.get_task_info_dict_list(app_id, act_id, module_id,is_release,False), ref_params={}))
-
-
-class SaveTaskInfoHandler(ClientBaseHandler):
-    """
-    :description 保存任务
-    """
-    @filter_check_params("task_list")
-    def post_async(self):
-        """
-        :description: 保存任务
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param module_id：活动模块标识
-        :param task_list：任务列表
-        :return response_json_success
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        module_id = int(self.get_param("module_id", 0))
-        task_list = self.get_param("task_list")
-
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        if not invoke_result_data.data:
-            invoke_result_data.data = {}
-        title_prefix = invoke_result_data.data["title_prefix"] if invoke_result_data.data.__contains__("title_prefix") else "任务"
-        operate_user_id = invoke_result_data.data["operate_user_id"] if invoke_result_data.data.__contains__("operate_user_id") else ""
-        operate_user_name = invoke_result_data.data["operate_user_name"] if invoke_result_data.data.__contains__("operate_user_name") else ""
-        operate_role_id = invoke_result_data.data["operate_role_id"] if invoke_result_data.data.__contains__("operate_role_id") else ""
-
-        try:
-            task_list = SevenHelper.json_loads(task_list)
-        except Exception as ex:
-            task_list = []
-        task_base_model = TaskBaseModel(context=self)
-        task_info_model = TaskInfoModel(context=self)
-        for item in task_list:
-            if not item.__contains__("task_type"):
-                continue
-            task_name = str(item["task_name"]) if item.__contains__("task_name") else ""
-            complete_type = int(item["complete_type"]) if item.__contains__("complete_type") else 1
-            sort_index = int(item["sort_index"]) if item.__contains__("sort_index") else 0
-            is_release = int(item["is_release"]) if item.__contains__("is_release") else 0
-            route_url = item["route_url"] if item.__contains__("route_url") else ''
-            i1 = int(item["i1"]) if item.__contains__("i1") else 0
-            i2 = int(item["i2"]) if item.__contains__("i2") else 0
-            s1 = item["s1"] if item.__contains__("s1") else ''
-            s2 = item["s2"] if item.__contains__("s2") else ''
-            config_json = SevenHelper.json_dumps(item["config_json"]) if item.__contains__("config_json") else {}
-            title = title_prefix + ";" + task_name if title_prefix else task_name
-            now_datetime = SevenHelper.get_now_datetime()
-            if "id" in item.keys():
-                task_info = task_info_model.get_entity_by_id(int(item["id"]))
-                if task_info:
-                    old_task_info = deepcopy(task_info)
-                    task_info.task_type = int(item["task_type"])
-                    task_info.task_name = task_name
-                    task_info.complete_type = complete_type
-                    task_info.config_json = config_json
-                    task_info.sort_index = sort_index
-                    task_info.is_release = is_release
-                    task_info.route_url = route_url
-                    task_info.i1 = i1
-                    task_info.i2 = i2
-                    task_info.s1 = s1
-                    task_info.s2 = s2
-                    task_info.modify_date = now_datetime
-                    task_info_model.update_entity(task_info, "complete_type,task_name,sort_index,is_release,route_url,i1,i2,s1,s2,config_json,modify_date")
-                    task_base_model._delete_task_info_dependency_key(0,task_info.id)
-                    self.create_operation_log(operation_type=OperationType.update.value, model_name=task_info.__str__(), old_detail=old_task_info.__dict__, update_detail=task_info.__dict__, title=title, operate_user_id=operate_user_id, operate_user_name=operate_user_name, operate_role_id=operate_role_id)
-                    ref_params = {}
-                    self.business_process_executed(task_info, ref_params)
-            else:
-                task_info = TaskInfo()
-                task_info.app_id = app_id
-                task_info.act_id = act_id
-                task_info.module_id = module_id
-                task_info.task_type = int(item["task_type"])
-                task_info.task_name = task_name
-                task_info.complete_type = complete_type
-                task_info.config_json = config_json
-                task_info.sort_index = sort_index
-                task_info.is_release = is_release
-                task_info.route_url = route_url
-                task_info.i1 = i1
-                task_info.i2 = i2
-                task_info.s1 = s1
-                task_info.s2 = s2
-                task_info.create_date = now_datetime
-                task_info.modify_date = now_datetime
-                task_info_model.add_entity(task_info)
-                self.create_operation_log(operation_type=OperationType.add.value, model_name=task_info.__str__(), old_detail=None, update_detail=task_info.__dict__, title=title, operate_user_id=operate_user_id, operate_user_name=operate_user_name, operate_role_id=operate_role_id)
-                ref_params = {}
-                self.business_process_executed(task_info, ref_params)
-
-        task_base_model._delete_task_info_dependency_key(act_id)
-
-        return self.response_json_success()
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-08-10 10:05:38
+@LastEditTime: 2023-01-12 09:51:44
+@LastEditors: HuangJianYi
+@Description: 任务模块
+"""
+
+from seven_cloudapp_frame.handlers.frame_base import *
+from seven_cloudapp_frame.models.task_base_model import *
+from seven_cloudapp_frame.models.enum import *
+from seven_cloudapp_frame.models.db_models.task.task_info_model import *
+
+
+class TaskInfoListHandler(ClientBaseHandler):
+    """
+    :description: 获取任务列表
+    """
+    def get_async(self):
+        """
+        :description: 获取任务列表
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param module_id：活动模块标识
+        :param is_release：是否发布
+        :return list
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        module_id = int(self.get_param("module_id", 0))
+        is_release = int(self.get_param("is_release", -1))
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_success({"data": []})
+        task_base_model = TaskBaseModel(context=self)
+        return self.response_json_success(self.business_process_executed(task_base_model.get_task_info_dict_list(app_id, act_id, module_id,is_release,False), ref_params={}))
+
+
+class SaveTaskInfoHandler(ClientBaseHandler):
+    """
+    :description 保存任务
+    """
+    @filter_check_params("task_list")
+    def post_async(self):
+        """
+        :description: 保存任务
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param module_id：活动模块标识
+        :param task_list：任务列表
+        :return response_json_success
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        module_id = int(self.get_param("module_id", 0))
+        task_list = self.get_param("task_list")
+
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        title_prefix = invoke_result_data.data["title_prefix"] if invoke_result_data.data.__contains__("title_prefix") else "任务"
+        operate_user_id = invoke_result_data.data["operate_user_id"] if invoke_result_data.data.__contains__("operate_user_id") else ""
+        operate_user_name = invoke_result_data.data["operate_user_name"] if invoke_result_data.data.__contains__("operate_user_name") else ""
+        operate_role_id = invoke_result_data.data["operate_role_id"] if invoke_result_data.data.__contains__("operate_role_id") else ""
+
+        try:
+            task_list = SevenHelper.json_loads(task_list)
+        except Exception as ex:
+            task_list = []
+        task_base_model = TaskBaseModel(context=self)
+        task_info_model = TaskInfoModel(context=self)
+        for item in task_list:
+            if not item.__contains__("task_type"):
+                continue
+            task_name = str(item["task_name"]) if item.__contains__("task_name") else ""
+            complete_type = int(item["complete_type"]) if item.__contains__("complete_type") else 1
+            sort_index = int(item["sort_index"]) if item.__contains__("sort_index") else 0
+            is_release = int(item["is_release"]) if item.__contains__("is_release") else 0
+            route_url = item["route_url"] if item.__contains__("route_url") else ''
+            i1 = int(item["i1"]) if item.__contains__("i1") else 0
+            i2 = int(item["i2"]) if item.__contains__("i2") else 0
+            s1 = item["s1"] if item.__contains__("s1") else ''
+            s2 = item["s2"] if item.__contains__("s2") else ''
+            config_json = SevenHelper.json_dumps(item["config_json"]) if item.__contains__("config_json") else {}
+            title = title_prefix + ";" + task_name if title_prefix else task_name
+            now_datetime = SevenHelper.get_now_datetime()
+            if "id" in item.keys():
+                task_info = task_info_model.get_entity_by_id(int(item["id"]))
+                if task_info:
+                    old_task_info = deepcopy(task_info)
+                    task_info.task_type = int(item["task_type"])
+                    task_info.task_name = task_name
+                    task_info.complete_type = complete_type
+                    task_info.config_json = config_json
+                    task_info.sort_index = sort_index
+                    task_info.is_release = is_release
+                    task_info.route_url = route_url
+                    task_info.i1 = i1
+                    task_info.i2 = i2
+                    task_info.s1 = s1
+                    task_info.s2 = s2
+                    task_info.modify_date = now_datetime
+                    task_info_model.update_entity(task_info, "complete_type,task_name,sort_index,is_release,route_url,i1,i2,s1,s2,config_json,modify_date")
+                    task_base_model._delete_task_info_dependency_key(0,task_info.id)
+                    self.create_operation_log(operation_type=OperationType.update.value, model_name=task_info.__str__(), old_detail=old_task_info.__dict__, update_detail=task_info.__dict__, title=title, operate_user_id=operate_user_id, operate_user_name=operate_user_name, operate_role_id=operate_role_id)
+                    ref_params = {}
+                    self.business_process_executed(task_info, ref_params)
+            else:
+                task_info = TaskInfo()
+                task_info.app_id = app_id
+                task_info.act_id = act_id
+                task_info.module_id = module_id
+                task_info.task_type = int(item["task_type"])
+                task_info.task_name = task_name
+                task_info.complete_type = complete_type
+                task_info.config_json = config_json
+                task_info.sort_index = sort_index
+                task_info.is_release = is_release
+                task_info.route_url = route_url
+                task_info.i1 = i1
+                task_info.i2 = i2
+                task_info.s1 = s1
+                task_info.s2 = s2
+                task_info.create_date = now_datetime
+                task_info.modify_date = now_datetime
+                task_info_model.add_entity(task_info)
+                self.create_operation_log(operation_type=OperationType.add.value, model_name=task_info.__str__(), old_detail=None, update_detail=task_info.__dict__, title=title, operate_user_id=operate_user_id, operate_user_name=operate_user_name, operate_role_id=operate_role_id)
+                ref_params = {}
+                self.business_process_executed(task_info, ref_params)
+
+        task_base_model._delete_task_info_dependency_key(act_id)
+
+        return self.response_json_success()
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/handlers/server/theme_s.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/handlers/server/theme_s.py`

 * *Ordering differences only*

 * *Files 19% similar despite different names*

```diff
@@ -1,76 +1,76 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-08-02 09:03:41
-@LastEditTime: 2022-06-13 14:39:47
-@LastEditors: HuangJianYi
-@Description: 主题皮肤模块
-"""
-
-from seven_cloudapp_frame.handlers.frame_base import *
-from seven_cloudapp_frame.models.theme_base_model import *
-
-
-class ThemeInfoListHandler(ClientBaseHandler):
-    """
-    :description: 主题列表
-    """
-    def get_async(self):
-        """
-        :description: 主题列表
-        :param app_id：应用标识
-        :param ascription_type：归属类型
-        :return: 列表
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        ascription_type = self.get_param_int("ascription_type", 1)
-        theme_base_model = ThemeBaseModel(context=self)
-        return self.response_json_success(theme_base_model.get_theme_list(app_id, is_cache=False, ascription_type=ascription_type))
-
-
-class SkinInfoListHandler(ClientBaseHandler):
-    """
-    :description: 皮肤列表
-    """
-    @filter_check_params("theme_id")
-    def get_async(self):
-        """
-        :description: 皮肤列表
-        :param theme_id：主题标识
-        :return: 列表
-        :last_editors: HuangJianYi
-        """
-        theme_id = int(self.get_param("theme_id", 0))
-        theme_base_model = ThemeBaseModel(context=self)
-        return self.response_json_success(theme_base_model.get_skin_list(theme_id,is_cache=False))
-
-
-class UpdateThemeHandler(ClientBaseHandler):
-    """
-    :description: 更新活动主题和皮肤
-    """
-    @filter_check_params("theme_id")
-    def get_async(self):
-        """
-        :description: 更新活动主题和皮肤
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param theme_id：主题标识
-        :param is_module：是否更新活动模块皮肤 1是0否
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        theme_id = int(self.get_param("theme_id", 0))
-        is_module = int(self.get_param("is_module", 0))
-        if is_module == 1:
-            is_module = True
-        else:
-            is_module = False
-        theme_base_model = ThemeBaseModel(context=self)
-        invoke_result_data = theme_base_model.update_act_theme_and_skin(app_id, act_id, theme_id, is_module)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-08-02 09:03:41
+@LastEditTime: 2022-06-13 14:39:47
+@LastEditors: HuangJianYi
+@Description: 主题皮肤模块
+"""
+
+from seven_cloudapp_frame.handlers.frame_base import *
+from seven_cloudapp_frame.models.theme_base_model import *
+
+
+class ThemeInfoListHandler(ClientBaseHandler):
+    """
+    :description: 主题列表
+    """
+    def get_async(self):
+        """
+        :description: 主题列表
+        :param app_id：应用标识
+        :param ascription_type：归属类型
+        :return: 列表
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        ascription_type = self.get_param_int("ascription_type", 1)
+        theme_base_model = ThemeBaseModel(context=self)
+        return self.response_json_success(theme_base_model.get_theme_list(app_id, is_cache=False, ascription_type=ascription_type))
+
+
+class SkinInfoListHandler(ClientBaseHandler):
+    """
+    :description: 皮肤列表
+    """
+    @filter_check_params("theme_id")
+    def get_async(self):
+        """
+        :description: 皮肤列表
+        :param theme_id：主题标识
+        :return: 列表
+        :last_editors: HuangJianYi
+        """
+        theme_id = int(self.get_param("theme_id", 0))
+        theme_base_model = ThemeBaseModel(context=self)
+        return self.response_json_success(theme_base_model.get_skin_list(theme_id,is_cache=False))
+
+
+class UpdateThemeHandler(ClientBaseHandler):
+    """
+    :description: 更新活动主题和皮肤
+    """
+    @filter_check_params("theme_id")
+    def get_async(self):
+        """
+        :description: 更新活动主题和皮肤
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param theme_id：主题标识
+        :param is_module：是否更新活动模块皮肤 1是0否
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        theme_id = int(self.get_param("theme_id", 0))
+        is_module = int(self.get_param("is_module", 0))
+        if is_module == 1:
+            is_module = True
+        else:
+            is_module = False
+        theme_base_model = ThemeBaseModel(context=self)
+        invoke_result_data = theme_base_model.update_act_theme_and_skin(app_id, act_id, theme_id, is_module)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
         return self.response_json_success()
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/handlers/server/user_s.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/handlers/server/user_s.py`

 * *Ordering differences only*

 * *Files 14% similar despite different names*

```diff
@@ -1,500 +1,500 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-27 10:52:51
-@LastEditTime: 2023-05-05 19:22:10
-@LastEditors: HuangJianYi
-@Description: 用户模块
-"""
-from seven_cloudapp_frame.handlers.frame_base import *
-from seven_cloudapp_frame.models.user_base_model import *
-from seven_cloudapp_frame.models.asset_base_model import *
-from seven_cloudapp_frame.libs.customize.oss2_helper import *
-from seven_cloudapp_frame.models.enum import *
-from seven_cloudapp_frame.models.seven_model import *
-from seven_cloudapp_frame.models.db_models.tao.tao_login_log_model import *
-from seven_cloudapp_frame.models.db_models.price.price_gear_model import *
-
-
-class LoginHandler(ClientBaseHandler):
-    """
-    :description: 登录处理
-    """
-
-    @filter_check_params("open_id")
-    def get_async(self):
-        """
-        :description: 登录日志入库
-        :param open_id：用户唯一标识
-        :param user_nick：用户昵称
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        open_id = self.get_open_id()
-        user_nick = self.get_user_nick()
-
-        request_params = str(self.request_params)
-
-        if user_nick == "":
-            return self.response_json_success()
-
-        tao_login_log_model = TaoLoginLogModel(context=self)
-        tao_login_log = tao_login_log_model.get_entity("open_id=%s", params=open_id)
-
-        is_add = False
-        if not tao_login_log:
-            is_add = True
-            tao_login_log = TaoLoginLog()
-
-        tao_login_log.open_id = open_id
-        tao_login_log.user_nick = user_nick
-        if user_nick.__contains__(":"):
-            tao_login_log.store_user_nick = user_nick.split(":")[0]
-            tao_login_log.is_master = 0
-        else:
-            tao_login_log.store_user_nick = user_nick
-            tao_login_log.is_master = 1
-        tao_login_log.request_params = request_params
-        tao_login_log.modify_date = self.get_now_datetime()
-
-        try:
-            if is_add:
-                tao_login_log.create_date = tao_login_log.modify_date
-                tao_login_log.id = tao_login_log_model.add_entity(tao_login_log)
-            else:
-                tao_login_log_model.update_entity(tao_login_log)
-
-            #更新登录时间到app_info
-            app_id = self.get_app_id()
-            if app_id:
-                AppInfoModel(context=self).update_table("modify_date=%s", "app_id=%s", [tao_login_log.modify_date, app_id])
-        except:
-            pass
-
-        return self.response_json_success()
-
-
-class UpdateUserStatusHandler(ClientBaseHandler):
-    """
-    :description: 更新用户状态
-    """
-
-    @filter_check_params(check_user_code=True)
-    def get_async(self):
-        """
-        :description: 更新用户状态
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param user_code：用户标识
-        :param user_state：用户状态（0正常1黑名单）
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        user_id = self.get_user_id()
-        user_state = self.get_param_int("user_state")
-        user_base_model = UserBaseModel(context=self)
-        invoke_result_data = user_base_model.update_user_state(app_id, act_id, user_id, user_state)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        title = "更新用户状态；"
-        if user_state == 0:
-            title = "解锁用户；"
-        else:
-            title = "拉黑用户；"
-        title = title + "用户昵称：" + invoke_result_data.data["user_nick"] + "，openid：" + invoke_result_data.data["open_id"]
-        self.create_operation_log(operation_type=OperationType.operate.value, model_name="user_info_tb", title=title)
-        return self.response_json_success()
-
-
-class UpdateUserStatusByBlackHandler(ClientBaseHandler):
-    """
-    :description: 用户拉入黑名单(黑名单管理模式)
-    """
-
-    @filter_check_params(check_user_code=True)
-    def get_async(self):
-        """
-        :description: 用户拉入黑名单
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param user_code：用户标识
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        user_id = self.get_user_id()
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        user_base_model = UserBaseModel(context=self)
-        invoke_result_data = user_base_model.update_user_state_by_black(app_id, act_id, user_id)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        title = "拉黑用户；用户昵称：" + invoke_result_data.data["user_nick"] + "，openid：" + invoke_result_data.data["open_id"]
-        self.create_operation_log(operation_type=OperationType.operate.value, model_name="user_info_tb", title=title)
-        ref_params = {}
-        self.business_process_executed(invoke_result_data, ref_params)
-        return self.response_json_success()
-
-
-class AuditUserBlackHandler(ClientBaseHandler):
-    """
-    :description 审核黑名单状态
-    """
-
-    @filter_check_params("black_id,audit_status")
-    def get_async(self):
-        """
-        :description: 审核黑名单状态
-        :param black_id：用户黑名单管理标识
-        :param audit_status：审核状态(0黑名单1申请中2同意3拒绝)
-        :param audit_remark：审核备注
-        :return: response_json_success
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        black_id = int(self.get_param("black_id", 0))
-        audit_status = int(self.get_param("audit_status", 0))
-        audit_remark = self.get_param("audit_remark")
-
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        user_base_model = UserBaseModel(context=self)
-        invoke_result_data = user_base_model.audit_user_black(app_id, black_id, audit_status, audit_remark)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        title = "操作审核黑名单；"
-        if audit_status == 2:
-            title = "同意解锁用户；"
-        elif audit_status == 3:
-            title = "拒绝解锁用户；"
-        title = title + "用户昵称：" + invoke_result_data.data["user_info"]["user_nick"] + "，openid：" + invoke_result_data.data["user_info"]["open_id"]
-        self.create_operation_log(operation_type=OperationType.operate.value, model_name="user_black_tb", title=title)
-        ref_params = {}
-        self.business_process_executed(invoke_result_data, ref_params)
-        return self.response_json_success()
-
-
-class UpdateAuditRemarkHandler(ClientBaseHandler):
-    """
-    :description 修改审核备注
-    """
-
-    @filter_check_params("black_id,audit_status")
-    def get_async(self):
-        """
-        :description: 修改审核备注
-        :param black_id：用户黑名单管理标识
-        :param audit_remark：审核备注
-        :return: response_json_success
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        black_id = int(self.get_param("black_id", 0))
-        audit_remark = self.get_param("audit_remark")
-        user_base_model = UserBaseModel(context=self)
-        invoke_result_data = user_base_model.update_audit_remark(app_id, black_id, audit_remark)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        title = "修改黑名单审核备注；用户昵称：" + invoke_result_data.data["user_black"]["user_nick"] + "，openid：" + invoke_result_data.data["user_black"]["open_id"]
-        self.create_operation_log(operation_type=OperationType.operate.value, model_name="user_black_tb", title=title)
-        return self.response_json_success()
-
-
-class UserBlackListHandler(ClientBaseHandler):
-    """
-    :description: 获取黑名单管理列表
-    """
-
-    def get_async(self):
-        """
-        :description: 获取黑名单管理列表
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param audit_status：审核状态(0黑名单1申请中2同意3拒绝)
-        :param user_code：用户标识
-        :param start_date：开始时间
-        :param end_date：结束时间
-        :param nick_name：用户昵称
-        :param user_open_id：open_id
-        :param page_size：条数
-        :param page_index：页数
-        :return: list
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        audit_status = int(self.get_param("audit_status", -1))
-        user_id = self.get_user_id()
-        user_nick = self.get_param("nick_name")
-        open_id = self.get_param("user_open_id")
-        start_date = self.get_param("start_date")
-        end_date = self.get_param("end_date")
-        page_size = int(self.get_param("page_size", 20))
-        page_index = int(self.get_param("page_index", 0))
-
-        user_base_model = UserBaseModel(context=self)
-        return self.response_json_success(user_base_model.get_black_list(app_id, act_id, page_size, page_index, audit_status, user_id, start_date, end_date, user_nick, open_id))
-
-
-class UpdateUserAssetHandler(ClientBaseHandler):
-    """
-    :description: 变更资产
-    """
-    @filter_check_params("asset_type,asset_value", check_user_code=True)
-    def post_async(self):
-        """
-        :description: 变更资产
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param module_id：模块标识
-        :param user_code：用户标识
-        :param asset_type：资产类型
-        :param asset_value：变更的资产值
-        :param asset_object_id：资产对象标识
-        :return: response_json_success
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        user_id = self.get_user_id()
-        module_id = self.get_param_int("module_id", 0)
-        asset_type = self.get_param_int("asset_type", 0)
-        asset_value = self.get_param_int("asset_value", 0)
-        asset_object_id = self.get_param("asset_object_id")
-
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-
-        user_base_model = UserBaseModel(context=self)
-        user_info_dict = user_base_model.get_user_info_dict(app_id, act_id, user_id)
-        if not user_info_dict:
-            return self.response_json_error("error", "用户信息不存在")
-
-        asset_base_model = AssetBaseModel(context=self)
-        invoke_result_data = asset_base_model.update_user_asset(app_id=app_id,
-                                                                act_id=act_id,
-                                                                module_id=module_id,
-                                                                user_id=user_id,
-                                                                open_id=user_info_dict["open_id"],
-                                                                user_nick=user_info_dict["user_nick"],
-                                                                asset_type=asset_type,
-                                                                asset_value=asset_value,
-                                                                asset_object_id=asset_object_id,
-                                                                source_type=3,
-                                                                source_object_id="",
-                                                                source_object_name="手动配置",
-                                                                log_title="手动配置",
-                                                                only_id="",
-                                                                handler_name=self.__class__.__name__,
-                                                                request_code=self.request_code,
-                                                                info_json={"operate_user_id":self.get_open_id(),"operate_user_name":self.get_user_nick()
-                                                                           })
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        default_prefix = "资产配置"
-        operation_desc = ""
-        if asset_type == 1:
-            default_prefix = "次数配置"
-        elif asset_type == 2:
-            default_prefix = "积分配置"
-        elif asset_type == 3:
-            default_prefix = "价格档位配置"
-            price_gear_model = PriceGearModel(context=self)
-            asset_object_id = int(asset_object_id)
-            if asset_object_id > 0:
-                price_gear = price_gear_model.get_entity_by_id(asset_object_id)
-                if price_gear:
-                    operation_desc = "价格档位:" + price_gear.price_gear_name + "，次数：" + str(asset_value)
-        title_prefix = invoke_result_data.data["title_prefix"] if invoke_result_data.data.__contains__("title_prefix") else default_prefix
-        title = title_prefix + ";" + "用户昵称：" + user_info_dict["user_nick"] + "，openid：" + user_info_dict["open_id"]
-        self.create_operation_log(operation_type=OperationType.operate.value, model_name="user_asset_tb", title=title, operation_desc=operation_desc)
-        ref_params = {}
-        self.business_process_executed(invoke_result_data, ref_params)
-        return self.response_json_success()
-
-
-class BatchUpdateUserAssetHandler(ClientBaseHandler):
-    """
-    :description: 批量变更资产
-    """
-    @filter_check_params("asset_object_json", check_user_code=True)
-    def post_async(self):
-        """
-        :description: 批量变更资产
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param module_id：模块标识
-        :param user_code：用户标识
-        :param asset_object_json：变更的资产值列表
-        :return: response_json_success
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        user_id = self.get_user_id()
-        module_id = self.get_param_int("module_id", 0)
-        #{"asset_type":0,"asset_object_id":"","asset_value":0}
-        asset_object_json = self.get_param("asset_object_json")
-
-        user_base_model = UserBaseModel(context=self)
-        user_info_dict = user_base_model.get_user_info_dict(app_id, act_id, user_id)
-        if not user_info_dict:
-            return self.response_json_error("error", "用户信息不存在")
-
-        asset_base_model = AssetBaseModel(context=self)
-        asset_object_json = SevenHelper.json_loads(asset_object_json)
-        asset_object_ids = ""
-        for asset_object in asset_object_json:
-            invoke_result_data = asset_base_model.update_user_asset(app_id=app_id,
-                                                                    act_id=act_id,
-                                                                    module_id=module_id,
-                                                                    user_id=user_id,
-                                                                    open_id=user_info_dict["open_id"],
-                                                                    user_nick=user_info_dict["user_nick"],
-                                                                    asset_type=int(asset_object["asset_type"]),
-                                                                    asset_value=int(asset_object["asset_value"]),
-                                                                    asset_object_id=asset_object["asset_object_id"],
-                                                                    source_type=3,
-                                                                    source_object_id="",
-                                                                    source_object_name="手动配置",
-                                                                    log_title="手动配置",
-                                                                    only_id="",
-                                                                    handler_name=self.__class__.__name__,
-                                                                    request_code=self.request_code,
-                                                                    info_json={
-                                                                        "operate_user_id": self.get_open_id(),
-                                                                        "operate_user_name": self.get_user_nick()
-                                                                    })
-            if invoke_result_data.success == False:
-                return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message, asset_object_ids)
-            else:
-                if asset_object_ids:
-                    asset_object_ids += ","
-                asset_object_ids += asset_object["asset_object_id"]
-        title = "批量变更资产配置；用户昵称：" + user_info_dict["user_nick"] + "，openid：" + user_info_dict["open_id"]
-        self.create_operation_log(operation_type=OperationType.operate.value, model_name="user_asset_tb", title=title)
-        return self.response_json_success()
-
-
-class UserAssetListHandler(ClientBaseHandler):
-    """
-    :description: 获取用户资产列表
-    """
-
-    @filter_check_params(check_user_code=True)
-    def get_async(self):
-        """
-        :description: 获取用户资产列表
-        :param act_id：活动标识
-        :param user_code：用户标识
-        :param asset_type：资产类型(1-次数2-积分3-价格档位)
-        :return list
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        user_id = self.get_user_id()
-        asset_type = int(self.get_param("asset_type", 0))
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_success({"data": []})
-        asset_base_model = AssetBaseModel(context=self)
-        ref_params = {}
-        return self.response_json_success(self.business_process_executed(asset_base_model.get_user_asset_list(app_id, act_id, user_id, asset_type), ref_params))
-
-
-class AssetLogListHandler(ClientBaseHandler):
-    """
-    :description: 资产流水记录
-    """
-
-    def get_async(self):
-        """
-        :description: 资产流水记录
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param module_id：模块标识
-        :param asset_type：资产类型(1-次数2-积分3-价格档位)
-        :param page_size：条数
-        :param page_index：页数
-        :param user_id：用户标识
-        :param asset_object_id：资产对象标识
-        :param start_date：开始时间
-        :param end_date：结束时间
-        :param user_nick：昵称
-        :param open_id：open_id
-        :param source_type：来源类型（1-购买2-任务3-手动配置4-抽奖5-回购）
-        :param source_object_id：来源对象标识(比如来源类型是任务则对应任务类型)
-        :param operate_type：操作类型(0累计 1消耗)
-        :return list
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        module_id = self.get_param_int("module_id", 0)
-        page_index = self.get_param_int("page_index", 0)
-        page_size = self.get_param_int("page_size", 20)
-        user_id = self.get_user_id()
-        user_open_id = self.get_param("user_open_id")
-        user_nick = self.get_param("nick_name")
-        start_date = self.get_param("start_date")
-        end_date = self.get_param("end_date")
-        source_type = self.get_param_int("source_type", 0)
-        source_object_id = self.get_param("source_object_id")
-        asset_type = self.get_param_int("asset_type", 0)
-        asset_object_id = self.get_param("asset_object_id")
-        operate_type = self.get_param_int("operate_type", -1)
-
-        field = "*"
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_success({"data": []})
-        else:
-            field = invoke_result_data.data["field"] if invoke_result_data.data.__contains__("field") else "*"
-        asset_base_model = AssetBaseModel(context=self)
-        page_list, total = asset_base_model.get_asset_log_list(app_id, act_id, asset_type, page_size, page_index, user_id, asset_object_id, start_date, end_date, user_nick, user_open_id, source_type, source_object_id, field, is_cache=False, operate_type=operate_type, module_id=module_id)
-        ref_params = {}
-        page_info = PageInfo(page_index, page_size, total, self.business_process_executed(page_list, ref_params))
-        return self.response_json_success(page_info)
-
-
-class UserInfoListHandler(ClientBaseHandler):
-    """
-    :description: 用户信息列表
-    """
-
-    def get_async(self):
-        """
-        :description: 用户信息列表
-        :param act_id：活动标识
-        :param user_id：用户标识
-        :param user_open_id：_open_id
-        :param nick_name：用户昵称
-        :param user_state：_用户状态0正常1黑名单
-        :param page_index：页索引
-        :param page_size：页大小
-        :param start_date：创建时间开始
-        :param end_date：创建时间结束
-        :return PageInfo
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = self.get_act_id()
-        user_id = self.get_user_id()
-        open_id = self.get_param("user_open_id")
-        user_nick = self.get_param("nick_name")
-        user_state = int(self.get_param("user_state", -1))
-        page_index = int(self.get_param("page_index", 0))
-        page_size = int(self.get_param("page_size", 20))
-        start_date = self.get_param("start_date")
-        end_date = self.get_param("end_date")
-        user_base_model = UserBaseModel(context=self)
-        page_info = user_base_model.get_user_list(app_id, act_id, page_size, page_index, user_state, user_id, start_date, end_date, user_nick, open_id)
-        ref_params = {}
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-27 10:52:51
+@LastEditTime: 2023-05-05 19:22:10
+@LastEditors: HuangJianYi
+@Description: 用户模块
+"""
+from seven_cloudapp_frame.handlers.frame_base import *
+from seven_cloudapp_frame.models.user_base_model import *
+from seven_cloudapp_frame.models.asset_base_model import *
+from seven_cloudapp_frame.libs.customize.oss2_helper import *
+from seven_cloudapp_frame.models.enum import *
+from seven_cloudapp_frame.models.seven_model import *
+from seven_cloudapp_frame.models.db_models.tao.tao_login_log_model import *
+from seven_cloudapp_frame.models.db_models.price.price_gear_model import *
+
+
+class LoginHandler(ClientBaseHandler):
+    """
+    :description: 登录处理
+    """
+
+    @filter_check_params("open_id")
+    def get_async(self):
+        """
+        :description: 登录日志入库
+        :param open_id：用户唯一标识
+        :param user_nick：用户昵称
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        open_id = self.get_open_id()
+        user_nick = self.get_user_nick()
+
+        request_params = str(self.request_params)
+
+        if user_nick == "":
+            return self.response_json_success()
+
+        tao_login_log_model = TaoLoginLogModel(context=self)
+        tao_login_log = tao_login_log_model.get_entity("open_id=%s", params=open_id)
+
+        is_add = False
+        if not tao_login_log:
+            is_add = True
+            tao_login_log = TaoLoginLog()
+
+        tao_login_log.open_id = open_id
+        tao_login_log.user_nick = user_nick
+        if user_nick.__contains__(":"):
+            tao_login_log.store_user_nick = user_nick.split(":")[0]
+            tao_login_log.is_master = 0
+        else:
+            tao_login_log.store_user_nick = user_nick
+            tao_login_log.is_master = 1
+        tao_login_log.request_params = request_params
+        tao_login_log.modify_date = self.get_now_datetime()
+
+        try:
+            if is_add:
+                tao_login_log.create_date = tao_login_log.modify_date
+                tao_login_log.id = tao_login_log_model.add_entity(tao_login_log)
+            else:
+                tao_login_log_model.update_entity(tao_login_log)
+
+            #更新登录时间到app_info
+            app_id = self.get_app_id()
+            if app_id:
+                AppInfoModel(context=self).update_table("modify_date=%s", "app_id=%s", [tao_login_log.modify_date, app_id])
+        except:
+            pass
+
+        return self.response_json_success()
+
+
+class UpdateUserStatusHandler(ClientBaseHandler):
+    """
+    :description: 更新用户状态
+    """
+
+    @filter_check_params(check_user_code=True)
+    def get_async(self):
+        """
+        :description: 更新用户状态
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param user_code：用户标识
+        :param user_state：用户状态（0正常1黑名单）
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        user_state = self.get_param_int("user_state")
+        user_base_model = UserBaseModel(context=self)
+        invoke_result_data = user_base_model.update_user_state(app_id, act_id, user_id, user_state)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        title = "更新用户状态；"
+        if user_state == 0:
+            title = "解锁用户；"
+        else:
+            title = "拉黑用户；"
+        title = title + "用户昵称：" + invoke_result_data.data["user_nick"] + "，openid：" + invoke_result_data.data["open_id"]
+        self.create_operation_log(operation_type=OperationType.operate.value, model_name="user_info_tb", title=title)
+        return self.response_json_success()
+
+
+class UpdateUserStatusByBlackHandler(ClientBaseHandler):
+    """
+    :description: 用户拉入黑名单(黑名单管理模式)
+    """
+
+    @filter_check_params(check_user_code=True)
+    def get_async(self):
+        """
+        :description: 用户拉入黑名单
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param user_code：用户标识
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        user_base_model = UserBaseModel(context=self)
+        invoke_result_data = user_base_model.update_user_state_by_black(app_id, act_id, user_id)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        title = "拉黑用户；用户昵称：" + invoke_result_data.data["user_nick"] + "，openid：" + invoke_result_data.data["open_id"]
+        self.create_operation_log(operation_type=OperationType.operate.value, model_name="user_info_tb", title=title)
+        ref_params = {}
+        self.business_process_executed(invoke_result_data, ref_params)
+        return self.response_json_success()
+
+
+class AuditUserBlackHandler(ClientBaseHandler):
+    """
+    :description 审核黑名单状态
+    """
+
+    @filter_check_params("black_id,audit_status")
+    def get_async(self):
+        """
+        :description: 审核黑名单状态
+        :param black_id：用户黑名单管理标识
+        :param audit_status：审核状态(0黑名单1申请中2同意3拒绝)
+        :param audit_remark：审核备注
+        :return: response_json_success
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        black_id = int(self.get_param("black_id", 0))
+        audit_status = int(self.get_param("audit_status", 0))
+        audit_remark = self.get_param("audit_remark")
+
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        user_base_model = UserBaseModel(context=self)
+        invoke_result_data = user_base_model.audit_user_black(app_id, black_id, audit_status, audit_remark)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        title = "操作审核黑名单；"
+        if audit_status == 2:
+            title = "同意解锁用户；"
+        elif audit_status == 3:
+            title = "拒绝解锁用户；"
+        title = title + "用户昵称：" + invoke_result_data.data["user_info"]["user_nick"] + "，openid：" + invoke_result_data.data["user_info"]["open_id"]
+        self.create_operation_log(operation_type=OperationType.operate.value, model_name="user_black_tb", title=title)
+        ref_params = {}
+        self.business_process_executed(invoke_result_data, ref_params)
+        return self.response_json_success()
+
+
+class UpdateAuditRemarkHandler(ClientBaseHandler):
+    """
+    :description 修改审核备注
+    """
+
+    @filter_check_params("black_id,audit_status")
+    def get_async(self):
+        """
+        :description: 修改审核备注
+        :param black_id：用户黑名单管理标识
+        :param audit_remark：审核备注
+        :return: response_json_success
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        black_id = int(self.get_param("black_id", 0))
+        audit_remark = self.get_param("audit_remark")
+        user_base_model = UserBaseModel(context=self)
+        invoke_result_data = user_base_model.update_audit_remark(app_id, black_id, audit_remark)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        title = "修改黑名单审核备注；用户昵称：" + invoke_result_data.data["user_black"]["user_nick"] + "，openid：" + invoke_result_data.data["user_black"]["open_id"]
+        self.create_operation_log(operation_type=OperationType.operate.value, model_name="user_black_tb", title=title)
+        return self.response_json_success()
+
+
+class UserBlackListHandler(ClientBaseHandler):
+    """
+    :description: 获取黑名单管理列表
+    """
+
+    def get_async(self):
+        """
+        :description: 获取黑名单管理列表
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param audit_status：审核状态(0黑名单1申请中2同意3拒绝)
+        :param user_code：用户标识
+        :param start_date：开始时间
+        :param end_date：结束时间
+        :param nick_name：用户昵称
+        :param user_open_id：open_id
+        :param page_size：条数
+        :param page_index：页数
+        :return: list
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        audit_status = int(self.get_param("audit_status", -1))
+        user_id = self.get_user_id()
+        user_nick = self.get_param("nick_name")
+        open_id = self.get_param("user_open_id")
+        start_date = self.get_param("start_date")
+        end_date = self.get_param("end_date")
+        page_size = int(self.get_param("page_size", 20))
+        page_index = int(self.get_param("page_index", 0))
+
+        user_base_model = UserBaseModel(context=self)
+        return self.response_json_success(user_base_model.get_black_list(app_id, act_id, page_size, page_index, audit_status, user_id, start_date, end_date, user_nick, open_id))
+
+
+class UpdateUserAssetHandler(ClientBaseHandler):
+    """
+    :description: 变更资产
+    """
+    @filter_check_params("asset_type,asset_value", check_user_code=True)
+    def post_async(self):
+        """
+        :description: 变更资产
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param module_id：模块标识
+        :param user_code：用户标识
+        :param asset_type：资产类型
+        :param asset_value：变更的资产值
+        :param asset_object_id：资产对象标识
+        :return: response_json_success
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        module_id = self.get_param_int("module_id", 0)
+        asset_type = self.get_param_int("asset_type", 0)
+        asset_value = self.get_param_int("asset_value", 0)
+        asset_object_id = self.get_param("asset_object_id")
+
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+
+        user_base_model = UserBaseModel(context=self)
+        user_info_dict = user_base_model.get_user_info_dict(app_id, act_id, user_id)
+        if not user_info_dict:
+            return self.response_json_error("error", "用户信息不存在")
+
+        asset_base_model = AssetBaseModel(context=self)
+        invoke_result_data = asset_base_model.update_user_asset(app_id=app_id,
+                                                                act_id=act_id,
+                                                                module_id=module_id,
+                                                                user_id=user_id,
+                                                                open_id=user_info_dict["open_id"],
+                                                                user_nick=user_info_dict["user_nick"],
+                                                                asset_type=asset_type,
+                                                                asset_value=asset_value,
+                                                                asset_object_id=asset_object_id,
+                                                                source_type=3,
+                                                                source_object_id="",
+                                                                source_object_name="手动配置",
+                                                                log_title="手动配置",
+                                                                only_id="",
+                                                                handler_name=self.__class__.__name__,
+                                                                request_code=self.request_code,
+                                                                info_json={"operate_user_id":self.get_open_id(),"operate_user_name":self.get_user_nick()
+                                                                           })
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        default_prefix = "资产配置"
+        operation_desc = ""
+        if asset_type == 1:
+            default_prefix = "次数配置"
+        elif asset_type == 2:
+            default_prefix = "积分配置"
+        elif asset_type == 3:
+            default_prefix = "价格档位配置"
+            price_gear_model = PriceGearModel(context=self)
+            asset_object_id = int(asset_object_id)
+            if asset_object_id > 0:
+                price_gear = price_gear_model.get_entity_by_id(asset_object_id)
+                if price_gear:
+                    operation_desc = "价格档位:" + price_gear.price_gear_name + "，次数：" + str(asset_value)
+        title_prefix = invoke_result_data.data["title_prefix"] if invoke_result_data.data.__contains__("title_prefix") else default_prefix
+        title = title_prefix + ";" + "用户昵称：" + user_info_dict["user_nick"] + "，openid：" + user_info_dict["open_id"]
+        self.create_operation_log(operation_type=OperationType.operate.value, model_name="user_asset_tb", title=title, operation_desc=operation_desc)
+        ref_params = {}
+        self.business_process_executed(invoke_result_data, ref_params)
+        return self.response_json_success()
+
+
+class BatchUpdateUserAssetHandler(ClientBaseHandler):
+    """
+    :description: 批量变更资产
+    """
+    @filter_check_params("asset_object_json", check_user_code=True)
+    def post_async(self):
+        """
+        :description: 批量变更资产
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param module_id：模块标识
+        :param user_code：用户标识
+        :param asset_object_json：变更的资产值列表
+        :return: response_json_success
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        module_id = self.get_param_int("module_id", 0)
+        #{"asset_type":0,"asset_object_id":"","asset_value":0}
+        asset_object_json = self.get_param("asset_object_json")
+
+        user_base_model = UserBaseModel(context=self)
+        user_info_dict = user_base_model.get_user_info_dict(app_id, act_id, user_id)
+        if not user_info_dict:
+            return self.response_json_error("error", "用户信息不存在")
+
+        asset_base_model = AssetBaseModel(context=self)
+        asset_object_json = SevenHelper.json_loads(asset_object_json)
+        asset_object_ids = ""
+        for asset_object in asset_object_json:
+            invoke_result_data = asset_base_model.update_user_asset(app_id=app_id,
+                                                                    act_id=act_id,
+                                                                    module_id=module_id,
+                                                                    user_id=user_id,
+                                                                    open_id=user_info_dict["open_id"],
+                                                                    user_nick=user_info_dict["user_nick"],
+                                                                    asset_type=int(asset_object["asset_type"]),
+                                                                    asset_value=int(asset_object["asset_value"]),
+                                                                    asset_object_id=asset_object["asset_object_id"],
+                                                                    source_type=3,
+                                                                    source_object_id="",
+                                                                    source_object_name="手动配置",
+                                                                    log_title="手动配置",
+                                                                    only_id="",
+                                                                    handler_name=self.__class__.__name__,
+                                                                    request_code=self.request_code,
+                                                                    info_json={
+                                                                        "operate_user_id": self.get_open_id(),
+                                                                        "operate_user_name": self.get_user_nick()
+                                                                    })
+            if invoke_result_data.success == False:
+                return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message, asset_object_ids)
+            else:
+                if asset_object_ids:
+                    asset_object_ids += ","
+                asset_object_ids += asset_object["asset_object_id"]
+        title = "批量变更资产配置；用户昵称：" + user_info_dict["user_nick"] + "，openid：" + user_info_dict["open_id"]
+        self.create_operation_log(operation_type=OperationType.operate.value, model_name="user_asset_tb", title=title)
+        return self.response_json_success()
+
+
+class UserAssetListHandler(ClientBaseHandler):
+    """
+    :description: 获取用户资产列表
+    """
+
+    @filter_check_params(check_user_code=True)
+    def get_async(self):
+        """
+        :description: 获取用户资产列表
+        :param act_id：活动标识
+        :param user_code：用户标识
+        :param asset_type：资产类型(1-次数2-积分3-价格档位)
+        :return list
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        asset_type = int(self.get_param("asset_type", 0))
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_success({"data": []})
+        asset_base_model = AssetBaseModel(context=self)
+        ref_params = {}
+        return self.response_json_success(self.business_process_executed(asset_base_model.get_user_asset_list(app_id, act_id, user_id, asset_type), ref_params))
+
+
+class AssetLogListHandler(ClientBaseHandler):
+    """
+    :description: 资产流水记录
+    """
+
+    def get_async(self):
+        """
+        :description: 资产流水记录
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param module_id：模块标识
+        :param asset_type：资产类型(1-次数2-积分3-价格档位)
+        :param page_size：条数
+        :param page_index：页数
+        :param user_id：用户标识
+        :param asset_object_id：资产对象标识
+        :param start_date：开始时间
+        :param end_date：结束时间
+        :param user_nick：昵称
+        :param open_id：open_id
+        :param source_type：来源类型（1-购买2-任务3-手动配置4-抽奖5-回购）
+        :param source_object_id：来源对象标识(比如来源类型是任务则对应任务类型)
+        :param operate_type：操作类型(0累计 1消耗)
+        :return list
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        module_id = self.get_param_int("module_id", 0)
+        page_index = self.get_param_int("page_index", 0)
+        page_size = self.get_param_int("page_size", 20)
+        user_id = self.get_user_id()
+        user_open_id = self.get_param("user_open_id")
+        user_nick = self.get_param("nick_name")
+        start_date = self.get_param("start_date")
+        end_date = self.get_param("end_date")
+        source_type = self.get_param_int("source_type", 0)
+        source_object_id = self.get_param("source_object_id")
+        asset_type = self.get_param_int("asset_type", 0)
+        asset_object_id = self.get_param("asset_object_id")
+        operate_type = self.get_param_int("operate_type", -1)
+
+        field = "*"
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_success({"data": []})
+        else:
+            field = invoke_result_data.data["field"] if invoke_result_data.data.__contains__("field") else "*"
+        asset_base_model = AssetBaseModel(context=self)
+        page_list, total = asset_base_model.get_asset_log_list(app_id, act_id, asset_type, page_size, page_index, user_id, asset_object_id, start_date, end_date, user_nick, user_open_id, source_type, source_object_id, field, is_cache=False, operate_type=operate_type, module_id=module_id)
+        ref_params = {}
+        page_info = PageInfo(page_index, page_size, total, self.business_process_executed(page_list, ref_params))
+        return self.response_json_success(page_info)
+
+
+class UserInfoListHandler(ClientBaseHandler):
+    """
+    :description: 用户信息列表
+    """
+
+    def get_async(self):
+        """
+        :description: 用户信息列表
+        :param act_id：活动标识
+        :param user_id：用户标识
+        :param user_open_id：_open_id
+        :param nick_name：用户昵称
+        :param user_state：_用户状态0正常1黑名单
+        :param page_index：页索引
+        :param page_size：页大小
+        :param start_date：创建时间开始
+        :param end_date：创建时间结束
+        :return PageInfo
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        open_id = self.get_param("user_open_id")
+        user_nick = self.get_param("nick_name")
+        user_state = int(self.get_param("user_state", -1))
+        page_index = int(self.get_param("page_index", 0))
+        page_size = int(self.get_param("page_size", 20))
+        start_date = self.get_param("start_date")
+        end_date = self.get_param("end_date")
+        user_base_model = UserBaseModel(context=self)
+        page_info = user_base_model.get_user_list(app_id, act_id, page_size, page_index, user_state, user_id, start_date, end_date, user_nick, open_id)
+        ref_params = {}
         return self.response_json_success(self.business_process_executed(page_info, ref_params))
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/libs/common/share_config.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/libs/common/share_config.py`

 * *Ordering differences only*

 * *Files 23% similar despite different names*

```diff
@@ -1,72 +1,72 @@
-# -*- coding: utf-8 -*-
-"""
-:Author: HuangJianYi
-:Date: 2023-02-09 18:29:31
-@LastEditTime: 2023-04-17 14:01:18
-@LastEditors: HuangJianYi
-:Description: 全局share配置
-"""
-
-import json
-import threading
-from seven_framework import config
-
-_lock = threading.Condition()
-
-
-def init_config(path):
-    """
-    :Description: 初始化配置文件
-    :param path: 配置文件路径，可使用物理路径或url
-    :return: global share_app_config
-    :last_editors: HuangJianYi
-    """
-    if path.lower().find("http://") > -1:
-        import requests
-        json_str = requests.get(path)
-    else:
-        with open(path, "r+", encoding="utf-8") as f:
-            json_str = f.read()
-    global share_app_config
-    share_app_config = json.loads(json_str)
-
-
-def set_value(key, value):
-    """
-    :Description: 设置一个全局键值配置
-    :param key:参数键名
-    :param value:参数值
-    :return: 无
-    :last_editors: HuangJianYi
-    """
-    _lock.acquire()
-    try:
-        share_app_config[key] = value
-    except:
-        raise
-    finally:
-        _lock.release()
-
-
-def get_value(key, default_value=None):
-    """
-    :Description: 获得一个全局变量,不存在则返回默认值
-    :param key:参数键名
-    :param default_value:获取不到返回的默认值
-    :return: 参数值
-    :last_editors: HuangJianYi
-    """
-    config_value = config.get_value(key)
-    if config_value == None:
-        try:
-            _lock.acquire()
-            config_value = share_app_config[key]
-            if config_value == None:
-                config_value = default_value
-        except KeyError:
-            config_value = default_value
-        except NameError:
-            config_value = default_value
-        finally:
-            _lock.release()
+# -*- coding: utf-8 -*-
+"""
+:Author: HuangJianYi
+:Date: 2023-02-09 18:29:31
+@LastEditTime: 2023-04-17 14:01:18
+@LastEditors: HuangJianYi
+:Description: 全局share配置
+"""
+
+import json
+import threading
+from seven_framework import config
+
+_lock = threading.Condition()
+
+
+def init_config(path):
+    """
+    :Description: 初始化配置文件
+    :param path: 配置文件路径，可使用物理路径或url
+    :return: global share_app_config
+    :last_editors: HuangJianYi
+    """
+    if path.lower().find("http://") > -1:
+        import requests
+        json_str = requests.get(path)
+    else:
+        with open(path, "r+", encoding="utf-8") as f:
+            json_str = f.read()
+    global share_app_config
+    share_app_config = json.loads(json_str)
+
+
+def set_value(key, value):
+    """
+    :Description: 设置一个全局键值配置
+    :param key:参数键名
+    :param value:参数值
+    :return: 无
+    :last_editors: HuangJianYi
+    """
+    _lock.acquire()
+    try:
+        share_app_config[key] = value
+    except:
+        raise
+    finally:
+        _lock.release()
+
+
+def get_value(key, default_value=None):
+    """
+    :Description: 获得一个全局变量,不存在则返回默认值
+    :param key:参数键名
+    :param default_value:获取不到返回的默认值
+    :return: 参数值
+    :last_editors: HuangJianYi
+    """
+    config_value = config.get_value(key)
+    if config_value == None:
+        try:
+            _lock.acquire()
+            config_value = share_app_config[key]
+            if config_value == None:
+                config_value = default_value
+        except KeyError:
+            config_value = default_value
+        except NameError:
+            config_value = default_value
+        finally:
+            _lock.release()
     return config_value
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/libs/customize/action_helper.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/libs/customize/action_helper.py`

 * *Ordering differences only*

 * *Files 24% similar despite different names*

```diff
@@ -1,148 +1,148 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-10-22 13:32:07
-@LastEditTime: 2022-04-26 10:02:26
-@LastEditors: HuangJianYi
-@Description: 
-"""
-from seven_framework import *
-
-class ActionHelper:
-    """
-    :description:执行帮助类 例子：执行多个方法run_func_while([lambda: act_info_model.add_entity(act_info),lambda: act_info_model.get_dict("id>0"),lambda: act_info_model.get_list("id>0")]) 或执行单个方法run_func_while(lambda: act_info_model.add_entity(act_info))
-    """
-    logger_error = Logger.get_logger_by_name("log_error")
-
-    @classmethod
-    def run_action_while(self, action, sleep_time=0.5, is_log=False, error_count_log=100, title=""):
-        """
-        :description: 无限循环执行动作
-        :param action:方法
-        :param sleep_time:异常停留时间，单位秒
-        :param is_log:是否记录日志
-        :param error_count_log:出错多少次记一次日志
-        :param title:异常标题
-        :return:无返回
-        :last_editors: HuangJianYi
-        """
-        if not action:
-            raise ValueError("参数action不能为空")
-        if not sleep_time:
-            raise ValueError("参数sleep_time不能为空")
-        run_count = 0
-        while True:
-            try:
-                if isinstance(action,list):
-                    for item in action:
-                        item()
-                else:
-                    action()
-                break
-            except Exception:
-                if is_log == True and (run_count % error_count_log == 0):
-                    self.logger_error.error(f"title:{title},ex:{traceback.format_exc()}")
-                print(title+":"+traceback.format_exc())
-            run_count+=1
-            time.sleep(sleep_time)
-
-    @classmethod
-    def run_func_while(self, func, sleep_time=0.5, is_log=False, error_count_log=100, title=""):
-        """
-        :description: 无限循环执行动作
-        :param func:方法
-        :param func:异常标题
-        :param sleep_time:异常停留时间，单位秒
-        :param is_log:是否记录日志
-        :param error_count_log:出错多少次记一次日志
-        :return:结果数据
-        :last_editors: HuangJianYi
-        """
-        if not func:
-            raise ValueError("参数func不能为空")
-        if not sleep_time:
-            raise ValueError("参数sleep_time不能为空")
-        run_count = 0
-        while True:
-            try:
-                if isinstance(func,list):
-                    result = []
-                    for item in func:
-                        result.append(item())
-                    return result
-                else:
-                    return func()
-            except Exception:
-                if is_log == True and (run_count % error_count_log == 0):
-                    self.logger_error.error(f"title:{title},ex:{traceback.format_exc()}")
-                print(title+":"+traceback.format_exc())
-            run_count+=1
-            time.sleep(sleep_time)
-
-    @classmethod
-    def run_action(self, action, sleep_time=0.5, retry_run_count=10, is_log=False, error_count_log=10, title=""):
-        """
-        :description: 限制次数执行动作
-        :param action:方法
-        :param sleep_time:异常停留时间，单位秒
-        :param retry_run_count:尝试次数
-        :param is_log:是否记录日志
-        :param error_count_log:出错多少次记一次日志
-        :param title:异常标题
-        :return:bool
-        :last_editors: HuangJianYi
-        """
-        if not action:
-            raise ValueError("参数action不能为空")
-        if not sleep_time:
-            raise ValueError("参数sleep_time不能为空")
-        run_count = 0
-        while run_count <= retry_run_count:
-            try:
-                if isinstance(action,list):
-                    for item in action:
-                        item()
-                else:
-                    action()
-                break
-            except Exception:
-                if is_log == True and (run_count % error_count_log == 0):
-                    self.logger_error.error(f"title:{title},ex:{traceback.format_exc()}")
-                print(title+":"+traceback.format_exc())
-            run_count+=1
-            time.sleep(sleep_time)
-
-    @classmethod
-    def run_func(self, func, sleep_time=0.5, retry_run_count=10, is_log=False, error_count_log=10, title=""):
-        """
-        :description: 限制次数执行动作
-        :param action:方法
-        :param sleep_time:异常停留时间，单位秒
-        :param retry_run_count:尝试次数
-        :param is_log:是否记录日志
-        :param error_count_log:出错多少次记一次日志
-        :param title:异常标题
-        :return:结果数据
-        :last_editors: HuangJianYi
-        """
-        if not func:
-            raise ValueError("参数func不能为空")
-        if not sleep_time:
-            raise ValueError("参数sleep_time不能为空")
-        run_count = 0
-        while run_count <= retry_run_count:
-            try:
-                if isinstance(func,list):
-                    result = []
-                    for item in func:
-                        result.append(item())
-                    return result
-                else:
-                    return func()
-            except Exception:
-                if is_log == True and (run_count % error_count_log == 0):
-                    self.logger_error.error(f"title:{title},ex:{traceback.format_exc()}")
-                print(title+":"+traceback.format_exc())
-            run_count+=1
-            time.sleep(sleep_time)
-        return None
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-10-22 13:32:07
+@LastEditTime: 2022-04-26 10:02:26
+@LastEditors: HuangJianYi
+@Description: 
+"""
+from seven_framework import *
+
+class ActionHelper:
+    """
+    :description:执行帮助类 例子：执行多个方法run_func_while([lambda: act_info_model.add_entity(act_info),lambda: act_info_model.get_dict("id>0"),lambda: act_info_model.get_list("id>0")]) 或执行单个方法run_func_while(lambda: act_info_model.add_entity(act_info))
+    """
+    logger_error = Logger.get_logger_by_name("log_error")
+
+    @classmethod
+    def run_action_while(self, action, sleep_time=0.5, is_log=False, error_count_log=100, title=""):
+        """
+        :description: 无限循环执行动作
+        :param action:方法
+        :param sleep_time:异常停留时间，单位秒
+        :param is_log:是否记录日志
+        :param error_count_log:出错多少次记一次日志
+        :param title:异常标题
+        :return:无返回
+        :last_editors: HuangJianYi
+        """
+        if not action:
+            raise ValueError("参数action不能为空")
+        if not sleep_time:
+            raise ValueError("参数sleep_time不能为空")
+        run_count = 0
+        while True:
+            try:
+                if isinstance(action,list):
+                    for item in action:
+                        item()
+                else:
+                    action()
+                break
+            except Exception:
+                if is_log == True and (run_count % error_count_log == 0):
+                    self.logger_error.error(f"title:{title},ex:{traceback.format_exc()}")
+                print(title+":"+traceback.format_exc())
+            run_count+=1
+            time.sleep(sleep_time)
+
+    @classmethod
+    def run_func_while(self, func, sleep_time=0.5, is_log=False, error_count_log=100, title=""):
+        """
+        :description: 无限循环执行动作
+        :param func:方法
+        :param func:异常标题
+        :param sleep_time:异常停留时间，单位秒
+        :param is_log:是否记录日志
+        :param error_count_log:出错多少次记一次日志
+        :return:结果数据
+        :last_editors: HuangJianYi
+        """
+        if not func:
+            raise ValueError("参数func不能为空")
+        if not sleep_time:
+            raise ValueError("参数sleep_time不能为空")
+        run_count = 0
+        while True:
+            try:
+                if isinstance(func,list):
+                    result = []
+                    for item in func:
+                        result.append(item())
+                    return result
+                else:
+                    return func()
+            except Exception:
+                if is_log == True and (run_count % error_count_log == 0):
+                    self.logger_error.error(f"title:{title},ex:{traceback.format_exc()}")
+                print(title+":"+traceback.format_exc())
+            run_count+=1
+            time.sleep(sleep_time)
+
+    @classmethod
+    def run_action(self, action, sleep_time=0.5, retry_run_count=10, is_log=False, error_count_log=10, title=""):
+        """
+        :description: 限制次数执行动作
+        :param action:方法
+        :param sleep_time:异常停留时间，单位秒
+        :param retry_run_count:尝试次数
+        :param is_log:是否记录日志
+        :param error_count_log:出错多少次记一次日志
+        :param title:异常标题
+        :return:bool
+        :last_editors: HuangJianYi
+        """
+        if not action:
+            raise ValueError("参数action不能为空")
+        if not sleep_time:
+            raise ValueError("参数sleep_time不能为空")
+        run_count = 0
+        while run_count <= retry_run_count:
+            try:
+                if isinstance(action,list):
+                    for item in action:
+                        item()
+                else:
+                    action()
+                break
+            except Exception:
+                if is_log == True and (run_count % error_count_log == 0):
+                    self.logger_error.error(f"title:{title},ex:{traceback.format_exc()}")
+                print(title+":"+traceback.format_exc())
+            run_count+=1
+            time.sleep(sleep_time)
+
+    @classmethod
+    def run_func(self, func, sleep_time=0.5, retry_run_count=10, is_log=False, error_count_log=10, title=""):
+        """
+        :description: 限制次数执行动作
+        :param action:方法
+        :param sleep_time:异常停留时间，单位秒
+        :param retry_run_count:尝试次数
+        :param is_log:是否记录日志
+        :param error_count_log:出错多少次记一次日志
+        :param title:异常标题
+        :return:结果数据
+        :last_editors: HuangJianYi
+        """
+        if not func:
+            raise ValueError("参数func不能为空")
+        if not sleep_time:
+            raise ValueError("参数sleep_time不能为空")
+        run_count = 0
+        while run_count <= retry_run_count:
+            try:
+                if isinstance(func,list):
+                    result = []
+                    for item in func:
+                        result.append(item())
+                    return result
+                else:
+                    return func()
+            except Exception:
+                if is_log == True and (run_count % error_count_log == 0):
+                    self.logger_error.error(f"title:{title},ex:{traceback.format_exc()}")
+                print(title+":"+traceback.format_exc())
+            run_count+=1
+            time.sleep(sleep_time)
+        return None
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/libs/customize/alipay_helper.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/libs/customize/alipay_helper.py`

 * *Ordering differences only*

 * *Files 17% similar despite different names*

```diff
@@ -1,233 +1,233 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2022-06-22 09:38:56
-@LastEditTime: 2023-02-10 09:53:56
-@LastEditors: HuangJianYi
-@Description: 支付宝支付帮助类
-"""
-from seven_framework import TimeHelper, HTTPHelper, config
-from Crypto.PublicKey import RSA
-from Crypto.Signature import PKCS1_v1_5
-from Crypto.Hash import SHA256
-from urllib.parse import quote_plus
-from base64 import decodebytes, encodebytes
-import json
-from seven_cloudapp_frame.libs.common import *
-from seven_cloudapp_frame.models.seven_model import InvokeResultData
-
-
-class AliPayRequest(object):
-    """
-    :description: 支付宝支付帮助类.使用RSA2签名,配置文件内容 "ali_pay": {"app_id": "","app_private_key": "","alipay_public_key":"","pay_notify_url":"","refund_notify_url":""}
-    """
-    def __init__(self, app_id="", app_private_key="", alipay_public_key="", debug=False):
-        """
-        :description: 初始化
-        :param app_id:支付宝分配给开发者的应用ID
-        :param app_private_key:商户密钥
-        :param alipay_public_key:支付宝公钥
-        :param notify_url:异步通知地址
-        :param debug:True沙箱 False正式环境
-        :return:
-        :last_editors: HuangJianYi
-        """
-        pay_config = share_config.get_value("ali_pay")
-        self.app_id = app_id if app_id else pay_config["app_id"]
-        app_private_key = app_private_key if app_private_key else pay_config["app_private_key"]
-        alipay_public_key = alipay_public_key if alipay_public_key else pay_config["alipay_public_key"]
-        self.app_private_key = RSA.importKey("-----BEGIN RSA PRIVATE KEY-----\n" + app_private_key + "\n-----END RSA PRIVATE KEY-----")
-        self.alipay_public_key = RSA.importKey("-----BEGIN RSA PUBLIC KEY-----\n" + alipay_public_key + "\n-----END RSA PUBLIC KEY-----")
-
-        if debug is True:
-            self.__gateway = "https://openapi.alipaydev.com/gateway.do"
-        else:
-            self.__gateway = "https://openapi.alipay.com/gateway.do"
-
-    def trade_page_pay(self, pay_order_no, subject, total_amount, notify_url, time_expire="", return_url=""):
-        """
-        :description: PC场景下单
-        :param pay_order_no:商户订单号。由商家自定义，64个字符以内，仅支持字母、数字、下划线且需保证在商户端不重复。
-        :param subject:订单标题。注意：不可使用特殊字符，如 /，=，& 等。
-        :param total_amount:订单总金额，单位为元，精确到小数点后两位，取值范围为 [0.01,100000000]。金额不能为0。
-        :param notify_url:异步通知地址
-        :param time_expire:绝对超时时间，格式为yyyy-MM-dd HH:mm:ss
-        :param return_url:同步通知地址(跳转地址),可为空
-        :return:支付地址
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        biz_content = {
-            "subject": subject,
-            "out_trade_no": pay_order_no,
-            "total_amount": total_amount,
-            "product_code": "FAST_INSTANT_TRADE_PAY",
-        }
-        if time_expire:
-            biz_content["time_expire"] = time_expire
-
-        data = self.convert_request_param("alipay.trade.page.pay", biz_content, notify_url, return_url)
-        url = self.__gateway + '?' + self.key_value_url(data)
-        response = HTTPHelper.get(url)
-        invoke_result_data.data = response.body
-        return invoke_result_data
-
-    def trade_query(self, pay_order_no, trade_no):
-        """
-        :description: 查询订单
-        :param pay_order_no:商户订单号。由商家自定义，64个字符以内，仅支持字母、数字、下划线且需保证在商户端不重复。
-        :param trade_no:支付宝支付单号
-        :return:订单信息
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        if pay_order_no:
-            biz_content = {'out_trade_no': pay_order_no}
-        if trade_no:
-            biz_content = {'trado_no': trade_no}
-        data = self.convert_request_param('alipay.trade.query', biz_content, "", "")
-        url = self.__gateway + '?' + self.key_value_url(data)
-        response = HTTPHelper.get(url)
-        response_data = json.loads(response.text)
-        if "alipay_trade_query_response" in response_data.keys():
-            if "code" in response_data["alipay_trade_query_response"]:
-                if response_data["alipay_trade_query_response"]["code"] == "10000":
-                    invoke_result_data.success = True
-                    invoke_result_data.data = response_data["alipay_trade_query_response"]
-        return invoke_result_data
-
-    def trade_close(self, pay_order_no, trade_no):
-        """
-        :description: 交易关闭 用于交易创建后，用户在一定时间内未进行支付，可调用该接口直接将未付款的交易进行关闭
-        :param pay_order_no:商户订单号。由商家自定义，64个字符以内，仅支持字母、数字、下划线且需保证在商户端不重复。
-        :param trade_no:支付宝支付单号
-        :return:
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        if pay_order_no:
-            biz_content = {'out_trade_no': pay_order_no}
-        if trade_no:
-            biz_content = {'trado_no': trade_no}
-        data = self.convert_request_param('alipay.trade.close', biz_content, "", "")
-        url = self.__gateway + '?' + self.key_value_url(data)
-        response = HTTPHelper.get(url)
-        response_data = json.loads(response.text)
-        if "alipay_trade_close_response" in response_data.keys():
-            if "code" in response_data["alipay_trade_close_response"]:
-                if response_data["alipay_trade_close_response"]["code"] == "10000":
-                    invoke_result_data.success = True
-                    invoke_result_data.data = response_data["alipay_trade_close_response"]
-        return invoke_result_data
-
-    def trade_refund(self, refund_amount, pay_order_no, trade_no, notify_url, return_url=""):
-        """
-        :description: 退款
-        :param refund_amount:退款金额
-        :param pay_order_no:商户订单号。由商家自定义，64个字符以内，仅支持字母、数字、下划线且需保证在商户端不重复。
-        :param trade_no:支付宝支付单号
-        :param notify_url:异步通知地址
-        :param return_url:同步通知地址(跳转地址),可为空
-        :return:退款结果
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        invoke_result_data.success = False
-        invoke_result_data.error_code = "fail"
-        invoke_result_data.error_message = "退款失败"
-        if pay_order_no:
-            biz_content = {'out_trade_no': pay_order_no}
-        if trade_no:
-            biz_content = {'trado_no': trade_no}
-        biz_content['refund_amount'] = refund_amount
-        data = self.convert_request_param('alipay.trade.refund', biz_content, notify_url, return_url)
-        url = self.__gateway + '?' + self.key_value_url(data)
-        response = HTTPHelper.get(url)
-        response_data = json.loads(response.text)
-        if "alipay_trade_refund_response" in response_data.keys():
-            if "code" in response_data["alipay_trade_refund_response"]:
-                if response_data["alipay_trade_refund_response"]["code"] == "10000":
-                    invoke_result_data.success = True
-                    invoke_result_data.data = response_data["alipay_trade_refund_response"]
-        return invoke_result_data
-
-    def convert_request_param(self, method, biz_content, notify_url, return_url=""):
-        """
-        :description: 转换请求参数
-        :param method:方法名
-        :param biz_content:业务内容
-        :param alipay_public_key:阿里公钥
-        :param return_url:同步地址
-        :return:请求参数字典
-        :last_editors: HuangJianYi
-        """
-        data = {"app_id": self.app_id, "method": method, "charset": "utf-8", "sign_type": "RSA2", "timestamp": TimeHelper.get_now_format_time(), "version": "1.0", "biz_content": biz_content}
-        if return_url:
-            data["return_url"] = return_url
-        if notify_url:
-            data["notify_url"] = notify_url
-        return data
-
-    def key_value_url(self, data):
-        """
-        :description: 拼接参数
-        :param data:参数字典
-        :return:拼接后的字符串
-        :last_editors: HuangJianYi
-        """
-        data.pop("sign", None)
-        unsigned_items = self.ordered_data(data)
-        quoted_string = "&".join("{0}={1}".format(k, quote_plus(v)) for k, v in unsigned_items)
-        unsigned_string = "&".join("{0}={1}".format(k, v) for k, v in unsigned_items)
-        sign = self.get_sign(unsigned_string.encode("utf-8"))
-        signed_string = quoted_string + "&sign=" + quote_plus(sign)
-        return signed_string
-
-    def ordered_data(self, data):
-        """
-        :description: 参数字典排序
-        :param data:参数字典
-        :param signature:签名值
-        :return:排序后的字符串
-        :last_editors: HuangJianYi
-        """
-        complex_keys = []
-        for key, value in data.items():
-            if isinstance(value, dict):
-                complex_keys.append(key)
-        for key in complex_keys:
-            data[key] = json.dumps(data[key], separators=(',', ':'))
-
-        return sorted([(k, v) for k, v in data.items()])
-
-    def get_sign(self, data):
-        """
-        :description: 生成签名
-        :param unsigned_string:参数拼接字符串
-        :return:签名值
-        :last_editors: HuangJianYi
-        """
-        key = self.app_private_key
-        signer = PKCS1_v1_5.new(key)
-        signature = signer.sign(SHA256.new(data))
-        sign = encodebytes(signature).decode("utf8").replace("\n", "")
-        return sign
-
-    def check_sign(self, data, signature):
-        """
-        :description: 校验签名
-        :param data:参数字典
-        :param signature:签名值
-        :return:True签名成功 False签名失败 
-        :last_editors: HuangJianYi
-        """
-        if "sign_type" in data:
-            data.pop("sign_type")
-        unsigned_items = self.ordered_data(data)
-        message = "&".join(u"{}={}".format(k, v) for k, v in unsigned_items)
-        signer = PKCS1_v1_5.new(self.alipay_public_key)
-        digest = SHA256.new()
-        digest.update(message.encode("utf8"))
-        if signer.verify(digest, decodebytes(signature.encode("utf8"))):
-            return True
-        return False
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2022-06-22 09:38:56
+@LastEditTime: 2023-02-10 09:53:56
+@LastEditors: HuangJianYi
+@Description: 支付宝支付帮助类
+"""
+from seven_framework import TimeHelper, HTTPHelper, config
+from Crypto.PublicKey import RSA
+from Crypto.Signature import PKCS1_v1_5
+from Crypto.Hash import SHA256
+from urllib.parse import quote_plus
+from base64 import decodebytes, encodebytes
+import json
+from seven_cloudapp_frame.libs.common import *
+from seven_cloudapp_frame.models.seven_model import InvokeResultData
+
+
+class AliPayRequest(object):
+    """
+    :description: 支付宝支付帮助类.使用RSA2签名,配置文件内容 "ali_pay": {"app_id": "","app_private_key": "","alipay_public_key":"","pay_notify_url":"","refund_notify_url":""}
+    """
+    def __init__(self, app_id="", app_private_key="", alipay_public_key="", debug=False):
+        """
+        :description: 初始化
+        :param app_id:支付宝分配给开发者的应用ID
+        :param app_private_key:商户密钥
+        :param alipay_public_key:支付宝公钥
+        :param notify_url:异步通知地址
+        :param debug:True沙箱 False正式环境
+        :return:
+        :last_editors: HuangJianYi
+        """
+        pay_config = share_config.get_value("ali_pay")
+        self.app_id = app_id if app_id else pay_config["app_id"]
+        app_private_key = app_private_key if app_private_key else pay_config["app_private_key"]
+        alipay_public_key = alipay_public_key if alipay_public_key else pay_config["alipay_public_key"]
+        self.app_private_key = RSA.importKey("-----BEGIN RSA PRIVATE KEY-----\n" + app_private_key + "\n-----END RSA PRIVATE KEY-----")
+        self.alipay_public_key = RSA.importKey("-----BEGIN RSA PUBLIC KEY-----\n" + alipay_public_key + "\n-----END RSA PUBLIC KEY-----")
+
+        if debug is True:
+            self.__gateway = "https://openapi.alipaydev.com/gateway.do"
+        else:
+            self.__gateway = "https://openapi.alipay.com/gateway.do"
+
+    def trade_page_pay(self, pay_order_no, subject, total_amount, notify_url, time_expire="", return_url=""):
+        """
+        :description: PC场景下单
+        :param pay_order_no:商户订单号。由商家自定义，64个字符以内，仅支持字母、数字、下划线且需保证在商户端不重复。
+        :param subject:订单标题。注意：不可使用特殊字符，如 /，=，& 等。
+        :param total_amount:订单总金额，单位为元，精确到小数点后两位，取值范围为 [0.01,100000000]。金额不能为0。
+        :param notify_url:异步通知地址
+        :param time_expire:绝对超时时间，格式为yyyy-MM-dd HH:mm:ss
+        :param return_url:同步通知地址(跳转地址),可为空
+        :return:支付地址
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        biz_content = {
+            "subject": subject,
+            "out_trade_no": pay_order_no,
+            "total_amount": total_amount,
+            "product_code": "FAST_INSTANT_TRADE_PAY",
+        }
+        if time_expire:
+            biz_content["time_expire"] = time_expire
+
+        data = self.convert_request_param("alipay.trade.page.pay", biz_content, notify_url, return_url)
+        url = self.__gateway + '?' + self.key_value_url(data)
+        response = HTTPHelper.get(url)
+        invoke_result_data.data = response.body
+        return invoke_result_data
+
+    def trade_query(self, pay_order_no, trade_no):
+        """
+        :description: 查询订单
+        :param pay_order_no:商户订单号。由商家自定义，64个字符以内，仅支持字母、数字、下划线且需保证在商户端不重复。
+        :param trade_no:支付宝支付单号
+        :return:订单信息
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        if pay_order_no:
+            biz_content = {'out_trade_no': pay_order_no}
+        if trade_no:
+            biz_content = {'trado_no': trade_no}
+        data = self.convert_request_param('alipay.trade.query', biz_content, "", "")
+        url = self.__gateway + '?' + self.key_value_url(data)
+        response = HTTPHelper.get(url)
+        response_data = json.loads(response.text)
+        if "alipay_trade_query_response" in response_data.keys():
+            if "code" in response_data["alipay_trade_query_response"]:
+                if response_data["alipay_trade_query_response"]["code"] == "10000":
+                    invoke_result_data.success = True
+                    invoke_result_data.data = response_data["alipay_trade_query_response"]
+        return invoke_result_data
+
+    def trade_close(self, pay_order_no, trade_no):
+        """
+        :description: 交易关闭 用于交易创建后，用户在一定时间内未进行支付，可调用该接口直接将未付款的交易进行关闭
+        :param pay_order_no:商户订单号。由商家自定义，64个字符以内，仅支持字母、数字、下划线且需保证在商户端不重复。
+        :param trade_no:支付宝支付单号
+        :return:
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        if pay_order_no:
+            biz_content = {'out_trade_no': pay_order_no}
+        if trade_no:
+            biz_content = {'trado_no': trade_no}
+        data = self.convert_request_param('alipay.trade.close', biz_content, "", "")
+        url = self.__gateway + '?' + self.key_value_url(data)
+        response = HTTPHelper.get(url)
+        response_data = json.loads(response.text)
+        if "alipay_trade_close_response" in response_data.keys():
+            if "code" in response_data["alipay_trade_close_response"]:
+                if response_data["alipay_trade_close_response"]["code"] == "10000":
+                    invoke_result_data.success = True
+                    invoke_result_data.data = response_data["alipay_trade_close_response"]
+        return invoke_result_data
+
+    def trade_refund(self, refund_amount, pay_order_no, trade_no, notify_url, return_url=""):
+        """
+        :description: 退款
+        :param refund_amount:退款金额
+        :param pay_order_no:商户订单号。由商家自定义，64个字符以内，仅支持字母、数字、下划线且需保证在商户端不重复。
+        :param trade_no:支付宝支付单号
+        :param notify_url:异步通知地址
+        :param return_url:同步通知地址(跳转地址),可为空
+        :return:退款结果
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        invoke_result_data.success = False
+        invoke_result_data.error_code = "fail"
+        invoke_result_data.error_message = "退款失败"
+        if pay_order_no:
+            biz_content = {'out_trade_no': pay_order_no}
+        if trade_no:
+            biz_content = {'trado_no': trade_no}
+        biz_content['refund_amount'] = refund_amount
+        data = self.convert_request_param('alipay.trade.refund', biz_content, notify_url, return_url)
+        url = self.__gateway + '?' + self.key_value_url(data)
+        response = HTTPHelper.get(url)
+        response_data = json.loads(response.text)
+        if "alipay_trade_refund_response" in response_data.keys():
+            if "code" in response_data["alipay_trade_refund_response"]:
+                if response_data["alipay_trade_refund_response"]["code"] == "10000":
+                    invoke_result_data.success = True
+                    invoke_result_data.data = response_data["alipay_trade_refund_response"]
+        return invoke_result_data
+
+    def convert_request_param(self, method, biz_content, notify_url, return_url=""):
+        """
+        :description: 转换请求参数
+        :param method:方法名
+        :param biz_content:业务内容
+        :param alipay_public_key:阿里公钥
+        :param return_url:同步地址
+        :return:请求参数字典
+        :last_editors: HuangJianYi
+        """
+        data = {"app_id": self.app_id, "method": method, "charset": "utf-8", "sign_type": "RSA2", "timestamp": TimeHelper.get_now_format_time(), "version": "1.0", "biz_content": biz_content}
+        if return_url:
+            data["return_url"] = return_url
+        if notify_url:
+            data["notify_url"] = notify_url
+        return data
+
+    def key_value_url(self, data):
+        """
+        :description: 拼接参数
+        :param data:参数字典
+        :return:拼接后的字符串
+        :last_editors: HuangJianYi
+        """
+        data.pop("sign", None)
+        unsigned_items = self.ordered_data(data)
+        quoted_string = "&".join("{0}={1}".format(k, quote_plus(v)) for k, v in unsigned_items)
+        unsigned_string = "&".join("{0}={1}".format(k, v) for k, v in unsigned_items)
+        sign = self.get_sign(unsigned_string.encode("utf-8"))
+        signed_string = quoted_string + "&sign=" + quote_plus(sign)
+        return signed_string
+
+    def ordered_data(self, data):
+        """
+        :description: 参数字典排序
+        :param data:参数字典
+        :param signature:签名值
+        :return:排序后的字符串
+        :last_editors: HuangJianYi
+        """
+        complex_keys = []
+        for key, value in data.items():
+            if isinstance(value, dict):
+                complex_keys.append(key)
+        for key in complex_keys:
+            data[key] = json.dumps(data[key], separators=(',', ':'))
+
+        return sorted([(k, v) for k, v in data.items()])
+
+    def get_sign(self, data):
+        """
+        :description: 生成签名
+        :param unsigned_string:参数拼接字符串
+        :return:签名值
+        :last_editors: HuangJianYi
+        """
+        key = self.app_private_key
+        signer = PKCS1_v1_5.new(key)
+        signature = signer.sign(SHA256.new(data))
+        sign = encodebytes(signature).decode("utf8").replace("\n", "")
+        return sign
+
+    def check_sign(self, data, signature):
+        """
+        :description: 校验签名
+        :param data:参数字典
+        :param signature:签名值
+        :return:True签名成功 False签名失败 
+        :last_editors: HuangJianYi
+        """
+        if "sign_type" in data:
+            data.pop("sign_type")
+        unsigned_items = self.ordered_data(data)
+        message = "&".join(u"{}={}".format(k, v) for k, v in unsigned_items)
+        signer = PKCS1_v1_5.new(self.alipay_public_key)
+        digest = SHA256.new()
+        digest.update(message.encode("utf8"))
+        if signer.verify(digest, decodebytes(signature.encode("utf8"))):
+            return True
+        return False
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/libs/customize/baidubce_helper.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/libs/customize/baidubce_helper.py`

 * *Ordering differences only*

 * *Files 14% similar despite different names*

```diff
@@ -1,199 +1,199 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2022-11-17 18:51:25
-@LastEditTime: 2023-04-20 17:15:41
-@LastEditors: HuangJianYi
-@Description: 
-"""
-import hashlib
-from seven_framework import *
-from seven_cloudapp_frame.libs.common import *
-from seven_cloudapp_frame.libs.customize.seven_helper import *
-from seven_cloudapp_frame.models.seven_model import InvokeResultData
-
-from baidubce.auth.bce_credentials import BceCredentials
-from baidubce.bce_client_configuration import BceClientConfiguration
-from baidubce.services.bos.bos_client import BosClient
-from baidubce.services.bos import storage_class
-
-class BaidubceHelper:
-    """
-    :description: 百度云帮助类
-    """
-    logger_error = Logger.get_logger_by_name("log_error")
-
-    @classmethod
-    def get_access_token(self):
-        """
-        :description:动态获取access_token
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        api_key = share_config.get_value("baidubce_config", {}).get("text_censor", {}).get("api_key", "")
-        secret_key = share_config.get_value("baidubce_config", {}).get("text_censor", {}).get("secret_key", "")
-        request_url = f'https://aip.baidubce.com/oauth/2.0/token?grant_type=client_credentials&client_id={api_key}&client_secret={secret_key}'
-        response = requests.get(request_url)
-        if response:
-            if "error" not in json.loads(response.text).keys():
-                access_token = json.loads(response.text)["access_token"]
-                redis_init = SevenHelper.redis_init(config_dict=config.get_value("platform_redis"))
-                redis_init.set("baidu_access_token", access_token, ex=2591000)
-                return access_token
-            else:
-                self.logger_error("【获取百度云access_token失败】" + response.text)
-        return ""
-
-    @classmethod
-    def text_censor(self, text, conclusion_types = [1]):
-        """
-        :description: 百度云文本审核
-        :param text：内容
-        :param conclusion_types：允许审核通过的结果类型（1.合规，2.不合规，3.疑似，4.审核失败）
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        access_token = SevenHelper.redis_init().get("baidu_access_token")
-        if not access_token:
-            access_token = self.get_access_token()
-        if not access_token:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "fail_access_token"
-            invoke_result_data.error_message = "无法进行文本审核"
-            return invoke_result_data
-        params = {"text": text}
-        request_url = "https://aip.baidubce.com/rest/2.0/solution/v1/text_censor/v2/user_defined"
-        request_url = request_url + "?access_token=" + access_token
-        headers = {'content-type': 'application/x-www-form-urlencoded'}
-        response = requests.post(request_url, data=params, headers=headers)
-        if response:
-            if "error_code" not in json.loads(response.text).keys():
-                conclusion_type = response.json()["conclusionType"]
-                if conclusion_type not in  conclusion_types:
-                    invoke_result_data.success = False
-                    invoke_result_data.error_code = "fail"
-                    invoke_result_data.error_message = "存在敏感词"
-                    return invoke_result_data
-                invoke_result_data.data = conclusion_type
-                return invoke_result_data
-            else:
-                self.logger_error("【百度云文本审核失败】" + response.text)
-        invoke_result_data.success = False
-        invoke_result_data.error_code = "fail"
-        invoke_result_data.error_message = "无法进行文本审核"
-        return invoke_result_data
-
-    @classmethod
-    def get_bos_client(self):
-        """
-        :description: 获取百度云存储对象的client客户端
-        """
-        baidubce_config = share_config.get_value("baidubce_config", {}).get("bos", {})
-        access_key = baidubce_config.get("access_key", "")
-        secret_key = baidubce_config.get("secret_key", "")
-        end_point = baidubce_config.get("end_point", "")
-        # 创建认证组
-        credentials = BceCredentials(access_key_id=access_key, secret_access_key=secret_key)
-        # 创建BceClientConfiguration
-        config = BceClientConfiguration(credentials=credentials, endpoint=end_point)
-        # 获取到客户端
-        bos_client = BosClient(config=config)
-        return bos_client
-
-    @classmethod
-    def context_md5(self, stream):
-        md5 = hashlib.md5()
-        md5.update(stream)
-        content_md5 = base64.standard_b64encode(md5.digest())
-        return content_md5
-
-    @classmethod
-    def put_object(self, file_name, stream):
-        """
-        :description:根据文件名上传到服务器
-        :param file_name: 文件名
-        :param stream: 二进制流
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        bos_client = self.get_bos_client()
-        baidubce_config = share_config.get_value("baidubce_config", {}).get("bos", {})
-        folder = baidubce_config.get("folder", "")
-        bucket = baidubce_config.get("bucket", "")
-        domain = baidubce_config.get("domain", "")
-        object_key = folder + "/" + str(int(time.time())) + str(uuid.uuid4()) + file_name
-        # 根据文件名上传文件
-        try:
-            result = bos_client.put_object(bucket_name=bucket, key=object_key, data=stream, content_length=len(stream), content_md5=self.context_md5(stream), storage_class=storage_class.STANDARD)
-            if result:
-                return domain + "/" + object_key
-        except Exception as e:
-            self.logger_error("【上传文件出错】" + str(traceback.format_exc()))
-        return ""
-
-    @classmethod
-    def put_object_from_file(self, file_name, local_file='', folder='', is_auto_name=True):
-        """
-        :description:根据文件名上传到服务器
-        :param file_name: 文件名
-        :param local_file: 本地文件地址
-        :param folder: 文件夹
-        :param is_auto_name: 是否生成随机文件名
-        :return: 链接地址
-        :last_editors: HuangJianYi
-        """
-        # 文件名
-        file_name = os.path.basename(local_file) if local_file != "" else file_name
-        if is_auto_name:
-            file_extension = os.path.splitext(file_name)[1]
-            file_name = UUIDHelper.get_uuid().replace("-", "") + file_extension
-        bos_client = self.get_bos_client()
-        baidubce_config = share_config.get_value("baidubce_config", {}).get("bos", {})
-        if not folder:
-            folder = baidubce_config.get("folder", "")
-        bucket = baidubce_config.get("bucket", "")
-        domain = baidubce_config.get("domain", "")
-        object_key = folder + "/" + file_name
-        try:
-            result = bos_client.put_object_from_file(bucket_name=bucket, key=object_key, file_name=local_file)
-            if result.status == 200:
-                return domain + "/" + object_key
-        except Exception as e:
-            self.logger_error("【上传文件出错】" + str(traceback.format_exc()))
-        return ""
-
-    @classmethod
-    def upload(self, file_name, is_auto_name=True, data=None):
-        """
-        :description:上传文件
-        :param file_name：文件名称
-        :param is_auto_name：是否生成随机文件名
-        :param data：需要上传的数据
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        if is_auto_name:
-            file_extension = os.path.splitext(file_name)[1]
-            file_name = UUIDHelper.get_uuid().replace("-", "") + file_extension
-        return self.put_object(file_name, data)
-
-    @classmethod
-    def export_excel(self, import_data):
-        """
-        :description: 把数据导入excel并返回下载地址
-        :param import_data:导入数据
-        :return excel下载地址
-        :last_editors: HuangJianYi
-        """
-        resource_path = ""
-        if import_data:
-            try:
-                if not os.path.exists("temp"):
-                    os.makedirs("temp")
-                path = "temp/" + UUIDHelper.get_uuid() + ".xlsx"
-                ExcelHelper.export(import_data, path)
-                resource_path = self.put_object_from_file("", path, share_config.get_value("oss_folder"), False)
-                os.remove(path)
-            except Exception as ex:
-                self.logger_error("【数据导入excel】" + traceback.format_exc())
-        return resource_path
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2022-11-17 18:51:25
+@LastEditTime: 2023-04-20 17:15:41
+@LastEditors: HuangJianYi
+@Description: 
+"""
+import hashlib
+from seven_framework import *
+from seven_cloudapp_frame.libs.common import *
+from seven_cloudapp_frame.libs.customize.seven_helper import *
+from seven_cloudapp_frame.models.seven_model import InvokeResultData
+
+from baidubce.auth.bce_credentials import BceCredentials
+from baidubce.bce_client_configuration import BceClientConfiguration
+from baidubce.services.bos.bos_client import BosClient
+from baidubce.services.bos import storage_class
+
+class BaidubceHelper:
+    """
+    :description: 百度云帮助类
+    """
+    logger_error = Logger.get_logger_by_name("log_error")
+
+    @classmethod
+    def get_access_token(self):
+        """
+        :description:动态获取access_token
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        api_key = share_config.get_value("baidubce_config", {}).get("text_censor", {}).get("api_key", "")
+        secret_key = share_config.get_value("baidubce_config", {}).get("text_censor", {}).get("secret_key", "")
+        request_url = f'https://aip.baidubce.com/oauth/2.0/token?grant_type=client_credentials&client_id={api_key}&client_secret={secret_key}'
+        response = requests.get(request_url)
+        if response:
+            if "error" not in json.loads(response.text).keys():
+                access_token = json.loads(response.text)["access_token"]
+                redis_init = SevenHelper.redis_init(config_dict=config.get_value("platform_redis"))
+                redis_init.set("baidu_access_token", access_token, ex=2591000)
+                return access_token
+            else:
+                self.logger_error("【获取百度云access_token失败】" + response.text)
+        return ""
+
+    @classmethod
+    def text_censor(self, text, conclusion_types = [1]):
+        """
+        :description: 百度云文本审核
+        :param text：内容
+        :param conclusion_types：允许审核通过的结果类型（1.合规，2.不合规，3.疑似，4.审核失败）
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        access_token = SevenHelper.redis_init().get("baidu_access_token")
+        if not access_token:
+            access_token = self.get_access_token()
+        if not access_token:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "fail_access_token"
+            invoke_result_data.error_message = "无法进行文本审核"
+            return invoke_result_data
+        params = {"text": text}
+        request_url = "https://aip.baidubce.com/rest/2.0/solution/v1/text_censor/v2/user_defined"
+        request_url = request_url + "?access_token=" + access_token
+        headers = {'content-type': 'application/x-www-form-urlencoded'}
+        response = requests.post(request_url, data=params, headers=headers)
+        if response:
+            if "error_code" not in json.loads(response.text).keys():
+                conclusion_type = response.json()["conclusionType"]
+                if conclusion_type not in  conclusion_types:
+                    invoke_result_data.success = False
+                    invoke_result_data.error_code = "fail"
+                    invoke_result_data.error_message = "存在敏感词"
+                    return invoke_result_data
+                invoke_result_data.data = conclusion_type
+                return invoke_result_data
+            else:
+                self.logger_error("【百度云文本审核失败】" + response.text)
+        invoke_result_data.success = False
+        invoke_result_data.error_code = "fail"
+        invoke_result_data.error_message = "无法进行文本审核"
+        return invoke_result_data
+
+    @classmethod
+    def get_bos_client(self):
+        """
+        :description: 获取百度云存储对象的client客户端
+        """
+        baidubce_config = share_config.get_value("baidubce_config", {}).get("bos", {})
+        access_key = baidubce_config.get("access_key", "")
+        secret_key = baidubce_config.get("secret_key", "")
+        end_point = baidubce_config.get("end_point", "")
+        # 创建认证组
+        credentials = BceCredentials(access_key_id=access_key, secret_access_key=secret_key)
+        # 创建BceClientConfiguration
+        config = BceClientConfiguration(credentials=credentials, endpoint=end_point)
+        # 获取到客户端
+        bos_client = BosClient(config=config)
+        return bos_client
+
+    @classmethod
+    def context_md5(self, stream):
+        md5 = hashlib.md5()
+        md5.update(stream)
+        content_md5 = base64.standard_b64encode(md5.digest())
+        return content_md5
+
+    @classmethod
+    def put_object(self, file_name, stream):
+        """
+        :description:根据文件名上传到服务器
+        :param file_name: 文件名
+        :param stream: 二进制流
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        bos_client = self.get_bos_client()
+        baidubce_config = share_config.get_value("baidubce_config", {}).get("bos", {})
+        folder = baidubce_config.get("folder", "")
+        bucket = baidubce_config.get("bucket", "")
+        domain = baidubce_config.get("domain", "")
+        object_key = folder + "/" + str(int(time.time())) + str(uuid.uuid4()) + file_name
+        # 根据文件名上传文件
+        try:
+            result = bos_client.put_object(bucket_name=bucket, key=object_key, data=stream, content_length=len(stream), content_md5=self.context_md5(stream), storage_class=storage_class.STANDARD)
+            if result:
+                return domain + "/" + object_key
+        except Exception as e:
+            self.logger_error("【上传文件出错】" + str(traceback.format_exc()))
+        return ""
+
+    @classmethod
+    def put_object_from_file(self, file_name, local_file='', folder='', is_auto_name=True):
+        """
+        :description:根据文件名上传到服务器
+        :param file_name: 文件名
+        :param local_file: 本地文件地址
+        :param folder: 文件夹
+        :param is_auto_name: 是否生成随机文件名
+        :return: 链接地址
+        :last_editors: HuangJianYi
+        """
+        # 文件名
+        file_name = os.path.basename(local_file) if local_file != "" else file_name
+        if is_auto_name:
+            file_extension = os.path.splitext(file_name)[1]
+            file_name = UUIDHelper.get_uuid().replace("-", "") + file_extension
+        bos_client = self.get_bos_client()
+        baidubce_config = share_config.get_value("baidubce_config", {}).get("bos", {})
+        if not folder:
+            folder = baidubce_config.get("folder", "")
+        bucket = baidubce_config.get("bucket", "")
+        domain = baidubce_config.get("domain", "")
+        object_key = folder + "/" + file_name
+        try:
+            result = bos_client.put_object_from_file(bucket_name=bucket, key=object_key, file_name=local_file)
+            if result.status == 200:
+                return domain + "/" + object_key
+        except Exception as e:
+            self.logger_error("【上传文件出错】" + str(traceback.format_exc()))
+        return ""
+
+    @classmethod
+    def upload(self, file_name, is_auto_name=True, data=None):
+        """
+        :description:上传文件
+        :param file_name：文件名称
+        :param is_auto_name：是否生成随机文件名
+        :param data：需要上传的数据
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        if is_auto_name:
+            file_extension = os.path.splitext(file_name)[1]
+            file_name = UUIDHelper.get_uuid().replace("-", "") + file_extension
+        return self.put_object(file_name, data)
+
+    @classmethod
+    def export_excel(self, import_data):
+        """
+        :description: 把数据导入excel并返回下载地址
+        :param import_data:导入数据
+        :return excel下载地址
+        :last_editors: HuangJianYi
+        """
+        resource_path = ""
+        if import_data:
+            try:
+                if not os.path.exists("temp"):
+                    os.makedirs("temp")
+                path = "temp/" + UUIDHelper.get_uuid() + ".xlsx"
+                ExcelHelper.export(import_data, path)
+                resource_path = self.put_object_from_file("", path, share_config.get_value("oss_folder"), False)
+                os.remove(path)
+            except Exception as ex:
+                self.logger_error("【数据导入excel】" + traceback.format_exc())
+        return resource_path
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/libs/customize/bloomfilter_helper.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/libs/customize/bloomfilter_helper.py`

 * *Ordering differences only*

 * *Files 23% similar despite different names*

```diff
@@ -1,72 +1,72 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-10-25 18:00:46
-@LastEditTime: 2022-04-24 14:31:41
-@LastEditors: HuangJianYi
-@Description: 
-"""
-import math
-import redis
-import mmh3
-
-
-class BloomFilterHelper():
-    """
-    :description: 布隆过滤器（Bloom Filter）是 1970 年由布隆提出的。它实际上是一个很长的二进制向量和一系列随机映射函数。布隆过滤器可以用于检索一个元素是否在一个集合中。它的优点是空间效率和查询时间都比一般的算法要好的多，缺点是有一定的误识别率和删除困难。
-    :return: 
-    :last_editors: HuangJianYi
-    """
-    #内置100个随机种子
-    SEEDS = [543, 460, 171, 876, 796, 607, 650, 81, 837, 545, 591, 946, 846, 521, 913, 636, 878, 735, 414, 372, 344, 324, 223, 180, 327, 891, 798, 933, 493, 293, 836, 10, 6, 544, 924, 849, 438, 41, 862, 648, 338, 465, 562, 693, 979, 52, 763, 103, 387, 374, 349, 94, 384, 680, 574, 480, 307, 580, 71, 535, 300, 53, 481, 519, 644, 219, 686, 236, 424, 326, 244, 212, 909, 202, 951, 56, 812, 901, 926, 250, 507, 739, 371, 63, 584, 154, 7, 284, 617, 332, 472, 140, 605, 262, 355, 526, 647, 923, 199, 518]
-
-    def __init__(self, capacity=1000000000, error_rate=0.00000001, redis_connection=None, key='bloom_filter', expire=0):
-        """
-        :description: 初始化
-        :param capacity: 预先估计要去重的数量
-        :param error_rate: 错误率
-        :param redis_connection: redis的连接客户端
-        :param key: 键的名字前缀
-        :param expire: 过期时间（单位秒）
-        :return:
-        :last_editors: HuangJianYi
-        """
-        self.m = math.ceil(capacity * math.log2(math.e) * math.log2(1 / error_rate))  #需要的总bit位数
-        self.k = math.ceil(math.log1p(2) * self.m / capacity)  #需要最少的hash次数
-        self.mem = math.ceil(self.m / 8 / 1024 / 1024)  #需要的多少M内存
-        self.blocknum = math.ceil(self.mem / 512)  #需要多少个512M的内存块,value的第一个字符必须是ascii码，所有最多有256个内存块
-        self.seeds = self.SEEDS[0:self.k]
-        self.key = key
-        self.N = 2**31 - 1
-        self.redis = redis_connection
-        self.expire = expire
-
-    def add(self, value):
-        name = self.key + "_" + str(ord(value[0]) % self.blocknum)
-        hashs = self.get_hashs(value)
-        for hash in hashs:
-            self.redis.setbit(name, hash, 1)
-        if self.expire > 0:
-            self.redis.expire(name, self.expire)
-
-
-    def is_exist(self, value):
-        name = self.key + "_" + str(ord(value[0]) % self.blocknum)
-        hashs = self.get_hashs(value)
-        exist = 1
-        for hash in hashs:
-            exist = exist & self.redis.getbit(name, hash)
-        if exist == 1:
-            return True
-        else:
-            return False
-
-    def get_hashs(self, value):
-        hashs = list()
-        for seed in self.seeds:
-            hash = mmh3.hash(value, seed)
-            if hash >= 0:
-                hashs.append(hash)
-            else:
-                hashs.append(self.N - hash)
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-10-25 18:00:46
+@LastEditTime: 2022-04-24 14:31:41
+@LastEditors: HuangJianYi
+@Description: 
+"""
+import math
+import redis
+import mmh3
+
+
+class BloomFilterHelper():
+    """
+    :description: 布隆过滤器（Bloom Filter）是 1970 年由布隆提出的。它实际上是一个很长的二进制向量和一系列随机映射函数。布隆过滤器可以用于检索一个元素是否在一个集合中。它的优点是空间效率和查询时间都比一般的算法要好的多，缺点是有一定的误识别率和删除困难。
+    :return: 
+    :last_editors: HuangJianYi
+    """
+    #内置100个随机种子
+    SEEDS = [543, 460, 171, 876, 796, 607, 650, 81, 837, 545, 591, 946, 846, 521, 913, 636, 878, 735, 414, 372, 344, 324, 223, 180, 327, 891, 798, 933, 493, 293, 836, 10, 6, 544, 924, 849, 438, 41, 862, 648, 338, 465, 562, 693, 979, 52, 763, 103, 387, 374, 349, 94, 384, 680, 574, 480, 307, 580, 71, 535, 300, 53, 481, 519, 644, 219, 686, 236, 424, 326, 244, 212, 909, 202, 951, 56, 812, 901, 926, 250, 507, 739, 371, 63, 584, 154, 7, 284, 617, 332, 472, 140, 605, 262, 355, 526, 647, 923, 199, 518]
+
+    def __init__(self, capacity=1000000000, error_rate=0.00000001, redis_connection=None, key='bloom_filter', expire=0):
+        """
+        :description: 初始化
+        :param capacity: 预先估计要去重的数量
+        :param error_rate: 错误率
+        :param redis_connection: redis的连接客户端
+        :param key: 键的名字前缀
+        :param expire: 过期时间（单位秒）
+        :return:
+        :last_editors: HuangJianYi
+        """
+        self.m = math.ceil(capacity * math.log2(math.e) * math.log2(1 / error_rate))  #需要的总bit位数
+        self.k = math.ceil(math.log1p(2) * self.m / capacity)  #需要最少的hash次数
+        self.mem = math.ceil(self.m / 8 / 1024 / 1024)  #需要的多少M内存
+        self.blocknum = math.ceil(self.mem / 512)  #需要多少个512M的内存块,value的第一个字符必须是ascii码，所有最多有256个内存块
+        self.seeds = self.SEEDS[0:self.k]
+        self.key = key
+        self.N = 2**31 - 1
+        self.redis = redis_connection
+        self.expire = expire
+
+    def add(self, value):
+        name = self.key + "_" + str(ord(value[0]) % self.blocknum)
+        hashs = self.get_hashs(value)
+        for hash in hashs:
+            self.redis.setbit(name, hash, 1)
+        if self.expire > 0:
+            self.redis.expire(name, self.expire)
+
+
+    def is_exist(self, value):
+        name = self.key + "_" + str(ord(value[0]) % self.blocknum)
+        hashs = self.get_hashs(value)
+        exist = 1
+        for hash in hashs:
+            exist = exist & self.redis.getbit(name, hash)
+        if exist == 1:
+            return True
+        else:
+            return False
+
+    def get_hashs(self, value):
+        hashs = list()
+        for seed in self.seeds:
+            hash = mmh3.hash(value, seed)
+            if hash >= 0:
+                hashs.append(hash)
+            else:
+                hashs.append(self.N - hash)
         return hashs
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/libs/customize/counter_helper.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/libs/customize/counter_helper.py`

 * *Ordering differences only*

 * *Files 14% similar despite different names*

```diff
@@ -1,172 +1,172 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-10-25 18:00:46
-@LastEditTime: 2022-12-13 15:06:40
-@LastEditors: HuangJianYi
-@Description: 
-"""
-
-from seven_framework import *
-from seven_cloudapp_frame.models.db_models.counter.counter_config_model import *
-from seven_cloudapp_frame.libs.customize.redis_helper import *
-
-
-class CounterHelper:
-    """
-    :description: 计数帮助类 配置字段说明{"expire":计数过期时间，单位秒,"计数key":{"db_connect_key": 上下文,"table_name": 表名,"id_field_name": 主键字段名,"value_field_name": 返回字段名}}
-    :sence:使用场景：1.珀莱雅H5评论列表走缓存，评论数和喜欢数又想保证计数实时 2.库存走reids并自动从数据库同步redis
-    """
-    logger_error = Logger.get_logger_by_name("log_error")
-
-    @classmethod
-    def amount(self, key_name, object_id, value, sync_update_db=True):
-        """
-        :description: 计数
-        :param key_name: 计数key
-        :param object_id: 对象标识
-        :param value: 值
-        :param sync_update_db: 是否同步更新数据库
-        :return: 
-        :last_editors: HuangJianYi 
-        """
-        try:
-            object_id = str(object_id)
-            counter_key = "counter:" + key_name
-            counter_config_model = CounterConfigModel()
-            counter_config_dict = counter_config_model.get_cache_dict("key_name=%s", params=[key_name])
-            if not counter_config_dict:
-                counter_config_dict = {}
-            key_expire = int(counter_config_dict.get("key_expire", 0))
-            if counter_config_dict.get("is_release", 0) == 0:
-                counter_config_dict = {}
-            db_connect_key = counter_config_dict.get("db_connect_key", "db_cloudapp")
-            table_name = counter_config_dict.get("table_name", "")
-            id_field_name = counter_config_dict.get("id_field_name", "")
-            value_field_name = counter_config_dict.get("value_field_name", "")
-            db_update_count = 0
-            if sync_update_db == True and table_name and id_field_name and value_field_name:
-                db = MySQLHelper(config.get_value(db_connect_key))
-                sql = f'UPDATE {table_name} SET {value_field_name}={value_field_name}+{value} WHERE {id_field_name}=' + '%s'
-                db_update_count = db.update(sql, [object_id])
-            if sync_update_db == False or (sync_update_db == True and db_update_count > 0):
-                init = RedisExHelper.init()
-                count = init.hincrby(counter_key, object_id, value)
-                if count == value:
-                    db_value = self.get_db_amount(key_name, object_id)
-                    init.hincrby(counter_key, object_id, db_value - value)
-                if key_expire > 0:
-                    init.expire(counter_key, key_expire * 3600)
-                return count
-            else:
-                return 0
-        except Exception as ex:
-            self.logger_error.error("【计数】" + traceback.format_exc())
-            return 0
-
-    @classmethod
-    def increment(self, key_name, object_id, value, sync_update_db=True):
-        """
-        :description: 增加计数
-        :param key_name: 计数key
-        :param object_id: 对象标识
-        :param value: 增加的值
-        :param sync_update_db: 是否同步更新数据库
-        :return: 
-        :last_editors: HuangJianYi 
-        """
-        return self.amount(key_name, object_id, abs(int(value)), sync_update_db)
-
-    @classmethod
-    def decrement(self, key_name, object_id, value, sync_update_db=True):
-        """
-        :description: 减少计数
-        :param key_name: 计数key
-        :param object_id: 对象标识
-        :param value: 减少的值
-        :param sync_update_db: 是否同步更新数据库
-        :return: 
-        :last_editors: HuangJianYi 
-        """
-        return self.amount(key_name, object_id, -int(value), sync_update_db)
-
-    @classmethod
-    def get_value(self, key_name, object_id):
-        """
-        :description: 获取计数值
-        :param key_name: 计数key
-        :param object_id: 对象标识
-        :return: 
-        :last_editors: HuangJianYi 
-        """
-        values = self.get_values(key_name, object_id)
-        if len(values) > 0:
-            return values[0]["value"]
-        else:
-            return 0
-
-    @classmethod
-    def get_values(self, key_name, object_ids):
-        """
-        :description: 获取计数值
-        :param key_name: 计数key
-        :param object_id: 对象标识数组
-        :return: 
-        :last_editors: HuangJianYi 
-        """
-        counter_key = "counter:" + key_name
-        values = []
-        init = RedisExHelper.init()
-        if isinstance(object_ids, str):
-            object_ids = object_ids.split(',')
-        if isinstance(object_ids, int):
-            object_ids = [str(object_ids)]
-        try:
-            counter_config_model = CounterConfigModel()
-            counter_config_dict = counter_config_model.get_cache_dict("key_name=%s", params=[key_name])
-            if not counter_config_dict:
-                counter_config_dict = {}
-            key_expire = int(counter_config_dict.get("key_expire", 0))
-            for object_id in object_ids:
-                cur_value = init.hget(counter_key, object_id)
-                if cur_value:
-                    values.append({"key": object_id, "value": int(cur_value)})
-                else:
-                    db_value = self.get_db_amount(key_name, object_id)
-                    init.hincrby(counter_key, object_id, db_value)
-                    if key_expire > 0:
-                        init.expire(counter_key, key_expire * 3600)
-                    values.append({"key": object_id, "value": db_value})
-        except Exception as ex:
-            self.logger_error.error("【获取计数值】" + traceback.format_exc())
-        return values
-
-    @classmethod
-    def get_db_amount(self, key_name, object_id):
-        """
-        :description: 获取数据库计数值
-        :param key_name: 计数key
-        :param object_id: 对象标识
-        :return: 
-        :last_editors: HuangJianYi 
-        """
-        db_value = 0
-        try:
-            counter_config_model = CounterConfigModel()
-            counter_config_dict = counter_config_model.get_cache_dict("key_name=%s", params=[key_name])
-            if not counter_config_dict or counter_config_dict["is_release"] == 0:
-                counter_config_dict = {}
-            db_connect_key = counter_config_dict.get("db_connect_key", "db_cloudapp")
-            table_name = counter_config_dict.get("table_name", "")
-            id_field_name = counter_config_dict.get("id_field_name", "")
-            value_field_name = counter_config_dict.get("value_field_name", "")
-            if table_name and id_field_name and value_field_name:
-                db = MySQLHelper(config.get_value(db_connect_key))
-                db_value = db.query(f'SELECT {value_field_name} FROM {table_name} WHERE {id_field_name}=' + '%s LIMIT 1;', params=[object_id])
-                if len(db_value) <= 0:
-                    db_value = 0
-                else:
-                    db_value = int(db_value[0][value_field_name])
-        except Exception as ex:
-            self.logger_error.error("【获取数据库计数值】" + traceback.format_exc())
-        return db_value
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-10-25 18:00:46
+@LastEditTime: 2022-12-13 15:06:40
+@LastEditors: HuangJianYi
+@Description: 
+"""
+
+from seven_framework import *
+from seven_cloudapp_frame.models.db_models.counter.counter_config_model import *
+from seven_cloudapp_frame.libs.customize.redis_helper import *
+
+
+class CounterHelper:
+    """
+    :description: 计数帮助类 配置字段说明{"expire":计数过期时间，单位秒,"计数key":{"db_connect_key": 上下文,"table_name": 表名,"id_field_name": 主键字段名,"value_field_name": 返回字段名}}
+    :sence:使用场景：1.珀莱雅H5评论列表走缓存，评论数和喜欢数又想保证计数实时 2.库存走reids并自动从数据库同步redis
+    """
+    logger_error = Logger.get_logger_by_name("log_error")
+
+    @classmethod
+    def amount(self, key_name, object_id, value, sync_update_db=True):
+        """
+        :description: 计数
+        :param key_name: 计数key
+        :param object_id: 对象标识
+        :param value: 值
+        :param sync_update_db: 是否同步更新数据库
+        :return: 
+        :last_editors: HuangJianYi 
+        """
+        try:
+            object_id = str(object_id)
+            counter_key = "counter:" + key_name
+            counter_config_model = CounterConfigModel()
+            counter_config_dict = counter_config_model.get_cache_dict("key_name=%s", params=[key_name])
+            if not counter_config_dict:
+                counter_config_dict = {}
+            key_expire = int(counter_config_dict.get("key_expire", 0))
+            if counter_config_dict.get("is_release", 0) == 0:
+                counter_config_dict = {}
+            db_connect_key = counter_config_dict.get("db_connect_key", "db_cloudapp")
+            table_name = counter_config_dict.get("table_name", "")
+            id_field_name = counter_config_dict.get("id_field_name", "")
+            value_field_name = counter_config_dict.get("value_field_name", "")
+            db_update_count = 0
+            if sync_update_db == True and table_name and id_field_name and value_field_name:
+                db = MySQLHelper(config.get_value(db_connect_key))
+                sql = f'UPDATE {table_name} SET {value_field_name}={value_field_name}+{value} WHERE {id_field_name}=' + '%s'
+                db_update_count = db.update(sql, [object_id])
+            if sync_update_db == False or (sync_update_db == True and db_update_count > 0):
+                init = RedisExHelper.init()
+                count = init.hincrby(counter_key, object_id, value)
+                if count == value:
+                    db_value = self.get_db_amount(key_name, object_id)
+                    init.hincrby(counter_key, object_id, db_value - value)
+                if key_expire > 0:
+                    init.expire(counter_key, key_expire * 3600)
+                return count
+            else:
+                return 0
+        except Exception as ex:
+            self.logger_error.error("【计数】" + traceback.format_exc())
+            return 0
+
+    @classmethod
+    def increment(self, key_name, object_id, value, sync_update_db=True):
+        """
+        :description: 增加计数
+        :param key_name: 计数key
+        :param object_id: 对象标识
+        :param value: 增加的值
+        :param sync_update_db: 是否同步更新数据库
+        :return: 
+        :last_editors: HuangJianYi 
+        """
+        return self.amount(key_name, object_id, abs(int(value)), sync_update_db)
+
+    @classmethod
+    def decrement(self, key_name, object_id, value, sync_update_db=True):
+        """
+        :description: 减少计数
+        :param key_name: 计数key
+        :param object_id: 对象标识
+        :param value: 减少的值
+        :param sync_update_db: 是否同步更新数据库
+        :return: 
+        :last_editors: HuangJianYi 
+        """
+        return self.amount(key_name, object_id, -int(value), sync_update_db)
+
+    @classmethod
+    def get_value(self, key_name, object_id):
+        """
+        :description: 获取计数值
+        :param key_name: 计数key
+        :param object_id: 对象标识
+        :return: 
+        :last_editors: HuangJianYi 
+        """
+        values = self.get_values(key_name, object_id)
+        if len(values) > 0:
+            return values[0]["value"]
+        else:
+            return 0
+
+    @classmethod
+    def get_values(self, key_name, object_ids):
+        """
+        :description: 获取计数值
+        :param key_name: 计数key
+        :param object_id: 对象标识数组
+        :return: 
+        :last_editors: HuangJianYi 
+        """
+        counter_key = "counter:" + key_name
+        values = []
+        init = RedisExHelper.init()
+        if isinstance(object_ids, str):
+            object_ids = object_ids.split(',')
+        if isinstance(object_ids, int):
+            object_ids = [str(object_ids)]
+        try:
+            counter_config_model = CounterConfigModel()
+            counter_config_dict = counter_config_model.get_cache_dict("key_name=%s", params=[key_name])
+            if not counter_config_dict:
+                counter_config_dict = {}
+            key_expire = int(counter_config_dict.get("key_expire", 0))
+            for object_id in object_ids:
+                cur_value = init.hget(counter_key, object_id)
+                if cur_value:
+                    values.append({"key": object_id, "value": int(cur_value)})
+                else:
+                    db_value = self.get_db_amount(key_name, object_id)
+                    init.hincrby(counter_key, object_id, db_value)
+                    if key_expire > 0:
+                        init.expire(counter_key, key_expire * 3600)
+                    values.append({"key": object_id, "value": db_value})
+        except Exception as ex:
+            self.logger_error.error("【获取计数值】" + traceback.format_exc())
+        return values
+
+    @classmethod
+    def get_db_amount(self, key_name, object_id):
+        """
+        :description: 获取数据库计数值
+        :param key_name: 计数key
+        :param object_id: 对象标识
+        :return: 
+        :last_editors: HuangJianYi 
+        """
+        db_value = 0
+        try:
+            counter_config_model = CounterConfigModel()
+            counter_config_dict = counter_config_model.get_cache_dict("key_name=%s", params=[key_name])
+            if not counter_config_dict or counter_config_dict["is_release"] == 0:
+                counter_config_dict = {}
+            db_connect_key = counter_config_dict.get("db_connect_key", "db_cloudapp")
+            table_name = counter_config_dict.get("table_name", "")
+            id_field_name = counter_config_dict.get("id_field_name", "")
+            value_field_name = counter_config_dict.get("value_field_name", "")
+            if table_name and id_field_name and value_field_name:
+                db = MySQLHelper(config.get_value(db_connect_key))
+                db_value = db.query(f'SELECT {value_field_name} FROM {table_name} WHERE {id_field_name}=' + '%s LIMIT 1;', params=[object_id])
+                if len(db_value) <= 0:
+                    db_value = 0
+                else:
+                    db_value = int(db_value[0][value_field_name])
+        except Exception as ex:
+            self.logger_error.error("【获取数据库计数值】" + traceback.format_exc())
+        return db_value
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/libs/customize/cryptography_helper.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/libs/customize/cryptography_helper.py`

 * *Ordering differences only*

 * *Files 20% similar despite different names*

```diff
@@ -1,162 +1,162 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-10-08 22:01:47
-@LastEditTime: 2023-04-19 15:55:32
-@LastEditors: HuangJianYi
-@Description: 
-"""
-from Crypto.Cipher import AES
-import base64
-import re
-from emoji import unicode_codes
-import hashlib
-from seven_framework import *
-
-class CryptographyHelper:
-    """
-    :description: 加密帮助类
-    :return: 
-    :last_editors: HuangJianYi
-    """
-
-    @classmethod
-    def emoji_base64_to_emoji(self, text_str):
-        """
-        :description: 把加密后的表情还原
-        :param text_str: 加密后的字符串
-        :return: 解密后的表情字符串
-        :last_editors: HuangJianYi 
-        """
-        results = re.findall('\[em_(.*?)\]', str(text_str))
-        if results:
-            for item in results:
-                text_str = str(text_str).replace("[em_{0}]".format(item), self.base64_decrypt(item))
-        return text_str
-
-    @classmethod
-    def emoji_to_emoji_base64(self, text_str):
-        """
-        :description: emoji表情转为[em_xxx]形式存于数据库,打包每一个emoji
-        :description: 性能遇到问题时重新设计转换程序
-        :param text_str: 未加密的字符串
-        :return: 解密后的表情字符串
-        :last_editors: HuangJianYi 
-        """
-        list_e = []
-        for i in text_str:
-            list_e.append(i)
-        for location, item_emoji in enumerate(text_str):
-            if item_emoji in unicode_codes.UNICODE_EMOJI["en"]:
-                emoji_base64 = self.base64_encrypt(item_emoji, "utf-8")
-                list_e[location] = "[em_" + emoji_base64 + "]"
-        return "".join(list_e)
-
-    @classmethod
-    def base64_encrypt(self, source, encoding="utf-8"):
-        """
-        :Description: base64加密
-        :param source: 需加密的字符串
-        :return: 加密后的字符串
-        :last_editors: HuangJianYi
-        """
-        if not source.strip():
-            return ""
-        cipher_text = str(base64.b64encode(source.encode(encoding=encoding)), 'utf-8')
-        return cipher_text
-
-    @classmethod
-    def base64_decrypt(self, source):
-        """
-        :Description: base64解密
-        :param source: 需加密的字符串
-        :return: 解密后的字符串
-        :last_editors: HuangJianYi
-        """
-        if not source.strip():
-            return ""
-        plain_text = str(base64.b64decode(source), 'utf-8')
-        return plain_text
-
-    @classmethod
-    def aes_encrypt(self, source, password, iv, mode=AES.MODE_CBC, pad_char='\0', encoding="utf-8"):
-        """
-        :Description: AES加密,默认CBC & ZeroPadding
-        :param source: 待加密字符串
-        :param password: 密钥
-        :param iv: 偏移量
-        :param mode: AES加密模式
-        :param pad_char: 填充字符
-        :param encoding: 编码
-        :return: 加密后的字符串
-        :last_editors: HuangJianYi
-        """
-        source = source.encode(encoding)
-        password = password.encode(encoding)
-        iv = iv.encode(encoding)
-        cryptor = AES.new(password, mode, iv)
-        # 这里密钥password 长度必须为16（AES-128）,
-        # 24（AES-192）,或者32 （AES-256）Bytes 长度
-        # 目前AES-128 足够目前使用
-        length = 16
-        count = len(source)
-        if count > 0:
-            if count < length:
-                add = (length - count)
-                source = source + (pad_char * add).encode(encoding)
-            elif count > length:
-                add = (length - (count % length))
-                source = source + (pad_char * add).encode(encoding)
-        cipher_text = cryptor.encrypt(source)
-        # 因为AES加密时候得到的字符串不一定是ascii字符集的，输出到终端或者保存时候可能存在问题
-        # 所以这里统一把加密后的字符串转化为base64
-        return str(base64.b64encode(cipher_text), encoding)
-
-    @classmethod
-    def aes_decrypt(self, source, password, iv, mode=AES.MODE_CBC, encoding="utf-8"):
-        """
-        :Description: AES解密,默认CBC
-        :param source: 待解密字符串
-        :param password: 密钥
-        :param iv: 偏移量
-        :param mode: AES加密模式
-        :param encoding: 编码
-        :return: 解密后的明文
-        :last_editors: HuangJianYi
-        """
-        try:
-            encry_text = base64.b64decode(source)
-            password = password.encode(encoding)
-            iv = iv.encode(encoding)
-            cryptor = AES.new(password, mode, iv)
-            plain_text = cryptor.decrypt(encry_text)
-            plain_text = str(plain_text, encoding)
-            index = plain_text.rindex('}') + 1
-            return plain_text[0:index]
-        except Exception as ex:
-            return ""
-
-    @classmethod
-    def signature_md5(self, request_param_dict, encrypt_key=""):
-        """
-        :description: 参数按照加密规则进行MD5加密
-        :description: 签名规则 signature_md5= ((参数1=参数1值&参数2=参数2值&signature_stamp={signature_stamp}))+密钥)进行Md5加密转小写，参数顺序按照字母表的顺序排列
-        :param request_param_dict: 请求参数字典
-        :param encrypt_key: 接口密钥
-        :return: 加密后的md5值，由于跟客户端传来的加密参数进行校验
-        """
-        request_sign_params = {}
-        for k, v in request_param_dict.items():
-            if k == "param_signature_md5":
-                continue
-            if k == "signature_md5":
-                continue
-            request_sign_params[k] = str(v).replace(" ", "_seven_").replace("(", "_seven1_").replace(")", "_seven2_")
-        request_params_sorted = sorted(request_sign_params.items(), key=lambda e: e[0], reverse=False)
-        request_message = "&".join(k + "=" + CodingHelper.url_encode(v) for k, v in request_params_sorted)
-        request_message = request_message.replace("_seven_", "%20").replace("_seven1_", "(").replace("_seven2_", ")").replace("%27", "'")
-        # MD5摘要
-        request_encrypt = hashlib.md5()
-        request_encrypt.update((request_message + str(encrypt_key)).encode("utf-8"))
-        check_request_signature_md5 = request_encrypt.hexdigest().lower()
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-10-08 22:01:47
+@LastEditTime: 2023-04-19 15:55:32
+@LastEditors: HuangJianYi
+@Description: 
+"""
+from Crypto.Cipher import AES
+import base64
+import re
+from emoji import unicode_codes
+import hashlib
+from seven_framework import *
+
+class CryptographyHelper:
+    """
+    :description: 加密帮助类
+    :return: 
+    :last_editors: HuangJianYi
+    """
+
+    @classmethod
+    def emoji_base64_to_emoji(self, text_str):
+        """
+        :description: 把加密后的表情还原
+        :param text_str: 加密后的字符串
+        :return: 解密后的表情字符串
+        :last_editors: HuangJianYi 
+        """
+        results = re.findall('\[em_(.*?)\]', str(text_str))
+        if results:
+            for item in results:
+                text_str = str(text_str).replace("[em_{0}]".format(item), self.base64_decrypt(item))
+        return text_str
+
+    @classmethod
+    def emoji_to_emoji_base64(self, text_str):
+        """
+        :description: emoji表情转为[em_xxx]形式存于数据库,打包每一个emoji
+        :description: 性能遇到问题时重新设计转换程序
+        :param text_str: 未加密的字符串
+        :return: 解密后的表情字符串
+        :last_editors: HuangJianYi 
+        """
+        list_e = []
+        for i in text_str:
+            list_e.append(i)
+        for location, item_emoji in enumerate(text_str):
+            if item_emoji in unicode_codes.UNICODE_EMOJI["en"]:
+                emoji_base64 = self.base64_encrypt(item_emoji, "utf-8")
+                list_e[location] = "[em_" + emoji_base64 + "]"
+        return "".join(list_e)
+
+    @classmethod
+    def base64_encrypt(self, source, encoding="utf-8"):
+        """
+        :Description: base64加密
+        :param source: 需加密的字符串
+        :return: 加密后的字符串
+        :last_editors: HuangJianYi
+        """
+        if not source.strip():
+            return ""
+        cipher_text = str(base64.b64encode(source.encode(encoding=encoding)), 'utf-8')
+        return cipher_text
+
+    @classmethod
+    def base64_decrypt(self, source):
+        """
+        :Description: base64解密
+        :param source: 需加密的字符串
+        :return: 解密后的字符串
+        :last_editors: HuangJianYi
+        """
+        if not source.strip():
+            return ""
+        plain_text = str(base64.b64decode(source), 'utf-8')
+        return plain_text
+
+    @classmethod
+    def aes_encrypt(self, source, password, iv, mode=AES.MODE_CBC, pad_char='\0', encoding="utf-8"):
+        """
+        :Description: AES加密,默认CBC & ZeroPadding
+        :param source: 待加密字符串
+        :param password: 密钥
+        :param iv: 偏移量
+        :param mode: AES加密模式
+        :param pad_char: 填充字符
+        :param encoding: 编码
+        :return: 加密后的字符串
+        :last_editors: HuangJianYi
+        """
+        source = source.encode(encoding)
+        password = password.encode(encoding)
+        iv = iv.encode(encoding)
+        cryptor = AES.new(password, mode, iv)
+        # 这里密钥password 长度必须为16（AES-128）,
+        # 24（AES-192）,或者32 （AES-256）Bytes 长度
+        # 目前AES-128 足够目前使用
+        length = 16
+        count = len(source)
+        if count > 0:
+            if count < length:
+                add = (length - count)
+                source = source + (pad_char * add).encode(encoding)
+            elif count > length:
+                add = (length - (count % length))
+                source = source + (pad_char * add).encode(encoding)
+        cipher_text = cryptor.encrypt(source)
+        # 因为AES加密时候得到的字符串不一定是ascii字符集的，输出到终端或者保存时候可能存在问题
+        # 所以这里统一把加密后的字符串转化为base64
+        return str(base64.b64encode(cipher_text), encoding)
+
+    @classmethod
+    def aes_decrypt(self, source, password, iv, mode=AES.MODE_CBC, encoding="utf-8"):
+        """
+        :Description: AES解密,默认CBC
+        :param source: 待解密字符串
+        :param password: 密钥
+        :param iv: 偏移量
+        :param mode: AES加密模式
+        :param encoding: 编码
+        :return: 解密后的明文
+        :last_editors: HuangJianYi
+        """
+        try:
+            encry_text = base64.b64decode(source)
+            password = password.encode(encoding)
+            iv = iv.encode(encoding)
+            cryptor = AES.new(password, mode, iv)
+            plain_text = cryptor.decrypt(encry_text)
+            plain_text = str(plain_text, encoding)
+            index = plain_text.rindex('}') + 1
+            return plain_text[0:index]
+        except Exception as ex:
+            return ""
+
+    @classmethod
+    def signature_md5(self, request_param_dict, encrypt_key=""):
+        """
+        :description: 参数按照加密规则进行MD5加密
+        :description: 签名规则 signature_md5= ((参数1=参数1值&参数2=参数2值&signature_stamp={signature_stamp}))+密钥)进行Md5加密转小写，参数顺序按照字母表的顺序排列
+        :param request_param_dict: 请求参数字典
+        :param encrypt_key: 接口密钥
+        :return: 加密后的md5值，由于跟客户端传来的加密参数进行校验
+        """
+        request_sign_params = {}
+        for k, v in request_param_dict.items():
+            if k == "param_signature_md5":
+                continue
+            if k == "signature_md5":
+                continue
+            request_sign_params[k] = str(v).replace(" ", "_seven_").replace("(", "_seven1_").replace(")", "_seven2_")
+        request_params_sorted = sorted(request_sign_params.items(), key=lambda e: e[0], reverse=False)
+        request_message = "&".join(k + "=" + CodingHelper.url_encode(v) for k, v in request_params_sorted)
+        request_message = request_message.replace("_seven_", "%20").replace("_seven1_", "(").replace("_seven2_", ")").replace("%27", "'")
+        # MD5摘要
+        request_encrypt = hashlib.md5()
+        request_encrypt.update((request_message + str(encrypt_key)).encode("utf-8"))
+        check_request_signature_md5 = request_encrypt.hexdigest().lower()
         return check_request_signature_md5
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/libs/customize/email_helper.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/libs/customize/email_helper.py`

 * *Ordering differences only*

 * *Files 12% similar despite different names*

```diff
@@ -1,58 +1,58 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2022-03-03 11:04:55
-@LastEditTime: 2022-03-03 11:49:20
-@LastEditors: HuangJianYi
-@Description: 
-"""
-from seven_framework import *
-from seven_cloudapp_frame.models.seven_model import InvokeResultData
-import smtplib
-from email.mime.text import MIMEText
-from email.utils import formataddr
-
-
-class EmailHelper:
-    """
-    :description: 邮件帮助类
-    """
-    logger_error = Logger.get_logger_by_name("log_error")
-    
-    @classmethod
-    def send(self, send_email, send_email_password, receive_emails, title, message, smtp_demain="smtp.qq.com", smtp_port=465):
-        """
-        :description:发送邮件
-        :param send_email: 发件人邮箱账号
-        :param send_email_password:发件人邮箱密码(当时申请smtp给的口令)
-        :param receive_email:收件人邮箱账号
-        :param title:标题
-        :param content:内容
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        try:
-            receive_email_list = []
-            if receive_emails:
-                receive_email_list = receive_emails.split(',')
-            if len(receive_email_list) > 0:
-                for receive_email in receive_email_list:
-                    msg = MIMEText(message,'plain','utf-8')
-                    msg['From'] = formataddr([send_email, send_email])
-                    msg['To'] = formataddr([receive_email, receive_email])
-                    msg['Subject'] = title
-
-                    server = smtplib.SMTP_SSL(smtp_demain, smtp_port)  # 发件人邮箱中的SMTP服务器，端口是465
-                    server.login(send_email, send_email_password)  # 括号中对应的是发件人邮箱账号、邮箱密码
-                    server.sendmail(send_email, [
-                        receive_email,
-                    ], msg.as_string())  # 括号中对应的是发件人邮箱账号、收件人邮箱账号、发送邮件
-                    server.quit()# 关闭连接
-        except:
-            self.logger_error.error("【send_email】" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "exception"
-            invoke_result_data.error_message = traceback.format_exc()
-            return invoke_result_data
-        return invoke_result_data
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2022-03-03 11:04:55
+@LastEditTime: 2022-03-03 11:49:20
+@LastEditors: HuangJianYi
+@Description: 
+"""
+from seven_framework import *
+from seven_cloudapp_frame.models.seven_model import InvokeResultData
+import smtplib
+from email.mime.text import MIMEText
+from email.utils import formataddr
+
+
+class EmailHelper:
+    """
+    :description: 邮件帮助类
+    """
+    logger_error = Logger.get_logger_by_name("log_error")
+    
+    @classmethod
+    def send(self, send_email, send_email_password, receive_emails, title, message, smtp_demain="smtp.qq.com", smtp_port=465):
+        """
+        :description:发送邮件
+        :param send_email: 发件人邮箱账号
+        :param send_email_password:发件人邮箱密码(当时申请smtp给的口令)
+        :param receive_email:收件人邮箱账号
+        :param title:标题
+        :param content:内容
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        try:
+            receive_email_list = []
+            if receive_emails:
+                receive_email_list = receive_emails.split(',')
+            if len(receive_email_list) > 0:
+                for receive_email in receive_email_list:
+                    msg = MIMEText(message,'plain','utf-8')
+                    msg['From'] = formataddr([send_email, send_email])
+                    msg['To'] = formataddr([receive_email, receive_email])
+                    msg['Subject'] = title
+
+                    server = smtplib.SMTP_SSL(smtp_demain, smtp_port)  # 发件人邮箱中的SMTP服务器，端口是465
+                    server.login(send_email, send_email_password)  # 括号中对应的是发件人邮箱账号、邮箱密码
+                    server.sendmail(send_email, [
+                        receive_email,
+                    ], msg.as_string())  # 括号中对应的是发件人邮箱账号、收件人邮箱账号、发送邮件
+                    server.quit()# 关闭连接
+        except:
+            self.logger_error.error("【send_email】" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "exception"
+            invoke_result_data.error_message = traceback.format_exc()
+            return invoke_result_data
+        return invoke_result_data
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/libs/customize/logistics_helper.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/libs/customize/logistics_helper.py`

 * *Ordering differences only*

 * *Files 16% similar despite different names*

```diff
@@ -1,164 +1,164 @@
-# coding=UTF-8
-"""
-@Author: HuangJianYi
-@Date: 2023-06-26 08:26:10
-@LastEditTime: 2023-07-12 18:40:33
-@LastEditors: HuangJianYi
-@Description: 物流处理类（阿里云）
-"""
-
-import requests
-from seven_cloudapp_frame.handlers.frame_base import *
-from difflib import SequenceMatcher
-
-
-class LogisticsHelper:
-    """
-    :description: 物流处理类
-    """
-    logistics_url = 'https://wuliu.market.alicloudapi.com/kdi'  # 物流信息接口
-    express_company_url = 'https://wuliu.market.alicloudapi.com/exCompany'  # 快递公司信息接口
-    logger_error = Logger.get_logger_by_name("log_error")
-    express_company_redis_key = "express_company_info"  # 快递公司redis_key
-
-    @classmethod
-    def get_logistics_info(self, express_no, express_company, recipient_phone):
-        """
-        :description: 获取物流信息
-        :param express_no：快递单号
-        :param express_company：快递公司
-        :param recipient_phone：收件人手机号
-        :return: InvokeResultData
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        try:
-            wuliu_config = share_config.get_value("wuliu_config")
-            if not wuliu_config or not wuliu_config["app_code"]:
-                invoke_result_data.success = False
-                invoke_result_data.error_message = "缺少配置信息"
-                return invoke_result_data
-            platform_redis = share_config.get_value("platform_redis") if share_config.get_value("platform_redis") else config.get_value("redis")
-            redis_init = RedisHelper.redis_init(config_dict=platform_redis, decode_responses=True)
-            # 获取redis缓存物流公司类型（缩写）
-            express_company_type = redis_init.hget(self.express_company_redis_key, express_company)
-            if not express_company_type:
-                express_company_invoke_result_data = self.get_express_company(express_no, express_company)
-                if express_company_invoke_result_data.success == False:
-                    invoke_result_data.success = False
-                    invoke_result_data.error_message = express_company_invoke_result_data.error_message
-                    return invoke_result_data
-                express_company_type = express_company_invoke_result_data.data['express_company_type']
-            if '顺丰' in express_company:
-                express_no += f":{str(recipient_phone[-4:])}"
-            url = self.logistics_url + '?' + f'no={express_no}&type={express_company_type}'
-            header = {"Authorization": 'APPCODE ' + wuliu_config["app_code"]}
-            res = requests.get(url, headers=header)
-            if res.status_code != 200:
-                error_msg = self.get_error_info(res.status_code, res.headers['X-Ca-Error-Message'])
-                invoke_result_data.success = False
-                invoke_result_data.error_message = error_msg
-                return invoke_result_data
-            else:
-                result_data = SevenHelper.json_loads(res.text)
-                if result_data['status'] == '0':
-                    invoke_result_data.data = result_data['result']
-                else:
-                    invoke_result_data.success = False
-                    if result_data['status'] == '201':
-                        invoke_result_data.error_message = "快递单号错误"
-                    elif result_data['status'] == '203':
-                        invoke_result_data.error_message = "快递公司不存在"
-                    elif result_data['status'] == '204':
-                        invoke_result_data.error_message = "快递公司识别失败"
-                    elif result_data['status'] == '205':
-                        invoke_result_data.error_message = "快递单号无法查询到信息"
-                    elif result_data['status'] == '207':
-                        invoke_result_data.error_message = "该单号被限制，错误单号"
-
-        except Exception as ex:
-            self.logger_error.error("【获取物流信息异常】" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_message = "获取物流信息异常，请联系客服"
-        return invoke_result_data
-
-    @classmethod
-    def get_express_company(self, express_no, express_company):
-        """
-        :description: 获取快递公司（根据快递单号）
-        :param express_no：快递单号
-        :param express_company：快递公司
-        :return: list
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        try:
-            wuliu_config = share_config.get_value("wuliu_config")
-            if not wuliu_config or not wuliu_config["app_code"]:
-                invoke_result_data.success = False
-                invoke_result_data.error_message = "缺少配置信息"
-                return invoke_result_data
-            url = self.express_company_url + '?' + f'no={express_no}'
-            header = {"Authorization": 'APPCODE ' + wuliu_config["app_code"]}
-            res = requests.get(url, headers=header)
-            if res.status_code != 200:
-                error_msg = self.get_error_info(res.status_code, res.headers['X-Ca-Error-Message'])
-                invoke_result_data.success = False
-                invoke_result_data.error_message = error_msg
-                return invoke_result_data
-            else:
-                result_data = SevenHelper.json_loads(res.text)
-                if result_data['status'] == '0' and result_data['list']:
-                    invoke_result_data.data = {"express_company_type": ""}  # 快递公司类型（缩写）
-                    similarity_ratio = 0  # 匹配度
-                    for express_company_dict in result_data['list']:
-                        curr_similarity_ratio = SequenceMatcher(None, express_company, express_company_dict['name']).ratio()
-                        if similarity_ratio < curr_similarity_ratio:
-                            similarity_ratio = curr_similarity_ratio
-                            invoke_result_data.data['express_company_type'] = express_company_dict['type']
-                    if not invoke_result_data.data['express_company_type']:
-                        invoke_result_data.success = False
-                        invoke_result_data.error_message = "无法匹配快递公司信息"
-                        return invoke_result_data
-                    # 匹配度超过90%，保存到redis
-                    if similarity_ratio > 0.9:
-                        platform_redis = share_config.get_value("platform_redis") if share_config.get_value("platform_redis") else config.get_value("redis")
-                        redis_init = RedisHelper.redis_init(config_dict=platform_redis)
-                        redis_init.hset(self.express_company_redis_key, express_company, str(invoke_result_data.data['express_company_type']))
-                else:
-                    invoke_result_data.success = False
-                    invoke_result_data.error_message = "未找到快递公司信息"
-                    return invoke_result_data
-        except Exception as ex:
-            self.logger_error.error("【获取快递公司（根据快递单号）】" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_message = "获取快递公司信息异常，请联系客服"
-        return invoke_result_data
-
-    @classmethod
-    def get_error_info(self, http_status_code, http_reason):
-        """
-        :description: 获取快递公司（根据快递单号）
-        :param http_status_code：http状态码
-        :param http_reason：原因
-        :return: str
-        :last_editors: HuangJianYi
-        """
-        error_msg = ""
-        if (http_status_code == 400 and http_reason == 'Invalid Param Location'):
-            error_msg = "参数错误"
-        elif (http_status_code == 400 and http_reason == 'Invalid AppCode'):
-            error_msg = "AppCode错误"
-        elif (http_status_code == 400 and http_reason == 'Invalid Url'):
-            error_msg = "请求的 Method、Path 或者环境错误"
-        elif (http_status_code == 403 and http_reason == 'Unauthorized'):
-            error_msg = "服务未被授权（或URL和Path不正确）"
-        elif (http_status_code == 403 and http_reason == 'Quota Exhausted'):
-            error_msg = "套餐包次数用完"
-        elif (http_status_code == 403 and http_reason == 'Api Market Subscription quota exhausted'):
-            error_msg = "套餐包次数用完，请续购套餐"
-        elif (http_status_code == 500):
-            error_msg = "API网关错误"
-        else:
-            error_msg = "参数名错误 或 其他错误"
+# coding=UTF-8
+"""
+@Author: HuangJianYi
+@Date: 2023-06-26 08:26:10
+@LastEditTime: 2023-07-12 18:40:33
+@LastEditors: HuangJianYi
+@Description: 物流处理类（阿里云）
+"""
+
+import requests
+from seven_cloudapp_frame.handlers.frame_base import *
+from difflib import SequenceMatcher
+
+
+class LogisticsHelper:
+    """
+    :description: 物流处理类
+    """
+    logistics_url = 'https://wuliu.market.alicloudapi.com/kdi'  # 物流信息接口
+    express_company_url = 'https://wuliu.market.alicloudapi.com/exCompany'  # 快递公司信息接口
+    logger_error = Logger.get_logger_by_name("log_error")
+    express_company_redis_key = "express_company_info"  # 快递公司redis_key
+
+    @classmethod
+    def get_logistics_info(self, express_no, express_company, recipient_phone):
+        """
+        :description: 获取物流信息
+        :param express_no：快递单号
+        :param express_company：快递公司
+        :param recipient_phone：收件人手机号
+        :return: InvokeResultData
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        try:
+            wuliu_config = share_config.get_value("wuliu_config")
+            if not wuliu_config or not wuliu_config["app_code"]:
+                invoke_result_data.success = False
+                invoke_result_data.error_message = "缺少配置信息"
+                return invoke_result_data
+            platform_redis = share_config.get_value("platform_redis") if share_config.get_value("platform_redis") else config.get_value("redis")
+            redis_init = RedisHelper.redis_init(config_dict=platform_redis, decode_responses=True)
+            # 获取redis缓存物流公司类型（缩写）
+            express_company_type = redis_init.hget(self.express_company_redis_key, express_company)
+            if not express_company_type:
+                express_company_invoke_result_data = self.get_express_company(express_no, express_company)
+                if express_company_invoke_result_data.success == False:
+                    invoke_result_data.success = False
+                    invoke_result_data.error_message = express_company_invoke_result_data.error_message
+                    return invoke_result_data
+                express_company_type = express_company_invoke_result_data.data['express_company_type']
+            if '顺丰' in express_company:
+                express_no += f":{str(recipient_phone[-4:])}"
+            url = self.logistics_url + '?' + f'no={express_no}&type={express_company_type}'
+            header = {"Authorization": 'APPCODE ' + wuliu_config["app_code"]}
+            res = requests.get(url, headers=header)
+            if res.status_code != 200:
+                error_msg = self.get_error_info(res.status_code, res.headers['X-Ca-Error-Message'])
+                invoke_result_data.success = False
+                invoke_result_data.error_message = error_msg
+                return invoke_result_data
+            else:
+                result_data = SevenHelper.json_loads(res.text)
+                if result_data['status'] == '0':
+                    invoke_result_data.data = result_data['result']
+                else:
+                    invoke_result_data.success = False
+                    if result_data['status'] == '201':
+                        invoke_result_data.error_message = "快递单号错误"
+                    elif result_data['status'] == '203':
+                        invoke_result_data.error_message = "快递公司不存在"
+                    elif result_data['status'] == '204':
+                        invoke_result_data.error_message = "快递公司识别失败"
+                    elif result_data['status'] == '205':
+                        invoke_result_data.error_message = "快递单号无法查询到信息"
+                    elif result_data['status'] == '207':
+                        invoke_result_data.error_message = "该单号被限制，错误单号"
+
+        except Exception as ex:
+            self.logger_error.error("【获取物流信息异常】" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_message = "获取物流信息异常，请联系客服"
+        return invoke_result_data
+
+    @classmethod
+    def get_express_company(self, express_no, express_company):
+        """
+        :description: 获取快递公司（根据快递单号）
+        :param express_no：快递单号
+        :param express_company：快递公司
+        :return: list
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        try:
+            wuliu_config = share_config.get_value("wuliu_config")
+            if not wuliu_config or not wuliu_config["app_code"]:
+                invoke_result_data.success = False
+                invoke_result_data.error_message = "缺少配置信息"
+                return invoke_result_data
+            url = self.express_company_url + '?' + f'no={express_no}'
+            header = {"Authorization": 'APPCODE ' + wuliu_config["app_code"]}
+            res = requests.get(url, headers=header)
+            if res.status_code != 200:
+                error_msg = self.get_error_info(res.status_code, res.headers['X-Ca-Error-Message'])
+                invoke_result_data.success = False
+                invoke_result_data.error_message = error_msg
+                return invoke_result_data
+            else:
+                result_data = SevenHelper.json_loads(res.text)
+                if result_data['status'] == '0' and result_data['list']:
+                    invoke_result_data.data = {"express_company_type": ""}  # 快递公司类型（缩写）
+                    similarity_ratio = 0  # 匹配度
+                    for express_company_dict in result_data['list']:
+                        curr_similarity_ratio = SequenceMatcher(None, express_company, express_company_dict['name']).ratio()
+                        if similarity_ratio < curr_similarity_ratio:
+                            similarity_ratio = curr_similarity_ratio
+                            invoke_result_data.data['express_company_type'] = express_company_dict['type']
+                    if not invoke_result_data.data['express_company_type']:
+                        invoke_result_data.success = False
+                        invoke_result_data.error_message = "无法匹配快递公司信息"
+                        return invoke_result_data
+                    # 匹配度超过90%，保存到redis
+                    if similarity_ratio > 0.9:
+                        platform_redis = share_config.get_value("platform_redis") if share_config.get_value("platform_redis") else config.get_value("redis")
+                        redis_init = RedisHelper.redis_init(config_dict=platform_redis)
+                        redis_init.hset(self.express_company_redis_key, express_company, str(invoke_result_data.data['express_company_type']))
+                else:
+                    invoke_result_data.success = False
+                    invoke_result_data.error_message = "未找到快递公司信息"
+                    return invoke_result_data
+        except Exception as ex:
+            self.logger_error.error("【获取快递公司（根据快递单号）】" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_message = "获取快递公司信息异常，请联系客服"
+        return invoke_result_data
+
+    @classmethod
+    def get_error_info(self, http_status_code, http_reason):
+        """
+        :description: 获取快递公司（根据快递单号）
+        :param http_status_code：http状态码
+        :param http_reason：原因
+        :return: str
+        :last_editors: HuangJianYi
+        """
+        error_msg = ""
+        if (http_status_code == 400 and http_reason == 'Invalid Param Location'):
+            error_msg = "参数错误"
+        elif (http_status_code == 400 and http_reason == 'Invalid AppCode'):
+            error_msg = "AppCode错误"
+        elif (http_status_code == 400 and http_reason == 'Invalid Url'):
+            error_msg = "请求的 Method、Path 或者环境错误"
+        elif (http_status_code == 403 and http_reason == 'Unauthorized'):
+            error_msg = "服务未被授权（或URL和Path不正确）"
+        elif (http_status_code == 403 and http_reason == 'Quota Exhausted'):
+            error_msg = "套餐包次数用完"
+        elif (http_status_code == 403 and http_reason == 'Api Market Subscription quota exhausted'):
+            error_msg = "套餐包次数用完，请续购套餐"
+        elif (http_status_code == 500):
+            error_msg = "API网关错误"
+        else:
+            error_msg = "参数名错误 或 其他错误"
         return error_msg
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/libs/customize/queue_up_helper.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/libs/customize/queue_up_helper.py`

 * *Ordering differences only*

 * *Files 11% similar despite different names*

```diff
@@ -1,702 +1,702 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-08-30 09:22:51
-@LastEditTime: 2023-07-19 18:55:04
-@LastEditors: HuangJianYi
-@Description: 排队系统帮助类
-"""
-from seven_framework import *
-from seven_cloudapp_frame.models.seven_model import *
-from seven_cloudapp_frame.libs.customize.seven_helper import *
-from seven_cloudapp_frame.libs.common import *
-
-
-class QueueUpHelper:
-    """
-    :description: 排队系统帮助类 提供获取小程序总排队人数、获取用户当前排队数、获取用户正在办理中的队列信息、加入排队、退出排队、查询单个排队情况、批量查询某用户排队情况(只包含已排队的信息)、批量查询某用户排队情况(包含已排队和未排队的信息)、更新可操作时间、签到等功能；
-    踢人规则1：第一个在办理中，第二个用户的过期时间=第一个结束时间+8*1，第三个=第一个结束时间+8*2，以此类推；第一个没在办理中，第一个过期时间是8*1，第二个是8*2，第三个是8*3，以此类推；
-    踢人规则2：如果都没有正在办理中，那么取上次办理人退出的时间作为排在第一位人员的开始时间，进行倒计时，没有上次办理人退出时间的话，则取当前第一位人员的入队时间进行倒计时；
-    """
-    logger_error = Logger.get_logger_by_name("log_error")
-    logger_info = Logger.get_logger_by_name("log_info")
-
-    @classmethod
-    def _get_zset_name(self, app_id, queue_name):
-        """
-        :description: 获取排行集合名称，集合用于排行榜，排第一的优先操作
-        :param app_id：应用标识
-        :param queue_name：队列名称
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        zset_name = "queueup_zset"
-        if app_id:
-            zset_name += "_" + str(app_id)
-        if queue_name:
-            zset_name += ":" + str(queue_name)
-        return zset_name
-
-    @classmethod
-    def _get_count_name(self, app_id, queue_name):
-        """
-        :description: 获取排队号计数名称
-        :param app_id：应用标识
-        :param queue_name：队列名称
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        count_name = "queueup_count"
-        if app_id:
-            count_name += "_" + str(app_id)
-        if queue_name:
-            count_name += ":" + str(SevenHelper.get_now_day_int()) + "_" + str(queue_name)
-        return count_name
-
-    @classmethod
-    def _get_user_hash_name(self, app_id):
-        """
-        :description: 获取用户关联队列名称
-        :param app_id：应用标识
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        hash_name = "queueup_user_list"
-        if app_id:
-            hash_name += "_" + str(app_id)
-        return hash_name
-
-    @classmethod
-    def _get_user_zset_name(self, app_id):
-        """
-        :description: 用户在小程序内的排队次数信息
-        :param app_id：应用标识
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        zset_name = "queueup_zset_user"
-        if app_id:
-            zset_name += "_" + str(app_id)
-        return zset_name
-
-    @classmethod
-    def _get_popdate_hash_name(self, app_id):
-        """
-        :description: 办理中的用户退出队列的时间列表名称
-        :param app_id：应用标识
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        hash_name = "queueup_popdate_list"
-        if app_id:
-            hash_name += "_" + str(app_id)
-        return hash_name
-
-    @classmethod
-    def _get_queue_no(self, app_id, queue_name):
-        """
-        :description: 获取排队号
-        :param app_id：应用标识
-        :param queue_name：队列名称
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        count_name = self._get_count_name(app_id, queue_name)
-        redis_init = SevenHelper.redis_init()
-        queue_no = redis_init.incr(count_name, 1)
-        redis_init.expire(count_name, 24 * 3600)
-        return queue_no
-
-    @classmethod
-    def _get_queue_num(self, app_id, queue_name):
-        """
-        :description: 获取当前排队人数
-        :param app_id：应用标识
-        :param queue_name：队列名称
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        zset_name = self._get_zset_name(app_id, queue_name)
-        redis_init = SevenHelper.redis_init()
-        return redis_init.zcard(zset_name)
-
-    @classmethod
-    def _get_app_user_num(self, app_id):
-        """
-        :description: 获取小程序总排队人数
-        :param app_id：应用标识
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        user_zset_name = self._get_user_zset_name(app_id)
-        redis_init = SevenHelper.redis_init()
-        return redis_init.zcount(user_zset_name, 1, 1000000000000)
-
-    @classmethod
-    def get_user_queue_num(self, app_id, user_id):
-        """
-        :description: 获取用户当前排队数
-        :param app_id：应用标识
-        :param user_id：用户标识
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        user_zset_name = self._get_user_zset_name(app_id)
-        redis_init = SevenHelper.redis_init()
-        return redis_init.zscore(user_zset_name, str(user_id))
-
-    @classmethod
-    def get_process_user_queue(self, app_id, user_id):
-        """
-        :description: 获取用户正在办理中的队列信息
-        :param app_id：应用标识
-        :param user_id：用户标识
-        :return: 队列信息，没有返回None
-        :last_editors: HuangJianYi
-        """
-        process_queue = None
-        invoke_result_data = self.muti_user_query(app_id, user_id)
-        if invoke_result_data.success == False:
-            return process_queue
-        else:
-            for item in invoke_result_data.data:
-                if item["progress_status"] == 2:
-                    process_queue = item
-                    break
-            return process_queue
-
-    @classmethod
-    def queue(self, app_id, queue_name, user_id, user_nick="", avatar="", queue_length=10, app_limit_user_num=500, info_dict={}, limit_user_queue_num=0):
-        """
-        :description: 加入排队
-        :param app_id：应用标识
-        :param queue_name：队列名称
-        :param user_id 用户标识
-        :param user_nick 用户昵称
-        :param avatar 头像
-        :param queue_length：队列的长度
-        :param app_limit_user_num：小程序内总排队人数上限
-        :param info_dict：信息字典,用于存储业务端需要的数据
-        :param limit_user_queue_num：限制用户可以加入的队列数
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        try:
-            acquire_lock_name = f"queueup_queue"
-            if app_id:
-                acquire_lock_name += "_" + str(app_id)
-            acquire_lock_name += ":" + str(queue_name)
-
-            acquire_lock_status, identifier = SevenHelper.redis_acquire_lock(acquire_lock_name)
-            if acquire_lock_status == False:
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "acquire_lock"
-                invoke_result_data.error_message = "系统繁忙,请稍后再试"
-                return invoke_result_data
-            redis_init = SevenHelper.redis_init()
-            if app_limit_user_num > 0 and self._get_app_user_num(app_id) >= app_limit_user_num:
-                SevenHelper.redis_release_lock(acquire_lock_name, identifier)
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "total_limit"
-                invoke_result_data.error_message = "抱歉~当前活动排队人数过多，请稍后再试"
-                return invoke_result_data
-            if limit_user_queue_num > 0 and QueueUpHelper.get_user_queue_num(app_id, user_id) >= limit_user_queue_num:
-                SevenHelper.redis_release_lock(acquire_lock_name, identifier)
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "user_limit"
-                invoke_result_data.error_message = "抱歉~当前可排队列已达上限，请稍后再试"
-                return invoke_result_data
-
-            zset_name = self._get_zset_name(app_id, queue_name)
-            data = str(user_id)
-            expire_time = 7 * 24 * 3600
-            if not redis_init.zscore(zset_name, data):
-                if self._get_queue_num(app_id, queue_name) >= queue_length:
-                    SevenHelper.redis_release_lock(acquire_lock_name, identifier)
-                    invoke_result_data.success = False
-                    invoke_result_data.error_code = "queue_limit"
-                    invoke_result_data.error_message = "排队失败,当前排队人数已达上限"
-                    return invoke_result_data
-                queue_no = int(str(SevenHelper.get_now_day_int()) + str(self._get_queue_no(app_id, queue_name)).zfill(4))
-                redis_init.zadd(zset_name, {data: queue_no})
-                redis_init.expire(zset_name, expire_time)
-
-                user_zset_name = self._get_user_zset_name(app_id)
-                redis_init.zincrby(user_zset_name, 1, data)
-                redis_init.expire(user_zset_name, expire_time)
-
-                start_timestamp = TimeHelper.get_now_timestamp()
-
-                hash_value = {}
-                hash_value["queue_name"] = queue_name  #排队名称
-                hash_value["queue_no"] = queue_no  #排队号
-                hash_value["user_id"] = data  #用户标识
-                hash_value["user_nick"] = user_nick  #用户昵称
-                hash_value["avatar"] = avatar  #头像
-                hash_value["progress_status"] = 1  #进度0未排队1已排队2办理中
-                hash_value["queue_timestamp"] = start_timestamp  #入队时间搓
-                hash_value["queue_date"] = TimeHelper.timestamp_to_format_time(start_timestamp)  #入队时间
-                hash_value["info_json"] = info_dict
-
-                queue_index = int(redis_init.zrank(zset_name, data)) + 1
-                if queue_index == 1:
-                    redis_init.hdel(self._get_popdate_hash_name(app_id), zset_name)
-                #添加排队信息
-                hash_name = self._get_user_hash_name(app_id)
-                hash_key = f"userid_{data}_queuename_{queue_name}"
-                redis_init.hsetnx(hash_name, hash_key, SevenHelper.json_dumps(hash_value))
-                redis_init.expire(hash_name, expire_time)
-
-                result_data = {}
-                result_data["queue_no"] = hash_value["queue_no"]  #排队号
-                result_data["queue_num"] = self._get_queue_num(app_id, queue_name)  #当前排队人数
-                result_data["queue_index"] = queue_index  #当前位置
-                result_data["before_num"] = queue_index - 1  #排在前面的人数
-                invoke_result_data.data = result_data
-
-                SevenHelper.redis_release_lock(acquire_lock_name, identifier)
-                return invoke_result_data
-            else:
-                SevenHelper.redis_release_lock(acquire_lock_name, identifier)
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "error"
-                invoke_result_data.error_message = "您已在队列中，请勿重复排队"
-                return invoke_result_data
-        except Exception as ex:
-            self.logger_error.error("【加入排队】" + traceback.format_exc())
-            SevenHelper.redis_release_lock(acquire_lock_name, identifier)
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "对不起，加入队列失败，请稍后再试"
-            return invoke_result_data
-
-    @classmethod
-    def _set_last_pop_date(self,app_id, redis_init, hash_key):
-        """
-        :description: 设置办理中的用户退出队列的时间
-        :param app_id：应用标识
-        :param redis_init：redis_init
-        :param hash_key：hash_key
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        hash_name = self._get_popdate_hash_name(app_id)
-        redis_init.hset(hash_name, hash_key, str(TimeHelper.get_now_timestamp()))
-        redis_init.expire(hash_name, 7 * 24 * 3600)
-
-    @classmethod
-    def pop(self, app_id, queue_name, user_id):
-        """
-        :description: 退出排队
-        :param app_id：应用标识
-        :param queue_name：队列名称
-        :param user_id 用户标识
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        try:
-            cache_key = f"queueup_pop"
-            if app_id:
-                cache_key += "_" + str(app_id)
-            cache_key += ":" + str(queue_name) + "_" + str(user_id)
-            if SevenHelper.is_continue_request(cache_key, expire=1 * 1000) == True:
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "error"
-                invoke_result_data.error_message = "对不起,请1秒后再试"
-                return invoke_result_data
-            zset_name = self._get_zset_name(app_id, queue_name)
-            data = str(user_id)
-            redis_init = SevenHelper.redis_init()
-            if redis_init.zscore(zset_name, data):
-                if int(redis_init.zrank(zset_name, data)) + 1 == 1:
-                    self._set_last_pop_date(app_id,redis_init, zset_name)
-                redis_init.zrem(zset_name, data)
-                redis_init.zincrby(self._get_user_zset_name(app_id), -1, data)
-                redis_init.hdel(self._get_user_hash_name(app_id), f"userid_{data}_queuename_{queue_name}")
-                return invoke_result_data
-            else:
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "error"
-                invoke_result_data.error_message = "未查到该用户的排队情况,请先排队"
-                return invoke_result_data
-        except Exception as ex:
-            self.logger_error.error("【退出排队】" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "退出排队失败"
-            return invoke_result_data
-
-    @classmethod
-    def pop_by_queue_name(self, app_id, queue_name):
-        """
-        :description: 将过期用户从队列中退出
-        :param app_id：应用标识
-        :param queue_name：队列名称
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        if SevenHelper.is_continue_request(f"pop_by_queue_name:{app_id}_{queue_name}", 200) == False:
-            try:
-                redis_init = SevenHelper.redis_init()
-                zset_name = self._get_zset_name(app_id, queue_name)
-                hash_name = self._get_user_hash_name(app_id)
-                value_list = redis_init.zrange(zset_name, 0, 1000)
-                if len(value_list) > 0:
-                    now_timestamp = TimeHelper.get_now_timestamp()
-                    first_is_process = False
-                    first_end_timestamp = 0
-                    first_hash_key = f"userid_{value_list[0]}_queuename_{queue_name}"
-                    first_hash_value = redis_init.hget(hash_name, first_hash_key)
-                    if first_hash_value:
-                        first_hash_value = SevenHelper.json_loads(first_hash_value)
-                        if first_hash_value["progress_status"] == 2:
-                            first_is_process = True
-                            first_end_timestamp = first_hash_value["end_timestamp"]
-                    hash_key_list = []
-                    for data in value_list:
-                        hash_key = f"userid_{data}_queuename_{queue_name}"
-                        hash_key_list.append(hash_key)
-                    string_list = redis_init.hmget(hash_name, hash_key_list)
-                    hash_value_list = []
-                    if len(string_list) > 0:
-                        for item in string_list:
-                            value = SevenHelper.json_loads(item)
-                            if value:
-                                hash_value_list.append(value)
-                    for i in range(len(value_list)):
-                        data = value_list[i]
-                        hash_value = [hash_value for hash_value in hash_value_list if hash_value["user_id"] == data]
-                        if len(hash_value) > 0:
-                            hash_value = hash_value[0]
-                        is_delete = False
-                        if hash_value:
-                            if first_is_process == True and i == 0:
-                                if now_timestamp > hash_value["end_timestamp"]:
-                                    is_delete = True
-                                    self.logger_info.info("【踢掉办理用户1】" + SevenHelper.json_dumps({"zset_name": zset_name, "first_hash_value": first_hash_value, "user_id": data, "now_timestamp": now_timestamp, "pop_timestamp": hash_value["end_timestamp"]}))
-                            elif first_is_process == True and i > 0:
-                                if now_timestamp > first_end_timestamp + (i * int(share_config.get_value("queue_confirm_time", 8))):
-                                    is_delete = True
-                                    self.logger_info.info("【踢掉办理用户2】" + SevenHelper.json_dumps({"zset_name": zset_name, "first_hash_value": first_hash_value, "user_id": data, "now_timestamp": now_timestamp, "pop_timestamp": first_end_timestamp + (i * int(share_config.get_value("queue_confirm_time", 8)))}))
-                            else:
-                                pop_timestamp = redis_init.hget(self._get_popdate_hash_name(app_id), zset_name)
-                                if pop_timestamp:
-                                    pop_timestamp = int(pop_timestamp)
-                                else:
-                                    pop_timestamp = hash_value["queue_timestamp"]
-                                if now_timestamp > pop_timestamp + ((i + 1) * int(share_config.get_value("queue_confirm_time", 8))):
-                                    is_delete = True
-                                    self.logger_info.info("【踢掉办理用户3】" + SevenHelper.json_dumps({"zset_name": zset_name, "first_hash_value": first_hash_value, "user_id": data, "now_timestamp": now_timestamp, "pop_timestamp": pop_timestamp + ((i + 1) * int(share_config.get_value("queue_confirm_time", 8)))}))
-
-                        if is_delete == True:
-                            self._set_last_pop_date(app_id, redis_init, zset_name)
-                            redis_init.hdel(hash_name, f"userid_{data}_queuename_{queue_name}")
-                            redis_init.zrem(zset_name, data)
-                            redis_init.zincrby(self._get_user_zset_name(app_id), -1, data)
-            except Exception as ex:
-                self.logger_error.error("【删除未操作的排队信息】" + traceback.format_exc())
-
-    @classmethod
-    def pop_by_user_id(self, app_id, user_id, progress_status=1):
-        """
-        :description: 指定用户退出参与的队列
-        :param app_id：应用标识
-        :param user_id：用户标识
-        :param progress_status：0-全部 1-已排队 2-办理中
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        if SevenHelper.is_continue_request(f"pop_by_user_id:{app_id}_{user_id}", 200) == False:
-            redis_init = SevenHelper.redis_init()
-            data = str(user_id)
-            hash_name = self._get_user_hash_name(app_id)
-            match_result = redis_init.hscan_iter(hash_name, match=f'userid_{data}_*')
-            for item in match_result:
-                hash_value = SevenHelper.json_loads(item[1])
-                if progress_status > 0 and hash_value["progress_status"] != progress_status:
-                    continue
-                self.pop(app_id, hash_value["queue_name"], data)
-
-    @classmethod
-    def query(self, app_id, queue_name, user_id):
-        """
-        :description: 查询某用户排队情况
-        :param app_id：应用标识
-        :param queue_name：队列名称
-        :param user_id：用户标识
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        try:
-            redis_init = SevenHelper.redis_init()
-            zset_name = self._get_zset_name(app_id, queue_name)
-            data = str(user_id)
-            #踢掉过期用户
-            self.pop_by_queue_name(app_id, queue_name)
-            #删除用户排队次数小于等于0的数据
-            redis_init.zremrangebyscore(self._get_user_zset_name(app_id), -10, 0)
-
-            #判断是否存在排队信息
-            score = redis_init.zscore(zset_name, data)
-            index = redis_init.zrank(zset_name, data)
-            if score and index is not None:
-                query_user = {}
-                query_user["queue_name"] = queue_name  #队列名称
-                query_user["queue_no"] = int(score)  #排队号
-                query_user["total_num"] = self._get_queue_num(app_id, queue_name)  #总排队人数
-                query_user["queue_index"] = int(index) + 1  #当前位置
-                query_user["before_num"] = query_user["queue_index"] - 1  #排在前面的人数
-                hash_value = redis_init.hget(self._get_user_hash_name(app_id), f"userid_{data}_queuename_{queue_name}")
-                hash_value = SevenHelper.json_loads(hash_value) if hash_value else {}
-                query_user["user_id"] = hash_value["user_id"] if hash_value.__contains__("user_id") else ''
-                query_user["user_nick"] = hash_value["user_nick"] if hash_value.__contains__("user_nick") else ''
-                query_user["avatar"] = hash_value["avatar"] if hash_value.__contains__("avatar") else ''
-                query_user["start_date"] = hash_value["start_date"] if hash_value.__contains__("start_date") else ''
-                query_user["end_date"] = hash_value["end_date"] if hash_value.__contains__("end_date") else ''
-                query_user["queue_date"] = hash_value["queue_date"] if hash_value.__contains__("queue_date") else ''
-                query_user["queue_timestamp"] = hash_value["queue_timestamp"] if hash_value.__contains__("queue_timestamp") else 0
-                query_user["progress_status"] = hash_value["progress_status"] if hash_value.__contains__("progress_status") else 0  #进度0未排队1已排队2办理中
-                query_user["info_json"] = hash_value["info_json"] if hash_value.__contains__("info_json") else {}
-                invoke_result_data.data = query_user
-                return invoke_result_data
-            else:
-                query_user = {}
-                query_user["queue_name"] = queue_name  #队列名称
-                query_user["progress_status"] = 0  #进度0未排队1已排队2办理中
-                query_user["before_num"] = self._get_queue_num(app_id, queue_name)  #排在前面的人数
-                invoke_result_data.data = query_user
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "error"
-                invoke_result_data.error_message = "您当前不在队列中，请先排队"
-                return invoke_result_data
-        except Exception as ex:
-            self.logger_error.error("【查询某用户排队情况】" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "您当前不在队列中，请先排队"
-            return invoke_result_data
-
-    @classmethod
-    def query_all(self, app_id, queue_name):
-        """
-        :description: 查询指定队列的所有用户信息
-        :param app_id：应用标识
-        :param queue_name：队列名称
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        invoke_result_data.data = []
-        zset_name = self._get_zset_name(app_id, queue_name)
-        redis_init = SevenHelper.redis_init()
-        user_id_list = redis_init.zrange(zset_name,0,-1)
-        if len(user_id_list) <= 0:
-            return invoke_result_data
-        for user_id in user_id_list:
-            query_invoke_result_data = self.query(app_id, queue_name, user_id)
-            if query_invoke_result_data.success == True:
-                invoke_result_data.data.append(query_invoke_result_data.data)
-        return invoke_result_data
-
-    @classmethod
-    def muti_user_query(self, app_id, user_id):
-        """
-        :description: 批量查询某用户排队情况(只包含已排队的信息)
-        :param app_id：应用标识
-        :param user_id：用户标识
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        invoke_result_data.data = []
-        try:
-            redis_init = SevenHelper.redis_init()
-            hash_name = self._get_user_hash_name(app_id)
-            data = str(user_id)
-            match_result = redis_init.hscan_iter(hash_name, match=f'userid_{data}_*')
-            for item in match_result:
-                hash_value = SevenHelper.json_loads(item[1])
-                query_invoke_result_data = self.query(app_id, hash_value["queue_name"], user_id)
-                if query_invoke_result_data.success == True:
-                    invoke_result_data.data.append(query_invoke_result_data.data)
-            return invoke_result_data
-        except Exception as ex:
-            self.logger_error.error("【批量查询某用户排队情况】" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "您当前不在队列中，请先排队"
-            return invoke_result_data
-
-    @classmethod
-    def muti_queue_query(self, app_id, queue_name_list, user_id):
-        """
-        :description: 批量查询某用户排队情况(包含已排队和未排队的信息)
-        :param app_id：应用标识
-        :param queue_name_list：查询队列集合
-        :param user_id：用户标识
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        invoke_result_data.data = []
-        try:
-            for queue_name in queue_name_list:
-                query_invoke_result_data = self.query(app_id, queue_name, user_id)
-                invoke_result_data.data.append(query_invoke_result_data.data)
-            return invoke_result_data
-        except Exception as ex:
-            self.logger_error.error("【批量查询排队情况】" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "未查到排队情况"
-            return invoke_result_data
-
-    @classmethod
-    def update_time(self, app_id, queue_name, user_id, operate_time=0,is_reset=False):
-        """
-        :description: 更新可操作时间，用于操作倒计时，时间到则踢出队列
-        :param app_id：应用标识
-        :param queue_name：队列名称
-        :param user_id：用户标识
-        :param operate_time：增加的操作时间，单位秒
-        :param is_reset：是否重置开始时间和结束时间
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        try:
-            redis_init = SevenHelper.redis_init()
-            zset_name = self._get_zset_name(app_id, queue_name)
-            data = str(user_id)
-            score = redis_init.zscore(zset_name, data)
-            if score and operate_time > 0:
-                hash_name = self._get_user_hash_name(app_id)
-                hash_key = f"userid_{data}_queuename_{queue_name}"
-                hash_value = redis_init.hget(hash_name, hash_key)
-                if not hash_value:
-                    invoke_result_data.success = False
-                    invoke_result_data.error_code = "error"
-                    invoke_result_data.error_message = "更新可操作时间失败"
-                    return invoke_result_data
-                hash_value = SevenHelper.json_loads(hash_value)
-                if hash_value["progress_status"] != 2:
-                    invoke_result_data.success = False
-                    invoke_result_data.error_code = "error"
-                    invoke_result_data.error_message = "未签到,不能更新可操作时间"
-                    return invoke_result_data
-                if is_reset == True:
-                    start_timestamp = TimeHelper.get_now_timestamp()
-                    hash_value["start_timestamp"] = start_timestamp
-                    hash_value["start_date"] = TimeHelper.timestamp_to_format_time(start_timestamp)
-                    end_timestamp = start_timestamp + int(operate_time)
-                    hash_value["end_timestamp"] = end_timestamp
-                    hash_value["end_date"] = TimeHelper.timestamp_to_format_time(end_timestamp)
-                else:
-                    queue_operate_total_time = int(share_config.get_value("queue_operate_total_time", 0))
-                    now_date = TimeHelper.get_now_datetime()
-                    expire_date = TimeHelper.timestamp_to_datetime(hash_value["end_timestamp"])
-                    if expire_date > now_date and queue_operate_total_time > 0:
-                        remain_time = TimeHelper.difference_seconds(expire_date, now_date)
-                        operate_time = queue_operate_total_time - remain_time if remain_time + operate_time > queue_operate_total_time else operate_time
-                    end_timestamp = hash_value["end_timestamp"] + int(operate_time)
-                    hash_value["end_timestamp"] = end_timestamp
-                    hash_value["end_date"] = TimeHelper.timestamp_to_format_time(end_timestamp)
-                redis_init.hset(hash_name, hash_key, SevenHelper.json_dumps(hash_value))
-            return invoke_result_data
-        except Exception as ex:
-            self.logger_error.error("【更新可操作时间】" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "更新可操作时间失败"
-            return invoke_result_data
-
-    @classmethod
-    def sign(self, app_id, queue_name, user_id, pop_other_queue=True):
-        """
-        :description: 签到操作（证明排队的人做出应答，开始办理业务，更新开始操作时间）
-        :param app_id：应用标识
-        :param queue_name：队列名称
-        :param user_id：用户标识
-        :param pop_other_queue：是否退出其他正在排队的队列，True是False否
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        try:
-            acquire_lock_name = f"queueup_sign"
-            if app_id:
-                acquire_lock_name += "_" + str(app_id)
-            acquire_lock_name += ":" + str(queue_name)
-            acquire_lock_name += ":" + str(user_id)
-            acquire_lock_status, identifier = SevenHelper.redis_acquire_lock(acquire_lock_name)
-            if acquire_lock_status == False:
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "acquire_lock"
-                invoke_result_data.error_message = "系统繁忙,请稍后再试"
-                return invoke_result_data
-
-            redis_init = SevenHelper.redis_init()
-            zset_name = self._get_zset_name(app_id, queue_name)
-            data = str(user_id)
-            #判断是否存在排队信息
-            score = redis_init.zscore(zset_name, data)
-            if score:
-                queue_index = int(redis_init.zrank(zset_name, data)) + 1  #当前位置
-                if queue_index != 1:
-                    SevenHelper.redis_release_lock(acquire_lock_name, identifier)
-                    invoke_result_data.success = False
-                    invoke_result_data.error_code = "error"
-                    invoke_result_data.error_message = "前面还有人在队列中，请耐心等待"
-                    return invoke_result_data
-                start_timestamp = TimeHelper.get_now_timestamp()
-                end_timestamp = start_timestamp + int(share_config.get_value("queue_operate_time", 300))  #操作时间，单位秒
-                hash_name = self._get_user_hash_name(app_id)
-                hash_key = f"userid_{data}_queuename_{queue_name}"
-                hash_value = redis_init.hget(hash_name, hash_key)
-                if not hash_value:
-                    SevenHelper.redis_release_lock(acquire_lock_name, identifier)
-                    invoke_result_data.success = False
-                    invoke_result_data.error_code = "error"
-                    invoke_result_data.error_message = "您当前不在队列中，请先排队"
-                    return invoke_result_data
-                hash_value = SevenHelper.json_loads(hash_value)
-                if hash_value["progress_status"] == 2:
-                    SevenHelper.redis_release_lock(acquire_lock_name, identifier)
-                    invoke_result_data.success = False
-                    invoke_result_data.error_code = "error"
-                    invoke_result_data.error_message = "您已在队列中，请勿重复排队"
-                    return invoke_result_data
-
-                hash_value["start_timestamp"] = start_timestamp
-                hash_value["end_timestamp"] = end_timestamp
-                hash_value["start_date"] = TimeHelper.timestamp_to_format_time(start_timestamp)
-                hash_value["end_date"] = TimeHelper.timestamp_to_format_time(end_timestamp)
-                hash_value["progress_status"] = 2
-                redis_init.hset(hash_name, hash_key, SevenHelper.json_dumps(hash_value))
-                if pop_other_queue == True:
-                    #踢掉在其他队列中的排队
-                    match_result = redis_init.hscan_iter(hash_name, match=f'userid_{data}_*')
-                    for item in match_result:
-                        hash_value = SevenHelper.json_loads(item[1])
-                        if hash_value["queue_name"] == queue_name:
-                            continue
-                        self.pop(app_id, hash_value["queue_name"], data)
-                invoke_result_data.data = hash_value
-                SevenHelper.redis_release_lock(acquire_lock_name, identifier)
-                return invoke_result_data
-            else:
-                SevenHelper.redis_release_lock(acquire_lock_name, identifier)
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "error"
-                invoke_result_data.error_message = "您当前不在队列中，请先排队"
-                return invoke_result_data
-        except Exception as ex:
-            self.logger_error.error("【签到操作】" + traceback.format_exc())
-            SevenHelper.redis_release_lock(acquire_lock_name, identifier)
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "您当前不在队列中，请先排队"
-            return invoke_result_data
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-08-30 09:22:51
+@LastEditTime: 2023-07-19 18:55:04
+@LastEditors: HuangJianYi
+@Description: 排队系统帮助类
+"""
+from seven_framework import *
+from seven_cloudapp_frame.models.seven_model import *
+from seven_cloudapp_frame.libs.customize.seven_helper import *
+from seven_cloudapp_frame.libs.common import *
+
+
+class QueueUpHelper:
+    """
+    :description: 排队系统帮助类 提供获取小程序总排队人数、获取用户当前排队数、获取用户正在办理中的队列信息、加入排队、退出排队、查询单个排队情况、批量查询某用户排队情况(只包含已排队的信息)、批量查询某用户排队情况(包含已排队和未排队的信息)、更新可操作时间、签到等功能；
+    踢人规则1：第一个在办理中，第二个用户的过期时间=第一个结束时间+8*1，第三个=第一个结束时间+8*2，以此类推；第一个没在办理中，第一个过期时间是8*1，第二个是8*2，第三个是8*3，以此类推；
+    踢人规则2：如果都没有正在办理中，那么取上次办理人退出的时间作为排在第一位人员的开始时间，进行倒计时，没有上次办理人退出时间的话，则取当前第一位人员的入队时间进行倒计时；
+    """
+    logger_error = Logger.get_logger_by_name("log_error")
+    logger_info = Logger.get_logger_by_name("log_info")
+
+    @classmethod
+    def _get_zset_name(self, app_id, queue_name):
+        """
+        :description: 获取排行集合名称，集合用于排行榜，排第一的优先操作
+        :param app_id：应用标识
+        :param queue_name：队列名称
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        zset_name = "queueup_zset"
+        if app_id:
+            zset_name += "_" + str(app_id)
+        if queue_name:
+            zset_name += ":" + str(queue_name)
+        return zset_name
+
+    @classmethod
+    def _get_count_name(self, app_id, queue_name):
+        """
+        :description: 获取排队号计数名称
+        :param app_id：应用标识
+        :param queue_name：队列名称
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        count_name = "queueup_count"
+        if app_id:
+            count_name += "_" + str(app_id)
+        if queue_name:
+            count_name += ":" + str(SevenHelper.get_now_day_int()) + "_" + str(queue_name)
+        return count_name
+
+    @classmethod
+    def _get_user_hash_name(self, app_id):
+        """
+        :description: 获取用户关联队列名称
+        :param app_id：应用标识
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        hash_name = "queueup_user_list"
+        if app_id:
+            hash_name += "_" + str(app_id)
+        return hash_name
+
+    @classmethod
+    def _get_user_zset_name(self, app_id):
+        """
+        :description: 用户在小程序内的排队次数信息
+        :param app_id：应用标识
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        zset_name = "queueup_zset_user"
+        if app_id:
+            zset_name += "_" + str(app_id)
+        return zset_name
+
+    @classmethod
+    def _get_popdate_hash_name(self, app_id):
+        """
+        :description: 办理中的用户退出队列的时间列表名称
+        :param app_id：应用标识
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        hash_name = "queueup_popdate_list"
+        if app_id:
+            hash_name += "_" + str(app_id)
+        return hash_name
+
+    @classmethod
+    def _get_queue_no(self, app_id, queue_name):
+        """
+        :description: 获取排队号
+        :param app_id：应用标识
+        :param queue_name：队列名称
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        count_name = self._get_count_name(app_id, queue_name)
+        redis_init = SevenHelper.redis_init()
+        queue_no = redis_init.incr(count_name, 1)
+        redis_init.expire(count_name, 24 * 3600)
+        return queue_no
+
+    @classmethod
+    def _get_queue_num(self, app_id, queue_name):
+        """
+        :description: 获取当前排队人数
+        :param app_id：应用标识
+        :param queue_name：队列名称
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        zset_name = self._get_zset_name(app_id, queue_name)
+        redis_init = SevenHelper.redis_init()
+        return redis_init.zcard(zset_name)
+
+    @classmethod
+    def _get_app_user_num(self, app_id):
+        """
+        :description: 获取小程序总排队人数
+        :param app_id：应用标识
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        user_zset_name = self._get_user_zset_name(app_id)
+        redis_init = SevenHelper.redis_init()
+        return redis_init.zcount(user_zset_name, 1, 1000000000000)
+
+    @classmethod
+    def get_user_queue_num(self, app_id, user_id):
+        """
+        :description: 获取用户当前排队数
+        :param app_id：应用标识
+        :param user_id：用户标识
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        user_zset_name = self._get_user_zset_name(app_id)
+        redis_init = SevenHelper.redis_init()
+        return redis_init.zscore(user_zset_name, str(user_id))
+
+    @classmethod
+    def get_process_user_queue(self, app_id, user_id):
+        """
+        :description: 获取用户正在办理中的队列信息
+        :param app_id：应用标识
+        :param user_id：用户标识
+        :return: 队列信息，没有返回None
+        :last_editors: HuangJianYi
+        """
+        process_queue = None
+        invoke_result_data = self.muti_user_query(app_id, user_id)
+        if invoke_result_data.success == False:
+            return process_queue
+        else:
+            for item in invoke_result_data.data:
+                if item["progress_status"] == 2:
+                    process_queue = item
+                    break
+            return process_queue
+
+    @classmethod
+    def queue(self, app_id, queue_name, user_id, user_nick="", avatar="", queue_length=10, app_limit_user_num=500, info_dict={}, limit_user_queue_num=0):
+        """
+        :description: 加入排队
+        :param app_id：应用标识
+        :param queue_name：队列名称
+        :param user_id 用户标识
+        :param user_nick 用户昵称
+        :param avatar 头像
+        :param queue_length：队列的长度
+        :param app_limit_user_num：小程序内总排队人数上限
+        :param info_dict：信息字典,用于存储业务端需要的数据
+        :param limit_user_queue_num：限制用户可以加入的队列数
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        try:
+            acquire_lock_name = f"queueup_queue"
+            if app_id:
+                acquire_lock_name += "_" + str(app_id)
+            acquire_lock_name += ":" + str(queue_name)
+
+            acquire_lock_status, identifier = SevenHelper.redis_acquire_lock(acquire_lock_name)
+            if acquire_lock_status == False:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "acquire_lock"
+                invoke_result_data.error_message = "系统繁忙,请稍后再试"
+                return invoke_result_data
+            redis_init = SevenHelper.redis_init()
+            if app_limit_user_num > 0 and self._get_app_user_num(app_id) >= app_limit_user_num:
+                SevenHelper.redis_release_lock(acquire_lock_name, identifier)
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "total_limit"
+                invoke_result_data.error_message = "抱歉~当前活动排队人数过多，请稍后再试"
+                return invoke_result_data
+            if limit_user_queue_num > 0 and QueueUpHelper.get_user_queue_num(app_id, user_id) >= limit_user_queue_num:
+                SevenHelper.redis_release_lock(acquire_lock_name, identifier)
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "user_limit"
+                invoke_result_data.error_message = "抱歉~当前可排队列已达上限，请稍后再试"
+                return invoke_result_data
+
+            zset_name = self._get_zset_name(app_id, queue_name)
+            data = str(user_id)
+            expire_time = 7 * 24 * 3600
+            if not redis_init.zscore(zset_name, data):
+                if self._get_queue_num(app_id, queue_name) >= queue_length:
+                    SevenHelper.redis_release_lock(acquire_lock_name, identifier)
+                    invoke_result_data.success = False
+                    invoke_result_data.error_code = "queue_limit"
+                    invoke_result_data.error_message = "排队失败,当前排队人数已达上限"
+                    return invoke_result_data
+                queue_no = int(str(SevenHelper.get_now_day_int()) + str(self._get_queue_no(app_id, queue_name)).zfill(4))
+                redis_init.zadd(zset_name, {data: queue_no})
+                redis_init.expire(zset_name, expire_time)
+
+                user_zset_name = self._get_user_zset_name(app_id)
+                redis_init.zincrby(user_zset_name, 1, data)
+                redis_init.expire(user_zset_name, expire_time)
+
+                start_timestamp = TimeHelper.get_now_timestamp()
+
+                hash_value = {}
+                hash_value["queue_name"] = queue_name  #排队名称
+                hash_value["queue_no"] = queue_no  #排队号
+                hash_value["user_id"] = data  #用户标识
+                hash_value["user_nick"] = user_nick  #用户昵称
+                hash_value["avatar"] = avatar  #头像
+                hash_value["progress_status"] = 1  #进度0未排队1已排队2办理中
+                hash_value["queue_timestamp"] = start_timestamp  #入队时间搓
+                hash_value["queue_date"] = TimeHelper.timestamp_to_format_time(start_timestamp)  #入队时间
+                hash_value["info_json"] = info_dict
+
+                queue_index = int(redis_init.zrank(zset_name, data)) + 1
+                if queue_index == 1:
+                    redis_init.hdel(self._get_popdate_hash_name(app_id), zset_name)
+                #添加排队信息
+                hash_name = self._get_user_hash_name(app_id)
+                hash_key = f"userid_{data}_queuename_{queue_name}"
+                redis_init.hsetnx(hash_name, hash_key, SevenHelper.json_dumps(hash_value))
+                redis_init.expire(hash_name, expire_time)
+
+                result_data = {}
+                result_data["queue_no"] = hash_value["queue_no"]  #排队号
+                result_data["queue_num"] = self._get_queue_num(app_id, queue_name)  #当前排队人数
+                result_data["queue_index"] = queue_index  #当前位置
+                result_data["before_num"] = queue_index - 1  #排在前面的人数
+                invoke_result_data.data = result_data
+
+                SevenHelper.redis_release_lock(acquire_lock_name, identifier)
+                return invoke_result_data
+            else:
+                SevenHelper.redis_release_lock(acquire_lock_name, identifier)
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "error"
+                invoke_result_data.error_message = "您已在队列中，请勿重复排队"
+                return invoke_result_data
+        except Exception as ex:
+            self.logger_error.error("【加入排队】" + traceback.format_exc())
+            SevenHelper.redis_release_lock(acquire_lock_name, identifier)
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "对不起，加入队列失败，请稍后再试"
+            return invoke_result_data
+
+    @classmethod
+    def _set_last_pop_date(self,app_id, redis_init, hash_key):
+        """
+        :description: 设置办理中的用户退出队列的时间
+        :param app_id：应用标识
+        :param redis_init：redis_init
+        :param hash_key：hash_key
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        hash_name = self._get_popdate_hash_name(app_id)
+        redis_init.hset(hash_name, hash_key, str(TimeHelper.get_now_timestamp()))
+        redis_init.expire(hash_name, 7 * 24 * 3600)
+
+    @classmethod
+    def pop(self, app_id, queue_name, user_id):
+        """
+        :description: 退出排队
+        :param app_id：应用标识
+        :param queue_name：队列名称
+        :param user_id 用户标识
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        try:
+            cache_key = f"queueup_pop"
+            if app_id:
+                cache_key += "_" + str(app_id)
+            cache_key += ":" + str(queue_name) + "_" + str(user_id)
+            if SevenHelper.is_continue_request(cache_key, expire=1 * 1000) == True:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "error"
+                invoke_result_data.error_message = "对不起,请1秒后再试"
+                return invoke_result_data
+            zset_name = self._get_zset_name(app_id, queue_name)
+            data = str(user_id)
+            redis_init = SevenHelper.redis_init()
+            if redis_init.zscore(zset_name, data):
+                if int(redis_init.zrank(zset_name, data)) + 1 == 1:
+                    self._set_last_pop_date(app_id,redis_init, zset_name)
+                redis_init.zrem(zset_name, data)
+                redis_init.zincrby(self._get_user_zset_name(app_id), -1, data)
+                redis_init.hdel(self._get_user_hash_name(app_id), f"userid_{data}_queuename_{queue_name}")
+                return invoke_result_data
+            else:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "error"
+                invoke_result_data.error_message = "未查到该用户的排队情况,请先排队"
+                return invoke_result_data
+        except Exception as ex:
+            self.logger_error.error("【退出排队】" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "退出排队失败"
+            return invoke_result_data
+
+    @classmethod
+    def pop_by_queue_name(self, app_id, queue_name):
+        """
+        :description: 将过期用户从队列中退出
+        :param app_id：应用标识
+        :param queue_name：队列名称
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        if SevenHelper.is_continue_request(f"pop_by_queue_name:{app_id}_{queue_name}", 200) == False:
+            try:
+                redis_init = SevenHelper.redis_init()
+                zset_name = self._get_zset_name(app_id, queue_name)
+                hash_name = self._get_user_hash_name(app_id)
+                value_list = redis_init.zrange(zset_name, 0, 1000)
+                if len(value_list) > 0:
+                    now_timestamp = TimeHelper.get_now_timestamp()
+                    first_is_process = False
+                    first_end_timestamp = 0
+                    first_hash_key = f"userid_{value_list[0]}_queuename_{queue_name}"
+                    first_hash_value = redis_init.hget(hash_name, first_hash_key)
+                    if first_hash_value:
+                        first_hash_value = SevenHelper.json_loads(first_hash_value)
+                        if first_hash_value["progress_status"] == 2:
+                            first_is_process = True
+                            first_end_timestamp = first_hash_value["end_timestamp"]
+                    hash_key_list = []
+                    for data in value_list:
+                        hash_key = f"userid_{data}_queuename_{queue_name}"
+                        hash_key_list.append(hash_key)
+                    string_list = redis_init.hmget(hash_name, hash_key_list)
+                    hash_value_list = []
+                    if len(string_list) > 0:
+                        for item in string_list:
+                            value = SevenHelper.json_loads(item)
+                            if value:
+                                hash_value_list.append(value)
+                    for i in range(len(value_list)):
+                        data = value_list[i]
+                        hash_value = [hash_value for hash_value in hash_value_list if hash_value["user_id"] == data]
+                        if len(hash_value) > 0:
+                            hash_value = hash_value[0]
+                        is_delete = False
+                        if hash_value:
+                            if first_is_process == True and i == 0:
+                                if now_timestamp > hash_value["end_timestamp"]:
+                                    is_delete = True
+                                    self.logger_info.info("【踢掉办理用户1】" + SevenHelper.json_dumps({"zset_name": zset_name, "first_hash_value": first_hash_value, "user_id": data, "now_timestamp": now_timestamp, "pop_timestamp": hash_value["end_timestamp"]}))
+                            elif first_is_process == True and i > 0:
+                                if now_timestamp > first_end_timestamp + (i * int(share_config.get_value("queue_confirm_time", 8))):
+                                    is_delete = True
+                                    self.logger_info.info("【踢掉办理用户2】" + SevenHelper.json_dumps({"zset_name": zset_name, "first_hash_value": first_hash_value, "user_id": data, "now_timestamp": now_timestamp, "pop_timestamp": first_end_timestamp + (i * int(share_config.get_value("queue_confirm_time", 8)))}))
+                            else:
+                                pop_timestamp = redis_init.hget(self._get_popdate_hash_name(app_id), zset_name)
+                                if pop_timestamp:
+                                    pop_timestamp = int(pop_timestamp)
+                                else:
+                                    pop_timestamp = hash_value["queue_timestamp"]
+                                if now_timestamp > pop_timestamp + ((i + 1) * int(share_config.get_value("queue_confirm_time", 8))):
+                                    is_delete = True
+                                    self.logger_info.info("【踢掉办理用户3】" + SevenHelper.json_dumps({"zset_name": zset_name, "first_hash_value": first_hash_value, "user_id": data, "now_timestamp": now_timestamp, "pop_timestamp": pop_timestamp + ((i + 1) * int(share_config.get_value("queue_confirm_time", 8)))}))
+
+                        if is_delete == True:
+                            self._set_last_pop_date(app_id, redis_init, zset_name)
+                            redis_init.hdel(hash_name, f"userid_{data}_queuename_{queue_name}")
+                            redis_init.zrem(zset_name, data)
+                            redis_init.zincrby(self._get_user_zset_name(app_id), -1, data)
+            except Exception as ex:
+                self.logger_error.error("【删除未操作的排队信息】" + traceback.format_exc())
+
+    @classmethod
+    def pop_by_user_id(self, app_id, user_id, progress_status=1):
+        """
+        :description: 指定用户退出参与的队列
+        :param app_id：应用标识
+        :param user_id：用户标识
+        :param progress_status：0-全部 1-已排队 2-办理中
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        if SevenHelper.is_continue_request(f"pop_by_user_id:{app_id}_{user_id}", 200) == False:
+            redis_init = SevenHelper.redis_init()
+            data = str(user_id)
+            hash_name = self._get_user_hash_name(app_id)
+            match_result = redis_init.hscan_iter(hash_name, match=f'userid_{data}_*')
+            for item in match_result:
+                hash_value = SevenHelper.json_loads(item[1])
+                if progress_status > 0 and hash_value["progress_status"] != progress_status:
+                    continue
+                self.pop(app_id, hash_value["queue_name"], data)
+
+    @classmethod
+    def query(self, app_id, queue_name, user_id):
+        """
+        :description: 查询某用户排队情况
+        :param app_id：应用标识
+        :param queue_name：队列名称
+        :param user_id：用户标识
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        try:
+            redis_init = SevenHelper.redis_init()
+            zset_name = self._get_zset_name(app_id, queue_name)
+            data = str(user_id)
+            #踢掉过期用户
+            self.pop_by_queue_name(app_id, queue_name)
+            #删除用户排队次数小于等于0的数据
+            redis_init.zremrangebyscore(self._get_user_zset_name(app_id), -10, 0)
+
+            #判断是否存在排队信息
+            score = redis_init.zscore(zset_name, data)
+            index = redis_init.zrank(zset_name, data)
+            if score and index is not None:
+                query_user = {}
+                query_user["queue_name"] = queue_name  #队列名称
+                query_user["queue_no"] = int(score)  #排队号
+                query_user["total_num"] = self._get_queue_num(app_id, queue_name)  #总排队人数
+                query_user["queue_index"] = int(index) + 1  #当前位置
+                query_user["before_num"] = query_user["queue_index"] - 1  #排在前面的人数
+                hash_value = redis_init.hget(self._get_user_hash_name(app_id), f"userid_{data}_queuename_{queue_name}")
+                hash_value = SevenHelper.json_loads(hash_value) if hash_value else {}
+                query_user["user_id"] = hash_value["user_id"] if hash_value.__contains__("user_id") else ''
+                query_user["user_nick"] = hash_value["user_nick"] if hash_value.__contains__("user_nick") else ''
+                query_user["avatar"] = hash_value["avatar"] if hash_value.__contains__("avatar") else ''
+                query_user["start_date"] = hash_value["start_date"] if hash_value.__contains__("start_date") else ''
+                query_user["end_date"] = hash_value["end_date"] if hash_value.__contains__("end_date") else ''
+                query_user["queue_date"] = hash_value["queue_date"] if hash_value.__contains__("queue_date") else ''
+                query_user["queue_timestamp"] = hash_value["queue_timestamp"] if hash_value.__contains__("queue_timestamp") else 0
+                query_user["progress_status"] = hash_value["progress_status"] if hash_value.__contains__("progress_status") else 0  #进度0未排队1已排队2办理中
+                query_user["info_json"] = hash_value["info_json"] if hash_value.__contains__("info_json") else {}
+                invoke_result_data.data = query_user
+                return invoke_result_data
+            else:
+                query_user = {}
+                query_user["queue_name"] = queue_name  #队列名称
+                query_user["progress_status"] = 0  #进度0未排队1已排队2办理中
+                query_user["before_num"] = self._get_queue_num(app_id, queue_name)  #排在前面的人数
+                invoke_result_data.data = query_user
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "error"
+                invoke_result_data.error_message = "您当前不在队列中，请先排队"
+                return invoke_result_data
+        except Exception as ex:
+            self.logger_error.error("【查询某用户排队情况】" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "您当前不在队列中，请先排队"
+            return invoke_result_data
+
+    @classmethod
+    def query_all(self, app_id, queue_name):
+        """
+        :description: 查询指定队列的所有用户信息
+        :param app_id：应用标识
+        :param queue_name：队列名称
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        invoke_result_data.data = []
+        zset_name = self._get_zset_name(app_id, queue_name)
+        redis_init = SevenHelper.redis_init()
+        user_id_list = redis_init.zrange(zset_name,0,-1)
+        if len(user_id_list) <= 0:
+            return invoke_result_data
+        for user_id in user_id_list:
+            query_invoke_result_data = self.query(app_id, queue_name, user_id)
+            if query_invoke_result_data.success == True:
+                invoke_result_data.data.append(query_invoke_result_data.data)
+        return invoke_result_data
+
+    @classmethod
+    def muti_user_query(self, app_id, user_id):
+        """
+        :description: 批量查询某用户排队情况(只包含已排队的信息)
+        :param app_id：应用标识
+        :param user_id：用户标识
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        invoke_result_data.data = []
+        try:
+            redis_init = SevenHelper.redis_init()
+            hash_name = self._get_user_hash_name(app_id)
+            data = str(user_id)
+            match_result = redis_init.hscan_iter(hash_name, match=f'userid_{data}_*')
+            for item in match_result:
+                hash_value = SevenHelper.json_loads(item[1])
+                query_invoke_result_data = self.query(app_id, hash_value["queue_name"], user_id)
+                if query_invoke_result_data.success == True:
+                    invoke_result_data.data.append(query_invoke_result_data.data)
+            return invoke_result_data
+        except Exception as ex:
+            self.logger_error.error("【批量查询某用户排队情况】" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "您当前不在队列中，请先排队"
+            return invoke_result_data
+
+    @classmethod
+    def muti_queue_query(self, app_id, queue_name_list, user_id):
+        """
+        :description: 批量查询某用户排队情况(包含已排队和未排队的信息)
+        :param app_id：应用标识
+        :param queue_name_list：查询队列集合
+        :param user_id：用户标识
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        invoke_result_data.data = []
+        try:
+            for queue_name in queue_name_list:
+                query_invoke_result_data = self.query(app_id, queue_name, user_id)
+                invoke_result_data.data.append(query_invoke_result_data.data)
+            return invoke_result_data
+        except Exception as ex:
+            self.logger_error.error("【批量查询排队情况】" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "未查到排队情况"
+            return invoke_result_data
+
+    @classmethod
+    def update_time(self, app_id, queue_name, user_id, operate_time=0,is_reset=False):
+        """
+        :description: 更新可操作时间，用于操作倒计时，时间到则踢出队列
+        :param app_id：应用标识
+        :param queue_name：队列名称
+        :param user_id：用户标识
+        :param operate_time：增加的操作时间，单位秒
+        :param is_reset：是否重置开始时间和结束时间
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        try:
+            redis_init = SevenHelper.redis_init()
+            zset_name = self._get_zset_name(app_id, queue_name)
+            data = str(user_id)
+            score = redis_init.zscore(zset_name, data)
+            if score and operate_time > 0:
+                hash_name = self._get_user_hash_name(app_id)
+                hash_key = f"userid_{data}_queuename_{queue_name}"
+                hash_value = redis_init.hget(hash_name, hash_key)
+                if not hash_value:
+                    invoke_result_data.success = False
+                    invoke_result_data.error_code = "error"
+                    invoke_result_data.error_message = "更新可操作时间失败"
+                    return invoke_result_data
+                hash_value = SevenHelper.json_loads(hash_value)
+                if hash_value["progress_status"] != 2:
+                    invoke_result_data.success = False
+                    invoke_result_data.error_code = "error"
+                    invoke_result_data.error_message = "未签到,不能更新可操作时间"
+                    return invoke_result_data
+                if is_reset == True:
+                    start_timestamp = TimeHelper.get_now_timestamp()
+                    hash_value["start_timestamp"] = start_timestamp
+                    hash_value["start_date"] = TimeHelper.timestamp_to_format_time(start_timestamp)
+                    end_timestamp = start_timestamp + int(operate_time)
+                    hash_value["end_timestamp"] = end_timestamp
+                    hash_value["end_date"] = TimeHelper.timestamp_to_format_time(end_timestamp)
+                else:
+                    queue_operate_total_time = int(share_config.get_value("queue_operate_total_time", 0))
+                    now_date = TimeHelper.get_now_datetime()
+                    expire_date = TimeHelper.timestamp_to_datetime(hash_value["end_timestamp"])
+                    if expire_date > now_date and queue_operate_total_time > 0:
+                        remain_time = TimeHelper.difference_seconds(expire_date, now_date)
+                        operate_time = queue_operate_total_time - remain_time if remain_time + operate_time > queue_operate_total_time else operate_time
+                    end_timestamp = hash_value["end_timestamp"] + int(operate_time)
+                    hash_value["end_timestamp"] = end_timestamp
+                    hash_value["end_date"] = TimeHelper.timestamp_to_format_time(end_timestamp)
+                redis_init.hset(hash_name, hash_key, SevenHelper.json_dumps(hash_value))
+            return invoke_result_data
+        except Exception as ex:
+            self.logger_error.error("【更新可操作时间】" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "更新可操作时间失败"
+            return invoke_result_data
+
+    @classmethod
+    def sign(self, app_id, queue_name, user_id, pop_other_queue=True):
+        """
+        :description: 签到操作（证明排队的人做出应答，开始办理业务，更新开始操作时间）
+        :param app_id：应用标识
+        :param queue_name：队列名称
+        :param user_id：用户标识
+        :param pop_other_queue：是否退出其他正在排队的队列，True是False否
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        try:
+            acquire_lock_name = f"queueup_sign"
+            if app_id:
+                acquire_lock_name += "_" + str(app_id)
+            acquire_lock_name += ":" + str(queue_name)
+            acquire_lock_name += ":" + str(user_id)
+            acquire_lock_status, identifier = SevenHelper.redis_acquire_lock(acquire_lock_name)
+            if acquire_lock_status == False:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "acquire_lock"
+                invoke_result_data.error_message = "系统繁忙,请稍后再试"
+                return invoke_result_data
+
+            redis_init = SevenHelper.redis_init()
+            zset_name = self._get_zset_name(app_id, queue_name)
+            data = str(user_id)
+            #判断是否存在排队信息
+            score = redis_init.zscore(zset_name, data)
+            if score:
+                queue_index = int(redis_init.zrank(zset_name, data)) + 1  #当前位置
+                if queue_index != 1:
+                    SevenHelper.redis_release_lock(acquire_lock_name, identifier)
+                    invoke_result_data.success = False
+                    invoke_result_data.error_code = "error"
+                    invoke_result_data.error_message = "前面还有人在队列中，请耐心等待"
+                    return invoke_result_data
+                start_timestamp = TimeHelper.get_now_timestamp()
+                end_timestamp = start_timestamp + int(share_config.get_value("queue_operate_time", 300))  #操作时间，单位秒
+                hash_name = self._get_user_hash_name(app_id)
+                hash_key = f"userid_{data}_queuename_{queue_name}"
+                hash_value = redis_init.hget(hash_name, hash_key)
+                if not hash_value:
+                    SevenHelper.redis_release_lock(acquire_lock_name, identifier)
+                    invoke_result_data.success = False
+                    invoke_result_data.error_code = "error"
+                    invoke_result_data.error_message = "您当前不在队列中，请先排队"
+                    return invoke_result_data
+                hash_value = SevenHelper.json_loads(hash_value)
+                if hash_value["progress_status"] == 2:
+                    SevenHelper.redis_release_lock(acquire_lock_name, identifier)
+                    invoke_result_data.success = False
+                    invoke_result_data.error_code = "error"
+                    invoke_result_data.error_message = "您已在队列中，请勿重复排队"
+                    return invoke_result_data
+
+                hash_value["start_timestamp"] = start_timestamp
+                hash_value["end_timestamp"] = end_timestamp
+                hash_value["start_date"] = TimeHelper.timestamp_to_format_time(start_timestamp)
+                hash_value["end_date"] = TimeHelper.timestamp_to_format_time(end_timestamp)
+                hash_value["progress_status"] = 2
+                redis_init.hset(hash_name, hash_key, SevenHelper.json_dumps(hash_value))
+                if pop_other_queue == True:
+                    #踢掉在其他队列中的排队
+                    match_result = redis_init.hscan_iter(hash_name, match=f'userid_{data}_*')
+                    for item in match_result:
+                        hash_value = SevenHelper.json_loads(item[1])
+                        if hash_value["queue_name"] == queue_name:
+                            continue
+                        self.pop(app_id, hash_value["queue_name"], data)
+                invoke_result_data.data = hash_value
+                SevenHelper.redis_release_lock(acquire_lock_name, identifier)
+                return invoke_result_data
+            else:
+                SevenHelper.redis_release_lock(acquire_lock_name, identifier)
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "error"
+                invoke_result_data.error_message = "您当前不在队列中，请先排队"
+                return invoke_result_data
+        except Exception as ex:
+            self.logger_error.error("【签到操作】" + traceback.format_exc())
+            SevenHelper.redis_release_lock(acquire_lock_name, identifier)
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "您当前不在队列中，请先排队"
+            return invoke_result_data
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/libs/customize/redis_helper.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/libs/customize/redis_helper.py`

 * *Ordering differences only*

 * *Files 19% similar despite different names*

```diff
@@ -1,122 +1,122 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2022-03-10 14:05:22
-@LastEditTime: 2023-03-23 18:35:44
-@LastEditors: HuangJianYi
-@Description: 
-"""
-from seven_framework import *
-from seven_framework.redis import *
-
-
-class RedisExHelper:
-    """
-    :description: redis帮助类
-    """
-    @classmethod
-    def init(self, config_dict=None, decode_responses=True):
-        """
-        :description: redis初始化
-        :return: redis_cli
-        :last_editors: HuangJianYi
-        """
-        if not config_dict:
-            config_dict = config.get_value("redis")
-        redis_cli = RedisHelper.redis_init(config_dict=config_dict, decode_responses=decode_responses)
-        return redis_cli
-
-    @classmethod
-    def check_llen(self, queue_name, queue_lenth=100):
-        """
-         :description: 校验队列长度
-         :param queue_name：自定义队列名称
-         :param queue_lenth：队列长度
-         :return: bool False-代表达到长度限制，进行拦截
-         :last_editors: HuangJianYi
-         """
-        redis_init = self.init()
-        list_len = redis_init.llen(queue_name)
-        if int(list_len) >= int(queue_lenth):
-            return True
-        else:
-            return False
-
-    @classmethod
-    def lpush(self, queue_name, value, expire):
-        """
-         :description: 入队列
-         :param queue_name：自定义队列名称
-         :param value：加入队列的数据
-         :param expire：过期时间，单位秒
-         :return:
-         :last_editors: HuangJianYi
-         """
-        redis_init = self.init()
-        redis_init.lpush(queue_name, json.dumps(value))
-        redis_init.expire(queue_name,expire)
-
-    @classmethod
-    def lpop(self, queue_name):
-        """
-         :description: 出队列
-         :param queue_name：队列名称
-         :return: 
-         :last_editors: HuangJianYi
-         """
-        result = self.init().lpop(queue_name)
-        return result
-
-    @classmethod
-    def acquire_lock(self, lock_name, acquire_time=5, time_out=10):
-        """
-        :description: 创建分布式锁 基于setnx命令的特性，我们就可以实现一个最简单的分布式锁了。我们通过向Redis发送 setnx 命令，然后判断Redis返回的结果是否为1，结果是1就表示setnx成功了，那本次就获得锁了，可以继续执行业务逻辑；如果结果是0，则表示setnx失败了，那本次就没有获取到锁，可以通过循环的方式一直尝试获取锁，直至其他客户端释放了锁（delete掉key）后，就可以正常执行setnx命令获取到锁
-        :param lock_name：锁定名称
-        :param acquire_time: 客户端等待获取锁的时间,单位秒,正常配置acquire_time<time_out
-        :param time_out: 锁的超时时间,单位秒
-        :return 返回元组，分布式锁是否获得（True获得False未获得）和解锁钥匙（释放锁时需传入才能解锁成功）
-        :last_editors: HuangJianYi
-        """
-        identifier = str(uuid.uuid4())
-        if config.get_value("is_pressure_test",False): #是否进行压力测试
-            return True,identifier
-        end = time.time() + acquire_time
-        lock = "lock:" + lock_name
-        redis_init = self.init()
-        while time.time() < end:
-            if redis_init.setnx(lock, identifier):
-                # 给锁设置超时时间, 防止进程崩溃导致其他进程无法获取锁
-                redis_init.expire(lock, time_out)
-                return True,identifier
-            if redis_init.ttl(lock) == -1 or redis_init.ttl(lock) == None:
-                redis_init.expire(lock, time_out)
-            time.sleep(0.001)
-        return False,""
-
-    @classmethod
-    def release_lock(self, lock_name, identifier):
-        """
-        :description: 释放分布式锁
-        :param lock_name：锁定名称
-        :param identifier: identifier
-        :return bool
-        :last_editors: HuangJianYi
-        """
-        lock = "lock:" + lock_name
-        redis_init = self.init()
-        pip = redis_init.pipeline(True)
-        try:
-            pip.watch(lock)
-            lock_value = redis_init.get(lock)
-            if not lock_value:
-                return True
-            if lock_value == identifier:
-                pip.multi()
-                pip.delete(lock)
-                pip.execute()
-                return True
-            pip.unwatch()
-            return False
-        except Exception:
-            pip.unwatch()
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2022-03-10 14:05:22
+@LastEditTime: 2023-03-23 18:35:44
+@LastEditors: HuangJianYi
+@Description: 
+"""
+from seven_framework import *
+from seven_framework.redis import *
+
+
+class RedisExHelper:
+    """
+    :description: redis帮助类
+    """
+    @classmethod
+    def init(self, config_dict=None, decode_responses=True):
+        """
+        :description: redis初始化
+        :return: redis_cli
+        :last_editors: HuangJianYi
+        """
+        if not config_dict:
+            config_dict = config.get_value("redis")
+        redis_cli = RedisHelper.redis_init(config_dict=config_dict, decode_responses=decode_responses)
+        return redis_cli
+
+    @classmethod
+    def check_llen(self, queue_name, queue_lenth=100):
+        """
+         :description: 校验队列长度
+         :param queue_name：自定义队列名称
+         :param queue_lenth：队列长度
+         :return: bool False-代表达到长度限制，进行拦截
+         :last_editors: HuangJianYi
+         """
+        redis_init = self.init()
+        list_len = redis_init.llen(queue_name)
+        if int(list_len) >= int(queue_lenth):
+            return True
+        else:
+            return False
+
+    @classmethod
+    def lpush(self, queue_name, value, expire):
+        """
+         :description: 入队列
+         :param queue_name：自定义队列名称
+         :param value：加入队列的数据
+         :param expire：过期时间，单位秒
+         :return:
+         :last_editors: HuangJianYi
+         """
+        redis_init = self.init()
+        redis_init.lpush(queue_name, json.dumps(value))
+        redis_init.expire(queue_name,expire)
+
+    @classmethod
+    def lpop(self, queue_name):
+        """
+         :description: 出队列
+         :param queue_name：队列名称
+         :return: 
+         :last_editors: HuangJianYi
+         """
+        result = self.init().lpop(queue_name)
+        return result
+
+    @classmethod
+    def acquire_lock(self, lock_name, acquire_time=5, time_out=10):
+        """
+        :description: 创建分布式锁 基于setnx命令的特性，我们就可以实现一个最简单的分布式锁了。我们通过向Redis发送 setnx 命令，然后判断Redis返回的结果是否为1，结果是1就表示setnx成功了，那本次就获得锁了，可以继续执行业务逻辑；如果结果是0，则表示setnx失败了，那本次就没有获取到锁，可以通过循环的方式一直尝试获取锁，直至其他客户端释放了锁（delete掉key）后，就可以正常执行setnx命令获取到锁
+        :param lock_name：锁定名称
+        :param acquire_time: 客户端等待获取锁的时间,单位秒,正常配置acquire_time<time_out
+        :param time_out: 锁的超时时间,单位秒
+        :return 返回元组，分布式锁是否获得（True获得False未获得）和解锁钥匙（释放锁时需传入才能解锁成功）
+        :last_editors: HuangJianYi
+        """
+        identifier = str(uuid.uuid4())
+        if config.get_value("is_pressure_test",False): #是否进行压力测试
+            return True,identifier
+        end = time.time() + acquire_time
+        lock = "lock:" + lock_name
+        redis_init = self.init()
+        while time.time() < end:
+            if redis_init.setnx(lock, identifier):
+                # 给锁设置超时时间, 防止进程崩溃导致其他进程无法获取锁
+                redis_init.expire(lock, time_out)
+                return True,identifier
+            if redis_init.ttl(lock) == -1 or redis_init.ttl(lock) == None:
+                redis_init.expire(lock, time_out)
+            time.sleep(0.001)
+        return False,""
+
+    @classmethod
+    def release_lock(self, lock_name, identifier):
+        """
+        :description: 释放分布式锁
+        :param lock_name：锁定名称
+        :param identifier: identifier
+        :return bool
+        :last_editors: HuangJianYi
+        """
+        lock = "lock:" + lock_name
+        redis_init = self.init()
+        pip = redis_init.pipeline(True)
+        try:
+            pip.watch(lock)
+            lock_value = redis_init.get(lock)
+            if not lock_value:
+                return True
+            if lock_value == identifier:
+                pip.multi()
+                pip.delete(lock)
+                pip.execute()
+                return True
+            pip.unwatch()
+            return False
+        except Exception:
+            pip.unwatch()
             return False
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/libs/customize/seven_helper.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/libs/customize/seven_helper.py`

 * *Ordering differences only*

 * *Files 22% similar despite different names*

```diff
@@ -1,641 +1,641 @@
-# -*- coding: utf-8 -*-
-"""
-:Author: HuangJianYi
-:Date: 2021-07-15 11:54:54
-@LastEditTime: 2023-04-12 15:28:04
-@LastEditors: HuangJianYi
-:description: 常用帮助类
-"""
-from seven_framework import *
-from seven_framework.redis import *
-from seven_cloudapp_frame.libs.common import *
-from seven_cloudapp_frame.libs.customize.redis_helper import RedisExHelper
-from seven_cloudapp_frame.libs.customize.time_helper import TimeExHelper
-
-import random
-import datetime
-import re
-import ast
-
-
-
-class SevenHelper:
-    """
-    :description: 常用帮助类 提供常用方法 如：字典列表合并、请求太频繁校验、（入队列、出队列、校验队列长度 主要用于流量削峰场景）、创建分布式锁、释放分布式锁、序列化、反序列化、生成订单号等
-    """
-    @classmethod
-    def redis_init(self, db=None, config_dict=None, decode_responses=True):
-        """
-        :description: redis初始化
-        :return: redis_cli
-        :last_editors: HuangJianYi
-        """
-        return RedisExHelper.init(config_dict, decode_responses)
-
-    @classmethod
-    def is_continue_request(self, cache_key, expire=500):
-        """
-        :description: 请求太频繁校验
-        :param cache_key：自定义cache_key
-        :param expire：过期时间，单位毫秒
-        :return: bool true-代表连续请求进行限制，false-代表跳过限制
-        :last_editors: HuangJianYi
-        """
-        if share_config.get_value("is_pressure_test",False): #是否进行压力测试
-            return False
-        redis_init = self.redis_init()
-        post_value = redis_init.incr(cache_key,1)
-        redis_init.pexpire(cache_key,expire)
-        if post_value > 1:
-            return True
-        return False
-
-    @classmethod
-    def redis_check_llen(self,queue_name,queue_lenth=100):
-        """
-         :description: 校验队列长度
-         :param queue_name：自定义队列名称
-         :param queue_lenth：队列长度
-         :return: bool False-代表达到长度限制，进行拦截
-         :last_editors: HuangJianYi
-         """
-        return RedisExHelper.check_llen(queue_name, queue_lenth)
-
-    @classmethod
-    def redis_lpush(self, queue_name, value, expire):
-        """
-         :description: 入队列
-         :param queue_name：自定义队列名称
-         :param value：加入队列的数据
-         :param expire：过期时间，单位秒
-         :return:
-         :last_editors: HuangJianYi
-         """
-        RedisExHelper.lpush(queue_name, value, expire)
-
-    @classmethod
-    def redis_lpop(self, queue_name):
-        """
-         :description: 出队列
-         :param queue_name：队列名称
-         :return: 
-         :last_editors: HuangJianYi
-         """
-        return RedisExHelper.lpop(queue_name)
-
-    @classmethod
-    def redis_acquire_lock(self, lock_name, acquire_time=5, time_out=10):
-        """
-        :description: 创建分布式锁
-        :param lock_name：锁定名称
-        :param acquire_time: 客户端等待获取锁的时间,单位秒
-        :param time_out: 锁的超时时间,单位秒
-        :return 分布式锁是否获得（True获得False未获得）和解锁钥匙（释放锁时需传入才能解锁成功）
-        :last_editors: HuangJianYi
-        """
-        return RedisExHelper.acquire_lock(lock_name, acquire_time, time_out)
-
-    @classmethod
-    def redis_release_lock(self, lock_name, identifier):
-        """
-        :description: 释放分布式锁
-        :param lock_name：锁定名称
-        :param identifier: identifier
-        :return bool
-        :last_editors: HuangJianYi
-        """
-        return RedisExHelper.release_lock(lock_name, identifier)
-
-    @classmethod
-    def merge_dict_list(self, source_dict_list, source_key, merge_dict_list, merge_key, merge_columns_names='', exclude_merge_columns_names=''):
-        """
-        :description: 两个字典列表合并
-        :param source_dict_list：源字典表
-        :param source_key：源表用来关联的字段
-        :param merge_dict_list：需要合并的字典表
-        :param merge_key：需要合并的字典表用来关联的字段
-        :param merge_columns_names：需要合并的字典表中需要展示的字段
-        :param exclude_merge_columns_names：需要合并的字典表中不需要展示的字段
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        result = []
-        if merge_columns_names:
-            list_key = list(merge_columns_names.split(","))
-        else:
-            list_key = list(merge_dict_list[0].keys()) if len(merge_dict_list)>0 else []
-        if exclude_merge_columns_names:
-            exclude_key = list(exclude_merge_columns_names.split(","))
-            list_key = list(set(list_key).difference(set(exclude_key)))
-        for source_dict in source_dict_list:
-            info_list = [i for i in merge_dict_list if source_dict[source_key] and str(i[merge_key]) == str(source_dict[source_key])]
-            if info_list:
-                source_dict = dict(source_dict, **dict.fromkeys(list_key))
-                for item in list_key:
-                    source_dict[item] = info_list[0].get(item,'')
-            else:
-                for item in list_key:
-                    if item not in source_dict.keys():
-                        source_dict[item] = ''
-            result.append(source_dict)
-        return result
-
-    @classmethod
-    def auto_mapper(self, s_model, map_dict=None):
-        '''
-        :description: 对象映射,字典转实体（把map_dict值赋值到实体s_model中）
-        :param s_model：需要映射的实体对象
-        :param map_dict：被映射的实体字典
-        :return: obj
-        :last_editors: HuangJianYi
-        '''
-        if map_dict:
-            field_list = s_model.get_field_list()
-            for filed in field_list:
-                if filed in map_dict:
-                    setattr(s_model, filed, map_dict[filed])
-        return s_model
-
-    @classmethod
-    def get_condition_by_str_list(self, field_name, str_list, is_in=True):
-        """
-        :description: 根据str_list返回查询条件 in查询参数化，如：act_info_model.get_list("FIND_IN_SET(act_name,%s)", params=['活动1,活动2'])
-        :param field_name: 字段名
-        :param str_list: 字符串数组
-        :param is_in: 是否in查询，是in查询 否not in 查询
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        if not str_list:
-            return ""
-        list_str = ','.join(["'%s'" % str(item) for item in str_list])
-        if is_in:
-            return f"{field_name} IN({list_str})"
-        else:
-            return f"{field_name} NOT IN({list_str})"
-
-    @classmethod
-    def get_condition_by_int_list(self, field_name, int_list, is_in=True):
-        '''
-        :description: 根据int_list返回查询条件 in查询参数化，如：act_info_model.get_list("FIND_IN_SET(act_name,%s)", params=['活动1,活动2'])
-        :param field_name:字段名
-        :param int_list:整形数组
-        :param is_in: 是否in查询，是in查询 否not in 查询
-        :return: str
-        :last_editors: HuangJianYi
-        '''
-        if not int_list:
-            return ""
-        list_str = str(int_list).strip('[').strip(']')
-        if is_in:
-            return f"{field_name} IN({list_str})"
-        else:
-            return f"{field_name} NOT IN({list_str})"
-
-    @classmethod
-    def get_condition_in(self, field_name, field_str, field_type=1, is_in=True):
-        '''
-        :description: 根据逗号分隔字符串合成条件
-        :param field_name:字段名
-        :param field_str:逗号分隔字符串
-        :param field_type:字段类型（1整形2字符串）
-        :param is_in: 是否in查询，是in查询 否not in 查询
-        :return: 查询字符串
-        :last_editors: HuangJianYi
-        '''
-        if not field_str:
-            return ""
-        str_list = []
-        if field_type == 1:
-            try:
-                str_list = [int(x) for x in field_str.split(",")]
-            except Exception as ex:
-                pass
-            if len(str_list) <= 0:
-                return ""
-            list_str = str(str_list).strip('[').strip(']')
-        else:
-            str_list = field_str.split(",")
-            list_str = ','.join(["'%s'" % str(item) for item in str_list])
-        if is_in:
-            return f"{field_name} IN({list_str})"
-        else:
-            return f"{field_name} NOT IN({list_str})"
-
-    @classmethod
-    def is_ip(self, ip_str):
-        """
-        :description: 判断是否IP地址
-        :param ip_str: ip串
-        :return:
-        :last_editors: HuangJianYi
-        """
-        p = re.compile('^((25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(25[0-5]|2[0-4]\d|[01]?\d\d?)$')
-        if p.match(str(ip_str)):
-            return True
-        return False
-
-    @classmethod
-    def get_first_ip(self,remote_ip):
-        """
-        :description: 获取第一个IP
-        :param remote_ip: ip串
-        :return:
-        """
-        if remote_ip and "," in remote_ip:
-            return remote_ip.split(",")[0]
-        else:
-            return remote_ip
-
-    @classmethod
-    def to_file_size(self, size):
-        """
-        :description: 文件大小格式化
-        :param size：文件大小
-        :return: str
-        :last_editors: HuangJianYi
-        """
-        if size < 1000:
-            return '%i' % size + 'size'
-        elif 1024 <= size < 1048576:
-            return '%.2f' % float(size / 1024) + 'KB'
-        elif 1048576 <= size < 1073741824:
-            return '%.2f' % float(size / 1048576) + 'MB'
-        elif 1073741824 <= size < 1000000000000:
-            return '%.2f' % float(size / 1073741824) + 'GB'
-        elif 1000000000000 <= size:
-            return '%.2f' % float(size / 1000000000000) + 'TB'
-
-    @classmethod
-    def get_random(self,length):
-        """
-        :description: 获取随机字符串
-        :param length：长度
-        :return: str
-        :last_editors: HuangJianYi
-        """
-        result = ""
-        for i in range(length):
-            # n=1 生成数字  n=2 生成字母
-            n = random.randint(1, 2)
-            if n == 1:
-                numb = random.randint(0, 9)
-                result += str(numb)
-            else:
-                nn = random.randint(1, 2)
-                cc = random.randint(1, 26)
-                if nn == 1:
-                    numb = chr(64 + cc)
-                    result += numb
-                else:
-                    numb = chr(96 + cc)
-                    result += numb
-        return result
-
-    @classmethod
-    def get_random_switch_string(self, random_str, split_chars=","):
-        """
-        :description: 随机取得字符串
-        :param trimChars：根据什么符号进行分割
-        :return: str
-        :last_editors: HuangJianYi
-        """
-        if random_str == "":
-            return ""
-        random_list = [i for i in random_str.split(split_chars) if i != ""]
-        return random.choice(random_list)
-
-    @classmethod
-    def get_now_datetime(self):
-        """
-        :description: 获取当前时间
-        :return: str
-        :last_editors: HuangJianYi
-        """
-        return TimeHelper.get_now_format_time()
-
-    @classmethod
-    def get_now_int(self, hours=0, minutes=0, fmt='%Y%m%d%H%M%S'):
-        """
-        :description: 获取整形的时间 格式为yyyyMMddHHmmss，如2009年12月27日9点10分10秒表示为20091227091010
-        :param hours: 需要增加的小时数
-        :param hours: 需要增加的分钟数
-        :param fmt: 时间格式
-        :return:
-        :last_editors: HuangJianYi
-        """
-        return TimeExHelper.get_now_int(hours, minutes, fmt)
-
-    @classmethod
-    def get_now_hour_int(self, hours=0):
-        """
-        :description: 获取整形的小时2020050612
-        :param hours: 需要增加的小时数
-        :return: int（2020050612）
-        :last_editors: HuangJianYi
-        """
-        return TimeExHelper.get_now_int(hours=hours, fmt='%Y%m%d%H')
-
-    @classmethod
-    def get_now_day_int(self, hours=0):
-        """
-        :description: 获取整形的天20200506
-        :param hours: 需要增加的小时数
-        :return: int（20200506）
-        :last_editors: HuangJianYi
-        """
-        return TimeExHelper.get_now_int(hours=hours, fmt='%Y%m%d')
-
-    @classmethod
-    def get_now_month_int(self, hours=0):
-        """
-        :description: 获取整形的月202005
-        :param hours: 需要增加的小时数
-        :return: int（202005）
-        :last_editors: HuangJianYi
-        """
-        return TimeExHelper.get_now_int(hours=hours, fmt='%Y%m')
-
-    @classmethod
-    def get_date_list(self, start_date, end_date):
-        """
-        :description: 两个日期之间的日期列表
-        :param start_date：开始日期
-        :param end_date：结束日期
-        :return: list
-        :last_editors: HuangJianYi
-        """
-        return TimeExHelper.get_date_list(start_date, end_date)
-
-    @classmethod
-    def get_page_count(self, page_size, record_count):
-        """
-        @description: 计算页数
-        @param page_size：页大小
-        @param record_count：总记录数
-        @return: 页数
-        @last_editors: HuangJianYi
-        """
-        page_count = record_count / page_size + 1
-        if page_size == 0:
-            page_count = 0
-        if record_count % page_size == 0:
-            page_count = record_count / page_size
-        page_count = int(page_count)
-        return page_count
-
-    @classmethod
-    def create_order_id(self, ran=5):
-        """
-        :description: 生成订单号
-        :param ran：随机数位数，默认5位随机数（0-5）
-        :return: 25位的订单号
-        :last_editors: HuangJianYi
-        """
-        ran_num = ""
-        if ran == 1:
-            ran_num = random.randint(0, 9)
-        elif ran == 2:
-            ran_num = random.randint(10, 99)
-        elif ran == 3:
-            ran_num = random.randint(100, 999)
-        elif ran == 4:
-            ran_num = random.randint(1000, 9999)
-        elif ran == 5:
-            ran_num = random.randint(10000, 99999)
-        # cur_time = TimeHelper.get_now_format_time('%Y%m%d%H%M%S%f')
-        cur_time = TimeHelper.get_now_timestamp(True)
-        order_id = str(cur_time) + str(ran_num)
-        return order_id
-
-    @classmethod
-    def json_dumps(self, rep_dic):
-        """
-        :description: 对象编码成Json字符串
-        :param rep_dic：字典对象
-        :return: str
-        :last_editors: HuangJianYi
-        """
-        try:
-            if rep_dic == "":
-                return ""
-            rep_dic = ast.literal_eval(rep_dic)
-        except Exception:
-            pass
-        if hasattr(rep_dic, '__dict__'):
-            rep_dic = rep_dic.__dict__
-        return json.dumps(rep_dic, ensure_ascii=False, cls=JsonEncoder, default=lambda x: (x.__dict__ if not isinstance(x, datetime.datetime) else datetime.datetime.strftime(x, '%Y-%m-%d %H:%M:%S')) if not isinstance(x, decimal.Decimal) else float(x), sort_keys=False, indent=None)
-
-    @classmethod
-    def json_loads(self, rep_str):
-        """
-        :description: 将Json字符串解码成python对象
-        :param rep_str：str
-        :return: dict
-        :last_editors: HuangJianYi
-        """
-        try:
-            return json.loads(rep_str)
-        except Exception as ex:
-            return json.loads(self.json_dumps(rep_str))
-
-    @classmethod
-    def get_sub_table(self,object_id,sub_count=0):
-        """
-        :description: 获取分表名称
-        :param object_id:对象标识
-        :param sub_count:分表数量
-        :return:
-        :last_editors: HuangJianYi
-        """
-        sub_table = None
-        if not sub_count or not object_id:
-            return sub_table
-        sub_table = str(int(object_id) % sub_count)
-        return sub_table
-
-    @classmethod
-    def remove_exponent(self, param):
-        """
-        :description: 去除参数多余的0，比如：100.00返回100，100.10返回100.1去掉尾数0
-        :param param:要去除0的参数
-        :return:
-        :last_editors: HuangJianYi
-        """
-        if isinstance(param, str):
-            param = decimal.Decimal(param)
-        return param.to_integral() if param == param.to_integral() else param.normalize()
-
-    @classmethod
-    def check_under_age(self, card_id):
-        """
-        :description: 根据身份证号校验是否未成年
-        :param card_id:身份证号
-        :return:True已成年False未成年
-        :last_editors: HuangJianYi
-        """
-        result = True
-        if len(card_id) == 18:
-            birthday_dict = self.get_birthday(card_id)
-            birthday_year = birthday_dict["year"]
-            birthday_month = birthday_dict["month"]
-            birthday_day = birthday_dict["day"]
-            now_time = datetime.datetime.today()
-            #获取今日日期
-            today = int(str(now_time.month) + str(now_time.day))
-            if now_time.day < 10:
-                today = int(str(now_time.month) + '0' + str(now_time.day))
-            #如果今日日期超过生日 则年龄为年份相减，否则年份相减再减1
-            age = 0
-            if today - int(birthday_month + birthday_day) > 0:
-                age = now_time.year - int(birthday_year)
-            else:
-                age = now_time.year - int(birthday_year) - 1
-            if age < 18:
-                result = False
-        return result
-
-    @classmethod
-    def get_birthday(self, card_id):
-        """
-        :description: 根据身份证号获取生日
-        :param card_id:身份证号
-        :return:字典
-        :last_editors: HuangJianYi
-        """
-        birthday_dict = {"year":0,"month":0,"day":0}
-        if len(card_id) == 18:
-            birthday_dict["year"] = card_id[6:10]
-            birthday_dict["month"] = card_id[10:12]
-            birthday_dict["day"] = card_id[12:14]
-        return birthday_dict
-
-    @classmethod
-    def get_enum_key(self, enum_class, enum_value, default_value=''):
-        """
-        :description: 根据枚举值获取枚举key
-        :param enum_class:枚举类
-        :param enum_value:枚举值
-        :param default_value:默认值
-        :return:str
-        :last_editors: HuangJianYi
-        """
-        try:
-            enum = enum_class(enum_value)
-            if enum:
-                return enum.name
-            else:
-                return default_value
-        except:
-            return default_value
-
-    @classmethod
-    def get_enum_value(self, enum_class, enum_key, default_value=''):
-        """
-        :description: 根据枚举key获取枚举值
-        :param enum_class:枚举类
-        :param enum_value:枚举key
-        :param default_value:默认值
-        :return:str
-        :last_editors: HuangJianYi
-        """
-        try:
-            for enum in enum_class:
-                if enum.name == enum_key:
-                    return enum.value
-            return default_value
-        except:
-            return default_value
-
-    @classmethod
-    def to_int(self, value, default_value=0, return_status=False):
-        """
-        :description: 转换成整形
-        :param value:值
-        :param default_value:出现异常的默认值
-        :param return_status:返回转换结果 True成功 False失败
-        :return:整形
-        :last_editors: HuangJianYi
-        """
-        status = True
-        try:
-            value = int(value)
-        except Exception as ex:
-            value = default_value
-            status = False
-        if return_status == True:
-            return value, status
-        return value
-
-    @classmethod
-    def to_decimal(self, value, default_value=0, return_status=False):
-        """
-        :description: 转换成浮点形
-        :param value:值
-        :param default_value:出现异常的默认值
-        :param return_status:返回转换结果 True成功 False失败
-        :return:浮点形
-        :last_editors: HuangJianYi
-        """
-        status = True
-        try:
-            value = decimal.Decimal(value)
-        except Exception as ex:
-            value = default_value
-            status = False
-        if return_status == True:
-            return value, status
-        return value
-
-    @classmethod
-    def to_date_time(self, value, fmt='%Y-%m-%d %H:%M:%S', default_value='1900-01-01 00:00:00', return_status=False):
-        """
-        :description: 转换成时间类型
-        :param value:值
-        :param fmt:时间格式化
-        :param default_value:出现异常的默认值
-        :param return_status:返回转换结果 True成功 False失败
-        :return:时间类型
-        :last_editors: HuangJianYi
-        """
-        status = True
-        try:
-            value = datetime.datetime.strptime(value, fmt)
-        except Exception as ex:
-            value = datetime.datetime.strptime(default_value, fmt)
-            status = False
-        if return_status == True:
-            return value, status
-        return value
-
-    @classmethod
-    def get_row_by_dict_list(self, dict_list, field_name, field_type=1):
-        """
-        :description: 获取字典列表中指定列的集合
-        :param field_name:字段名
-        :param field_type:字段类型（1整形2字符串）
-        :return:数组
-        :last_editors: HuangJianYi
-        """
-        if isinstance(dict_list,list) == False:
-            return []
-        if field_type == 1:
-            return [int(item[field_name]) for item in dict_list]
-        else:
-            return [str(item[field_name]) for item in dict_list]
-
-    @classmethod
-    def replace_value_to_list(self, data_list, old_item, new_item):
-        """
-        :description: 替换列表中指定元素，旧值换新值
-        :param old_item:旧元素(可对象、字典)
-        :param new_item:新元素(可对象、字典)
-        :return:list
-        :last_editors: HuangJianYi
-        """
-        try:
-            data_index = data_list.index(old_item)
-            data_list[data_index] = new_item
-        except:
-            pass
+# -*- coding: utf-8 -*-
+"""
+:Author: HuangJianYi
+:Date: 2021-07-15 11:54:54
+@LastEditTime: 2023-04-12 15:28:04
+@LastEditors: HuangJianYi
+:description: 常用帮助类
+"""
+from seven_framework import *
+from seven_framework.redis import *
+from seven_cloudapp_frame.libs.common import *
+from seven_cloudapp_frame.libs.customize.redis_helper import RedisExHelper
+from seven_cloudapp_frame.libs.customize.time_helper import TimeExHelper
+
+import random
+import datetime
+import re
+import ast
+
+
+
+class SevenHelper:
+    """
+    :description: 常用帮助类 提供常用方法 如：字典列表合并、请求太频繁校验、（入队列、出队列、校验队列长度 主要用于流量削峰场景）、创建分布式锁、释放分布式锁、序列化、反序列化、生成订单号等
+    """
+    @classmethod
+    def redis_init(self, db=None, config_dict=None, decode_responses=True):
+        """
+        :description: redis初始化
+        :return: redis_cli
+        :last_editors: HuangJianYi
+        """
+        return RedisExHelper.init(config_dict, decode_responses)
+
+    @classmethod
+    def is_continue_request(self, cache_key, expire=500):
+        """
+        :description: 请求太频繁校验
+        :param cache_key：自定义cache_key
+        :param expire：过期时间，单位毫秒
+        :return: bool true-代表连续请求进行限制，false-代表跳过限制
+        :last_editors: HuangJianYi
+        """
+        if share_config.get_value("is_pressure_test",False): #是否进行压力测试
+            return False
+        redis_init = self.redis_init()
+        post_value = redis_init.incr(cache_key,1)
+        redis_init.pexpire(cache_key,expire)
+        if post_value > 1:
+            return True
+        return False
+
+    @classmethod
+    def redis_check_llen(self,queue_name,queue_lenth=100):
+        """
+         :description: 校验队列长度
+         :param queue_name：自定义队列名称
+         :param queue_lenth：队列长度
+         :return: bool False-代表达到长度限制，进行拦截
+         :last_editors: HuangJianYi
+         """
+        return RedisExHelper.check_llen(queue_name, queue_lenth)
+
+    @classmethod
+    def redis_lpush(self, queue_name, value, expire):
+        """
+         :description: 入队列
+         :param queue_name：自定义队列名称
+         :param value：加入队列的数据
+         :param expire：过期时间，单位秒
+         :return:
+         :last_editors: HuangJianYi
+         """
+        RedisExHelper.lpush(queue_name, value, expire)
+
+    @classmethod
+    def redis_lpop(self, queue_name):
+        """
+         :description: 出队列
+         :param queue_name：队列名称
+         :return: 
+         :last_editors: HuangJianYi
+         """
+        return RedisExHelper.lpop(queue_name)
+
+    @classmethod
+    def redis_acquire_lock(self, lock_name, acquire_time=5, time_out=10):
+        """
+        :description: 创建分布式锁
+        :param lock_name：锁定名称
+        :param acquire_time: 客户端等待获取锁的时间,单位秒
+        :param time_out: 锁的超时时间,单位秒
+        :return 分布式锁是否获得（True获得False未获得）和解锁钥匙（释放锁时需传入才能解锁成功）
+        :last_editors: HuangJianYi
+        """
+        return RedisExHelper.acquire_lock(lock_name, acquire_time, time_out)
+
+    @classmethod
+    def redis_release_lock(self, lock_name, identifier):
+        """
+        :description: 释放分布式锁
+        :param lock_name：锁定名称
+        :param identifier: identifier
+        :return bool
+        :last_editors: HuangJianYi
+        """
+        return RedisExHelper.release_lock(lock_name, identifier)
+
+    @classmethod
+    def merge_dict_list(self, source_dict_list, source_key, merge_dict_list, merge_key, merge_columns_names='', exclude_merge_columns_names=''):
+        """
+        :description: 两个字典列表合并
+        :param source_dict_list：源字典表
+        :param source_key：源表用来关联的字段
+        :param merge_dict_list：需要合并的字典表
+        :param merge_key：需要合并的字典表用来关联的字段
+        :param merge_columns_names：需要合并的字典表中需要展示的字段
+        :param exclude_merge_columns_names：需要合并的字典表中不需要展示的字段
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        result = []
+        if merge_columns_names:
+            list_key = list(merge_columns_names.split(","))
+        else:
+            list_key = list(merge_dict_list[0].keys()) if len(merge_dict_list)>0 else []
+        if exclude_merge_columns_names:
+            exclude_key = list(exclude_merge_columns_names.split(","))
+            list_key = list(set(list_key).difference(set(exclude_key)))
+        for source_dict in source_dict_list:
+            info_list = [i for i in merge_dict_list if source_dict[source_key] and str(i[merge_key]) == str(source_dict[source_key])]
+            if info_list:
+                source_dict = dict(source_dict, **dict.fromkeys(list_key))
+                for item in list_key:
+                    source_dict[item] = info_list[0].get(item,'')
+            else:
+                for item in list_key:
+                    if item not in source_dict.keys():
+                        source_dict[item] = ''
+            result.append(source_dict)
+        return result
+
+    @classmethod
+    def auto_mapper(self, s_model, map_dict=None):
+        '''
+        :description: 对象映射,字典转实体（把map_dict值赋值到实体s_model中）
+        :param s_model：需要映射的实体对象
+        :param map_dict：被映射的实体字典
+        :return: obj
+        :last_editors: HuangJianYi
+        '''
+        if map_dict:
+            field_list = s_model.get_field_list()
+            for filed in field_list:
+                if filed in map_dict:
+                    setattr(s_model, filed, map_dict[filed])
+        return s_model
+
+    @classmethod
+    def get_condition_by_str_list(self, field_name, str_list, is_in=True):
+        """
+        :description: 根据str_list返回查询条件 in查询参数化，如：act_info_model.get_list("FIND_IN_SET(act_name,%s)", params=['活动1,活动2'])
+        :param field_name: 字段名
+        :param str_list: 字符串数组
+        :param is_in: 是否in查询，是in查询 否not in 查询
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        if not str_list:
+            return ""
+        list_str = ','.join(["'%s'" % str(item) for item in str_list])
+        if is_in:
+            return f"{field_name} IN({list_str})"
+        else:
+            return f"{field_name} NOT IN({list_str})"
+
+    @classmethod
+    def get_condition_by_int_list(self, field_name, int_list, is_in=True):
+        '''
+        :description: 根据int_list返回查询条件 in查询参数化，如：act_info_model.get_list("FIND_IN_SET(act_name,%s)", params=['活动1,活动2'])
+        :param field_name:字段名
+        :param int_list:整形数组
+        :param is_in: 是否in查询，是in查询 否not in 查询
+        :return: str
+        :last_editors: HuangJianYi
+        '''
+        if not int_list:
+            return ""
+        list_str = str(int_list).strip('[').strip(']')
+        if is_in:
+            return f"{field_name} IN({list_str})"
+        else:
+            return f"{field_name} NOT IN({list_str})"
+
+    @classmethod
+    def get_condition_in(self, field_name, field_str, field_type=1, is_in=True):
+        '''
+        :description: 根据逗号分隔字符串合成条件
+        :param field_name:字段名
+        :param field_str:逗号分隔字符串
+        :param field_type:字段类型（1整形2字符串）
+        :param is_in: 是否in查询，是in查询 否not in 查询
+        :return: 查询字符串
+        :last_editors: HuangJianYi
+        '''
+        if not field_str:
+            return ""
+        str_list = []
+        if field_type == 1:
+            try:
+                str_list = [int(x) for x in field_str.split(",")]
+            except Exception as ex:
+                pass
+            if len(str_list) <= 0:
+                return ""
+            list_str = str(str_list).strip('[').strip(']')
+        else:
+            str_list = field_str.split(",")
+            list_str = ','.join(["'%s'" % str(item) for item in str_list])
+        if is_in:
+            return f"{field_name} IN({list_str})"
+        else:
+            return f"{field_name} NOT IN({list_str})"
+
+    @classmethod
+    def is_ip(self, ip_str):
+        """
+        :description: 判断是否IP地址
+        :param ip_str: ip串
+        :return:
+        :last_editors: HuangJianYi
+        """
+        p = re.compile('^((25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(25[0-5]|2[0-4]\d|[01]?\d\d?)$')
+        if p.match(str(ip_str)):
+            return True
+        return False
+
+    @classmethod
+    def get_first_ip(self,remote_ip):
+        """
+        :description: 获取第一个IP
+        :param remote_ip: ip串
+        :return:
+        """
+        if remote_ip and "," in remote_ip:
+            return remote_ip.split(",")[0]
+        else:
+            return remote_ip
+
+    @classmethod
+    def to_file_size(self, size):
+        """
+        :description: 文件大小格式化
+        :param size：文件大小
+        :return: str
+        :last_editors: HuangJianYi
+        """
+        if size < 1000:
+            return '%i' % size + 'size'
+        elif 1024 <= size < 1048576:
+            return '%.2f' % float(size / 1024) + 'KB'
+        elif 1048576 <= size < 1073741824:
+            return '%.2f' % float(size / 1048576) + 'MB'
+        elif 1073741824 <= size < 1000000000000:
+            return '%.2f' % float(size / 1073741824) + 'GB'
+        elif 1000000000000 <= size:
+            return '%.2f' % float(size / 1000000000000) + 'TB'
+
+    @classmethod
+    def get_random(self,length):
+        """
+        :description: 获取随机字符串
+        :param length：长度
+        :return: str
+        :last_editors: HuangJianYi
+        """
+        result = ""
+        for i in range(length):
+            # n=1 生成数字  n=2 生成字母
+            n = random.randint(1, 2)
+            if n == 1:
+                numb = random.randint(0, 9)
+                result += str(numb)
+            else:
+                nn = random.randint(1, 2)
+                cc = random.randint(1, 26)
+                if nn == 1:
+                    numb = chr(64 + cc)
+                    result += numb
+                else:
+                    numb = chr(96 + cc)
+                    result += numb
+        return result
+
+    @classmethod
+    def get_random_switch_string(self, random_str, split_chars=","):
+        """
+        :description: 随机取得字符串
+        :param trimChars：根据什么符号进行分割
+        :return: str
+        :last_editors: HuangJianYi
+        """
+        if random_str == "":
+            return ""
+        random_list = [i for i in random_str.split(split_chars) if i != ""]
+        return random.choice(random_list)
+
+    @classmethod
+    def get_now_datetime(self):
+        """
+        :description: 获取当前时间
+        :return: str
+        :last_editors: HuangJianYi
+        """
+        return TimeHelper.get_now_format_time()
+
+    @classmethod
+    def get_now_int(self, hours=0, minutes=0, fmt='%Y%m%d%H%M%S'):
+        """
+        :description: 获取整形的时间 格式为yyyyMMddHHmmss，如2009年12月27日9点10分10秒表示为20091227091010
+        :param hours: 需要增加的小时数
+        :param hours: 需要增加的分钟数
+        :param fmt: 时间格式
+        :return:
+        :last_editors: HuangJianYi
+        """
+        return TimeExHelper.get_now_int(hours, minutes, fmt)
+
+    @classmethod
+    def get_now_hour_int(self, hours=0):
+        """
+        :description: 获取整形的小时2020050612
+        :param hours: 需要增加的小时数
+        :return: int（2020050612）
+        :last_editors: HuangJianYi
+        """
+        return TimeExHelper.get_now_int(hours=hours, fmt='%Y%m%d%H')
+
+    @classmethod
+    def get_now_day_int(self, hours=0):
+        """
+        :description: 获取整形的天20200506
+        :param hours: 需要增加的小时数
+        :return: int（20200506）
+        :last_editors: HuangJianYi
+        """
+        return TimeExHelper.get_now_int(hours=hours, fmt='%Y%m%d')
+
+    @classmethod
+    def get_now_month_int(self, hours=0):
+        """
+        :description: 获取整形的月202005
+        :param hours: 需要增加的小时数
+        :return: int（202005）
+        :last_editors: HuangJianYi
+        """
+        return TimeExHelper.get_now_int(hours=hours, fmt='%Y%m')
+
+    @classmethod
+    def get_date_list(self, start_date, end_date):
+        """
+        :description: 两个日期之间的日期列表
+        :param start_date：开始日期
+        :param end_date：结束日期
+        :return: list
+        :last_editors: HuangJianYi
+        """
+        return TimeExHelper.get_date_list(start_date, end_date)
+
+    @classmethod
+    def get_page_count(self, page_size, record_count):
+        """
+        @description: 计算页数
+        @param page_size：页大小
+        @param record_count：总记录数
+        @return: 页数
+        @last_editors: HuangJianYi
+        """
+        page_count = record_count / page_size + 1
+        if page_size == 0:
+            page_count = 0
+        if record_count % page_size == 0:
+            page_count = record_count / page_size
+        page_count = int(page_count)
+        return page_count
+
+    @classmethod
+    def create_order_id(self, ran=5):
+        """
+        :description: 生成订单号
+        :param ran：随机数位数，默认5位随机数（0-5）
+        :return: 25位的订单号
+        :last_editors: HuangJianYi
+        """
+        ran_num = ""
+        if ran == 1:
+            ran_num = random.randint(0, 9)
+        elif ran == 2:
+            ran_num = random.randint(10, 99)
+        elif ran == 3:
+            ran_num = random.randint(100, 999)
+        elif ran == 4:
+            ran_num = random.randint(1000, 9999)
+        elif ran == 5:
+            ran_num = random.randint(10000, 99999)
+        # cur_time = TimeHelper.get_now_format_time('%Y%m%d%H%M%S%f')
+        cur_time = TimeHelper.get_now_timestamp(True)
+        order_id = str(cur_time) + str(ran_num)
+        return order_id
+
+    @classmethod
+    def json_dumps(self, rep_dic):
+        """
+        :description: 对象编码成Json字符串
+        :param rep_dic：字典对象
+        :return: str
+        :last_editors: HuangJianYi
+        """
+        try:
+            if rep_dic == "":
+                return ""
+            rep_dic = ast.literal_eval(rep_dic)
+        except Exception:
+            pass
+        if hasattr(rep_dic, '__dict__'):
+            rep_dic = rep_dic.__dict__
+        return json.dumps(rep_dic, ensure_ascii=False, cls=JsonEncoder, default=lambda x: (x.__dict__ if not isinstance(x, datetime.datetime) else datetime.datetime.strftime(x, '%Y-%m-%d %H:%M:%S')) if not isinstance(x, decimal.Decimal) else float(x), sort_keys=False, indent=None)
+
+    @classmethod
+    def json_loads(self, rep_str):
+        """
+        :description: 将Json字符串解码成python对象
+        :param rep_str：str
+        :return: dict
+        :last_editors: HuangJianYi
+        """
+        try:
+            return json.loads(rep_str)
+        except Exception as ex:
+            return json.loads(self.json_dumps(rep_str))
+
+    @classmethod
+    def get_sub_table(self,object_id,sub_count=0):
+        """
+        :description: 获取分表名称
+        :param object_id:对象标识
+        :param sub_count:分表数量
+        :return:
+        :last_editors: HuangJianYi
+        """
+        sub_table = None
+        if not sub_count or not object_id:
+            return sub_table
+        sub_table = str(int(object_id) % sub_count)
+        return sub_table
+
+    @classmethod
+    def remove_exponent(self, param):
+        """
+        :description: 去除参数多余的0，比如：100.00返回100，100.10返回100.1去掉尾数0
+        :param param:要去除0的参数
+        :return:
+        :last_editors: HuangJianYi
+        """
+        if isinstance(param, str):
+            param = decimal.Decimal(param)
+        return param.to_integral() if param == param.to_integral() else param.normalize()
+
+    @classmethod
+    def check_under_age(self, card_id):
+        """
+        :description: 根据身份证号校验是否未成年
+        :param card_id:身份证号
+        :return:True已成年False未成年
+        :last_editors: HuangJianYi
+        """
+        result = True
+        if len(card_id) == 18:
+            birthday_dict = self.get_birthday(card_id)
+            birthday_year = birthday_dict["year"]
+            birthday_month = birthday_dict["month"]
+            birthday_day = birthday_dict["day"]
+            now_time = datetime.datetime.today()
+            #获取今日日期
+            today = int(str(now_time.month) + str(now_time.day))
+            if now_time.day < 10:
+                today = int(str(now_time.month) + '0' + str(now_time.day))
+            #如果今日日期超过生日 则年龄为年份相减，否则年份相减再减1
+            age = 0
+            if today - int(birthday_month + birthday_day) > 0:
+                age = now_time.year - int(birthday_year)
+            else:
+                age = now_time.year - int(birthday_year) - 1
+            if age < 18:
+                result = False
+        return result
+
+    @classmethod
+    def get_birthday(self, card_id):
+        """
+        :description: 根据身份证号获取生日
+        :param card_id:身份证号
+        :return:字典
+        :last_editors: HuangJianYi
+        """
+        birthday_dict = {"year":0,"month":0,"day":0}
+        if len(card_id) == 18:
+            birthday_dict["year"] = card_id[6:10]
+            birthday_dict["month"] = card_id[10:12]
+            birthday_dict["day"] = card_id[12:14]
+        return birthday_dict
+
+    @classmethod
+    def get_enum_key(self, enum_class, enum_value, default_value=''):
+        """
+        :description: 根据枚举值获取枚举key
+        :param enum_class:枚举类
+        :param enum_value:枚举值
+        :param default_value:默认值
+        :return:str
+        :last_editors: HuangJianYi
+        """
+        try:
+            enum = enum_class(enum_value)
+            if enum:
+                return enum.name
+            else:
+                return default_value
+        except:
+            return default_value
+
+    @classmethod
+    def get_enum_value(self, enum_class, enum_key, default_value=''):
+        """
+        :description: 根据枚举key获取枚举值
+        :param enum_class:枚举类
+        :param enum_value:枚举key
+        :param default_value:默认值
+        :return:str
+        :last_editors: HuangJianYi
+        """
+        try:
+            for enum in enum_class:
+                if enum.name == enum_key:
+                    return enum.value
+            return default_value
+        except:
+            return default_value
+
+    @classmethod
+    def to_int(self, value, default_value=0, return_status=False):
+        """
+        :description: 转换成整形
+        :param value:值
+        :param default_value:出现异常的默认值
+        :param return_status:返回转换结果 True成功 False失败
+        :return:整形
+        :last_editors: HuangJianYi
+        """
+        status = True
+        try:
+            value = int(value)
+        except Exception as ex:
+            value = default_value
+            status = False
+        if return_status == True:
+            return value, status
+        return value
+
+    @classmethod
+    def to_decimal(self, value, default_value=0, return_status=False):
+        """
+        :description: 转换成浮点形
+        :param value:值
+        :param default_value:出现异常的默认值
+        :param return_status:返回转换结果 True成功 False失败
+        :return:浮点形
+        :last_editors: HuangJianYi
+        """
+        status = True
+        try:
+            value = decimal.Decimal(value)
+        except Exception as ex:
+            value = default_value
+            status = False
+        if return_status == True:
+            return value, status
+        return value
+
+    @classmethod
+    def to_date_time(self, value, fmt='%Y-%m-%d %H:%M:%S', default_value='1900-01-01 00:00:00', return_status=False):
+        """
+        :description: 转换成时间类型
+        :param value:值
+        :param fmt:时间格式化
+        :param default_value:出现异常的默认值
+        :param return_status:返回转换结果 True成功 False失败
+        :return:时间类型
+        :last_editors: HuangJianYi
+        """
+        status = True
+        try:
+            value = datetime.datetime.strptime(value, fmt)
+        except Exception as ex:
+            value = datetime.datetime.strptime(default_value, fmt)
+            status = False
+        if return_status == True:
+            return value, status
+        return value
+
+    @classmethod
+    def get_row_by_dict_list(self, dict_list, field_name, field_type=1):
+        """
+        :description: 获取字典列表中指定列的集合
+        :param field_name:字段名
+        :param field_type:字段类型（1整形2字符串）
+        :return:数组
+        :last_editors: HuangJianYi
+        """
+        if isinstance(dict_list,list) == False:
+            return []
+        if field_type == 1:
+            return [int(item[field_name]) for item in dict_list]
+        else:
+            return [str(item[field_name]) for item in dict_list]
+
+    @classmethod
+    def replace_value_to_list(self, data_list, old_item, new_item):
+        """
+        :description: 替换列表中指定元素，旧值换新值
+        :param old_item:旧元素(可对象、字典)
+        :param new_item:新元素(可对象、字典)
+        :return:list
+        :last_editors: HuangJianYi
+        """
+        try:
+            data_index = data_list.index(old_item)
+            data_list[data_index] = new_item
+        except:
+            pass
         return data_list
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/libs/customize/tiktok_helper.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/libs/customize/tiktok_helper.py`

 * *Ordering differences only*

 * *Files 18% similar despite different names*

```diff
@@ -1,667 +1,667 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-01-14 10:44:07
-@LastEditTime: 2023-02-10 09:59:17
-@LastEditors: HuangJianYi
-@Description: 
-"""
-import requests
-import json
-import hashlib
-from Crypto.Cipher import AES
-import base64
-from seven_cloudapp_frame.libs.common import *
-from seven_cloudapp_frame.libs.customize.seven_helper import *
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.seven_model import InvokeResultData
-
-
-class TikTokHelper:
-    """
-    :description: 抖音帮助类 1.临时登录凭证校验获取open_id、session_key  2.解析加密数据
-    """
-    logger_error = Logger.get_logger_by_name("log_error")
-
-    @classmethod
-    def code2_session(self, code="", anonymous_code="", app_id="", app_secret=""):
-        """
-        :description:获取open_id、session_key等信息
-        :param code: 登录票据,非匿名需要 code
-        :param anonymous_code: 非匿名下的 anonymous_code 用于数据同步，匿名需要 anonymous_code
-        :param app_id: app_id
-        :param app_secret: app_secret
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = app_id if app_id else share_config.get_value("app_id")
-        app_secret = app_secret if app_secret else share_config.get_value("app_secret")
-
-        invoke_result_data = InvokeResultData()
-        redis_key = f"{app_id}_tiktok_login_code:{code}"
-        redis_init = SevenHelper.redis_init()
-        code2_session_dict = redis_init.get(redis_key)
-        if code2_session_dict:
-            code2_session_dict = SevenHelper.json_loads(code2_session_dict)
-            invoke_result_data.data = code2_session_dict
-            return invoke_result_data
-        param = {
-            'code': code,  # 用户点击按钮跳转到抖音授权页, 抖音处理完后重定向到redirect_uri, 并给我们加上code=xxx的参数, 这个code就是我们需要的
-            'appid': app_id,
-            'secret': app_secret,
-            'anonymous_code': anonymous_code,
-        }
-        response = None
-        try:
-            requset_url = 'https://developer.toutiao.com/api/apps/v2/jscode2session'
-            headers = {"Content-type": "application/json"}
-            response = requests.post(requset_url, headers=headers, data=json.dumps(param))
-            response_data = SevenHelper.json_loads(response.text)
-            if response_data.__contains__("err_no") and response_data["err_no"] != 0:
-                invoke_result_data.success = False
-                invoke_result_data.error_code = response_data["err_no"]
-                invoke_result_data.error_message = response_data["err_tips"]
-                return invoke_result_data
-            open_id = response_data["data"]['openid']
-            session_key = response_data["data"]['session_key']
-            redis_init.set(redis_key, SevenHelper.json_dumps(response_data["data"]), ex=60 * 60)
-            redis_init.set(f"{app_id}_tiktok_sessionkey:{str(open_id)}", session_key, ex=60 * 60)
-            invoke_result_data.data = response_data["data"]
-            return invoke_result_data
-        except Exception as ex:
-            self.logger_error.error("【code2_session】" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "exception"
-            invoke_result_data.error_message = traceback.format_exc()
-            return invoke_result_data
-
-    @classmethod
-    def get_access_token(self, grant_type="client_credential", app_id="", app_secret=""):
-        """
-        :description:access_token 是小程序的全局唯一调用凭据，开发者调用小程序支付时需要使用 access_token。access_token 的有效期为 2 个小时，需要定时刷新 access_token，重复获取会导致之前一次获取的 access_token 的有效期缩短为 5 分钟。
-        :param grant_type: 获取access_token 时值为 client_credential
-        :param app_id: app_id
-        :param app_secret: app_secret
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = app_id if app_id else share_config.get_value("app_id")
-        app_secret = app_secret if app_secret else share_config.get_value("app_secret")
-
-        invoke_result_data = InvokeResultData()
-        param = {
-            'appid': app_id,
-            'secret': app_secret,
-            'grant_type': grant_type,
-        }
-        response = None
-        redis_init = SevenHelper.redis_init(config_dict=share_config.get_value("platform_redis"))
-        redis_key = f"tiktok_access_token:{str(app_id)}"
-        try:
-            access_token = redis_init.get(redis_key)
-            if access_token:
-                invoke_result_data.data = access_token
-                return invoke_result_data
-            requset_url = 'https://developer.toutiao.com/api/apps/token'
-            headers = {"Content-type": "application/json"}
-            response = requests.post(requset_url, headers=headers, data=json.dumps(param))
-            response_data = SevenHelper.json_loads(response.text)
-            if response_data.__contains__("err_no") and response_data["err_no"] != 0:
-                invoke_result_data.success = False
-                invoke_result_data.error_code = response_data["err_no"]
-                invoke_result_data.error_message = response_data["err_tips"]
-                return invoke_result_data
-            invoke_result_data.data = str(response_data["access_token"])
-            redis_init.set(redis_key, invoke_result_data.data, ex=3600)
-            return invoke_result_data
-        except Exception as ex:
-            self.logger_error.error("【get_access_token】" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "exception"
-            invoke_result_data.error_message = traceback.format_exc()
-            return invoke_result_data
-
-    @classmethod
-    def decrypt_data_by_code(self, open_id, code, encrypted_Data, iv, app_id="", app_secret=""):
-        """
-        :description:解析加密数据，客户端判断是否登录状态，如果登录只传open_id不传code，如果是登录过期,要传code重新获取session_key
-        :param open_id：open_id
-        :param code：登录票据
-        :param encrypted_Data：加密数据,抖音返回加密参数
-        :param iv：抖音返回参数
-        :param app_id: app_id
-        :param app_secret: app_secret
-        :return: 解密后的数据，用户信息或者手机号信息
-        :last_editors: HuangJianYi
-        """
-        app_id = app_id if app_id else share_config.get_value("app_id")
-        app_secret = app_secret if app_secret else share_config.get_value("app_secret")
-
-        data = {}
-        if code:
-            code2_session_dict = self.code2_session(code=code, app_id=app_id, app_secret=app_secret)
-            if code2_session_dict:
-                open_id = code2_session_dict["openid"]
-        try:
-            session_key = SevenHelper.redis_init().get(f"{app_id}_tiktok_sessionkey:{str(open_id)}")
-            data_crypt = TikTokBizDataCrypt(app_id, session_key)
-            data = data_crypt.decrypt(encrypted_Data, iv)  #data中是解密的信息
-        except Exception as ex:
-            self.logger_error.error("【decrypt_data_by_code】" + traceback.format_exc())
-        return data
-
-    @classmethod
-    def decrypt_data(self, session_key, encrypted_Data, iv, app_id=""):
-        """
-        :description:解析加密数据
-        :param session_key: session_key调用登录接口获得
-        :param encrypted_Data：加密数据,抖音返回加密参数
-        :param iv：抖音返回参数
-        :param app_id: 抖音小程序标识
-        :return: 解密后的数据，用户信息或者手机号信息
-        :last_editors: HuangJianYi
-        """
-        app_id = app_id if app_id else share_config.get_value("app_id")
-
-        data = {}
-        try:
-            data_crypt = TikTokBizDataCrypt(app_id, session_key)
-            #data中是解密的信息
-            data = data_crypt.decrypt(encrypted_Data, iv)
-        except Exception as ex:
-            self.logger_error.error("【decrypt_data】" + traceback.format_exc())
-        return data
-
-    @classmethod
-    def create_qr_code(self, access_token, appname="douyin", path="", width=430, line_color={ "r": 0, "g": 0, "b": 0 }, background={ "r": 255, "g": 255, "b": 255 }):
-        """
-        :description:获取小程序/小游戏的二维码。该二维码可通过任意 app 扫码打开，能跳转到开发者指定的对应字节系 app 内拉起小程序/小游戏， 并传入开发者指定的参数。通过该接口生成的二维码，永久有效，暂无数量限制。
-        :param access_token: 服务端 API 调用标识
-        :param appname: 打开二维码的字节系 app 名称
-        :param path: 小程序/小游戏启动参数，小程序则格式为 encode({path}?{query})，小游戏则格式为 JSON 字符串，默认为空
-        :param width: 二维码宽度，单位 px，最小 280px，最大 1280px，默认为 430px
-        :param line_color: 二维码线条颜色，默认为黑色
-        :param background: 二维码背景颜色，默认为白色
-        :return: 图片二进制 数据类型Array<byte>
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        param = {
-                "appname": appname,
-                "access_token": access_token,
-                "path": path,
-                "width": width,
-                "line_color": line_color,
-                "background": background
-                }
-        response = ""
-        try:
-            requset_url = 'https://developer.toutiao.com/api/apps/token'
-            headers = {"Content-type": "application/json"}
-            response = requests.post(requset_url, headers=headers, data=json.dumps(param))
-            response_data = SevenHelper.json_loads(response.text)
-            if response_data["errcode"] != 0:
-                invoke_result_data.success = False
-                invoke_result_data.error_code = response_data["err_no"]
-                invoke_result_data.error_message = response_data["err_tips"]
-                return invoke_result_data
-            else:
-                invoke_result_data.data = response_data.content
-            return invoke_result_data
-        except Exception as ex:
-            self.logger_error.error("【create_qr_code】" + traceback.format_exc() + ":" + str(response.text))
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "exception"
-            invoke_result_data.error_message = traceback.format_exc()
-            return invoke_result_data
-
-
-class TikTokPayRequest(object):
-    """
-    :description: 抖音支付请求类,配置文件内容 "tiktok_pay": {"cp_extra": "","token": "","salt": ""}
-    """
-    # =======【基本信息设置】=====================================
-    # 抖音公众号身份的唯一标识。审核通过后，在抖音发送的邮件中查看
-    app_id = ""
-    #开发者自定义字段，回调原样回传
-    cp_extra = ""
-    #担保交易Token（令牌）
-    token = ""
-    #担保交易密钥
-    salt = ""
-    # 日志
-    logger_error = Logger.get_logger_by_name("log_error")
-
-    def __init__(self, app_id="", cp_extra="", token="", salt=""):
-        """
-        :description: 初始化
-        :last_editors: HuangJianYi
-        """
-        pay_config = share_config.get_value("tiktok_pay")
-        self.app_id = app_id if app_id else share_config.get_value("app_id")
-        self.cp_extra = cp_extra if cp_extra else pay_config["cp_extra"]
-        self.token = token if token else pay_config["token"]
-        self.salt = salt if salt else pay_config["salt"]
-
-    def create_order(self, pay_order_no, notify_url, total_amount=1, subject="", body="", valid_time=900, thirdparty_id="", disable_msg=None, msg_page=""):
-        """
-        :description: 服务端创建预下单
-        :param pay_order_no：商户订单号(支付单号)开发者服务端的唯一订单号
-        :param notify_url：支付结果异步通知地址
-        :param total_amount:支付价格;单位元
-        :param subject: 商品描述; 长度限制 128 字节，不超过 42 个汉字 |默认 自己约定一个比如 “福小宠商品”*|
-        :param body:商品详情|默认 自己约定一个比如 “福小宠商品”
-        :param valid_time:订单过期时间(秒); 最小 15 分钟，最大两天|默认 900
-        :param thirdparty_id:服务商模式接入必传,第三方平台服务商 id，非服务商模式留空|默认传空字符串
-        :param disable_msg:是否屏蔽担保支付的推送消息，1-屏蔽 0-非屏蔽，接入 POI 必传|默认传None
-        :param msg_page:担保支付消息跳转页|默认传空字符串
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        try:
-            data = {}
-            data['app_id'] = self.app_id
-            data['out_order_no'] = pay_order_no
-            data['total_amount'] = int(decimal.Decimal(str(total_amount)) * 100)
-            data['subject'] = subject
-            data['body'] = body
-            data['valid_time'] = valid_time
-            if notify_url:
-                data['notify_url'] = notify_url
-            if self.cp_extra:
-                data['cp_extra'] = self.cp_extra
-            if disable_msg:
-                data['disable_msg'] = int(disable_msg)
-            if msg_page:
-                data['msg_page'] = msg_page
-            if thirdparty_id:
-                data['thirdparty_id'] = thirdparty_id
-
-            sign = self.get_sign(data)
-            # 如果有第三方平台服务商id:thirdparty_id字段请把他放入data的字典里面
-            data['sign'] = sign
-
-            redis_key = f"{self.app_id}_tiktok_order_id:{str(pay_order_no)}"
-            orderInfo = SevenHelper.redis_init().get(redis_key)
-            if orderInfo:
-                invoke_result_data.data = SevenHelper.json_loads(orderInfo)
-                return invoke_result_data
-
-            url = "https://developer.toutiao.com/api/apps/ecpay/v1/create_order"
-            headers = {"Content-type": "application/json"}
-            response = requests.post(url, headers=headers, data=json.dumps(data))
-            response_data = SevenHelper.json_loads(response.text)
-            # err_no	number	    状态码 0-业务处理成功
-            # err_tips	string	    错误提示信息，常见错误处理可参考附录常见问题章节
-            # data	    orderInfo	拉起收银台的 orderInfo
-            # {"err_no": 2000, "err_tips": "单号记录不存在", "data": null}
-            if response_data['err_no'] == 0:
-                SevenHelper.redis_init().set(redis_key, SevenHelper.json_dumps(response_data['data']), ex=3600 * 1)
-                invoke_result_data.data = response_data['data']
-                return invoke_result_data
-            else:
-                self.logger_error.error(f"【{pay_order_no},创建预下单】" + response_data['err_tips'])
-                invoke_result_data.success = False
-                invoke_result_data.error_code="error"
-                invoke_result_data.error_message = response_data['err_tips']
-                return invoke_result_data
-        except Exception as ex:
-            self.logger_error.error("【创建预下单】" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_code="error"
-            invoke_result_data.error_message = "创建预下单出现异常，请重试"
-            return invoke_result_data
-
-    def query_order(self, pay_order_no, thirdparty_id=""):
-        """
-        :description: 查询订单
-        :param pay_order_no：开发者侧的订单号, 不可重复
-        :param thirdparty_id: 服务商模式接入必传  第三方平台服务商 id，非服务商模式留空字符串|默认值 空字符串
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        try:
-            app_id = self.app_id
-            data = {}
-            data['out_order_no'] = pay_order_no
-            sign = self.get_sign(data)
-            data['sign'] = sign
-            data['app_id'] = app_id
-            if thirdparty_id:
-                data['thirdparty_id'] = thirdparty_id
-
-            url = "https://developer.toutiao.com/api/apps/ecpay/v1/query_order"
-            headers = {"Content-type": "application/json"}
-            response = requests.post(url, headers=headers, data=json.dumps(data))
-            response_data = SevenHelper.json_loads(response.text)
-            # {"err_no": 2000, "err_tips": "单号记录不存在", "out_order_no": "", "order_id": "", "payment_info": null}
-            # payment_info 返回值结构如下：
-            # {
-            #     "total_fee": 1200,
-            #     "order_status": "PROCESSING-处理中|SUCCESS-成功|FAIL-失败|TIMEOUT-超时",
-            #     "pay_time": "支付时间",
-            #     "way": 1,
-            #     "channel_no": "渠道单号",
-            #     "channel_gateway_no": "渠道网关号"
-            # }
-            if response_data['err_no'] == 0:
-                invoke_result_data.data = response_data
-                return invoke_result_data
-            else:
-                self.logger_error.error(f"【{pay_order_no},查询订单】" + response_data['err_tips'])
-                invoke_result_data.success = False
-                invoke_result_data.error_code="error"
-                invoke_result_data.error_message = response_data['err_tips']
-                return invoke_result_data
-
-        except Exception as ex:
-            self.logger_error.error("【查询订单】" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_code="error"
-            invoke_result_data.error_message = "查询订单出现异常，请重试"
-            return invoke_result_data
-
-    def get_pay_status(self, pay_order_no, thirdparty_id=""):
-        """
-        :description: 查询订单状态
-        :param pay_order_no：开发者侧的订单号, 不可重复
-        :param thirdparty_id: 服务商模式接入必传  第三方平台服务商 id，非服务商模式留空字符串|默认值 空字符串
-        :return: PROCESSING-处理中|SUCCESS-成功|FAIL-失败|TIMEOUT-超时
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        invoke_result_data = self.query_order(pay_order_no, thirdparty_id)
-        if invoke_result_data.success == False:
-            return ""
-        else:
-            response_data = invoke_result_data.data
-            if response_data['payment_info']:
-                return response_data['payment_info']['order_status']
-            else:
-                return ""
-
-    def create_refund(self, refund_no, pay_order_no, notify_url, refund_amount=1, reason="", thirdparty_id="", disable_msg=None, msg_page="", all_settle=None):
-        """
-        :description: 服务端退款请求
-        :param refund_no:开发者侧的退款单号, 不可重复
-        :param pay_order_no:商户分配订单号，标识进行退款的订单，开发者服务端的唯一订单号
-        :param notify_url:退款通知地址
-        :param refund_amount: 退款金额；单位元
-        :param reason:退款理由，长度上限 100|默认 由开发者定 例如：“7天无理由退款”
-        :param thirdparty_id:服务商模式接入必传,第三方平台服务商 id，非服务商模式留空|默认传空字符串
-        :param disable_msg:是否屏蔽担保支付的推送消息，1-屏蔽 0-非屏蔽，接入 POI 必传|默认传None
-        :param msg_page:担保支付消息跳转页|默认传空字符串
-        :param all_settle:是否为分账后退款，1-分账后退款；0-分账前退款。分账后退款会扣减可提现金额，请保证余额充足*|默认传None
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        try:
-            data = {}
-            data['app_id'] = self.app_id
-            data['out_refund_no'] = refund_no
-            data['out_order_no'] = pay_order_no
-            data['refund_amount'] = int(decimal.Decimal(str(refund_amount)) * 100)
-            data['reason'] = reason
-            #cp_extra 开发者自定义字段，回调原样回传
-            if self.cp_extra:
-                data['cp_extra'] = self.cp_extra
-            if notify_url:
-                data['notify_url'] = notify_url
-            if disable_msg:
-                data['disable_msg'] = int(disable_msg)
-            if msg_page:
-                data['msg_page'] = msg_page
-            if all_settle:
-                data['all_settle'] = int(all_settle)
-            if thirdparty_id:
-                data['thirdparty_id'] = thirdparty_id
-
-            sign = self.get_sign(data)
-            # 如果有第三方平台服务商 id :thirdparty_id字段请把他放入data.update的字典里面
-            data['sign'] = sign
-
-            url = "https://developer.toutiao.com/api/apps/ecpay/v1/create_refund"
-            headers = {"Content-type": "application/json"}
-            response = requests.post(url, headers=headers, data=json.dumps(data))
-            response_data = SevenHelper.json_loads(response.text)
-            if response_data['err_no'] == 0:
-                invoke_result_data.data = response_data
-                return invoke_result_data
-        except Exception as ex:
-            self.logger_error.error("【创建退款单】" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "退款出现异常，请重试"
-            return invoke_result_data
-
-    def query_refund(self, refund_no="", thirdparty_id=""):
-        """
-        :desciption:退款查询
-        :param refund_no:开发者侧的退款单号, 不可重复
-        :param thirdparty_id:服务商模式接入必传  第三方平台服务商 id，非服务商模式留空字符串
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        try:
-            app_id = self.app_id
-            data = {}
-            data['out_refund_no'] = refund_no
-            sign = self.get_sign(data)
-            data['sign'] = sign
-            data['app_id'] = app_id
-            if thirdparty_id:
-                data['thirdparty_id'] = thirdparty_id
-
-            url = "https://developer.toutiao.com/api/apps/ecpay/v1/query_refund"
-            headers = {"Content-type": "application/json"}
-            response = requests.post(url, headers=headers, data=json.dumps(data))
-            response_data = SevenHelper.json_loads(response.text)
-            if response_data['err_no'] == 0:
-                invoke_result_data.data = response_data
-                return invoke_result_data
-
-        except Exception as ex:
-            self.logger_error.error("【退款查询】" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "退款查询出现异常，请重试"
-            return invoke_result_data
-
-    def create_settle(self, pay_order_no="", settle_desc="", settle_params="", thirdparty_id=""):
-        """
-        :description:服务端结算请求
-        :param order_no:商户分配订单号，标识进行退款的订单，开发者服务端的唯一订单号
-        :param settle_desc:结算描述 默认 自己约定一个比如 “福小宠商品结算”
-        :param settle_params:其他分账方信息，分账分配参数 SettleParameter 数组序列化后生成的 json 格式字符串
-        :param thirdparty_id：服务商模式接入必传,第三方平台服务商 id，非服务商模式留空|默认传空字符串
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        try:
-            app_id = self.app_id
-            #out_order_no 开发者服务端的唯一订单号
-            out_settle_no = SevenHelper.create_order_id()
-            #回调地址
-            notify_url = self.notify_url
-            cp_extra = self.cp_extra
-            # 在这里将分账信息存入数据库
-            data = {}
-            data['out_settle_no'] = out_settle_no
-            #cp_extra 开发者自定义字段，回调原样回传
-            data['cp_extra'] = cp_extra
-            data['notify_url'] = notify_url
-            data['out_order_no'] = pay_order_no
-            data['settle_desc'] = settle_desc
-            if settle_params:
-                data['settle_params'] = settle_params
-            sign = self.get_sign(data)
-            data['sign'] = sign
-            data['app_id'] = app_id
-            if thirdparty_id:
-                data['thirdparty_id'] = thirdparty_id
-
-            url = "https://developer.toutiao.com/api/apps/ecpay/v1/settle"
-            headers = {"Content-type": "application/json"}
-            response = requests.post(url, headers=headers, data=json.dumps(data))
-            response_data = SevenHelper.json_loads(response.text)
-            if response_data['err_no'] == 0:
-                invoke_result_data.data = response_data
-                return invoke_result_data
-
-        except Exception as ex:
-            self.logger_error.error("【结算请求】" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "结算请求出现异常，请重试"
-            return invoke_result_data
-
-    def query_settle(self, out_settle_no="", thirdparty_id=""):
-        """
-        :desciption:结算查询
-        :param out_settle_no:开发者侧的分账号, 不可重复
-        :param thirdparty_id:服务商模式接入必传  第三方平台服务商 id，非服务商模式留空字符串
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        try:
-            app_id = self.app_id
-            data = {}
-            data['out_settle_no'] = out_settle_no
-            sign = self.get_sign(data)
-            data['sign'] = sign
-            data['app_id'] = app_id
-            if thirdparty_id:
-                data['thirdparty_id'] = thirdparty_id
-
-            url = "https://developer.toutiao.com/api/apps/ecpay/v1/query_settle"
-            headers = {"Content-type": "application/json"}
-            response = requests.post(url, headers=headers, data=json.dumps(data))
-            response_data = SevenHelper.json_loads(response.text)
-            if response_data['err_no'] == 0:
-                invoke_result_data.data = response_data
-                return invoke_result_data
-
-        except Exception as ex:
-            self.logger_error.error("【结算查询】" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "结算查询出现异常，请重试"
-            return invoke_result_data
-
-    def get_sign(self, params_map):
-        params_list = []
-        for k, v in params_map.items():
-            if k == "other_settle_params":
-                continue
-            value = str(v).strip()
-            if value.startswith("\"") and value.endswith("\"") and len(value) > 1:
-                value = value[1: len(value) - 1]
-            value = value.strip()
-            if value == "" or value == "null":
-                continue
-            if k not in ("app_id", "thirdparty_id", "sign"):
-                params_list.append(value)
-        params_list.append(self.salt)
-        params_list.sort()
-        original_str = str("&").join(params_list)
-        return hashlib.md5(original_str.encode("utf-8")).hexdigest()
-
-
-class TikTokReponse(object):
-    """
-    :description: 抖音支付响应类 根据支付/退款/分账等回调json内容，检测type字段判断是支付回调还是退款回调，type:payment 支付成功回调,refund退款成功回调,settle分账成功回调
-    """
-    logger_error = Logger.get_logger_by_name("log_error")
-
-    def __init__(self, data, token=""):
-        self.data = json.loads(data)  #data由json.loads(self.request.body)获得
-        pay_config = share_config.get_value("tiktok_pay")
-        self.token = token if token else pay_config["token"]
-
-    def get_data(self):
-        """
-        :description: 获取通知的数据
-        :return:
-        :last_editors: HuangJianYi
-        """
-        return self.data
-
-    def check_sign(self):
-        """
-        :description: 校验签名
-        :return:
-        :last_editors: HuangJianYi
-        """
-        #计算服务端sign
-        service_signature = self.get_callback_sign(self.data)
-        #验证成功,进行业务处理
-        log_msg = f'客户端签名:{self.data["msg_signature"]},服务端签名:{service_signature}'
-        # self.logger_error.error(log_msg)
-        if service_signature == self.data["msg_signature"]:
-            return True
-        else:
-            return False
-
-    def get_callback_sign(self, params):
-        """
-        :description: 获取头条回调sign
-        :param params: 参数字典
-        :return: sign
-        :last_editors: HuangJianYi
-        """
-        keys = ['type', 'msg_signature']
-        params_copy = {key: params[key] for key in params if key not in keys}
-        for key, v in params_copy.items():
-            value = str(v).strip()
-            if value.startswith("\"") and value.endswith("\"") and len(value) > 1:
-                value = value[1:len(value) - 1]
-            value = value.strip()
-            if value == "" or value == "null":
-                continue
-            if isinstance(value, int):
-                params_copy[key] = str(value)
-        params_copy['token'] = self.token
-        params_list = sorted(list(params_copy.items()), key=lambda x: x[1])
-        params_str = ''.join(f"{v}" for k, v in params_list)
-        sign = CryptoHelper().sha1_encrypt(params_str)
-        return sign
-
-    def convert_response_json(self, err_no=0, err_tips="success"):
-        """
-        :description: 获取通知的数据
-        :return:
-        :last_editors: HuangJianYi
-        """
-        return {"err_no": err_no, "err_tips": err_tips}
-
-
-class TikTokBizDataCrypt:
-    def __init__(self, app_id, session_key):
-        self.app_id = app_id
-        self.session_key = session_key
-
-    def decrypt(self, encryptedData, iv):
-        """
-        :description: 解密
-        :param encryptedData: encryptedData
-        :param iv: iv
-        :return str
-        :last_editors: HuangJianYi
-        """
-        # base64 decode
-        session_key = base64.b64decode(self.session_key)
-        encryptedData = base64.b64decode(encryptedData)
-        iv = base64.b64decode(iv)
-        decrypted = {}
-        cipher = AES.new(session_key, AES.MODE_CBC, iv)
-        result_data = str(self._unpad(cipher.decrypt(encryptedData)), "utf-8")
-        if result_data:
-            decrypted = SevenHelper.json_loads(result_data)
-        if decrypted:
-            if decrypted['watermark']['appid'] != self.app_id:
-                raise Exception('Invalid Buffer')
-
-        return decrypted
-
-    def _unpad(self, s):
-        return s[:-ord(s[len(s) - 1:])]
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-01-14 10:44:07
+@LastEditTime: 2023-02-10 09:59:17
+@LastEditors: HuangJianYi
+@Description: 
+"""
+import requests
+import json
+import hashlib
+from Crypto.Cipher import AES
+import base64
+from seven_cloudapp_frame.libs.common import *
+from seven_cloudapp_frame.libs.customize.seven_helper import *
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.seven_model import InvokeResultData
+
+
+class TikTokHelper:
+    """
+    :description: 抖音帮助类 1.临时登录凭证校验获取open_id、session_key  2.解析加密数据
+    """
+    logger_error = Logger.get_logger_by_name("log_error")
+
+    @classmethod
+    def code2_session(self, code="", anonymous_code="", app_id="", app_secret=""):
+        """
+        :description:获取open_id、session_key等信息
+        :param code: 登录票据,非匿名需要 code
+        :param anonymous_code: 非匿名下的 anonymous_code 用于数据同步，匿名需要 anonymous_code
+        :param app_id: app_id
+        :param app_secret: app_secret
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = app_id if app_id else share_config.get_value("app_id")
+        app_secret = app_secret if app_secret else share_config.get_value("app_secret")
+
+        invoke_result_data = InvokeResultData()
+        redis_key = f"{app_id}_tiktok_login_code:{code}"
+        redis_init = SevenHelper.redis_init()
+        code2_session_dict = redis_init.get(redis_key)
+        if code2_session_dict:
+            code2_session_dict = SevenHelper.json_loads(code2_session_dict)
+            invoke_result_data.data = code2_session_dict
+            return invoke_result_data
+        param = {
+            'code': code,  # 用户点击按钮跳转到抖音授权页, 抖音处理完后重定向到redirect_uri, 并给我们加上code=xxx的参数, 这个code就是我们需要的
+            'appid': app_id,
+            'secret': app_secret,
+            'anonymous_code': anonymous_code,
+        }
+        response = None
+        try:
+            requset_url = 'https://developer.toutiao.com/api/apps/v2/jscode2session'
+            headers = {"Content-type": "application/json"}
+            response = requests.post(requset_url, headers=headers, data=json.dumps(param))
+            response_data = SevenHelper.json_loads(response.text)
+            if response_data.__contains__("err_no") and response_data["err_no"] != 0:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = response_data["err_no"]
+                invoke_result_data.error_message = response_data["err_tips"]
+                return invoke_result_data
+            open_id = response_data["data"]['openid']
+            session_key = response_data["data"]['session_key']
+            redis_init.set(redis_key, SevenHelper.json_dumps(response_data["data"]), ex=60 * 60)
+            redis_init.set(f"{app_id}_tiktok_sessionkey:{str(open_id)}", session_key, ex=60 * 60)
+            invoke_result_data.data = response_data["data"]
+            return invoke_result_data
+        except Exception as ex:
+            self.logger_error.error("【code2_session】" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "exception"
+            invoke_result_data.error_message = traceback.format_exc()
+            return invoke_result_data
+
+    @classmethod
+    def get_access_token(self, grant_type="client_credential", app_id="", app_secret=""):
+        """
+        :description:access_token 是小程序的全局唯一调用凭据，开发者调用小程序支付时需要使用 access_token。access_token 的有效期为 2 个小时，需要定时刷新 access_token，重复获取会导致之前一次获取的 access_token 的有效期缩短为 5 分钟。
+        :param grant_type: 获取access_token 时值为 client_credential
+        :param app_id: app_id
+        :param app_secret: app_secret
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = app_id if app_id else share_config.get_value("app_id")
+        app_secret = app_secret if app_secret else share_config.get_value("app_secret")
+
+        invoke_result_data = InvokeResultData()
+        param = {
+            'appid': app_id,
+            'secret': app_secret,
+            'grant_type': grant_type,
+        }
+        response = None
+        redis_init = SevenHelper.redis_init(config_dict=share_config.get_value("platform_redis"))
+        redis_key = f"tiktok_access_token:{str(app_id)}"
+        try:
+            access_token = redis_init.get(redis_key)
+            if access_token:
+                invoke_result_data.data = access_token
+                return invoke_result_data
+            requset_url = 'https://developer.toutiao.com/api/apps/token'
+            headers = {"Content-type": "application/json"}
+            response = requests.post(requset_url, headers=headers, data=json.dumps(param))
+            response_data = SevenHelper.json_loads(response.text)
+            if response_data.__contains__("err_no") and response_data["err_no"] != 0:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = response_data["err_no"]
+                invoke_result_data.error_message = response_data["err_tips"]
+                return invoke_result_data
+            invoke_result_data.data = str(response_data["access_token"])
+            redis_init.set(redis_key, invoke_result_data.data, ex=3600)
+            return invoke_result_data
+        except Exception as ex:
+            self.logger_error.error("【get_access_token】" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "exception"
+            invoke_result_data.error_message = traceback.format_exc()
+            return invoke_result_data
+
+    @classmethod
+    def decrypt_data_by_code(self, open_id, code, encrypted_Data, iv, app_id="", app_secret=""):
+        """
+        :description:解析加密数据，客户端判断是否登录状态，如果登录只传open_id不传code，如果是登录过期,要传code重新获取session_key
+        :param open_id：open_id
+        :param code：登录票据
+        :param encrypted_Data：加密数据,抖音返回加密参数
+        :param iv：抖音返回参数
+        :param app_id: app_id
+        :param app_secret: app_secret
+        :return: 解密后的数据，用户信息或者手机号信息
+        :last_editors: HuangJianYi
+        """
+        app_id = app_id if app_id else share_config.get_value("app_id")
+        app_secret = app_secret if app_secret else share_config.get_value("app_secret")
+
+        data = {}
+        if code:
+            code2_session_dict = self.code2_session(code=code, app_id=app_id, app_secret=app_secret)
+            if code2_session_dict:
+                open_id = code2_session_dict["openid"]
+        try:
+            session_key = SevenHelper.redis_init().get(f"{app_id}_tiktok_sessionkey:{str(open_id)}")
+            data_crypt = TikTokBizDataCrypt(app_id, session_key)
+            data = data_crypt.decrypt(encrypted_Data, iv)  #data中是解密的信息
+        except Exception as ex:
+            self.logger_error.error("【decrypt_data_by_code】" + traceback.format_exc())
+        return data
+
+    @classmethod
+    def decrypt_data(self, session_key, encrypted_Data, iv, app_id=""):
+        """
+        :description:解析加密数据
+        :param session_key: session_key调用登录接口获得
+        :param encrypted_Data：加密数据,抖音返回加密参数
+        :param iv：抖音返回参数
+        :param app_id: 抖音小程序标识
+        :return: 解密后的数据，用户信息或者手机号信息
+        :last_editors: HuangJianYi
+        """
+        app_id = app_id if app_id else share_config.get_value("app_id")
+
+        data = {}
+        try:
+            data_crypt = TikTokBizDataCrypt(app_id, session_key)
+            #data中是解密的信息
+            data = data_crypt.decrypt(encrypted_Data, iv)
+        except Exception as ex:
+            self.logger_error.error("【decrypt_data】" + traceback.format_exc())
+        return data
+
+    @classmethod
+    def create_qr_code(self, access_token, appname="douyin", path="", width=430, line_color={ "r": 0, "g": 0, "b": 0 }, background={ "r": 255, "g": 255, "b": 255 }):
+        """
+        :description:获取小程序/小游戏的二维码。该二维码可通过任意 app 扫码打开，能跳转到开发者指定的对应字节系 app 内拉起小程序/小游戏， 并传入开发者指定的参数。通过该接口生成的二维码，永久有效，暂无数量限制。
+        :param access_token: 服务端 API 调用标识
+        :param appname: 打开二维码的字节系 app 名称
+        :param path: 小程序/小游戏启动参数，小程序则格式为 encode({path}?{query})，小游戏则格式为 JSON 字符串，默认为空
+        :param width: 二维码宽度，单位 px，最小 280px，最大 1280px，默认为 430px
+        :param line_color: 二维码线条颜色，默认为黑色
+        :param background: 二维码背景颜色，默认为白色
+        :return: 图片二进制 数据类型Array<byte>
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        param = {
+                "appname": appname,
+                "access_token": access_token,
+                "path": path,
+                "width": width,
+                "line_color": line_color,
+                "background": background
+                }
+        response = ""
+        try:
+            requset_url = 'https://developer.toutiao.com/api/apps/token'
+            headers = {"Content-type": "application/json"}
+            response = requests.post(requset_url, headers=headers, data=json.dumps(param))
+            response_data = SevenHelper.json_loads(response.text)
+            if response_data["errcode"] != 0:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = response_data["err_no"]
+                invoke_result_data.error_message = response_data["err_tips"]
+                return invoke_result_data
+            else:
+                invoke_result_data.data = response_data.content
+            return invoke_result_data
+        except Exception as ex:
+            self.logger_error.error("【create_qr_code】" + traceback.format_exc() + ":" + str(response.text))
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "exception"
+            invoke_result_data.error_message = traceback.format_exc()
+            return invoke_result_data
+
+
+class TikTokPayRequest(object):
+    """
+    :description: 抖音支付请求类,配置文件内容 "tiktok_pay": {"cp_extra": "","token": "","salt": ""}
+    """
+    # =======【基本信息设置】=====================================
+    # 抖音公众号身份的唯一标识。审核通过后，在抖音发送的邮件中查看
+    app_id = ""
+    #开发者自定义字段，回调原样回传
+    cp_extra = ""
+    #担保交易Token（令牌）
+    token = ""
+    #担保交易密钥
+    salt = ""
+    # 日志
+    logger_error = Logger.get_logger_by_name("log_error")
+
+    def __init__(self, app_id="", cp_extra="", token="", salt=""):
+        """
+        :description: 初始化
+        :last_editors: HuangJianYi
+        """
+        pay_config = share_config.get_value("tiktok_pay")
+        self.app_id = app_id if app_id else share_config.get_value("app_id")
+        self.cp_extra = cp_extra if cp_extra else pay_config["cp_extra"]
+        self.token = token if token else pay_config["token"]
+        self.salt = salt if salt else pay_config["salt"]
+
+    def create_order(self, pay_order_no, notify_url, total_amount=1, subject="", body="", valid_time=900, thirdparty_id="", disable_msg=None, msg_page=""):
+        """
+        :description: 服务端创建预下单
+        :param pay_order_no：商户订单号(支付单号)开发者服务端的唯一订单号
+        :param notify_url：支付结果异步通知地址
+        :param total_amount:支付价格;单位元
+        :param subject: 商品描述; 长度限制 128 字节，不超过 42 个汉字 |默认 自己约定一个比如 “福小宠商品”*|
+        :param body:商品详情|默认 自己约定一个比如 “福小宠商品”
+        :param valid_time:订单过期时间(秒); 最小 15 分钟，最大两天|默认 900
+        :param thirdparty_id:服务商模式接入必传,第三方平台服务商 id，非服务商模式留空|默认传空字符串
+        :param disable_msg:是否屏蔽担保支付的推送消息，1-屏蔽 0-非屏蔽，接入 POI 必传|默认传None
+        :param msg_page:担保支付消息跳转页|默认传空字符串
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        try:
+            data = {}
+            data['app_id'] = self.app_id
+            data['out_order_no'] = pay_order_no
+            data['total_amount'] = int(decimal.Decimal(str(total_amount)) * 100)
+            data['subject'] = subject
+            data['body'] = body
+            data['valid_time'] = valid_time
+            if notify_url:
+                data['notify_url'] = notify_url
+            if self.cp_extra:
+                data['cp_extra'] = self.cp_extra
+            if disable_msg:
+                data['disable_msg'] = int(disable_msg)
+            if msg_page:
+                data['msg_page'] = msg_page
+            if thirdparty_id:
+                data['thirdparty_id'] = thirdparty_id
+
+            sign = self.get_sign(data)
+            # 如果有第三方平台服务商id:thirdparty_id字段请把他放入data的字典里面
+            data['sign'] = sign
+
+            redis_key = f"{self.app_id}_tiktok_order_id:{str(pay_order_no)}"
+            orderInfo = SevenHelper.redis_init().get(redis_key)
+            if orderInfo:
+                invoke_result_data.data = SevenHelper.json_loads(orderInfo)
+                return invoke_result_data
+
+            url = "https://developer.toutiao.com/api/apps/ecpay/v1/create_order"
+            headers = {"Content-type": "application/json"}
+            response = requests.post(url, headers=headers, data=json.dumps(data))
+            response_data = SevenHelper.json_loads(response.text)
+            # err_no	number	    状态码 0-业务处理成功
+            # err_tips	string	    错误提示信息，常见错误处理可参考附录常见问题章节
+            # data	    orderInfo	拉起收银台的 orderInfo
+            # {"err_no": 2000, "err_tips": "单号记录不存在", "data": null}
+            if response_data['err_no'] == 0:
+                SevenHelper.redis_init().set(redis_key, SevenHelper.json_dumps(response_data['data']), ex=3600 * 1)
+                invoke_result_data.data = response_data['data']
+                return invoke_result_data
+            else:
+                self.logger_error.error(f"【{pay_order_no},创建预下单】" + response_data['err_tips'])
+                invoke_result_data.success = False
+                invoke_result_data.error_code="error"
+                invoke_result_data.error_message = response_data['err_tips']
+                return invoke_result_data
+        except Exception as ex:
+            self.logger_error.error("【创建预下单】" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code="error"
+            invoke_result_data.error_message = "创建预下单出现异常，请重试"
+            return invoke_result_data
+
+    def query_order(self, pay_order_no, thirdparty_id=""):
+        """
+        :description: 查询订单
+        :param pay_order_no：开发者侧的订单号, 不可重复
+        :param thirdparty_id: 服务商模式接入必传  第三方平台服务商 id，非服务商模式留空字符串|默认值 空字符串
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        try:
+            app_id = self.app_id
+            data = {}
+            data['out_order_no'] = pay_order_no
+            sign = self.get_sign(data)
+            data['sign'] = sign
+            data['app_id'] = app_id
+            if thirdparty_id:
+                data['thirdparty_id'] = thirdparty_id
+
+            url = "https://developer.toutiao.com/api/apps/ecpay/v1/query_order"
+            headers = {"Content-type": "application/json"}
+            response = requests.post(url, headers=headers, data=json.dumps(data))
+            response_data = SevenHelper.json_loads(response.text)
+            # {"err_no": 2000, "err_tips": "单号记录不存在", "out_order_no": "", "order_id": "", "payment_info": null}
+            # payment_info 返回值结构如下：
+            # {
+            #     "total_fee": 1200,
+            #     "order_status": "PROCESSING-处理中|SUCCESS-成功|FAIL-失败|TIMEOUT-超时",
+            #     "pay_time": "支付时间",
+            #     "way": 1,
+            #     "channel_no": "渠道单号",
+            #     "channel_gateway_no": "渠道网关号"
+            # }
+            if response_data['err_no'] == 0:
+                invoke_result_data.data = response_data
+                return invoke_result_data
+            else:
+                self.logger_error.error(f"【{pay_order_no},查询订单】" + response_data['err_tips'])
+                invoke_result_data.success = False
+                invoke_result_data.error_code="error"
+                invoke_result_data.error_message = response_data['err_tips']
+                return invoke_result_data
+
+        except Exception as ex:
+            self.logger_error.error("【查询订单】" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code="error"
+            invoke_result_data.error_message = "查询订单出现异常，请重试"
+            return invoke_result_data
+
+    def get_pay_status(self, pay_order_no, thirdparty_id=""):
+        """
+        :description: 查询订单状态
+        :param pay_order_no：开发者侧的订单号, 不可重复
+        :param thirdparty_id: 服务商模式接入必传  第三方平台服务商 id，非服务商模式留空字符串|默认值 空字符串
+        :return: PROCESSING-处理中|SUCCESS-成功|FAIL-失败|TIMEOUT-超时
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        invoke_result_data = self.query_order(pay_order_no, thirdparty_id)
+        if invoke_result_data.success == False:
+            return ""
+        else:
+            response_data = invoke_result_data.data
+            if response_data['payment_info']:
+                return response_data['payment_info']['order_status']
+            else:
+                return ""
+
+    def create_refund(self, refund_no, pay_order_no, notify_url, refund_amount=1, reason="", thirdparty_id="", disable_msg=None, msg_page="", all_settle=None):
+        """
+        :description: 服务端退款请求
+        :param refund_no:开发者侧的退款单号, 不可重复
+        :param pay_order_no:商户分配订单号，标识进行退款的订单，开发者服务端的唯一订单号
+        :param notify_url:退款通知地址
+        :param refund_amount: 退款金额；单位元
+        :param reason:退款理由，长度上限 100|默认 由开发者定 例如：“7天无理由退款”
+        :param thirdparty_id:服务商模式接入必传,第三方平台服务商 id，非服务商模式留空|默认传空字符串
+        :param disable_msg:是否屏蔽担保支付的推送消息，1-屏蔽 0-非屏蔽，接入 POI 必传|默认传None
+        :param msg_page:担保支付消息跳转页|默认传空字符串
+        :param all_settle:是否为分账后退款，1-分账后退款；0-分账前退款。分账后退款会扣减可提现金额，请保证余额充足*|默认传None
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        try:
+            data = {}
+            data['app_id'] = self.app_id
+            data['out_refund_no'] = refund_no
+            data['out_order_no'] = pay_order_no
+            data['refund_amount'] = int(decimal.Decimal(str(refund_amount)) * 100)
+            data['reason'] = reason
+            #cp_extra 开发者自定义字段，回调原样回传
+            if self.cp_extra:
+                data['cp_extra'] = self.cp_extra
+            if notify_url:
+                data['notify_url'] = notify_url
+            if disable_msg:
+                data['disable_msg'] = int(disable_msg)
+            if msg_page:
+                data['msg_page'] = msg_page
+            if all_settle:
+                data['all_settle'] = int(all_settle)
+            if thirdparty_id:
+                data['thirdparty_id'] = thirdparty_id
+
+            sign = self.get_sign(data)
+            # 如果有第三方平台服务商 id :thirdparty_id字段请把他放入data.update的字典里面
+            data['sign'] = sign
+
+            url = "https://developer.toutiao.com/api/apps/ecpay/v1/create_refund"
+            headers = {"Content-type": "application/json"}
+            response = requests.post(url, headers=headers, data=json.dumps(data))
+            response_data = SevenHelper.json_loads(response.text)
+            if response_data['err_no'] == 0:
+                invoke_result_data.data = response_data
+                return invoke_result_data
+        except Exception as ex:
+            self.logger_error.error("【创建退款单】" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "退款出现异常，请重试"
+            return invoke_result_data
+
+    def query_refund(self, refund_no="", thirdparty_id=""):
+        """
+        :desciption:退款查询
+        :param refund_no:开发者侧的退款单号, 不可重复
+        :param thirdparty_id:服务商模式接入必传  第三方平台服务商 id，非服务商模式留空字符串
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        try:
+            app_id = self.app_id
+            data = {}
+            data['out_refund_no'] = refund_no
+            sign = self.get_sign(data)
+            data['sign'] = sign
+            data['app_id'] = app_id
+            if thirdparty_id:
+                data['thirdparty_id'] = thirdparty_id
+
+            url = "https://developer.toutiao.com/api/apps/ecpay/v1/query_refund"
+            headers = {"Content-type": "application/json"}
+            response = requests.post(url, headers=headers, data=json.dumps(data))
+            response_data = SevenHelper.json_loads(response.text)
+            if response_data['err_no'] == 0:
+                invoke_result_data.data = response_data
+                return invoke_result_data
+
+        except Exception as ex:
+            self.logger_error.error("【退款查询】" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "退款查询出现异常，请重试"
+            return invoke_result_data
+
+    def create_settle(self, pay_order_no="", settle_desc="", settle_params="", thirdparty_id=""):
+        """
+        :description:服务端结算请求
+        :param order_no:商户分配订单号，标识进行退款的订单，开发者服务端的唯一订单号
+        :param settle_desc:结算描述 默认 自己约定一个比如 “福小宠商品结算”
+        :param settle_params:其他分账方信息，分账分配参数 SettleParameter 数组序列化后生成的 json 格式字符串
+        :param thirdparty_id：服务商模式接入必传,第三方平台服务商 id，非服务商模式留空|默认传空字符串
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        try:
+            app_id = self.app_id
+            #out_order_no 开发者服务端的唯一订单号
+            out_settle_no = SevenHelper.create_order_id()
+            #回调地址
+            notify_url = self.notify_url
+            cp_extra = self.cp_extra
+            # 在这里将分账信息存入数据库
+            data = {}
+            data['out_settle_no'] = out_settle_no
+            #cp_extra 开发者自定义字段，回调原样回传
+            data['cp_extra'] = cp_extra
+            data['notify_url'] = notify_url
+            data['out_order_no'] = pay_order_no
+            data['settle_desc'] = settle_desc
+            if settle_params:
+                data['settle_params'] = settle_params
+            sign = self.get_sign(data)
+            data['sign'] = sign
+            data['app_id'] = app_id
+            if thirdparty_id:
+                data['thirdparty_id'] = thirdparty_id
+
+            url = "https://developer.toutiao.com/api/apps/ecpay/v1/settle"
+            headers = {"Content-type": "application/json"}
+            response = requests.post(url, headers=headers, data=json.dumps(data))
+            response_data = SevenHelper.json_loads(response.text)
+            if response_data['err_no'] == 0:
+                invoke_result_data.data = response_data
+                return invoke_result_data
+
+        except Exception as ex:
+            self.logger_error.error("【结算请求】" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "结算请求出现异常，请重试"
+            return invoke_result_data
+
+    def query_settle(self, out_settle_no="", thirdparty_id=""):
+        """
+        :desciption:结算查询
+        :param out_settle_no:开发者侧的分账号, 不可重复
+        :param thirdparty_id:服务商模式接入必传  第三方平台服务商 id，非服务商模式留空字符串
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        try:
+            app_id = self.app_id
+            data = {}
+            data['out_settle_no'] = out_settle_no
+            sign = self.get_sign(data)
+            data['sign'] = sign
+            data['app_id'] = app_id
+            if thirdparty_id:
+                data['thirdparty_id'] = thirdparty_id
+
+            url = "https://developer.toutiao.com/api/apps/ecpay/v1/query_settle"
+            headers = {"Content-type": "application/json"}
+            response = requests.post(url, headers=headers, data=json.dumps(data))
+            response_data = SevenHelper.json_loads(response.text)
+            if response_data['err_no'] == 0:
+                invoke_result_data.data = response_data
+                return invoke_result_data
+
+        except Exception as ex:
+            self.logger_error.error("【结算查询】" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "结算查询出现异常，请重试"
+            return invoke_result_data
+
+    def get_sign(self, params_map):
+        params_list = []
+        for k, v in params_map.items():
+            if k == "other_settle_params":
+                continue
+            value = str(v).strip()
+            if value.startswith("\"") and value.endswith("\"") and len(value) > 1:
+                value = value[1: len(value) - 1]
+            value = value.strip()
+            if value == "" or value == "null":
+                continue
+            if k not in ("app_id", "thirdparty_id", "sign"):
+                params_list.append(value)
+        params_list.append(self.salt)
+        params_list.sort()
+        original_str = str("&").join(params_list)
+        return hashlib.md5(original_str.encode("utf-8")).hexdigest()
+
+
+class TikTokReponse(object):
+    """
+    :description: 抖音支付响应类 根据支付/退款/分账等回调json内容，检测type字段判断是支付回调还是退款回调，type:payment 支付成功回调,refund退款成功回调,settle分账成功回调
+    """
+    logger_error = Logger.get_logger_by_name("log_error")
+
+    def __init__(self, data, token=""):
+        self.data = json.loads(data)  #data由json.loads(self.request.body)获得
+        pay_config = share_config.get_value("tiktok_pay")
+        self.token = token if token else pay_config["token"]
+
+    def get_data(self):
+        """
+        :description: 获取通知的数据
+        :return:
+        :last_editors: HuangJianYi
+        """
+        return self.data
+
+    def check_sign(self):
+        """
+        :description: 校验签名
+        :return:
+        :last_editors: HuangJianYi
+        """
+        #计算服务端sign
+        service_signature = self.get_callback_sign(self.data)
+        #验证成功,进行业务处理
+        log_msg = f'客户端签名:{self.data["msg_signature"]},服务端签名:{service_signature}'
+        # self.logger_error.error(log_msg)
+        if service_signature == self.data["msg_signature"]:
+            return True
+        else:
+            return False
+
+    def get_callback_sign(self, params):
+        """
+        :description: 获取头条回调sign
+        :param params: 参数字典
+        :return: sign
+        :last_editors: HuangJianYi
+        """
+        keys = ['type', 'msg_signature']
+        params_copy = {key: params[key] for key in params if key not in keys}
+        for key, v in params_copy.items():
+            value = str(v).strip()
+            if value.startswith("\"") and value.endswith("\"") and len(value) > 1:
+                value = value[1:len(value) - 1]
+            value = value.strip()
+            if value == "" or value == "null":
+                continue
+            if isinstance(value, int):
+                params_copy[key] = str(value)
+        params_copy['token'] = self.token
+        params_list = sorted(list(params_copy.items()), key=lambda x: x[1])
+        params_str = ''.join(f"{v}" for k, v in params_list)
+        sign = CryptoHelper().sha1_encrypt(params_str)
+        return sign
+
+    def convert_response_json(self, err_no=0, err_tips="success"):
+        """
+        :description: 获取通知的数据
+        :return:
+        :last_editors: HuangJianYi
+        """
+        return {"err_no": err_no, "err_tips": err_tips}
+
+
+class TikTokBizDataCrypt:
+    def __init__(self, app_id, session_key):
+        self.app_id = app_id
+        self.session_key = session_key
+
+    def decrypt(self, encryptedData, iv):
+        """
+        :description: 解密
+        :param encryptedData: encryptedData
+        :param iv: iv
+        :return str
+        :last_editors: HuangJianYi
+        """
+        # base64 decode
+        session_key = base64.b64decode(self.session_key)
+        encryptedData = base64.b64decode(encryptedData)
+        iv = base64.b64decode(iv)
+        decrypted = {}
+        cipher = AES.new(session_key, AES.MODE_CBC, iv)
+        result_data = str(self._unpad(cipher.decrypt(encryptedData)), "utf-8")
+        if result_data:
+            decrypted = SevenHelper.json_loads(result_data)
+        if decrypted:
+            if decrypted['watermark']['appid'] != self.app_id:
+                raise Exception('Invalid Buffer')
+
+        return decrypted
+
+    def _unpad(self, s):
+        return s[:-ord(s[len(s) - 1:])]
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/libs/customize/time_helper.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/libs/customize/time_helper.py`

 * *Ordering differences only*

 * *Files 14% similar despite different names*

```diff
@@ -1,106 +1,106 @@
-# -*- coding: utf-8 -*-
-"""
-:Author: HuangJianYi
-:Date: 2021-07-15 11:54:54
-@LastEditTime: 2022-11-16 16:13:04
-@LastEditors: HuangJianYi
-:description: 时间帮助类
-"""
-from seven_framework import *
-import datetime
-
-
-
-class TimeExHelper:
-    """
-    :description: 时间帮助类
-    """
-
-    @classmethod
-    def get_now_int(self, hours=0, minutes=0, fmt='%Y%m%d%H%M%S'):
-        """
-        :description: 获取整形的时间 格式为yyyyMMddHHmmss，如2009年12月27日9点10分10秒表示为20091227091010
-        :param hours: 需要增加的小时数
-        :param hours: 需要增加的分钟数
-        :param fmt: 时间格式
-        :return:
-        :last_editors: HuangJianYi
-        """
-        now_date = (datetime.datetime.now() + datetime.timedelta(minutes=minutes, hours=hours))
-        return int(now_date.strftime(fmt))
-
-    @classmethod
-    def get_now_hour_int(self, hours=0):
-        """
-        :description: 获取整形的小时2020050612
-        :param hours: 需要增加的小时数
-        :return: int（2020050612）
-        :last_editors: HuangJianYi
-        """
-        return self.get_now_int(hours=hours, fmt='%Y%m%d%H')
-
-    @classmethod
-    def get_now_day_int(self, hours=0):
-        """
-        :description: 获取整形的天20200506
-        :param hours: 需要增加的小时数
-        :return: int（20200506）
-        :last_editors: HuangJianYi
-        """
-        return self.get_now_int(hours=hours, fmt='%Y%m%d')
-
-    @classmethod
-    def get_now_month_int(self, hours=0):
-        """
-        :description: 获取整形的月202005
-        :param hours: 需要增加的小时数
-        :return: int（202005）
-        :last_editors: HuangJianYi
-        """
-        return self.get_now_int(hours=hours,fmt='%Y%m')
-
-    @classmethod
-    def get_date_list(self, start_date, end_date):
-        """
-        :description: 两个日期之间的日期列表
-        :param start_date：开始日期
-        :param end_date：结束日期
-        :return: list
-        :last_editors: HuangJianYi
-        """
-        if not start_date or not end_date:
-            return []
-        if ":" not in start_date:
-            start_date+=" 00:00:00"
-        if ":" not in end_date:
-            end_date += " 00:00:00"
-        datestart = datetime.datetime.strptime(start_date, '%Y-%m-%d %H:%M:%S')
-        dateend = datetime.datetime.strptime(end_date, '%Y-%m-%d %H:%M:%S')
-
-        date_list = []
-
-        while datestart < dateend:
-            date_list.append(datestart.strftime('%Y-%m-%d'))
-            datestart += datetime.timedelta(days=1)
-        return date_list
-
-    @classmethod
-    def convert_custom_date(self, dt):
-        """
-        :description: 转换自定义文本时间
-        :param dt: datetime格式时间或时间字符串
-        :return: str
-        :last_editors: HuangJianYi
-        """
-        now_timestamp = TimeHelper.get_now_timestamp()
-        difference_seconds = TimeHelper.difference_seconds(now_timestamp, dt)
-        if difference_seconds <= 1:
-            return "刚刚"
-        elif difference_seconds < 60:
-            return  str(difference_seconds) + "秒前"
-        elif difference_seconds >= 60 and difference_seconds < 3600:
-            return str(int(difference_seconds / 60)) + "分钟前"
-        elif difference_seconds >= 3600 and difference_seconds < 24 * 3600:
-            return str(int(difference_seconds / 3600)) + "小时前"
-        else:
-            return str(int(difference_seconds / (24 * 3600))) + "天前"
+# -*- coding: utf-8 -*-
+"""
+:Author: HuangJianYi
+:Date: 2021-07-15 11:54:54
+@LastEditTime: 2022-11-16 16:13:04
+@LastEditors: HuangJianYi
+:description: 时间帮助类
+"""
+from seven_framework import *
+import datetime
+
+
+
+class TimeExHelper:
+    """
+    :description: 时间帮助类
+    """
+
+    @classmethod
+    def get_now_int(self, hours=0, minutes=0, fmt='%Y%m%d%H%M%S'):
+        """
+        :description: 获取整形的时间 格式为yyyyMMddHHmmss，如2009年12月27日9点10分10秒表示为20091227091010
+        :param hours: 需要增加的小时数
+        :param hours: 需要增加的分钟数
+        :param fmt: 时间格式
+        :return:
+        :last_editors: HuangJianYi
+        """
+        now_date = (datetime.datetime.now() + datetime.timedelta(minutes=minutes, hours=hours))
+        return int(now_date.strftime(fmt))
+
+    @classmethod
+    def get_now_hour_int(self, hours=0):
+        """
+        :description: 获取整形的小时2020050612
+        :param hours: 需要增加的小时数
+        :return: int（2020050612）
+        :last_editors: HuangJianYi
+        """
+        return self.get_now_int(hours=hours, fmt='%Y%m%d%H')
+
+    @classmethod
+    def get_now_day_int(self, hours=0):
+        """
+        :description: 获取整形的天20200506
+        :param hours: 需要增加的小时数
+        :return: int（20200506）
+        :last_editors: HuangJianYi
+        """
+        return self.get_now_int(hours=hours, fmt='%Y%m%d')
+
+    @classmethod
+    def get_now_month_int(self, hours=0):
+        """
+        :description: 获取整形的月202005
+        :param hours: 需要增加的小时数
+        :return: int（202005）
+        :last_editors: HuangJianYi
+        """
+        return self.get_now_int(hours=hours,fmt='%Y%m')
+
+    @classmethod
+    def get_date_list(self, start_date, end_date):
+        """
+        :description: 两个日期之间的日期列表
+        :param start_date：开始日期
+        :param end_date：结束日期
+        :return: list
+        :last_editors: HuangJianYi
+        """
+        if not start_date or not end_date:
+            return []
+        if ":" not in start_date:
+            start_date+=" 00:00:00"
+        if ":" not in end_date:
+            end_date += " 00:00:00"
+        datestart = datetime.datetime.strptime(start_date, '%Y-%m-%d %H:%M:%S')
+        dateend = datetime.datetime.strptime(end_date, '%Y-%m-%d %H:%M:%S')
+
+        date_list = []
+
+        while datestart < dateend:
+            date_list.append(datestart.strftime('%Y-%m-%d'))
+            datestart += datetime.timedelta(days=1)
+        return date_list
+
+    @classmethod
+    def convert_custom_date(self, dt):
+        """
+        :description: 转换自定义文本时间
+        :param dt: datetime格式时间或时间字符串
+        :return: str
+        :last_editors: HuangJianYi
+        """
+        now_timestamp = TimeHelper.get_now_timestamp()
+        difference_seconds = TimeHelper.difference_seconds(now_timestamp, dt)
+        if difference_seconds <= 1:
+            return "刚刚"
+        elif difference_seconds < 60:
+            return  str(difference_seconds) + "秒前"
+        elif difference_seconds >= 60 and difference_seconds < 3600:
+            return str(int(difference_seconds / 60)) + "分钟前"
+        elif difference_seconds >= 3600 and difference_seconds < 24 * 3600:
+            return str(int(difference_seconds / 3600)) + "小时前"
+        else:
+            return str(int(difference_seconds / (24 * 3600))) + "天前"
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/libs/customize/wechat_helper.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/libs/customize/wechat_helper.py`

 * *Ordering differences only*

 * *Files 11% similar despite different names*

```diff
@@ -1,1689 +1,1689 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-08-19 09:23:14
-@LastEditTime: 2023-06-15 10:05:05
-@LastEditors: HuangJianYi
-@Description: 
-"""
-from time import *
-from requests_pkcs12 import post
-import requests
-from Crypto.Cipher import AES
-import base64
-import xmltodict
-from xml.etree import ElementTree
-import xml.etree.ElementTree as ET
-from urllib.parse import quote
-import hashlib
-from Crypto.PublicKey import RSA
-from Crypto.Signature import PKCS1_v1_5
-from Crypto.Hash import SHA256
-import string
-from seven_cloudapp_frame.libs.common import *
-from seven_cloudapp_frame.libs.customize.seven_helper import *
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.seven_model import InvokeResultData
-
-
-class WeChatHelper:
-    """
-    :description: 微信帮助类 1.临时登录凭证校验获取open_id、session_key  2.解析加密数据
-    """
-    logger_error = Logger.get_logger_by_name("log_error")
-
-    @classmethod
-    def get_web_authorize_url(self, redirect_uri, scope="snsapi_userinfo", app_id="", state="1"):
-        """
-        :description:获取网页授权链接, 注意：公众号必须是服务号并认证才可以使用网页授权
-        :param redirect_uri：授权后重定向的回调地址
-        :param scope：应用授权作用域，snsapi_base （不弹出授权页面，直接跳转，只能获取用户openid），snsapi_userinfo （弹出授权页面，可通过openid拿到昵称、性别、所在地。并且，即使在未关注的情况下，只要用户授权，也能获取其信息）
-        :param app_id：公众号的唯一标识
-        :param state：重定向后会带上state参数，开发者可以填写a-zA-Z0-9的参数值，最多128字节
-        :return: 返回网页授权链接
-        :last_editors: HuangJianYi
-        """
-        app_id = app_id if app_id else share_config.get_value("app_id")
-        authorize_url = "https://open.weixin.qq.com/connect/oauth2/authorize?appid={0}&redirect_uri={1}&response_type=code&scope={2}&state={3}&connect_redirect=1#wechat_redirect".format(app_id, CodingHelper.url_encode(redirect_uri), scope, CodingHelper.url_encode(state))
-        return authorize_url
-
-    @classmethod
-    def get_web_authorize_userinfo(self, code, grant_type="authorization_code", app_id="", app_secret=""):
-        """
-        :description:获取网页授权用户信息
-        :param code：登录票据
-        :param grant_type：授权方式
-        :param app_id：公众号的唯一标识
-        :param app_secret：公众号的appsecret
-        :return: 返回用户信息{ "openid": "OPENID","nickname": NICKNAME,"sex": 1,"province":"PROVINCE","city":"CITY","country":"COUNTRY","headimgurl":"https://thirdwx.qlogo.cn/mmopen/g3MonUZtNHkdmzicIlibx6iaFqAc56vxLSUfpb6n5WKSYVY0ChQKkiaJSgQ1dZuTOgvLLrhJbERQQ4eMsv84eavHiaiceqxibJxCfHe/46","privilege":[ "PRIVILEGE1" "PRIVILEGE2"],"unionid": "o6_bmasdasdsad6_2sgVt7hMZOPfL"}
-        :last_editors: HuangJianYi
-        """
-        app_id = app_id if app_id else share_config.get_value("app_id")
-        app_secret = app_secret if app_secret else share_config.get_value("app_secret")
-        invoke_result_data = InvokeResultData()
-        param = {
-            'code': code,  # 用户点击按钮跳转到微信授权页, 微信处理完后重定向到redirect_uri, 并给我们加上code=xxx的参数, 这个code就是我们需要的
-            'appid': app_id,
-            'secret': app_secret,
-            'grant_type': grant_type,
-        }
-
-        # 通过code获取access_token
-        requset_url = 'https://api.weixin.qq.com/sns/oauth2/access_token'
-        response = None
-        try:
-            response = requests.get(requset_url, params=param)
-            response_data = SevenHelper.json_loads(response.text)
-            if response_data.__contains__("errcode") and response_data["errcode"] != 0:
-                invoke_result_data.success = False
-                invoke_result_data.error_code = response_data["errcode"]
-                invoke_result_data.error_message = response_data["errmsg"]
-                return invoke_result_data
-            open_id = response_data['openid']
-            access_token = response_data['access_token']
-            requset_url = "https://api.weixin.qq.com/sns/userinfo"
-            response = requests.get(requset_url, params={'access_token': access_token, 'openid': open_id, 'lang': "zh_CN"})
-            response_data = SevenHelper.json_loads(response.text)
-            if response_data.__contains__("errcode") and response_data["errcode"] != 0:
-                invoke_result_data.success = False
-                invoke_result_data.error_code = response_data["errcode"]
-                invoke_result_data.error_message = response_data["errmsg"]
-                return invoke_result_data
-            invoke_result_data.data = response_data
-            if invoke_result_data.data.__contains__("nickname"):
-                invoke_result_data.data["nickname"] = invoke_result_data.data["nickname"].encode('ISO-8859-1').decode('utf-8')
-            return invoke_result_data
-        except Exception as ex:
-            self.logger_error.error("【get_web_authorize_userinfo】" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "exception"
-            invoke_result_data.error_message = traceback.format_exc()
-            return invoke_result_data
-
-    @classmethod
-    def get_jsapi_ticket(self, app_id=""):
-        """
-        :description:获取jsapi_ticket,注意：需在公众号后台添加ip白名单，控制台去请求微信接口获取
-        :param app_id:app_id
-        :return: 返回ticket
-        :last_editors: HuangJianYi
-        """
-        app_id = app_id if app_id else share_config.get_value("app_id")
-
-        invoke_result_data = InvokeResultData()
-        try:
-            redis_init = SevenHelper.redis_init(config_dict=share_config.get_value("platform_redis"))
-            redis_key = f"wechat_jsapi_ticket:{str(app_id)}"
-            jsapi_ticket = redis_init.get(redis_key)
-            if not jsapi_ticket:
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "error"
-                invoke_result_data.error_message = "jsapi_ticket不存在"
-                return invoke_result_data
-            invoke_result_data.data = jsapi_ticket
-            return invoke_result_data
-        except Exception as ex:
-            self.logger_error.error("【get_jsapi_ticket】" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "exception"
-            invoke_result_data.error_message = traceback.format_exc()
-            return invoke_result_data
-
-    @classmethod
-    def set_jsapi_ticket(self, app_id="", app_secret="", is_del=False):
-        """
-        :description:获取jsapi_ticket
-        :param app_id:app_id
-        :param app_secret:app_secret
-        :param is_del:是否删除redis里的ticket
-        :return: 返回ticket
-        :last_editors: HuangJianYi
-        """
-        app_id = app_id if app_id else share_config.get_value("app_id")
-        app_secret = app_secret if app_secret else share_config.get_value("app_secret")
-
-        invoke_result_data = InvokeResultData()
-        for i in range(2):
-            if i == 0:
-                invoke_result_data = self.get_access_token(app_id, app_secret)
-            else:
-                invoke_result_data = self.get_access_token(app_id, app_secret, True)
-
-            if invoke_result_data.success == True:
-                break
-        if invoke_result_data.success == False:
-            return invoke_result_data
-        access_token = invoke_result_data.data
-        response = None
-        redis_init = SevenHelper.redis_init(config_dict=config.get_value("platform_redis"))
-        redis_key = f"wechat_jsapi_ticket:{str(app_id)}"
-        if is_del == True:
-            redis_init.delete(redis_key)
-        try:
-            requset_url = f"https://api.weixin.qq.com/cgi-bin/ticket/getticket?access_token={access_token}&type=jsapi"
-            response = requests.get(requset_url)
-            response_data = SevenHelper.json_loads(response.text)
-            if response_data.__contains__("errcode") and response_data["errcode"] != 0:
-                invoke_result_data.success = False
-                invoke_result_data.error_code = response_data["errcode"]
-                invoke_result_data.error_message = response_data["errmsg"]
-                return invoke_result_data
-            invoke_result_data.data = str(response_data["ticket"])
-            redis_init.set(redis_key, invoke_result_data.data, ex=3600)
-            return invoke_result_data
-        except Exception as ex:
-            self.logger_error.error("【set_jsapi_ticket】" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "exception"
-            invoke_result_data.error_message = traceback.format_exc()
-            return invoke_result_data
-
-    @classmethod
-    def get_share_sign_package(self, request_url, app_id=""):
-        """
-        :description:获取分享请求参数
-        :param request_url:请求地址 如果是服务端获取地址则使用 request_url = self.request.headers['Referer']
-        :param app_id:app_id
-        :return: 返回分享请求参数
-        :last_editors: HuangJianYi
-        """
-        app_id = app_id if app_id else share_config.get_value("app_id")
-
-        invoke_result_data = InvokeResultData()
-        request_url = request_url.split('#')[0]
-        timestamp = int(time.time())
-        invoke_result_data = self.get_jsapi_ticket(app_id)
-        if invoke_result_data.success == False:
-            return invoke_result_data
-        js_ticket = invoke_result_data.data
-        noncestr = self.get_nonce_str()
-        param = {'noncestr': noncestr, 'jsapi_ticket': js_ticket, 'timestamp': timestamp, 'url': request_url}
-        string_sign_temp = self.key_value_url(param, False)
-        sign = hashlib.sha1(string_sign_temp.encode("utf8")).hexdigest()
-        sign_package = {'appid': app_id, 'noncestr': noncestr, 'timestamp': timestamp, 'url': request_url, 'signature': sign}
-        invoke_result_data.data = sign_package
-        return invoke_result_data
-
-    @classmethod
-    def code2_session(self, code, grant_type="authorization_code", app_id="", app_secret=""):
-        """
-        :description:小程序临时登录凭证校验
-        :param code：登录票据
-        :param grant_type：授权方式
-        :param app_id：app_id
-        :param app_secret：app_secret
-        :return: 返回字典包含字段 session_key,openid
-        :last_editors: HuangJianYi
-        """
-        app_id = app_id if app_id else share_config.get_value("app_id")
-        app_secret = app_secret if app_secret else share_config.get_value("app_secret")
-        invoke_result_data = InvokeResultData()
-        redis_key = f"{app_id}_wechat_login_code:{str(code)}"
-        redis_init = SevenHelper.redis_init()
-        code2_session_dict = redis_init.get(redis_key)
-        if code2_session_dict:
-            code2_session_dict = SevenHelper.json_loads(code2_session_dict)
-            invoke_result_data.data = code2_session_dict
-            return invoke_result_data
-        param = {
-            'js_code': code,  # 用户点击按钮跳转到微信授权页, 微信处理完后重定向到redirect_uri, 并给我们加上code=xxx的参数, 这个code就是我们需要的
-            'appid': app_id,
-            'secret': app_secret,
-            'grant_type': grant_type,
-        }
-
-        # 通过code获取sessionkey
-        requset_url = 'https://api.weixin.qq.com/sns/jscode2session'
-        response = None
-        try:
-            response = requests.get(requset_url, params=param)
-            response_data = SevenHelper.json_loads(response.text)
-            if response_data.__contains__("errcode") and response_data["errcode"] != 0:
-                invoke_result_data.success = False
-                invoke_result_data.error_code = response_data["errcode"]
-                invoke_result_data.error_message = response_data["errmsg"]
-                return invoke_result_data
-            open_id = response_data['openid']
-            session_key = response_data['session_key']
-            redis_init.set(redis_key, SevenHelper.json_dumps(response_data), ex=60 * 60)
-            redis_init.set(f"{app_id}_wechat_sessionkey:{open_id}", session_key, ex=60 * 60)
-            invoke_result_data.data = response_data
-            return invoke_result_data
-        except Exception as ex:
-            self.logger_error.error("【code2_session】" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "exception"
-            invoke_result_data.error_message = traceback.format_exc()
-            return invoke_result_data
-
-    @classmethod
-    def get_access_token(self, app_id="", app_secret="", is_del=False, grant_type="client_credential", from_wechat_get = True):
-        """
-        :description:access_token 是微信的全局唯一调用凭据，开发者调用小程序支付时需要使用 access_token。access_token 的有效期为 2 个小时，需要定时刷新 access_token，重复获取会导致之前一次获取的 access_token 的有效期缩短为 5 分钟。建议开发者使用中控服务器统一获取和刷新 access_token，其他业务逻辑服务器所使用的 access_token 均来自于该中控服务器，不应该各自去刷新，否则容易造成冲突，导致 access_token 覆盖而影响业务；
-        :description:注意：如果是公众号开发，需在公众号后台添加ip白名单，控制台去请求微信接口获取，小程序不用
-        :param app_id:app_id
-        :param app_secret:app_secret
-        :param is_del:是否删除redis里的access_token
-        :param grant_type: 获取access_token 时值为 client_credential
-        :param from_wechat_get: 是否请求微信接口获取access_token并存到redis
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = app_id if app_id else share_config.get_value("app_id")
-        app_secret = app_secret if app_secret else share_config.get_value("app_secret")
-
-        invoke_result_data = InvokeResultData()
-
-        try:
-            redis_init = SevenHelper.redis_init(config_dict=share_config.get_value("platform_redis"))
-            redis_key = f"wechat_access_token:{str(app_id)}"
-            if is_del == True:
-                redis_init.delete(redis_key)
-            access_token = redis_init.get(redis_key)
-            if access_token:
-                invoke_result_data.data = access_token
-                return invoke_result_data
-            if from_wechat_get == True:
-                invoke_result_data = self.set_access_token(app_id, app_secret, is_del, grant_type)
-                if invoke_result_data.success == False:
-                    return invoke_result_data
-            return invoke_result_data
-        except Exception as ex:
-            self.logger_error.error("【get_access_token】" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "exception"
-            invoke_result_data.error_message = traceback.format_exc()
-            return invoke_result_data
-
-    @classmethod
-    def set_access_token(self, app_id="", app_secret="", is_del=False, grant_type="client_credential"):
-        """
-        :description:access_token 是微信的全局唯一调用凭据，开发者调用小程序支付时需要使用 access_token。access_token 的有效期为 2 个小时，需要定时刷新 access_token，重复获取会导致之前一次获取的 access_token 的有效期缩短为 5 分钟。建议开发者使用中控服务器统一获取和刷新 access_token，其他业务逻辑服务器所使用的 access_token 均来自于该中控服务器，不应该各自去刷新，否则容易造成冲突，导致 access_token 覆盖而影响业务；
-        :param app_id:app_id
-        :param app_secret:app_secret
-        :param is_del:是否删除redis里的access_token
-        :param grant_type: 获取access_token 时值为 client_credential
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = app_id if app_id else share_config.get_value("app_id")
-        app_secret = app_secret if app_secret else share_config.get_value("app_secret")
-
-        invoke_result_data = InvokeResultData()
-        param = {
-            'appid': app_id,
-            'secret': app_secret,
-            'grant_type': grant_type,
-        }
-        response = None
-        redis_init = SevenHelper.redis_init(config_dict=config.get_value("platform_redis"))
-        redis_key = f"wechat_access_token:{str(app_id)}"
-        if is_del == True:
-            redis_init.delete(redis_key)
-        try:
-            requset_url = 'https://api.weixin.qq.com/cgi-bin/token'
-            response = requests.get(requset_url, params=param)
-            response_data = SevenHelper.json_loads(response.text)
-            if response_data.__contains__("errcode") and response_data["errcode"] != 0:
-                invoke_result_data.success = False
-                invoke_result_data.error_code = response_data["errcode"]
-                invoke_result_data.error_message = response_data["errmsg"]
-                return invoke_result_data
-            invoke_result_data.data = str(response_data["access_token"])
-            redis_init.set(redis_key, invoke_result_data.data, ex=3600)
-            return invoke_result_data
-        except Exception as ex:
-            self.logger_error.error("【set_access_token】" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "exception"
-            invoke_result_data.error_message = traceback.format_exc()
-            return invoke_result_data
-
-    @classmethod
-    def send_template_message(self, open_id, template_id, page, request_data, miniprogram_state="formal", lang="zh_CN", app_id="", app_secret=""):
-        """
-        :description:发送订阅消息（https://developers.weixin.qq.com/miniprogram/dev/api-backend/open-api/subscribe-message/subscribeMessage.send.html）
-        :param open_id:接收者（用户）的 openid
-        :param template_id:所需下发的订阅模板id
-        :param page:点击模板卡片后的跳转页面，仅限本小程序内的页面。支持带参数,（示例index?foo=bar）。该字段不填则模板无跳转
-        :param request_data:模板内容，格式形如 { “date2”: { “value”: any }, “thing3”: { “value”: any } }
-        :param miniprogram_state:跳转小程序类型：developer为开发版；trial为体验版；formal为正式版；默认为正式版
-        :param lang:进入小程序查看”的语言类型，支持zh_CN(简体中文)、en_US(英文)、zh_HK(繁体中文)、zh_TW(繁体中文)，默认为zh_CN
-        :param app_id:app_id
-        :param app_secret:app_secret
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = app_id if app_id else share_config.get_value("app_id")
-        app_secret = app_secret if app_secret else share_config.get_value("app_secret")
-        invoke_result_data = InvokeResultData()
-        for i in range(2):
-            if i == 0:
-                invoke_result_data = self.get_access_token(app_id, app_secret)
-            else:
-                invoke_result_data = self.get_access_token(app_id, app_secret, True)
-
-            if invoke_result_data.success == True:
-                break
-        if invoke_result_data.success == False:
-            return invoke_result_data
-        access_token = invoke_result_data.data
-        try:
-            requset_url = 'https://api.weixin.qq.com/cgi-bin/message/subscribe/send?access_token=' + access_token
-            param = {"touser": open_id, "page": page, "lang": lang, "data": request_data, "template_id": template_id, "miniprogram_state": miniprogram_state}
-            response = requests.post(requset_url, data=json.dumps(param, ensure_ascii=False).encode('utf-8'), headers={'Content-Type': 'application/json'})
-            response_data = SevenHelper.json_loads(response.text)
-            if response_data.__contains__("errcode") and response_data["errcode"] != 0:
-                invoke_result_data.success = False
-                invoke_result_data.error_code = response_data["errcode"]
-                invoke_result_data.error_message = response_data["errmsg"]
-                return invoke_result_data
-        except Exception as ex:
-            self.logger_error.error("【发送订阅消息】" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "exception"
-            invoke_result_data.error_message = traceback.format_exc()
-            return invoke_result_data
-        return invoke_result_data
-
-    @classmethod
-    def get_user_phonenumber(self, code, app_id="", app_secret=""):
-        """
-        :description:code换取用户手机号。 每个code只能使用一次，code的有效期为5min
-        :param code: 手机号获取凭证
-        :param app_id:app_id
-        :param app_secret:app_secret
-        :return: InvokeResultData data里是个对象 {'phoneNumber': '15059331111', 'purePhoneNumber': '15059331111', 'countryCode': '86', 'watermark': {'timestamp': 1681202041, 'appid': 'wx7b10fe6577977c11'}}
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        if not code:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "param_error"
-            invoke_result_data.error_message = "code无效，请升级微信版本到8.0.16以上"
-            return invoke_result_data
-        for i in range(2):
-            if i == 0:
-                invoke_result_data = self.get_access_token(app_id, app_secret)
-            else:
-                invoke_result_data = self.get_access_token(app_id, app_secret, True)
-
-            if invoke_result_data.success == True:
-                break
-        if invoke_result_data.success == False:
-            return invoke_result_data
-        access_token = invoke_result_data.data
-        try:
-            requset_url = 'https://api.weixin.qq.com/wxa/business/getuserphonenumber?access_token=' + access_token
-            param = {'code': code}
-            response = requests.post(requset_url, data=json.dumps(param, ensure_ascii=False).encode('utf-8'), headers={'Content-Type': 'application/json'})
-            response_data = SevenHelper.json_loads(response.text)
-            if response_data.__contains__("errcode") and response_data["errcode"] != 0:
-                invoke_result_data.success = False
-                invoke_result_data.error_code = response_data["errcode"]
-                invoke_result_data.error_message = response_data["errmsg"]
-                return invoke_result_data
-            invoke_result_data.data = response_data["phone_info"]
-            return invoke_result_data
-        except Exception as ex:
-            self.logger_error.error("【授权手机号】" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "exception"
-            invoke_result_data.error_message = "授权手机号失败"
-            return invoke_result_data
-
-    @classmethod
-    def create_qr_code_unlimit(self, page, scene="a=1", width=430, env_version="release", app_id="", app_secret=""):
-        """
-        :description:获取小程序/小游戏的二维码（注意：接口只能生成已发布的小程序的二维码。开发版的带参二维码可以在开发者工具预览时生成）
-        :param page: 页面 page，例如 pages/index/index，根路径前不要填加 /，不能携带参数（参数请放在scene字段里），如果不填写这个字段，默认跳主页面
-        :param scene: 最大32个可见字符，只支持数字，大小写英文以及部分特殊字符：!#$&'()*+,/:;=?@-._~，其它字符请自行编码为合法字符（因不支持%，中文无法使用 urlencode 处理，请使用其他编码方式）
-        :param width: 二维码的宽度，单位 px，最小 280px，最大 1280px
-        :param env_version: 要打开的小程序版本。正式版为 "release"，体验版为 "trial"，开发版为 "develop"。默认是正式版。
-        :param app_id:app_id
-        :param app_secret:app_secret
-        :return: 图片二进制 数据类型Array<byte>
-        :last_editors: HuangJianYi
-        """
-        app_id = app_id if app_id else share_config.get_value("app_id")
-        app_secret = app_secret if app_secret else share_config.get_value("app_secret")
-
-        invoke_result_data = InvokeResultData()
-        redis_init = SevenHelper.redis_init(decode_responses=False)
-        redis_key = "create_qr_code_unlimit:" + CryptoHelper.md5_encrypt(f"{page}_{scene}")
-        redis_value = redis_init.get(redis_key)
-        if redis_value:
-            invoke_result_data.data = redis_value
-            return invoke_result_data
-
-        for i in range(2):
-            if i == 0:
-                invoke_result_data = self.get_access_token(app_id, app_secret)
-            else:
-                invoke_result_data = self.get_access_token(app_id, app_secret, True)
-
-            if invoke_result_data.success == True:
-                break
-        if invoke_result_data.success == False:
-            return invoke_result_data
-        access_token = invoke_result_data.data
-        response = ""
-        try:
-            headers = {"Content-type": "application/json"}
-            requset_url = 'https://api.weixin.qq.com/wxa/getwxacodeunlimit?access_token=' + access_token
-            param = {"page": page, "scene": scene, "width": width, "env_version": env_version}
-            try:
-                response = requests.post(requset_url, data=json.dumps(param, ensure_ascii=False).encode('utf-8'), headers=headers)
-                response_data = SevenHelper.json_loads(response.text)
-                if response_data.__contains__("errcode") and response_data["errcode"] != 0:
-                    invoke_result_data.success = False
-                    invoke_result_data.error_code = response_data["errcode"]
-                    invoke_result_data.error_message = response_data["errmsg"]
-                    return invoke_result_data
-            except:
-                pass
-            invoke_result_data.data = response.content
-            redis_init.set(redis_key, response.content, 30 * 24 * 3600)
-            return invoke_result_data
-        except Exception as ex:
-            self.logger_error.error("【create_qr_code_unlimit】" + traceback.format_exc() + ":" + str(response.text))
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "exception"
-            invoke_result_data.error_message = traceback.format_exc()
-            return invoke_result_data
-
-    @classmethod
-    def create_qr_code(self, path, width=430, app_id="", app_secret=""):
-        """
-        :description:获取小程序二维码，适用于需要的码数量较少的业务场景。通过该接口生成的小程序码，永久有效，有数量限制
-        :param path: 扫码进入的小程序页面路径，最大长度 128 字节，不能为空；对于小游戏，可以只传入 query 部分，来实现传参效果，如：传入 "?foo=bar"，即可在 wx.getLaunchOptionsSync 接口中的 query 参数获取到 {foo:"bar"}。
-        :param width: 二维码的宽度，单位 px，最小 280px，最大 1280px
-        :param app_id:app_id
-        :param app_secret:app_secret
-        :return: 图片二进制 数据类型Array<byte>
-        :last_editors: HuangJianYi
-        """
-        app_id = app_id if app_id else share_config.get_value("app_id")
-        app_secret = app_secret if app_secret else share_config.get_value("app_secret")
-
-        invoke_result_data = InvokeResultData()
-        redis_init = SevenHelper.redis_init(decode_responses=False)
-        redis_key = "wechat_qr_code:" + CryptoHelper.md5_encrypt(f"{path}")
-        redis_value = redis_init.get(redis_key)
-        if redis_value:
-            invoke_result_data.data = redis_value
-            return invoke_result_data
-
-        for i in range(2):
-            if i == 0:
-                invoke_result_data = self.get_access_token(app_id, app_secret)
-            else:
-                invoke_result_data = self.get_access_token(app_id, app_secret, True)
-
-            if invoke_result_data.success == True:
-                break
-        if invoke_result_data.success == False:
-            return invoke_result_data
-        access_token = invoke_result_data.data
-        response = ""
-        try:
-            headers = {"Content-type": "application/json"}
-            requset_url = 'https://api.weixin.qq.com/cgi-bin/wxaapp/createwxaqrcode?access_token=' + access_token
-            param = {"path": path, "width": width}
-            try:
-                response = requests.post(requset_url, data=json.dumps(param, ensure_ascii=False).encode('utf-8'), headers=headers)
-                response_data = SevenHelper.json_loads(response.text)
-                if response_data.__contains__("errcode") and response_data["errcode"] != 0:
-                    invoke_result_data.success = False
-                    invoke_result_data.error_code = response_data["errcode"]
-                    invoke_result_data.error_message = response_data["errmsg"]
-                    return invoke_result_data
-            except:
-                pass
-            invoke_result_data.data = response.content
-            redis_init.set(redis_key, response.content, 30 * 24 * 3600)
-            return invoke_result_data
-        except Exception as ex:
-            self.logger_error.error("【create_qr_code】" + traceback.format_exc() + ":" + str(response.text))
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "exception"
-            invoke_result_data.error_message = traceback.format_exc()
-            return invoke_result_data
-
-    @classmethod
-    def msg_sec_check(self, content, scene, open_id, nickname, app_id="", app_secret=""):
-        """
-        :description: 文本内容安全识别(https://developers.weixin.qq.com/miniprogram/dev/OpenApiDoc/sec-center/sec-check/msgSecCheck.html)
-        :param content：需检测的文本内容，文本字数的上限为2500字，需使用UTF-8编码
-        :param scene：场景枚举值（1 资料；2 评论；3 论坛；4 社交日志）
-        :param openid：用户的openid（用户需在近两小时访问过小程序）
-        :param nickname：用户昵称
-        :param app_id:app_id
-        :param app_secret:app_secret
-        :return:
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        app_id = app_id if app_id else share_config.get_value("app_id")
-        app_secret = app_secret if app_secret else share_config.get_value("app_secret")
-        invoke_result_data = InvokeResultData()
-        for i in range(2):
-            if i == 0:
-                invoke_result_data = self.get_access_token(app_id, app_secret)
-            else:
-                invoke_result_data = self.get_access_token(app_id, app_secret, True)
-
-            if invoke_result_data.success == True:
-                break
-        if invoke_result_data.success == False:
-            return invoke_result_data
-        access_token = invoke_result_data.data
-        response = ""
-        try:
-            requset_url = 'https://api.weixin.qq.com/wxa/msg_sec_check?access_token=' + access_token
-            headers = {"Content-type": "application/json"}
-            param = {"content": content, "scene": scene, "openid": open_id, "nickname": nickname, "version": 2}
-            response = requests.post(requset_url, data=json.dumps(param, ensure_ascii=False).encode('utf-8'), headers=headers)
-            response_data = SevenHelper.json_loads(response.text)
-            if response_data.__contains__("errcode") and response_data["errcode"] != 0:
-                invoke_result_data.success = False
-                invoke_result_data.error_code = response_data["errcode"]
-                invoke_result_data.error_message = response_data["errmsg"]
-                return invoke_result_data
-            invoke_result_data.data = response_data
-            return invoke_result_data
-        except Exception as ex:
-            self.logger_error.error("【msg_sec_check】" + traceback.format_exc() + ":" + str(response.text))
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "exception"
-            invoke_result_data.error_message = traceback.format_exc()
-            return invoke_result_data
-
-    @classmethod
-    def media_check_async(self, media_url, media_type, scene, open_id, app_id="", app_secret=""):
-        """
-        :description: 音视频内容安全识别(https://developers.weixin.qq.com/miniprogram/dev/OpenApiDoc/sec-center/sec-check/mediaCheckAsync.html)
-        :param media_url：要检测的图片或音频的url，支持图片格式包括jpg, jepg, png, bmp, gif（取首帧），支持的音频格式包括mp3, aac, ac3, wma, flac, vorbis, opus, wav
-        :param media_type：1:音频;2:图片
-        :param scene：场景枚举值（1 资料；2 评论；3 论坛；4 社交日志）
-        :param open_id：用户的openid（用户需在近两小时访问过小程序）
-        :param app_id:app_id
-        :param app_secret:app_secret
-        :return:
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        app_id = app_id if app_id else share_config.get_value("app_id")
-        app_secret = app_secret if app_secret else share_config.get_value("app_secret")
-        invoke_result_data = InvokeResultData()
-        for i in range(2):
-            if i == 0:
-                invoke_result_data = self.get_access_token(app_id, app_secret)
-            else:
-                invoke_result_data = self.get_access_token(app_id, app_secret, True)
-
-            if invoke_result_data.success == True:
-                break
-        if invoke_result_data.success == False:
-            return invoke_result_data
-        access_token = invoke_result_data.data
-        response = ""
-        try:
-            requset_url = 'https://api.weixin.qq.com/wxa/media_check_async?access_token=' + access_token
-            headers = {"Content-type": "application/json"}
-            param = {"media_url": media_url,"media_type": media_type, "scene": scene, "openid": open_id, "version": 2}
-            response = requests.post(requset_url, data=json.dumps(param, ensure_ascii=False).encode('utf-8'), headers=headers)
-            response_data = SevenHelper.json_loads(response.text)
-            if response_data.__contains__("errcode") and response_data["errcode"] != 0:
-                invoke_result_data.success = False
-                invoke_result_data.error_code = response_data["errcode"]
-                invoke_result_data.error_message = response_data["errmsg"]
-                return invoke_result_data
-            invoke_result_data.data = response_data
-            return invoke_result_data
-        except Exception as ex:
-            self.logger_error.error("【media_check_async】" + traceback.format_exc() + ":" + str(response.text))
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "exception"
-            invoke_result_data.error_message = traceback.format_exc()
-            return invoke_result_data
-
-    @classmethod
-    def decrypt_data_by_code(self, open_id, code, encrypted_Data, iv, app_id="", app_secret=""):
-        """
-        :description:解析加密数据，客户端判断是否登录状态，如果登录只传open_id不传code，如果是登录过期,要传code重新获取session_key
-        :param open_id：open_id
-        :param code：登录票据
-        :param encrypted_Data：加密数据,微信返回加密参数
-        :param iv：微信返回参数
-        :param app_id：app_id
-        :param app_secret：app_secret
-        :return: 解密后的数据，用户信息或者手机号信息
-        :last_editors: HuangJianYi
-        """
-        app_id = app_id if app_id else share_config.get_value("app_id")
-        app_secret = app_secret if app_secret else share_config.get_value("app_secret")
-
-        data = None
-        if code:
-            code2_session_dict = self.code2_session(code=code, app_id=app_id, app_secret=app_secret)
-            if code2_session_dict:
-                open_id = code2_session_dict["openid"]
-        try:
-            session_key = SevenHelper.redis_init().get(f"{app_id}_wechat_sessionkey:{open_id}")
-            wx_data_crypt = WeChatDataCrypt(app_id, session_key)
-            data = wx_data_crypt.decrypt(encrypted_Data, iv)  #data中是解密的信息
-        except Exception as ex:
-            self.logger_error.error("【decrypt_data_by_code】" + traceback.format_exc())
-        return data
-
-    @classmethod
-    def decrypt_data(self, session_key, encrypted_Data, iv, app_id=""):
-        """
-        :description:解析加密数据
-        :param session_key: session_key调用登录接口获得
-        :param encrypted_Data：加密数据,微信返回加密参数
-        :param iv：微信返回参数
-        :param app_id: 微信小程序标识
-        :return: 解密后的数据，用户信息或者手机号信息
-        :last_editors: HuangJianYi
-        """
-        app_id = app_id if app_id else share_config.get_value("app_id")
-
-        data = {}
-        try:
-            wx_data_crypt = WeChatDataCrypt(app_id, session_key)
-            data = wx_data_crypt.decrypt(encrypted_Data, iv)  #data中是解密的信息
-        except Exception as ex:
-            ("【decrypt_data】" + traceback.format_exc())
-        return data
-
-    @classmethod
-    def array_to_xml(self, array):
-        """
-        :description:array转xml
-        :return:
-        :last_editors: HuangJianYi
-        """
-        xml = ["<xml>"]
-        for k, v in array.items():
-            if v.isdigit():
-                xml.append("<{0}>{1}</{0}>".format(k, v))
-            else:
-                xml.append("<{0}><![CDATA[{1}]]></{0}>".format(k, v))
-        xml.append("</xml>")
-        return "".join(xml)
-
-    @classmethod
-    def xml_to_array(self, xml):
-        """
-        :description:将xml转为array
-        :return:
-        :last_editors: HuangJianYi
-        """
-        array_data = {}
-        root = ElementTree.fromstring(xml)
-        for child in root:
-            value = child.text
-            array_data[child.tag] = value
-        return array_data
-
-    @classmethod
-    def key_value_url(self, params, url_encode):
-        """
-        :description:   将键值对转为 key1=value1&key2=value2 对参数按照key=value的格式，并按照参数名ASCII字典序排序
-        :param params：参数字典
-        :param url_encode：是否url编码 True是False否
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        slist = sorted(params)
-        buff = []
-        for k in slist:
-            v = quote(params[k]) if url_encode else params[k]
-            buff.append("{0}={1}".format(k, v))
-
-        return "&".join(buff)
-
-    @classmethod
-    def get_nonce_str(self, length=32):
-        """
-        :description: 生成随机字符串
-        :param length：长度
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        import random
-        chars = "abcdefghijklmnopqrstuvwxyz0123456789"
-        strs = []
-        for x in range(length):
-            strs.append(chars[random.randrange(0, len(chars))])
-        return "".join(strs)
-
-    @classmethod
-    def get_sign(self, params, api_key):
-        """
-        :description:生成sign拼接API密钥
-        :param api_key: api密钥
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        string_a = WeChatHelper.key_value_url(params, False)
-        string_sign_temp = string_a + '&key=' + api_key  # APIKEY, API密钥，需要在商户后台设置
-        sign = (hashlib.md5(string_sign_temp.encode("utf-8")).hexdigest()).upper()
-        return sign
-
-    @classmethod
-    def signature_v3(self, private_key_path, sign_str):
-        """
-        :description:  生成V3签名值
-        :param private_key_path：私钥路径
-        :param sign_str：签名字符串
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        with open(private_key_path) as file:
-            private_key = file.read()
-        try:
-            rsa_key = RSA.import_key(private_key)
-            signer = PKCS1_v1_5.new(rsa_key)
-            digest = SHA256.new(sign_str.encode('utf-8'))
-            return base64.b64encode(signer.sign(digest)).decode('utf-8')
-        except Exception:
-            raise "WeixinPaySignIError"
-
-    @classmethod
-    def generate_scheme(self, app_id="", app_secret="", page="pages/index/index", query="", env_version="release", is_expire=True, expire_type=1, expire_interval=30, expire_time=0):
-        """
-        :description: 该接口用于获取小程序 scheme 码，适用于短信、邮件、外部网页、微信内等拉起小程序的业务场景。通过该接口，可以选择最长30天有效的小程序码，有数量限制，目前仅针对国内非个人主体的小程序开放
-        :param app_id:app_id
-        :param app_secret:app_secret
-        :param page: 页面 page，例如 pages/theme/theme，根路径前不要填加
-        :param query: 查询条件，例如 source_id=1&query1=q1
-        :param env_version: 默认值"release"。要打开的小程序版本。正式版为"release"，体验版为"trial"，开发版为"develop"，仅在微信外打开时生效。
-        :param is_expire: 到期失效的 scheme 码的失效时间，为 Unix 时间戳。生成的到期失效 scheme 码在该时间前有效。最长有效期为30天。is_expire 为 true 且 expire_type 为 0 时必填
-        :param expire_type: 默认值0，到期失效的 scheme 码失效类型，失效时间：0，失效间隔天数：1
-        :param expire_interval: 到期失效的 scheme 码的失效间隔天数。生成的到期失效 scheme 码在该间隔时间到达前有效。最长间隔天数为30天。is_expire 为 true 且 expire_type 为 1 时必填
-        :param expire_time: 到期失效的 scheme 码的失效时间，为 Unix 时间戳。生成的到期失效 scheme 码在该时间前有效。最长有效期为30天。is_expire 为 true 且 expire_type 为 0 时必填
-        :return: InvokeResultData
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-
-        if expire_type == 1 and expire_interval > 30:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "URL Scheme有效期最长30天"
-            return invoke_result_data
-        elif expire_type == 0 and TimeHelper.difference_days(expire_time, TimeHelper.get_now_timestamp()) > 30:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "URL Scheme有效期最长30天"
-            return invoke_result_data
-
-        redis_init = SevenHelper.redis_init(decode_responses=False)
-        redis_key = "generate_scheme:" + CryptoHelper.md5_encrypt(f"{page}_{query}_{env_version}_{is_expire}_{expire_type}_{expire_interval}_{expire_time}")
-        redis_value = redis_init.get(redis_key)
-        if redis_value:
-            invoke_result_data.data = redis_value.decode()
-            return invoke_result_data
-
-        for i in range(2):
-            if i == 0:
-                invoke_result_data = WeChatHelper.get_access_token(app_id, app_secret)
-            else:
-                invoke_result_data = WeChatHelper.get_access_token(app_id, app_secret, True)
-
-            if invoke_result_data.success == True:
-                break
-        if invoke_result_data.success == False:
-            return invoke_result_data
-
-        access_token = invoke_result_data.data
-        response = ""
-        response_data = {}
-        try:
-            headers = {"Content-type": "application/json"}
-            requset_url = 'https://api.weixin.qq.com/wxa/generatescheme?access_token=' + access_token
-            param = {"jump_wxa": {"path": page, "query": query, "env_version": env_version}, "is_expire": is_expire, "expire_type": expire_type, "expire_interval": expire_interval, "expire_time": expire_time}
-            try:
-                response = requests.post(requset_url, data=json.dumps(param, ensure_ascii=False).encode('utf-8'), headers=headers)
-                response_data = SevenHelper.json_loads(response.text)
-                if response_data.__contains__("errcode") and response_data["errcode"] != 0:
-                    invoke_result_data.success = False
-                    invoke_result_data.error_code = response_data["errcode"]
-                    invoke_result_data.error_message = response_data["errmsg"]
-                    return invoke_result_data
-            except:
-                pass
-            invoke_result_data.data = response_data['openlink']
-            if expire_type == 1 and expire_interval > 0:
-                redis_init.set(redis_key, invoke_result_data.data, expire_interval * 24 * 3600)
-            elif expire_type == 0 and expire_time > 0:
-                redis_init.set(redis_key, invoke_result_data.data, 300)
-                redis_init.expireat(redis_key, expire_time)
-            return invoke_result_data
-        except Exception as ex:
-            self.logger_error.error("【generate_scheme】" + traceback.format_exc() + ":" + str(response.text))
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "exception"
-            invoke_result_data.error_message = traceback.format_exc()
-            return invoke_result_data
-
-    @classmethod
-    def generate_urllink(self, app_id="", app_secret="", page="pages/index/index", query="", env_version="release", is_expire=True, expire_type=1, expire_interval=30, expire_time=0, cloud_base=None):
-        """
-        :description: 获取小程序 URL Link，适用于短信、邮件、网页、微信内等拉起小程序的业务场景。通过该接口，可以选择最长30天有效的小程序链接，有数量限制，目前仅针对国内非个人主体的小程序开放
-        :param app_id:app_id
-        :param app_secret:app_secret
-        :param page: 页面 page，例如 pages/theme/theme，根路径前不要填加
-        :param query: 查询条件，例如 source_id=1&query1=q1
-        :param env_version: 默认值"release"。要打开的小程序版本。正式版为"release"，体验版为"trial"，开发版为"develop"，仅在微信外打开时生效。
-        :param is_expire: 到期失效的 scheme 码的失效时间，为 Unix 时间戳。生成的到期失效 scheme 码在该时间前有效。最长有效期为30天。is_expire 为 true 且 expire_type 为 0 时必填
-        :param expire_type: 默认值0，到期失效的 scheme 码失效类型，失效时间：0，失效间隔天数：1
-        :param expire_interval: 到期失效的 scheme 码的失效间隔天数。生成的到期失效 scheme 码在该间隔时间到达前有效。最长间隔天数为30天。is_expire 为 true 且 expire_type 为 1 时必填
-        :param expire_time: 到期失效的 scheme 码的失效时间，为 Unix 时间戳。生成的到期失效 scheme 码在该时间前有效。最长有效期为30天。is_expire 为 true 且 expire_type 为 0 时必填
-        :param cloud_base: 云开发静态网站自定义 H5 配置参数，可配置中转的云开发 H5 页面。不填默认用官方 H5 页面 例如{"env": "云开发环境，如：xxx", "domain": "静态网站自定义域名，不填则使用默认域名，如：xxx.xxx", "path": "云开发静态网站 H5 页面路径，不可携带 query如：/jump-wxa.html", "query": "云开发静态网站 H5 页面 query 参数，最大 1024 个字符，只支持数字，大小写英文以及部分特殊字符：`!#$&'()*+,/:;=?@-._~%``如：a=1&b=2", "resource_appid": "第三方批量代云开发时必填，表示创建该 env 的 appid （小程序/第三方平台）"}
-        :return: InvokeResultData
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-
-        if expire_type == 1 and expire_interval > 30:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "URL Link有效期最长30天"
-            return invoke_result_data
-        elif expire_type == 0 and TimeHelper.difference_days(expire_time, TimeHelper.get_now_timestamp()) > 30:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "URL Link有效期最长30天"
-            return invoke_result_data
-
-        redis_init = SevenHelper.redis_init(decode_responses=False)
-        redis_key = "generate_urllink:" + CryptoHelper.md5_encrypt(f"{page}_{query}_{env_version}_{is_expire}_{expire_type}_{expire_interval}_{expire_time}_{cloud_base}")
-        redis_value = redis_init.get(redis_key)
-        if redis_value:
-            invoke_result_data.data = redis_value.decode()
-            return invoke_result_data
-
-        for i in range(2):
-            if i == 0:
-                invoke_result_data = WeChatHelper.get_access_token(app_id, app_secret)
-            else:
-                invoke_result_data = WeChatHelper.get_access_token(app_id, app_secret, True)
-
-            if invoke_result_data.success == True:
-                break
-        if invoke_result_data.success == False:
-            return invoke_result_data
-
-        access_token = invoke_result_data.data
-        response = ""
-        response_data = {}
-        try:
-            headers = {"Content-type": "application/json"}
-            requset_url = 'https://api.weixin.qq.com/wxa/generate_urllink?access_token=' + access_token
-            param = {"path": page, "query": query, "env_version": env_version, "is_expire": is_expire, "expire_type": expire_type, "expire_interval": expire_interval, "expire_time": expire_time, "cloud_base": cloud_base}
-            try:
-                response = requests.post(requset_url, data=json.dumps(param, ensure_ascii=False).encode('utf-8'), headers=headers)
-                response_data = SevenHelper.json_loads(response.text)
-                if response_data.__contains__("errcode") and response_data["errcode"] != 0:
-                    invoke_result_data.success = False
-                    invoke_result_data.error_code = response_data["errcode"]
-                    invoke_result_data.error_message = response_data["errmsg"]
-                    return invoke_result_data
-            except:
-                pass
-            invoke_result_data.data = response_data['url_link']
-            if expire_type == 1 and expire_interval > 0:
-                redis_init.set(redis_key, invoke_result_data.data, expire_interval * 24 * 3600)
-            elif expire_type == 0 and expire_time > 0:
-                redis_init.set(redis_key, invoke_result_data.data, 300)
-                redis_init.expireat(redis_key, expire_time)
-            return invoke_result_data
-        except Exception as ex:
-            self.logger_error.error("【generate_urllink】" + traceback.format_exc() + ":" + str(response.text))
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "exception"
-            invoke_result_data.error_message = traceback.format_exc()
-            return invoke_result_data
-
-    @classmethod
-    def generate_shortlink(self, app_id="", app_secret="", page="pages/index/index", query="", page_title="", is_permanent=False):
-        """
-        :description: 获取小程序 Short Link，适用于微信内拉起小程序的业务场景。目前只开放给电商类目(具体包含以下一级类目：电商平台、商家自营、跨境电商)。通过该接口，可以选择生成到期失效和永久有效的小程序短链
-        :param app_id:app_id
-        :param app_secret:app_secret
-        :param page: 页面 page，例如 pages/theme/theme，根路径前不要填加
-        :param query: 查询条件，例如 source_id=1&query1=q1
-        :param page_title: 页面标题，不能包含违法信息，超过20字符会用... 截断代替
-        :param is_permanent: 默认值false。生成的 Short Link 类型，短期有效：false，永久有效：true
-        :return: InvokeResultData
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-
-        redis_init = SevenHelper.redis_init(decode_responses=False)
-        redis_key = "generate_shortlink:" + CryptoHelper.md5_encrypt(f"{page}_{query}_{page_title}_{is_permanent}")
-        redis_value = redis_init.get(redis_key)
-        if redis_value:
-            invoke_result_data.data = redis_value.decode()
-            return invoke_result_data
-
-        for i in range(2):
-            if i == 0:
-                invoke_result_data = WeChatHelper.get_access_token(app_id, app_secret)
-            else:
-                invoke_result_data = WeChatHelper.get_access_token(app_id, app_secret, True)
-
-            if invoke_result_data.success == True:
-                break
-        if invoke_result_data.success == False:
-            return invoke_result_data
-
-        access_token = invoke_result_data.data
-        response = ""
-        response_data = {}
-        try:
-            headers = {"Content-type": "application/json"}
-            requset_url = 'https://api.weixin.qq.com/wxa/genwxashortlink?access_token=' + access_token
-            param = {"page_url": f"{page}?{query}", "page_title": page_title, "is_permanent": is_permanent}
-            try:
-                response = requests.post(requset_url, data=json.dumps(param, ensure_ascii=False).encode('utf-8'), headers=headers)
-                response_data = SevenHelper.json_loads(response.text)
-                if response_data.__contains__("errcode") and response_data["errcode"] != 0:
-                    invoke_result_data.success = False
-                    invoke_result_data.error_code = response_data["errcode"]
-                    invoke_result_data.error_message = response_data["errmsg"]
-                    return invoke_result_data
-            except:
-                pass
-            invoke_result_data.data = response_data['link']
-            if is_permanent == True:
-                redis_init.set(redis_key, invoke_result_data.data)
-            else:
-                redis_init.set(redis_key, invoke_result_data.data, 30 * 24 * 3600)
-            return invoke_result_data
-        except Exception as ex:
-            self.logger_error.error("【generate_shortlink】" + traceback.format_exc() + ":" + str(response.text))
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "exception"
-            invoke_result_data.error_message = traceback.format_exc()
-            return invoke_result_data
-
-
-class WeChatPayRequest(object):
-    """
-    :description: 微信支付请求类,配置文件内容 "wechat_pay": {"api_key": "","mch_id": "","certificate_url": "","private_key_url": ""}
-    """
-    """配置账号信息"""
-    # =======【基本信息设置】=====================================
-    # 微信公众号身份的唯一标识。审核通过后，在微信发送的邮件中查看
-    app_id = ""
-    # 受理商ID，身份标识
-    mch_id = ""
-    # API密钥，需要在商户后台设置
-    api_key = ""
-    # 证书地址,证书文件需要在商户后台下载
-    certificate_url = ""
-    # 商户私钥地址,文件需要在商户后台下载
-    private_key_url = ""
-
-    logger_error = Logger.get_logger_by_name("log_error")
-
-    def __init__(self, app_id="", api_key="", mch_id="", certificate_url="", private_key_url=""):
-        pay_config = share_config.get_value("wechat_pay")
-        self.app_id = app_id if app_id else share_config.get_value("app_id")
-        self.api_key = api_key if api_key else pay_config["api_key"]
-        self.mch_id = mch_id if mch_id else pay_config["mch_id"]
-        self.certificate_url = certificate_url if certificate_url else pay_config["certificate_url"]
-        self.private_key_url = private_key_url if private_key_url else pay_config.get("private_key_url", "")
-
-    def get_prepay_id(self, unified_order_url, params):
-        """
-        :description: 获取预支付单号prepay_id
-        :param unifiedorder_url：微信下单地址
-        :param params：请求参数字典
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        redis_key = f"{self.app_id}_wechat_prepay_id:" + str(params['out_trade_no'])
-        redis_init = SevenHelper.redis_init()
-        prepay_id = redis_init.get(redis_key)
-        if prepay_id:
-            invoke_result_data.data = prepay_id
-            return invoke_result_data
-        params['sign'] = WeChatHelper.get_sign(params, self.api_key)
-        respone = requests.post(unified_order_url, self.convert_request_xml(params), headers={'Content-Type': 'application/xml'})
-        response_data = xmltodict.parse(respone.text.encode('ISO-8859-1').decode('utf-8'))['xml']
-        if response_data['return_code'] == 'SUCCESS':
-            if response_data['result_code'] == 'SUCCESS':
-                prepay_id = str(response_data['prepay_id'])
-                redis_init.set(redis_key, prepay_id, ex=3600 * 1)
-                invoke_result_data.data = prepay_id
-                return invoke_result_data
-            else:
-                self.logger_error.error("【预支付单号】" + str(response_data))
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "error"
-                invoke_result_data.error_message = response_data['err_code_des']
-                return invoke_result_data
-        else:
-            self.logger_error.error("【预支付单号】" + str(response_data))
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = response_data['return_msg']
-            return invoke_result_data
-
-    def create_order(self, pay_order_no, body, total_fee, spbill_create_ip, notify_url, open_id="", time_expire="", trade_type="JSAPI"):
-        """
-        :description: 创建微信预订单
-        :param pay_order_no：商户订单号(支付单号)
-        :param body：订单描述
-        :param total_fee：支付金额；单位元
-        :param spbill_create_ip：客户端IP
-        :param notify_url：微信支付结果异步通知地址
-        :param open_id：微信open_id
-        :param time_expire：交易结束时间
-        :param trade_type：交易类型trade_type为JSAPI时，openid为必填参数！此参数为微信用户在商户对应appid下的唯一标识, 统一支付接口中，缺少必填参数openid！
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        spbill_create_ip = spbill_create_ip if SevenHelper.is_ip(spbill_create_ip) == True else "127.0.0.1"
-        params = {
-            'appid': self.app_id,  # appid
-            'mch_id': self.mch_id,  # 商户号
-            'nonce_str': WeChatHelper.get_nonce_str(),
-            'body': body,
-            'out_trade_no': str(pay_order_no),
-            'total_fee': str(int(decimal.Decimal(str(total_fee)) * 100)),
-            'spbill_create_ip': spbill_create_ip,
-            'trade_type': trade_type,
-            'notify_url': notify_url
-        }
-        if trade_type == "JSAPI":
-            if open_id == "":
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "error"
-                invoke_result_data.error_message = "缺少必填参数open_id"
-                return invoke_result_data
-            else:
-                params['openid'] = open_id
-        if time_expire != "":
-            params['time_expire'] = str(time_expire)
-
-        # 开发者调用支付统一下单API生成预交易单
-        unified_order_url = 'https://api.mch.weixin.qq.com/pay/unifiedorder'
-        invoke_result_data = self.get_prepay_id(unified_order_url, params)
-        if invoke_result_data.success == False:
-            return invoke_result_data
-        prepay_id = invoke_result_data.data
-        params['prepay_id'] = prepay_id
-        params['package'] = f"prepay_id={prepay_id}"
-        params['timestamp'] = str(int(time.time()))
-        sign_again_params = {'appId': params['appid'], 'nonceStr': params['nonce_str'], 'package': params['package'], 'signType': 'MD5', 'timeStamp': params['timestamp']}
-        sign_again_params['sign'] = WeChatHelper.get_sign(sign_again_params, self.api_key)
-        sign_again_params['paySign'] = sign_again_params['sign']
-        invoke_result_data.data = sign_again_params
-        return invoke_result_data  # 返回给app
-
-    def query_order(self, pay_order_no="", transaction_id=""):
-        """
-        :description: 查询订单
-        :param transaction_id：微信订单号
-        :param pay_order_no：商户订单号(支付单号)
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        if transaction_id == "" and pay_order_no == "":
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "缺少必填参数transaction_id或pay_order_no"
-            return invoke_result_data
-        request_xml = ""
-        try:
-            params = {
-                'appid': self.app_id,
-                'mch_id': self.mch_id,
-                'nonce_str': WeChatHelper.get_nonce_str(),
-            }
-            if transaction_id != "":
-                params['transaction_id'] = str(transaction_id)
-            if pay_order_no != "":
-                params['out_trade_no'] = str(pay_order_no)
-            params['sign'] = WeChatHelper.get_sign(params, self.api_key)
-            request_xml = self.convert_request_xml(params)
-            queryorder_url = 'https://api.mch.weixin.qq.com/pay/orderquery'
-            respone = requests.post(queryorder_url, request_xml, headers={'Content-Type': 'application/xml'})
-            response_data = xmltodict.parse(respone.text.encode('ISO-8859-1').decode('utf-8'))['xml']
-            invoke_result_data.data = response_data
-            return invoke_result_data
-        except Exception as ex:
-            self.logger_error.error("【查询订单】" + traceback.format_exc() + ":" + str(request_xml))
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "查询订单出现异常"
-            return invoke_result_data
-
-    def close_order(self, pay_order_no=""):
-        """
-        :description: 关闭订单
-        :param pay_order_no：商户订单号(支付单号)
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        if pay_order_no == "":
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "缺少必填参数pay_order_no"
-            return invoke_result_data
-        request_xml = ""
-        try:
-            params = {'appid': self.app_id, 'mch_id': self.mch_id, 'nonce_str': WeChatHelper.get_nonce_str(), 'out_trade_no': str(pay_order_no)}
-            params['sign'] = WeChatHelper.get_sign(params, self.api_key)
-            request_xml = self.convert_request_xml(params)
-            queryorder_url = 'https://api.mch.weixin.qq.com/pay/closeorder'
-            respone = requests.post(queryorder_url, request_xml, headers={'Content-Type': 'application/xml'})
-            response_data = xmltodict.parse(respone.text.encode('ISO-8859-1').decode('utf-8'))['xml']
-            invoke_result_data.data = response_data
-            return invoke_result_data
-        except Exception as ex:
-            self.logger_error.error("【关闭订单】" + traceback.format_exc() + ":" + str(request_xml))
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "关闭订单出现异常"
-            return invoke_result_data
-
-    def get_pay_status(self, pay_order_no, transaction_id=""):
-        """
-        :description: 查询订单状态
-        :param pay_order_no：商户订单号(支付单号)
-        :param transaction_id：微信订单号
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        invoke_result_data = self.query_order(pay_order_no, transaction_id)
-        if invoke_result_data.success == False:
-            return ""
-        else:
-            response_data = invoke_result_data.data
-            if response_data['return_code'] == 'SUCCESS':
-                if response_data['result_code'] == 'SUCCESS':
-                    return str(response_data['trade_state'] if response_data.__contains__("trade_state") else "")  # SUCCESS--支付成功REFUND--转入退款NOTPAY--未支付CLOSED--已关闭REVOKED--已撤销(刷卡支付)USERPAYING--用户支付中PAYERROR--支付失败(其他原因，如银行返回失败)ACCEPT--已接收，等待扣款
-                else:
-                    return ""
-            else:
-                return ""
-
-    def create_refund(self, refund_no, pay_order_no, notify_url, refund_fee, total_fee):
-        """
-        :description: 服务端退款请求
-        :param refund_no:开发者侧的退款单号, 不可重复
-        :param pay_order_no:商户分配订单号，标识进行退款的订单，开发者服务端的唯一订单号
-        :param notify_url:退款通知地址
-        :param refund_fee: 退款金额，单位[分]
-        :param total_fee：支付金额；单位元
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        params = {
-            'appid': self.app_id,  # appid
-            'mch_id': self.mch_id,  # 商户号
-            'nonce_str': WeChatHelper.get_nonce_str(),
-            'out_trade_no': str(pay_order_no),
-            'out_refund_no': str(refund_no),
-            'notify_url': notify_url,
-            'refund_fee': int(decimal.Decimal(str(refund_fee)) * 100),
-            'sign_type': 'MD5',
-            'total_fee': int(decimal.Decimal(str(total_fee)) * 100),
-        }
-        params['sign'] = WeChatHelper.get_sign(params, self.api_key)
-        refund_url = 'https://api.mch.weixin.qq.com/secapi/pay/refund'
-        respone = post(url=refund_url, data=self.convert_request_xml(params), headers={'Content-Type': 'application/xml'}, pkcs12_filename=self.certificate_url, pkcs12_password=self.mch_id)
-        response_data = xmltodict.parse(respone.text.encode('ISO-8859-1').decode('utf-8'))['xml']
-        if response_data['return_code'] == 'SUCCESS':
-            if response_data['result_code'] == 'SUCCESS':
-                invoke_result_data.data = response_data['refund_id']
-                return invoke_result_data
-            else:
-                self.logger_error.error("【创建退款单】" + str(response_data))
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "error"
-                invoke_result_data.error_message = response_data['err_code_des']
-                return invoke_result_data
-        else:
-            self.logger_error.error("【创建退款单】" + str(response_data))
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = response_data['return_msg']
-            return invoke_result_data
-
-    def query_refund(self, refund_no):
-        """
-        :description: 查询退款单
-        :param refund_no：商户退款单号
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        if refund_no == "":
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "缺少必填参数refund_no"
-            return invoke_result_data
-        request_xml = ""
-        try:
-            params = {'appid': self.app_id, 'mch_id': self.mch_id, 'nonce_str': WeChatHelper.get_nonce_str(), 'out_refund_no': str(refund_no), 'sign_type': 'MD5'}
-            params['sign'] = WeChatHelper.get_sign(params, self.api_key)
-            request_xml = self.convert_request_xml(params)
-            queryrefund_url = 'https://api.mch.weixin.qq.com/pay/refundquery'
-            respone = requests.post(queryrefund_url, request_xml, headers={'Content-Type': 'application/xml'})
-            response_data = xmltodict.parse(respone.text.encode('ISO-8859-1').decode('utf-8'))['xml']
-            invoke_result_data.data = response_data
-            return invoke_result_data
-        except Exception as ex:
-            self.logger_error.error("【查询退款单】" + traceback.format_exc() + ":" + str(request_xml))
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "查询退款单出现异常"
-            return invoke_result_data
-
-    def send_red_pack(self, mch_billno, send_name, re_openid, total_amount, total_num, wishing, client_ip, act_name, remark, scene_id=''):
-        """
-        :description: 发现金红包(https://pay.weixin.qq.com/wiki/doc/api/tools/cash_coupon.php?chapter=13_4&index=3)
-        :param mch_billno：商户订单号(每个订单号必须唯一组成：mch_id+yyyymmdd+10位一天内不能重复的数字)
-        :param send_name：商户名称(红包发送者名称)
-        :param re_openid：接受红包的用户openid
-        :param total_amount：付款金额，单位分
-        :param total_num：红包发放总人数
-        :param wishing：红包祝福语
-        :param client_ip：该IP可传用户端或者服务端的IP
-        :param act_name：活动名称
-        :param remark：备注信息
-        :param scene_id：发放红包使用场景，红包金额大于200或者小于1元时必传（PRODUCT_1:商品促销PRODUCT_2:抽奖PRODUCT_3:虚拟物品兑奖 PRODUCT_4:企业内部福利PRODUCT_5:渠道分润PRODUCT_6:保险回馈PRODUCT_7:彩票派奖PRODUCT_8:税务刮奖）
-        :return: 当返回错误码为“SYSTEMERROR”时，请不要更换商户订单号，一定要使用原商户订单号重试，否则可能造成重复发放红包等资金风险
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        client_ip = client_ip if SevenHelper.is_ip(client_ip) == True else "127.0.0.1"
-        request_xml = ""
-        try:
-            params = {'appid': self.app_id, 'mch_id': self.mch_id, 'nonce_str': WeChatHelper.get_nonce_str(), 'mch_billno': str(mch_billno), 'send_name': send_name, 're_openid': re_openid, 'total_amount': total_amount, 'total_num': total_num, 'wishing': wishing, 'client_ip': client_ip, 'act_name': act_name, 'remark': remark}
-            if scene_id:
-                params['scene_id'] = scene_id
-            params['sign'] = WeChatHelper.get_sign(params, self.api_key)
-            request_xml = self.convert_request_xml(params)
-            requset_url = 'https://api.mch.weixin.qq.com/mmpaymkttransfers/sendredpack'
-            # 重点是`cert=(certificate_url, private_key_url), verify=True`参数，查看源码后才知道是这样传ca证书
-            respone = requests.post(requset_url, data=request_xml, cert=(self.certificate_url, self.private_key_url), verify=True)
-            response_data = xmltodict.parse(respone.text.encode('ISO-8859-1').decode('utf-8'))['xml']
-            if response_data['return_code'] == 'SUCCESS':
-                if response_data['result_code'] == 'SUCCESS':
-                    invoke_result_data.data = {"send_listid": response_data['send_listid']}
-                    return invoke_result_data
-                else:
-                    self.logger_error.error("【发现金红包】" + str(response_data))
-                    invoke_result_data.success = False
-                    invoke_result_data.error_code = "error"
-                    invoke_result_data.error_message = response_data['err_code_des']
-                    return invoke_result_data
-            invoke_result_data.data = response_data
-            return invoke_result_data
-        except Exception as ex:
-            self.logger_error.error("【发现金红包】" + traceback.format_exc() + ":" + str(request_xml))
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "发现金红包出现异常"
-            return invoke_result_data
-
-    def convert_request_xml(self, params):
-        """
-        :description:拼接XML
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        xml = "<xml>"
-        for k, v in params.items():
-            # v = v.encode('utf8')
-            # k = k.encode('utf8')
-            xml += '<' + k + '>' + str(v) + '</' + k + '>'
-        xml += "</xml>"
-        return xml.encode("utf-8")
-
-
-class WeChatPayReponse(object):
-    """
-    :description: 微信支付响应类
-    """
-
-    logger_error = Logger.get_logger_by_name("log_error")
-
-    def __init__(self, reponse_xml, api_key=""):
-        self.data = WeChatHelper.xml_to_array(reponse_xml)
-        pay_config = share_config.get_value("wechat_pay")
-        self.api_key = api_key if api_key else pay_config["api_key"]
-
-    def check_sign(self):
-        """
-        :description: 校验签名
-        :return:
-        :last_editors: HuangJianYi
-        """
-        params = dict(self.data)  # make a copy to save sign
-        del params['sign']
-        sign = WeChatHelper.get_sign(params, self.api_key)  # 本地签名
-        if self.data['sign'] == sign:
-            return True
-        return False
-
-    def get_data(self):
-        """
-        :description: 获取微信的通知的数据
-        :return:
-        :last_editors: HuangJianYi
-        """
-        return self.data
-
-    def convert_response_xml(self, msg, ok=True):
-        """
-        :description: 返回xml格式数据
-        :return:
-        :last_editors: HuangJianYi
-        """
-        code = "SUCCESS" if ok else "FAIL"
-        return WeChatHelper.array_to_xml(dict(return_code=code, return_msg=msg))
-
-
-class WeChatRefundReponse(object):
-    """
-    :description: 微信退款响应类
-    """
-    logger_error = Logger.get_logger_by_name("log_error")
-
-    def __init__(self, reponse_xml, api_key=""):
-        self.data = WeChatHelper.xml_to_array(reponse_xml)
-        pay_config = share_config.get_value("wechat_pay")
-        self.api_key = api_key if api_key else pay_config["api_key"]
-
-    def get_data(self):
-        """
-        :description:获取微信的通知的数据
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        return self.data
-
-    def decode_req_info(self, req_info):
-        """
-        :description:解密退款通知加密参数req_info
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        detail_info = CryptoHelper.aes_decrypt(req_info, CryptoHelper.md5_encrypt(self.api_key))
-        dict_req_info = xmltodict.parse(detail_info)
-        return dict_req_info
-
-    def convert_response_xml(self, msg, ok=True):
-        code = "SUCCESS" if ok else "FAIL"
-        return WeChatHelper.array_to_xml(dict(return_code=code, return_msg=msg))
-
-
-class WeChatDataCrypt:
-    """
-    :description: 微信数据解密帮助类
-    """
-
-    def __init__(self, app_id, session_key):
-        self.app_id = app_id
-        self.session_key = session_key
-
-    def decrypt(self, encryptedData, iv):
-        # base64 decode
-        session_key = base64.b64decode(self.session_key)
-        encryptedData = base64.b64decode(encryptedData)
-        iv = base64.b64decode(iv)
-        decrypted = {}
-        cipher = AES.new(session_key, AES.MODE_CBC, iv)
-        result_data = str(self._unpad(cipher.decrypt(encryptedData)), "utf-8")
-        if result_data:
-            decrypted = SevenHelper.json_loads(result_data)
-        if decrypted:
-            if decrypted['watermark']['appid'] != self.app_id:
-                raise Exception('Invalid Buffer')
-        return decrypted
-
-    def _unpad(self, s):
-        return s[:-ord(s[len(s) - 1:])]
-
-
-class WeChatPayV3Request(object):
-    """
-    微信V3支付支付
-    """
-    # 微信公众号身份的唯一标识。审核通过后，在微信发送的邮件中查看
-    app_id = ""
-    # 商户ID，身份标识
-    mch_id = ""
-    # API密钥，需要在商户后台设置
-    api_key = ""
-    # 证书地址,证书文件需要在商户后台下载
-    certificate_url = ""
-    # 商户私钥地址apiclient_key.pem 地址,文件需要在商户后台下载
-    private_key_url = ""
-    # 商户API证书序列号
-    mch_serial_no = ""
-
-    logger_error = Logger.get_logger_by_name("log_error")
-
-    base_url = 'https://api.mch.weixin.qq.com'
-
-    def __init__(self, app_id="", api_key="", mch_id="", mch_serial_no="", certificate_url="", private_key_url=""):
-
-        pay_config = share_config.get_value("wechat_pay", {})
-        self.app_id = app_id if app_id else share_config.get_value("app_id")
-        self.mch_id = mch_id if mch_id else pay_config.get("mch_id", "")
-        self.api_key = api_key if api_key else pay_config.get("api_key", "")
-        self.mch_serial_no = mch_serial_no if mch_serial_no else pay_config.get("mch_serial_no", "")
-        self.certificate_url = certificate_url if certificate_url else pay_config.get("certificate_url", "")
-        self.private_key_url = private_key_url if private_key_url else pay_config.get("private_key_url", "")
-        self.timestamp = str(int(time.time()))
-        self.nonce_str = ''.join(random.sample(string.ascii_letters + string.digits, 16))
-
-    def _generate_request_sign(self, url_path, data, method='POST'):
-        """
-        :description:  生成请求签名
-        :param url_path：不包含域名的请求地址
-        :param data：请求参数（post请求才需要传,get传None）
-        :param method：请求方式
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        sign_list = [method, url_path, self.timestamp, self.nonce_str]
-        if data is not None:
-            sign_list.append(data)
-        else:
-            sign_list.append('')
-        sign_str = '\n'.join(sign_list) + '\n'
-        return WeChatHelper.signature_v3(private_key_path=self.private_key_url, sign_str=sign_str)
-
-    def _generate_pay_sign(self, app_id, package):
-        """
-        :description:  生成支付签名
-        :param app_id：商户绑定的应用标识
-        :param package：订单详情扩展字符串（示例值：prepay_id=wx201410272009395522657a690389285100）
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        sign_list = [app_id, self.timestamp, self.nonce_str, package]
-        sign_str = '\n'.join(sign_list) + '\n'
-        return WeChatHelper.signature_v3(private_key_path=self.cert_dir, sign_str=sign_str)
-
-    def _generate_auth_header(self, signature):
-        """
-        生成授权请求头
-        """
-        return f'WECHATPAY2-SHA256-RSA2048 mchid="{self.mch_id}",nonce_str="{self.nonce_str}",' \
-               f'signature="{signature}",timestamp="{self.timestamp}",serial_no="{self.mch_serial_no}"'
-
-    def transfer_one(self, open_id, out_batch_no, batch_name, batch_remark, total_amount):
-        """
-        :description:  单次商家转账
-        :param open_id：open_id是微信用户在公众号appid下的唯一用户标识（appid不同，则获取到的openid就不同），可用于永久标记一个用户
-        :param out_batch_no：商家批次单号（商户生成的唯一编号）
-        :param batch_name：批次名称
-        :param batch_remark：批次备注
-        :param total_amount：转账总金额(单位：分)
-        :return: 错误码返回SYSTEM_ERROR和NOT_ENOUGH和FREQUENCY_LIMITED 请勿更换商家转账批次单号，请使用相同参数再次调用API。否则可能造成资金损失
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        url_path = '/v3/transfer/batches'
-        url = self.base_url + url_path
-        transfer_detail_list = []
-        transfer_detail = {}
-        transfer_detail["out_detail_no"] = out_batch_no
-        transfer_detail["transfer_amount"] = total_amount
-        transfer_detail["transfer_remark"] = batch_remark
-        transfer_detail["openid"] = open_id
-        transfer_detail_list.append(transfer_detail)
-
-        data = {'appid': self.app_id, 'out_batch_no': out_batch_no, "batch_name": batch_name, "batch_remark": batch_remark, "total_amount": total_amount, 'total_num': 1, "transfer_detail_list": transfer_detail_list}
-
-        try:
-            data = json.dumps(data)
-            signature = self._generate_request_sign(url_path=url_path, data=data)
-            # print("Authorization signature:", self._generate_auth_header(signature))
-            headers = {'Authorization': self._generate_auth_header(signature), 'Content-Type': 'application/json'}
-            res = requests.post(url=url, data=data, headers=headers, timeout=10)
-            response_data = SevenHelper.json_loads(res.text)
-            if response_data.__contains__("code") and response_data["code"] != 0:
-                invoke_result_data.success = False
-                invoke_result_data.error_code = response_data["code"]
-                invoke_result_data.error_message = response_data["message"]
-                return invoke_result_data
-            invoke_result_data.data = response_data
-            return invoke_result_data
-        except Exception as ex:
-            self.logger_error.error("【v3_transfer_one】" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "exception"
-            invoke_result_data.error_message = traceback.format_exc()
-            return invoke_result_data
-
-    def transfer_list(self, out_batch_no, batch_name, batch_remark, total_amount, total_num, transfer_detail_list=[]):
-        """
-        :description:  批量商家转账
-        :param out_batch_no：商家批次单号（商户生成的唯一编号）
-        :param batch_name：批次名称
-        :param batch_remark：批次备注
-        :param total_amount：转账总金额
-        :param total_num：转账总笔数
-        :param transfer_detail_list：转账明细列表
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        url_path = '/v3/transfer/batches'
-        url = self.base_url + url_path
-        data = {'appid': self.app_id, 'out_batch_no': out_batch_no, "batch_name": batch_name, "batch_remark": batch_remark, "total_amount": total_amount, 'total_num': total_num, "transfer_detail_list": transfer_detail_list}
-
-        try:
-            data = json.dumps(data)
-            signature = self._generate_request_sign(url_path=url_path, data=data)
-            # print("Authorization signature:", self._generate_auth_header(signature))
-            headers = {'Authorization': self._generate_auth_header(signature), 'Content-Type': 'application/json'}
-            res = requests.post(url=url, data=data, headers=headers, timeout=10)
-            response_data = SevenHelper.json_loads(res.text)
-            if response_data.__contains__("code") and response_data["code"] != 0:
-                invoke_result_data.success = False
-                invoke_result_data.error_code = response_data["code"]
-                invoke_result_data.error_message = response_data["message"]
-                return invoke_result_data
-            invoke_result_data.data = response_data
-            return invoke_result_data
-        except Exception as ex:
-            self.logger_error.error("【v3_transfer_list】" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "exception"
-            invoke_result_data.error_message = traceback.format_exc()
-            return invoke_result_data
-
-    def query_batches(self, batch_id, need_query_detail=False, offset=0, limit=20, detail_status=None):
-        """
-        :description:  商家转账批次单号查询批次单
-        :param batch_id：微信批次单号
-        :param need_query_detail：是否查询转账明细单(枚举值：true：是；false：否，默认否。商户可选择是否查询指定状态的转账明细单，当转账批次单状态为“FINISHED”（已完成）时，才会返回满足条件的转账明细单)
-        :param offset：请求资源起始位置
-        :param limit：最大资源条数
-        :param detail_status：明细状态(查询指定状态的转账明细单，当need_query_detail为true时，该字段必填ALL:全部。需要同时查询转账成功和转账失败的明细单SUCCESS:转账成功。只查询转账成功的明细单FAIL:转账失败。只查询转账失败的明细单)
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        url_path = f'/v3/transfer/batches/batch-id/{batch_id}'
-        data = {'need_query_detail': need_query_detail, 'offset': offset, 'limit': limit}
-        if need_query_detail == True:
-            detail_status = "ALL"
-        if detail_status:
-            data["detail_status"] = detail_status
-        url_path = url_path + "?" + WeChatHelper.key_value_url(data, False)
-        url = self.base_url + url_path
-        data = None
-        try:
-            signature = self._generate_request_sign(url_path=url_path, data=data, method='GET')
-            # print("Authorization signature:", self._generate_auth_header(signature))
-            headers = {'Authorization': self._generate_auth_header(signature), 'Content-Type': 'application/json'}
-            res = requests.get(url=url, data=data, headers=headers, timeout=10)
-            response_data = SevenHelper.json_loads(res.text)
-            if response_data.__contains__("code") and response_data["code"] != 0:
-                invoke_result_data.success = False
-                invoke_result_data.error_code = response_data["code"]
-                invoke_result_data.error_message = response_data["message"]
-                return invoke_result_data
-            invoke_result_data.data = response_data
-            return invoke_result_data
-        except Exception as ex:
-            self.logger_error.error("【v3_query_batches】" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "exception"
-            invoke_result_data.error_message = traceback.format_exc()
-            return invoke_result_data
-
-    def query_batches_detail(self, batch_id, detail_id):
-        """
-        :description:  微信明细单号查询明细单
-        :param batch_id：微信批次单号
-        :param detail_id：微信明细单号
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        url_path = f'/v3/transfer/batches/batch-id/{batch_id}/details/detail-id/{detail_id}'
-        url = self.base_url + url_path
-        data = None
-        try:
-            signature = self._generate_request_sign(url_path=url_path, data=data, method='GET')
-            # print("Authorization signature:", self._generate_auth_header(signature))
-            headers = {'Authorization': self._generate_auth_header(signature), 'Content-Type': 'application/json'}
-            res = requests.get(url=url, data=data, headers=headers, timeout=10)
-            response_data = SevenHelper.json_loads(res.text)
-            if response_data.__contains__("code") and response_data["code"] != 0:
-                invoke_result_data.success = False
-                invoke_result_data.error_code = response_data["code"]
-                invoke_result_data.error_message = response_data["message"]
-                return invoke_result_data
-            invoke_result_data.data = response_data
-            return invoke_result_data
-        except Exception as ex:
-            self.logger_error.error("【v3_query_batches_detail】" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "exception"
-            invoke_result_data.error_message = traceback.format_exc()
-            return invoke_result_data
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-08-19 09:23:14
+@LastEditTime: 2023-06-15 10:05:05
+@LastEditors: HuangJianYi
+@Description: 
+"""
+from time import *
+from requests_pkcs12 import post
+import requests
+from Crypto.Cipher import AES
+import base64
+import xmltodict
+from xml.etree import ElementTree
+import xml.etree.ElementTree as ET
+from urllib.parse import quote
+import hashlib
+from Crypto.PublicKey import RSA
+from Crypto.Signature import PKCS1_v1_5
+from Crypto.Hash import SHA256
+import string
+from seven_cloudapp_frame.libs.common import *
+from seven_cloudapp_frame.libs.customize.seven_helper import *
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.seven_model import InvokeResultData
+
+
+class WeChatHelper:
+    """
+    :description: 微信帮助类 1.临时登录凭证校验获取open_id、session_key  2.解析加密数据
+    """
+    logger_error = Logger.get_logger_by_name("log_error")
+
+    @classmethod
+    def get_web_authorize_url(self, redirect_uri, scope="snsapi_userinfo", app_id="", state="1"):
+        """
+        :description:获取网页授权链接, 注意：公众号必须是服务号并认证才可以使用网页授权
+        :param redirect_uri：授权后重定向的回调地址
+        :param scope：应用授权作用域，snsapi_base （不弹出授权页面，直接跳转，只能获取用户openid），snsapi_userinfo （弹出授权页面，可通过openid拿到昵称、性别、所在地。并且，即使在未关注的情况下，只要用户授权，也能获取其信息）
+        :param app_id：公众号的唯一标识
+        :param state：重定向后会带上state参数，开发者可以填写a-zA-Z0-9的参数值，最多128字节
+        :return: 返回网页授权链接
+        :last_editors: HuangJianYi
+        """
+        app_id = app_id if app_id else share_config.get_value("app_id")
+        authorize_url = "https://open.weixin.qq.com/connect/oauth2/authorize?appid={0}&redirect_uri={1}&response_type=code&scope={2}&state={3}&connect_redirect=1#wechat_redirect".format(app_id, CodingHelper.url_encode(redirect_uri), scope, CodingHelper.url_encode(state))
+        return authorize_url
+
+    @classmethod
+    def get_web_authorize_userinfo(self, code, grant_type="authorization_code", app_id="", app_secret=""):
+        """
+        :description:获取网页授权用户信息
+        :param code：登录票据
+        :param grant_type：授权方式
+        :param app_id：公众号的唯一标识
+        :param app_secret：公众号的appsecret
+        :return: 返回用户信息{ "openid": "OPENID","nickname": NICKNAME,"sex": 1,"province":"PROVINCE","city":"CITY","country":"COUNTRY","headimgurl":"https://thirdwx.qlogo.cn/mmopen/g3MonUZtNHkdmzicIlibx6iaFqAc56vxLSUfpb6n5WKSYVY0ChQKkiaJSgQ1dZuTOgvLLrhJbERQQ4eMsv84eavHiaiceqxibJxCfHe/46","privilege":[ "PRIVILEGE1" "PRIVILEGE2"],"unionid": "o6_bmasdasdsad6_2sgVt7hMZOPfL"}
+        :last_editors: HuangJianYi
+        """
+        app_id = app_id if app_id else share_config.get_value("app_id")
+        app_secret = app_secret if app_secret else share_config.get_value("app_secret")
+        invoke_result_data = InvokeResultData()
+        param = {
+            'code': code,  # 用户点击按钮跳转到微信授权页, 微信处理完后重定向到redirect_uri, 并给我们加上code=xxx的参数, 这个code就是我们需要的
+            'appid': app_id,
+            'secret': app_secret,
+            'grant_type': grant_type,
+        }
+
+        # 通过code获取access_token
+        requset_url = 'https://api.weixin.qq.com/sns/oauth2/access_token'
+        response = None
+        try:
+            response = requests.get(requset_url, params=param)
+            response_data = SevenHelper.json_loads(response.text)
+            if response_data.__contains__("errcode") and response_data["errcode"] != 0:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = response_data["errcode"]
+                invoke_result_data.error_message = response_data["errmsg"]
+                return invoke_result_data
+            open_id = response_data['openid']
+            access_token = response_data['access_token']
+            requset_url = "https://api.weixin.qq.com/sns/userinfo"
+            response = requests.get(requset_url, params={'access_token': access_token, 'openid': open_id, 'lang': "zh_CN"})
+            response_data = SevenHelper.json_loads(response.text)
+            if response_data.__contains__("errcode") and response_data["errcode"] != 0:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = response_data["errcode"]
+                invoke_result_data.error_message = response_data["errmsg"]
+                return invoke_result_data
+            invoke_result_data.data = response_data
+            if invoke_result_data.data.__contains__("nickname"):
+                invoke_result_data.data["nickname"] = invoke_result_data.data["nickname"].encode('ISO-8859-1').decode('utf-8')
+            return invoke_result_data
+        except Exception as ex:
+            self.logger_error.error("【get_web_authorize_userinfo】" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "exception"
+            invoke_result_data.error_message = traceback.format_exc()
+            return invoke_result_data
+
+    @classmethod
+    def get_jsapi_ticket(self, app_id=""):
+        """
+        :description:获取jsapi_ticket,注意：需在公众号后台添加ip白名单，控制台去请求微信接口获取
+        :param app_id:app_id
+        :return: 返回ticket
+        :last_editors: HuangJianYi
+        """
+        app_id = app_id if app_id else share_config.get_value("app_id")
+
+        invoke_result_data = InvokeResultData()
+        try:
+            redis_init = SevenHelper.redis_init(config_dict=share_config.get_value("platform_redis"))
+            redis_key = f"wechat_jsapi_ticket:{str(app_id)}"
+            jsapi_ticket = redis_init.get(redis_key)
+            if not jsapi_ticket:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "error"
+                invoke_result_data.error_message = "jsapi_ticket不存在"
+                return invoke_result_data
+            invoke_result_data.data = jsapi_ticket
+            return invoke_result_data
+        except Exception as ex:
+            self.logger_error.error("【get_jsapi_ticket】" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "exception"
+            invoke_result_data.error_message = traceback.format_exc()
+            return invoke_result_data
+
+    @classmethod
+    def set_jsapi_ticket(self, app_id="", app_secret="", is_del=False):
+        """
+        :description:获取jsapi_ticket
+        :param app_id:app_id
+        :param app_secret:app_secret
+        :param is_del:是否删除redis里的ticket
+        :return: 返回ticket
+        :last_editors: HuangJianYi
+        """
+        app_id = app_id if app_id else share_config.get_value("app_id")
+        app_secret = app_secret if app_secret else share_config.get_value("app_secret")
+
+        invoke_result_data = InvokeResultData()
+        for i in range(2):
+            if i == 0:
+                invoke_result_data = self.get_access_token(app_id, app_secret)
+            else:
+                invoke_result_data = self.get_access_token(app_id, app_secret, True)
+
+            if invoke_result_data.success == True:
+                break
+        if invoke_result_data.success == False:
+            return invoke_result_data
+        access_token = invoke_result_data.data
+        response = None
+        redis_init = SevenHelper.redis_init(config_dict=config.get_value("platform_redis"))
+        redis_key = f"wechat_jsapi_ticket:{str(app_id)}"
+        if is_del == True:
+            redis_init.delete(redis_key)
+        try:
+            requset_url = f"https://api.weixin.qq.com/cgi-bin/ticket/getticket?access_token={access_token}&type=jsapi"
+            response = requests.get(requset_url)
+            response_data = SevenHelper.json_loads(response.text)
+            if response_data.__contains__("errcode") and response_data["errcode"] != 0:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = response_data["errcode"]
+                invoke_result_data.error_message = response_data["errmsg"]
+                return invoke_result_data
+            invoke_result_data.data = str(response_data["ticket"])
+            redis_init.set(redis_key, invoke_result_data.data, ex=3600)
+            return invoke_result_data
+        except Exception as ex:
+            self.logger_error.error("【set_jsapi_ticket】" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "exception"
+            invoke_result_data.error_message = traceback.format_exc()
+            return invoke_result_data
+
+    @classmethod
+    def get_share_sign_package(self, request_url, app_id=""):
+        """
+        :description:获取分享请求参数
+        :param request_url:请求地址 如果是服务端获取地址则使用 request_url = self.request.headers['Referer']
+        :param app_id:app_id
+        :return: 返回分享请求参数
+        :last_editors: HuangJianYi
+        """
+        app_id = app_id if app_id else share_config.get_value("app_id")
+
+        invoke_result_data = InvokeResultData()
+        request_url = request_url.split('#')[0]
+        timestamp = int(time.time())
+        invoke_result_data = self.get_jsapi_ticket(app_id)
+        if invoke_result_data.success == False:
+            return invoke_result_data
+        js_ticket = invoke_result_data.data
+        noncestr = self.get_nonce_str()
+        param = {'noncestr': noncestr, 'jsapi_ticket': js_ticket, 'timestamp': timestamp, 'url': request_url}
+        string_sign_temp = self.key_value_url(param, False)
+        sign = hashlib.sha1(string_sign_temp.encode("utf8")).hexdigest()
+        sign_package = {'appid': app_id, 'noncestr': noncestr, 'timestamp': timestamp, 'url': request_url, 'signature': sign}
+        invoke_result_data.data = sign_package
+        return invoke_result_data
+
+    @classmethod
+    def code2_session(self, code, grant_type="authorization_code", app_id="", app_secret=""):
+        """
+        :description:小程序临时登录凭证校验
+        :param code：登录票据
+        :param grant_type：授权方式
+        :param app_id：app_id
+        :param app_secret：app_secret
+        :return: 返回字典包含字段 session_key,openid
+        :last_editors: HuangJianYi
+        """
+        app_id = app_id if app_id else share_config.get_value("app_id")
+        app_secret = app_secret if app_secret else share_config.get_value("app_secret")
+        invoke_result_data = InvokeResultData()
+        redis_key = f"{app_id}_wechat_login_code:{str(code)}"
+        redis_init = SevenHelper.redis_init()
+        code2_session_dict = redis_init.get(redis_key)
+        if code2_session_dict:
+            code2_session_dict = SevenHelper.json_loads(code2_session_dict)
+            invoke_result_data.data = code2_session_dict
+            return invoke_result_data
+        param = {
+            'js_code': code,  # 用户点击按钮跳转到微信授权页, 微信处理完后重定向到redirect_uri, 并给我们加上code=xxx的参数, 这个code就是我们需要的
+            'appid': app_id,
+            'secret': app_secret,
+            'grant_type': grant_type,
+        }
+
+        # 通过code获取sessionkey
+        requset_url = 'https://api.weixin.qq.com/sns/jscode2session'
+        response = None
+        try:
+            response = requests.get(requset_url, params=param)
+            response_data = SevenHelper.json_loads(response.text)
+            if response_data.__contains__("errcode") and response_data["errcode"] != 0:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = response_data["errcode"]
+                invoke_result_data.error_message = response_data["errmsg"]
+                return invoke_result_data
+            open_id = response_data['openid']
+            session_key = response_data['session_key']
+            redis_init.set(redis_key, SevenHelper.json_dumps(response_data), ex=60 * 60)
+            redis_init.set(f"{app_id}_wechat_sessionkey:{open_id}", session_key, ex=60 * 60)
+            invoke_result_data.data = response_data
+            return invoke_result_data
+        except Exception as ex:
+            self.logger_error.error("【code2_session】" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "exception"
+            invoke_result_data.error_message = traceback.format_exc()
+            return invoke_result_data
+
+    @classmethod
+    def get_access_token(self, app_id="", app_secret="", is_del=False, grant_type="client_credential", from_wechat_get = True):
+        """
+        :description:access_token 是微信的全局唯一调用凭据，开发者调用小程序支付时需要使用 access_token。access_token 的有效期为 2 个小时，需要定时刷新 access_token，重复获取会导致之前一次获取的 access_token 的有效期缩短为 5 分钟。建议开发者使用中控服务器统一获取和刷新 access_token，其他业务逻辑服务器所使用的 access_token 均来自于该中控服务器，不应该各自去刷新，否则容易造成冲突，导致 access_token 覆盖而影响业务；
+        :description:注意：如果是公众号开发，需在公众号后台添加ip白名单，控制台去请求微信接口获取，小程序不用
+        :param app_id:app_id
+        :param app_secret:app_secret
+        :param is_del:是否删除redis里的access_token
+        :param grant_type: 获取access_token 时值为 client_credential
+        :param from_wechat_get: 是否请求微信接口获取access_token并存到redis
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = app_id if app_id else share_config.get_value("app_id")
+        app_secret = app_secret if app_secret else share_config.get_value("app_secret")
+
+        invoke_result_data = InvokeResultData()
+
+        try:
+            redis_init = SevenHelper.redis_init(config_dict=share_config.get_value("platform_redis"))
+            redis_key = f"wechat_access_token:{str(app_id)}"
+            if is_del == True:
+                redis_init.delete(redis_key)
+            access_token = redis_init.get(redis_key)
+            if access_token:
+                invoke_result_data.data = access_token
+                return invoke_result_data
+            if from_wechat_get == True:
+                invoke_result_data = self.set_access_token(app_id, app_secret, is_del, grant_type)
+                if invoke_result_data.success == False:
+                    return invoke_result_data
+            return invoke_result_data
+        except Exception as ex:
+            self.logger_error.error("【get_access_token】" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "exception"
+            invoke_result_data.error_message = traceback.format_exc()
+            return invoke_result_data
+
+    @classmethod
+    def set_access_token(self, app_id="", app_secret="", is_del=False, grant_type="client_credential"):
+        """
+        :description:access_token 是微信的全局唯一调用凭据，开发者调用小程序支付时需要使用 access_token。access_token 的有效期为 2 个小时，需要定时刷新 access_token，重复获取会导致之前一次获取的 access_token 的有效期缩短为 5 分钟。建议开发者使用中控服务器统一获取和刷新 access_token，其他业务逻辑服务器所使用的 access_token 均来自于该中控服务器，不应该各自去刷新，否则容易造成冲突，导致 access_token 覆盖而影响业务；
+        :param app_id:app_id
+        :param app_secret:app_secret
+        :param is_del:是否删除redis里的access_token
+        :param grant_type: 获取access_token 时值为 client_credential
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = app_id if app_id else share_config.get_value("app_id")
+        app_secret = app_secret if app_secret else share_config.get_value("app_secret")
+
+        invoke_result_data = InvokeResultData()
+        param = {
+            'appid': app_id,
+            'secret': app_secret,
+            'grant_type': grant_type,
+        }
+        response = None
+        redis_init = SevenHelper.redis_init(config_dict=config.get_value("platform_redis"))
+        redis_key = f"wechat_access_token:{str(app_id)}"
+        if is_del == True:
+            redis_init.delete(redis_key)
+        try:
+            requset_url = 'https://api.weixin.qq.com/cgi-bin/token'
+            response = requests.get(requset_url, params=param)
+            response_data = SevenHelper.json_loads(response.text)
+            if response_data.__contains__("errcode") and response_data["errcode"] != 0:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = response_data["errcode"]
+                invoke_result_data.error_message = response_data["errmsg"]
+                return invoke_result_data
+            invoke_result_data.data = str(response_data["access_token"])
+            redis_init.set(redis_key, invoke_result_data.data, ex=3600)
+            return invoke_result_data
+        except Exception as ex:
+            self.logger_error.error("【set_access_token】" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "exception"
+            invoke_result_data.error_message = traceback.format_exc()
+            return invoke_result_data
+
+    @classmethod
+    def send_template_message(self, open_id, template_id, page, request_data, miniprogram_state="formal", lang="zh_CN", app_id="", app_secret=""):
+        """
+        :description:发送订阅消息（https://developers.weixin.qq.com/miniprogram/dev/api-backend/open-api/subscribe-message/subscribeMessage.send.html）
+        :param open_id:接收者（用户）的 openid
+        :param template_id:所需下发的订阅模板id
+        :param page:点击模板卡片后的跳转页面，仅限本小程序内的页面。支持带参数,（示例index?foo=bar）。该字段不填则模板无跳转
+        :param request_data:模板内容，格式形如 { “date2”: { “value”: any }, “thing3”: { “value”: any } }
+        :param miniprogram_state:跳转小程序类型：developer为开发版；trial为体验版；formal为正式版；默认为正式版
+        :param lang:进入小程序查看”的语言类型，支持zh_CN(简体中文)、en_US(英文)、zh_HK(繁体中文)、zh_TW(繁体中文)，默认为zh_CN
+        :param app_id:app_id
+        :param app_secret:app_secret
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = app_id if app_id else share_config.get_value("app_id")
+        app_secret = app_secret if app_secret else share_config.get_value("app_secret")
+        invoke_result_data = InvokeResultData()
+        for i in range(2):
+            if i == 0:
+                invoke_result_data = self.get_access_token(app_id, app_secret)
+            else:
+                invoke_result_data = self.get_access_token(app_id, app_secret, True)
+
+            if invoke_result_data.success == True:
+                break
+        if invoke_result_data.success == False:
+            return invoke_result_data
+        access_token = invoke_result_data.data
+        try:
+            requset_url = 'https://api.weixin.qq.com/cgi-bin/message/subscribe/send?access_token=' + access_token
+            param = {"touser": open_id, "page": page, "lang": lang, "data": request_data, "template_id": template_id, "miniprogram_state": miniprogram_state}
+            response = requests.post(requset_url, data=json.dumps(param, ensure_ascii=False).encode('utf-8'), headers={'Content-Type': 'application/json'})
+            response_data = SevenHelper.json_loads(response.text)
+            if response_data.__contains__("errcode") and response_data["errcode"] != 0:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = response_data["errcode"]
+                invoke_result_data.error_message = response_data["errmsg"]
+                return invoke_result_data
+        except Exception as ex:
+            self.logger_error.error("【发送订阅消息】" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "exception"
+            invoke_result_data.error_message = traceback.format_exc()
+            return invoke_result_data
+        return invoke_result_data
+
+    @classmethod
+    def get_user_phonenumber(self, code, app_id="", app_secret=""):
+        """
+        :description:code换取用户手机号。 每个code只能使用一次，code的有效期为5min
+        :param code: 手机号获取凭证
+        :param app_id:app_id
+        :param app_secret:app_secret
+        :return: InvokeResultData data里是个对象 {'phoneNumber': '15059331111', 'purePhoneNumber': '15059331111', 'countryCode': '86', 'watermark': {'timestamp': 1681202041, 'appid': 'wx7b10fe6577977c11'}}
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        if not code:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "param_error"
+            invoke_result_data.error_message = "code无效，请升级微信版本到8.0.16以上"
+            return invoke_result_data
+        for i in range(2):
+            if i == 0:
+                invoke_result_data = self.get_access_token(app_id, app_secret)
+            else:
+                invoke_result_data = self.get_access_token(app_id, app_secret, True)
+
+            if invoke_result_data.success == True:
+                break
+        if invoke_result_data.success == False:
+            return invoke_result_data
+        access_token = invoke_result_data.data
+        try:
+            requset_url = 'https://api.weixin.qq.com/wxa/business/getuserphonenumber?access_token=' + access_token
+            param = {'code': code}
+            response = requests.post(requset_url, data=json.dumps(param, ensure_ascii=False).encode('utf-8'), headers={'Content-Type': 'application/json'})
+            response_data = SevenHelper.json_loads(response.text)
+            if response_data.__contains__("errcode") and response_data["errcode"] != 0:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = response_data["errcode"]
+                invoke_result_data.error_message = response_data["errmsg"]
+                return invoke_result_data
+            invoke_result_data.data = response_data["phone_info"]
+            return invoke_result_data
+        except Exception as ex:
+            self.logger_error.error("【授权手机号】" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "exception"
+            invoke_result_data.error_message = "授权手机号失败"
+            return invoke_result_data
+
+    @classmethod
+    def create_qr_code_unlimit(self, page, scene="a=1", width=430, env_version="release", app_id="", app_secret=""):
+        """
+        :description:获取小程序/小游戏的二维码（注意：接口只能生成已发布的小程序的二维码。开发版的带参二维码可以在开发者工具预览时生成）
+        :param page: 页面 page，例如 pages/index/index，根路径前不要填加 /，不能携带参数（参数请放在scene字段里），如果不填写这个字段，默认跳主页面
+        :param scene: 最大32个可见字符，只支持数字，大小写英文以及部分特殊字符：!#$&'()*+,/:;=?@-._~，其它字符请自行编码为合法字符（因不支持%，中文无法使用 urlencode 处理，请使用其他编码方式）
+        :param width: 二维码的宽度，单位 px，最小 280px，最大 1280px
+        :param env_version: 要打开的小程序版本。正式版为 "release"，体验版为 "trial"，开发版为 "develop"。默认是正式版。
+        :param app_id:app_id
+        :param app_secret:app_secret
+        :return: 图片二进制 数据类型Array<byte>
+        :last_editors: HuangJianYi
+        """
+        app_id = app_id if app_id else share_config.get_value("app_id")
+        app_secret = app_secret if app_secret else share_config.get_value("app_secret")
+
+        invoke_result_data = InvokeResultData()
+        redis_init = SevenHelper.redis_init(decode_responses=False)
+        redis_key = "create_qr_code_unlimit:" + CryptoHelper.md5_encrypt(f"{page}_{scene}")
+        redis_value = redis_init.get(redis_key)
+        if redis_value:
+            invoke_result_data.data = redis_value
+            return invoke_result_data
+
+        for i in range(2):
+            if i == 0:
+                invoke_result_data = self.get_access_token(app_id, app_secret)
+            else:
+                invoke_result_data = self.get_access_token(app_id, app_secret, True)
+
+            if invoke_result_data.success == True:
+                break
+        if invoke_result_data.success == False:
+            return invoke_result_data
+        access_token = invoke_result_data.data
+        response = ""
+        try:
+            headers = {"Content-type": "application/json"}
+            requset_url = 'https://api.weixin.qq.com/wxa/getwxacodeunlimit?access_token=' + access_token
+            param = {"page": page, "scene": scene, "width": width, "env_version": env_version}
+            try:
+                response = requests.post(requset_url, data=json.dumps(param, ensure_ascii=False).encode('utf-8'), headers=headers)
+                response_data = SevenHelper.json_loads(response.text)
+                if response_data.__contains__("errcode") and response_data["errcode"] != 0:
+                    invoke_result_data.success = False
+                    invoke_result_data.error_code = response_data["errcode"]
+                    invoke_result_data.error_message = response_data["errmsg"]
+                    return invoke_result_data
+            except:
+                pass
+            invoke_result_data.data = response.content
+            redis_init.set(redis_key, response.content, 30 * 24 * 3600)
+            return invoke_result_data
+        except Exception as ex:
+            self.logger_error.error("【create_qr_code_unlimit】" + traceback.format_exc() + ":" + str(response.text))
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "exception"
+            invoke_result_data.error_message = traceback.format_exc()
+            return invoke_result_data
+
+    @classmethod
+    def create_qr_code(self, path, width=430, app_id="", app_secret=""):
+        """
+        :description:获取小程序二维码，适用于需要的码数量较少的业务场景。通过该接口生成的小程序码，永久有效，有数量限制
+        :param path: 扫码进入的小程序页面路径，最大长度 128 字节，不能为空；对于小游戏，可以只传入 query 部分，来实现传参效果，如：传入 "?foo=bar"，即可在 wx.getLaunchOptionsSync 接口中的 query 参数获取到 {foo:"bar"}。
+        :param width: 二维码的宽度，单位 px，最小 280px，最大 1280px
+        :param app_id:app_id
+        :param app_secret:app_secret
+        :return: 图片二进制 数据类型Array<byte>
+        :last_editors: HuangJianYi
+        """
+        app_id = app_id if app_id else share_config.get_value("app_id")
+        app_secret = app_secret if app_secret else share_config.get_value("app_secret")
+
+        invoke_result_data = InvokeResultData()
+        redis_init = SevenHelper.redis_init(decode_responses=False)
+        redis_key = "wechat_qr_code:" + CryptoHelper.md5_encrypt(f"{path}")
+        redis_value = redis_init.get(redis_key)
+        if redis_value:
+            invoke_result_data.data = redis_value
+            return invoke_result_data
+
+        for i in range(2):
+            if i == 0:
+                invoke_result_data = self.get_access_token(app_id, app_secret)
+            else:
+                invoke_result_data = self.get_access_token(app_id, app_secret, True)
+
+            if invoke_result_data.success == True:
+                break
+        if invoke_result_data.success == False:
+            return invoke_result_data
+        access_token = invoke_result_data.data
+        response = ""
+        try:
+            headers = {"Content-type": "application/json"}
+            requset_url = 'https://api.weixin.qq.com/cgi-bin/wxaapp/createwxaqrcode?access_token=' + access_token
+            param = {"path": path, "width": width}
+            try:
+                response = requests.post(requset_url, data=json.dumps(param, ensure_ascii=False).encode('utf-8'), headers=headers)
+                response_data = SevenHelper.json_loads(response.text)
+                if response_data.__contains__("errcode") and response_data["errcode"] != 0:
+                    invoke_result_data.success = False
+                    invoke_result_data.error_code = response_data["errcode"]
+                    invoke_result_data.error_message = response_data["errmsg"]
+                    return invoke_result_data
+            except:
+                pass
+            invoke_result_data.data = response.content
+            redis_init.set(redis_key, response.content, 30 * 24 * 3600)
+            return invoke_result_data
+        except Exception as ex:
+            self.logger_error.error("【create_qr_code】" + traceback.format_exc() + ":" + str(response.text))
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "exception"
+            invoke_result_data.error_message = traceback.format_exc()
+            return invoke_result_data
+
+    @classmethod
+    def msg_sec_check(self, content, scene, open_id, nickname, app_id="", app_secret=""):
+        """
+        :description: 文本内容安全识别(https://developers.weixin.qq.com/miniprogram/dev/OpenApiDoc/sec-center/sec-check/msgSecCheck.html)
+        :param content：需检测的文本内容，文本字数的上限为2500字，需使用UTF-8编码
+        :param scene：场景枚举值（1 资料；2 评论；3 论坛；4 社交日志）
+        :param openid：用户的openid（用户需在近两小时访问过小程序）
+        :param nickname：用户昵称
+        :param app_id:app_id
+        :param app_secret:app_secret
+        :return:
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        app_id = app_id if app_id else share_config.get_value("app_id")
+        app_secret = app_secret if app_secret else share_config.get_value("app_secret")
+        invoke_result_data = InvokeResultData()
+        for i in range(2):
+            if i == 0:
+                invoke_result_data = self.get_access_token(app_id, app_secret)
+            else:
+                invoke_result_data = self.get_access_token(app_id, app_secret, True)
+
+            if invoke_result_data.success == True:
+                break
+        if invoke_result_data.success == False:
+            return invoke_result_data
+        access_token = invoke_result_data.data
+        response = ""
+        try:
+            requset_url = 'https://api.weixin.qq.com/wxa/msg_sec_check?access_token=' + access_token
+            headers = {"Content-type": "application/json"}
+            param = {"content": content, "scene": scene, "openid": open_id, "nickname": nickname, "version": 2}
+            response = requests.post(requset_url, data=json.dumps(param, ensure_ascii=False).encode('utf-8'), headers=headers)
+            response_data = SevenHelper.json_loads(response.text)
+            if response_data.__contains__("errcode") and response_data["errcode"] != 0:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = response_data["errcode"]
+                invoke_result_data.error_message = response_data["errmsg"]
+                return invoke_result_data
+            invoke_result_data.data = response_data
+            return invoke_result_data
+        except Exception as ex:
+            self.logger_error.error("【msg_sec_check】" + traceback.format_exc() + ":" + str(response.text))
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "exception"
+            invoke_result_data.error_message = traceback.format_exc()
+            return invoke_result_data
+
+    @classmethod
+    def media_check_async(self, media_url, media_type, scene, open_id, app_id="", app_secret=""):
+        """
+        :description: 音视频内容安全识别(https://developers.weixin.qq.com/miniprogram/dev/OpenApiDoc/sec-center/sec-check/mediaCheckAsync.html)
+        :param media_url：要检测的图片或音频的url，支持图片格式包括jpg, jepg, png, bmp, gif（取首帧），支持的音频格式包括mp3, aac, ac3, wma, flac, vorbis, opus, wav
+        :param media_type：1:音频;2:图片
+        :param scene：场景枚举值（1 资料；2 评论；3 论坛；4 社交日志）
+        :param open_id：用户的openid（用户需在近两小时访问过小程序）
+        :param app_id:app_id
+        :param app_secret:app_secret
+        :return:
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        app_id = app_id if app_id else share_config.get_value("app_id")
+        app_secret = app_secret if app_secret else share_config.get_value("app_secret")
+        invoke_result_data = InvokeResultData()
+        for i in range(2):
+            if i == 0:
+                invoke_result_data = self.get_access_token(app_id, app_secret)
+            else:
+                invoke_result_data = self.get_access_token(app_id, app_secret, True)
+
+            if invoke_result_data.success == True:
+                break
+        if invoke_result_data.success == False:
+            return invoke_result_data
+        access_token = invoke_result_data.data
+        response = ""
+        try:
+            requset_url = 'https://api.weixin.qq.com/wxa/media_check_async?access_token=' + access_token
+            headers = {"Content-type": "application/json"}
+            param = {"media_url": media_url,"media_type": media_type, "scene": scene, "openid": open_id, "version": 2}
+            response = requests.post(requset_url, data=json.dumps(param, ensure_ascii=False).encode('utf-8'), headers=headers)
+            response_data = SevenHelper.json_loads(response.text)
+            if response_data.__contains__("errcode") and response_data["errcode"] != 0:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = response_data["errcode"]
+                invoke_result_data.error_message = response_data["errmsg"]
+                return invoke_result_data
+            invoke_result_data.data = response_data
+            return invoke_result_data
+        except Exception as ex:
+            self.logger_error.error("【media_check_async】" + traceback.format_exc() + ":" + str(response.text))
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "exception"
+            invoke_result_data.error_message = traceback.format_exc()
+            return invoke_result_data
+
+    @classmethod
+    def decrypt_data_by_code(self, open_id, code, encrypted_Data, iv, app_id="", app_secret=""):
+        """
+        :description:解析加密数据，客户端判断是否登录状态，如果登录只传open_id不传code，如果是登录过期,要传code重新获取session_key
+        :param open_id：open_id
+        :param code：登录票据
+        :param encrypted_Data：加密数据,微信返回加密参数
+        :param iv：微信返回参数
+        :param app_id：app_id
+        :param app_secret：app_secret
+        :return: 解密后的数据，用户信息或者手机号信息
+        :last_editors: HuangJianYi
+        """
+        app_id = app_id if app_id else share_config.get_value("app_id")
+        app_secret = app_secret if app_secret else share_config.get_value("app_secret")
+
+        data = None
+        if code:
+            code2_session_dict = self.code2_session(code=code, app_id=app_id, app_secret=app_secret)
+            if code2_session_dict:
+                open_id = code2_session_dict["openid"]
+        try:
+            session_key = SevenHelper.redis_init().get(f"{app_id}_wechat_sessionkey:{open_id}")
+            wx_data_crypt = WeChatDataCrypt(app_id, session_key)
+            data = wx_data_crypt.decrypt(encrypted_Data, iv)  #data中是解密的信息
+        except Exception as ex:
+            self.logger_error.error("【decrypt_data_by_code】" + traceback.format_exc())
+        return data
+
+    @classmethod
+    def decrypt_data(self, session_key, encrypted_Data, iv, app_id=""):
+        """
+        :description:解析加密数据
+        :param session_key: session_key调用登录接口获得
+        :param encrypted_Data：加密数据,微信返回加密参数
+        :param iv：微信返回参数
+        :param app_id: 微信小程序标识
+        :return: 解密后的数据，用户信息或者手机号信息
+        :last_editors: HuangJianYi
+        """
+        app_id = app_id if app_id else share_config.get_value("app_id")
+
+        data = {}
+        try:
+            wx_data_crypt = WeChatDataCrypt(app_id, session_key)
+            data = wx_data_crypt.decrypt(encrypted_Data, iv)  #data中是解密的信息
+        except Exception as ex:
+            ("【decrypt_data】" + traceback.format_exc())
+        return data
+
+    @classmethod
+    def array_to_xml(self, array):
+        """
+        :description:array转xml
+        :return:
+        :last_editors: HuangJianYi
+        """
+        xml = ["<xml>"]
+        for k, v in array.items():
+            if v.isdigit():
+                xml.append("<{0}>{1}</{0}>".format(k, v))
+            else:
+                xml.append("<{0}><![CDATA[{1}]]></{0}>".format(k, v))
+        xml.append("</xml>")
+        return "".join(xml)
+
+    @classmethod
+    def xml_to_array(self, xml):
+        """
+        :description:将xml转为array
+        :return:
+        :last_editors: HuangJianYi
+        """
+        array_data = {}
+        root = ElementTree.fromstring(xml)
+        for child in root:
+            value = child.text
+            array_data[child.tag] = value
+        return array_data
+
+    @classmethod
+    def key_value_url(self, params, url_encode):
+        """
+        :description:   将键值对转为 key1=value1&key2=value2 对参数按照key=value的格式，并按照参数名ASCII字典序排序
+        :param params：参数字典
+        :param url_encode：是否url编码 True是False否
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        slist = sorted(params)
+        buff = []
+        for k in slist:
+            v = quote(params[k]) if url_encode else params[k]
+            buff.append("{0}={1}".format(k, v))
+
+        return "&".join(buff)
+
+    @classmethod
+    def get_nonce_str(self, length=32):
+        """
+        :description: 生成随机字符串
+        :param length：长度
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        import random
+        chars = "abcdefghijklmnopqrstuvwxyz0123456789"
+        strs = []
+        for x in range(length):
+            strs.append(chars[random.randrange(0, len(chars))])
+        return "".join(strs)
+
+    @classmethod
+    def get_sign(self, params, api_key):
+        """
+        :description:生成sign拼接API密钥
+        :param api_key: api密钥
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        string_a = WeChatHelper.key_value_url(params, False)
+        string_sign_temp = string_a + '&key=' + api_key  # APIKEY, API密钥，需要在商户后台设置
+        sign = (hashlib.md5(string_sign_temp.encode("utf-8")).hexdigest()).upper()
+        return sign
+
+    @classmethod
+    def signature_v3(self, private_key_path, sign_str):
+        """
+        :description:  生成V3签名值
+        :param private_key_path：私钥路径
+        :param sign_str：签名字符串
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        with open(private_key_path) as file:
+            private_key = file.read()
+        try:
+            rsa_key = RSA.import_key(private_key)
+            signer = PKCS1_v1_5.new(rsa_key)
+            digest = SHA256.new(sign_str.encode('utf-8'))
+            return base64.b64encode(signer.sign(digest)).decode('utf-8')
+        except Exception:
+            raise "WeixinPaySignIError"
+
+    @classmethod
+    def generate_scheme(self, app_id="", app_secret="", page="pages/index/index", query="", env_version="release", is_expire=True, expire_type=1, expire_interval=30, expire_time=0):
+        """
+        :description: 该接口用于获取小程序 scheme 码，适用于短信、邮件、外部网页、微信内等拉起小程序的业务场景。通过该接口，可以选择最长30天有效的小程序码，有数量限制，目前仅针对国内非个人主体的小程序开放
+        :param app_id:app_id
+        :param app_secret:app_secret
+        :param page: 页面 page，例如 pages/theme/theme，根路径前不要填加
+        :param query: 查询条件，例如 source_id=1&query1=q1
+        :param env_version: 默认值"release"。要打开的小程序版本。正式版为"release"，体验版为"trial"，开发版为"develop"，仅在微信外打开时生效。
+        :param is_expire: 到期失效的 scheme 码的失效时间，为 Unix 时间戳。生成的到期失效 scheme 码在该时间前有效。最长有效期为30天。is_expire 为 true 且 expire_type 为 0 时必填
+        :param expire_type: 默认值0，到期失效的 scheme 码失效类型，失效时间：0，失效间隔天数：1
+        :param expire_interval: 到期失效的 scheme 码的失效间隔天数。生成的到期失效 scheme 码在该间隔时间到达前有效。最长间隔天数为30天。is_expire 为 true 且 expire_type 为 1 时必填
+        :param expire_time: 到期失效的 scheme 码的失效时间，为 Unix 时间戳。生成的到期失效 scheme 码在该时间前有效。最长有效期为30天。is_expire 为 true 且 expire_type 为 0 时必填
+        :return: InvokeResultData
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+
+        if expire_type == 1 and expire_interval > 30:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "URL Scheme有效期最长30天"
+            return invoke_result_data
+        elif expire_type == 0 and TimeHelper.difference_days(expire_time, TimeHelper.get_now_timestamp()) > 30:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "URL Scheme有效期最长30天"
+            return invoke_result_data
+
+        redis_init = SevenHelper.redis_init(decode_responses=False)
+        redis_key = "generate_scheme:" + CryptoHelper.md5_encrypt(f"{page}_{query}_{env_version}_{is_expire}_{expire_type}_{expire_interval}_{expire_time}")
+        redis_value = redis_init.get(redis_key)
+        if redis_value:
+            invoke_result_data.data = redis_value.decode()
+            return invoke_result_data
+
+        for i in range(2):
+            if i == 0:
+                invoke_result_data = WeChatHelper.get_access_token(app_id, app_secret)
+            else:
+                invoke_result_data = WeChatHelper.get_access_token(app_id, app_secret, True)
+
+            if invoke_result_data.success == True:
+                break
+        if invoke_result_data.success == False:
+            return invoke_result_data
+
+        access_token = invoke_result_data.data
+        response = ""
+        response_data = {}
+        try:
+            headers = {"Content-type": "application/json"}
+            requset_url = 'https://api.weixin.qq.com/wxa/generatescheme?access_token=' + access_token
+            param = {"jump_wxa": {"path": page, "query": query, "env_version": env_version}, "is_expire": is_expire, "expire_type": expire_type, "expire_interval": expire_interval, "expire_time": expire_time}
+            try:
+                response = requests.post(requset_url, data=json.dumps(param, ensure_ascii=False).encode('utf-8'), headers=headers)
+                response_data = SevenHelper.json_loads(response.text)
+                if response_data.__contains__("errcode") and response_data["errcode"] != 0:
+                    invoke_result_data.success = False
+                    invoke_result_data.error_code = response_data["errcode"]
+                    invoke_result_data.error_message = response_data["errmsg"]
+                    return invoke_result_data
+            except:
+                pass
+            invoke_result_data.data = response_data['openlink']
+            if expire_type == 1 and expire_interval > 0:
+                redis_init.set(redis_key, invoke_result_data.data, expire_interval * 24 * 3600)
+            elif expire_type == 0 and expire_time > 0:
+                redis_init.set(redis_key, invoke_result_data.data, 300)
+                redis_init.expireat(redis_key, expire_time)
+            return invoke_result_data
+        except Exception as ex:
+            self.logger_error.error("【generate_scheme】" + traceback.format_exc() + ":" + str(response.text))
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "exception"
+            invoke_result_data.error_message = traceback.format_exc()
+            return invoke_result_data
+
+    @classmethod
+    def generate_urllink(self, app_id="", app_secret="", page="pages/index/index", query="", env_version="release", is_expire=True, expire_type=1, expire_interval=30, expire_time=0, cloud_base=None):
+        """
+        :description: 获取小程序 URL Link，适用于短信、邮件、网页、微信内等拉起小程序的业务场景。通过该接口，可以选择最长30天有效的小程序链接，有数量限制，目前仅针对国内非个人主体的小程序开放
+        :param app_id:app_id
+        :param app_secret:app_secret
+        :param page: 页面 page，例如 pages/theme/theme，根路径前不要填加
+        :param query: 查询条件，例如 source_id=1&query1=q1
+        :param env_version: 默认值"release"。要打开的小程序版本。正式版为"release"，体验版为"trial"，开发版为"develop"，仅在微信外打开时生效。
+        :param is_expire: 到期失效的 scheme 码的失效时间，为 Unix 时间戳。生成的到期失效 scheme 码在该时间前有效。最长有效期为30天。is_expire 为 true 且 expire_type 为 0 时必填
+        :param expire_type: 默认值0，到期失效的 scheme 码失效类型，失效时间：0，失效间隔天数：1
+        :param expire_interval: 到期失效的 scheme 码的失效间隔天数。生成的到期失效 scheme 码在该间隔时间到达前有效。最长间隔天数为30天。is_expire 为 true 且 expire_type 为 1 时必填
+        :param expire_time: 到期失效的 scheme 码的失效时间，为 Unix 时间戳。生成的到期失效 scheme 码在该时间前有效。最长有效期为30天。is_expire 为 true 且 expire_type 为 0 时必填
+        :param cloud_base: 云开发静态网站自定义 H5 配置参数，可配置中转的云开发 H5 页面。不填默认用官方 H5 页面 例如{"env": "云开发环境，如：xxx", "domain": "静态网站自定义域名，不填则使用默认域名，如：xxx.xxx", "path": "云开发静态网站 H5 页面路径，不可携带 query如：/jump-wxa.html", "query": "云开发静态网站 H5 页面 query 参数，最大 1024 个字符，只支持数字，大小写英文以及部分特殊字符：`!#$&'()*+,/:;=?@-._~%``如：a=1&b=2", "resource_appid": "第三方批量代云开发时必填，表示创建该 env 的 appid （小程序/第三方平台）"}
+        :return: InvokeResultData
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+
+        if expire_type == 1 and expire_interval > 30:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "URL Link有效期最长30天"
+            return invoke_result_data
+        elif expire_type == 0 and TimeHelper.difference_days(expire_time, TimeHelper.get_now_timestamp()) > 30:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "URL Link有效期最长30天"
+            return invoke_result_data
+
+        redis_init = SevenHelper.redis_init(decode_responses=False)
+        redis_key = "generate_urllink:" + CryptoHelper.md5_encrypt(f"{page}_{query}_{env_version}_{is_expire}_{expire_type}_{expire_interval}_{expire_time}_{cloud_base}")
+        redis_value = redis_init.get(redis_key)
+        if redis_value:
+            invoke_result_data.data = redis_value.decode()
+            return invoke_result_data
+
+        for i in range(2):
+            if i == 0:
+                invoke_result_data = WeChatHelper.get_access_token(app_id, app_secret)
+            else:
+                invoke_result_data = WeChatHelper.get_access_token(app_id, app_secret, True)
+
+            if invoke_result_data.success == True:
+                break
+        if invoke_result_data.success == False:
+            return invoke_result_data
+
+        access_token = invoke_result_data.data
+        response = ""
+        response_data = {}
+        try:
+            headers = {"Content-type": "application/json"}
+            requset_url = 'https://api.weixin.qq.com/wxa/generate_urllink?access_token=' + access_token
+            param = {"path": page, "query": query, "env_version": env_version, "is_expire": is_expire, "expire_type": expire_type, "expire_interval": expire_interval, "expire_time": expire_time, "cloud_base": cloud_base}
+            try:
+                response = requests.post(requset_url, data=json.dumps(param, ensure_ascii=False).encode('utf-8'), headers=headers)
+                response_data = SevenHelper.json_loads(response.text)
+                if response_data.__contains__("errcode") and response_data["errcode"] != 0:
+                    invoke_result_data.success = False
+                    invoke_result_data.error_code = response_data["errcode"]
+                    invoke_result_data.error_message = response_data["errmsg"]
+                    return invoke_result_data
+            except:
+                pass
+            invoke_result_data.data = response_data['url_link']
+            if expire_type == 1 and expire_interval > 0:
+                redis_init.set(redis_key, invoke_result_data.data, expire_interval * 24 * 3600)
+            elif expire_type == 0 and expire_time > 0:
+                redis_init.set(redis_key, invoke_result_data.data, 300)
+                redis_init.expireat(redis_key, expire_time)
+            return invoke_result_data
+        except Exception as ex:
+            self.logger_error.error("【generate_urllink】" + traceback.format_exc() + ":" + str(response.text))
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "exception"
+            invoke_result_data.error_message = traceback.format_exc()
+            return invoke_result_data
+
+    @classmethod
+    def generate_shortlink(self, app_id="", app_secret="", page="pages/index/index", query="", page_title="", is_permanent=False):
+        """
+        :description: 获取小程序 Short Link，适用于微信内拉起小程序的业务场景。目前只开放给电商类目(具体包含以下一级类目：电商平台、商家自营、跨境电商)。通过该接口，可以选择生成到期失效和永久有效的小程序短链
+        :param app_id:app_id
+        :param app_secret:app_secret
+        :param page: 页面 page，例如 pages/theme/theme，根路径前不要填加
+        :param query: 查询条件，例如 source_id=1&query1=q1
+        :param page_title: 页面标题，不能包含违法信息，超过20字符会用... 截断代替
+        :param is_permanent: 默认值false。生成的 Short Link 类型，短期有效：false，永久有效：true
+        :return: InvokeResultData
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+
+        redis_init = SevenHelper.redis_init(decode_responses=False)
+        redis_key = "generate_shortlink:" + CryptoHelper.md5_encrypt(f"{page}_{query}_{page_title}_{is_permanent}")
+        redis_value = redis_init.get(redis_key)
+        if redis_value:
+            invoke_result_data.data = redis_value.decode()
+            return invoke_result_data
+
+        for i in range(2):
+            if i == 0:
+                invoke_result_data = WeChatHelper.get_access_token(app_id, app_secret)
+            else:
+                invoke_result_data = WeChatHelper.get_access_token(app_id, app_secret, True)
+
+            if invoke_result_data.success == True:
+                break
+        if invoke_result_data.success == False:
+            return invoke_result_data
+
+        access_token = invoke_result_data.data
+        response = ""
+        response_data = {}
+        try:
+            headers = {"Content-type": "application/json"}
+            requset_url = 'https://api.weixin.qq.com/wxa/genwxashortlink?access_token=' + access_token
+            param = {"page_url": f"{page}?{query}", "page_title": page_title, "is_permanent": is_permanent}
+            try:
+                response = requests.post(requset_url, data=json.dumps(param, ensure_ascii=False).encode('utf-8'), headers=headers)
+                response_data = SevenHelper.json_loads(response.text)
+                if response_data.__contains__("errcode") and response_data["errcode"] != 0:
+                    invoke_result_data.success = False
+                    invoke_result_data.error_code = response_data["errcode"]
+                    invoke_result_data.error_message = response_data["errmsg"]
+                    return invoke_result_data
+            except:
+                pass
+            invoke_result_data.data = response_data['link']
+            if is_permanent == True:
+                redis_init.set(redis_key, invoke_result_data.data)
+            else:
+                redis_init.set(redis_key, invoke_result_data.data, 30 * 24 * 3600)
+            return invoke_result_data
+        except Exception as ex:
+            self.logger_error.error("【generate_shortlink】" + traceback.format_exc() + ":" + str(response.text))
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "exception"
+            invoke_result_data.error_message = traceback.format_exc()
+            return invoke_result_data
+
+
+class WeChatPayRequest(object):
+    """
+    :description: 微信支付请求类,配置文件内容 "wechat_pay": {"api_key": "","mch_id": "","certificate_url": "","private_key_url": ""}
+    """
+    """配置账号信息"""
+    # =======【基本信息设置】=====================================
+    # 微信公众号身份的唯一标识。审核通过后，在微信发送的邮件中查看
+    app_id = ""
+    # 受理商ID，身份标识
+    mch_id = ""
+    # API密钥，需要在商户后台设置
+    api_key = ""
+    # 证书地址,证书文件需要在商户后台下载
+    certificate_url = ""
+    # 商户私钥地址,文件需要在商户后台下载
+    private_key_url = ""
+
+    logger_error = Logger.get_logger_by_name("log_error")
+
+    def __init__(self, app_id="", api_key="", mch_id="", certificate_url="", private_key_url=""):
+        pay_config = share_config.get_value("wechat_pay")
+        self.app_id = app_id if app_id else share_config.get_value("app_id")
+        self.api_key = api_key if api_key else pay_config["api_key"]
+        self.mch_id = mch_id if mch_id else pay_config["mch_id"]
+        self.certificate_url = certificate_url if certificate_url else pay_config["certificate_url"]
+        self.private_key_url = private_key_url if private_key_url else pay_config.get("private_key_url", "")
+
+    def get_prepay_id(self, unified_order_url, params):
+        """
+        :description: 获取预支付单号prepay_id
+        :param unifiedorder_url：微信下单地址
+        :param params：请求参数字典
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        redis_key = f"{self.app_id}_wechat_prepay_id:" + str(params['out_trade_no'])
+        redis_init = SevenHelper.redis_init()
+        prepay_id = redis_init.get(redis_key)
+        if prepay_id:
+            invoke_result_data.data = prepay_id
+            return invoke_result_data
+        params['sign'] = WeChatHelper.get_sign(params, self.api_key)
+        respone = requests.post(unified_order_url, self.convert_request_xml(params), headers={'Content-Type': 'application/xml'})
+        response_data = xmltodict.parse(respone.text.encode('ISO-8859-1').decode('utf-8'))['xml']
+        if response_data['return_code'] == 'SUCCESS':
+            if response_data['result_code'] == 'SUCCESS':
+                prepay_id = str(response_data['prepay_id'])
+                redis_init.set(redis_key, prepay_id, ex=3600 * 1)
+                invoke_result_data.data = prepay_id
+                return invoke_result_data
+            else:
+                self.logger_error.error("【预支付单号】" + str(response_data))
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "error"
+                invoke_result_data.error_message = response_data['err_code_des']
+                return invoke_result_data
+        else:
+            self.logger_error.error("【预支付单号】" + str(response_data))
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = response_data['return_msg']
+            return invoke_result_data
+
+    def create_order(self, pay_order_no, body, total_fee, spbill_create_ip, notify_url, open_id="", time_expire="", trade_type="JSAPI"):
+        """
+        :description: 创建微信预订单
+        :param pay_order_no：商户订单号(支付单号)
+        :param body：订单描述
+        :param total_fee：支付金额；单位元
+        :param spbill_create_ip：客户端IP
+        :param notify_url：微信支付结果异步通知地址
+        :param open_id：微信open_id
+        :param time_expire：交易结束时间
+        :param trade_type：交易类型trade_type为JSAPI时，openid为必填参数！此参数为微信用户在商户对应appid下的唯一标识, 统一支付接口中，缺少必填参数openid！
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        spbill_create_ip = spbill_create_ip if SevenHelper.is_ip(spbill_create_ip) == True else "127.0.0.1"
+        params = {
+            'appid': self.app_id,  # appid
+            'mch_id': self.mch_id,  # 商户号
+            'nonce_str': WeChatHelper.get_nonce_str(),
+            'body': body,
+            'out_trade_no': str(pay_order_no),
+            'total_fee': str(int(decimal.Decimal(str(total_fee)) * 100)),
+            'spbill_create_ip': spbill_create_ip,
+            'trade_type': trade_type,
+            'notify_url': notify_url
+        }
+        if trade_type == "JSAPI":
+            if open_id == "":
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "error"
+                invoke_result_data.error_message = "缺少必填参数open_id"
+                return invoke_result_data
+            else:
+                params['openid'] = open_id
+        if time_expire != "":
+            params['time_expire'] = str(time_expire)
+
+        # 开发者调用支付统一下单API生成预交易单
+        unified_order_url = 'https://api.mch.weixin.qq.com/pay/unifiedorder'
+        invoke_result_data = self.get_prepay_id(unified_order_url, params)
+        if invoke_result_data.success == False:
+            return invoke_result_data
+        prepay_id = invoke_result_data.data
+        params['prepay_id'] = prepay_id
+        params['package'] = f"prepay_id={prepay_id}"
+        params['timestamp'] = str(int(time.time()))
+        sign_again_params = {'appId': params['appid'], 'nonceStr': params['nonce_str'], 'package': params['package'], 'signType': 'MD5', 'timeStamp': params['timestamp']}
+        sign_again_params['sign'] = WeChatHelper.get_sign(sign_again_params, self.api_key)
+        sign_again_params['paySign'] = sign_again_params['sign']
+        invoke_result_data.data = sign_again_params
+        return invoke_result_data  # 返回给app
+
+    def query_order(self, pay_order_no="", transaction_id=""):
+        """
+        :description: 查询订单
+        :param transaction_id：微信订单号
+        :param pay_order_no：商户订单号(支付单号)
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        if transaction_id == "" and pay_order_no == "":
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "缺少必填参数transaction_id或pay_order_no"
+            return invoke_result_data
+        request_xml = ""
+        try:
+            params = {
+                'appid': self.app_id,
+                'mch_id': self.mch_id,
+                'nonce_str': WeChatHelper.get_nonce_str(),
+            }
+            if transaction_id != "":
+                params['transaction_id'] = str(transaction_id)
+            if pay_order_no != "":
+                params['out_trade_no'] = str(pay_order_no)
+            params['sign'] = WeChatHelper.get_sign(params, self.api_key)
+            request_xml = self.convert_request_xml(params)
+            queryorder_url = 'https://api.mch.weixin.qq.com/pay/orderquery'
+            respone = requests.post(queryorder_url, request_xml, headers={'Content-Type': 'application/xml'})
+            response_data = xmltodict.parse(respone.text.encode('ISO-8859-1').decode('utf-8'))['xml']
+            invoke_result_data.data = response_data
+            return invoke_result_data
+        except Exception as ex:
+            self.logger_error.error("【查询订单】" + traceback.format_exc() + ":" + str(request_xml))
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "查询订单出现异常"
+            return invoke_result_data
+
+    def close_order(self, pay_order_no=""):
+        """
+        :description: 关闭订单
+        :param pay_order_no：商户订单号(支付单号)
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        if pay_order_no == "":
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "缺少必填参数pay_order_no"
+            return invoke_result_data
+        request_xml = ""
+        try:
+            params = {'appid': self.app_id, 'mch_id': self.mch_id, 'nonce_str': WeChatHelper.get_nonce_str(), 'out_trade_no': str(pay_order_no)}
+            params['sign'] = WeChatHelper.get_sign(params, self.api_key)
+            request_xml = self.convert_request_xml(params)
+            queryorder_url = 'https://api.mch.weixin.qq.com/pay/closeorder'
+            respone = requests.post(queryorder_url, request_xml, headers={'Content-Type': 'application/xml'})
+            response_data = xmltodict.parse(respone.text.encode('ISO-8859-1').decode('utf-8'))['xml']
+            invoke_result_data.data = response_data
+            return invoke_result_data
+        except Exception as ex:
+            self.logger_error.error("【关闭订单】" + traceback.format_exc() + ":" + str(request_xml))
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "关闭订单出现异常"
+            return invoke_result_data
+
+    def get_pay_status(self, pay_order_no, transaction_id=""):
+        """
+        :description: 查询订单状态
+        :param pay_order_no：商户订单号(支付单号)
+        :param transaction_id：微信订单号
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        invoke_result_data = self.query_order(pay_order_no, transaction_id)
+        if invoke_result_data.success == False:
+            return ""
+        else:
+            response_data = invoke_result_data.data
+            if response_data['return_code'] == 'SUCCESS':
+                if response_data['result_code'] == 'SUCCESS':
+                    return str(response_data['trade_state'] if response_data.__contains__("trade_state") else "")  # SUCCESS--支付成功REFUND--转入退款NOTPAY--未支付CLOSED--已关闭REVOKED--已撤销(刷卡支付)USERPAYING--用户支付中PAYERROR--支付失败(其他原因，如银行返回失败)ACCEPT--已接收，等待扣款
+                else:
+                    return ""
+            else:
+                return ""
+
+    def create_refund(self, refund_no, pay_order_no, notify_url, refund_fee, total_fee):
+        """
+        :description: 服务端退款请求
+        :param refund_no:开发者侧的退款单号, 不可重复
+        :param pay_order_no:商户分配订单号，标识进行退款的订单，开发者服务端的唯一订单号
+        :param notify_url:退款通知地址
+        :param refund_fee: 退款金额，单位[分]
+        :param total_fee：支付金额；单位元
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        params = {
+            'appid': self.app_id,  # appid
+            'mch_id': self.mch_id,  # 商户号
+            'nonce_str': WeChatHelper.get_nonce_str(),
+            'out_trade_no': str(pay_order_no),
+            'out_refund_no': str(refund_no),
+            'notify_url': notify_url,
+            'refund_fee': int(decimal.Decimal(str(refund_fee)) * 100),
+            'sign_type': 'MD5',
+            'total_fee': int(decimal.Decimal(str(total_fee)) * 100),
+        }
+        params['sign'] = WeChatHelper.get_sign(params, self.api_key)
+        refund_url = 'https://api.mch.weixin.qq.com/secapi/pay/refund'
+        respone = post(url=refund_url, data=self.convert_request_xml(params), headers={'Content-Type': 'application/xml'}, pkcs12_filename=self.certificate_url, pkcs12_password=self.mch_id)
+        response_data = xmltodict.parse(respone.text.encode('ISO-8859-1').decode('utf-8'))['xml']
+        if response_data['return_code'] == 'SUCCESS':
+            if response_data['result_code'] == 'SUCCESS':
+                invoke_result_data.data = response_data['refund_id']
+                return invoke_result_data
+            else:
+                self.logger_error.error("【创建退款单】" + str(response_data))
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "error"
+                invoke_result_data.error_message = response_data['err_code_des']
+                return invoke_result_data
+        else:
+            self.logger_error.error("【创建退款单】" + str(response_data))
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = response_data['return_msg']
+            return invoke_result_data
+
+    def query_refund(self, refund_no):
+        """
+        :description: 查询退款单
+        :param refund_no：商户退款单号
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        if refund_no == "":
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "缺少必填参数refund_no"
+            return invoke_result_data
+        request_xml = ""
+        try:
+            params = {'appid': self.app_id, 'mch_id': self.mch_id, 'nonce_str': WeChatHelper.get_nonce_str(), 'out_refund_no': str(refund_no), 'sign_type': 'MD5'}
+            params['sign'] = WeChatHelper.get_sign(params, self.api_key)
+            request_xml = self.convert_request_xml(params)
+            queryrefund_url = 'https://api.mch.weixin.qq.com/pay/refundquery'
+            respone = requests.post(queryrefund_url, request_xml, headers={'Content-Type': 'application/xml'})
+            response_data = xmltodict.parse(respone.text.encode('ISO-8859-1').decode('utf-8'))['xml']
+            invoke_result_data.data = response_data
+            return invoke_result_data
+        except Exception as ex:
+            self.logger_error.error("【查询退款单】" + traceback.format_exc() + ":" + str(request_xml))
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "查询退款单出现异常"
+            return invoke_result_data
+
+    def send_red_pack(self, mch_billno, send_name, re_openid, total_amount, total_num, wishing, client_ip, act_name, remark, scene_id=''):
+        """
+        :description: 发现金红包(https://pay.weixin.qq.com/wiki/doc/api/tools/cash_coupon.php?chapter=13_4&index=3)
+        :param mch_billno：商户订单号(每个订单号必须唯一组成：mch_id+yyyymmdd+10位一天内不能重复的数字)
+        :param send_name：商户名称(红包发送者名称)
+        :param re_openid：接受红包的用户openid
+        :param total_amount：付款金额，单位分
+        :param total_num：红包发放总人数
+        :param wishing：红包祝福语
+        :param client_ip：该IP可传用户端或者服务端的IP
+        :param act_name：活动名称
+        :param remark：备注信息
+        :param scene_id：发放红包使用场景，红包金额大于200或者小于1元时必传（PRODUCT_1:商品促销PRODUCT_2:抽奖PRODUCT_3:虚拟物品兑奖 PRODUCT_4:企业内部福利PRODUCT_5:渠道分润PRODUCT_6:保险回馈PRODUCT_7:彩票派奖PRODUCT_8:税务刮奖）
+        :return: 当返回错误码为“SYSTEMERROR”时，请不要更换商户订单号，一定要使用原商户订单号重试，否则可能造成重复发放红包等资金风险
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        client_ip = client_ip if SevenHelper.is_ip(client_ip) == True else "127.0.0.1"
+        request_xml = ""
+        try:
+            params = {'appid': self.app_id, 'mch_id': self.mch_id, 'nonce_str': WeChatHelper.get_nonce_str(), 'mch_billno': str(mch_billno), 'send_name': send_name, 're_openid': re_openid, 'total_amount': total_amount, 'total_num': total_num, 'wishing': wishing, 'client_ip': client_ip, 'act_name': act_name, 'remark': remark}
+            if scene_id:
+                params['scene_id'] = scene_id
+            params['sign'] = WeChatHelper.get_sign(params, self.api_key)
+            request_xml = self.convert_request_xml(params)
+            requset_url = 'https://api.mch.weixin.qq.com/mmpaymkttransfers/sendredpack'
+            # 重点是`cert=(certificate_url, private_key_url), verify=True`参数，查看源码后才知道是这样传ca证书
+            respone = requests.post(requset_url, data=request_xml, cert=(self.certificate_url, self.private_key_url), verify=True)
+            response_data = xmltodict.parse(respone.text.encode('ISO-8859-1').decode('utf-8'))['xml']
+            if response_data['return_code'] == 'SUCCESS':
+                if response_data['result_code'] == 'SUCCESS':
+                    invoke_result_data.data = {"send_listid": response_data['send_listid']}
+                    return invoke_result_data
+                else:
+                    self.logger_error.error("【发现金红包】" + str(response_data))
+                    invoke_result_data.success = False
+                    invoke_result_data.error_code = "error"
+                    invoke_result_data.error_message = response_data['err_code_des']
+                    return invoke_result_data
+            invoke_result_data.data = response_data
+            return invoke_result_data
+        except Exception as ex:
+            self.logger_error.error("【发现金红包】" + traceback.format_exc() + ":" + str(request_xml))
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "发现金红包出现异常"
+            return invoke_result_data
+
+    def convert_request_xml(self, params):
+        """
+        :description:拼接XML
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        xml = "<xml>"
+        for k, v in params.items():
+            # v = v.encode('utf8')
+            # k = k.encode('utf8')
+            xml += '<' + k + '>' + str(v) + '</' + k + '>'
+        xml += "</xml>"
+        return xml.encode("utf-8")
+
+
+class WeChatPayReponse(object):
+    """
+    :description: 微信支付响应类
+    """
+
+    logger_error = Logger.get_logger_by_name("log_error")
+
+    def __init__(self, reponse_xml, api_key=""):
+        self.data = WeChatHelper.xml_to_array(reponse_xml)
+        pay_config = share_config.get_value("wechat_pay")
+        self.api_key = api_key if api_key else pay_config["api_key"]
+
+    def check_sign(self):
+        """
+        :description: 校验签名
+        :return:
+        :last_editors: HuangJianYi
+        """
+        params = dict(self.data)  # make a copy to save sign
+        del params['sign']
+        sign = WeChatHelper.get_sign(params, self.api_key)  # 本地签名
+        if self.data['sign'] == sign:
+            return True
+        return False
+
+    def get_data(self):
+        """
+        :description: 获取微信的通知的数据
+        :return:
+        :last_editors: HuangJianYi
+        """
+        return self.data
+
+    def convert_response_xml(self, msg, ok=True):
+        """
+        :description: 返回xml格式数据
+        :return:
+        :last_editors: HuangJianYi
+        """
+        code = "SUCCESS" if ok else "FAIL"
+        return WeChatHelper.array_to_xml(dict(return_code=code, return_msg=msg))
+
+
+class WeChatRefundReponse(object):
+    """
+    :description: 微信退款响应类
+    """
+    logger_error = Logger.get_logger_by_name("log_error")
+
+    def __init__(self, reponse_xml, api_key=""):
+        self.data = WeChatHelper.xml_to_array(reponse_xml)
+        pay_config = share_config.get_value("wechat_pay")
+        self.api_key = api_key if api_key else pay_config["api_key"]
+
+    def get_data(self):
+        """
+        :description:获取微信的通知的数据
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        return self.data
+
+    def decode_req_info(self, req_info):
+        """
+        :description:解密退款通知加密参数req_info
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        detail_info = CryptoHelper.aes_decrypt(req_info, CryptoHelper.md5_encrypt(self.api_key))
+        dict_req_info = xmltodict.parse(detail_info)
+        return dict_req_info
+
+    def convert_response_xml(self, msg, ok=True):
+        code = "SUCCESS" if ok else "FAIL"
+        return WeChatHelper.array_to_xml(dict(return_code=code, return_msg=msg))
+
+
+class WeChatDataCrypt:
+    """
+    :description: 微信数据解密帮助类
+    """
+
+    def __init__(self, app_id, session_key):
+        self.app_id = app_id
+        self.session_key = session_key
+
+    def decrypt(self, encryptedData, iv):
+        # base64 decode
+        session_key = base64.b64decode(self.session_key)
+        encryptedData = base64.b64decode(encryptedData)
+        iv = base64.b64decode(iv)
+        decrypted = {}
+        cipher = AES.new(session_key, AES.MODE_CBC, iv)
+        result_data = str(self._unpad(cipher.decrypt(encryptedData)), "utf-8")
+        if result_data:
+            decrypted = SevenHelper.json_loads(result_data)
+        if decrypted:
+            if decrypted['watermark']['appid'] != self.app_id:
+                raise Exception('Invalid Buffer')
+        return decrypted
+
+    def _unpad(self, s):
+        return s[:-ord(s[len(s) - 1:])]
+
+
+class WeChatPayV3Request(object):
+    """
+    微信V3支付支付
+    """
+    # 微信公众号身份的唯一标识。审核通过后，在微信发送的邮件中查看
+    app_id = ""
+    # 商户ID，身份标识
+    mch_id = ""
+    # API密钥，需要在商户后台设置
+    api_key = ""
+    # 证书地址,证书文件需要在商户后台下载
+    certificate_url = ""
+    # 商户私钥地址apiclient_key.pem 地址,文件需要在商户后台下载
+    private_key_url = ""
+    # 商户API证书序列号
+    mch_serial_no = ""
+
+    logger_error = Logger.get_logger_by_name("log_error")
+
+    base_url = 'https://api.mch.weixin.qq.com'
+
+    def __init__(self, app_id="", api_key="", mch_id="", mch_serial_no="", certificate_url="", private_key_url=""):
+
+        pay_config = share_config.get_value("wechat_pay", {})
+        self.app_id = app_id if app_id else share_config.get_value("app_id")
+        self.mch_id = mch_id if mch_id else pay_config.get("mch_id", "")
+        self.api_key = api_key if api_key else pay_config.get("api_key", "")
+        self.mch_serial_no = mch_serial_no if mch_serial_no else pay_config.get("mch_serial_no", "")
+        self.certificate_url = certificate_url if certificate_url else pay_config.get("certificate_url", "")
+        self.private_key_url = private_key_url if private_key_url else pay_config.get("private_key_url", "")
+        self.timestamp = str(int(time.time()))
+        self.nonce_str = ''.join(random.sample(string.ascii_letters + string.digits, 16))
+
+    def _generate_request_sign(self, url_path, data, method='POST'):
+        """
+        :description:  生成请求签名
+        :param url_path：不包含域名的请求地址
+        :param data：请求参数（post请求才需要传,get传None）
+        :param method：请求方式
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        sign_list = [method, url_path, self.timestamp, self.nonce_str]
+        if data is not None:
+            sign_list.append(data)
+        else:
+            sign_list.append('')
+        sign_str = '\n'.join(sign_list) + '\n'
+        return WeChatHelper.signature_v3(private_key_path=self.private_key_url, sign_str=sign_str)
+
+    def _generate_pay_sign(self, app_id, package):
+        """
+        :description:  生成支付签名
+        :param app_id：商户绑定的应用标识
+        :param package：订单详情扩展字符串（示例值：prepay_id=wx201410272009395522657a690389285100）
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        sign_list = [app_id, self.timestamp, self.nonce_str, package]
+        sign_str = '\n'.join(sign_list) + '\n'
+        return WeChatHelper.signature_v3(private_key_path=self.cert_dir, sign_str=sign_str)
+
+    def _generate_auth_header(self, signature):
+        """
+        生成授权请求头
+        """
+        return f'WECHATPAY2-SHA256-RSA2048 mchid="{self.mch_id}",nonce_str="{self.nonce_str}",' \
+               f'signature="{signature}",timestamp="{self.timestamp}",serial_no="{self.mch_serial_no}"'
+
+    def transfer_one(self, open_id, out_batch_no, batch_name, batch_remark, total_amount):
+        """
+        :description:  单次商家转账
+        :param open_id：open_id是微信用户在公众号appid下的唯一用户标识（appid不同，则获取到的openid就不同），可用于永久标记一个用户
+        :param out_batch_no：商家批次单号（商户生成的唯一编号）
+        :param batch_name：批次名称
+        :param batch_remark：批次备注
+        :param total_amount：转账总金额(单位：分)
+        :return: 错误码返回SYSTEM_ERROR和NOT_ENOUGH和FREQUENCY_LIMITED 请勿更换商家转账批次单号，请使用相同参数再次调用API。否则可能造成资金损失
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        url_path = '/v3/transfer/batches'
+        url = self.base_url + url_path
+        transfer_detail_list = []
+        transfer_detail = {}
+        transfer_detail["out_detail_no"] = out_batch_no
+        transfer_detail["transfer_amount"] = total_amount
+        transfer_detail["transfer_remark"] = batch_remark
+        transfer_detail["openid"] = open_id
+        transfer_detail_list.append(transfer_detail)
+
+        data = {'appid': self.app_id, 'out_batch_no': out_batch_no, "batch_name": batch_name, "batch_remark": batch_remark, "total_amount": total_amount, 'total_num': 1, "transfer_detail_list": transfer_detail_list}
+
+        try:
+            data = json.dumps(data)
+            signature = self._generate_request_sign(url_path=url_path, data=data)
+            # print("Authorization signature:", self._generate_auth_header(signature))
+            headers = {'Authorization': self._generate_auth_header(signature), 'Content-Type': 'application/json'}
+            res = requests.post(url=url, data=data, headers=headers, timeout=10)
+            response_data = SevenHelper.json_loads(res.text)
+            if response_data.__contains__("code") and response_data["code"] != 0:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = response_data["code"]
+                invoke_result_data.error_message = response_data["message"]
+                return invoke_result_data
+            invoke_result_data.data = response_data
+            return invoke_result_data
+        except Exception as ex:
+            self.logger_error.error("【v3_transfer_one】" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "exception"
+            invoke_result_data.error_message = traceback.format_exc()
+            return invoke_result_data
+
+    def transfer_list(self, out_batch_no, batch_name, batch_remark, total_amount, total_num, transfer_detail_list=[]):
+        """
+        :description:  批量商家转账
+        :param out_batch_no：商家批次单号（商户生成的唯一编号）
+        :param batch_name：批次名称
+        :param batch_remark：批次备注
+        :param total_amount：转账总金额
+        :param total_num：转账总笔数
+        :param transfer_detail_list：转账明细列表
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        url_path = '/v3/transfer/batches'
+        url = self.base_url + url_path
+        data = {'appid': self.app_id, 'out_batch_no': out_batch_no, "batch_name": batch_name, "batch_remark": batch_remark, "total_amount": total_amount, 'total_num': total_num, "transfer_detail_list": transfer_detail_list}
+
+        try:
+            data = json.dumps(data)
+            signature = self._generate_request_sign(url_path=url_path, data=data)
+            # print("Authorization signature:", self._generate_auth_header(signature))
+            headers = {'Authorization': self._generate_auth_header(signature), 'Content-Type': 'application/json'}
+            res = requests.post(url=url, data=data, headers=headers, timeout=10)
+            response_data = SevenHelper.json_loads(res.text)
+            if response_data.__contains__("code") and response_data["code"] != 0:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = response_data["code"]
+                invoke_result_data.error_message = response_data["message"]
+                return invoke_result_data
+            invoke_result_data.data = response_data
+            return invoke_result_data
+        except Exception as ex:
+            self.logger_error.error("【v3_transfer_list】" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "exception"
+            invoke_result_data.error_message = traceback.format_exc()
+            return invoke_result_data
+
+    def query_batches(self, batch_id, need_query_detail=False, offset=0, limit=20, detail_status=None):
+        """
+        :description:  商家转账批次单号查询批次单
+        :param batch_id：微信批次单号
+        :param need_query_detail：是否查询转账明细单(枚举值：true：是；false：否，默认否。商户可选择是否查询指定状态的转账明细单，当转账批次单状态为“FINISHED”（已完成）时，才会返回满足条件的转账明细单)
+        :param offset：请求资源起始位置
+        :param limit：最大资源条数
+        :param detail_status：明细状态(查询指定状态的转账明细单，当need_query_detail为true时，该字段必填ALL:全部。需要同时查询转账成功和转账失败的明细单SUCCESS:转账成功。只查询转账成功的明细单FAIL:转账失败。只查询转账失败的明细单)
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        url_path = f'/v3/transfer/batches/batch-id/{batch_id}'
+        data = {'need_query_detail': need_query_detail, 'offset': offset, 'limit': limit}
+        if need_query_detail == True:
+            detail_status = "ALL"
+        if detail_status:
+            data["detail_status"] = detail_status
+        url_path = url_path + "?" + WeChatHelper.key_value_url(data, False)
+        url = self.base_url + url_path
+        data = None
+        try:
+            signature = self._generate_request_sign(url_path=url_path, data=data, method='GET')
+            # print("Authorization signature:", self._generate_auth_header(signature))
+            headers = {'Authorization': self._generate_auth_header(signature), 'Content-Type': 'application/json'}
+            res = requests.get(url=url, data=data, headers=headers, timeout=10)
+            response_data = SevenHelper.json_loads(res.text)
+            if response_data.__contains__("code") and response_data["code"] != 0:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = response_data["code"]
+                invoke_result_data.error_message = response_data["message"]
+                return invoke_result_data
+            invoke_result_data.data = response_data
+            return invoke_result_data
+        except Exception as ex:
+            self.logger_error.error("【v3_query_batches】" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "exception"
+            invoke_result_data.error_message = traceback.format_exc()
+            return invoke_result_data
+
+    def query_batches_detail(self, batch_id, detail_id):
+        """
+        :description:  微信明细单号查询明细单
+        :param batch_id：微信批次单号
+        :param detail_id：微信明细单号
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        url_path = f'/v3/transfer/batches/batch-id/{batch_id}/details/detail-id/{detail_id}'
+        url = self.base_url + url_path
+        data = None
+        try:
+            signature = self._generate_request_sign(url_path=url_path, data=data, method='GET')
+            # print("Authorization signature:", self._generate_auth_header(signature))
+            headers = {'Authorization': self._generate_auth_header(signature), 'Content-Type': 'application/json'}
+            res = requests.get(url=url, data=data, headers=headers, timeout=10)
+            response_data = SevenHelper.json_loads(res.text)
+            if response_data.__contains__("code") and response_data["code"] != 0:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = response_data["code"]
+                invoke_result_data.error_message = response_data["message"]
+                return invoke_result_data
+            invoke_result_data.data = response_data
+            return invoke_result_data
+        except Exception as ex:
+            self.logger_error.error("【v3_query_batches_detail】" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "exception"
+            invoke_result_data.error_message = traceback.format_exc()
+            return invoke_result_data
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/app_base_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/app_base_model.py`

 * *Ordering differences only*

 * *Files 10% similar despite different names*

```diff
@@ -1,401 +1,401 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-28 09:54:51
-@LastEditTime: 2023-06-28 11:01:14
-@LastEditors: HuangJianYi
-@Description: 
-"""
-from decimal import *
-from seven_cloudapp_frame.libs.customize.seven_helper import *
-from seven_cloudapp_frame.libs.common import *
-from seven_cloudapp_frame.models.top_base_model import *
-from seven_cloudapp_frame.models.seven_model import *
-from seven_cloudapp_frame.models.db_models.app.app_info_model import *
-from seven_cloudapp_frame.models.db_models.base.base_info_model import *
-from seven_cloudapp_frame.models.db_models.friend.friend_link_model import *
-from seven_cloudapp_frame.models.db_models.product.product_price_model import *
-from seven_cloudapp_frame.models.db_models.tao.tao_login_log_model import *
-from seven_cloudapp_frame.models.db_models.version.version_info_model import *
-from seven_cloudapp_frame.models.db_models.dict.dict_info_model import *
-
-class AppBaseModel():
-    """
-    :description: 应用信息业务模型
-    """
-    def __init__(self,context=None,logging_error=None,logging_info=None):
-        self.context = context
-        self.logging_link_error = logging_error
-        self.logging_link_info = logging_info
-
-    def get_app_id(self,store_name):
-        """
-        :description: 获取应用标识
-        :param store_name:店铺名称
-        :return app_id
-        :last_editors: HuangJianYi
-        """
-        app_id = ""
-        app_info_dict = AppInfoModel(context=self.context).get_cache_dict("store_name=%s", limit="1", field="app_id", params=[store_name])
-        if app_info_dict:
-            app_id = app_info_dict["app_id"]
-        return app_id
-
-    def get_app_info_dict(self, app_id, is_cache=True, field="*"):
-        """
-        :description: 获取应用信息
-        :param app_id: 应用标识
-        :param is_cache: 是否缓存
-        :param field: 查询字段
-        :return: 返回应用信息
-        :last_editors: HuangJianYi
-        """
-        app_info_model = AppInfoModel(context=self.context)
-        if is_cache:
-            dependency_key = DependencyKey.app_info(app_id)
-            return app_info_model.get_cache_dict(where="app_id=%s",limit="1", field=field, params=[app_id],dependency_key=dependency_key)
-        else:
-            return app_info_model.get_dict(where="app_id=%s", limit="1",field=field, params=[app_id])
-
-    def get_app_expire(self,app_id):
-        """
-        :description: 获取小程序是否过期未续费
-        :param app_id: 应用标识
-        :return 1过期0未过期
-        :last_editors: HuangJianYi
-        """
-        now_date = SevenHelper.get_now_datetime()
-        invoke_result_data = InvokeResultData()
-        app_info_dict = self.get_app_info_dict(app_id)
-        if not app_info_dict:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "小程序不存在"
-            return invoke_result_data
-        result = {}
-        app_info_dict["expiration_date"] = str(app_info_dict["expiration_date"])
-        if app_info_dict["expiration_date"] == "1900-01-01 00:00:00":
-            result["is_expire"] = 0
-        elif now_date > app_info_dict["expiration_date"]:
-            result["is_expire"] = 1
-        else:
-            result["is_expire"] = 0
-        invoke_result_data.data = result
-        return invoke_result_data
-
-    def get_left_navigation(self, user_nick, access_token, app_key, app_secret, app_id=""):
-        """
-        :description: 获取左侧导航
-        :param user_nick: 用户昵称
-        :param app_key: app_key
-        :param app_secret: app_secret
-        :param access_token: access_token
-        :param app_id: 应用标识
-        :return
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        store_user_nick = user_nick.split(':')[0]
-        if not store_user_nick:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "对不起，请先授权登录"
-            return invoke_result_data
-        base_info_dict = BaseInfoModel(context=self.context).get_dict()
-        if not base_info_dict:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "基础信息不存在"
-            return invoke_result_data
-
-        app_info_dict = None
-        if app_id:
-            app_info_dict = self.get_app_info_dict(app_id)
-
-        # 左上角信息
-        info = {}
-        info["company"] = "天志互联"
-        info["miniappName"] = base_info_dict["product_name"]
-        info["logo"] = base_info_dict["product_icon"]
-        info["client_now_ver"] = app_info_dict["template_ver"] if app_info_dict else ""
-
-        # 左边底部菜单
-        helper_info = {}
-        helper_info["customer_service"] = base_info_dict["customer_service"]
-        helper_info["video_url"] = base_info_dict["video_url"]
-        helper_info["study_url"] = base_info_dict["study_url"]
-        helper_info["is_remind_phone"] = base_info_dict["is_remind_phone"]
-        helper_info["phone"] = ""
-
-        # 过期时间
-        renew_info = {}
-        renew_info["surplus_day"] = 0
-        dead_date = ""
-        if app_info_dict:
-            helper_info["phone"] = app_info_dict["app_telephone"]
-            dead_date = app_info_dict["expiration_date"]
-        else:
-            top_base_model = TopBaseModel(context=self.context)
-            invoke_result_data = top_base_model.get_dead_date(store_user_nick,access_token, app_key, app_secret)
-            if invoke_result_data.success == False:
-                return invoke_result_data
-            dead_date = invoke_result_data.data
-        renew_info["dead_date"] = dead_date
-        if dead_date != "expire":
-            renew_info["surplus_day"] = TimeHelper.difference_days(dead_date, SevenHelper.get_now_datetime())
-        data = {}
-        data["app_info"] = info
-        data["helper_info"] = helper_info
-        data["renew_info"] = renew_info
-
-        product_price_model = ProductPriceModel(context=self.context)
-        now_date = SevenHelper.get_now_datetime()
-        product_price = product_price_model.get_cache_entity(where="%s>=begin_time and %s<=end_time and is_release=1",order_by="create_time desc",params=[now_date,now_date])
-        base_info = {}
-        # 把string转成数组对象
-        base_info["update_function"] = SevenHelper.json_loads(base_info_dict["update_function"]) if base_info_dict["update_function"] else []
-        base_info["update_function_b"] = SevenHelper.json_loads(base_info_dict["update_function_b"]) if base_info_dict["update_function_b"] else []
-        base_info["decoration_poster_list"] = SevenHelper.json_loads(base_info_dict["decoration_poster_json"]) if base_info_dict["decoration_poster_json"] else []
-        base_info["menu_config_list"] = SevenHelper.json_loads(base_info_dict["menu_config_json"]) if base_info_dict["menu_config_json"] else []
-        base_info["product_price_list"] = SevenHelper.json_loads(product_price.content) if product_price else []
-        base_info["server_ver"] = base_info_dict["server_ver"]
-        base_info["client_ver"] = base_info_dict["client_ver"]
-        base_info["is_force_update"] = base_info_dict["is_force_update"]
-        base_info["is_force_phone"] = share_config.get_value("is_force_phone",True)
-
-        #配置文件指定账号升级
-        test_config = share_config.get_value("test_config",{})
-        test_client_ver = test_config.get("client_ver","")
-        if test_client_ver and store_user_nick and store_user_nick == test_config.get("user_nick",""):
-            base_info["client_ver"] = test_client_ver
-        else:
-            #中台指定账号升级
-            version_info = VersionInfoModel(context=self.context).get_entity(where="type_id=1",order_by="id desc")
-            if version_info:
-                if version_info.update_scope == 2 and version_info.white_lists:
-                    white_lists = SevenHelper.json_loads(version_info.white_lists)
-                    if isinstance(white_lists, str):
-                        white_lists = white_lists.split(',')
-                    if store_user_nick in white_lists:
-                        base_info["client_ver"] = version_info.version_number
-
-        data["base_info"] = base_info
-        invoke_result_data.data =data
-        return invoke_result_data
-
-    def get_app_info_result(self, user_nick, open_id, access_token, app_key, app_secret, main_user_open_id=""):
-        """
-        :description: 获取小程序信息
-        :param user_nick:用户昵称
-        :param open_id:open_id
-        :param access_token: access_token
-        :param app_key:app_key
-        :param app_secret: app_secret
-        :param main_user_open_id: main_user_open_id
-        :return app_info
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        store_user_nick = user_nick.split(':')[0]
-        if not store_user_nick:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "对不起，请先授权登录"
-            return invoke_result_data
-        if not open_id:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "对不起，请先授权登录"
-            return invoke_result_data
-
-        app_info_model = AppInfoModel(context=self.context)
-        app_info = app_info_model.get_entity("store_user_nick=%s", params=store_user_nick)
-        top_base_model = TopBaseModel(context=self.context)
-        invoke_result_data = top_base_model.get_dead_date(store_user_nick, access_token, app_key, app_secret)
-        if invoke_result_data.success == False:
-            return invoke_result_data
-        dead_date = invoke_result_data.data
-        project_code = top_base_model.get_project_code(store_user_nick,access_token,app_key, app_secret)
-        now_timestamp = TimeHelper.datetime_to_timestamp(datetime.datetime.strptime(TimeHelper.get_now_format_time('%Y-%m-%d 00:00:00'), '%Y-%m-%d %H:%M:%S'))
-        login_log = TaoLoginLogModel(context=self.context).get_entity("open_id=%s", order_by="id desc", params=open_id)
-        if app_info:
-            if dead_date != "expire":
-                app_info.expiration_date = dead_date
-            if project_code != "":
-                app_info.project_code = project_code
-            invoke_result_data = top_base_model.get_shop(access_token, app_key, app_secret)
-            if invoke_result_data.success == True:
-                app_info.access_token = access_token
-            if app_info.main_user_open_id != main_user_open_id:
-                app_info.main_user_open_id = main_user_open_id
-            app_info_model.update_entity(app_info,"expiration_date,project_code,access_token,main_user_open_id")
-            app_info_model.delete_dependency_key(f"app_info:appid_{app_info.app_id}")
-
-            app_info.user_nick = user_nick
-            app_info.dead_date = dead_date
-            app_info.project_code = project_code
-            if app_info.dead_date != "expire":
-                dead_date_timestamp = TimeHelper.datetime_to_timestamp(datetime.datetime.strptime(app_info.dead_date, '%Y-%m-%d %H:%M:%S'))
-                app_info.surplus_day = int(int(abs(dead_date_timestamp - now_timestamp)) / 24 / 3600)
-            app_info.last_login_date = login_log.modify_date if login_log else ""
-            invoke_result_data.data = app_info
-            return invoke_result_data
-        else:
-            app_info = AppInfo()
-            app_info.access_token = access_token
-            base_info = BaseInfoModel(context=self.context).get_dict(field="client_ver")
-
-            app_info.template_ver = base_info["client_ver"]
-            app_info.user_nick = user_nick
-            app_info.dead_date = dead_date
-            app_info.project_code = project_code
-            if app_info.dead_date != "expire":
-                dead_date_timestamp = TimeHelper.datetime_to_timestamp(datetime.datetime.strptime(app_info.dead_date, '%Y-%m-%d %H:%M:%S'))
-                app_info.surplus_day = int(int(abs(dead_date_timestamp - now_timestamp)) / 24 / 3600)
-            app_info.last_login_date = login_log.create_date if login_log else ""
-            invoke_result_data.data = app_info
-            return invoke_result_data
-
-    def get_online_url(self, act_id, app_id, module_id=0, act_type=0):
-        """
-        :description: 获取online_url
-        :param act_id:活动标识
-        :param app_id:应用标识
-        :param module_id:模块标识
-        :param act_type:活动类型
-        :return str
-        :last_editors: HuangJianYi
-        """
-        page_index = ""
-        page = share_config.get_value("page_index")
-        if page:
-            if isinstance(page,dict):
-                cur_page = page.get(str(act_type),"")
-                if cur_page:
-                    page_index = "&page=" + CodingHelper.url_encode(cur_page)
-            else:
-                page_index = "&page=" + CodingHelper.url_encode(page)
-        query = CodingHelper.url_encode(f"actid={act_id}")
-        if module_id > 0:
-            query = CodingHelper.url_encode(f"actid={act_id}&module_id={module_id}")
-        online_url = f"https://m.duanqu.com/?_ariver_appid={app_id}&_mp_code=tb&transition=present{page_index}&query={query}"
-        return online_url
-
-    def get_live_url(self, app_id):
-        """
-        :description: 获取live_url
-        :param app_id:应用标识
-        :return str
-        :last_editors: HuangJianYi
-        """
-        live_url = f"https://market.m.taobao.com/app/taefed/shopping-delivery-wapp/index.html#/putin?mainKey=form&appId={app_id}"
-        return live_url
-
-    def _delete_dict_info_dependency_key(self, parent_id, dict_type, delay_delete_time=0.01):
-        """
-        :description: 删除字典信息依赖建
-        :param parent_id: 父节点标识
-        :param dict_type: 字典类型
-        :param delay_delete_time: 延迟删除时间，传0则不进行延迟
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        DictInfoModel().delete_dependency_key(DependencyKey.dict_info_list(parent_id, dict_type), delay_delete_time)
-
-    def save_dict_info(self, dict_id, parent_id, dict_type, dict_name, dict_value, dict_pic, sort_index, is_release, i1, i2, s1, s2):
-        """
-        :description: 保存字典
-        :param dict_id: 字典标识
-        :param parent_id: 父节点标识
-        :param dict_type: 字典类型
-        :param dict_name：字典名称
-        :param dict_value：字典值
-        :param dict_pic：字典图片
-        :param sort_index：排序
-        :param is_release：是否发布
-        :param i1：i1
-        :param i2：i2
-        :param s1：s1
-        :param s2：s2
-        :return
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        if (not parent_id and not dict_type) or not dict_name:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "param_error"
-            invoke_result_data.error_message = "参数不能为空或等于0"
-            return invoke_result_data
-        old_dict_info = None
-        dict_info = None
-        is_add = False
-        dict_info_model = DictInfoModel(context=self.context)
-        if dict_id > 0:
-            dict_info = dict_info_model.get_entity_by_id(dict_id)
-            if not dict_info:
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "error"
-                invoke_result_data.error_message = "信息不存在"
-                return invoke_result_data
-            old_dict_info = deepcopy(dict_info)
-        if not dict_info:
-            is_add = True
-            dict_info = DictInfo()
-        dict_info.parent_id = parent_id
-        dict_info.dict_type = dict_type
-        dict_info.dict_name = dict_name
-        dict_info.dict_value = dict_value
-        dict_info.dict_pic = dict_pic
-        dict_info.sort_index = sort_index
-        dict_info.is_release = is_release
-        dict_info.i1 = i1
-        dict_info.i2 = i2
-        dict_info.s1 = s1
-        dict_info.s2 = s2
-        dict_info.modify_date = SevenHelper.get_now_datetime()
-        if is_add:
-            dict_info.create_date = dict_info.modify_date
-            dict_info.id = dict_info_model.add_entity(dict_info)
-        else:
-            dict_info_model.update_entity(dict_info,exclude_field_list="parent_id,create_date")
-        result = {}
-        result["is_add"] = is_add
-        result["new"] = dict_info
-        result["old"] = old_dict_info
-        invoke_result_data.data = result
-        self._delete_dict_info_dependency_key(parent_id, dict_type)
-        return invoke_result_data
-
-    def get_dict_info_list(self, parent_id, dict_type, page_size, page_index, order_by="id desc",field="*", is_cache=True):
-        """
-        :description: 字典列表
-        :param parent_id：父节点标识
-        :param dict_type: 字典类型
-        :param page_size：页大小
-        :param page_index：页索引
-        :param order_by：排序
-        :param field：查询字段
-        :param is_cache：是否缓存
-        :return:
-        :last_editors: HuangJianYi
-        """
-        page_list = []
-        total = 0
-        if not parent_id or not dict_type:
-            return page_list, total
-        condition_where = ConditionWhere()
-        params = []
-        if parent_id:
-            condition_where.add_condition("parent_id=%s")
-            params.append(parent_id)
-        if dict_type:
-            condition_where.add_condition("dict_type=%s")
-            params.append(dict_type)
-        condition_where.add_condition("is_release=1")
-
-        dict_info_model = DictInfoModel(context=self.context)
-        if is_cache == True:
-            page_list, total = dict_info_model.get_cache_dict_page_list(field=field, page_index=page_index, page_size=page_size, where=condition_where.to_string(), group_by="", order_by=order_by,params=params,dependency_key=DependencyKey.dict_info_list(parent_id,dict_type),cache_expire=600)
-        else:
-            page_list, total = dict_info_model.get_dict_page_list(field=field, page_index=page_index, page_size=page_size, where=condition_where.to_string(), group_by="", order_by=order_by,params=params)
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-28 09:54:51
+@LastEditTime: 2023-06-28 11:01:14
+@LastEditors: HuangJianYi
+@Description: 
+"""
+from decimal import *
+from seven_cloudapp_frame.libs.customize.seven_helper import *
+from seven_cloudapp_frame.libs.common import *
+from seven_cloudapp_frame.models.top_base_model import *
+from seven_cloudapp_frame.models.seven_model import *
+from seven_cloudapp_frame.models.db_models.app.app_info_model import *
+from seven_cloudapp_frame.models.db_models.base.base_info_model import *
+from seven_cloudapp_frame.models.db_models.friend.friend_link_model import *
+from seven_cloudapp_frame.models.db_models.product.product_price_model import *
+from seven_cloudapp_frame.models.db_models.tao.tao_login_log_model import *
+from seven_cloudapp_frame.models.db_models.version.version_info_model import *
+from seven_cloudapp_frame.models.db_models.dict.dict_info_model import *
+
+class AppBaseModel():
+    """
+    :description: 应用信息业务模型
+    """
+    def __init__(self,context=None,logging_error=None,logging_info=None):
+        self.context = context
+        self.logging_link_error = logging_error
+        self.logging_link_info = logging_info
+
+    def get_app_id(self,store_name):
+        """
+        :description: 获取应用标识
+        :param store_name:店铺名称
+        :return app_id
+        :last_editors: HuangJianYi
+        """
+        app_id = ""
+        app_info_dict = AppInfoModel(context=self.context).get_cache_dict("store_name=%s", limit="1", field="app_id", params=[store_name])
+        if app_info_dict:
+            app_id = app_info_dict["app_id"]
+        return app_id
+
+    def get_app_info_dict(self, app_id, is_cache=True, field="*"):
+        """
+        :description: 获取应用信息
+        :param app_id: 应用标识
+        :param is_cache: 是否缓存
+        :param field: 查询字段
+        :return: 返回应用信息
+        :last_editors: HuangJianYi
+        """
+        app_info_model = AppInfoModel(context=self.context)
+        if is_cache:
+            dependency_key = DependencyKey.app_info(app_id)
+            return app_info_model.get_cache_dict(where="app_id=%s",limit="1", field=field, params=[app_id],dependency_key=dependency_key)
+        else:
+            return app_info_model.get_dict(where="app_id=%s", limit="1",field=field, params=[app_id])
+
+    def get_app_expire(self,app_id):
+        """
+        :description: 获取小程序是否过期未续费
+        :param app_id: 应用标识
+        :return 1过期0未过期
+        :last_editors: HuangJianYi
+        """
+        now_date = SevenHelper.get_now_datetime()
+        invoke_result_data = InvokeResultData()
+        app_info_dict = self.get_app_info_dict(app_id)
+        if not app_info_dict:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "小程序不存在"
+            return invoke_result_data
+        result = {}
+        app_info_dict["expiration_date"] = str(app_info_dict["expiration_date"])
+        if app_info_dict["expiration_date"] == "1900-01-01 00:00:00":
+            result["is_expire"] = 0
+        elif now_date > app_info_dict["expiration_date"]:
+            result["is_expire"] = 1
+        else:
+            result["is_expire"] = 0
+        invoke_result_data.data = result
+        return invoke_result_data
+
+    def get_left_navigation(self, user_nick, access_token, app_key, app_secret, app_id=""):
+        """
+        :description: 获取左侧导航
+        :param user_nick: 用户昵称
+        :param app_key: app_key
+        :param app_secret: app_secret
+        :param access_token: access_token
+        :param app_id: 应用标识
+        :return
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        store_user_nick = user_nick.split(':')[0]
+        if not store_user_nick:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "对不起，请先授权登录"
+            return invoke_result_data
+        base_info_dict = BaseInfoModel(context=self.context).get_dict()
+        if not base_info_dict:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "基础信息不存在"
+            return invoke_result_data
+
+        app_info_dict = None
+        if app_id:
+            app_info_dict = self.get_app_info_dict(app_id)
+
+        # 左上角信息
+        info = {}
+        info["company"] = "天志互联"
+        info["miniappName"] = base_info_dict["product_name"]
+        info["logo"] = base_info_dict["product_icon"]
+        info["client_now_ver"] = app_info_dict["template_ver"] if app_info_dict else ""
+
+        # 左边底部菜单
+        helper_info = {}
+        helper_info["customer_service"] = base_info_dict["customer_service"]
+        helper_info["video_url"] = base_info_dict["video_url"]
+        helper_info["study_url"] = base_info_dict["study_url"]
+        helper_info["is_remind_phone"] = base_info_dict["is_remind_phone"]
+        helper_info["phone"] = ""
+
+        # 过期时间
+        renew_info = {}
+        renew_info["surplus_day"] = 0
+        dead_date = ""
+        if app_info_dict:
+            helper_info["phone"] = app_info_dict["app_telephone"]
+            dead_date = app_info_dict["expiration_date"]
+        else:
+            top_base_model = TopBaseModel(context=self.context)
+            invoke_result_data = top_base_model.get_dead_date(store_user_nick,access_token, app_key, app_secret)
+            if invoke_result_data.success == False:
+                return invoke_result_data
+            dead_date = invoke_result_data.data
+        renew_info["dead_date"] = dead_date
+        if dead_date != "expire":
+            renew_info["surplus_day"] = TimeHelper.difference_days(dead_date, SevenHelper.get_now_datetime())
+        data = {}
+        data["app_info"] = info
+        data["helper_info"] = helper_info
+        data["renew_info"] = renew_info
+
+        product_price_model = ProductPriceModel(context=self.context)
+        now_date = SevenHelper.get_now_datetime()
+        product_price = product_price_model.get_cache_entity(where="%s>=begin_time and %s<=end_time and is_release=1",order_by="create_time desc",params=[now_date,now_date])
+        base_info = {}
+        # 把string转成数组对象
+        base_info["update_function"] = SevenHelper.json_loads(base_info_dict["update_function"]) if base_info_dict["update_function"] else []
+        base_info["update_function_b"] = SevenHelper.json_loads(base_info_dict["update_function_b"]) if base_info_dict["update_function_b"] else []
+        base_info["decoration_poster_list"] = SevenHelper.json_loads(base_info_dict["decoration_poster_json"]) if base_info_dict["decoration_poster_json"] else []
+        base_info["menu_config_list"] = SevenHelper.json_loads(base_info_dict["menu_config_json"]) if base_info_dict["menu_config_json"] else []
+        base_info["product_price_list"] = SevenHelper.json_loads(product_price.content) if product_price else []
+        base_info["server_ver"] = base_info_dict["server_ver"]
+        base_info["client_ver"] = base_info_dict["client_ver"]
+        base_info["is_force_update"] = base_info_dict["is_force_update"]
+        base_info["is_force_phone"] = share_config.get_value("is_force_phone",True)
+
+        #配置文件指定账号升级
+        test_config = share_config.get_value("test_config",{})
+        test_client_ver = test_config.get("client_ver","")
+        if test_client_ver and store_user_nick and store_user_nick == test_config.get("user_nick",""):
+            base_info["client_ver"] = test_client_ver
+        else:
+            #中台指定账号升级
+            version_info = VersionInfoModel(context=self.context).get_entity(where="type_id=1",order_by="id desc")
+            if version_info:
+                if version_info.update_scope == 2 and version_info.white_lists:
+                    white_lists = SevenHelper.json_loads(version_info.white_lists)
+                    if isinstance(white_lists, str):
+                        white_lists = white_lists.split(',')
+                    if store_user_nick in white_lists:
+                        base_info["client_ver"] = version_info.version_number
+
+        data["base_info"] = base_info
+        invoke_result_data.data =data
+        return invoke_result_data
+
+    def get_app_info_result(self, user_nick, open_id, access_token, app_key, app_secret, main_user_open_id=""):
+        """
+        :description: 获取小程序信息
+        :param user_nick:用户昵称
+        :param open_id:open_id
+        :param access_token: access_token
+        :param app_key:app_key
+        :param app_secret: app_secret
+        :param main_user_open_id: main_user_open_id
+        :return app_info
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        store_user_nick = user_nick.split(':')[0]
+        if not store_user_nick:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "对不起，请先授权登录"
+            return invoke_result_data
+        if not open_id:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "对不起，请先授权登录"
+            return invoke_result_data
+
+        app_info_model = AppInfoModel(context=self.context)
+        app_info = app_info_model.get_entity("store_user_nick=%s", params=store_user_nick)
+        top_base_model = TopBaseModel(context=self.context)
+        invoke_result_data = top_base_model.get_dead_date(store_user_nick, access_token, app_key, app_secret)
+        if invoke_result_data.success == False:
+            return invoke_result_data
+        dead_date = invoke_result_data.data
+        project_code = top_base_model.get_project_code(store_user_nick,access_token,app_key, app_secret)
+        now_timestamp = TimeHelper.datetime_to_timestamp(datetime.datetime.strptime(TimeHelper.get_now_format_time('%Y-%m-%d 00:00:00'), '%Y-%m-%d %H:%M:%S'))
+        login_log = TaoLoginLogModel(context=self.context).get_entity("open_id=%s", order_by="id desc", params=open_id)
+        if app_info:
+            if dead_date != "expire":
+                app_info.expiration_date = dead_date
+            if project_code != "":
+                app_info.project_code = project_code
+            invoke_result_data = top_base_model.get_shop(access_token, app_key, app_secret)
+            if invoke_result_data.success == True:
+                app_info.access_token = access_token
+            if app_info.main_user_open_id != main_user_open_id:
+                app_info.main_user_open_id = main_user_open_id
+            app_info_model.update_entity(app_info,"expiration_date,project_code,access_token,main_user_open_id")
+            app_info_model.delete_dependency_key(f"app_info:appid_{app_info.app_id}")
+
+            app_info.user_nick = user_nick
+            app_info.dead_date = dead_date
+            app_info.project_code = project_code
+            if app_info.dead_date != "expire":
+                dead_date_timestamp = TimeHelper.datetime_to_timestamp(datetime.datetime.strptime(app_info.dead_date, '%Y-%m-%d %H:%M:%S'))
+                app_info.surplus_day = int(int(abs(dead_date_timestamp - now_timestamp)) / 24 / 3600)
+            app_info.last_login_date = login_log.modify_date if login_log else ""
+            invoke_result_data.data = app_info
+            return invoke_result_data
+        else:
+            app_info = AppInfo()
+            app_info.access_token = access_token
+            base_info = BaseInfoModel(context=self.context).get_dict(field="client_ver")
+
+            app_info.template_ver = base_info["client_ver"]
+            app_info.user_nick = user_nick
+            app_info.dead_date = dead_date
+            app_info.project_code = project_code
+            if app_info.dead_date != "expire":
+                dead_date_timestamp = TimeHelper.datetime_to_timestamp(datetime.datetime.strptime(app_info.dead_date, '%Y-%m-%d %H:%M:%S'))
+                app_info.surplus_day = int(int(abs(dead_date_timestamp - now_timestamp)) / 24 / 3600)
+            app_info.last_login_date = login_log.create_date if login_log else ""
+            invoke_result_data.data = app_info
+            return invoke_result_data
+
+    def get_online_url(self, act_id, app_id, module_id=0, act_type=0):
+        """
+        :description: 获取online_url
+        :param act_id:活动标识
+        :param app_id:应用标识
+        :param module_id:模块标识
+        :param act_type:活动类型
+        :return str
+        :last_editors: HuangJianYi
+        """
+        page_index = ""
+        page = share_config.get_value("page_index")
+        if page:
+            if isinstance(page,dict):
+                cur_page = page.get(str(act_type),"")
+                if cur_page:
+                    page_index = "&page=" + CodingHelper.url_encode(cur_page)
+            else:
+                page_index = "&page=" + CodingHelper.url_encode(page)
+        query = CodingHelper.url_encode(f"actid={act_id}")
+        if module_id > 0:
+            query = CodingHelper.url_encode(f"actid={act_id}&module_id={module_id}")
+        online_url = f"https://m.duanqu.com/?_ariver_appid={app_id}&_mp_code=tb&transition=present{page_index}&query={query}"
+        return online_url
+
+    def get_live_url(self, app_id):
+        """
+        :description: 获取live_url
+        :param app_id:应用标识
+        :return str
+        :last_editors: HuangJianYi
+        """
+        live_url = f"https://market.m.taobao.com/app/taefed/shopping-delivery-wapp/index.html#/putin?mainKey=form&appId={app_id}"
+        return live_url
+
+    def _delete_dict_info_dependency_key(self, parent_id, dict_type, delay_delete_time=0.01):
+        """
+        :description: 删除字典信息依赖建
+        :param parent_id: 父节点标识
+        :param dict_type: 字典类型
+        :param delay_delete_time: 延迟删除时间，传0则不进行延迟
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        DictInfoModel().delete_dependency_key(DependencyKey.dict_info_list(parent_id, dict_type), delay_delete_time)
+
+    def save_dict_info(self, dict_id, parent_id, dict_type, dict_name, dict_value, dict_pic, sort_index, is_release, i1, i2, s1, s2):
+        """
+        :description: 保存字典
+        :param dict_id: 字典标识
+        :param parent_id: 父节点标识
+        :param dict_type: 字典类型
+        :param dict_name：字典名称
+        :param dict_value：字典值
+        :param dict_pic：字典图片
+        :param sort_index：排序
+        :param is_release：是否发布
+        :param i1：i1
+        :param i2：i2
+        :param s1：s1
+        :param s2：s2
+        :return
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        if (not parent_id and not dict_type) or not dict_name:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "param_error"
+            invoke_result_data.error_message = "参数不能为空或等于0"
+            return invoke_result_data
+        old_dict_info = None
+        dict_info = None
+        is_add = False
+        dict_info_model = DictInfoModel(context=self.context)
+        if dict_id > 0:
+            dict_info = dict_info_model.get_entity_by_id(dict_id)
+            if not dict_info:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "error"
+                invoke_result_data.error_message = "信息不存在"
+                return invoke_result_data
+            old_dict_info = deepcopy(dict_info)
+        if not dict_info:
+            is_add = True
+            dict_info = DictInfo()
+        dict_info.parent_id = parent_id
+        dict_info.dict_type = dict_type
+        dict_info.dict_name = dict_name
+        dict_info.dict_value = dict_value
+        dict_info.dict_pic = dict_pic
+        dict_info.sort_index = sort_index
+        dict_info.is_release = is_release
+        dict_info.i1 = i1
+        dict_info.i2 = i2
+        dict_info.s1 = s1
+        dict_info.s2 = s2
+        dict_info.modify_date = SevenHelper.get_now_datetime()
+        if is_add:
+            dict_info.create_date = dict_info.modify_date
+            dict_info.id = dict_info_model.add_entity(dict_info)
+        else:
+            dict_info_model.update_entity(dict_info,exclude_field_list="parent_id,create_date")
+        result = {}
+        result["is_add"] = is_add
+        result["new"] = dict_info
+        result["old"] = old_dict_info
+        invoke_result_data.data = result
+        self._delete_dict_info_dependency_key(parent_id, dict_type)
+        return invoke_result_data
+
+    def get_dict_info_list(self, parent_id, dict_type, page_size, page_index, order_by="id desc",field="*", is_cache=True):
+        """
+        :description: 字典列表
+        :param parent_id：父节点标识
+        :param dict_type: 字典类型
+        :param page_size：页大小
+        :param page_index：页索引
+        :param order_by：排序
+        :param field：查询字段
+        :param is_cache：是否缓存
+        :return:
+        :last_editors: HuangJianYi
+        """
+        page_list = []
+        total = 0
+        if not parent_id or not dict_type:
+            return page_list, total
+        condition_where = ConditionWhere()
+        params = []
+        if parent_id:
+            condition_where.add_condition("parent_id=%s")
+            params.append(parent_id)
+        if dict_type:
+            condition_where.add_condition("dict_type=%s")
+            params.append(dict_type)
+        condition_where.add_condition("is_release=1")
+
+        dict_info_model = DictInfoModel(context=self.context)
+        if is_cache == True:
+            page_list, total = dict_info_model.get_cache_dict_page_list(field=field, page_index=page_index, page_size=page_size, where=condition_where.to_string(), group_by="", order_by=order_by,params=params,dependency_key=DependencyKey.dict_info_list(parent_id,dict_type),cache_expire=600)
+        else:
+            page_list, total = dict_info_model.get_dict_page_list(field=field, page_index=page_index, page_size=page_size, where=condition_where.to_string(), group_by="", order_by=order_by,params=params)
         return page_list, total
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/asset_base_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/asset_base_model.py`

 * *Ordering differences only*

 * *Files 10% similar despite different names*

```diff
@@ -1,906 +1,906 @@
-# -*- coding: utf-8 -*-
-"""
-:Author: HuangJianYi
-:Date: 2020-05-12 20:11:48
-@LastEditTime: 2023-05-05 19:30:39
-@LastEditors: HuangJianYi
-:description: 
-"""
-from seven_cloudapp_frame.libs.common import *
-from seven_cloudapp_frame.libs.customize.seven_helper import *
-from seven_cloudapp_frame.models.db_models.asset.asset_log_model import *
-from seven_cloudapp_frame.models.db_models.asset.asset_only_model import *
-from seven_cloudapp_frame.models.db_models.user.user_asset_model import *
-from seven_cloudapp_frame.models.db_models.asset.asset_warn_notice_model import *
-from seven_cloudapp_frame.models.db_models.store.store_asset_model import *
-from seven_cloudapp_frame.models.db_models.store.store_asset_log_model import *
-from seven_cloudapp_frame.models.seven_model import *
-from seven_cloudapp_frame.models.frame_base_model import *
-
-
-class AssetBaseModel():
-    """
-    :description: 资产管理业务模型,主要管理用户资产和商家资产
-    """
-    def __init__(self,context=None,logging_error=None,logging_info=None, db_connect_key='db_cloudapp', redis_config_dict=None):
-        self.context = context
-        self.logging_link_error = logging_error
-        self.logging_link_info = logging_info
-        self.db_connect_key = db_connect_key
-        self.redis_config_dict = redis_config_dict
-
-
-    def _delete_asset_dependency_key(self, act_id, user_id, delay_delete_time=0.01):
-        """
-        :description: 删除资产依赖建
-        :param act_id: 活动标识
-        :param user_id: 用户标识
-        :param delay_delete_time: 延迟删除时间，传0则不进行延迟
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        AssetLogModel().delete_dependency_key(DependencyKey.asset_log_list(act_id,user_id), delay_delete_time,redis_config_dict=self.redis_config_dict)
-
-    def _add_onlyid_warn_stat(self,handler_name):
-        """
-        :description: 添加唯一标识预警拦截计数
-        :param handler_name：接口名称
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        if handler_name:
-            handler_name = str(handler_name).lower()
-            redis_init = SevenHelper.redis_init(config_dict=self.redis_config_dict)
-
-            hash_name_1 = f"warn_handler_list_{str(SevenHelper.get_now_int(fmt='%Y%m%d'))}"
-            hash_key_1 = f"handlername_{handler_name}"
-            if not redis_init.hexists(hash_name_1, hash_key_1):
-                redis_init.hset(hash_name_1,hash_key_1,SevenHelper.json_dumps({"app_id":'',"handler_name":handler_name}))
-                redis_init.expire(hash_name_1, 24 * 3600)
-
-            hash_name_2 = f"{hash_name_1}:{hash_key_1}"
-            redis_init.hincrby(hash_name_2, str(SevenHelper.get_now_int(fmt='%Y%m%d%H%M')), 1)
-            redis_init.expire(hash_name_2, 24 * 3600)
-
-    def delete_asset_only(self, act_id, only_id, create_day=0, app_id=''):
-        """
-        :description: 清除资产唯一标识 从数据库和redis中删除
-        :param act_id：活动标识
-        :param only_id：资产唯一标识
-        :param create_day：整形的创建天20200506
-        :param app_id：应用标识
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        redis_init = SevenHelper.redis_init(config_dict=self.redis_config_dict)
-        hash_name = f"asset_only_list:{act_id}" if act_id > 0 else f"asset_only_list:{app_id}_0"
-        if create_day <= 0:
-            hash_name += f"_{SevenHelper.get_now_day_int()}"
-        else:
-            hash_name += f"_{create_day}"
-        if redis_init.hexists(hash_name, only_id):
-            redis_init.hdel(hash_name, only_id)
-            asset_only_model = AssetOnlyModel(db_connect_key=self.db_connect_key,context=self.context)
-            asset_only_model.del_entity("only_id=%s", params=[only_id])
-
-    def get_user_asset_id_md5(self, app_id, act_id, user_id, asset_type, asset_object_id):
-        """
-        :description: 生成用户资产唯一标识
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param user_id：用户标识
-        :param asset_type：资产类型(1-次数2-积分3-价格档位)
-        :param asset_object_id：对象标识
-        :return: 用户资产唯一标识
-        :last_editors: HuangJianYi
-        """
-        if not user_id or not asset_type:
-            return 0
-        if act_id > 0:
-            return CryptoHelper.md5_encrypt_int(f"{act_id}_{user_id}_{asset_type}_{asset_object_id}")
-        else:
-            return CryptoHelper.md5_encrypt_int(f"{app_id}_0_{user_id}_{asset_type}_{asset_object_id}")
-            
-    def get_asset_check_code(self, id_md5, asset_value, sign_key):
-        """
-        :description: 生成资产校验码
-        :param id_md5：id_md5
-        :param asset_value：当前资产值
-        :param sign_key：签名key,目前使用app_id作为签名key
-        :return: 用户资产校验码
-        :last_editors: HuangJianYi
-        """
-        if not id_md5 or not asset_value:
-            return ""
-        return CryptoHelper.md5_encrypt(f"{id_md5}_{asset_value}", sign_key)
-
-    def update_user_asset(self, app_id, act_id, module_id, user_id, open_id, user_nick, asset_type, asset_value, asset_object_id, source_type, source_object_id, source_object_name, log_title, only_id="",handler_name="",request_code="", info_json={}):
-        """
-        :description: 变更用户资产
-        :param act_id：活动标识
-        :param module_id：模块标识，没有填0
-        :param user_id：用户标识
-        :param open_id：open_id
-        :param user_nick：昵称
-        :param asset_type：资产类型(1-次数2-积分3-价格档位)
-        :param asset_value：变动的资产值，比如原本是100现在变成80，应该传入-20,原本是100现在变成120，应该传入20
-        :param asset_object_id：资产对象标识
-        :param source_type：来源类型（1-购买2-任务3-手动配置4-抽奖5-回购）
-        :param source_object_id：来源对象标识(比如来源类型是任务则对应任务类型)
-        :param source_object_name：来源对象名称(比如来源类型是任务则对应任务名称)
-        :param log_title：资产流水标题
-        :param only_id:唯一标识(用于并发操作时校验避免重复操作)由业务方定义传入
-        :param handler_name:接口名称
-        :param request_code:请求唯一标识，从seven_framework框架获取对应request_code
-        :param info_json：资产流水详情，用于存放业务方自定义字典
-        :return: 返回实体InvokeResultData
-        :last_editors: HuangJianYi
-        """
-
-        invoke_result_data = InvokeResultData()
-
-        if not user_id or not asset_type or not asset_value:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "param_error"
-            invoke_result_data.error_message = "参数不能为空或等于0"
-            return invoke_result_data
-
-        if int(asset_type) == 3 and not asset_object_id:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "param_error"
-            invoke_result_data.error_message = "资产类型为价格档位,参数asset_object_id不能为空或等于0"
-            return invoke_result_data
-        asset_value = int(asset_value)
-        user_asset_id_md5 = self.get_user_asset_id_md5(app_id, act_id, user_id, asset_type, asset_object_id)
-        if user_asset_id_md5 == 0:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "修改失败"
-            return invoke_result_data
-        #如果only_id已经存在，直接在redis进行拦截,减少数据库的请求，时限1天
-        redis_init = SevenHelper.redis_init(config_dict=self.redis_config_dict)
-        is_asset_warn = share_config.get_value("is_asset_warn",False) #是否开启资产预警，跟控制台配套使用
-        only_cache_key = ""
-        if only_id:
-            only_cache_key = f"asset_only_list:{act_id}_{SevenHelper.get_now_day_int()}"  if act_id > 0 else f"asset_only_list:{app_id}_0_{SevenHelper.get_now_day_int()}"
-            if redis_init.hexists(only_cache_key, only_id):
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "error"
-                invoke_result_data.error_message = "only_id已经存在"
-                
-                if is_asset_warn == True:
-                    asset_warn_notice = AssetWarnNotice()
-                    asset_warn_notice.app_id = app_id
-                    asset_warn_notice.act_id = act_id
-                    asset_warn_notice.ascription_type = 2
-                    asset_warn_notice.handler_name = handler_name
-                    asset_warn_notice.request_code = request_code
-                    asset_warn_notice.user_id = user_id
-                    asset_warn_notice.open_id = open_id
-                    asset_warn_notice.user_nick = user_nick
-                    asset_warn_notice.asset_type =asset_type
-                    asset_warn_notice.asset_object_id = asset_object_id
-                    asset_warn_notice.log_title = source_object_name if source_object_name else log_title
-                    if source_type == 1:
-                        asset_warn_notice.info_desc = f"重复请求{asset_warn_notice.log_title}【订单号：{only_id}】"
-                    else:
-                        asset_warn_notice.info_desc = f"重复请求{asset_warn_notice.log_title}"
-                    asset_warn_notice.info_json = {"asset_value":asset_value}
-                    asset_warn_notice.create_date = SevenHelper.get_now_datetime()
-                    asset_warn_notice.create_day = SevenHelper.get_now_day_int()
-                    redis_init.rpush("asset_intercept_queue_list",SevenHelper.json_dumps(asset_warn_notice))
-                    redis_init.expire("asset_intercept_queue_list", 7 * 24 * 3600)
-                    #添加唯一标识预警拦截计数,用于控制台跑数据进行并发预警
-                    self._add_onlyid_warn_stat(handler_name)
-                
-                return invoke_result_data
-        db_transaction = DbTransaction(db_config_dict=config.get_value(self.db_connect_key),context=self.context)
-        frame_base_model = FrameBaseModel(context=self.context)
-        user_asset_model = UserAssetModel(db_connect_key=self.db_connect_key,sub_table=frame_base_model.get_business_sub_table("user_asset_tb",{"app_id":app_id}),db_transaction=db_transaction, context=self.context)
-        asset_log_model = AssetLogModel(db_connect_key=self.db_connect_key,sub_table=frame_base_model.get_business_sub_table("asset_log_tb",{"app_id":app_id}),db_transaction=db_transaction, context=self.context)
-        asset_only_model = AssetOnlyModel(db_connect_key=self.db_connect_key,db_transaction=db_transaction, context=self.context)
-
-        acquire_lock_name = f"userasset:{user_asset_id_md5}"
-        acquire_lock_status, identifier = SevenHelper.redis_acquire_lock(acquire_lock_name)
-        if acquire_lock_status == False:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "acquire_lock"
-            invoke_result_data.error_message = "系统繁忙,请稍后再试"
-            return invoke_result_data
-
-        try:
-            now_day_int = SevenHelper.get_now_day_int()
-            now_datetime = SevenHelper.get_now_datetime()
-            old_user_asset_id = 0
-            history_asset_value = 0
-
-            user_asset = user_asset_model.get_entity("id_md5=%s",params=[user_asset_id_md5])
-            if user_asset:
-                if user_asset.asset_value + asset_value < 0:
-                    SevenHelper.redis_release_lock(acquire_lock_name, identifier)
-                    invoke_result_data.success = False
-                    invoke_result_data.error_code = "no_enough"
-                    invoke_result_data.error_message = "变更后的资产不能为负数"
-                    return invoke_result_data
-                if user_asset.asset_value + asset_value > 2147483647:
-                    SevenHelper.redis_release_lock(acquire_lock_name, identifier)
-                    invoke_result_data.success = False
-                    invoke_result_data.error_code = "no_enough"
-                    invoke_result_data.error_message = "变更后的资产不能大于整形的最大值"
-                    return invoke_result_data
-
-                old_user_asset_id = user_asset.id
-                history_asset_value = user_asset.asset_value
-            else:
-                if asset_value < 0:
-                    SevenHelper.redis_release_lock(acquire_lock_name, identifier)
-                    invoke_result_data.success = False
-                    invoke_result_data.error_code = "no_enough"
-                    invoke_result_data.error_message = "资产不能为负数"
-                    return invoke_result_data
-                user_asset = UserAsset()
-                user_asset.id_md5 = user_asset_id_md5
-                user_asset.app_id = app_id
-                user_asset.act_id = act_id
-                user_asset.user_id = user_id
-                user_asset.open_id = open_id
-                user_asset.user_nick = user_nick
-                user_asset.asset_type = asset_type
-                user_asset.asset_object_id = asset_object_id
-                user_asset.create_date = now_datetime
-
-            user_asset.asset_value += asset_value
-            user_asset.asset_check_code = self.get_asset_check_code(user_asset_id_md5, user_asset.asset_value, app_id)
-            user_asset.modify_date = now_datetime
-
-            asset_log = AssetLog()
-            asset_log.app_id = app_id
-            asset_log.act_id = act_id
-            asset_log.module_id = module_id
-            asset_log.user_id = user_id
-            asset_log.open_id = open_id
-            asset_log.user_nick = user_nick
-            asset_log.log_title = log_title
-            asset_log.info_json = SevenHelper.json_dumps(info_json) if info_json else {}
-            asset_log.asset_type = asset_type
-            asset_log.asset_object_id = asset_object_id
-            asset_log.source_type = source_type
-            asset_log.source_object_id = source_object_id
-            asset_log.source_object_name = source_object_name
-            asset_log.only_id = only_id
-            asset_log.operate_type = 0 if asset_value > 0 else 1
-            asset_log.operate_value = asset_value
-            asset_log.history_value = history_asset_value
-            asset_log.now_value = user_asset.asset_value
-            asset_log.handler_name = handler_name
-            asset_log.request_code = request_code
-            asset_log.create_date = now_datetime
-            asset_log.create_day = now_day_int
-
-            if only_id:
-                asset_only = AssetOnly()
-                if act_id > 0:
-                    asset_only.id_md5 = CryptoHelper.md5_encrypt_int(f"{act_id}_{user_id}_{only_id}")
-                else:
-                    asset_only.id_md5 = CryptoHelper.md5_encrypt_int(f"{app_id}_0_{user_id}_{only_id}")
-
-                asset_only.app_id = app_id
-                asset_only.act_id = act_id
-                asset_only.user_id = user_id
-                asset_only.open_id = open_id
-                asset_only.only_id = only_id
-                asset_only.create_date = now_datetime
-
-            db_transaction.begin_transaction()
-
-            if old_user_asset_id != 0:
-                user_asset_model.update_entity(user_asset, "asset_value,asset_check_code,modify_date")
-            else:
-                user_asset_model.add_entity(user_asset)
-            if only_id:
-                asset_only_model.add_entity(asset_only)
-            asset_log_model.add_entity(asset_log)
-
-            result,message = db_transaction.commit_transaction(return_detail_tuple=True)
-            if result == False:
-                if only_id and is_asset_warn == True:
-                    #添加唯一标识预警拦截计数,用于控制台跑数据进行并发预警
-                    self._add_onlyid_warn_stat(handler_name)
-                if self.context:
-                    self.context.logging_link_error("【变更资产】" + message)
-                elif self.logging_link_error:
-                    self.logging_link_error("【变更资产】" + message)
-                SevenHelper.redis_release_lock(acquire_lock_name, identifier)
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "fail"
-                invoke_result_data.error_message = "系统繁忙,请稍后再试"
-                return invoke_result_data
-            try:
-                if only_id:
-                    redis_init.hset(only_cache_key, only_id, 1)
-                    redis_init.expire(only_cache_key, 24 * 3600)
-                self._delete_asset_dependency_key(act_id,user_id)
-                
-                if is_asset_warn == True:
-                    asset_queue = {}
-                    asset_queue["app_id"] = app_id
-                    asset_queue["act_id"] = act_id
-                    asset_queue["open_id"] = open_id
-                    asset_queue["user_nick"] = user_nick
-                    asset_queue["user_id"] = user_id
-                    asset_queue["asset_type"] = asset_type
-                    asset_queue["asset_object_id"] = asset_object_id
-                    asset_queue["now_value"] = user_asset.asset_value
-                    asset_queue["operate_value"] = asset_value
-                    asset_queue["history_asset_value"] = history_asset_value
-                    asset_queue["now_day_int"] = now_day_int
-                    asset_queue["create_date"] = now_datetime
-                    redis_init.rpush(f"asset_queue_list",SevenHelper.json_dumps(asset_queue))
-                    redis_init.expire(f"asset_queue_list", 7 * 24 * 3600)
-            except Exception as ex:
-                if self.context:
-                    self.context.logging_link_error("【资产队列】" + traceback.format_exc())
-                elif self.logging_link_error:
-                    self.logging_link_error("【资产队列】" + traceback.format_exc())
-            
-            invoke_result_data.data = {"user_asset":user_asset.__dict__}
-
-        except Exception as ex:
-            if self.context:
-                self.context.logging_link_error("【变更资产】" + traceback.format_exc())
-            elif self.logging_link_error:
-                self.logging_link_error("【变更资产】" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "exception"
-            invoke_result_data.error_message = "系统繁忙,请稍后再试"
-        finally:
-            SevenHelper.redis_release_lock(acquire_lock_name, identifier)
-
-        return invoke_result_data
-
-    def get_user_asset_list(self, app_id, act_id, user_ids, asset_type=0):
-        """
-        :description: 获取用户资产列表
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param user_ids：用户标识 多个逗号,分隔
-        :param asset_type：资产类型(1-次数2-积分3-价格档位)
-        :return: 返回list
-        :last_editors: HuangJianYi
-        """
-        if not user_ids:
-            return []
-        condition = "app_id=%s and act_id=%s"
-        params = [app_id, act_id]
-        if asset_type > 0:
-            condition+= " AND asset_type=%s"
-            params.append(asset_type)
-        if user_ids:
-            if isinstance(user_ids,str):
-                condition += f" AND user_id in ({user_ids})"
-            elif isinstance(user_ids,list):
-                condition+=" AND " + SevenHelper.get_condition_by_int_list("user_id",user_ids)
-            else:
-                condition += " AND user_id=%s"
-                params.append(user_ids)
-        user_asset_model = UserAssetModel(db_connect_key=self.db_connect_key,sub_table=FrameBaseModel(context=self.context).get_business_sub_table("user_asset_tb",{"app_id":app_id}),context=self.context)
-        user_asset_dict_list = user_asset_model.get_dict_list(condition, params=params)
-        if len(user_asset_dict_list) > 0:
-            for user_asset_dict in user_asset_dict_list:
-                if share_config.get_value("is_check_asset",True) == True: #是否开启资产校验
-                    if user_asset_dict["app_id"] != str(app_id):
-                        user_asset_dict["asset_value"] = 0
-                    if self.get_asset_check_code(user_asset_dict["id_md5"], user_asset_dict["asset_value"], app_id) != user_asset_dict["asset_check_code"]:
-                        user_asset_dict["asset_value"] = 0
-        return user_asset_dict_list
-
-    def get_user_asset(self, app_id, act_id, user_id, asset_type, asset_object_id=""):
-        """
-        :description: 获取具体的用户资产
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param user_id：用户标识
-        :param asset_type：资产类型(1-次数2-积分3-价格档位)
-        :param asset_object_id：资产对象标识,没有传空
-        :return: 返回单条字典
-        :last_editors: HuangJianYi
-        """
-        if not user_id or not asset_type:
-            return None
-        user_asset_model = UserAssetModel(db_connect_key=self.db_connect_key,sub_table=FrameBaseModel(context=self.context).get_business_sub_table("user_asset_tb",{"app_id":app_id}),context=self.context)
-        user_asset_id_md5 = self.get_user_asset_id_md5(app_id, act_id, user_id, asset_type, asset_object_id)
-        user_asset_dict = user_asset_model.get_dict("id_md5=%s", limit="1", params=[user_asset_id_md5])
-        if user_asset_dict:
-            if share_config.get_value("is_check_asset",True) == True: #是否开启资产校验
-                if user_asset_dict["app_id"] != str(app_id):
-                    user_asset_dict["asset_value"] = 0
-                if self.get_asset_check_code(user_asset_dict["id_md5"], user_asset_dict["asset_value"], app_id) != user_asset_dict["asset_check_code"]:
-                    user_asset_dict["asset_value"] = 0
-        return user_asset_dict
-
-    def get_asset_log_list(self, app_id, act_id, asset_type=0, page_size=20, page_index=0, user_id=0, asset_object_id="", start_date="", end_date="", user_nick="", open_id="", source_type=0, source_object_id=None, field="*", is_cache=True, operate_type=-1, page_count_mode="total", module_id=0):
-        """
-        :description: 获取用户资产流水记录
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param asset_type：资产类型(1-次数2-积分3-价格档位)
-        :param page_size：条数
-        :param page_index：页数
-        :param user_id：用户标识
-        :param asset_object_id：资产对象标识
-        :param start_date：开始时间
-        :param end_date：结束时间
-        :param user_nick：昵称
-        :param open_id：open_id
-        :param source_type：来源类型（1-购买2-任务3-手动配置4-抽奖5-回购）
-        :param source_object_id：来源对象标识(比如来源类型是任务则对应任务类型)
-        :param field：查询字段
-        :param is_cache：是否缓存
-        :param operate_type：操作类型 （0累计 1消耗）
-        :param page_count_mode: 分页计数模式 total-计算总数(默认) next-计算是否有下一页(bool) none-不计算
-        :param module_id: 模块标识
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        page_list = []
-
-        condition = "app_id=%s and act_id=%s"
-        params = [app_id, act_id]
-        if module_id != 0:
-            condition += " AND module_id=%s"
-            params.append(module_id)
-        if asset_type != 0:
-            condition += " AND asset_type=%s"
-            params.append(asset_type)
-        if user_id != 0:
-            condition += " AND user_id=%s"
-            params.append(user_id)
-        if open_id:
-            condition += " AND open_id=%s"
-            params.append(open_id)
-        if user_nick:
-            condition += " AND user_nick=%s"
-            params.append(user_nick)
-        if asset_object_id:
-            condition += " AND asset_object_id=%s"
-            params.append(asset_object_id)
-        if start_date:
-            condition += " AND create_date>=%s"
-            params.append(start_date)
-        if end_date:
-            condition += " AND create_date<=%s"
-            params.append(end_date)
-        if source_type:
-            if type(source_type) == str:
-                condition += " AND " + SevenHelper.get_condition_by_int_list("source_type",[int(item) for item in source_type.split(",")])
-            elif type(source_type) == list:
-                condition += " AND " + SevenHelper.get_condition_by_int_list("source_type",source_type)
-            else:
-                condition += " AND source_type=%s"
-                params.append(source_type)
-        if operate_type != -1:
-            condition += " AND operate_type=%s"
-            params.append(operate_type)
-        if source_object_id:
-            if type(source_object_id) == str:
-                condition += " AND " + SevenHelper.get_condition_by_str_list("source_object_id",source_object_id.split(","))
-            elif type(source_object_id) == list:
-                condition += " AND " + SevenHelper.get_condition_by_str_list("source_object_id",source_object_id)
-            else:
-                condition += " AND source_object_id=%s"
-                params.append(source_object_id)
-        asset_log_model = AssetLogModel(db_connect_key=self.db_connect_key,sub_table=FrameBaseModel(context=self.context).get_business_sub_table("asset_log_tb",{"app_id":app_id}),context=self.context)
-        if is_cache:
-            page_list = asset_log_model.get_cache_dict_page_list(field, page_index, page_size, condition, order_by="id desc", params=params, dependency_key=DependencyKey.asset_log_list(act_id,user_id), page_count_mode=page_count_mode)
-        else:
-            page_list = asset_log_model.get_dict_page_list(field, page_index, page_size, condition, order_by="id desc", params=params, page_count_mode=page_count_mode)
-        result = None
-        if page_count_mode in ['total','next']:
-            result = page_list[1]
-            page_list = page_list[0]
-        if len(page_list) > 0:
-            for item in page_list:
-                if item["app_id"] != app_id:
-                    if page_count_mode == 'total':
-                        return [], 0
-                    elif page_count_mode == 'next':
-                        return [], False
-                    else:
-                        return []
-                item["create_day"] = TimeHelper.format_time_to_datetime(str(item["create_date"])).strftime('%Y-%m-%d')
-                if item.__contains__("info_json"):
-                    item["info_json"] = SevenHelper.json_loads(item["info_json"]) if item["info_json"] else {}
-                    if isinstance(item["info_json"], dict):
-                        item["operate_user_id"] = item["info_json"].get("operate_user_id","")
-                        item["operate_user_name"] = item["info_json"].get("operate_user_name","")
-                    else:
-                        item["operate_user_id"] = ""
-                        item["operate_user_name"] = ""
-        if page_count_mode in ['total','next']:
-            return page_list, result
-        return page_list
-
-    def add_asset_log(self, app_id, act_id, module_id, user_id, open_id, user_nick, asset_type, asset_value, asset_object_id, source_type, source_object_id, source_object_name, log_title, history_asset_value=0, handler_name="", request_code="", info_json={}):
-        """
-        :description: 添加资产流水
-        :param act_id：活动标识
-        :param module_id：模块标识，没有填0
-        :param user_id：用户标识
-        :param open_id：open_id
-        :param user_nick：昵称
-        :param asset_type：资产类型(1-次数2-积分3-价格档位)
-        :param asset_value：变动的资产值，算好差值传入
-        :param asset_object_id：资产对象标识
-        :param source_type：来源类型（1-购买2-任务3-手动配置4-抽奖5-回购）
-        :param source_object_id：来源对象标识(比如来源类型是任务则对应任务类型)
-        :param source_object_name：来源对象名称(比如来源类型是任务则对应任务名称)
-        :param log_title：资产流水标题
-        :param history_asset_value:历史资产值
-        :param handler_name:接口名称
-        :param request_code:请求唯一标识，从seven_framework框架获取对应request_code
-        :param info_json：资产流水详情，用于存放业务方自定义字典
-        :return: 返回实体InvokeResultData
-        :last_editors: HuangJianYi
-        """
-        asset_value = int(asset_value)
-        asset_log_model = AssetLogModel(db_connect_key=self.db_connect_key,sub_table=FrameBaseModel(context=self.context).get_business_sub_table("asset_log_tb",{"app_id":app_id}),context=self.context)
-        asset_log = AssetLog()
-        asset_log.app_id = app_id
-        asset_log.act_id = act_id
-        asset_log.module_id = module_id
-        asset_log.user_id = user_id
-        asset_log.open_id = open_id
-        asset_log.user_nick = user_nick
-        asset_log.log_title = log_title
-        asset_log.info_json = info_json if info_json else {}
-        asset_log.asset_type = asset_type
-        asset_log.asset_object_id = asset_object_id
-        asset_log.source_type = source_type
-        asset_log.source_object_id = source_object_id
-        asset_log.source_object_name = source_object_name
-        asset_log.only_id = ""
-        asset_log.operate_type = 0 if asset_value > 0 else 1
-        asset_log.operate_value = asset_value
-        asset_log.history_value = history_asset_value
-        asset_log.now_value = history_asset_value + asset_value
-        asset_log.handler_name = handler_name
-        asset_log.request_code = request_code
-        asset_log.create_date = SevenHelper.get_now_datetime()
-        asset_log.create_day = SevenHelper.get_now_day_int()
-        asset_log_model.add_entity(asset_log)
-
-    def get_asset_warn_list(self, app_id, act_id,  asset_type, ascription_type=1, page_size=20, page_index=0,user_id=0,asset_object_id="", start_date="", end_date="", user_nick="", open_id="", field="*"):
-        """
-        :description: 获取资产预警记录
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param asset_type：资产类型(1-次数2-积分3-价格档位)
-        :param ascription_type：归属类型(1-预警2-拦截)
-        :param page_size：条数
-        :param page_index：页数
-        :param user_id：用户标识
-        :param asset_object_id：资产对象标识
-        :param start_date：开始时间
-        :param end_date：结束时间
-        :param user_nick：昵称
-        :param open_id：open_id
-        :param field：查询字段
-        :return: 返回PageInfo
-        :last_editors: HuangJianYi
-        """
-        page_list = []
-        total = 0
-
-        condition = "app_id=%s and act_id=%s"
-        params = [app_id, act_id]
-        if asset_type != 0:
-            condition += " AND asset_type=%s"
-            params.append(asset_type)
-        if asset_object_id:
-            condition += " AND asset_object_id=%s"
-            params.append(asset_object_id)
-        if ascription_type != 0:
-            condition += " AND ascription_type=%s"
-            params.append(ascription_type)
-        if user_id != 0:
-            condition += " AND user_id=%s"
-            params.append(user_id)
-        if open_id:
-            condition += " AND open_id=%s"
-            params.append(open_id)
-        if user_nick:
-            condition += " AND user_nick=%s"
-            params.append(user_nick)
-        if start_date:
-            condition += " AND create_date>=%s"
-            params.append(start_date)
-        if end_date:
-            condition += " AND create_date<=%s"
-            params.append(end_date)
-
-        page_list, total = AssetWarnNoticeModel(db_connect_key=self.db_connect_key,context=self.context).get_dict_page_list(field, page_index, page_size, condition, order_by="id desc", params=params)
-        return page_list, total
-
-    def update_store_asset(self, app_id,store_id, store_name, asset_type, asset_value, asset_object_id, source_type, source_object_id, source_object_name, log_title, db_connect_key='db_cloudapp', handler_name="",request_code="", info_json={}):
-        """
-        :description: 变更商家资产
-        :param app_id：应用标识
-        :param store_id：商家ID
-        :param store_name：商家名称
-        :param asset_type：资产类型(1-次数2-积分3-价格档位)
-        :param asset_value：变动的资产值，算好差值传入
-        :param asset_object_id：资产对象标识
-        :param source_type：来源类型（1-购买2-任务3-手动配置4-抽奖5-回购）
-        :param source_object_id：来源对象标识(比如来源类型是任务则对应任务类型)
-        :param source_object_name：来源对象名称(比如来源类型是任务则对应任务名称)
-        :param log_title：资产流水标题
-        :param db_connect_key：db_connect_key
-        :param handler_name:接口名称
-        :param request_code:请求唯一标识，从seven_framework框架获取对应request_code
-        :param info_json：资产流水详情，用于存放业务方自定义字典
-        :return: 返回实体InvokeResultData
-        :last_editors: HuangJianYi
-        """
-
-        invoke_result_data = InvokeResultData()
-
-        if not app_id or not asset_type or not asset_value:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "param_error"
-            invoke_result_data.error_message = "参数不能为空或等于0"
-            return invoke_result_data
-
-        if int(asset_type) == 3 and not asset_object_id:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "param_error"
-            invoke_result_data.error_message = "资产类型为价格档位,参数asset_object_id不能为空或等于0"
-            return invoke_result_data
-        asset_value = int(asset_value)
-        store_asset_id_md5 = CryptoHelper.md5_encrypt_int(f"{app_id}_{asset_type}_{asset_object_id}")
-        if store_asset_id_md5 == 0:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "修改失败"
-            return invoke_result_data
-        if not db_connect_key:
-            db_connect_key=self.db_connect_key
-        db_transaction = DbTransaction(db_config_dict=config.get_value(db_connect_key),context=self.context)
-        store_asset_model = StoreAssetModel(db_connect_key=db_connect_key, db_transaction=db_transaction, context=self.context)
-        store_asset_log_model = StoreAssetLogModel(db_connect_key=db_connect_key, db_transaction=db_transaction, context=self.context)
-
-        acquire_lock_name = f"storeasset:{store_asset_id_md5}"
-        acquire_lock_status, identifier = SevenHelper.redis_acquire_lock(acquire_lock_name)
-        if acquire_lock_status == False:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "acquire_lock"
-            invoke_result_data.error_message = "系统繁忙,请稍后再试"
-            return invoke_result_data
-
-        try:
-            now_day_int = SevenHelper.get_now_day_int()
-            now_datetime = SevenHelper.get_now_datetime()
-            old_store_asset_id = 0
-            history_asset_value = 0
-
-            store_asset = store_asset_model.get_entity("id_md5=%s",params=[store_asset_id_md5])
-            if store_asset:
-                if store_asset.asset_value + asset_value < 0:
-                    SevenHelper.redis_release_lock(acquire_lock_name, identifier)
-                    invoke_result_data.success = False
-                    invoke_result_data.error_code = "no_enough"
-                    invoke_result_data.error_message = "变更后的资产不能为负数"
-                    return invoke_result_data
-                if store_asset.asset_value + asset_value > 2147483647:
-                    SevenHelper.redis_release_lock(acquire_lock_name, identifier)
-                    invoke_result_data.success = False
-                    invoke_result_data.error_code = "no_enough"
-                    invoke_result_data.error_message = "变更后的资产不能大于整形的最大值"
-                    return invoke_result_data
-
-                old_store_asset_id = store_asset.id
-                history_asset_value = store_asset.asset_value
-            else:
-                if asset_value < 0:
-                    SevenHelper.redis_release_lock(acquire_lock_name, identifier)
-                    invoke_result_data.success = False
-                    invoke_result_data.error_code = "no_enough"
-                    invoke_result_data.error_message = "资产不能为负数"
-                    return invoke_result_data
-                store_asset = StoreAsset()
-                store_asset.id_md5 = store_asset_id_md5
-                store_asset.app_id = app_id
-                store_asset.store_id = store_id
-                store_asset.store_name = store_name
-                store_asset.asset_type = asset_type
-                store_asset.asset_object_id = asset_object_id
-                store_asset.create_date = now_datetime
-
-            store_asset.asset_value += asset_value
-            store_asset.asset_check_code = self.get_asset_check_code(store_asset_id_md5, store_asset.asset_value, app_id)
-            store_asset.modify_date = now_datetime
-
-            store_asset_log = StoreAssetLog()
-            store_asset_log.app_id = app_id
-            store_asset_log.store_id = store_id
-            store_asset_log.store_name = store_name
-            store_asset_log.log_title = log_title
-            store_asset_log.info_json = SevenHelper.json_dumps(info_json) if info_json else {}
-            store_asset_log.asset_type = asset_type
-            store_asset_log.asset_object_id = asset_object_id
-            store_asset_log.source_type = source_type
-            store_asset_log.source_object_id = source_object_id
-            store_asset_log.source_object_name = source_object_name
-            store_asset_log.operate_type = 0 if asset_value > 0 else 1
-            store_asset_log.operate_value = asset_value
-            store_asset_log.history_value = history_asset_value
-            store_asset_log.now_value = store_asset.asset_value
-            store_asset_log.handler_name = handler_name
-            store_asset_log.request_code = request_code
-            store_asset_log.create_date = now_datetime
-            store_asset_log.create_day = now_day_int
-
-            db_transaction.begin_transaction()
-
-            if old_store_asset_id != 0:
-                store_asset_model.update_entity(store_asset, "asset_value,asset_check_code,modify_date")
-            else:
-                store_asset_model.add_entity(store_asset)
-            store_asset_log_model.add_entity(store_asset_log)
-            result,message = db_transaction.commit_transaction(return_detail_tuple=True)
-            if result == False:
-                if self.context:
-                    self.context.logging_link_error("【变更商家资产】" + message)
-                elif self.logging_link_error:
-                    self.logging_link_error("【变更商家资产】" + message)
-                SevenHelper.redis_release_lock(acquire_lock_name, identifier)
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "fail"
-                invoke_result_data.error_message = "系统繁忙,请稍后再试"
-                return invoke_result_data
-            store_asset_log_model.delete_dependency_key(DependencyKey.store_asset_log_list(app_id))
-            invoke_result_data.data = {"store_asset":store_asset.__dict__}
-
-        except Exception as ex:
-            if self.context:
-                self.context.logging_link_error("【变更商家资产】" + traceback.format_exc())
-            elif self.logging_link_error:
-                self.logging_link_error("【变更商家资产】" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "exception"
-            invoke_result_data.error_message = "系统繁忙,请稍后再试"
-        finally:
-            SevenHelper.redis_release_lock(acquire_lock_name, identifier)
-
-        return invoke_result_data
-
-    def get_store_asset(self, app_id, asset_type, asset_object_id, db_connect_key='db_cloudapp'):
-        """
-        :description: 获取具体的商家资产
-        :param app_id：应用标识
-        :param asset_type：资产类型(1-次数2-积分3-价格档位)
-        :param asset_object_id：资产对象标识,没有传空
-        :param db_connect_key：db_connect_key
-        :return: 返回list
-        :last_editors: HuangJianYi
-        """
-        if not asset_type:
-            return None
-        if not db_connect_key:
-            db_connect_key=self.db_connect_key
-        store_asset_model = StoreAssetModel(db_connect_key=db_connect_key,context=self.context)
-        store_asset_id_md5 = CryptoHelper.md5_encrypt_int(f"{app_id}_{asset_type}_{asset_object_id}")
-        store_asset_dict = store_asset_model.get_dict("id_md5=%s", limit="1", params=[store_asset_id_md5])
-        if store_asset_dict:
-            if share_config.get_value("is_check_asset",True) == True: #是否开启资产校验
-                if store_asset_dict["app_id"] != str(app_id):
-                    store_asset_dict["asset_value"] = 0
-                if self.get_asset_check_code(store_asset_dict["id_md5"], store_asset_dict["asset_value"], app_id) != store_asset_dict["asset_check_code"]:
-                    store_asset_dict["asset_value"] = 0
-        return store_asset_dict
-    
-    def get_store_asset_list(self, app_ids, asset_type=0, db_connect_key='db_cloudapp'):
-        """
-        :description: 获取商家资产列表
-        :param app_ids：应用标识 多个逗号,分隔
-        :param asset_type：资产类型(1-次数2-积分3-价格档位)
-        :param db_connect_key：db_connect_key
-        :return: 返回list
-        :last_editors: HuangJianYi
-        """
-        if not app_ids:
-            return []
-        condition_where = ConditionWhere()
-        params_list = []
-        if asset_type > 0:
-            condition_where.add_condition("asset_type=%s")
-            params_list.append(asset_type)
-        if ',' in str(app_ids):
-                app_ids = app_ids.split(',')
-        if isinstance(app_ids,list):
-            condition_where.add_condition(SevenHelper.get_condition_by_str_list("app_id",app_ids))
-        else:
-            condition_where.add_condition("app_id=%s")
-            params_list.append(app_ids)
-        if not db_connect_key:
-            db_connect_key=self.db_connect_key
-        store_asset_model = StoreAssetModel(db_connect_key=db_connect_key,context=self.context)
-        store_asset_dict_list = store_asset_model.get_dict_list(condition_where.to_string(), params=params_list)
-        if len(store_asset_dict_list) > 0:
-            for store_asset_dict in store_asset_dict_list:
-                if share_config.get_value("is_check_asset",True) == True: #是否开启资产校验
-                    if self.get_asset_check_code(store_asset_dict["id_md5"], store_asset_dict["asset_value"], store_asset_dict["app_id"]) != store_asset_dict["asset_check_code"]:
-                        store_asset_dict["asset_value"] = 0
-        return store_asset_dict_list
-
-    def get_store_asset_log_list(self, app_id, asset_type, db_connect_key='db_cloudapp', page_size=20, page_index=0, store_id=0,store_name="", asset_object_id="", start_date="", end_date="", source_type=0, source_object_id=None, field="*", is_cache=True, operate_type=-1):
-        """
-        :description: 获取商家资产流水记录
-        :param app_id：应用标识
-        :param asset_type：资产类型(1-次数2-积分3-价格档位)
-        :param db_connect_key：db_connect_key
-        :param page_size：条数
-        :param page_index：页数
-        :param store_id：商家标识
-        :param store_name：商家名称
-        :param asset_object_id：资产对象标识
-        :param start_date：开始时间
-        :param end_date：结束时间
-        :param source_type：来源类型（1-购买2-任务3-手动配置4-抽奖5-回购）
-        :param source_object_id：来源对象标识(比如来源类型是任务则对应任务类型)
-        :param field：查询字段
-        :param is_cache：是否缓存
-        :param operate_type：操作类型 （0累计 1消耗）
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        page_list = []
-        total = 0
-        if asset_type <= 0:
-            return page_list,total
-
-        condition = "asset_type=%s"
-        params = [asset_type]
-
-        if store_id != 0:
-            condition += " AND store_id=%s"
-            params.append(store_id)
-        if store_name:
-            condition += " AND store_name=%s"
-            params.append(store_name)
-        if asset_object_id:
-            condition += " AND asset_object_id=%s"
-            params.append(asset_object_id)
-        if start_date:
-            condition += " AND create_date>=%s"
-            params.append(start_date)
-        if end_date:
-            condition += " AND create_date<=%s"
-            params.append(end_date)
-        if source_type != 0:
-            condition += " AND source_type=%s"
-            params.append(source_type)
-        if operate_type != -1:
-            condition += " AND operate_type=%s"
-            params.append(operate_type)
-        if source_object_id:
-            if type(source_object_id) == str:
-                condition += " AND " + SevenHelper.get_condition_by_str_list("source_object_id",source_object_id.split(","))
-            elif type(source_object_id) == list:
-                condition += " AND " + SevenHelper.get_condition_by_str_list("source_object_id",source_object_id)
-            else:
-                condition += " AND source_object_id=%s"
-                params.append(source_object_id)
-        if not db_connect_key:
-            db_connect_key=self.db_connect_key
-        store_asset_log_model = StoreAssetLogModel(db_connect_key=db_connect_key,context=self.context)
-        if is_cache:
-            page_list, total = store_asset_log_model.get_cache_dict_page_list(field, page_index, page_size, condition, order_by="id desc", params=params,dependency_key=DependencyKey.store_asset_log_list(app_id))
-        else:
-            page_list, total = store_asset_log_model.get_dict_page_list(field, page_index, page_size, condition, order_by="id desc", params=params)
-        if len(page_list) > 0:
-            for item in page_list:
-                if item["app_id"] != app_id:
-                    return [],0
-                item["create_day"] = TimeHelper.format_time_to_datetime(str(item["create_date"])).strftime('%Y-%m-%d')
-                item["info_json"] = SevenHelper.json_loads(item["info_json"]) if item["info_json"] else {}
+# -*- coding: utf-8 -*-
+"""
+:Author: HuangJianYi
+:Date: 2020-05-12 20:11:48
+@LastEditTime: 2023-05-05 19:30:39
+@LastEditors: HuangJianYi
+:description: 
+"""
+from seven_cloudapp_frame.libs.common import *
+from seven_cloudapp_frame.libs.customize.seven_helper import *
+from seven_cloudapp_frame.models.db_models.asset.asset_log_model import *
+from seven_cloudapp_frame.models.db_models.asset.asset_only_model import *
+from seven_cloudapp_frame.models.db_models.user.user_asset_model import *
+from seven_cloudapp_frame.models.db_models.asset.asset_warn_notice_model import *
+from seven_cloudapp_frame.models.db_models.store.store_asset_model import *
+from seven_cloudapp_frame.models.db_models.store.store_asset_log_model import *
+from seven_cloudapp_frame.models.seven_model import *
+from seven_cloudapp_frame.models.frame_base_model import *
+
+
+class AssetBaseModel():
+    """
+    :description: 资产管理业务模型,主要管理用户资产和商家资产
+    """
+    def __init__(self,context=None,logging_error=None,logging_info=None, db_connect_key='db_cloudapp', redis_config_dict=None):
+        self.context = context
+        self.logging_link_error = logging_error
+        self.logging_link_info = logging_info
+        self.db_connect_key = db_connect_key
+        self.redis_config_dict = redis_config_dict
+
+
+    def _delete_asset_dependency_key(self, act_id, user_id, delay_delete_time=0.01):
+        """
+        :description: 删除资产依赖建
+        :param act_id: 活动标识
+        :param user_id: 用户标识
+        :param delay_delete_time: 延迟删除时间，传0则不进行延迟
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        AssetLogModel().delete_dependency_key(DependencyKey.asset_log_list(act_id,user_id), delay_delete_time,redis_config_dict=self.redis_config_dict)
+
+    def _add_onlyid_warn_stat(self,handler_name):
+        """
+        :description: 添加唯一标识预警拦截计数
+        :param handler_name：接口名称
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        if handler_name:
+            handler_name = str(handler_name).lower()
+            redis_init = SevenHelper.redis_init(config_dict=self.redis_config_dict)
+
+            hash_name_1 = f"warn_handler_list_{str(SevenHelper.get_now_int(fmt='%Y%m%d'))}"
+            hash_key_1 = f"handlername_{handler_name}"
+            if not redis_init.hexists(hash_name_1, hash_key_1):
+                redis_init.hset(hash_name_1,hash_key_1,SevenHelper.json_dumps({"app_id":'',"handler_name":handler_name}))
+                redis_init.expire(hash_name_1, 24 * 3600)
+
+            hash_name_2 = f"{hash_name_1}:{hash_key_1}"
+            redis_init.hincrby(hash_name_2, str(SevenHelper.get_now_int(fmt='%Y%m%d%H%M')), 1)
+            redis_init.expire(hash_name_2, 24 * 3600)
+
+    def delete_asset_only(self, act_id, only_id, create_day=0, app_id=''):
+        """
+        :description: 清除资产唯一标识 从数据库和redis中删除
+        :param act_id：活动标识
+        :param only_id：资产唯一标识
+        :param create_day：整形的创建天20200506
+        :param app_id：应用标识
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        redis_init = SevenHelper.redis_init(config_dict=self.redis_config_dict)
+        hash_name = f"asset_only_list:{act_id}" if act_id > 0 else f"asset_only_list:{app_id}_0"
+        if create_day <= 0:
+            hash_name += f"_{SevenHelper.get_now_day_int()}"
+        else:
+            hash_name += f"_{create_day}"
+        if redis_init.hexists(hash_name, only_id):
+            redis_init.hdel(hash_name, only_id)
+            asset_only_model = AssetOnlyModel(db_connect_key=self.db_connect_key,context=self.context)
+            asset_only_model.del_entity("only_id=%s", params=[only_id])
+
+    def get_user_asset_id_md5(self, app_id, act_id, user_id, asset_type, asset_object_id):
+        """
+        :description: 生成用户资产唯一标识
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param user_id：用户标识
+        :param asset_type：资产类型(1-次数2-积分3-价格档位)
+        :param asset_object_id：对象标识
+        :return: 用户资产唯一标识
+        :last_editors: HuangJianYi
+        """
+        if not user_id or not asset_type:
+            return 0
+        if act_id > 0:
+            return CryptoHelper.md5_encrypt_int(f"{act_id}_{user_id}_{asset_type}_{asset_object_id}")
+        else:
+            return CryptoHelper.md5_encrypt_int(f"{app_id}_0_{user_id}_{asset_type}_{asset_object_id}")
+            
+    def get_asset_check_code(self, id_md5, asset_value, sign_key):
+        """
+        :description: 生成资产校验码
+        :param id_md5：id_md5
+        :param asset_value：当前资产值
+        :param sign_key：签名key,目前使用app_id作为签名key
+        :return: 用户资产校验码
+        :last_editors: HuangJianYi
+        """
+        if not id_md5 or not asset_value:
+            return ""
+        return CryptoHelper.md5_encrypt(f"{id_md5}_{asset_value}", sign_key)
+
+    def update_user_asset(self, app_id, act_id, module_id, user_id, open_id, user_nick, asset_type, asset_value, asset_object_id, source_type, source_object_id, source_object_name, log_title, only_id="",handler_name="",request_code="", info_json={}):
+        """
+        :description: 变更用户资产
+        :param act_id：活动标识
+        :param module_id：模块标识，没有填0
+        :param user_id：用户标识
+        :param open_id：open_id
+        :param user_nick：昵称
+        :param asset_type：资产类型(1-次数2-积分3-价格档位)
+        :param asset_value：变动的资产值，比如原本是100现在变成80，应该传入-20,原本是100现在变成120，应该传入20
+        :param asset_object_id：资产对象标识
+        :param source_type：来源类型（1-购买2-任务3-手动配置4-抽奖5-回购）
+        :param source_object_id：来源对象标识(比如来源类型是任务则对应任务类型)
+        :param source_object_name：来源对象名称(比如来源类型是任务则对应任务名称)
+        :param log_title：资产流水标题
+        :param only_id:唯一标识(用于并发操作时校验避免重复操作)由业务方定义传入
+        :param handler_name:接口名称
+        :param request_code:请求唯一标识，从seven_framework框架获取对应request_code
+        :param info_json：资产流水详情，用于存放业务方自定义字典
+        :return: 返回实体InvokeResultData
+        :last_editors: HuangJianYi
+        """
+
+        invoke_result_data = InvokeResultData()
+
+        if not user_id or not asset_type or not asset_value:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "param_error"
+            invoke_result_data.error_message = "参数不能为空或等于0"
+            return invoke_result_data
+
+        if int(asset_type) == 3 and not asset_object_id:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "param_error"
+            invoke_result_data.error_message = "资产类型为价格档位,参数asset_object_id不能为空或等于0"
+            return invoke_result_data
+        asset_value = int(asset_value)
+        user_asset_id_md5 = self.get_user_asset_id_md5(app_id, act_id, user_id, asset_type, asset_object_id)
+        if user_asset_id_md5 == 0:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "修改失败"
+            return invoke_result_data
+        #如果only_id已经存在，直接在redis进行拦截,减少数据库的请求，时限1天
+        redis_init = SevenHelper.redis_init(config_dict=self.redis_config_dict)
+        is_asset_warn = share_config.get_value("is_asset_warn",False) #是否开启资产预警，跟控制台配套使用
+        only_cache_key = ""
+        if only_id:
+            only_cache_key = f"asset_only_list:{act_id}_{SevenHelper.get_now_day_int()}"  if act_id > 0 else f"asset_only_list:{app_id}_0_{SevenHelper.get_now_day_int()}"
+            if redis_init.hexists(only_cache_key, only_id):
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "error"
+                invoke_result_data.error_message = "only_id已经存在"
+                
+                if is_asset_warn == True:
+                    asset_warn_notice = AssetWarnNotice()
+                    asset_warn_notice.app_id = app_id
+                    asset_warn_notice.act_id = act_id
+                    asset_warn_notice.ascription_type = 2
+                    asset_warn_notice.handler_name = handler_name
+                    asset_warn_notice.request_code = request_code
+                    asset_warn_notice.user_id = user_id
+                    asset_warn_notice.open_id = open_id
+                    asset_warn_notice.user_nick = user_nick
+                    asset_warn_notice.asset_type =asset_type
+                    asset_warn_notice.asset_object_id = asset_object_id
+                    asset_warn_notice.log_title = source_object_name if source_object_name else log_title
+                    if source_type == 1:
+                        asset_warn_notice.info_desc = f"重复请求{asset_warn_notice.log_title}【订单号：{only_id}】"
+                    else:
+                        asset_warn_notice.info_desc = f"重复请求{asset_warn_notice.log_title}"
+                    asset_warn_notice.info_json = {"asset_value":asset_value}
+                    asset_warn_notice.create_date = SevenHelper.get_now_datetime()
+                    asset_warn_notice.create_day = SevenHelper.get_now_day_int()
+                    redis_init.rpush("asset_intercept_queue_list",SevenHelper.json_dumps(asset_warn_notice))
+                    redis_init.expire("asset_intercept_queue_list", 7 * 24 * 3600)
+                    #添加唯一标识预警拦截计数,用于控制台跑数据进行并发预警
+                    self._add_onlyid_warn_stat(handler_name)
+                
+                return invoke_result_data
+        db_transaction = DbTransaction(db_config_dict=config.get_value(self.db_connect_key),context=self.context)
+        frame_base_model = FrameBaseModel(context=self.context)
+        user_asset_model = UserAssetModel(db_connect_key=self.db_connect_key,sub_table=frame_base_model.get_business_sub_table("user_asset_tb",{"app_id":app_id}),db_transaction=db_transaction, context=self.context)
+        asset_log_model = AssetLogModel(db_connect_key=self.db_connect_key,sub_table=frame_base_model.get_business_sub_table("asset_log_tb",{"app_id":app_id}),db_transaction=db_transaction, context=self.context)
+        asset_only_model = AssetOnlyModel(db_connect_key=self.db_connect_key,db_transaction=db_transaction, context=self.context)
+
+        acquire_lock_name = f"userasset:{user_asset_id_md5}"
+        acquire_lock_status, identifier = SevenHelper.redis_acquire_lock(acquire_lock_name)
+        if acquire_lock_status == False:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "acquire_lock"
+            invoke_result_data.error_message = "系统繁忙,请稍后再试"
+            return invoke_result_data
+
+        try:
+            now_day_int = SevenHelper.get_now_day_int()
+            now_datetime = SevenHelper.get_now_datetime()
+            old_user_asset_id = 0
+            history_asset_value = 0
+
+            user_asset = user_asset_model.get_entity("id_md5=%s",params=[user_asset_id_md5])
+            if user_asset:
+                if user_asset.asset_value + asset_value < 0:
+                    SevenHelper.redis_release_lock(acquire_lock_name, identifier)
+                    invoke_result_data.success = False
+                    invoke_result_data.error_code = "no_enough"
+                    invoke_result_data.error_message = "变更后的资产不能为负数"
+                    return invoke_result_data
+                if user_asset.asset_value + asset_value > 2147483647:
+                    SevenHelper.redis_release_lock(acquire_lock_name, identifier)
+                    invoke_result_data.success = False
+                    invoke_result_data.error_code = "no_enough"
+                    invoke_result_data.error_message = "变更后的资产不能大于整形的最大值"
+                    return invoke_result_data
+
+                old_user_asset_id = user_asset.id
+                history_asset_value = user_asset.asset_value
+            else:
+                if asset_value < 0:
+                    SevenHelper.redis_release_lock(acquire_lock_name, identifier)
+                    invoke_result_data.success = False
+                    invoke_result_data.error_code = "no_enough"
+                    invoke_result_data.error_message = "资产不能为负数"
+                    return invoke_result_data
+                user_asset = UserAsset()
+                user_asset.id_md5 = user_asset_id_md5
+                user_asset.app_id = app_id
+                user_asset.act_id = act_id
+                user_asset.user_id = user_id
+                user_asset.open_id = open_id
+                user_asset.user_nick = user_nick
+                user_asset.asset_type = asset_type
+                user_asset.asset_object_id = asset_object_id
+                user_asset.create_date = now_datetime
+
+            user_asset.asset_value += asset_value
+            user_asset.asset_check_code = self.get_asset_check_code(user_asset_id_md5, user_asset.asset_value, app_id)
+            user_asset.modify_date = now_datetime
+
+            asset_log = AssetLog()
+            asset_log.app_id = app_id
+            asset_log.act_id = act_id
+            asset_log.module_id = module_id
+            asset_log.user_id = user_id
+            asset_log.open_id = open_id
+            asset_log.user_nick = user_nick
+            asset_log.log_title = log_title
+            asset_log.info_json = SevenHelper.json_dumps(info_json) if info_json else {}
+            asset_log.asset_type = asset_type
+            asset_log.asset_object_id = asset_object_id
+            asset_log.source_type = source_type
+            asset_log.source_object_id = source_object_id
+            asset_log.source_object_name = source_object_name
+            asset_log.only_id = only_id
+            asset_log.operate_type = 0 if asset_value > 0 else 1
+            asset_log.operate_value = asset_value
+            asset_log.history_value = history_asset_value
+            asset_log.now_value = user_asset.asset_value
+            asset_log.handler_name = handler_name
+            asset_log.request_code = request_code
+            asset_log.create_date = now_datetime
+            asset_log.create_day = now_day_int
+
+            if only_id:
+                asset_only = AssetOnly()
+                if act_id > 0:
+                    asset_only.id_md5 = CryptoHelper.md5_encrypt_int(f"{act_id}_{user_id}_{only_id}")
+                else:
+                    asset_only.id_md5 = CryptoHelper.md5_encrypt_int(f"{app_id}_0_{user_id}_{only_id}")
+
+                asset_only.app_id = app_id
+                asset_only.act_id = act_id
+                asset_only.user_id = user_id
+                asset_only.open_id = open_id
+                asset_only.only_id = only_id
+                asset_only.create_date = now_datetime
+
+            db_transaction.begin_transaction()
+
+            if old_user_asset_id != 0:
+                user_asset_model.update_entity(user_asset, "asset_value,asset_check_code,modify_date")
+            else:
+                user_asset_model.add_entity(user_asset)
+            if only_id:
+                asset_only_model.add_entity(asset_only)
+            asset_log_model.add_entity(asset_log)
+
+            result,message = db_transaction.commit_transaction(return_detail_tuple=True)
+            if result == False:
+                if only_id and is_asset_warn == True:
+                    #添加唯一标识预警拦截计数,用于控制台跑数据进行并发预警
+                    self._add_onlyid_warn_stat(handler_name)
+                if self.context:
+                    self.context.logging_link_error("【变更资产】" + message)
+                elif self.logging_link_error:
+                    self.logging_link_error("【变更资产】" + message)
+                SevenHelper.redis_release_lock(acquire_lock_name, identifier)
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "fail"
+                invoke_result_data.error_message = "系统繁忙,请稍后再试"
+                return invoke_result_data
+            try:
+                if only_id:
+                    redis_init.hset(only_cache_key, only_id, 1)
+                    redis_init.expire(only_cache_key, 24 * 3600)
+                self._delete_asset_dependency_key(act_id,user_id)
+                
+                if is_asset_warn == True:
+                    asset_queue = {}
+                    asset_queue["app_id"] = app_id
+                    asset_queue["act_id"] = act_id
+                    asset_queue["open_id"] = open_id
+                    asset_queue["user_nick"] = user_nick
+                    asset_queue["user_id"] = user_id
+                    asset_queue["asset_type"] = asset_type
+                    asset_queue["asset_object_id"] = asset_object_id
+                    asset_queue["now_value"] = user_asset.asset_value
+                    asset_queue["operate_value"] = asset_value
+                    asset_queue["history_asset_value"] = history_asset_value
+                    asset_queue["now_day_int"] = now_day_int
+                    asset_queue["create_date"] = now_datetime
+                    redis_init.rpush(f"asset_queue_list",SevenHelper.json_dumps(asset_queue))
+                    redis_init.expire(f"asset_queue_list", 7 * 24 * 3600)
+            except Exception as ex:
+                if self.context:
+                    self.context.logging_link_error("【资产队列】" + traceback.format_exc())
+                elif self.logging_link_error:
+                    self.logging_link_error("【资产队列】" + traceback.format_exc())
+            
+            invoke_result_data.data = {"user_asset":user_asset.__dict__}
+
+        except Exception as ex:
+            if self.context:
+                self.context.logging_link_error("【变更资产】" + traceback.format_exc())
+            elif self.logging_link_error:
+                self.logging_link_error("【变更资产】" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "exception"
+            invoke_result_data.error_message = "系统繁忙,请稍后再试"
+        finally:
+            SevenHelper.redis_release_lock(acquire_lock_name, identifier)
+
+        return invoke_result_data
+
+    def get_user_asset_list(self, app_id, act_id, user_ids, asset_type=0):
+        """
+        :description: 获取用户资产列表
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param user_ids：用户标识 多个逗号,分隔
+        :param asset_type：资产类型(1-次数2-积分3-价格档位)
+        :return: 返回list
+        :last_editors: HuangJianYi
+        """
+        if not user_ids:
+            return []
+        condition = "app_id=%s and act_id=%s"
+        params = [app_id, act_id]
+        if asset_type > 0:
+            condition+= " AND asset_type=%s"
+            params.append(asset_type)
+        if user_ids:
+            if isinstance(user_ids,str):
+                condition += f" AND user_id in ({user_ids})"
+            elif isinstance(user_ids,list):
+                condition+=" AND " + SevenHelper.get_condition_by_int_list("user_id",user_ids)
+            else:
+                condition += " AND user_id=%s"
+                params.append(user_ids)
+        user_asset_model = UserAssetModel(db_connect_key=self.db_connect_key,sub_table=FrameBaseModel(context=self.context).get_business_sub_table("user_asset_tb",{"app_id":app_id}),context=self.context)
+        user_asset_dict_list = user_asset_model.get_dict_list(condition, params=params)
+        if len(user_asset_dict_list) > 0:
+            for user_asset_dict in user_asset_dict_list:
+                if share_config.get_value("is_check_asset",True) == True: #是否开启资产校验
+                    if user_asset_dict["app_id"] != str(app_id):
+                        user_asset_dict["asset_value"] = 0
+                    if self.get_asset_check_code(user_asset_dict["id_md5"], user_asset_dict["asset_value"], app_id) != user_asset_dict["asset_check_code"]:
+                        user_asset_dict["asset_value"] = 0
+        return user_asset_dict_list
+
+    def get_user_asset(self, app_id, act_id, user_id, asset_type, asset_object_id=""):
+        """
+        :description: 获取具体的用户资产
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param user_id：用户标识
+        :param asset_type：资产类型(1-次数2-积分3-价格档位)
+        :param asset_object_id：资产对象标识,没有传空
+        :return: 返回单条字典
+        :last_editors: HuangJianYi
+        """
+        if not user_id or not asset_type:
+            return None
+        user_asset_model = UserAssetModel(db_connect_key=self.db_connect_key,sub_table=FrameBaseModel(context=self.context).get_business_sub_table("user_asset_tb",{"app_id":app_id}),context=self.context)
+        user_asset_id_md5 = self.get_user_asset_id_md5(app_id, act_id, user_id, asset_type, asset_object_id)
+        user_asset_dict = user_asset_model.get_dict("id_md5=%s", limit="1", params=[user_asset_id_md5])
+        if user_asset_dict:
+            if share_config.get_value("is_check_asset",True) == True: #是否开启资产校验
+                if user_asset_dict["app_id"] != str(app_id):
+                    user_asset_dict["asset_value"] = 0
+                if self.get_asset_check_code(user_asset_dict["id_md5"], user_asset_dict["asset_value"], app_id) != user_asset_dict["asset_check_code"]:
+                    user_asset_dict["asset_value"] = 0
+        return user_asset_dict
+
+    def get_asset_log_list(self, app_id, act_id, asset_type=0, page_size=20, page_index=0, user_id=0, asset_object_id="", start_date="", end_date="", user_nick="", open_id="", source_type=0, source_object_id=None, field="*", is_cache=True, operate_type=-1, page_count_mode="total", module_id=0):
+        """
+        :description: 获取用户资产流水记录
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param asset_type：资产类型(1-次数2-积分3-价格档位)
+        :param page_size：条数
+        :param page_index：页数
+        :param user_id：用户标识
+        :param asset_object_id：资产对象标识
+        :param start_date：开始时间
+        :param end_date：结束时间
+        :param user_nick：昵称
+        :param open_id：open_id
+        :param source_type：来源类型（1-购买2-任务3-手动配置4-抽奖5-回购）
+        :param source_object_id：来源对象标识(比如来源类型是任务则对应任务类型)
+        :param field：查询字段
+        :param is_cache：是否缓存
+        :param operate_type：操作类型 （0累计 1消耗）
+        :param page_count_mode: 分页计数模式 total-计算总数(默认) next-计算是否有下一页(bool) none-不计算
+        :param module_id: 模块标识
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        page_list = []
+
+        condition = "app_id=%s and act_id=%s"
+        params = [app_id, act_id]
+        if module_id != 0:
+            condition += " AND module_id=%s"
+            params.append(module_id)
+        if asset_type != 0:
+            condition += " AND asset_type=%s"
+            params.append(asset_type)
+        if user_id != 0:
+            condition += " AND user_id=%s"
+            params.append(user_id)
+        if open_id:
+            condition += " AND open_id=%s"
+            params.append(open_id)
+        if user_nick:
+            condition += " AND user_nick=%s"
+            params.append(user_nick)
+        if asset_object_id:
+            condition += " AND asset_object_id=%s"
+            params.append(asset_object_id)
+        if start_date:
+            condition += " AND create_date>=%s"
+            params.append(start_date)
+        if end_date:
+            condition += " AND create_date<=%s"
+            params.append(end_date)
+        if source_type:
+            if type(source_type) == str:
+                condition += " AND " + SevenHelper.get_condition_by_int_list("source_type",[int(item) for item in source_type.split(",")])
+            elif type(source_type) == list:
+                condition += " AND " + SevenHelper.get_condition_by_int_list("source_type",source_type)
+            else:
+                condition += " AND source_type=%s"
+                params.append(source_type)
+        if operate_type != -1:
+            condition += " AND operate_type=%s"
+            params.append(operate_type)
+        if source_object_id:
+            if type(source_object_id) == str:
+                condition += " AND " + SevenHelper.get_condition_by_str_list("source_object_id",source_object_id.split(","))
+            elif type(source_object_id) == list:
+                condition += " AND " + SevenHelper.get_condition_by_str_list("source_object_id",source_object_id)
+            else:
+                condition += " AND source_object_id=%s"
+                params.append(source_object_id)
+        asset_log_model = AssetLogModel(db_connect_key=self.db_connect_key,sub_table=FrameBaseModel(context=self.context).get_business_sub_table("asset_log_tb",{"app_id":app_id}),context=self.context)
+        if is_cache:
+            page_list = asset_log_model.get_cache_dict_page_list(field, page_index, page_size, condition, order_by="id desc", params=params, dependency_key=DependencyKey.asset_log_list(act_id,user_id), page_count_mode=page_count_mode)
+        else:
+            page_list = asset_log_model.get_dict_page_list(field, page_index, page_size, condition, order_by="id desc", params=params, page_count_mode=page_count_mode)
+        result = None
+        if page_count_mode in ['total','next']:
+            result = page_list[1]
+            page_list = page_list[0]
+        if len(page_list) > 0:
+            for item in page_list:
+                if item["app_id"] != app_id:
+                    if page_count_mode == 'total':
+                        return [], 0
+                    elif page_count_mode == 'next':
+                        return [], False
+                    else:
+                        return []
+                item["create_day"] = TimeHelper.format_time_to_datetime(str(item["create_date"])).strftime('%Y-%m-%d')
+                if item.__contains__("info_json"):
+                    item["info_json"] = SevenHelper.json_loads(item["info_json"]) if item["info_json"] else {}
+                    if isinstance(item["info_json"], dict):
+                        item["operate_user_id"] = item["info_json"].get("operate_user_id","")
+                        item["operate_user_name"] = item["info_json"].get("operate_user_name","")
+                    else:
+                        item["operate_user_id"] = ""
+                        item["operate_user_name"] = ""
+        if page_count_mode in ['total','next']:
+            return page_list, result
+        return page_list
+
+    def add_asset_log(self, app_id, act_id, module_id, user_id, open_id, user_nick, asset_type, asset_value, asset_object_id, source_type, source_object_id, source_object_name, log_title, history_asset_value=0, handler_name="", request_code="", info_json={}):
+        """
+        :description: 添加资产流水
+        :param act_id：活动标识
+        :param module_id：模块标识，没有填0
+        :param user_id：用户标识
+        :param open_id：open_id
+        :param user_nick：昵称
+        :param asset_type：资产类型(1-次数2-积分3-价格档位)
+        :param asset_value：变动的资产值，算好差值传入
+        :param asset_object_id：资产对象标识
+        :param source_type：来源类型（1-购买2-任务3-手动配置4-抽奖5-回购）
+        :param source_object_id：来源对象标识(比如来源类型是任务则对应任务类型)
+        :param source_object_name：来源对象名称(比如来源类型是任务则对应任务名称)
+        :param log_title：资产流水标题
+        :param history_asset_value:历史资产值
+        :param handler_name:接口名称
+        :param request_code:请求唯一标识，从seven_framework框架获取对应request_code
+        :param info_json：资产流水详情，用于存放业务方自定义字典
+        :return: 返回实体InvokeResultData
+        :last_editors: HuangJianYi
+        """
+        asset_value = int(asset_value)
+        asset_log_model = AssetLogModel(db_connect_key=self.db_connect_key,sub_table=FrameBaseModel(context=self.context).get_business_sub_table("asset_log_tb",{"app_id":app_id}),context=self.context)
+        asset_log = AssetLog()
+        asset_log.app_id = app_id
+        asset_log.act_id = act_id
+        asset_log.module_id = module_id
+        asset_log.user_id = user_id
+        asset_log.open_id = open_id
+        asset_log.user_nick = user_nick
+        asset_log.log_title = log_title
+        asset_log.info_json = info_json if info_json else {}
+        asset_log.asset_type = asset_type
+        asset_log.asset_object_id = asset_object_id
+        asset_log.source_type = source_type
+        asset_log.source_object_id = source_object_id
+        asset_log.source_object_name = source_object_name
+        asset_log.only_id = ""
+        asset_log.operate_type = 0 if asset_value > 0 else 1
+        asset_log.operate_value = asset_value
+        asset_log.history_value = history_asset_value
+        asset_log.now_value = history_asset_value + asset_value
+        asset_log.handler_name = handler_name
+        asset_log.request_code = request_code
+        asset_log.create_date = SevenHelper.get_now_datetime()
+        asset_log.create_day = SevenHelper.get_now_day_int()
+        asset_log_model.add_entity(asset_log)
+
+    def get_asset_warn_list(self, app_id, act_id,  asset_type, ascription_type=1, page_size=20, page_index=0,user_id=0,asset_object_id="", start_date="", end_date="", user_nick="", open_id="", field="*"):
+        """
+        :description: 获取资产预警记录
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param asset_type：资产类型(1-次数2-积分3-价格档位)
+        :param ascription_type：归属类型(1-预警2-拦截)
+        :param page_size：条数
+        :param page_index：页数
+        :param user_id：用户标识
+        :param asset_object_id：资产对象标识
+        :param start_date：开始时间
+        :param end_date：结束时间
+        :param user_nick：昵称
+        :param open_id：open_id
+        :param field：查询字段
+        :return: 返回PageInfo
+        :last_editors: HuangJianYi
+        """
+        page_list = []
+        total = 0
+
+        condition = "app_id=%s and act_id=%s"
+        params = [app_id, act_id]
+        if asset_type != 0:
+            condition += " AND asset_type=%s"
+            params.append(asset_type)
+        if asset_object_id:
+            condition += " AND asset_object_id=%s"
+            params.append(asset_object_id)
+        if ascription_type != 0:
+            condition += " AND ascription_type=%s"
+            params.append(ascription_type)
+        if user_id != 0:
+            condition += " AND user_id=%s"
+            params.append(user_id)
+        if open_id:
+            condition += " AND open_id=%s"
+            params.append(open_id)
+        if user_nick:
+            condition += " AND user_nick=%s"
+            params.append(user_nick)
+        if start_date:
+            condition += " AND create_date>=%s"
+            params.append(start_date)
+        if end_date:
+            condition += " AND create_date<=%s"
+            params.append(end_date)
+
+        page_list, total = AssetWarnNoticeModel(db_connect_key=self.db_connect_key,context=self.context).get_dict_page_list(field, page_index, page_size, condition, order_by="id desc", params=params)
+        return page_list, total
+
+    def update_store_asset(self, app_id,store_id, store_name, asset_type, asset_value, asset_object_id, source_type, source_object_id, source_object_name, log_title, db_connect_key='db_cloudapp', handler_name="",request_code="", info_json={}):
+        """
+        :description: 变更商家资产
+        :param app_id：应用标识
+        :param store_id：商家ID
+        :param store_name：商家名称
+        :param asset_type：资产类型(1-次数2-积分3-价格档位)
+        :param asset_value：变动的资产值，算好差值传入
+        :param asset_object_id：资产对象标识
+        :param source_type：来源类型（1-购买2-任务3-手动配置4-抽奖5-回购）
+        :param source_object_id：来源对象标识(比如来源类型是任务则对应任务类型)
+        :param source_object_name：来源对象名称(比如来源类型是任务则对应任务名称)
+        :param log_title：资产流水标题
+        :param db_connect_key：db_connect_key
+        :param handler_name:接口名称
+        :param request_code:请求唯一标识，从seven_framework框架获取对应request_code
+        :param info_json：资产流水详情，用于存放业务方自定义字典
+        :return: 返回实体InvokeResultData
+        :last_editors: HuangJianYi
+        """
+
+        invoke_result_data = InvokeResultData()
+
+        if not app_id or not asset_type or not asset_value:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "param_error"
+            invoke_result_data.error_message = "参数不能为空或等于0"
+            return invoke_result_data
+
+        if int(asset_type) == 3 and not asset_object_id:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "param_error"
+            invoke_result_data.error_message = "资产类型为价格档位,参数asset_object_id不能为空或等于0"
+            return invoke_result_data
+        asset_value = int(asset_value)
+        store_asset_id_md5 = CryptoHelper.md5_encrypt_int(f"{app_id}_{asset_type}_{asset_object_id}")
+        if store_asset_id_md5 == 0:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "修改失败"
+            return invoke_result_data
+        if not db_connect_key:
+            db_connect_key=self.db_connect_key
+        db_transaction = DbTransaction(db_config_dict=config.get_value(db_connect_key),context=self.context)
+        store_asset_model = StoreAssetModel(db_connect_key=db_connect_key, db_transaction=db_transaction, context=self.context)
+        store_asset_log_model = StoreAssetLogModel(db_connect_key=db_connect_key, db_transaction=db_transaction, context=self.context)
+
+        acquire_lock_name = f"storeasset:{store_asset_id_md5}"
+        acquire_lock_status, identifier = SevenHelper.redis_acquire_lock(acquire_lock_name)
+        if acquire_lock_status == False:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "acquire_lock"
+            invoke_result_data.error_message = "系统繁忙,请稍后再试"
+            return invoke_result_data
+
+        try:
+            now_day_int = SevenHelper.get_now_day_int()
+            now_datetime = SevenHelper.get_now_datetime()
+            old_store_asset_id = 0
+            history_asset_value = 0
+
+            store_asset = store_asset_model.get_entity("id_md5=%s",params=[store_asset_id_md5])
+            if store_asset:
+                if store_asset.asset_value + asset_value < 0:
+                    SevenHelper.redis_release_lock(acquire_lock_name, identifier)
+                    invoke_result_data.success = False
+                    invoke_result_data.error_code = "no_enough"
+                    invoke_result_data.error_message = "变更后的资产不能为负数"
+                    return invoke_result_data
+                if store_asset.asset_value + asset_value > 2147483647:
+                    SevenHelper.redis_release_lock(acquire_lock_name, identifier)
+                    invoke_result_data.success = False
+                    invoke_result_data.error_code = "no_enough"
+                    invoke_result_data.error_message = "变更后的资产不能大于整形的最大值"
+                    return invoke_result_data
+
+                old_store_asset_id = store_asset.id
+                history_asset_value = store_asset.asset_value
+            else:
+                if asset_value < 0:
+                    SevenHelper.redis_release_lock(acquire_lock_name, identifier)
+                    invoke_result_data.success = False
+                    invoke_result_data.error_code = "no_enough"
+                    invoke_result_data.error_message = "资产不能为负数"
+                    return invoke_result_data
+                store_asset = StoreAsset()
+                store_asset.id_md5 = store_asset_id_md5
+                store_asset.app_id = app_id
+                store_asset.store_id = store_id
+                store_asset.store_name = store_name
+                store_asset.asset_type = asset_type
+                store_asset.asset_object_id = asset_object_id
+                store_asset.create_date = now_datetime
+
+            store_asset.asset_value += asset_value
+            store_asset.asset_check_code = self.get_asset_check_code(store_asset_id_md5, store_asset.asset_value, app_id)
+            store_asset.modify_date = now_datetime
+
+            store_asset_log = StoreAssetLog()
+            store_asset_log.app_id = app_id
+            store_asset_log.store_id = store_id
+            store_asset_log.store_name = store_name
+            store_asset_log.log_title = log_title
+            store_asset_log.info_json = SevenHelper.json_dumps(info_json) if info_json else {}
+            store_asset_log.asset_type = asset_type
+            store_asset_log.asset_object_id = asset_object_id
+            store_asset_log.source_type = source_type
+            store_asset_log.source_object_id = source_object_id
+            store_asset_log.source_object_name = source_object_name
+            store_asset_log.operate_type = 0 if asset_value > 0 else 1
+            store_asset_log.operate_value = asset_value
+            store_asset_log.history_value = history_asset_value
+            store_asset_log.now_value = store_asset.asset_value
+            store_asset_log.handler_name = handler_name
+            store_asset_log.request_code = request_code
+            store_asset_log.create_date = now_datetime
+            store_asset_log.create_day = now_day_int
+
+            db_transaction.begin_transaction()
+
+            if old_store_asset_id != 0:
+                store_asset_model.update_entity(store_asset, "asset_value,asset_check_code,modify_date")
+            else:
+                store_asset_model.add_entity(store_asset)
+            store_asset_log_model.add_entity(store_asset_log)
+            result,message = db_transaction.commit_transaction(return_detail_tuple=True)
+            if result == False:
+                if self.context:
+                    self.context.logging_link_error("【变更商家资产】" + message)
+                elif self.logging_link_error:
+                    self.logging_link_error("【变更商家资产】" + message)
+                SevenHelper.redis_release_lock(acquire_lock_name, identifier)
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "fail"
+                invoke_result_data.error_message = "系统繁忙,请稍后再试"
+                return invoke_result_data
+            store_asset_log_model.delete_dependency_key(DependencyKey.store_asset_log_list(app_id))
+            invoke_result_data.data = {"store_asset":store_asset.__dict__}
+
+        except Exception as ex:
+            if self.context:
+                self.context.logging_link_error("【变更商家资产】" + traceback.format_exc())
+            elif self.logging_link_error:
+                self.logging_link_error("【变更商家资产】" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "exception"
+            invoke_result_data.error_message = "系统繁忙,请稍后再试"
+        finally:
+            SevenHelper.redis_release_lock(acquire_lock_name, identifier)
+
+        return invoke_result_data
+
+    def get_store_asset(self, app_id, asset_type, asset_object_id, db_connect_key='db_cloudapp'):
+        """
+        :description: 获取具体的商家资产
+        :param app_id：应用标识
+        :param asset_type：资产类型(1-次数2-积分3-价格档位)
+        :param asset_object_id：资产对象标识,没有传空
+        :param db_connect_key：db_connect_key
+        :return: 返回list
+        :last_editors: HuangJianYi
+        """
+        if not asset_type:
+            return None
+        if not db_connect_key:
+            db_connect_key=self.db_connect_key
+        store_asset_model = StoreAssetModel(db_connect_key=db_connect_key,context=self.context)
+        store_asset_id_md5 = CryptoHelper.md5_encrypt_int(f"{app_id}_{asset_type}_{asset_object_id}")
+        store_asset_dict = store_asset_model.get_dict("id_md5=%s", limit="1", params=[store_asset_id_md5])
+        if store_asset_dict:
+            if share_config.get_value("is_check_asset",True) == True: #是否开启资产校验
+                if store_asset_dict["app_id"] != str(app_id):
+                    store_asset_dict["asset_value"] = 0
+                if self.get_asset_check_code(store_asset_dict["id_md5"], store_asset_dict["asset_value"], app_id) != store_asset_dict["asset_check_code"]:
+                    store_asset_dict["asset_value"] = 0
+        return store_asset_dict
+    
+    def get_store_asset_list(self, app_ids, asset_type=0, db_connect_key='db_cloudapp'):
+        """
+        :description: 获取商家资产列表
+        :param app_ids：应用标识 多个逗号,分隔
+        :param asset_type：资产类型(1-次数2-积分3-价格档位)
+        :param db_connect_key：db_connect_key
+        :return: 返回list
+        :last_editors: HuangJianYi
+        """
+        if not app_ids:
+            return []
+        condition_where = ConditionWhere()
+        params_list = []
+        if asset_type > 0:
+            condition_where.add_condition("asset_type=%s")
+            params_list.append(asset_type)
+        if ',' in str(app_ids):
+                app_ids = app_ids.split(',')
+        if isinstance(app_ids,list):
+            condition_where.add_condition(SevenHelper.get_condition_by_str_list("app_id",app_ids))
+        else:
+            condition_where.add_condition("app_id=%s")
+            params_list.append(app_ids)
+        if not db_connect_key:
+            db_connect_key=self.db_connect_key
+        store_asset_model = StoreAssetModel(db_connect_key=db_connect_key,context=self.context)
+        store_asset_dict_list = store_asset_model.get_dict_list(condition_where.to_string(), params=params_list)
+        if len(store_asset_dict_list) > 0:
+            for store_asset_dict in store_asset_dict_list:
+                if share_config.get_value("is_check_asset",True) == True: #是否开启资产校验
+                    if self.get_asset_check_code(store_asset_dict["id_md5"], store_asset_dict["asset_value"], store_asset_dict["app_id"]) != store_asset_dict["asset_check_code"]:
+                        store_asset_dict["asset_value"] = 0
+        return store_asset_dict_list
+
+    def get_store_asset_log_list(self, app_id, asset_type, db_connect_key='db_cloudapp', page_size=20, page_index=0, store_id=0,store_name="", asset_object_id="", start_date="", end_date="", source_type=0, source_object_id=None, field="*", is_cache=True, operate_type=-1):
+        """
+        :description: 获取商家资产流水记录
+        :param app_id：应用标识
+        :param asset_type：资产类型(1-次数2-积分3-价格档位)
+        :param db_connect_key：db_connect_key
+        :param page_size：条数
+        :param page_index：页数
+        :param store_id：商家标识
+        :param store_name：商家名称
+        :param asset_object_id：资产对象标识
+        :param start_date：开始时间
+        :param end_date：结束时间
+        :param source_type：来源类型（1-购买2-任务3-手动配置4-抽奖5-回购）
+        :param source_object_id：来源对象标识(比如来源类型是任务则对应任务类型)
+        :param field：查询字段
+        :param is_cache：是否缓存
+        :param operate_type：操作类型 （0累计 1消耗）
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        page_list = []
+        total = 0
+        if asset_type <= 0:
+            return page_list,total
+
+        condition = "asset_type=%s"
+        params = [asset_type]
+
+        if store_id != 0:
+            condition += " AND store_id=%s"
+            params.append(store_id)
+        if store_name:
+            condition += " AND store_name=%s"
+            params.append(store_name)
+        if asset_object_id:
+            condition += " AND asset_object_id=%s"
+            params.append(asset_object_id)
+        if start_date:
+            condition += " AND create_date>=%s"
+            params.append(start_date)
+        if end_date:
+            condition += " AND create_date<=%s"
+            params.append(end_date)
+        if source_type != 0:
+            condition += " AND source_type=%s"
+            params.append(source_type)
+        if operate_type != -1:
+            condition += " AND operate_type=%s"
+            params.append(operate_type)
+        if source_object_id:
+            if type(source_object_id) == str:
+                condition += " AND " + SevenHelper.get_condition_by_str_list("source_object_id",source_object_id.split(","))
+            elif type(source_object_id) == list:
+                condition += " AND " + SevenHelper.get_condition_by_str_list("source_object_id",source_object_id)
+            else:
+                condition += " AND source_object_id=%s"
+                params.append(source_object_id)
+        if not db_connect_key:
+            db_connect_key=self.db_connect_key
+        store_asset_log_model = StoreAssetLogModel(db_connect_key=db_connect_key,context=self.context)
+        if is_cache:
+            page_list, total = store_asset_log_model.get_cache_dict_page_list(field, page_index, page_size, condition, order_by="id desc", params=params,dependency_key=DependencyKey.store_asset_log_list(app_id))
+        else:
+            page_list, total = store_asset_log_model.get_dict_page_list(field, page_index, page_size, condition, order_by="id desc", params=params)
+        if len(page_list) > 0:
+            for item in page_list:
+                if item["app_id"] != app_id:
+                    return [],0
+                item["create_day"] = TimeHelper.format_time_to_datetime(str(item["create_date"])).strftime('%Y-%m-%d')
+                item["info_json"] = SevenHelper.json_loads(item["info_json"]) if item["info_json"] else {}
         return page_list,total
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/cache_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/cache_model.py`

 * *Ordering differences only*

 * *Files 13% similar despite different names*

```diff
@@ -1,624 +1,624 @@
-# -*- coding: utf-8 -*-
-"""
-:Author: HuangJianYi
-:Date: 2020-03-06 23:17:54
-@LastEditTime: 2023-07-13 16:11:57
-@LastEditors: HuangJianYi
-:Description: 数据缓存业务模型
-"""
-import json
-from copy import deepcopy
-from seven_framework.base_model import *
-from seven_framework import *
-from seven_framework.redis import *
-from seven_cloudapp_frame.libs.common import *
-
-class CacheModel(BaseModel):
-
-    def __init__(self, model_class, sub_table):
-        """
-        :Description: 数据缓存业务模型,用于mysql数据同步到redis，dependency_cache_expire(依赖建缓存时间默认300分钟，普通缓存默认30分钟),查询结果是None和0不会被缓存，除非配置文件设置is_cache_empty=True
-        :param model_class: 实体对象类
-        :param sub_table: 分表标识
-        :last_editors: HuangJianYi
-        """
-        self.cache_prefix = "data_cache"
-        super(CacheModel,self).__init__(model_class, sub_table)
-
-    def get_dependency_key(self, dependency_key=''):
-        """
-        :Description: 获取依赖建
-        :param dependencyKey: 依赖键
-        :return: 依赖建
-        :last_editors: HuangJianYi
-        """
-        if not dependency_key:
-            dependency_key = self.table_name.lower()
-        return self.cache_prefix + ":" + "dependency_" + dependency_key
-
-    def get_cache_key(self, prefix_key, field='*', where='', group_by='', order_by='', limit='', params=None):
-        """
-        :Description: 获取缓存key
-        :param prefix_key: 缓存key前缀[entity、entityone、entitylist、entitypagelist、total、dict、dictone、dictlist、dictpagelist]
-        :param field: 查询字段
-        :param where: 数据库查询条件语句
-        :param group_by: GROUP BY 语句
-        :param order_by:  ORDER BY 语句
-        :param limit:  LIMIT 语句
-        :param params: 参数化查询参数
-        :return: 缓存key
-        :last_editors: HuangJianYi
-        """
-        params_str = ""
-        if params:
-            if isinstance(params,list):
-                for param in params:
-                    params_str += "_" + str(param)
-            else:
-                params_str += "_" + str(params)
-        suffix_key = CryptoHelper.md5_encrypt(str(field + "_" + where + "_" + group_by + "_" + order_by + "_" + limit + params_str).replace(" ", "").lower())
-        return prefix_key + "_" + self.table_name + "_" + suffix_key
-
-    def get_dependency_cache_key(self, dependency_key, cache_key):
-        """
-        :Description: 获取依赖缓存key
-        :param dependency_key: 依赖键
-        :param cache_key: 缓存key
-        :return: 依赖缓存key
-        :last_editors: HuangJianYi
-        """
-        return self.cache_prefix + ":" + CryptoHelper.md5_encrypt(dependency_key+cache_key)
-
-    def get_dependency_cache(self, dependency_key, cache_key, redis_config_dict=None):
-        """
-        :Description: 获取依赖缓存值
-        :param dependency_key: 依赖键
-        :param cache_key: 缓存key
-        :param redis_config_dict: redis_config_dict
-        :return: 依赖缓存值
-        :last_editors: HuangJianYi
-        """
-        if share_config.get_value("is_redis_cache",True) == False:
-            return None
-        dependency_cache_key = self.get_dependency_cache_key(dependency_key, cache_key)
-        redis_init = self.__redis_init(config_dict=redis_config_dict)
-        dependency_date_value = redis_init.get(dependency_key)
-        if not dependency_date_value:
-            redis_init.delete(dependency_cache_key)
-            return None
-        dependency_date = TimeHelper.format_time_to_datetime(dependency_date_value)
-        cache_savetime_key = dependency_cache_key + "_savetime"
-        cache_savetime_value = redis_init.get(cache_savetime_key)
-        if not cache_savetime_value:
-            redis_init.delete(cache_savetime_key)
-            redis_init.delete(dependency_cache_key)
-            return None
-        cache_savetime_date = TimeHelper.format_time_to_datetime(cache_savetime_value)
-        if cache_savetime_date < dependency_date:
-            redis_init.delete(cache_savetime_key)
-            redis_init.delete(dependency_cache_key)
-            return None
-        cache_data = redis_init.get(dependency_cache_key)
-        if not cache_data:
-            return None
-        elif cache_data in ['null','0']:
-            return cache_data
-        else:
-            size = len(cache_data) / 1024
-            limit_size = share_config.get_value("cache_limit_size", 500) # 单位KB
-            if size >= limit_size and limit_size > 0:
-                if hasattr(self, "db"):
-                    if hasattr(self.db, "context"):
-                        if hasattr(self.db.context, "logging_link_error"):
-                            self.db.context.logging_link_error(f"超过缓存值大小阀值{limit_size}KB,当前值为{size}KB,dependency_key:{dependency_key}")
-            cache_data = json.loads(cache_data)
-            return cache_data
-
-    def log_cache(self, dependency_key, cache_key, cache_data, sql, params):
-        """
-        :Description: 记录从缓存取到的数据到日志
-        :param dependency_key: dependency_key
-        :param cache_key: cache_key
-        :param cache_data: 缓存数据
-        :param sql: sql
-        :param params: params
-        :return:
-        :last_editors: HuangJianYi
-        """
-        if hasattr(self, "db") and share_config.get_value("log_redis_cache",True):
-            if hasattr(self.db, "context"):
-                if hasattr(self.db.context, "logging_link_info"):
-                    log_info = {"sql":sql, "params":params, "result":cache_data, "dependency_key":dependency_key, "cache_key":self.get_dependency_cache_key(dependency_key,cache_key)}
-                    self.db.context.logging_link_info("data_cache:" + JsonHelper.json_dumps(log_info))
-
-    def set_dependency_cache(self, dependency_key, cache_key, value, cache_expire, redis_config_dict=None):
-        """
-        :Description: 设置依赖缓存值
-        :param dependency_key: 依赖键
-        :param cache_key: 缓存key
-        :param cache_expire: 缓存时间（单位秒）
-        :param redis_config_dict: redis_config_dict
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        is_cache_empty = share_config.get_value("is_cache_empty",False)
-        if is_cache_empty == False:
-            if not value:
-                return
-        redis_init = self.__redis_init(config_dict=redis_config_dict)
-        dependency_date_value = redis_init.get(dependency_key)
-        if not dependency_date_value:
-            redis_init.set(dependency_key,str(TimeHelper.get_now_format_time()),ex=share_config.get_value("dependency_cache_expire",5*60*60))
-        dependency_cache_key = self.get_dependency_cache_key(dependency_key,cache_key)
-        redis_init.set(dependency_cache_key + "_savetime",str(TimeHelper.get_now_format_time()),ex=cache_expire)
-        return redis_init.set(dependency_cache_key,JsonHelper.json_dumps(value),ex=cache_expire)
-
-    def __redis_init(self, config_dict=None, decode_responses=True):
-        """
-        :description: redis初始化
-        :param config_dict: config_dict
-        :param decode_responses: decode_responses
-        :return: redis_cli
-        :last_editors: HuangJianYi
-        """
-        if not config_dict:
-            config_dict = config.get_value("redis_cache")
-            if not config_dict:
-                config_dict = config.get_value("redis")
-        redis_cli = RedisHelper.redis_init(config_dict=config_dict, decode_responses=decode_responses)
-        return redis_cli
-
-    def delete_dependency_key(self, dependency_key='', delay_delete_time=0.01, redis_config_dict=None):
-        """
-        :Description: 删除依赖键,支持延迟删除和重试机制，同时删除多个依赖建建议传数组，不要分开多次调用
-        :param dependency_key: 依赖键,为空则删除默认依赖建
-        :param delay_delete_time: 延迟删除时间，传0则不进行延迟
-        :param redis_config_dict: redis_config_dict
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        if share_config.get_value("is_redis_cache",True) == True:
-            count = 0
-            while count < 2:
-                count += 1
-                try:
-                    success_count = 0
-                    redis_init = self.__redis_init(config_dict=redis_config_dict)
-                    if delay_delete_time > 0:
-                        time.sleep(delay_delete_time)
-                    if isinstance(dependency_key,list):
-                        dependency_keys = []
-                        for key in dependency_key:
-                            dependency_keys.append(self.get_dependency_key(key))
-                        success_count = redis_init.delete(*dependency_keys)
-                        if success_count == len(dependency_key):
-                            break
-                    else:
-                        success_count = redis_init.delete(self.get_dependency_key(dependency_key))
-                        if success_count == 1:
-                            break
-                except:
-                    print(traceback.print_exc())
-                    pass
-
-    def get_cache_list(self, where='', group_by='', order_by='', limit='', field="*", params=None,dependency_key='', cache_expire=1800, redis_config_dict=None):
-        """
-        :Description: 根据条件获取列表
-        :param where: 数据库查询条件语句
-        :param group_by: GROUP BY 语句
-        :param order_by:  ORDER BY 语句
-        :param limit:  LIMIT 语句
-        :param field: 查询字段 
-        :param params: 参数化查询参数
-        :param dependencyKey: 依赖键
-        :param cache_expire: 缓存时间（单位秒）
-        :param redis_config_dict: redis_config_dict
-        :return: 模型实体列表
-        :last_editors: HuangJianYi
-        """
-        if where and where.strip() != '':
-            where = " WHERE " + where
-        if group_by and group_by.strip() != '':
-            group_by = " GROUP BY "+group_by
-        if order_by and order_by.strip() != '':
-            order_by = " ORDER BY " + order_by
-        if limit:
-            limit = " LIMIT "+str(limit)
-        sql = f"SELECT {field} FROM {self.table_name}{where}{group_by}{order_by}{limit};"
-
-        dependency_key = self.get_dependency_key(str(dependency_key))
-        cache_key = self.get_cache_key('entitylist',field,where,group_by,order_by,limit,params)
-        list_row = self.get_dependency_cache(dependency_key,cache_key,redis_config_dict)
-        if list_row and share_config.get_value("is_redis_cache",True) == True:
-            self.log_cache(dependency_key, cache_key, list_row, sql, params)
-            if list_row == 'null':
-                return []
-            return self._BaseModel__row_entity_list(list_row)
-        else:
-            list_row = self.db.fetch_all_rows(sql, params)
-            cache_value = deepcopy(list_row)
-            if not cache_value:
-                cache_value = []
-            config_cache_expire = share_config.get_value("cache_expire",0)
-            if config_cache_expire > 0:
-                cache_expire = config_cache_expire
-            self.set_dependency_cache(dependency_key,cache_key,cache_value,cache_expire,redis_config_dict)
-            return self._BaseModel__row_entity_list(list_row)
-
-    def get_cache_page_list(self, field="*", page_index=0, page_size=20, where='', group_by='', order_by='', params=None, dependency_key='', cache_expire=1800, page_count_mode='total', redis_config_dict=None):
-        """
-        :Description: 分页获取数据
-        :param field: 查询字段 
-        :param page_index: 分页页码 0为第一页
-        :param page_size: 分页返回数据数量
-        :param where: 数据库查询条件语句
-        :param group_by: GROUP BY 语句
-        :param order_by:  ORDER BY 语句
-        :param params: 参数化查询参数
-        :param dependencyKey: 依赖键
-        :param cache_expire: 缓存时间（单位秒）
-        :param page_count_mode: 分页计数模式 total-计算总数(默认) next-计算是否有下一页(bool) none-不计算
-        :param redis_config_dict: redis_config_dict
-        :return: 模型实体列表
-        :last_editors: HuangJianYi
-        """
-        if where and where.strip() != '':
-            where = " WHERE " + where
-        if group_by and group_by.strip() != '':
-            group_by = " GROUP BY " + group_by
-        if order_by and order_by.strip() != '':
-            order_by = " ORDER BY " + order_by
-
-        limit = f"{str(int(page_index) * int(page_size))},{str(page_size if page_count_mode != 'next' else page_size+1)}"
-        sql = f"SELECT {field} FROM {self.table_name}{where}{group_by}{order_by} LIMIT {limit};"
-
-        dependency_key = self.get_dependency_key(str(dependency_key))
-        cache_key = self.get_cache_key('entitypagelist',field,where,group_by,order_by,limit,params)
-        page_list = self.get_dependency_cache(dependency_key,cache_key,redis_config_dict)
-        if page_list and share_config.get_value("is_redis_cache",True) == True:
-            self.log_cache(dependency_key, cache_key, page_list, sql, params)
-            if page_count_mode == "total":
-                return self._BaseModel__row_entity_list(page_list["data"]),page_list["row_count"]
-            elif page_count_mode == "next":
-                return self._BaseModel__row_entity_list(page_list["data"]),bool(page_list["is_next_page"])
-            else:
-                return self._BaseModel__row_entity_list(page_list["data"])
-        else:
-            page_list = {}
-            list_row = self.db.fetch_all_rows(sql, params)
-            if not list_row:
-                list_row = []
-            if page_count_mode == "total":
-                sql = f"SELECT COUNT({self.primary_key_field}) AS count FROM {self.table_name}{where}{group_by}"
-                if group_by:
-                    sql = f"SELECT COUNT(*) as count FROM ({sql}) temp_table;"
-                row = self.db.fetch_one_row(sql, params)
-                if row and 'count' in row and int(row['count']) > 0:
-                    row_count = int(row["count"])
-                else:
-                    row_count = 0
-                page_list["data"] = list_row
-                page_list["row_count"] = row_count
-                self.set_dependency_cache(dependency_key,cache_key,page_list,cache_expire,redis_config_dict)
-                return self._BaseModel__row_entity_list(page_list["data"]), row_count
-            elif page_count_mode == "next":
-                is_next_page = len(list_row) == page_size+1
-                if list_row and len(list_row) > 0:
-                    list_row = list_row[:page_size]
-                page_list["data"] = list_row
-                page_list["is_next_page"] = is_next_page
-                self.set_dependency_cache(dependency_key,cache_key,page_list,cache_expire,redis_config_dict)
-                return self._BaseModel__row_entity_list(page_list["data"]), is_next_page
-            else:
-                page_list["data"] = list_row
-                self.set_dependency_cache(dependency_key,cache_key,page_list,cache_expire,redis_config_dict)
-                return self._BaseModel__row_entity_list(page_list["data"])
-
-    def get_cache_entity(self, where='', group_by='', order_by='',  params=None, dependency_key='', cache_expire=1800, redis_config_dict=None):
-        """
-        :Description: 根据条件获取实体对象
-        :param where: 数据库查询条件语句
-        :param group_by: GROUP BY 语句
-        :param order_by:  ORDER BY 语句
-        :param params: 参数化查询参数
-        :param dependencyKey: 依赖键
-        :param cache_expire: 缓存时间（单位秒）
-        :param redis_config_dict: redis_config_dict
-        :return: 模型实体
-        :last_editors: HuangJianYi
-        """
-        if where and where.strip() != '':
-            where = " WHERE " + where
-        if group_by and group_by.strip() != '':
-            group_by = " GROUP BY "+group_by
-        if order_by and order_by.strip() != '':
-            order_by = " ORDER BY " + order_by
-        sql = f"SELECT * FROM {self.table_name}{where}{group_by}{order_by} LIMIT 1;"
-
-        dependency_key = self.get_dependency_key(str(dependency_key))
-        cache_key = self.get_cache_key('entity','*',where,group_by,order_by,'1',params)
-        one_row = self.get_dependency_cache(dependency_key,cache_key,redis_config_dict)
-        if one_row and share_config.get_value("is_redis_cache",True) == True:
-            self.log_cache(dependency_key, cache_key, one_row, sql, params)
-            if one_row == 'null':
-                return None
-            return self._BaseModel__row_entity(one_row)
-        else:
-            one_row = self.db.fetch_one_row(sql, params)
-            config_cache_expire = share_config.get_value("cache_expire",0)
-            if config_cache_expire > 0:
-                cache_expire = config_cache_expire
-            self.set_dependency_cache(dependency_key,cache_key,one_row,cache_expire,redis_config_dict)
-            return self._BaseModel__row_entity(one_row)
-
-    def get_cache_entity_by_id(self, primary_key_id, dependency_key='', cache_expire=1800, redis_config_dict=None):
-        """
-        :Description: 根据主键值获取实体对象
-        :param primary_key_id: 主键ID值
-        :param dependencyKey: 依赖键
-        :param cache_expire: 缓存时间（单位秒）
-        :param redis_config_dict: redis_config_dict
-        :return: 模型实体
-        :last_editors: HuangJianYi
-        """
-        where = f"{self.primary_key_field}=%s"
-        params = [primary_key_id]
-        sql = f"SELECT * FROM {self.table_name} WHERE {where} LIMIT 1;"
-
-        dependency_key = self.get_dependency_key(str(dependency_key))
-        cache_key = self.get_cache_key('entityone','*',where,'','','',params)
-        one_row = self.get_dependency_cache(dependency_key,cache_key,redis_config_dict)
-        if one_row and share_config.get_value("is_redis_cache",True) == True:
-            self.log_cache(dependency_key, cache_key, one_row, sql, params)
-            if one_row == 'null':
-                return None
-            return self._BaseModel__row_entity(one_row)
-        else:
-            one_row = self.db.fetch_one_row(sql,params)
-            config_cache_expire = share_config.get_value("cache_expire",0)
-            if config_cache_expire > 0:
-                cache_expire = config_cache_expire
-            self.set_dependency_cache(dependency_key,cache_key,one_row,cache_expire,redis_config_dict)
-            return self._BaseModel__row_entity(one_row)
-
-    def get_cache_total(self, where='', group_by='', field=None, params=None, dependency_key='', cache_expire=1800, redis_config_dict=None):
-        """
-        :Description: 根据条件获取数据数量
-        :param where: 数据库查询条件语句
-        :param group_by: GROUP BY 语句
-        :param params: 参数化查询参数
-        :param field: count(传参)
-        :param dependencyKey: 依赖键
-        :param cache_expire: 缓存时间（单位秒）
-        :param redis_config_dict: redis_config_dict
-        :return: 查询符合条件的行的数量
-        :last_editors: HuangJianYi
-        """
-        if where and where.strip() != '':
-            where = " WHERE " + where
-        if group_by and group_by.strip() != '':
-            group_by = " GROUP BY "+group_by
-        if not field:
-            field = self.primary_key_field
-        sql = f"SELECT COUNT({field}) AS count FROM {self.table_name}{where}{group_by};"
-
-        dependency_key = self.get_dependency_key(str(dependency_key))
-        cache_key = self.get_cache_key('total',field,where,group_by,'','',params)
-        total = self.get_dependency_cache(dependency_key,cache_key,redis_config_dict)
-        if total and share_config.get_value("is_redis_cache",True) == True:
-            self.log_cache(dependency_key, cache_key, total, sql, params)
-            if total == '0':
-                return 0
-            else:
-                return total
-        else:
-            list_row = self.db.fetch_one_row(sql, params)
-            if list_row and 'count' in list_row:
-                config_cache_expire = share_config.get_value("cache_expire",0)
-                if config_cache_expire > 0:
-                    cache_expire = config_cache_expire
-                self.set_dependency_cache(dependency_key,cache_key,list_row['count'],cache_expire,redis_config_dict)
-                return list_row['count']
-            return 0
-
-    def get_cache_dict(self, where='', group_by='', order_by='', limit='1', field="*", params=None, dependency_key='', cache_expire=1800, redis_config_dict=None):
-        """
-        :Description: 返回字典dict
-        :param dependencyKey: 依赖键
-        :param cache_expire: 缓存时间（单位秒）
-        :param where: 数据库查询条件语句
-        :param group_by: GROUP BY 语句
-        :param order_by:  ORDER BY 语句
-        :param limit:  LIMIT 语句
-        :param field: 查询字段 
-        :param params: 参数化查询参数
-        :param dependencyKey: 依赖键
-        :param cache_expire: 缓存时间（单位秒）
-        :param redis_config_dict: redis_config_dict
-        :return: 返回匹配条件的第一行字典数据
-        :last_editors: HuangJianYi
-        """
-        if where and where.strip() != '':
-            where = " WHERE " + where
-        if group_by and group_by.strip() != '':
-            group_by = " GROUP BY "+group_by
-        if order_by and order_by.strip() != '':
-            order_by = " ORDER BY " + order_by
-        if limit:
-            limit = " LIMIT "+str(limit)
-        sql = f"SELECT {field} FROM {self.table_name}{where}{group_by}{order_by}{limit}"
-
-        dependency_key = self.get_dependency_key(str(dependency_key))
-        cache_key = self.get_cache_key('dict',field,where,group_by,order_by,limit,params)
-        one_row = self.get_dependency_cache(dependency_key,cache_key,redis_config_dict)
-
-        if one_row and share_config.get_value("is_redis_cache",True) == True:
-            self.log_cache(dependency_key, cache_key, one_row, sql, params)
-            if one_row == 'null':
-                return None
-            return one_row
-        else:
-            one_row = self.db.fetch_one_row(sql, params)
-            config_cache_expire = share_config.get_value("cache_expire",0)
-            if config_cache_expire > 0:
-                cache_expire = config_cache_expire
-            self.set_dependency_cache(dependency_key,cache_key,one_row,cache_expire,redis_config_dict)
-            if one_row:
-                for field in one_row:
-                    one_row[field] = self._BaseModel__convert_field_type(one_row[field])
-            return one_row
-
-    def get_cache_dict_by_id(self, primary_key_id, dependency_key='', cache_expire=1800, field="*", redis_config_dict=None):
-        """
-        :Description: 根据主键ID获取dict
-        :param primary_key_id: 主键ID值
-        :param dependencyKey: 依赖键
-        :param cache_expire: 缓存时间（单位秒）
-        :param field: 查询字段
-        :param redis_config_dict: redis_config_dict
-        :return: 返回匹配id的第一行字典数据
-        :last_editors: HuangJianYi
-        """
-        where = f"{self.primary_key_field}=%s"
-        params = [primary_key_id]
-        sql = f"SELECT {field} FROM {self.table_name} WHERE {where} LIMIT 1;"
-
-        dependency_key = self.get_dependency_key(str(dependency_key))
-        cache_key = self.get_cache_key('dictone',field,where,'','','',params)
-        one_row = self.get_dependency_cache(dependency_key,cache_key,redis_config_dict)
-        if one_row and share_config.get_value("is_redis_cache",True) == True:
-            self.log_cache(dependency_key, cache_key, one_row, sql, params)
-            if one_row == 'null':
-                return None
-            return one_row
-        else:
-            one_row = self.db.fetch_one_row(sql,params)
-            config_cache_expire = share_config.get_value("cache_expire",0)
-            if config_cache_expire > 0:
-                cache_expire = config_cache_expire
-            self.set_dependency_cache(dependency_key,cache_key,one_row,cache_expire,redis_config_dict)
-            if one_row:
-                for field in one_row:
-                    one_row[field] = self._BaseModel__convert_field_type(one_row[field])
-            return one_row
-
-    def get_cache_dict_list(self, where='', group_by='', order_by='', limit='', field="*", params=None, dependency_key='', cache_expire=1800, redis_config_dict=None):
-        """
-        :Description: 返回字典列表dict list
-        :param where: 数据库查询条件语句
-        :param group_by: GROUP BY 语句
-        :param order_by:  ORDER BY 语句
-        :param limit:  LIMIT 语句
-        :param field: 查询字段 
-        :param params: 参数化查询参数
-        :param dependencyKey: 依赖键
-        :param cache_expire: 缓存时间（单位秒）
-        :param redis_config_dict: redis_config_dict
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        if where and where.strip() != '':
-            where = " WHERE " + where
-        if group_by and group_by.strip() != '':
-            group_by = " GROUP BY "+group_by
-        if order_by and order_by.strip() != '':
-            order_by = " ORDER BY " + order_by
-        if limit:
-            limit = " LIMIT "+str(limit)
-        sql = f"SELECT {field} FROM {self.table_name}{where}{group_by}{order_by}{limit};"
-
-        dependency_key = self.get_dependency_key(str(dependency_key))
-        cache_key = self.get_cache_key('dictlist',field,where,group_by,order_by,limit,params)
-        list = self.get_dependency_cache(dependency_key,cache_key,redis_config_dict)
-        if list and share_config.get_value("is_redis_cache",True) == True:
-            self.log_cache(dependency_key, cache_key, list, sql, params)
-            return list
-        else:
-            list_row = self.db.fetch_all_rows(sql, params)
-            if not list_row:
-                list_row = []
-            config_cache_expire = share_config.get_value("cache_expire",0)
-            if config_cache_expire > 0:
-                cache_expire = config_cache_expire
-            self.set_dependency_cache(dependency_key,cache_key,list_row,cache_expire,redis_config_dict)
-            if list_row and len(list_row) > 0:
-                for one_row in list_row:
-                    for field in one_row:
-                        one_row[field] = self._BaseModel__convert_field_type(one_row[field])
-            return list_row
-
-    def get_cache_dict_page_list(self, field="*", page_index=0 ,page_size=20, where='', group_by='' ,order_by='' , params=None, dependency_key='', cache_expire=1800, page_count_mode='total', redis_config_dict=None):
-        """
-        :Description: 获取分页字典数据
-        :param field: 查询字段 
-        :param page_index: 分页页码 0为第一页
-        :param page_size: 分页返回数据数量
-        :param where: 数据库查询条件语句
-        :param group_by: GROUP BY 语句
-        :param order_by:  ORDER BY 语句
-        :param params: 参数化查询参数
-        :param dependencyKey: 依赖键
-        :param cache_expire: 缓存时间（单位秒）
-        :param page_count_mode: 分页计数模式 total-计算总数(默认) next-计算是否有下一页(bool) none-不计算
-        :param redis_config_dict: redis_config_dict
-        :return: 数据字典数组
-        :last_editors: HuangJianYi
-        """
-        if where and where.strip() != '':
-            where = " WHERE " + where
-        if group_by and group_by.strip() != '':
-            group_by = " GROUP BY " + group_by
-        if order_by and order_by.strip() != '':
-            order_by = " ORDER BY " + order_by
-
-        limit = f"{str(int(page_index) * int(page_size))},{str(page_size if page_count_mode != 'next' else page_size+1)}"
-        sql = f"SELECT {field} FROM {self.table_name}{where}{group_by}{order_by} LIMIT {limit}"
-
-        dependency_key = self.get_dependency_key(str(dependency_key))
-        cache_key = self.get_cache_key('dictpagelist',field,where,group_by,order_by,limit,params)
-        page_list = self.get_dependency_cache(dependency_key,cache_key,redis_config_dict)
-        if page_list and share_config.get_value("is_redis_cache",True) == True:
-            self.log_cache(dependency_key, cache_key, page_list, sql, params)
-            if page_count_mode == "total":
-                return page_list["data"],page_list["row_count"]
-            elif page_count_mode == "next":
-                return page_list["data"],bool(page_list["is_next_page"])
-            else:
-                return page_list["data"]
-        else:
-            config_cache_expire = share_config.get_value("cache_expire",0)
-            if config_cache_expire > 0:
-                cache_expire = config_cache_expire
-            page_list = {}
-            list_row = self.db.fetch_all_rows(sql, params)
-            if not list_row:
-                list_row = []
-            if list_row and len(list_row) > 0:
-                for one_row in list_row:
-                    for field in one_row:
-                        one_row[field] = self._BaseModel__convert_field_type(one_row[field])
-            if page_count_mode == "total":
-                sql = f"SELECT COUNT({self.primary_key_field}) AS count FROM {self.table_name}{where}{group_by}"
-                if group_by:
-                    sql = f"SELECT COUNT(*) as count FROM ({sql}) temp_table;"
-                row = self.db.fetch_one_row(sql, params)
-                if row and 'count' in row and int(row['count']) > 0:
-                    row_count = int(row["count"])
-                else:
-                    row_count = 0
-                page_list["data"] = list_row
-                page_list["row_count"] = row_count
-                self.set_dependency_cache(dependency_key,cache_key,page_list,cache_expire,redis_config_dict)
-                return list_row, row_count
-            elif page_count_mode == "next":
-                is_next_page = len(list_row) == page_size+1
-                if list_row and len(list_row) > 0:
-                    list_row = list_row[:page_size]
-                page_list["data"] = list_row
-                page_list["is_next_page"] = is_next_page
-                self.set_dependency_cache(dependency_key,cache_key,page_list,cache_expire,redis_config_dict)
-                return list_row, is_next_page
-            else:
-                page_list["data"] = list_row
-                self.set_dependency_cache(dependency_key,cache_key,page_list,cache_expire,redis_config_dict)
-                return list_row
+# -*- coding: utf-8 -*-
+"""
+:Author: HuangJianYi
+:Date: 2020-03-06 23:17:54
+@LastEditTime: 2023-07-13 16:11:57
+@LastEditors: HuangJianYi
+:Description: 数据缓存业务模型
+"""
+import json
+from copy import deepcopy
+from seven_framework.base_model import *
+from seven_framework import *
+from seven_framework.redis import *
+from seven_cloudapp_frame.libs.common import *
+
+class CacheModel(BaseModel):
+
+    def __init__(self, model_class, sub_table):
+        """
+        :Description: 数据缓存业务模型,用于mysql数据同步到redis，dependency_cache_expire(依赖建缓存时间默认300分钟，普通缓存默认30分钟),查询结果是None和0不会被缓存，除非配置文件设置is_cache_empty=True
+        :param model_class: 实体对象类
+        :param sub_table: 分表标识
+        :last_editors: HuangJianYi
+        """
+        self.cache_prefix = "data_cache"
+        super(CacheModel,self).__init__(model_class, sub_table)
+
+    def get_dependency_key(self, dependency_key=''):
+        """
+        :Description: 获取依赖建
+        :param dependencyKey: 依赖键
+        :return: 依赖建
+        :last_editors: HuangJianYi
+        """
+        if not dependency_key:
+            dependency_key = self.table_name.lower()
+        return self.cache_prefix + ":" + "dependency_" + dependency_key
+
+    def get_cache_key(self, prefix_key, field='*', where='', group_by='', order_by='', limit='', params=None):
+        """
+        :Description: 获取缓存key
+        :param prefix_key: 缓存key前缀[entity、entityone、entitylist、entitypagelist、total、dict、dictone、dictlist、dictpagelist]
+        :param field: 查询字段
+        :param where: 数据库查询条件语句
+        :param group_by: GROUP BY 语句
+        :param order_by:  ORDER BY 语句
+        :param limit:  LIMIT 语句
+        :param params: 参数化查询参数
+        :return: 缓存key
+        :last_editors: HuangJianYi
+        """
+        params_str = ""
+        if params:
+            if isinstance(params,list):
+                for param in params:
+                    params_str += "_" + str(param)
+            else:
+                params_str += "_" + str(params)
+        suffix_key = CryptoHelper.md5_encrypt(str(field + "_" + where + "_" + group_by + "_" + order_by + "_" + limit + params_str).replace(" ", "").lower())
+        return prefix_key + "_" + self.table_name + "_" + suffix_key
+
+    def get_dependency_cache_key(self, dependency_key, cache_key):
+        """
+        :Description: 获取依赖缓存key
+        :param dependency_key: 依赖键
+        :param cache_key: 缓存key
+        :return: 依赖缓存key
+        :last_editors: HuangJianYi
+        """
+        return self.cache_prefix + ":" + CryptoHelper.md5_encrypt(dependency_key+cache_key)
+
+    def get_dependency_cache(self, dependency_key, cache_key, redis_config_dict=None):
+        """
+        :Description: 获取依赖缓存值
+        :param dependency_key: 依赖键
+        :param cache_key: 缓存key
+        :param redis_config_dict: redis_config_dict
+        :return: 依赖缓存值
+        :last_editors: HuangJianYi
+        """
+        if share_config.get_value("is_redis_cache",True) == False:
+            return None
+        dependency_cache_key = self.get_dependency_cache_key(dependency_key, cache_key)
+        redis_init = self.__redis_init(config_dict=redis_config_dict)
+        dependency_date_value = redis_init.get(dependency_key)
+        if not dependency_date_value:
+            redis_init.delete(dependency_cache_key)
+            return None
+        dependency_date = TimeHelper.format_time_to_datetime(dependency_date_value)
+        cache_savetime_key = dependency_cache_key + "_savetime"
+        cache_savetime_value = redis_init.get(cache_savetime_key)
+        if not cache_savetime_value:
+            redis_init.delete(cache_savetime_key)
+            redis_init.delete(dependency_cache_key)
+            return None
+        cache_savetime_date = TimeHelper.format_time_to_datetime(cache_savetime_value)
+        if cache_savetime_date < dependency_date:
+            redis_init.delete(cache_savetime_key)
+            redis_init.delete(dependency_cache_key)
+            return None
+        cache_data = redis_init.get(dependency_cache_key)
+        if not cache_data:
+            return None
+        elif cache_data in ['null','0']:
+            return cache_data
+        else:
+            size = len(cache_data) / 1024
+            limit_size = share_config.get_value("cache_limit_size", 500) # 单位KB
+            if size >= limit_size and limit_size > 0:
+                if hasattr(self, "db"):
+                    if hasattr(self.db, "context"):
+                        if hasattr(self.db.context, "logging_link_error"):
+                            self.db.context.logging_link_error(f"超过缓存值大小阀值{limit_size}KB,当前值为{size}KB,dependency_key:{dependency_key}")
+            cache_data = json.loads(cache_data)
+            return cache_data
+
+    def log_cache(self, dependency_key, cache_key, cache_data, sql, params):
+        """
+        :Description: 记录从缓存取到的数据到日志
+        :param dependency_key: dependency_key
+        :param cache_key: cache_key
+        :param cache_data: 缓存数据
+        :param sql: sql
+        :param params: params
+        :return:
+        :last_editors: HuangJianYi
+        """
+        if hasattr(self, "db") and share_config.get_value("log_redis_cache",True):
+            if hasattr(self.db, "context"):
+                if hasattr(self.db.context, "logging_link_info"):
+                    log_info = {"sql":sql, "params":params, "result":cache_data, "dependency_key":dependency_key, "cache_key":self.get_dependency_cache_key(dependency_key,cache_key)}
+                    self.db.context.logging_link_info("data_cache:" + JsonHelper.json_dumps(log_info))
+
+    def set_dependency_cache(self, dependency_key, cache_key, value, cache_expire, redis_config_dict=None):
+        """
+        :Description: 设置依赖缓存值
+        :param dependency_key: 依赖键
+        :param cache_key: 缓存key
+        :param cache_expire: 缓存时间（单位秒）
+        :param redis_config_dict: redis_config_dict
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        is_cache_empty = share_config.get_value("is_cache_empty",False)
+        if is_cache_empty == False:
+            if not value:
+                return
+        redis_init = self.__redis_init(config_dict=redis_config_dict)
+        dependency_date_value = redis_init.get(dependency_key)
+        if not dependency_date_value:
+            redis_init.set(dependency_key,str(TimeHelper.get_now_format_time()),ex=share_config.get_value("dependency_cache_expire",5*60*60))
+        dependency_cache_key = self.get_dependency_cache_key(dependency_key,cache_key)
+        redis_init.set(dependency_cache_key + "_savetime",str(TimeHelper.get_now_format_time()),ex=cache_expire)
+        return redis_init.set(dependency_cache_key,JsonHelper.json_dumps(value),ex=cache_expire)
+
+    def __redis_init(self, config_dict=None, decode_responses=True):
+        """
+        :description: redis初始化
+        :param config_dict: config_dict
+        :param decode_responses: decode_responses
+        :return: redis_cli
+        :last_editors: HuangJianYi
+        """
+        if not config_dict:
+            config_dict = config.get_value("redis_cache")
+            if not config_dict:
+                config_dict = config.get_value("redis")
+        redis_cli = RedisHelper.redis_init(config_dict=config_dict, decode_responses=decode_responses)
+        return redis_cli
+
+    def delete_dependency_key(self, dependency_key='', delay_delete_time=0.01, redis_config_dict=None):
+        """
+        :Description: 删除依赖键,支持延迟删除和重试机制，同时删除多个依赖建建议传数组，不要分开多次调用
+        :param dependency_key: 依赖键,为空则删除默认依赖建
+        :param delay_delete_time: 延迟删除时间，传0则不进行延迟
+        :param redis_config_dict: redis_config_dict
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        if share_config.get_value("is_redis_cache",True) == True:
+            count = 0
+            while count < 2:
+                count += 1
+                try:
+                    success_count = 0
+                    redis_init = self.__redis_init(config_dict=redis_config_dict)
+                    if delay_delete_time > 0:
+                        time.sleep(delay_delete_time)
+                    if isinstance(dependency_key,list):
+                        dependency_keys = []
+                        for key in dependency_key:
+                            dependency_keys.append(self.get_dependency_key(key))
+                        success_count = redis_init.delete(*dependency_keys)
+                        if success_count == len(dependency_key):
+                            break
+                    else:
+                        success_count = redis_init.delete(self.get_dependency_key(dependency_key))
+                        if success_count == 1:
+                            break
+                except:
+                    print(traceback.print_exc())
+                    pass
+
+    def get_cache_list(self, where='', group_by='', order_by='', limit='', field="*", params=None,dependency_key='', cache_expire=1800, redis_config_dict=None):
+        """
+        :Description: 根据条件获取列表
+        :param where: 数据库查询条件语句
+        :param group_by: GROUP BY 语句
+        :param order_by:  ORDER BY 语句
+        :param limit:  LIMIT 语句
+        :param field: 查询字段 
+        :param params: 参数化查询参数
+        :param dependencyKey: 依赖键
+        :param cache_expire: 缓存时间（单位秒）
+        :param redis_config_dict: redis_config_dict
+        :return: 模型实体列表
+        :last_editors: HuangJianYi
+        """
+        if where and where.strip() != '':
+            where = " WHERE " + where
+        if group_by and group_by.strip() != '':
+            group_by = " GROUP BY "+group_by
+        if order_by and order_by.strip() != '':
+            order_by = " ORDER BY " + order_by
+        if limit:
+            limit = " LIMIT "+str(limit)
+        sql = f"SELECT {field} FROM {self.table_name}{where}{group_by}{order_by}{limit};"
+
+        dependency_key = self.get_dependency_key(str(dependency_key))
+        cache_key = self.get_cache_key('entitylist',field,where,group_by,order_by,limit,params)
+        list_row = self.get_dependency_cache(dependency_key,cache_key,redis_config_dict)
+        if list_row and share_config.get_value("is_redis_cache",True) == True:
+            self.log_cache(dependency_key, cache_key, list_row, sql, params)
+            if list_row == 'null':
+                return []
+            return self._BaseModel__row_entity_list(list_row)
+        else:
+            list_row = self.db.fetch_all_rows(sql, params)
+            cache_value = deepcopy(list_row)
+            if not cache_value:
+                cache_value = []
+            config_cache_expire = share_config.get_value("cache_expire",0)
+            if config_cache_expire > 0:
+                cache_expire = config_cache_expire
+            self.set_dependency_cache(dependency_key,cache_key,cache_value,cache_expire,redis_config_dict)
+            return self._BaseModel__row_entity_list(list_row)
+
+    def get_cache_page_list(self, field="*", page_index=0, page_size=20, where='', group_by='', order_by='', params=None, dependency_key='', cache_expire=1800, page_count_mode='total', redis_config_dict=None):
+        """
+        :Description: 分页获取数据
+        :param field: 查询字段 
+        :param page_index: 分页页码 0为第一页
+        :param page_size: 分页返回数据数量
+        :param where: 数据库查询条件语句
+        :param group_by: GROUP BY 语句
+        :param order_by:  ORDER BY 语句
+        :param params: 参数化查询参数
+        :param dependencyKey: 依赖键
+        :param cache_expire: 缓存时间（单位秒）
+        :param page_count_mode: 分页计数模式 total-计算总数(默认) next-计算是否有下一页(bool) none-不计算
+        :param redis_config_dict: redis_config_dict
+        :return: 模型实体列表
+        :last_editors: HuangJianYi
+        """
+        if where and where.strip() != '':
+            where = " WHERE " + where
+        if group_by and group_by.strip() != '':
+            group_by = " GROUP BY " + group_by
+        if order_by and order_by.strip() != '':
+            order_by = " ORDER BY " + order_by
+
+        limit = f"{str(int(page_index) * int(page_size))},{str(page_size if page_count_mode != 'next' else page_size+1)}"
+        sql = f"SELECT {field} FROM {self.table_name}{where}{group_by}{order_by} LIMIT {limit};"
+
+        dependency_key = self.get_dependency_key(str(dependency_key))
+        cache_key = self.get_cache_key('entitypagelist',field,where,group_by,order_by,limit,params)
+        page_list = self.get_dependency_cache(dependency_key,cache_key,redis_config_dict)
+        if page_list and share_config.get_value("is_redis_cache",True) == True:
+            self.log_cache(dependency_key, cache_key, page_list, sql, params)
+            if page_count_mode == "total":
+                return self._BaseModel__row_entity_list(page_list["data"]),page_list["row_count"]
+            elif page_count_mode == "next":
+                return self._BaseModel__row_entity_list(page_list["data"]),bool(page_list["is_next_page"])
+            else:
+                return self._BaseModel__row_entity_list(page_list["data"])
+        else:
+            page_list = {}
+            list_row = self.db.fetch_all_rows(sql, params)
+            if not list_row:
+                list_row = []
+            if page_count_mode == "total":
+                sql = f"SELECT COUNT({self.primary_key_field}) AS count FROM {self.table_name}{where}{group_by}"
+                if group_by:
+                    sql = f"SELECT COUNT(*) as count FROM ({sql}) temp_table;"
+                row = self.db.fetch_one_row(sql, params)
+                if row and 'count' in row and int(row['count']) > 0:
+                    row_count = int(row["count"])
+                else:
+                    row_count = 0
+                page_list["data"] = list_row
+                page_list["row_count"] = row_count
+                self.set_dependency_cache(dependency_key,cache_key,page_list,cache_expire,redis_config_dict)
+                return self._BaseModel__row_entity_list(page_list["data"]), row_count
+            elif page_count_mode == "next":
+                is_next_page = len(list_row) == page_size+1
+                if list_row and len(list_row) > 0:
+                    list_row = list_row[:page_size]
+                page_list["data"] = list_row
+                page_list["is_next_page"] = is_next_page
+                self.set_dependency_cache(dependency_key,cache_key,page_list,cache_expire,redis_config_dict)
+                return self._BaseModel__row_entity_list(page_list["data"]), is_next_page
+            else:
+                page_list["data"] = list_row
+                self.set_dependency_cache(dependency_key,cache_key,page_list,cache_expire,redis_config_dict)
+                return self._BaseModel__row_entity_list(page_list["data"])
+
+    def get_cache_entity(self, where='', group_by='', order_by='',  params=None, dependency_key='', cache_expire=1800, redis_config_dict=None):
+        """
+        :Description: 根据条件获取实体对象
+        :param where: 数据库查询条件语句
+        :param group_by: GROUP BY 语句
+        :param order_by:  ORDER BY 语句
+        :param params: 参数化查询参数
+        :param dependencyKey: 依赖键
+        :param cache_expire: 缓存时间（单位秒）
+        :param redis_config_dict: redis_config_dict
+        :return: 模型实体
+        :last_editors: HuangJianYi
+        """
+        if where and where.strip() != '':
+            where = " WHERE " + where
+        if group_by and group_by.strip() != '':
+            group_by = " GROUP BY "+group_by
+        if order_by and order_by.strip() != '':
+            order_by = " ORDER BY " + order_by
+        sql = f"SELECT * FROM {self.table_name}{where}{group_by}{order_by} LIMIT 1;"
+
+        dependency_key = self.get_dependency_key(str(dependency_key))
+        cache_key = self.get_cache_key('entity','*',where,group_by,order_by,'1',params)
+        one_row = self.get_dependency_cache(dependency_key,cache_key,redis_config_dict)
+        if one_row and share_config.get_value("is_redis_cache",True) == True:
+            self.log_cache(dependency_key, cache_key, one_row, sql, params)
+            if one_row == 'null':
+                return None
+            return self._BaseModel__row_entity(one_row)
+        else:
+            one_row = self.db.fetch_one_row(sql, params)
+            config_cache_expire = share_config.get_value("cache_expire",0)
+            if config_cache_expire > 0:
+                cache_expire = config_cache_expire
+            self.set_dependency_cache(dependency_key,cache_key,one_row,cache_expire,redis_config_dict)
+            return self._BaseModel__row_entity(one_row)
+
+    def get_cache_entity_by_id(self, primary_key_id, dependency_key='', cache_expire=1800, redis_config_dict=None):
+        """
+        :Description: 根据主键值获取实体对象
+        :param primary_key_id: 主键ID值
+        :param dependencyKey: 依赖键
+        :param cache_expire: 缓存时间（单位秒）
+        :param redis_config_dict: redis_config_dict
+        :return: 模型实体
+        :last_editors: HuangJianYi
+        """
+        where = f"{self.primary_key_field}=%s"
+        params = [primary_key_id]
+        sql = f"SELECT * FROM {self.table_name} WHERE {where} LIMIT 1;"
+
+        dependency_key = self.get_dependency_key(str(dependency_key))
+        cache_key = self.get_cache_key('entityone','*',where,'','','',params)
+        one_row = self.get_dependency_cache(dependency_key,cache_key,redis_config_dict)
+        if one_row and share_config.get_value("is_redis_cache",True) == True:
+            self.log_cache(dependency_key, cache_key, one_row, sql, params)
+            if one_row == 'null':
+                return None
+            return self._BaseModel__row_entity(one_row)
+        else:
+            one_row = self.db.fetch_one_row(sql,params)
+            config_cache_expire = share_config.get_value("cache_expire",0)
+            if config_cache_expire > 0:
+                cache_expire = config_cache_expire
+            self.set_dependency_cache(dependency_key,cache_key,one_row,cache_expire,redis_config_dict)
+            return self._BaseModel__row_entity(one_row)
+
+    def get_cache_total(self, where='', group_by='', field=None, params=None, dependency_key='', cache_expire=1800, redis_config_dict=None):
+        """
+        :Description: 根据条件获取数据数量
+        :param where: 数据库查询条件语句
+        :param group_by: GROUP BY 语句
+        :param params: 参数化查询参数
+        :param field: count(传参)
+        :param dependencyKey: 依赖键
+        :param cache_expire: 缓存时间（单位秒）
+        :param redis_config_dict: redis_config_dict
+        :return: 查询符合条件的行的数量
+        :last_editors: HuangJianYi
+        """
+        if where and where.strip() != '':
+            where = " WHERE " + where
+        if group_by and group_by.strip() != '':
+            group_by = " GROUP BY "+group_by
+        if not field:
+            field = self.primary_key_field
+        sql = f"SELECT COUNT({field}) AS count FROM {self.table_name}{where}{group_by};"
+
+        dependency_key = self.get_dependency_key(str(dependency_key))
+        cache_key = self.get_cache_key('total',field,where,group_by,'','',params)
+        total = self.get_dependency_cache(dependency_key,cache_key,redis_config_dict)
+        if total and share_config.get_value("is_redis_cache",True) == True:
+            self.log_cache(dependency_key, cache_key, total, sql, params)
+            if total == '0':
+                return 0
+            else:
+                return total
+        else:
+            list_row = self.db.fetch_one_row(sql, params)
+            if list_row and 'count' in list_row:
+                config_cache_expire = share_config.get_value("cache_expire",0)
+                if config_cache_expire > 0:
+                    cache_expire = config_cache_expire
+                self.set_dependency_cache(dependency_key,cache_key,list_row['count'],cache_expire,redis_config_dict)
+                return list_row['count']
+            return 0
+
+    def get_cache_dict(self, where='', group_by='', order_by='', limit='1', field="*", params=None, dependency_key='', cache_expire=1800, redis_config_dict=None):
+        """
+        :Description: 返回字典dict
+        :param dependencyKey: 依赖键
+        :param cache_expire: 缓存时间（单位秒）
+        :param where: 数据库查询条件语句
+        :param group_by: GROUP BY 语句
+        :param order_by:  ORDER BY 语句
+        :param limit:  LIMIT 语句
+        :param field: 查询字段 
+        :param params: 参数化查询参数
+        :param dependencyKey: 依赖键
+        :param cache_expire: 缓存时间（单位秒）
+        :param redis_config_dict: redis_config_dict
+        :return: 返回匹配条件的第一行字典数据
+        :last_editors: HuangJianYi
+        """
+        if where and where.strip() != '':
+            where = " WHERE " + where
+        if group_by and group_by.strip() != '':
+            group_by = " GROUP BY "+group_by
+        if order_by and order_by.strip() != '':
+            order_by = " ORDER BY " + order_by
+        if limit:
+            limit = " LIMIT "+str(limit)
+        sql = f"SELECT {field} FROM {self.table_name}{where}{group_by}{order_by}{limit}"
+
+        dependency_key = self.get_dependency_key(str(dependency_key))
+        cache_key = self.get_cache_key('dict',field,where,group_by,order_by,limit,params)
+        one_row = self.get_dependency_cache(dependency_key,cache_key,redis_config_dict)
+
+        if one_row and share_config.get_value("is_redis_cache",True) == True:
+            self.log_cache(dependency_key, cache_key, one_row, sql, params)
+            if one_row == 'null':
+                return None
+            return one_row
+        else:
+            one_row = self.db.fetch_one_row(sql, params)
+            config_cache_expire = share_config.get_value("cache_expire",0)
+            if config_cache_expire > 0:
+                cache_expire = config_cache_expire
+            self.set_dependency_cache(dependency_key,cache_key,one_row,cache_expire,redis_config_dict)
+            if one_row:
+                for field in one_row:
+                    one_row[field] = self._BaseModel__convert_field_type(one_row[field])
+            return one_row
+
+    def get_cache_dict_by_id(self, primary_key_id, dependency_key='', cache_expire=1800, field="*", redis_config_dict=None):
+        """
+        :Description: 根据主键ID获取dict
+        :param primary_key_id: 主键ID值
+        :param dependencyKey: 依赖键
+        :param cache_expire: 缓存时间（单位秒）
+        :param field: 查询字段
+        :param redis_config_dict: redis_config_dict
+        :return: 返回匹配id的第一行字典数据
+        :last_editors: HuangJianYi
+        """
+        where = f"{self.primary_key_field}=%s"
+        params = [primary_key_id]
+        sql = f"SELECT {field} FROM {self.table_name} WHERE {where} LIMIT 1;"
+
+        dependency_key = self.get_dependency_key(str(dependency_key))
+        cache_key = self.get_cache_key('dictone',field,where,'','','',params)
+        one_row = self.get_dependency_cache(dependency_key,cache_key,redis_config_dict)
+        if one_row and share_config.get_value("is_redis_cache",True) == True:
+            self.log_cache(dependency_key, cache_key, one_row, sql, params)
+            if one_row == 'null':
+                return None
+            return one_row
+        else:
+            one_row = self.db.fetch_one_row(sql,params)
+            config_cache_expire = share_config.get_value("cache_expire",0)
+            if config_cache_expire > 0:
+                cache_expire = config_cache_expire
+            self.set_dependency_cache(dependency_key,cache_key,one_row,cache_expire,redis_config_dict)
+            if one_row:
+                for field in one_row:
+                    one_row[field] = self._BaseModel__convert_field_type(one_row[field])
+            return one_row
+
+    def get_cache_dict_list(self, where='', group_by='', order_by='', limit='', field="*", params=None, dependency_key='', cache_expire=1800, redis_config_dict=None):
+        """
+        :Description: 返回字典列表dict list
+        :param where: 数据库查询条件语句
+        :param group_by: GROUP BY 语句
+        :param order_by:  ORDER BY 语句
+        :param limit:  LIMIT 语句
+        :param field: 查询字段 
+        :param params: 参数化查询参数
+        :param dependencyKey: 依赖键
+        :param cache_expire: 缓存时间（单位秒）
+        :param redis_config_dict: redis_config_dict
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        if where and where.strip() != '':
+            where = " WHERE " + where
+        if group_by and group_by.strip() != '':
+            group_by = " GROUP BY "+group_by
+        if order_by and order_by.strip() != '':
+            order_by = " ORDER BY " + order_by
+        if limit:
+            limit = " LIMIT "+str(limit)
+        sql = f"SELECT {field} FROM {self.table_name}{where}{group_by}{order_by}{limit};"
+
+        dependency_key = self.get_dependency_key(str(dependency_key))
+        cache_key = self.get_cache_key('dictlist',field,where,group_by,order_by,limit,params)
+        list = self.get_dependency_cache(dependency_key,cache_key,redis_config_dict)
+        if list and share_config.get_value("is_redis_cache",True) == True:
+            self.log_cache(dependency_key, cache_key, list, sql, params)
+            return list
+        else:
+            list_row = self.db.fetch_all_rows(sql, params)
+            if not list_row:
+                list_row = []
+            config_cache_expire = share_config.get_value("cache_expire",0)
+            if config_cache_expire > 0:
+                cache_expire = config_cache_expire
+            self.set_dependency_cache(dependency_key,cache_key,list_row,cache_expire,redis_config_dict)
+            if list_row and len(list_row) > 0:
+                for one_row in list_row:
+                    for field in one_row:
+                        one_row[field] = self._BaseModel__convert_field_type(one_row[field])
+            return list_row
+
+    def get_cache_dict_page_list(self, field="*", page_index=0 ,page_size=20, where='', group_by='' ,order_by='' , params=None, dependency_key='', cache_expire=1800, page_count_mode='total', redis_config_dict=None):
+        """
+        :Description: 获取分页字典数据
+        :param field: 查询字段 
+        :param page_index: 分页页码 0为第一页
+        :param page_size: 分页返回数据数量
+        :param where: 数据库查询条件语句
+        :param group_by: GROUP BY 语句
+        :param order_by:  ORDER BY 语句
+        :param params: 参数化查询参数
+        :param dependencyKey: 依赖键
+        :param cache_expire: 缓存时间（单位秒）
+        :param page_count_mode: 分页计数模式 total-计算总数(默认) next-计算是否有下一页(bool) none-不计算
+        :param redis_config_dict: redis_config_dict
+        :return: 数据字典数组
+        :last_editors: HuangJianYi
+        """
+        if where and where.strip() != '':
+            where = " WHERE " + where
+        if group_by and group_by.strip() != '':
+            group_by = " GROUP BY " + group_by
+        if order_by and order_by.strip() != '':
+            order_by = " ORDER BY " + order_by
+
+        limit = f"{str(int(page_index) * int(page_size))},{str(page_size if page_count_mode != 'next' else page_size+1)}"
+        sql = f"SELECT {field} FROM {self.table_name}{where}{group_by}{order_by} LIMIT {limit}"
+
+        dependency_key = self.get_dependency_key(str(dependency_key))
+        cache_key = self.get_cache_key('dictpagelist',field,where,group_by,order_by,limit,params)
+        page_list = self.get_dependency_cache(dependency_key,cache_key,redis_config_dict)
+        if page_list and share_config.get_value("is_redis_cache",True) == True:
+            self.log_cache(dependency_key, cache_key, page_list, sql, params)
+            if page_count_mode == "total":
+                return page_list["data"],page_list["row_count"]
+            elif page_count_mode == "next":
+                return page_list["data"],bool(page_list["is_next_page"])
+            else:
+                return page_list["data"]
+        else:
+            config_cache_expire = share_config.get_value("cache_expire",0)
+            if config_cache_expire > 0:
+                cache_expire = config_cache_expire
+            page_list = {}
+            list_row = self.db.fetch_all_rows(sql, params)
+            if not list_row:
+                list_row = []
+            if list_row and len(list_row) > 0:
+                for one_row in list_row:
+                    for field in one_row:
+                        one_row[field] = self._BaseModel__convert_field_type(one_row[field])
+            if page_count_mode == "total":
+                sql = f"SELECT COUNT({self.primary_key_field}) AS count FROM {self.table_name}{where}{group_by}"
+                if group_by:
+                    sql = f"SELECT COUNT(*) as count FROM ({sql}) temp_table;"
+                row = self.db.fetch_one_row(sql, params)
+                if row and 'count' in row and int(row['count']) > 0:
+                    row_count = int(row["count"])
+                else:
+                    row_count = 0
+                page_list["data"] = list_row
+                page_list["row_count"] = row_count
+                self.set_dependency_cache(dependency_key,cache_key,page_list,cache_expire,redis_config_dict)
+                return list_row, row_count
+            elif page_count_mode == "next":
+                is_next_page = len(list_row) == page_size+1
+                if list_row and len(list_row) > 0:
+                    list_row = list_row[:page_size]
+                page_list["data"] = list_row
+                page_list["is_next_page"] = is_next_page
+                self.set_dependency_cache(dependency_key,cache_key,page_list,cache_expire,redis_config_dict)
+                return list_row, is_next_page
+            else:
+                page_list["data"] = list_row
+                self.set_dependency_cache(dependency_key,cache_key,page_list,cache_expire,redis_config_dict)
+                return list_row
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/cms_base_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/cms_base_model.py`

 * *Ordering differences only*

 * *Files 13% similar despite different names*

```diff
@@ -1,257 +1,257 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-11-26 10:22:44
-@LastEditTime: 2023-02-16 17:31:18
-@LastEditors: HuangJianYi
-@Description: 
-"""
-from seven_cloudapp_frame.models.seven_model import *
-from seven_cloudapp_frame.libs.customize.seven_helper import *
-from seven_cloudapp_frame.models.seven_model import PageInfo
-from seven_cloudapp_frame.models.db_models.cms.cms_info_model import *
-
-class CmsBaseModel():
-    """
-    :description: 资讯相关业务模型 用于后台或者中台案例和教程等配置信息、字典表用于管理标签、分类等信息
-    """
-    def __init__(self,context=None,logging_error=None,logging_info=None):
-        self.context = context
-        self.logging_link_error = logging_error
-        self.logging_link_info = logging_info
-
-    def _delete_cms_info_dependency_key(self, place_id, delay_delete_time=0.01):
-        """
-        :description: 删除资讯信息依赖建
-        :param place_id: 位置标识
-        :param act_id: 活动标识
-        :param delay_delete_time: 延迟删除时间，传0则不进行延迟
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        CmsInfoModel().delete_dependency_key(DependencyKey.cms_info_list(place_id), delay_delete_time)
-
-    def save_cms_info(self, place_id, cms_id, app_id, act_id, info_title=None, simple_title=None, simple_title_url=None, info_type=-1, info_summary=None, info_tag=None, info_mark=None, target_url=None, min_pic=None, mid_pic=None, max_pic=None, info_data=None, pic_collect_json=None, sort_index=-1, is_release=-1, i1=-1, i2=-1, i3=-1, i4=-1, s1=None, s2=None, s3=None, s4=None):
-        """
-        :description: 保存资讯信息
-        :param place_id：位置标识
-        :param cms_id：信息标识
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param info_title：信息标题
-        :param simple_title：信息短标题
-        :param simple_title_url：短标题链接
-        :param info_type：短标题链接
-        :param info_summary：短标题链接
-        :param info_tag：信息标签[文章内容特性][砍人事件]
-        :param info_mark：信息标记[首发,推荐,独家，热门]
-        :param target_url：跳转地址
-        :param min_pic：信息小图
-        :param mid_pic：信息中图
-        :param max_pic：信息大图
-        :param info_data：信息内容
-        :param pic_collect_json：图集json
-        :param sort_index：排序
-        :param is_release：是否发布（1是0否）
-        :param i1：i1
-        :param i2：i2
-        :param i3：i3
-        :param i4：i4
-        :param s1：s1
-        :param s2：s2
-        :param s3：s3
-        :param s4：s4
-        :return
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        old_cms_info = None
-        cms_info = None
-        is_add = False
-        cms_info_model = CmsInfoModel(context=self.context)
-        if cms_id > 0:
-            cms_info = cms_info_model.get_entity_by_id(cms_id)
-            if not cms_info or (app_id and cms_info.app_id != app_id):
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "error"
-                invoke_result_data.error_message = "信息不存在"
-                return invoke_result_data
-            old_cms_info = deepcopy(cms_info)
-        if not cms_info:
-            is_add = True
-            cms_info = CmsInfo()
-        if is_add:
-            cms_info.place_id = place_id
-            cms_info.app_id = app_id
-            cms_info.act_id = act_id
-            cms_info.info_title = info_title
-            cms_info.simple_title = simple_title
-            cms_info.simple_title_url = simple_title_url
-            cms_info.info_type = info_type
-            cms_info.info_summary = info_summary
-            cms_info.info_tag = info_tag
-            cms_info.info_mark = info_mark
-            cms_info.target_url = target_url
-            cms_info.min_pic = min_pic
-            cms_info.mid_pic = mid_pic
-            cms_info.max_pic = max_pic
-            cms_info.info_data = info_data
-            cms_info.pic_collect_json = pic_collect_json if pic_collect_json else []
-            cms_info.sort_index = sort_index
-            cms_info.i1 = i1
-            cms_info.i2 = i2
-            cms_info.i3 = i3
-            cms_info.i4 = i4
-            cms_info.s1 = s1
-            cms_info.s2 = s2
-            cms_info.s3 = s3
-            cms_info.s4 = s4
-            cms_info.modify_date = SevenHelper.get_now_datetime()
-            cms_info.is_release = is_release
-            if is_release == 1:
-                cms_info.release_date = cms_info.modify_date
-            cms_info.create_date = cms_info.modify_date
-            cms_info.id = cms_info_model.add_entity(cms_info)
-        else:
-            cms_info.info_title = info_title if info_title !=None else cms_info.info_title
-            cms_info.simple_title = simple_title if simple_title !=None  else cms_info.simple_title
-            cms_info.simple_title_url = simple_title_url if simple_title_url !=None else cms_info.simple_title_url
-            cms_info.info_type = info_type if info_type !=-1 else cms_info.info_type
-            cms_info.info_summary = info_summary if info_summary !=None else cms_info.info_summary
-            cms_info.info_tag = info_tag if info_tag !=None else cms_info.info_tag
-            cms_info.info_mark = info_mark if info_mark !=None else cms_info.info_mark
-            cms_info.target_url = target_url if target_url !=None else cms_info.target_url
-            cms_info.min_pic = min_pic if min_pic !=None else cms_info.min_pic
-            cms_info.mid_pic = mid_pic if mid_pic !=None else cms_info.mid_pic
-            cms_info.max_pic = max_pic if max_pic !=None else cms_info.max_pic
-            cms_info.info_data = info_data if info_data !=None else cms_info.info_data
-            cms_info.pic_collect_json = pic_collect_json if pic_collect_json !=None else cms_info.pic_collect_json
-            cms_info.sort_index = sort_index if sort_index !=-1 else cms_info.sort_index
-            cms_info.i1 = i1 if i1 !=-1 else cms_info.i1
-            cms_info.i2 = i2 if i2 !=-1 else cms_info.i2
-            cms_info.i3 = i3 if i3 !=-1 else cms_info.i3
-            cms_info.i4 = i4 if i4 !=-1 else cms_info.i4
-            cms_info.s1 = s1 if s1 !=None else cms_info.s1
-            cms_info.s2 = s2 if s2 !=None else cms_info.s2
-            cms_info.s3 = s3 if s3 !=None else cms_info.s3
-            cms_info.s4 = s4 if s4 !=None else cms_info.s4
-            cms_info.modify_date = SevenHelper.get_now_datetime()
-            cms_info.is_release = is_release if is_release !=-1 else cms_info.is_release
-            if is_release == 1:
-                cms_info.release_date = cms_info.modify_date
-            cms_info_model.update_entity(cms_info,exclude_field_list="place_id,app_id,act_id,create_date")
-        result = {}
-        result["is_add"] = is_add
-        result["new"] = cms_info
-        result["old"] = old_cms_info
-        invoke_result_data.data = result
-        self._delete_cms_info_dependency_key(place_id)
-        return invoke_result_data
-
-    def delete_cms_info(self,app_id,cms_id):
-        """
-        :description: 删除资讯信息
-        :param app_id：应用标识
-        :param cms_id：资讯标识
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        cms_info_model = CmsInfoModel(context=self.context)
-        cms_info_dict = cms_info_model.get_dict_by_id(cms_id)
-        if not cms_info_dict or cms_info_dict["app_id"] != app_id:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "资讯信息不存在"
-            return invoke_result_data
-        invoke_result_data.success = cms_info_model.del_entity("id=%s",params=[cms_info_dict["id"]])
-        self._delete_cms_info_dependency_key(cms_info_dict["place_id"])
-        invoke_result_data.data = cms_info_dict
-        return invoke_result_data
-
-    def release_cms_info(self,app_id,cms_id,is_release):
-        """
-        :description: 活动奖品上下架
-        :param app_id：应用标识
-        :param cms_id：资讯标识
-        :param is_release: 是否发布 1-是 0-否
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        cms_info_model = CmsInfoModel(context=self.context)
-        cms_info_dict = cms_info_model.get_dict_by_id(cms_id)
-        if not cms_info_dict or cms_info_dict["app_id"] != app_id:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "资讯信息不存在"
-            return invoke_result_data
-        modify_date = SevenHelper.get_now_datetime()
-        invoke_result_data.success = cms_info_model.update_table("modify_date=%s,is_release=%s", "id=%s", [modify_date, is_release, cms_id])
-        self._delete_cms_info_dependency_key(cms_info_dict["place_id"])
-        invoke_result_data.data = cms_info_dict
-        return invoke_result_data
-
-    def get_cms_info_list(self, place_id, page_size, page_index, order_by="id desc",field="*", app_id="", act_id=0, is_cache=True, page_count_mode="total"):
-        """
-        :description: 位置信息列表
-        :param place_id：位置标识
-        :param page_size：页大小
-        :param page_index：页索引
-        :param order_by：排序
-        :param field：查询字段
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param is_cache：是否缓存
-        :param page_count_mode: 分页计数模式 total-计算总数(默认) next-计算是否有下一页(bool) none-不计算       
-        :return:
-        :last_editors: HuangJianYi
-        """
-        page_list = []
-        condition = "place_id=%s and is_release=1"
-        params = [place_id]
-        if app_id:
-            condition+=" and app_id=%s"
-            params.append(app_id)
-        if act_id:
-            condition+=" and act_id=%s"
-            params.append(act_id)
-
-        cms_info_model = CmsInfoModel(context=self.context)
-        if is_cache == True:
-            page_list = cms_info_model.get_cache_dict_page_list(field=field, page_index=page_index, page_size=page_size, where=condition, group_by="", order_by=order_by,params=params,dependency_key=DependencyKey.cms_info_list(place_id),cache_expire=600,page_count_mode=page_count_mode)
-        else:
-            page_list = cms_info_model.get_dict_page_list(field=field, page_index=page_index, page_size=page_size, where=condition, group_by="", order_by=order_by,params=params,page_count_mode=page_count_mode)
-        
-        return page_list
-    
-    def get_cms_info_list_v2(self, place_id, page_size, page_index, order_by="id desc", field="*", condition=None, params=None, is_cache=True, page_count_mode="total"):
-        """
-        :description: 位置信息列表
-        :param place_id：位置标识
-        :param page_size：页大小
-        :param page_index：页索引
-        :param order_by：排序
-        :param field：查询字段
-        :param condition：查询条件
-        :param params：参数数组
-        :param is_cache：是否缓存
-        :param page_count_mode: 分页计数模式 total-计算总数(默认) next-计算是否有下一页(bool) none-不计算       
-        :return:
-        :last_editors: HuangJianYi
-        """
-        page_list = []
-        condition_where = ConditionWhere()
-        condition_where.add_condition("place_id=%s")
-        params_list = [place_id]
-        if condition:
-            condition_where.add_condition(condition)
-            params_list.extend(params)
-
-        cms_info_model = CmsInfoModel(context=self.context)
-        if is_cache == True:
-            page_list = cms_info_model.get_cache_dict_page_list(field=field, page_index=page_index, page_size=page_size, where=condition_where.to_string(), group_by="", order_by=order_by,params=params_list,dependency_key=DependencyKey.cms_info_list(place_id),cache_expire=600,page_count_mode=page_count_mode)
-        else:
-            page_list = cms_info_model.get_dict_page_list(field=field, page_index=page_index, page_size=page_size, where=condition_where.to_string(), group_by="", order_by=order_by,params=params_list,page_count_mode=page_count_mode)
-        
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-11-26 10:22:44
+@LastEditTime: 2023-02-16 17:31:18
+@LastEditors: HuangJianYi
+@Description: 
+"""
+from seven_cloudapp_frame.models.seven_model import *
+from seven_cloudapp_frame.libs.customize.seven_helper import *
+from seven_cloudapp_frame.models.seven_model import PageInfo
+from seven_cloudapp_frame.models.db_models.cms.cms_info_model import *
+
+class CmsBaseModel():
+    """
+    :description: 资讯相关业务模型 用于后台或者中台案例和教程等配置信息、字典表用于管理标签、分类等信息
+    """
+    def __init__(self,context=None,logging_error=None,logging_info=None):
+        self.context = context
+        self.logging_link_error = logging_error
+        self.logging_link_info = logging_info
+
+    def _delete_cms_info_dependency_key(self, place_id, delay_delete_time=0.01):
+        """
+        :description: 删除资讯信息依赖建
+        :param place_id: 位置标识
+        :param act_id: 活动标识
+        :param delay_delete_time: 延迟删除时间，传0则不进行延迟
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        CmsInfoModel().delete_dependency_key(DependencyKey.cms_info_list(place_id), delay_delete_time)
+
+    def save_cms_info(self, place_id, cms_id, app_id, act_id, info_title=None, simple_title=None, simple_title_url=None, info_type=-1, info_summary=None, info_tag=None, info_mark=None, target_url=None, min_pic=None, mid_pic=None, max_pic=None, info_data=None, pic_collect_json=None, sort_index=-1, is_release=-1, i1=-1, i2=-1, i3=-1, i4=-1, s1=None, s2=None, s3=None, s4=None):
+        """
+        :description: 保存资讯信息
+        :param place_id：位置标识
+        :param cms_id：信息标识
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param info_title：信息标题
+        :param simple_title：信息短标题
+        :param simple_title_url：短标题链接
+        :param info_type：短标题链接
+        :param info_summary：短标题链接
+        :param info_tag：信息标签[文章内容特性][砍人事件]
+        :param info_mark：信息标记[首发,推荐,独家，热门]
+        :param target_url：跳转地址
+        :param min_pic：信息小图
+        :param mid_pic：信息中图
+        :param max_pic：信息大图
+        :param info_data：信息内容
+        :param pic_collect_json：图集json
+        :param sort_index：排序
+        :param is_release：是否发布（1是0否）
+        :param i1：i1
+        :param i2：i2
+        :param i3：i3
+        :param i4：i4
+        :param s1：s1
+        :param s2：s2
+        :param s3：s3
+        :param s4：s4
+        :return
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        old_cms_info = None
+        cms_info = None
+        is_add = False
+        cms_info_model = CmsInfoModel(context=self.context)
+        if cms_id > 0:
+            cms_info = cms_info_model.get_entity_by_id(cms_id)
+            if not cms_info or (app_id and cms_info.app_id != app_id):
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "error"
+                invoke_result_data.error_message = "信息不存在"
+                return invoke_result_data
+            old_cms_info = deepcopy(cms_info)
+        if not cms_info:
+            is_add = True
+            cms_info = CmsInfo()
+        if is_add:
+            cms_info.place_id = place_id
+            cms_info.app_id = app_id
+            cms_info.act_id = act_id
+            cms_info.info_title = info_title
+            cms_info.simple_title = simple_title
+            cms_info.simple_title_url = simple_title_url
+            cms_info.info_type = info_type
+            cms_info.info_summary = info_summary
+            cms_info.info_tag = info_tag
+            cms_info.info_mark = info_mark
+            cms_info.target_url = target_url
+            cms_info.min_pic = min_pic
+            cms_info.mid_pic = mid_pic
+            cms_info.max_pic = max_pic
+            cms_info.info_data = info_data
+            cms_info.pic_collect_json = pic_collect_json if pic_collect_json else []
+            cms_info.sort_index = sort_index
+            cms_info.i1 = i1
+            cms_info.i2 = i2
+            cms_info.i3 = i3
+            cms_info.i4 = i4
+            cms_info.s1 = s1
+            cms_info.s2 = s2
+            cms_info.s3 = s3
+            cms_info.s4 = s4
+            cms_info.modify_date = SevenHelper.get_now_datetime()
+            cms_info.is_release = is_release
+            if is_release == 1:
+                cms_info.release_date = cms_info.modify_date
+            cms_info.create_date = cms_info.modify_date
+            cms_info.id = cms_info_model.add_entity(cms_info)
+        else:
+            cms_info.info_title = info_title if info_title !=None else cms_info.info_title
+            cms_info.simple_title = simple_title if simple_title !=None  else cms_info.simple_title
+            cms_info.simple_title_url = simple_title_url if simple_title_url !=None else cms_info.simple_title_url
+            cms_info.info_type = info_type if info_type !=-1 else cms_info.info_type
+            cms_info.info_summary = info_summary if info_summary !=None else cms_info.info_summary
+            cms_info.info_tag = info_tag if info_tag !=None else cms_info.info_tag
+            cms_info.info_mark = info_mark if info_mark !=None else cms_info.info_mark
+            cms_info.target_url = target_url if target_url !=None else cms_info.target_url
+            cms_info.min_pic = min_pic if min_pic !=None else cms_info.min_pic
+            cms_info.mid_pic = mid_pic if mid_pic !=None else cms_info.mid_pic
+            cms_info.max_pic = max_pic if max_pic !=None else cms_info.max_pic
+            cms_info.info_data = info_data if info_data !=None else cms_info.info_data
+            cms_info.pic_collect_json = pic_collect_json if pic_collect_json !=None else cms_info.pic_collect_json
+            cms_info.sort_index = sort_index if sort_index !=-1 else cms_info.sort_index
+            cms_info.i1 = i1 if i1 !=-1 else cms_info.i1
+            cms_info.i2 = i2 if i2 !=-1 else cms_info.i2
+            cms_info.i3 = i3 if i3 !=-1 else cms_info.i3
+            cms_info.i4 = i4 if i4 !=-1 else cms_info.i4
+            cms_info.s1 = s1 if s1 !=None else cms_info.s1
+            cms_info.s2 = s2 if s2 !=None else cms_info.s2
+            cms_info.s3 = s3 if s3 !=None else cms_info.s3
+            cms_info.s4 = s4 if s4 !=None else cms_info.s4
+            cms_info.modify_date = SevenHelper.get_now_datetime()
+            cms_info.is_release = is_release if is_release !=-1 else cms_info.is_release
+            if is_release == 1:
+                cms_info.release_date = cms_info.modify_date
+            cms_info_model.update_entity(cms_info,exclude_field_list="place_id,app_id,act_id,create_date")
+        result = {}
+        result["is_add"] = is_add
+        result["new"] = cms_info
+        result["old"] = old_cms_info
+        invoke_result_data.data = result
+        self._delete_cms_info_dependency_key(place_id)
+        return invoke_result_data
+
+    def delete_cms_info(self,app_id,cms_id):
+        """
+        :description: 删除资讯信息
+        :param app_id：应用标识
+        :param cms_id：资讯标识
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        cms_info_model = CmsInfoModel(context=self.context)
+        cms_info_dict = cms_info_model.get_dict_by_id(cms_id)
+        if not cms_info_dict or cms_info_dict["app_id"] != app_id:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "资讯信息不存在"
+            return invoke_result_data
+        invoke_result_data.success = cms_info_model.del_entity("id=%s",params=[cms_info_dict["id"]])
+        self._delete_cms_info_dependency_key(cms_info_dict["place_id"])
+        invoke_result_data.data = cms_info_dict
+        return invoke_result_data
+
+    def release_cms_info(self,app_id,cms_id,is_release):
+        """
+        :description: 活动奖品上下架
+        :param app_id：应用标识
+        :param cms_id：资讯标识
+        :param is_release: 是否发布 1-是 0-否
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        cms_info_model = CmsInfoModel(context=self.context)
+        cms_info_dict = cms_info_model.get_dict_by_id(cms_id)
+        if not cms_info_dict or cms_info_dict["app_id"] != app_id:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "资讯信息不存在"
+            return invoke_result_data
+        modify_date = SevenHelper.get_now_datetime()
+        invoke_result_data.success = cms_info_model.update_table("modify_date=%s,is_release=%s", "id=%s", [modify_date, is_release, cms_id])
+        self._delete_cms_info_dependency_key(cms_info_dict["place_id"])
+        invoke_result_data.data = cms_info_dict
+        return invoke_result_data
+
+    def get_cms_info_list(self, place_id, page_size, page_index, order_by="id desc",field="*", app_id="", act_id=0, is_cache=True, page_count_mode="total"):
+        """
+        :description: 位置信息列表
+        :param place_id：位置标识
+        :param page_size：页大小
+        :param page_index：页索引
+        :param order_by：排序
+        :param field：查询字段
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param is_cache：是否缓存
+        :param page_count_mode: 分页计数模式 total-计算总数(默认) next-计算是否有下一页(bool) none-不计算       
+        :return:
+        :last_editors: HuangJianYi
+        """
+        page_list = []
+        condition = "place_id=%s and is_release=1"
+        params = [place_id]
+        if app_id:
+            condition+=" and app_id=%s"
+            params.append(app_id)
+        if act_id:
+            condition+=" and act_id=%s"
+            params.append(act_id)
+
+        cms_info_model = CmsInfoModel(context=self.context)
+        if is_cache == True:
+            page_list = cms_info_model.get_cache_dict_page_list(field=field, page_index=page_index, page_size=page_size, where=condition, group_by="", order_by=order_by,params=params,dependency_key=DependencyKey.cms_info_list(place_id),cache_expire=600,page_count_mode=page_count_mode)
+        else:
+            page_list = cms_info_model.get_dict_page_list(field=field, page_index=page_index, page_size=page_size, where=condition, group_by="", order_by=order_by,params=params,page_count_mode=page_count_mode)
+        
+        return page_list
+    
+    def get_cms_info_list_v2(self, place_id, page_size, page_index, order_by="id desc", field="*", condition=None, params=None, is_cache=True, page_count_mode="total"):
+        """
+        :description: 位置信息列表
+        :param place_id：位置标识
+        :param page_size：页大小
+        :param page_index：页索引
+        :param order_by：排序
+        :param field：查询字段
+        :param condition：查询条件
+        :param params：参数数组
+        :param is_cache：是否缓存
+        :param page_count_mode: 分页计数模式 total-计算总数(默认) next-计算是否有下一页(bool) none-不计算       
+        :return:
+        :last_editors: HuangJianYi
+        """
+        page_list = []
+        condition_where = ConditionWhere()
+        condition_where.add_condition("place_id=%s")
+        params_list = [place_id]
+        if condition:
+            condition_where.add_condition(condition)
+            params_list.extend(params)
+
+        cms_info_model = CmsInfoModel(context=self.context)
+        if is_cache == True:
+            page_list = cms_info_model.get_cache_dict_page_list(field=field, page_index=page_index, page_size=page_size, where=condition_where.to_string(), group_by="", order_by=order_by,params=params_list,dependency_key=DependencyKey.cms_info_list(place_id),cache_expire=600,page_count_mode=page_count_mode)
+        else:
+            page_list = cms_info_model.get_dict_page_list(field=field, page_index=page_index, page_size=page_size, where=condition_where.to_string(), group_by="", order_by=order_by,params=params_list,page_count_mode=page_count_mode)
+        
         return page_list
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/console_models/asset_console_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/console_models/asset_console_model.py`

 * *Ordering differences only*

 * *Files 16% similar despite different names*

```diff
@@ -1,287 +1,287 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-19 13:37:16
-@LastEditTime: 2023-04-20 19:18:05
-@LastEditors: HuangJianYi
-@Description: 
-"""
-import threading, multiprocessing
-from seven_framework.console.base_console import *
-from seven_cloudapp_frame.libs.customize.seven_helper import *
-from seven_cloudapp_frame.models.db_models.asset.asset_inventory_model import *
-from seven_cloudapp_frame.models.db_models.asset.asset_warn_notice_model import *
-
-
-
-class AssetConsoleModel():
-    """
-    :description: 资产控制台业务模型
-    """
-    def console_asset(self, mod_count=1):
-        """
-        :description: 控制台资产预警
-        :param mod_count: 单表队列数
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        for i in range(mod_count):
-            j = threading.Thread(target=self._process_asset_inventory_warn, args=[i, mod_count])
-            j.start()
-
-        n = threading.Thread(target=self._process_asset_inventory_queue, args=[])
-        n.start()
-
-        t = threading.Thread(target=self._process_asset_intercept_queue, args=[])
-        t.start()
-
-    def _process_onlyid_warn(self):
-        """
-        :description: 处理唯一值并发预警
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        while True:
-            try:
-                time.sleep(0.1)
-                asset_warn_notice_model = AssetWarnNoticeModel()
-                redis_init = SevenHelper.redis_init()
-                hash_name_1 = f"warn_handler_list_{str(SevenHelper.get_now_int(fmt='%Y%m%d'))}"
-                hkeys = redis_init.hkeys(hash_name_1)
-                if len(hkeys)<=0:
-                    time.sleep(1)
-                    continue
-                for key in hkeys:
-                    date_start = TimeHelper.format_time_to_datetime(format='%Y-%m-%d %H:%M')
-                    date_end = date_start + datetime.timedelta(minutes=5)
-                    date_list = []
-                    while date_start < date_end:
-                        date_list.append(str(TimeHelper.datetime_to_format_time(date_start, '%Y%m%d%H%M')))
-                        date_start += datetime.timedelta(minutes=1)
-                    hash_name_2 = f"{hash_name_1}:{key}"
-                    value_list = redis_init.hmget(hash_name_2,date_list)
-                    if not value_list or len(value_list)<=0:
-                        continue
-                    count = 0
-                    for value in value_list:
-                        count += int(value)
-                    if count <= 0:
-                        continue
-                    hash_value_1 = redis_init.hget(hash_name_1,key)
-                    hash_value_1 = SevenHelper.json_loads(hash_value_1) if hash_value_1 else {"app_id":"","handler_name":""}
-                    asset_warn_notice = AssetWarnNotice()
-                    asset_warn_notice.app_id = hash_value_1["app_id"]
-                    asset_warn_notice.act_id = 0
-                    asset_warn_notice.ascription_type = 2
-                    asset_warn_notice.handler_name = hash_value_1["handler_name"]
-                    asset_warn_notice.request_code =""
-                    asset_warn_notice.user_id = ""
-                    asset_warn_notice.open_id = ""
-                    asset_warn_notice.user_nick = ""
-                    asset_warn_notice.asset_type = 0
-                    asset_warn_notice.asset_object_id = ""
-                    asset_warn_notice.log_title = "重复请求拦截"
-                    asset_warn_notice.info_desc = f"{date_start}-{date_end}进行了{count}次拦截"
-                    asset_warn_notice.info_json = {}
-                    asset_warn_notice.create_date = SevenHelper.get_now_datetime()
-                    asset_warn_notice.create_day = SevenHelper.get_now_day_int()
-                    asset_warn_notice_model.add_entity(asset_warn_notice)
-                time.sleep(5*60)
-            except Exception as ex:
-                time.sleep(5)
-
-    def _push_warn_notice(self):
-        """
-        :description: 推送预警通知到消息系统
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        while True:
-            try:
-                time.sleep(0.1)
-                asset_warn_notice_model = AssetWarnNoticeModel()
-                redis_init = SevenHelper.redis_init(config_dict=config.get_value("warn_redis"))
-                warn_notice_list = asset_warn_notice_model.get_list("is_notice=0 and ascription_type=1",order_by="create_date asc",limit="200")
-                if len(warn_notice_list) > 0:
-                    for warn_notice in warn_notice_list:
-                        try:
-                            push_message = {}
-                            push_message["project_id"] = int(config.get_value("project_name",0))
-                            push_message["app_id"] = warn_notice.app_id
-                            push_message["action_id"] = warn_notice.act_id
-                            push_message["taobao_nick_name"] = warn_notice.user_nick
-                            push_message["error_type"] = warn_notice.log_title
-                            push_message["error_message"] = warn_notice.info_desc
-                            push_message["handler"] = warn_notice.handler_name
-                            redis_init.lpush("warning_notice_queue", JsonHelper.json_dumps(push_message))
-                            warn_notice.is_notice = 1
-                            warn_notice.notice_date = SevenHelper.get_now_datetime()
-                            asset_warn_notice_model.update_entity(warn_notice,"is_notice,notice_date")
-                        except Exception as ex:
-                            logger_error.error(f"推送预警通知异常,json串:{SevenHelper.json_dumps(warn_notice)},ex:{traceback.format_exc()}")
-                            continue
-                time.sleep(1)
-            except Exception as ex:
-                time.sleep(5)
-
-    def _process_asset_inventory_warn(self, mod_value, mod_count):
-        """
-        :description: 处理资产每日进销存是否对等预警
-        :param mod_value: 当前队列值
-        :param mod_count: 队列数
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        print(f"{TimeHelper.get_now_format_time()} 资产每日进销存预警队列{mod_value}启动")
-        while True:
-            try:
-                time.sleep(0.1)
-                asset_inventory_model = AssetInventoryModel()
-                asset_warn_notice_model = AssetWarnNoticeModel()
-                now_date = TimeHelper.get_now_format_time()
-                now_day_int = SevenHelper.get_now_day_int()
-                if mod_count == 1:
-                    asset_inventory_list = asset_inventory_model.get_list(f"create_day={now_day_int} and process_count=0", order_by="create_date asc", limit="200")
-                else:
-                    asset_inventory_list = asset_inventory_model.get_list(f"create_day={now_day_int} and process_count=0 and MOD(user_id,{mod_count})={mod_value}", order_by="create_date asc", limit="200")
-                if len(asset_inventory_list) > 0:
-                    for asset_inventory in asset_inventory_list:
-                        try:
-                            asset_inventory.process_count = 1
-                            asset_inventory.process_date = now_date
-                            asset_inventory_model.update_entity(asset_inventory, "process_count,process_date")
-
-                            if (asset_inventory.history_value + asset_inventory.inc_value + asset_inventory.dec_value) != asset_inventory.now_value:
-
-                                asset_warn_notice = AssetWarnNotice()
-                                asset_warn_notice.app_id = asset_inventory.app_id
-                                asset_warn_notice.act_id = asset_inventory.act_id
-                                asset_warn_notice.handler_name = ""
-                                asset_warn_notice.request_code = ""
-                                asset_warn_notice.user_id = asset_inventory.user_id
-                                asset_warn_notice.open_id = asset_inventory.open_id
-                                asset_warn_notice.user_nick = asset_inventory.user_nick
-                                asset_warn_notice.asset_type = asset_inventory.asset_type
-                                asset_warn_notice.asset_object_id = asset_inventory.asset_object_id
-                                asset_warn_notice.info_desc = f"历史值:{asset_inventory.history_value},增加：{asset_inventory.inc_value},减少：{asset_inventory.dec_value},当前值:{asset_inventory.now_value}"
-                                if asset_inventory.asset_type == 1:
-                                    asset_warn_notice.log_title = "次数进销存异常"
-                                elif asset_inventory.asset_type == 2:
-                                    asset_warn_notice.log_title = "积分进销存异常"
-                                elif asset_inventory.asset_type == 3:
-                                    asset_warn_notice.log_title = "价格档位进销存异常"
-                                    asset_warn_notice.info_desc = f"档位ID:{asset_inventory.asset_object_id}," + asset_warn_notice.info_desc
-                                else:
-                                    asset_warn_notice.log_title = f"资产类型：{asset_inventory.asset_type}异常"
-                                asset_warn_notice.info_json = SevenHelper.json_dumps(asset_inventory)
-                                asset_warn_notice.create_date = now_date
-                                asset_warn_notice.create_day = now_day_int
-                                asset_warn_notice_model.add_entity(asset_warn_notice)
-
-                        except Exception as ex:
-                            logger_error.error(f"资产每日进销存预警队列{mod_value}异常,json串:{SevenHelper.json_dumps(asset_inventory)},ex:{traceback.format_exc()}")
-                            continue
-                else:
-                    time.sleep(60 * 60)
-            except Exception as ex:
-                time.sleep(5)
-
-    def _process_asset_inventory_queue(self):
-        """
-        :description: 处理资产队列入进销存
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        while True:
-            try:
-                time.sleep(0.1)
-                redis_init = SevenHelper.redis_init()
-                asset_inventory_model = AssetInventoryModel()
-                asset_queue_json = redis_init.lpop(f"asset_queue_list")
-                if not asset_queue_json:
-                    time.sleep(1)
-                    continue
-                asset_queue_dict = SevenHelper.json_loads(asset_queue_json)
-                try:
-                    old_asset_inventory_id = 0
-                    app_id = asset_queue_dict["app_id"]
-                    act_id = asset_queue_dict["act_id"]
-                    open_id = asset_queue_dict["open_id"]
-                    user_nick = asset_queue_dict["user_nick"]
-                    user_id = asset_queue_dict["user_id"]
-                    asset_type = asset_queue_dict["asset_type"]
-                    asset_object_id = asset_queue_dict["asset_object_id"]
-                    now_day_int = asset_queue_dict["now_day_int"]
-                    create_date = asset_queue_dict["create_date"]
-                    now_value = asset_queue_dict["now_value"]
-                    operate_value = asset_queue_dict["operate_value"]
-                    history_asset_value = asset_queue_dict["history_asset_value"]
-                    if act_id > 0:
-                        asset_inventory_id_md5 = CryptoHelper.md5_encrypt_int(f"{act_id}_{user_id}_{asset_type}_{asset_object_id}_{now_day_int}")
-                    else:
-                        asset_inventory_id_md5 = CryptoHelper.md5_encrypt_int(f"{app_id}_0_{user_id}_{asset_type}_{asset_object_id}_{now_day_int}")
-                    asset_inventory = asset_inventory_model.get_entity("id_md5=%s",params=[asset_inventory_id_md5])
-                    asset_inventory_update_sql = f"process_count=0,now_value={now_value}"
-                    if asset_inventory:
-                        old_asset_inventory_id = asset_inventory.id
-                        if operate_value > 0:
-                            asset_inventory_update_sql += f",inc_value=inc_value+{operate_value}"
-                        else:
-                            asset_inventory_update_sql += f",dec_value=dec_value+{operate_value}"
-                    else:
-                        asset_inventory = AssetInventory()
-                        asset_inventory.id_md5 = asset_inventory_id_md5
-                        asset_inventory.app_id = app_id
-                        asset_inventory.act_id = act_id
-                        asset_inventory.user_id = user_id
-                        asset_inventory.open_id = open_id
-                        asset_inventory.user_nick = user_nick
-                        asset_inventory.asset_type = asset_type
-                        asset_inventory.asset_object_id = asset_object_id
-                        if operate_value > 0:
-                            asset_inventory.inc_value += operate_value
-                        else:
-                            asset_inventory.dec_value += operate_value
-                        asset_inventory.history_value = history_asset_value
-                        asset_inventory.now_value = now_value
-                        asset_inventory.create_date = create_date
-                        asset_inventory.create_day = now_day_int
-                    if old_asset_inventory_id != 0:
-                        asset_inventory_model.update_table(asset_inventory_update_sql, "id=%s", params=[old_asset_inventory_id])
-                    else:
-                        asset_inventory_model.add_entity(asset_inventory)
-                except Exception as ex:
-                    asset_queue_dict["process_count"] += 1
-                    if asset_queue_dict["process_count"] <= 10:
-                        redis_init.rpush(f"asset_queue_list", SevenHelper.json_dumps(asset_queue_dict))
-                    else:
-                        logger_error.error(f"资产队列异常,json串:{SevenHelper.json_dumps(asset_queue_dict)},ex:{traceback.format_exc()}")
-                    continue
-            except Exception as ex:
-                logger_error.error(f"资产队列异常,ex:{traceback.format_exc()}")
-                time.sleep(5)
-
-    def _process_asset_intercept_queue(self):
-        """
-        :description: 处理资产拦截队列入库
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        while True:
-            try:
-                time.sleep(0.1)
-                redis_init = SevenHelper.redis_init()
-                asset_warn_notice_model = AssetWarnNoticeModel()
-                queue_json = redis_init.lpop(f"asset_intercept_queue_list")
-                if not queue_json:
-                    time.sleep(1)
-                    continue
-                try:
-                    queue_dict = SevenHelper.json_loads(queue_json)
-                    asset_warn_notice = SevenHelper.auto_mapper(AssetWarnNotice,queue_dict)
-                    asset_warn_notice_model.add_entity(asset_warn_notice)
-                except Exception as ex:
-                    continue
-            except Exception as ex:
-                logger_error.error(f"资产拦截队列异常,ex:{traceback.format_exc()}")
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-19 13:37:16
+@LastEditTime: 2023-04-20 19:18:05
+@LastEditors: HuangJianYi
+@Description: 
+"""
+import threading, multiprocessing
+from seven_framework.console.base_console import *
+from seven_cloudapp_frame.libs.customize.seven_helper import *
+from seven_cloudapp_frame.models.db_models.asset.asset_inventory_model import *
+from seven_cloudapp_frame.models.db_models.asset.asset_warn_notice_model import *
+
+
+
+class AssetConsoleModel():
+    """
+    :description: 资产控制台业务模型
+    """
+    def console_asset(self, mod_count=1):
+        """
+        :description: 控制台资产预警
+        :param mod_count: 单表队列数
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        for i in range(mod_count):
+            j = threading.Thread(target=self._process_asset_inventory_warn, args=[i, mod_count])
+            j.start()
+
+        n = threading.Thread(target=self._process_asset_inventory_queue, args=[])
+        n.start()
+
+        t = threading.Thread(target=self._process_asset_intercept_queue, args=[])
+        t.start()
+
+    def _process_onlyid_warn(self):
+        """
+        :description: 处理唯一值并发预警
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        while True:
+            try:
+                time.sleep(0.1)
+                asset_warn_notice_model = AssetWarnNoticeModel()
+                redis_init = SevenHelper.redis_init()
+                hash_name_1 = f"warn_handler_list_{str(SevenHelper.get_now_int(fmt='%Y%m%d'))}"
+                hkeys = redis_init.hkeys(hash_name_1)
+                if len(hkeys)<=0:
+                    time.sleep(1)
+                    continue
+                for key in hkeys:
+                    date_start = TimeHelper.format_time_to_datetime(format='%Y-%m-%d %H:%M')
+                    date_end = date_start + datetime.timedelta(minutes=5)
+                    date_list = []
+                    while date_start < date_end:
+                        date_list.append(str(TimeHelper.datetime_to_format_time(date_start, '%Y%m%d%H%M')))
+                        date_start += datetime.timedelta(minutes=1)
+                    hash_name_2 = f"{hash_name_1}:{key}"
+                    value_list = redis_init.hmget(hash_name_2,date_list)
+                    if not value_list or len(value_list)<=0:
+                        continue
+                    count = 0
+                    for value in value_list:
+                        count += int(value)
+                    if count <= 0:
+                        continue
+                    hash_value_1 = redis_init.hget(hash_name_1,key)
+                    hash_value_1 = SevenHelper.json_loads(hash_value_1) if hash_value_1 else {"app_id":"","handler_name":""}
+                    asset_warn_notice = AssetWarnNotice()
+                    asset_warn_notice.app_id = hash_value_1["app_id"]
+                    asset_warn_notice.act_id = 0
+                    asset_warn_notice.ascription_type = 2
+                    asset_warn_notice.handler_name = hash_value_1["handler_name"]
+                    asset_warn_notice.request_code =""
+                    asset_warn_notice.user_id = ""
+                    asset_warn_notice.open_id = ""
+                    asset_warn_notice.user_nick = ""
+                    asset_warn_notice.asset_type = 0
+                    asset_warn_notice.asset_object_id = ""
+                    asset_warn_notice.log_title = "重复请求拦截"
+                    asset_warn_notice.info_desc = f"{date_start}-{date_end}进行了{count}次拦截"
+                    asset_warn_notice.info_json = {}
+                    asset_warn_notice.create_date = SevenHelper.get_now_datetime()
+                    asset_warn_notice.create_day = SevenHelper.get_now_day_int()
+                    asset_warn_notice_model.add_entity(asset_warn_notice)
+                time.sleep(5*60)
+            except Exception as ex:
+                time.sleep(5)
+
+    def _push_warn_notice(self):
+        """
+        :description: 推送预警通知到消息系统
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        while True:
+            try:
+                time.sleep(0.1)
+                asset_warn_notice_model = AssetWarnNoticeModel()
+                redis_init = SevenHelper.redis_init(config_dict=config.get_value("warn_redis"))
+                warn_notice_list = asset_warn_notice_model.get_list("is_notice=0 and ascription_type=1",order_by="create_date asc",limit="200")
+                if len(warn_notice_list) > 0:
+                    for warn_notice in warn_notice_list:
+                        try:
+                            push_message = {}
+                            push_message["project_id"] = int(config.get_value("project_name",0))
+                            push_message["app_id"] = warn_notice.app_id
+                            push_message["action_id"] = warn_notice.act_id
+                            push_message["taobao_nick_name"] = warn_notice.user_nick
+                            push_message["error_type"] = warn_notice.log_title
+                            push_message["error_message"] = warn_notice.info_desc
+                            push_message["handler"] = warn_notice.handler_name
+                            redis_init.lpush("warning_notice_queue", JsonHelper.json_dumps(push_message))
+                            warn_notice.is_notice = 1
+                            warn_notice.notice_date = SevenHelper.get_now_datetime()
+                            asset_warn_notice_model.update_entity(warn_notice,"is_notice,notice_date")
+                        except Exception as ex:
+                            logger_error.error(f"推送预警通知异常,json串:{SevenHelper.json_dumps(warn_notice)},ex:{traceback.format_exc()}")
+                            continue
+                time.sleep(1)
+            except Exception as ex:
+                time.sleep(5)
+
+    def _process_asset_inventory_warn(self, mod_value, mod_count):
+        """
+        :description: 处理资产每日进销存是否对等预警
+        :param mod_value: 当前队列值
+        :param mod_count: 队列数
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        print(f"{TimeHelper.get_now_format_time()} 资产每日进销存预警队列{mod_value}启动")
+        while True:
+            try:
+                time.sleep(0.1)
+                asset_inventory_model = AssetInventoryModel()
+                asset_warn_notice_model = AssetWarnNoticeModel()
+                now_date = TimeHelper.get_now_format_time()
+                now_day_int = SevenHelper.get_now_day_int()
+                if mod_count == 1:
+                    asset_inventory_list = asset_inventory_model.get_list(f"create_day={now_day_int} and process_count=0", order_by="create_date asc", limit="200")
+                else:
+                    asset_inventory_list = asset_inventory_model.get_list(f"create_day={now_day_int} and process_count=0 and MOD(user_id,{mod_count})={mod_value}", order_by="create_date asc", limit="200")
+                if len(asset_inventory_list) > 0:
+                    for asset_inventory in asset_inventory_list:
+                        try:
+                            asset_inventory.process_count = 1
+                            asset_inventory.process_date = now_date
+                            asset_inventory_model.update_entity(asset_inventory, "process_count,process_date")
+
+                            if (asset_inventory.history_value + asset_inventory.inc_value + asset_inventory.dec_value) != asset_inventory.now_value:
+
+                                asset_warn_notice = AssetWarnNotice()
+                                asset_warn_notice.app_id = asset_inventory.app_id
+                                asset_warn_notice.act_id = asset_inventory.act_id
+                                asset_warn_notice.handler_name = ""
+                                asset_warn_notice.request_code = ""
+                                asset_warn_notice.user_id = asset_inventory.user_id
+                                asset_warn_notice.open_id = asset_inventory.open_id
+                                asset_warn_notice.user_nick = asset_inventory.user_nick
+                                asset_warn_notice.asset_type = asset_inventory.asset_type
+                                asset_warn_notice.asset_object_id = asset_inventory.asset_object_id
+                                asset_warn_notice.info_desc = f"历史值:{asset_inventory.history_value},增加：{asset_inventory.inc_value},减少：{asset_inventory.dec_value},当前值:{asset_inventory.now_value}"
+                                if asset_inventory.asset_type == 1:
+                                    asset_warn_notice.log_title = "次数进销存异常"
+                                elif asset_inventory.asset_type == 2:
+                                    asset_warn_notice.log_title = "积分进销存异常"
+                                elif asset_inventory.asset_type == 3:
+                                    asset_warn_notice.log_title = "价格档位进销存异常"
+                                    asset_warn_notice.info_desc = f"档位ID:{asset_inventory.asset_object_id}," + asset_warn_notice.info_desc
+                                else:
+                                    asset_warn_notice.log_title = f"资产类型：{asset_inventory.asset_type}异常"
+                                asset_warn_notice.info_json = SevenHelper.json_dumps(asset_inventory)
+                                asset_warn_notice.create_date = now_date
+                                asset_warn_notice.create_day = now_day_int
+                                asset_warn_notice_model.add_entity(asset_warn_notice)
+
+                        except Exception as ex:
+                            logger_error.error(f"资产每日进销存预警队列{mod_value}异常,json串:{SevenHelper.json_dumps(asset_inventory)},ex:{traceback.format_exc()}")
+                            continue
+                else:
+                    time.sleep(60 * 60)
+            except Exception as ex:
+                time.sleep(5)
+
+    def _process_asset_inventory_queue(self):
+        """
+        :description: 处理资产队列入进销存
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        while True:
+            try:
+                time.sleep(0.1)
+                redis_init = SevenHelper.redis_init()
+                asset_inventory_model = AssetInventoryModel()
+                asset_queue_json = redis_init.lpop(f"asset_queue_list")
+                if not asset_queue_json:
+                    time.sleep(1)
+                    continue
+                asset_queue_dict = SevenHelper.json_loads(asset_queue_json)
+                try:
+                    old_asset_inventory_id = 0
+                    app_id = asset_queue_dict["app_id"]
+                    act_id = asset_queue_dict["act_id"]
+                    open_id = asset_queue_dict["open_id"]
+                    user_nick = asset_queue_dict["user_nick"]
+                    user_id = asset_queue_dict["user_id"]
+                    asset_type = asset_queue_dict["asset_type"]
+                    asset_object_id = asset_queue_dict["asset_object_id"]
+                    now_day_int = asset_queue_dict["now_day_int"]
+                    create_date = asset_queue_dict["create_date"]
+                    now_value = asset_queue_dict["now_value"]
+                    operate_value = asset_queue_dict["operate_value"]
+                    history_asset_value = asset_queue_dict["history_asset_value"]
+                    if act_id > 0:
+                        asset_inventory_id_md5 = CryptoHelper.md5_encrypt_int(f"{act_id}_{user_id}_{asset_type}_{asset_object_id}_{now_day_int}")
+                    else:
+                        asset_inventory_id_md5 = CryptoHelper.md5_encrypt_int(f"{app_id}_0_{user_id}_{asset_type}_{asset_object_id}_{now_day_int}")
+                    asset_inventory = asset_inventory_model.get_entity("id_md5=%s",params=[asset_inventory_id_md5])
+                    asset_inventory_update_sql = f"process_count=0,now_value={now_value}"
+                    if asset_inventory:
+                        old_asset_inventory_id = asset_inventory.id
+                        if operate_value > 0:
+                            asset_inventory_update_sql += f",inc_value=inc_value+{operate_value}"
+                        else:
+                            asset_inventory_update_sql += f",dec_value=dec_value+{operate_value}"
+                    else:
+                        asset_inventory = AssetInventory()
+                        asset_inventory.id_md5 = asset_inventory_id_md5
+                        asset_inventory.app_id = app_id
+                        asset_inventory.act_id = act_id
+                        asset_inventory.user_id = user_id
+                        asset_inventory.open_id = open_id
+                        asset_inventory.user_nick = user_nick
+                        asset_inventory.asset_type = asset_type
+                        asset_inventory.asset_object_id = asset_object_id
+                        if operate_value > 0:
+                            asset_inventory.inc_value += operate_value
+                        else:
+                            asset_inventory.dec_value += operate_value
+                        asset_inventory.history_value = history_asset_value
+                        asset_inventory.now_value = now_value
+                        asset_inventory.create_date = create_date
+                        asset_inventory.create_day = now_day_int
+                    if old_asset_inventory_id != 0:
+                        asset_inventory_model.update_table(asset_inventory_update_sql, "id=%s", params=[old_asset_inventory_id])
+                    else:
+                        asset_inventory_model.add_entity(asset_inventory)
+                except Exception as ex:
+                    asset_queue_dict["process_count"] += 1
+                    if asset_queue_dict["process_count"] <= 10:
+                        redis_init.rpush(f"asset_queue_list", SevenHelper.json_dumps(asset_queue_dict))
+                    else:
+                        logger_error.error(f"资产队列异常,json串:{SevenHelper.json_dumps(asset_queue_dict)},ex:{traceback.format_exc()}")
+                    continue
+            except Exception as ex:
+                logger_error.error(f"资产队列异常,ex:{traceback.format_exc()}")
+                time.sleep(5)
+
+    def _process_asset_intercept_queue(self):
+        """
+        :description: 处理资产拦截队列入库
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        while True:
+            try:
+                time.sleep(0.1)
+                redis_init = SevenHelper.redis_init()
+                asset_warn_notice_model = AssetWarnNoticeModel()
+                queue_json = redis_init.lpop(f"asset_intercept_queue_list")
+                if not queue_json:
+                    time.sleep(1)
+                    continue
+                try:
+                    queue_dict = SevenHelper.json_loads(queue_json)
+                    asset_warn_notice = SevenHelper.auto_mapper(AssetWarnNotice,queue_dict)
+                    asset_warn_notice_model.add_entity(asset_warn_notice)
+                except Exception as ex:
+                    continue
+            except Exception as ex:
+                logger_error.error(f"资产拦截队列异常,ex:{traceback.format_exc()}")
                 time.sleep(5)
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/console_models/erp_console_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/console_models/erp_console_model.py`

 * *Ordering differences only*

 * *Files 19% similar despite different names*

```diff
@@ -1,287 +1,287 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-11-24 09:36:39
-@LastEditTime: 2023-04-24 15:27:37
-@LastEditors: HuangJianYi
-@Description: ERP控制台业务模型(用于跟遁甲系统对接，推送订单和回写物流) 需在配置文件加 armor_url 和 armor_sign_key对应的值
-"""
-
-import threading, multiprocessing
-from seven_framework import *
-from seven_framework.console.base_console import *
-from seven_cloudapp_frame.libs.common import *
-from seven_cloudapp_frame.libs.customize.seven_helper import *
-from seven_cloudapp_frame.models.frame_base_model import FrameBaseModel
-from seven_cloudapp_frame.models.db_models.erp.erp_relation_model import *
-from seven_cloudapp_frame.models.db_models.prize.prize_order_model import *
-from seven_cloudapp_frame.models.db_models.prize.prize_roster_model import *
-from seven_cloudapp_frame.models.db_models.act.act_info_model import *
-
-
-class ErpConsoleModel():
-    """
-    :description: ERP控制台业务模型(用于跟遁甲系统对接，推送订单和回写物流)
-    """
-
-    def console_erp(self, mod_count=1, prize_roster_model=None, process_type=1):
-        """
-        :description: 控制台推送订单和回写物流
-        :param mod_count: 单表队列数
-        :param prize_roster_model: 中奖记录model实例化
-        :param process_type: 处理方式（1.redis 2.api） 如果是淘系使用redis处理方式非淘系用api模式
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        for i in range(mod_count):
-
-            t = threading.Thread(target=self.process_order_push, args=[i, mod_count, True, prize_roster_model])
-            t.start()
-
-            j = threading.Thread(target=self.process_order_pull, args=[i, mod_count, process_type, prize_roster_model])
-            j.start()
-
-    def process_order_push(self, mod_value, mod_count, is_loop=True, prize_roster_model=None):
-        """
-        :description: 处理订单推送到遁甲系统
-        :param mod_value: 当前队列值
-        :param mod_count: 队列数
-        :param is_loop: 是否循环
-        :param prize_roster_model: 中奖记录model实例化
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        page_size = 100
-        push_url = share_config.get_value("armor_url", "") + "/api/new_order"
-        sign_key = share_config.get_value("armor_sign_key", "")
-
-        print(f"{TimeHelper.get_now_format_time()} 推送订单队列{mod_value}启动")
-
-        while True:
-            try:
-                time.sleep(0.1)
-                erp_relation_model = ErpRelationModel()
-                frame_base_model = FrameBaseModel()
-                now_date = TimeHelper.get_now_format_time()
-                if mod_count == 1:
-                    erp_relation_list = erp_relation_model.get_dict_list("is_release=1 and %s>sync_date and start_date<=%s and end_date>=%s", order_by="sync_date asc", limit="200", params=[TimeHelper.add_minutes_by_format_time(minute=-10), now_date, now_date])
-                else:
-                    erp_relation_list = erp_relation_model.get_dict_list("MOD(id,%s)=%s and is_release=1 and %s>sync_date and start_date<=%s and end_date>=%s", order_by="sync_date asc", limit="200", params=[mod_count, mod_value, TimeHelper.add_minutes_by_format_time(minute=-10), now_date, now_date])
-                if len(erp_relation_list) > 0:
-                    for erp_relation_dict in erp_relation_list:
-                        try:
-                            erp_relation_model.update_table("sync_date=%s", "id=%s", params=[TimeHelper.get_now_format_time(), erp_relation_dict["id"]])
-                            prize_order_model = PrizeOrderModel(sub_table=frame_base_model.get_business_sub_table("prize_order_tb", {"app_id": erp_relation_dict["app_id"]}))
-                            if not prize_roster_model:
-                                prize_roster_model = PrizeRosterModel(sub_table=frame_base_model.get_business_sub_table("prize_roster_tb", {"app_id": erp_relation_dict["app_id"]}))
-                            condition = "app_id=%s and order_status=0 and sync_status=0"
-                            params = [erp_relation_dict["app_id"]]
-                            record_count = prize_order_model.get_total(condition, params=params)
-                            page_count = SevenHelper.get_page_count(page_size, record_count)
-                            for page_index in range(page_count):
-                                prize_order_list_dict = prize_order_model.get_dict_list(condition, "", order_by="id asc", limit=str(page_size), field="*", params=params)
-                                for prize_order_dict in prize_order_list_dict:
-                                    request_params = self.compose_push_request_params(sign_key, erp_relation_dict, prize_order_dict, prize_roster_model)
-                                    if request_params["goods"]:
-                                        result = HTTPHelper.post(push_url, request_params, {"Content-Type": "application/json"})
-                                        if result and result.ok:
-                                            prize_order_model.update_table("sync_status=1,sync_date=%s", "id=%s", params=[TimeHelper.get_now_format_time(), prize_order_dict["id"]])
-                                        else:
-                                            prize_order_dict["sync_count"] = prize_order_dict["sync_count"] + 1
-                                            if prize_order_dict["sync_count"] == 10:
-                                                prize_order_model.update_table("sync_status=2,sync_date=%s,sync_result=%s", "id=%s", params=[TimeHelper.get_now_format_time(), SevenHelper.json_dumps(result), prize_order_dict["id"]])
-                                            else:
-                                                prize_order_model.update_table("sync_count=sync_count+1,sync_date=%s,sync_result=%s", "id=%s", params=[TimeHelper.get_now_format_time(), SevenHelper.json_dumps(result), prize_order_dict["id"]])
-                                    else:
-                                        prize_order_model.update_table("sync_status=2,sync_date=%s,sync_result=%s", "id=%s", params=[TimeHelper.get_now_format_time(), "推送订单失败，没有商品信息", prize_order_dict["id"]])
-
-                        except Exception as ex:
-                            logger_error.error(f"推送订单队列{mod_value}异常,json串:{SevenHelper.json_dumps(erp_relation_dict)},ex:{traceback.format_exc()}")
-                            continue
-
-                if is_loop == True and len(erp_relation_list) <= 0:
-                    time.sleep(60)
-                if is_loop == False:
-                    break
-            except Exception as ex:
-                time.sleep(5)
-
-    def compose_push_request_params(self, sign_key, erp_relation_dict, prize_order_dict, prize_roster_model):
-        """
-        :description: 合成请求参数
-        :param sign_key: 接口签名key
-        :param erp_relation_dict: erp关联信息
-        :param prize_order_dict: 订单信息
-        :param prize_roster_model: 中奖记录实例
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        data = {}
-        data["product_id"] = config.get_value("project_name", 0)
-        data["business_name"] = erp_relation_dict["store_name"]
-        data["app_id"] = erp_relation_dict["app_id"]
-        data["app_key"] = erp_relation_dict["app_key"]
-        data["mini_order"] = prize_order_dict["order_no"]
-        data["user_id"] = prize_order_dict["user_id"]
-        data["open_id"] = prize_order_dict["open_id"]
-        data["user_account"] = prize_order_dict["user_nick"]
-        data["order_time"] = TimeHelper.datetime_to_timestamp(prize_order_dict["create_date"]) * 1000 if str(prize_order_dict["create_date"]) != "1900-01-01 00:00:00" else 0
-        data["activity_id"] = prize_order_dict["act_id"]
-        data["activity_name"] = ""
-        data["order_price"] = str(prize_order_dict['order_price'])
-        data["consignee"] = prize_order_dict["real_name"]
-        data["phone"] = prize_order_dict["telephone"]
-        data["province"] = prize_order_dict["province"]
-        data["city"] = prize_order_dict["city"]
-        data["county"] = prize_order_dict["county"]
-        data["street"] = prize_order_dict["street"]
-        data["address"] = prize_order_dict["address"]
-        data["remark"] = prize_order_dict["seller_remark"]
-        data["buyer_remark"] = prize_order_dict["buyer_remark"]
-        data["freight_price"] = str(prize_order_dict["freight_price"])
-        data["timestamp"] = TimeHelper.get_now_timestamp(True)
-        data["order_status"] = prize_order_dict["order_status"]
-        if data["order_status"] == 2:
-            data["order_status"] = -1  #遁甲系统 不予发货固定是-1
-        if data["order_status"] == 1:
-            data["logistics_number"] = prize_order_dict["express_no"]
-            data["logistics_company"] = prize_order_dict["express_company"]
-            data["delivery_time"] = TimeHelper.datetime_to_timestamp(prize_order_dict["deliver_date"]) * 1000 if str(prize_order_dict["deliver_date"]) != "1900-01-01 00:00:00" else 0
-
-        goods_list = []
-        prize_roster_list_dict = prize_roster_model.get_dict_list("order_no=%s", "", "id desc", "", "*", prize_order_dict["order_no"])
-        for prize_roster_dict in prize_roster_list_dict:
-            goods = {}
-            goods["main_order"] = prize_roster_dict["main_pay_order_no"]
-            goods["sub_order"] = prize_roster_dict["sub_pay_order_no"]
-            goods["goods_name"] = prize_roster_dict["prize_name"]
-            goods["goods_price"] = str(prize_roster_dict["prize_price"])
-            goods["goods_code"] = prize_roster_dict["goods_code"]
-            goods["goods_id"] = prize_roster_dict["goods_id"]
-            goods["sku"] = prize_roster_dict["sku_id"]
-            goods["goods_count"] = 1
-            goods_list.append(goods)
-        data["goods"] = goods_list
-        data["sign"] = SignHelper.params_sign_md5(data, sign_key)
-        return data
-
-    def process_order_pull(self, mod_value, mod_count, process_type=1, prize_roster_model=None):
-        """
-        :description: 处理订单拉取，同步物流信息
-        :param mod_value: 当前队列值
-        :param mod_count: 队列数
-        :param process_type: 处理方式（1.redis 2.api） 如果是淘系使用redis处理方式非淘系用api模式
-        :param prize_roster_model: 中奖记录model实例化
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        erp_relation_model = ErpRelationModel()
-        erp_redis_init = SevenHelper.redis_init(config_dict=config.get_value("erp_redis"))
-
-        print(f"{TimeHelper.get_now_format_time()} 拉取订单队列{mod_value}启动")
-        #获取产品id
-        project_name = config.get_value("project_name", 0)
-        while True:
-            try:
-                time.sleep(0.1)
-                frame_base_model = FrameBaseModel()
-                now_date = TimeHelper.get_now_format_time()
-                if mod_count == 1:
-                    erp_relation_list = erp_relation_model.get_dict_list("is_release=1 and %s>return_date and start_date<=%s and end_date>=%s", order_by="return_date asc", limit="200", params=[TimeHelper.add_minutes_by_format_time(minute=-10), now_date, now_date])
-                else:
-                    erp_relation_list = erp_relation_model.get_dict_list("MOD(id,%s)=%s and is_release=1 and %s>return_date and start_date<=%s and end_date>=%s", order_by="return_date asc", limit="200", params=[mod_count, mod_value, TimeHelper.add_minutes_by_format_time(minute=-10), now_date, now_date])
-                if len(erp_relation_list) > 0:
-                    for erp_relation_dict in erp_relation_list:
-                        try:
-                            prize_order_model = PrizeOrderModel(sub_table=frame_base_model.get_business_sub_table("prize_order_tb", {"app_id": erp_relation_dict["app_id"]}))
-                            if not prize_roster_model:
-                                prize_roster_model = PrizeRosterModel(sub_table=frame_base_model.get_business_sub_table("prize_roster_tb", {"app_id": erp_relation_dict["app_id"]}))
-                            erp_relation_model.update_table("return_date=%s", "id=%s", params=[TimeHelper.get_now_format_time(), erp_relation_dict["id"]])
-                            if process_type == 1:
-                                key = "order_" + project_name + "_" + erp_relation_dict["app_id"]
-                                tatal_count = erp_redis_init.llen(key)
-                                if tatal_count <= 0:
-                                    #logger_info.info("redis订单数量：" + str(tatal_count) + "，key=" + key)
-                                    continue
-                                index = 0
-                                while True:
-                                    order_info_json = erp_redis_init.lindex(key, index=index)
-                                    if not order_info_json:
-                                        break
-                                    order_info_dict = json.loads(order_info_json)
-                                    order_status = order_info_dict["order_status"]
-                                    order_no = order_info_dict["mini_order"]
-                                    express_no = order_info_dict["logistics_number"]
-                                    express_company = order_info_dict["logistics_company"]
-                                    delivery_time = order_info_dict["delivery_time"]
-                                    modify_date = TimeHelper.get_now_datetime()
-                                    if order_status == 1:
-                                        delivery_time = TimeHelper.timestamp_to_datetime(delivery_time)
-                                        update_sql = "order_status=1,express_no=%s,express_company=%s,deliver_date=%s,sync_date=%s"
-                                        params = [express_no, express_company, delivery_time, modify_date, order_no]
-                                        prize_order_model.update_table(update_sql, "order_no=%s", params=params)
-                                        prize_roster_model.update_table("logistics_status=1", "app_id=%s and order_no=%s", params=[erp_relation_dict["app_id"], order_no])
-                                        self.process_order_pull_executed(order_info_dict)
-                                    else:
-                                        update_sql = "sync_status=2,sync_date=%s,sync_result=%s"
-                                        params = [modify_date, "拉取订单失败", order_no]
-                                        prize_order_model.update_table(update_sql, "order_no=%s", params=params)
-                                    #删除redis缓存
-                                    erp_redis_init.lpop(key)
-                            else:
-                                page_size = 100
-                                pull_url = share_config.get_value("armor_url","") + "/api/new_get_order"
-                                sign_key = share_config.get_value("armor_sign_key", "")
-                                condition = "app_id=%s and order_status=0 and sync_status=1"
-                                params = [erp_relation_dict["app_id"]]
-                                record_count = prize_order_model.get_total(condition, params=params)
-                                page_count = SevenHelper.get_page_count(page_size, record_count)
-                                for page_index in range(0, page_count):
-                                    prize_order_list_dict, total = prize_order_model.get_dict_page_list("id,order_no", page_index, page_size, condition, "", "id asc", params)
-                                    if total > 0:
-                                        order_no_list = [prize_order['order_no'] for prize_order in prize_order_list_dict]
-                                        data = {}
-                                        data["mini_order"] = ",".join(order_no_list)
-                                        data["timestamp"] = TimeHelper.get_now_timestamp(True)
-                                        data["sign"] = SignHelper.params_sign_md5(data, sign_key)
-                                        result = HTTPHelper.post(pull_url, data, {"Content-Type": "application/json"})
-                                        if result and result.ok:
-                                            result = json.loads(result.text)
-                                            data_list = result["data"]
-                                            if not data_list:
-                                                continue
-                                            data_list = [i for i in data_list if i['order_status'] in (1, 2)]
-                                            if data_list:
-                                                for data in data_list:
-                                                    order_status = data["order_status"]
-                                                    order_no = data["mini_order"]
-                                                    express_no = data["logistics_number"]
-                                                    express_company = data["logistics_company"]
-                                                    delivery_time = data["delivery_time"]
-                                                    modify_date = TimeHelper.get_now_datetime()
-                                                    if order_status == 1:
-                                                        delivery_time = TimeHelper.timestamp_to_datetime(delivery_time)
-                                                        update_sql = "order_status=1,express_no=%s,express_company=%s,deliver_date=%s,sync_date=%s"
-                                                        params = [express_no, express_company, delivery_time, modify_date, order_no]
-                                                        prize_order_model.update_table(update_sql, "order_no=%s", params=params)
-                                                        prize_roster_model.update_table("logistics_status=1", "app_id=%s and order_no=%s", params=[erp_relation_dict["app_id"], order_no])
-                                                        self.process_order_pull_executed(data)
-                                                    else:
-                                                        update_sql = "sync_status=2,sync_date=%s,sync_result=%s"
-                                                        params = [modify_date, "拉取订单失败", order_no]
-                                                        prize_order_model.update_table(update_sql, "order_no=%s", params=params)
-                        except Exception as ex:
-                            logger_error.error(f"拉取订单队列{mod_value}异常,json串:{SevenHelper.json_dumps(erp_relation_dict)},ex:{traceback.format_exc()}")
-                            continue
-                else:
-                    time.sleep(60)
-            except Exception as ex:
-                time.sleep(5)
-
-    def process_order_pull_executed(self, order_info_dict):
-        """
-        :description: 拉取订单执行后事件
-        :param order_info_dict: 订单信息字典
-        :return: 
-        :last_editors: HuangJianYi
-        """
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-11-24 09:36:39
+@LastEditTime: 2023-04-24 15:27:37
+@LastEditors: HuangJianYi
+@Description: ERP控制台业务模型(用于跟遁甲系统对接，推送订单和回写物流) 需在配置文件加 armor_url 和 armor_sign_key对应的值
+"""
+
+import threading, multiprocessing
+from seven_framework import *
+from seven_framework.console.base_console import *
+from seven_cloudapp_frame.libs.common import *
+from seven_cloudapp_frame.libs.customize.seven_helper import *
+from seven_cloudapp_frame.models.frame_base_model import FrameBaseModel
+from seven_cloudapp_frame.models.db_models.erp.erp_relation_model import *
+from seven_cloudapp_frame.models.db_models.prize.prize_order_model import *
+from seven_cloudapp_frame.models.db_models.prize.prize_roster_model import *
+from seven_cloudapp_frame.models.db_models.act.act_info_model import *
+
+
+class ErpConsoleModel():
+    """
+    :description: ERP控制台业务模型(用于跟遁甲系统对接，推送订单和回写物流)
+    """
+
+    def console_erp(self, mod_count=1, prize_roster_model=None, process_type=1):
+        """
+        :description: 控制台推送订单和回写物流
+        :param mod_count: 单表队列数
+        :param prize_roster_model: 中奖记录model实例化
+        :param process_type: 处理方式（1.redis 2.api） 如果是淘系使用redis处理方式非淘系用api模式
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        for i in range(mod_count):
+
+            t = threading.Thread(target=self.process_order_push, args=[i, mod_count, True, prize_roster_model])
+            t.start()
+
+            j = threading.Thread(target=self.process_order_pull, args=[i, mod_count, process_type, prize_roster_model])
+            j.start()
+
+    def process_order_push(self, mod_value, mod_count, is_loop=True, prize_roster_model=None):
+        """
+        :description: 处理订单推送到遁甲系统
+        :param mod_value: 当前队列值
+        :param mod_count: 队列数
+        :param is_loop: 是否循环
+        :param prize_roster_model: 中奖记录model实例化
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        page_size = 100
+        push_url = share_config.get_value("armor_url", "") + "/api/new_order"
+        sign_key = share_config.get_value("armor_sign_key", "")
+
+        print(f"{TimeHelper.get_now_format_time()} 推送订单队列{mod_value}启动")
+
+        while True:
+            try:
+                time.sleep(0.1)
+                erp_relation_model = ErpRelationModel()
+                frame_base_model = FrameBaseModel()
+                now_date = TimeHelper.get_now_format_time()
+                if mod_count == 1:
+                    erp_relation_list = erp_relation_model.get_dict_list("is_release=1 and %s>sync_date and start_date<=%s and end_date>=%s", order_by="sync_date asc", limit="200", params=[TimeHelper.add_minutes_by_format_time(minute=-10), now_date, now_date])
+                else:
+                    erp_relation_list = erp_relation_model.get_dict_list("MOD(id,%s)=%s and is_release=1 and %s>sync_date and start_date<=%s and end_date>=%s", order_by="sync_date asc", limit="200", params=[mod_count, mod_value, TimeHelper.add_minutes_by_format_time(minute=-10), now_date, now_date])
+                if len(erp_relation_list) > 0:
+                    for erp_relation_dict in erp_relation_list:
+                        try:
+                            erp_relation_model.update_table("sync_date=%s", "id=%s", params=[TimeHelper.get_now_format_time(), erp_relation_dict["id"]])
+                            prize_order_model = PrizeOrderModel(sub_table=frame_base_model.get_business_sub_table("prize_order_tb", {"app_id": erp_relation_dict["app_id"]}))
+                            if not prize_roster_model:
+                                prize_roster_model = PrizeRosterModel(sub_table=frame_base_model.get_business_sub_table("prize_roster_tb", {"app_id": erp_relation_dict["app_id"]}))
+                            condition = "app_id=%s and order_status=0 and sync_status=0"
+                            params = [erp_relation_dict["app_id"]]
+                            record_count = prize_order_model.get_total(condition, params=params)
+                            page_count = SevenHelper.get_page_count(page_size, record_count)
+                            for page_index in range(page_count):
+                                prize_order_list_dict = prize_order_model.get_dict_list(condition, "", order_by="id asc", limit=str(page_size), field="*", params=params)
+                                for prize_order_dict in prize_order_list_dict:
+                                    request_params = self.compose_push_request_params(sign_key, erp_relation_dict, prize_order_dict, prize_roster_model)
+                                    if request_params["goods"]:
+                                        result = HTTPHelper.post(push_url, request_params, {"Content-Type": "application/json"})
+                                        if result and result.ok:
+                                            prize_order_model.update_table("sync_status=1,sync_date=%s", "id=%s", params=[TimeHelper.get_now_format_time(), prize_order_dict["id"]])
+                                        else:
+                                            prize_order_dict["sync_count"] = prize_order_dict["sync_count"] + 1
+                                            if prize_order_dict["sync_count"] == 10:
+                                                prize_order_model.update_table("sync_status=2,sync_date=%s,sync_result=%s", "id=%s", params=[TimeHelper.get_now_format_time(), SevenHelper.json_dumps(result), prize_order_dict["id"]])
+                                            else:
+                                                prize_order_model.update_table("sync_count=sync_count+1,sync_date=%s,sync_result=%s", "id=%s", params=[TimeHelper.get_now_format_time(), SevenHelper.json_dumps(result), prize_order_dict["id"]])
+                                    else:
+                                        prize_order_model.update_table("sync_status=2,sync_date=%s,sync_result=%s", "id=%s", params=[TimeHelper.get_now_format_time(), "推送订单失败，没有商品信息", prize_order_dict["id"]])
+
+                        except Exception as ex:
+                            logger_error.error(f"推送订单队列{mod_value}异常,json串:{SevenHelper.json_dumps(erp_relation_dict)},ex:{traceback.format_exc()}")
+                            continue
+
+                if is_loop == True and len(erp_relation_list) <= 0:
+                    time.sleep(60)
+                if is_loop == False:
+                    break
+            except Exception as ex:
+                time.sleep(5)
+
+    def compose_push_request_params(self, sign_key, erp_relation_dict, prize_order_dict, prize_roster_model):
+        """
+        :description: 合成请求参数
+        :param sign_key: 接口签名key
+        :param erp_relation_dict: erp关联信息
+        :param prize_order_dict: 订单信息
+        :param prize_roster_model: 中奖记录实例
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        data = {}
+        data["product_id"] = config.get_value("project_name", 0)
+        data["business_name"] = erp_relation_dict["store_name"]
+        data["app_id"] = erp_relation_dict["app_id"]
+        data["app_key"] = erp_relation_dict["app_key"]
+        data["mini_order"] = prize_order_dict["order_no"]
+        data["user_id"] = prize_order_dict["user_id"]
+        data["open_id"] = prize_order_dict["open_id"]
+        data["user_account"] = prize_order_dict["user_nick"]
+        data["order_time"] = TimeHelper.datetime_to_timestamp(prize_order_dict["create_date"]) * 1000 if str(prize_order_dict["create_date"]) != "1900-01-01 00:00:00" else 0
+        data["activity_id"] = prize_order_dict["act_id"]
+        data["activity_name"] = ""
+        data["order_price"] = str(prize_order_dict['order_price'])
+        data["consignee"] = prize_order_dict["real_name"]
+        data["phone"] = prize_order_dict["telephone"]
+        data["province"] = prize_order_dict["province"]
+        data["city"] = prize_order_dict["city"]
+        data["county"] = prize_order_dict["county"]
+        data["street"] = prize_order_dict["street"]
+        data["address"] = prize_order_dict["address"]
+        data["remark"] = prize_order_dict["seller_remark"]
+        data["buyer_remark"] = prize_order_dict["buyer_remark"]
+        data["freight_price"] = str(prize_order_dict["freight_price"])
+        data["timestamp"] = TimeHelper.get_now_timestamp(True)
+        data["order_status"] = prize_order_dict["order_status"]
+        if data["order_status"] == 2:
+            data["order_status"] = -1  #遁甲系统 不予发货固定是-1
+        if data["order_status"] == 1:
+            data["logistics_number"] = prize_order_dict["express_no"]
+            data["logistics_company"] = prize_order_dict["express_company"]
+            data["delivery_time"] = TimeHelper.datetime_to_timestamp(prize_order_dict["deliver_date"]) * 1000 if str(prize_order_dict["deliver_date"]) != "1900-01-01 00:00:00" else 0
+
+        goods_list = []
+        prize_roster_list_dict = prize_roster_model.get_dict_list("order_no=%s", "", "id desc", "", "*", prize_order_dict["order_no"])
+        for prize_roster_dict in prize_roster_list_dict:
+            goods = {}
+            goods["main_order"] = prize_roster_dict["main_pay_order_no"]
+            goods["sub_order"] = prize_roster_dict["sub_pay_order_no"]
+            goods["goods_name"] = prize_roster_dict["prize_name"]
+            goods["goods_price"] = str(prize_roster_dict["prize_price"])
+            goods["goods_code"] = prize_roster_dict["goods_code"]
+            goods["goods_id"] = prize_roster_dict["goods_id"]
+            goods["sku"] = prize_roster_dict["sku_id"]
+            goods["goods_count"] = 1
+            goods_list.append(goods)
+        data["goods"] = goods_list
+        data["sign"] = SignHelper.params_sign_md5(data, sign_key)
+        return data
+
+    def process_order_pull(self, mod_value, mod_count, process_type=1, prize_roster_model=None):
+        """
+        :description: 处理订单拉取，同步物流信息
+        :param mod_value: 当前队列值
+        :param mod_count: 队列数
+        :param process_type: 处理方式（1.redis 2.api） 如果是淘系使用redis处理方式非淘系用api模式
+        :param prize_roster_model: 中奖记录model实例化
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        erp_relation_model = ErpRelationModel()
+        erp_redis_init = SevenHelper.redis_init(config_dict=config.get_value("erp_redis"))
+
+        print(f"{TimeHelper.get_now_format_time()} 拉取订单队列{mod_value}启动")
+        #获取产品id
+        project_name = config.get_value("project_name", 0)
+        while True:
+            try:
+                time.sleep(0.1)
+                frame_base_model = FrameBaseModel()
+                now_date = TimeHelper.get_now_format_time()
+                if mod_count == 1:
+                    erp_relation_list = erp_relation_model.get_dict_list("is_release=1 and %s>return_date and start_date<=%s and end_date>=%s", order_by="return_date asc", limit="200", params=[TimeHelper.add_minutes_by_format_time(minute=-10), now_date, now_date])
+                else:
+                    erp_relation_list = erp_relation_model.get_dict_list("MOD(id,%s)=%s and is_release=1 and %s>return_date and start_date<=%s and end_date>=%s", order_by="return_date asc", limit="200", params=[mod_count, mod_value, TimeHelper.add_minutes_by_format_time(minute=-10), now_date, now_date])
+                if len(erp_relation_list) > 0:
+                    for erp_relation_dict in erp_relation_list:
+                        try:
+                            prize_order_model = PrizeOrderModel(sub_table=frame_base_model.get_business_sub_table("prize_order_tb", {"app_id": erp_relation_dict["app_id"]}))
+                            if not prize_roster_model:
+                                prize_roster_model = PrizeRosterModel(sub_table=frame_base_model.get_business_sub_table("prize_roster_tb", {"app_id": erp_relation_dict["app_id"]}))
+                            erp_relation_model.update_table("return_date=%s", "id=%s", params=[TimeHelper.get_now_format_time(), erp_relation_dict["id"]])
+                            if process_type == 1:
+                                key = "order_" + project_name + "_" + erp_relation_dict["app_id"]
+                                tatal_count = erp_redis_init.llen(key)
+                                if tatal_count <= 0:
+                                    #logger_info.info("redis订单数量：" + str(tatal_count) + "，key=" + key)
+                                    continue
+                                index = 0
+                                while True:
+                                    order_info_json = erp_redis_init.lindex(key, index=index)
+                                    if not order_info_json:
+                                        break
+                                    order_info_dict = json.loads(order_info_json)
+                                    order_status = order_info_dict["order_status"]
+                                    order_no = order_info_dict["mini_order"]
+                                    express_no = order_info_dict["logistics_number"]
+                                    express_company = order_info_dict["logistics_company"]
+                                    delivery_time = order_info_dict["delivery_time"]
+                                    modify_date = TimeHelper.get_now_datetime()
+                                    if order_status == 1:
+                                        delivery_time = TimeHelper.timestamp_to_datetime(delivery_time)
+                                        update_sql = "order_status=1,express_no=%s,express_company=%s,deliver_date=%s,sync_date=%s"
+                                        params = [express_no, express_company, delivery_time, modify_date, order_no]
+                                        prize_order_model.update_table(update_sql, "order_no=%s", params=params)
+                                        prize_roster_model.update_table("logistics_status=1", "app_id=%s and order_no=%s", params=[erp_relation_dict["app_id"], order_no])
+                                        self.process_order_pull_executed(order_info_dict)
+                                    else:
+                                        update_sql = "sync_status=2,sync_date=%s,sync_result=%s"
+                                        params = [modify_date, "拉取订单失败", order_no]
+                                        prize_order_model.update_table(update_sql, "order_no=%s", params=params)
+                                    #删除redis缓存
+                                    erp_redis_init.lpop(key)
+                            else:
+                                page_size = 100
+                                pull_url = share_config.get_value("armor_url","") + "/api/new_get_order"
+                                sign_key = share_config.get_value("armor_sign_key", "")
+                                condition = "app_id=%s and order_status=0 and sync_status=1"
+                                params = [erp_relation_dict["app_id"]]
+                                record_count = prize_order_model.get_total(condition, params=params)
+                                page_count = SevenHelper.get_page_count(page_size, record_count)
+                                for page_index in range(0, page_count):
+                                    prize_order_list_dict, total = prize_order_model.get_dict_page_list("id,order_no", page_index, page_size, condition, "", "id asc", params)
+                                    if total > 0:
+                                        order_no_list = [prize_order['order_no'] for prize_order in prize_order_list_dict]
+                                        data = {}
+                                        data["mini_order"] = ",".join(order_no_list)
+                                        data["timestamp"] = TimeHelper.get_now_timestamp(True)
+                                        data["sign"] = SignHelper.params_sign_md5(data, sign_key)
+                                        result = HTTPHelper.post(pull_url, data, {"Content-Type": "application/json"})
+                                        if result and result.ok:
+                                            result = json.loads(result.text)
+                                            data_list = result["data"]
+                                            if not data_list:
+                                                continue
+                                            data_list = [i for i in data_list if i['order_status'] in (1, 2)]
+                                            if data_list:
+                                                for data in data_list:
+                                                    order_status = data["order_status"]
+                                                    order_no = data["mini_order"]
+                                                    express_no = data["logistics_number"]
+                                                    express_company = data["logistics_company"]
+                                                    delivery_time = data["delivery_time"]
+                                                    modify_date = TimeHelper.get_now_datetime()
+                                                    if order_status == 1:
+                                                        delivery_time = TimeHelper.timestamp_to_datetime(delivery_time)
+                                                        update_sql = "order_status=1,express_no=%s,express_company=%s,deliver_date=%s,sync_date=%s"
+                                                        params = [express_no, express_company, delivery_time, modify_date, order_no]
+                                                        prize_order_model.update_table(update_sql, "order_no=%s", params=params)
+                                                        prize_roster_model.update_table("logistics_status=1", "app_id=%s and order_no=%s", params=[erp_relation_dict["app_id"], order_no])
+                                                        self.process_order_pull_executed(data)
+                                                    else:
+                                                        update_sql = "sync_status=2,sync_date=%s,sync_result=%s"
+                                                        params = [modify_date, "拉取订单失败", order_no]
+                                                        prize_order_model.update_table(update_sql, "order_no=%s", params=params)
+                        except Exception as ex:
+                            logger_error.error(f"拉取订单队列{mod_value}异常,json串:{SevenHelper.json_dumps(erp_relation_dict)},ex:{traceback.format_exc()}")
+                            continue
+                else:
+                    time.sleep(60)
+            except Exception as ex:
+                time.sleep(5)
+
+    def process_order_pull_executed(self, order_info_dict):
+        """
+        :description: 拉取订单执行后事件
+        :param order_info_dict: 订单信息字典
+        :return: 
+        :last_editors: HuangJianYi
+        """
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/console_models/launch_console_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/console_models/launch_console_model.py`

 * *Ordering differences only*

 * *Files 15% similar despite different names*

```diff
@@ -1,192 +1,192 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-19 13:37:16
-@LastEditTime: 2023-02-09 19:27:32
-@LastEditors: HuangJianYi
-@Description: 
-"""
-import threading, multiprocessing
-from seven_framework.console.base_console import *
-from seven_cloudapp_frame.libs.customize.seven_helper import *
-from seven_cloudapp_frame.libs.common import *
-from seven_cloudapp_frame.models.top_base_model import *
-from seven_cloudapp_frame.models.db_models.act.act_info_model import *
-from seven_cloudapp_frame.models.db_models.launch.launch_goods_model import *
-from seven_cloudapp_frame.models.db_models.launch.launch_plan_model import *
-
-
-class LaunchConsoleModel():
-    """
-    :description: 投放业务模型
-    """
-    def console_launch(self):
-        """
-        :description: 控制台投放
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        k = threading.Thread(target=self.process_launch_goods, args=[])
-        k.start()
-
-
-    def get_online_url(self, app_id, act_id, module_id=0, act_type=0):
-        """
-        :description: 获取online_url
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:模块标识
-        :param act_type:活动类型
-        :return str
-        :last_editors: HuangJianYi
-        """
-        page_index = ""
-        page = share_config.get_value("page_index")
-        if page:
-            if isinstance(page,dict):
-                cur_page = page.get(str(act_type),"")
-                if cur_page:
-                    page_index = "&page=" + CodingHelper.url_encode(cur_page)
-            else:
-                page_index = "&page=" + CodingHelper.url_encode(page)
-        query = CodingHelper.url_encode(f"actid={act_id}")
-        if module_id > 0:
-            query = CodingHelper.url_encode(f"actid={act_id}&module_id={module_id}")
-        online_url = f"https://m.duanqu.com/?_ariver_appid={app_id}{page_index}&query={query}"
-        return online_url
-
-    def process_launch_goods(self):
-        """
-        :description: 处理同步投放商品
-        :return
-        :last_editors: HuangJianYi
-        """
-        while True:
-            try:
-                time.sleep(0.1)
-                redis_init = RedisExHelper.init()
-                act_id = redis_init.lindex("queue_async_lauch",index=0)
-                app_key = share_config.get_value("app_key")
-                app_secret = share_config.get_value("app_secret")
-                invoke_result_data = InvokeResultData()
-                if act_id:
-                    act_id = int(act_id)
-                    act_info_model = ActInfoModel()
-                    act_info_dict = act_info_model.get_dict_by_id(act_id,field="app_id,id")
-                    if not act_info_dict:
-                        continue
-                    app_info_model = AppInfoModel()
-                    app_info_dict = app_info_model.get_dict("app_id=%s",field="access_token", params=[act_info_dict["app_id"]])
-                    if not app_info_dict:
-                        continue
-                    online_url = self.get_online_url(act_info_dict["app_id"],act_id)
-                    launch_plan_model = LaunchPlanModel()
-                    launch_plan_dict = launch_plan_model.get_dict("act_id=%s", order_by="id desc",field="launch_url", params=[act_id])
-                    if not launch_plan_dict:
-                        invoke_result_data = self.async_tb_launch_goods(act_info_dict["app_id"], act_info_dict["id"], online_url, app_info_dict["access_token"], app_key, app_secret)
-                    else:
-                        invoke_result_data = self.async_tb_launch_goods(act_info_dict["app_id"], act_info_dict["id"], launch_plan_dict["launch_url"], app_info_dict["access_token"], app_key, app_secret)
-                    if invoke_result_data.success == False:
-                        logger_error.error(f"同步投放商品失败,message:{invoke_result_data.error_message}")
-            except Exception as ex:
-                logger_error.error(f"同步投放商品失败,ex:{traceback.format_exc()}")
-            finally:
-                redis_init.lpop("queue_async_lauch")
-                time.sleep(1)
-
-    def async_tb_launch_goods(self, app_id, act_id, online_url, access_token, app_key, app_secret, is_log=False):
-        """
-        :description: 同步投放商品到淘宝（小程序投放-商品绑定/解绑）
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param online_url:投放地址
-        :param access_token:access_token
-        :param app_key:app_key
-        :param app_secret:app_secret
-        :param is_log：是否记录返回信息
-        :return 实体模型InvokeResultData
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        top_base_model = TopBaseModel()
-        launch_goods_model = LaunchGoodsModel()
-        launch_goods_list = launch_goods_model.get_list("app_id=%s and act_id=%s and is_sync=0 and is_launch=1", params=[app_id, act_id])
-        no_launch_goods_list = launch_goods_model.get_list("app_id=%s and act_id=%s and is_sync=0 and is_launch=0 and create_date!=launch_date", params=[app_id, act_id])
-
-        no_launch_page_index = 0
-        no_launch_page_size = 50
-        launch_page_index = 0
-        launch_page_size = 50
-
-        try:
-            # 同步不投放的商品
-            if len(no_launch_goods_list) > 0:
-                no_launch_page_total = int(len(no_launch_goods_list) / no_launch_page_size)
-                if (len(no_launch_goods_list) % no_launch_page_size) > 0:
-                    no_launch_page_total += 1
-                for no_launch_page_index in range(0, no_launch_page_total):
-                    cur_no_launch_goods_list = []
-                    if no_launch_page_index == no_launch_page_total - 1:
-                        cur_no_launch_goods_list = no_launch_goods_list[no_launch_page_index * no_launch_page_size:len(no_launch_goods_list)]
-                    else:
-                        cur_no_launch_goods_list = no_launch_goods_list[(no_launch_page_index * no_launch_page_size):((no_launch_page_index + 1) * no_launch_page_size)]
-                    no_launch_goods_id_list = [str(no_launch_goods.goods_id) for no_launch_goods in cur_no_launch_goods_list]
-                    no_launch_goods_id_list = list(set(no_launch_goods_id_list))
-                    no_launch_goods_ids = ",".join(no_launch_goods_id_list)
-
-                    update_no_launch_goods_list = []
-                    # 淘宝top接口
-                    invoke_result_data = top_base_model.miniapp_distribution_items_bind(no_launch_goods_ids, online_url, 'false', access_token, app_key, app_secret, is_log)
-                    if invoke_result_data.success == False:
-                        return invoke_result_data
-                    resp = invoke_result_data.data
-                    async_result = resp["miniapp_distribution_items_bind_response"]["model_list"]["distribution_order_bind_target_entity_open_result_dto"][0]["bind_result_list"]["distribution_order_bind_base_dto"]
-                    for async_result_info in async_result:
-                        no_launch_goods = [no_launch_goods for no_launch_goods in no_launch_goods_list if str(no_launch_goods.goods_id) == async_result_info["target_entity_id"]]
-                        if len(no_launch_goods) > 0:
-                            if async_result_info["success"] == True:
-                                no_launch_goods[0].is_sync = 1
-                                no_launch_goods[0].sync_date = SevenHelper.get_now_datetime()
-                            else:
-                                no_launch_goods[0].error_message = async_result_info["fail_msg"]
-                            update_no_launch_goods_list.append(no_launch_goods[0])
-
-                    launch_goods_model.update_list(update_no_launch_goods_list)
-
-            # 同步投放的商品
-            if len(launch_goods_list) > 0:
-                launch_page_total = int(len(launch_goods_list) / launch_page_size)
-                if (len(launch_goods_list) % launch_page_size) > 0:
-                    launch_page_total += 1
-                for launch_page_index in range(0, launch_page_total):
-                    cur_launch_goods_list = []
-                    if launch_page_index == launch_page_total - 1:
-                        cur_launch_goods_list = launch_goods_list[launch_page_index * launch_page_size:len(launch_goods_list)]
-                    else:
-                        cur_launch_goods_list = launch_goods_list[(launch_page_index * launch_page_size):((launch_page_index + 1) * launch_page_size)]
-                    launch_goods_id_list = [str(launch_goods.goods_id) for launch_goods in cur_launch_goods_list]
-                    launch_goods_id_list = list(set(launch_goods_id_list))
-                    launch_goods_ids = ",".join(launch_goods_id_list)
-
-                    update_launch_goods_list = []
-                    # 淘宝top接口
-                    invoke_result_data = top_base_model.miniapp_distribution_items_bind(launch_goods_ids, online_url, 'true', access_token, app_key, app_secret, is_log)
-                    if invoke_result_data.success == False:
-                        return invoke_result_data
-                    resp = invoke_result_data.data
-                    async_result = resp["miniapp_distribution_items_bind_response"]["model_list"]["distribution_order_bind_target_entity_open_result_dto"][0]["bind_result_list"]["distribution_order_bind_base_dto"]
-                    for async_result_info in async_result:
-                        launch_goods = [launch_goods for launch_goods in launch_goods_list if str(launch_goods.goods_id) == async_result_info["target_entity_id"]]
-                        if len(launch_goods) > 0:
-                            if async_result_info["success"] == True:
-                                launch_goods[0].is_sync = 1
-                                launch_goods[0].sync_date = SevenHelper.get_now_datetime()
-                            else:
-                                launch_goods[0].is_launch = 0
-                                launch_goods[0].is_sync = 1
-                                launch_goods[0].error_message = async_result_info["fail_msg"]
-                            update_launch_goods_list.append(launch_goods[0])
-                    launch_goods_model.update_list(update_launch_goods_list)
-            return invoke_result_data
-        except Exception as ex:
-            logger_error.error(f"同步投放商品失败,ex:{traceback.format_exc()}")
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-19 13:37:16
+@LastEditTime: 2023-02-09 19:27:32
+@LastEditors: HuangJianYi
+@Description: 
+"""
+import threading, multiprocessing
+from seven_framework.console.base_console import *
+from seven_cloudapp_frame.libs.customize.seven_helper import *
+from seven_cloudapp_frame.libs.common import *
+from seven_cloudapp_frame.models.top_base_model import *
+from seven_cloudapp_frame.models.db_models.act.act_info_model import *
+from seven_cloudapp_frame.models.db_models.launch.launch_goods_model import *
+from seven_cloudapp_frame.models.db_models.launch.launch_plan_model import *
+
+
+class LaunchConsoleModel():
+    """
+    :description: 投放业务模型
+    """
+    def console_launch(self):
+        """
+        :description: 控制台投放
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        k = threading.Thread(target=self.process_launch_goods, args=[])
+        k.start()
+
+
+    def get_online_url(self, app_id, act_id, module_id=0, act_type=0):
+        """
+        :description: 获取online_url
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:模块标识
+        :param act_type:活动类型
+        :return str
+        :last_editors: HuangJianYi
+        """
+        page_index = ""
+        page = share_config.get_value("page_index")
+        if page:
+            if isinstance(page,dict):
+                cur_page = page.get(str(act_type),"")
+                if cur_page:
+                    page_index = "&page=" + CodingHelper.url_encode(cur_page)
+            else:
+                page_index = "&page=" + CodingHelper.url_encode(page)
+        query = CodingHelper.url_encode(f"actid={act_id}")
+        if module_id > 0:
+            query = CodingHelper.url_encode(f"actid={act_id}&module_id={module_id}")
+        online_url = f"https://m.duanqu.com/?_ariver_appid={app_id}{page_index}&query={query}"
+        return online_url
+
+    def process_launch_goods(self):
+        """
+        :description: 处理同步投放商品
+        :return
+        :last_editors: HuangJianYi
+        """
+        while True:
+            try:
+                time.sleep(0.1)
+                redis_init = RedisExHelper.init()
+                act_id = redis_init.lindex("queue_async_lauch",index=0)
+                app_key = share_config.get_value("app_key")
+                app_secret = share_config.get_value("app_secret")
+                invoke_result_data = InvokeResultData()
+                if act_id:
+                    act_id = int(act_id)
+                    act_info_model = ActInfoModel()
+                    act_info_dict = act_info_model.get_dict_by_id(act_id,field="app_id,id")
+                    if not act_info_dict:
+                        continue
+                    app_info_model = AppInfoModel()
+                    app_info_dict = app_info_model.get_dict("app_id=%s",field="access_token", params=[act_info_dict["app_id"]])
+                    if not app_info_dict:
+                        continue
+                    online_url = self.get_online_url(act_info_dict["app_id"],act_id)
+                    launch_plan_model = LaunchPlanModel()
+                    launch_plan_dict = launch_plan_model.get_dict("act_id=%s", order_by="id desc",field="launch_url", params=[act_id])
+                    if not launch_plan_dict:
+                        invoke_result_data = self.async_tb_launch_goods(act_info_dict["app_id"], act_info_dict["id"], online_url, app_info_dict["access_token"], app_key, app_secret)
+                    else:
+                        invoke_result_data = self.async_tb_launch_goods(act_info_dict["app_id"], act_info_dict["id"], launch_plan_dict["launch_url"], app_info_dict["access_token"], app_key, app_secret)
+                    if invoke_result_data.success == False:
+                        logger_error.error(f"同步投放商品失败,message:{invoke_result_data.error_message}")
+            except Exception as ex:
+                logger_error.error(f"同步投放商品失败,ex:{traceback.format_exc()}")
+            finally:
+                redis_init.lpop("queue_async_lauch")
+                time.sleep(1)
+
+    def async_tb_launch_goods(self, app_id, act_id, online_url, access_token, app_key, app_secret, is_log=False):
+        """
+        :description: 同步投放商品到淘宝（小程序投放-商品绑定/解绑）
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param online_url:投放地址
+        :param access_token:access_token
+        :param app_key:app_key
+        :param app_secret:app_secret
+        :param is_log：是否记录返回信息
+        :return 实体模型InvokeResultData
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        top_base_model = TopBaseModel()
+        launch_goods_model = LaunchGoodsModel()
+        launch_goods_list = launch_goods_model.get_list("app_id=%s and act_id=%s and is_sync=0 and is_launch=1", params=[app_id, act_id])
+        no_launch_goods_list = launch_goods_model.get_list("app_id=%s and act_id=%s and is_sync=0 and is_launch=0 and create_date!=launch_date", params=[app_id, act_id])
+
+        no_launch_page_index = 0
+        no_launch_page_size = 50
+        launch_page_index = 0
+        launch_page_size = 50
+
+        try:
+            # 同步不投放的商品
+            if len(no_launch_goods_list) > 0:
+                no_launch_page_total = int(len(no_launch_goods_list) / no_launch_page_size)
+                if (len(no_launch_goods_list) % no_launch_page_size) > 0:
+                    no_launch_page_total += 1
+                for no_launch_page_index in range(0, no_launch_page_total):
+                    cur_no_launch_goods_list = []
+                    if no_launch_page_index == no_launch_page_total - 1:
+                        cur_no_launch_goods_list = no_launch_goods_list[no_launch_page_index * no_launch_page_size:len(no_launch_goods_list)]
+                    else:
+                        cur_no_launch_goods_list = no_launch_goods_list[(no_launch_page_index * no_launch_page_size):((no_launch_page_index + 1) * no_launch_page_size)]
+                    no_launch_goods_id_list = [str(no_launch_goods.goods_id) for no_launch_goods in cur_no_launch_goods_list]
+                    no_launch_goods_id_list = list(set(no_launch_goods_id_list))
+                    no_launch_goods_ids = ",".join(no_launch_goods_id_list)
+
+                    update_no_launch_goods_list = []
+                    # 淘宝top接口
+                    invoke_result_data = top_base_model.miniapp_distribution_items_bind(no_launch_goods_ids, online_url, 'false', access_token, app_key, app_secret, is_log)
+                    if invoke_result_data.success == False:
+                        return invoke_result_data
+                    resp = invoke_result_data.data
+                    async_result = resp["miniapp_distribution_items_bind_response"]["model_list"]["distribution_order_bind_target_entity_open_result_dto"][0]["bind_result_list"]["distribution_order_bind_base_dto"]
+                    for async_result_info in async_result:
+                        no_launch_goods = [no_launch_goods for no_launch_goods in no_launch_goods_list if str(no_launch_goods.goods_id) == async_result_info["target_entity_id"]]
+                        if len(no_launch_goods) > 0:
+                            if async_result_info["success"] == True:
+                                no_launch_goods[0].is_sync = 1
+                                no_launch_goods[0].sync_date = SevenHelper.get_now_datetime()
+                            else:
+                                no_launch_goods[0].error_message = async_result_info["fail_msg"]
+                            update_no_launch_goods_list.append(no_launch_goods[0])
+
+                    launch_goods_model.update_list(update_no_launch_goods_list)
+
+            # 同步投放的商品
+            if len(launch_goods_list) > 0:
+                launch_page_total = int(len(launch_goods_list) / launch_page_size)
+                if (len(launch_goods_list) % launch_page_size) > 0:
+                    launch_page_total += 1
+                for launch_page_index in range(0, launch_page_total):
+                    cur_launch_goods_list = []
+                    if launch_page_index == launch_page_total - 1:
+                        cur_launch_goods_list = launch_goods_list[launch_page_index * launch_page_size:len(launch_goods_list)]
+                    else:
+                        cur_launch_goods_list = launch_goods_list[(launch_page_index * launch_page_size):((launch_page_index + 1) * launch_page_size)]
+                    launch_goods_id_list = [str(launch_goods.goods_id) for launch_goods in cur_launch_goods_list]
+                    launch_goods_id_list = list(set(launch_goods_id_list))
+                    launch_goods_ids = ",".join(launch_goods_id_list)
+
+                    update_launch_goods_list = []
+                    # 淘宝top接口
+                    invoke_result_data = top_base_model.miniapp_distribution_items_bind(launch_goods_ids, online_url, 'true', access_token, app_key, app_secret, is_log)
+                    if invoke_result_data.success == False:
+                        return invoke_result_data
+                    resp = invoke_result_data.data
+                    async_result = resp["miniapp_distribution_items_bind_response"]["model_list"]["distribution_order_bind_target_entity_open_result_dto"][0]["bind_result_list"]["distribution_order_bind_base_dto"]
+                    for async_result_info in async_result:
+                        launch_goods = [launch_goods for launch_goods in launch_goods_list if str(launch_goods.goods_id) == async_result_info["target_entity_id"]]
+                        if len(launch_goods) > 0:
+                            if async_result_info["success"] == True:
+                                launch_goods[0].is_sync = 1
+                                launch_goods[0].sync_date = SevenHelper.get_now_datetime()
+                            else:
+                                launch_goods[0].is_launch = 0
+                                launch_goods[0].is_sync = 1
+                                launch_goods[0].error_message = async_result_info["fail_msg"]
+                            update_launch_goods_list.append(launch_goods[0])
+                    launch_goods_model.update_list(update_launch_goods_list)
+            return invoke_result_data
+        except Exception as ex:
+            logger_error.error(f"同步投放商品失败,ex:{traceback.format_exc()}")
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/console_models/stat_console_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/console_models/stat_console_model.py`

 * *Ordering differences only*

 * *Files 22% similar despite different names*

```diff
@@ -1,412 +1,412 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-19 13:37:16
-@LastEditTime: 2023-04-26 13:46:09
-@LastEditors: HuangJianYi
-@Description: 
-"""
-import threading, multiprocessing
-from seven_framework.console.base_console import *
-from seven_cloudapp_frame.models.seven_model import InvokeResultData
-from seven_cloudapp_frame.models.frame_base_model import *
-from seven_cloudapp_frame.libs.customize.seven_helper import *
-from seven_cloudapp_frame.libs.common import *
-from seven_cloudapp_frame.models.console_models.timing_work_model import *
-from seven_cloudapp_frame.models.db_models.stat.stat_queue_model import *
-from seven_cloudapp_frame.models.db_models.stat.stat_orm_model import *
-from seven_cloudapp_frame.models.db_models.stat.stat_report_model import *
-from seven_cloudapp_frame.models.db_models.stat.stat_log_model import *
-from seven_cloudapp_frame.models.db_models.stat.stat_user_report_model import *
-from seven_cloudapp_frame.models.db_models.stat.stat_user_log_model import *
-
-class StatConsoleModel():
-    """
-    :description: 统计控制台业务模型
-    """
-    def console_stat_queue(self, mod_count=1):
-        """
-        :description: 控制台统计上报
-        :param mod_count: 单表队列数
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        stat_config = share_config.get_value("stat_config", {})
-        is_process_stat = stat_config.get("is_process_stat", True)
-        if is_process_stat:
-            stat_process_ways = share_config.get_value("stat_process_ways", "redis")
-            if stat_process_ways == "mysql":
-                for i in range(mod_count):
-                    t = threading.Thread(target=self._process_stat_queue, args=[i, mod_count])
-                    t.start()
-            else:
-                for i in range(10):
-                    j = threading.Thread(target=self._process_redis_stat_queue, args=[i])
-                    j.start()
-
-            clea_data_work = ClearDataWork()
-            clea_data_work.start_hours = 2
-            clea_data_work.end_hours = 4
-            clea_data_work.sleep_time = 3600
-            clea_data_work.start_work("清理统计流水数据作业")
-
-        is_process_stat_user = stat_config.get("is_process_stat_user",False)
-        if is_process_stat_user:
-            for i in range(10):
-                k = threading.Thread(target=self._process_redis_stat_user_queue, args=[i])
-                k.start()
-
-            stat_user_data_work = StatUserDataWork()
-            stat_user_data_work.start_hours = 2
-            stat_user_data_work.end_hours = 4
-            stat_user_data_work.sleep_time = 3600
-            stat_user_data_work.start_work("处理统计用户数据作业")
-
-
-    def _process_stat_queue(self, mod_value, mod_count):
-        """
-        :description: 处理mysql统计队列
-        :param mod_value: 当前队列值
-        :param mod_count: 队列数
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        print(f"{TimeHelper.get_now_format_time()} 统计队列{mod_value}启动")
-        while True:
-            try:
-                time.sleep(0.1)
-                db_connect_key = "db_cloudapp"
-                db_transaction = DbTransaction(db_config_dict=config.get_value(db_connect_key))
-                stat_queue_model = StatQueueModel(db_connect_key=db_connect_key, db_transaction=db_transaction)
-                stat_orm_model = StatOrmModel(db_connect_key=db_connect_key)
-                now_date = TimeHelper.get_now_format_time()
-                if mod_count == 1:
-                    stat_queue_list = stat_queue_model.get_list(f"process_count<10 and '{now_date}'>process_date", order_by="process_date asc", limit="200")
-                else:
-                    stat_queue_list = stat_queue_model.get_list(f"MOD(user_id,{mod_count})={mod_value} and process_count<10 and '{now_date}'>process_date", order_by="process_date asc", limit="200")
-                if len(stat_queue_list) > 0:
-                    for stat_queue in stat_queue_list:
-                        try:
-                            stat_report_model = StatReportModel(db_connect_key=db_connect_key,db_transaction=db_transaction)
-                            stat_orm = stat_orm_model.get_cache_entity("((act_id=%s and module_id=%s and object_id=%s) or (act_id=0 and module_id=0 and object_id='')) and key_name=%s", params=[stat_queue.act_id, stat_queue.module_id, stat_queue.object_id, stat_queue.key_name])
-                            if not stat_orm:
-                                stat_queue_model.del_entity("id=%s", params=[stat_queue.id])
-                                continue
-                            create_date = TimeHelper.format_time_to_datetime(stat_queue.create_date)
-                            create_day_int = int(create_date.strftime('%Y%m%d'))
-                            create_month_int = int(create_date.strftime('%Y%m'))
-                            create_year_int = int(create_date.strftime('%Y'))
-                            stat_log_model = StatLogModel(db_connect_key=db_connect_key, sub_table=FrameBaseModel().get_business_sub_table("stat_log_tb", {"app_id": stat_queue.app_id}), db_transaction=db_transaction)
-                            is_add = True
-                            if stat_orm.repeat_type > 0:
-                                if stat_orm.repeat_type == 2:
-                                    stat_log_dict = stat_log_model.get_dict("act_id=%s and module_id=%s and orm_id=%s and user_id=%s and object_id=%s", field="id", params=[stat_queue.act_id, stat_queue.module_id, stat_orm.id, stat_queue.user_id, stat_queue.object_id])
-                                else:
-                                    stat_log_dict = stat_log_model.get_dict("act_id=%s and module_id=%s and orm_id=%s and user_id=%s and create_day=%s and object_id=%s", field="id", params=[stat_queue.act_id, stat_queue.module_id, stat_orm.id, stat_queue.user_id, create_day_int, stat_queue.object_id])
-                                if stat_log_dict:
-                                    is_add = False
-
-                            stat_log = StatLog()
-                            stat_log.app_id = stat_queue.app_id
-                            stat_log.act_id = stat_queue.act_id
-                            stat_log.module_id = stat_queue.module_id
-                            stat_log.orm_id = stat_orm.id
-                            stat_log.user_id = stat_queue.user_id
-                            stat_log.open_id = stat_queue.open_id
-                            stat_log.key_value = stat_queue.key_value
-                            stat_log.create_day = create_day_int
-                            stat_log.create_month = create_month_int
-                            stat_log.create_date = create_date
-
-                            stat_report_condition = "act_id=%s and module_id=%s and object_id=%s and key_name=%s and create_day=%s"
-                            stat_report_param = [stat_queue.act_id, stat_queue.module_id, stat_queue.object_id, stat_queue.key_name, create_day_int]
-                            stat_report_dict = stat_report_model.get_dict(stat_report_condition, params=stat_report_param)
-
-                            db_transaction.begin_transaction()
-                            if is_add:
-                                if not stat_report_dict:
-                                    stat_report = StatReport()
-                                    stat_report.app_id = stat_queue.app_id
-                                    stat_report.act_id = stat_queue.act_id
-                                    stat_report.module_id = stat_queue.module_id
-                                    stat_report.object_id = stat_queue.object_id
-                                    stat_report.key_name = stat_queue.key_name
-                                    stat_report.key_value = stat_queue.key_value
-                                    stat_report.create_date = create_date
-                                    stat_report.create_year = create_year_int
-                                    stat_report.create_month = create_month_int
-                                    stat_report.create_day = create_day_int
-                                    stat_report_model.add_entity(stat_report)
-                                else:
-                                    stat_report_model.update_table(f"key_value=key_value+{stat_queue.key_value}", stat_report_condition, params=stat_report_param)
-                                stat_log_model.add_entity(stat_log)
-                            stat_queue_model.del_entity("id=%s", params=[stat_queue.id])
-                            result,message = db_transaction.commit_transaction(True)
-                            if result == False:
-                                raise Exception("执行事务失败", message)
-                        except Exception as ex:
-                            stat_queue.process_count += 1
-                            if stat_queue.process_count <= 10:
-                                stat_queue.process_result = f"出现异常,json串:{SevenHelper.json_dumps(stat_queue)},ex:{traceback.format_exc()}"
-                                minute = 1 if stat_queue.process_count <= 5 else 5
-                                stat_queue.process_date = TimeHelper.add_minutes_by_format_time(minute=minute)
-                                stat_queue_model.update_entity(stat_queue, "process_count,process_result,process_date")
-                            else:
-                                logger_error.error(f"统计队列{mod_value}异常,json串:{SevenHelper.json_dumps(stat_queue)},ex:{traceback.format_exc()}")
-                            continue
-                else:
-                    time.sleep(1)
-            except Exception as ex:
-                logger_error.error(f"统计队列{mod_value}异常,ex:{traceback.format_exc()}")
-                time.sleep(5)
-
-    def _process_redis_stat_queue(self, mod_value):
-        """
-        :description: 处理redis统计队列
-        :param mod_value: 当前队列值
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        print(f"{TimeHelper.get_now_format_time()} 统计队列{mod_value}启动")
-
-        while True:
-            try:
-                time.sleep(0.1)
-                redis_init = SevenHelper.redis_init()
-                redis_stat_key = f"stat_queue_list:{mod_value}"
-                stat_queue_json = redis_init.lindex(redis_stat_key, index=0)
-                if not stat_queue_json:
-                    time.sleep(1)
-                    continue
-                try:
-                    stat_queue_dict = SevenHelper.json_loads(stat_queue_json)
-                    db_connect_key = "db_cloudapp"
-                    db_transaction = DbTransaction(db_config_dict=config.get_value(db_connect_key))
-                    stat_orm_model = StatOrmModel(db_connect_key=db_connect_key)
-                    stat_report_model = StatReportModel(db_connect_key=db_connect_key,db_transaction=db_transaction)
-                    stat_orm = stat_orm_model.get_cache_entity("((act_id=%s and module_id=%s and object_id=%s) or (act_id=0 and module_id=0 and object_id='')) and key_name=%s", params=[stat_queue_dict["act_id"], stat_queue_dict["module_id"], stat_queue_dict.get("object_id",''), stat_queue_dict["key_name"]])
-                    if not stat_orm:
-                        redis_init.lpop(redis_stat_key)
-                        continue
-                    create_date = TimeHelper.format_time_to_datetime(stat_queue_dict["create_date"])
-                    create_day_int = int(create_date.strftime('%Y%m%d'))
-                    create_month_int = int(create_date.strftime('%Y%m'))
-                    create_year_int = int(create_date.strftime('%Y'))
-                    stat_log_model = StatLogModel(sub_table=FrameBaseModel().get_business_sub_table("stat_log_tb", {"app_id": stat_queue_dict["app_id"]}), db_transaction=db_transaction)
-                    is_add = True
-                    if stat_orm.repeat_type > 0:
-                        if stat_orm.repeat_type == 2:
-                            stat_log_dict = stat_log_model.get_dict("act_id=%s and module_id=%s and orm_id=%s and user_id=%s and object_id=%s", field="id", params=[stat_queue_dict["act_id"], stat_queue_dict["module_id"], stat_orm.id, stat_queue_dict["user_id"], stat_queue_dict.get("object_id",'')])
-                        else:
-                            stat_log_dict = stat_log_model.get_dict("act_id=%s and module_id=%s and orm_id=%s and user_id=%s and create_day=%s and object_id=%s", field="id", params=[stat_queue_dict["act_id"], stat_queue_dict["module_id"], stat_orm.id, stat_queue_dict["user_id"], create_day_int, stat_queue_dict.get("object_id",'')])
-                        if stat_log_dict:
-                            is_add = False
-
-                    stat_log = StatLog()
-                    stat_log.app_id = stat_queue_dict["app_id"]
-                    stat_log.act_id = stat_queue_dict["act_id"]
-                    stat_log.module_id = stat_queue_dict["module_id"]
-                    stat_log.object_id = stat_queue_dict.get("object_id",'')
-                    stat_log.orm_id = stat_orm.id
-                    stat_log.user_id = stat_queue_dict["user_id"]
-                    stat_log.open_id = stat_queue_dict["open_id"]
-                    stat_log.key_value = stat_queue_dict["key_value"]
-                    stat_log.create_day = create_day_int
-                    stat_log.create_month = create_month_int
-                    stat_log.create_date = create_date
-
-                    stat_report_condition = "act_id=%s and module_id=%s and object_id=%s and key_name=%s and create_day=%s"
-                    stat_report_param = [stat_queue_dict["act_id"], stat_queue_dict["module_id"], stat_queue_dict.get("object_id",''), stat_queue_dict["key_name"], create_day_int]
-                    stat_report_dict = stat_report_model.get_dict(stat_report_condition, params=stat_report_param)
-
-                    if is_add:
-                        db_transaction.begin_transaction()
-                        if not stat_report_dict:
-                            stat_report = StatReport()
-                            stat_report.app_id = stat_queue_dict["app_id"]
-                            stat_report.act_id = stat_queue_dict["act_id"]
-                            stat_report.module_id = stat_queue_dict["module_id"]
-                            stat_report.object_id = stat_queue_dict.get("object_id",'')
-                            stat_report.key_name = stat_queue_dict["key_name"]
-                            stat_report.key_value = stat_queue_dict["key_value"]
-                            stat_report.create_date = create_date
-                            stat_report.create_year = create_year_int
-                            stat_report.create_month = create_month_int
-                            stat_report.create_day = create_day_int
-                            stat_report_model.add_entity(stat_report)
-                        else:
-                            key_value = stat_queue_dict["key_value"]
-                            stat_report_model.update_table(f"key_value=key_value+{key_value}", stat_report_condition, params=stat_report_param)
-                        stat_log_model.add_entity(stat_log)
-                        result,message = db_transaction.commit_transaction(True)
-                        if result == False:
-                            raise Exception("执行事务失败", message)
-
-                    redis_init.lpop(redis_stat_key)
-
-                except Exception as ex:
-                    logger_error.error(f"统计队列{mod_value}异常,json串:{SevenHelper.json_dumps(stat_queue_dict)},ex:{traceback.format_exc()}")
-                    continue
-
-            except Exception as ex:
-                logger_error.error(f"统计队列{mod_value}异常,ex:{traceback.format_exc()}")
-                time.sleep(5)
-
-    def _process_redis_stat_user_queue(self, mod_value):
-        """
-        :description: 处理redis统计用户队列
-        :param mod_value: 当前队列值
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        print(f"{TimeHelper.get_now_format_time()} 统计用户队列{mod_value}启动")
-
-        while True:
-            try:
-                time.sleep(0.1)
-                db_transaction = DbTransaction(db_config_dict=config.get_value("db_cloudapp"))
-                redis_init = SevenHelper.redis_init()
-                redis_stat_key = f"stat_user_queue_list:{mod_value}"
-                stat_queue_json = redis_init.lindex(redis_stat_key, index=0)
-                if not stat_queue_json:
-                    time.sleep(1)
-                    continue
-                try:
-                    stat_queue_dict = SevenHelper.json_loads(stat_queue_json)
-                    stat_user_log_model = StatUserLogModel(sub_table=FrameBaseModel().get_business_sub_table("stat_user_log_tb", {"app_id": stat_queue_dict["app_id"]}),db_transaction=db_transaction)
-                    stat_user_report_model = StatUserReportModel(db_transaction=db_transaction)
-                    create_date = TimeHelper.format_time_to_datetime(stat_queue_dict["create_date"])
-                    create_day_int = int(create_date.strftime('%Y%m%d'))
-                    create_month_int = int(create_date.strftime('%Y%m'))
-                    create_year_int = int(create_date.strftime('%Y'))
-                    field_name = stat_queue_dict["key_name"]
-
-                    stat_user_log = StatUserLog()
-                    stat_user_log.app_id = stat_queue_dict["app_id"]
-                    stat_user_log.act_id = stat_queue_dict["act_id"]
-                    stat_user_log.module_id = stat_queue_dict["module_id"]
-                    stat_user_log.user_id = stat_queue_dict["user_id"]
-                    stat_user_log.open_id = stat_queue_dict["open_id"]
-                    stat_user_log.key_name = field_name
-                    stat_user_log.key_value = stat_queue_dict["key_value"]
-                    stat_user_log.request_code = stat_queue_dict.get("request_code","")
-                    stat_user_log.create_day = create_day_int
-                    stat_user_log.create_month = create_month_int
-                    stat_user_log.create_date = create_date
-
-                    stat_report_condition = "act_id=%s and module_id=%s and create_day=%s and user_id=%s"
-                    stat_report_param = [stat_queue_dict["act_id"], stat_queue_dict["module_id"], create_day_int, stat_queue_dict["user_id"]]
-                    stat_report_dict = stat_user_report_model.get_dict(stat_report_condition, params=stat_report_param)
-                    if not stat_report_dict:
-                        stat_user_report = StatUserReport()
-                        stat_user_report.app_id = stat_queue_dict["app_id"]
-                        stat_user_report.act_id = stat_queue_dict["act_id"]
-                        stat_user_report.module_id = stat_queue_dict["module_id"]
-                        stat_user_report.user_id = stat_queue_dict["user_id"]
-                        stat_user_report.open_id = stat_queue_dict["open_id"]
-                        stat_user_report.key_name = field_name
-                        stat_user_report.key_value = stat_queue_dict["key_value"]
-                        stat_user_report.create_date = create_date
-                        stat_user_report.create_year = create_year_int
-                        stat_user_report.create_month = create_month_int
-                        stat_user_report.create_day = create_day_int
-                        stat_user_report_model.add_entity(stat_user_report)
-
-                    db_transaction.begin_transaction()
-                    key_value = stat_queue_dict["key_value"]
-                    stat_user_report_model.update_table(f"{field_name}={field_name}+{key_value}", stat_report_condition, params=stat_report_param)
-                    stat_user_log_model.add_entity(stat_user_log)
-                    result,message = db_transaction.commit_transaction(True)
-                    if result == False:
-                        raise Exception("执行事务失败", message)
-
-                    redis_init.lpop(redis_stat_key)
-
-                except Exception as ex:
-                    logger_error.error(f"统计用户队列{mod_value}异常,json串:{SevenHelper.json_dumps(stat_queue_dict)},ex:{traceback.format_exc()}")
-                    continue
-
-            except Exception as ex:
-                logger_error.error(f"统计用户队列{mod_value}异常,ex:{traceback.format_exc()}")
-                time.sleep(5)
-
-
-class ClearDataWork(TimingWork):
-    """
-    :description: 清理数据
-    :return: 
-    :last_editors: HuangJianYi
-    """
-    def execute(self):
-        invoke_result_data = InvokeResultData()
-        self.process_only_table()
-
-        return invoke_result_data
-
-    def process_only_table(self):
-        """
-        :description: 处理单表
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        stat_log_model = StatLogModel()
-        stat_orm_model = StatOrmModel()
-        page_index = 0
-        while True:
-            stat_orm_dict_list, is_next = stat_orm_model.get_dict_page_list(field="id,repeat_type", page_index=page_index, page_size=200, order_by="id asc", page_count_mode="next")
-            if len(stat_orm_dict_list) <= 0:
-                break
-            for stat_orm_dict in stat_orm_dict_list:
-                if stat_orm_dict["repeat_type"] != 2:
-                    while True:
-                        is_del = stat_log_model.del_entity("orm_id=%s and create_day<%s", params=[stat_orm_dict["id"], SevenHelper.get_now_day_int(-24 * 15)], limit="100")
-                        if is_del == False:
-                            break
-            page_index += 1
-
-
-class StatUserDataWork(TimingWork):
-    """
-    :description: 处理统计用户数据（用户汇总报表只保留1年的记录，流水只保留1个月）
-    :return: 
-    :last_editors: HuangJianYi
-    """
-
-    def execute(self):
-        invoke_result_data = InvokeResultData()
-        self.clear_log()
-        self.clear_report()
-        return invoke_result_data
-
-    def clear_log(self):
-        """
-        :description: 清理流水
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        stat_log_model = StatUserLogModel()
-        stat_config = share_config.get_value("stat_config", {})
-        space_day = int(stat_config.get("user_log_space_day", 30))
-        while True:
-            is_del = stat_log_model.del_entity("create_day<%s", params=[SevenHelper.get_now_day_int(-24 * space_day)], limit="100")
-            if is_del == False:
-                break
-
-    def clear_report(self):
-        """
-        :description: 清理报表(用户统计表需要按年创建分表，然后把数据加入到对应的年分表中，没建表则无法清理报表)
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        stat_user_report_model = StatUserReportModel()
-        stat_config = share_config.get_value("stat_config", {})
-        space_day = int(stat_config.get("user_report_space_day", 365))
-        while True:
-            stat_user_report_list = stat_user_report_model.get_list(where="create_day<%s", order_by="id asc", limit="200", params=[SevenHelper.get_now_day_int(-24 * space_day)])
-            if len(stat_user_report_list) <= 0:
-                break
-            for item in stat_user_report_list:
-                create_year = item.create_year
-                stat_user_report_year_model = StatUserReportModel(sub_table=f"{create_year}")
-                stat_user_report_year_model.add_entity(item)
-                stat_user_report_model.del_entity("id=%s", params=[item.id])
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-19 13:37:16
+@LastEditTime: 2023-04-26 13:46:09
+@LastEditors: HuangJianYi
+@Description: 
+"""
+import threading, multiprocessing
+from seven_framework.console.base_console import *
+from seven_cloudapp_frame.models.seven_model import InvokeResultData
+from seven_cloudapp_frame.models.frame_base_model import *
+from seven_cloudapp_frame.libs.customize.seven_helper import *
+from seven_cloudapp_frame.libs.common import *
+from seven_cloudapp_frame.models.console_models.timing_work_model import *
+from seven_cloudapp_frame.models.db_models.stat.stat_queue_model import *
+from seven_cloudapp_frame.models.db_models.stat.stat_orm_model import *
+from seven_cloudapp_frame.models.db_models.stat.stat_report_model import *
+from seven_cloudapp_frame.models.db_models.stat.stat_log_model import *
+from seven_cloudapp_frame.models.db_models.stat.stat_user_report_model import *
+from seven_cloudapp_frame.models.db_models.stat.stat_user_log_model import *
+
+class StatConsoleModel():
+    """
+    :description: 统计控制台业务模型
+    """
+    def console_stat_queue(self, mod_count=1):
+        """
+        :description: 控制台统计上报
+        :param mod_count: 单表队列数
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        stat_config = share_config.get_value("stat_config", {})
+        is_process_stat = stat_config.get("is_process_stat", True)
+        if is_process_stat:
+            stat_process_ways = share_config.get_value("stat_process_ways", "redis")
+            if stat_process_ways == "mysql":
+                for i in range(mod_count):
+                    t = threading.Thread(target=self._process_stat_queue, args=[i, mod_count])
+                    t.start()
+            else:
+                for i in range(10):
+                    j = threading.Thread(target=self._process_redis_stat_queue, args=[i])
+                    j.start()
+
+            clea_data_work = ClearDataWork()
+            clea_data_work.start_hours = 2
+            clea_data_work.end_hours = 4
+            clea_data_work.sleep_time = 3600
+            clea_data_work.start_work("清理统计流水数据作业")
+
+        is_process_stat_user = stat_config.get("is_process_stat_user",False)
+        if is_process_stat_user:
+            for i in range(10):
+                k = threading.Thread(target=self._process_redis_stat_user_queue, args=[i])
+                k.start()
+
+            stat_user_data_work = StatUserDataWork()
+            stat_user_data_work.start_hours = 2
+            stat_user_data_work.end_hours = 4
+            stat_user_data_work.sleep_time = 3600
+            stat_user_data_work.start_work("处理统计用户数据作业")
+
+
+    def _process_stat_queue(self, mod_value, mod_count):
+        """
+        :description: 处理mysql统计队列
+        :param mod_value: 当前队列值
+        :param mod_count: 队列数
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        print(f"{TimeHelper.get_now_format_time()} 统计队列{mod_value}启动")
+        while True:
+            try:
+                time.sleep(0.1)
+                db_connect_key = "db_cloudapp"
+                db_transaction = DbTransaction(db_config_dict=config.get_value(db_connect_key))
+                stat_queue_model = StatQueueModel(db_connect_key=db_connect_key, db_transaction=db_transaction)
+                stat_orm_model = StatOrmModel(db_connect_key=db_connect_key)
+                now_date = TimeHelper.get_now_format_time()
+                if mod_count == 1:
+                    stat_queue_list = stat_queue_model.get_list(f"process_count<10 and '{now_date}'>process_date", order_by="process_date asc", limit="200")
+                else:
+                    stat_queue_list = stat_queue_model.get_list(f"MOD(user_id,{mod_count})={mod_value} and process_count<10 and '{now_date}'>process_date", order_by="process_date asc", limit="200")
+                if len(stat_queue_list) > 0:
+                    for stat_queue in stat_queue_list:
+                        try:
+                            stat_report_model = StatReportModel(db_connect_key=db_connect_key,db_transaction=db_transaction)
+                            stat_orm = stat_orm_model.get_cache_entity("((act_id=%s and module_id=%s and object_id=%s) or (act_id=0 and module_id=0 and object_id='')) and key_name=%s", params=[stat_queue.act_id, stat_queue.module_id, stat_queue.object_id, stat_queue.key_name])
+                            if not stat_orm:
+                                stat_queue_model.del_entity("id=%s", params=[stat_queue.id])
+                                continue
+                            create_date = TimeHelper.format_time_to_datetime(stat_queue.create_date)
+                            create_day_int = int(create_date.strftime('%Y%m%d'))
+                            create_month_int = int(create_date.strftime('%Y%m'))
+                            create_year_int = int(create_date.strftime('%Y'))
+                            stat_log_model = StatLogModel(db_connect_key=db_connect_key, sub_table=FrameBaseModel().get_business_sub_table("stat_log_tb", {"app_id": stat_queue.app_id}), db_transaction=db_transaction)
+                            is_add = True
+                            if stat_orm.repeat_type > 0:
+                                if stat_orm.repeat_type == 2:
+                                    stat_log_dict = stat_log_model.get_dict("act_id=%s and module_id=%s and orm_id=%s and user_id=%s and object_id=%s", field="id", params=[stat_queue.act_id, stat_queue.module_id, stat_orm.id, stat_queue.user_id, stat_queue.object_id])
+                                else:
+                                    stat_log_dict = stat_log_model.get_dict("act_id=%s and module_id=%s and orm_id=%s and user_id=%s and create_day=%s and object_id=%s", field="id", params=[stat_queue.act_id, stat_queue.module_id, stat_orm.id, stat_queue.user_id, create_day_int, stat_queue.object_id])
+                                if stat_log_dict:
+                                    is_add = False
+
+                            stat_log = StatLog()
+                            stat_log.app_id = stat_queue.app_id
+                            stat_log.act_id = stat_queue.act_id
+                            stat_log.module_id = stat_queue.module_id
+                            stat_log.orm_id = stat_orm.id
+                            stat_log.user_id = stat_queue.user_id
+                            stat_log.open_id = stat_queue.open_id
+                            stat_log.key_value = stat_queue.key_value
+                            stat_log.create_day = create_day_int
+                            stat_log.create_month = create_month_int
+                            stat_log.create_date = create_date
+
+                            stat_report_condition = "act_id=%s and module_id=%s and object_id=%s and key_name=%s and create_day=%s"
+                            stat_report_param = [stat_queue.act_id, stat_queue.module_id, stat_queue.object_id, stat_queue.key_name, create_day_int]
+                            stat_report_dict = stat_report_model.get_dict(stat_report_condition, params=stat_report_param)
+
+                            db_transaction.begin_transaction()
+                            if is_add:
+                                if not stat_report_dict:
+                                    stat_report = StatReport()
+                                    stat_report.app_id = stat_queue.app_id
+                                    stat_report.act_id = stat_queue.act_id
+                                    stat_report.module_id = stat_queue.module_id
+                                    stat_report.object_id = stat_queue.object_id
+                                    stat_report.key_name = stat_queue.key_name
+                                    stat_report.key_value = stat_queue.key_value
+                                    stat_report.create_date = create_date
+                                    stat_report.create_year = create_year_int
+                                    stat_report.create_month = create_month_int
+                                    stat_report.create_day = create_day_int
+                                    stat_report_model.add_entity(stat_report)
+                                else:
+                                    stat_report_model.update_table(f"key_value=key_value+{stat_queue.key_value}", stat_report_condition, params=stat_report_param)
+                                stat_log_model.add_entity(stat_log)
+                            stat_queue_model.del_entity("id=%s", params=[stat_queue.id])
+                            result,message = db_transaction.commit_transaction(True)
+                            if result == False:
+                                raise Exception("执行事务失败", message)
+                        except Exception as ex:
+                            stat_queue.process_count += 1
+                            if stat_queue.process_count <= 10:
+                                stat_queue.process_result = f"出现异常,json串:{SevenHelper.json_dumps(stat_queue)},ex:{traceback.format_exc()}"
+                                minute = 1 if stat_queue.process_count <= 5 else 5
+                                stat_queue.process_date = TimeHelper.add_minutes_by_format_time(minute=minute)
+                                stat_queue_model.update_entity(stat_queue, "process_count,process_result,process_date")
+                            else:
+                                logger_error.error(f"统计队列{mod_value}异常,json串:{SevenHelper.json_dumps(stat_queue)},ex:{traceback.format_exc()}")
+                            continue
+                else:
+                    time.sleep(1)
+            except Exception as ex:
+                logger_error.error(f"统计队列{mod_value}异常,ex:{traceback.format_exc()}")
+                time.sleep(5)
+
+    def _process_redis_stat_queue(self, mod_value):
+        """
+        :description: 处理redis统计队列
+        :param mod_value: 当前队列值
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        print(f"{TimeHelper.get_now_format_time()} 统计队列{mod_value}启动")
+
+        while True:
+            try:
+                time.sleep(0.1)
+                redis_init = SevenHelper.redis_init()
+                redis_stat_key = f"stat_queue_list:{mod_value}"
+                stat_queue_json = redis_init.lindex(redis_stat_key, index=0)
+                if not stat_queue_json:
+                    time.sleep(1)
+                    continue
+                try:
+                    stat_queue_dict = SevenHelper.json_loads(stat_queue_json)
+                    db_connect_key = "db_cloudapp"
+                    db_transaction = DbTransaction(db_config_dict=config.get_value(db_connect_key))
+                    stat_orm_model = StatOrmModel(db_connect_key=db_connect_key)
+                    stat_report_model = StatReportModel(db_connect_key=db_connect_key,db_transaction=db_transaction)
+                    stat_orm = stat_orm_model.get_cache_entity("((act_id=%s and module_id=%s and object_id=%s) or (act_id=0 and module_id=0 and object_id='')) and key_name=%s", params=[stat_queue_dict["act_id"], stat_queue_dict["module_id"], stat_queue_dict.get("object_id",''), stat_queue_dict["key_name"]])
+                    if not stat_orm:
+                        redis_init.lpop(redis_stat_key)
+                        continue
+                    create_date = TimeHelper.format_time_to_datetime(stat_queue_dict["create_date"])
+                    create_day_int = int(create_date.strftime('%Y%m%d'))
+                    create_month_int = int(create_date.strftime('%Y%m'))
+                    create_year_int = int(create_date.strftime('%Y'))
+                    stat_log_model = StatLogModel(sub_table=FrameBaseModel().get_business_sub_table("stat_log_tb", {"app_id": stat_queue_dict["app_id"]}), db_transaction=db_transaction)
+                    is_add = True
+                    if stat_orm.repeat_type > 0:
+                        if stat_orm.repeat_type == 2:
+                            stat_log_dict = stat_log_model.get_dict("act_id=%s and module_id=%s and orm_id=%s and user_id=%s and object_id=%s", field="id", params=[stat_queue_dict["act_id"], stat_queue_dict["module_id"], stat_orm.id, stat_queue_dict["user_id"], stat_queue_dict.get("object_id",'')])
+                        else:
+                            stat_log_dict = stat_log_model.get_dict("act_id=%s and module_id=%s and orm_id=%s and user_id=%s and create_day=%s and object_id=%s", field="id", params=[stat_queue_dict["act_id"], stat_queue_dict["module_id"], stat_orm.id, stat_queue_dict["user_id"], create_day_int, stat_queue_dict.get("object_id",'')])
+                        if stat_log_dict:
+                            is_add = False
+
+                    stat_log = StatLog()
+                    stat_log.app_id = stat_queue_dict["app_id"]
+                    stat_log.act_id = stat_queue_dict["act_id"]
+                    stat_log.module_id = stat_queue_dict["module_id"]
+                    stat_log.object_id = stat_queue_dict.get("object_id",'')
+                    stat_log.orm_id = stat_orm.id
+                    stat_log.user_id = stat_queue_dict["user_id"]
+                    stat_log.open_id = stat_queue_dict["open_id"]
+                    stat_log.key_value = stat_queue_dict["key_value"]
+                    stat_log.create_day = create_day_int
+                    stat_log.create_month = create_month_int
+                    stat_log.create_date = create_date
+
+                    stat_report_condition = "act_id=%s and module_id=%s and object_id=%s and key_name=%s and create_day=%s"
+                    stat_report_param = [stat_queue_dict["act_id"], stat_queue_dict["module_id"], stat_queue_dict.get("object_id",''), stat_queue_dict["key_name"], create_day_int]
+                    stat_report_dict = stat_report_model.get_dict(stat_report_condition, params=stat_report_param)
+
+                    if is_add:
+                        db_transaction.begin_transaction()
+                        if not stat_report_dict:
+                            stat_report = StatReport()
+                            stat_report.app_id = stat_queue_dict["app_id"]
+                            stat_report.act_id = stat_queue_dict["act_id"]
+                            stat_report.module_id = stat_queue_dict["module_id"]
+                            stat_report.object_id = stat_queue_dict.get("object_id",'')
+                            stat_report.key_name = stat_queue_dict["key_name"]
+                            stat_report.key_value = stat_queue_dict["key_value"]
+                            stat_report.create_date = create_date
+                            stat_report.create_year = create_year_int
+                            stat_report.create_month = create_month_int
+                            stat_report.create_day = create_day_int
+                            stat_report_model.add_entity(stat_report)
+                        else:
+                            key_value = stat_queue_dict["key_value"]
+                            stat_report_model.update_table(f"key_value=key_value+{key_value}", stat_report_condition, params=stat_report_param)
+                        stat_log_model.add_entity(stat_log)
+                        result,message = db_transaction.commit_transaction(True)
+                        if result == False:
+                            raise Exception("执行事务失败", message)
+
+                    redis_init.lpop(redis_stat_key)
+
+                except Exception as ex:
+                    logger_error.error(f"统计队列{mod_value}异常,json串:{SevenHelper.json_dumps(stat_queue_dict)},ex:{traceback.format_exc()}")
+                    continue
+
+            except Exception as ex:
+                logger_error.error(f"统计队列{mod_value}异常,ex:{traceback.format_exc()}")
+                time.sleep(5)
+
+    def _process_redis_stat_user_queue(self, mod_value):
+        """
+        :description: 处理redis统计用户队列
+        :param mod_value: 当前队列值
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        print(f"{TimeHelper.get_now_format_time()} 统计用户队列{mod_value}启动")
+
+        while True:
+            try:
+                time.sleep(0.1)
+                db_transaction = DbTransaction(db_config_dict=config.get_value("db_cloudapp"))
+                redis_init = SevenHelper.redis_init()
+                redis_stat_key = f"stat_user_queue_list:{mod_value}"
+                stat_queue_json = redis_init.lindex(redis_stat_key, index=0)
+                if not stat_queue_json:
+                    time.sleep(1)
+                    continue
+                try:
+                    stat_queue_dict = SevenHelper.json_loads(stat_queue_json)
+                    stat_user_log_model = StatUserLogModel(sub_table=FrameBaseModel().get_business_sub_table("stat_user_log_tb", {"app_id": stat_queue_dict["app_id"]}),db_transaction=db_transaction)
+                    stat_user_report_model = StatUserReportModel(db_transaction=db_transaction)
+                    create_date = TimeHelper.format_time_to_datetime(stat_queue_dict["create_date"])
+                    create_day_int = int(create_date.strftime('%Y%m%d'))
+                    create_month_int = int(create_date.strftime('%Y%m'))
+                    create_year_int = int(create_date.strftime('%Y'))
+                    field_name = stat_queue_dict["key_name"]
+
+                    stat_user_log = StatUserLog()
+                    stat_user_log.app_id = stat_queue_dict["app_id"]
+                    stat_user_log.act_id = stat_queue_dict["act_id"]
+                    stat_user_log.module_id = stat_queue_dict["module_id"]
+                    stat_user_log.user_id = stat_queue_dict["user_id"]
+                    stat_user_log.open_id = stat_queue_dict["open_id"]
+                    stat_user_log.key_name = field_name
+                    stat_user_log.key_value = stat_queue_dict["key_value"]
+                    stat_user_log.request_code = stat_queue_dict.get("request_code","")
+                    stat_user_log.create_day = create_day_int
+                    stat_user_log.create_month = create_month_int
+                    stat_user_log.create_date = create_date
+
+                    stat_report_condition = "act_id=%s and module_id=%s and create_day=%s and user_id=%s"
+                    stat_report_param = [stat_queue_dict["act_id"], stat_queue_dict["module_id"], create_day_int, stat_queue_dict["user_id"]]
+                    stat_report_dict = stat_user_report_model.get_dict(stat_report_condition, params=stat_report_param)
+                    if not stat_report_dict:
+                        stat_user_report = StatUserReport()
+                        stat_user_report.app_id = stat_queue_dict["app_id"]
+                        stat_user_report.act_id = stat_queue_dict["act_id"]
+                        stat_user_report.module_id = stat_queue_dict["module_id"]
+                        stat_user_report.user_id = stat_queue_dict["user_id"]
+                        stat_user_report.open_id = stat_queue_dict["open_id"]
+                        stat_user_report.key_name = field_name
+                        stat_user_report.key_value = stat_queue_dict["key_value"]
+                        stat_user_report.create_date = create_date
+                        stat_user_report.create_year = create_year_int
+                        stat_user_report.create_month = create_month_int
+                        stat_user_report.create_day = create_day_int
+                        stat_user_report_model.add_entity(stat_user_report)
+
+                    db_transaction.begin_transaction()
+                    key_value = stat_queue_dict["key_value"]
+                    stat_user_report_model.update_table(f"{field_name}={field_name}+{key_value}", stat_report_condition, params=stat_report_param)
+                    stat_user_log_model.add_entity(stat_user_log)
+                    result,message = db_transaction.commit_transaction(True)
+                    if result == False:
+                        raise Exception("执行事务失败", message)
+
+                    redis_init.lpop(redis_stat_key)
+
+                except Exception as ex:
+                    logger_error.error(f"统计用户队列{mod_value}异常,json串:{SevenHelper.json_dumps(stat_queue_dict)},ex:{traceback.format_exc()}")
+                    continue
+
+            except Exception as ex:
+                logger_error.error(f"统计用户队列{mod_value}异常,ex:{traceback.format_exc()}")
+                time.sleep(5)
+
+
+class ClearDataWork(TimingWork):
+    """
+    :description: 清理数据
+    :return: 
+    :last_editors: HuangJianYi
+    """
+    def execute(self):
+        invoke_result_data = InvokeResultData()
+        self.process_only_table()
+
+        return invoke_result_data
+
+    def process_only_table(self):
+        """
+        :description: 处理单表
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        stat_log_model = StatLogModel()
+        stat_orm_model = StatOrmModel()
+        page_index = 0
+        while True:
+            stat_orm_dict_list, is_next = stat_orm_model.get_dict_page_list(field="id,repeat_type", page_index=page_index, page_size=200, order_by="id asc", page_count_mode="next")
+            if len(stat_orm_dict_list) <= 0:
+                break
+            for stat_orm_dict in stat_orm_dict_list:
+                if stat_orm_dict["repeat_type"] != 2:
+                    while True:
+                        is_del = stat_log_model.del_entity("orm_id=%s and create_day<%s", params=[stat_orm_dict["id"], SevenHelper.get_now_day_int(-24 * 15)], limit="100")
+                        if is_del == False:
+                            break
+            page_index += 1
+
+
+class StatUserDataWork(TimingWork):
+    """
+    :description: 处理统计用户数据（用户汇总报表只保留1年的记录，流水只保留1个月）
+    :return: 
+    :last_editors: HuangJianYi
+    """
+
+    def execute(self):
+        invoke_result_data = InvokeResultData()
+        self.clear_log()
+        self.clear_report()
+        return invoke_result_data
+
+    def clear_log(self):
+        """
+        :description: 清理流水
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        stat_log_model = StatUserLogModel()
+        stat_config = share_config.get_value("stat_config", {})
+        space_day = int(stat_config.get("user_log_space_day", 30))
+        while True:
+            is_del = stat_log_model.del_entity("create_day<%s", params=[SevenHelper.get_now_day_int(-24 * space_day)], limit="100")
+            if is_del == False:
+                break
+
+    def clear_report(self):
+        """
+        :description: 清理报表(用户统计表需要按年创建分表，然后把数据加入到对应的年分表中，没建表则无法清理报表)
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        stat_user_report_model = StatUserReportModel()
+        stat_config = share_config.get_value("stat_config", {})
+        space_day = int(stat_config.get("user_report_space_day", 365))
+        while True:
+            stat_user_report_list = stat_user_report_model.get_list(where="create_day<%s", order_by="id asc", limit="200", params=[SevenHelper.get_now_day_int(-24 * space_day)])
+            if len(stat_user_report_list) <= 0:
+                break
+            for item in stat_user_report_list:
+                create_year = item.create_year
+                stat_user_report_year_model = StatUserReportModel(sub_table=f"{create_year}")
+                stat_user_report_year_model.add_entity(item)
+                stat_user_report_model.del_entity("id=%s", params=[item.id])
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/console_models/task_console_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/console_models/task_console_model.py`

 * *Ordering differences only*

 * *Files 20% similar despite different names*

```diff
@@ -1,63 +1,63 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-19 13:37:16
-@LastEditTime: 2023-06-08 17:49:57
-@LastEditors: HuangJianYi
-@Description: 
-"""
-import threading
-from seven_framework.console.base_console import *
-from seven_cloudapp_frame.models.enum import *
-from seven_cloudapp_frame.models.frame_base_model import *
-from seven_cloudapp_frame.models.task_base_model import *
-from seven_cloudapp_frame.libs.customize.seven_helper import *
-from seven_cloudapp_frame.libs.common import *
-from seven_cloudapp_frame.models.db_models.task.task_gear_count_model import *
-from seven_cloudapp_frame.models.db_models.task.task_info_model import *
-from seven_cloudapp_frame.models.db_models.task.task_count_model import *
-
-
-class TaskConsoleModel():
-    """
-    :description: 任务控制台业务模型
-    """
-
-    def console_task_queue(self):
-        """
-        :description: 控制台统计上报
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        for i in range(10):
-            j = threading.Thread(target=self.process_task_queue, args=[i])
-            j.start()
-
-    def process_task_queue(self, mod_value):
-        """
-        :description: 处理档位任务队列
-        :param mod_value: 当前队列值
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        print(f"{TimeHelper.get_now_format_time()} 档位任务队列{mod_value}启动")
-
-        while True:
-            try:
-                time.sleep(0.1)
-
-                redis_init = SevenHelper.redis_init()
-                redis_key = f"task_gear_list:{mod_value}"
-                task_queue_json = redis_init.lindex(redis_key, index=0)
-                if not task_queue_json:
-                    time.sleep(1)
-                    continue
-                task_queue_dict = SevenHelper.json_loads(task_queue_json)
-                task_base_model = TaskBaseModel(logging_error=logger_error)
-                invoke_result_data = task_base_model.add_gear_task_count_to_db(task_queue_dict["app_id"], task_queue_dict["act_id"], task_queue_dict["module_id"], task_queue_dict["user_id"], task_queue_dict["open_id"], task_queue_dict["task_type"], task_queue_dict["now_count"], task_queue_dict["remark"])
-                if invoke_result_data.success == True:
-                    redis_init.lpop(redis_key)
-
-            except Exception as ex:
-                logger_error.error(f"档位任务队列{mod_value}异常,ex:{traceback.format_exc()}")
-                time.sleep(5)
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-19 13:37:16
+@LastEditTime: 2023-06-08 17:49:57
+@LastEditors: HuangJianYi
+@Description: 
+"""
+import threading
+from seven_framework.console.base_console import *
+from seven_cloudapp_frame.models.enum import *
+from seven_cloudapp_frame.models.frame_base_model import *
+from seven_cloudapp_frame.models.task_base_model import *
+from seven_cloudapp_frame.libs.customize.seven_helper import *
+from seven_cloudapp_frame.libs.common import *
+from seven_cloudapp_frame.models.db_models.task.task_gear_count_model import *
+from seven_cloudapp_frame.models.db_models.task.task_info_model import *
+from seven_cloudapp_frame.models.db_models.task.task_count_model import *
+
+
+class TaskConsoleModel():
+    """
+    :description: 任务控制台业务模型
+    """
+
+    def console_task_queue(self):
+        """
+        :description: 控制台统计上报
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        for i in range(10):
+            j = threading.Thread(target=self.process_task_queue, args=[i])
+            j.start()
+
+    def process_task_queue(self, mod_value):
+        """
+        :description: 处理档位任务队列
+        :param mod_value: 当前队列值
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        print(f"{TimeHelper.get_now_format_time()} 档位任务队列{mod_value}启动")
+
+        while True:
+            try:
+                time.sleep(0.1)
+
+                redis_init = SevenHelper.redis_init()
+                redis_key = f"task_gear_list:{mod_value}"
+                task_queue_json = redis_init.lindex(redis_key, index=0)
+                if not task_queue_json:
+                    time.sleep(1)
+                    continue
+                task_queue_dict = SevenHelper.json_loads(task_queue_json)
+                task_base_model = TaskBaseModel(logging_error=logger_error)
+                invoke_result_data = task_base_model.add_gear_task_count_to_db(task_queue_dict["app_id"], task_queue_dict["act_id"], task_queue_dict["module_id"], task_queue_dict["user_id"], task_queue_dict["open_id"], task_queue_dict["task_type"], task_queue_dict["now_count"], task_queue_dict["remark"])
+                if invoke_result_data.success == True:
+                    redis_init.lpop(redis_key)
+
+            except Exception as ex:
+                logger_error.error(f"档位任务队列{mod_value}异常,ex:{traceback.format_exc()}")
+                time.sleep(5)
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/console_models/timing_work_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/console_models/timing_work_model.py`

 * *Ordering differences only*

 * *Files 14% similar despite different names*

```diff
@@ -1,122 +1,122 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-19 13:37:16
-@LastEditTime: 2023-02-10 10:42:46
-@LastEditors: HuangJianYi
-@Description: 
-"""
-import threading, multiprocessing
-from seven_cloudapp_frame.libs.common import *
-from seven_cloudapp_frame.models.seven_model import InvokeResultData
-from seven_framework import *
-from seven_framework.console.base_console import *
-
-class TimingWork():
-    """
-    :description: 定时作业
-    """
-    def __init__(self):
-        self.work_name = "" #作业名称
-        self.start_hours = 0 #开始小时
-        self.end_hours = 24 #结束小时
-        self.fail_count = 0 #失败重试次数
-        self.fail_sleep_time = 1 #失败休眠时间，单位秒
-        self.sleep_time = 1 #休眠时间，单位秒
-        self.is_execute_one = False #是否执行一次
-
-    do_work_thread = None
-
-    def execute(self):
-        """
-        :description: 执行内容，用于重写
-        :return: InvokeResultData
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        is_stop_work = False
-        return invoke_result_data,is_stop_work
-
-    def __process_work(self,work_name):
-        """
-        :description: 处理作业 "job_config":{"work1":{"start_hours":0,"end_hours":24},"work2":{"start_hours":0,"end_hours":24}}
-        :param work_name: 作业名称
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        self.work_name = work_name
-        job_config = share_config.get_value("job_config", {})
-        content_dict = job_config.get(work_name,None)
-        if content_dict:
-            self.start_hours = content_dict.get("start_hours",0)
-            self.end_hours = content_dict.get("end_hours",24)
-            self.fail_count = content_dict.get("fail_count",0)
-            self.fail_sleep_time = content_dict.get("fail_sleep_time",1)
-            self.sleep_time = content_dict.get("sleep_time",1)
-            self.is_execute_one = content_dict.get("is_execute_one",False)
-        while True:
-            now_hour = TimeHelper.get_now_datetime().hour
-            if now_hour >= self.start_hours and now_hour <= self.end_hours:
-                invoke_result_data = InvokeResultData()
-                is_stop_work = False
-                try:
-                    execute_result = self.execute()
-                    if isinstance(execute_result, tuple):
-                        invoke_result_data = execute_result[0]
-                        is_stop_work = execute_result[1]
-                    else:
-                        invoke_result_data = execute_result
-                except:
-                    invoke_result_data.success = False
-                if invoke_result_data.success == False and self.fail_count > 0 and is_stop_work == False:
-                    for i in range(self.fail_count):
-                        try:
-                            execute_result = self.execute()
-                            if isinstance(execute_result, tuple):
-                                invoke_result_data = execute_result[0]
-                                is_stop_work = execute_result[1]
-                            else:
-                                invoke_result_data = execute_result
-                        except:
-                            invoke_result_data.success = False
-                        if is_stop_work == True:
-                            print("定时:" + work_name + "强行停止运行")
-                            break
-                        if invoke_result_data.success == True:
-                            print("定时:" + work_name + "第" + (i + 1) + "次尝试执行成功")
-                            break
-                        else:
-                            print("定时:" + work_name + "第" + (i + 1) + "次尝试执行失败")
-                            if self.fail_count > 0:
-                                time.sleep(self.fail_sleep_time)
-                if invoke_result_data.success == True:
-                    print("定时:" + work_name + "本次执行成功")
-                else:
-                    print("定时:" + work_name + "本次执行失败,ex:" + traceback.format_exc())
-                if is_stop_work == True:
-                    print("定时:" + work_name + "强行停止运行")
-                    break
-                if self.is_execute_one == True:
-                    time.sleep(60*60)
-                    break
-                else:
-                    time.sleep(self.sleep_time)
-            else:
-                time.sleep(10)
-
-    def start_work(self,work_name):
-        """
-        :description: 开始执行
-        :param work_name: 作业名称
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        try:
-            if self.do_work_thread == None:
-                print("定时:" + work_name + "开始启动")
-                self.do_work_thread = threading.Thread(target=self.__process_work, args=[work_name])
-                self.do_work_thread.start()
-                print("定时:" + work_name + "启动成功")
-        except:
-            logger_error.error(f"定时:{work_name}启动异常,ex:{traceback.format_exc()}")
-            print(f"定时:{work_name}启动异常,ex:{traceback.format_exc()}")
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-19 13:37:16
+@LastEditTime: 2023-02-10 10:42:46
+@LastEditors: HuangJianYi
+@Description: 
+"""
+import threading, multiprocessing
+from seven_cloudapp_frame.libs.common import *
+from seven_cloudapp_frame.models.seven_model import InvokeResultData
+from seven_framework import *
+from seven_framework.console.base_console import *
+
+class TimingWork():
+    """
+    :description: 定时作业
+    """
+    def __init__(self):
+        self.work_name = "" #作业名称
+        self.start_hours = 0 #开始小时
+        self.end_hours = 24 #结束小时
+        self.fail_count = 0 #失败重试次数
+        self.fail_sleep_time = 1 #失败休眠时间，单位秒
+        self.sleep_time = 1 #休眠时间，单位秒
+        self.is_execute_one = False #是否执行一次
+
+    do_work_thread = None
+
+    def execute(self):
+        """
+        :description: 执行内容，用于重写
+        :return: InvokeResultData
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        is_stop_work = False
+        return invoke_result_data,is_stop_work
+
+    def __process_work(self,work_name):
+        """
+        :description: 处理作业 "job_config":{"work1":{"start_hours":0,"end_hours":24},"work2":{"start_hours":0,"end_hours":24}}
+        :param work_name: 作业名称
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        self.work_name = work_name
+        job_config = share_config.get_value("job_config", {})
+        content_dict = job_config.get(work_name,None)
+        if content_dict:
+            self.start_hours = content_dict.get("start_hours",0)
+            self.end_hours = content_dict.get("end_hours",24)
+            self.fail_count = content_dict.get("fail_count",0)
+            self.fail_sleep_time = content_dict.get("fail_sleep_time",1)
+            self.sleep_time = content_dict.get("sleep_time",1)
+            self.is_execute_one = content_dict.get("is_execute_one",False)
+        while True:
+            now_hour = TimeHelper.get_now_datetime().hour
+            if now_hour >= self.start_hours and now_hour <= self.end_hours:
+                invoke_result_data = InvokeResultData()
+                is_stop_work = False
+                try:
+                    execute_result = self.execute()
+                    if isinstance(execute_result, tuple):
+                        invoke_result_data = execute_result[0]
+                        is_stop_work = execute_result[1]
+                    else:
+                        invoke_result_data = execute_result
+                except:
+                    invoke_result_data.success = False
+                if invoke_result_data.success == False and self.fail_count > 0 and is_stop_work == False:
+                    for i in range(self.fail_count):
+                        try:
+                            execute_result = self.execute()
+                            if isinstance(execute_result, tuple):
+                                invoke_result_data = execute_result[0]
+                                is_stop_work = execute_result[1]
+                            else:
+                                invoke_result_data = execute_result
+                        except:
+                            invoke_result_data.success = False
+                        if is_stop_work == True:
+                            print("定时:" + work_name + "强行停止运行")
+                            break
+                        if invoke_result_data.success == True:
+                            print("定时:" + work_name + "第" + (i + 1) + "次尝试执行成功")
+                            break
+                        else:
+                            print("定时:" + work_name + "第" + (i + 1) + "次尝试执行失败")
+                            if self.fail_count > 0:
+                                time.sleep(self.fail_sleep_time)
+                if invoke_result_data.success == True:
+                    print("定时:" + work_name + "本次执行成功")
+                else:
+                    print("定时:" + work_name + "本次执行失败,ex:" + traceback.format_exc())
+                if is_stop_work == True:
+                    print("定时:" + work_name + "强行停止运行")
+                    break
+                if self.is_execute_one == True:
+                    time.sleep(60*60)
+                    break
+                else:
+                    time.sleep(self.sleep_time)
+            else:
+                time.sleep(10)
+
+    def start_work(self,work_name):
+        """
+        :description: 开始执行
+        :param work_name: 作业名称
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        try:
+            if self.do_work_thread == None:
+                print("定时:" + work_name + "开始启动")
+                self.do_work_thread = threading.Thread(target=self.__process_work, args=[work_name])
+                self.do_work_thread.start()
+                print("定时:" + work_name + "启动成功")
+        except:
+            logger_error.error(f"定时:{work_name}启动异常,ex:{traceback.format_exc()}")
+            print(f"定时:{work_name}启动异常,ex:{traceback.format_exc()}")
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/act/act_info_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/act/act_info_model.py`

 * *Ordering differences only*

 * *Files 26% similar despite different names*

```diff
@@ -1,85 +1,85 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-27 10:58:31
-@LastEditTime: 2023-01-12 09:14:53
-@LastEditors: HuangJianYi
-@Description: 
-"""
-
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-class ActInfoModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(ActInfoModel, self).__init__(ActInfo, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class ActInfo:
-
-    def __init__(self):
-        super(ActInfo, self).__init__()
-        self.id = 0  # id
-        self.app_id = ""  # 应用标识
-        self.act_name = ""  # 活动名称
-        self.act_type = 0  # 活动类型
-        self.theme_id = 0  # 主题标识
-        self.is_visit_store = 0  # 是否开启访问店铺
-        self.store_url = ""  # 店铺地址
-        self.close_word = ""  # 关闭小程序文案
-        self.is_share = 0  # 是否开启分享(1是0否)
-        self.share_desc_json = ""  # 分享内容
-        self.is_rule = 0  # 是否显示规则（1是0否）
-        self.rule_desc_json = ""  # 规则内容
-        self.start_date = "1900-01-01 00:00:00"  # 开始时间
-        self.end_date = "1900-01-01 00:00:00"  # 结束时间
-        self.is_black = 0  # 是否开启黑名单
-        self.refund_count = 0  # 退款次数
-        self.finish_menu_config_json = ""  # 已配置的菜单json
-        self.is_finish = 0  # 是否完成配置
-        self.is_launch = 0  # 是否开启投放（1是0否）
-        self.is_del = 0  # 是否删除（1是0否）
-        self.join_ways = 0  # 活动参与条件（0所有1关注店铺2加入会员3指定用户）
-        self.is_fictitious = 0  # 是否开启虚拟中奖（1是0否）
-        self.task_asset_type_json = ""  # 任务货币类型（字典数组）
-        self.lc_order_id = ""  # 小部件orderId
-        self.agreement_json = "" # 协议内容（用户协议或隐私条款）
-        self.brand_json = ""  # 品牌内容
-        self.is_release = 0  # 是否发布（1是0否）
-        self.release_date = "1900-01-01 00:00:00"  # 发布时间
-        self.sort_index = 0  # 排序号
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.modify_date = "1900-01-01 00:00:00"  # 更新时间
-        self.i1 = 0  # i1
-        self.i2 = 0  # i2
-        self.i3 = 0  # i3
-        self.i4 = 0  # i4
-        self.i5 = 0  # i5
-        self.s1 = ""  # s1
-        self.s2 = ""  # s2
-        self.s3 = ""  # s3
-        self.s4 = ""  # s4
-        self.s5 = ""  # s5
-        self.d1 = "1900-01-01 00:00:00"  # d1
-        self.d2 = "1900-01-01 00:00:00"  # d2
-
-    @classmethod
-    def get_field_list(self):
-        return [
-            'id', 'app_id', 'act_name', 'act_type', 'theme_id', 'is_visit_store', 'store_url', 'close_word', 'is_share', 'share_desc_json', 'is_rule', 'rule_desc_json', 'start_date', 'end_date', 'is_black', 'refund_count', 'finish_menu_config_json', 'is_finish', 'is_launch', 'is_del', 'join_ways', 'is_fictitious', 'task_asset_type_json', 'lc_order_id', 'agreement_json', 'brand_json', 'is_release', 'release_date', 'sort_index', 'create_date', 'modify_date', 'i1', 'i2', 'i3', 'i4', 'i5', 's1',
-            's2', 's3', 's4', 's5', 'd1', 'd2'
-        ]
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "act_info_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-27 10:58:31
+@LastEditTime: 2023-01-12 09:14:53
+@LastEditors: HuangJianYi
+@Description: 
+"""
+
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+class ActInfoModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(ActInfoModel, self).__init__(ActInfo, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class ActInfo:
+
+    def __init__(self):
+        super(ActInfo, self).__init__()
+        self.id = 0  # id
+        self.app_id = ""  # 应用标识
+        self.act_name = ""  # 活动名称
+        self.act_type = 0  # 活动类型
+        self.theme_id = 0  # 主题标识
+        self.is_visit_store = 0  # 是否开启访问店铺
+        self.store_url = ""  # 店铺地址
+        self.close_word = ""  # 关闭小程序文案
+        self.is_share = 0  # 是否开启分享(1是0否)
+        self.share_desc_json = ""  # 分享内容
+        self.is_rule = 0  # 是否显示规则（1是0否）
+        self.rule_desc_json = ""  # 规则内容
+        self.start_date = "1900-01-01 00:00:00"  # 开始时间
+        self.end_date = "1900-01-01 00:00:00"  # 结束时间
+        self.is_black = 0  # 是否开启黑名单
+        self.refund_count = 0  # 退款次数
+        self.finish_menu_config_json = ""  # 已配置的菜单json
+        self.is_finish = 0  # 是否完成配置
+        self.is_launch = 0  # 是否开启投放（1是0否）
+        self.is_del = 0  # 是否删除（1是0否）
+        self.join_ways = 0  # 活动参与条件（0所有1关注店铺2加入会员3指定用户）
+        self.is_fictitious = 0  # 是否开启虚拟中奖（1是0否）
+        self.task_asset_type_json = ""  # 任务货币类型（字典数组）
+        self.lc_order_id = ""  # 小部件orderId
+        self.agreement_json = "" # 协议内容（用户协议或隐私条款）
+        self.brand_json = ""  # 品牌内容
+        self.is_release = 0  # 是否发布（1是0否）
+        self.release_date = "1900-01-01 00:00:00"  # 发布时间
+        self.sort_index = 0  # 排序号
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.modify_date = "1900-01-01 00:00:00"  # 更新时间
+        self.i1 = 0  # i1
+        self.i2 = 0  # i2
+        self.i3 = 0  # i3
+        self.i4 = 0  # i4
+        self.i5 = 0  # i5
+        self.s1 = ""  # s1
+        self.s2 = ""  # s2
+        self.s3 = ""  # s3
+        self.s4 = ""  # s4
+        self.s5 = ""  # s5
+        self.d1 = "1900-01-01 00:00:00"  # d1
+        self.d2 = "1900-01-01 00:00:00"  # d2
+
+    @classmethod
+    def get_field_list(self):
+        return [
+            'id', 'app_id', 'act_name', 'act_type', 'theme_id', 'is_visit_store', 'store_url', 'close_word', 'is_share', 'share_desc_json', 'is_rule', 'rule_desc_json', 'start_date', 'end_date', 'is_black', 'refund_count', 'finish_menu_config_json', 'is_finish', 'is_launch', 'is_del', 'join_ways', 'is_fictitious', 'task_asset_type_json', 'lc_order_id', 'agreement_json', 'brand_json', 'is_release', 'release_date', 'sort_index', 'create_date', 'modify_date', 'i1', 'i2', 'i3', 'i4', 'i5', 's1',
+            's2', 's3', 's4', 's5', 'd1', 'd2'
+        ]
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "act_info_tb"
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/act/act_module_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/act/act_module_model.py`

 * *Ordering differences only*

 * *Files 14% similar despite different names*

```diff
@@ -1,74 +1,74 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-27 10:55:09
-@LastEditTime: 2023-03-13 11:22:34
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class ActModuleModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(ActModuleModel, self).__init__(ActModule, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class ActModule:
-
-    def __init__(self):
-        super(ActModule, self).__init__()
-        self.id = 0  #
-        self.app_id = ""  # 应用标识
-        self.act_id = 0  # 活动标识
-        self.business_type = 0  # 业务类型(0无1机台2活动)
-        self.module_name = ""  # 模块名称
-        self.module_sub_name = ""  # 模块短名称
-        self.module_type = 0  # 模块类型
-        self.start_date = "1900-01-01 00:00:00"  # 开始时间
-        self.end_date = "1900-01-01 00:00:00"  # 结束时间
-        self.skin_id = 0  # 皮肤标识
-        self.module_pic = ""  # 模块图片
-        self.module_desc = ""  # 描述信息
-        self.price = 0  # 价格
-        self.price_gear_id = 0  # 档位标识
-        self.ip_id = 0  # IP标识
-        self.join_ways = 0  # 活动参与条件（0所有1关注店铺2加入会员3指定用户）
-        self.is_fictitious = 0  # 是否开启虚拟中奖（1是0否）
-        self.sort_index = 0  # 排序
-        self.is_release = 0  # 是否发布（1是0否）
-        self.release_date = "1900-01-01 00:00:00"  # 发布时间
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.modify_date = "1900-01-01 00:00:00"  # 更新时间
-        self.is_del = 0  # 是否删除（1是0否）
-        self.i1 = 0  # i1
-        self.i2 = 0  # i2
-        self.i3 = 0  # i3
-        self.i4 = 0  # i4
-        self.i5 = 0  # i5
-        self.s1 = ""  # s1
-        self.s2 = ""  # s2
-        self.s3 = ""  # s3
-        self.s4 = ""  # s4
-        self.s5 = ""  # s5
-        self.d1 = "1900-01-01 00:00:00"  # d1
-        self.d2 = "1900-01-01 00:00:00"  # d2
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'app_id', 'act_id', 'business_type', 'module_name', 'module_sub_name', 'module_type', 'start_date', 'end_date', 'skin_id', 'module_pic', 'module_desc', 'price', 'price_gear_id', 'ip_id', 'join_ways', 'is_fictitious', 'sort_index', 'is_release', 'release_date', 'create_date', 'modify_date', 'is_del', 'i1', 'i2', 'i3', 'i4', 'i5', 's1', 's2', 's3', 's4', 's5', 'd1', 'd2']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "act_module_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-27 10:55:09
+@LastEditTime: 2023-03-13 11:22:34
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class ActModuleModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(ActModuleModel, self).__init__(ActModule, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class ActModule:
+
+    def __init__(self):
+        super(ActModule, self).__init__()
+        self.id = 0  #
+        self.app_id = ""  # 应用标识
+        self.act_id = 0  # 活动标识
+        self.business_type = 0  # 业务类型(0无1机台2活动)
+        self.module_name = ""  # 模块名称
+        self.module_sub_name = ""  # 模块短名称
+        self.module_type = 0  # 模块类型
+        self.start_date = "1900-01-01 00:00:00"  # 开始时间
+        self.end_date = "1900-01-01 00:00:00"  # 结束时间
+        self.skin_id = 0  # 皮肤标识
+        self.module_pic = ""  # 模块图片
+        self.module_desc = ""  # 描述信息
+        self.price = 0  # 价格
+        self.price_gear_id = 0  # 档位标识
+        self.ip_id = 0  # IP标识
+        self.join_ways = 0  # 活动参与条件（0所有1关注店铺2加入会员3指定用户）
+        self.is_fictitious = 0  # 是否开启虚拟中奖（1是0否）
+        self.sort_index = 0  # 排序
+        self.is_release = 0  # 是否发布（1是0否）
+        self.release_date = "1900-01-01 00:00:00"  # 发布时间
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.modify_date = "1900-01-01 00:00:00"  # 更新时间
+        self.is_del = 0  # 是否删除（1是0否）
+        self.i1 = 0  # i1
+        self.i2 = 0  # i2
+        self.i3 = 0  # i3
+        self.i4 = 0  # i4
+        self.i5 = 0  # i5
+        self.s1 = ""  # s1
+        self.s2 = ""  # s2
+        self.s3 = ""  # s3
+        self.s4 = ""  # s4
+        self.s5 = ""  # s5
+        self.d1 = "1900-01-01 00:00:00"  # d1
+        self.d2 = "1900-01-01 00:00:00"  # d2
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'app_id', 'act_id', 'business_type', 'module_name', 'module_sub_name', 'module_type', 'start_date', 'end_date', 'skin_id', 'module_pic', 'module_desc', 'price', 'price_gear_id', 'ip_id', 'join_ways', 'is_fictitious', 'sort_index', 'is_release', 'release_date', 'create_date', 'modify_date', 'is_del', 'i1', 'i2', 'i3', 'i4', 'i5', 's1', 's2', 's3', 's4', 's5', 'd1', 'd2']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "act_module_tb"
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/act/act_prize_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/act/act_prize_model.py`

 * *Ordering differences only*

 * *Files 19% similar despite different names*

```diff
@@ -1,84 +1,84 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-27 10:59:46
-@LastEditTime: 2023-05-05 15:16:14
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class ActPrizeModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(ActPrizeModel, self).__init__(ActPrize, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class ActPrize:
-
-    def __init__(self):
-        super(ActPrize, self).__init__()
-        self.id = 0  # 标识
-        self.app_id = ""  # 应用标识
-        self.act_id = 0  # 活动标识
-        self.module_id = 0  # 活动模块标识
-        self.ascription_type = 0  # 奖品归属类型（0-活动奖品1-任务奖品2-兑换奖品）业务自定义从101开始
-        self.prize_name = ""  # 奖品名称
-        self.prize_title = ""  # 奖品子标题
-        self.prize_pic = ""  # 奖品图
-        self.prize_detail_json = ""  # 奖品详情json
-        self.goods_id = ""  # 商品ID
-        self.goods_code = ""  # 商品编码
-        self.goods_code_list = ""  # 多个sku商品编码
-        self.goods_type = 0  # 物品类型（1虚拟2实物）
-        self.prize_type = 0  # 奖品类型(1-现货 2-优惠券 3-红包 4-参与奖 5-预售 6-积分 7-卡片 8-专属下单商品)业务自定义从101开始
-        self.prize_price = 0  # 奖品价格
-        self.probability = 0  # 奖品权重
-        self.chance = 0  # 概率
-        self.prize_limit = 0  # 中奖限制
-        self.is_prize_notice = 0  # 是否显示跑马灯(1是0否)
-        self.surplus = 0  # 奖品库存
-        self.is_surplus = 0  # 是否显示奖品库存（1显示0-不显示）
-        self.prize_total = 0  # 奖品总数
-        self.hand_out = 0  # 已发出数量
-        self.lottery_type = 0  # 出奖类型（1概率出奖 2强制概率）
-        self.tag_name = ""  # 标签名称(奖项名称)
-        self.tag_id = 0  # 标签ID(奖项标识)
-        self.sort_index = 0  # 排序
-        self.is_del = 0  # 是否删除（1是0否）
-        self.is_release = 0  # 是否发布（1是0否）
-        self.is_sku = 0  # 是否有SKU
-        self.sku_json = ""  # sku详情json
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.modify_date = "1900-01-01 00:00:00"  # 更新时间
-        self.i1 = 0  # i1
-        self.i2 = 0  # i2
-        self.i3 = 0  # i3
-        self.i4 = 0  # i4
-        self.i5 = 0  # i5
-        self.s1 = ""  # s1
-        self.s2 = ""  # s2
-        self.s3 = ""  # s3
-        self.s4 = ""  # s4
-        self.s5 = ""  # s5
-        self.d1 = "1900-01-01 00:00:00"  # d1
-        self.d2 = "1900-01-01 00:00:00"  # d2
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'app_id', 'act_id', 'module_id', 'ascription_type', 'prize_name', 'prize_title', 'prize_pic', 'prize_detail_json', 'goods_id', 'goods_code', 'goods_code_list', 'goods_type', 'prize_type', 'prize_price', 'probability', 'chance', 'prize_limit', 'is_prize_notice', 'surplus', 'is_surplus', 'prize_total', 'hand_out', 'lottery_type', 'tag_name', 'tag_id', 'sort_index', 'is_del', 'is_release', 'is_sku', 'sku_json', 'create_date', 'modify_date', 'i1', 'i2', 'i3', 'i4', 'i5', 's1','s2', 's3', 's4', 's5', 'd1', 'd2']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "act_prize_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-27 10:59:46
+@LastEditTime: 2023-05-05 15:16:14
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class ActPrizeModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(ActPrizeModel, self).__init__(ActPrize, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class ActPrize:
+
+    def __init__(self):
+        super(ActPrize, self).__init__()
+        self.id = 0  # 标识
+        self.app_id = ""  # 应用标识
+        self.act_id = 0  # 活动标识
+        self.module_id = 0  # 活动模块标识
+        self.ascription_type = 0  # 奖品归属类型（0-活动奖品1-任务奖品2-兑换奖品）业务自定义从101开始
+        self.prize_name = ""  # 奖品名称
+        self.prize_title = ""  # 奖品子标题
+        self.prize_pic = ""  # 奖品图
+        self.prize_detail_json = ""  # 奖品详情json
+        self.goods_id = ""  # 商品ID
+        self.goods_code = ""  # 商品编码
+        self.goods_code_list = ""  # 多个sku商品编码
+        self.goods_type = 0  # 物品类型（1虚拟2实物）
+        self.prize_type = 0  # 奖品类型(1-现货 2-优惠券 3-红包 4-参与奖 5-预售 6-积分 7-卡片 8-专属下单商品)业务自定义从101开始
+        self.prize_price = 0  # 奖品价格
+        self.probability = 0  # 奖品权重
+        self.chance = 0  # 概率
+        self.prize_limit = 0  # 中奖限制
+        self.is_prize_notice = 0  # 是否显示跑马灯(1是0否)
+        self.surplus = 0  # 奖品库存
+        self.is_surplus = 0  # 是否显示奖品库存（1显示0-不显示）
+        self.prize_total = 0  # 奖品总数
+        self.hand_out = 0  # 已发出数量
+        self.lottery_type = 0  # 出奖类型（1概率出奖 2强制概率）
+        self.tag_name = ""  # 标签名称(奖项名称)
+        self.tag_id = 0  # 标签ID(奖项标识)
+        self.sort_index = 0  # 排序
+        self.is_del = 0  # 是否删除（1是0否）
+        self.is_release = 0  # 是否发布（1是0否）
+        self.is_sku = 0  # 是否有SKU
+        self.sku_json = ""  # sku详情json
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.modify_date = "1900-01-01 00:00:00"  # 更新时间
+        self.i1 = 0  # i1
+        self.i2 = 0  # i2
+        self.i3 = 0  # i3
+        self.i4 = 0  # i4
+        self.i5 = 0  # i5
+        self.s1 = ""  # s1
+        self.s2 = ""  # s2
+        self.s3 = ""  # s3
+        self.s4 = ""  # s4
+        self.s5 = ""  # s5
+        self.d1 = "1900-01-01 00:00:00"  # d1
+        self.d2 = "1900-01-01 00:00:00"  # d2
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'app_id', 'act_id', 'module_id', 'ascription_type', 'prize_name', 'prize_title', 'prize_pic', 'prize_detail_json', 'goods_id', 'goods_code', 'goods_code_list', 'goods_type', 'prize_type', 'prize_price', 'probability', 'chance', 'prize_limit', 'is_prize_notice', 'surplus', 'is_surplus', 'prize_total', 'hand_out', 'lottery_type', 'tag_name', 'tag_id', 'sort_index', 'is_del', 'is_release', 'is_sku', 'sku_json', 'create_date', 'modify_date', 'i1', 'i2', 'i3', 'i4', 'i5', 's1','s2', 's3', 's4', 's5', 'd1', 'd2']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "act_prize_tb"
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/act/act_type_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/act/act_type_model.py`

 * *Ordering differences only*

 * *Files 12% similar despite different names*

```diff
@@ -1,59 +1,59 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-27 10:55:09
-@LastEditTime: 2021-07-29 18:28:08
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class ActTypeModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(ActTypeModel, self).__init__(ActType, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class ActType:
-
-    def __init__(self):
-        super(ActType, self).__init__()
-        self.id = 0  # id
-        self.type_name = ""  # 类型名称
-        self.type_sub_name = ""  # 类型子名称
-        self.type_pic = ""  # 类型图片
-        self.market_ids = ""  # 所属营销方案id串（逗号分隔多个）
-        self.experience_pic = ""  # 体验二维码图
-        self.play_process_json = ""  # 玩法流程  举例:{"title": "玩法流程", "process_list": ["1.用户可通过付费购买获得拆盲盒次数"]}
-        self.suit_behavior_json = ""  # 适用行为 举例:{"title": "适用行业", "behavior_list": ["所有行业"]}
-        self.market_function_json = ""  # 营销功能 举例:{"title": "营销功能", "function_list": ["提升商品销量", "提升商品权重"]}
-        self.type_desc = ""  # 类型描述
-        self.task_asset_type_json = ""  # 任务货币类型（字典数组）
-        self.sort_index = 0  # 排序
-        self.is_release = 0  # 是否发布（1是0否）
-        self.release_date = "1900-01-01 00:00:00"  # 发布时间
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.modify_date = "1900-01-01 00:00:00"  # 更新时间
-        self.i1 = 0  # i1
-        self.i2 = 0  # i2
-        self.s1 = ''  # s1
-        self.s2 = ''  # s2
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'type_name', 'type_sub_name', 'type_pic', 'market_ids', 'experience_pic', 'play_process_json', 'suit_behavior_json', 'market_function_json', 'type_desc', 'task_asset_type_json', 'sort_index', 'is_release', 'release_date', 'create_date', 'modify_date', 'i1', 'i2', 's1', 's2']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "act_type_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-27 10:55:09
+@LastEditTime: 2021-07-29 18:28:08
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class ActTypeModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(ActTypeModel, self).__init__(ActType, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class ActType:
+
+    def __init__(self):
+        super(ActType, self).__init__()
+        self.id = 0  # id
+        self.type_name = ""  # 类型名称
+        self.type_sub_name = ""  # 类型子名称
+        self.type_pic = ""  # 类型图片
+        self.market_ids = ""  # 所属营销方案id串（逗号分隔多个）
+        self.experience_pic = ""  # 体验二维码图
+        self.play_process_json = ""  # 玩法流程  举例:{"title": "玩法流程", "process_list": ["1.用户可通过付费购买获得拆盲盒次数"]}
+        self.suit_behavior_json = ""  # 适用行为 举例:{"title": "适用行业", "behavior_list": ["所有行业"]}
+        self.market_function_json = ""  # 营销功能 举例:{"title": "营销功能", "function_list": ["提升商品销量", "提升商品权重"]}
+        self.type_desc = ""  # 类型描述
+        self.task_asset_type_json = ""  # 任务货币类型（字典数组）
+        self.sort_index = 0  # 排序
+        self.is_release = 0  # 是否发布（1是0否）
+        self.release_date = "1900-01-01 00:00:00"  # 发布时间
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.modify_date = "1900-01-01 00:00:00"  # 更新时间
+        self.i1 = 0  # i1
+        self.i2 = 0  # i2
+        self.s1 = ''  # s1
+        self.s2 = ''  # s2
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'type_name', 'type_sub_name', 'type_pic', 'market_ids', 'experience_pic', 'play_process_json', 'suit_behavior_json', 'market_function_json', 'type_desc', 'task_asset_type_json', 'sort_index', 'is_release', 'release_date', 'create_date', 'modify_date', 'i1', 'i2', 's1', 's2']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "act_type_tb"
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/app/app_info_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/app/app_info_model.py`

 * *Ordering differences only*

 * *Files 10% similar despite different names*

```diff
@@ -1,75 +1,75 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-20 10:09:52
-@LastEditTime: 2022-07-28 11:34:40
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class AppInfoModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(AppInfoModel, self).__init__(AppInfo, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class AppInfo:
-
-    def __init__(self):
-        super(AppInfo, self).__init__()
-        self.id = 0  # id
-        self.store_name = ""  # 店铺名称
-        self.store_user_nick = ""  # 店铺主帐号名称（会员名）
-        self.main_user_open_id = "" # 店铺主账号open_id
-        self.store_id = 0  # 店铺ID
-        self.store_icon = ""  # 店铺图标
-        self.seller_id = ""  # 卖家ID
-        self.app_id = ""  # app_id
-        self.app_name = ""  # 应用名称
-        self.app_icon = ""  # 应用图标
-        self.app_url = ""  # 小程序链接
-        self.app_ver = ""  # 应用版本
-        self.app_key = ""  # 应用密钥
-        self.access_token = ""  # access_token
-        self.preview_url = ""  # 预览地址
-        self.app_desc = ""  # 应用介绍
-        self.template_id = ""  # 模板标识
-        self.template_ver = ""  # 模板版本号
-        self.clients = ""  # 适用客户端（taobao和tmall）
-        self.app_telephone = ""  # 手机号码
-        self.is_instance = 0  # 是否实例化：0-未实例化，1-已实例化
-        self.instance_date = "1900-01-01 00:00:00"  # 实例化时间
-        self.is_setting = 0  # 是否完成数据配置：0-未完成，1-已配置
-        self.expiration_date = "1900-01-01 00:00:00"  # 过期时间
-        self.project_code = ""  # 项目编码
-        self.modify_date = "1900-01-01 00:00:00"  # 更新时间
-        self.is_gm = 0  # 是否开启gm权限：0-否，1-是
-        self.current_limit_count = 0  # 限流数量
-        self.i1 = 0  # i1
-        self.i2 = 0  # i2
-        self.i3 = 0  # i3
-        self.i4 = 0  # i4
-        self.s1 = ""  # s1
-        self.s2 = ""  # s2
-        self.s3 = ""  # s3
-        self.s4 = ""  # s4
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'store_name', 'store_user_nick','main_user_open_id', 'store_id', 'store_icon', 'seller_id', 'app_id', 'app_name', 'app_icon', 'app_url', 'app_ver', 'app_key', 'access_token', 'preview_url', 'app_desc', 'template_id', 'template_ver', 'clients', 'app_telephone', 'is_instance', 'instance_date', 'is_setting', 'expiration_date', 'project_code', 'modify_date', 'is_gm', 'current_limit_count', 'i1', 'i2', 'i3', 'i4', 's1', 's2', 's3', 's4']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "app_info_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-20 10:09:52
+@LastEditTime: 2022-07-28 11:34:40
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class AppInfoModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(AppInfoModel, self).__init__(AppInfo, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class AppInfo:
+
+    def __init__(self):
+        super(AppInfo, self).__init__()
+        self.id = 0  # id
+        self.store_name = ""  # 店铺名称
+        self.store_user_nick = ""  # 店铺主帐号名称（会员名）
+        self.main_user_open_id = "" # 店铺主账号open_id
+        self.store_id = 0  # 店铺ID
+        self.store_icon = ""  # 店铺图标
+        self.seller_id = ""  # 卖家ID
+        self.app_id = ""  # app_id
+        self.app_name = ""  # 应用名称
+        self.app_icon = ""  # 应用图标
+        self.app_url = ""  # 小程序链接
+        self.app_ver = ""  # 应用版本
+        self.app_key = ""  # 应用密钥
+        self.access_token = ""  # access_token
+        self.preview_url = ""  # 预览地址
+        self.app_desc = ""  # 应用介绍
+        self.template_id = ""  # 模板标识
+        self.template_ver = ""  # 模板版本号
+        self.clients = ""  # 适用客户端（taobao和tmall）
+        self.app_telephone = ""  # 手机号码
+        self.is_instance = 0  # 是否实例化：0-未实例化，1-已实例化
+        self.instance_date = "1900-01-01 00:00:00"  # 实例化时间
+        self.is_setting = 0  # 是否完成数据配置：0-未完成，1-已配置
+        self.expiration_date = "1900-01-01 00:00:00"  # 过期时间
+        self.project_code = ""  # 项目编码
+        self.modify_date = "1900-01-01 00:00:00"  # 更新时间
+        self.is_gm = 0  # 是否开启gm权限：0-否，1-是
+        self.current_limit_count = 0  # 限流数量
+        self.i1 = 0  # i1
+        self.i2 = 0  # i2
+        self.i3 = 0  # i3
+        self.i4 = 0  # i4
+        self.s1 = ""  # s1
+        self.s2 = ""  # s2
+        self.s3 = ""  # s3
+        self.s4 = ""  # s4
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'store_name', 'store_user_nick','main_user_open_id', 'store_id', 'store_icon', 'seller_id', 'app_id', 'app_name', 'app_icon', 'app_url', 'app_ver', 'app_key', 'access_token', 'preview_url', 'app_desc', 'template_id', 'template_ver', 'clients', 'app_telephone', 'is_instance', 'instance_date', 'is_setting', 'expiration_date', 'project_code', 'modify_date', 'is_gm', 'current_limit_count', 'i1', 'i2', 'i3', 'i4', 's1', 's2', 's3', 's4']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "app_info_tb"
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/asset/asset_inventory_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/asset/asset_inventory_model.py`

 * *Ordering differences only*

 * *Files 14% similar despite different names*

```diff
@@ -1,56 +1,56 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-08-19 22:41:48
-@LastEditTime: 2021-09-02 18:30:45
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class AssetInventoryModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(AssetInventoryModel, self).__init__(AssetInventory, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class AssetInventory:
-
-    def __init__(self):
-        super(AssetInventory, self).__init__()
-        self.id = 0  # id
-        self.id_md5 = 0  # id_md5(act_id+user_id+asset_type+asset_object_id+create_day)md5int生成
-        self.app_id = ""  # 应用标识
-        self.act_id = 0  # 活动标识
-        self.user_id = 0  # 用户标识
-        self.open_id = ""  # open_id
-        self.user_nick = ""  # 用户昵称
-        self.asset_type = 0  # 资产类型(1-次数2-积分3-价格档位)
-        self.asset_object_id = ""  # 对象标识
-        self.inc_value = 0  # 增加值
-        self.dec_value = 0  # 消耗值
-        self.history_value = 0  # 今天之前的资产值
-        self.now_value = 0  # 当前的资产值
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.create_day = 0  # 创建时间天
-        self.process_count = 0  # 处理次数
-        self.process_date = "1900-01-01 00:00:00"  # 处理时间
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'id_md5', 'app_id', 'act_id', 'user_id', 'open_id', 'user_nick', 'asset_type', 'asset_object_id', 'inc_value', 'dec_value', 'history_value', 'now_value', 'create_date', 'create_day', 'process_count', 'process_date']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "asset_inventory_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-08-19 22:41:48
+@LastEditTime: 2021-09-02 18:30:45
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class AssetInventoryModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(AssetInventoryModel, self).__init__(AssetInventory, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class AssetInventory:
+
+    def __init__(self):
+        super(AssetInventory, self).__init__()
+        self.id = 0  # id
+        self.id_md5 = 0  # id_md5(act_id+user_id+asset_type+asset_object_id+create_day)md5int生成
+        self.app_id = ""  # 应用标识
+        self.act_id = 0  # 活动标识
+        self.user_id = 0  # 用户标识
+        self.open_id = ""  # open_id
+        self.user_nick = ""  # 用户昵称
+        self.asset_type = 0  # 资产类型(1-次数2-积分3-价格档位)
+        self.asset_object_id = ""  # 对象标识
+        self.inc_value = 0  # 增加值
+        self.dec_value = 0  # 消耗值
+        self.history_value = 0  # 今天之前的资产值
+        self.now_value = 0  # 当前的资产值
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.create_day = 0  # 创建时间天
+        self.process_count = 0  # 处理次数
+        self.process_date = "1900-01-01 00:00:00"  # 处理时间
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'id_md5', 'app_id', 'act_id', 'user_id', 'open_id', 'user_nick', 'asset_type', 'asset_object_id', 'inc_value', 'dec_value', 'history_value', 'now_value', 'create_date', 'create_day', 'process_count', 'process_date']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "asset_inventory_tb"
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/asset/asset_log_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/asset/asset_log_model.py`

 * *Ordering differences only*

 * *Files 13% similar despite different names*

```diff
@@ -1,66 +1,66 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-15 17:17:08
-@LastEditTime: 2022-10-27 17:08:11
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class AssetLogModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(AssetLogModel, self).__init__(AssetLog, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class AssetLog:
-
-    def __init__(self):
-        super(AssetLog, self).__init__()
-        self.id = 0  # id
-        self.app_id = ""  # 应用标识
-        self.act_id = 0  # 活动标识
-        self.module_id = 0  # 活动模块标识
-        self.user_id = 0  # 用户标识
-        self.open_id = ""  # open_id
-        self.user_nick = ""  # 昵称
-        self.log_title = ""  # 标题
-        self.info_json = ""  # 详情信息
-        self.asset_type = 0  # 资产类型(1-次数2-积分3-价格档位4-运费券，业务自定义类型从101起，避免跟公共冲突)
-        self.asset_object_id = ""  # 资产对象标识（比如资产类型是价格档位则对应档位id）
-        self.source_type = 0  # 来源类型（1-购买2-任务3-手动配置4-抽奖5-回购6-兑换7-退款.业务自定义类型从101起，避免跟公共冲突）
-        self.source_object_id = ""  # 来源对象标识(比如来源类型是任务则对应任务类型)
-        self.source_object_name = ""  # 来源对象名称(比如来源类型是任务则对应任务名称)
-        self.only_id = ""  # 唯一标识(用于并发操作时校验避免重复操作)
-        self.operate_type = 0  # 操作类型 （0累计 1消耗）
-        self.operate_value = 0  # 操作值
-        self.history_value = 0  # 历史值
-        self.now_value = 0  # 当前值
-        self.handler_name = ""  # 接口名称
-        self.request_code = ""  # 请求代码
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.create_day = 0  # 创建天
-        self.warn_date = "1900-01-01 00:00:00"  # 预警时间
-        self.warn_day = 0  # 预警天
-        self.i1 = 0  # i1
-        self.s1 = ""  # s1
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'app_id', 'act_id', 'module_id', 'user_id', 'open_id', 'user_nick', 'log_title', 'info_json', 'asset_type', 'asset_object_id', 'source_type', 'source_object_id', 'source_object_name', 'only_id', 'operate_type', 'operate_value', 'history_value', 'now_value', 'handler_name', 'request_code', 'create_date', 'create_day', 'warn_date', 'warn_day', 'i1', 's1']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "asset_log_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-15 17:17:08
+@LastEditTime: 2022-10-27 17:08:11
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class AssetLogModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(AssetLogModel, self).__init__(AssetLog, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class AssetLog:
+
+    def __init__(self):
+        super(AssetLog, self).__init__()
+        self.id = 0  # id
+        self.app_id = ""  # 应用标识
+        self.act_id = 0  # 活动标识
+        self.module_id = 0  # 活动模块标识
+        self.user_id = 0  # 用户标识
+        self.open_id = ""  # open_id
+        self.user_nick = ""  # 昵称
+        self.log_title = ""  # 标题
+        self.info_json = ""  # 详情信息
+        self.asset_type = 0  # 资产类型(1-次数2-积分3-价格档位4-运费券，业务自定义类型从101起，避免跟公共冲突)
+        self.asset_object_id = ""  # 资产对象标识（比如资产类型是价格档位则对应档位id）
+        self.source_type = 0  # 来源类型（1-购买2-任务3-手动配置4-抽奖5-回购6-兑换7-退款.业务自定义类型从101起，避免跟公共冲突）
+        self.source_object_id = ""  # 来源对象标识(比如来源类型是任务则对应任务类型)
+        self.source_object_name = ""  # 来源对象名称(比如来源类型是任务则对应任务名称)
+        self.only_id = ""  # 唯一标识(用于并发操作时校验避免重复操作)
+        self.operate_type = 0  # 操作类型 （0累计 1消耗）
+        self.operate_value = 0  # 操作值
+        self.history_value = 0  # 历史值
+        self.now_value = 0  # 当前值
+        self.handler_name = ""  # 接口名称
+        self.request_code = ""  # 请求代码
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.create_day = 0  # 创建天
+        self.warn_date = "1900-01-01 00:00:00"  # 预警时间
+        self.warn_day = 0  # 预警天
+        self.i1 = 0  # i1
+        self.s1 = ""  # s1
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'app_id', 'act_id', 'module_id', 'user_id', 'open_id', 'user_nick', 'log_title', 'info_json', 'asset_type', 'asset_object_id', 'source_type', 'source_object_id', 'source_object_name', 'only_id', 'operate_type', 'operate_value', 'history_value', 'now_value', 'handler_name', 'request_code', 'create_date', 'create_day', 'warn_date', 'warn_day', 'i1', 's1']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "asset_log_tb"
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/asset/asset_only_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/function/function_skin_model.py`

 * *Files 19% similar despite different names*

```diff
@@ -1,47 +1,50 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-15 17:17:08
-@LastEditTime: 2021-09-02 20:41:40
-@LastEditors: HuangJianYi
-@Description: 
-"""
-
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-class AssetOnlyModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(AssetOnlyModel, self).__init__(AssetOnly, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class AssetOnly:
-
-    def __init__(self):
-        super(AssetOnly, self).__init__()
-        self.id = 0  # id
-        self.id_md5 = 0  # id_md5(act_id+user_id+only_id)md5int生成
-        self.app_id = ""  # 应用标识
-        self.act_id = 0  # 活动ID
-        self.user_id = 0  # 用户标识
-        self.open_id = ""  # open_id
-        self.only_id = ""  # 唯一标识(用于并发操作时校验避免重复操作)
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'id_md5', 'app_id', 'act_id', 'user_id', 'open_id', 'only_id', 'create_date']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "asset_only_tb"
+# -*- coding: utf-8 -*-
+"""
+:Author: HuangJingCan
+:Date: 2022-12-15 10:52:33
+:LastEditTime: 2022-12-15 13:59:26
+:LastEditors: HuangJingCan
+:Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class FunctionSkinModel(CacheModel):
+
+    def __init__(self, db_connect_key='db_middler_platform', sub_table=None, db_transaction=None, context=None):
+        super(FunctionSkinModel, self).__init__(FunctionSkin, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+
+class FunctionSkin:
+    def __init__(self):
+        super(FunctionSkin, self).__init__()
+        self.id = 0  # id
+        self.product_id = 0  # 产品id
+        self.theme_name = ""  # 名称
+        self.theme_id = 0  # 主题id
+        self.use_count = 0  # 使用数量
+        self.sort_index = 0  # 排序
+        self.is_release = 0  # 是否发布：0未发布1已发布
+        self.operation_user = ""  # 操作用户
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.modify_date = "1900-01-01 00:00:00"  # 修改时间
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'product_id', 'theme_name', 'theme_id', 'use_count', 'sort_index', 'is_release', 'operation_user', 'create_date', 'modify_date']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "function_skin_tb"
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/asset/asset_warn_notice_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/tao/tao_pay_order_model.py`

 * *Files 21% similar despite different names*

```diff
@@ -1,48 +1,74 @@
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-
-
-class AssetWarnNoticeModel(BaseModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(AssetWarnNoticeModel, self).__init__(AssetWarnNotice, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class AssetWarnNotice:
-
-    def __init__(self):
-        super(AssetWarnNotice, self).__init__()
-        self.id = 0  # id
-        self.app_id = ""  # 应用标识
-        self.act_id = 0  # 活动标识
-        self.ascription_type = 1 # 归属类型(1-预警2-拦截)
-        self.user_id = 0  # 用户标识
-        self.open_id = ""  # open_id
-        self.user_nick = ""  # 用户昵称
-        self.asset_type = 0  # 资产类型(1-次数2-积分3-价格档位)
-        self.asset_object_id = ""  # 对象标识
-        self.handler_name = ""  # 接口名称
-        self.request_code = ""  # 请求代码
-        self.log_title = ""  # 标题
-        self.info_desc = ""  # 详情
-        self.info_json = ""  # 详情json
-        self.is_notice = 0  # 是否通知
-        self.notice_date = "1900-01-01 00:00:00"  # 通知时间
-        self.create_day = 0  # 创建时间天
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'app_id', 'act_id','ascription_type', 'user_id', 'open_id', 'user_nick', 'asset_type', 'asset_object_id', 'handler_name', 'request_code', 'log_title', 'info_desc', 'info_json', 'is_notice', 'notice_date', 'create_day', 'create_date']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "asset_warn_notice_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-27 10:57:24
+@LastEditTime: 2022-01-21 16:34:17
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class TaoPayOrderModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(TaoPayOrderModel, self).__init__(TaoPayOrder, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class TaoPayOrder:
+
+    def __init__(self):
+        super(TaoPayOrder, self).__init__()
+        self.id = 0  # id(act_id+user_id+guid)md5int生成
+        self.ascription_type = 0  # 归属类型（0-抽奖次数订单1-邮费次数订单2-任务订单）
+        self.app_id = ""  # 应用标识
+        self.act_id = 0  # 活动标识
+        self.user_id = 0  # 用户标识
+        self.open_id = ""  # open_id
+        self.user_nick = ""  # 用户昵称
+        self.goods_code = ""  # 商品编码
+        self.goods_name = ""  # 商品名称
+        self.sku_id = ""  # sku_id
+        self.sku_name = ""  # sku_name
+        self.buy_num = 0  # 购买数量
+        self.pay_price = 0  # 购买金额
+        self.main_pay_order_no = ""  # 淘宝主订单号
+        self.sub_pay_order_no = ""  # 淘宝子订单号
+        self.order_status = ""  # 订单状态
+        self.asset_type = 0  # 资产类型(1-次数2-积分3-价格档位)
+        self.asset_object_name = ""  # 资产对象名称
+        self.asset_object_id = ""  # 资产对象标识
+        self.surplus_count = 0  # 剩余资产值
+        self.prize_ids = ""  # 奖品ID列表（逗号隔开）
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.pay_date = "1900-01-01 00:00:00"  # 支付时间
+        self.i1 = 0  # i1
+        self.i2 = 0  # i2
+        self.i3 = 0  # i3
+        self.i4 = 0  # i4
+        self.i5 = 0  # i5
+        self.s1 = ""  # s1
+        self.s2 = ""  # s2
+        self.s3 = ""  # s3
+        self.s4 = ""  # s4
+        self.s5 = ""  # s5
+        self.d1 = "1900-01-01 00:00:00"  # d1
+        self.d2 = "1900-01-01 00:00:00"  # d2
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'ascription_type', 'app_id', 'act_id', 'user_id', 'open_id', 'user_nick', 'goods_code', 'goods_name', 'sku_id', 'sku_name', 'buy_num', 'pay_price', 'main_pay_order_no', 'sub_pay_order_no', 'order_status', 'asset_type', 'asset_object_name', 'asset_object_id', 'surplus_count', 'prize_ids', 'create_date', 'pay_date', 'i1', 'i2', 'i3', 'i4', 'i5', 's1', 's2', 's3', 's4', 's5', 'd1', 'd2']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "tao_pay_order_tb"
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/base/base_info_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/base/base_info_model.py`

 * *Ordering differences only*

 * *Files 16% similar despite different names*

```diff
@@ -1,70 +1,70 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-20 10:09:52
-@LastEditTime: 2021-07-29 18:30:00
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class BaseInfoModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(BaseInfoModel, self).__init__(BaseInfo, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class BaseInfo:
-
-    def __init__(self):
-        super(BaseInfo, self).__init__()
-        self.id = 0  # id
-        self.guid = ""  # guid
-        self.product_name = ""  # 产品名称
-        self.product_icon = ""  # 产品图标
-        self.product_desc = ""  # 产品简介
-        self.service_market_url = ""  # 服务市场链接
-        self.customer_service = ""  # 客服号
-        self.experience_pic = ""  # 案例二维码图
-        self.client_ver = ""  # 客户端版本号
-        self.server_ver = ""  # 服务端版本号
-        self.update_function = ""  # 版本更新内容
-        self.update_function_b = ""  # 千牛端版本更新内容
-        self.store_study_url = ""  # 店铺装修教程图文地址（如何上架小程序）
-        self.study_url = ""  # 后台配置图文教程
-        self.video_url = ""  # 后台配置视频教程
-        self.course_url = ""  # 主账号授权子账号教程
-        self.decoration_poster_json = ""  # 装修海报
-        self.menu_config_json = ""  # 菜单配置信息
-        self.is_remind_phone = 0  # 是否提醒提示配置手机号
-        self.is_force_update = 0  # 是个强制更新客户端版本
-        self.is_contact_us = 0  # 是否提醒联系我们
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.modify_date = "1900-01-01 00:00:00"  # 修改时间
-        self.i1 = 0  # i1
-        self.i2 = 0  # i2
-        self.i3 = 0  # i3
-        self.i4 = 0  # i4
-        self.s1 = ""  # s1
-        self.s2 = ""  # s2
-        self.s3 = ""  # s3
-        self.s4 = ""  # s4
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'guid', 'product_name', 'product_icon', 'product_desc', 'service_market_url', 'customer_service', 'experience_pic', 'client_ver', 'server_ver', 'update_function', 'update_function_b', 'store_study_url', 'study_url', 'video_url', 'course_url', 'decoration_poster_json', 'menu_config_json', 'is_remind_phone', 'is_force_update', 'is_contact_us', 'create_date', 'modify_date', 'i1', 'i2', 'i3', 'i4', 's1', 's2', 's3', 's4']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "base_info_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-20 10:09:52
+@LastEditTime: 2021-07-29 18:30:00
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class BaseInfoModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(BaseInfoModel, self).__init__(BaseInfo, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class BaseInfo:
+
+    def __init__(self):
+        super(BaseInfo, self).__init__()
+        self.id = 0  # id
+        self.guid = ""  # guid
+        self.product_name = ""  # 产品名称
+        self.product_icon = ""  # 产品图标
+        self.product_desc = ""  # 产品简介
+        self.service_market_url = ""  # 服务市场链接
+        self.customer_service = ""  # 客服号
+        self.experience_pic = ""  # 案例二维码图
+        self.client_ver = ""  # 客户端版本号
+        self.server_ver = ""  # 服务端版本号
+        self.update_function = ""  # 版本更新内容
+        self.update_function_b = ""  # 千牛端版本更新内容
+        self.store_study_url = ""  # 店铺装修教程图文地址（如何上架小程序）
+        self.study_url = ""  # 后台配置图文教程
+        self.video_url = ""  # 后台配置视频教程
+        self.course_url = ""  # 主账号授权子账号教程
+        self.decoration_poster_json = ""  # 装修海报
+        self.menu_config_json = ""  # 菜单配置信息
+        self.is_remind_phone = 0  # 是否提醒提示配置手机号
+        self.is_force_update = 0  # 是个强制更新客户端版本
+        self.is_contact_us = 0  # 是否提醒联系我们
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.modify_date = "1900-01-01 00:00:00"  # 修改时间
+        self.i1 = 0  # i1
+        self.i2 = 0  # i2
+        self.i3 = 0  # i3
+        self.i4 = 0  # i4
+        self.s1 = ""  # s1
+        self.s2 = ""  # s2
+        self.s3 = ""  # s3
+        self.s4 = ""  # s4
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'guid', 'product_name', 'product_icon', 'product_desc', 'service_market_url', 'customer_service', 'experience_pic', 'client_ver', 'server_ver', 'update_function', 'update_function_b', 'store_study_url', 'study_url', 'video_url', 'course_url', 'decoration_poster_json', 'menu_config_json', 'is_remind_phone', 'is_force_update', 'is_contact_us', 'create_date', 'modify_date', 'i1', 'i2', 'i3', 'i4', 's1', 's2', 's3', 's4']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "base_info_tb"
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/browse/browse_log_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/friend/friend_link_model.py`

 * *Files 17% similar despite different names*

```diff
@@ -1,49 +1,51 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-08-16 09:42:13
-@LastEditTime: 2021-08-16 09:47:53
-@LastEditors: HuangJianYi
-@Description: 
-"""
-
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class BrowseLogModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(BrowseLogModel, self).__init__(BrowseLog, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class BrowseLog:
-
-    def __init__(self):
-        super(BrowseLog, self).__init__()
-        self.id = 0  # id
-        self.app_id = ""  # 应用标识
-        self.act_id = 0  # 活动标识
-        self.user_id = 0  # 用户标识
-        self.open_id = ""  # 邀请人OpenID
-        self.goods_id = ""  # 商品id
-        self.is_handle = 0  # 是否处理（1处理0未处理）
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.create_day = 0  # 创建天
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'app_id', 'act_id', 'user_id', 'open_id', 'goods_id', 'is_handle', 'create_date', 'create_day']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "browse_log_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-27 10:55:09
+@LastEditTime: 2021-07-29 18:30:54
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class FriendLinkModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(FriendLinkModel, self).__init__(FriendLink, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class FriendLink:
+
+    def __init__(self):
+        super(FriendLink, self).__init__()
+        self.id = 0  # id
+        self.title = ""  # 标题
+        self.product_id = 0  # 产品id（0-其他，-1未选择）
+        self.ad_pic = ""  # 互推广告图
+        self.big_pic = ""  # 互推大图
+        self.product_link = ""  # 产品链接地址
+        self.associated_url = ""  # 关联地址
+        self.sort_index = 0  # 排序
+        self.is_release = 0  # 是否发布（1是0否）
+        self.release_date = "1900-01-01 00:00:00"  # 发布时间
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.modify_date = "1900-01-01 00:00:00"  # 更新时间
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'title', 'product_id', 'ad_pic', 'big_pic', 'product_link', 'associated_url', 'sort_index', 'is_release', 'release_date', 'create_date', 'modify_date']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "friend_link_tb"
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/cms/cms_info_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/task/task_log_model.py`

 * *Files 21% similar despite different names*

```diff
@@ -1,69 +1,61 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-11-25 18:38:13
-@LastEditTime: 2021-11-26 10:59:17
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class CmsInfoModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(CmsInfoModel, self).__init__(CmsInfo, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class CmsInfo:
-
-    def __init__(self):
-        super(CmsInfo, self).__init__()
-        self.id = 0  # id
-        self.app_id = ""  # 应用标识
-        self.act_id = 0  # 活动标识
-        self.place_id = 0  # 信息位标识
-        self.info_title = ""  # 信息标题
-        self.simple_title = ""  # 信息短标题
-        self.simple_title_url = ""  # 短标题链接
-        self.info_type = 0  # 信息类型
-        self.info_summary = ""  # 信息摘要
-        self.info_tag = ""  # 信息标签[文章内容特性][砍人事件]
-        self.info_mark = ""  # 信息标记[首发,推荐,独家，热门]
-        self.target_url = ""  # 跳转地址
-        self.min_pic = ""  # 信息小图
-        self.mid_pic = ""  # 信息中图
-        self.max_pic = ""  # 信息大图
-        self.info_data = ""  # 信息内容
-        self.pic_collect_json = ""  # 图集json
-        self.sort_index = 0  # 排序
-        self.is_release = 0  # 是否发布（1是0否）
-        self.release_date = "1900-01-01 00:00:00"  # 发布时间
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.modify_date = "1900-01-01 00:00:00"  # 更新时间
-        self.i1 = 0  # i1
-        self.i2 = 0  # i2
-        self.i3 = 0  # i3
-        self.i4 = 0  # i4
-        self.s1 = ""  # s1
-        self.s2 = ""  # s2
-        self.s3 = ""  # s3
-        self.s4 = ""  # s4
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'app_id', 'act_id', 'place_id', 'info_title', 'simple_title', 'simple_title_url', 'info_type', 'info_summary', 'info_tag', 'info_mark', 'target_url', 'min_pic', 'mid_pic', 'max_pic', 'info_data', 'pic_collect_json', 'sort_index', 'is_release', 'release_date', 'create_date', 'modify_date', 'i1', 'i2', 'i3', 'i4', 's1', 's2', 's3','s4']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "cms_info_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-15 17:17:08
+@LastEditTime: 2023-05-18 14:32:11
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class TaskLogModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(TaskLogModel, self).__init__(TaskLog, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class TaskLog:
+
+    def __init__(self):
+        super(TaskLog, self).__init__()
+        self.id = 0  # id
+        self.app_id = ""  # 应用标识
+        self.act_id = 0  # 活动标识
+        self.module_id = 0  # 活动模块标识
+        self.user_id = 0  # 用户标识
+        self.open_id = ""  # open_id
+        self.user_nick = ""  # 昵称
+        self.log_title = ""  # 标题
+        self.info_json = ""  # 详情信息
+        self.task_type = 0  # 任务类型
+        self.task_sub_type = ""  # 任务子类型
+        self.task_name = ""  # 任务名称
+        self.reward_type = ""  # 奖励类型
+        self.reward_object_id = ""  # 奖励对象标识
+        self.reward_name = ""  # 奖励名称
+        self.reward_num = 0  # 奖励数量
+        self.handler_name = ""  # 接口名称
+        self.request_code = ""  # 请求代码
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.create_day = 0  # 创建天
+        self.i1 = 0  # i1
+        self.s1 = ""  # s1
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'app_id', 'act_id', 'module_id', 'user_id', 'open_id', 'user_nick', 'log_title', 'info_json', 'task_type', 'task_sub_type', 'task_name', 'reward_type', 'reward_object_id', 'reward_name', 'reward_num', 'handler_name', 'request_code', 'create_date', 'create_day', 'i1', 's1']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "task_log_tb"
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/cms/cms_place_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/user/user_asset_model.py`

 * *Files 23% similar despite different names*

```diff
@@ -1,50 +1,52 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-11-25 18:38:13
-@LastEditTime: 2021-12-29 14:54:12
-@LastEditors: HuangJianYi
-@Description: 
-"""
-
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class CmsPlaceModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(CmsPlaceModel, self).__init__(CmsPlace, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class CmsPlace:
-
-    def __init__(self):
-        super(CmsPlace, self).__init__()
-        self.id = 0  # id
-        self.place_name = ""  # 位置名称
-        self.place_type = 1  # 位置类型(1商家后台2中台)
-        self.config_json = ""  # 自定义配置json
-        self.field_config_json = ""  # 字段配置json
-        self.remark = ""  # 备注
-        self.is_release = 0  # 是否发布（1是0否）
-        self.release_date = "1900-01-01 00:00:00"  # 发布时间
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.modify_date = "1900-01-01 00:00:00"  # 更新时间
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'place_type', 'place_name', 'config_json', 'field_config_json', 'remark', 'is_release', 'release_date', 'create_date', 'modify_date']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "cms_place_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-15 17:17:08
+@LastEditTime: 2021-09-02 18:27:58
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class UserAssetModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(UserAssetModel, self).__init__(UserAsset, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class UserAsset:
+
+    def __init__(self):
+        super(UserAsset, self).__init__()
+        self.id = 0  # id
+        self.id_md5 = 0  # id_md5(act_id+user_id+asset_type+asset_object_id)md5int生成
+        self.app_id = ""  # 应用标识
+        self.act_id = 0  # 活动标识
+        self.user_id = 0  # 用户标识
+        self.open_id = ""  # open_id
+        self.user_nick = ""  # 用户昵称
+        self.asset_type = 0  # 资产类型(1-次数2-积分3-价格档位4-运费券，业务自定义类型从101起，避免跟公共冲突)
+        self.asset_object_id = ""  # 资产对象标识
+        self.asset_value = 0  # 资产值
+        self.asset_check_code = ""  # 资产检验码(id+asset_value+加密签名)md5生成
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.modify_date = "1900-01-01 00:00:00"  # 更新时间
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'id_md5', 'app_id', 'act_id', 'user_id', 'open_id', 'user_nick', 'asset_type', 'asset_object_id', 'asset_value', 'asset_check_code', 'create_date', 'modify_date']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "user_asset_tb"
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/collect/collect_log_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/ip/ip_type_model.py`

 * *Files 16% similar despite different names*

```diff
@@ -1,47 +1,49 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-08-16 09:42:13
-@LastEditTime: 2021-08-16 09:49:09
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-class CollectLogModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(CollectLogModel, self).__init__(CollectLog, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class CollectLog:
-
-    def __init__(self):
-        super(CollectLog, self).__init__()
-        self.id = 0  # id
-        self.app_id = ""  # 应用标识
-        self.act_id = 0  # 活动标识
-        self.user_id = 0  # 用户标识
-        self.open_id = ""  # open_id
-        self.goods_id = 0  # 商品id
-        self.is_handle = 0  # 是否处理（1处理0未处理）
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.create_day = 0  # 创建天
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'app_id', 'act_id', 'user_id', 'open_id', 'goods_id', 'is_handle', 'create_date', 'create_day']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "collect_log_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-27 10:55:09
+@LastEditTime: 2022-07-28 18:29:51
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class IpTypeModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(IpTypeModel, self).__init__(IpType, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+
+class IpType:
+
+    def __init__(self):
+        super(IpType, self).__init__()
+        self.id = 0  # id
+        self.app_id = ""  # 应用标识
+        self.act_id = 0  # 活动标识
+        self.type_name = ""  # 类型名称
+        self.type_pic = ""  # 类型图片
+        self.sort_index = 0  # 排序
+        self.is_release = 0  # 是否发布（1发布0未发布）
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.modify_date = "1900-01-01 00:00:00"  # 修改时间
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'app_id', 'act_id', 'type_name', 'type_pic', 'sort_index', 'is_release', 'create_date', 'modify_date']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "ip_type_tb"
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/counter/counter_config_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/cms/cms_place_model.py`

 * *Files 20% similar despite different names*

```diff
@@ -1,49 +1,50 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-26 09:40:36
-@LastEditTime: 2022-12-07 14:18:05
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class CounterConfigModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(CounterConfigModel, self).__init__(CounterConfig, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-
-class CounterConfig:
-
-    def __init__(self):
-        super(CounterConfig, self).__init__()
-        self.id = 0  # id
-        self.key_name = ""  # 计数key
-        self.key_expire = 0  # 计数key过期时间
-        self.db_connect_key = ""  # 数据库连接串Key
-        self.table_name = ""  # 表名
-        self.id_field_name = ""  # 主键字段名称
-        self.value_field_name = ""  # 值字段名称
-        self.is_release = 0  # 是否发布(1是0否)
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'key_name', 'key_expire', 'db_connect_key', 'table_name', 'id_field_name', 'value_field_name', 'is_release', 'create_date']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "counter_config_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-11-25 18:38:13
+@LastEditTime: 2021-12-29 14:54:12
+@LastEditors: HuangJianYi
+@Description: 
+"""
+
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class CmsPlaceModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(CmsPlaceModel, self).__init__(CmsPlace, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class CmsPlace:
+
+    def __init__(self):
+        super(CmsPlace, self).__init__()
+        self.id = 0  # id
+        self.place_name = ""  # 位置名称
+        self.place_type = 1  # 位置类型(1商家后台2中台)
+        self.config_json = ""  # 自定义配置json
+        self.field_config_json = ""  # 字段配置json
+        self.remark = ""  # 备注
+        self.is_release = 0  # 是否发布（1是0否）
+        self.release_date = "1900-01-01 00:00:00"  # 发布时间
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.modify_date = "1900-01-01 00:00:00"  # 更新时间
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'place_type', 'place_name', 'config_json', 'field_config_json', 'remark', 'is_release', 'release_date', 'create_date', 'modify_date']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "cms_place_tb"
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/dict/dict_info_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/dict/dict_info_model.py`

 * *Ordering differences only*

 * *Files 11% similar despite different names*

```diff
@@ -1,53 +1,53 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2022-09-26 15:19:56
-@LastEditTime: 2022-09-28 11:13:26
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class DictInfoModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(DictInfoModel, self).__init__(DictInfo, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class DictInfo:
-
-    def __init__(self):
-        super(DictInfo, self).__init__()
-        self.id = 0  # id
-        self.dict_type = 0  # 字典类型
-        self.dict_name = ""  # 字典名称
-        self.dict_value = ""  # 字典值
-        self.dict_pic = ""  # 字典图片
-        self.sort_index = 0  # 排序
-        self.is_release = 0  # 是否发布（1发布0未发布）
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.modify_date = "1900-01-01 00:00:00"  # 更新时间
-        self.parent_id = 0  # 父节点
-        self.i1 = 0  # i1
-        self.i2 = 0  # i2
-        self.s1 = ""  # s1
-        self.s2 = ""  # s2
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'dict_type', 'dict_name', 'dict_value', 'dict_pic', 'sort_index', 'is_release', 'create_date', 'modify_date', 'parent_id', 'i1', 'i2', 's1', 's2']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "dict_info_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2022-09-26 15:19:56
+@LastEditTime: 2022-09-28 11:13:26
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class DictInfoModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(DictInfoModel, self).__init__(DictInfo, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class DictInfo:
+
+    def __init__(self):
+        super(DictInfo, self).__init__()
+        self.id = 0  # id
+        self.dict_type = 0  # 字典类型
+        self.dict_name = ""  # 字典名称
+        self.dict_value = ""  # 字典值
+        self.dict_pic = ""  # 字典图片
+        self.sort_index = 0  # 排序
+        self.is_release = 0  # 是否发布（1发布0未发布）
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.modify_date = "1900-01-01 00:00:00"  # 更新时间
+        self.parent_id = 0  # 父节点
+        self.i1 = 0  # i1
+        self.i2 = 0  # i2
+        self.s1 = ""  # s1
+        self.s2 = ""  # s2
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'dict_type', 'dict_name', 'dict_value', 'dict_pic', 'sort_index', 'is_release', 'create_date', 'modify_date', 'parent_id', 'i1', 'i2', 's1', 's2']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "dict_info_tb"
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/erp/erp_relation_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/erp/erp_relation_model.py`

 * *Ordering differences only*

 * *Files 18% similar despite different names*

```diff
@@ -1,41 +1,41 @@
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class ErpRelationModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(ErpRelationModel, self).__init__(ErpRelation, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class ErpRelation:
-
-    def __init__(self):
-        super(ErpRelation, self).__init__()
-        self.id = 0  # id
-        self.app_id = ""  # 应用标识
-        self.app_key = ""  # 应用密钥(商家实例化生成的app_key)
-        self.store_name = ""  # 店铺名称
-        self.is_release = 0  # 是否发布(1是0否)
-        self.start_date = "1900-01-01 00:00:00"  # 开始时间
-        self.end_date = "1900-01-01 00:00:00"  # 结束时间
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.sync_date = "1900-01-01 00:00:00"  # 同步时间
-        self.return_date = "1900-01-01 00:00:00"  # 回传时间
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'app_id', 'app_key', 'store_name', 'is_release', 'start_date', 'end_date', 'create_date', 'sync_date', 'return_date']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "erp_relation_tb"
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class ErpRelationModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(ErpRelationModel, self).__init__(ErpRelation, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class ErpRelation:
+
+    def __init__(self):
+        super(ErpRelation, self).__init__()
+        self.id = 0  # id
+        self.app_id = ""  # 应用标识
+        self.app_key = ""  # 应用密钥(商家实例化生成的app_key)
+        self.store_name = ""  # 店铺名称
+        self.is_release = 0  # 是否发布(1是0否)
+        self.start_date = "1900-01-01 00:00:00"  # 开始时间
+        self.end_date = "1900-01-01 00:00:00"  # 结束时间
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.sync_date = "1900-01-01 00:00:00"  # 同步时间
+        self.return_date = "1900-01-01 00:00:00"  # 回传时间
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'app_id', 'app_key', 'store_name', 'is_release', 'start_date', 'end_date', 'create_date', 'sync_date', 'return_date']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "erp_relation_tb"
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/friend/friend_link_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/launch/launch_plan_model.py`

 * *Files 19% similar despite different names*

```diff
@@ -1,51 +1,48 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-27 10:55:09
-@LastEditTime: 2021-07-29 18:30:54
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class FriendLinkModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(FriendLinkModel, self).__init__(FriendLink, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class FriendLink:
-
-    def __init__(self):
-        super(FriendLink, self).__init__()
-        self.id = 0  # id
-        self.title = ""  # 标题
-        self.product_id = 0  # 产品id（0-其他，-1未选择）
-        self.ad_pic = ""  # 互推广告图
-        self.big_pic = ""  # 互推大图
-        self.product_link = ""  # 产品链接地址
-        self.associated_url = ""  # 关联地址
-        self.sort_index = 0  # 排序
-        self.is_release = 0  # 是否发布（1是0否）
-        self.release_date = "1900-01-01 00:00:00"  # 发布时间
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.modify_date = "1900-01-01 00:00:00"  # 更新时间
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'title', 'product_id', 'ad_pic', 'big_pic', 'product_link', 'associated_url', 'sort_index', 'is_release', 'release_date', 'create_date', 'modify_date']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "friend_link_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-27 10:55:09
+@LastEditTime: 2022-07-13 17:51:05
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+class LaunchPlanModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(LaunchPlanModel, self).__init__(LaunchPlan, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class LaunchPlan:
+
+    def __init__(self):
+        super(LaunchPlan, self).__init__()
+        self.id = 0  # 标识
+        self.app_id = ""  # 应用唯一标识
+        self.act_id = 0  # 活动标识
+        self.tb_launch_id = 0  # 淘宝投放计划标识
+        self.launch_url = ""  # 投放链接
+        self.start_date = "1900-01-01 00:00:00" # 投放开始时间
+        self.end_date = "1900-01-01 00:00:00"  # 投放结束时间
+        self.status = 0  # 投放状态
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.modify_date = "1900-01-01 00:00:00"  # 修改时间
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'app_id', 'act_id', 'tb_launch_id', 'launch_url', 'start_date', 'end_date', 'status', 'create_date', 'modify_date']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "launch_plan_tb"
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/function/function_info_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/function/function_product_model.py`

 * *Files 24% similar despite different names*

```diff
@@ -1,50 +1,47 @@
-# -*- coding: utf-8 -*-
-"""
-:Author: HuangJingCan
-:Date: 2022-12-15 10:52:33
-:LastEditTime: 2022-12-15 13:57:08
-:LastEditors: HuangJingCan
-:Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class FunctionInfoModel(CacheModel):
-
-    def __init__(self, db_connect_key='db_middler_platform', sub_table=None, db_transaction=None, context=None):
-        super(FunctionInfoModel, self).__init__(FunctionInfo, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-
-class FunctionInfo:
-    def __init__(self):
-        super(FunctionInfo, self).__init__()
-        self.id = 0  # id
-        self.product_id = 0  # 产品id
-        self.function_name = ""  # 功能名称
-        self.key_name = ""  # key名称
-        self.sort_index = 0  # 排序
-        self.is_release = 0  # 是否发布：0未发布1已发布
-        self.operation_user = ""  # 操作用户
-        self.use_count = 0  # 使用数量
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.modify_date = "1900-01-01 00:00:00"  # 修改时间
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'product_id', 'function_name', 'key_name', 'sort_index', 'is_release', 'operation_user', 'use_count', 'create_date', 'modify_date']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "function_info_tb"
+# -*- coding: utf-8 -*-
+"""
+:Author: HuangJingCan
+:Date: 2022-12-15 10:52:33
+:LastEditTime: 2022-12-15 13:58:26
+:LastEditors: HuangJingCan
+:Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class FunctionProductModel(CacheModel):
+    def __init__(self, db_connect_key='db_middler_platform', sub_table=None, db_transaction=None, context=None):
+        super(FunctionProductModel, self).__init__(FunctionProduct, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+
+class FunctionProduct:
+    def __init__(self):
+        super(FunctionProduct, self).__init__()
+        self.app_id = 0  # 程序标识
+        self.app_code = ""  # 程序代码
+        self.app_name = ""  # 程序名称
+        self.parent_id = 0  # 父标识
+        self.name_path = ""  # 程序名路径
+        self.id_path = ""  # 父路经
+        self.sort_index = 0  # 排序
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+
+    @classmethod
+    def get_field_list(self):
+        return ['app_id', 'app_code', 'app_name', 'parent_id', 'name_path', 'id_path', 'sort_index', 'create_date']
+
+    @classmethod
+    def get_primary_key(self):
+        return "app_id"
+
+    def __str__(self):
+        return "function_product_tb"
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/function/function_module_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/function/function_module_model.py`

 * *Ordering differences only*

 * *Files 14% similar despite different names*

```diff
@@ -1,51 +1,51 @@
-# -*- coding: utf-8 -*-
-"""
-:Author: HuangJingCan
-:Date: 2022-12-15 10:52:33
-:LastEditTime: 2022-12-15 13:58:26
-:LastEditors: HuangJingCan
-:Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class FunctionModuleModel(CacheModel):
-
-    def __init__(self, db_connect_key='db_middler_platform', sub_table=None, db_transaction=None, context=None):
-        super(FunctionModuleModel, self).__init__(FunctionModule, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-
-class FunctionModule:
-    def __init__(self):
-        super(FunctionModule, self).__init__()
-        self.id = 0  # id
-        self.product_id = 0  # 产品id
-        self.module_type = 0  # 模块类型：1基础模块2中级模块3高级模块
-        self.module_name = ""  # 模块名称
-        self.is_release = 0  # 是否发布：0未发布1已发布
-        self.app_code = ""  # 应用编码（淘系项目，收费项目列表查询）
-        self.project_code = ""  # 项目编码（淘系项目，收费项目列表查询）
-        self.skin_ids = ""  # 皮肤id列表（逗号隔开）
-        self.function_ids = ""  # 功能id列表（逗号隔开）
-        self.modify_date = "1900-01-01 00:00:00"  # 修改时间
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'product_id', 'module_type', 'module_name', 'is_release', 'app_code', 'project_code', 'skin_ids', 'function_ids', 'modify_date', 'create_date']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "function_module_tb"
+# -*- coding: utf-8 -*-
+"""
+:Author: HuangJingCan
+:Date: 2022-12-15 10:52:33
+:LastEditTime: 2022-12-15 13:58:26
+:LastEditors: HuangJingCan
+:Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class FunctionModuleModel(CacheModel):
+
+    def __init__(self, db_connect_key='db_middler_platform', sub_table=None, db_transaction=None, context=None):
+        super(FunctionModuleModel, self).__init__(FunctionModule, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+
+class FunctionModule:
+    def __init__(self):
+        super(FunctionModule, self).__init__()
+        self.id = 0  # id
+        self.product_id = 0  # 产品id
+        self.module_type = 0  # 模块类型：1基础模块2中级模块3高级模块
+        self.module_name = ""  # 模块名称
+        self.is_release = 0  # 是否发布：0未发布1已发布
+        self.app_code = ""  # 应用编码（淘系项目，收费项目列表查询）
+        self.project_code = ""  # 项目编码（淘系项目，收费项目列表查询）
+        self.skin_ids = ""  # 皮肤id列表（逗号隔开）
+        self.function_ids = ""  # 功能id列表（逗号隔开）
+        self.modify_date = "1900-01-01 00:00:00"  # 修改时间
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'product_id', 'module_type', 'module_name', 'is_release', 'app_code', 'project_code', 'skin_ids', 'function_ids', 'modify_date', 'create_date']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "function_module_tb"
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/function/function_product_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/browse/browse_log_model.py`

 * *Files 18% similar despite different names*

```diff
@@ -1,47 +1,49 @@
-# -*- coding: utf-8 -*-
-"""
-:Author: HuangJingCan
-:Date: 2022-12-15 10:52:33
-:LastEditTime: 2022-12-15 13:58:26
-:LastEditors: HuangJingCan
-:Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class FunctionProductModel(CacheModel):
-    def __init__(self, db_connect_key='db_middler_platform', sub_table=None, db_transaction=None, context=None):
-        super(FunctionProductModel, self).__init__(FunctionProduct, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-
-class FunctionProduct:
-    def __init__(self):
-        super(FunctionProduct, self).__init__()
-        self.app_id = 0  # 程序标识
-        self.app_code = ""  # 程序代码
-        self.app_name = ""  # 程序名称
-        self.parent_id = 0  # 父标识
-        self.name_path = ""  # 程序名路径
-        self.id_path = ""  # 父路经
-        self.sort_index = 0  # 排序
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-
-    @classmethod
-    def get_field_list(self):
-        return ['app_id', 'app_code', 'app_name', 'parent_id', 'name_path', 'id_path', 'sort_index', 'create_date']
-
-    @classmethod
-    def get_primary_key(self):
-        return "app_id"
-
-    def __str__(self):
-        return "function_product_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-08-16 09:42:13
+@LastEditTime: 2021-08-16 09:47:53
+@LastEditors: HuangJianYi
+@Description: 
+"""
+
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class BrowseLogModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(BrowseLogModel, self).__init__(BrowseLog, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class BrowseLog:
+
+    def __init__(self):
+        super(BrowseLog, self).__init__()
+        self.id = 0  # id
+        self.app_id = ""  # 应用标识
+        self.act_id = 0  # 活动标识
+        self.user_id = 0  # 用户标识
+        self.open_id = ""  # 邀请人OpenID
+        self.goods_id = ""  # 商品id
+        self.is_handle = 0  # 是否处理（1处理0未处理）
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.create_day = 0  # 创建天
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'app_id', 'act_id', 'user_id', 'open_id', 'goods_id', 'is_handle', 'create_date', 'create_day']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "browse_log_tb"
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/function/function_shop_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/function/function_shop_model.py`

 * *Ordering differences only*

 * *Files 11% similar despite different names*

```diff
@@ -1,61 +1,61 @@
-# -*- coding: utf-8 -*-
-"""
-:Author: HuangJingCan
-:Date: 2022-12-15 10:52:33
-@LastEditTime: 2023-04-07 16:09:03
-@LastEditors: HuangJianYi
-:Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class FunctionShopModel(CacheModel):
-    def __init__(self, db_connect_key='db_middler_platform', sub_table=None, db_transaction=None, context=None):
-        super(FunctionShopModel, self).__init__(FunctionShop, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-
-class FunctionShop:
-    def __init__(self):
-        super(FunctionShop, self).__init__()
-        self.id = 0  # id
-        self.product_id = 0  # 产品id
-        self.cloud_app_id = 0  # 云应用id
-        self.store_name = ""  # 店铺名称
-        self.store_user_nick = ""  # 店铺主帐号名称（会员名）
-        self.user_type = 0  # 用户类型：1-SAAS用户2-SAAS定制用户
-        self.app_key = ""  # 商家实例化的app_key
-        self.app_id = ""  # app_id
-        self.trade_type = 0  # 行业类型（枚举型）
-        self.service_date_start = "1900-01-01 00:00:00"  # 服务开始时间
-        self.service_date_end = "1900-01-01 00:00:00"  # 服务结束时间
-        self.skin_ids = ""  # 皮肤id列表（逗号隔开）
-        self.function_ids = ""  # 功能id列表（逗号隔开）
-        self.is_erp = 0  # 是否开启erp：0未开启1已开启
-        self.erp_id = 0  # erp关联id（遁甲系统获取）
-        self.erp_config_info = ""  # erp信息（json列表：{key:'字段名',value:'值'}）
-        self.module_name = ""  # 模块名称
-        self.module_pic = ""  # 模块图片
-        self.is_release = 0  # 是否发布：0未发布1已发布
-        self.release_date = "1900-01-01 00:00:00"  # 发布时间
-        self.modify_date = "1900-01-01 00:00:00"  # 修改时间
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'product_id', 'cloud_app_id', 'store_name', 'store_user_nick', 'user_type', 'app_key', 'app_id', 'trade_type', 'service_date_start', 'service_date_end', 'skin_ids', 'function_ids', 'is_erp', 'erp_id', 'erp_config_info', 'module_name', 'module_pic', 'is_release', 'release_date', 'modify_date', 'create_date']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "function_shop_tb"
+# -*- coding: utf-8 -*-
+"""
+:Author: HuangJingCan
+:Date: 2022-12-15 10:52:33
+@LastEditTime: 2023-04-07 16:09:03
+@LastEditors: HuangJianYi
+:Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class FunctionShopModel(CacheModel):
+    def __init__(self, db_connect_key='db_middler_platform', sub_table=None, db_transaction=None, context=None):
+        super(FunctionShopModel, self).__init__(FunctionShop, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+
+class FunctionShop:
+    def __init__(self):
+        super(FunctionShop, self).__init__()
+        self.id = 0  # id
+        self.product_id = 0  # 产品id
+        self.cloud_app_id = 0  # 云应用id
+        self.store_name = ""  # 店铺名称
+        self.store_user_nick = ""  # 店铺主帐号名称（会员名）
+        self.user_type = 0  # 用户类型：1-SAAS用户2-SAAS定制用户
+        self.app_key = ""  # 商家实例化的app_key
+        self.app_id = ""  # app_id
+        self.trade_type = 0  # 行业类型（枚举型）
+        self.service_date_start = "1900-01-01 00:00:00"  # 服务开始时间
+        self.service_date_end = "1900-01-01 00:00:00"  # 服务结束时间
+        self.skin_ids = ""  # 皮肤id列表（逗号隔开）
+        self.function_ids = ""  # 功能id列表（逗号隔开）
+        self.is_erp = 0  # 是否开启erp：0未开启1已开启
+        self.erp_id = 0  # erp关联id（遁甲系统获取）
+        self.erp_config_info = ""  # erp信息（json列表：{key:'字段名',value:'值'}）
+        self.module_name = ""  # 模块名称
+        self.module_pic = ""  # 模块图片
+        self.is_release = 0  # 是否发布：0未发布1已发布
+        self.release_date = "1900-01-01 00:00:00"  # 发布时间
+        self.modify_date = "1900-01-01 00:00:00"  # 修改时间
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'product_id', 'cloud_app_id', 'store_name', 'store_user_nick', 'user_type', 'app_key', 'app_id', 'trade_type', 'service_date_start', 'service_date_end', 'skin_ids', 'function_ids', 'is_erp', 'erp_id', 'erp_config_info', 'module_name', 'module_pic', 'is_release', 'release_date', 'modify_date', 'create_date']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "function_shop_tb"
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/function/function_skin_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/function/function_info_model.py`

 * *Files 24% similar despite different names*

```diff
@@ -1,50 +1,50 @@
-# -*- coding: utf-8 -*-
-"""
-:Author: HuangJingCan
-:Date: 2022-12-15 10:52:33
-:LastEditTime: 2022-12-15 13:59:26
-:LastEditors: HuangJingCan
-:Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class FunctionSkinModel(CacheModel):
-
-    def __init__(self, db_connect_key='db_middler_platform', sub_table=None, db_transaction=None, context=None):
-        super(FunctionSkinModel, self).__init__(FunctionSkin, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-
-class FunctionSkin:
-    def __init__(self):
-        super(FunctionSkin, self).__init__()
-        self.id = 0  # id
-        self.product_id = 0  # 产品id
-        self.theme_name = ""  # 名称
-        self.theme_id = 0  # 主题id
-        self.use_count = 0  # 使用数量
-        self.sort_index = 0  # 排序
-        self.is_release = 0  # 是否发布：0未发布1已发布
-        self.operation_user = ""  # 操作用户
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.modify_date = "1900-01-01 00:00:00"  # 修改时间
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'product_id', 'theme_name', 'theme_id', 'use_count', 'sort_index', 'is_release', 'operation_user', 'create_date', 'modify_date']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "function_skin_tb"
+# -*- coding: utf-8 -*-
+"""
+:Author: HuangJingCan
+:Date: 2022-12-15 10:52:33
+:LastEditTime: 2022-12-15 13:57:08
+:LastEditors: HuangJingCan
+:Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class FunctionInfoModel(CacheModel):
+
+    def __init__(self, db_connect_key='db_middler_platform', sub_table=None, db_transaction=None, context=None):
+        super(FunctionInfoModel, self).__init__(FunctionInfo, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+
+class FunctionInfo:
+    def __init__(self):
+        super(FunctionInfo, self).__init__()
+        self.id = 0  # id
+        self.product_id = 0  # 产品id
+        self.function_name = ""  # 功能名称
+        self.key_name = ""  # key名称
+        self.sort_index = 0  # 排序
+        self.is_release = 0  # 是否发布：0未发布1已发布
+        self.operation_user = ""  # 操作用户
+        self.use_count = 0  # 使用数量
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.modify_date = "1900-01-01 00:00:00"  # 修改时间
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'product_id', 'function_name', 'key_name', 'sort_index', 'is_release', 'operation_user', 'use_count', 'create_date', 'modify_date']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "function_info_tb"
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/invite/invite_help_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/invite/invite_help_model.py`

 * *Ordering differences only*

 * *Files 14% similar despite different names*

```diff
@@ -1,60 +1,60 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-08-12 17:38:51
-@LastEditTime: 2023-03-13 18:33:04
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class InviteHelpModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(InviteHelpModel, self).__init__(InviteHelp, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class InviteHelp:
-
-    def __init__(self):
-        super(InviteHelp, self).__init__()
-        self.id = 0  # id
-        self.id_md5 = 0  # id_md5(act_id+module_id+object_id)md5int
-        self.app_id = ""  # 应用标识
-        self.act_id = 0  # 活动标识
-        self.module_id = 0  # 模块标识
-        self.help_type = 0  # 助力类型（0无1邀请用户）
-        self.object_id = 0  # 对象标识
-        self.user_id = 0  # 邀请人用户标识
-        self.open_id = ""  # 邀请人OpenID
-        self.invited_user_id = "" # 受邀人用户标识
-        self.invited_open_id = ""  # 受邀人OpenID
-        self.invited_user_nick = ""  # 受邀人昵称
-        self.invited_avatar = ""  # 受邀人头像
-        self.is_handle = 0  # 是否处理（1处理0未处理）
-        self.is_invited_handle = 0  #受邀人是否处理（1处理0未处理）
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.create_day = 0  # 创建天
-        self.i1 = 0  # i1
-        self.i2 = 0  # i2
-        self.s1 = ''  # s1
-        self.s2 = ''  # s2
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'id_md5', 'app_id', 'act_id', 'module_id', 'help_type', 'object_id', 'user_id', 'open_id', 'invited_user_id', 'invited_open_id', 'invited_user_nick', 'invited_avatar', 'is_handle', 'is_invited_handle', 'create_date', 'create_day', 'i1', 'i2', 's1', 's2']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "invite_help_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-08-12 17:38:51
+@LastEditTime: 2023-03-13 18:33:04
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class InviteHelpModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(InviteHelpModel, self).__init__(InviteHelp, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class InviteHelp:
+
+    def __init__(self):
+        super(InviteHelp, self).__init__()
+        self.id = 0  # id
+        self.id_md5 = 0  # id_md5(act_id+module_id+object_id)md5int
+        self.app_id = ""  # 应用标识
+        self.act_id = 0  # 活动标识
+        self.module_id = 0  # 模块标识
+        self.help_type = 0  # 助力类型（0无1邀请用户）
+        self.object_id = 0  # 对象标识
+        self.user_id = 0  # 邀请人用户标识
+        self.open_id = ""  # 邀请人OpenID
+        self.invited_user_id = "" # 受邀人用户标识
+        self.invited_open_id = ""  # 受邀人OpenID
+        self.invited_user_nick = ""  # 受邀人昵称
+        self.invited_avatar = ""  # 受邀人头像
+        self.is_handle = 0  # 是否处理（1处理0未处理）
+        self.is_invited_handle = 0  #受邀人是否处理（1处理0未处理）
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.create_day = 0  # 创建天
+        self.i1 = 0  # i1
+        self.i2 = 0  # i2
+        self.s1 = ''  # s1
+        self.s2 = ''  # s2
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'id_md5', 'app_id', 'act_id', 'module_id', 'help_type', 'object_id', 'user_id', 'open_id', 'invited_user_id', 'invited_open_id', 'invited_user_nick', 'invited_avatar', 'is_handle', 'is_invited_handle', 'create_date', 'create_day', 'i1', 'i2', 's1', 's2']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "invite_help_tb"
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/invite/invite_log_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/cms/cms_info_model.py`

 * *Files 22% similar despite different names*

```diff
@@ -1,52 +1,69 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-08-12 17:38:51
-@LastEditTime: 2021-11-24 10:38:24
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class InviteLogModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(InviteLogModel, self).__init__(InviteLog, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class InviteLog:
-
-    def __init__(self):
-        super(InviteLog, self).__init__()
-        self.id = 0  # id
-        self.app_id = ""  # 应用标识
-        self.act_id = 0  # 活动标识
-        self.user_id = 0  # 邀请人用户标识
-        self.open_id = ""  # 邀请人OpenID
-        self.invite_user_id = "" # 受邀人用户标识
-        self.invite_open_id = ""  # 受邀人OpenID
-        self.invite_user_nick = ""  # 受邀人昵称
-        self.invite_avatar = ""  # 受邀人头像
-        self.is_handle = 0  # 是否处理（1处理0未处理）
-        self.is_invited_handle = 0  #受邀人是否处理（1处理0未处理）
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.create_day = 0  # 创建天
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'app_id', 'act_id', 'user_id', 'open_id', 'invite_user_id', 'invite_open_id', 'invite_user_nick', 'invite_avatar', 'is_handle', 'is_invited_handle', 'create_date', 'create_day']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "invite_log_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-11-25 18:38:13
+@LastEditTime: 2021-11-26 10:59:17
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class CmsInfoModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(CmsInfoModel, self).__init__(CmsInfo, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class CmsInfo:
+
+    def __init__(self):
+        super(CmsInfo, self).__init__()
+        self.id = 0  # id
+        self.app_id = ""  # 应用标识
+        self.act_id = 0  # 活动标识
+        self.place_id = 0  # 信息位标识
+        self.info_title = ""  # 信息标题
+        self.simple_title = ""  # 信息短标题
+        self.simple_title_url = ""  # 短标题链接
+        self.info_type = 0  # 信息类型
+        self.info_summary = ""  # 信息摘要
+        self.info_tag = ""  # 信息标签[文章内容特性][砍人事件]
+        self.info_mark = ""  # 信息标记[首发,推荐,独家，热门]
+        self.target_url = ""  # 跳转地址
+        self.min_pic = ""  # 信息小图
+        self.mid_pic = ""  # 信息中图
+        self.max_pic = ""  # 信息大图
+        self.info_data = ""  # 信息内容
+        self.pic_collect_json = ""  # 图集json
+        self.sort_index = 0  # 排序
+        self.is_release = 0  # 是否发布（1是0否）
+        self.release_date = "1900-01-01 00:00:00"  # 发布时间
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.modify_date = "1900-01-01 00:00:00"  # 更新时间
+        self.i1 = 0  # i1
+        self.i2 = 0  # i2
+        self.i3 = 0  # i3
+        self.i4 = 0  # i4
+        self.s1 = ""  # s1
+        self.s2 = ""  # s2
+        self.s3 = ""  # s3
+        self.s4 = ""  # s4
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'app_id', 'act_id', 'place_id', 'info_title', 'simple_title', 'simple_title_url', 'info_type', 'info_summary', 'info_tag', 'info_mark', 'target_url', 'min_pic', 'mid_pic', 'max_pic', 'info_data', 'pic_collect_json', 'sort_index', 'is_release', 'release_date', 'create_date', 'modify_date', 'i1', 'i2', 'i3', 'i4', 's1', 's2', 's3','s4']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "cms_info_tb"
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/ip/ip_info_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/ip/ip_info_model.py`

 * *Ordering differences only*

 * *Files 20% similar despite different names*

```diff
@@ -1,56 +1,56 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-27 10:55:09
-@LastEditTime: 2022-09-28 17:52:56
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class IpInfoModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(IpInfoModel, self).__init__(IpInfo, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class IpInfo:
-
-    def __init__(self):
-        super(IpInfo, self).__init__()
-        self.id = 0  # id
-        self.app_id = ""  # 应用标识
-        self.act_id = 0  # 活动标识
-        self.ip_name = ""  # ip名称
-        self.mode_type = 0  # 模式类型
-        self.ip_type = 0  # ip类型
-        self.ip_pic = ""  # ip图片
-        self.show_pic = ""  # 展示图片
-        self.ip_summary = ""  # ip描述
-        self.sort_index = 0  # 排序
-        self.is_release = 0  # 是否发布（1发布0未发布）
-        self.is_del = 0  # 是否删除（1是0否）
-        self.del_date = "1900-01-01 00:00:00"  # 删除时间
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.modify_date = "1900-01-01 00:00:00"  # 修改时间
-        self.ip_config_json = ""  # 配置信息json
-
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'app_id', 'act_id', 'ip_name', 'mode_type', 'ip_type', 'ip_pic', 'show_pic', 'ip_summary', 'sort_index', 'is_release', 'is_del', 'del_date', 'create_date', 'modify_date', 'ip_config_json']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "ip_info_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-27 10:55:09
+@LastEditTime: 2022-09-28 17:52:56
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class IpInfoModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(IpInfoModel, self).__init__(IpInfo, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class IpInfo:
+
+    def __init__(self):
+        super(IpInfo, self).__init__()
+        self.id = 0  # id
+        self.app_id = ""  # 应用标识
+        self.act_id = 0  # 活动标识
+        self.ip_name = ""  # ip名称
+        self.mode_type = 0  # 模式类型
+        self.ip_type = 0  # ip类型
+        self.ip_pic = ""  # ip图片
+        self.show_pic = ""  # 展示图片
+        self.ip_summary = ""  # ip描述
+        self.sort_index = 0  # 排序
+        self.is_release = 0  # 是否发布（1发布0未发布）
+        self.is_del = 0  # 是否删除（1是0否）
+        self.del_date = "1900-01-01 00:00:00"  # 删除时间
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.modify_date = "1900-01-01 00:00:00"  # 修改时间
+        self.ip_config_json = ""  # 配置信息json
+
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'app_id', 'act_id', 'ip_name', 'mode_type', 'ip_type', 'ip_pic', 'show_pic', 'ip_summary', 'sort_index', 'is_release', 'is_del', 'del_date', 'create_date', 'modify_date', 'ip_config_json']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "ip_info_tb"
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/ip/ip_type_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/saas/saas_custom_model.py`

 * *Files 20% similar despite different names*

```diff
@@ -1,49 +1,50 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-27 10:55:09
-@LastEditTime: 2022-07-28 18:29:51
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class IpTypeModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(IpTypeModel, self).__init__(IpType, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-
-class IpType:
-
-    def __init__(self):
-        super(IpType, self).__init__()
-        self.id = 0  # id
-        self.app_id = ""  # 应用标识
-        self.act_id = 0  # 活动标识
-        self.type_name = ""  # 类型名称
-        self.type_pic = ""  # 类型图片
-        self.sort_index = 0  # 排序
-        self.is_release = 0  # 是否发布（1发布0未发布）
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.modify_date = "1900-01-01 00:00:00"  # 修改时间
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'app_id', 'act_id', 'type_name', 'type_pic', 'sort_index', 'is_release', 'create_date', 'modify_date']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "ip_type_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-26 17:00:16
+@LastEditTime: 2021-07-29 18:34:56
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class SaasCustomModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(SaasCustomModel, self).__init__(SaasCustom, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class SaasCustom:
+
+    def __init__(self):
+        super(SaasCustom, self).__init__()
+        self.id = 0  #
+        self.cloud_app_id = 0  # 云应用id
+        self.store_user_nick = ""  # 店铺主帐号名称（会员名）
+        self.app_name = ""  # 应用名称
+        self.app_icon = ""  # 应用图标
+        self.is_release = 0  # 是否发布（1是0否）
+        self.release_date = "1900-01-01 00:00:00"  # 发布时间
+        self.service_date_start = "1900-01-01 00:00:00"  # 服务开始时间
+        self.service_date_end = "1900-01-01 00:00:00"  # 服务结束时间
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.modify_date = "1900-01-01 00:00:00"  # 更新时间
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'cloud_app_id', 'store_user_nick', 'app_name', 'app_icon', 'is_release', 'release_date', 'service_date_start', 'service_date_end', 'create_date', 'modify_date']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "saas_custom_tb"
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/launch/launch_goods_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/launch/launch_goods_model.py`

 * *Ordering differences only*

 * *Files 22% similar despite different names*

```diff
@@ -1,49 +1,49 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-27 10:55:09
-@LastEditTime: 2021-08-10 18:06:23
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class LaunchGoodsModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(LaunchGoodsModel, self).__init__(LaunchGoods, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class LaunchGoods:
-
-    def __init__(self):
-        super(LaunchGoods, self).__init__()
-        self.id = 0  # 标识
-        self.app_id = ""  # 应用唯一标识
-        self.act_id = 0  # 活动标识
-        self.goods_id = ""  # 商品ID
-        self.is_launch = 0  # 是否投放(0：不投放 1：投放)
-        self.is_sync = 0  # 是否同步（0不同步 1：同步）
-        self.error_message = ""  # 同步失败原因
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.launch_date = "1900-01-01 00:00:00"  # 投放时间
-        self.sync_date = "1900-01-01 00:00:00"  # 同步时间
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'app_id', 'act_id', 'goods_id', 'is_launch', 'is_sync', 'error_message', 'create_date', 'launch_date', 'sync_date']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "launch_goods_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-27 10:55:09
+@LastEditTime: 2021-08-10 18:06:23
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class LaunchGoodsModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(LaunchGoodsModel, self).__init__(LaunchGoods, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class LaunchGoods:
+
+    def __init__(self):
+        super(LaunchGoods, self).__init__()
+        self.id = 0  # 标识
+        self.app_id = ""  # 应用唯一标识
+        self.act_id = 0  # 活动标识
+        self.goods_id = ""  # 商品ID
+        self.is_launch = 0  # 是否投放(0：不投放 1：投放)
+        self.is_sync = 0  # 是否同步（0不同步 1：同步）
+        self.error_message = ""  # 同步失败原因
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.launch_date = "1900-01-01 00:00:00"  # 投放时间
+        self.sync_date = "1900-01-01 00:00:00"  # 同步时间
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'app_id', 'act_id', 'goods_id', 'is_launch', 'is_sync', 'error_message', 'create_date', 'launch_date', 'sync_date']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "launch_goods_tb"
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/launch/launch_plan_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/tao/tao_login_log_model.py`

 * *Files 19% similar despite different names*

```diff
@@ -1,48 +1,47 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-27 10:55:09
-@LastEditTime: 2022-07-13 17:51:05
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-class LaunchPlanModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(LaunchPlanModel, self).__init__(LaunchPlan, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class LaunchPlan:
-
-    def __init__(self):
-        super(LaunchPlan, self).__init__()
-        self.id = 0  # 标识
-        self.app_id = ""  # 应用唯一标识
-        self.act_id = 0  # 活动标识
-        self.tb_launch_id = 0  # 淘宝投放计划标识
-        self.launch_url = ""  # 投放链接
-        self.start_date = "1900-01-01 00:00:00" # 投放开始时间
-        self.end_date = "1900-01-01 00:00:00"  # 投放结束时间
-        self.status = 0  # 投放状态
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.modify_date = "1900-01-01 00:00:00"  # 修改时间
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'app_id', 'act_id', 'tb_launch_id', 'launch_url', 'start_date', 'end_date', 'status', 'create_date', 'modify_date']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "launch_plan_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-27 10:57:24
+@LastEditTime: 2021-07-29 18:37:28
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class TaoLoginLogModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(TaoLoginLogModel, self).__init__(TaoLoginLog, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class TaoLoginLog:
+
+    def __init__(self):
+        super(TaoLoginLog, self).__init__()
+        self.id = 0  # id
+        self.open_id = ""  # open_id
+        self.user_nick = ""  # 用户昵称
+        self.store_user_nick = ""  # 主帐号名称（会员名）
+        self.is_master = 0  # 是否主账号（1是0否）
+        self.request_params = ""  # 参数
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.modify_date = "1900-01-01 00:00:00"  # 更新时间
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'open_id', 'user_nick', 'store_user_nick', 'is_master', 'request_params', 'create_date', 'modify_date']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "tao_login_log_tb"
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/marketing/marketing_program_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/skin/skin_info_model.py`

 * *Files 21% similar despite different names*

```diff
@@ -1,48 +1,50 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-08-03 15:45:17
-@LastEditTime: 2021-08-03 15:45:58
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class MarketingProgramModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(MarketingProgramModel, self).__init__(MarketingProgram, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class MarketingProgram:
-
-    def __init__(self):
-        super(MarketingProgram, self).__init__()
-        self.id = 0  # id
-        self.link_title = ""  # 链接标题
-        self.link_url = ""  # 链接地址
-        self.content = ""  # 内容说明
-        self.sort_index = 0  # 排序
-        self.is_release = 0  # 是否发布（1是0否）
-        self.release_date = "1900-01-01 00:00:00"  # 发布时间
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.modify_date = "1900-01-01 00:00:00"  # 更新时间
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'link_title', 'link_url', 'content', 'sort_index', 'is_release', 'release_date', 'create_date', 'modify_date']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "marketing_program_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-26 15:41:57
+@LastEditTime: 2022-01-20 11:32:37
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class SkinInfoModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(SkinInfoModel, self).__init__(SkinInfo, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class SkinInfo:
+
+    def __init__(self):
+        super(SkinInfo, self).__init__()
+        self.id = 0  # id
+        self.skin_name = ""  # 皮肤名称
+        self.theme_id = 0  # 主题标识
+        self.style_type = 0  # 样式类型
+        self.client_json = ""  # 客户端内容json
+        self.server_json = ""  # 服务端内容json
+        self.out_id = ""  # 外部id
+        self.theme_out_id = ""  # 外部主题id
+        self.sort_index = 0  # 排序
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.modify_date = "1900-01-01 00:00:00"  # 修改时间
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'skin_name', 'theme_id', 'style_type', 'client_json', 'server_json', 'out_id', 'theme_out_id', 'sort_index', 'create_date', 'modify_date']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "skin_info_tb"
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/middler/middler_product_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/middler/middler_product_model.py`

 * *Ordering differences only*

 * *Files 12% similar despite different names*

```diff
@@ -1,50 +1,50 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-15 15:05:22
-@LastEditTime: 2021-07-29 18:33:10
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class MiddlerProductModel(CacheModel):
-    def __init__(self, db_connect_key='db_middler_platform', sub_table=None, db_transaction=None, context=None):
-        super(MiddlerProductModel, self).__init__(MiddlerProduct, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class MiddlerProduct:
-
-    def __init__(self):
-        super(MiddlerProduct, self).__init__()
-        self.id = 0  # id
-        self.guid = ""  # guid
-        self.app_key = 0  # app_key
-        self.app_secret = ""  # app_secret
-        self.product_name = ""  # 产品名称
-        self.product_type = 0  # 产品类型：1云开发，2云应用
-        self.product_icon = ""  # 产品图标
-        self.db_key = ""  # 数据库key
-        self.contains_name = ""  # 产品服务名称列表（如：一起来盖楼,互动游戏宝,互动PK宝盒）
-        self.is_release = 0  # 是否发布（1是0否）
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'guid', 'app_key', 'app_secret', 'product_name', 'product_type', 'product_icon', 'db_key', 'contains_name', 'is_release', 'create_date']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "middler_product_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-15 15:05:22
+@LastEditTime: 2021-07-29 18:33:10
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class MiddlerProductModel(CacheModel):
+    def __init__(self, db_connect_key='db_middler_platform', sub_table=None, db_transaction=None, context=None):
+        super(MiddlerProductModel, self).__init__(MiddlerProduct, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class MiddlerProduct:
+
+    def __init__(self):
+        super(MiddlerProduct, self).__init__()
+        self.id = 0  # id
+        self.guid = ""  # guid
+        self.app_key = 0  # app_key
+        self.app_secret = ""  # app_secret
+        self.product_name = ""  # 产品名称
+        self.product_type = 0  # 产品类型：1云开发，2云应用
+        self.product_icon = ""  # 产品图标
+        self.db_key = ""  # 数据库key
+        self.contains_name = ""  # 产品服务名称列表（如：一起来盖楼,互动游戏宝,互动PK宝盒）
+        self.is_release = 0  # 是否发布（1是0否）
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'guid', 'app_key', 'app_secret', 'product_name', 'product_type', 'product_icon', 'db_key', 'contains_name', 'is_release', 'create_date']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "middler_product_tb"
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/operation/operation_config_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/marketing/marketing_program_model.py`

 * *Files 25% similar despite different names*

```diff
@@ -1,45 +1,48 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-08-02 10:11:35
-@LastEditTime: 2022-10-10 11:20:43
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class OperationConfigModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(OperationConfigModel, self).__init__(OperationConfig, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class OperationConfig:
-
-    def __init__(self):
-        super(OperationConfig, self).__init__()
-        self.id = 0  # id
-        self.model_name = ""  # 模块或表名称
-        self.config_json = ""  # 配置信息json
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-
-
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'model_name', 'config_json', 'create_date']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "operation_config_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-08-03 15:45:17
+@LastEditTime: 2021-08-03 15:45:58
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class MarketingProgramModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(MarketingProgramModel, self).__init__(MarketingProgram, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class MarketingProgram:
+
+    def __init__(self):
+        super(MarketingProgram, self).__init__()
+        self.id = 0  # id
+        self.link_title = ""  # 链接标题
+        self.link_url = ""  # 链接地址
+        self.content = ""  # 内容说明
+        self.sort_index = 0  # 排序
+        self.is_release = 0  # 是否发布（1是0否）
+        self.release_date = "1900-01-01 00:00:00"  # 发布时间
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.modify_date = "1900-01-01 00:00:00"  # 更新时间
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'link_title', 'link_url', 'content', 'sort_index', 'is_release', 'release_date', 'create_date', 'modify_date']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "marketing_program_tb"
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/operation/operation_log_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/operation/operation_log_model.py`

 * *Ordering differences only*

 * *Files 18% similar despite different names*

```diff
@@ -1,63 +1,63 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-08-02 10:11:35
-@LastEditTime: 2022-10-19 14:49:59
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class OperationLogModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(OperationLogModel, self).__init__(OperationLog, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class OperationLog:
-
-    def __init__(self):
-        super(OperationLog, self).__init__()
-        self.id = 0  # id
-        self.app_id = ""  # 应用标识
-        self.act_id = 0  # 活动标识
-        self.operation_type = 0  # 操作类型：1-add，2-update，3-delete 4-还原 5-复制
-        self.title = ""  # 标题
-        self.operation_desc = "" # 描述
-        self.detail = ""  # 当前信息
-        self.update_detail = ""  # 更新之后的信息
-        self.request_params = ""  # 传入的参数
-        self.model_name = ""  # 模块或表名称
-        self.operation_ways = 1  # 操作方式(1单一操作2批量操作)
-        self.protocol = ""  # protocol(http或https)
-        self.method = ""  # method
-        self.handler_name = ""  # handler_name
-        self.request_host = ""  # request_host
-        self.request_uri = ""  # request_uri
-        self.remote_ip = ""  # remote_ip
-        self.request_code = "" # 请求代码
-        self.operate_user_id = ""  # 操作人标识
-        self.operate_user_name = ""  # 操作人名称
-        self.operate_role_id = ""  # 操作角色标识
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.create_day = 0  # 创建天
-
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'app_id', 'act_id', 'operation_type', 'title', 'operation_desc', 'detail', 'update_detail', 'request_params', 'model_name', 'operation_ways', 'protocol', 'method', 'handler_name', 'request_host', 'request_uri', 'remote_ip', 'request_code', 'operate_user_id', 'operate_user_name', 'operate_role_id', 'create_date', 'create_day']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "operation_log_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-08-02 10:11:35
+@LastEditTime: 2022-10-19 14:49:59
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class OperationLogModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(OperationLogModel, self).__init__(OperationLog, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class OperationLog:
+
+    def __init__(self):
+        super(OperationLog, self).__init__()
+        self.id = 0  # id
+        self.app_id = ""  # 应用标识
+        self.act_id = 0  # 活动标识
+        self.operation_type = 0  # 操作类型：1-add，2-update，3-delete 4-还原 5-复制
+        self.title = ""  # 标题
+        self.operation_desc = "" # 描述
+        self.detail = ""  # 当前信息
+        self.update_detail = ""  # 更新之后的信息
+        self.request_params = ""  # 传入的参数
+        self.model_name = ""  # 模块或表名称
+        self.operation_ways = 1  # 操作方式(1单一操作2批量操作)
+        self.protocol = ""  # protocol(http或https)
+        self.method = ""  # method
+        self.handler_name = ""  # handler_name
+        self.request_host = ""  # request_host
+        self.request_uri = ""  # request_uri
+        self.remote_ip = ""  # remote_ip
+        self.request_code = "" # 请求代码
+        self.operate_user_id = ""  # 操作人标识
+        self.operate_user_name = ""  # 操作人名称
+        self.operate_role_id = ""  # 操作角色标识
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.create_day = 0  # 创建天
+
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'app_id', 'act_id', 'operation_type', 'title', 'operation_desc', 'detail', 'update_detail', 'request_params', 'model_name', 'operation_ways', 'protocol', 'method', 'handler_name', 'request_host', 'request_uri', 'remote_ip', 'request_code', 'operate_user_id', 'operate_user_name', 'operate_role_id', 'create_date', 'create_day']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "operation_log_tb"
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/pay/pay_order_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/pay/pay_order_model.py`

 * *Ordering differences only*

 * *Files 18% similar despite different names*

```diff
@@ -1,61 +1,61 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-09-16 19:14:40
-@LastEditTime: 2023-06-01 13:44:08
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class PayOrderModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(PayOrderModel, self).__init__(PayOrder, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class PayOrder:
-
-    def __init__(self):
-        super(PayOrder, self).__init__()
-        self.id = 0  # id
-        self.app_id = ""  # 应用标识
-        self.act_id = 0  # 活动标识
-        self.user_id = 0  # 用户标识
-        self.open_id = ""  # open_id
-        self.pay_order_no = ""  # 支付单号
-        self.order_name = ""  # 订单名称
-        self.order_desc = ""  # 订单描述
-        self.source_type = 0  # 来源类型（1-购买2-邮费.业务自定义类型从101起，避免跟公共冲突）
-        self.out_order_no = ""  # 平台交易单号
-        self.order_status = 0  # 订单状态:0等待买家付款1付款成功2支付关闭11交易成功20退款关闭
-        self.pay_amount = 0  # 支付金额（单位：元）
-        self.discount_amount = 0  # 优惠金额（单位：元）
-        self.refund_amount = 0  # 退款金额（单位：元）
-        self.buy_num = 0  # 购买数量
-        self.buy_object_id = ""  # 购买对象标识
-        self.buy_object_name = ""  # 购买对象名称
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.pay_date = "1900-01-01 00:00:00"  # 支付时间
-        self.process_count = 0 # 处理次数
-        self.process_date = "1900-01-01 00:00:00"  # 处理时间
-        self.remark = ""  # 备注
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'app_id', 'act_id', 'user_id', 'open_id', 'pay_order_no', 'order_name', 'order_desc', 'source_type', 'out_order_no', 'order_status', 'pay_amount', 'discount_amount', 'refund_amount', 'buy_num', 'buy_object_id', 'buy_object_name', 'create_date', 'pay_date', 'process_count', 'process_date', 'remark']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "pay_order_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-09-16 19:14:40
+@LastEditTime: 2023-06-01 13:44:08
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class PayOrderModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(PayOrderModel, self).__init__(PayOrder, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class PayOrder:
+
+    def __init__(self):
+        super(PayOrder, self).__init__()
+        self.id = 0  # id
+        self.app_id = ""  # 应用标识
+        self.act_id = 0  # 活动标识
+        self.user_id = 0  # 用户标识
+        self.open_id = ""  # open_id
+        self.pay_order_no = ""  # 支付单号
+        self.order_name = ""  # 订单名称
+        self.order_desc = ""  # 订单描述
+        self.source_type = 0  # 来源类型（1-购买2-邮费.业务自定义类型从101起，避免跟公共冲突）
+        self.out_order_no = ""  # 平台交易单号
+        self.order_status = 0  # 订单状态:0等待买家付款1付款成功2支付关闭11交易成功20退款关闭
+        self.pay_amount = 0  # 支付金额（单位：元）
+        self.discount_amount = 0  # 优惠金额（单位：元）
+        self.refund_amount = 0  # 退款金额（单位：元）
+        self.buy_num = 0  # 购买数量
+        self.buy_object_id = ""  # 购买对象标识
+        self.buy_object_name = ""  # 购买对象名称
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.pay_date = "1900-01-01 00:00:00"  # 支付时间
+        self.process_count = 0 # 处理次数
+        self.process_date = "1900-01-01 00:00:00"  # 处理时间
+        self.remark = ""  # 备注
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'app_id', 'act_id', 'user_id', 'open_id', 'pay_order_no', 'order_name', 'order_desc', 'source_type', 'out_order_no', 'order_status', 'pay_amount', 'discount_amount', 'refund_amount', 'buy_num', 'buy_object_id', 'buy_object_name', 'create_date', 'pay_date', 'process_count', 'process_date', 'remark']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "pay_order_tb"
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/price/price_gear_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/price/price_gear_model.py`

 * *Ordering differences only*

 * *Files 16% similar despite different names*

```diff
@@ -1,46 +1,46 @@
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class PriceGearModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(PriceGearModel, self).__init__(PriceGear, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class PriceGear:
-
-    def __init__(self):
-        super(PriceGear, self).__init__()
-        self.id = 0  # id
-        self.app_id = ""  # 应用标识
-        self.act_id = 0  # 活动标识
-        self.relation_type = 0  # 关联类型：1商品skuid关联2商品id关联
-        self.goods_id = ""  # 商品ID
-        self.sku_id = ""  # sku_id
-        self.price_gear_name = ""  # 档位名称
-        self.price_gear_pic = ""  # 档位图片
-        self.price = 0  # 价格
-        self.is_del = 0  # 是否删除（1是0否）
-        self.sort_index = 0 # 排序
-        self.effective_date = "1900-01-01 00:00:00"  # 有效时间
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.modify_date = "1900-01-01 00:00:00"  # 更新时间
-        self.remark = ""  # 备注
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'app_id', 'act_id', 'relation_type', 'goods_id', 'sku_id', 'price_gear_name', 'price_gear_pic', 'price', 'is_del', 'sort_index', 'effective_date', 'create_date', 'modify_date', 'remark']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "price_gear_tb"
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class PriceGearModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(PriceGearModel, self).__init__(PriceGear, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class PriceGear:
+
+    def __init__(self):
+        super(PriceGear, self).__init__()
+        self.id = 0  # id
+        self.app_id = ""  # 应用标识
+        self.act_id = 0  # 活动标识
+        self.relation_type = 0  # 关联类型：1商品skuid关联2商品id关联
+        self.goods_id = ""  # 商品ID
+        self.sku_id = ""  # sku_id
+        self.price_gear_name = ""  # 档位名称
+        self.price_gear_pic = ""  # 档位图片
+        self.price = 0  # 价格
+        self.is_del = 0  # 是否删除（1是0否）
+        self.sort_index = 0 # 排序
+        self.effective_date = "1900-01-01 00:00:00"  # 有效时间
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.modify_date = "1900-01-01 00:00:00"  # 更新时间
+        self.remark = ""  # 备注
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'app_id', 'act_id', 'relation_type', 'goods_id', 'sku_id', 'price_gear_name', 'price_gear_pic', 'price', 'is_del', 'sort_index', 'effective_date', 'create_date', 'modify_date', 'remark']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "price_gear_tb"
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/prize/prize_order_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/prize/prize_order_model.py`

 * *Ordering differences only*

 * *Files 11% similar despite different names*

```diff
@@ -1,86 +1,86 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-27 10:55:09
-@LastEditTime: 2022-09-06 14:03:27
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class PrizeOrderModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(PrizeOrderModel, self).__init__(PrizeOrder, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class PrizeOrder:
-
-    def __init__(self):
-        super(PrizeOrder, self).__init__()
-        self.id = 0  # id
-        self.order_no = ""  # 订单号
-        self.app_id = ""  # 应用标识
-        self.act_id = 0  # 活动标识
-        self.module_id = 0  # 活动模块标识
-        self.source_type = 1  # 来源类型（1用户下单2系统自动下单3商家操作下单业务自定义从101开始）
-        self.user_id = 0  # 用户标识
-        self.open_id = ""  # open_id
-        self.user_nick = ""  # 用户昵称
-        self.real_name = ""  # 真实姓名
-        self.telephone = ""  # 手机号码
-        self.province = ""  # 所在省
-        self.city = ""  # 所在市
-        self.county = ""  # 所在区
-        self.street = ""  # 所在街道
-        self.address = ""  # 收货地址
-        self.deliver_date = "1900-01-01 00:00:00"  # 发货时间
-        self.express_no = ""  # 快递单号
-        self.express_company = ""  # 快递公司
-        self.order_status = 0  # 订单状态（-1未付款-2付款中0未发货1已发货2不予发货3已退款4交易成功）
-        self.buyer_remark = ""  # 买家备注
-        self.seller_remark = ""  # 卖家备注
-        self.cs_modify_address = ""  # 客服修改地址
-        self.order_price = 0  # 订单金额
-        self.is_free_freight = 0  # 是否包邮
-        self.freight_price = 0  # 运费金额
-        self.freight_pay_order_no = ""  # 运费支付单号
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.create_month = 0  # 创建月
-        self.create_day = 0  # 创建天
-        self.modify_date = "1900-01-01 00:00:00"  # 修改时间
-        self.sync_status = 0  # 订单同步状态，用于遁甲或者ERP同步订单（0未同步，1同步成功，2同步失败）
-        self.sync_date = "1900-01-01 00:00:00"  # 同步时间
-        self.sync_count = 0  # 同步次数
-        self.sync_result = ""  # 同步结果
-        self.i1 = 0  # i1
-        self.i2 = 0  # i2
-        self.i3 = 0  # i3
-        self.i4 = 0  # i4
-        self.i5 = 0  # i5
-        self.s1 = ""  # s1
-        self.s2 = ""  # s2
-        self.s3 = ""  # s3
-        self.s4 = ""  # s4
-        self.s5 = ""  # s5
-        self.d1 = "1900-01-01 00:00:00"  # d1
-        self.d2 = "1900-01-01 00:00:00"  # d2
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'order_no', 'app_id', 'act_id', 'module_id','source_type', 'user_id', 'open_id', 'user_nick', 'real_name', 'telephone', 'province', 'city', 'county', 'street', 'address', 'deliver_date', 'express_no', 'express_company', 'order_status', 'buyer_remark', 'seller_remark', 'cs_modify_address', 'order_price', 'is_free_freight', 'freight_price', 'freight_pay_order_no', 'create_date', 'create_month', 'create_day', 'modify_date', 'sync_status', 'sync_date', 'sync_count', 'sync_result', 'i1', 'i2', 'i3', 'i4', 'i5', 's1','s2', 's3', 's4', 's5', 'd1', 'd2']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "prize_order_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-27 10:55:09
+@LastEditTime: 2022-09-06 14:03:27
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class PrizeOrderModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(PrizeOrderModel, self).__init__(PrizeOrder, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class PrizeOrder:
+
+    def __init__(self):
+        super(PrizeOrder, self).__init__()
+        self.id = 0  # id
+        self.order_no = ""  # 订单号
+        self.app_id = ""  # 应用标识
+        self.act_id = 0  # 活动标识
+        self.module_id = 0  # 活动模块标识
+        self.source_type = 1  # 来源类型（1用户下单2系统自动下单3商家操作下单业务自定义从101开始）
+        self.user_id = 0  # 用户标识
+        self.open_id = ""  # open_id
+        self.user_nick = ""  # 用户昵称
+        self.real_name = ""  # 真实姓名
+        self.telephone = ""  # 手机号码
+        self.province = ""  # 所在省
+        self.city = ""  # 所在市
+        self.county = ""  # 所在区
+        self.street = ""  # 所在街道
+        self.address = ""  # 收货地址
+        self.deliver_date = "1900-01-01 00:00:00"  # 发货时间
+        self.express_no = ""  # 快递单号
+        self.express_company = ""  # 快递公司
+        self.order_status = 0  # 订单状态（-1未付款-2付款中0未发货1已发货2不予发货3已退款4交易成功）
+        self.buyer_remark = ""  # 买家备注
+        self.seller_remark = ""  # 卖家备注
+        self.cs_modify_address = ""  # 客服修改地址
+        self.order_price = 0  # 订单金额
+        self.is_free_freight = 0  # 是否包邮
+        self.freight_price = 0  # 运费金额
+        self.freight_pay_order_no = ""  # 运费支付单号
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.create_month = 0  # 创建月
+        self.create_day = 0  # 创建天
+        self.modify_date = "1900-01-01 00:00:00"  # 修改时间
+        self.sync_status = 0  # 订单同步状态，用于遁甲或者ERP同步订单（0未同步，1同步成功，2同步失败）
+        self.sync_date = "1900-01-01 00:00:00"  # 同步时间
+        self.sync_count = 0  # 同步次数
+        self.sync_result = ""  # 同步结果
+        self.i1 = 0  # i1
+        self.i2 = 0  # i2
+        self.i3 = 0  # i3
+        self.i4 = 0  # i4
+        self.i5 = 0  # i5
+        self.s1 = ""  # s1
+        self.s2 = ""  # s2
+        self.s3 = ""  # s3
+        self.s4 = ""  # s4
+        self.s5 = ""  # s5
+        self.d1 = "1900-01-01 00:00:00"  # d1
+        self.d2 = "1900-01-01 00:00:00"  # d2
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'order_no', 'app_id', 'act_id', 'module_id','source_type', 'user_id', 'open_id', 'user_nick', 'real_name', 'telephone', 'province', 'city', 'county', 'street', 'address', 'deliver_date', 'express_no', 'express_company', 'order_status', 'buyer_remark', 'seller_remark', 'cs_modify_address', 'order_price', 'is_free_freight', 'freight_price', 'freight_pay_order_no', 'create_date', 'create_month', 'create_day', 'modify_date', 'sync_status', 'sync_date', 'sync_count', 'sync_result', 'i1', 'i2', 'i3', 'i4', 'i5', 's1','s2', 's3', 's4', 's5', 'd1', 'd2']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "prize_order_tb"
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/prize/prize_roster_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/prize/prize_roster_model.py`

 * *Ordering differences only*

 * *Files 25% similar despite different names*

```diff
@@ -1,88 +1,88 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-27 10:55:09
-@LastEditTime: 2022-10-27 16:48:27
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class PrizeRosterModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(PrizeRosterModel, self).__init__(PrizeRoster, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class PrizeRoster:
-
-    def __init__(self):
-        super(PrizeRoster, self).__init__()
-        self.id = 0  # id
-        self.app_id = ""  # 应用标识
-        self.act_id = 0  # 活动标识
-        self.user_id = 0  # 用户标识
-        self.open_id = ""  # open_id
-        self.user_nick = ""  # 用户昵称
-        self.order_no = ""  # 订单号
-        self.source_type = 0  # 来源类型（0-活动奖品1-任务奖品2-兑换奖品）业务自定义从101开始
-        self.source_object_id = ""  # 来源对象标识
-        self.module_id = 0  # 活动模块标识
-        self.module_name = ""  # 活动模块名称
-        self.goods_type = 0  # 物品类型（1虚拟2实物）
-        self.prize_type = 0  # 奖品类型(1现货2优惠券3红包4参与奖5预售6积分7卡片)业务自定义从101开始
-        self.prize_id = 0  # 奖品标识
-        self.prize_name = ""  # 奖品名称
-        self.prize_pic = ""  # 奖品图
-        self.prize_detail_json = ""  # 奖品详情json
-        self.prize_price = 0  # 奖品价格
-        self.tag_name = ""  # 标签名称(奖项名称)
-        self.tag_id = 0  # 标签ID(奖项标识)
-        self.logistics_status = 0  # 物流状态（0未发货1已发货2不予发货）
-        self.prize_status = 0  # 奖品状态（0未下单（未领取）1已下单（已领取）2已回购10已隐藏（删除）11无需发货）
-        self.pay_status = 0  # 支付状态(0未支付1已支付2已退款3处理中)
-        self.goods_id = ""  # 商品ID
-        self.goods_code = ""  # 商品编码
-        self.goods_code_list = ""  # 多个sku商品编码
-        self.is_sku = 0  # 是否有SKU
-        self.sku_id = ""  # sku_id
-        self.sku_name = ""  # sku_name
-        self.sku_json = ""  # sku详情json
-        self.main_pay_order_no = ""  # 支付主订单号
-        self.sub_pay_order_no = ""  # 支付子订单号
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.request_code = ""  # 请求代码
-        self.i1 = 0  # i1
-        self.i2 = 0  # i2
-        self.i3 = 0  # i3
-        self.i4 = 0  # i4
-        self.i5 = 0  # i5
-        self.s1 = ""  # s1
-        self.s2 = ""  # s2
-        self.s3 = ""  # s3
-        self.s4 = ""  # s4
-        self.s5 = ""  # s5
-        self.d1 = "1900-01-01 00:00:00"  # d1
-        self.d2 = "1900-01-01 00:00:00"  # d2
-
-    @classmethod
-    def get_field_list(self):
-        return [
-            'id', 'app_id', 'act_id', 'user_id', 'open_id', 'user_nick', 'order_no', 'source_type', 'source_object_id', 'module_id', 'module_name', 'goods_type', 'prize_type', 'prize_id', 'prize_name', 'prize_pic', 'prize_detail_json', 'prize_price', 'tag_name', 'tag_id', 'logistics_status', 'prize_status', 'pay_status', 'goods_id', 'goods_code', 'goods_code_list', 'is_sku', 'sku_id', 'sku_name', 'sku_json', 'main_pay_order_no', 'sub_pay_order_no', 'create_date', 'request_code', 'i1', 'i2',
-            'i3', 'i4', 'i5', 's1', 's2', 's3', 's4', 's5', 'd1', 'd2'
-        ]
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "prize_roster_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-27 10:55:09
+@LastEditTime: 2022-10-27 16:48:27
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class PrizeRosterModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(PrizeRosterModel, self).__init__(PrizeRoster, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class PrizeRoster:
+
+    def __init__(self):
+        super(PrizeRoster, self).__init__()
+        self.id = 0  # id
+        self.app_id = ""  # 应用标识
+        self.act_id = 0  # 活动标识
+        self.user_id = 0  # 用户标识
+        self.open_id = ""  # open_id
+        self.user_nick = ""  # 用户昵称
+        self.order_no = ""  # 订单号
+        self.source_type = 0  # 来源类型（0-活动奖品1-任务奖品2-兑换奖品）业务自定义从101开始
+        self.source_object_id = ""  # 来源对象标识
+        self.module_id = 0  # 活动模块标识
+        self.module_name = ""  # 活动模块名称
+        self.goods_type = 0  # 物品类型（1虚拟2实物）
+        self.prize_type = 0  # 奖品类型(1现货2优惠券3红包4参与奖5预售6积分7卡片)业务自定义从101开始
+        self.prize_id = 0  # 奖品标识
+        self.prize_name = ""  # 奖品名称
+        self.prize_pic = ""  # 奖品图
+        self.prize_detail_json = ""  # 奖品详情json
+        self.prize_price = 0  # 奖品价格
+        self.tag_name = ""  # 标签名称(奖项名称)
+        self.tag_id = 0  # 标签ID(奖项标识)
+        self.logistics_status = 0  # 物流状态（0未发货1已发货2不予发货）
+        self.prize_status = 0  # 奖品状态（0未下单（未领取）1已下单（已领取）2已回购10已隐藏（删除）11无需发货）
+        self.pay_status = 0  # 支付状态(0未支付1已支付2已退款3处理中)
+        self.goods_id = ""  # 商品ID
+        self.goods_code = ""  # 商品编码
+        self.goods_code_list = ""  # 多个sku商品编码
+        self.is_sku = 0  # 是否有SKU
+        self.sku_id = ""  # sku_id
+        self.sku_name = ""  # sku_name
+        self.sku_json = ""  # sku详情json
+        self.main_pay_order_no = ""  # 支付主订单号
+        self.sub_pay_order_no = ""  # 支付子订单号
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.request_code = ""  # 请求代码
+        self.i1 = 0  # i1
+        self.i2 = 0  # i2
+        self.i3 = 0  # i3
+        self.i4 = 0  # i4
+        self.i5 = 0  # i5
+        self.s1 = ""  # s1
+        self.s2 = ""  # s2
+        self.s3 = ""  # s3
+        self.s4 = ""  # s4
+        self.s5 = ""  # s5
+        self.d1 = "1900-01-01 00:00:00"  # d1
+        self.d2 = "1900-01-01 00:00:00"  # d2
+
+    @classmethod
+    def get_field_list(self):
+        return [
+            'id', 'app_id', 'act_id', 'user_id', 'open_id', 'user_nick', 'order_no', 'source_type', 'source_object_id', 'module_id', 'module_name', 'goods_type', 'prize_type', 'prize_id', 'prize_name', 'prize_pic', 'prize_detail_json', 'prize_price', 'tag_name', 'tag_id', 'logistics_status', 'prize_status', 'pay_status', 'goods_id', 'goods_code', 'goods_code_list', 'is_sku', 'sku_id', 'sku_name', 'sku_json', 'main_pay_order_no', 'sub_pay_order_no', 'create_date', 'request_code', 'i1', 'i2',
+            'i3', 'i4', 'i5', 's1', 's2', 's3', 's4', 's5', 'd1', 'd2'
+        ]
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "prize_roster_tb"
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/product/product_price_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/product/product_price_model.py`

 * *Ordering differences only*

 * *Files 17% similar despite different names*

```diff
@@ -1,49 +1,49 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-27 10:55:09
-@LastEditTime: 2021-07-29 18:34:42
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class ProductPriceModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(ProductPriceModel, self).__init__(ProductPrice, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class ProductPrice:
-
-    def __init__(self):
-        super(ProductPrice, self).__init__()
-        self.id = 0  # id
-        self.plan_name = ""  # 计划名称
-        self.begin_time = "1900-01-01 00:00:00"  # 开始时间
-        self.end_time = "1900-01-01 00:00:00"  # 结束时间
-        self.content = ""  # 内容 举例:[{'price': 1, 'link_url': '2', 'time': '3个月', 'costprice': 1, 'title': '1'}, {'price': 2, 'link_url': '3', 'time': '6个月', 'costprice': 2, 'title': '2'}, {'price': 4, 'link_url': '5', 'time': '12个月', 'costprice': 4, 'title': '4'}]
-        self.project_code = "" # 项目编码
-        self.is_release = 0  # 是否发布（1是0否）
-        self.release_date = "1900-01-01 00:00:00"  # 发布时间
-        self.create_time = "1900-01-01 00:00:00"  # 创建时间
-        self.modify_date = "1900-01-01 00:00:00"  # 更新时间
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'plan_name', 'begin_time', 'end_time', 'content', 'project_code', 'is_release', 'release_date', 'create_time', 'modify_date']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "product_price_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-27 10:55:09
+@LastEditTime: 2021-07-29 18:34:42
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class ProductPriceModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(ProductPriceModel, self).__init__(ProductPrice, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class ProductPrice:
+
+    def __init__(self):
+        super(ProductPrice, self).__init__()
+        self.id = 0  # id
+        self.plan_name = ""  # 计划名称
+        self.begin_time = "1900-01-01 00:00:00"  # 开始时间
+        self.end_time = "1900-01-01 00:00:00"  # 结束时间
+        self.content = ""  # 内容 举例:[{'price': 1, 'link_url': '2', 'time': '3个月', 'costprice': 1, 'title': '1'}, {'price': 2, 'link_url': '3', 'time': '6个月', 'costprice': 2, 'title': '2'}, {'price': 4, 'link_url': '5', 'time': '12个月', 'costprice': 4, 'title': '4'}]
+        self.project_code = "" # 项目编码
+        self.is_release = 0  # 是否发布（1是0否）
+        self.release_date = "1900-01-01 00:00:00"  # 发布时间
+        self.create_time = "1900-01-01 00:00:00"  # 创建时间
+        self.modify_date = "1900-01-01 00:00:00"  # 更新时间
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'plan_name', 'begin_time', 'end_time', 'content', 'project_code', 'is_release', 'release_date', 'create_time', 'modify_date']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "product_price_tb"
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/refund/refund_order_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/user/user_black_model.py`

 * *Files 22% similar despite different names*

```diff
@@ -1,55 +1,53 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-09-13 16:26:10
-@LastEditTime: 2021-09-30 10:19:50
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class RefundOrderModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(RefundOrderModel, self).__init__(RefundOrder, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class RefundOrder:
-
-    def __init__(self):
-        super(RefundOrder, self).__init__()
-        self.id = 0  # id
-        self.app_id = ""  # 应用标识
-        self.act_id = 0  # 活动标识
-        self.user_id = 0  # 用户标识
-        self.open_id = ""  # open_id
-        self.refund_type = 1  # 退款类型（1-手动 2-自动）
-        self.pay_order_no = ""  # 支付单号
-        self.refund_no = ""  # 退款单号
-        self.out_refund_no = ""  # 平台退款单号
-        self.out_order_no = ""  # 平台交易单号
-        self.refund_amount = 0  # 退款金额
-        self.refund_status = 0  # 退款状态 1商户申请退款中2退款处理中3退款成功4退款失败5退款关闭
-        self.refund_reason = ""  # 退款理由
-        self.refund_date = "1900-01-01 00:00:00"  # 退款时间
-        self.refund_result_detail = ""  # 退款结果描述
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'app_id', 'act_id', 'user_id', 'open_id', 'refund_type', 'pay_order_no', 'refund_no', 'out_refund_no', 'out_order_no', 'refund_amount', 'refund_status', 'refund_reason', 'refund_date', 'refund_result_detail', 'create_date']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "refund_order_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-22 16:03:01
+@LastEditTime: 2021-07-29 18:39:05
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class UserBlackModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(UserBlackModel, self).__init__(UserBlack, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class UserBlack:
+
+    def __init__(self):
+        super(UserBlack, self).__init__()
+        self.id = 0  # 标识
+        self.app_id = ""  # 应用标识
+        self.act_id = 0  # 活动标识
+        self.user_id = 0  # 用户标识
+        self.open_id = ""  # open_id
+        self.user_nick = ""  # 用户昵称
+        self.black_type = 0  # 拉黑类型（1自动2手动）
+        self.reason = ""  # 申请原因
+        self.audit_status = 0  # 审核状态(0黑名单1申请中2同意3拒绝)
+        self.audit_remark = ""  # 审核备注
+        self.refund_count = 0  # 退款次数
+        self.refund_order_data = ""  # 退款主订单号(逗号分隔)
+        self.create_date = "1900-01-01 00:00:00"  # 申请时间
+        self.audit_date = "1900-01-01 00:00:00"  # 审核时间
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'app_id', 'act_id', 'user_id', 'open_id', 'user_nick', 'black_type', 'reason', 'audit_status', 'audit_remark', 'refund_count', 'refund_order_data', 'create_date', 'audit_date']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "user_black_tb"
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/saas/saas_custom_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/store/store_asset_model.py`

 * *Files 26% similar despite different names*

```diff
@@ -1,50 +1,51 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-26 17:00:16
-@LastEditTime: 2021-07-29 18:34:56
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class SaasCustomModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(SaasCustomModel, self).__init__(SaasCustom, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class SaasCustom:
-
-    def __init__(self):
-        super(SaasCustom, self).__init__()
-        self.id = 0  #
-        self.cloud_app_id = 0  # 云应用id
-        self.store_user_nick = ""  # 店铺主帐号名称（会员名）
-        self.app_name = ""  # 应用名称
-        self.app_icon = ""  # 应用图标
-        self.is_release = 0  # 是否发布（1是0否）
-        self.release_date = "1900-01-01 00:00:00"  # 发布时间
-        self.service_date_start = "1900-01-01 00:00:00"  # 服务开始时间
-        self.service_date_end = "1900-01-01 00:00:00"  # 服务结束时间
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.modify_date = "1900-01-01 00:00:00"  # 更新时间
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'cloud_app_id', 'store_user_nick', 'app_name', 'app_icon', 'is_release', 'release_date', 'service_date_start', 'service_date_end', 'create_date', 'modify_date']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "saas_custom_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-15 17:17:08
+@LastEditTime: 2022-06-27 14:26:58
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class StoreAssetModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(StoreAssetModel, self).__init__(StoreAsset, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+
+class StoreAsset:
+
+    def __init__(self):
+        super(StoreAsset, self).__init__()
+        self.id = 0  # id
+        self.id_md5 = 0  # id_md5(app_id+asset_type+asset_object_id)md5int生成
+        self.store_id = 0  # 店铺ID
+        self.store_name = 0  # 店铺名称
+        self.app_id = ""  # 应用标识
+        self.asset_type = 0  # 资产类型(1-次数2-积分3-价格档位，业务自定义类型从101起，避免跟公共冲突)
+        self.asset_object_id = ""  # 资产对象标识
+        self.asset_value = 0  # 资产值
+        self.asset_check_code = ""  # 资产检验码(id+asset_value+加密签名)md5生成
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.modify_date = "1900-01-01 00:00:00"  # 更新时间
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'id_md5', 'store_id', 'store_name', 'app_id', 'asset_type', 'asset_object_id', 'asset_value', 'asset_check_code', 'create_date', 'modify_date']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "store_asset_tb"
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/special/special_goods_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/special/special_goods_model.py`

 * *Ordering differences only*

 * *Files 17% similar despite different names*

```diff
@@ -1,45 +1,45 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-28 16:41:14
-@LastEditTime: 2021-08-10 18:06:59
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class SpecialGoodsModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(SpecialGoodsModel, self).__init__(SpecialGoods, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class SpecialGoods:
-
-    def __init__(self):
-        super(SpecialGoods, self).__init__()
-        self.id = 0  # 标识
-        self.app_id = ""  # 应用唯一标识
-        self.goods_id = ""  # 商品ID
-        self.goods_name = ""  # 商品名称
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.modify_date = "1900-01-01 00:00:00"  # 修改时间
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'app_id', 'goods_id', 'goods_name', 'create_date', 'modify_date']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "special_goods_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-28 16:41:14
+@LastEditTime: 2021-08-10 18:06:59
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class SpecialGoodsModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(SpecialGoodsModel, self).__init__(SpecialGoods, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class SpecialGoods:
+
+    def __init__(self):
+        super(SpecialGoods, self).__init__()
+        self.id = 0  # 标识
+        self.app_id = ""  # 应用唯一标识
+        self.goods_id = ""  # 商品ID
+        self.goods_name = ""  # 商品名称
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.modify_date = "1900-01-01 00:00:00"  # 修改时间
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'app_id', 'goods_id', 'goods_name', 'create_date', 'modify_date']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "special_goods_tb"
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/stat/stat_log_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/stat/stat_report_model.py`

 * *Files 14% similar despite different names*

```diff
@@ -1,51 +1,50 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-26 09:40:36
-@LastEditTime: 2021-07-29 18:35:59
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class StatLogModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(StatLogModel, self).__init__(StatLog, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class StatLog:
-
-    def __init__(self):
-        super(StatLog, self).__init__()
-        self.id = 0  # id
-        self.app_id = ""  # 应用标识
-        self.act_id = 0  # 活动标识
-        self.module_id = 0  # 活动模块标识
-        self.object_id = ""  # 对象标识
-        self.orm_id = 0  # 映射标识
-        self.user_id = 0  # 用户标识
-        self.open_id = ""  # open_id
-        self.key_value = 0  # key值
-        self.create_day = 0  # 创建日
-        self.create_month = 0  # 创建月
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'app_id', 'act_id', 'module_id', 'object_id', 'orm_id', 'user_id', 'open_id', 'key_value', 'create_day', 'create_month', 'create_date']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "stat_log_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-26 09:40:36
+@LastEditTime: 2021-07-29 18:36:50
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class StatReportModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(StatReportModel, self).__init__(StatReport, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class StatReport:
+
+    def __init__(self):
+        super(StatReport, self).__init__()
+        self.id = 0  # id
+        self.app_id = ""  # 应用标识
+        self.act_id = 0  # 活动标识
+        self.module_id = 0  # 活动模块标识
+        self.object_id = ""  # 对象标识
+        self.key_name = ""  # key名称
+        self.key_value = 0  # key值
+        self.create_day = 0  # 创建天
+        self.create_month = 0  # 创建月
+        self.create_year = 0  # 创建年
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'app_id', 'act_id', 'module_id', 'object_id', 'key_name', 'key_value', 'create_day', 'create_month', 'create_year', 'create_date']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "stat_report_tb"
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/stat/stat_orm_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/task/task_gear_count_model.py`

 * *Files 25% similar despite different names*

```diff
@@ -1,58 +1,53 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-26 09:40:36
-@LastEditTime: 2023-05-24 18:33:19
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class StatOrmModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(StatOrmModel, self).__init__(StatOrm, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class StatOrm:
-
-    def __init__(self):
-        super(StatOrm, self).__init__()
-        self.id = 0  # id
-        self.app_id = ""  # 应用标识
-        self.act_id = 0  # 活动标识
-        self.module_id = 0  # 活动模块标识
-        self.object_id = ""  # 对象标识
-        self.group_name = ""  # 分组名称
-        self.group_sub_name = ""  # 分组子名称
-        self.key_name = ""  # key名称
-        self.key_value = ""  # key值
-        self.tip_title = "" # 提示标题
-        self.value_type = 0 # 输出类型(1-int，2-decimal)
-        self.repeat_type = 0  # 去重方式(0不去重1当日去重2全部去重)
-        self.sort_index = 0  # 排序号
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.is_show = 0  # 是否显示(1是0否)
-        self.i1 = 0  # i1
-        self.i2 = 0  # i2
-        self.s1 = ""  # s1
-        self.s2 = ""  # s2
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'app_id', 'act_id', 'module_id', 'object_id', 'group_name', 'group_sub_name', 'key_name', 'key_value', 'tip_title', 'value_type', 'repeat_type', 'sort_index', 'create_date', 'is_show', 'i1', 'i2', 's1', 's2']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "stat_orm_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-08-10 10:09:06
+@LastEditTime: 2023-05-22 14:37:04
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+
+
+class TaskGearCountModel(BaseModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(TaskGearCountModel, self).__init__(TaskGearCount, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+
+class TaskGearCount:
+
+    def __init__(self):
+        super(TaskGearCount, self).__init__()
+        self.id = 0  # 标识
+        self.id_md5 = 0  # id_md5(actid+moduleid+tasktype+userid)md5int生成
+        self.app_id = ""  # 应用标识
+        self.act_id = 0  # 活动标识
+        self.module_id = 0  # 活动模块标识
+        self.user_id = 0  # 用户标识
+        self.open_id = ""  # open_id
+        self.task_type = 0  # 任务类型（枚举TaskType）
+        self.now_count = 0  # 当前计数
+        self.create_day = 0  # 创建天(19000101)
+        self.create_month = 0  # 创建天(19000101)
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.modify_date = "1900-01-01 00:00:00"  # 修改时间
+        self.remark = ""  # 备注
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'id_md5', 'app_id', 'act_id', 'module_id', 'user_id', 'open_id', 'task_type', 'now_count', 'create_day', 'create_month', 'create_date', 'modify_date', 'remark']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "task_gear_count_tb"
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/stat/stat_queue_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/stat/stat_user_log_model.py`

 * *Files 22% similar despite different names*

```diff
@@ -1,45 +1,51 @@
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class StatQueueModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(StatQueueModel, self).__init__(StatQueue, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class StatQueue:
-
-    def __init__(self):
-        super(StatQueue, self).__init__()
-        self.id = 0  # id
-        self.app_id = ""  # 应用标识
-        self.act_id = 0  # 活动标识
-        self.module_id = 0  # 活动模块标识
-        self.object_id = ""  # 对象标识
-        self.user_id = 0  # 用户标识
-        self.open_id = ""  # open_id
-        self.key_name = ""  # key名称
-        self.key_value = 0  # key值
-        self.request_code = ""  # 请求代码
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.process_count = 0  # 处理次数
-        self.process_result = ""  # 处理结果
-        self.process_date = "1900-01-01 00:00:00"  # 处理时间
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'app_id', 'act_id', 'module_id','object_id', 'user_id', 'open_id', 'key_name', 'key_value', 'request_code', 'create_date', 'process_count', 'process_result', 'process_date']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "stat_queue_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2022-08-24 15:02:41
+@LastEditTime: 2022-11-24 16:39:38
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class StatUserLogModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(StatUserLogModel, self).__init__(StatUserLog, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class StatUserLog:
+
+    def __init__(self):
+        super(StatUserLog, self).__init__()
+        self.id = 0  # id
+        self.app_id = ""  # 应用标识
+        self.act_id = 0  # 活动标识
+        self.module_id = 0  # 活动模块标识
+        self.user_id = 0  # 用户标识
+        self.open_id = ""  # open_id
+        self.key_name = ""  # key名称
+        self.key_value = 0  # key值
+        self.request_code = ""  # 请求代码
+        self.create_day = 0  # 创建日
+        self.create_month = 0  # 创建月
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'app_id', 'act_id', 'module_id', 'user_id', 'open_id', 'key_name', 'key_value', 'request_code', 'create_day', 'create_month', 'create_date']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "stat_user_log_tb"
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/stat/stat_report_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/user/user_address_model.py`

 * *Files 17% similar despite different names*

```diff
@@ -1,50 +1,53 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-26 09:40:36
-@LastEditTime: 2021-07-29 18:36:50
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class StatReportModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(StatReportModel, self).__init__(StatReport, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class StatReport:
-
-    def __init__(self):
-        super(StatReport, self).__init__()
-        self.id = 0  # id
-        self.app_id = ""  # 应用标识
-        self.act_id = 0  # 活动标识
-        self.module_id = 0  # 活动模块标识
-        self.object_id = ""  # 对象标识
-        self.key_name = ""  # key名称
-        self.key_value = 0  # key值
-        self.create_day = 0  # 创建天
-        self.create_month = 0  # 创建月
-        self.create_year = 0  # 创建年
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'app_id', 'act_id', 'module_id', 'object_id', 'key_name', 'key_value', 'create_day', 'create_month', 'create_year', 'create_date']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "stat_report_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-11-01 18:56:43
+@LastEditTime: 2021-11-02 18:33:34
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class UserAddressModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(UserAddressModel, self).__init__(UserAddress, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class UserAddress:
+
+    def __init__(self):
+        super(UserAddress, self).__init__()
+        self.id = 0  # id
+        self.app_id = ""  # 应用标识
+        self.act_id = 0  # 活动标识
+        self.user_id = 0  # 用户标识
+        self.open_id = ""  # open_id
+        self.real_name = ""  # 真实姓名
+        self.telephone = ""  # 手机号码
+        self.is_default = 0  # 是否默认地址（1是0否）
+        self.province = ""  # 省
+        self.city = ""  # 市
+        self.county = ""  # 区
+        self.street = ""  # 所在街道
+        self.address = ""  # 收货地址
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'app_id', 'act_id', 'user_id', 'open_id', 'real_name', 'telephone', 'is_default', 'province', 'city', 'county', 'street', 'address', 'create_date']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "user_address_tb"
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/stat/stat_user_log_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/theme/theme_ver_model.py`

 * *Files 22% similar despite different names*

```diff
@@ -1,51 +1,46 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2022-08-24 15:02:41
-@LastEditTime: 2022-11-24 16:39:38
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class StatUserLogModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(StatUserLogModel, self).__init__(StatUserLog, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class StatUserLog:
-
-    def __init__(self):
-        super(StatUserLog, self).__init__()
-        self.id = 0  # id
-        self.app_id = ""  # 应用标识
-        self.act_id = 0  # 活动标识
-        self.module_id = 0  # 活动模块标识
-        self.user_id = 0  # 用户标识
-        self.open_id = ""  # open_id
-        self.key_name = ""  # key名称
-        self.key_value = 0  # key值
-        self.request_code = ""  # 请求代码
-        self.create_day = 0  # 创建日
-        self.create_month = 0  # 创建月
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'app_id', 'act_id', 'module_id', 'user_id', 'open_id', 'key_name', 'key_value', 'request_code', 'create_day', 'create_month', 'create_date']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "stat_user_log_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-26 15:41:57
+@LastEditTime: 2021-07-29 18:38:20
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class ThemeVerModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(ThemeVerModel, self).__init__(ThemeVer, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class ThemeVer:
+
+    def __init__(self):
+        super(ThemeVer, self).__init__()
+        self.id = 0  # id
+        self.theme_id = 0  # 主题标识
+        self.out_id = ""  # 外部id
+        self.client_json = ""  # 客户端内容json
+        self.ver_no = ""  # 客户端版本号
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.modify_date = "1900-01-01 00:00:00"  # 修改时间
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'theme_id', 'out_id', 'client_json', 'ver_no', 'create_date', 'modify_date']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "theme_ver_tb"
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/stat/stat_user_report_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/stat/stat_user_report_model.py`

 * *Ordering differences only*

 * *Files 13% similar despite different names*

```diff
@@ -1,78 +1,78 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2022-08-24 15:02:41
-@LastEditTime: 2022-08-25 09:35:33
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-class StatUserReportModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(StatUserReportModel, self).__init__(StatUserReport, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class StatUserReport:
-
-    def __init__(self):
-        super(StatUserReport, self).__init__()
-        self.id = 0  # id
-        self.app_id = ""  # 应用标识
-        self.act_id = 0  # 活动标识
-        self.module_id = 0  # 活动模块标识
-        self.user_id = 0  # 用户标识
-        self.open_id = ""  # open_id
-        self.i1 = 0  # i1
-        self.i2 = 0  # i2
-        self.i3 = 0  # i3
-        self.i4 = 0  # i4
-        self.i5 = 0  # i5
-        self.i6 = 0  # i6
-        self.i7 = 0  # i7
-        self.i8 = 0  # i8
-        self.i9 = 0  # i9
-        self.i10 = 0  # i10
-        self.i11 = 0  # i11
-        self.i12 = 0  # i12
-        self.i13 = 0  # i13
-        self.i14 = 0  # i14
-        self.i15 = 0  # i15
-        self.i16 = 0  # i16
-        self.i17 = 0  # i17
-        self.i18 = 0  # i18
-        self.i19 = 0  # i19
-        self.i20 = 0  # i20
-        self.d1 = 0  # d1
-        self.d2 = 0  # d2
-        self.d3 = 0  # d3
-        self.d4 = 0  # d4
-        self.d5 = 0  # d5
-        self.d6 = 0  # d6
-        self.d7 = 0  # d7
-        self.d8 = 0  # d8
-        self.d9 = 0  # d9
-        self.d10 = 0  # d10
-        self.create_day = 0  # 创建天
-        self.create_month = 0  # 创建月
-        self.create_year = 0  # 创建年
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'app_id', 'act_id', 'module_id', 'user_id', 'open_id', 'i1', 'i2', 'i3', 'i4', 'i5', 'i6', 'i7', 'i8', 'i9', 'i10', 'i11', 'i12', 'i13', 'i14', 'i15', 'i16', 'i17', 'i18', 'i19', 'i20', 'd1', 'd2', 'd3', 'd4', 'd5', 'd6', 'd7', 'd8', 'd9', 'd10', 'create_day', 'create_month', 'create_year', 'create_date']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "stat_user_report_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2022-08-24 15:02:41
+@LastEditTime: 2022-08-25 09:35:33
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+class StatUserReportModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(StatUserReportModel, self).__init__(StatUserReport, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class StatUserReport:
+
+    def __init__(self):
+        super(StatUserReport, self).__init__()
+        self.id = 0  # id
+        self.app_id = ""  # 应用标识
+        self.act_id = 0  # 活动标识
+        self.module_id = 0  # 活动模块标识
+        self.user_id = 0  # 用户标识
+        self.open_id = ""  # open_id
+        self.i1 = 0  # i1
+        self.i2 = 0  # i2
+        self.i3 = 0  # i3
+        self.i4 = 0  # i4
+        self.i5 = 0  # i5
+        self.i6 = 0  # i6
+        self.i7 = 0  # i7
+        self.i8 = 0  # i8
+        self.i9 = 0  # i9
+        self.i10 = 0  # i10
+        self.i11 = 0  # i11
+        self.i12 = 0  # i12
+        self.i13 = 0  # i13
+        self.i14 = 0  # i14
+        self.i15 = 0  # i15
+        self.i16 = 0  # i16
+        self.i17 = 0  # i17
+        self.i18 = 0  # i18
+        self.i19 = 0  # i19
+        self.i20 = 0  # i20
+        self.d1 = 0  # d1
+        self.d2 = 0  # d2
+        self.d3 = 0  # d3
+        self.d4 = 0  # d4
+        self.d5 = 0  # d5
+        self.d6 = 0  # d6
+        self.d7 = 0  # d7
+        self.d8 = 0  # d8
+        self.d9 = 0  # d9
+        self.d10 = 0  # d10
+        self.create_day = 0  # 创建天
+        self.create_month = 0  # 创建月
+        self.create_year = 0  # 创建年
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'app_id', 'act_id', 'module_id', 'user_id', 'open_id', 'i1', 'i2', 'i3', 'i4', 'i5', 'i6', 'i7', 'i8', 'i9', 'i10', 'i11', 'i12', 'i13', 'i14', 'i15', 'i16', 'i17', 'i18', 'i19', 'i20', 'd1', 'd2', 'd3', 'd4', 'd5', 'd6', 'd7', 'd8', 'd9', 'd10', 'create_day', 'create_month', 'create_year', 'create_date']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "stat_user_report_tb"
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/store/store_asset_log_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/store/store_asset_log_model.py`

 * *Ordering differences only*

 * *Files 11% similar despite different names*

```diff
@@ -1,64 +1,64 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-15 17:17:08
-@LastEditTime: 2022-10-27 17:08:51
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class StoreAssetLogModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(StoreAssetLogModel, self).__init__(StoreAssetLog, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-
-class StoreAssetLog:
-
-    def __init__(self):
-        super(StoreAssetLog, self).__init__()
-        self.id = 0  # id
-        self.store_id = 0  # 店铺ID
-        self.store_name = 0  # 店铺名称
-        self.app_id = ""  # 应用标识
-        self.log_title = ""  # 标题
-        self.info_json = ""  # 详情信息
-        self.asset_type = 0  # 资产类型(1-次数2-积分3-价格档位)
-        self.asset_object_id = ""  # 资产对象标识（比如资产类型是价格档位则对应档位id）
-        self.source_type = 0  # 来源类型（1-购买2-任务3-手动配置4-抽奖5-回购6-兑换.业务自定义类型从101起，避免跟公共冲突）
-        self.source_object_id = ""  # 来源对象标识(比如来源类型是任务则对应任务类型)
-        self.source_object_name = ""  # 来源对象名称(比如来源类型是任务则对应任务名称)
-        self.only_id = ""  # 唯一标识(用于并发操作时校验避免重复操作)
-        self.operate_type = 0  # 操作类型 （0累计 1消耗）
-        self.operate_value = 0  # 操作值
-        self.history_value = 0  # 历史值
-        self.now_value = 0  # 当前值
-        self.handler_name = ""  # 接口名称
-        self.request_code = ""  # 请求代码
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.create_day = 0  # 创建天
-        self.warn_date = "1900-01-01 00:00:00"  # 预警时间
-        self.warn_day = 0  # 预警天
-        self.i1 = 0  # i1
-        self.s1 = ""  # s1
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'store_id', 'store_name', 'app_id', 'log_title', 'info_json', 'asset_type', 'asset_object_id', 'source_type', 'source_object_id', 'source_object_name', 'only_id', 'operate_type', 'operate_value', 'history_value', 'now_value', 'handler_name', 'request_code', 'create_date', 'create_day', 'warn_date', 'warn_day', 'i1', 's1']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "store_asset_log_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-15 17:17:08
+@LastEditTime: 2022-10-27 17:08:51
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class StoreAssetLogModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(StoreAssetLogModel, self).__init__(StoreAssetLog, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+
+class StoreAssetLog:
+
+    def __init__(self):
+        super(StoreAssetLog, self).__init__()
+        self.id = 0  # id
+        self.store_id = 0  # 店铺ID
+        self.store_name = 0  # 店铺名称
+        self.app_id = ""  # 应用标识
+        self.log_title = ""  # 标题
+        self.info_json = ""  # 详情信息
+        self.asset_type = 0  # 资产类型(1-次数2-积分3-价格档位)
+        self.asset_object_id = ""  # 资产对象标识（比如资产类型是价格档位则对应档位id）
+        self.source_type = 0  # 来源类型（1-购买2-任务3-手动配置4-抽奖5-回购6-兑换.业务自定义类型从101起，避免跟公共冲突）
+        self.source_object_id = ""  # 来源对象标识(比如来源类型是任务则对应任务类型)
+        self.source_object_name = ""  # 来源对象名称(比如来源类型是任务则对应任务名称)
+        self.only_id = ""  # 唯一标识(用于并发操作时校验避免重复操作)
+        self.operate_type = 0  # 操作类型 （0累计 1消耗）
+        self.operate_value = 0  # 操作值
+        self.history_value = 0  # 历史值
+        self.now_value = 0  # 当前值
+        self.handler_name = ""  # 接口名称
+        self.request_code = ""  # 请求代码
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.create_day = 0  # 创建天
+        self.warn_date = "1900-01-01 00:00:00"  # 预警时间
+        self.warn_day = 0  # 预警天
+        self.i1 = 0  # i1
+        self.s1 = ""  # s1
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'store_id', 'store_name', 'app_id', 'log_title', 'info_json', 'asset_type', 'asset_object_id', 'source_type', 'source_object_id', 'source_object_name', 'only_id', 'operate_type', 'operate_value', 'history_value', 'now_value', 'handler_name', 'request_code', 'create_date', 'create_day', 'warn_date', 'warn_day', 'i1', 's1']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "store_asset_log_tb"
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/store/store_asset_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/operation/operation_config_model.py`

 * *Files 23% similar despite different names*

```diff
@@ -1,51 +1,45 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-15 17:17:08
-@LastEditTime: 2022-06-27 14:26:58
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class StoreAssetModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(StoreAssetModel, self).__init__(StoreAsset, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-
-class StoreAsset:
-
-    def __init__(self):
-        super(StoreAsset, self).__init__()
-        self.id = 0  # id
-        self.id_md5 = 0  # id_md5(app_id+asset_type+asset_object_id)md5int生成
-        self.store_id = 0  # 店铺ID
-        self.store_name = 0  # 店铺名称
-        self.app_id = ""  # 应用标识
-        self.asset_type = 0  # 资产类型(1-次数2-积分3-价格档位，业务自定义类型从101起，避免跟公共冲突)
-        self.asset_object_id = ""  # 资产对象标识
-        self.asset_value = 0  # 资产值
-        self.asset_check_code = ""  # 资产检验码(id+asset_value+加密签名)md5生成
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.modify_date = "1900-01-01 00:00:00"  # 更新时间
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'id_md5', 'store_id', 'store_name', 'app_id', 'asset_type', 'asset_object_id', 'asset_value', 'asset_check_code', 'create_date', 'modify_date']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "store_asset_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-08-02 10:11:35
+@LastEditTime: 2022-10-10 11:20:43
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class OperationConfigModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(OperationConfigModel, self).__init__(OperationConfig, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class OperationConfig:
+
+    def __init__(self):
+        super(OperationConfig, self).__init__()
+        self.id = 0  # id
+        self.model_name = ""  # 模块或表名称
+        self.config_json = ""  # 配置信息json
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+
+
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'model_name', 'config_json', 'create_date']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "operation_config_tb"
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/tao/tao_coupon_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/task/task_count_model.py`

 * *Files 19% similar despite different names*

```diff
@@ -1,54 +1,53 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-27 10:57:24
-@LastEditTime: 2021-12-10 14:32:30
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class TaoCouponModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(TaoCouponModel, self).__init__(TaoCoupon, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class TaoCoupon:
-
-    def __init__(self):
-        super(TaoCoupon, self).__init__()
-        self.id = 0  # 标识
-        self.app_id = ""  # 应用标识
-        self.act_id = 0  # 活动标识
-        self.module_id = 0  # 活动模块标识
-        self.prize_id = 0  # 奖品标识
-        self.coupon_type = 0  # 优惠券类型(0无1店铺优惠券2商品优惠券3会员专享优惠券)
-        self.coupon_url = ""  # 优惠劵地址
-        self.coupon_price = 0  # 优惠券面额
-        self.use_sill_price = 0  # 使用门槛金额
-        self.right_ename = ""  # 发放的权益(奖品)唯一标识
-        self.pool_id = ""  # 奖池ID
-        self.coupon_start_date = "1900-01-01 00:00:00"  # 优惠券开始时间
-        self.coupon_end_date = "1900-01-01 00:00:00"  # 优惠券结束时间
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.modify_date = "1900-01-01 00:00:00"  # 更新时间
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'app_id', 'act_id', 'module_id', 'prize_id', 'coupon_type', 'coupon_url', 'coupon_price', 'use_sill_price', 'right_ename', 'pool_id', 'coupon_start_date', 'coupon_end_date', 'create_date', 'modify_date']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "tao_coupon_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-08-10 10:09:06
+@LastEditTime: 2021-09-02 17:41:04
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+
+
+class TaskCountModel(BaseModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(TaskCountModel, self).__init__(TaskCount, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class TaskCount:
+
+    def __init__(self):
+        super(TaskCount, self).__init__()
+        self.id = 0  # 标识
+        self.id_md5 = 0  # id_md5(actid+moduleid+tasktype+tasksubtype+userid)md5int生成
+        self.app_id = ""  # 应用标识
+        self.act_id = 0  # 活动标识
+        self.module_id = 0  # 活动模块标识
+        self.user_id = 0  # 用户标识
+        self.open_id = ""  # open_id
+        self.task_type = 0  # 任务类型（枚举TaskType）
+        self.task_sub_type = ""  # 任务子类型(用于指定任务里的再细分，比如:指定金额任务分不同档位金额)
+        self.complete_count = 0  # 任务完成数
+        self.now_count = 0  # 当前计数
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.modify_date = "1900-01-01 00:00:00"  # 更新时间
+        self.modify_day = 0  # 更新天(19000101)
+        self.remark = ""  # 备注
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'id_md5', 'app_id', 'act_id', 'module_id', 'user_id', 'open_id', 'task_type', 'task_sub_type', 'complete_count', 'now_count', 'create_date', 'modify_date', 'modify_day', 'remark']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "task_count_tb"
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/tao/tao_login_log_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/theme/theme_info_model.py`

 * *Files 27% similar despite different names*

```diff
@@ -1,47 +1,50 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-27 10:57:24
-@LastEditTime: 2021-07-29 18:37:28
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class TaoLoginLogModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(TaoLoginLogModel, self).__init__(TaoLoginLog, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class TaoLoginLog:
-
-    def __init__(self):
-        super(TaoLoginLog, self).__init__()
-        self.id = 0  # id
-        self.open_id = ""  # open_id
-        self.user_nick = ""  # 用户昵称
-        self.store_user_nick = ""  # 主帐号名称（会员名）
-        self.is_master = 0  # 是否主账号（1是0否）
-        self.request_params = ""  # 参数
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.modify_date = "1900-01-01 00:00:00"  # 更新时间
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'open_id', 'user_nick', 'store_user_nick', 'is_master', 'request_params', 'create_date', 'modify_date']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "tao_login_log_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-26 15:41:57
+@LastEditTime: 2021-11-25 10:31:12
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class ThemeInfoModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(ThemeInfoModel, self).__init__(ThemeInfo, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class ThemeInfo:
+
+    def __init__(self):
+        super(ThemeInfo, self).__init__()
+        self.id = 0  # id
+        self.app_id = ""  # 应用唯一标识
+        self.ascription_type = 1  #归属类型(1公共)
+        self.theme_name = ""  # 主题名称
+        self.server_json = ""  # 服务端内容json
+        self.out_id = ""  # 外部id
+        self.style_type = 0  # 样式类型
+        self.sort_index = 0  # 排序号
+        self.is_release = 0  # 是否发布（1发布0未发布）
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.modify_date = "1900-01-01 00:00:00"  # 修改时间
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'app_id', 'ascription_type', 'theme_name', 'server_json', 'out_id', 'style_type', 'sort_index', 'is_release', 'create_date', 'modify_date']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "theme_info_tb"
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/tao/tao_pay_order_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/user/user_info_model.py`

 * *Files 16% similar despite different names*

```diff
@@ -1,74 +1,75 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-27 10:57:24
-@LastEditTime: 2022-01-21 16:34:17
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class TaoPayOrderModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(TaoPayOrderModel, self).__init__(TaoPayOrder, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class TaoPayOrder:
-
-    def __init__(self):
-        super(TaoPayOrder, self).__init__()
-        self.id = 0  # id(act_id+user_id+guid)md5int生成
-        self.ascription_type = 0  # 归属类型（0-抽奖次数订单1-邮费次数订单2-任务订单）
-        self.app_id = ""  # 应用标识
-        self.act_id = 0  # 活动标识
-        self.user_id = 0  # 用户标识
-        self.open_id = ""  # open_id
-        self.user_nick = ""  # 用户昵称
-        self.goods_code = ""  # 商品编码
-        self.goods_name = ""  # 商品名称
-        self.sku_id = ""  # sku_id
-        self.sku_name = ""  # sku_name
-        self.buy_num = 0  # 购买数量
-        self.pay_price = 0  # 购买金额
-        self.main_pay_order_no = ""  # 淘宝主订单号
-        self.sub_pay_order_no = ""  # 淘宝子订单号
-        self.order_status = ""  # 订单状态
-        self.asset_type = 0  # 资产类型(1-次数2-积分3-价格档位)
-        self.asset_object_name = ""  # 资产对象名称
-        self.asset_object_id = ""  # 资产对象标识
-        self.surplus_count = 0  # 剩余资产值
-        self.prize_ids = ""  # 奖品ID列表（逗号隔开）
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.pay_date = "1900-01-01 00:00:00"  # 支付时间
-        self.i1 = 0  # i1
-        self.i2 = 0  # i2
-        self.i3 = 0  # i3
-        self.i4 = 0  # i4
-        self.i5 = 0  # i5
-        self.s1 = ""  # s1
-        self.s2 = ""  # s2
-        self.s3 = ""  # s3
-        self.s4 = ""  # s4
-        self.s5 = ""  # s5
-        self.d1 = "1900-01-01 00:00:00"  # d1
-        self.d2 = "1900-01-01 00:00:00"  # d2
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'ascription_type', 'app_id', 'act_id', 'user_id', 'open_id', 'user_nick', 'goods_code', 'goods_name', 'sku_id', 'sku_name', 'buy_num', 'pay_price', 'main_pay_order_no', 'sub_pay_order_no', 'order_status', 'asset_type', 'asset_object_name', 'asset_object_id', 'surplus_count', 'prize_ids', 'create_date', 'pay_date', 'i1', 'i2', 'i3', 'i4', 'i5', 's1', 's2', 's3', 's4', 's5', 'd1', 'd2']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "tao_pay_order_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-22 10:59:39
+@LastEditTime: 2022-01-24 10:11:52
+@LastEditors: HuangJianYi
+@Description: 
+"""
+
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class UserInfoModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(UserInfoModel, self).__init__(UserInfo, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class UserInfo:
+
+    def __init__(self):
+        super(UserInfo, self).__init__()
+        self.id = 0  # id
+        self.id_md5 = ""  # id_md5(act_id+user_id)md5int生成
+        self.app_id = ""  # 应用标识
+        self.act_id = 0  # 活动标识
+        self.user_id = 0  # 用户标识
+        self.union_id = ""  # union_id
+        self.open_id = ""  # open_id
+        self.user_nick = ""  # 昵称
+        self.user_nick_encrypt = ""  # 昵称加密值
+        self.avatar = ""  # 头像
+        self.is_auth = 0  # 是否授权（1是0否）
+        self.is_new = 0  # 是否新用户
+        self.pay_price = 0  # 累计支付金额
+        self.pay_num = 0  # 累计支付笔数
+        self.login_token = ""  # 登录令牌
+        self.user_state = 0  # 用户状态（0-正常，1-黑名单）
+        self.is_member = 0  # 是否会员
+        self.is_member_before = 0  # 用户最初会员状态
+        self.is_favor = 0  # 是否关注店铺
+        self.is_favor_before = 0  # 用户最初关注状态（0未关注1已关注）
+        self.relieve_date = "1900-01-01 00:00:00"  # 解禁时间
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.modify_date = "1900-01-01 00:00:00"  # 更新时间
+        self.i1 = 0  # i1
+        self.i2 = 0  # i2
+        self.i3 = 0  # i3
+        self.i4 = 0  # i4
+        self.i5 = 0  # i5
+        self.s1 = ""  # s1
+        self.s2 = ""  # s2
+        self.s3 = ""  # s3
+        self.s4 = ""  # s4
+        self.s5 = ""  # s5
+        self.d1 = "1900-01-01 00:00:00"  # d1
+        self.d2 = "1900-01-01 00:00:00"  # d2
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'id_md5', 'app_id', 'act_id', 'user_id', 'union_id', 'open_id', 'user_nick', 'user_nick_encrypt', 'avatar', 'is_auth', 'is_new', 'pay_price', 'pay_num', 'login_token', 'user_state', 'is_member', 'is_member_before', 'is_favor', 'is_favor_before', 'relieve_date', 'create_date', 'modify_date', 'i1', 'i2', 'i3', 'i4', 'i5', 's1', 's2', 's3', 's4', 's5', 'd1', 'd2']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "user_info_tb"
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/task/task_log_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/stat/stat_orm_model.py`

 * *Files 22% similar despite different names*

```diff
@@ -1,61 +1,58 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-15 17:17:08
-@LastEditTime: 2023-05-18 14:32:11
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class TaskLogModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(TaskLogModel, self).__init__(TaskLog, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class TaskLog:
-
-    def __init__(self):
-        super(TaskLog, self).__init__()
-        self.id = 0  # id
-        self.app_id = ""  # 应用标识
-        self.act_id = 0  # 活动标识
-        self.module_id = 0  # 活动模块标识
-        self.user_id = 0  # 用户标识
-        self.open_id = ""  # open_id
-        self.user_nick = ""  # 昵称
-        self.log_title = ""  # 标题
-        self.info_json = ""  # 详情信息
-        self.task_type = 0  # 任务类型
-        self.task_sub_type = ""  # 任务子类型
-        self.task_name = ""  # 任务名称
-        self.reward_type = ""  # 奖励类型
-        self.reward_object_id = ""  # 奖励对象标识
-        self.reward_name = ""  # 奖励名称
-        self.reward_num = 0  # 奖励数量
-        self.handler_name = ""  # 接口名称
-        self.request_code = ""  # 请求代码
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.create_day = 0  # 创建天
-        self.i1 = 0  # i1
-        self.s1 = ""  # s1
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'app_id', 'act_id', 'module_id', 'user_id', 'open_id', 'user_nick', 'log_title', 'info_json', 'task_type', 'task_sub_type', 'task_name', 'reward_type', 'reward_object_id', 'reward_name', 'reward_num', 'handler_name', 'request_code', 'create_date', 'create_day', 'i1', 's1']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "task_log_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-26 09:40:36
+@LastEditTime: 2023-05-24 18:33:19
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class StatOrmModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(StatOrmModel, self).__init__(StatOrm, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class StatOrm:
+
+    def __init__(self):
+        super(StatOrm, self).__init__()
+        self.id = 0  # id
+        self.app_id = ""  # 应用标识
+        self.act_id = 0  # 活动标识
+        self.module_id = 0  # 活动模块标识
+        self.object_id = ""  # 对象标识
+        self.group_name = ""  # 分组名称
+        self.group_sub_name = ""  # 分组子名称
+        self.key_name = ""  # key名称
+        self.key_value = ""  # key值
+        self.tip_title = "" # 提示标题
+        self.value_type = 0 # 输出类型(1-int，2-decimal)
+        self.repeat_type = 0  # 去重方式(0不去重1当日去重2全部去重)
+        self.sort_index = 0  # 排序号
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.is_show = 0  # 是否显示(1是0否)
+        self.i1 = 0  # i1
+        self.i2 = 0  # i2
+        self.s1 = ""  # s1
+        self.s2 = ""  # s2
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'app_id', 'act_id', 'module_id', 'object_id', 'group_name', 'group_sub_name', 'key_name', 'key_value', 'tip_title', 'value_type', 'repeat_type', 'sort_index', 'create_date', 'is_show', 'i1', 'i2', 's1', 's2']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "stat_orm_tb"
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/third/third_pay_order_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/user/user_account_model.py`

 * *Files 20% similar despite different names*

```diff
@@ -1,66 +1,60 @@
-
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-
-
-class ThirdPayOrderModel(BaseModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(ThirdPayOrderModel, self).__init__(ThirdPayOrder, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-    
-class ThirdPayOrder:
-
-    def __init__(self):
-        super(ThirdPayOrder, self).__init__()
-        self.id = 0  # id
-        self.ascription_type = 0  # 归属类型（0-抽奖次数订单1-邮费次数订单2-任务订单）
-        self.app_id = ""  # 应用标识
-        self.act_id = 0  # 活动标识
-        self.user_id = 0  # 用户标识
-        self.open_id = ""  # open_id
-        self.user_nick = ""  # 用户昵称
-        self.goods_code = ""  # 商品编码
-        self.goods_name = ""  # 商品名称
-        self.sku_id = ""  # sku_id
-        self.sku_name = ""  # sku_name
-        self.buy_num = 0  # 购买数量
-        self.pay_price = 0  # 购买金额
-        self.main_pay_order_no = ""  # 第三方主订单号
-        self.sub_pay_order_no = ""  # 第三方子订单号
-        self.order_status = ""  # 订单状态
-        self.asset_type = 0  # 资产类型(1-次数2-积分3-价格档位)
-        self.asset_object_id = ""  # 资产对象标识
-        self.surplus_count = 0  # 剩余资产值
-        self.prize_ids = ""  # 奖品ID列表（逗号隔开）
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.pay_date = "1900-01-01 00:00:00"  # 支付时间
-        self.i1 = 0  # i1
-        self.i2 = 0  # i2
-        self.i3 = 0  # i3
-        self.i4 = 0  # i4
-        self.i5 = 0  # i5
-        self.s1 = ""  # s1
-        self.s2 = ""  # s2
-        self.s3 = ""  # s3
-        self.s4 = ""  # s4
-        self.s5 = ""  # s5
-        self.d1 = "1900-01-01 00:00:00"  # d1
-        self.d2 = "1900-01-01 00:00:00"  # d2
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'ascription_type', 'app_id', 'act_id', 'user_id', 'open_id', 'user_nick', 'goods_code', 'goods_name', 'sku_id', 'sku_name', 'buy_num', 'pay_price', 'main_pay_order_no', 'sub_pay_order_no', 'order_status', 'asset_type', 'asset_object_id', 'surplus_count', 'prize_ids', 'create_date', 'pay_date', 'i1', 'i2', 'i3', 'i4', 'i5', 's1', 's2', 's3', 's4', 's5', 'd1', 'd2']
-        
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "third_pay_order_tb"
-    
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-22 10:59:39
+@LastEditTime: 2022-07-20 14:11:07
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class UserAccountModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(UserAccountModel, self).__init__(UserAccount, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+
+class UserAccount:
+
+    def __init__(self):
+        super(UserAccount, self).__init__()
+        self.id = 0  # id
+        self.union_id = ""  # union_id
+        self.open_id = ""  # open_id
+        self.user_nick = ""  # 用户昵称
+        self.user_nick_encrypt = ""  # 昵称加密值
+        self.mix_nick = ""  # 混淆昵称
+        self.avatar = ""  # 头像
+        self.user_state = 0  # 用户状态（0-正常，1-黑名单）
+        self.full_name = ""  # 姓名
+        self.telephone = ""  #电话号码
+        self.sex = 0  #性别（1-男，2-女）
+        self.birthday = "1900-01-01"  #生日
+        self.certificate_type = 1  #证件类型(1身份证2军官证)
+        self.certificate_no = "" #证件号码
+        self.relieve_date = "1900-01-01 00:00:00"  # 解禁时间
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.create_ip = "" #创建IP
+        self.modify_date = "1900-01-01 00:00:00"  # 修改时间
+        self.login_date = "1900-01-01 00:00:00"  # 登录时间
+        self.login_ip = "" #登录IP
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'union_id', 'open_id', 'user_nick', 'user_nick_encrypt', 'mix_nick', 'avatar', 'user_state', 'full_name', 'telephone', 'sex', 'birthday', 'certificate_type', 'certificate_no', 'relieve_date', 'create_date', 'create_ip', 'modify_date', 'login_date', 'login_ip']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "user_account_tb"
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/user/user_account_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/task/task_info_model.py`

 * *Files 23% similar despite different names*

```diff
@@ -1,60 +1,57 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-22 10:59:39
-@LastEditTime: 2022-07-20 14:11:07
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class UserAccountModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(UserAccountModel, self).__init__(UserAccount, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-
-class UserAccount:
-
-    def __init__(self):
-        super(UserAccount, self).__init__()
-        self.id = 0  # id
-        self.union_id = ""  # union_id
-        self.open_id = ""  # open_id
-        self.user_nick = ""  # 用户昵称
-        self.user_nick_encrypt = ""  # 昵称加密值
-        self.mix_nick = ""  # 混淆昵称
-        self.avatar = ""  # 头像
-        self.user_state = 0  # 用户状态（0-正常，1-黑名单）
-        self.full_name = ""  # 姓名
-        self.telephone = ""  #电话号码
-        self.sex = 0  #性别（1-男，2-女）
-        self.birthday = "1900-01-01"  #生日
-        self.certificate_type = 1  #证件类型(1身份证2军官证)
-        self.certificate_no = "" #证件号码
-        self.relieve_date = "1900-01-01 00:00:00"  # 解禁时间
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.create_ip = "" #创建IP
-        self.modify_date = "1900-01-01 00:00:00"  # 修改时间
-        self.login_date = "1900-01-01 00:00:00"  # 登录时间
-        self.login_ip = "" #登录IP
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'union_id', 'open_id', 'user_nick', 'user_nick_encrypt', 'mix_nick', 'avatar', 'user_state', 'full_name', 'telephone', 'sex', 'birthday', 'certificate_type', 'certificate_no', 'relieve_date', 'create_date', 'create_ip', 'modify_date', 'login_date', 'login_ip']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "user_account_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-08-10 10:09:06
+@LastEditTime: 2021-08-12 10:11:20
+@LastEditors: HuangJianYi
+@Description: 
+"""
+
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class TaskInfoModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(TaskInfoModel, self).__init__(TaskInfo, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class TaskInfo:
+
+    def __init__(self):
+        super(TaskInfo, self).__init__()
+        self.id = 0  # 标识
+        self.app_id = ""  # 应用标识
+        self.act_id = 0  # 活动标识
+        self.module_id = 0  # 活动模块标识
+        self.complete_type = 0  # 完成类型(1-每日任务 2-每周任务 3-持久任务 4-每月任务)
+        self.task_name = ""  # 任务名称
+        self.task_type = 0  # 任务类型（公共枚举TaskType，业务继承公共枚举进行拓展）
+        self.config_json = ""  # 任务配置（json字符串，TaskType里面的注释都有详细例子）
+        self.sort_index = 0  # 排序
+        self.is_release = 0  # 是否发布
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.modify_date = "1900-01-01 00:00:00"  # 更新时间
+        self.route_url = ""  # 路由地址
+        self.i1 = 0  # i1
+        self.i2 = 0  # i2
+        self.s1 = ""  # s1
+        self.s2 = ""  # s2
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'app_id', 'act_id', 'module_id', 'complete_type', 'task_name', 'task_type', 'config_json', 'sort_index', 'is_release', 'create_date', 'modify_date', 'route_url', 'i1', 'i2', 's1', 's2']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "task_info_tb"
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/user/user_black_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/asset/asset_only_model.py`

 * *Files 22% similar despite different names*

```diff
@@ -1,53 +1,47 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-22 16:03:01
-@LastEditTime: 2021-07-29 18:39:05
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class UserBlackModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(UserBlackModel, self).__init__(UserBlack, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class UserBlack:
-
-    def __init__(self):
-        super(UserBlack, self).__init__()
-        self.id = 0  # 标识
-        self.app_id = ""  # 应用标识
-        self.act_id = 0  # 活动标识
-        self.user_id = 0  # 用户标识
-        self.open_id = ""  # open_id
-        self.user_nick = ""  # 用户昵称
-        self.black_type = 0  # 拉黑类型（1自动2手动）
-        self.reason = ""  # 申请原因
-        self.audit_status = 0  # 审核状态(0黑名单1申请中2同意3拒绝)
-        self.audit_remark = ""  # 审核备注
-        self.refund_count = 0  # 退款次数
-        self.refund_order_data = ""  # 退款主订单号(逗号分隔)
-        self.create_date = "1900-01-01 00:00:00"  # 申请时间
-        self.audit_date = "1900-01-01 00:00:00"  # 审核时间
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'app_id', 'act_id', 'user_id', 'open_id', 'user_nick', 'black_type', 'reason', 'audit_status', 'audit_remark', 'refund_count', 'refund_order_data', 'create_date', 'audit_date']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "user_black_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-15 17:17:08
+@LastEditTime: 2021-09-02 20:41:40
+@LastEditors: HuangJianYi
+@Description: 
+"""
+
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+class AssetOnlyModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(AssetOnlyModel, self).__init__(AssetOnly, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class AssetOnly:
+
+    def __init__(self):
+        super(AssetOnly, self).__init__()
+        self.id = 0  # id
+        self.id_md5 = 0  # id_md5(act_id+user_id+only_id)md5int生成
+        self.app_id = ""  # 应用标识
+        self.act_id = 0  # 活动ID
+        self.user_id = 0  # 用户标识
+        self.open_id = ""  # open_id
+        self.only_id = ""  # 唯一标识(用于并发操作时校验避免重复操作)
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'id_md5', 'app_id', 'act_id', 'user_id', 'open_id', 'only_id', 'create_date']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "asset_only_tb"
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/db_models/version/version_info_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/db_models/version/version_info_model.py`

 * *Ordering differences only*

 * *Files 16% similar despite different names*

```diff
@@ -1,42 +1,42 @@
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class VersionInfoModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(VersionInfoModel, self).__init__(VersionInfo, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class VersionInfo:
-
-    def __init__(self):
-        super(VersionInfo, self).__init__()
-        self.id = 0  # id
-        self.type_id = 0  # 类型（1消费者端2千牛端）
-        self.version_number = ""  # 更新版本号
-        self.is_force_update = 0  # 是否强制更新（1是0否）
-        self.content = ""  # 更新内容
-        self.update_scope = 0  # 更新范围(1-全部,会同步更新到baseinfo表2-指定用户) 取最新记录，如果指定用户取最新记录的值，否则取baseinfo表的值
-        self.white_lists = ""  # 更新白名单(多个逗号分隔)
-        self.is_release = 0  # 是否发布（1是0否）
-        self.release_date = "1900-01-01 00:00:00"  # 发布时间
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.modify_date = "1900-01-01 00:00:00"  # 更新时间
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'type_id', 'version_number', 'is_force_update', 'content', 'update_scope', 'white_lists', 'is_release', 'release_date', 'create_date', 'modify_date']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "version_info_tb"
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class VersionInfoModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(VersionInfoModel, self).__init__(VersionInfo, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class VersionInfo:
+
+    def __init__(self):
+        super(VersionInfo, self).__init__()
+        self.id = 0  # id
+        self.type_id = 0  # 类型（1消费者端2千牛端）
+        self.version_number = ""  # 更新版本号
+        self.is_force_update = 0  # 是否强制更新（1是0否）
+        self.content = ""  # 更新内容
+        self.update_scope = 0  # 更新范围(1-全部,会同步更新到baseinfo表2-指定用户) 取最新记录，如果指定用户取最新记录的值，否则取baseinfo表的值
+        self.white_lists = ""  # 更新白名单(多个逗号分隔)
+        self.is_release = 0  # 是否发布（1是0否）
+        self.release_date = "1900-01-01 00:00:00"  # 发布时间
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.modify_date = "1900-01-01 00:00:00"  # 更新时间
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'type_id', 'version_number', 'is_force_update', 'content', 'update_scope', 'white_lists', 'is_release', 'release_date', 'create_date', 'modify_date']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "version_info_tb"
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/enum.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/enum.py`

 * *Ordering differences only*

 * *Files 9% similar despite different names*

```diff
@@ -1,127 +1,127 @@
-# -*- coding: utf-8 -*-
-"""
-:Author: HuangJianYi
-:Date: 2020-06-02 14:32:40
-@LastEditTime: 2023-06-28 15:26:30
-@LastEditors: HuangJianYi
-:description: 枚举类
-"""
-
-from enum import Enum
-from enum import unique
-
-
-
-@unique
-class PlatType(Enum):
-    """
-    :description: 平台类型
-    """
-    tb = 1 #淘宝
-    wx = 2 #微信
-    dy = 3 #抖音
-    web = 4 #站点
-    jd = 5 #京东
-
-@unique
-class PageCountMode(Enum):
-    """
-    :description: 分页模式
-    """
-    none = 0 #无
-    total = 1 #总数
-    next = 2 #是否有下一页
-
-@unique
-class OperationType(Enum):
-    """
-    :description: 用户操作日志类型
-    """
-    add = 1 #新增
-    update = 2 #编辑
-    delete = 3 #删除
-    review = 4 #还原
-    copy = 5 #复制
-    export = 6 #导出
-    import_data = 7 #导入
-    release = 8 #上架
-    un_release = 9 #下架
-    operate = 10 #操作
-
-
-@unique
-class TaskRewardType(Enum):
-    """
-    :description: 任务奖励类型
-    """
-    asset = 1 #资产
-    prize = 2 #奖品
-    card = 3 #卡片
-
-@unique
-class TaskCompleteType(Enum):
-    """
-    :description: 任务完成类型
-    """
-    day = 1 #每日任务
-    week = 2 #每周任务
-    month = 4 #每月任务
-    long = 3 #持久任务
-
-@unique
-class TaskType(Enum):
-    """
-    docstring：任务类型 业务的自定义任务类型从201起
-    """
-    # 掌柜有礼、免费领取、新人有礼，格式：{"reward_value":0,"asset_object_id":""}  字段说明：reward_value:奖励值 asset_object_id:资产对象标识
-    free_gift = 1
-    # 单次签到，格式：{"reward_value":0,"asset_object_id":""}  字段说明：reward_value:奖励值 asset_object_id:资产对象标识
-    one_sign = 2
-    # 每周签到(指定天数签到)，格式：{"day_list":[{'day': 1, 'reward_value': 1}, {'day': 2, 'reward_value': 1}, {'day': 3, 'reward_value': 1}, {'day': 4, 'reward_value': 1}, {'day': 5, 'reward_value': 1}, {'day': 6, 'reward_value': 1}, {'day': 7, 'reward_value': 1}],"asset_object_id":""}  字段说明：day_array:每天奖励配置列表 asset_object_id:资产对象标识
-    weekly_sign = 3
-    # 邀请新用户，格式：{"reward_value":0,"satisfy_num":1,"limit_num":0,"asset_object_id":""} 字段说明：reward_value:奖励值 satisfy_num:满足数 limit_num:完成限制数 asset_object_id:资产对象标识
-    invite_new_user = 4
-    # 邀请入会，格式：{"reward_value":0,"satisfy_num":1,"limit_num":0,"asset_object_id":""}  字段说明：reward_value:奖励值 satisfy_num:满足数 limit_num:完成限制数 asset_object_id:资产对象标识
-    invite_join_member = 5
-    # 关注店铺，格式：{"reward_value":0,"once_favor_reward":0,"asset_object_id":""} 字段说明：reward_value:奖励值 once_favor_reward:已关注是否奖励1是0否 asset_object_id:资产对象标识
-    favor_store = 6
-    # 加入店铺会员，格式：{"reward_value":0,"once_member_reward":0,"asset_object_id":""} 字段说明：reward_value:奖励值 once_member_reward:已入会是否奖励1是0否 asset_object_id:资产对象标识
-    join_member = 7
-    # 收藏商品，格式：{"reward_value":0,"satisfy_num":1,"limit_num":0,"goods_ids":"","goods_list":[],"asset_object_id":""} 字段说明：reward_value:奖励值 satisfy_num:满足数 asset_object_id:资产对象标识 limit_num:完成限制数 goods_ids:商品ID串 goods_list:商品列表
-    collect_goods = 8
-    # 浏览商品，格式：{"reward_value":0,"satisfy_num":1,"limit_num":0,"goods_ids":"","goods_list":[],"asset_object_id":""} 字段说明：reward_value:奖励值 satisfy_num:满足数 asset_object_id:资产对象标识 limit_num:完成限制数 goods_ids:商品ID串 goods_list:商品列表
-    browse_goods = 9
-    # 浏览店铺(进店逛逛)，格式：{"reward_value":0,"satisfy_num":1,"limit_num":0,"asset_object_id":""} 或者 [{"id":1,"reward_value":0,"satisfy_num":1,"limit_num":0,"asset_object_id":""}] 字段说明：reward_value:奖励值 satisfy_num:满足数 limit_num:完成限制数 asset_object_id:资产对象标识
-    browse_store = 10
-    # 浏览直播间(观看直播间)，格式：{"reward_value":0,"satisfy_num":1,"limit_num":0,"link_url":"","asset_object_id":""} 或者 [{"id":1,"reward_value":0,"satisfy_num":1,"limit_num":0,"link_url":"","asset_object_id":""}] 字段说明：reward_value:奖励值 link_url:链接地址 satisfy_num:满足数 limit_num:完成限制数 asset_object_id:资产对象标识
-    browse_live_room = 11
-    # 浏览会场/专题，格式：[{"id":"","reward_value":0,"link_url":"","satisfy_num":1,"limit_num":1,"asset_object_id":""}] 字段说明：id:子任务类型,必填 reward_value:奖励值 satisfy_num:满足数  link_url:链接地址 asset_object_id:资产对象标识 limit_num:完成限制数
-    browse_special_topic = 12
-    # 累计签到，格式：{"day_list":[{'day': 1, 'reward_value': 1}, {'day': 2, 'reward_value': 1}],"asset_object_id":""} 字段说明： day_list:每天奖励配置列表 asset_object_id:资产对象标识
-    cumulative_sign = 13
-    # 分享，格式：{"reward_value":0,"satisfy_num":1,"limit_num":0,"asset_object_id":""} 字段说明：reward_value:奖励值 satisfy_num:满足数 limit_num:完成限制数 asset_object_id:资产对象标识
-    share = 14
-    # 邀请用户助力(不判断是否新用户，可重复邀请)，格式：{"reward_value":0,"satisfy_num":1,"limit_num":0,"asset_object_id":""} 字段说明：reward_value:奖励值 satisfy_num:满足数 limit_num:完成限制数 asset_object_id:资产对象标识
-    invite_user_help = 15
-    # 神秘暗号，格式：{"reward_value":0,"secret_code":"","asset_object_id":""} 字段说明：reward_value:奖励值 secret_code:暗号 asset_object_id:资产对象标识
-    secret_code = 16
-    # 店铺会员积分兑换资产，格式：{"reward_value":1,"satisfy_num":1,"limit_num":1} 字段说明：reward_value:奖励值 satisfy_num:需要的积分 limit_num:完成限制数
-    crm_point_exchange_asset = 17
-    # 连续签到（天数是连续递增），格式：{"day_list":[{'day': 1, 'reward_value': 1}, {'day': 2, 'reward_value': 1}],"asset_object_id":""} 字段说明： day_list:每天奖励配置列表 asset_object_id:资产对象标识
-    successive_sign = 18
-    # 购买指定商品，格式：{"reward_value":0,"satisfy_num":1,"limit_num":0,"goods_ids":"","goods_list":[],"asset_object_id":""} 字段说明：reward_value:奖励值 satisfy_num:满足数 asset_object_id:资产对象标识 limit_num:完成限制数 goods_ids:商品ID串 goods_list:商品列表
-    buy_appoint_goods = 19
-    # 购买指定商品每多少金额，格式：{"reward_value":0,"satisfy_num":1,"limit_num":0,"goods_ids":"","goods_list":[],"asset_object_id":""} 字段说明：reward_value:奖励值 satisfy_num:满足数 asset_object_id:资产对象标识 limit_num:完成限制数 goods_ids:商品ID串 goods_list:商品列表
-    buy_appoint_goods_price = 20
-    # 购买指定商品档位金额任务，格式：{"gear_list":[{"id":1,"gear":0,"reward_type":1,"reward_name":"","asset_object_id":"","reward_value":1}],"goods_ids":"","goods_list":[]} 字段说明：id:前端生成的唯一标识 gear:档位阀值 reward_value:奖励值(等于0无法领取) reward_type:奖励类型 reward_name:奖励奖品名称 asset_object_id:对象标识(如果奖励类型是资产对应资产对象标识，如果是奖品对应奖品标识，如果是卡片对应卡片标识) goods_ids:商品ID串 goods_list:商品列表
-    buy_appoint_goods_price_gear = 21
-    # 购买全店商品每多少金额，格式：{"reward_value":0,"satisfy_num":1,"limit_num":0,"goods_ids":"","goods_list":[],"asset_object_id":""} 字段说明：reward_value:奖励值 satisfy_num:满足数 asset_object_id:资产对象标识 limit_num:完成限制数 goods_ids:排除的商品ID串 goods_list:排除的商品列表
-    buy_store_price = 22
-    # 购买全店商品档位金额任务，格式：{"gear_list":[{"id":1,"gear":0,"reward_type":1,"reward_name":"","asset_object_id":"","reward_value":1}]} 字段说明：id:前端生成的唯一标识 gear:档位阀值 reward_value:奖励值(等于0无法领取) reward_type:奖励类型 reward_name:奖励奖品名称 asset_object_id:对象标识(如果奖励类型是资产对应资产对象标识，如果是奖品对应奖品标识，如果是卡片对应卡片标识)  goods_ids:排除的商品ID串 goods_list:排除的商品列表
-    buy_store_price_gear = 23
-    # 每多少次抽盒/抽包/抽奖，格式：{"reward_value":0,"satisfy_num":1,"limit_num":0,"asset_object_id":""}  字段说明：reward_value:奖励值 satisfy_num:满足数（当大于1时才需要配置字段） limit_num:完成限制数 asset_object_id:资产对象标识
-    lottery = 24
-    #试抽，格式：{"reward_value":0,"limit_num":0,"asset_object_id":""}  字段说明：reward_value:奖励值 satisfy_num:满足数（当大于1时才需要配置字段） limit_num:完成限制数 asset_object_id:资产对象标识
-    lottery_try = 25
-    # 抽盒/抽包-档位任务，格式：{"gear_list":[{"id":1,"gear":0,"reward_type":1,"reward_name":"","asset_object_id":"","reward_value":1}]} 字段说明：id:前端生成的唯一标识 gear:档位阀值 reward_value:奖励值(等于0无法领取) reward_type:奖励类型 reward_name:奖励奖品名称 asset_object_id:对象标识(如果奖励类型是资产对应资产对象标识，如果是奖品对应奖品标识，如果是卡片对应卡片标识)
-    lottery_gear = 26
+# -*- coding: utf-8 -*-
+"""
+:Author: HuangJianYi
+:Date: 2020-06-02 14:32:40
+@LastEditTime: 2023-06-28 15:26:30
+@LastEditors: HuangJianYi
+:description: 枚举类
+"""
+
+from enum import Enum
+from enum import unique
+
+
+
+@unique
+class PlatType(Enum):
+    """
+    :description: 平台类型
+    """
+    tb = 1 #淘宝
+    wx = 2 #微信
+    dy = 3 #抖音
+    web = 4 #站点
+    jd = 5 #京东
+
+@unique
+class PageCountMode(Enum):
+    """
+    :description: 分页模式
+    """
+    none = 0 #无
+    total = 1 #总数
+    next = 2 #是否有下一页
+
+@unique
+class OperationType(Enum):
+    """
+    :description: 用户操作日志类型
+    """
+    add = 1 #新增
+    update = 2 #编辑
+    delete = 3 #删除
+    review = 4 #还原
+    copy = 5 #复制
+    export = 6 #导出
+    import_data = 7 #导入
+    release = 8 #上架
+    un_release = 9 #下架
+    operate = 10 #操作
+
+
+@unique
+class TaskRewardType(Enum):
+    """
+    :description: 任务奖励类型
+    """
+    asset = 1 #资产
+    prize = 2 #奖品
+    card = 3 #卡片
+
+@unique
+class TaskCompleteType(Enum):
+    """
+    :description: 任务完成类型
+    """
+    day = 1 #每日任务
+    week = 2 #每周任务
+    month = 4 #每月任务
+    long = 3 #持久任务
+
+@unique
+class TaskType(Enum):
+    """
+    docstring：任务类型 业务的自定义任务类型从201起
+    """
+    # 掌柜有礼、免费领取、新人有礼，格式：{"reward_value":0,"asset_object_id":""}  字段说明：reward_value:奖励值 asset_object_id:资产对象标识
+    free_gift = 1
+    # 单次签到，格式：{"reward_value":0,"asset_object_id":""}  字段说明：reward_value:奖励值 asset_object_id:资产对象标识
+    one_sign = 2
+    # 每周签到(指定天数签到)，格式：{"day_list":[{'day': 1, 'reward_value': 1}, {'day': 2, 'reward_value': 1}, {'day': 3, 'reward_value': 1}, {'day': 4, 'reward_value': 1}, {'day': 5, 'reward_value': 1}, {'day': 6, 'reward_value': 1}, {'day': 7, 'reward_value': 1}],"asset_object_id":""}  字段说明：day_array:每天奖励配置列表 asset_object_id:资产对象标识
+    weekly_sign = 3
+    # 邀请新用户，格式：{"reward_value":0,"satisfy_num":1,"limit_num":0,"asset_object_id":""} 字段说明：reward_value:奖励值 satisfy_num:满足数 limit_num:完成限制数 asset_object_id:资产对象标识
+    invite_new_user = 4
+    # 邀请入会，格式：{"reward_value":0,"satisfy_num":1,"limit_num":0,"asset_object_id":""}  字段说明：reward_value:奖励值 satisfy_num:满足数 limit_num:完成限制数 asset_object_id:资产对象标识
+    invite_join_member = 5
+    # 关注店铺，格式：{"reward_value":0,"once_favor_reward":0,"asset_object_id":""} 字段说明：reward_value:奖励值 once_favor_reward:已关注是否奖励1是0否 asset_object_id:资产对象标识
+    favor_store = 6
+    # 加入店铺会员，格式：{"reward_value":0,"once_member_reward":0,"asset_object_id":""} 字段说明：reward_value:奖励值 once_member_reward:已入会是否奖励1是0否 asset_object_id:资产对象标识
+    join_member = 7
+    # 收藏商品，格式：{"reward_value":0,"satisfy_num":1,"limit_num":0,"goods_ids":"","goods_list":[],"asset_object_id":""} 字段说明：reward_value:奖励值 satisfy_num:满足数 asset_object_id:资产对象标识 limit_num:完成限制数 goods_ids:商品ID串 goods_list:商品列表
+    collect_goods = 8
+    # 浏览商品，格式：{"reward_value":0,"satisfy_num":1,"limit_num":0,"goods_ids":"","goods_list":[],"asset_object_id":""} 字段说明：reward_value:奖励值 satisfy_num:满足数 asset_object_id:资产对象标识 limit_num:完成限制数 goods_ids:商品ID串 goods_list:商品列表
+    browse_goods = 9
+    # 浏览店铺(进店逛逛)，格式：{"reward_value":0,"satisfy_num":1,"limit_num":0,"asset_object_id":""} 或者 [{"id":1,"reward_value":0,"satisfy_num":1,"limit_num":0,"asset_object_id":""}] 字段说明：reward_value:奖励值 satisfy_num:满足数 limit_num:完成限制数 asset_object_id:资产对象标识
+    browse_store = 10
+    # 浏览直播间(观看直播间)，格式：{"reward_value":0,"satisfy_num":1,"limit_num":0,"link_url":"","asset_object_id":""} 或者 [{"id":1,"reward_value":0,"satisfy_num":1,"limit_num":0,"link_url":"","asset_object_id":""}] 字段说明：reward_value:奖励值 link_url:链接地址 satisfy_num:满足数 limit_num:完成限制数 asset_object_id:资产对象标识
+    browse_live_room = 11
+    # 浏览会场/专题，格式：[{"id":"","reward_value":0,"link_url":"","satisfy_num":1,"limit_num":1,"asset_object_id":""}] 字段说明：id:子任务类型,必填 reward_value:奖励值 satisfy_num:满足数  link_url:链接地址 asset_object_id:资产对象标识 limit_num:完成限制数
+    browse_special_topic = 12
+    # 累计签到，格式：{"day_list":[{'day': 1, 'reward_value': 1}, {'day': 2, 'reward_value': 1}],"asset_object_id":""} 字段说明： day_list:每天奖励配置列表 asset_object_id:资产对象标识
+    cumulative_sign = 13
+    # 分享，格式：{"reward_value":0,"satisfy_num":1,"limit_num":0,"asset_object_id":""} 字段说明：reward_value:奖励值 satisfy_num:满足数 limit_num:完成限制数 asset_object_id:资产对象标识
+    share = 14
+    # 邀请用户助力(不判断是否新用户，可重复邀请)，格式：{"reward_value":0,"satisfy_num":1,"limit_num":0,"asset_object_id":""} 字段说明：reward_value:奖励值 satisfy_num:满足数 limit_num:完成限制数 asset_object_id:资产对象标识
+    invite_user_help = 15
+    # 神秘暗号，格式：{"reward_value":0,"secret_code":"","asset_object_id":""} 字段说明：reward_value:奖励值 secret_code:暗号 asset_object_id:资产对象标识
+    secret_code = 16
+    # 店铺会员积分兑换资产，格式：{"reward_value":1,"satisfy_num":1,"limit_num":1} 字段说明：reward_value:奖励值 satisfy_num:需要的积分 limit_num:完成限制数
+    crm_point_exchange_asset = 17
+    # 连续签到（天数是连续递增），格式：{"day_list":[{'day': 1, 'reward_value': 1}, {'day': 2, 'reward_value': 1}],"asset_object_id":""} 字段说明： day_list:每天奖励配置列表 asset_object_id:资产对象标识
+    successive_sign = 18
+    # 购买指定商品，格式：{"reward_value":0,"satisfy_num":1,"limit_num":0,"goods_ids":"","goods_list":[],"asset_object_id":""} 字段说明：reward_value:奖励值 satisfy_num:满足数 asset_object_id:资产对象标识 limit_num:完成限制数 goods_ids:商品ID串 goods_list:商品列表
+    buy_appoint_goods = 19
+    # 购买指定商品每多少金额，格式：{"reward_value":0,"satisfy_num":1,"limit_num":0,"goods_ids":"","goods_list":[],"asset_object_id":""} 字段说明：reward_value:奖励值 satisfy_num:满足数 asset_object_id:资产对象标识 limit_num:完成限制数 goods_ids:商品ID串 goods_list:商品列表
+    buy_appoint_goods_price = 20
+    # 购买指定商品档位金额任务，格式：{"gear_list":[{"id":1,"gear":0,"reward_type":1,"reward_name":"","asset_object_id":"","reward_value":1}],"goods_ids":"","goods_list":[]} 字段说明：id:前端生成的唯一标识 gear:档位阀值 reward_value:奖励值(等于0无法领取) reward_type:奖励类型 reward_name:奖励奖品名称 asset_object_id:对象标识(如果奖励类型是资产对应资产对象标识，如果是奖品对应奖品标识，如果是卡片对应卡片标识) goods_ids:商品ID串 goods_list:商品列表
+    buy_appoint_goods_price_gear = 21
+    # 购买全店商品每多少金额，格式：{"reward_value":0,"satisfy_num":1,"limit_num":0,"goods_ids":"","goods_list":[],"asset_object_id":""} 字段说明：reward_value:奖励值 satisfy_num:满足数 asset_object_id:资产对象标识 limit_num:完成限制数 goods_ids:排除的商品ID串 goods_list:排除的商品列表
+    buy_store_price = 22
+    # 购买全店商品档位金额任务，格式：{"gear_list":[{"id":1,"gear":0,"reward_type":1,"reward_name":"","asset_object_id":"","reward_value":1}]} 字段说明：id:前端生成的唯一标识 gear:档位阀值 reward_value:奖励值(等于0无法领取) reward_type:奖励类型 reward_name:奖励奖品名称 asset_object_id:对象标识(如果奖励类型是资产对应资产对象标识，如果是奖品对应奖品标识，如果是卡片对应卡片标识)  goods_ids:排除的商品ID串 goods_list:排除的商品列表
+    buy_store_price_gear = 23
+    # 每多少次抽盒/抽包/抽奖，格式：{"reward_value":0,"satisfy_num":1,"limit_num":0,"asset_object_id":""}  字段说明：reward_value:奖励值 satisfy_num:满足数（当大于1时才需要配置字段） limit_num:完成限制数 asset_object_id:资产对象标识
+    lottery = 24
+    #试抽，格式：{"reward_value":0,"limit_num":0,"asset_object_id":""}  字段说明：reward_value:奖励值 satisfy_num:满足数（当大于1时才需要配置字段） limit_num:完成限制数 asset_object_id:资产对象标识
+    lottery_try = 25
+    # 抽盒/抽包-档位任务，格式：{"gear_list":[{"id":1,"gear":0,"reward_type":1,"reward_name":"","asset_object_id":"","reward_value":1}]} 字段说明：id:前端生成的唯一标识 gear:档位阀值 reward_value:奖励值(等于0无法领取) reward_type:奖励类型 reward_name:奖励奖品名称 asset_object_id:对象标识(如果奖励类型是资产对应资产对象标识，如果是奖品对应奖品标识，如果是卡片对应卡片标识)
+    lottery_gear = 26
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/frame_base_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/frame_base_model.py`

 * *Ordering differences only*

 * *Files 14% similar despite different names*

```diff
@@ -1,536 +1,536 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-08-11 09:10:33
-@LastEditTime: 2023-05-16 12:53:21
-@LastEditors: HuangJianYi
-@Description: 
-"""
-from seven_cloudapp_frame.libs.customize.seven_helper import *
-from seven_cloudapp_frame.libs.common import *
-from seven_cloudapp_frame.models.seven_model import *
-from seven_cloudapp_frame.models.db_models.act.act_info_model import *
-from seven_cloudapp_frame.models.db_models.act.act_module_model import *
-from seven_cloudapp_frame.models.db_models.user.user_info_model import *
-from seven_framework import *
-
-class FrameBaseModel():
-    """
-    :description: 框架业务模型 用于被其他业务模型继承，调用模型之间通用的方法
-    """
-    def __init__(self, context=None):
-        self.context = context
-        self.acquire_lock_name = ""
-        self.identifier = ""
-        self.request_queue_name = ""
-        self.handler_name = ""
-        self.act_id = 0
-        self.module_id = 0
-        self.user_id = 0
-        self.source_object_id = ""
-
-    def score_algorithm_to_score(self, weight):
-        """
-        :description: 分数算法，获取分数 = 权重 * 分数因子 + 时间极大值  - 当前时间
-        :param weight:权重值
-        :return: 分数
-        :last_editors: HuangJianYi
-        """
-        score_fator = 1_000_000_000 #分数因子
-        max_timestamp = 2_000_000_000 #时间极大值，秒级别
-        score = weight * score_fator + max_timestamp - TimeHelper.get_now_timestamp()
-        return score
-
-    def score_algorithm_to_weight(self, score):
-        """
-        :description: 分数算法，获取分数对应的权重值
-        :param score:分数
-        :return: 权重值
-        :last_editors: HuangJianYi
-        """
-        score_fator = 1_000_000_000
-        return int(score/score_fator)
-
-    def lottery_algorithm_chance(self, prize_list, field_name="chance"):
-        """
-        :description: 抽奖算法（概率）
-        :param prize_list:奖品列表
-        :param field_name:字段名称
-        :return: 中奖的奖品
-        :last_editors: HuangJianYi
-        """
-        init_value = 0.00
-        probability_list = []
-        for prize in prize_list:
-            current_prize = prize
-            current_prize["start_probability"] = init_value
-            current_prize["end_probability"] = init_value + float(prize[field_name])
-            probability_list.append(current_prize)
-            init_value = init_value + float(prize[field_name])
-        prize_index = random.uniform(0.00, init_value)
-        for prize in probability_list:
-            if (prize["start_probability"] <= prize_index and prize_index < prize["end_probability"]):
-                return prize
-
-    def lottery_algorithm_probability(self, prize_list, field_name="probability"):
-        """
-        :description: 抽奖算法（权重）
-        :param prize_list:奖品列表
-        :param field_name:字段名称
-        :return: 中奖的奖品
-        :last_editors: HuangJianYi
-        """
-        init_value = 0
-        probability_list = []
-        for prize in prize_list:
-            current_prize = prize
-            current_prize["start_probability"] = init_value
-            current_prize["end_probability"] = init_value + prize[field_name]
-            probability_list.append(current_prize)
-            init_value = init_value + prize[field_name]
-        prize_index = random.randint(0, init_value - 1)
-        for prize in probability_list:
-            if (prize["start_probability"] <= prize_index and prize_index < prize["end_probability"]):
-                return prize
-
-    def rewards_status(self):
-        """
-        :description: 给予奖励的子订单状态
-        :param 
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        status = [
-            #等待卖家发货
-            "WAIT_SELLER_SEND_GOODS",
-            #卖家部分发货
-            "SELLER_CONSIGNED_PART",
-            #等待买家确认收货
-            "WAIT_BUYER_CONFIRM_GOODS",
-            #买家已签收（货到付款专用）
-            "TRADE_BUYER_SIGNED",
-            #交易成功
-            "TRADE_FINISHED"
-        ]
-        return status
-
-    def refund_status(self):
-        """
-        :description: 给予奖励的子订单退款状态
-        :param 
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        status = [
-            #没有退款
-            "NO_REFUND",
-            #退款关闭
-            "CLOSED",
-            #卖家拒绝退款
-            "WAIT_SELLER_AGREE"
-        ]
-        return status
-
-    def get_order_status_name(self, order_status):
-        """
-        :description: 获取订单状态名称 -1未付款-2付款中0未发货1已发货2不予发货3已退款4交易成功
-        :param order_status：订单状态
-        :return 订单状态名称
-        :last_editors: HuangJianYi
-        """
-        if order_status == -1:
-            return "未付款"
-        elif order_status == -2:
-            return "付款中"
-        elif order_status == 0:
-            return "未发货"
-        elif order_status == 1:
-            return "已发货"
-        elif order_status == 2:
-            return "不予发货"
-        elif order_status == 3:
-            return "已退款"
-        else:
-            return "交易成功"
-
-    def get_business_sub_table(self, table_name, param_dict):
-        """
-        :description: 获取分表名称(目前框架支持的分表prize_order_tb、prize_roster_tb、stat_log_tb、task_count_tb、user_asset_tb、asset_log_tb、user_info_tb)
-        :param table_name:表名
-        :param param_dict:参数字典
-        :return:
-        :last_editors: HuangJianYi
-        """
-        if not param_dict or not table_name:
-            return None    
-        sub_table_config = share_config.get_value("sub_table_config",{})
-        table_config = sub_table_config.get(table_name, None)
-        if not table_config:
-            return None
-        return SevenHelper.get_sub_table(param_dict.get("app_id", 0), table_config.get("sub_count", 10))
-        
-    def process_malice_request(self, handler_name, user_id, ip="", user_request_limit_num=30, ip_request_limit_num=30, cycle_type=1, limit_request_time=24):
-        """
-        :description: 处理恶意请求
-        :param handler_name:接口名称
-        :param user_id:用户标识
-        :param ip:用户ip
-        :param user_request_limit_num:用户请求上限数
-        :param ip_request_limit_num:ip请求上限数
-        :param cycle_type:累计周期类型(1-每分钟 2-每小时 3-每天)
-        :param limit_request_time:限制请求时间(单位小时)
-        :return:InvokeResultData
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        if (not user_id and not ip) or not handler_name:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "param_error"
-            invoke_result_data.error_message = "参数不能为空或等于0"
-            return invoke_result_data
-        redis_init = SevenHelper.redis_init()
-        if user_id:
-            objectid_key = f"malice_request:objectid_1_{handler_name}_{user_id}"
-            count_key = f"malice_request:count_1_{handler_name}_{user_id}"
-            objectid_value = redis_init.get(objectid_key)
-            if objectid_value:
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "malice_request_1"
-                invoke_result_data.error_message = "异常操作请稍后再试"
-                return invoke_result_data
-            count_value = redis_init.get(count_key)
-            count_value = int(count_value) if count_value else 0
-            if count_value >= user_request_limit_num:
-                redis_init.set(objectid_key, 1, limit_request_time * 60 * 60)
-            redis_init.incr(count_key, 1)
-            if cycle_type == 1:
-                redis_init.expire(count_key, 60)
-            elif cycle_type == 2:
-                redis_init.expire(count_key, 60*60)
-            else:
-                redis_init.expire(count_key, 24*60*60)
-        if ip:
-            objectid_key = f"malice_request:objectid_2_{handler_name}_{ip}"
-            count_key = f"malice_request:count_2_{handler_name}_{ip}"
-            objectid_value = redis_init.get(objectid_key)
-            if objectid_value:
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "malice_request_2"
-                invoke_result_data.error_message = "异常操作请稍后再试"
-                return invoke_result_data
-            count_value = redis_init.get(count_key)
-            count_value = int(count_value) if count_value else 0
-            if count_value >= ip_request_limit_num:
-                redis_init.set(objectid_key, 1, limit_request_time * 60 * 60)
-            redis_init.incr(count_key, 1)
-            if cycle_type == 1:
-                redis_init.expire(count_key, 60)
-            elif cycle_type == 2:
-                redis_init.expire(count_key, 60*60)
-            else:
-                redis_init.expire(count_key, 24*60*60)
-        return invoke_result_data
-    
-    def check_act_info(self, act_id, check_release=True):
-        """
-        :description: 检验活动信息
-        :param act_id:活动标识
-        :param check_release:校验活动信息发布
-        :return:invoke_result_data
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        act_info_model = ActInfoModel(context=self.context)
-        act_info_dict = act_info_model.get_cache_dict_by_id(act_id,dependency_key=DependencyKey.act_info(act_id))
-        if not act_info_dict or act_info_dict["is_del"] == 1:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "no_act"
-            invoke_result_data.error_message = "活动信息不存在"
-            return invoke_result_data
-        if check_release == True and act_info_dict["is_release"] == 0:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "no_act"
-            invoke_result_data.error_message = "活动已下架"
-            return invoke_result_data
-        now_date = SevenHelper.get_now_datetime()
-        act_info_dict["start_date"] = str(act_info_dict["start_date"])
-        act_info_dict["end_date"] = str(act_info_dict["end_date"])
-        if act_info_dict["start_date"] != "" and act_info_dict["start_date"] != "1900-01-01 00:00:00":
-            if now_date < act_info_dict["start_date"]:
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "error"
-                invoke_result_data.error_message = "活动将在" + act_info_dict['start_date'] + "开启"
-                return invoke_result_data
-        if act_info_dict["end_date"] != "" and act_info_dict["end_date"] != "1900-01-01 00:00:00":
-            if now_date > act_info_dict["end_date"]:
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "error"
-                invoke_result_data.error_message = "活动已结束"
-                return invoke_result_data
-        invoke_result_data.data = act_info_dict
-        return invoke_result_data
-
-    def check_act_module(self, module_id, check_release=True):
-        """
-        :description: 检验活动模块
-        :param module_id:活动模块标识
-        :param check_release:校验活动信息发布
-        :return:invoke_result_data
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        if module_id:
-            act_module_model = ActModuleModel(context=self.context)
-            act_module_dict = act_module_model.get_cache_dict_by_id(module_id,dependency_key=DependencyKey.act_module(module_id))
-            if not act_module_dict or act_module_dict["is_del"] == 1:
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "no_module"
-                invoke_result_data.error_message = "活动模块信息不存在"
-                return invoke_result_data
-            if check_release == True and act_module_dict["is_release"] == 0:
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "no_module"
-                invoke_result_data.error_message = "活动模块已下架"
-                return invoke_result_data
-            now_date = SevenHelper.get_now_datetime()
-            act_module_dict["start_date"] = str(act_module_dict["start_date"])
-            act_module_dict["end_date"] = str(act_module_dict["end_date"])
-            if act_module_dict["start_date"] != "" and act_module_dict["start_date"] != "1900-01-01 00:00:00":
-                if now_date < act_module_dict["start_date"]:
-                    invoke_result_data.success = False
-                    invoke_result_data.error_code = "error"
-                    invoke_result_data.error_message = "活动将在" + act_module_dict["start_date"] + "开启"
-                    return invoke_result_data
-            if act_module_dict["end_date"] != "" and act_module_dict["end_date"] != "1900-01-01 00:00:00":
-                if now_date > act_module_dict["end_date"]:
-                    invoke_result_data.success = False
-                    invoke_result_data.error_code = "error"
-                    invoke_result_data.error_message = "活动已结束"
-                    return invoke_result_data
-            invoke_result_data.data = act_module_dict
-        return invoke_result_data
-        
-    def check_user_info(self, app_id, act_id, user_id, login_token, check_new_user, check_user_nick):
-        """
-        :description: 检验用户信息
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param user_id:用户标识
-        :param login_token:访问令牌
-        :param check_new_user:是否新用户才能参与
-        :param check_user_nick:是否校验昵称为空
-        :return:invoke_result_data
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        user_info_model = UserInfoModel(sub_table=self.get_business_sub_table("user_info_tb",{"app_id":app_id}),context=self.context)
-        id_md5 = CryptoHelper.md5_encrypt_int(f"{act_id}_{user_id}")
-        user_info_dict = user_info_model.get_cache_dict("id_md5=%s", limit="1", params=[id_md5], dependency_key=DependencyKey.user_info(act_id,id_md5))
-        if not user_info_dict:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "no_user"
-            invoke_result_data.error_message = "用户信息不存在"
-            return invoke_result_data
-        if user_info_dict["app_id"] != app_id:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "no_power"
-            invoke_result_data.error_message = "用户信息不存在"
-            return invoke_result_data
-        if user_info_dict["user_state"] == 1:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "user_exception"
-            invoke_result_data.error_message = "账号异常,请联系客服处理"
-            return invoke_result_data
-        if check_new_user == True and user_info_dict["is_new"] == 0:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "不是新用户"
-            return invoke_result_data
-        if check_user_nick == True:
-            if not user_info_dict["user_nick"] and not user_info_dict["user_nick_encrypt"]:
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "no_authorize"
-                invoke_result_data.error_message = "对不起,请先授权"
-                return invoke_result_data
-        if login_token and user_info_dict["login_token"] != login_token:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "已在另一台设备登录,无法操作"
-            return invoke_result_data
-        invoke_result_data.data = user_info_dict
-        return invoke_result_data
-    
-    def check_request_queue(self, request_queue_name, user_id, request_limit_num, request_limit_time):
-        """
-        :description: 检验请求队列,用于流量削峰判断
-        :param request_queue_name:请求队列名称
-        :param user_id:用户标识
-        :param request_limit_num:请求限制数(指的是当前接口在指定时间内可以请求的次数，用于流量削峰，减少短时间内的大量请求)；0不限制
-        :param request_limit_time:请求限制时间；默认1秒
-        :return:invoke_result_data
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        if request_limit_num > 0  and request_limit_time > 0:
-            if SevenHelper.redis_check_llen(request_queue_name,request_limit_num) == True:
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "concurrent"
-                invoke_result_data.error_message = "当前人气火爆,请稍后再试"
-                return invoke_result_data
-            SevenHelper.redis_lpush(request_queue_name,user_id,request_limit_time)
-        return invoke_result_data
-    
-    def business_process_executing(self, app_id, act_id, module_id, user_id, login_token, handler_name, check_new_user=False, check_user_nick=True, continue_request_expire=5, acquire_lock_name="", request_limit_num=0, request_limit_time=1, source_object_id="",check_act_info=True,check_act_module=True,check_user_info=True,check_act_info_release=True,check_act_module_release=True):
-        """
-        :description: 业务执行前事件,核心业务如抽奖、做任务需要调用当前方法
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_id:用户标识
-        :param login_token:访问令牌
-        :param handler_name:接口名称
-        :param check_new_user:是否新用户才能参与
-        :param check_user_nick:是否校验昵称为空
-        :param continue_request_expire:连续请求过期时间，为0不进行校验，单位秒 
-        :param acquire_lock_name:分布式锁名称，为空则不开启分布式锁校验功能
-        :param request_limit_num:请求限制数(指的是当前接口在指定时间内可以请求的次数，用于流量削峰，减少短时间内的大量请求)；0不限制
-        :param request_limit_time:请求限制时间；默认1秒
-        :param source_object_id:来源对象标识
-        :param check_act_info:是否检验活动信息
-        :param check_act_module:是否检验活动模块信息
-        :param check_user_info:是否校验用户信息
-        :param check_act_info_release:校验活动信息是否发布
-        :param check_act_module_release:校验活动模块是否发布
-        :return:
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-
-        if not act_id or not user_id or not handler_name:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "param_error"
-            invoke_result_data.error_message = "参数不能为空或等于0"
-            return invoke_result_data
-
-        #请求太频繁限制
-        if continue_request_expire > 0:
-            continue_request_key = f"request_business_executing:{handler_name}_{act_id}_{module_id}_{user_id}"
-            if source_object_id:
-                continue_request_key += f"_{source_object_id}"
-            if SevenHelper.is_continue_request(continue_request_key, expire=continue_request_expire * 1000) == True:
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "error"
-                invoke_result_data.error_message = f"对不起,请{continue_request_expire}秒后再试"
-                return invoke_result_data
-        #校验活动
-        act_info_dict = None
-        if check_act_info == True:
-            invoke_result_data = self.check_act_info(act_id,check_act_info_release)
-            if invoke_result_data.success == False:
-                return invoke_result_data
-            act_info_dict = invoke_result_data.data
-            check_app_id = act_info_dict["app_id"]
-            invoke_result_data.data = None
-            if check_app_id != app_id:
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "error"
-                invoke_result_data.error_message = "非法操作"
-                return invoke_result_data
-        #校验活动模块
-        act_module_dict = None
-        if check_act_module == True and module_id > 0:
-            invoke_result_data = self.check_act_module(module_id,check_act_module_release)
-            if invoke_result_data.success == False:
-                return invoke_result_data
-            act_module_dict = invoke_result_data.data
-            check_app_id = act_module_dict["app_id"]
-            invoke_result_data.data = None
-            if check_app_id != app_id:
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "error"
-                invoke_result_data.error_message = "非法操作"
-                return invoke_result_data
-        #校验用户信息
-        user_info_dict = None
-        if check_user_info == True:
-            invoke_result_data = self.check_user_info(app_id,act_id,user_id,login_token,check_new_user,check_user_nick)
-            if invoke_result_data.success == False:
-                return invoke_result_data
-            user_info_dict = invoke_result_data.data
-            invoke_result_data.data = None
-        
-        #分布式锁名称存在才进行校验
-        identifier = ""
-        if acquire_lock_name:
-            acquire_lock_status, identifier = SevenHelper.redis_acquire_lock(acquire_lock_name)
-            if acquire_lock_status == False:
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "acquire_lock"
-                invoke_result_data.error_message = "当前人气火爆,请稍后再试"
-                return invoke_result_data
-        request_queue_name = ""
-        if request_limit_num > 0 and request_limit_time > 0:
-            request_queue_name = f"request_queue:{handler_name}_{act_id}_{module_id}"
-            invoke_result_data = self.check_request_queue(request_queue_name,user_id,request_limit_num,request_limit_time)
-            if invoke_result_data.success == False:
-                return invoke_result_data
-
-        invoke_result_data.data = {}
-        invoke_result_data.data["act_info_dict"] = act_info_dict
-        invoke_result_data.data["act_module_dict"] = act_module_dict
-        invoke_result_data.data["user_info_dict"] = user_info_dict
-        invoke_result_data.data["identifier"] = identifier
-        invoke_result_data.data["request_queue_name"] = request_queue_name
-        
-        self.acquire_lock_name = acquire_lock_name
-        self.identifier = identifier
-        self.request_queue_name = request_queue_name
-        self.handler_name = handler_name
-        self.act_id = act_id
-        self.module_id = module_id
-        self.user_id = user_id
-        self.source_object_id = source_object_id
-        
-        return invoke_result_data
-
-    def business_process_executed(self, act_id=0, module_id=0, user_id=0, handler_name="", acquire_lock_name="", identifier="", request_queue_name="", source_object_id=""):
-        """
-        :description: 业务执行后事件，调用了业务执行前事件需要调用当前方法,参数可以不传，默认用business_process_executing方法传递的参数
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_id:用户标识
-        :param handler_name:接口名称
-        :param acquire_lock_name:分布式锁名称
-        :param identifier:分布式锁标识
-        :param request_queue_name:请求队列名称
-        :param source_object_id:来源对象标识
-        :return:
-        :last_editors: HuangJianYi
-        """
-        if not acquire_lock_name:
-            acquire_lock_name = self.acquire_lock_name
-        if not identifier:
-            identifier = self.identifier
-        if not request_queue_name:
-            request_queue_name = self.request_queue_name
-        if not source_object_id:
-            source_object_id = self.source_object_id
-        if not handler_name:
-            handler_name = self.handler_name
-        if not act_id:
-            act_id = self.act_id
-        if not module_id:
-            module_id = self.module_id
-        if not user_id:
-            user_id = self.user_id
-             
-        continue_request_key = f"request_business_executing:{handler_name}_{act_id}_{module_id}_{user_id}"
-        if source_object_id:
-            continue_request_key += f"_{source_object_id}"
-        SevenHelper.redis_init().delete(continue_request_key)
-        if acquire_lock_name and identifier:
-            SevenHelper.redis_release_lock(acquire_lock_name,identifier)
-        if request_queue_name:
-            SevenHelper.redis_lpop(request_queue_name)
-
-
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-08-11 09:10:33
+@LastEditTime: 2023-05-16 12:53:21
+@LastEditors: HuangJianYi
+@Description: 
+"""
+from seven_cloudapp_frame.libs.customize.seven_helper import *
+from seven_cloudapp_frame.libs.common import *
+from seven_cloudapp_frame.models.seven_model import *
+from seven_cloudapp_frame.models.db_models.act.act_info_model import *
+from seven_cloudapp_frame.models.db_models.act.act_module_model import *
+from seven_cloudapp_frame.models.db_models.user.user_info_model import *
+from seven_framework import *
+
+class FrameBaseModel():
+    """
+    :description: 框架业务模型 用于被其他业务模型继承，调用模型之间通用的方法
+    """
+    def __init__(self, context=None):
+        self.context = context
+        self.acquire_lock_name = ""
+        self.identifier = ""
+        self.request_queue_name = ""
+        self.handler_name = ""
+        self.act_id = 0
+        self.module_id = 0
+        self.user_id = 0
+        self.source_object_id = ""
+
+    def score_algorithm_to_score(self, weight):
+        """
+        :description: 分数算法，获取分数 = 权重 * 分数因子 + 时间极大值  - 当前时间
+        :param weight:权重值
+        :return: 分数
+        :last_editors: HuangJianYi
+        """
+        score_fator = 1_000_000_000 #分数因子
+        max_timestamp = 2_000_000_000 #时间极大值，秒级别
+        score = weight * score_fator + max_timestamp - TimeHelper.get_now_timestamp()
+        return score
+
+    def score_algorithm_to_weight(self, score):
+        """
+        :description: 分数算法，获取分数对应的权重值
+        :param score:分数
+        :return: 权重值
+        :last_editors: HuangJianYi
+        """
+        score_fator = 1_000_000_000
+        return int(score/score_fator)
+
+    def lottery_algorithm_chance(self, prize_list, field_name="chance"):
+        """
+        :description: 抽奖算法（概率）
+        :param prize_list:奖品列表
+        :param field_name:字段名称
+        :return: 中奖的奖品
+        :last_editors: HuangJianYi
+        """
+        init_value = 0.00
+        probability_list = []
+        for prize in prize_list:
+            current_prize = prize
+            current_prize["start_probability"] = init_value
+            current_prize["end_probability"] = init_value + float(prize[field_name])
+            probability_list.append(current_prize)
+            init_value = init_value + float(prize[field_name])
+        prize_index = random.uniform(0.00, init_value)
+        for prize in probability_list:
+            if (prize["start_probability"] <= prize_index and prize_index < prize["end_probability"]):
+                return prize
+
+    def lottery_algorithm_probability(self, prize_list, field_name="probability"):
+        """
+        :description: 抽奖算法（权重）
+        :param prize_list:奖品列表
+        :param field_name:字段名称
+        :return: 中奖的奖品
+        :last_editors: HuangJianYi
+        """
+        init_value = 0
+        probability_list = []
+        for prize in prize_list:
+            current_prize = prize
+            current_prize["start_probability"] = init_value
+            current_prize["end_probability"] = init_value + prize[field_name]
+            probability_list.append(current_prize)
+            init_value = init_value + prize[field_name]
+        prize_index = random.randint(0, init_value - 1)
+        for prize in probability_list:
+            if (prize["start_probability"] <= prize_index and prize_index < prize["end_probability"]):
+                return prize
+
+    def rewards_status(self):
+        """
+        :description: 给予奖励的子订单状态
+        :param 
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        status = [
+            #等待卖家发货
+            "WAIT_SELLER_SEND_GOODS",
+            #卖家部分发货
+            "SELLER_CONSIGNED_PART",
+            #等待买家确认收货
+            "WAIT_BUYER_CONFIRM_GOODS",
+            #买家已签收（货到付款专用）
+            "TRADE_BUYER_SIGNED",
+            #交易成功
+            "TRADE_FINISHED"
+        ]
+        return status
+
+    def refund_status(self):
+        """
+        :description: 给予奖励的子订单退款状态
+        :param 
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        status = [
+            #没有退款
+            "NO_REFUND",
+            #退款关闭
+            "CLOSED",
+            #卖家拒绝退款
+            "WAIT_SELLER_AGREE"
+        ]
+        return status
+
+    def get_order_status_name(self, order_status):
+        """
+        :description: 获取订单状态名称 -1未付款-2付款中0未发货1已发货2不予发货3已退款4交易成功
+        :param order_status：订单状态
+        :return 订单状态名称
+        :last_editors: HuangJianYi
+        """
+        if order_status == -1:
+            return "未付款"
+        elif order_status == -2:
+            return "付款中"
+        elif order_status == 0:
+            return "未发货"
+        elif order_status == 1:
+            return "已发货"
+        elif order_status == 2:
+            return "不予发货"
+        elif order_status == 3:
+            return "已退款"
+        else:
+            return "交易成功"
+
+    def get_business_sub_table(self, table_name, param_dict):
+        """
+        :description: 获取分表名称(目前框架支持的分表prize_order_tb、prize_roster_tb、stat_log_tb、task_count_tb、user_asset_tb、asset_log_tb、user_info_tb)
+        :param table_name:表名
+        :param param_dict:参数字典
+        :return:
+        :last_editors: HuangJianYi
+        """
+        if not param_dict or not table_name:
+            return None    
+        sub_table_config = share_config.get_value("sub_table_config",{})
+        table_config = sub_table_config.get(table_name, None)
+        if not table_config:
+            return None
+        return SevenHelper.get_sub_table(param_dict.get("app_id", 0), table_config.get("sub_count", 10))
+        
+    def process_malice_request(self, handler_name, user_id, ip="", user_request_limit_num=30, ip_request_limit_num=30, cycle_type=1, limit_request_time=24):
+        """
+        :description: 处理恶意请求
+        :param handler_name:接口名称
+        :param user_id:用户标识
+        :param ip:用户ip
+        :param user_request_limit_num:用户请求上限数
+        :param ip_request_limit_num:ip请求上限数
+        :param cycle_type:累计周期类型(1-每分钟 2-每小时 3-每天)
+        :param limit_request_time:限制请求时间(单位小时)
+        :return:InvokeResultData
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        if (not user_id and not ip) or not handler_name:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "param_error"
+            invoke_result_data.error_message = "参数不能为空或等于0"
+            return invoke_result_data
+        redis_init = SevenHelper.redis_init()
+        if user_id:
+            objectid_key = f"malice_request:objectid_1_{handler_name}_{user_id}"
+            count_key = f"malice_request:count_1_{handler_name}_{user_id}"
+            objectid_value = redis_init.get(objectid_key)
+            if objectid_value:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "malice_request_1"
+                invoke_result_data.error_message = "异常操作请稍后再试"
+                return invoke_result_data
+            count_value = redis_init.get(count_key)
+            count_value = int(count_value) if count_value else 0
+            if count_value >= user_request_limit_num:
+                redis_init.set(objectid_key, 1, limit_request_time * 60 * 60)
+            redis_init.incr(count_key, 1)
+            if cycle_type == 1:
+                redis_init.expire(count_key, 60)
+            elif cycle_type == 2:
+                redis_init.expire(count_key, 60*60)
+            else:
+                redis_init.expire(count_key, 24*60*60)
+        if ip:
+            objectid_key = f"malice_request:objectid_2_{handler_name}_{ip}"
+            count_key = f"malice_request:count_2_{handler_name}_{ip}"
+            objectid_value = redis_init.get(objectid_key)
+            if objectid_value:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "malice_request_2"
+                invoke_result_data.error_message = "异常操作请稍后再试"
+                return invoke_result_data
+            count_value = redis_init.get(count_key)
+            count_value = int(count_value) if count_value else 0
+            if count_value >= ip_request_limit_num:
+                redis_init.set(objectid_key, 1, limit_request_time * 60 * 60)
+            redis_init.incr(count_key, 1)
+            if cycle_type == 1:
+                redis_init.expire(count_key, 60)
+            elif cycle_type == 2:
+                redis_init.expire(count_key, 60*60)
+            else:
+                redis_init.expire(count_key, 24*60*60)
+        return invoke_result_data
+    
+    def check_act_info(self, act_id, check_release=True):
+        """
+        :description: 检验活动信息
+        :param act_id:活动标识
+        :param check_release:校验活动信息发布
+        :return:invoke_result_data
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        act_info_model = ActInfoModel(context=self.context)
+        act_info_dict = act_info_model.get_cache_dict_by_id(act_id,dependency_key=DependencyKey.act_info(act_id))
+        if not act_info_dict or act_info_dict["is_del"] == 1:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "no_act"
+            invoke_result_data.error_message = "活动信息不存在"
+            return invoke_result_data
+        if check_release == True and act_info_dict["is_release"] == 0:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "no_act"
+            invoke_result_data.error_message = "活动已下架"
+            return invoke_result_data
+        now_date = SevenHelper.get_now_datetime()
+        act_info_dict["start_date"] = str(act_info_dict["start_date"])
+        act_info_dict["end_date"] = str(act_info_dict["end_date"])
+        if act_info_dict["start_date"] != "" and act_info_dict["start_date"] != "1900-01-01 00:00:00":
+            if now_date < act_info_dict["start_date"]:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "error"
+                invoke_result_data.error_message = "活动将在" + act_info_dict['start_date'] + "开启"
+                return invoke_result_data
+        if act_info_dict["end_date"] != "" and act_info_dict["end_date"] != "1900-01-01 00:00:00":
+            if now_date > act_info_dict["end_date"]:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "error"
+                invoke_result_data.error_message = "活动已结束"
+                return invoke_result_data
+        invoke_result_data.data = act_info_dict
+        return invoke_result_data
+
+    def check_act_module(self, module_id, check_release=True):
+        """
+        :description: 检验活动模块
+        :param module_id:活动模块标识
+        :param check_release:校验活动信息发布
+        :return:invoke_result_data
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        if module_id:
+            act_module_model = ActModuleModel(context=self.context)
+            act_module_dict = act_module_model.get_cache_dict_by_id(module_id,dependency_key=DependencyKey.act_module(module_id))
+            if not act_module_dict or act_module_dict["is_del"] == 1:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "no_module"
+                invoke_result_data.error_message = "活动模块信息不存在"
+                return invoke_result_data
+            if check_release == True and act_module_dict["is_release"] == 0:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "no_module"
+                invoke_result_data.error_message = "活动模块已下架"
+                return invoke_result_data
+            now_date = SevenHelper.get_now_datetime()
+            act_module_dict["start_date"] = str(act_module_dict["start_date"])
+            act_module_dict["end_date"] = str(act_module_dict["end_date"])
+            if act_module_dict["start_date"] != "" and act_module_dict["start_date"] != "1900-01-01 00:00:00":
+                if now_date < act_module_dict["start_date"]:
+                    invoke_result_data.success = False
+                    invoke_result_data.error_code = "error"
+                    invoke_result_data.error_message = "活动将在" + act_module_dict["start_date"] + "开启"
+                    return invoke_result_data
+            if act_module_dict["end_date"] != "" and act_module_dict["end_date"] != "1900-01-01 00:00:00":
+                if now_date > act_module_dict["end_date"]:
+                    invoke_result_data.success = False
+                    invoke_result_data.error_code = "error"
+                    invoke_result_data.error_message = "活动已结束"
+                    return invoke_result_data
+            invoke_result_data.data = act_module_dict
+        return invoke_result_data
+        
+    def check_user_info(self, app_id, act_id, user_id, login_token, check_new_user, check_user_nick):
+        """
+        :description: 检验用户信息
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param user_id:用户标识
+        :param login_token:访问令牌
+        :param check_new_user:是否新用户才能参与
+        :param check_user_nick:是否校验昵称为空
+        :return:invoke_result_data
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        user_info_model = UserInfoModel(sub_table=self.get_business_sub_table("user_info_tb",{"app_id":app_id}),context=self.context)
+        id_md5 = CryptoHelper.md5_encrypt_int(f"{act_id}_{user_id}")
+        user_info_dict = user_info_model.get_cache_dict("id_md5=%s", limit="1", params=[id_md5], dependency_key=DependencyKey.user_info(act_id,id_md5))
+        if not user_info_dict:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "no_user"
+            invoke_result_data.error_message = "用户信息不存在"
+            return invoke_result_data
+        if user_info_dict["app_id"] != app_id:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "no_power"
+            invoke_result_data.error_message = "用户信息不存在"
+            return invoke_result_data
+        if user_info_dict["user_state"] == 1:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "user_exception"
+            invoke_result_data.error_message = "账号异常,请联系客服处理"
+            return invoke_result_data
+        if check_new_user == True and user_info_dict["is_new"] == 0:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "不是新用户"
+            return invoke_result_data
+        if check_user_nick == True:
+            if not user_info_dict["user_nick"] and not user_info_dict["user_nick_encrypt"]:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "no_authorize"
+                invoke_result_data.error_message = "对不起,请先授权"
+                return invoke_result_data
+        if login_token and user_info_dict["login_token"] != login_token:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "已在另一台设备登录,无法操作"
+            return invoke_result_data
+        invoke_result_data.data = user_info_dict
+        return invoke_result_data
+    
+    def check_request_queue(self, request_queue_name, user_id, request_limit_num, request_limit_time):
+        """
+        :description: 检验请求队列,用于流量削峰判断
+        :param request_queue_name:请求队列名称
+        :param user_id:用户标识
+        :param request_limit_num:请求限制数(指的是当前接口在指定时间内可以请求的次数，用于流量削峰，减少短时间内的大量请求)；0不限制
+        :param request_limit_time:请求限制时间；默认1秒
+        :return:invoke_result_data
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        if request_limit_num > 0  and request_limit_time > 0:
+            if SevenHelper.redis_check_llen(request_queue_name,request_limit_num) == True:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "concurrent"
+                invoke_result_data.error_message = "当前人气火爆,请稍后再试"
+                return invoke_result_data
+            SevenHelper.redis_lpush(request_queue_name,user_id,request_limit_time)
+        return invoke_result_data
+    
+    def business_process_executing(self, app_id, act_id, module_id, user_id, login_token, handler_name, check_new_user=False, check_user_nick=True, continue_request_expire=5, acquire_lock_name="", request_limit_num=0, request_limit_time=1, source_object_id="",check_act_info=True,check_act_module=True,check_user_info=True,check_act_info_release=True,check_act_module_release=True):
+        """
+        :description: 业务执行前事件,核心业务如抽奖、做任务需要调用当前方法
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param user_id:用户标识
+        :param login_token:访问令牌
+        :param handler_name:接口名称
+        :param check_new_user:是否新用户才能参与
+        :param check_user_nick:是否校验昵称为空
+        :param continue_request_expire:连续请求过期时间，为0不进行校验，单位秒 
+        :param acquire_lock_name:分布式锁名称，为空则不开启分布式锁校验功能
+        :param request_limit_num:请求限制数(指的是当前接口在指定时间内可以请求的次数，用于流量削峰，减少短时间内的大量请求)；0不限制
+        :param request_limit_time:请求限制时间；默认1秒
+        :param source_object_id:来源对象标识
+        :param check_act_info:是否检验活动信息
+        :param check_act_module:是否检验活动模块信息
+        :param check_user_info:是否校验用户信息
+        :param check_act_info_release:校验活动信息是否发布
+        :param check_act_module_release:校验活动模块是否发布
+        :return:
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+
+        if not act_id or not user_id or not handler_name:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "param_error"
+            invoke_result_data.error_message = "参数不能为空或等于0"
+            return invoke_result_data
+
+        #请求太频繁限制
+        if continue_request_expire > 0:
+            continue_request_key = f"request_business_executing:{handler_name}_{act_id}_{module_id}_{user_id}"
+            if source_object_id:
+                continue_request_key += f"_{source_object_id}"
+            if SevenHelper.is_continue_request(continue_request_key, expire=continue_request_expire * 1000) == True:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "error"
+                invoke_result_data.error_message = f"对不起,请{continue_request_expire}秒后再试"
+                return invoke_result_data
+        #校验活动
+        act_info_dict = None
+        if check_act_info == True:
+            invoke_result_data = self.check_act_info(act_id,check_act_info_release)
+            if invoke_result_data.success == False:
+                return invoke_result_data
+            act_info_dict = invoke_result_data.data
+            check_app_id = act_info_dict["app_id"]
+            invoke_result_data.data = None
+            if check_app_id != app_id:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "error"
+                invoke_result_data.error_message = "非法操作"
+                return invoke_result_data
+        #校验活动模块
+        act_module_dict = None
+        if check_act_module == True and module_id > 0:
+            invoke_result_data = self.check_act_module(module_id,check_act_module_release)
+            if invoke_result_data.success == False:
+                return invoke_result_data
+            act_module_dict = invoke_result_data.data
+            check_app_id = act_module_dict["app_id"]
+            invoke_result_data.data = None
+            if check_app_id != app_id:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "error"
+                invoke_result_data.error_message = "非法操作"
+                return invoke_result_data
+        #校验用户信息
+        user_info_dict = None
+        if check_user_info == True:
+            invoke_result_data = self.check_user_info(app_id,act_id,user_id,login_token,check_new_user,check_user_nick)
+            if invoke_result_data.success == False:
+                return invoke_result_data
+            user_info_dict = invoke_result_data.data
+            invoke_result_data.data = None
+        
+        #分布式锁名称存在才进行校验
+        identifier = ""
+        if acquire_lock_name:
+            acquire_lock_status, identifier = SevenHelper.redis_acquire_lock(acquire_lock_name)
+            if acquire_lock_status == False:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "acquire_lock"
+                invoke_result_data.error_message = "当前人气火爆,请稍后再试"
+                return invoke_result_data
+        request_queue_name = ""
+        if request_limit_num > 0 and request_limit_time > 0:
+            request_queue_name = f"request_queue:{handler_name}_{act_id}_{module_id}"
+            invoke_result_data = self.check_request_queue(request_queue_name,user_id,request_limit_num,request_limit_time)
+            if invoke_result_data.success == False:
+                return invoke_result_data
+
+        invoke_result_data.data = {}
+        invoke_result_data.data["act_info_dict"] = act_info_dict
+        invoke_result_data.data["act_module_dict"] = act_module_dict
+        invoke_result_data.data["user_info_dict"] = user_info_dict
+        invoke_result_data.data["identifier"] = identifier
+        invoke_result_data.data["request_queue_name"] = request_queue_name
+        
+        self.acquire_lock_name = acquire_lock_name
+        self.identifier = identifier
+        self.request_queue_name = request_queue_name
+        self.handler_name = handler_name
+        self.act_id = act_id
+        self.module_id = module_id
+        self.user_id = user_id
+        self.source_object_id = source_object_id
+        
+        return invoke_result_data
+
+    def business_process_executed(self, act_id=0, module_id=0, user_id=0, handler_name="", acquire_lock_name="", identifier="", request_queue_name="", source_object_id=""):
+        """
+        :description: 业务执行后事件，调用了业务执行前事件需要调用当前方法,参数可以不传，默认用business_process_executing方法传递的参数
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param user_id:用户标识
+        :param handler_name:接口名称
+        :param acquire_lock_name:分布式锁名称
+        :param identifier:分布式锁标识
+        :param request_queue_name:请求队列名称
+        :param source_object_id:来源对象标识
+        :return:
+        :last_editors: HuangJianYi
+        """
+        if not acquire_lock_name:
+            acquire_lock_name = self.acquire_lock_name
+        if not identifier:
+            identifier = self.identifier
+        if not request_queue_name:
+            request_queue_name = self.request_queue_name
+        if not source_object_id:
+            source_object_id = self.source_object_id
+        if not handler_name:
+            handler_name = self.handler_name
+        if not act_id:
+            act_id = self.act_id
+        if not module_id:
+            module_id = self.module_id
+        if not user_id:
+            user_id = self.user_id
+             
+        continue_request_key = f"request_business_executing:{handler_name}_{act_id}_{module_id}_{user_id}"
+        if source_object_id:
+            continue_request_key += f"_{source_object_id}"
+        SevenHelper.redis_init().delete(continue_request_key)
+        if acquire_lock_name and identifier:
+            SevenHelper.redis_release_lock(acquire_lock_name,identifier)
+        if request_queue_name:
+            SevenHelper.redis_lpop(request_queue_name)
+
+
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/goods_base_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/goods_base_model.py`

 * *Ordering differences only*

 * *Files 14% similar despite different names*

```diff
@@ -1,190 +1,190 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-08-18 17:42:13
-@LastEditTime: 2023-05-25 18:41:53
-@LastEditors: HuangJianYi
-@Description: 
-"""
-from seven_cloudapp_frame.models.seven_model import PageInfo
-from seven_cloudapp_frame.models.top_base_model import *
-from seven_cloudapp_frame.models.db_models.special.special_goods_model import *
-from seven_cloudapp_frame.models.db_models.act.act_prize_model import *
-
-class GoodsBaseModel():
-    """
-    :description: 商品相关业务模型
-    """
-    def __init__(self,context=None,logging_error=None,logging_info=None):
-        self.context = context
-        self.logging_link_error = logging_error
-        self.logging_link_info = logging_info
-
-    def get_special_goods_list(self, app_id, goods_name, access_token, app_key, app_secret, is_log=False, page_index=0, page_size=20):
-        """
-        :description: 专属下单商品列表（只取小程序内的历史绑定过的商品列表）
-        :param app_id：应用标识
-        :param goods_name：商品名称
-        :param access_tokene：access_token
-        :param app_key：app_key
-        :param app_secret：app_secret
-        :param is_log：是否记录top请求日志
-        :param page_index：页索引
-        :param page_size：页大小
-        :return:
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        condition = "app_id=%s"
-        params = [app_id]
-        if goods_name:
-            condition += " and goods_name=%s"
-            params.append(goods_name)
-
-        special_goods_model = SpecialGoodsModel(context=self.context)
-        page_list, total = special_goods_model.get_dict_page_list("*", page_index, page_size, condition, order_by="id asc", params=params)
-        if not page_list:
-            invoke_result_data.data = []
-            return invoke_result_data
-
-        resp_special_goods = {}
-        resp_on_sale_goods = {}
-        act_prize_list = []
-        goods_id_list = [str(special_goods["goods_id"]) for special_goods in page_list]
-        if len(goods_id_list) > 0:
-            goods_ids = ",".join(goods_id_list)
-            condition_where = ConditionWhere()
-            condition_where.add_condition(SevenHelper.get_condition_by_str_list("goods_id",goods_id_list))
-            condition_where.add_condition("is_del=0")
-            act_prize_list = ActPrizeModel(context=self.context).get_dict_list(condition_where.to_string())
-            top_base_model = TopBaseModel(context=self.context)
-            invoke_result_data = top_base_model.get_goods_list_by_goodsids(goods_ids, access_token, app_key, app_secret, "num_iid,title,nick,pic_url,price", is_log)
-            if invoke_result_data.success == False:
-                return invoke_result_data
-            resp_on_sale_goods = invoke_result_data.data
-            if "error_message" in resp_on_sale_goods.keys():
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "error"
-                invoke_result_data.error_message = resp_on_sale_goods["error_message"]
-                return invoke_result_data
-            invoke_result_data = top_base_model.open_trade_special_items_query(app_id, access_token, app_key, app_secret, is_log)
-            if invoke_result_data.success == False:
-                return invoke_result_data
-            resp_special_goods = invoke_result_data.data
-
-        # resp_on_sale_goods = {'items_seller_list_get_response': {'items': {'item': [{'input_str': '123321', 'newprepay': 'default', 'nick': 'loveyouhk', 'num_iid': 645237589892, 'pic_url': 'https://img.alicdn.com/bao/uploaded/i4/305104024/O1CN01hjxRJe1fb2PfX01n8_!!305104024.jpg', 'price': '10.00', 'property_alias': '', 'props_name': '20000:6151601944:品牌:15phoe/衣窝风;20021:105255:主要材质:棉;20509:12430609:尺码:S（54-56cm）;1627207:28341:颜色分类:黑色;8560225:740132938:上市时间:2015年冬季;13021751:3251403:货号:123321', 'skus': {'sku': [{'created': '2021-05-23 16:00:15', 'modified': '2021-05-23 16:00:15', 'price': '10.00', 'properties': '20509:12430609;1627207:28341', 'properties_name': '20509:12430609:尺码:S（54-56cm）;1627207:28341:颜色分类:黑色', 'quantity': 10, 'sku_id': 4818446850738}]}, 'title': '专属测试523男士包头帽'}, {'input_str': '', 'newprepay': 'default', 'nick': 'loveyouhk', 'num_iid': 645938651976, 'pic_url': 'https://img.alicdn.com/bao/uploaded/i4/305104024/O1CN01hjxRJe1fb2PfX01n8_!!305104024.jpg', 'price': '10.00', 'property_alias': '', 'props_name': '20021:105255:主要材质:棉', 'title': '523170000'}]}, 'request_id': '41zzkkd2aorh'}}
-        # resp_special_goods = {'opentrade_special_items_query_response': {'items': {'number': [645938651976, 645237589892, 634388910274, 641313416583, 641692061394, 641691601551, 632998091188, 639914960755]}, 'request_id': '5aaavqza0p93'}}
-
-        for special_goods in page_list:
-            if "items_seller_list_get_response" in resp_on_sale_goods.keys():
-                if "items" in resp_on_sale_goods["items_seller_list_get_response"].keys():
-                    cur_resp_goods_list = [resp_goods for resp_goods in resp_on_sale_goods["items_seller_list_get_response"]["items"]["item"] if str(resp_goods.get("num_iid", "")) == special_goods["goods_id"]]
-                    if len(cur_resp_goods_list) > 0:
-                        special_goods["title"] = cur_resp_goods_list[0]["title"]
-                        special_goods["price"] = cur_resp_goods_list[0]["price"]
-                    else:
-                        special_goods["title"] = ""
-                        special_goods["price"] = 0.00
-
-                    if special_goods["title"] != "" and special_goods["title"] != special_goods["goods_name"]:
-                        special_goods_model.update_table("goods_name=%s", "id=%s", params=[special_goods["title"], special_goods["id"]])
-
-            if "opentrade_special_items_query_response" in resp_special_goods.keys():
-                if "items" in resp_special_goods["opentrade_special_items_query_response"].keys():
-                    cur_resp_special_goods_list = [goods_id for goods_id in resp_special_goods["opentrade_special_items_query_response"]["items"]["number"] if str(goods_id) == special_goods["goods_id"]]
-                    if len(cur_resp_special_goods_list) <= 0:
-                        special_goods["is_bind"] = 1
-                    else:
-                        special_goods["is_bind"] = 0
-
-            cur_act_prize_list = [act_prize for act_prize in act_prize_list if act_prize["goods_id"] == special_goods["goods_id"]]
-            special_goods["is_select"] = 1 if len(cur_act_prize_list) > 0 else 0
-
-        page_info = PageInfo(page_index, page_size, total, page_list)
-        invoke_result_data.data = page_info
-        return invoke_result_data
-
-    def get_special_goods_list_for_tb(self, app_id, goods_id, access_token, app_key, app_secret, is_log=False, page_index=0, page_size=20):
-        """
-        :description: 专属下单商品列表（取淘宝接口返回的已绑定的商品列表）
-        :param app_id：应用标识
-        :param goods_id：商品ID
-        :param access_tokene：access_token
-        :param app_key：app_key
-        :param app_secret：app_secret
-        :param is_log：是否记录top请求日志
-        :param page_index：页索引
-        :param page_size：页大小
-        :return:
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        special_goods_id_list = []
-        special_goods_list = []
-        top_base_model = TopBaseModel(context=self.context)
-        invoke_result_data = top_base_model.open_trade_special_items_query(app_id, access_token, app_key, app_secret, is_log)
-        if invoke_result_data.success == False:
-            return invoke_result_data
-        if len(invoke_result_data.data["opentrade_special_items_query_response"]["items"]) <= 0:
-            invoke_result_data.data = PageInfo(page_index, page_size, 0, [])
-            return invoke_result_data
-        special_goods_id_list = invoke_result_data.data["opentrade_special_items_query_response"]["items"]["number"]
-
-        if goods_id and goods_id in special_goods_id_list:
-            record_count = 1
-            special_goods_id_list=[goods_id]
-        else:
-            record_count = len(special_goods_id_list)
-            special_goods_id_list = special_goods_id_list[page_index*page_size:(page_index+1)*page_size]
-        if len(special_goods_id_list)>0:
-            special_goods_ids = ",".join([str(i) for i in special_goods_id_list])
-            invoke_result_data = top_base_model.get_goods_list_by_goodsids(special_goods_ids, access_token, app_key, app_secret,"num_iid,title,pic_url,price", is_log)
-            if invoke_result_data.success == False:
-                return invoke_result_data
-            special_goods_list = invoke_result_data.data["items_seller_list_get_response"]["items"]["item"]
-            act_prize_model = ActPrizeModel(context=self.context)
-            condition_where = ConditionWhere()
-            condition_where.add_condition(SevenHelper.get_condition_by_str_list("goods_id",special_goods_id_list))
-            condition_where.add_condition("is_del=0")
-            act_prize_dict_list = act_prize_model.get_dict_list(condition_where.to_string())
-            for special_goods in special_goods_list:
-                cur_act_prize_list = [act_prize for act_prize in act_prize_dict_list if act_prize["goods_id"] == special_goods["goods_id"]]
-                special_goods["is_select"] = 1 if len(cur_act_prize_list) > 0 else 0
-
-        page_info = PageInfo(page_index, page_size, record_count, special_goods_list)
-        invoke_result_data.data = page_info
-        return invoke_result_data
-
-    def bind_special_goods(self, app_id, goods_id, goods_name, access_token, app_key, app_secret, is_log=False):
-        """
-        :description: 专属下单商品绑定(单个商品)
-        :param app_id：应用标识
-        :param goods_id：商品ID
-        :param goods_name: 商品名称
-        :param access_tokene：access_token
-        :param app_key：app_key
-        :param app_secret：app_secret
-        :param is_log：是否记录top请求日志
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        top_base_model = TopBaseModel(context=self.context)
-        invoke_result_data = top_base_model.open_trade_special_items_bind(app_id, goods_id, access_token, app_key, app_secret, is_log)
-        if invoke_result_data.success == False:
-            return invoke_result_data
-        special_goods_model = SpecialGoodsModel()
-        special_goods = special_goods_model.get_dict("app_id=%s and goods_id=%s", limit="1", params=[app_id, goods_id])
-        if not special_goods:
-            special_goods = SpecialGoods()
-            special_goods.app_id = app_id
-            special_goods.goods_id = goods_id
-            special_goods.goods_name = goods_name
-            special_goods.create_date = SevenHelper.get_now_datetime()
-            special_goods_model.add_entity(special_goods)
-        else:
-            special_goods.goods_id = goods_id
-            special_goods.goods_name = goods_name
-            special_goods.modify_date = SevenHelper.get_now_datetime()
-            special_goods_model.update_entity(special_goods,"goods_id,goods_name,modify_date")
-        return invoke_result_data
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-08-18 17:42:13
+@LastEditTime: 2023-05-25 18:41:53
+@LastEditors: HuangJianYi
+@Description: 
+"""
+from seven_cloudapp_frame.models.seven_model import PageInfo
+from seven_cloudapp_frame.models.top_base_model import *
+from seven_cloudapp_frame.models.db_models.special.special_goods_model import *
+from seven_cloudapp_frame.models.db_models.act.act_prize_model import *
+
+class GoodsBaseModel():
+    """
+    :description: 商品相关业务模型
+    """
+    def __init__(self,context=None,logging_error=None,logging_info=None):
+        self.context = context
+        self.logging_link_error = logging_error
+        self.logging_link_info = logging_info
+
+    def get_special_goods_list(self, app_id, goods_name, access_token, app_key, app_secret, is_log=False, page_index=0, page_size=20):
+        """
+        :description: 专属下单商品列表（只取小程序内的历史绑定过的商品列表）
+        :param app_id：应用标识
+        :param goods_name：商品名称
+        :param access_tokene：access_token
+        :param app_key：app_key
+        :param app_secret：app_secret
+        :param is_log：是否记录top请求日志
+        :param page_index：页索引
+        :param page_size：页大小
+        :return:
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        condition = "app_id=%s"
+        params = [app_id]
+        if goods_name:
+            condition += " and goods_name=%s"
+            params.append(goods_name)
+
+        special_goods_model = SpecialGoodsModel(context=self.context)
+        page_list, total = special_goods_model.get_dict_page_list("*", page_index, page_size, condition, order_by="id asc", params=params)
+        if not page_list:
+            invoke_result_data.data = []
+            return invoke_result_data
+
+        resp_special_goods = {}
+        resp_on_sale_goods = {}
+        act_prize_list = []
+        goods_id_list = [str(special_goods["goods_id"]) for special_goods in page_list]
+        if len(goods_id_list) > 0:
+            goods_ids = ",".join(goods_id_list)
+            condition_where = ConditionWhere()
+            condition_where.add_condition(SevenHelper.get_condition_by_str_list("goods_id",goods_id_list))
+            condition_where.add_condition("is_del=0")
+            act_prize_list = ActPrizeModel(context=self.context).get_dict_list(condition_where.to_string())
+            top_base_model = TopBaseModel(context=self.context)
+            invoke_result_data = top_base_model.get_goods_list_by_goodsids(goods_ids, access_token, app_key, app_secret, "num_iid,title,nick,pic_url,price", is_log)
+            if invoke_result_data.success == False:
+                return invoke_result_data
+            resp_on_sale_goods = invoke_result_data.data
+            if "error_message" in resp_on_sale_goods.keys():
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "error"
+                invoke_result_data.error_message = resp_on_sale_goods["error_message"]
+                return invoke_result_data
+            invoke_result_data = top_base_model.open_trade_special_items_query(app_id, access_token, app_key, app_secret, is_log)
+            if invoke_result_data.success == False:
+                return invoke_result_data
+            resp_special_goods = invoke_result_data.data
+
+        # resp_on_sale_goods = {'items_seller_list_get_response': {'items': {'item': [{'input_str': '123321', 'newprepay': 'default', 'nick': 'loveyouhk', 'num_iid': 645237589892, 'pic_url': 'https://img.alicdn.com/bao/uploaded/i4/305104024/O1CN01hjxRJe1fb2PfX01n8_!!305104024.jpg', 'price': '10.00', 'property_alias': '', 'props_name': '20000:6151601944:品牌:15phoe/衣窝风;20021:105255:主要材质:棉;20509:12430609:尺码:S（54-56cm）;1627207:28341:颜色分类:黑色;8560225:740132938:上市时间:2015年冬季;13021751:3251403:货号:123321', 'skus': {'sku': [{'created': '2021-05-23 16:00:15', 'modified': '2021-05-23 16:00:15', 'price': '10.00', 'properties': '20509:12430609;1627207:28341', 'properties_name': '20509:12430609:尺码:S（54-56cm）;1627207:28341:颜色分类:黑色', 'quantity': 10, 'sku_id': 4818446850738}]}, 'title': '专属测试523男士包头帽'}, {'input_str': '', 'newprepay': 'default', 'nick': 'loveyouhk', 'num_iid': 645938651976, 'pic_url': 'https://img.alicdn.com/bao/uploaded/i4/305104024/O1CN01hjxRJe1fb2PfX01n8_!!305104024.jpg', 'price': '10.00', 'property_alias': '', 'props_name': '20021:105255:主要材质:棉', 'title': '523170000'}]}, 'request_id': '41zzkkd2aorh'}}
+        # resp_special_goods = {'opentrade_special_items_query_response': {'items': {'number': [645938651976, 645237589892, 634388910274, 641313416583, 641692061394, 641691601551, 632998091188, 639914960755]}, 'request_id': '5aaavqza0p93'}}
+
+        for special_goods in page_list:
+            if "items_seller_list_get_response" in resp_on_sale_goods.keys():
+                if "items" in resp_on_sale_goods["items_seller_list_get_response"].keys():
+                    cur_resp_goods_list = [resp_goods for resp_goods in resp_on_sale_goods["items_seller_list_get_response"]["items"]["item"] if str(resp_goods.get("num_iid", "")) == special_goods["goods_id"]]
+                    if len(cur_resp_goods_list) > 0:
+                        special_goods["title"] = cur_resp_goods_list[0]["title"]
+                        special_goods["price"] = cur_resp_goods_list[0]["price"]
+                    else:
+                        special_goods["title"] = ""
+                        special_goods["price"] = 0.00
+
+                    if special_goods["title"] != "" and special_goods["title"] != special_goods["goods_name"]:
+                        special_goods_model.update_table("goods_name=%s", "id=%s", params=[special_goods["title"], special_goods["id"]])
+
+            if "opentrade_special_items_query_response" in resp_special_goods.keys():
+                if "items" in resp_special_goods["opentrade_special_items_query_response"].keys():
+                    cur_resp_special_goods_list = [goods_id for goods_id in resp_special_goods["opentrade_special_items_query_response"]["items"]["number"] if str(goods_id) == special_goods["goods_id"]]
+                    if len(cur_resp_special_goods_list) <= 0:
+                        special_goods["is_bind"] = 1
+                    else:
+                        special_goods["is_bind"] = 0
+
+            cur_act_prize_list = [act_prize for act_prize in act_prize_list if act_prize["goods_id"] == special_goods["goods_id"]]
+            special_goods["is_select"] = 1 if len(cur_act_prize_list) > 0 else 0
+
+        page_info = PageInfo(page_index, page_size, total, page_list)
+        invoke_result_data.data = page_info
+        return invoke_result_data
+
+    def get_special_goods_list_for_tb(self, app_id, goods_id, access_token, app_key, app_secret, is_log=False, page_index=0, page_size=20):
+        """
+        :description: 专属下单商品列表（取淘宝接口返回的已绑定的商品列表）
+        :param app_id：应用标识
+        :param goods_id：商品ID
+        :param access_tokene：access_token
+        :param app_key：app_key
+        :param app_secret：app_secret
+        :param is_log：是否记录top请求日志
+        :param page_index：页索引
+        :param page_size：页大小
+        :return:
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        special_goods_id_list = []
+        special_goods_list = []
+        top_base_model = TopBaseModel(context=self.context)
+        invoke_result_data = top_base_model.open_trade_special_items_query(app_id, access_token, app_key, app_secret, is_log)
+        if invoke_result_data.success == False:
+            return invoke_result_data
+        if len(invoke_result_data.data["opentrade_special_items_query_response"]["items"]) <= 0:
+            invoke_result_data.data = PageInfo(page_index, page_size, 0, [])
+            return invoke_result_data
+        special_goods_id_list = invoke_result_data.data["opentrade_special_items_query_response"]["items"]["number"]
+
+        if goods_id and goods_id in special_goods_id_list:
+            record_count = 1
+            special_goods_id_list=[goods_id]
+        else:
+            record_count = len(special_goods_id_list)
+            special_goods_id_list = special_goods_id_list[page_index*page_size:(page_index+1)*page_size]
+        if len(special_goods_id_list)>0:
+            special_goods_ids = ",".join([str(i) for i in special_goods_id_list])
+            invoke_result_data = top_base_model.get_goods_list_by_goodsids(special_goods_ids, access_token, app_key, app_secret,"num_iid,title,pic_url,price", is_log)
+            if invoke_result_data.success == False:
+                return invoke_result_data
+            special_goods_list = invoke_result_data.data["items_seller_list_get_response"]["items"]["item"]
+            act_prize_model = ActPrizeModel(context=self.context)
+            condition_where = ConditionWhere()
+            condition_where.add_condition(SevenHelper.get_condition_by_str_list("goods_id",special_goods_id_list))
+            condition_where.add_condition("is_del=0")
+            act_prize_dict_list = act_prize_model.get_dict_list(condition_where.to_string())
+            for special_goods in special_goods_list:
+                cur_act_prize_list = [act_prize for act_prize in act_prize_dict_list if act_prize["goods_id"] == special_goods["goods_id"]]
+                special_goods["is_select"] = 1 if len(cur_act_prize_list) > 0 else 0
+
+        page_info = PageInfo(page_index, page_size, record_count, special_goods_list)
+        invoke_result_data.data = page_info
+        return invoke_result_data
+
+    def bind_special_goods(self, app_id, goods_id, goods_name, access_token, app_key, app_secret, is_log=False):
+        """
+        :description: 专属下单商品绑定(单个商品)
+        :param app_id：应用标识
+        :param goods_id：商品ID
+        :param goods_name: 商品名称
+        :param access_tokene：access_token
+        :param app_key：app_key
+        :param app_secret：app_secret
+        :param is_log：是否记录top请求日志
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        top_base_model = TopBaseModel(context=self.context)
+        invoke_result_data = top_base_model.open_trade_special_items_bind(app_id, goods_id, access_token, app_key, app_secret, is_log)
+        if invoke_result_data.success == False:
+            return invoke_result_data
+        special_goods_model = SpecialGoodsModel()
+        special_goods = special_goods_model.get_dict("app_id=%s and goods_id=%s", limit="1", params=[app_id, goods_id])
+        if not special_goods:
+            special_goods = SpecialGoods()
+            special_goods.app_id = app_id
+            special_goods.goods_id = goods_id
+            special_goods.goods_name = goods_name
+            special_goods.create_date = SevenHelper.get_now_datetime()
+            special_goods_model.add_entity(special_goods)
+        else:
+            special_goods.goods_id = goods_id
+            special_goods.goods_name = goods_name
+            special_goods.modify_date = SevenHelper.get_now_datetime()
+            special_goods_model.update_entity(special_goods,"goods_id,goods_name,modify_date")
+        return invoke_result_data
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/ip_base_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/theme_base_model.py`

 * *Files 25% similar despite different names*

```diff
@@ -1,312 +1,285 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-08-02 09:44:36
-@LastEditTime: 2023-05-09 09:08:21
-@LastEditors: HuangJianYi
-@Description: 
-"""
-from seven_cloudapp_frame.models.seven_model import *
-from seven_cloudapp_frame.models.enum import *
-from seven_cloudapp_frame.libs.customize.seven_helper import *
-from seven_cloudapp_frame.models.db_models.ip.ip_info_model import *
-from seven_cloudapp_frame.models.db_models.ip.ip_type_model import *
-
-class IpBaseModel():
-    """
-    :description: IP信息业务模型
-    """
-    def __init__(self,context=None,logging_error=None,logging_info=None):
-        self.context = context
-        self.logging_link_error = logging_error
-        self.logging_link_info = logging_info
-
-    def _delete_ip_info_dependency_key(self, act_id, ip_id=0, delay_delete_time=0.01):
-        """
-        :description: 删除ip信息依赖建
-        :param act_id: 活动标识
-        :param ip_id: ip标识
-        :param delay_delete_time: 延迟删除时间，传0则不进行延迟
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        dependency_key_list = [DependencyKey.ip_info_list(act_id)]
-        if ip_id:
-            dependency_key_list.append(DependencyKey.ip_info(ip_id))
-        IpInfoModel().delete_dependency_key(dependency_key_list, delay_delete_time)
-        
-    def _delete_ip_type_dependency_key(self, act_id, type_id=0, delay_delete_time=0.01):
-        """
-        :description: 删除ip类型依赖建
-        :param act_id: 活动标识
-        :param type_id: ip类型标识
-        :param delay_delete_time: 延迟删除时间，传0则不进行延迟
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        dependency_key_list = [DependencyKey.ip_type(type_id)]
-        if type_id:
-            dependency_key_list.append(DependencyKey.ip_type_list(act_id))
-        IpTypeModel().delete_dependency_key(dependency_key_list, delay_delete_time)
-
-    def save_ip_info(self, app_id,act_id,ip_id,ip_name,ip_pic,show_pic,sort_index,is_release,ip_type,ip_summary,mode_type=0,ip_config_json=None):
-        """
-        :description: 保存ip信息
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param ip_id: ip标识
-        :param ip_name：ip名称
-        :param ip_pic：ip图片
-        :param show_pic：展示图片
-        :param sort_index：排序
-        :param is_release：是否发布
-        :param ip_type：ip类型
-        :param ip_summary：ip描述
-        :param mode_type：模式类型
-        :param ip_config_json：ip配置
-        :return
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        if not act_id or not ip_name:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "param_error"
-            invoke_result_data.error_message = "参数不能为空或等于0"
-            return invoke_result_data
-
-        ip_info = None
-        old_ip_info = None
-        is_add = False
-        ip_info_model = IpInfoModel(context=self.context)
-        if ip_id > 0:
-            ip_info = ip_info_model.get_entity_by_id(ip_id)
-            if not ip_info or ip_info.app_id != app_id:
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "error"
-                invoke_result_data.error_message = "ip信息不存在"
-                return invoke_result_data
-            old_ip_info = deepcopy(ip_info)
-        if not ip_info:
-            is_add = True
-            ip_info = IpInfo()
-        ip_info.app_id = app_id
-        ip_info.act_id = act_id
-        ip_info.ip_name = ip_name
-        ip_info.ip_type = ip_type
-        ip_info.ip_pic = ip_pic
-        ip_info.show_pic = show_pic
-        ip_info.ip_summary = ip_summary
-        ip_info.sort_index = sort_index
-        ip_info.is_release = is_release
-        ip_info.mode_type = mode_type
-        if ip_config_json != None:
-            ip_info.ip_config_json = ip_config_json
-        ip_info.modify_date = SevenHelper.get_now_datetime()
-        if is_add:
-            ip_info.create_date = ip_info.modify_date
-            ip_info.id = ip_info_model.add_entity(ip_info)
-        else:
-            ip_info_model.update_entity(ip_info,exclude_field_list="app_id,act_id")
-        result = {}
-        result["is_add"] = is_add
-        result["new"] = ip_info
-        result["old"] = old_ip_info
-        invoke_result_data.data = result
-        self._delete_ip_info_dependency_key(act_id,ip_info.id)
-        return invoke_result_data
-
-    def get_ip_info_list(self, app_id, act_id, page_size, page_index, is_del=0,is_release=-1, field="*", condition="", params=[], order_by="sort_index desc", is_cache=True, page_count_mode="total", dependency_key=""):
-        """
-        :description: 获取IP列表
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param page_size：页大小
-        :param page_index：页索引
-        :param is_del: 是否回收站1是0否
-        :param is_release: 是否发布1是0否
-        :param field：字段
-        :param condition：条件
-        :param params：参数数组
-        :param order_by：排序
-        :param is_cache：是否缓存
-        :param page_count_mode: 分页计数模式 total-计算总数(默认) next-计算是否有下一页(bool) none-不计算
-        :param dependency_key：依赖建
-        :return: list
-        :last_editors: HuangJianYi
-        """
-        params_list = [app_id, act_id]
-        condition_where = ConditionWhere()
-        condition_where.add_condition("app_id=%s and act_id=%s")
-        if condition:
-            condition_where.add_condition(condition)
-            params_list.extend(params)
-        if is_del != -1:
-            condition_where.add_condition("is_del=%s")
-            params_list.append(is_del)
-        if is_release != -1:
-            condition_where.add_condition("is_release=%s")
-            params_list.append(is_release)
-        if is_cache == True:
-            if not dependency_key:
-                dependency_key = DependencyKey.ip_info_list(act_id)
-            page_list = IpInfoModel(context=self.context).get_cache_dict_page_list(field=field, page_index=page_index, page_size=page_size, where=condition_where.to_string(), group_by="", order_by=order_by, params=params_list, dependency_key=dependency_key, cache_expire=600, page_count_mode=page_count_mode)
-        else:
-            page_list = IpInfoModel(context=self.context).get_dict_page_list(field=field, page_index=page_index, page_size=page_size, where=condition_where.to_string(), group_by="", order_by=order_by, params=params_list, page_count_mode=page_count_mode)
-        return page_list
-
-    def update_ip_info_status(self,app_id,ip_id,is_del):
-        """
-        :description: 删除ip
-        :param app_id：应用标识
-        :param ip_id：ip标识
-        :param is_del：0-还原，1-删除
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        ip_info_model = IpInfoModel(context=self.context)
-        ip_info_dict = ip_info_model.get_dict_by_id(ip_id)
-        if not ip_info_dict or ip_info_dict["app_id"] != app_id:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "ip信息不存在"
-            return invoke_result_data
-        is_release = 0
-        del_date = SevenHelper.get_now_datetime()
-        invoke_result_data.success = ip_info_model.update_table("is_del=%s,is_release=%s,modify_date=%s,del_date=%s", "id=%s", [is_del, is_release, del_date, del_date, ip_id])
-        self._delete_ip_info_dependency_key(ip_info_dict["act_id"],ip_id)
-        invoke_result_data.data = ip_info_dict
-        return invoke_result_data
-
-    def release_ip_info(self,app_id,ip_id,is_release):
-        """
-        :description: ip上下架
-        :param app_id：应用标识
-        :param ip_id：ip标识
-        :param is_release: 是否发布 1-是 0-否
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        ip_info_model = IpInfoModel(context=self.context)
-        ip_info_dict = ip_info_model.get_dict_by_id(ip_id)
-        if not ip_info_dict or ip_info_dict["app_id"]!=app_id:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "ip信息不存在"
-            return invoke_result_data
-        modify_date = SevenHelper.get_now_datetime()
-        invoke_result_data.success = ip_info_model.update_table("is_release=%s,modify_date=%s", "id=%s", [is_release, modify_date, ip_id])
-        self._delete_ip_info_dependency_key(ip_info_dict["act_id"],ip_id)
-        invoke_result_data.data = ip_info_dict
-        return invoke_result_data
-
-    def save_ip_type(self,app_id,act_id,ip_type_id,type_name,sort_index,is_release,type_pic=""):
-        """
-        :description: 保存ip类型
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param ip_type_id：ip类型标识
-        :param type_name：类型名称
-        :param sort_index：排序
-        :param is_release：是否发布
-        :param type_pic：类型图片
-        :return
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        if not act_id or not type_name:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "param_error"
-            invoke_result_data.error_message = "参数不能为空或等于0"
-            return invoke_result_data
-
-        ip_type = None
-        old_ip_type = None
-        is_add = False
-        ip_type_model = IpTypeModel(context=self.context)
-        if ip_type_id > 0:
-            ip_type = ip_type_model.get_entity_by_id(ip_type_id)
-            if not ip_type or ip_type.app_id != app_id:
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "error"
-                invoke_result_data.error_message = "ip类型信息不存在"
-                return invoke_result_data
-            old_ip_type = deepcopy(ip_type)
-        if not ip_type:
-            is_add = True
-            ip_type = IpType()
-        ip_type.app_id = app_id
-        ip_type.act_id = act_id
-        ip_type.type_name = type_name
-        ip_type.type_pic = type_pic
-        ip_type.sort_index = sort_index
-        ip_type.is_release = is_release
-        ip_type.modify_date = SevenHelper.get_now_datetime()
-        if is_add:
-            ip_type.create_date = ip_type.modify_date
-            ip_type.id = ip_type_model.add_entity(ip_type)
-        else:
-            ip_type_model.update_entity(ip_type,exclude_field_list="app_id,act_id")
-        result = {}
-        result["is_add"] = is_add
-        result["new"] = ip_type
-        result["old"] = old_ip_type
-        invoke_result_data.data = result
-        self._delete_ip_type_dependency_key(act_id,ip_type.id)
-        return invoke_result_data
-
-    def get_ip_type_list(self, app_id, act_id, page_size, page_index,is_release=-1, field="*", condition="", params=[], order_by="sort_index desc", is_cache=True, page_count_mode="total"):
-        """
-        :description: 获取IP类型列表
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param page_size：页大小
-        :param page_index：页索引
-        :param is_release: 是否发布1是0否
-        :param field：字段
-        :param condition：条件
-        :param params：参数数组
-        :param order_by：排序
-        :param is_cache：是否缓存
-        :param page_count_mode: 分页计数模式 total-计算总数(默认) next-计算是否有下一页(bool) none-不计算
-        :return:
-        :last_editors: HuangJianYi
-        """
-        params_list = [app_id, act_id]
-        condition_where = ConditionWhere()
-        condition_where.add_condition("app_id=%s and act_id=%s")
-        if condition:
-            condition_where.add_condition(condition)
-            params_list.extend(params)
-        if is_release != -1:
-            condition_where.add_condition("is_release=%s")
-            params_list.append(is_release)
-        if is_cache == True:
-            page_list = IpTypeModel(context=self.context).get_cache_dict_page_list(field=field, page_index=page_index, page_size=page_size, where=condition_where.to_string(), group_by="", order_by=order_by, params=params_list, dependency_key=DependencyKey.ip_type_list(act_id), cache_expire=600, page_count_mode=page_count_mode)
-        else:
-            page_list = IpTypeModel(context=self.context).get_dict_page_list(field=field, page_index=page_index, page_size=page_size, where=condition_where.to_string(), group_by="", order_by=order_by, params=params_list, page_count_mode=page_count_mode)
-        return page_list
-
-    def release_ip_type(self,app_id, ip_type_id, is_release):
-        """
-        :description: ip上下架
-        :param app_id：应用标识
-        :param ip_type_id：ip类型标识
-        :param is_release: 是否发布 1-是 0-否
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        ip_type_model = IpTypeModel(context=self.context)
-        ip_type_dict = ip_type_model.get_dict_by_id(ip_type_id)
-        if not ip_type_dict or ip_type_dict["app_id"]!=app_id:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "ip信息不存在"
-            return invoke_result_data
-        modify_date = SevenHelper.get_now_datetime()
-        invoke_result_data.success = ip_type_model.update_table("is_release=%s,modify_date=%s", "id=%s", [is_release, modify_date, ip_type_id])
-        self._delete_ip_type_dependency_key(ip_type_dict["act_id"],ip_type_id)
-        invoke_result_data.data = ip_type_dict
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-26 15:44:04
+@LastEditTime: 2023-03-29 12:00:55
+@LastEditors: HuangJianYi
+@Description: 
+"""
+from seven_cloudapp_frame.models.seven_model import *
+from seven_cloudapp_frame.libs.common import *
+from seven_cloudapp_frame.libs.customize.seven_helper import *
+from seven_cloudapp_frame.models.act_base_model import *
+from seven_cloudapp_frame.models.db_models.theme.theme_info_model import *
+from seven_cloudapp_frame.models.db_models.theme.theme_ver_model import *
+from seven_cloudapp_frame.models.db_models.skin.skin_info_model import *
+from seven_cloudapp_frame.models.db_models.act.act_info_model import *
+from seven_cloudapp_frame.models.db_models.act.act_module_model import *
+
+class ThemeBaseModel():
+    """
+    :description: 主题皮肤业务模型
+    """
+    def __init__(self, context=None,logging_error=None, logging_info=None):
+        self.context = context
+        self.logging_link_error = logging_error
+        self.logging_link_info = logging_info
+
+    def get_theme_info(self,theme_id, ver_no,is_cache=True):
+        """
+        :description: 获取主题信息
+        :param act_id：活动标识
+        :param theme_id：主题标识
+        :param ver_no：客户端版本号
+        :param is_cache：是否缓存
+        :return: 返回主题信息
+        :last_editors: HuangJianYi
+        """
+        theme_info_model = ThemeInfoModel(context=self.context)
+        cache_key = f"theme_info:themeid_{theme_id}_verno_{ver_no}"
+        redis_init = SevenHelper.redis_init()
+        if is_cache:
+            theme_info_dict = redis_init.get(cache_key)
+            if theme_info_dict:
+                theme_info_dict = SevenHelper.json_loads(theme_info_dict)
+                return theme_info_dict
+
+        theme_info_dict = theme_info_model.get_dict_by_id(theme_id)
+        if not theme_info_dict:
+            return theme_info_dict
+        out_id = theme_info_dict["out_id"]
+        if ver_no:
+            theme_ver = ThemeVerModel(context=self.context).get_dict("out_id=%s and ver_no=%s", limit="1", params=[out_id, ver_no])
+            if theme_ver and theme_ver["client_json"] != "":
+                theme_info_dict["client_json"] = theme_ver["client_json"]
+        skin_info_list = SkinInfoModel(context=self.context).get_dict_list("theme_id=%s", params=theme_id)
+        theme_info_dict["skin_list"] = skin_info_list
+        if is_cache:
+            redis_init.set(cache_key, SevenHelper.json_dumps(theme_info_dict), ex=share_config.get_value("cache_expire", 600))
+        return theme_info_dict
+
+    def get_theme_list(self,app_id, is_public=True, is_cache=True, ascription_type=-1):
+        """
+        :description: 获取主题列表
+        :param app_id：应用标识
+        :param is_public：是否读取公共的（True是False否）
+        :param is_cache：是否缓存
+        :param ascription_type：归属类型
+        :return: 获取主题列表
+        :last_editors: HuangJianYi
+        """
+        condition_where = ConditionWhere()
+        condition_where.add_condition("is_release=1")
+        params = []
+        if ascription_type != -1:
+            condition_where.add_condition("ascription_type=%s")
+            params.append(ascription_type)
+        if is_public == True:
+            condition_where.add_condition("(app_id=%s or app_id='')")
+        else:
+            condition_where.add_condition("app_id=%s")
+        params.append(app_id)
+        theme_info_model = ThemeInfoModel(context=self.context)
+        if is_cache:
+            dict_list = theme_info_model.get_cache_dict_list(where=condition_where.to_string(), params=params)
+        else:
+            dict_list = theme_info_model.get_dict_list(where=condition_where.to_string(), params=params)
+
+        for dict_info in dict_list:
+            dict_info["server_json"] = SevenHelper.json_loads(dict_info["server_json"]) if dict_info["server_json"] else {}
+        return dict_list
+
+    def get_skin_list(self, theme_id=0, theme_out_id="",is_cache=True):
+        """
+        :description: 获取皮肤列表
+        :param theme_id：主题标识
+        :param theme_out_id：外部主题标识
+        :param is_cache：是否缓存
+        :return: 获取主题列表
+        :last_editors: HuangJianYi
+        """
+        where = ""
+        params = []
+        if not theme_id:
+            return []
+        if theme_id:
+            where = "theme_id=%s"
+            params.append(theme_id)
+        if theme_out_id:
+            if where:
+                where+=" and "
+            where += " theme_out_id=%s"
+            params.append(theme_out_id)
+        if is_cache:
+            dict_list = SkinInfoModel(context=self.context).get_cache_dict_list(where=where, params=params)
+        else:
+            dict_list = SkinInfoModel(context=self.context).get_dict_list(where=where, params=params)
+        for dict_info in dict_list:
+            dict_info["client_json"] = SevenHelper.json_loads(dict_info["client_json"]) if dict_info["client_json"] else {}
+            dict_info["server_json"] = SevenHelper.json_loads(dict_info["server_json"]) if dict_info["server_json"] else {}
+        return dict_list
+
+    def update_act_theme_and_skin(self,app_id,act_id,theme_id,is_module):
+        """
+        :description: 更新活动主题和皮肤
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param theme_id：主题标识
+        :param is_module：是否更新活动模块皮肤 True是False否
+        :return: 获取主题列表
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        act_info_model = ActInfoModel(context=self.context)
+        act_base_model = ActBaseModel(context=self.context)
+        act_info_dict = act_base_model.get_act_info_dict(act_id,is_cache=False)
+        if act_info_dict["app_id"] != app_id:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "活动不存在"
+            return invoke_result_data
+        if act_info_dict["theme_id"] == theme_id:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "主题未改变无需更改"
+            return invoke_result_data
+
+        skin_info = SkinInfoModel(context=self.context).get_entity("theme_id=%s", params=theme_id)
+        if not skin_info:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "对不起，主题没有皮肤"
+            return invoke_result_data
+        act_info_model.update_table("theme_id=%s", "id=%s", [theme_id, act_id])
+        if is_module == True:
+            ActModuleModel(context=self.context).update_table("skin_id=%s", "act_id=%s", [skin_info.id, act_id])
+        return invoke_result_data
+
+    def save_theme(self, app_id, theme_name, client_json, server_json, out_id, ver_no, style_type, ascription_type=1):
+        """
+        :description: 添加或修改主题
+        :param app_id：app_id
+        :param theme_name：主题名称
+        :param client_json：客户端内容json
+        :param server_json：服务端内容json
+        :param out_id：外部id
+        :param ver_no：客户端版本号
+        :param style_type：样式类型
+        :param ascription_type：归属类型(1公共)
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        if not out_id or not ver_no:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "param_error"
+            invoke_result_data.error_message = "参数不能为空或等于0"
+            return invoke_result_data
+
+        theme_info_model = ThemeInfoModel(context=self.context)
+        theme_ver_model = ThemeVerModel(context=self.context)
+        theme_info = theme_info_model.get_entity("out_id=%s", params=[out_id])
+        if theme_info:
+            if client_json:
+                theme_ver = theme_ver_model.get_entity('out_id=%s and ver_no=%s', params=[out_id, ver_no])
+                if theme_ver:
+                    theme_ver_model.update_table('client_json=%s', 'out_id=%s and ver_no=%s', params=[client_json, out_id, ver_no])
+                else:
+                    theme_ver = ThemeVer()
+                    theme_ver.app_id = theme_info.app_id
+                    theme_ver.out_id = out_id
+                    theme_ver.theme_id = theme_info.id
+                    theme_ver.client_json = client_json
+                    theme_ver.ver_no = ver_no
+                    theme_ver.create_date = theme_info.create_date
+                    theme_ver_model.add_entity(theme_ver)
+            if server_json:
+                theme_info_model.update_table('server_json=%s', 'out_id=%s', params=[server_json, out_id])
+        else:
+            theme_total = theme_info_model.get_total()
+            if not theme_name:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "error"
+                invoke_result_data.error_message = "主题名称不能为空"
+                return invoke_result_data
+            theme_info = ThemeInfo()
+            theme_info.theme_name = theme_name
+            theme_info.server_json = server_json
+            theme_info.out_id = out_id
+            theme_info.style_type = style_type
+            theme_info.ascription_type = ascription_type
+            if app_id != "":
+                theme_info.app_id = app_id
+                theme_info.is_private = 1
+            theme_info.sort_index = int(theme_total) + 1
+            theme_info.is_release = 1
+            theme_info.create_date = SevenHelper.get_now_datetime()
+            theme_id = theme_info_model.add_entity(theme_info)
+            if theme_id:
+                theme_ver = ThemeVer()
+                theme_ver.app_id = theme_info.app_id
+                theme_ver.out_id = out_id
+                theme_ver.theme_id = theme_id
+                theme_ver.client_json = client_json
+                theme_ver.ver_no = ver_no
+                theme_ver.create_date = theme_info.create_date
+                theme_ver_model.add_entity(theme_ver)
+
+        return invoke_result_data
+
+    def save_skin(self, app_id, skin_name, client_json, server_json, theme_out_id, skin_out_id, style_type=0):
+        """
+        :description: 保存皮肤
+        :param app_id：应用标识
+        :param skin_name：皮肤名称
+        :param client_json：客户端内容json
+        :param server_json：服务端内容json
+        :param theme_out_id：样式外部id
+        :param skin_out_id：皮肤外部id
+        :param style_type：样式类型
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        if not skin_out_id:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "param_error"
+            invoke_result_data.error_message = "参数不能为空或等于0"
+            return invoke_result_data
+        skin_info_model = SkinInfoModel(context=self.context)
+        skin_info = skin_info_model.get_entity("out_id=%s", params=[skin_out_id])
+        if skin_info:
+            if client_json:
+                skin_info_model.update_table('client_json=%s', 'out_id=%s', params=[client_json, skin_out_id])
+            if server_json:
+                skin_info_model.update_table('server_json=%s', 'out_id=%s', params=[server_json, skin_out_id])
+        else:
+            skin_info_total = skin_info_model.get_total('theme_out_id=%s', params=theme_out_id)
+            if not skin_name:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "error"
+                invoke_result_data.error_message = "皮肤名称不能为空"
+                return invoke_result_data
+            theme_info_model = ThemeInfoModel(context=self.context)
+            theme_info = theme_info_model.get_entity("out_id=%s", params=theme_out_id)
+            if not theme_info:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "error"
+                invoke_result_data.error_message = "没有找到对应主题"
+                return invoke_result_data
+            skin_info = SkinInfo()
+            skin_info.skin_name = skin_name
+            skin_info.client_json = client_json
+            skin_info.server_json = server_json
+            skin_info.style_type = style_type
+            if app_id != "":
+                skin_info.app_id = app_id
+            skin_info.sort_index = skin_info_total + 1
+            skin_info.theme_id = theme_info.id
+            skin_info.create_date = SevenHelper.get_now_datetime()
+            skin_info.modify_date = SevenHelper.get_now_datetime()
+            skin_info.out_id = skin_out_id
+            skin_info.theme_out_id = theme_out_id
+            skin_id = skin_info_model.add_entity(skin_info)
+        invoke_result_data.data = skin_id
         return invoke_result_data
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/launch_base_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/launch_base_model.py`

 * *Ordering differences only*

 * *Files 9% similar despite different names*

```diff
@@ -1,544 +1,544 @@
-from asq.initiators import query
-from seven_cloudapp_frame.models.seven_model import *
-from seven_cloudapp_frame.libs.customize.seven_helper import *
-from seven_cloudapp_frame.models.act_base_model import *
-from seven_cloudapp_frame.models.top_base_model import *
-from seven_cloudapp_frame.models.db_models.act.act_info_model import *
-from seven_cloudapp_frame.models.db_models.act.act_prize_model import *
-from seven_cloudapp_frame.models.db_models.launch.launch_goods_model import *
-from seven_cloudapp_frame.models.db_models.price.price_gear_model import *
-from seven_cloudapp_frame.models.db_models.launch.launch_plan_model import *
-
-class LaunchBaseModel():
-    """
-    :description: 淘宝商品投放业务模型
-    """
-    def __init__(self, context=None, logging_error=None, logging_info=None):
-        self.context = context
-        self.logging_link_error = logging_error
-        self.logging_link_info = logging_info
-
-    def add_launch_goods(self, app_id, act_id, goods_id, old_goods_id, source_types):
-        """
-        :description: 添加商品投放
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param goods_id：投放商品ID
-        :param old_goods_id：旧投放商品ID，投放商品ID和旧投放商品ID不同的话，改变原该投放商品的状态
-        :param source_types：商品来源（1活动奖品2价格档位） 多个逗号,分隔
-        :return 实体模型InvokeResultData
-        :last_editors: HuangJianYi
-        """
-        now_datetime = SevenHelper.get_now_datetime()
-        act_base_model = ActBaseModel(context=self.context)
-        launch_goods_model = LaunchGoodsModel(context=self.context)
-        act_info_dict = act_base_model.get_act_info_dict(act_id)
-        invoke_result_data = InvokeResultData()
-        if act_info_dict and act_info_dict["is_launch"] == 0:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "无法进行投放"
-            return invoke_result_data
-        if not goods_id:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "投放商品ID不能为空或0"
-            return invoke_result_data
-        if goods_id != old_goods_id and old_goods_id:
-            is_update = True
-            if source_types:
-                source_types = list(set(source_types.split(',')))
-            for item in source_types:
-                if int(item) == 1:
-                    act_prize_total = ActPrizeModel(context=self.context).get_total("act_id=%s and goods_id=%s", params=[act_id, old_goods_id])
-                    if act_prize_total > 0 :
-                        is_update = False
-                elif int(item) == 2:
-                    price_gear_total = PriceGearModel(context=self.context).get_total("act_id=%s and goods_id=%s", params=[act_id, old_goods_id])
-                    if price_gear_total > 0 :
-                        is_update = False
-            if is_update == True:
-                launch_goods_model.update_table("is_launch=0,is_sync=0,launch_date=%s", "act_id=%s and goods_id=%s", params=[SevenHelper.get_now_datetime(), act_id, old_goods_id])
-
-        total = launch_goods_model.get_total("goods_id=%s", params=[goods_id])
-        if total <= 0:
-            launch_goods = LaunchGoods()
-            launch_goods.app_id = app_id
-            launch_goods.act_id = act_id
-            launch_goods.goods_id = goods_id
-            launch_goods.is_launch = 0
-            launch_goods.is_sync = 0
-            launch_goods.create_date = now_datetime
-            launch_goods.launch_date = now_datetime
-            launch_goods.sync_date = now_datetime
-            launch_goods_model.add_entity(launch_goods)
-
-        return invoke_result_data
-
-    def add_launch_goods_v2(self, app_id, act_id, goods_ids):
-        """
-        :description: 添加投放商品 投放2.0
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param goods_ids:商品id串
-        :return 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        if goods_ids != "":
-            launch_goods_model = LaunchGoodsModel(context=self)
-            goods_id_list = goods_ids.split(',')
-            for goods_id in goods_id_list:
-                total = launch_goods_model.get_total("goods_id=%s", params=[goods_id])
-                if total <= 0:
-                    launch_goods = LaunchGoods()
-                    launch_goods.app_id = app_id
-                    launch_goods.act_id = act_id
-                    launch_goods.goods_id = goods_id
-                    launch_goods.is_launch = 0
-                    launch_goods.is_sync = 0
-                    launch_goods.error_message = ""
-                    launch_goods.create_date = SevenHelper.get_now_datetime()
-                    launch_goods.launch_date = SevenHelper.get_now_datetime()
-                    launch_goods_model.add_entity(launch_goods)
-        return invoke_result_data
-
-    def update_launch_goods(self, act_id, goods_id, source_types):
-        """
-        :description: 修改投放商品为未投放未同步
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param goods_id：投放商品ID
-        :param source_types：商品来源（1活动奖品商品2价格档位商品） 多个逗号,分隔
-        :return 实体模型InvokeResultData
-        :last_editors: HuangJianYi
-        """
-        act_base_model = ActBaseModel(context=self.context)
-        launch_goods_model = LaunchGoodsModel(context=self.context)
-        act_info_dict = act_base_model.get_act_info_dict(act_id)
-        invoke_result_data = InvokeResultData()
-        if act_info_dict and act_info_dict["is_launch"] == 0:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "无法进行投放"
-            return invoke_result_data
-        is_update = True
-        if source_types:
-            source_types = list(set(source_types.split(',')))
-        for item in source_types:
-            if int(item) == 1:
-                act_prize_total = ActPrizeModel(context=self.context).get_total("act_id=%s and goods_id=%s", params=[act_id, goods_id])
-                if act_prize_total > 0 :
-                    is_update = False
-            elif int(item) == 2:
-                price_gear_total = PriceGearModel(context=self.context).get_total("act_id=%s and goods_id=%s", params=[act_id, goods_id])
-                if price_gear_total > 0 :
-                    is_update = False
-        if is_update == True:
-            launch_goods_model.update_table("is_launch=0,is_sync=0,launch_date=%s", "act_id=%s and goods_id=%s", params=[SevenHelper.get_now_datetime(), act_id, goods_id])
-        return invoke_result_data
-
-    def init_launch_goods(self, app_id, act_id, source_types, online_url):
-        """
-        :description: 初始化活动投放,用于创建活动时调用
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param source_types：商品来源（1活动奖品商品2价格档位商品） 多个逗号,分隔
-        :param online_url:投放地址
-        :return 实体模型InvokeResultData
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        act_base_model = ActBaseModel(context=self.context)
-        act_info_dict = act_base_model.get_act_info_dict(act_id)
-        if not act_info_dict:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "活动不存在"
-            return invoke_result_data
-        goods_id_list = []
-        if source_types:
-            source_types = list(set(source_types.split(',')))
-        for item in source_types:
-            if int(item) == 1:
-                prize_goods_id_list = ActPrizeModel(context=self.context).get_dict_list("act_id=%s and goods_id!='' and is_del=0", field="goods_id", params=[act_id])
-                if len(prize_goods_id_list) > 0:
-                    goods_id_list += [str(goods_id["goods_id"]) for goods_id in prize_goods_id_list]
-            elif int(item) == 2:
-                gear_goods_id_list = PriceGearModel(context=self.context).get_dict_list("act_id=%s and goods_id!='' and is_del=0", field="goods_id", params=[act_id])
-                if len(gear_goods_id_list) > 0:
-                    goods_id_list += [str(goods_id["goods_id"]) for goods_id in gear_goods_id_list]
-        goods_id_list = list(set(goods_id_list))
-        if len(goods_id_list) == 0:
-            result_data = {"url": online_url, "act_name": act_info_dict['act_name'], "goods_list": []}
-            invoke_result_data.data = result_data
-            return invoke_result_data
-
-        launch_goods_model = LaunchGoodsModel(context=self.context)
-        goods_exist_list = launch_goods_model.get_dict_list("act_id<>%s and " + SevenHelper.get_condition_by_str_list("goods_id",goods_id_list), field="goods_id", params=act_id)
-        goods_id_exist_list = [str(i["goods_id"]) for i in goods_exist_list]
-        goods_list = []
-        now_datetime = SevenHelper.get_now_datetime()
-        for goods_id in goods_id_list:
-            launch_goods = LaunchGoods()
-            launch_goods.app_id = app_id
-            launch_goods.act_id = act_id
-            launch_goods.goods_id = goods_id
-            if goods_id in goods_id_exist_list:
-                launch_goods.is_launch = 0
-                launch_goods.is_sync = 0
-            else:
-                launch_goods.is_launch = 1
-                launch_goods.is_sync = 1
-
-            launch_goods.create_date = now_datetime
-            launch_goods.launch_date = now_datetime
-            launch_goods.sync_date = now_datetime
-            goods_list.append(launch_goods)
-
-        launch_goods_model.add_list(goods_list)
-        result_data = {"url": online_url, "act_name": act_info_dict['act_name'], "goods_list": goods_id_list}
-        invoke_result_data.data = result_data
-        return invoke_result_data
-
-    def async_launch_goods(self, app_id, act_id, online_url, access_token, app_key, app_secret, is_log=False):
-        """
-        :description: 同步投放商品（小程序投放-商品绑定/解绑）
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param online_url:投放地址
-        :param access_token:access_token
-        :param app_key:app_key
-        :param app_secret:app_secret
-        :param is_log：是否记录返回信息
-        :return 实体模型InvokeResultData
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        act_base_model = ActBaseModel(context=self.context)
-        act_info_dict = act_base_model.get_act_info_dict(act_id)
-        if not act_info_dict:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "活动不存在"
-            return invoke_result_data
-        top_base_model = TopBaseModel(context=self.context)
-        launch_goods_model = LaunchGoodsModel(context=self.context)
-        launch_goods_list = launch_goods_model.get_list("app_id=%s and act_id=%s and is_sync=0 and is_launch=1", params=[app_id,act_id])
-        no_launch_goods_list = launch_goods_model.get_list("app_id=%s and act_id=%s and is_sync=0 and is_launch=0", params=[app_id,act_id])
-        # 同步不投放的商品
-        if len(no_launch_goods_list) > 0:
-
-            no_launch_goods_id_list = [str(no_launch_goods.goods_id) for no_launch_goods in no_launch_goods_list]
-            no_launch_goods_id_list = list(set(no_launch_goods_id_list))
-            no_launch_goods_ids = ",".join(no_launch_goods_id_list)
-
-            update_no_launch_goods_list = []
-            # 淘宝top接口
-            invoke_result_data = top_base_model.miniapp_distribution_items_bind(no_launch_goods_ids, online_url, 'false',access_token,app_key, app_secret, is_log)
-            if invoke_result_data.success == False:
-                return invoke_result_data
-            resp = invoke_result_data.data
-            async_result = resp["miniapp_distribution_items_bind_response"]["model_list"]["distribution_order_bind_target_entity_open_result_dto"][0]["bind_result_list"]["distribution_order_bind_base_dto"]
-            for async_result_info in async_result:
-                no_launch_goods = [no_launch_goods for no_launch_goods in no_launch_goods_list if str(no_launch_goods.goods_id) == async_result_info["target_entity_id"]]
-                if len(no_launch_goods) > 0:
-                    if async_result_info["success"] == True:
-                        no_launch_goods[0].is_sync = 1
-                        no_launch_goods[0].sync_date = SevenHelper.get_now_datetime()
-                    else:
-                        no_launch_goods[0].error_message = async_result_info["fail_msg"]
-                    update_no_launch_goods_list.append(no_launch_goods[0])
-
-            launch_goods_model.update_list(update_no_launch_goods_list)
-
-        # 同步投放的商品
-        if len(launch_goods_list) > 0:
-            launch_goods_id_list = [str(launch_goods.goods_id) for launch_goods in launch_goods_list]
-            launch_goods_id_list = list(set(launch_goods_id_list))
-            launch_goods_ids = ",".join(launch_goods_id_list)
-
-            update_launch_goods_list = []
-            # 淘宝top接口
-            invoke_result_data = top_base_model.miniapp_distribution_items_bind(launch_goods_ids, online_url, 'true',access_token,app_key, app_secret, is_log)
-            if invoke_result_data.success == False:
-                return invoke_result_data
-            resp = invoke_result_data.data
-            async_result = resp["miniapp_distribution_items_bind_response"]["model_list"]["distribution_order_bind_target_entity_open_result_dto"][0]["bind_result_list"]["distribution_order_bind_base_dto"]
-            for async_result_info in async_result:
-                launch_goods = [launch_goods for launch_goods in launch_goods_list if str(launch_goods.goods_id) == async_result_info["target_entity_id"]]
-                if len(launch_goods) > 0:
-                    if async_result_info["success"] == True:
-                        launch_goods[0].is_sync = 1
-                        launch_goods[0].sync_date = SevenHelper.get_now_datetime()
-                    else:
-                        launch_goods[0].is_launch = 0
-                        launch_goods[0].is_sync = 1
-                        launch_goods[0].error_message = async_result_info["fail_msg"]
-                    update_launch_goods_list.append(launch_goods[0])
-
-            launch_goods_model.update_list(update_launch_goods_list)
-
-        return invoke_result_data
-
-    def get_launch_goods_list(self, app_id, act_id, page_size, page_index, access_token, app_key, app_secret, goods_id="", launch_status=-1):
-        """
-        :description: 获取投放商品列表
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param page_size:条数
-        :param page_index:页数
-        :param access_token:access_token
-        :param app_key:app_key
-        :param app_secret:app_secret
-        :param goods_id:商品id
-        :param launch_status:投放状态
-        :return 实体模型InvokeResultData
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        act_base_model = ActBaseModel(context=self.context)
-        act_info_dict = act_base_model.get_act_info_dict(act_id)
-        if not act_info_dict:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "活动不存在"
-            return invoke_result_data
-        launch_goods_model = LaunchGoodsModel(context=self.context)
-        condition = "app_id=%s and act_id=%s"
-        params = [app_id, act_id]
-        if goods_id != "":
-            condition += " and goods_id =%s"
-            params.append(goods_id)
-        if launch_status != -1:
-            condition += " and is_launch=%s"
-            params.append(launch_status)
-
-        launch_goods_list, total = launch_goods_model.get_dict_page_list("*", page_index, page_size, condition, "", "id desc", params=params)
-
-        top_base_model = TopBaseModel(context=self.context)
-        #获取商品信息
-        goods_list = []
-        if len(launch_goods_list) > 0:
-            goods_ids = ",".join([str(launch_goods["goods_id"]) for launch_goods in launch_goods_list])
-
-            invoke_result_data = top_base_model.get_goods_list_by_goodsids(goods_ids, access_token,app_key,app_secret)
-            if invoke_result_data.success == False:
-                return invoke_result_data
-            resq = invoke_result_data.data
-            if "items_seller_list_get_response" in resq.keys():
-                if "item" in resq["items_seller_list_get_response"]["items"].keys():
-                    goods_list = resq["items_seller_list_get_response"]["items"]["item"]
-            else:
-                invoke_result_data.success = False
-                invoke_result_data.error_code = resq["error_code"]
-                invoke_result_data.error_message = resq["error_message"]
-                return invoke_result_data
-        if len(goods_list)>0:
-            launch_goods_list = SevenHelper.merge_dict_list(launch_goods_list, "goods_id", goods_list, "num_iid", "pic_url,title")
-        page_info = PageInfo(page_index, page_size, total, launch_goods_list)
-        invoke_result_data.data = {"is_launch": act_info_dict['is_launch'], "page_info": page_info.__dict__}
-        return invoke_result_data
-
-    def reset_launch_goods(self, app_id, act_id, close_goods_id):
-        """
-        :description: 重置商品投放 删除已投放的记录并将活动投放状态改为未投放
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param close_goods_id：投放失败时关闭投放的商品ID  多个逗号,分隔
-        :return 实体模型InvokeResultData
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-
-        ActInfoModel(context=self).update_table("is_launch=0", "app_id=%s and id=%s", params=[app_id, act_id])
-        ActBaseModel(context=self)._delete_act_info_dependency_key(app_id, act_id)
-        if close_goods_id != "":
-            close_goods_id_list = list(set(close_goods_id.split(",")))
-            LaunchGoodsModel(context=self).update_table("is_launch=0,launch_date=%s", "act_id=%s and " + SevenHelper.get_condition_by_str_list("goods_id", close_goods_id_list), params=[SevenHelper.get_now_datetime(), act_id])
-        else:
-            LaunchGoodsModel(context=self).del_entity("app_id=%s and id=%s", params=[app_id, act_id])
-        
-        #保存投放计划信息
-        tb_launch_plan = None
-        if call_back_info != "":
-            call_back_info = SevenHelper.json_loads(call_back_info)
-            for cur_tb_launch_plan in call_back_info["putSuccessList"]:
-                if cur_tb_launch_plan["sceneInfo"]["id"] == 1:
-                    tb_launch_plan = cur_tb_launch_plan
-                    break
-
-        if tb_launch_plan:
-            launch_plan_model = LaunchPlanModel(context=self)
-            launch_plan = launch_plan_model.get_entity("tb_launch_id=%s", params=[tb_launch_plan["id"]])
-            if not launch_plan:
-                launch_plan = LaunchPlan()
-                launch_plan.app_id = app_id
-                launch_plan.act_id = act_id
-                launch_plan.tb_launch_id = tb_launch_plan["id"]
-                launch_plan.launch_url = tb_launch_plan["previewUrl"]
-                launch_plan.start_date = tb_launch_plan["startTime"].replace('年', '-').replace('月', '-').replace('日', ' ') + tb_launch_plan["startTimeBottm"]
-                launch_plan.end_date = tb_launch_plan["endTime"].replace('年', '-').replace('月', '-').replace('日', ' ') + tb_launch_plan["endTimeBottom"]
-                if tb_launch_plan["status"] == "未开始":
-                    launch_plan.status = 0
-                elif tb_launch_plan["status"] == "进行中":
-                    launch_plan.status = 1
-                elif tb_launch_plan["status"] == "已结束":
-                    launch_plan.status = 2
-                launch_plan.create_date = SevenHelper.get_now_datetime()
-                launch_plan.modify_date = SevenHelper.get_now_datetime()
-                launch_plan_model.add_entity(launch_plan)
-            return invoke_result_data
-    
-    def init_launch_goods_callback(self, app_id, act_id, close_goods_id, call_back_info):
-        """
-        :description: 初始化投放商品回调接口
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param close_goods_id：投放失败时关闭投放的商品ID  多个逗号,分隔
-        :param call_back_info：回调信息
-        :return 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        if close_goods_id != "":
-            close_goods_id_list = list(set(close_goods_id.split(",")))
-            LaunchGoodsModel(context=self).update_table("is_launch=0,launch_date=%s", "act_id=%s and "+ SevenHelper.get_condition_by_str_list("goods_id",close_goods_id_list), params=[SevenHelper.get_now_datetime(),act_id])
-        #保存投放计划信息
-        tb_launch_plan = None
-        if call_back_info != "":
-            call_back_info = SevenHelper.json_loads(call_back_info)
-            for cur_tb_launch_plan in call_back_info["putSuccessList"]:
-                if cur_tb_launch_plan["sceneInfo"]["id"] == 1:
-                    tb_launch_plan = cur_tb_launch_plan
-                    break
-
-        if tb_launch_plan:
-            launch_plan_model = LaunchPlanModel(context=self)
-            launch_plan = launch_plan_model.get_entity("tb_launch_id=%s", params=[tb_launch_plan["id"]])
-            if not launch_plan:
-                launch_plan = LaunchPlan()
-                launch_plan.app_id = app_id
-                launch_plan.act_id = act_id
-                launch_plan.tb_launch_id = tb_launch_plan["id"]
-                launch_plan.launch_url = tb_launch_plan["previewUrl"]
-                launch_plan.start_date = tb_launch_plan["startTime"].replace('年', '-').replace('月', '-').replace('日', ' ') + tb_launch_plan["startTimeBottm"]
-                launch_plan.end_date = tb_launch_plan["endTime"].replace('年', '-').replace('月', '-').replace('日', ' ') + tb_launch_plan["endTimeBottom"]
-                if tb_launch_plan["status"] == "未开始":
-                    launch_plan.status = 0
-                elif tb_launch_plan["status"] == "进行中":
-                    launch_plan.status = 1
-                elif tb_launch_plan["status"] == "已结束":
-                    launch_plan.status = 2
-                launch_plan.create_date = SevenHelper.get_now_datetime()
-                launch_plan.modify_date = SevenHelper.get_now_datetime()
-                launch_plan_model.add_entity(launch_plan)
-            ActInfoModel(context=self).update_table("is_launch=1", "id=%s", params=act_id)
-            ActBaseModel(context=self)._delete_act_info_dependency_key(app_id,act_id)
-            
-        return invoke_result_data
-
-    def get_launch_plan_status(self, act_id, access_token ,app_key, app_secret):
-        """
-        :description: 获取投放计划状态
-        :param act_id：活动标识
-        :param access_token:access_token
-        :param app_key:app_key
-        :param app_secret:app_secret
-        :return 
-        :last_editors: HuangJianYi
-        """
-        launch_status = 1  #投放状态，0:未开始， 1：进行中，2/3:已结束，其他为平台状态
-        launch_plan_model = LaunchPlanModel(context=self)
-        launch_plan_dict = launch_plan_model.get_dict("act_id=%s", order_by="id desc",field="tb_launch_id", params=[act_id])
-
-        act_info_model = ActInfoModel(context=self)
-        act_info_dict = act_info_model.get_dict("id=%s",field="is_launch", params=[act_id])
-        if not launch_plan_dict:
-            if act_info_dict:
-                if act_info_dict["is_launch"] == 1:
-                    return launch_status
-                else:
-                    return 0
-            else:
-                return 0
-        top_base_model = TopBaseModel(context=self)
-        invoke_result_data = top_base_model.miniapp_distribution_order_get(launch_plan_dict["tb_launch_id"], access_token, app_key, app_secret)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        tb_launch_status = invoke_result_data.data["miniapp_distribution_order_get_response"]["model"]["distribution_order_open_biz_dto"][0]["status"]
-        if tb_launch_status == 0:
-            tb_launch_status = 1
-        if tb_launch_status == 2 and act_info_dict["is_launch"] == 0:
-            tb_launch_status = 0
-        launch_status = tb_launch_status
-        return launch_status
-
-    def can_launch_goods_list(self, page_index, page_size, goods_name, order_tag, order_by, access_token, app_key, app_secret, is_log=False):
-        """
-        :description: 导入商品列表（获取当前会话用户出售中的商品列表）
-        :param page_index：页索引
-        :param page_size：页大小
-        :param goods_name：商品名称
-        :param order_tag：order_tag
-        :param order_by：排序类型
-        :return 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-
-        top_base_model = TopBaseModel(context=self)
-        app_key, app_secret = self.get_app_key_secret()
-        invoke_result_data = top_base_model.get_goods_list(page_index, page_size, goods_name, order_tag, order_by, access_token, app_key, app_secret, is_log=is_log)
-        if invoke_result_data.success == False:
-            return invoke_result_data
-
-        goods_id_list = [str(goods["num_iid"]) for goods in invoke_result_data.data["items_onsale_get_response"]["items"]["item"]]
-        goods_id_in_condition = SevenHelper.get_condition_by_str_list("goods_id", goods_id_list)
-        launch_goods_model = LaunchGoodsModel(context=self)
-        launch_goods_list = launch_goods_model.get_list(goods_id_in_condition)
-        act_id_list = [launch_goods.act_id for launch_goods in launch_goods_list]
-        act_id_list = list(set(act_id_list))
-        act_id_in_condition = SevenHelper.get_condition_by_int_list("id",act_id_list)
-
-        act_info_model = ActInfoModel(context=self)
-        act_info_list = act_info_model.get_list(act_id_in_condition)
-
-        for goods in invoke_result_data.data["items_onsale_get_response"]["items"]["item"]:
-            launch_goods = query(launch_goods_list).first_or_default(None, lambda x: x.goods_id == str(goods["num_iid"]))
-            if launch_goods:
-                goods["is_select"] = 1
-                goods["bind_act_id"] = launch_goods.act_id
-                act_info = query(act_info_list).first_or_default(None, lambda x: x.id == goods["bind_act_id"])
-                if act_info:
-                    goods["bind_act_name"] = act_info.act_name
-                else:
-                    goods["bind_act_name"] = ""
-            else:
-                goods["is_select"] = 0
-                goods["bind_act_id"] = 0
-                goods["bind_act_name"] = ""
-        
-        return invoke_result_data
-
-    def get_launch_progress(self,act_id):
-        """
-        :description: 获取投放进度
-        :param act_id：活动标识
-        :return 投放进度 0未完成  1：已完成
-        :last_editors: HuangJianYi
-        """
-        redis_init = SevenHelper.redis_init()
-        redis_data = redis_init.lrange("queue_async_lauch",0,-1)
-
-        progress = 0 #投放进度  0未完成  1：已完成
-        if not redis_data:
-            progress = 1
-        elif len(redis_data) == 0:
-            progress = 1
-        else:
-            for data in redis_data:
-                if str(act_id) == data:
-                    progress = 0
-                    break
-        return progress
+from asq.initiators import query
+from seven_cloudapp_frame.models.seven_model import *
+from seven_cloudapp_frame.libs.customize.seven_helper import *
+from seven_cloudapp_frame.models.act_base_model import *
+from seven_cloudapp_frame.models.top_base_model import *
+from seven_cloudapp_frame.models.db_models.act.act_info_model import *
+from seven_cloudapp_frame.models.db_models.act.act_prize_model import *
+from seven_cloudapp_frame.models.db_models.launch.launch_goods_model import *
+from seven_cloudapp_frame.models.db_models.price.price_gear_model import *
+from seven_cloudapp_frame.models.db_models.launch.launch_plan_model import *
+
+class LaunchBaseModel():
+    """
+    :description: 淘宝商品投放业务模型
+    """
+    def __init__(self, context=None, logging_error=None, logging_info=None):
+        self.context = context
+        self.logging_link_error = logging_error
+        self.logging_link_info = logging_info
+
+    def add_launch_goods(self, app_id, act_id, goods_id, old_goods_id, source_types):
+        """
+        :description: 添加商品投放
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param goods_id：投放商品ID
+        :param old_goods_id：旧投放商品ID，投放商品ID和旧投放商品ID不同的话，改变原该投放商品的状态
+        :param source_types：商品来源（1活动奖品2价格档位） 多个逗号,分隔
+        :return 实体模型InvokeResultData
+        :last_editors: HuangJianYi
+        """
+        now_datetime = SevenHelper.get_now_datetime()
+        act_base_model = ActBaseModel(context=self.context)
+        launch_goods_model = LaunchGoodsModel(context=self.context)
+        act_info_dict = act_base_model.get_act_info_dict(act_id)
+        invoke_result_data = InvokeResultData()
+        if act_info_dict and act_info_dict["is_launch"] == 0:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "无法进行投放"
+            return invoke_result_data
+        if not goods_id:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "投放商品ID不能为空或0"
+            return invoke_result_data
+        if goods_id != old_goods_id and old_goods_id:
+            is_update = True
+            if source_types:
+                source_types = list(set(source_types.split(',')))
+            for item in source_types:
+                if int(item) == 1:
+                    act_prize_total = ActPrizeModel(context=self.context).get_total("act_id=%s and goods_id=%s", params=[act_id, old_goods_id])
+                    if act_prize_total > 0 :
+                        is_update = False
+                elif int(item) == 2:
+                    price_gear_total = PriceGearModel(context=self.context).get_total("act_id=%s and goods_id=%s", params=[act_id, old_goods_id])
+                    if price_gear_total > 0 :
+                        is_update = False
+            if is_update == True:
+                launch_goods_model.update_table("is_launch=0,is_sync=0,launch_date=%s", "act_id=%s and goods_id=%s", params=[SevenHelper.get_now_datetime(), act_id, old_goods_id])
+
+        total = launch_goods_model.get_total("goods_id=%s", params=[goods_id])
+        if total <= 0:
+            launch_goods = LaunchGoods()
+            launch_goods.app_id = app_id
+            launch_goods.act_id = act_id
+            launch_goods.goods_id = goods_id
+            launch_goods.is_launch = 0
+            launch_goods.is_sync = 0
+            launch_goods.create_date = now_datetime
+            launch_goods.launch_date = now_datetime
+            launch_goods.sync_date = now_datetime
+            launch_goods_model.add_entity(launch_goods)
+
+        return invoke_result_data
+
+    def add_launch_goods_v2(self, app_id, act_id, goods_ids):
+        """
+        :description: 添加投放商品 投放2.0
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param goods_ids:商品id串
+        :return 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        if goods_ids != "":
+            launch_goods_model = LaunchGoodsModel(context=self)
+            goods_id_list = goods_ids.split(',')
+            for goods_id in goods_id_list:
+                total = launch_goods_model.get_total("goods_id=%s", params=[goods_id])
+                if total <= 0:
+                    launch_goods = LaunchGoods()
+                    launch_goods.app_id = app_id
+                    launch_goods.act_id = act_id
+                    launch_goods.goods_id = goods_id
+                    launch_goods.is_launch = 0
+                    launch_goods.is_sync = 0
+                    launch_goods.error_message = ""
+                    launch_goods.create_date = SevenHelper.get_now_datetime()
+                    launch_goods.launch_date = SevenHelper.get_now_datetime()
+                    launch_goods_model.add_entity(launch_goods)
+        return invoke_result_data
+
+    def update_launch_goods(self, act_id, goods_id, source_types):
+        """
+        :description: 修改投放商品为未投放未同步
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param goods_id：投放商品ID
+        :param source_types：商品来源（1活动奖品商品2价格档位商品） 多个逗号,分隔
+        :return 实体模型InvokeResultData
+        :last_editors: HuangJianYi
+        """
+        act_base_model = ActBaseModel(context=self.context)
+        launch_goods_model = LaunchGoodsModel(context=self.context)
+        act_info_dict = act_base_model.get_act_info_dict(act_id)
+        invoke_result_data = InvokeResultData()
+        if act_info_dict and act_info_dict["is_launch"] == 0:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "无法进行投放"
+            return invoke_result_data
+        is_update = True
+        if source_types:
+            source_types = list(set(source_types.split(',')))
+        for item in source_types:
+            if int(item) == 1:
+                act_prize_total = ActPrizeModel(context=self.context).get_total("act_id=%s and goods_id=%s", params=[act_id, goods_id])
+                if act_prize_total > 0 :
+                    is_update = False
+            elif int(item) == 2:
+                price_gear_total = PriceGearModel(context=self.context).get_total("act_id=%s and goods_id=%s", params=[act_id, goods_id])
+                if price_gear_total > 0 :
+                    is_update = False
+        if is_update == True:
+            launch_goods_model.update_table("is_launch=0,is_sync=0,launch_date=%s", "act_id=%s and goods_id=%s", params=[SevenHelper.get_now_datetime(), act_id, goods_id])
+        return invoke_result_data
+
+    def init_launch_goods(self, app_id, act_id, source_types, online_url):
+        """
+        :description: 初始化活动投放,用于创建活动时调用
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param source_types：商品来源（1活动奖品商品2价格档位商品） 多个逗号,分隔
+        :param online_url:投放地址
+        :return 实体模型InvokeResultData
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        act_base_model = ActBaseModel(context=self.context)
+        act_info_dict = act_base_model.get_act_info_dict(act_id)
+        if not act_info_dict:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "活动不存在"
+            return invoke_result_data
+        goods_id_list = []
+        if source_types:
+            source_types = list(set(source_types.split(',')))
+        for item in source_types:
+            if int(item) == 1:
+                prize_goods_id_list = ActPrizeModel(context=self.context).get_dict_list("act_id=%s and goods_id!='' and is_del=0", field="goods_id", params=[act_id])
+                if len(prize_goods_id_list) > 0:
+                    goods_id_list += [str(goods_id["goods_id"]) for goods_id in prize_goods_id_list]
+            elif int(item) == 2:
+                gear_goods_id_list = PriceGearModel(context=self.context).get_dict_list("act_id=%s and goods_id!='' and is_del=0", field="goods_id", params=[act_id])
+                if len(gear_goods_id_list) > 0:
+                    goods_id_list += [str(goods_id["goods_id"]) for goods_id in gear_goods_id_list]
+        goods_id_list = list(set(goods_id_list))
+        if len(goods_id_list) == 0:
+            result_data = {"url": online_url, "act_name": act_info_dict['act_name'], "goods_list": []}
+            invoke_result_data.data = result_data
+            return invoke_result_data
+
+        launch_goods_model = LaunchGoodsModel(context=self.context)
+        goods_exist_list = launch_goods_model.get_dict_list("act_id<>%s and " + SevenHelper.get_condition_by_str_list("goods_id",goods_id_list), field="goods_id", params=act_id)
+        goods_id_exist_list = [str(i["goods_id"]) for i in goods_exist_list]
+        goods_list = []
+        now_datetime = SevenHelper.get_now_datetime()
+        for goods_id in goods_id_list:
+            launch_goods = LaunchGoods()
+            launch_goods.app_id = app_id
+            launch_goods.act_id = act_id
+            launch_goods.goods_id = goods_id
+            if goods_id in goods_id_exist_list:
+                launch_goods.is_launch = 0
+                launch_goods.is_sync = 0
+            else:
+                launch_goods.is_launch = 1
+                launch_goods.is_sync = 1
+
+            launch_goods.create_date = now_datetime
+            launch_goods.launch_date = now_datetime
+            launch_goods.sync_date = now_datetime
+            goods_list.append(launch_goods)
+
+        launch_goods_model.add_list(goods_list)
+        result_data = {"url": online_url, "act_name": act_info_dict['act_name'], "goods_list": goods_id_list}
+        invoke_result_data.data = result_data
+        return invoke_result_data
+
+    def async_launch_goods(self, app_id, act_id, online_url, access_token, app_key, app_secret, is_log=False):
+        """
+        :description: 同步投放商品（小程序投放-商品绑定/解绑）
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param online_url:投放地址
+        :param access_token:access_token
+        :param app_key:app_key
+        :param app_secret:app_secret
+        :param is_log：是否记录返回信息
+        :return 实体模型InvokeResultData
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        act_base_model = ActBaseModel(context=self.context)
+        act_info_dict = act_base_model.get_act_info_dict(act_id)
+        if not act_info_dict:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "活动不存在"
+            return invoke_result_data
+        top_base_model = TopBaseModel(context=self.context)
+        launch_goods_model = LaunchGoodsModel(context=self.context)
+        launch_goods_list = launch_goods_model.get_list("app_id=%s and act_id=%s and is_sync=0 and is_launch=1", params=[app_id,act_id])
+        no_launch_goods_list = launch_goods_model.get_list("app_id=%s and act_id=%s and is_sync=0 and is_launch=0", params=[app_id,act_id])
+        # 同步不投放的商品
+        if len(no_launch_goods_list) > 0:
+
+            no_launch_goods_id_list = [str(no_launch_goods.goods_id) for no_launch_goods in no_launch_goods_list]
+            no_launch_goods_id_list = list(set(no_launch_goods_id_list))
+            no_launch_goods_ids = ",".join(no_launch_goods_id_list)
+
+            update_no_launch_goods_list = []
+            # 淘宝top接口
+            invoke_result_data = top_base_model.miniapp_distribution_items_bind(no_launch_goods_ids, online_url, 'false',access_token,app_key, app_secret, is_log)
+            if invoke_result_data.success == False:
+                return invoke_result_data
+            resp = invoke_result_data.data
+            async_result = resp["miniapp_distribution_items_bind_response"]["model_list"]["distribution_order_bind_target_entity_open_result_dto"][0]["bind_result_list"]["distribution_order_bind_base_dto"]
+            for async_result_info in async_result:
+                no_launch_goods = [no_launch_goods for no_launch_goods in no_launch_goods_list if str(no_launch_goods.goods_id) == async_result_info["target_entity_id"]]
+                if len(no_launch_goods) > 0:
+                    if async_result_info["success"] == True:
+                        no_launch_goods[0].is_sync = 1
+                        no_launch_goods[0].sync_date = SevenHelper.get_now_datetime()
+                    else:
+                        no_launch_goods[0].error_message = async_result_info["fail_msg"]
+                    update_no_launch_goods_list.append(no_launch_goods[0])
+
+            launch_goods_model.update_list(update_no_launch_goods_list)
+
+        # 同步投放的商品
+        if len(launch_goods_list) > 0:
+            launch_goods_id_list = [str(launch_goods.goods_id) for launch_goods in launch_goods_list]
+            launch_goods_id_list = list(set(launch_goods_id_list))
+            launch_goods_ids = ",".join(launch_goods_id_list)
+
+            update_launch_goods_list = []
+            # 淘宝top接口
+            invoke_result_data = top_base_model.miniapp_distribution_items_bind(launch_goods_ids, online_url, 'true',access_token,app_key, app_secret, is_log)
+            if invoke_result_data.success == False:
+                return invoke_result_data
+            resp = invoke_result_data.data
+            async_result = resp["miniapp_distribution_items_bind_response"]["model_list"]["distribution_order_bind_target_entity_open_result_dto"][0]["bind_result_list"]["distribution_order_bind_base_dto"]
+            for async_result_info in async_result:
+                launch_goods = [launch_goods for launch_goods in launch_goods_list if str(launch_goods.goods_id) == async_result_info["target_entity_id"]]
+                if len(launch_goods) > 0:
+                    if async_result_info["success"] == True:
+                        launch_goods[0].is_sync = 1
+                        launch_goods[0].sync_date = SevenHelper.get_now_datetime()
+                    else:
+                        launch_goods[0].is_launch = 0
+                        launch_goods[0].is_sync = 1
+                        launch_goods[0].error_message = async_result_info["fail_msg"]
+                    update_launch_goods_list.append(launch_goods[0])
+
+            launch_goods_model.update_list(update_launch_goods_list)
+
+        return invoke_result_data
+
+    def get_launch_goods_list(self, app_id, act_id, page_size, page_index, access_token, app_key, app_secret, goods_id="", launch_status=-1):
+        """
+        :description: 获取投放商品列表
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param page_size:条数
+        :param page_index:页数
+        :param access_token:access_token
+        :param app_key:app_key
+        :param app_secret:app_secret
+        :param goods_id:商品id
+        :param launch_status:投放状态
+        :return 实体模型InvokeResultData
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        act_base_model = ActBaseModel(context=self.context)
+        act_info_dict = act_base_model.get_act_info_dict(act_id)
+        if not act_info_dict:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "活动不存在"
+            return invoke_result_data
+        launch_goods_model = LaunchGoodsModel(context=self.context)
+        condition = "app_id=%s and act_id=%s"
+        params = [app_id, act_id]
+        if goods_id != "":
+            condition += " and goods_id =%s"
+            params.append(goods_id)
+        if launch_status != -1:
+            condition += " and is_launch=%s"
+            params.append(launch_status)
+
+        launch_goods_list, total = launch_goods_model.get_dict_page_list("*", page_index, page_size, condition, "", "id desc", params=params)
+
+        top_base_model = TopBaseModel(context=self.context)
+        #获取商品信息
+        goods_list = []
+        if len(launch_goods_list) > 0:
+            goods_ids = ",".join([str(launch_goods["goods_id"]) for launch_goods in launch_goods_list])
+
+            invoke_result_data = top_base_model.get_goods_list_by_goodsids(goods_ids, access_token,app_key,app_secret)
+            if invoke_result_data.success == False:
+                return invoke_result_data
+            resq = invoke_result_data.data
+            if "items_seller_list_get_response" in resq.keys():
+                if "item" in resq["items_seller_list_get_response"]["items"].keys():
+                    goods_list = resq["items_seller_list_get_response"]["items"]["item"]
+            else:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = resq["error_code"]
+                invoke_result_data.error_message = resq["error_message"]
+                return invoke_result_data
+        if len(goods_list)>0:
+            launch_goods_list = SevenHelper.merge_dict_list(launch_goods_list, "goods_id", goods_list, "num_iid", "pic_url,title")
+        page_info = PageInfo(page_index, page_size, total, launch_goods_list)
+        invoke_result_data.data = {"is_launch": act_info_dict['is_launch'], "page_info": page_info.__dict__}
+        return invoke_result_data
+
+    def reset_launch_goods(self, app_id, act_id, close_goods_id):
+        """
+        :description: 重置商品投放 删除已投放的记录并将活动投放状态改为未投放
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param close_goods_id：投放失败时关闭投放的商品ID  多个逗号,分隔
+        :return 实体模型InvokeResultData
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+
+        ActInfoModel(context=self).update_table("is_launch=0", "app_id=%s and id=%s", params=[app_id, act_id])
+        ActBaseModel(context=self)._delete_act_info_dependency_key(app_id, act_id)
+        if close_goods_id != "":
+            close_goods_id_list = list(set(close_goods_id.split(",")))
+            LaunchGoodsModel(context=self).update_table("is_launch=0,launch_date=%s", "act_id=%s and " + SevenHelper.get_condition_by_str_list("goods_id", close_goods_id_list), params=[SevenHelper.get_now_datetime(), act_id])
+        else:
+            LaunchGoodsModel(context=self).del_entity("app_id=%s and id=%s", params=[app_id, act_id])
+        
+        #保存投放计划信息
+        tb_launch_plan = None
+        if call_back_info != "":
+            call_back_info = SevenHelper.json_loads(call_back_info)
+            for cur_tb_launch_plan in call_back_info["putSuccessList"]:
+                if cur_tb_launch_plan["sceneInfo"]["id"] == 1:
+                    tb_launch_plan = cur_tb_launch_plan
+                    break
+
+        if tb_launch_plan:
+            launch_plan_model = LaunchPlanModel(context=self)
+            launch_plan = launch_plan_model.get_entity("tb_launch_id=%s", params=[tb_launch_plan["id"]])
+            if not launch_plan:
+                launch_plan = LaunchPlan()
+                launch_plan.app_id = app_id
+                launch_plan.act_id = act_id
+                launch_plan.tb_launch_id = tb_launch_plan["id"]
+                launch_plan.launch_url = tb_launch_plan["previewUrl"]
+                launch_plan.start_date = tb_launch_plan["startTime"].replace('年', '-').replace('月', '-').replace('日', ' ') + tb_launch_plan["startTimeBottm"]
+                launch_plan.end_date = tb_launch_plan["endTime"].replace('年', '-').replace('月', '-').replace('日', ' ') + tb_launch_plan["endTimeBottom"]
+                if tb_launch_plan["status"] == "未开始":
+                    launch_plan.status = 0
+                elif tb_launch_plan["status"] == "进行中":
+                    launch_plan.status = 1
+                elif tb_launch_plan["status"] == "已结束":
+                    launch_plan.status = 2
+                launch_plan.create_date = SevenHelper.get_now_datetime()
+                launch_plan.modify_date = SevenHelper.get_now_datetime()
+                launch_plan_model.add_entity(launch_plan)
+            return invoke_result_data
+    
+    def init_launch_goods_callback(self, app_id, act_id, close_goods_id, call_back_info):
+        """
+        :description: 初始化投放商品回调接口
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param close_goods_id：投放失败时关闭投放的商品ID  多个逗号,分隔
+        :param call_back_info：回调信息
+        :return 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        if close_goods_id != "":
+            close_goods_id_list = list(set(close_goods_id.split(",")))
+            LaunchGoodsModel(context=self).update_table("is_launch=0,launch_date=%s", "act_id=%s and "+ SevenHelper.get_condition_by_str_list("goods_id",close_goods_id_list), params=[SevenHelper.get_now_datetime(),act_id])
+        #保存投放计划信息
+        tb_launch_plan = None
+        if call_back_info != "":
+            call_back_info = SevenHelper.json_loads(call_back_info)
+            for cur_tb_launch_plan in call_back_info["putSuccessList"]:
+                if cur_tb_launch_plan["sceneInfo"]["id"] == 1:
+                    tb_launch_plan = cur_tb_launch_plan
+                    break
+
+        if tb_launch_plan:
+            launch_plan_model = LaunchPlanModel(context=self)
+            launch_plan = launch_plan_model.get_entity("tb_launch_id=%s", params=[tb_launch_plan["id"]])
+            if not launch_plan:
+                launch_plan = LaunchPlan()
+                launch_plan.app_id = app_id
+                launch_plan.act_id = act_id
+                launch_plan.tb_launch_id = tb_launch_plan["id"]
+                launch_plan.launch_url = tb_launch_plan["previewUrl"]
+                launch_plan.start_date = tb_launch_plan["startTime"].replace('年', '-').replace('月', '-').replace('日', ' ') + tb_launch_plan["startTimeBottm"]
+                launch_plan.end_date = tb_launch_plan["endTime"].replace('年', '-').replace('月', '-').replace('日', ' ') + tb_launch_plan["endTimeBottom"]
+                if tb_launch_plan["status"] == "未开始":
+                    launch_plan.status = 0
+                elif tb_launch_plan["status"] == "进行中":
+                    launch_plan.status = 1
+                elif tb_launch_plan["status"] == "已结束":
+                    launch_plan.status = 2
+                launch_plan.create_date = SevenHelper.get_now_datetime()
+                launch_plan.modify_date = SevenHelper.get_now_datetime()
+                launch_plan_model.add_entity(launch_plan)
+            ActInfoModel(context=self).update_table("is_launch=1", "id=%s", params=act_id)
+            ActBaseModel(context=self)._delete_act_info_dependency_key(app_id,act_id)
+            
+        return invoke_result_data
+
+    def get_launch_plan_status(self, act_id, access_token ,app_key, app_secret):
+        """
+        :description: 获取投放计划状态
+        :param act_id：活动标识
+        :param access_token:access_token
+        :param app_key:app_key
+        :param app_secret:app_secret
+        :return 
+        :last_editors: HuangJianYi
+        """
+        launch_status = 1  #投放状态，0:未开始， 1：进行中，2/3:已结束，其他为平台状态
+        launch_plan_model = LaunchPlanModel(context=self)
+        launch_plan_dict = launch_plan_model.get_dict("act_id=%s", order_by="id desc",field="tb_launch_id", params=[act_id])
+
+        act_info_model = ActInfoModel(context=self)
+        act_info_dict = act_info_model.get_dict("id=%s",field="is_launch", params=[act_id])
+        if not launch_plan_dict:
+            if act_info_dict:
+                if act_info_dict["is_launch"] == 1:
+                    return launch_status
+                else:
+                    return 0
+            else:
+                return 0
+        top_base_model = TopBaseModel(context=self)
+        invoke_result_data = top_base_model.miniapp_distribution_order_get(launch_plan_dict["tb_launch_id"], access_token, app_key, app_secret)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        tb_launch_status = invoke_result_data.data["miniapp_distribution_order_get_response"]["model"]["distribution_order_open_biz_dto"][0]["status"]
+        if tb_launch_status == 0:
+            tb_launch_status = 1
+        if tb_launch_status == 2 and act_info_dict["is_launch"] == 0:
+            tb_launch_status = 0
+        launch_status = tb_launch_status
+        return launch_status
+
+    def can_launch_goods_list(self, page_index, page_size, goods_name, order_tag, order_by, access_token, app_key, app_secret, is_log=False):
+        """
+        :description: 导入商品列表（获取当前会话用户出售中的商品列表）
+        :param page_index：页索引
+        :param page_size：页大小
+        :param goods_name：商品名称
+        :param order_tag：order_tag
+        :param order_by：排序类型
+        :return 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+
+        top_base_model = TopBaseModel(context=self)
+        app_key, app_secret = self.get_app_key_secret()
+        invoke_result_data = top_base_model.get_goods_list(page_index, page_size, goods_name, order_tag, order_by, access_token, app_key, app_secret, is_log=is_log)
+        if invoke_result_data.success == False:
+            return invoke_result_data
+
+        goods_id_list = [str(goods["num_iid"]) for goods in invoke_result_data.data["items_onsale_get_response"]["items"]["item"]]
+        goods_id_in_condition = SevenHelper.get_condition_by_str_list("goods_id", goods_id_list)
+        launch_goods_model = LaunchGoodsModel(context=self)
+        launch_goods_list = launch_goods_model.get_list(goods_id_in_condition)
+        act_id_list = [launch_goods.act_id for launch_goods in launch_goods_list]
+        act_id_list = list(set(act_id_list))
+        act_id_in_condition = SevenHelper.get_condition_by_int_list("id",act_id_list)
+
+        act_info_model = ActInfoModel(context=self)
+        act_info_list = act_info_model.get_list(act_id_in_condition)
+
+        for goods in invoke_result_data.data["items_onsale_get_response"]["items"]["item"]:
+            launch_goods = query(launch_goods_list).first_or_default(None, lambda x: x.goods_id == str(goods["num_iid"]))
+            if launch_goods:
+                goods["is_select"] = 1
+                goods["bind_act_id"] = launch_goods.act_id
+                act_info = query(act_info_list).first_or_default(None, lambda x: x.id == goods["bind_act_id"])
+                if act_info:
+                    goods["bind_act_name"] = act_info.act_name
+                else:
+                    goods["bind_act_name"] = ""
+            else:
+                goods["is_select"] = 0
+                goods["bind_act_id"] = 0
+                goods["bind_act_name"] = ""
+        
+        return invoke_result_data
+
+    def get_launch_progress(self,act_id):
+        """
+        :description: 获取投放进度
+        :param act_id：活动标识
+        :return 投放进度 0未完成  1：已完成
+        :last_editors: HuangJianYi
+        """
+        redis_init = SevenHelper.redis_init()
+        redis_data = redis_init.lrange("queue_async_lauch",0,-1)
+
+        progress = 0 #投放进度  0未完成  1：已完成
+        if not redis_data:
+            progress = 1
+        elif len(redis_data) == 0:
+            progress = 1
+        else:
+            for data in redis_data:
+                if str(act_id) == data:
+                    progress = 0
+                    break
+        return progress
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/module_base_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/module_base_model.py`

 * *Ordering differences only*

 * *Files 11% similar despite different names*

```diff
@@ -1,275 +1,275 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-08-05 10:54:36
-@LastEditTime: 2023-03-13 11:29:15
-@LastEditors: HuangJianYi
-@Description: 
-"""
-from seven_cloudapp_frame.libs.customize.seven_helper import *
-from seven_cloudapp_frame.models.seven_model import *
-
-from seven_cloudapp_frame.models.db_models.act.act_module_model import *
-from seven_cloudapp_frame.models.db_models.price.price_gear_model import *
-
-class ModuleBaseModel():
-    """
-    :description: 活动模块业务模型
-    """
-    def __init__(self, context=None, logging_error=None, logging_info=None):
-        self.context = context
-        self.logging_link_error = logging_error
-        self.logging_link_info = logging_info
-
-
-    def _delete_act_module_dependency_key(self, act_id, module_id, delay_delete_time=0.01):
-        """
-        :description: 删除活动模块依赖建
-        :param act_id: 活动标识
-        :param module_id: 活动模块标识
-        :param delay_delete_time: 延迟删除时间，传0则不进行延迟
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        dependency_key_list = []
-        if module_id:
-            dependency_key_list.append(DependencyKey.act_module(module_id))
-        if act_id:
-            dependency_key_list.append(DependencyKey.act_module_list(act_id))
-        ActModuleModel().delete_dependency_key(dependency_key_list, delay_delete_time)
-        
-
-    def get_act_module_dict(self,module_id,is_cache=True,is_filter=True):
-        """
-        :description: 获取活动模块
-        :param module_id: 模块标识
-        :param is_cache: 是否缓存
-        :param is_filter: 是否过滤未发布或删除的数据
-        :return: 返回活动模块
-        :last_editors: HuangJianYi
-        """
-        act_module_model = ActModuleModel(context=self.context)
-        if is_cache:
-            dependency_key = DependencyKey.act_module(module_id)
-            act_module_dict = act_module_model.get_cache_dict_by_id(module_id,dependency_key=dependency_key)
-        else:
-            act_module_dict = act_module_model.get_dict_by_id(module_id)
-        if is_filter == True:
-            if not act_module_dict or act_module_dict["is_release"] == 0 or act_module_dict["is_del"] == 1:
-                return None
-        return act_module_dict
-
-    def get_act_module_list(self,app_id,act_id,module_name,start_date,end_date,is_del,page_size,page_index,order_by="sort_index desc,id asc",condition="",params=[],is_cache=True):
-        """
-        :description: 获取活动信息列表
-        :param app_id: 应用标识
-        :param act_id: 活动标识
-        :param module_name: 模块名称
-        :param start_date：开始时间
-        :param end_date：结束时间
-        :param is_del: 是否回收站1是0否
-        :param page_size: 条数
-        :param page_index: 页数
-        :param order_by：排序
-        :param condition：条件
-        :param params：参数化数组
-        :param is_cache: 是否缓存
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        where = "app_id=%s AND act_id=%s"
-        params_list = [app_id,act_id]
-        if condition:
-            where += " AND " + condition
-            params_list.extend(params)
-        if is_del !=-1:
-            where += " AND is_del=%s"
-            params_list.append(is_del)
-        if module_name:
-            where += " AND module_name=%s"
-            params_list.append(module_name)
-        if start_date != "":
-            where += " AND start_date>=%s"
-            params_list.append(start_date)
-        if end_date != "":
-            where += " AND end_date<=%s"
-            params_list.append(end_date)
-        if is_cache:
-            page_list, total = ActModuleModel(context=self.context).get_cache_dict_page_list(field="*", page_index=page_index, page_size=page_size, where=where, group_by="", order_by=order_by, params=params_list,dependency_key=DependencyKey.act_module_list(act_id))
-        else:
-            page_list, total = ActModuleModel(context=self.context).get_dict_page_list(field="*", page_index=page_index, page_size=page_size, where=where, group_by="", order_by=order_by, params=params_list)
-        return page_list, total
-
-    def save_act_module(self,app_id,act_id,module_id,module_name,module_sub_name,start_date,end_date,module_pic,module_desc,price,price_gear_id,ip_id,join_ways,is_fictitious,sort_index,is_release,i1,i2,i3,i4,i5,s1,s2,s3,s4,s5,d1,d2,business_type=0,module_type=0):
-        """
-        :description: 添加活动模块信息
-        :param app_id: 应用标识
-        :param act_id: 活动标识
-        :param business_type: 业务类型(0无1机台2活动)
-        :param module_id: 活动模块标识
-        :param module_name: 模块名称
-        :param module_sub_name: 模块短名称
-        :param start_date: 开始时间
-        :param end_date: 结束时间
-        :param module_pic: 模块图片
-        :param module_desc: 描述信息
-        :param price: 价格
-        :param price_gear_id: 档位标识
-        :param ip_id: IP标识
-        :param join_ways: 活动参与条件（0所有1关注店铺2加入会员3指定用户）
-        :param is_fictitious: 是否开启虚拟中奖（1是0否）
-        :param sort_index: 排序
-        :param is_release: 是否发布（1是0否）
-        :param i1: i1
-        :param i2: i2
-        :param i3: i3
-        :param i4: i4
-        :param i5: i5
-        :param s1: s1
-        :param s2: s2
-        :param s3: s3
-        :param s4: s4
-        :param s5: s5
-        :param d1: d1
-        :param d2: d2
-        :param business_type: 业务类型(0无1机台2活动)
-        :param module_type: 模块类型
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        if not act_id:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "param_error"
-            invoke_result_data.error_message = "参数不能为空或等于0"
-            return invoke_result_data
-
-        is_add = False
-        old_act_module = None
-        now_datetime = SevenHelper.get_now_datetime()
-        act_module_model = ActModuleModel(context=self.context)
-        act_module = None
-        if module_id > 0:
-            act_module = act_module_model.get_entity_by_id(module_id)
-            if not act_module or act_module.app_id != app_id:
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "error"
-                invoke_result_data.error_message = "活动模块信息不存在"
-                return invoke_result_data
-            old_act_module = deepcopy(act_module)
-        if not act_module:
-            is_add = True
-            act_module = ActModule()
-
-        act_module.app_id = app_id
-        act_module.act_id = act_id
-        act_module.business_type = business_type
-        act_module.module_name = module_name
-        act_module.module_sub_name = module_sub_name
-        act_module.module_type = module_type
-        act_module.start_date = start_date
-        act_module.end_date = end_date
-        act_module.module_pic = module_pic
-        act_module.module_desc = module_desc
-        act_module.price = price
-        act_module.price_gear_id = price_gear_id
-        act_module.ip_id = ip_id
-        act_module.join_ways = join_ways
-        act_module.is_fictitious = is_fictitious
-        act_module.sort_index = sort_index
-        act_module.is_release = is_release
-        act_module.release_date = now_datetime
-        act_module.i1 = i1
-        act_module.i2 = i2
-        act_module.i3 = i3
-        act_module.i4 = i4
-        act_module.i5 = i5
-        act_module.s1 = s1
-        act_module.s2 = s2
-        act_module.s3 = s3
-        act_module.s4 = s4
-        act_module.s5 = s5
-        act_module.d1 = d1
-        act_module.d2 = d2
-        act_module.modify_date = now_datetime
-
-        if is_add:
-            act_module.create_date = now_datetime
-            act_module.id = act_module_model.add_entity(act_module)
-        else:
-            act_module_model.update_entity(act_module,exclude_field_list="app_id,act_id")
-        result = {}
-        result["is_add"] = is_add
-        result["new"] = act_module
-        result["old"] = old_act_module
-        invoke_result_data.data = result
-        self._delete_act_module_dependency_key(act_id,act_module.id)
-        return invoke_result_data
-
-    def update_act_module_status(self,app_id,module_id,is_del):
-        """
-        :description: 删除或者还原活动模块
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param is_del：0-还原，1-删除
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        act_module_model = ActModuleModel(context=self.context)
-        act_module_dict = act_module_model.get_dict_by_id(module_id)
-        if not act_module_dict or act_module_dict["app_id"]!=app_id:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "活动模块信息不存在"
-            return invoke_result_data
-        is_release = 0
-        modify_date = SevenHelper.get_now_datetime()
-        invoke_result_data.success = act_module_model.update_table("is_del=%s,is_release=%s,release_date=%s,modify_date=%s", "id=%s", [is_del, is_release, modify_date, modify_date, module_id])
-        self._delete_act_module_dependency_key(act_module_dict["act_id"],module_id)
-        invoke_result_data.data = act_module_dict
-        return invoke_result_data
-
-    def release_act_module(self,app_id,module_id,is_release):
-        """
-        :description: 活动模块上下架
-        :param app_id：应用标识
-        :param module_id：活动模块标识
-        :param is_release: 是否发布 1-是 0-否
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        act_module_model = ActModuleModel(context=self.context)
-        act_module_dict = act_module_model.get_dict_by_id(module_id)
-        if not act_module_dict or act_module_dict["app_id"]!=app_id:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "no_module"
-            invoke_result_data.error_message = "活动信息不存在"
-            return invoke_result_data
-        invoke_result_data.success = act_module_model.update_table("release_date=%s,is_release=%s", "id=%s", [SevenHelper.get_now_datetime(), is_release, module_id])
-        self._delete_act_module_dependency_key(act_module_dict["act_id"],module_id)
-        invoke_result_data.data = act_module_dict
-        return invoke_result_data
-
-    def update_act_module_price(self,app_id,act_id,prize_gear_id):
-        """
-        :description: 更新活动模块价格
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param prize_gear_id：档位标识
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        act_module_model = ActModuleModel(context=self.context)
-        price_gear_model = PriceGearModel(context=self.context)
-        price_gear_dict = price_gear_model.get_dict_by_id(prize_gear_id)
-        if not price_gear_dict or price_gear_dict["app_id"]!= app_id or price_gear_dict["act_id"] != act_id:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "价格档位信息不存在"
-            return invoke_result_data
-        invoke_result_data.success = act_module_model.update_table("price=%s", "act_id=%s and price_gears_id=%s", params=[price_gear_dict["price"], act_id, prize_gear_id])
-        self._delete_act_module_dependency_key(act_id,0)
-        return invoke_result_data
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-08-05 10:54:36
+@LastEditTime: 2023-03-13 11:29:15
+@LastEditors: HuangJianYi
+@Description: 
+"""
+from seven_cloudapp_frame.libs.customize.seven_helper import *
+from seven_cloudapp_frame.models.seven_model import *
+
+from seven_cloudapp_frame.models.db_models.act.act_module_model import *
+from seven_cloudapp_frame.models.db_models.price.price_gear_model import *
+
+class ModuleBaseModel():
+    """
+    :description: 活动模块业务模型
+    """
+    def __init__(self, context=None, logging_error=None, logging_info=None):
+        self.context = context
+        self.logging_link_error = logging_error
+        self.logging_link_info = logging_info
+
+
+    def _delete_act_module_dependency_key(self, act_id, module_id, delay_delete_time=0.01):
+        """
+        :description: 删除活动模块依赖建
+        :param act_id: 活动标识
+        :param module_id: 活动模块标识
+        :param delay_delete_time: 延迟删除时间，传0则不进行延迟
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        dependency_key_list = []
+        if module_id:
+            dependency_key_list.append(DependencyKey.act_module(module_id))
+        if act_id:
+            dependency_key_list.append(DependencyKey.act_module_list(act_id))
+        ActModuleModel().delete_dependency_key(dependency_key_list, delay_delete_time)
+        
+
+    def get_act_module_dict(self,module_id,is_cache=True,is_filter=True):
+        """
+        :description: 获取活动模块
+        :param module_id: 模块标识
+        :param is_cache: 是否缓存
+        :param is_filter: 是否过滤未发布或删除的数据
+        :return: 返回活动模块
+        :last_editors: HuangJianYi
+        """
+        act_module_model = ActModuleModel(context=self.context)
+        if is_cache:
+            dependency_key = DependencyKey.act_module(module_id)
+            act_module_dict = act_module_model.get_cache_dict_by_id(module_id,dependency_key=dependency_key)
+        else:
+            act_module_dict = act_module_model.get_dict_by_id(module_id)
+        if is_filter == True:
+            if not act_module_dict or act_module_dict["is_release"] == 0 or act_module_dict["is_del"] == 1:
+                return None
+        return act_module_dict
+
+    def get_act_module_list(self,app_id,act_id,module_name,start_date,end_date,is_del,page_size,page_index,order_by="sort_index desc,id asc",condition="",params=[],is_cache=True):
+        """
+        :description: 获取活动信息列表
+        :param app_id: 应用标识
+        :param act_id: 活动标识
+        :param module_name: 模块名称
+        :param start_date：开始时间
+        :param end_date：结束时间
+        :param is_del: 是否回收站1是0否
+        :param page_size: 条数
+        :param page_index: 页数
+        :param order_by：排序
+        :param condition：条件
+        :param params：参数化数组
+        :param is_cache: 是否缓存
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        where = "app_id=%s AND act_id=%s"
+        params_list = [app_id,act_id]
+        if condition:
+            where += " AND " + condition
+            params_list.extend(params)
+        if is_del !=-1:
+            where += " AND is_del=%s"
+            params_list.append(is_del)
+        if module_name:
+            where += " AND module_name=%s"
+            params_list.append(module_name)
+        if start_date != "":
+            where += " AND start_date>=%s"
+            params_list.append(start_date)
+        if end_date != "":
+            where += " AND end_date<=%s"
+            params_list.append(end_date)
+        if is_cache:
+            page_list, total = ActModuleModel(context=self.context).get_cache_dict_page_list(field="*", page_index=page_index, page_size=page_size, where=where, group_by="", order_by=order_by, params=params_list,dependency_key=DependencyKey.act_module_list(act_id))
+        else:
+            page_list, total = ActModuleModel(context=self.context).get_dict_page_list(field="*", page_index=page_index, page_size=page_size, where=where, group_by="", order_by=order_by, params=params_list)
+        return page_list, total
+
+    def save_act_module(self,app_id,act_id,module_id,module_name,module_sub_name,start_date,end_date,module_pic,module_desc,price,price_gear_id,ip_id,join_ways,is_fictitious,sort_index,is_release,i1,i2,i3,i4,i5,s1,s2,s3,s4,s5,d1,d2,business_type=0,module_type=0):
+        """
+        :description: 添加活动模块信息
+        :param app_id: 应用标识
+        :param act_id: 活动标识
+        :param business_type: 业务类型(0无1机台2活动)
+        :param module_id: 活动模块标识
+        :param module_name: 模块名称
+        :param module_sub_name: 模块短名称
+        :param start_date: 开始时间
+        :param end_date: 结束时间
+        :param module_pic: 模块图片
+        :param module_desc: 描述信息
+        :param price: 价格
+        :param price_gear_id: 档位标识
+        :param ip_id: IP标识
+        :param join_ways: 活动参与条件（0所有1关注店铺2加入会员3指定用户）
+        :param is_fictitious: 是否开启虚拟中奖（1是0否）
+        :param sort_index: 排序
+        :param is_release: 是否发布（1是0否）
+        :param i1: i1
+        :param i2: i2
+        :param i3: i3
+        :param i4: i4
+        :param i5: i5
+        :param s1: s1
+        :param s2: s2
+        :param s3: s3
+        :param s4: s4
+        :param s5: s5
+        :param d1: d1
+        :param d2: d2
+        :param business_type: 业务类型(0无1机台2活动)
+        :param module_type: 模块类型
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        if not act_id:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "param_error"
+            invoke_result_data.error_message = "参数不能为空或等于0"
+            return invoke_result_data
+
+        is_add = False
+        old_act_module = None
+        now_datetime = SevenHelper.get_now_datetime()
+        act_module_model = ActModuleModel(context=self.context)
+        act_module = None
+        if module_id > 0:
+            act_module = act_module_model.get_entity_by_id(module_id)
+            if not act_module or act_module.app_id != app_id:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "error"
+                invoke_result_data.error_message = "活动模块信息不存在"
+                return invoke_result_data
+            old_act_module = deepcopy(act_module)
+        if not act_module:
+            is_add = True
+            act_module = ActModule()
+
+        act_module.app_id = app_id
+        act_module.act_id = act_id
+        act_module.business_type = business_type
+        act_module.module_name = module_name
+        act_module.module_sub_name = module_sub_name
+        act_module.module_type = module_type
+        act_module.start_date = start_date
+        act_module.end_date = end_date
+        act_module.module_pic = module_pic
+        act_module.module_desc = module_desc
+        act_module.price = price
+        act_module.price_gear_id = price_gear_id
+        act_module.ip_id = ip_id
+        act_module.join_ways = join_ways
+        act_module.is_fictitious = is_fictitious
+        act_module.sort_index = sort_index
+        act_module.is_release = is_release
+        act_module.release_date = now_datetime
+        act_module.i1 = i1
+        act_module.i2 = i2
+        act_module.i3 = i3
+        act_module.i4 = i4
+        act_module.i5 = i5
+        act_module.s1 = s1
+        act_module.s2 = s2
+        act_module.s3 = s3
+        act_module.s4 = s4
+        act_module.s5 = s5
+        act_module.d1 = d1
+        act_module.d2 = d2
+        act_module.modify_date = now_datetime
+
+        if is_add:
+            act_module.create_date = now_datetime
+            act_module.id = act_module_model.add_entity(act_module)
+        else:
+            act_module_model.update_entity(act_module,exclude_field_list="app_id,act_id")
+        result = {}
+        result["is_add"] = is_add
+        result["new"] = act_module
+        result["old"] = old_act_module
+        invoke_result_data.data = result
+        self._delete_act_module_dependency_key(act_id,act_module.id)
+        return invoke_result_data
+
+    def update_act_module_status(self,app_id,module_id,is_del):
+        """
+        :description: 删除或者还原活动模块
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param is_del：0-还原，1-删除
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        act_module_model = ActModuleModel(context=self.context)
+        act_module_dict = act_module_model.get_dict_by_id(module_id)
+        if not act_module_dict or act_module_dict["app_id"]!=app_id:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "活动模块信息不存在"
+            return invoke_result_data
+        is_release = 0
+        modify_date = SevenHelper.get_now_datetime()
+        invoke_result_data.success = act_module_model.update_table("is_del=%s,is_release=%s,release_date=%s,modify_date=%s", "id=%s", [is_del, is_release, modify_date, modify_date, module_id])
+        self._delete_act_module_dependency_key(act_module_dict["act_id"],module_id)
+        invoke_result_data.data = act_module_dict
+        return invoke_result_data
+
+    def release_act_module(self,app_id,module_id,is_release):
+        """
+        :description: 活动模块上下架
+        :param app_id：应用标识
+        :param module_id：活动模块标识
+        :param is_release: 是否发布 1-是 0-否
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        act_module_model = ActModuleModel(context=self.context)
+        act_module_dict = act_module_model.get_dict_by_id(module_id)
+        if not act_module_dict or act_module_dict["app_id"]!=app_id:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "no_module"
+            invoke_result_data.error_message = "活动信息不存在"
+            return invoke_result_data
+        invoke_result_data.success = act_module_model.update_table("release_date=%s,is_release=%s", "id=%s", [SevenHelper.get_now_datetime(), is_release, module_id])
+        self._delete_act_module_dependency_key(act_module_dict["act_id"],module_id)
+        invoke_result_data.data = act_module_dict
+        return invoke_result_data
+
+    def update_act_module_price(self,app_id,act_id,prize_gear_id):
+        """
+        :description: 更新活动模块价格
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param prize_gear_id：档位标识
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        act_module_model = ActModuleModel(context=self.context)
+        price_gear_model = PriceGearModel(context=self.context)
+        price_gear_dict = price_gear_model.get_dict_by_id(prize_gear_id)
+        if not price_gear_dict or price_gear_dict["app_id"]!= app_id or price_gear_dict["act_id"] != act_id:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "价格档位信息不存在"
+            return invoke_result_data
+        invoke_result_data.success = act_module_model.update_table("price=%s", "act_id=%s and price_gears_id=%s", params=[price_gear_dict["price"], act_id, prize_gear_id])
+        self._delete_act_module_dependency_key(act_id,0)
+        return invoke_result_data
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/mp_base_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/mp_base_model.py`

 * *Files 11% similar despite different names*

```diff
@@ -1,381 +1,380 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-12-20 16:07:52
-@LastEditTime: 2023-07-30 10:09:44
-@LastEditors: HuangJianYi
-@Description: 中台接口相关处理业务模型
-"""
-from seven_framework import *
-from seven_cloudapp_frame.libs.common import *
-from seven_cloudapp_frame.models.seven_model import *
-from seven_cloudapp_frame.libs.customize.seven_helper import *
-from seven_cloudapp_frame.models.db_models.function.function_shop_model import *
-from seven_cloudapp_frame.models.db_models.function.function_skin_model import *
-from seven_cloudapp_frame.models.db_models.function.function_info_model import *
-from seven_cloudapp_frame.models.db_models.function.function_module_model import *
-
-class MPBaseModel():
-    """
-    :description: 中台接口相关处理业务模型
-    """
-    def __init__(self, context=None, logging_error=None, logging_info=None):
-        self.context = context
-        self.logging_link_error = logging_error
-        self.logging_link_info = logging_info
-
-    def get_custom_function_list(self, store_user_nick):
-        """
-        :description: 获取定制功能列表
-        :param store_user_nick: 店铺主帐号名称（会员名）
-        :return InvokeResultData
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        #产品id
-        product_id = config.get_value("project_name")
-        power_project_id = share_config.get_value("power_project_id") # 权限产品id
-        if power_project_id:
-            product_id = power_project_id
-        if not product_id:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "param_error"
-            invoke_result_data.error_message = "参数错误product_id不能为空"
-            return invoke_result_data
-        if not store_user_nick:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "param_error"
-            invoke_result_data.error_message = "参数错误store_user_nick不能为空"
-            return invoke_result_data
-        try:
-            dependency_key = f"high_power_list:{product_id}"
-            function_shop_dict_list = FunctionShopModel(context=self.context).get_cache_dict_list("is_release=1 and product_id=%s and store_user_nick=%s", order_by="id desc", field="*", params=[product_id, store_user_nick], dependency_key=dependency_key, redis_config_dict=config.get_value("redis_function"))
-            for item in function_shop_dict_list:
-                function_ids = item['function_ids'] = SevenHelper.json_loads(item['function_ids']) if item['function_ids'] else []
-                skin_ids = item['skin_ids'] = SevenHelper.json_loads(item['skin_ids']) if item['skin_ids'] else []
-                item["function_info_second_list"] = []
-                if function_ids:
-                    condition_where = ConditionWhere()
-                    condition_where.add_condition(SevenHelper.get_condition_by_int_list("id", function_ids))
-                    condition_where.add_condition("is_release=1")
-                    function_list = FunctionInfoModel(context=self.context).get_cache_dict_list(condition_where.to_string(), field="function_name as name,key_name", dependency_key=dependency_key, redis_config_dict=config.get_value("redis_function"))
-                    item["function_info_second_list"] = function_list or []
-
-                item["skin_ids_second_list"] = []
-                if skin_ids:
-                    condition_where = ConditionWhere()
-                    condition_where.add_condition(SevenHelper.get_condition_by_int_list("id", skin_ids))
-                    condition_where.add_condition("is_release=1")
-                    skin_list = FunctionSkinModel(context=self.context).get_cache_dict_list(condition_where.to_string(), field="theme_name as name,theme_id", dependency_key=dependency_key, redis_config_dict=config.get_value("redis_function"))
-                    item["skin_ids_second_list"] = skin_list or []
-            invoke_result_data.data = function_shop_dict_list
-            return invoke_result_data
-        except Exception as ex:
-            if self.context:
-                self.context.logging_link_error("【获取中台定制功能列表】" + traceback.format_exc())
-            elif self.logging_link_error:
-                self.logging_link_error("【获取中台定制功能列表】" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "exception"
-            invoke_result_data.error_message = "系统繁忙,请稍后再试"
-            return invoke_result_data
-
-    def get_public_function_list(self, project_code, app_code=""):
-        """
-        :description: 获取公共功能列表
-        :param project_code: 项目编码
-        :param app_code: 项目编码（淘系项目，收费项目列表查询）
-        :return InvokeResultData
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        if not project_code:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "param_error"
-            invoke_result_data.error_message = "参数错误project_code不能为空"
-            return invoke_result_data
-        #产品id
-        product_id = config.get_value("project_name")
-        power_project_id = share_config.get_value("power_project_id") # 权限产品id,SaaS走project_name,SaaS定制走power_project_id
-        if power_project_id:
-            product_id = power_project_id
-        if not product_id:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "param_error"
-            invoke_result_data.error_message = "参数错误product_id不能为空"
-            return invoke_result_data
-        try:
-            dependency_key = f"high_power_list:{product_id}"
-            params = [product_id, project_code]
-            condition_where = ConditionWhere()
-            condition_where.add_condition("is_release=1 and product_id=%s and project_code=%s")
-            field = "id,product_id,module_type,module_name as name,app_code,project_code,skin_ids,function_ids"
-            if app_code:
-                condition_where.add_condition("app_code=%s")
-                params.append(app_code)
-            function_module_dict_list = FunctionModuleModel(context=self.context).get_cache_dict_list(condition_where.to_string(), field=field, params=params, dependency_key=dependency_key,redis_config_dict=config.get_value("redis_function"))
-            for item in function_module_dict_list:
-                function_ids = item['function_ids'] = SevenHelper.json_loads(item['function_ids']) if item['function_ids'] else []
-                skin_ids = item['skin_ids'] = SevenHelper.json_loads(item['skin_ids']) if item['skin_ids'] else []
-
-                item["function_info_second_list"] = []
-                if function_ids:
-                    condition_where = ConditionWhere()
-                    condition_where.add_condition(SevenHelper.get_condition_by_int_list("id", function_ids))
-                    condition_where.add_condition("is_release=1")
-                    function_list = FunctionInfoModel(context=self.context).get_cache_dict_list(condition_where.to_string(), field="function_name as name,key_name", dependency_key=dependency_key,redis_config_dict=config.get_value("redis_function"))
-                    item["function_info_second_list"] = function_list or []
-
-                item["skin_ids_second_list"] = []
-                if skin_ids:
-                    condition_where = ConditionWhere()
-                    condition_where.add_condition(SevenHelper.get_condition_by_int_list("id", skin_ids))
-                    condition_where.add_condition("is_release=1")
-                    skin_list = FunctionSkinModel(context=self.context).get_cache_dict_list(condition_where.to_string(), field="theme_name as name,theme_id", dependency_key=dependency_key,redis_config_dict=config.get_value("redis_function"))
-                    item["skin_ids_second_list"] = skin_list or []
-
-            invoke_result_data.data = function_module_dict_list
-            return invoke_result_data
-        except Exception as ex:
-            if self.context:
-                self.context.logging_link_error("【获取中台公共功能列表】" + traceback.format_exc())
-            elif self.logging_link_error:
-                self.logging_link_error("【获取中台公共功能列表】" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "exception"
-            invoke_result_data.error_message = "系统繁忙,请稍后再试"
-            return invoke_result_data
-
-    def get_key_power_list(self, store_user_nick, project_code, key_names, user_type=0):
-        """
-        :description: 指定模块权限列表
-        :param store_user_nick: 店铺主帐号名称（会员名）
-        :param project_code: 项目编码
-        :param key_names: 权限代码，多个逗号分隔
-        :param user_type:  0-不限1-SAAS用户2-SAAS定制用户
-        :return InvokeResultData
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        #产品id
-        product_id = config.get_value("project_name")
-        power_project_id = share_config.get_value("power_project_id") # 权限产品id,SaaS走project_name,SaaS定制走power_project_id
-        if power_project_id:
-            product_id = power_project_id
-        if not product_id:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "param_error"
-            invoke_result_data.error_message = "参数错误product_id不能为空"
-            return invoke_result_data
-        if not key_names:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "param_error"
-            invoke_result_data.error_message = "权限代码key_names不能为空"
-            return invoke_result_data
-        try:
-            dependency_key = f"high_power_list:{product_id}"
-            params = [product_id]
-            condition_where = ConditionWhere()
-            condition_where.add_condition("is_release=1 and product_id=%s")
-            if store_user_nick:
-                condition_where.add_condition("store_user_nick=%s")
-                params.append(store_user_nick)
-            if user_type:
-                condition_where.add_condition("user_type=%s")
-                params.append(user_type)
-            function_shop_dict = FunctionShopModel(context=self.context).get_cache_dict(condition_where.to_string(), field="function_ids", params=params, dependency_key=dependency_key, redis_config_dict=config.get_value("redis_function"))
-            if function_shop_dict:
-                function_id_list = SevenHelper.json_loads(function_shop_dict["function_ids"])
-            else:
-                function_module_dict = FunctionModuleModel(context=self.context).get_cache_dict("is_release=1 and product_id=%s and project_code=%s", params=[product_id, project_code], dependency_key=dependency_key, redis_config_dict=config.get_value("redis_function"))
-                if not function_module_dict:
-                    invoke_result_data.success = False
-                    invoke_result_data.error_code = "error"
-                    invoke_result_data.error_message = "此产品无此项目编码"
-                    return invoke_result_data
-                function_id_list = SevenHelper.json_loads(function_module_dict["function_ids"])
-
-            key_name_list = key_names.split(",")
-            result_data = []
-            function_info_list = FunctionInfoModel(context=self.context).get_cache_dict_list("is_release=1 and " + SevenHelper.get_condition_by_str_list("key_name", key_name_list), field="id,key_name", dependency_key=dependency_key, redis_config_dict=config.get_value("redis_function"))
-            for item in key_name_list:
-                if function_info_list:
-                    for item in function_info_list:
-                        key_name = item["key_name"]
-                        if item == key_name:
-                            func_id = item["id"]
-                            if func_id in function_id_list:
-                                result_data.append({"key_name": key_name, "is_power": True})
-                            else:
-                                result_data.append({"key_name": key_name, "is_power": False})
-                        else:
-                            result_data.append({"key_name": item, "is_power": False})
-                else:
-                    result_data.append({"key_name": item, "is_power": False})
-            invoke_result_data.data = result_data
-            return invoke_result_data
-        except Exception as ex:
-            if self.context:
-                self.context.logging_link_error("【获取中台指定模块权限列表】" + traceback.format_exc())
-            elif self.logging_link_error:
-                self.logging_link_error("【获取中台指定模块权限列表】" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "exception"
-            invoke_result_data.error_message = "系统繁忙,请稍后再试"
-            return invoke_result_data
-
-    def check_high_power(self, store_user_nick, project_code, key_names, user_type=0):
-        """
-        :description:  检验是否有指定模块的权限
-        :param store_user_nick:商家主账号昵称
-        :param project_code:项目编码
-        :param key_names:权限代码，多个逗号分隔 
-        :param user_type:0-不限1-SAAS用户2-SAAS定制用户
-        :return bool: 是否有权限
-        :last_editors: HuangJianYi
-        """
-        is_power = True
-        invoke_result_data = self.get_key_power_list(store_user_nick, project_code, key_names, user_type)
-        if invoke_result_data.success == True:
-            for key in invoke_result_data.data:
-                if key["is_power"] == False:
-                    is_power = False
-                    break
-        else:
-            is_power = False
-        return is_power
-
-    def get_api_public_function_list(self, project_code, return_response_status=False):
-        """
-        :description:  获取公共功能列表
-        :param project_code:收费项目代码（服务管理-收费项目列表）
-        :param return_response_status:是否返回响应状态
-        :return list: 
-        :last_editors: HuangJianYi
-        """
-        response_status = False
-        public_function_list = []
-        if not project_code:
-            if return_response_status:
-                return public_function_list,response_status
-            return public_function_list
-        #产品id
-        product_id = config.get_value("project_name")
-        power_project_id = share_config.get_value("power_project_id") # 权限产品id,SaaS走project_name,SaaS定制走power_project_id
-        if power_project_id:
-            product_id = power_project_id
-        if not product_id:
-            if return_response_status:
-                return public_function_list,response_status
-            return public_function_list
-        requst_url = share_config.get_value("mp_url","http://taobao-mp-s.gao7.com") + "/general/project_code_list"
-        data = {}
-        data["project_code"] = project_code
-        data["product_id"] = product_id
-        result = HTTPHelper.get(requst_url, data, {"Content-Type": "application/json"})
-        if result and result.ok and result.text:
-            obj_data = SevenHelper.json_loads(result.text)
-            if obj_data and obj_data["Data"]:
-                public_function_list = obj_data["Data"]
-                response_status = True
-        if return_response_status:
-            return public_function_list,response_status
-        return public_function_list
-
-    def get_api_custom_function_list(self, store_user_nick, return_response_status=False):
-        """
-        :description:  获取定制功能列表，权限产品id（power_project_id）,SaaS定制走power_project_id必须配置，SaaS可不配置走project_name,对应中台表function_product_tb的app_id字段
-        :param store_user_nick:商家主账号昵称
-        :param return_response_status:是否返回响应状态
-        :return list: 
-        :last_editors: HuangJianYi
-        """
-        response_status = False
-        custom_function_list = []
-        #产品id
-        product_id = config.get_value("project_name")
-        power_project_id = share_config.get_value("power_project_id") # 权限产品id
-        if power_project_id:
-            product_id = power_project_id
-        if not product_id:
-            if return_response_status:
-                return custom_function_list,response_status
-            return custom_function_list
-        requst_url = share_config.get_value("mp_url", "http://taobao-mp-s.gao7.com") + "/custom/query_skin_managemen_list"
-        data = {}
-        data["product_id"] = product_id
-        data["store_user_nick"] = store_user_nick
-        result = HTTPHelper.get(requst_url, data, {"Content-Type": "application/json"})
-        if result and result.ok and result.text:
-            obj_data = SevenHelper.json_loads(result.text)
-            if obj_data and obj_data["Data"]:
-                custom_function_list = obj_data["Data"]
-                response_status = True
-        if return_response_status:
-            return custom_function_list,response_status
-        return custom_function_list
-
-    def get_api_key_power_list(self, store_user_nick, project_code, key_names, user_type=0, return_response_status=False):
-        """
-        :description:  指定模块权限列表，权限产品id（power_project_id）,SaaS定制走power_project_id必须配置，SaaS可不配置走project_name,对应中台表function_product_tb的app_id字段
-        :param store_user_nick:商家主账号昵称
-        :param project_code:项目编码
-        :param key_names:权限代码，多个逗号分隔
-        :param user_type:0-不限1-SAAS用户2-SAAS定制用户
-        :param return_response_status:是否返回响应状态
-        :return list: 
-        :last_editors: HuangJianYi
-        """
-        response_status = False
-        power_list = []
-        #产品id
-        product_id = config.get_value("project_name")
-        power_project_id = share_config.get_value("power_project_id") # 权限产品id
-        if power_project_id:
-            product_id = power_project_id
-        if not product_id:
-            if return_response_status:
-                return power_list,response_status
-            return power_list
-        requst_url = share_config.get_value("mp_url", "http://taobao-mp-s.gao7.com") + "/general/jurisdiction_list"
-        data = {}
-        data["product_id"] = product_id
-        data["project_code"] = project_code
-        data["store_user_nick"] = store_user_nick
-        data["key_name"] = key_names
-        if user_type > 0:
-            data["user_type"] = user_type
-        result = HTTPHelper.get(requst_url, data, {"Content-Type": "application/json"})
-        if result and result.ok and result.text:
-            obj_data = SevenHelper.json_loads(result.text)
-            if obj_data and obj_data["Data"]:
-                power_list = obj_data["Data"]
-                response_status = True
-        if return_response_status:
-            return power_list,response_status
-        return power_list
-
-    def check_api_high_power(self, store_user_nick, project_code, key_names, user_type=0, return_response_status=False):
-        """
-        :description:  检验是否有指定模块的权限
-        :param store_user_nick:商家主账号昵称
-        :param project_code:项目编码
-        :param key_names:权限代码，多个逗号分隔 
-        :param user_type:0-不限1-SAAS用户2-SAAS定制用户
-        :param return_response_status:是否返回响应状态
-        :return bool: 是否有权限
-        :last_editors: HuangJianYi
-        """
-        response_status = False
-        if return_response_status == True:
-            power_list, response_status = self.get_api_key_power_list(store_user_nick, project_code, key_names, user_type, return_response_status)
-        else:
-            power_list = self.get_key_power_list(store_user_nick, project_code, key_names, user_type)
-        is_power = True
-        for key in power_list:
-            if key["is_power"] == False:
-                is_power = False
-                break
-        if return_response_status == True:
-            return is_power,response_status
-        return is_power
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-12-20 16:07:52
+@LastEditTime: 2023-07-30 10:09:44
+@LastEditors: HuangJianYi
+@Description: 中台接口相关处理业务模型
+"""
+from seven_framework import *
+from seven_cloudapp_frame.libs.common import *
+from seven_cloudapp_frame.models.seven_model import *
+from seven_cloudapp_frame.libs.customize.seven_helper import *
+from seven_cloudapp_frame.models.db_models.function.function_shop_model import *
+from seven_cloudapp_frame.models.db_models.function.function_skin_model import *
+from seven_cloudapp_frame.models.db_models.function.function_info_model import *
+from seven_cloudapp_frame.models.db_models.function.function_module_model import *
+
+class MPBaseModel():
+    """
+    :description: 中台接口相关处理业务模型
+    """
+    def __init__(self, context=None, logging_error=None, logging_info=None):
+        self.context = context
+        self.logging_link_error = logging_error
+        self.logging_link_info = logging_info
+
+    def get_custom_function_list(self, store_user_nick):
+        """
+        :description: 获取定制功能列表
+        :param store_user_nick: 店铺主帐号名称（会员名）
+        :return InvokeResultData
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        #产品id
+        product_id = config.get_value("project_name")
+        power_project_id = share_config.get_value("power_project_id") # 权限产品id
+        if power_project_id:
+            product_id = power_project_id
+        if not product_id:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "param_error"
+            invoke_result_data.error_message = "参数错误product_id不能为空"
+            return invoke_result_data
+        if not store_user_nick:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "param_error"
+            invoke_result_data.error_message = "参数错误store_user_nick不能为空"
+            return invoke_result_data
+        try:
+            dependency_key = f"high_power_list:{product_id}"
+            function_shop_dict_list = FunctionShopModel(context=self.context).get_cache_dict_list("is_release=1 and product_id=%s and store_user_nick=%s", order_by="id desc", field="*", params=[product_id, store_user_nick], dependency_key=dependency_key, redis_config_dict=config.get_value("redis_function"))
+            for item in function_shop_dict_list:
+                function_ids = item['function_ids'] = SevenHelper.json_loads(item['function_ids']) if item['function_ids'] else []
+                skin_ids = item['skin_ids'] = SevenHelper.json_loads(item['skin_ids']) if item['skin_ids'] else []
+                item["function_info_second_list"] = []
+                if function_ids:
+                    condition_where = ConditionWhere()
+                    condition_where.add_condition(SevenHelper.get_condition_by_int_list("id", function_ids))
+                    condition_where.add_condition("is_release=1")
+                    function_list = FunctionInfoModel(context=self.context).get_cache_dict_list(condition_where.to_string(), field="function_name as name,key_name", dependency_key=dependency_key, redis_config_dict=config.get_value("redis_function"))
+                    item["function_info_second_list"] = function_list or []
+
+                item["skin_ids_second_list"] = []
+                if skin_ids:
+                    condition_where = ConditionWhere()
+                    condition_where.add_condition(SevenHelper.get_condition_by_int_list("id", skin_ids))
+                    condition_where.add_condition("is_release=1")
+                    skin_list = FunctionSkinModel(context=self.context).get_cache_dict_list(condition_where.to_string(), field="theme_name as name,theme_id", dependency_key=dependency_key, redis_config_dict=config.get_value("redis_function"))
+                    item["skin_ids_second_list"] = skin_list or []
+            invoke_result_data.data = function_shop_dict_list
+            return invoke_result_data
+        except Exception as ex:
+            if self.context:
+                self.context.logging_link_error("【获取中台定制功能列表】" + traceback.format_exc())
+            elif self.logging_link_error:
+                self.logging_link_error("【获取中台定制功能列表】" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "exception"
+            invoke_result_data.error_message = "系统繁忙,请稍后再试"
+            return invoke_result_data
+
+    def get_public_function_list(self, project_code, app_code=""):
+        """
+        :description: 获取公共功能列表
+        :param project_code: 项目编码
+        :param app_code: 项目编码（淘系项目，收费项目列表查询）
+        :return InvokeResultData
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        if not project_code:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "param_error"
+            invoke_result_data.error_message = "参数错误project_code不能为空"
+            return invoke_result_data
+        #产品id
+        product_id = config.get_value("project_name")
+        power_project_id = share_config.get_value("power_project_id") # 权限产品id,SaaS走project_name,SaaS定制走power_project_id
+        if power_project_id:
+            product_id = power_project_id
+        if not product_id:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "param_error"
+            invoke_result_data.error_message = "参数错误product_id不能为空"
+            return invoke_result_data
+        try:
+            dependency_key = f"high_power_list:{product_id}"
+            params = [product_id, project_code]
+            condition_where = ConditionWhere()
+            condition_where.add_condition("is_release=1 and product_id=%s and project_code=%s")
+            field = "id,product_id,module_type,module_name as name,app_code,project_code,skin_ids,function_ids"
+            if app_code:
+                condition_where.add_condition("app_code=%s")
+                params.append(app_code)
+            function_module_dict_list = FunctionModuleModel(context=self.context).get_cache_dict_list(condition_where.to_string(), field=field, params=params, dependency_key=dependency_key,redis_config_dict=config.get_value("redis_function"))
+            for item in function_module_dict_list:
+                function_ids = item['function_ids'] = SevenHelper.json_loads(item['function_ids']) if item['function_ids'] else []
+                skin_ids = item['skin_ids'] = SevenHelper.json_loads(item['skin_ids']) if item['skin_ids'] else []
+
+                item["function_info_second_list"] = []
+                if function_ids:
+                    condition_where = ConditionWhere()
+                    condition_where.add_condition(SevenHelper.get_condition_by_int_list("id", function_ids))
+                    condition_where.add_condition("is_release=1")
+                    function_list = FunctionInfoModel(context=self.context).get_cache_dict_list(condition_where.to_string(), field="function_name as name,key_name", dependency_key=dependency_key,redis_config_dict=config.get_value("redis_function"))
+                    item["function_info_second_list"] = function_list or []
+
+                item["skin_ids_second_list"] = []
+                if skin_ids:
+                    condition_where = ConditionWhere()
+                    condition_where.add_condition(SevenHelper.get_condition_by_int_list("id", skin_ids))
+                    condition_where.add_condition("is_release=1")
+                    skin_list = FunctionSkinModel(context=self.context).get_cache_dict_list(condition_where.to_string(), field="theme_name as name,theme_id", dependency_key=dependency_key,redis_config_dict=config.get_value("redis_function"))
+                    item["skin_ids_second_list"] = skin_list or []
+
+            invoke_result_data.data = function_module_dict_list
+            return invoke_result_data
+        except Exception as ex:
+            if self.context:
+                self.context.logging_link_error("【获取中台公共功能列表】" + traceback.format_exc())
+            elif self.logging_link_error:
+                self.logging_link_error("【获取中台公共功能列表】" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "exception"
+            invoke_result_data.error_message = "系统繁忙,请稍后再试"
+            return invoke_result_data
+
+    def get_key_power_list(self, store_user_nick, project_code, key_names, user_type=0):
+        """
+        :description: 指定模块权限列表
+        :param store_user_nick: 店铺主帐号名称（会员名）
+        :param project_code: 项目编码
+        :param key_names: 权限代码，多个逗号分隔
+        :param user_type:  0-不限1-SAAS用户2-SAAS定制用户
+        :return InvokeResultData
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        #产品id
+        product_id = config.get_value("project_name")
+        power_project_id = share_config.get_value("power_project_id") # 权限产品id,SaaS走project_name,SaaS定制走power_project_id
+        if power_project_id:
+            product_id = power_project_id
+        if not product_id:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "param_error"
+            invoke_result_data.error_message = "参数错误product_id不能为空"
+            return invoke_result_data
+        if not key_names:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "param_error"
+            invoke_result_data.error_message = "权限代码key_names不能为空"
+            return invoke_result_data
+        try:
+            dependency_key = f"high_power_list:{product_id}"
+            params = [product_id]
+            condition_where = ConditionWhere()
+            condition_where.add_condition("is_release=1 and product_id=%s")
+            if store_user_nick:
+                condition_where.add_condition("store_user_nick=%s")
+                params.append(store_user_nick)
+            if user_type:
+                condition_where.add_condition("user_type=%s")
+                params.append(user_type)
+            function_shop_dict = FunctionShopModel(context=self.context).get_cache_dict(condition_where.to_string(), field="function_ids", params=params, dependency_key=dependency_key, redis_config_dict=config.get_value("redis_function"))
+            if function_shop_dict:
+                function_id_list = SevenHelper.json_loads(function_shop_dict["function_ids"])
+            else:
+                function_module_dict = FunctionModuleModel(context=self.context).get_cache_dict("is_release=1 and product_id=%s and project_code=%s", params=[product_id, project_code], dependency_key=dependency_key, redis_config_dict=config.get_value("redis_function"))
+                if not function_module_dict:
+                    invoke_result_data.success = False
+                    invoke_result_data.error_code = "error"
+                    invoke_result_data.error_message = "此产品无此项目编码"
+                    return invoke_result_data
+                function_id_list = SevenHelper.json_loads(function_module_dict["function_ids"])
+
+            key_name_list = key_names.split(",")
+            result_data = []
+            function_info_list = FunctionInfoModel(context=self.context).get_cache_dict_list("is_release=1 and " + SevenHelper.get_condition_by_str_list("key_name", key_name_list), field="id,key_name", dependency_key=dependency_key, redis_config_dict=config.get_value("redis_function"))
+            for key_name in key_name_list:
+                if function_info_list:
+                    for function_info in function_info_list:
+                        if key_name == function_info["key_name"]:
+                            func_id = function_info["id"]
+                            if func_id in function_id_list:
+                                result_data.append({"key_name": key_name, "is_power": True})
+                            else:
+                                result_data.append({"key_name": key_name, "is_power": False})
+                        else:
+                            result_data.append({"key_name": key_name, "is_power": False})
+                else:
+                    result_data.append({"key_name": key_name, "is_power": False})
+            invoke_result_data.data = result_data
+            return invoke_result_data
+        except Exception as ex:
+            if self.context:
+                self.context.logging_link_error("【获取中台指定模块权限列表】" + traceback.format_exc())
+            elif self.logging_link_error:
+                self.logging_link_error("【获取中台指定模块权限列表】" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "exception"
+            invoke_result_data.error_message = "系统繁忙,请稍后再试"
+            return invoke_result_data
+
+    def check_high_power(self, store_user_nick, project_code, key_names, user_type=0):
+        """
+        :description:  检验是否有指定模块的权限
+        :param store_user_nick:商家主账号昵称
+        :param project_code:项目编码
+        :param key_names:权限代码，多个逗号分隔 
+        :param user_type:0-不限1-SAAS用户2-SAAS定制用户
+        :return bool: 是否有权限
+        :last_editors: HuangJianYi
+        """
+        is_power = True
+        invoke_result_data = self.get_key_power_list(store_user_nick, project_code, key_names, user_type)
+        if invoke_result_data.success == True:
+            for key in invoke_result_data.data:
+                if key["is_power"] == False:
+                    is_power = False
+                    break
+        else:
+            is_power = False
+        return is_power
+
+    def get_api_public_function_list(self, project_code, return_response_status=False):
+        """
+        :description:  获取公共功能列表
+        :param project_code:收费项目代码（服务管理-收费项目列表）
+        :param return_response_status:是否返回响应状态
+        :return list: 
+        :last_editors: HuangJianYi
+        """
+        response_status = False
+        public_function_list = []
+        if not project_code:
+            if return_response_status:
+                return public_function_list,response_status
+            return public_function_list
+        #产品id
+        product_id = config.get_value("project_name")
+        power_project_id = share_config.get_value("power_project_id") # 权限产品id,SaaS走project_name,SaaS定制走power_project_id
+        if power_project_id:
+            product_id = power_project_id
+        if not product_id:
+            if return_response_status:
+                return public_function_list,response_status
+            return public_function_list
+        requst_url = share_config.get_value("mp_url","http://taobao-mp-s.gao7.com") + "/general/project_code_list"
+        data = {}
+        data["project_code"] = project_code
+        data["product_id"] = product_id
+        result = HTTPHelper.get(requst_url, data, {"Content-Type": "application/json"})
+        if result and result.ok and result.text:
+            obj_data = SevenHelper.json_loads(result.text)
+            if obj_data and obj_data["Data"]:
+                public_function_list = obj_data["Data"]
+                response_status = True
+        if return_response_status:
+            return public_function_list,response_status
+        return public_function_list
+
+    def get_api_custom_function_list(self, store_user_nick, return_response_status=False):
+        """
+        :description:  获取定制功能列表，权限产品id（power_project_id）,SaaS定制走power_project_id必须配置，SaaS可不配置走project_name,对应中台表function_product_tb的app_id字段
+        :param store_user_nick:商家主账号昵称
+        :param return_response_status:是否返回响应状态
+        :return list: 
+        :last_editors: HuangJianYi
+        """
+        response_status = False
+        custom_function_list = []
+        #产品id
+        product_id = config.get_value("project_name")
+        power_project_id = share_config.get_value("power_project_id") # 权限产品id
+        if power_project_id:
+            product_id = power_project_id
+        if not product_id:
+            if return_response_status:
+                return custom_function_list,response_status
+            return custom_function_list
+        requst_url = share_config.get_value("mp_url", "http://taobao-mp-s.gao7.com") + "/custom/query_skin_managemen_list"
+        data = {}
+        data["product_id"] = product_id
+        data["store_user_nick"] = store_user_nick
+        result = HTTPHelper.get(requst_url, data, {"Content-Type": "application/json"})
+        if result and result.ok and result.text:
+            obj_data = SevenHelper.json_loads(result.text)
+            if obj_data and obj_data["Data"]:
+                custom_function_list = obj_data["Data"]
+                response_status = True
+        if return_response_status:
+            return custom_function_list,response_status
+        return custom_function_list
+
+    def get_api_key_power_list(self, store_user_nick, project_code, key_names, user_type=0, return_response_status=False):
+        """
+        :description:  指定模块权限列表，权限产品id（power_project_id）,SaaS定制走power_project_id必须配置，SaaS可不配置走project_name,对应中台表function_product_tb的app_id字段
+        :param store_user_nick:商家主账号昵称
+        :param project_code:项目编码
+        :param key_names:权限代码，多个逗号分隔
+        :param user_type:0-不限1-SAAS用户2-SAAS定制用户
+        :param return_response_status:是否返回响应状态
+        :return list: 
+        :last_editors: HuangJianYi
+        """
+        response_status = False
+        power_list = []
+        #产品id
+        product_id = config.get_value("project_name")
+        power_project_id = share_config.get_value("power_project_id") # 权限产品id
+        if power_project_id:
+            product_id = power_project_id
+        if not product_id:
+            if return_response_status:
+                return power_list,response_status
+            return power_list
+        requst_url = share_config.get_value("mp_url", "http://taobao-mp-s.gao7.com") + "/general/jurisdiction_list"
+        data = {}
+        data["product_id"] = product_id
+        data["project_code"] = project_code
+        data["store_user_nick"] = store_user_nick
+        data["key_name"] = key_names
+        if user_type > 0:
+            data["user_type"] = user_type
+        result = HTTPHelper.get(requst_url, data, {"Content-Type": "application/json"})
+        if result and result.ok and result.text:
+            obj_data = SevenHelper.json_loads(result.text)
+            if obj_data and obj_data["Data"]:
+                power_list = obj_data["Data"]
+                response_status = True
+        if return_response_status:
+            return power_list,response_status
+        return power_list
+
+    def check_api_high_power(self, store_user_nick, project_code, key_names, user_type=0, return_response_status=False):
+        """
+        :description:  检验是否有指定模块的权限
+        :param store_user_nick:商家主账号昵称
+        :param project_code:项目编码
+        :param key_names:权限代码，多个逗号分隔 
+        :param user_type:0-不限1-SAAS用户2-SAAS定制用户
+        :param return_response_status:是否返回响应状态
+        :return bool: 是否有权限
+        :last_editors: HuangJianYi
+        """
+        response_status = False
+        if return_response_status == True:
+            power_list, response_status = self.get_api_key_power_list(store_user_nick, project_code, key_names, user_type, return_response_status)
+        else:
+            power_list = self.get_key_power_list(store_user_nick, project_code, key_names, user_type)
+        is_power = True
+        for key in power_list:
+            if key["is_power"] == False:
+                is_power = False
+                break
+        if return_response_status == True:
+            return is_power,response_status
+        return is_power
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/order_base_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/order_base_model.py`

 * *Ordering differences only*

 * *Files 12% similar despite different names*

```diff
@@ -1,1155 +1,1155 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-08-09 09:24:43
-@LastEditTime: 2023-06-25 17:20:45
-@LastEditors: HuangJianYi
-@Description: 
-"""
-from seven_cloudapp_frame.libs.customize.wechat_helper import WeChatPayRequest
-from seven_cloudapp_frame.models.user_base_model import UserBaseModel
-from seven_cloudapp_frame.models.frame_base_model import FrameBaseModel
-from seven_cloudapp_frame.models.seven_model import *
-from seven_cloudapp_frame.models.app_base_model import *
-from seven_cloudapp_frame.models.top_base_model import *
-from seven_cloudapp_frame.models.price_base_model import *
-from seven_cloudapp_frame.models.asset_base_model import *
-from seven_cloudapp_frame.models.db_models.act.act_module_model import *
-from seven_cloudapp_frame.models.db_models.prize.prize_order_model import *
-from seven_cloudapp_frame.models.db_models.prize.prize_roster_model import *
-from seven_cloudapp_frame.models.db_models.tao.tao_pay_order_model import *
-from seven_cloudapp_frame.models.db_models.user.user_info_model import *
-from seven_cloudapp_frame.models.db_models.tao.tao_coupon_model import *
-from seven_cloudapp_frame.models.db_models.pay.pay_order_model import *
-from seven_cloudapp_frame.models.db_models.refund.refund_order_model import *
-
-
-class OrderBaseModel(FrameBaseModel):
-    """
-    :description: 订单和中奖记录相关业务模型
-    """
-    def __init__(self, context=None,logging_error=None, logging_info=None):
-        self.context = context
-        self.logging_link_error = logging_error
-        self.logging_link_info = logging_info
-        super(OrderBaseModel,self).__init__(context)
-
-    def _delete_prize_order_dependency_key(self, act_id, user_id, delay_delete_time=0.1):
-        """
-        :description: 删除订单依赖建
-        :param act_id: 活动标识
-        :param user_id: 用户标识
-        :param delay_delete_time: 延迟删除时间，传0则不进行延迟
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        PrizeOrderModel().delete_dependency_key(DependencyKey.prize_order_list(act_id,user_id), delay_delete_time)
-        
-    def _delete_prize_roster_dependency_key(self, act_id, user_id, delay_delete_time=0.1, app_id=''):
-        """
-        :description: 删除中奖记录依赖建
-        :param act_id: 活动标识
-        :param user_id: 用户标识
-        :param delay_delete_time: 延迟删除时间，传0则不进行延迟
-        :param app_id: 应用标识
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        PrizeRosterModel().delete_dependency_key(DependencyKey.prize_roster_list(act_id, user_id, app_id), delay_delete_time)
-
-    def get_prize_order_list(self, app_id, act_id, user_id, open_id, nick_name, order_no, real_name, telephone, address, order_status, create_date_start, create_date_end, page_size=20, page_index=0, order_by="create_date desc", field="*", is_search_roster=False, is_cache=True, condition="", params=[], prize_roster_sub_table=None, page_count_mode="total"):
-        """
-        :description: 用户奖品订单列表
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param user_id：用户标识
-        :param open_id：open_id
-        :param order_no：订单号
-        :param nick_name：用户昵称
-        :param real_name：用户名字
-        :param telephone：联系电话
-        :param address：收货地址
-        :param order_status：订单状态（-1未付款-2付款中0未发货1已发货2不予发货3已退款4交易成功）
-        :param create_date_start：订单创建时间开始
-        :param create_date_end：订单创建时间结束
-        :param page_size：页大小
-        :param page_index：页索引
-        :param order_by：排序
-        :param field：查询字段
-        :param is_search_roster：是否查询订单关联中奖记录
-        :param is_cache：是否缓存
-        :param condition：条件
-        :param params：参数化数组
-        :param prize_roster_sub_table：奖品记录分表名称
-        :param page_count_mode: 分页计数模式 total-计算总数(默认) next-计算是否有下一页(bool) none-不计算       
-        :return:
-        :last_editors: HuangJianYi
-        """
-        page_list = []
-
-        where = "app_id=%s"
-        params_list = [app_id]
-        if act_id >= 0:
-            where += " AND act_id=%s"
-            params_list.append(act_id)
-        if condition:
-            where += " AND " + condition
-            params_list.extend(params)
-        if user_id:
-            where += " AND user_id=%s"
-            params_list.append(user_id)
-        if open_id:
-            where += " AND open_id=%s"
-            params_list.append(open_id)
-        if order_no:
-            where += " AND order_no=%s"
-            params_list.append(order_no)
-        if nick_name:
-            where += " AND user_nick=%s"
-            params_list.append(nick_name)
-        if real_name:
-            where += " AND real_name=%s"
-            params_list.append(real_name)
-        if telephone:
-            where += " AND telephone=%s"
-            params_list.append(telephone)
-        if address:
-            address = f"{address}%"
-            where += " AND address like %s"
-            params_list.append(address)
-        if order_status >=-2:
-            where += " AND order_status=%s"
-            params_list.append(order_status)
-        if create_date_start:
-            where += " AND create_date>=%s"
-            params_list.append(create_date_start)
-        if create_date_end:
-            where += " AND create_date<=%s"
-            params_list.append(create_date_end)
-        prize_order_model = PrizeOrderModel(sub_table=self.get_business_sub_table("prize_order_tb",{"app_id":app_id}),context=self.context)
-        if is_cache:
-            page_list = prize_order_model.get_cache_dict_page_list(field, page_index, page_size, where, "", order_by, params_list, dependency_key=DependencyKey.prize_order_list(act_id,user_id), page_count_mode=page_count_mode)
-        else:
-            page_list = prize_order_model.get_dict_page_list(field, page_index, page_size, where, "", order_by, params_list, page_count_mode)
-        result = None
-        if page_count_mode in ['total','next']:
-            result = page_list[1]
-            page_list = page_list[0]
-        if is_search_roster == True:
-            if not prize_roster_sub_table:
-                prize_roster_sub_table = self.get_business_sub_table("prize_roster_tb",{"app_id":app_id})
-            prize_roster_model = PrizeRosterModel(sub_table=prize_roster_sub_table, context=self.context)
-            if page_list and len(page_list)>0:
-                order_no_list = [str(i['order_no']) for i in page_list]
-                prize_roster_list_dict = prize_roster_model.get_dict_list(SevenHelper.get_condition_by_str_list("order_no",order_no_list))
-                for i in range(len(page_list)):
-                    roster_list = [prize_roster for prize_roster in prize_roster_list_dict if page_list[i]["order_no"] == prize_roster["order_no"]]
-                    page_list[i]["roster_list"] = roster_list
-        if page_count_mode in ['total','next']:
-            return page_list, result
-        return page_list
-
-    def update_prize_order_status(self,app_id,act_id,prize_order_id,order_status,express_company="",express_no="",prize_roster_sub_table=None):
-        """
-        :description: 更新用户奖品订单状态
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param prize_order_id：奖品订单标识
-        :param order_status：订单状态
-        :param express_company：快递公司
-        :param express_no：快递单号
-        :param prize_roster_sub_table：奖品记录分表名称
-        :return: 实体模型InvokeResultData
-        :last_editors: HuangJianYi
-        """
-        now_datetime = SevenHelper.get_now_datetime()
-        db_transaction = DbTransaction(db_config_dict=config.get_value("db_cloudapp"),context=self.context)
-        prize_order_model = PrizeOrderModel(sub_table=self.get_business_sub_table("prize_order_tb",{"app_id":app_id}), db_transaction=db_transaction, context=self.context)
-        if not prize_roster_sub_table:
-            prize_roster_sub_table = self.get_business_sub_table("prize_roster_tb",{"app_id":app_id})
-        prize_roster_model = PrizeRosterModel(sub_table=prize_roster_sub_table, db_transaction=db_transaction, context=self.context)
-        invoke_result_data = InvokeResultData()
-
-        prize_order = prize_order_model.get_entity_by_id(prize_order_id)
-        if not prize_order:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message ="奖品订单信息不存在-1"
-            return invoke_result_data
-        if prize_order.app_id != app_id:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message ="奖品订单信息不存在-2"
-            return invoke_result_data
-        if prize_order.act_id != act_id:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message ="奖品订单信息不存在-3"
-            return invoke_result_data
-        try:
-            db_transaction.begin_transaction()
-            if order_status == 1:
-                if not express_company and not express_no:
-                    invoke_result_data.success = False
-                    invoke_result_data.error_code = "error"
-                    invoke_result_data.error_message ="快递公司或快递单号不能为空"
-                    return invoke_result_data
-                update_sql = "order_status=1,express_company=%s,express_no=%s,deliver_date=%s,modify_date=%s"
-                params = [express_company, express_no, now_datetime, now_datetime, prize_order_id]
-                prize_order_model.update_table(update_sql, "id=%s", params)
-                prize_roster_model.update_table("logistics_status=1", "order_no=%s", [prize_order.order_no])
-            elif order_status == 2:
-                update_sql = "order_status=2,modify_date=%s"
-                params = [now_datetime, prize_order_id]
-                prize_order_model.update_table(update_sql, "id=%s", params)
-                prize_roster_model.update_table("logistics_status=2", "order_no=%s", [prize_order.order_no])
-            else:
-                prize_order_model.update_table("order_status=%s,modify_date=%s", "id=%s", [order_status, now_datetime, prize_order_id])
-                if order_status == 0:
-                    prize_roster_model.update_table("logistics_status=0", "order_no=%s", [prize_order.order_no])
-            result,message = db_transaction.commit_transaction(True)
-            if result == False:
-                raise Exception("执行事务失败",message)
-            prize_order_model.delete_dependency_key(DependencyKey.prize_order_list(prize_order.act_id,prize_order.user_id))
-
-        except Exception as ex:
-            if self.context:
-                self.context.logging_link_error(traceback.format_exc())
-            elif self.logging_link_error:
-                self.logging_link_error(traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message ="操作失败"
-            return invoke_result_data
-        invoke_result_data.data = prize_order.__dict__
-        return invoke_result_data
-
-    def update_prize_order_seller_remark(self,app_id,act_id,prize_order_id,seller_remark):
-        """
-        :description: 更新用户奖品订单卖家备注
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param prize_order_id：奖品订单标识
-        :param seller_remark：卖家备注
-        :return: 实体模型InvokeResultData
-        :last_editors: HuangJianYi
-        """
-        now_datetime = SevenHelper.get_now_datetime()
-        prize_order_model = PrizeOrderModel(sub_table=self.get_business_sub_table("prize_order_tb",{"app_id":app_id}),context=self.context)
-        invoke_result_data = InvokeResultData()
-
-        prize_order = prize_order_model.get_entity_by_id(prize_order_id)
-        if not prize_order:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message ="奖品订单信息不存在-1"
-            return invoke_result_data
-        if prize_order.app_id != app_id:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message ="奖品订单信息不存在-2"
-            return invoke_result_data
-        if prize_order.act_id != act_id:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message ="奖品订单信息不存在-3"
-            return invoke_result_data
-        prize_order_model.update_table("seller_remark=%s,modify_date=%s", "id=%s", [seller_remark, now_datetime, prize_order_id])
-        invoke_result_data.data = prize_order.__dict__
-        return invoke_result_data
-    
-    def update_prize_order_receive_address(self, app_id, act_id, prize_order_id, province=None, city=None, county=None, street=None, address=None, real_name=None, telephone=None):
-        """
-        :description: 更新用户奖品订单收货地址
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param prize_order_id：奖品订单标识
-        :param province:省
-        :param city:市
-        :param county:区县
-        :param street:街道
-        :param address:地址
-        :param real_name:用户名
-        :param telephone:电话
-        :return: 实体模型InvokeResultData
-        :last_editors: HuangJianYi
-        """
-
-        now_datetime = SevenHelper.get_now_datetime()
-        prize_order_model = PrizeOrderModel(sub_table=self.get_business_sub_table("prize_order_tb",{"app_id":app_id}),context=self.context)
-        invoke_result_data = InvokeResultData()
-
-        prize_order = prize_order_model.get_entity_by_id(prize_order_id)
-        if not prize_order:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message ="奖品订单信息不存在-1"
-            return invoke_result_data
-        if prize_order.app_id != app_id:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message ="奖品订单信息不存在-2"
-            return invoke_result_data
-        if prize_order.act_id != act_id:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message ="奖品订单信息不存在-3"
-            return invoke_result_data
-        if province != None:
-            prize_order.province = province
-        if city != None:
-            prize_order.city = city
-        if county != None:
-            prize_order.county = county
-        if street != None:
-            prize_order.street = street
-        if address != None:
-            prize_order.address = address
-        if real_name != None:
-            prize_order.real_name = real_name
-        if telephone != None:
-            prize_order.telephone = telephone
-        prize_order_model.update_table("province=%s,city=%s,county=%s,street=%s,address=%s,real_name=%s,telephone=%s,modify_date=%s", "id=%s", [prize_order.province, prize_order.city, prize_order.county, prize_order.street, prize_order.address, prize_order.real_name, prize_order.telephone, now_datetime, prize_order_id])
-        return invoke_result_data
-
-    def import_prize_order(self, app_id, act_id, content_type, content, ref_head_name='小程序订单号', prize_roster_sub_table=None):
-        """
-        :description: 
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param content_type：内容类型 1-base64字符串内容 2-json字符串内容
-        :param content：字符串内容
-        :param ref_head_name：关联表头名称
-        :param prize_roster_sub_table：奖品记录分表名称
-        :return 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-
-        prize_order_model = PrizeOrderModel(sub_table=self.get_business_sub_table("prize_order_tb",{"app_id":app_id}),context=self.context)
-        if not prize_roster_sub_table:
-            prize_roster_sub_table = self.get_business_sub_table("prize_roster_tb",{"app_id":app_id})
-        prize_roster_model = PrizeRosterModel(sub_table=prize_roster_sub_table, context=self.context)
-        data = []
-        total_num = 0
-        if content_type == 1:
-            data = base64.decodebytes(str(content).encode())
-            if not os.path.exists("temp"):
-                os.makedirs("temp")
-            path = "temp/" + UUIDHelper.get_uuid() + ".xlsx"
-            with open(path, 'ba') as f:
-                buf = bytearray(data)
-                f.write(buf)
-            f.close()
-            order_no_index = -1
-            express_no_index = -1
-            express_company_index = -1
-
-            data = ExcelHelper.input(path)
-            data_total = len(data)
-            # 表格头部
-            if data_total > 0:
-                title_list = data[0]
-                if ref_head_name in title_list:
-                    order_no_index = title_list.index(ref_head_name)
-                if "物流单号" in title_list:
-                    express_no_index = title_list.index("物流单号")
-                if "物流公司" in title_list:
-                    express_company_index = title_list.index("物流公司")
-
-            if order_no_index == -1 or express_no_index == -1 or express_company_index == -1:
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "error"
-                invoke_result_data.error_message ="缺少必要字段，无法导入订单"
-                return invoke_result_data
-            # 数据导入
-            for i in range(1, data_total):
-                row = data[i]
-                order_no = str(row[order_no_index]).strip()
-                express_no = str(row[express_no_index]).strip()
-                express_company = str(row[express_company_index]).strip()
-                if order_no and express_no and express_company:
-                    now_datetime = SevenHelper.get_now_datetime()
-                    update_sql = "order_status=1,express_company=%s,express_no=%s,deliver_date=%s"
-                    params = [express_company, express_no, now_datetime, order_no]
-                    result = prize_order_model.update_table(update_sql, "order_no=%s", params)
-                    if result == True:
-                        prize_roster_model.update_table("logistics_status=1", "order_no=%s", [order_no])
-                        total_num += 1
-            os.remove(path)
-        else:
-            data = SevenHelper.json_loads(content)
-            for row in data:
-                order_no = str(row[ref_head_name]).strip()
-                express_no = str(row['物流单号']).strip()
-                express_company = str(row['物流公司']).strip()
-                if order_no and express_no and express_company:
-                    now_datetime = SevenHelper.get_now_datetime()
-                    update_sql = "order_status=1,express_company=%s,express_no=%s,deliver_date=%s"
-                    params = [express_company, express_no, now_datetime, order_no]
-                    result = prize_order_model.update_table(update_sql, "order_no=%s", params)
-                    if result == True:
-                        prize_roster_model.update_table("logistics_status=1", "order_no=%s", [order_no])
-                        total_num += 1
-                else:
-                    continue
-        invoke_result_data.data = {"total_num": total_num}
-        return invoke_result_data
-
-    def select_prize_order(self,app_id,act_id,user_id,login_token,prize_ids,real_name,telephone,province,city,county,street,address):
-        """
-        :description: 选择奖品进行下单
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param user_id：用户标识
-        :param login_token:用户访问令牌
-        :param prize_ids:用户奖品id串，逗号分隔（为空则将所有未下单的奖品进行下单）
-        :param real_name:用户名
-        :param telephone:电话
-        :param province:省
-        :param city:市
-        :param county:区县
-        :param street:街道
-        :param address:地址
-        :return 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-
-        db_transaction = DbTransaction(db_config_dict=config.get_value("db_cloudapp"),context=self.context)
-        prize_roster_model = PrizeRosterModel(sub_table=self.get_business_sub_table("prize_roster_tb",{"app_id":app_id}), db_transaction=db_transaction, context=self.context)
-        prize_order_model = PrizeOrderModel(sub_table=self.get_business_sub_table("prize_order_tb",{"app_id":app_id}),db_transaction=db_transaction, context=self.context)
-        prize_ids_list = []
-        if prize_ids:
-            prize_ids_list = prize_ids.split(',')
-            for prize_id in prize_ids_list:
-                try:
-                    prize_id = int(prize_id)
-                except Exception as ex:
-                    invoke_result_data.success = False
-                    invoke_result_data.error_code = "error"
-                    invoke_result_data.error_message ="存在无法识别的奖品标识"
-                    return invoke_result_data
-
-        #获取用户信息
-        if act_id > 0 :
-            user_info_model = UserInfoModel(sub_table=self.get_business_sub_table("user_info_tb",{"app_id":app_id}), context=self.context)
-            user_info_dict = user_info_model.get_dict("act_id=%s and user_id=%s", limit="1", params=[act_id, user_id])
-            if not user_info_dict:
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "error"
-                invoke_result_data.error_message = "用户不存在"
-                return invoke_result_data
-            if user_info_dict["login_token"] != login_token:
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "error"
-                invoke_result_data.error_message = "已在另一台设备登录,无法操作"
-                return invoke_result_data
-            if int(user_info_dict["user_state"]) == 1:
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "user_exception"
-                invoke_result_data.error_message = "账号异常,请联系客服处理"
-                return invoke_result_data
-        
-        acquire_lock_name = f"create_prize_order_queue_{act_id}_{user_id}" if act_id > 0 else f"create_prize_order_queue_{app_id}_0_{user_id}"
-        acquire_lock_status, identifier = SevenHelper.redis_acquire_lock(acquire_lock_name)
-        if acquire_lock_status == False:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "acquire_lock"
-            invoke_result_data.error_message = "请求超时,请稍后再试"
-            SevenHelper.redis_release_lock(acquire_lock_name, identifier)
-            return invoke_result_data
-        #用户奖品列表
-        if len(prize_ids_list)>0:
-            prize_roster_list = prize_roster_model.get_list("app_id=%s and act_id=%s and user_id=%s and prize_status=0 and id in (" + prize_ids + ")",params=[app_id, act_id, user_id])
-            if len(prize_roster_list) == 0:
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "error"
-                invoke_result_data.error_message = "对不起,所选下单奖品不存在"
-                SevenHelper.redis_release_lock(acquire_lock_name, identifier)
-                return invoke_result_data
-        else:
-            prize_roster_list = prize_roster_model.get_list("app_id=%s and act_id=%s and user_id=%s and prize_status=0",params=[app_id, act_id, user_id])
-
-        now_date = SevenHelper.get_now_datetime()
-        prize_order = PrizeOrder()
-        prize_order.app_id = app_id
-        prize_order.user_id = user_id
-        prize_order.user_nick = user_info_dict["user_nick"]
-        prize_order.open_id = user_info_dict["open_id"]
-        prize_order.act_id = act_id
-        prize_order.real_name = real_name
-        prize_order.telephone = telephone
-        prize_order.province = province
-        prize_order.city = city
-        prize_order.county = county
-        prize_order.street = street
-        prize_order.address = address
-        prize_order.order_status = 0
-        prize_order.create_date = now_date
-        prize_order.modify_date = now_date
-        prize_order.order_no = SevenHelper.create_order_id()
-
-        for prize_roster in prize_roster_list:
-            prize_roster.order_no = prize_order.order_no
-            prize_roster.prize_status = 1
-        try:
-            db_transaction.begin_transaction()
-            prize_order_model.add_entity(prize_order)
-            prize_roster_model.update_list(prize_roster_list, "order_no,prize_status")
-            result,message = db_transaction.commit_transaction(True)
-            if result == False:
-                raise Exception("执行事务失败",message)
-            prize_roster_model.delete_dependency_key([DependencyKey.prize_roster_list(act_id, user_id, app_id),DependencyKey.prize_order_list(act_id,user_id)])
-        except Exception as ex:
-            if self.context:
-                self.context.logging_link_error("create_prize_order:" + traceback.format_exc())
-            elif self.logging_link_error:
-                self.logging_link_error("create_prize_order:" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "对不起,下单失败"
-            SevenHelper.redis_release_lock(acquire_lock_name, identifier)
-            return invoke_result_data
-
-        SevenHelper.redis_release_lock(acquire_lock_name, identifier)
-        self._delete_prize_order_dependency_key(act_id,user_id)
-        self._delete_prize_roster_dependency_key(act_id=act_id, user_id=user_id, app_id=app_id)
-        invoke_result_data.data = prize_order.__dict__
-        return invoke_result_data
-
-    def get_tao_pay_order_list(self,app_id,act_id,user_id,open_id,nick_name,pay_date_start,pay_date_end,page_size=20,page_index=0,field="*",order_by="pay_date desc",condition="",params=[]):
-        """
-        :description: 淘宝用户购买订单列表
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param user_id：用户唯一标识
-        :param open_id：open_id
-        :param nick_name：用户昵称
-        :param pay_date_start：订单支付时间开始
-        :param pay_date_end：订单支付时间结束
-        :param page_size：页大小
-        :param page_index：页索引
-        :param field：查询字段
-        :param order_by：排序
-        :param condition：条件
-        :param params：参数化数组
-        :return: PageInfo
-        :last_editors: HuangJianYi
-        """
-        where = "app_id=%s and act_id=%s"
-        params_list = [app_id,act_id]
-        if condition:
-            where += " AND " + condition
-            params_list.extend(params)
-        page_info = PageInfo(page_index, page_size, 0, [])
-
-        if not act_id:
-            return page_info
-        if user_id:
-            where += " AND user_id=%s"
-            params_list.append(user_id)
-        if open_id:
-            where += " AND open_id=%s"
-            params_list.append(open_id)
-        if nick_name:
-            where += " AND user_nick=%s"
-            params_list.append(nick_name)
-        if pay_date_start:
-            where += " AND pay_date>=%s"
-            params_list.append(pay_date_start)
-        if pay_date_end:
-            where += " AND pay_date<=%s"
-            params_list.append(pay_date_end)
-        page_list, total = TaoPayOrderModel(sub_table=FrameBaseModel(context=self.context).get_business_sub_table("tao_pay_order_tb",{"app_id":app_id}), context=self.context).get_dict_page_list(field, page_index, page_size, where, "", order_by, params_list)
-        page_info = PageInfo(page_index, page_size, total, page_list)
-        return page_info
-
-    def _get_tao_pay_order_no_list(self,app_id,user_id):
-        """
-        :description: 获取已获取奖励的订单子编号列表
-        :param app_id:应用标识
-        :param user_id:用户标识
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        redis_init = SevenHelper.redis_init()
-        pay_order_cache_key = f"sub_pay_order_no_list:appid_{app_id}_userid_{user_id}"
-        pay_order_no_list = redis_init.lrange(pay_order_cache_key,0,-1)
-        pay_order_list = []
-        is_add = False
-        if not pay_order_no_list or len(pay_order_no_list)<=0:
-            tao_pay_order_model = TaoPayOrderModel(sub_table=FrameBaseModel(context=self.context).get_business_sub_table("tao_pay_order_tb",{"app_id":app_id}),context=self.context)
-            pay_order_list = tao_pay_order_model.get_dict_list("app_id=%s and user_id=%s",field="sub_pay_order_no", params=[app_id,user_id])
-            is_add = True
-
-        if len(pay_order_list) >0:
-            for item in pay_order_list:
-                pay_order_no_list.append(item["sub_pay_order_no"])
-                if is_add == True:
-                    redis_init.lpush(pay_order_cache_key,item["sub_pay_order_no"])
-                    redis_init.expire(pay_order_cache_key, 30 * 24 * 3600)
-        return pay_order_no_list,redis_init,pay_order_cache_key
-
-    def sync_tao_pay_order(self,app_id,act_id,module_id,user_id,login_token,handler_name,request_code,asset_type=3,goods_id="",sku_id="",ascription_type=1,app_key="",app_secret="",is_log=False,check_user_nick=True,continue_request_expire=5,support_presale_order=False):
-        """
-        :description: 同步淘宝支付订单给用户加资产
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_id:用户标识
-        :param login_token:访问令牌
-        :param handler_name:接口名称
-        :param request_code:请求代码
-        :param asset_type:资产类型(1-次数2-积分3-价格档位)
-        :param goods_id:商品ID（资产类型为3-价格档位 无需填写）
-        :param sku_id:sku_id (资产类型为3-价格档位 无需填写)
-        :param ascription_type:归属类型（0-抽奖次数订单1-邮费次数订单2-任务订单）
-        :param app_key:app_key
-        :param app_secret:app_secret
-        :param is_log:是否记录top请求日志
-        :param check_user_nick:是否校验昵称为空
-        :param continue_request_expire:连续请求过期时间，为0不进行校验，单位秒
-        :param support_presale_order:是否支持预售订单
-        :return 
-        :last_editors: HuangJianYi
-        """
-        acquire_lock_name = f"sync_tao_pay_order:{act_id}_{module_id}_{user_id}"
-        identifier = ""
-        try:
-            invoke_result_data = self.business_process_executing(app_id,act_id,module_id,user_id,login_token,handler_name,False,check_user_nick,continue_request_expire,acquire_lock_name)
-            if invoke_result_data.success == True:
-                act_info_dict = invoke_result_data.data["act_info_dict"]
-                act_module_dict = invoke_result_data.data["act_module_dict"]
-                user_info_dict = invoke_result_data.data["user_info_dict"]
-                identifier = invoke_result_data.data["identifier"]
-
-                # 获取订单
-                app_info_dict = AppBaseModel(context=self.context).get_app_info_dict(app_id)
-                access_token = app_info_dict["access_token"] if app_info_dict else ""
-                top_base_model = TopBaseModel(context=self.context)
-                order_data = []
-                if act_info_dict['start_date'] != "":
-                    invoke_result_data = top_base_model.get_buy_order_list(user_info_dict["open_id"], access_token,app_key,app_secret, act_info_dict['start_date'],is_log=is_log)
-                    if invoke_result_data.success == True:
-                        order_data = invoke_result_data.data
-                else:
-                    invoke_result_data = top_base_model.get_buy_order_list(user_info_dict["open_id"], access_token,app_key,app_secret,is_log=is_log)
-                    if invoke_result_data.success == True:
-                        order_data = invoke_result_data.data
-                if len(order_data)>0:
-                    pay_order_no_list,redis_init,pay_order_cache_key = self._get_tao_pay_order_no_list(app_id,user_id)
-
-                    goods_ids_list = []
-                    #满足奖励条件的订单
-                    reward_order_list = []
-                    #所有相关商品订单
-                    all_order_list = []
-                    if asset_type == 3:
-                        price_base_model = PriceBaseModel(context=self.context)
-                        price_gear_dict_list = price_base_model.get_price_gear_list(app_id,act_id,100,0,page_count_mode='none')
-                        for price_gear_dict in price_gear_dict_list:
-                            goods_ids_list.append(price_gear_dict["goods_id"])
-                    else:
-                        goods_ids_list.append(str(goods_id))
-
-                    for item in order_data:
-                        for order in item["orders"]["order"]:
-                            if str(order["num_iid"]) in goods_ids_list:
-                                order["step_paid_fee"] = item["step_paid_fee"] if "step_paid_fee" in item.keys() else 0
-                                order["type"] = item["type"]
-                                if "pay_time" in item:
-                                    order["tid"] = item["tid"]
-                                    order["pay_time"] = item["pay_time"]
-                                if support_presale_order == True:
-                                    if order["status"] in self.rewards_status() or (order["type"] == "step" and order["step_trade_status"] != "FRONT_NOPAID_FINAL_NOPAID"):
-                                        reward_order_list.append(order)
-                                else:
-                                    if order["status"] in self.rewards_status():
-                                        reward_order_list.append(order)
-                
-                                all_order_list.append(order)
-
-                    pay_price = 0
-                    pay_num = 0
-                    buy_num = 0
-                    tao_pay_order_list = []
-                    for order in reward_order_list:
-                        try:
-                            #判断是否已经加过奖励
-                            if order["oid"] not in pay_order_no_list:
-                                asset_object_name = ""
-                                asset_object_id = ""
-                                if asset_type == 3:
-                                    now_price_gear_dict = None
-                                    for price_gear_dict in price_gear_dict_list:
-                                        if (price_gear_dict["effective_date"] == '1900-01-01 00:00:00' or TimeHelper.format_time_to_datetime(price_gear_dict["effective_date"]) < TimeHelper.format_time_to_datetime(order["pay_time"])) and price_gear_dict["goods_id"] == str(order["num_iid"]):
-                                            #关联类型：1商品skuid关联2商品id关联
-                                            if price_gear_dict["relation_type"] == 1 and price_gear_dict["sku_id"] != str(order["sku_id"]):
-                                                continue
-                                            now_price_gear_dict = price_gear_dict
-                                    if not now_price_gear_dict:
-                                        continue
-                                    asset_object_id = now_price_gear_dict["id"]
-                                    asset_object_name = now_price_gear_dict["price_gear_name"]
-                                else:
-                                    if str(goods_id) != str(order["num_iid"]):
-                                        continue
-                                    if sku_id and str(sku_id) != str(order["sku_id"]):
-                                        continue
-
-                                tao_pay_order = TaoPayOrder()
-                                tao_pay_order.app_id = app_id
-                                tao_pay_order.act_id = act_id
-                                tao_pay_order.ascription_type = ascription_type
-                                tao_pay_order.user_id = user_id
-                                tao_pay_order.open_id = user_info_dict["open_id"]
-                                tao_pay_order.user_nick = user_info_dict["user_nick"]
-                                tao_pay_order.main_pay_order_no = order['tid']
-                                tao_pay_order.sub_pay_order_no = order['oid']
-                                tao_pay_order.goods_code = order['num_iid']
-                                tao_pay_order.goods_name = order['title']
-                                if "sku_id" in order.keys():
-                                    tao_pay_order.sku_id = order['sku_id']
-                                    sku_invoke_result_data = top_base_model.get_sku_name(int(order['num_iid']), int(order['sku_id']), access_token,app_key, app_secret,is_log)
-                                    tao_pay_order.sku_name = sku_invoke_result_data.data if sku_invoke_result_data.success == True else ""
-                                tao_pay_order.buy_num = order['num']
-                                tao_pay_order.pay_price = order['payment']
-                                tao_pay_order.order_status = order['status']
-                                tao_pay_order.create_date = SevenHelper.get_now_datetime()
-                                tao_pay_order.asset_type = asset_type
-                                tao_pay_order.asset_object_id = asset_object_id
-                                tao_pay_order.asset_object_name = asset_object_name
-                                tao_pay_order.surplus_count = order['num']
-                                tao_pay_order.pay_date = order['pay_time']
-                                tao_pay_order_list.append(tao_pay_order)
-                                if support_presale_order == True:
-                                    payment = decimal.Decimal(order["step_paid_fee"]) if order["type"] == "step" and decimal.Decimal(order["step_paid_fee"]) > 0 else decimal.Decimal(order["payment"])
-                                else:
-                                    payment = decimal.Decimal(order["payment"])
-                                pay_price = decimal.Decimal(pay_price) + payment
-                                pay_num = pay_num + 1
-                                buy_num = buy_num + order['num']
-                        except Exception as ex:
-                            if self.context:
-                                self.context.logging_link_info(str(order) + "【同步淘宝支付订单】" + traceback.format_exc())
-                            elif self.logging_link_info:
-                                self.logging_link_info(str(order) + "【同步淘宝支付订单】" + traceback.format_exc())
-                            continue
-                    if len(tao_pay_order_list) > 0:
-                        result = TaoPayOrderModel(sub_table=FrameBaseModel(context=self.context).get_business_sub_table("tao_pay_order_tb",{"app_id":app_id}),context=self.context).add_list(tao_pay_order_list)
-                        if result == True and buy_num > 0:
-                            asset_base_model = AssetBaseModel(context=self.context)
-                            invoke_result_data.data = {}
-                            invoke_result_data.data["asset_list"] = []
-                            for item in tao_pay_order_list:
-                                only_id = str(item.sub_pay_order_no)
-                                asset_invoke_result_data = asset_base_model.update_user_asset(app_id,act_id,module_id,user_id,user_info_dict["open_id"],user_info_dict["user_nick"],asset_type,item.buy_num,item.asset_object_id,1,"","","购买",only_id,handler_name,request_code,info_json={})
-                                if asset_invoke_result_data.success == False:
-                                    invoke_result_data.success = False
-                                    invoke_result_data.error_code = "error"
-                                    invoke_result_data.error_message = "变更资产失败"
-                                else:
-                                    redis_init.lpush(pay_order_cache_key,item.sub_pay_order_no)
-                                    redis_init.expire(pay_order_cache_key, 30 * 24 * 3600)
-                                    data = {}
-                                    data["asset_type"] = asset_type
-                                    data["asset_object_id"] = item.asset_object_id
-                                    data["buy_num"] = item.buy_num
-                                    invoke_result_data.data["asset_list"].append(data)
-                            invoke_result_data.data["buy_num"] = buy_num
-                            invoke_result_data.data["pay_price"] = pay_price
-                            invoke_result_data.data["pay_num"] = pay_num
-                        else:
-                            invoke_result_data.success = False
-                            invoke_result_data.error_code = "error"
-                            invoke_result_data.error_message = "没有匹配订单"
-                    else:
-                        invoke_result_data.success = False
-                        invoke_result_data.error_code = "error"
-                        invoke_result_data.error_message = "没有匹配订单"
-                    if len(all_order_list) >0:
-                        user_base_model = UserBaseModel(context=self.context)
-                        black_status = user_base_model.check_pull_black(user_info_dict,act_info_dict["is_black"],act_info_dict["refund_count"],all_order_list)
-                        if black_status == True:
-                            invoke_result_data.data = {} if not invoke_result_data.data else invoke_result_data.data
-                            invoke_result_data.data["user_state"] = 1
-                else:
-                    invoke_result_data.success = False
-                    invoke_result_data.error_code = "error"
-                    invoke_result_data.error_message = "没有订单"
-        except Exception as ex:
-            if self.context:
-                self.context.logging_link_error("【同步淘宝支付订单】" + traceback.format_exc())
-            elif self.logging_link_error:
-                self.logging_link_error("【同步淘宝支付订单】" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "exception"
-            invoke_result_data.error_message = "系统繁忙,请稍后再试"
-        finally:
-            self.business_process_executed(act_id,module_id,user_id,handler_name,acquire_lock_name,identifier)
-
-        return invoke_result_data
-
-    def get_prize_roster_list(self,app_id,act_id,module_id,user_id,open_id="",user_nick="",order_no="",goods_type=-1,prize_type=-1,logistics_status=-1,prize_status=-1,pay_status=-1,page_size=20,page_index=0,create_date_start="",create_date_end="",order_by="create_date desc",field="*",condition="",params=[],is_cache=True, page_count_mode="total"):
-        """
-        :description: 用户中奖记录列表
-        :description: 如果有进行数据缓存，创建中奖记录时需清掉依赖建
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param module_id：活动模块标识
-        :param user_id：用户标识
-        :param open_id：open_id
-        :param user_nick：用户昵称
-        :param order_no：订单号
-        :param goods_type：物品类型（1虚拟2实物）
-        :param prize_type：奖品类型(1现货2优惠券3红包4参与奖5预售)
-        :param logistics_status：物流状态（0未发货1已发货2不予发货）
-        :param prize_status：奖品状态（0未下单（未领取）1已下单（已领取）2已回购10已隐藏（删除）11无需发货）
-        :param pay_status：支付状态(0未支付1已支付2已退款3处理中)
-        :param page_size：页大小
-        :param page_index：页索引
-        :param create_date_start：开始时间
-        :param create_date_end：结束时间
-        :param order_by：排序
-        :param field：查询字段
-        :param condition：条件
-        :param params：参数化数组
-        :param is_cache：是否缓存
-        :param page_count_mode: 分页计数模式 total-计算总数(默认) next-计算是否有下一页(bool) none-不计算
-        :return:
-        :last_editors: HuangJianYi
-        """
-        condition_where = ConditionWhere()
-        condition_where.add_condition("app_id=%s")
-        params_list = [app_id]
-        if act_id >= 0:
-            condition_where.add_condition("act_id=%s")
-            params_list.append(act_id)
-        if module_id:
-            condition_where.add_condition("module_id=%s")
-            params_list.append(module_id)
-        if user_id:
-            condition_where.add_condition("user_id=%s")
-            params_list.append(user_id)
-        if open_id:
-            condition_where.add_condition("open_id=%s")
-            params_list.append(open_id)
-        if user_nick:
-            condition_where.add_condition("user_nick=%s")
-            params_list.append(user_nick)
-        if order_no:
-            condition_where.add_condition("order_no=%s")
-            params_list.append(order_no)
-        if goods_type !=-1:
-            condition_where.add_condition("goods_type=%s")
-            params_list.append(goods_type)
-        if prize_type !=-1:
-            condition_where.add_condition("prize_type=%s")
-            params_list.append(prize_type)
-        if logistics_status !=-1:
-            condition_where.add_condition("logistics_status=%s")
-            params_list.append(logistics_status)
-        if prize_status !=-1:
-            condition_where.add_condition("prize_status=%s")
-            params_list.append(prize_status)
-        if pay_status !=-1:
-            condition_where.add_condition("pay_status=%s")
-            params_list.append(pay_status)
-        if create_date_start:
-            condition_where.add_condition("create_date>=%s")
-            params_list.append(create_date_start)
-        if create_date_end:
-            condition_where.add_condition("create_date<=%s")
-            params_list.append(create_date_end)
-        if condition:
-            condition_where.add_condition(condition)
-            params_list.extend(params)
-
-        prize_roster_model = PrizeRosterModel(sub_table=self.get_business_sub_table("prize_roster_tb",{"app_id":app_id}),context=self.context)
-        if is_cache:
-            page_list = prize_roster_model.get_cache_dict_page_list(field, page_index, page_size, condition_where.to_string(), "", order_by, params_list, dependency_key=DependencyKey.prize_roster_list(act_id,user_id,app_id), page_count_mode=page_count_mode)
-        else:
-            page_list = prize_roster_model.get_dict_page_list(field, page_index, page_size, condition_where.to_string(), "", order_by, params_list, page_count_mode)
-        return page_list
-
-    def get_horseracelamp_list(self, app_id, act_id, module_id, is_search_module=False, condition="", params=[], page_size=30):
-        """
-        :description: 获取跑马灯奖品列表
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param is_search_module:是否查询活动模块
-        :param condition：条件
-        :param params：参数数组
-        :param page_size：页大小
-        :return list
-        :last_editors: HuangJianYi
-        """
-        condition_where = ConditionWhere()
-        condition_where.add_condition("app_id=%s")
-        params_list = [app_id]
-        if act_id >= 0:
-            condition_where.add_condition("act_id=%s")
-            params_list.append(act_id)
-        if is_search_module == True and module_id:
-            condition_where.add_condition("module_id=%s")
-            params_list.append(module_id)
-        if condition:
-            condition_where.add_condition(condition)
-            params_list.extend(params)
-        act_prize_list_dict = ActPrizeModel(context=self.context).get_cache_dict_list("act_id=%s and is_prize_notice=1 and is_del=0", params=[act_id],cache_expire=60)
-        if act_prize_list_dict:
-            if len(act_prize_list_dict) > 100:
-                act_prize_list_dict = random.sample(act_prize_list_dict,50)
-
-            prize_id_list = [str(i["id"]) for i in act_prize_list_dict]
-            if len(prize_id_list) > 0:
-                prize_ids = ",".join(prize_id_list)
-                condition_where.add_condition("prize_id in (" + prize_ids + ")")
-        prize_roster_model = PrizeRosterModel(sub_table=self.get_business_sub_table("prize_roster_tb",{"app_id":app_id}),context=self.context)
-        prize_roster_list = prize_roster_model.get_cache_dict_list(condition_where.to_string(), "", "create_date desc", str(page_size), "user_nick,prize_name,tag_id,module_name", params_list, cache_expire=60)
-        total = int(len(prize_roster_list))
-        if total == 0:
-            prize_roster_list = []
-        else:
-            for i in range(len(prize_roster_list)):
-                if prize_roster_list[i]["user_nick"]:
-                    length = len(prize_roster_list[i]["user_nick"])
-                    if length > 2:
-                        user_nick = prize_roster_list[i]["user_nick"][0:length - 2] + "**"
-                    else:
-                        user_nick = prize_roster_list[i]["user_nick"][0:1] + "*"
-                    prize_roster_list[i]["user_nick"] = user_nick
-        act_module_list = []
-        if total < page_size:
-            add_num = page_size - total
-            act_prize_model = ActPrizeModel(context=self.context)
-            prize_condition = "act_id=%s and is_prize_notice=1"
-            prize_params = [act_id]
-
-            if is_search_module == True:
-                module_condition = "act_id=%s and is_fictitious=1"
-                module_params = [act_id]
-                if module_id >0:
-                    module_condition += " and id=%s"
-                    module_params = [act_id, module_id]
-                act_module_list = ActModuleModel(context=self.context).get_cache_list(module_condition, params=module_params,cache_expire=60)
-                if len(act_module_list) > 0:
-                    module_id_list = [str(i.id) for i in act_module_list]
-                    module_ids = ",".join(module_id_list)
-                    prize_condition += " and module_id in (" + module_ids + ")"
-            false_act_prize_list = act_prize_model.get_cache_list(prize_condition, order_by="probability desc,chance desc", limit="30", params=prize_params,cache_expire=60)
-            if len(false_act_prize_list) > 0 and add_num > 0:
-                now_datetime = TimeHelper.add_hours_by_format_time(hour=-random.randint(0, 1000))
-                user_info_list_dict = UserInfoModel(sub_table=self.get_business_sub_table("user_info_tb",{"app_id":false_act_prize_list[0].app_id}),context=self.context).get_dict_list("act_id<%s and create_date>%s", params=[act_id,now_datetime], limit=str(add_num))
-
-                for i in range(len(user_info_list_dict)):
-                    false_act_prize = false_act_prize_list[random.randint(0, len(false_act_prize_list)-1)]
-                    if not false_act_prize:
-                        continue
-                    prize_roster = {}
-                    user_nick = ""
-                    if user_info_list_dict[i]["user_nick"]:
-                        length = len(user_info_list_dict[i]["user_nick"])
-                        if length > 2:
-                            user_nick = user_info_list_dict[i]["user_nick"][0:length - 2] + "**"
-                        else:
-                            user_nick = user_info_list_dict[i]["user_nick"][0:1] + "*"
-                    prize_roster["user_nick"] = user_nick
-                    prize_roster["prize_name"] = false_act_prize.prize_name
-                    prize_roster["tag_id"] = false_act_prize.tag_id
-                    act_module_filter = [act_module for act_module in act_module_list if false_act_prize.module_id == act_module.id]
-                    prize_roster["module_name"] = act_module_filter[0].module_name if len(act_module_filter) > 0 else ""
-                    prize_roster_list.append(prize_roster)
-
-        return prize_roster_list
-
-    def get_coupon_prize(self, app_id, act_id, user_id, user_prize_id, app_key, app_secret, is_log=False):
-        """
-        :description: 领取淘宝优惠券
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param user_id：用户标识
-        :param user_prize_id:用户奖品标识
-        :param app_key:app_key
-        :param app_secret:app_secret
-        :param is_log:是否记录日志
-        :return 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        app_base_model = AppBaseModel(context=self.context)
-        app_info_dict = app_base_model.get_app_info_dict(app_id)
-        if not app_info_dict:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message ="小程序不存在"
-            return invoke_result_data
-        access_token = app_info_dict["access_token"]
-        if access_token == "":
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message ="未授权请联系客服授权"
-            return invoke_result_data
-        prize_roster_model = PrizeRosterModel(sub_table=self.get_business_sub_table("prize_roster_tb",{"app_id":app_id}),context=self.context)
-        prize_roster_dict = prize_roster_model.get_cache_dict_by_id(user_prize_id, dependency_key=DependencyKey.prize_roster_list(act_id,user_id,app_id))
-        if not prize_roster_dict or prize_roster_dict['user_id'] != user_id:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message ="奖品不存在"
-            return invoke_result_data
-        tao_coupon_model = TaoCouponModel(context=self.context)
-        tao_coupon_dict = tao_coupon_model.get_dict(where="prize_id=%s", limit="1", params=[prize_roster_dict["prize_id"]])
-        if not tao_coupon_dict or tao_coupon_dict['right_ename'] == "":
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message ="奖品不是优惠券,无需领取"
-            return invoke_result_data
-        top_base_model = TopBaseModel(context=self.context)
-        top_invoke_result_data = top_base_model.alibaba_benefit_send(tao_coupon_dict['right_ename'], prize_roster_dict["open_id"], access_token, app_key, app_secret, is_log)
-        if top_invoke_result_data.success == False:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message ="领取失败"
-            return invoke_result_data
-        resp = top_invoke_result_data.data
-        if resp["alibaba_benefit_send_response"]:
-            if resp["alibaba_benefit_send_response"]["result_success"] == True:
-                prize_roster_model.update_table("prize_status=1", "id=%s", params=[user_prize_id])
-                prize_roster_model.delete_dependency_key(DependencyKey.prize_roster_list(act_id,user_id,app_id))
-                result = {}
-                result["prize_name"] = resp["alibaba_benefit_send_response"]["prize_name"]
-                invoke_result_data.data = result
-                return invoke_result_data
-            if resp["alibaba_benefit_send_response"]["result_code"] == "COUPON_INVALID_OR_DELETED":
-                prize_roster_model.update_table("prize_status=10", "id=%s", params=[user_prize_id])
-                prize_roster_model.delete_dependency_key(DependencyKey.prize_roster_list(act_id,user_id,app_id))
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "error"
-                invoke_result_data.error_message ="领取失败：优惠券无效或已删除"
-                return invoke_result_data
-            if resp["alibaba_benefit_send_response"]["result_code"] == "COUPON_NOT_EXISTS":
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "error"
-                invoke_result_data.error_message ="领取失败：优惠券不存在"
-                return invoke_result_data
-            if resp["alibaba_benefit_send_response"]["result_code"] == "APPLY_SINGLE_COUPON_COUNT_EXCEED_LIMIT":
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "error"
-                invoke_result_data.error_message ="领取失败：优惠券超过限额"
-                return invoke_result_data
-            if resp["alibaba_benefit_send_response"]["result_code"] == "USER_PERMISSION_EXCEED_MAX_RIGHT_COUNT_IN_DAY":
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "error"
-                invoke_result_data.error_message ="领取失败：同一张优惠券每天限领取一次"
-                return invoke_result_data
-            if resp["alibaba_benefit_send_response"]["result_code"] == "APPLY_ONE_SELLER_COUNT_EXCEED_LIMIT":
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "error"
-                invoke_result_data.error_message ="领取失败：用户优惠券超出10张限制"
-                return invoke_result_data
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message ="领取失败"
-            invoke_result_data.data = resp["alibaba_benefit_send_response"]["result_code"]
-            return invoke_result_data
-            
-        else:
-            result = resp["sub_msg"] if resp["sub_msg"] else ""
-            if result == "" and resp["result_msg"]:
-                result = resp["result_msg"]
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = f"领取失败:{result}"
-            return invoke_result_data
-
-    def create_wechat_refund(self, source_type, app_id, act_id, pay_order_no, refund_amount = 0, refund_reason = ""):
-        """
-        :description: 创建微信退款
-        :param source_type：来源类型（1用户申请退款2人工审核退款3自动退款）
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param pay_order_no：支付单号
-        :param refund_reason：退款原因
-        :return 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        pay_order_model = PayOrderModel(context=self)
-        refund_order_model = RefundOrderModel(context=self)
-        #请求太频繁限制
-        if SevenHelper.is_continue_request(f"create_wechat_refund:{app_id}_{pay_order_no}", 1000) == False:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message ="请求太频繁,请稍后再试"
-            return invoke_result_data
-
-        pay_order = pay_order_model.get_entity("pay_order_no=%s", params=pay_order_no)
-        if not pay_order:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message ="对不起，找不到支付订单"
-            return invoke_result_data
-
-        refund_order = refund_order_model.get_entity(where="pay_order_no=%s AND refund_status in (1,2)", params=[pay_order_no])
-        if refund_order:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message ="对不起，退款处理中"
-            return invoke_result_data
-        if refund_amount <= 0:
-            refund_amount = pay_order.pay_amount
-        if pay_order.refund_amount + refund_amount > pay_order.pay_amount:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message ="退款总金额不能超过支付金额"
-            return invoke_result_data
-            
-        refund_status = 0
-        if source_type == 1:
-            refund_reason = refund_reason
-            refund_status = 1
-        elif source_type == 2:
-            refund_reason = "人工审核退款"
-        elif source_type == 3:
-            refund_reason = "自动退款"
-        
-        
-        refund_no = SevenHelper.create_order_id()
-        #创建退款预订单
-        refund_order = RefundOrder()
-        refund_order.app_id = app_id
-        refund_order.act_id = act_id
-        refund_order.user_id = pay_order.user_id
-        refund_order.open_id = pay_order.open_id
-        refund_order.pay_order_no = pay_order_no
-        refund_order.refund_no = refund_no
-        refund_order.out_order_no = pay_order.out_order_no
-        refund_order.refund_amount = refund_amount
-        refund_order.refund_status = refund_status
-        refund_order.refund_reason = refund_reason
-        refund_order.create_date = SevenHelper.get_now_datetime()
-        refund_order.id = refund_order_model.add_entity(refund_order)
-        if refund_order.id <= 0:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message ="对不起，创建退款订单失败"
-            return invoke_result_data
-        
-        if source_type != 1:
-            wechat_pay = share_config.get_value("wechat_pay")
-            #退款异步通知地址
-            notify_url = wechat_pay["notify_url"]
-            result_data = WeChatPayRequest().create_refund(refund_no, pay_order.pay_order_no, notify_url, refund_amount, pay_order.pay_amount)
-            if result_data.success == False:
-                refund_order_model.del_entity("id=%s", params=refund_order.id)
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "error"
-                invoke_result_data.error_message ="对不起，创建退款订单异常"
-                return invoke_result_data
-            refund_order_model.update_table("refund_status=2", "id=%s", params=refund_order.id)
-            invoke_result_data.data = refund_no
-
-        return invoke_result_data
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-08-09 09:24:43
+@LastEditTime: 2023-06-25 17:20:45
+@LastEditors: HuangJianYi
+@Description: 
+"""
+from seven_cloudapp_frame.libs.customize.wechat_helper import WeChatPayRequest
+from seven_cloudapp_frame.models.user_base_model import UserBaseModel
+from seven_cloudapp_frame.models.frame_base_model import FrameBaseModel
+from seven_cloudapp_frame.models.seven_model import *
+from seven_cloudapp_frame.models.app_base_model import *
+from seven_cloudapp_frame.models.top_base_model import *
+from seven_cloudapp_frame.models.price_base_model import *
+from seven_cloudapp_frame.models.asset_base_model import *
+from seven_cloudapp_frame.models.db_models.act.act_module_model import *
+from seven_cloudapp_frame.models.db_models.prize.prize_order_model import *
+from seven_cloudapp_frame.models.db_models.prize.prize_roster_model import *
+from seven_cloudapp_frame.models.db_models.tao.tao_pay_order_model import *
+from seven_cloudapp_frame.models.db_models.user.user_info_model import *
+from seven_cloudapp_frame.models.db_models.tao.tao_coupon_model import *
+from seven_cloudapp_frame.models.db_models.pay.pay_order_model import *
+from seven_cloudapp_frame.models.db_models.refund.refund_order_model import *
+
+
+class OrderBaseModel(FrameBaseModel):
+    """
+    :description: 订单和中奖记录相关业务模型
+    """
+    def __init__(self, context=None,logging_error=None, logging_info=None):
+        self.context = context
+        self.logging_link_error = logging_error
+        self.logging_link_info = logging_info
+        super(OrderBaseModel,self).__init__(context)
+
+    def _delete_prize_order_dependency_key(self, act_id, user_id, delay_delete_time=0.1):
+        """
+        :description: 删除订单依赖建
+        :param act_id: 活动标识
+        :param user_id: 用户标识
+        :param delay_delete_time: 延迟删除时间，传0则不进行延迟
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        PrizeOrderModel().delete_dependency_key(DependencyKey.prize_order_list(act_id,user_id), delay_delete_time)
+        
+    def _delete_prize_roster_dependency_key(self, act_id, user_id, delay_delete_time=0.1, app_id=''):
+        """
+        :description: 删除中奖记录依赖建
+        :param act_id: 活动标识
+        :param user_id: 用户标识
+        :param delay_delete_time: 延迟删除时间，传0则不进行延迟
+        :param app_id: 应用标识
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        PrizeRosterModel().delete_dependency_key(DependencyKey.prize_roster_list(act_id, user_id, app_id), delay_delete_time)
+
+    def get_prize_order_list(self, app_id, act_id, user_id, open_id, nick_name, order_no, real_name, telephone, address, order_status, create_date_start, create_date_end, page_size=20, page_index=0, order_by="create_date desc", field="*", is_search_roster=False, is_cache=True, condition="", params=[], prize_roster_sub_table=None, page_count_mode="total"):
+        """
+        :description: 用户奖品订单列表
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param user_id：用户标识
+        :param open_id：open_id
+        :param order_no：订单号
+        :param nick_name：用户昵称
+        :param real_name：用户名字
+        :param telephone：联系电话
+        :param address：收货地址
+        :param order_status：订单状态（-1未付款-2付款中0未发货1已发货2不予发货3已退款4交易成功）
+        :param create_date_start：订单创建时间开始
+        :param create_date_end：订单创建时间结束
+        :param page_size：页大小
+        :param page_index：页索引
+        :param order_by：排序
+        :param field：查询字段
+        :param is_search_roster：是否查询订单关联中奖记录
+        :param is_cache：是否缓存
+        :param condition：条件
+        :param params：参数化数组
+        :param prize_roster_sub_table：奖品记录分表名称
+        :param page_count_mode: 分页计数模式 total-计算总数(默认) next-计算是否有下一页(bool) none-不计算       
+        :return:
+        :last_editors: HuangJianYi
+        """
+        page_list = []
+
+        where = "app_id=%s"
+        params_list = [app_id]
+        if act_id >= 0:
+            where += " AND act_id=%s"
+            params_list.append(act_id)
+        if condition:
+            where += " AND " + condition
+            params_list.extend(params)
+        if user_id:
+            where += " AND user_id=%s"
+            params_list.append(user_id)
+        if open_id:
+            where += " AND open_id=%s"
+            params_list.append(open_id)
+        if order_no:
+            where += " AND order_no=%s"
+            params_list.append(order_no)
+        if nick_name:
+            where += " AND user_nick=%s"
+            params_list.append(nick_name)
+        if real_name:
+            where += " AND real_name=%s"
+            params_list.append(real_name)
+        if telephone:
+            where += " AND telephone=%s"
+            params_list.append(telephone)
+        if address:
+            address = f"{address}%"
+            where += " AND address like %s"
+            params_list.append(address)
+        if order_status >=-2:
+            where += " AND order_status=%s"
+            params_list.append(order_status)
+        if create_date_start:
+            where += " AND create_date>=%s"
+            params_list.append(create_date_start)
+        if create_date_end:
+            where += " AND create_date<=%s"
+            params_list.append(create_date_end)
+        prize_order_model = PrizeOrderModel(sub_table=self.get_business_sub_table("prize_order_tb",{"app_id":app_id}),context=self.context)
+        if is_cache:
+            page_list = prize_order_model.get_cache_dict_page_list(field, page_index, page_size, where, "", order_by, params_list, dependency_key=DependencyKey.prize_order_list(act_id,user_id), page_count_mode=page_count_mode)
+        else:
+            page_list = prize_order_model.get_dict_page_list(field, page_index, page_size, where, "", order_by, params_list, page_count_mode)
+        result = None
+        if page_count_mode in ['total','next']:
+            result = page_list[1]
+            page_list = page_list[0]
+        if is_search_roster == True:
+            if not prize_roster_sub_table:
+                prize_roster_sub_table = self.get_business_sub_table("prize_roster_tb",{"app_id":app_id})
+            prize_roster_model = PrizeRosterModel(sub_table=prize_roster_sub_table, context=self.context)
+            if page_list and len(page_list)>0:
+                order_no_list = [str(i['order_no']) for i in page_list]
+                prize_roster_list_dict = prize_roster_model.get_dict_list(SevenHelper.get_condition_by_str_list("order_no",order_no_list))
+                for i in range(len(page_list)):
+                    roster_list = [prize_roster for prize_roster in prize_roster_list_dict if page_list[i]["order_no"] == prize_roster["order_no"]]
+                    page_list[i]["roster_list"] = roster_list
+        if page_count_mode in ['total','next']:
+            return page_list, result
+        return page_list
+
+    def update_prize_order_status(self,app_id,act_id,prize_order_id,order_status,express_company="",express_no="",prize_roster_sub_table=None):
+        """
+        :description: 更新用户奖品订单状态
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param prize_order_id：奖品订单标识
+        :param order_status：订单状态
+        :param express_company：快递公司
+        :param express_no：快递单号
+        :param prize_roster_sub_table：奖品记录分表名称
+        :return: 实体模型InvokeResultData
+        :last_editors: HuangJianYi
+        """
+        now_datetime = SevenHelper.get_now_datetime()
+        db_transaction = DbTransaction(db_config_dict=config.get_value("db_cloudapp"),context=self.context)
+        prize_order_model = PrizeOrderModel(sub_table=self.get_business_sub_table("prize_order_tb",{"app_id":app_id}), db_transaction=db_transaction, context=self.context)
+        if not prize_roster_sub_table:
+            prize_roster_sub_table = self.get_business_sub_table("prize_roster_tb",{"app_id":app_id})
+        prize_roster_model = PrizeRosterModel(sub_table=prize_roster_sub_table, db_transaction=db_transaction, context=self.context)
+        invoke_result_data = InvokeResultData()
+
+        prize_order = prize_order_model.get_entity_by_id(prize_order_id)
+        if not prize_order:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message ="奖品订单信息不存在-1"
+            return invoke_result_data
+        if prize_order.app_id != app_id:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message ="奖品订单信息不存在-2"
+            return invoke_result_data
+        if prize_order.act_id != act_id:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message ="奖品订单信息不存在-3"
+            return invoke_result_data
+        try:
+            db_transaction.begin_transaction()
+            if order_status == 1:
+                if not express_company and not express_no:
+                    invoke_result_data.success = False
+                    invoke_result_data.error_code = "error"
+                    invoke_result_data.error_message ="快递公司或快递单号不能为空"
+                    return invoke_result_data
+                update_sql = "order_status=1,express_company=%s,express_no=%s,deliver_date=%s,modify_date=%s"
+                params = [express_company, express_no, now_datetime, now_datetime, prize_order_id]
+                prize_order_model.update_table(update_sql, "id=%s", params)
+                prize_roster_model.update_table("logistics_status=1", "order_no=%s", [prize_order.order_no])
+            elif order_status == 2:
+                update_sql = "order_status=2,modify_date=%s"
+                params = [now_datetime, prize_order_id]
+                prize_order_model.update_table(update_sql, "id=%s", params)
+                prize_roster_model.update_table("logistics_status=2", "order_no=%s", [prize_order.order_no])
+            else:
+                prize_order_model.update_table("order_status=%s,modify_date=%s", "id=%s", [order_status, now_datetime, prize_order_id])
+                if order_status == 0:
+                    prize_roster_model.update_table("logistics_status=0", "order_no=%s", [prize_order.order_no])
+            result,message = db_transaction.commit_transaction(True)
+            if result == False:
+                raise Exception("执行事务失败",message)
+            prize_order_model.delete_dependency_key(DependencyKey.prize_order_list(prize_order.act_id,prize_order.user_id))
+
+        except Exception as ex:
+            if self.context:
+                self.context.logging_link_error(traceback.format_exc())
+            elif self.logging_link_error:
+                self.logging_link_error(traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message ="操作失败"
+            return invoke_result_data
+        invoke_result_data.data = prize_order.__dict__
+        return invoke_result_data
+
+    def update_prize_order_seller_remark(self,app_id,act_id,prize_order_id,seller_remark):
+        """
+        :description: 更新用户奖品订单卖家备注
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param prize_order_id：奖品订单标识
+        :param seller_remark：卖家备注
+        :return: 实体模型InvokeResultData
+        :last_editors: HuangJianYi
+        """
+        now_datetime = SevenHelper.get_now_datetime()
+        prize_order_model = PrizeOrderModel(sub_table=self.get_business_sub_table("prize_order_tb",{"app_id":app_id}),context=self.context)
+        invoke_result_data = InvokeResultData()
+
+        prize_order = prize_order_model.get_entity_by_id(prize_order_id)
+        if not prize_order:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message ="奖品订单信息不存在-1"
+            return invoke_result_data
+        if prize_order.app_id != app_id:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message ="奖品订单信息不存在-2"
+            return invoke_result_data
+        if prize_order.act_id != act_id:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message ="奖品订单信息不存在-3"
+            return invoke_result_data
+        prize_order_model.update_table("seller_remark=%s,modify_date=%s", "id=%s", [seller_remark, now_datetime, prize_order_id])
+        invoke_result_data.data = prize_order.__dict__
+        return invoke_result_data
+    
+    def update_prize_order_receive_address(self, app_id, act_id, prize_order_id, province=None, city=None, county=None, street=None, address=None, real_name=None, telephone=None):
+        """
+        :description: 更新用户奖品订单收货地址
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param prize_order_id：奖品订单标识
+        :param province:省
+        :param city:市
+        :param county:区县
+        :param street:街道
+        :param address:地址
+        :param real_name:用户名
+        :param telephone:电话
+        :return: 实体模型InvokeResultData
+        :last_editors: HuangJianYi
+        """
+
+        now_datetime = SevenHelper.get_now_datetime()
+        prize_order_model = PrizeOrderModel(sub_table=self.get_business_sub_table("prize_order_tb",{"app_id":app_id}),context=self.context)
+        invoke_result_data = InvokeResultData()
+
+        prize_order = prize_order_model.get_entity_by_id(prize_order_id)
+        if not prize_order:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message ="奖品订单信息不存在-1"
+            return invoke_result_data
+        if prize_order.app_id != app_id:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message ="奖品订单信息不存在-2"
+            return invoke_result_data
+        if prize_order.act_id != act_id:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message ="奖品订单信息不存在-3"
+            return invoke_result_data
+        if province != None:
+            prize_order.province = province
+        if city != None:
+            prize_order.city = city
+        if county != None:
+            prize_order.county = county
+        if street != None:
+            prize_order.street = street
+        if address != None:
+            prize_order.address = address
+        if real_name != None:
+            prize_order.real_name = real_name
+        if telephone != None:
+            prize_order.telephone = telephone
+        prize_order_model.update_table("province=%s,city=%s,county=%s,street=%s,address=%s,real_name=%s,telephone=%s,modify_date=%s", "id=%s", [prize_order.province, prize_order.city, prize_order.county, prize_order.street, prize_order.address, prize_order.real_name, prize_order.telephone, now_datetime, prize_order_id])
+        return invoke_result_data
+
+    def import_prize_order(self, app_id, act_id, content_type, content, ref_head_name='小程序订单号', prize_roster_sub_table=None):
+        """
+        :description: 
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param content_type：内容类型 1-base64字符串内容 2-json字符串内容
+        :param content：字符串内容
+        :param ref_head_name：关联表头名称
+        :param prize_roster_sub_table：奖品记录分表名称
+        :return 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+
+        prize_order_model = PrizeOrderModel(sub_table=self.get_business_sub_table("prize_order_tb",{"app_id":app_id}),context=self.context)
+        if not prize_roster_sub_table:
+            prize_roster_sub_table = self.get_business_sub_table("prize_roster_tb",{"app_id":app_id})
+        prize_roster_model = PrizeRosterModel(sub_table=prize_roster_sub_table, context=self.context)
+        data = []
+        total_num = 0
+        if content_type == 1:
+            data = base64.decodebytes(str(content).encode())
+            if not os.path.exists("temp"):
+                os.makedirs("temp")
+            path = "temp/" + UUIDHelper.get_uuid() + ".xlsx"
+            with open(path, 'ba') as f:
+                buf = bytearray(data)
+                f.write(buf)
+            f.close()
+            order_no_index = -1
+            express_no_index = -1
+            express_company_index = -1
+
+            data = ExcelHelper.input(path)
+            data_total = len(data)
+            # 表格头部
+            if data_total > 0:
+                title_list = data[0]
+                if ref_head_name in title_list:
+                    order_no_index = title_list.index(ref_head_name)
+                if "物流单号" in title_list:
+                    express_no_index = title_list.index("物流单号")
+                if "物流公司" in title_list:
+                    express_company_index = title_list.index("物流公司")
+
+            if order_no_index == -1 or express_no_index == -1 or express_company_index == -1:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "error"
+                invoke_result_data.error_message ="缺少必要字段，无法导入订单"
+                return invoke_result_data
+            # 数据导入
+            for i in range(1, data_total):
+                row = data[i]
+                order_no = str(row[order_no_index]).strip()
+                express_no = str(row[express_no_index]).strip()
+                express_company = str(row[express_company_index]).strip()
+                if order_no and express_no and express_company:
+                    now_datetime = SevenHelper.get_now_datetime()
+                    update_sql = "order_status=1,express_company=%s,express_no=%s,deliver_date=%s"
+                    params = [express_company, express_no, now_datetime, order_no]
+                    result = prize_order_model.update_table(update_sql, "order_no=%s", params)
+                    if result == True:
+                        prize_roster_model.update_table("logistics_status=1", "order_no=%s", [order_no])
+                        total_num += 1
+            os.remove(path)
+        else:
+            data = SevenHelper.json_loads(content)
+            for row in data:
+                order_no = str(row[ref_head_name]).strip()
+                express_no = str(row['物流单号']).strip()
+                express_company = str(row['物流公司']).strip()
+                if order_no and express_no and express_company:
+                    now_datetime = SevenHelper.get_now_datetime()
+                    update_sql = "order_status=1,express_company=%s,express_no=%s,deliver_date=%s"
+                    params = [express_company, express_no, now_datetime, order_no]
+                    result = prize_order_model.update_table(update_sql, "order_no=%s", params)
+                    if result == True:
+                        prize_roster_model.update_table("logistics_status=1", "order_no=%s", [order_no])
+                        total_num += 1
+                else:
+                    continue
+        invoke_result_data.data = {"total_num": total_num}
+        return invoke_result_data
+
+    def select_prize_order(self,app_id,act_id,user_id,login_token,prize_ids,real_name,telephone,province,city,county,street,address):
+        """
+        :description: 选择奖品进行下单
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param user_id：用户标识
+        :param login_token:用户访问令牌
+        :param prize_ids:用户奖品id串，逗号分隔（为空则将所有未下单的奖品进行下单）
+        :param real_name:用户名
+        :param telephone:电话
+        :param province:省
+        :param city:市
+        :param county:区县
+        :param street:街道
+        :param address:地址
+        :return 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+
+        db_transaction = DbTransaction(db_config_dict=config.get_value("db_cloudapp"),context=self.context)
+        prize_roster_model = PrizeRosterModel(sub_table=self.get_business_sub_table("prize_roster_tb",{"app_id":app_id}), db_transaction=db_transaction, context=self.context)
+        prize_order_model = PrizeOrderModel(sub_table=self.get_business_sub_table("prize_order_tb",{"app_id":app_id}),db_transaction=db_transaction, context=self.context)
+        prize_ids_list = []
+        if prize_ids:
+            prize_ids_list = prize_ids.split(',')
+            for prize_id in prize_ids_list:
+                try:
+                    prize_id = int(prize_id)
+                except Exception as ex:
+                    invoke_result_data.success = False
+                    invoke_result_data.error_code = "error"
+                    invoke_result_data.error_message ="存在无法识别的奖品标识"
+                    return invoke_result_data
+
+        #获取用户信息
+        if act_id > 0 :
+            user_info_model = UserInfoModel(sub_table=self.get_business_sub_table("user_info_tb",{"app_id":app_id}), context=self.context)
+            user_info_dict = user_info_model.get_dict("act_id=%s and user_id=%s", limit="1", params=[act_id, user_id])
+            if not user_info_dict:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "error"
+                invoke_result_data.error_message = "用户不存在"
+                return invoke_result_data
+            if user_info_dict["login_token"] != login_token:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "error"
+                invoke_result_data.error_message = "已在另一台设备登录,无法操作"
+                return invoke_result_data
+            if int(user_info_dict["user_state"]) == 1:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "user_exception"
+                invoke_result_data.error_message = "账号异常,请联系客服处理"
+                return invoke_result_data
+        
+        acquire_lock_name = f"create_prize_order_queue_{act_id}_{user_id}" if act_id > 0 else f"create_prize_order_queue_{app_id}_0_{user_id}"
+        acquire_lock_status, identifier = SevenHelper.redis_acquire_lock(acquire_lock_name)
+        if acquire_lock_status == False:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "acquire_lock"
+            invoke_result_data.error_message = "请求超时,请稍后再试"
+            SevenHelper.redis_release_lock(acquire_lock_name, identifier)
+            return invoke_result_data
+        #用户奖品列表
+        if len(prize_ids_list)>0:
+            prize_roster_list = prize_roster_model.get_list("app_id=%s and act_id=%s and user_id=%s and prize_status=0 and id in (" + prize_ids + ")",params=[app_id, act_id, user_id])
+            if len(prize_roster_list) == 0:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "error"
+                invoke_result_data.error_message = "对不起,所选下单奖品不存在"
+                SevenHelper.redis_release_lock(acquire_lock_name, identifier)
+                return invoke_result_data
+        else:
+            prize_roster_list = prize_roster_model.get_list("app_id=%s and act_id=%s and user_id=%s and prize_status=0",params=[app_id, act_id, user_id])
+
+        now_date = SevenHelper.get_now_datetime()
+        prize_order = PrizeOrder()
+        prize_order.app_id = app_id
+        prize_order.user_id = user_id
+        prize_order.user_nick = user_info_dict["user_nick"]
+        prize_order.open_id = user_info_dict["open_id"]
+        prize_order.act_id = act_id
+        prize_order.real_name = real_name
+        prize_order.telephone = telephone
+        prize_order.province = province
+        prize_order.city = city
+        prize_order.county = county
+        prize_order.street = street
+        prize_order.address = address
+        prize_order.order_status = 0
+        prize_order.create_date = now_date
+        prize_order.modify_date = now_date
+        prize_order.order_no = SevenHelper.create_order_id()
+
+        for prize_roster in prize_roster_list:
+            prize_roster.order_no = prize_order.order_no
+            prize_roster.prize_status = 1
+        try:
+            db_transaction.begin_transaction()
+            prize_order_model.add_entity(prize_order)
+            prize_roster_model.update_list(prize_roster_list, "order_no,prize_status")
+            result,message = db_transaction.commit_transaction(True)
+            if result == False:
+                raise Exception("执行事务失败",message)
+            prize_roster_model.delete_dependency_key([DependencyKey.prize_roster_list(act_id, user_id, app_id),DependencyKey.prize_order_list(act_id,user_id)])
+        except Exception as ex:
+            if self.context:
+                self.context.logging_link_error("create_prize_order:" + traceback.format_exc())
+            elif self.logging_link_error:
+                self.logging_link_error("create_prize_order:" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "对不起,下单失败"
+            SevenHelper.redis_release_lock(acquire_lock_name, identifier)
+            return invoke_result_data
+
+        SevenHelper.redis_release_lock(acquire_lock_name, identifier)
+        self._delete_prize_order_dependency_key(act_id,user_id)
+        self._delete_prize_roster_dependency_key(act_id=act_id, user_id=user_id, app_id=app_id)
+        invoke_result_data.data = prize_order.__dict__
+        return invoke_result_data
+
+    def get_tao_pay_order_list(self,app_id,act_id,user_id,open_id,nick_name,pay_date_start,pay_date_end,page_size=20,page_index=0,field="*",order_by="pay_date desc",condition="",params=[]):
+        """
+        :description: 淘宝用户购买订单列表
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param user_id：用户唯一标识
+        :param open_id：open_id
+        :param nick_name：用户昵称
+        :param pay_date_start：订单支付时间开始
+        :param pay_date_end：订单支付时间结束
+        :param page_size：页大小
+        :param page_index：页索引
+        :param field：查询字段
+        :param order_by：排序
+        :param condition：条件
+        :param params：参数化数组
+        :return: PageInfo
+        :last_editors: HuangJianYi
+        """
+        where = "app_id=%s and act_id=%s"
+        params_list = [app_id,act_id]
+        if condition:
+            where += " AND " + condition
+            params_list.extend(params)
+        page_info = PageInfo(page_index, page_size, 0, [])
+
+        if not act_id:
+            return page_info
+        if user_id:
+            where += " AND user_id=%s"
+            params_list.append(user_id)
+        if open_id:
+            where += " AND open_id=%s"
+            params_list.append(open_id)
+        if nick_name:
+            where += " AND user_nick=%s"
+            params_list.append(nick_name)
+        if pay_date_start:
+            where += " AND pay_date>=%s"
+            params_list.append(pay_date_start)
+        if pay_date_end:
+            where += " AND pay_date<=%s"
+            params_list.append(pay_date_end)
+        page_list, total = TaoPayOrderModel(sub_table=FrameBaseModel(context=self.context).get_business_sub_table("tao_pay_order_tb",{"app_id":app_id}), context=self.context).get_dict_page_list(field, page_index, page_size, where, "", order_by, params_list)
+        page_info = PageInfo(page_index, page_size, total, page_list)
+        return page_info
+
+    def _get_tao_pay_order_no_list(self,app_id,user_id):
+        """
+        :description: 获取已获取奖励的订单子编号列表
+        :param app_id:应用标识
+        :param user_id:用户标识
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        redis_init = SevenHelper.redis_init()
+        pay_order_cache_key = f"sub_pay_order_no_list:appid_{app_id}_userid_{user_id}"
+        pay_order_no_list = redis_init.lrange(pay_order_cache_key,0,-1)
+        pay_order_list = []
+        is_add = False
+        if not pay_order_no_list or len(pay_order_no_list)<=0:
+            tao_pay_order_model = TaoPayOrderModel(sub_table=FrameBaseModel(context=self.context).get_business_sub_table("tao_pay_order_tb",{"app_id":app_id}),context=self.context)
+            pay_order_list = tao_pay_order_model.get_dict_list("app_id=%s and user_id=%s",field="sub_pay_order_no", params=[app_id,user_id])
+            is_add = True
+
+        if len(pay_order_list) >0:
+            for item in pay_order_list:
+                pay_order_no_list.append(item["sub_pay_order_no"])
+                if is_add == True:
+                    redis_init.lpush(pay_order_cache_key,item["sub_pay_order_no"])
+                    redis_init.expire(pay_order_cache_key, 30 * 24 * 3600)
+        return pay_order_no_list,redis_init,pay_order_cache_key
+
+    def sync_tao_pay_order(self,app_id,act_id,module_id,user_id,login_token,handler_name,request_code,asset_type=3,goods_id="",sku_id="",ascription_type=1,app_key="",app_secret="",is_log=False,check_user_nick=True,continue_request_expire=5,support_presale_order=False):
+        """
+        :description: 同步淘宝支付订单给用户加资产
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param user_id:用户标识
+        :param login_token:访问令牌
+        :param handler_name:接口名称
+        :param request_code:请求代码
+        :param asset_type:资产类型(1-次数2-积分3-价格档位)
+        :param goods_id:商品ID（资产类型为3-价格档位 无需填写）
+        :param sku_id:sku_id (资产类型为3-价格档位 无需填写)
+        :param ascription_type:归属类型（0-抽奖次数订单1-邮费次数订单2-任务订单）
+        :param app_key:app_key
+        :param app_secret:app_secret
+        :param is_log:是否记录top请求日志
+        :param check_user_nick:是否校验昵称为空
+        :param continue_request_expire:连续请求过期时间，为0不进行校验，单位秒
+        :param support_presale_order:是否支持预售订单
+        :return 
+        :last_editors: HuangJianYi
+        """
+        acquire_lock_name = f"sync_tao_pay_order:{act_id}_{module_id}_{user_id}"
+        identifier = ""
+        try:
+            invoke_result_data = self.business_process_executing(app_id,act_id,module_id,user_id,login_token,handler_name,False,check_user_nick,continue_request_expire,acquire_lock_name)
+            if invoke_result_data.success == True:
+                act_info_dict = invoke_result_data.data["act_info_dict"]
+                act_module_dict = invoke_result_data.data["act_module_dict"]
+                user_info_dict = invoke_result_data.data["user_info_dict"]
+                identifier = invoke_result_data.data["identifier"]
+
+                # 获取订单
+                app_info_dict = AppBaseModel(context=self.context).get_app_info_dict(app_id)
+                access_token = app_info_dict["access_token"] if app_info_dict else ""
+                top_base_model = TopBaseModel(context=self.context)
+                order_data = []
+                if act_info_dict['start_date'] != "":
+                    invoke_result_data = top_base_model.get_buy_order_list(user_info_dict["open_id"], access_token,app_key,app_secret, act_info_dict['start_date'],is_log=is_log)
+                    if invoke_result_data.success == True:
+                        order_data = invoke_result_data.data
+                else:
+                    invoke_result_data = top_base_model.get_buy_order_list(user_info_dict["open_id"], access_token,app_key,app_secret,is_log=is_log)
+                    if invoke_result_data.success == True:
+                        order_data = invoke_result_data.data
+                if len(order_data)>0:
+                    pay_order_no_list,redis_init,pay_order_cache_key = self._get_tao_pay_order_no_list(app_id,user_id)
+
+                    goods_ids_list = []
+                    #满足奖励条件的订单
+                    reward_order_list = []
+                    #所有相关商品订单
+                    all_order_list = []
+                    if asset_type == 3:
+                        price_base_model = PriceBaseModel(context=self.context)
+                        price_gear_dict_list = price_base_model.get_price_gear_list(app_id,act_id,100,0,page_count_mode='none')
+                        for price_gear_dict in price_gear_dict_list:
+                            goods_ids_list.append(price_gear_dict["goods_id"])
+                    else:
+                        goods_ids_list.append(str(goods_id))
+
+                    for item in order_data:
+                        for order in item["orders"]["order"]:
+                            if str(order["num_iid"]) in goods_ids_list:
+                                order["step_paid_fee"] = item["step_paid_fee"] if "step_paid_fee" in item.keys() else 0
+                                order["type"] = item["type"]
+                                if "pay_time" in item:
+                                    order["tid"] = item["tid"]
+                                    order["pay_time"] = item["pay_time"]
+                                if support_presale_order == True:
+                                    if order["status"] in self.rewards_status() or (order["type"] == "step" and order["step_trade_status"] != "FRONT_NOPAID_FINAL_NOPAID"):
+                                        reward_order_list.append(order)
+                                else:
+                                    if order["status"] in self.rewards_status():
+                                        reward_order_list.append(order)
+                
+                                all_order_list.append(order)
+
+                    pay_price = 0
+                    pay_num = 0
+                    buy_num = 0
+                    tao_pay_order_list = []
+                    for order in reward_order_list:
+                        try:
+                            #判断是否已经加过奖励
+                            if order["oid"] not in pay_order_no_list:
+                                asset_object_name = ""
+                                asset_object_id = ""
+                                if asset_type == 3:
+                                    now_price_gear_dict = None
+                                    for price_gear_dict in price_gear_dict_list:
+                                        if (price_gear_dict["effective_date"] == '1900-01-01 00:00:00' or TimeHelper.format_time_to_datetime(price_gear_dict["effective_date"]) < TimeHelper.format_time_to_datetime(order["pay_time"])) and price_gear_dict["goods_id"] == str(order["num_iid"]):
+                                            #关联类型：1商品skuid关联2商品id关联
+                                            if price_gear_dict["relation_type"] == 1 and price_gear_dict["sku_id"] != str(order["sku_id"]):
+                                                continue
+                                            now_price_gear_dict = price_gear_dict
+                                    if not now_price_gear_dict:
+                                        continue
+                                    asset_object_id = now_price_gear_dict["id"]
+                                    asset_object_name = now_price_gear_dict["price_gear_name"]
+                                else:
+                                    if str(goods_id) != str(order["num_iid"]):
+                                        continue
+                                    if sku_id and str(sku_id) != str(order["sku_id"]):
+                                        continue
+
+                                tao_pay_order = TaoPayOrder()
+                                tao_pay_order.app_id = app_id
+                                tao_pay_order.act_id = act_id
+                                tao_pay_order.ascription_type = ascription_type
+                                tao_pay_order.user_id = user_id
+                                tao_pay_order.open_id = user_info_dict["open_id"]
+                                tao_pay_order.user_nick = user_info_dict["user_nick"]
+                                tao_pay_order.main_pay_order_no = order['tid']
+                                tao_pay_order.sub_pay_order_no = order['oid']
+                                tao_pay_order.goods_code = order['num_iid']
+                                tao_pay_order.goods_name = order['title']
+                                if "sku_id" in order.keys():
+                                    tao_pay_order.sku_id = order['sku_id']
+                                    sku_invoke_result_data = top_base_model.get_sku_name(int(order['num_iid']), int(order['sku_id']), access_token,app_key, app_secret,is_log)
+                                    tao_pay_order.sku_name = sku_invoke_result_data.data if sku_invoke_result_data.success == True else ""
+                                tao_pay_order.buy_num = order['num']
+                                tao_pay_order.pay_price = order['payment']
+                                tao_pay_order.order_status = order['status']
+                                tao_pay_order.create_date = SevenHelper.get_now_datetime()
+                                tao_pay_order.asset_type = asset_type
+                                tao_pay_order.asset_object_id = asset_object_id
+                                tao_pay_order.asset_object_name = asset_object_name
+                                tao_pay_order.surplus_count = order['num']
+                                tao_pay_order.pay_date = order['pay_time']
+                                tao_pay_order_list.append(tao_pay_order)
+                                if support_presale_order == True:
+                                    payment = decimal.Decimal(order["step_paid_fee"]) if order["type"] == "step" and decimal.Decimal(order["step_paid_fee"]) > 0 else decimal.Decimal(order["payment"])
+                                else:
+                                    payment = decimal.Decimal(order["payment"])
+                                pay_price = decimal.Decimal(pay_price) + payment
+                                pay_num = pay_num + 1
+                                buy_num = buy_num + order['num']
+                        except Exception as ex:
+                            if self.context:
+                                self.context.logging_link_info(str(order) + "【同步淘宝支付订单】" + traceback.format_exc())
+                            elif self.logging_link_info:
+                                self.logging_link_info(str(order) + "【同步淘宝支付订单】" + traceback.format_exc())
+                            continue
+                    if len(tao_pay_order_list) > 0:
+                        result = TaoPayOrderModel(sub_table=FrameBaseModel(context=self.context).get_business_sub_table("tao_pay_order_tb",{"app_id":app_id}),context=self.context).add_list(tao_pay_order_list)
+                        if result == True and buy_num > 0:
+                            asset_base_model = AssetBaseModel(context=self.context)
+                            invoke_result_data.data = {}
+                            invoke_result_data.data["asset_list"] = []
+                            for item in tao_pay_order_list:
+                                only_id = str(item.sub_pay_order_no)
+                                asset_invoke_result_data = asset_base_model.update_user_asset(app_id,act_id,module_id,user_id,user_info_dict["open_id"],user_info_dict["user_nick"],asset_type,item.buy_num,item.asset_object_id,1,"","","购买",only_id,handler_name,request_code,info_json={})
+                                if asset_invoke_result_data.success == False:
+                                    invoke_result_data.success = False
+                                    invoke_result_data.error_code = "error"
+                                    invoke_result_data.error_message = "变更资产失败"
+                                else:
+                                    redis_init.lpush(pay_order_cache_key,item.sub_pay_order_no)
+                                    redis_init.expire(pay_order_cache_key, 30 * 24 * 3600)
+                                    data = {}
+                                    data["asset_type"] = asset_type
+                                    data["asset_object_id"] = item.asset_object_id
+                                    data["buy_num"] = item.buy_num
+                                    invoke_result_data.data["asset_list"].append(data)
+                            invoke_result_data.data["buy_num"] = buy_num
+                            invoke_result_data.data["pay_price"] = pay_price
+                            invoke_result_data.data["pay_num"] = pay_num
+                        else:
+                            invoke_result_data.success = False
+                            invoke_result_data.error_code = "error"
+                            invoke_result_data.error_message = "没有匹配订单"
+                    else:
+                        invoke_result_data.success = False
+                        invoke_result_data.error_code = "error"
+                        invoke_result_data.error_message = "没有匹配订单"
+                    if len(all_order_list) >0:
+                        user_base_model = UserBaseModel(context=self.context)
+                        black_status = user_base_model.check_pull_black(user_info_dict,act_info_dict["is_black"],act_info_dict["refund_count"],all_order_list)
+                        if black_status == True:
+                            invoke_result_data.data = {} if not invoke_result_data.data else invoke_result_data.data
+                            invoke_result_data.data["user_state"] = 1
+                else:
+                    invoke_result_data.success = False
+                    invoke_result_data.error_code = "error"
+                    invoke_result_data.error_message = "没有订单"
+        except Exception as ex:
+            if self.context:
+                self.context.logging_link_error("【同步淘宝支付订单】" + traceback.format_exc())
+            elif self.logging_link_error:
+                self.logging_link_error("【同步淘宝支付订单】" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "exception"
+            invoke_result_data.error_message = "系统繁忙,请稍后再试"
+        finally:
+            self.business_process_executed(act_id,module_id,user_id,handler_name,acquire_lock_name,identifier)
+
+        return invoke_result_data
+
+    def get_prize_roster_list(self,app_id,act_id,module_id,user_id,open_id="",user_nick="",order_no="",goods_type=-1,prize_type=-1,logistics_status=-1,prize_status=-1,pay_status=-1,page_size=20,page_index=0,create_date_start="",create_date_end="",order_by="create_date desc",field="*",condition="",params=[],is_cache=True, page_count_mode="total"):
+        """
+        :description: 用户中奖记录列表
+        :description: 如果有进行数据缓存，创建中奖记录时需清掉依赖建
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param module_id：活动模块标识
+        :param user_id：用户标识
+        :param open_id：open_id
+        :param user_nick：用户昵称
+        :param order_no：订单号
+        :param goods_type：物品类型（1虚拟2实物）
+        :param prize_type：奖品类型(1现货2优惠券3红包4参与奖5预售)
+        :param logistics_status：物流状态（0未发货1已发货2不予发货）
+        :param prize_status：奖品状态（0未下单（未领取）1已下单（已领取）2已回购10已隐藏（删除）11无需发货）
+        :param pay_status：支付状态(0未支付1已支付2已退款3处理中)
+        :param page_size：页大小
+        :param page_index：页索引
+        :param create_date_start：开始时间
+        :param create_date_end：结束时间
+        :param order_by：排序
+        :param field：查询字段
+        :param condition：条件
+        :param params：参数化数组
+        :param is_cache：是否缓存
+        :param page_count_mode: 分页计数模式 total-计算总数(默认) next-计算是否有下一页(bool) none-不计算
+        :return:
+        :last_editors: HuangJianYi
+        """
+        condition_where = ConditionWhere()
+        condition_where.add_condition("app_id=%s")
+        params_list = [app_id]
+        if act_id >= 0:
+            condition_where.add_condition("act_id=%s")
+            params_list.append(act_id)
+        if module_id:
+            condition_where.add_condition("module_id=%s")
+            params_list.append(module_id)
+        if user_id:
+            condition_where.add_condition("user_id=%s")
+            params_list.append(user_id)
+        if open_id:
+            condition_where.add_condition("open_id=%s")
+            params_list.append(open_id)
+        if user_nick:
+            condition_where.add_condition("user_nick=%s")
+            params_list.append(user_nick)
+        if order_no:
+            condition_where.add_condition("order_no=%s")
+            params_list.append(order_no)
+        if goods_type !=-1:
+            condition_where.add_condition("goods_type=%s")
+            params_list.append(goods_type)
+        if prize_type !=-1:
+            condition_where.add_condition("prize_type=%s")
+            params_list.append(prize_type)
+        if logistics_status !=-1:
+            condition_where.add_condition("logistics_status=%s")
+            params_list.append(logistics_status)
+        if prize_status !=-1:
+            condition_where.add_condition("prize_status=%s")
+            params_list.append(prize_status)
+        if pay_status !=-1:
+            condition_where.add_condition("pay_status=%s")
+            params_list.append(pay_status)
+        if create_date_start:
+            condition_where.add_condition("create_date>=%s")
+            params_list.append(create_date_start)
+        if create_date_end:
+            condition_where.add_condition("create_date<=%s")
+            params_list.append(create_date_end)
+        if condition:
+            condition_where.add_condition(condition)
+            params_list.extend(params)
+
+        prize_roster_model = PrizeRosterModel(sub_table=self.get_business_sub_table("prize_roster_tb",{"app_id":app_id}),context=self.context)
+        if is_cache:
+            page_list = prize_roster_model.get_cache_dict_page_list(field, page_index, page_size, condition_where.to_string(), "", order_by, params_list, dependency_key=DependencyKey.prize_roster_list(act_id,user_id,app_id), page_count_mode=page_count_mode)
+        else:
+            page_list = prize_roster_model.get_dict_page_list(field, page_index, page_size, condition_where.to_string(), "", order_by, params_list, page_count_mode)
+        return page_list
+
+    def get_horseracelamp_list(self, app_id, act_id, module_id, is_search_module=False, condition="", params=[], page_size=30):
+        """
+        :description: 获取跑马灯奖品列表
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param is_search_module:是否查询活动模块
+        :param condition：条件
+        :param params：参数数组
+        :param page_size：页大小
+        :return list
+        :last_editors: HuangJianYi
+        """
+        condition_where = ConditionWhere()
+        condition_where.add_condition("app_id=%s")
+        params_list = [app_id]
+        if act_id >= 0:
+            condition_where.add_condition("act_id=%s")
+            params_list.append(act_id)
+        if is_search_module == True and module_id:
+            condition_where.add_condition("module_id=%s")
+            params_list.append(module_id)
+        if condition:
+            condition_where.add_condition(condition)
+            params_list.extend(params)
+        act_prize_list_dict = ActPrizeModel(context=self.context).get_cache_dict_list("act_id=%s and is_prize_notice=1 and is_del=0", params=[act_id],cache_expire=60)
+        if act_prize_list_dict:
+            if len(act_prize_list_dict) > 100:
+                act_prize_list_dict = random.sample(act_prize_list_dict,50)
+
+            prize_id_list = [str(i["id"]) for i in act_prize_list_dict]
+            if len(prize_id_list) > 0:
+                prize_ids = ",".join(prize_id_list)
+                condition_where.add_condition("prize_id in (" + prize_ids + ")")
+        prize_roster_model = PrizeRosterModel(sub_table=self.get_business_sub_table("prize_roster_tb",{"app_id":app_id}),context=self.context)
+        prize_roster_list = prize_roster_model.get_cache_dict_list(condition_where.to_string(), "", "create_date desc", str(page_size), "user_nick,prize_name,tag_id,module_name", params_list, cache_expire=60)
+        total = int(len(prize_roster_list))
+        if total == 0:
+            prize_roster_list = []
+        else:
+            for i in range(len(prize_roster_list)):
+                if prize_roster_list[i]["user_nick"]:
+                    length = len(prize_roster_list[i]["user_nick"])
+                    if length > 2:
+                        user_nick = prize_roster_list[i]["user_nick"][0:length - 2] + "**"
+                    else:
+                        user_nick = prize_roster_list[i]["user_nick"][0:1] + "*"
+                    prize_roster_list[i]["user_nick"] = user_nick
+        act_module_list = []
+        if total < page_size:
+            add_num = page_size - total
+            act_prize_model = ActPrizeModel(context=self.context)
+            prize_condition = "act_id=%s and is_prize_notice=1"
+            prize_params = [act_id]
+
+            if is_search_module == True:
+                module_condition = "act_id=%s and is_fictitious=1"
+                module_params = [act_id]
+                if module_id >0:
+                    module_condition += " and id=%s"
+                    module_params = [act_id, module_id]
+                act_module_list = ActModuleModel(context=self.context).get_cache_list(module_condition, params=module_params,cache_expire=60)
+                if len(act_module_list) > 0:
+                    module_id_list = [str(i.id) for i in act_module_list]
+                    module_ids = ",".join(module_id_list)
+                    prize_condition += " and module_id in (" + module_ids + ")"
+            false_act_prize_list = act_prize_model.get_cache_list(prize_condition, order_by="probability desc,chance desc", limit="30", params=prize_params,cache_expire=60)
+            if len(false_act_prize_list) > 0 and add_num > 0:
+                now_datetime = TimeHelper.add_hours_by_format_time(hour=-random.randint(0, 1000))
+                user_info_list_dict = UserInfoModel(sub_table=self.get_business_sub_table("user_info_tb",{"app_id":false_act_prize_list[0].app_id}),context=self.context).get_dict_list("act_id<%s and create_date>%s", params=[act_id,now_datetime], limit=str(add_num))
+
+                for i in range(len(user_info_list_dict)):
+                    false_act_prize = false_act_prize_list[random.randint(0, len(false_act_prize_list)-1)]
+                    if not false_act_prize:
+                        continue
+                    prize_roster = {}
+                    user_nick = ""
+                    if user_info_list_dict[i]["user_nick"]:
+                        length = len(user_info_list_dict[i]["user_nick"])
+                        if length > 2:
+                            user_nick = user_info_list_dict[i]["user_nick"][0:length - 2] + "**"
+                        else:
+                            user_nick = user_info_list_dict[i]["user_nick"][0:1] + "*"
+                    prize_roster["user_nick"] = user_nick
+                    prize_roster["prize_name"] = false_act_prize.prize_name
+                    prize_roster["tag_id"] = false_act_prize.tag_id
+                    act_module_filter = [act_module for act_module in act_module_list if false_act_prize.module_id == act_module.id]
+                    prize_roster["module_name"] = act_module_filter[0].module_name if len(act_module_filter) > 0 else ""
+                    prize_roster_list.append(prize_roster)
+
+        return prize_roster_list
+
+    def get_coupon_prize(self, app_id, act_id, user_id, user_prize_id, app_key, app_secret, is_log=False):
+        """
+        :description: 领取淘宝优惠券
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param user_id：用户标识
+        :param user_prize_id:用户奖品标识
+        :param app_key:app_key
+        :param app_secret:app_secret
+        :param is_log:是否记录日志
+        :return 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        app_base_model = AppBaseModel(context=self.context)
+        app_info_dict = app_base_model.get_app_info_dict(app_id)
+        if not app_info_dict:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message ="小程序不存在"
+            return invoke_result_data
+        access_token = app_info_dict["access_token"]
+        if access_token == "":
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message ="未授权请联系客服授权"
+            return invoke_result_data
+        prize_roster_model = PrizeRosterModel(sub_table=self.get_business_sub_table("prize_roster_tb",{"app_id":app_id}),context=self.context)
+        prize_roster_dict = prize_roster_model.get_cache_dict_by_id(user_prize_id, dependency_key=DependencyKey.prize_roster_list(act_id,user_id,app_id))
+        if not prize_roster_dict or prize_roster_dict['user_id'] != user_id:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message ="奖品不存在"
+            return invoke_result_data
+        tao_coupon_model = TaoCouponModel(context=self.context)
+        tao_coupon_dict = tao_coupon_model.get_dict(where="prize_id=%s", limit="1", params=[prize_roster_dict["prize_id"]])
+        if not tao_coupon_dict or tao_coupon_dict['right_ename'] == "":
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message ="奖品不是优惠券,无需领取"
+            return invoke_result_data
+        top_base_model = TopBaseModel(context=self.context)
+        top_invoke_result_data = top_base_model.alibaba_benefit_send(tao_coupon_dict['right_ename'], prize_roster_dict["open_id"], access_token, app_key, app_secret, is_log)
+        if top_invoke_result_data.success == False:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message ="领取失败"
+            return invoke_result_data
+        resp = top_invoke_result_data.data
+        if resp["alibaba_benefit_send_response"]:
+            if resp["alibaba_benefit_send_response"]["result_success"] == True:
+                prize_roster_model.update_table("prize_status=1", "id=%s", params=[user_prize_id])
+                prize_roster_model.delete_dependency_key(DependencyKey.prize_roster_list(act_id,user_id,app_id))
+                result = {}
+                result["prize_name"] = resp["alibaba_benefit_send_response"]["prize_name"]
+                invoke_result_data.data = result
+                return invoke_result_data
+            if resp["alibaba_benefit_send_response"]["result_code"] == "COUPON_INVALID_OR_DELETED":
+                prize_roster_model.update_table("prize_status=10", "id=%s", params=[user_prize_id])
+                prize_roster_model.delete_dependency_key(DependencyKey.prize_roster_list(act_id,user_id,app_id))
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "error"
+                invoke_result_data.error_message ="领取失败：优惠券无效或已删除"
+                return invoke_result_data
+            if resp["alibaba_benefit_send_response"]["result_code"] == "COUPON_NOT_EXISTS":
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "error"
+                invoke_result_data.error_message ="领取失败：优惠券不存在"
+                return invoke_result_data
+            if resp["alibaba_benefit_send_response"]["result_code"] == "APPLY_SINGLE_COUPON_COUNT_EXCEED_LIMIT":
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "error"
+                invoke_result_data.error_message ="领取失败：优惠券超过限额"
+                return invoke_result_data
+            if resp["alibaba_benefit_send_response"]["result_code"] == "USER_PERMISSION_EXCEED_MAX_RIGHT_COUNT_IN_DAY":
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "error"
+                invoke_result_data.error_message ="领取失败：同一张优惠券每天限领取一次"
+                return invoke_result_data
+            if resp["alibaba_benefit_send_response"]["result_code"] == "APPLY_ONE_SELLER_COUNT_EXCEED_LIMIT":
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "error"
+                invoke_result_data.error_message ="领取失败：用户优惠券超出10张限制"
+                return invoke_result_data
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message ="领取失败"
+            invoke_result_data.data = resp["alibaba_benefit_send_response"]["result_code"]
+            return invoke_result_data
+            
+        else:
+            result = resp["sub_msg"] if resp["sub_msg"] else ""
+            if result == "" and resp["result_msg"]:
+                result = resp["result_msg"]
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = f"领取失败:{result}"
+            return invoke_result_data
+
+    def create_wechat_refund(self, source_type, app_id, act_id, pay_order_no, refund_amount = 0, refund_reason = ""):
+        """
+        :description: 创建微信退款
+        :param source_type：来源类型（1用户申请退款2人工审核退款3自动退款）
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param pay_order_no：支付单号
+        :param refund_reason：退款原因
+        :return 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        pay_order_model = PayOrderModel(context=self)
+        refund_order_model = RefundOrderModel(context=self)
+        #请求太频繁限制
+        if SevenHelper.is_continue_request(f"create_wechat_refund:{app_id}_{pay_order_no}", 1000) == False:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message ="请求太频繁,请稍后再试"
+            return invoke_result_data
+
+        pay_order = pay_order_model.get_entity("pay_order_no=%s", params=pay_order_no)
+        if not pay_order:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message ="对不起，找不到支付订单"
+            return invoke_result_data
+
+        refund_order = refund_order_model.get_entity(where="pay_order_no=%s AND refund_status in (1,2)", params=[pay_order_no])
+        if refund_order:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message ="对不起，退款处理中"
+            return invoke_result_data
+        if refund_amount <= 0:
+            refund_amount = pay_order.pay_amount
+        if pay_order.refund_amount + refund_amount > pay_order.pay_amount:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message ="退款总金额不能超过支付金额"
+            return invoke_result_data
+            
+        refund_status = 0
+        if source_type == 1:
+            refund_reason = refund_reason
+            refund_status = 1
+        elif source_type == 2:
+            refund_reason = "人工审核退款"
+        elif source_type == 3:
+            refund_reason = "自动退款"
+        
+        
+        refund_no = SevenHelper.create_order_id()
+        #创建退款预订单
+        refund_order = RefundOrder()
+        refund_order.app_id = app_id
+        refund_order.act_id = act_id
+        refund_order.user_id = pay_order.user_id
+        refund_order.open_id = pay_order.open_id
+        refund_order.pay_order_no = pay_order_no
+        refund_order.refund_no = refund_no
+        refund_order.out_order_no = pay_order.out_order_no
+        refund_order.refund_amount = refund_amount
+        refund_order.refund_status = refund_status
+        refund_order.refund_reason = refund_reason
+        refund_order.create_date = SevenHelper.get_now_datetime()
+        refund_order.id = refund_order_model.add_entity(refund_order)
+        if refund_order.id <= 0:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message ="对不起，创建退款订单失败"
+            return invoke_result_data
+        
+        if source_type != 1:
+            wechat_pay = share_config.get_value("wechat_pay")
+            #退款异步通知地址
+            notify_url = wechat_pay["notify_url"]
+            result_data = WeChatPayRequest().create_refund(refund_no, pay_order.pay_order_no, notify_url, refund_amount, pay_order.pay_amount)
+            if result_data.success == False:
+                refund_order_model.del_entity("id=%s", params=refund_order.id)
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "error"
+                invoke_result_data.error_message ="对不起，创建退款订单异常"
+                return invoke_result_data
+            refund_order_model.update_table("refund_status=2", "id=%s", params=refund_order.id)
+            invoke_result_data.data = refund_no
+
+        return invoke_result_data
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/price_base_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/price_base_model.py`

 * *Ordering differences only*

 * *Files 15% similar despite different names*

```diff
@@ -1,228 +1,228 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-08-02 14:26:29
-@LastEditTime: 2023-01-04 15:59:34
-@LastEditors: HuangJianYi
-@Description: 
-"""
-from seven_cloudapp_frame.models.seven_model import *
-from seven_cloudapp_frame.libs.customize.seven_helper import *
-from seven_cloudapp_frame.models.act_base_model import *
-from seven_cloudapp_frame.models.launch_base_model import *
-from seven_cloudapp_frame.models.db_models.price.price_gear_model import *
-
-
-class PriceBaseModel():
-    """
-    :description: 价格档位业务模型
-    """
-    def __init__(self, context=None,logging_error=None, logging_info=None):
-        self.context = context
-        self.logging_link_error = logging_error
-        self.logging_link_info = logging_info
-
-    def _delete_price_gear_dependency_key(self, act_id, delay_delete_time=0.01):
-        """
-        :description: 删除价格档位依赖建
-        :param act_id: 活动标识
-        :param delay_delete_time: 延迟删除时间，传0则不进行延迟
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        PriceGearModel().delete_dependency_key(DependencyKey.price_gear_list(act_id), delay_delete_time)
-
-    def save_price_gear(self,app_id,act_id,price_gear_id,relation_type,price_gear_name,price_gear_pic,price,goods_id,sku_id,remark="",sort_index=0):
-        """
-        :description: 保存价格档位
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param price_gear_id：价格档位标识
-        :param relation_type：关联类型：1-商品skuid关联2-商品id关联
-        :param price_gear_name：档位名称
-        :param price_gear_pic：档位图片
-        :param price：价格
-        :param goods_id：商品ID
-        :param sku_id：sku_id
-        :param remark：备注
-        :param sort_index：排序
-        :return:
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        price_gear = None
-        old_price_gear = None
-        price_gear_model = PriceGearModel(context=self.context)
-        if price_gear_id > 0:
-            price_gear = price_gear_model.get_entity_by_id(price_gear_id)
-        is_add = False
-        if not price_gear:
-            is_add = True
-            price_gear = PriceGear()
-        else:
-            old_price_gear = deepcopy(price_gear)
-        try:
-            price = decimal.Decimal(price)
-        except Exception as ex:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "参数price类型错误"
-            return invoke_result_data
-
-        if goods_id != "":
-            price_gear_goodsid = price_gear_model.get_entity("act_id!=%s and goods_id=%s", params=[act_id, goods_id])
-            if price_gear_goodsid:
-                act_info_dict = ActInfoModel(context=self.context).get_dict_by_id(price_gear_goodsid.act_id)
-                act_name = act_info_dict["act_name"] if act_info_dict else ""
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "error"
-                invoke_result_data.error_message = f"此商品ID已关联活动{act_name},无法使用"
-                return invoke_result_data
-
-        price_gear.app_id = app_id
-        price_gear.act_id = act_id
-        price_gear.relation_type = relation_type
-        price_gear.price = price
-        price_gear.price_gear_name = price_gear_name
-        price_gear.price_gear_pic = price_gear_pic
-        price_gear.goods_id = goods_id
-        price_gear.sku_id = sku_id
-        price_gear.remark = remark
-        price_gear.sort_index = sort_index
-        price_gear.modify_date = SevenHelper.get_now_datetime()
-
-        if is_add:
-            if sku_id != "":
-                price_gear_goodsid_skuid = price_gear_model.get_total("sku_id=%s", params=[sku_id])
-                if price_gear_goodsid_skuid:
-                    invoke_result_data.success = False
-                    invoke_result_data.error_code = "error"
-                    invoke_result_data.error_message = f"当前SKUID已绑定价格档位,请更换"
-                    return invoke_result_data
-            price_gear.create_date = SevenHelper.get_now_datetime()
-            price_gear.effective_date = SevenHelper.get_now_datetime()
-            price_gear.id = price_gear_model.add_entity(price_gear)
-        else:
-            if sku_id != "":
-                price_gear_goodsid_skuid = price_gear_model.get_total("id!=%s and sku_id=%s", params=[price_gear.id, sku_id])
-                if price_gear_goodsid_skuid:
-                    invoke_result_data.success = False
-                    invoke_result_data.error_code = "error"
-                    invoke_result_data.error_message = f"当前SKUID已绑定价格档位,请更换"
-                    return invoke_result_data
-            price_gear_model.update_entity(price_gear)
-
-        launch_goods_id = price_gear.goods_id if price_gear else ''
-        old_goods_id = old_price_gear.goods_id if old_price_gear else ''
-        launch_base_model = LaunchBaseModel(context=self.context)
-        launch_base_model.add_launch_goods(app_id,act_id, launch_goods_id, old_goods_id,"2")
-
-        result = {}
-        result["is_add"] = is_add
-        result["new"] = price_gear
-        result["old"] = old_price_gear
-        invoke_result_data.data = result
-        self._delete_price_gear_dependency_key(act_id)
-        return invoke_result_data
-
-    def get_price_gear_list(self,app_id,act_id,page_size,page_index,order_by="id desc",is_del=0,is_cache=True, page_count_mode="total"):
-        """
-        :description: 获取价格档位列表
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param page_index：页索引
-        :param page_size：页大小
-        :param order_by：排序
-        :param is_del：是否回收站1是0否
-        :param is_cache：是否缓存
-        :param page_count_mode: 分页计数模式 total-计算总数(默认) next-计算是否有下一页(bool) none-不计算
-        :return:
-        :last_editors: HuangJianYi
-        """
-        condition = "app_id=%s and act_id=%s"
-        if is_del == 1:
-            condition += " and is_del=1"
-        else:
-            condition += " and is_del=0"
-
-        params = [app_id,act_id]
-        price_gear_model = PriceGearModel(context=self.context)
-        if is_cache == True:
-            page_list = price_gear_model.get_cache_dict_page_list(field="*", page_index=page_index, page_size=page_size, where=condition, group_by="", order_by=order_by,params=params,dependency_key=DependencyKey.price_gear_list(act_id),page_count_mode=page_count_mode)
-        else:
-            page_list = price_gear_model.get_dict_page_list(field="*", page_index=page_index, page_size=page_size, where=condition, group_by="", order_by=order_by,params=params,page_count_mode=page_count_mode)
-        return page_list
-
-    def update_price_gear_status(self,app_id,act_id,price_gear_id,is_del):
-        """
-        :description: 删除或恢复价格档位
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param price_gear_id：价格档位标识
-        :param is_del：1删除0恢复
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        price_gear_model = PriceGearModel(context=self.context)
-        price_gear_dict = price_gear_model.get_dict_by_id(price_gear_id)
-        if not price_gear_dict or price_gear_dict["act_id"] != act_id or price_gear_dict["app_id"] != app_id:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "价格档位信息不存在"
-            return invoke_result_data
-        goods_id =  price_gear_dict["goods_id"]
-        invoke_result_data.success = price_gear_model.update_table("is_del=%s,goods_id='',sku_id=''", "id=%s", [is_del, price_gear_id])
-        if invoke_result_data.success ==True and is_del == 1:
-            launch_base_model = LaunchBaseModel(context=self.context)
-            launch_base_model.update_launch_goods(act_id, goods_id,"2")
-        self._delete_price_gear_dependency_key(act_id)
-        invoke_result_data.data = price_gear_dict
-        return invoke_result_data
-
-    def check_price_gear(self,app_id,act_id,price_gear_id,goods_id,sku_id):
-        """
-        :description: 验证价格档位
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param price_gear_id：价格档位标识
-        :param goods_id：商品ID
-        :param sku_id：sku_id
-        :return:
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        price_gear_model = PriceGearModel(context=self.context)
-        condtion = "app_id=%s and goods_id=%s"
-        params = [app_id, goods_id]
-        if price_gear_id > 0:
-            condtion += " and id!=%s"
-            params.append(price_gear_id)
-        price_gear_dict_list = price_gear_model.get_dict_list(condtion, params=params)
-        is_fail = False
-        bind_act_id = 0
-        if price_gear_dict_list:
-            if not sku_id:
-                is_fail = True
-                bind_act_id = price_gear_dict_list[0]["act_id"]
-            else:
-                for price_gear_dict in price_gear_dict_list:
-                    if price_gear_dict["relation_type"] == 2 or price_gear_dict["sku_id"] == sku_id:
-                        is_fail = True
-                        bind_act_id = int(price_gear_dict["act_id"])
-                        break
-        #验证失败
-        if is_fail == True:
-            if act_id == bind_act_id:
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "error"
-                invoke_result_data.error_message = "对不起,该商品已绑定其他价格档位"
-                return invoke_result_data
-            else:
-                act_info = ActInfoModel(context=self.context).get_cache_entity_by_id(bind_act_id)
-                if act_info:
-                    invoke_result_data.success = False
-                    invoke_result_data.error_code = "error"
-                    invoke_result_data.error_message = "对不起,该商品已绑定" + act_info.act_name + "活动"
-                    return invoke_result_data
-        return invoke_result_data
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-08-02 14:26:29
+@LastEditTime: 2023-01-04 15:59:34
+@LastEditors: HuangJianYi
+@Description: 
+"""
+from seven_cloudapp_frame.models.seven_model import *
+from seven_cloudapp_frame.libs.customize.seven_helper import *
+from seven_cloudapp_frame.models.act_base_model import *
+from seven_cloudapp_frame.models.launch_base_model import *
+from seven_cloudapp_frame.models.db_models.price.price_gear_model import *
+
+
+class PriceBaseModel():
+    """
+    :description: 价格档位业务模型
+    """
+    def __init__(self, context=None,logging_error=None, logging_info=None):
+        self.context = context
+        self.logging_link_error = logging_error
+        self.logging_link_info = logging_info
+
+    def _delete_price_gear_dependency_key(self, act_id, delay_delete_time=0.01):
+        """
+        :description: 删除价格档位依赖建
+        :param act_id: 活动标识
+        :param delay_delete_time: 延迟删除时间，传0则不进行延迟
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        PriceGearModel().delete_dependency_key(DependencyKey.price_gear_list(act_id), delay_delete_time)
+
+    def save_price_gear(self,app_id,act_id,price_gear_id,relation_type,price_gear_name,price_gear_pic,price,goods_id,sku_id,remark="",sort_index=0):
+        """
+        :description: 保存价格档位
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param price_gear_id：价格档位标识
+        :param relation_type：关联类型：1-商品skuid关联2-商品id关联
+        :param price_gear_name：档位名称
+        :param price_gear_pic：档位图片
+        :param price：价格
+        :param goods_id：商品ID
+        :param sku_id：sku_id
+        :param remark：备注
+        :param sort_index：排序
+        :return:
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        price_gear = None
+        old_price_gear = None
+        price_gear_model = PriceGearModel(context=self.context)
+        if price_gear_id > 0:
+            price_gear = price_gear_model.get_entity_by_id(price_gear_id)
+        is_add = False
+        if not price_gear:
+            is_add = True
+            price_gear = PriceGear()
+        else:
+            old_price_gear = deepcopy(price_gear)
+        try:
+            price = decimal.Decimal(price)
+        except Exception as ex:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "参数price类型错误"
+            return invoke_result_data
+
+        if goods_id != "":
+            price_gear_goodsid = price_gear_model.get_entity("act_id!=%s and goods_id=%s", params=[act_id, goods_id])
+            if price_gear_goodsid:
+                act_info_dict = ActInfoModel(context=self.context).get_dict_by_id(price_gear_goodsid.act_id)
+                act_name = act_info_dict["act_name"] if act_info_dict else ""
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "error"
+                invoke_result_data.error_message = f"此商品ID已关联活动{act_name},无法使用"
+                return invoke_result_data
+
+        price_gear.app_id = app_id
+        price_gear.act_id = act_id
+        price_gear.relation_type = relation_type
+        price_gear.price = price
+        price_gear.price_gear_name = price_gear_name
+        price_gear.price_gear_pic = price_gear_pic
+        price_gear.goods_id = goods_id
+        price_gear.sku_id = sku_id
+        price_gear.remark = remark
+        price_gear.sort_index = sort_index
+        price_gear.modify_date = SevenHelper.get_now_datetime()
+
+        if is_add:
+            if sku_id != "":
+                price_gear_goodsid_skuid = price_gear_model.get_total("sku_id=%s", params=[sku_id])
+                if price_gear_goodsid_skuid:
+                    invoke_result_data.success = False
+                    invoke_result_data.error_code = "error"
+                    invoke_result_data.error_message = f"当前SKUID已绑定价格档位,请更换"
+                    return invoke_result_data
+            price_gear.create_date = SevenHelper.get_now_datetime()
+            price_gear.effective_date = SevenHelper.get_now_datetime()
+            price_gear.id = price_gear_model.add_entity(price_gear)
+        else:
+            if sku_id != "":
+                price_gear_goodsid_skuid = price_gear_model.get_total("id!=%s and sku_id=%s", params=[price_gear.id, sku_id])
+                if price_gear_goodsid_skuid:
+                    invoke_result_data.success = False
+                    invoke_result_data.error_code = "error"
+                    invoke_result_data.error_message = f"当前SKUID已绑定价格档位,请更换"
+                    return invoke_result_data
+            price_gear_model.update_entity(price_gear)
+
+        launch_goods_id = price_gear.goods_id if price_gear else ''
+        old_goods_id = old_price_gear.goods_id if old_price_gear else ''
+        launch_base_model = LaunchBaseModel(context=self.context)
+        launch_base_model.add_launch_goods(app_id,act_id, launch_goods_id, old_goods_id,"2")
+
+        result = {}
+        result["is_add"] = is_add
+        result["new"] = price_gear
+        result["old"] = old_price_gear
+        invoke_result_data.data = result
+        self._delete_price_gear_dependency_key(act_id)
+        return invoke_result_data
+
+    def get_price_gear_list(self,app_id,act_id,page_size,page_index,order_by="id desc",is_del=0,is_cache=True, page_count_mode="total"):
+        """
+        :description: 获取价格档位列表
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param page_index：页索引
+        :param page_size：页大小
+        :param order_by：排序
+        :param is_del：是否回收站1是0否
+        :param is_cache：是否缓存
+        :param page_count_mode: 分页计数模式 total-计算总数(默认) next-计算是否有下一页(bool) none-不计算
+        :return:
+        :last_editors: HuangJianYi
+        """
+        condition = "app_id=%s and act_id=%s"
+        if is_del == 1:
+            condition += " and is_del=1"
+        else:
+            condition += " and is_del=0"
+
+        params = [app_id,act_id]
+        price_gear_model = PriceGearModel(context=self.context)
+        if is_cache == True:
+            page_list = price_gear_model.get_cache_dict_page_list(field="*", page_index=page_index, page_size=page_size, where=condition, group_by="", order_by=order_by,params=params,dependency_key=DependencyKey.price_gear_list(act_id),page_count_mode=page_count_mode)
+        else:
+            page_list = price_gear_model.get_dict_page_list(field="*", page_index=page_index, page_size=page_size, where=condition, group_by="", order_by=order_by,params=params,page_count_mode=page_count_mode)
+        return page_list
+
+    def update_price_gear_status(self,app_id,act_id,price_gear_id,is_del):
+        """
+        :description: 删除或恢复价格档位
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param price_gear_id：价格档位标识
+        :param is_del：1删除0恢复
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        price_gear_model = PriceGearModel(context=self.context)
+        price_gear_dict = price_gear_model.get_dict_by_id(price_gear_id)
+        if not price_gear_dict or price_gear_dict["act_id"] != act_id or price_gear_dict["app_id"] != app_id:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "价格档位信息不存在"
+            return invoke_result_data
+        goods_id =  price_gear_dict["goods_id"]
+        invoke_result_data.success = price_gear_model.update_table("is_del=%s,goods_id='',sku_id=''", "id=%s", [is_del, price_gear_id])
+        if invoke_result_data.success ==True and is_del == 1:
+            launch_base_model = LaunchBaseModel(context=self.context)
+            launch_base_model.update_launch_goods(act_id, goods_id,"2")
+        self._delete_price_gear_dependency_key(act_id)
+        invoke_result_data.data = price_gear_dict
+        return invoke_result_data
+
+    def check_price_gear(self,app_id,act_id,price_gear_id,goods_id,sku_id):
+        """
+        :description: 验证价格档位
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param price_gear_id：价格档位标识
+        :param goods_id：商品ID
+        :param sku_id：sku_id
+        :return:
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        price_gear_model = PriceGearModel(context=self.context)
+        condtion = "app_id=%s and goods_id=%s"
+        params = [app_id, goods_id]
+        if price_gear_id > 0:
+            condtion += " and id!=%s"
+            params.append(price_gear_id)
+        price_gear_dict_list = price_gear_model.get_dict_list(condtion, params=params)
+        is_fail = False
+        bind_act_id = 0
+        if price_gear_dict_list:
+            if not sku_id:
+                is_fail = True
+                bind_act_id = price_gear_dict_list[0]["act_id"]
+            else:
+                for price_gear_dict in price_gear_dict_list:
+                    if price_gear_dict["relation_type"] == 2 or price_gear_dict["sku_id"] == sku_id:
+                        is_fail = True
+                        bind_act_id = int(price_gear_dict["act_id"])
+                        break
+        #验证失败
+        if is_fail == True:
+            if act_id == bind_act_id:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "error"
+                invoke_result_data.error_message = "对不起,该商品已绑定其他价格档位"
+                return invoke_result_data
+            else:
+                act_info = ActInfoModel(context=self.context).get_cache_entity_by_id(bind_act_id)
+                if act_info:
+                    invoke_result_data.success = False
+                    invoke_result_data.error_code = "error"
+                    invoke_result_data.error_message = "对不起,该商品已绑定" + act_info.act_name + "活动"
+                    return invoke_result_data
+        return invoke_result_data
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/prize_base_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/prize_base_model.py`

 * *Ordering differences only*

 * *Files 17% similar despite different names*

```diff
@@ -1,327 +1,327 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-08-04 13:41:15
-@LastEditTime: 2023-02-21 13:38:22
-@LastEditors: HuangJianYi
-@Description: 
-"""
-from seven_cloudapp_frame.models.seven_model import *
-from seven_cloudapp_frame.libs.customize.seven_helper import *
-from seven_cloudapp_frame.models.db_models.act.act_module_model import *
-from seven_cloudapp_frame.models.db_models.act.act_prize_model import *
-from seven_cloudapp_frame.models.db_models.tao.tao_coupon_model import *
-from seven_cloudapp_frame.models.db_models.user.user_info_model import *
-
-class PrizeBaseModel():
-    """
-    :description: 活动奖品业务模型
-    """
-    def __init__(self, context=None,logging_error=None, logging_info=None):
-        self.context = context
-        self.logging_link_error = logging_error
-        self.logging_link_info = logging_info
-
-    def _delete_act_prize_dependency_key(self, act_id, model_id, prize_id, delay_delete_time=0.01):
-        """
-        :description: 删除活动奖品依赖建
-        :param act_id: 活动标识
-        :param model_id: 模块标识
-        :param prize_id: 奖品标识
-        :param delay_delete_time: 延迟删除时间，传0则不进行延迟
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        dependency_key_list = []
-        if prize_id:
-            dependency_key_list.append(DependencyKey.act_prize(prize_id))
-        if act_id:
-            dependency_key_list.append(DependencyKey.act_prize_list(act_id))
-            if model_id:
-                dependency_key_list.append(DependencyKey.act_prize_list(act_id, model_id))
-        ActPrizeModel().delete_dependency_key(dependency_key_list,delay_delete_time)
-
-
-    def get_act_prize_dict(self,prize_id,is_cache=True,is_filter=True):
-        """
-        :description: 获取活动模块
-        :param prize_id: 奖品标识
-        :param is_cache: 是否缓存
-        :param is_filter: 是否过滤未发布或删除的数据
-        :return: 返回活动奖品
-        :last_editors: HuangJianYi
-        """
-        act_prize_model = ActPrizeModel(context=self.context)
-        if is_cache:
-            act_prize_dict = act_prize_model.get_cache_dict_by_id(prize_id,dependency_key=DependencyKey.act_prize(prize_id))
-        else:
-            act_prize_dict = act_prize_model.get_dict_by_id(prize_id)
-        if is_filter == True:
-            if not act_prize_dict or act_prize_dict["is_release"] == 0 or act_prize_dict["is_del"] == 1:
-                return None
-        return act_prize_dict
-
-    def get_act_prize_list(self,app_id,act_id,module_id,prize_name,ascription_type,is_del,page_size,page_index,order_by="sort_index desc,id asc",condition="",params=[],field="*",is_cache=True,page_count_mode="total"):
-        """
-        :description: 获取活动奖品列表
-        :param app_id: 应用标识
-        :param act_id: 活动标识
-        :param module_id: 活动模块标识
-        :param prize_name: 奖品名称
-        :param ascription_type: 奖品归属类型（0-活动奖品1-任务奖品）
-        :param is_del：是否回收站1是0否
-        :param page_size: 条数
-        :param page_index: 页数
-        :param order_by：排序
-        :param condition：条件
-        :param params：参数化数组
-        :param field:查询字段
-        :param is_cache: 是否缓存
-        :param page_count_mode: 分页计数模式 total-计算总数(默认) next-计算是否有下一页(bool) none-不计算       
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        where = "app_id=%s and act_id=%s"
-        params_list = [app_id,act_id]
-        if condition:
-            where += " and " + condition
-            params_list.extend(params)
-        if ascription_type != -1:
-            where += " and ascription_type=%s"
-            params_list.append(ascription_type)
-        if is_del !=-1:
-            where += " and is_del=%s"
-            params_list.append(is_del)
-        if module_id:
-            where += " and module_id=%s"
-            params_list.append(module_id)
-        if prize_name:
-            where += " and prize_name=%s"
-            params_list.append(prize_name)
-        act_prize_model = ActPrizeModel(context=self.context)
-        if is_cache:
-            page_list = act_prize_model.get_cache_dict_page_list(field=field, page_index=page_index, page_size=page_size, where=where, group_by="", order_by=order_by, params=params_list,dependency_key=DependencyKey.act_prize_list(act_id,module_id),page_count_mode=page_count_mode)
-        else:
-            page_list = act_prize_model.get_dict_page_list(field=field, page_index=page_index, page_size=page_size, where=where, group_by="", order_by=order_by, params=params_list,page_count_mode=page_count_mode)
-        return page_list
-
-    def save_act_prize(self,app_id,act_id,module_id,prize_id,prize_name,prize_title,prize_pic,prize_detail_json,goods_id,goods_code,goods_code_list,goods_type,prize_type,prize_price,probability,chance,prize_limit,is_prize_notice,prize_total,is_surplus,lottery_type,tag_name,tag_id,is_sku,sku_json,sort_index,is_release,ascription_type=0,i1=0,i2=0,i3=0,i4=0,i5=0,s1='',s2='',s3='',s4='',s5='',d1='',d2=''):
-        """
-        :description: 保存活动模块信息
-        :param app_id: 应用标识
-        :param act_id: 活动标识
-        :param module_id: 活动模块标识
-        :param prize_id: 奖品标识
-        :param prize_name: 奖品名称
-        :param prize_title: 奖品子标题
-        :param prize_pic: 奖品图
-        :param prize_detail_json: 奖品详情图（json）
-        :param goods_id: 商品ID
-        :param goods_code: 商品编码
-        :param goods_code_list: 多个sku商品编码
-        :param goods_type: 物品类型（1虚拟2实物）
-        :param prize_type: 奖品类型(1现货2优惠券3红包4参与奖、谢谢参与5预售)
-        :param prize_price: 奖品价值
-        :param probability: 奖品权重
-        :param chance: 概率
-        :param prize_limit: 中奖限制数
-        :param is_prize_notice: 是否显示跑马灯(1是0否)
-        :param prize_total: 变动后的奖品总数
-        :param is_surplus: 是否显示奖品库存（1显示0-不显示）
-        :param lottery_type: 出奖类型（1概率出奖 2强制概率）
-        :param tag_name: 标签名称(奖项名称)
-        :param tag_id: 标签ID(奖项标识)
-        :param is_sku: 是否有SKU
-        :param sku_json: sku详情json
-        :param sort_index: 排序
-        :param is_release: 是否发布（1是0否）
-        :param ascription_type: 奖品归属类型（0-活动奖品1-任务奖品）
-        :param i1: i1
-        :param i2: i2
-        :param i3: i3
-        :param i4: i4
-        :param i5: i5
-        :param s1: s1
-        :param s2: s2
-        :param s3: s3
-        :param s4: s4
-        :param s5: s5
-        :param d1: d1
-        :param d2: d2
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        if not module_id and not act_id:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "param_error"
-            invoke_result_data.error_message = "参数不能为空或等于0"
-            return invoke_result_data
-
-        is_add = False
-        old_act_prize = None
-        act_prize = None
-        now_datetime = SevenHelper.get_now_datetime()
-        act_prize_model = ActPrizeModel(context=self.context)
-        if prize_id > 0:
-            act_prize = act_prize_model.get_entity_by_id(prize_id)
-            if not act_prize or act_prize.app_id != app_id:
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "error"
-                invoke_result_data.error_message = "活动奖品信息不存在"
-                return invoke_result_data
-            old_act_prize = deepcopy(act_prize)
-        if not act_prize:
-            is_add = True
-            act_prize = ActPrize()
-
-        act_prize.app_id = app_id
-        act_prize.act_id = act_id
-        act_prize.module_id = module_id
-        act_prize.ascription_type = ascription_type
-        act_prize.prize_name = prize_name
-        act_prize.prize_title = prize_title
-        act_prize.prize_pic = prize_pic
-        act_prize.prize_detail_json = prize_detail_json if prize_detail_json else []
-        act_prize.goods_id = goods_id
-        act_prize.goods_code = goods_code
-        act_prize.goods_code_list = goods_code_list
-        act_prize.goods_type = goods_type
-        act_prize.prize_type = prize_type
-        act_prize.prize_price = prize_price
-        act_prize.probability = probability
-        act_prize.chance = chance
-        act_prize.prize_limit = prize_limit
-        act_prize.is_prize_notice = is_prize_notice
-        act_prize.is_surplus = is_surplus
-        act_prize.lottery_type = lottery_type
-        act_prize.tag_name = tag_name
-        act_prize.tag_id = tag_id
-        act_prize.is_sku = is_sku
-        act_prize.sku_json = sku_json if sku_json else {}
-        act_prize.sort_index = sort_index
-        act_prize.is_release = is_release
-        act_prize.i1 = i1
-        act_prize.i2 = i2
-        act_prize.i3 = i3
-        act_prize.i4 = i4
-        act_prize.i5 = i5
-        act_prize.s1 = s1
-        act_prize.s2 = s2
-        act_prize.s3 = s3
-        act_prize.s4 = s4
-        act_prize.s5 = s5
-        act_prize.d1 = d1
-        act_prize.d2 = d2
-        act_prize.modify_date = now_datetime
-
-        # 奖品类型为参与奖时
-        prize_total = 9999 if prize_type == 4 else prize_total
-
-        if is_add:
-            act_prize.create_date = now_datetime
-            act_prize.surplus = prize_total
-            act_prize.prize_total = prize_total
-            act_prize.id = act_prize_model.add_entity(act_prize)
-        else:
-            act_prize_model.update_entity(act_prize,exclude_field_list="app_id,act_id,module_id,prize_total,surplus,hand_out")
-            operate_num = prize_total - act_prize.prize_total
-            if operate_num != 0:
-                act_prize_model.update_table(f"surplus=surplus+{operate_num},prize_total=prize_total+{operate_num}", "id=%s", act_prize.id)
-
-        result = {}
-        result["is_add"] = is_add
-        result["new"] = act_prize
-        result["old"] = old_act_prize
-        invoke_result_data.data = result
-        self._delete_act_prize_dependency_key(act_id,module_id,act_prize.id)
-        return invoke_result_data
-
-    def save_tao_coupon(self,app_id,act_id,prize_id,coupon_type,right_ename,pool_id,coupon_start_date,coupon_end_date,coupon_url,coupon_price,use_sill_price):
-        """
-        :description: 添加奖品关联优惠券
-        :param app_id: 应用标识
-        :param act_id: 活动标识
-        :param prize_id: 奖品标识
-        :param coupon_type: 优惠券类型(0无1店铺优惠券2商品优惠券3会员专享优惠券)
-        :param right_ename: 发放的权益(奖品)唯一标识
-        :param pool_id: 奖池ID
-        :param coupon_start_date: 优惠券开始时间
-        :param coupon_end_date: 优惠券结束时间
-        :param coupon_url: 优惠劵地址
-        :param coupon_price: 优惠券面额
-        :param use_sill_price: 使用门槛金额
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        tao_coupon = None
-        tao_coupon_model = TaoCouponModel(context=self.context)
-        if prize_id > 0:
-            tao_coupon = tao_coupon_model.get_entity("act_id=%s and prize_id=%s",params=[act_id,prize_id])
-        if not tao_coupon:
-            tao_coupon = TaoCoupon()
-        tao_coupon.app_id = app_id
-        tao_coupon.act_id = act_id
-        tao_coupon.prize_id = prize_id
-        tao_coupon.coupon_type = coupon_type
-        tao_coupon.right_ename = right_ename
-        tao_coupon.pool_id = pool_id
-        tao_coupon.coupon_start_date = coupon_start_date if coupon_start_date else "1900-01-01 00:00:00"
-        tao_coupon.coupon_end_date = coupon_end_date if coupon_end_date else "2900-01-01 00:00:00"
-        tao_coupon.coupon_url = coupon_url
-        tao_coupon.coupon_price = coupon_price
-        tao_coupon.use_sill_price = use_sill_price
-
-        tao_coupon.modify_date = SevenHelper.get_now_datetime()
-        tao_coupon.id = tao_coupon_model.add_update_entity(tao_coupon, update_sql="coupon_type=%s,right_ename=%s,pool_id=%s,coupon_start_date=%s,coupon_end_date=%s,coupon_url=%s,coupon_price=%s,use_sill_price=%s,modify_date=%s",params=[coupon_type,right_ename,pool_id,coupon_start_date,coupon_end_date,coupon_url,coupon_price,use_sill_price,tao_coupon.modify_date])
-        invoke_result_data.data=tao_coupon.id
-        tao_coupon_model.delete_dependency_key([DependencyKey.coupon(tao_coupon.id),DependencyKey.coupon_list(act_id)])
-        return invoke_result_data
-
-    def update_act_prize_status(self,app_id,prize_id,is_del):
-        """
-        :description: 删除或者还原活动奖品
-        :param app_id：应用标识
-        :param prize_id：奖品标识
-        :param is_del：0-还原，1-删除
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        act_prize_model = ActPrizeModel(context=self.context)
-        act_prize_dict = act_prize_model.get_dict_by_id(prize_id)
-        if not act_prize_dict or act_prize_dict["app_id"] != app_id:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "活动奖品信息不存在"
-            return invoke_result_data
-        is_release = 0 if is_del == 1 else 1
-        modify_date = SevenHelper.get_now_datetime()
-        invoke_result_data.success = act_prize_model.update_table("is_del=%s,is_release=%s,modify_date=%s", "id=%s", [is_del, is_release, modify_date, prize_id])
-        self._delete_act_prize_dependency_key(act_prize_dict["act_id"],act_prize_dict["module_id"],prize_id)
-        invoke_result_data.data = act_prize_dict
-        return invoke_result_data
-
-    def release_act_prize(self,app_id,prize_id,is_release):
-        """
-        :description: 活动奖品上下架
-        :param app_id：应用标识
-        :param prize_id：奖品标识
-        :param is_release: 是否发布 1-是 0-否
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        act_prize_model = ActPrizeModel(context=self.context)
-        act_prize_dict = act_prize_model.get_dict_by_id(prize_id)
-        if not act_prize_dict or act_prize_dict["app_id"] != app_id:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "活动奖品不存在"
-            return invoke_result_data
-        modify_date = SevenHelper.get_now_datetime()
-        invoke_result_data.success = act_prize_model.update_table("modify_date=%s,is_release=%s", "id=%s", [modify_date, is_release, prize_id])
-        self._delete_act_prize_dependency_key(act_prize_dict["act_id"],act_prize_dict["module_id"],prize_id)
-        invoke_result_data.data = act_prize_dict
-        return invoke_result_data
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-08-04 13:41:15
+@LastEditTime: 2023-02-21 13:38:22
+@LastEditors: HuangJianYi
+@Description: 
+"""
+from seven_cloudapp_frame.models.seven_model import *
+from seven_cloudapp_frame.libs.customize.seven_helper import *
+from seven_cloudapp_frame.models.db_models.act.act_module_model import *
+from seven_cloudapp_frame.models.db_models.act.act_prize_model import *
+from seven_cloudapp_frame.models.db_models.tao.tao_coupon_model import *
+from seven_cloudapp_frame.models.db_models.user.user_info_model import *
+
+class PrizeBaseModel():
+    """
+    :description: 活动奖品业务模型
+    """
+    def __init__(self, context=None,logging_error=None, logging_info=None):
+        self.context = context
+        self.logging_link_error = logging_error
+        self.logging_link_info = logging_info
+
+    def _delete_act_prize_dependency_key(self, act_id, model_id, prize_id, delay_delete_time=0.01):
+        """
+        :description: 删除活动奖品依赖建
+        :param act_id: 活动标识
+        :param model_id: 模块标识
+        :param prize_id: 奖品标识
+        :param delay_delete_time: 延迟删除时间，传0则不进行延迟
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        dependency_key_list = []
+        if prize_id:
+            dependency_key_list.append(DependencyKey.act_prize(prize_id))
+        if act_id:
+            dependency_key_list.append(DependencyKey.act_prize_list(act_id))
+            if model_id:
+                dependency_key_list.append(DependencyKey.act_prize_list(act_id, model_id))
+        ActPrizeModel().delete_dependency_key(dependency_key_list,delay_delete_time)
+
+
+    def get_act_prize_dict(self,prize_id,is_cache=True,is_filter=True):
+        """
+        :description: 获取活动模块
+        :param prize_id: 奖品标识
+        :param is_cache: 是否缓存
+        :param is_filter: 是否过滤未发布或删除的数据
+        :return: 返回活动奖品
+        :last_editors: HuangJianYi
+        """
+        act_prize_model = ActPrizeModel(context=self.context)
+        if is_cache:
+            act_prize_dict = act_prize_model.get_cache_dict_by_id(prize_id,dependency_key=DependencyKey.act_prize(prize_id))
+        else:
+            act_prize_dict = act_prize_model.get_dict_by_id(prize_id)
+        if is_filter == True:
+            if not act_prize_dict or act_prize_dict["is_release"] == 0 or act_prize_dict["is_del"] == 1:
+                return None
+        return act_prize_dict
+
+    def get_act_prize_list(self,app_id,act_id,module_id,prize_name,ascription_type,is_del,page_size,page_index,order_by="sort_index desc,id asc",condition="",params=[],field="*",is_cache=True,page_count_mode="total"):
+        """
+        :description: 获取活动奖品列表
+        :param app_id: 应用标识
+        :param act_id: 活动标识
+        :param module_id: 活动模块标识
+        :param prize_name: 奖品名称
+        :param ascription_type: 奖品归属类型（0-活动奖品1-任务奖品）
+        :param is_del：是否回收站1是0否
+        :param page_size: 条数
+        :param page_index: 页数
+        :param order_by：排序
+        :param condition：条件
+        :param params：参数化数组
+        :param field:查询字段
+        :param is_cache: 是否缓存
+        :param page_count_mode: 分页计数模式 total-计算总数(默认) next-计算是否有下一页(bool) none-不计算       
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        where = "app_id=%s and act_id=%s"
+        params_list = [app_id,act_id]
+        if condition:
+            where += " and " + condition
+            params_list.extend(params)
+        if ascription_type != -1:
+            where += " and ascription_type=%s"
+            params_list.append(ascription_type)
+        if is_del !=-1:
+            where += " and is_del=%s"
+            params_list.append(is_del)
+        if module_id:
+            where += " and module_id=%s"
+            params_list.append(module_id)
+        if prize_name:
+            where += " and prize_name=%s"
+            params_list.append(prize_name)
+        act_prize_model = ActPrizeModel(context=self.context)
+        if is_cache:
+            page_list = act_prize_model.get_cache_dict_page_list(field=field, page_index=page_index, page_size=page_size, where=where, group_by="", order_by=order_by, params=params_list,dependency_key=DependencyKey.act_prize_list(act_id,module_id),page_count_mode=page_count_mode)
+        else:
+            page_list = act_prize_model.get_dict_page_list(field=field, page_index=page_index, page_size=page_size, where=where, group_by="", order_by=order_by, params=params_list,page_count_mode=page_count_mode)
+        return page_list
+
+    def save_act_prize(self,app_id,act_id,module_id,prize_id,prize_name,prize_title,prize_pic,prize_detail_json,goods_id,goods_code,goods_code_list,goods_type,prize_type,prize_price,probability,chance,prize_limit,is_prize_notice,prize_total,is_surplus,lottery_type,tag_name,tag_id,is_sku,sku_json,sort_index,is_release,ascription_type=0,i1=0,i2=0,i3=0,i4=0,i5=0,s1='',s2='',s3='',s4='',s5='',d1='',d2=''):
+        """
+        :description: 保存活动模块信息
+        :param app_id: 应用标识
+        :param act_id: 活动标识
+        :param module_id: 活动模块标识
+        :param prize_id: 奖品标识
+        :param prize_name: 奖品名称
+        :param prize_title: 奖品子标题
+        :param prize_pic: 奖品图
+        :param prize_detail_json: 奖品详情图（json）
+        :param goods_id: 商品ID
+        :param goods_code: 商品编码
+        :param goods_code_list: 多个sku商品编码
+        :param goods_type: 物品类型（1虚拟2实物）
+        :param prize_type: 奖品类型(1现货2优惠券3红包4参与奖、谢谢参与5预售)
+        :param prize_price: 奖品价值
+        :param probability: 奖品权重
+        :param chance: 概率
+        :param prize_limit: 中奖限制数
+        :param is_prize_notice: 是否显示跑马灯(1是0否)
+        :param prize_total: 变动后的奖品总数
+        :param is_surplus: 是否显示奖品库存（1显示0-不显示）
+        :param lottery_type: 出奖类型（1概率出奖 2强制概率）
+        :param tag_name: 标签名称(奖项名称)
+        :param tag_id: 标签ID(奖项标识)
+        :param is_sku: 是否有SKU
+        :param sku_json: sku详情json
+        :param sort_index: 排序
+        :param is_release: 是否发布（1是0否）
+        :param ascription_type: 奖品归属类型（0-活动奖品1-任务奖品）
+        :param i1: i1
+        :param i2: i2
+        :param i3: i3
+        :param i4: i4
+        :param i5: i5
+        :param s1: s1
+        :param s2: s2
+        :param s3: s3
+        :param s4: s4
+        :param s5: s5
+        :param d1: d1
+        :param d2: d2
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        if not module_id and not act_id:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "param_error"
+            invoke_result_data.error_message = "参数不能为空或等于0"
+            return invoke_result_data
+
+        is_add = False
+        old_act_prize = None
+        act_prize = None
+        now_datetime = SevenHelper.get_now_datetime()
+        act_prize_model = ActPrizeModel(context=self.context)
+        if prize_id > 0:
+            act_prize = act_prize_model.get_entity_by_id(prize_id)
+            if not act_prize or act_prize.app_id != app_id:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "error"
+                invoke_result_data.error_message = "活动奖品信息不存在"
+                return invoke_result_data
+            old_act_prize = deepcopy(act_prize)
+        if not act_prize:
+            is_add = True
+            act_prize = ActPrize()
+
+        act_prize.app_id = app_id
+        act_prize.act_id = act_id
+        act_prize.module_id = module_id
+        act_prize.ascription_type = ascription_type
+        act_prize.prize_name = prize_name
+        act_prize.prize_title = prize_title
+        act_prize.prize_pic = prize_pic
+        act_prize.prize_detail_json = prize_detail_json if prize_detail_json else []
+        act_prize.goods_id = goods_id
+        act_prize.goods_code = goods_code
+        act_prize.goods_code_list = goods_code_list
+        act_prize.goods_type = goods_type
+        act_prize.prize_type = prize_type
+        act_prize.prize_price = prize_price
+        act_prize.probability = probability
+        act_prize.chance = chance
+        act_prize.prize_limit = prize_limit
+        act_prize.is_prize_notice = is_prize_notice
+        act_prize.is_surplus = is_surplus
+        act_prize.lottery_type = lottery_type
+        act_prize.tag_name = tag_name
+        act_prize.tag_id = tag_id
+        act_prize.is_sku = is_sku
+        act_prize.sku_json = sku_json if sku_json else {}
+        act_prize.sort_index = sort_index
+        act_prize.is_release = is_release
+        act_prize.i1 = i1
+        act_prize.i2 = i2
+        act_prize.i3 = i3
+        act_prize.i4 = i4
+        act_prize.i5 = i5
+        act_prize.s1 = s1
+        act_prize.s2 = s2
+        act_prize.s3 = s3
+        act_prize.s4 = s4
+        act_prize.s5 = s5
+        act_prize.d1 = d1
+        act_prize.d2 = d2
+        act_prize.modify_date = now_datetime
+
+        # 奖品类型为参与奖时
+        prize_total = 9999 if prize_type == 4 else prize_total
+
+        if is_add:
+            act_prize.create_date = now_datetime
+            act_prize.surplus = prize_total
+            act_prize.prize_total = prize_total
+            act_prize.id = act_prize_model.add_entity(act_prize)
+        else:
+            act_prize_model.update_entity(act_prize,exclude_field_list="app_id,act_id,module_id,prize_total,surplus,hand_out")
+            operate_num = prize_total - act_prize.prize_total
+            if operate_num != 0:
+                act_prize_model.update_table(f"surplus=surplus+{operate_num},prize_total=prize_total+{operate_num}", "id=%s", act_prize.id)
+
+        result = {}
+        result["is_add"] = is_add
+        result["new"] = act_prize
+        result["old"] = old_act_prize
+        invoke_result_data.data = result
+        self._delete_act_prize_dependency_key(act_id,module_id,act_prize.id)
+        return invoke_result_data
+
+    def save_tao_coupon(self,app_id,act_id,prize_id,coupon_type,right_ename,pool_id,coupon_start_date,coupon_end_date,coupon_url,coupon_price,use_sill_price):
+        """
+        :description: 添加奖品关联优惠券
+        :param app_id: 应用标识
+        :param act_id: 活动标识
+        :param prize_id: 奖品标识
+        :param coupon_type: 优惠券类型(0无1店铺优惠券2商品优惠券3会员专享优惠券)
+        :param right_ename: 发放的权益(奖品)唯一标识
+        :param pool_id: 奖池ID
+        :param coupon_start_date: 优惠券开始时间
+        :param coupon_end_date: 优惠券结束时间
+        :param coupon_url: 优惠劵地址
+        :param coupon_price: 优惠券面额
+        :param use_sill_price: 使用门槛金额
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        tao_coupon = None
+        tao_coupon_model = TaoCouponModel(context=self.context)
+        if prize_id > 0:
+            tao_coupon = tao_coupon_model.get_entity("act_id=%s and prize_id=%s",params=[act_id,prize_id])
+        if not tao_coupon:
+            tao_coupon = TaoCoupon()
+        tao_coupon.app_id = app_id
+        tao_coupon.act_id = act_id
+        tao_coupon.prize_id = prize_id
+        tao_coupon.coupon_type = coupon_type
+        tao_coupon.right_ename = right_ename
+        tao_coupon.pool_id = pool_id
+        tao_coupon.coupon_start_date = coupon_start_date if coupon_start_date else "1900-01-01 00:00:00"
+        tao_coupon.coupon_end_date = coupon_end_date if coupon_end_date else "2900-01-01 00:00:00"
+        tao_coupon.coupon_url = coupon_url
+        tao_coupon.coupon_price = coupon_price
+        tao_coupon.use_sill_price = use_sill_price
+
+        tao_coupon.modify_date = SevenHelper.get_now_datetime()
+        tao_coupon.id = tao_coupon_model.add_update_entity(tao_coupon, update_sql="coupon_type=%s,right_ename=%s,pool_id=%s,coupon_start_date=%s,coupon_end_date=%s,coupon_url=%s,coupon_price=%s,use_sill_price=%s,modify_date=%s",params=[coupon_type,right_ename,pool_id,coupon_start_date,coupon_end_date,coupon_url,coupon_price,use_sill_price,tao_coupon.modify_date])
+        invoke_result_data.data=tao_coupon.id
+        tao_coupon_model.delete_dependency_key([DependencyKey.coupon(tao_coupon.id),DependencyKey.coupon_list(act_id)])
+        return invoke_result_data
+
+    def update_act_prize_status(self,app_id,prize_id,is_del):
+        """
+        :description: 删除或者还原活动奖品
+        :param app_id：应用标识
+        :param prize_id：奖品标识
+        :param is_del：0-还原，1-删除
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        act_prize_model = ActPrizeModel(context=self.context)
+        act_prize_dict = act_prize_model.get_dict_by_id(prize_id)
+        if not act_prize_dict or act_prize_dict["app_id"] != app_id:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "活动奖品信息不存在"
+            return invoke_result_data
+        is_release = 0 if is_del == 1 else 1
+        modify_date = SevenHelper.get_now_datetime()
+        invoke_result_data.success = act_prize_model.update_table("is_del=%s,is_release=%s,modify_date=%s", "id=%s", [is_del, is_release, modify_date, prize_id])
+        self._delete_act_prize_dependency_key(act_prize_dict["act_id"],act_prize_dict["module_id"],prize_id)
+        invoke_result_data.data = act_prize_dict
+        return invoke_result_data
+
+    def release_act_prize(self,app_id,prize_id,is_release):
+        """
+        :description: 活动奖品上下架
+        :param app_id：应用标识
+        :param prize_id：奖品标识
+        :param is_release: 是否发布 1-是 0-否
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        act_prize_model = ActPrizeModel(context=self.context)
+        act_prize_dict = act_prize_model.get_dict_by_id(prize_id)
+        if not act_prize_dict or act_prize_dict["app_id"] != app_id:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "活动奖品不存在"
+            return invoke_result_data
+        modify_date = SevenHelper.get_now_datetime()
+        invoke_result_data.success = act_prize_model.update_table("modify_date=%s,is_release=%s", "id=%s", [modify_date, is_release, prize_id])
+        self._delete_act_prize_dependency_key(act_prize_dict["act_id"],act_prize_dict["module_id"],prize_id)
+        invoke_result_data.data = act_prize_dict
+        return invoke_result_data
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/push_base_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/push_base_model.py`

 * *Ordering differences only*

 * *Files 12% similar despite different names*

```diff
@@ -1,92 +1,92 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2022-01-05 17:32:29
-@LastEditTime: 2022-07-11 15:02:43
-@LastEditors: HuangJianYi
-@Description: 消息推送业务模型
-"""
-
-from seven_cloudapp_frame.models.seven_model import *
-from seven_cloudapp_frame.libs.customize.seven_helper import *
-from seven_cloudapp_frame.libs.customize.wechat_helper import *
-
-
-class PushBaseModel():
-    """
-    :description: 消息推送业务模型
-    """
-    def __init__(self, context=None, logging_error=None, logging_info=None):
-        self.context = context
-        self.logging_link_error = logging_error
-        self.logging_link_info = logging_info
-
-    def add_wechat_subscribe(self, app_id, template_id, open_id):
-        """
-        :description: 添加微信订阅次数
-        :param app_id：应用标识
-        :param template_id：模板ID
-        :param open_id:接收者（用户）的 openid
-        :return:
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        redis_init = SevenHelper.redis_init()
-        redis_key = f"wechat_subscribe_list:{app_id}_{template_id}"
-        redis_init.zincrby(redis_key, value=open_id, amount=1)
-        redis_init.expire(redis_key, 3600 * 24 * 30)
-        return invoke_result_data
-
-    def push_wechat_message(self, open_id, template_id, page, request_data, miniprogram_state="formal", lang="zh_CN", app_id="", app_secret="", plan_id=0):
-        """
-        :description: 推送微信订阅信息
-        :param open_id:接收者（用户）的 openid
-        :param template_id:所需下发的订阅模板id
-        :param page:点击模板卡片后的跳转页面，仅限本小程序内的页面。支持带参数,（示例index?foo=bar）。该字段不填则模板无跳转
-        :param request_data:模板内容，格式形如 {"date2":{"value":any}, "thing3":{"value":any}}
-        :param miniprogram_state:跳转小程序类型：developer为开发版；trial为体验版；formal为正式版；默认为正式版
-        :param lang:进入小程序查看”的语言类型，支持zh_CN(简体中文)、en_US(英文)、zh_HK(繁体中文)、zh_TW(繁体中文)，默认为zh_CN
-        :param app_id:app_id
-        :param app_secret:app_secret
-        param plan_id:计划标识
-        :return:
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        try:
-            redis_init = SevenHelper.redis_init()
-            push_log_dict = {}
-            push_log_dict["open_id"] = open_id
-            push_log_dict["template_id"] = template_id
-            push_log_dict["page"] = page
-            push_log_dict["request_data"] = request_data
-            push_log_dict["miniprogram_state"] = miniprogram_state
-            push_log_dict["lang"] = lang
-            push_log_dict["app_id"] = app_id
-            push_log_dict["app_secret"] = app_secret
-            push_log_dict["plan_id"] = plan_id
-            subscribe_redis_key = f"wechat_subscribe_list:{app_id}_{template_id}"
-            if not redis_init.zscore(subscribe_redis_key, open_id):
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "error"
-                invoke_result_data.error_message = "订阅次数不足"
-            else:
-                redis_init.zincrby(subscribe_redis_key, value=open_id, amount=-1)
-                invoke_result_data = WeChatHelper.send_template_message(open_id=open_id, template_id=template_id, page=page, request_data=request_data, miniprogram_state=miniprogram_state, lang=lang, app_id=app_id, app_secret=app_secret)
-            push_log_dict["result"] = invoke_result_data
-            push_redis_key = f"wechat_pushlog_list:{app_id}"
-            if plan_id > 0:
-                push_redis_key += f"_{plan_id}"
-            redis_init.rpush(push_redis_key, SevenHelper.json_dumps(push_log_dict))
-            redis_init.expire(push_redis_key, 3600 * 24 * 30)
-            return invoke_result_data
-        except Exception as ex:
-            log_info = "【推送微信订阅信息】" + traceback.format_exc()
-            if self.context:
-                self.context.logging_link_error(log_info)
-            elif self.logging_link_error:
-                self.logging_link_error(log_info)
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "exception"
-            invoke_result_data.error_message = "系统繁忙,请稍后再试"
-        return invoke_result_data
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2022-01-05 17:32:29
+@LastEditTime: 2022-07-11 15:02:43
+@LastEditors: HuangJianYi
+@Description: 消息推送业务模型
+"""
+
+from seven_cloudapp_frame.models.seven_model import *
+from seven_cloudapp_frame.libs.customize.seven_helper import *
+from seven_cloudapp_frame.libs.customize.wechat_helper import *
+
+
+class PushBaseModel():
+    """
+    :description: 消息推送业务模型
+    """
+    def __init__(self, context=None, logging_error=None, logging_info=None):
+        self.context = context
+        self.logging_link_error = logging_error
+        self.logging_link_info = logging_info
+
+    def add_wechat_subscribe(self, app_id, template_id, open_id):
+        """
+        :description: 添加微信订阅次数
+        :param app_id：应用标识
+        :param template_id：模板ID
+        :param open_id:接收者（用户）的 openid
+        :return:
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        redis_init = SevenHelper.redis_init()
+        redis_key = f"wechat_subscribe_list:{app_id}_{template_id}"
+        redis_init.zincrby(redis_key, value=open_id, amount=1)
+        redis_init.expire(redis_key, 3600 * 24 * 30)
+        return invoke_result_data
+
+    def push_wechat_message(self, open_id, template_id, page, request_data, miniprogram_state="formal", lang="zh_CN", app_id="", app_secret="", plan_id=0):
+        """
+        :description: 推送微信订阅信息
+        :param open_id:接收者（用户）的 openid
+        :param template_id:所需下发的订阅模板id
+        :param page:点击模板卡片后的跳转页面，仅限本小程序内的页面。支持带参数,（示例index?foo=bar）。该字段不填则模板无跳转
+        :param request_data:模板内容，格式形如 {"date2":{"value":any}, "thing3":{"value":any}}
+        :param miniprogram_state:跳转小程序类型：developer为开发版；trial为体验版；formal为正式版；默认为正式版
+        :param lang:进入小程序查看”的语言类型，支持zh_CN(简体中文)、en_US(英文)、zh_HK(繁体中文)、zh_TW(繁体中文)，默认为zh_CN
+        :param app_id:app_id
+        :param app_secret:app_secret
+        param plan_id:计划标识
+        :return:
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        try:
+            redis_init = SevenHelper.redis_init()
+            push_log_dict = {}
+            push_log_dict["open_id"] = open_id
+            push_log_dict["template_id"] = template_id
+            push_log_dict["page"] = page
+            push_log_dict["request_data"] = request_data
+            push_log_dict["miniprogram_state"] = miniprogram_state
+            push_log_dict["lang"] = lang
+            push_log_dict["app_id"] = app_id
+            push_log_dict["app_secret"] = app_secret
+            push_log_dict["plan_id"] = plan_id
+            subscribe_redis_key = f"wechat_subscribe_list:{app_id}_{template_id}"
+            if not redis_init.zscore(subscribe_redis_key, open_id):
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "error"
+                invoke_result_data.error_message = "订阅次数不足"
+            else:
+                redis_init.zincrby(subscribe_redis_key, value=open_id, amount=-1)
+                invoke_result_data = WeChatHelper.send_template_message(open_id=open_id, template_id=template_id, page=page, request_data=request_data, miniprogram_state=miniprogram_state, lang=lang, app_id=app_id, app_secret=app_secret)
+            push_log_dict["result"] = invoke_result_data
+            push_redis_key = f"wechat_pushlog_list:{app_id}"
+            if plan_id > 0:
+                push_redis_key += f"_{plan_id}"
+            redis_init.rpush(push_redis_key, SevenHelper.json_dumps(push_log_dict))
+            redis_init.expire(push_redis_key, 3600 * 24 * 30)
+            return invoke_result_data
+        except Exception as ex:
+            log_info = "【推送微信订阅信息】" + traceback.format_exc()
+            if self.context:
+                self.context.logging_link_error(log_info)
+            elif self.logging_link_error:
+                self.logging_link_error(log_info)
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "exception"
+            invoke_result_data.error_message = "系统繁忙,请稍后再试"
+        return invoke_result_data
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/shakeshop_base_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/shakeshop_base_model.py`

 * *Ordering differences only*

 * *Files 14% similar despite different names*

```diff
@@ -1,290 +1,290 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2022-01-10 11:31:34
-@LastEditTime: 2022-01-13 18:12:21
-@LastEditors: HuangJianYi
-@Description: 抖店接口业务模型
-"""
-
-import json
-import time
-import requests
-from cryptography.hazmat.backends import default_backend
-from cryptography.hazmat.primitives.hashes import MD5, SHA256, Hash
-from cryptography.hazmat.primitives.hmac import HMAC
-from seven_cloudapp_frame.libs.customize.seven_helper import SevenHelper
-from seven_cloudapp_frame.models.seven_model import *
-from seven_framework.base_model import *
-
-
-class ShakeShopBaseModel():
-    """
-    :description: 抖店接口业务模型
-    """
-    def __init__(self, context, app_key: str, app_secret: str, app_type, code=None, shop_id: str = None, proxy: str = None, test_mode=False, logging_error=None, logging_info=None):
-        """
-        :description:  初始化实例，自用型应用传入shop_id用于初始化access token，工具型应用传入code换取access token（如初始化时未传入，可以在访问抖店API之前调用init_token(code)进行token的初始化。
-        :param context: 上下文
-        :param app_key: app_key
-        :param app_secret: app_secret
-        :param app_secret: app_secret
-        :param app_type: app_type(SELF或TOOL)
-        :param code: code
-        :param shop_id: 店铺ID
-        :param proxy: 代理
-        :param test_mode: 是否测试沙盒
-        :param logging_error: logging_error
-        :param logging_info: logging_info
-        :return 
-        :last_editors: HuangJianYi
-        """
-        self.context = context
-        self.logging_link_error = logging_error
-        self.logging_link_info = logging_info
-        self._app_key = app_key
-        self._app_secret = app_secret
-        self._app_type = app_type
-        if self._app_type == "SELF" and not shop_id:
-            raise ShopIdError('shop_id is not assigned.')
-        self._shop_id = shop_id
-        self._proxy = proxy
-        self._test_mode = test_mode
-        if self._test_mode:
-            self._gate_way = 'https://openapi-sandbox.jinritemai.com'
-        else:
-            self._gate_way = 'https://openapi-fxg.jinritemai.com'
-        self._version = 2
-        redis_token = SevenHelper.redis_init().get(f"shakeshop_access_token:{str(app_key)}_{self._test_mode}")
-        if redis_token:
-            redis_token = json.loads(redis_token)
-        self._token = redis_token
-        self._sign_method = 'hmac-sha256'
-        if self._token:
-            if self._token.get('expires_in') - int(time.time()) < 3000:
-                self._refresh_token()
-        else:
-            if self._app_type == "SELF":
-                self.init_token()
-            elif self._app_type == "TOOL" and code:
-                self.init_token(code)
-
-    def _sign(self, method: str, param_json: str, timestamp: str) -> str:
-        param_pattern = 'app_key{}method{}param_json{}timestamp{}v{}'.format(self._app_key, method, param_json, timestamp, self._version)
-        sign_pattern = '{}{}{}'.format(self._app_secret, param_pattern, self._app_secret)
-        return self._hash_hmac(sign_pattern)
-
-    def _hash_hmac(self, pattern: str) -> str:
-        try:
-            hmac = HMAC(key=self._app_secret.encode('UTF-8'), algorithm=SHA256(), backend=default_backend())
-            hmac.update(pattern.encode('UTF-8'))
-            signature = hmac.finalize()
-            return signature.hex()
-        except Exception as e:
-            if self.context:
-                self.context.logging_link_error(traceback.format_exc())
-            elif self.logging_link_error:
-                self.logging_link_error(traceback.format_exc())
-            return None
-
-    def _access_token(self) -> str:
-        """
-        :description: 获取access_token
-        :return 
-        :last_editors: HuangJianYi
-        """
-        if not self._token:
-            raise TokenError('no token info, call init_token() to initialize it.')
-        try:
-            if self._token.get('expires_in') - int(time.time()) < 3000:
-                self._refresh_token()
-            return self._token.get('access_token')
-        except Exception as e:
-            if self.context:
-                self.context.logging_link_error(traceback.format_exc())
-            elif self.logging_link_error:
-                self.logging_link_error(traceback.format_exc())
-            return None
-
-    def init_token(self, code: str = '') -> bool:
-        """
-        :description: 初始化access_token
-        :param code: 工具型应用从授权url回调中获取到的code，自用型应用无需传入。
-        :return 
-        :last_editors: HuangJianYi
-        """
-        request_redis_key = f"shakeshop_access_token:{str(self._app_key)}_{self._test_mode}"
-        if SevenHelper.is_continue_request(request_redis_key, 2000) == True:
-            return False
-        if self._app_type == "TOOL" and not code:
-            raise CodeError('code is not assigned.')
-        path = '/token/create'
-        grant_type = 'authorization_self' if self._app_type == "SELF" else 'authorization_code'
-        params = {}
-        params.update({'code': code if code else ''})
-        params.update({'grant_type': grant_type})
-        if self._app_type == "SELF":
-            if self._test_mode:
-                params.update({'test_shop': '1'})
-            elif self._shop_id:
-                params.update({'shop_id': self._shop_id})
-            else:
-                raise ShopIdError('shop_id is not assigned.')
-        result = self._request(path=path, params=params, token_request=True)
-        SevenHelper.redis_init().delete(request_redis_key)
-        if result and result.get('code') == 10000 and result.get('data'):
-            self._token = result.get('data')
-            self._token.update({'expires_in': int(time.time()) + result.get('data').get('expires_in')})
-            SevenHelper.redis_init().set(f"shakeshop_access_token:{str(self._app_key )}_{self._test_mode}", json.dumps(self._token), ex=3600)
-            return True
-        return False
-
-    def _get_refresh_token(self) -> str:
-        """
-        :description: 获取refresh_token
-        :return 
-        :last_editors: HuangJianYi
-        """
-        if not self._token:
-            return None
-        try:
-            return self._token.get('refresh_token')
-        except Exception as e:
-            if self.context:
-                self.context.logging_link_error(traceback.format_exc())
-            elif self.logging_link_error:
-                self.logging_link_error(traceback.format_exc())
-            return None
-
-    def _refresh_token(self) -> None:
-        """
-        :description: 刷新refresh_token
-        :return 
-        :last_editors: HuangJianYi
-        """
-        request_redis_key = f"shakeshop_access_token:{str(self._app_key)}_{self._test_mode}"
-        if SevenHelper.is_continue_request(request_redis_key, 2000) == True:
-            return False
-        path = '/token/refresh'
-        refresh_token = self._get_refresh_token()
-        grant_type = 'refresh_token'
-        params = {}
-        params.update({'grant_type': grant_type})
-        params.update({'refresh_token': refresh_token})
-        result = self._request(path=path, params=params, token_request=True)
-        SevenHelper.redis_init().delete(request_redis_key)
-        if result and result.get('err_no') == 0 and result.get('data'):
-            self._token = result.get('data')
-            self._token.update({'expires_in': int(time.time()) + result.get('data').get('expires_in')})
-            SevenHelper.redis_init().set(f"shakeshop_access_token:{str(self._app_key )}_{self._test_mode}", json.dumps(self._token), ex=3600)
-
-    def _request(self, path: str, params: dict, token_request: bool = False, is_log: bool = False) -> json:
-        """
-        :description: 发起请求
-        :param path: api地址
-        :param params: 参数集合
-        :param token_request: 是否token请求
-        :param is_log: 是否记录日志
-        :return 
-        :last_editors: HuangJianYi
-        """
-        try:
-            headers = {}
-            headers.update({'Content-Type': 'application/json'})
-            headers.update({'Accept': 'application/json'})
-            headers.update({'User-Agent': 'newfire doudian python sdk(https://github.com/minibear2021/doudian)'})
-            timestamp = SevenHelper.get_now_datetime()
-            param_json = json.dumps(params, sort_keys=True, separators=(',', ':'))
-            method = path[1:].replace('/', '.')
-            sign = self._sign(method=method, param_json=param_json, timestamp=timestamp)
-            if token_request:
-                url = self._gate_way + '{}?app_key={}&method={}&param_json={}&timestamp={}&v={}&sign_method={}&sign={}'.format(path, self._app_key, method, param_json, timestamp, self._version, self._sign_method, sign)
-            else:
-                access_token = self._access_token()
-                url = self._gate_way + '{}?app_key={}&method={}&access_token={}&param_json={}&timestamp={}&v={}&sign_method={}&sign={}'.format(path, self._app_key, method, access_token, param_json, timestamp, self._version, self._sign_method, sign)
-            if is_log == True:
-                if self.context:
-                    self.context.logging_link_info(f'Request url:{url},Request headers:{headers},Request params:{param_json}')
-                elif self.logging_link_info:
-                    self.logging_link_info(f'Request url:{url},Request headers:{headers},Request params:{param_json}')
-
-            response = requests.post(url=url, data=param_json, headers=headers, proxies=self._proxy)
-            if is_log == True:
-                if self.context:
-                    self.context.logging_link_info(f'Response status code: {response.status_code},Response headers:{response.headers},Response content:' + response.content.decode('UTF-8'))
-                elif self.logging_link_info:
-                    self.logging_link_info(f'Response status code: {response.status_code},Response headers:{response.headers},Response content:' + response.content.decode('UTF-8'))
-            if response.status_code != 200:
-                return None
-            return json.loads(response.content)
-        except Exception as e:
-            if self.context:
-                self.context.logging_link_error(traceback.format_exc())
-            elif self.logging_link_error:
-                self.logging_link_error(traceback.format_exc())
-            return None
-
-    def request(self, path: str, params: dict, is_log: bool = False) -> json:
-        """
-        :description: 请求抖店API接口
-        :param path: 调用的API接口地址，示例：'/material/uploadImageSync'
-        :param params: 业务参数字典，示例：{'folder_id':'70031975314169695161250','url':'http://www.demo.com/demo.jpg','material_name':'demo.jpg'}
-        :param is_log: 是否记录日志
-        :return 
-        :last_editors: HuangJianYi
-        """
-        return self._request(path=path, params=params, is_log=is_log)
-
-    def callback(self, headers: dict, body: bytes, is_log: bool = False) -> json:
-        """
-        :description: 验证处理消息推送服务收到信息Md5解密模式
-        :param headers: headers
-        :param body: body
-        :param is_log: 是否记录日志
-        :return 
-        :last_editors: HuangJianYi
-        """
-        data: str = body.decode('UTF-8')
-        if is_log == True:
-            if self.context:
-                self.context.logging_link_info(f'Callback Header:{headers},Callback Body:{body}')
-            elif self.logging_link_info:
-                self.logging_link_info(f'Callback Header:{headers},Callback Body:{body}')
-        if not data:
-            return None
-        if headers.get('app-id') != self._app_key:
-            return None
-        event_sign: str = headers.get('event-sign')
-        if not event_sign:
-            return None
-        h = Hash(algorithm=MD5(), backend=default_backend())
-        h.update('{}{}{}'.format(self._app_key, data, self._app_secret).encode('UTF-8'))
-        if h.finalize().hex() != event_sign:
-            return None
-        return json.loads(data)
-
-    def build_auth_url(self, service_id: str, state: str) -> str:
-        """拼接授权URL，引导商家点击完成授权
-        """
-        if self._app_type == "TOOL":
-            return 'https://fuwu.jinritemai.com/authorize?service_id={}&state={}'.format(service_id, state)
-        else:
-            return None
-
-
-class TokenError(Exception):
-    """access token无效
-    """
-    pass
-
-
-class CodeError(Exception):
-    """code无效
-    """
-    pass
-
-
-class ShopIdError(Exception):
-    """shop_id无效
-    """
-    pass
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2022-01-10 11:31:34
+@LastEditTime: 2022-01-13 18:12:21
+@LastEditors: HuangJianYi
+@Description: 抖店接口业务模型
+"""
+
+import json
+import time
+import requests
+from cryptography.hazmat.backends import default_backend
+from cryptography.hazmat.primitives.hashes import MD5, SHA256, Hash
+from cryptography.hazmat.primitives.hmac import HMAC
+from seven_cloudapp_frame.libs.customize.seven_helper import SevenHelper
+from seven_cloudapp_frame.models.seven_model import *
+from seven_framework.base_model import *
+
+
+class ShakeShopBaseModel():
+    """
+    :description: 抖店接口业务模型
+    """
+    def __init__(self, context, app_key: str, app_secret: str, app_type, code=None, shop_id: str = None, proxy: str = None, test_mode=False, logging_error=None, logging_info=None):
+        """
+        :description:  初始化实例，自用型应用传入shop_id用于初始化access token，工具型应用传入code换取access token（如初始化时未传入，可以在访问抖店API之前调用init_token(code)进行token的初始化。
+        :param context: 上下文
+        :param app_key: app_key
+        :param app_secret: app_secret
+        :param app_secret: app_secret
+        :param app_type: app_type(SELF或TOOL)
+        :param code: code
+        :param shop_id: 店铺ID
+        :param proxy: 代理
+        :param test_mode: 是否测试沙盒
+        :param logging_error: logging_error
+        :param logging_info: logging_info
+        :return 
+        :last_editors: HuangJianYi
+        """
+        self.context = context
+        self.logging_link_error = logging_error
+        self.logging_link_info = logging_info
+        self._app_key = app_key
+        self._app_secret = app_secret
+        self._app_type = app_type
+        if self._app_type == "SELF" and not shop_id:
+            raise ShopIdError('shop_id is not assigned.')
+        self._shop_id = shop_id
+        self._proxy = proxy
+        self._test_mode = test_mode
+        if self._test_mode:
+            self._gate_way = 'https://openapi-sandbox.jinritemai.com'
+        else:
+            self._gate_way = 'https://openapi-fxg.jinritemai.com'
+        self._version = 2
+        redis_token = SevenHelper.redis_init().get(f"shakeshop_access_token:{str(app_key)}_{self._test_mode}")
+        if redis_token:
+            redis_token = json.loads(redis_token)
+        self._token = redis_token
+        self._sign_method = 'hmac-sha256'
+        if self._token:
+            if self._token.get('expires_in') - int(time.time()) < 3000:
+                self._refresh_token()
+        else:
+            if self._app_type == "SELF":
+                self.init_token()
+            elif self._app_type == "TOOL" and code:
+                self.init_token(code)
+
+    def _sign(self, method: str, param_json: str, timestamp: str) -> str:
+        param_pattern = 'app_key{}method{}param_json{}timestamp{}v{}'.format(self._app_key, method, param_json, timestamp, self._version)
+        sign_pattern = '{}{}{}'.format(self._app_secret, param_pattern, self._app_secret)
+        return self._hash_hmac(sign_pattern)
+
+    def _hash_hmac(self, pattern: str) -> str:
+        try:
+            hmac = HMAC(key=self._app_secret.encode('UTF-8'), algorithm=SHA256(), backend=default_backend())
+            hmac.update(pattern.encode('UTF-8'))
+            signature = hmac.finalize()
+            return signature.hex()
+        except Exception as e:
+            if self.context:
+                self.context.logging_link_error(traceback.format_exc())
+            elif self.logging_link_error:
+                self.logging_link_error(traceback.format_exc())
+            return None
+
+    def _access_token(self) -> str:
+        """
+        :description: 获取access_token
+        :return 
+        :last_editors: HuangJianYi
+        """
+        if not self._token:
+            raise TokenError('no token info, call init_token() to initialize it.')
+        try:
+            if self._token.get('expires_in') - int(time.time()) < 3000:
+                self._refresh_token()
+            return self._token.get('access_token')
+        except Exception as e:
+            if self.context:
+                self.context.logging_link_error(traceback.format_exc())
+            elif self.logging_link_error:
+                self.logging_link_error(traceback.format_exc())
+            return None
+
+    def init_token(self, code: str = '') -> bool:
+        """
+        :description: 初始化access_token
+        :param code: 工具型应用从授权url回调中获取到的code，自用型应用无需传入。
+        :return 
+        :last_editors: HuangJianYi
+        """
+        request_redis_key = f"shakeshop_access_token:{str(self._app_key)}_{self._test_mode}"
+        if SevenHelper.is_continue_request(request_redis_key, 2000) == True:
+            return False
+        if self._app_type == "TOOL" and not code:
+            raise CodeError('code is not assigned.')
+        path = '/token/create'
+        grant_type = 'authorization_self' if self._app_type == "SELF" else 'authorization_code'
+        params = {}
+        params.update({'code': code if code else ''})
+        params.update({'grant_type': grant_type})
+        if self._app_type == "SELF":
+            if self._test_mode:
+                params.update({'test_shop': '1'})
+            elif self._shop_id:
+                params.update({'shop_id': self._shop_id})
+            else:
+                raise ShopIdError('shop_id is not assigned.')
+        result = self._request(path=path, params=params, token_request=True)
+        SevenHelper.redis_init().delete(request_redis_key)
+        if result and result.get('code') == 10000 and result.get('data'):
+            self._token = result.get('data')
+            self._token.update({'expires_in': int(time.time()) + result.get('data').get('expires_in')})
+            SevenHelper.redis_init().set(f"shakeshop_access_token:{str(self._app_key )}_{self._test_mode}", json.dumps(self._token), ex=3600)
+            return True
+        return False
+
+    def _get_refresh_token(self) -> str:
+        """
+        :description: 获取refresh_token
+        :return 
+        :last_editors: HuangJianYi
+        """
+        if not self._token:
+            return None
+        try:
+            return self._token.get('refresh_token')
+        except Exception as e:
+            if self.context:
+                self.context.logging_link_error(traceback.format_exc())
+            elif self.logging_link_error:
+                self.logging_link_error(traceback.format_exc())
+            return None
+
+    def _refresh_token(self) -> None:
+        """
+        :description: 刷新refresh_token
+        :return 
+        :last_editors: HuangJianYi
+        """
+        request_redis_key = f"shakeshop_access_token:{str(self._app_key)}_{self._test_mode}"
+        if SevenHelper.is_continue_request(request_redis_key, 2000) == True:
+            return False
+        path = '/token/refresh'
+        refresh_token = self._get_refresh_token()
+        grant_type = 'refresh_token'
+        params = {}
+        params.update({'grant_type': grant_type})
+        params.update({'refresh_token': refresh_token})
+        result = self._request(path=path, params=params, token_request=True)
+        SevenHelper.redis_init().delete(request_redis_key)
+        if result and result.get('err_no') == 0 and result.get('data'):
+            self._token = result.get('data')
+            self._token.update({'expires_in': int(time.time()) + result.get('data').get('expires_in')})
+            SevenHelper.redis_init().set(f"shakeshop_access_token:{str(self._app_key )}_{self._test_mode}", json.dumps(self._token), ex=3600)
+
+    def _request(self, path: str, params: dict, token_request: bool = False, is_log: bool = False) -> json:
+        """
+        :description: 发起请求
+        :param path: api地址
+        :param params: 参数集合
+        :param token_request: 是否token请求
+        :param is_log: 是否记录日志
+        :return 
+        :last_editors: HuangJianYi
+        """
+        try:
+            headers = {}
+            headers.update({'Content-Type': 'application/json'})
+            headers.update({'Accept': 'application/json'})
+            headers.update({'User-Agent': 'newfire doudian python sdk(https://github.com/minibear2021/doudian)'})
+            timestamp = SevenHelper.get_now_datetime()
+            param_json = json.dumps(params, sort_keys=True, separators=(',', ':'))
+            method = path[1:].replace('/', '.')
+            sign = self._sign(method=method, param_json=param_json, timestamp=timestamp)
+            if token_request:
+                url = self._gate_way + '{}?app_key={}&method={}&param_json={}&timestamp={}&v={}&sign_method={}&sign={}'.format(path, self._app_key, method, param_json, timestamp, self._version, self._sign_method, sign)
+            else:
+                access_token = self._access_token()
+                url = self._gate_way + '{}?app_key={}&method={}&access_token={}&param_json={}&timestamp={}&v={}&sign_method={}&sign={}'.format(path, self._app_key, method, access_token, param_json, timestamp, self._version, self._sign_method, sign)
+            if is_log == True:
+                if self.context:
+                    self.context.logging_link_info(f'Request url:{url},Request headers:{headers},Request params:{param_json}')
+                elif self.logging_link_info:
+                    self.logging_link_info(f'Request url:{url},Request headers:{headers},Request params:{param_json}')
+
+            response = requests.post(url=url, data=param_json, headers=headers, proxies=self._proxy)
+            if is_log == True:
+                if self.context:
+                    self.context.logging_link_info(f'Response status code: {response.status_code},Response headers:{response.headers},Response content:' + response.content.decode('UTF-8'))
+                elif self.logging_link_info:
+                    self.logging_link_info(f'Response status code: {response.status_code},Response headers:{response.headers},Response content:' + response.content.decode('UTF-8'))
+            if response.status_code != 200:
+                return None
+            return json.loads(response.content)
+        except Exception as e:
+            if self.context:
+                self.context.logging_link_error(traceback.format_exc())
+            elif self.logging_link_error:
+                self.logging_link_error(traceback.format_exc())
+            return None
+
+    def request(self, path: str, params: dict, is_log: bool = False) -> json:
+        """
+        :description: 请求抖店API接口
+        :param path: 调用的API接口地址，示例：'/material/uploadImageSync'
+        :param params: 业务参数字典，示例：{'folder_id':'70031975314169695161250','url':'http://www.demo.com/demo.jpg','material_name':'demo.jpg'}
+        :param is_log: 是否记录日志
+        :return 
+        :last_editors: HuangJianYi
+        """
+        return self._request(path=path, params=params, is_log=is_log)
+
+    def callback(self, headers: dict, body: bytes, is_log: bool = False) -> json:
+        """
+        :description: 验证处理消息推送服务收到信息Md5解密模式
+        :param headers: headers
+        :param body: body
+        :param is_log: 是否记录日志
+        :return 
+        :last_editors: HuangJianYi
+        """
+        data: str = body.decode('UTF-8')
+        if is_log == True:
+            if self.context:
+                self.context.logging_link_info(f'Callback Header:{headers},Callback Body:{body}')
+            elif self.logging_link_info:
+                self.logging_link_info(f'Callback Header:{headers},Callback Body:{body}')
+        if not data:
+            return None
+        if headers.get('app-id') != self._app_key:
+            return None
+        event_sign: str = headers.get('event-sign')
+        if not event_sign:
+            return None
+        h = Hash(algorithm=MD5(), backend=default_backend())
+        h.update('{}{}{}'.format(self._app_key, data, self._app_secret).encode('UTF-8'))
+        if h.finalize().hex() != event_sign:
+            return None
+        return json.loads(data)
+
+    def build_auth_url(self, service_id: str, state: str) -> str:
+        """拼接授权URL，引导商家点击完成授权
+        """
+        if self._app_type == "TOOL":
+            return 'https://fuwu.jinritemai.com/authorize?service_id={}&state={}'.format(service_id, state)
+        else:
+            return None
+
+
+class TokenError(Exception):
+    """access token无效
+    """
+    pass
+
+
+class CodeError(Exception):
+    """code无效
+    """
+    pass
+
+
+class ShopIdError(Exception):
+    """shop_id无效
+    """
+    pass
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/stat_base_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/stat_base_model.py`

 * *Ordering differences only*

 * *Files 17% similar despite different names*

```diff
@@ -1,469 +1,469 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-26 09:39:08
-@LastEditTime: 2023-06-12 18:48:29
-@LastEditors: HuangJianYi
-@Description: 
-"""
-from seven_cloudapp_frame.models.seven_model import *
-from seven_cloudapp_frame.libs.customize.seven_helper import *
-from seven_cloudapp_frame.libs.common import *
-from seven_cloudapp_frame.models.frame_base_model import FrameBaseModel
-from seven_cloudapp_frame.models.db_models.stat.stat_queue_model import *
-from seven_cloudapp_frame.models.db_models.stat.stat_report_model import *
-from seven_cloudapp_frame.models.db_models.stat.stat_orm_model import *
-
-class StatBaseModel(FrameBaseModel):
-    """
-    :description: 统计上报业务模型
-    """
-    def __init__(self, context=None,logging_error=None, logging_info=None, db_connect_key='db_cloudapp', redis_config_dict=None):
-        self.context = context
-        self.logging_link_error = logging_error
-        self.logging_link_info = logging_info
-        self.db_connect_key = db_connect_key
-        self.redis_config_dict = redis_config_dict
-        super(StatBaseModel,self).__init__(context)
-
-    def add_stat(self, app_id, act_id, module_id, user_id, open_id, key_name, key_value, object_id=''):
-        """
-        :description: 添加活动（模块）上报
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param module_id：活动模块标识
-        :param user_id：用户标识(比传)
-        :param open_id：open_id(可不传)
-        :param key_name：统计key
-        :param key_value：统计value
-        :param object_id：对象标识
-        :return:
-        :last_editors: HuangJianYi
-        """
-        stat_queue = StatQueue()
-        stat_queue.app_id = app_id
-        stat_queue.act_id = act_id
-        stat_queue.module_id = module_id
-        stat_queue.object_id = object_id
-        stat_queue.user_id = user_id
-        stat_queue.open_id = open_id
-        stat_queue.key_name = key_name
-        stat_queue.key_value = key_value
-        stat_queue.create_date = SevenHelper.get_now_datetime()
-        stat_queue.process_date = SevenHelper.get_now_datetime()
-
-        redis_init = SevenHelper.redis_init(config_dict=self.redis_config_dict)
-        stat_process_ways = share_config.get_value("stat_process_ways","redis")
-        if stat_process_ways == "mysql":
-            stat_queue_model = StatQueueModel(db_connect_key=self.db_connect_key,context=self.context)
-            stat_queue_model.add_entity(stat_queue)
-        else:
-            redis_init.rpush(f"stat_queue_list:{str(user_id % 10)}", SevenHelper.json_dumps(stat_queue))
-
-    def add_stat_list(self, app_id, act_id, module_id, user_id, open_id, stat_data, object_id=''):
-        """
-        :description: 添加活动（模块）上报
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param module_id：活动模块标识
-        :param user_id：用户标识(比传)
-        :param open_id：open_id(可不传)
-        :param stat_data:统计数据
-        :param object_id：对象标识
-        :return:
-        :last_editors: HuangJianYi
-        """
-        stat_process_ways = share_config.get_value("stat_process_ways","redis")
-        stat_queue_list = []
-        if isinstance(stat_data,list):
-            for item in stat_data:
-                stat_queue = StatQueue()
-                stat_queue.app_id = app_id
-                stat_queue.act_id = act_id
-                stat_queue.module_id = module_id
-                stat_queue.object_id = object_id
-                stat_queue.user_id = user_id
-                stat_queue.open_id = open_id
-                stat_queue.key_name = item["key"]
-                stat_queue.key_value = item["value"]
-                stat_queue.create_date = SevenHelper.get_now_datetime()
-                stat_queue.process_date = SevenHelper.get_now_datetime()
-                if stat_process_ways == "mysql":
-                    stat_queue_list.append(stat_queue)
-                else:
-                    stat_queue_list.append(SevenHelper.json_dumps(stat_queue))
-        else:
-            for key,value in stat_data.items():
-                stat_queue = StatQueue()
-                stat_queue.app_id = app_id
-                stat_queue.act_id = act_id
-                stat_queue.module_id = module_id
-                stat_queue.object_id = object_id
-                stat_queue.user_id = user_id
-                stat_queue.open_id = open_id
-                stat_queue.key_name = key
-                stat_queue.key_value = value
-                stat_queue.create_date = SevenHelper.get_now_datetime()
-                stat_queue.process_date = SevenHelper.get_now_datetime()
-                if stat_process_ways == "mysql":
-                    stat_queue_list.append(stat_queue)
-                else:
-                    stat_queue_list.append(SevenHelper.json_dumps(stat_queue))
-
-        if stat_process_ways == "mysql":
-            stat_queue_model = StatQueueModel(db_connect_key=self.db_connect_key,context=self.context)
-            return stat_queue_model.add_list(stat_queue_list)
-        else:
-            if len(stat_queue_list) > 0:
-                redis_init = SevenHelper.redis_init(config_dict=self.redis_config_dict)
-                redis_init.rpush(f"stat_queue_list:{str(user_id % 10)}", *stat_queue_list)
-
-    def get_stat_report_list(self, app_id, act_id, module_id, start_date, end_date, order_by="sort_index asc", is_only_module=False, orm_condition=None, orm_params=None, report_condition=None, report_params=None, object_id=''):
-        """
-        :description: 报表数据列表(表格)
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param module_id：活动模块标识
-        :param start_date：开始时间
-        :param end_date：结束时间
-        :param order_by：orm排序
-        :param is_only_module：是否只取module的数据
-        :param orm_condition：orm查询条件
-        :param orm_params：orm参数数组
-        :param report_condition：report查询条件
-        :param report_params：report参数数组
-        :param object_id：对象标识
-        :return list
-        :last_editors: HuangJianYi
-        """
-        if not report_condition:
-            report_condition = "app_id=%s and act_id=%s and module_id=%s and object_id=%s"
-        if not report_params:
-            report_params = [app_id, act_id, module_id, object_id]
-        if start_date != "":
-            report_condition += " and create_date>=%s"
-            report_params.append(start_date)
-        if end_date != "":
-            report_condition += " and create_date<%s"
-            report_params.append(end_date)
-        if is_only_module == True:
-            if not orm_condition:
-                orm_condition = "act_id=%s and module_id=%s and object_id=%s and is_show=1"
-            if not orm_params:
-                orm_params = [act_id, module_id, object_id]
-        else:
-            if not orm_condition:
-                orm_condition = "((act_id=%s and module_id=%s and object_id=%s) or (act_id=0 and module_id=0 and object_id='')) and is_show=1"
-            if not orm_params:
-                orm_params = [act_id, module_id, object_id]
-        stat_orm_list = StatOrmModel(db_connect_key=self.db_connect_key,context=self.context).get_list(where=orm_condition, group_by="key_name", order_by=order_by, params=orm_params)
-        if len(stat_orm_list)<=0:
-            return []
-        key_name_s = ','.join(["'%s'" % str(stat_orm.key_name) for stat_orm in stat_orm_list])
-        report_condition += f" and key_name in({key_name_s})"
-        stat_report_model = StatReportModel(db_connect_key=self.db_connect_key,context=self.context)
-        behavior_report_list = stat_report_model.get_dict_list(report_condition, group_by="key_name", field="key_name,SUM(key_value) AS key_value",params=report_params)
-        #公共映射组（未去重）
-        common_groups_1 = [orm.group_name for orm in stat_orm_list]
-        #公共映射组(去重)
-        common_groups = list(set(common_groups_1))
-        common_groups.sort(key=common_groups_1.index)
-
-        common_group_data_list = []
-
-        for common_group in common_groups:
-            group_data = {}
-            group_data["group_name"] = common_group
-            data_list = []
-
-            # 无子节点
-            orm_list = [orm for orm in stat_orm_list if orm.group_name == common_group and orm.group_sub_name == '']
-            for orm in orm_list:
-                data = {}
-                data["title"] = orm.key_value
-                data["tip_title"] = orm.tip_title
-                data["name"] = orm.key_name
-                data["value"] = 0
-                for behavior_report in behavior_report_list:
-                    if behavior_report["key_name"] == orm.key_name:
-                        if orm.value_type == 2:
-                            data["value"] = behavior_report["key_value"]
-                        else:
-                            data["value"] = int(behavior_report["key_value"])
-                data_list.append(data)
-            if len(data_list) > 0:
-                group_data["data_list"] = data_list
-
-            # 有子节点
-            orm_list_sub = [orm for orm in stat_orm_list if orm.group_name == common_group and orm.group_sub_name != '']
-            if orm_list_sub:
-                groups_sub_name = [orm.group_sub_name for orm in orm_list_sub]
-                #公共映射组(去重)
-                sub_names = list(set(groups_sub_name))
-                sub_names.sort(key=groups_sub_name.index)
-                sub_group_data_list = []
-                for sub_name in sub_names:
-                    sub_group_data = {}
-                    sub_group_data["group_name"] = sub_name
-                    sub_data_list = []
-
-                    # 无子节点
-                    orm_list_1 = [orm for orm in stat_orm_list if orm.group_sub_name == sub_name]
-                    for orm in orm_list_1:
-                        data = {}
-                        data["title"] = orm.key_value
-                        data["tip_title"] = orm.tip_title
-                        data["name"] = orm.key_name
-                        data["value"] = 0
-                        for behavior_report in behavior_report_list:
-                            if behavior_report["key_name"] == orm.key_name:
-                                if orm.value_type == 2:
-                                    data["value"] = behavior_report["key_value"]
-                                else:
-                                    data["value"] = int(behavior_report["key_value"])
-                        sub_data_list.append(data)
-                    sub_group_data["data_list"] = sub_data_list
-                    sub_group_data_list.append(sub_group_data)
-                group_data["sub_data_list"] = sub_group_data_list
-
-            common_group_data_list.append(group_data)
-
-        return common_group_data_list
-
-    def get_trend_report_list(self, app_id, act_id, module_id, start_date, end_date, order_by="sort_index asc", is_only_module=False, orm_condition=None, orm_params=None, report_condition=None, report_params=None, object_id=''):
-        """
-        :description: 报表数据列表(趋势图)
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param module_id：活动模块标识
-        :param start_date：开始时间
-        :param end_date：结束时间
-        :param order_by：orm排序
-        :param is_only_module：是否只取module的数据
-        :param orm_condition：orm查询条件
-        :param orm_params：orm参数数组
-        :param report_condition：report查询条件
-        :param report_params：report参数数组
-        :param object_id：对象标识
-        :return list
-        :last_editors: HuangJianYi
-        """
-        if not report_condition:
-            report_condition = "app_id=%s and act_id=%s and module_id=%s and object_id=%s"
-        if not report_params:
-            report_params = [app_id, act_id, module_id, object_id]
-        if start_date != "":
-            report_condition += " and create_date>=%s"
-            report_params.append(start_date)
-        if end_date != "":
-            report_condition += " and create_date<%s"
-            report_params.append(end_date)
-        if is_only_module == True:
-            if not orm_condition:
-                orm_condition = "act_id=%s and module_id=%s and object_id=%s and is_show=1"
-            if not orm_params:
-                orm_params = [act_id, module_id, object_id]
-        else:
-            if not orm_condition:
-                orm_condition = "((act_id=%s and module_id=%s and object_id=%s) or (act_id=0 and module_id=0 and object_id='')) and is_show=1"
-            if not orm_params:
-                orm_params = [act_id, module_id, object_id]
-        stat_orm_list = StatOrmModel(db_connect_key=self.db_connect_key,context=self.context).get_list(where=orm_condition, group_by="key_name", order_by=order_by, params=orm_params)
-        if len(stat_orm_list)<=0:
-            return []
-        key_name_s = ','.join(["'%s'" % str(stat_orm.key_name) for stat_orm in stat_orm_list])
-        report_condition += f" and key_name in({key_name_s})"
-        stat_report_model = StatReportModel(db_connect_key=self.db_connect_key,context=self.context)
-        stat_report_list = stat_report_model.get_dict_list(report_condition, field="key_name,key_value,DATE_FORMAT(create_date,'%%Y-%%m-%%d') AS create_date",params=report_params)
-        date_list = SevenHelper.get_date_list(start_date, end_date)
-        #公共映射组（未去重）
-        common_groups_1 = [orm.group_name for orm in stat_orm_list]
-        #公共映射组(去重)
-        common_groups = list(set(common_groups_1))
-        common_groups.sort(key=common_groups_1.index)
-
-        common_group_data_list = []
-
-        for common_group in common_groups:
-            group_data = {}
-            group_data["group_name"] = common_group
-            data_list = []
-
-            # 无子节点
-            orm_list = [orm for orm in stat_orm_list if orm.group_name == common_group and orm.group_sub_name == '']
-            for orm in orm_list:
-                data = {}
-                data["title"] = orm.key_value
-                data["name"] = orm.key_name
-                data["value"] = []
-                for date_day in date_list:
-                    behavior_date_report = {}
-                    for behavior_report in stat_report_list:
-                        if behavior_report["key_name"] == orm.key_name and behavior_report["create_date"] == date_day:
-                            if orm.value_type != 2:
-                                behavior_report["key_value"] = int(behavior_report["key_value"])
-                            behavior_date_report = {"title": orm.key_value, "date": date_day, "value": behavior_report["key_value"]}
-                            break
-                    if not behavior_date_report:
-                        behavior_date_report = {"title": orm.key_value, "date": date_day, "value": 0}
-                    data["value"].append(behavior_date_report)
-                data_list.append(data)
-            if len(data_list) > 0:
-                group_data["data_list"] = data_list
-
-            # 有子节点
-            orm_list_sub = [orm for orm in stat_orm_list if orm.group_name == common_group and orm.group_sub_name != '']
-            if orm_list_sub:
-                groups_sub_name = [orm.group_sub_name for orm in orm_list_sub]
-                #公共映射组(去重)
-                sub_names = list(set(groups_sub_name))
-                sub_names.sort(key=groups_sub_name.index)
-                sub_group_data_list = []
-                for sub_name in sub_names:
-                    sub_group_data = {}
-                    sub_group_data["group_name"] = sub_name
-                    sub_data_list = []
-
-                    # 无子节点
-                    orm_list_1 = [orm for orm in stat_orm_list if orm.group_sub_name == sub_name]
-                    for orm in orm_list_1:
-                        data = {}
-                        data["title"] = orm.key_value
-                        data["name"] = orm.key_name
-                        data["value"] = []
-                        for date_day in date_list:
-                            behavior_date_report = {}
-                            for behavior_report in stat_report_list:
-                                if behavior_report["key_name"] == orm.key_name and behavior_report["create_date"] == date_day:
-                                    if orm.value_type != 2:
-                                        behavior_report["key_value"] = int(behavior_report["key_value"])
-                                    behavior_date_report = {"title": orm.key_value, "date": date_day, "value": behavior_report["key_value"]}
-                                    break
-                            if not behavior_date_report:
-                                behavior_date_report = {"title": orm.key_value, "date": date_day, "value": 0}
-                            data["value"].append(behavior_date_report)
-                        sub_data_list.append(data)
-                    sub_group_data["data_list"] = sub_data_list
-                    sub_group_data_list.append(sub_group_data)
-                group_data["sub_data_list"] = sub_group_data_list
-
-            common_group_data_list.append(group_data)
-
-        return common_group_data_list
-
-    def process_invite_report(self, app_id, act_id, module_id, user_id, open_id, invite_user_id):
-        """
-        :description: 处理邀请进入上报
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_id:用户标识
-        :param open_id:open_id
-        :param invite_user_id:邀请人用户标识
-        :param handler_name:接口名称
-        :return 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        try:
-            if user_id == invite_user_id:
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "error"
-                invoke_result_data.error_message = "无效邀请"
-                return invoke_result_data
-            key_list_dict = {}
-            key_list_dict["AddBeInvitedUserCount"] = 1 #从分享进入新增用户数
-            key_list_dict["BeInvitedUserCount"] = 1  #从分享进入用户数
-            key_list_dict["BeInvitedCount"] = 1  #从分享进入次数
-            self.add_stat_list(app_id, act_id, module_id, user_id, open_id, key_list_dict)
-        except Exception as ex:
-            if self.context:
-                self.context.logging_link_error("【处理邀请上报】" + traceback.format_exc())
-            elif self.logging_link_error:
-                self.logging_link_error("【处理邀请上报】" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "exception"
-            invoke_result_data.error_message = "系统繁忙,请稍后再试"
-            return invoke_result_data
-
-        return invoke_result_data
-
-    def process_share_report(self, app_id, act_id, module_id, user_id, open_id):
-        """
-        :description: 处理分享上报
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_id:用户标识
-        :param open_id:open_id
-        :return 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        try:
-            key_list_dict = {}
-            key_list_dict["ShareUserCount"] = 1 #分享用户数
-            key_list_dict["ShareCount"] = 1 #分享次数
-            self.add_stat_list(app_id, act_id, module_id, user_id, open_id, key_list_dict)
-        except Exception as ex:
-            if self.context:
-                self.context.logging_link_error("【处理分享上报】" + traceback.format_exc())
-            elif self.logging_link_error:
-                self.logging_link_error("【处理分享上报】" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "exception"
-            invoke_result_data.error_message = "系统繁忙,请稍后再试"
-            return invoke_result_data
-
-        return invoke_result_data
-
-    def add_stat_user_list(self, app_id, act_id, module_id, user_id, open_id, stat_data, object_id=''):
-        """
-        :description: 添加用户行为上报
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param module_id：活动模块标识
-        :param user_id：用户标识
-        :param open_id：open_id
-        :param stat_data:统计数据
-        :param object_id：对象标识
-        :return:
-        :last_editors: HuangJianYi
-        """
-        stat_queue_list = []
-        if isinstance(stat_data,list):
-            for item in stat_data:
-                stat_queue = StatQueue()
-                stat_queue.app_id = app_id
-                stat_queue.act_id = act_id
-                stat_queue.module_id = module_id
-                stat_queue.object_id = object_id
-                stat_queue.user_id = user_id
-                stat_queue.open_id = open_id
-                stat_queue.key_name = item["key"]
-                stat_queue.key_value = item["value"]
-                if hasattr(self.context, "request_code"):
-                    stat_queue.request_code = self.context.request_code
-                stat_queue.create_date = SevenHelper.get_now_datetime()
-                stat_queue.process_date = SevenHelper.get_now_datetime()
-                stat_queue_list.append(SevenHelper.json_dumps(stat_queue))
-        else:
-            for key,value in stat_data.items():
-                stat_queue = StatQueue()
-                stat_queue.app_id = app_id
-                stat_queue.act_id = act_id
-                stat_queue.module_id = module_id
-                stat_queue.object_id = object_id
-                stat_queue.user_id = user_id
-                stat_queue.open_id = open_id
-                stat_queue.key_name = key
-                stat_queue.key_value = value
-                if hasattr(self.context, "request_code"):
-                    stat_queue.request_code = self.context.request_code
-                stat_queue.create_date = SevenHelper.get_now_datetime()
-                stat_queue.process_date = SevenHelper.get_now_datetime()
-                stat_queue_list.append(SevenHelper.json_dumps(stat_queue))
-
-        redis_init = SevenHelper.redis_init(config_dict=self.redis_config_dict)
-        for stat_queue in stat_queue_list:
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-26 09:39:08
+@LastEditTime: 2023-06-12 18:48:29
+@LastEditors: HuangJianYi
+@Description: 
+"""
+from seven_cloudapp_frame.models.seven_model import *
+from seven_cloudapp_frame.libs.customize.seven_helper import *
+from seven_cloudapp_frame.libs.common import *
+from seven_cloudapp_frame.models.frame_base_model import FrameBaseModel
+from seven_cloudapp_frame.models.db_models.stat.stat_queue_model import *
+from seven_cloudapp_frame.models.db_models.stat.stat_report_model import *
+from seven_cloudapp_frame.models.db_models.stat.stat_orm_model import *
+
+class StatBaseModel(FrameBaseModel):
+    """
+    :description: 统计上报业务模型
+    """
+    def __init__(self, context=None,logging_error=None, logging_info=None, db_connect_key='db_cloudapp', redis_config_dict=None):
+        self.context = context
+        self.logging_link_error = logging_error
+        self.logging_link_info = logging_info
+        self.db_connect_key = db_connect_key
+        self.redis_config_dict = redis_config_dict
+        super(StatBaseModel,self).__init__(context)
+
+    def add_stat(self, app_id, act_id, module_id, user_id, open_id, key_name, key_value, object_id=''):
+        """
+        :description: 添加活动（模块）上报
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param module_id：活动模块标识
+        :param user_id：用户标识(比传)
+        :param open_id：open_id(可不传)
+        :param key_name：统计key
+        :param key_value：统计value
+        :param object_id：对象标识
+        :return:
+        :last_editors: HuangJianYi
+        """
+        stat_queue = StatQueue()
+        stat_queue.app_id = app_id
+        stat_queue.act_id = act_id
+        stat_queue.module_id = module_id
+        stat_queue.object_id = object_id
+        stat_queue.user_id = user_id
+        stat_queue.open_id = open_id
+        stat_queue.key_name = key_name
+        stat_queue.key_value = key_value
+        stat_queue.create_date = SevenHelper.get_now_datetime()
+        stat_queue.process_date = SevenHelper.get_now_datetime()
+
+        redis_init = SevenHelper.redis_init(config_dict=self.redis_config_dict)
+        stat_process_ways = share_config.get_value("stat_process_ways","redis")
+        if stat_process_ways == "mysql":
+            stat_queue_model = StatQueueModel(db_connect_key=self.db_connect_key,context=self.context)
+            stat_queue_model.add_entity(stat_queue)
+        else:
+            redis_init.rpush(f"stat_queue_list:{str(user_id % 10)}", SevenHelper.json_dumps(stat_queue))
+
+    def add_stat_list(self, app_id, act_id, module_id, user_id, open_id, stat_data, object_id=''):
+        """
+        :description: 添加活动（模块）上报
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param module_id：活动模块标识
+        :param user_id：用户标识(比传)
+        :param open_id：open_id(可不传)
+        :param stat_data:统计数据
+        :param object_id：对象标识
+        :return:
+        :last_editors: HuangJianYi
+        """
+        stat_process_ways = share_config.get_value("stat_process_ways","redis")
+        stat_queue_list = []
+        if isinstance(stat_data,list):
+            for item in stat_data:
+                stat_queue = StatQueue()
+                stat_queue.app_id = app_id
+                stat_queue.act_id = act_id
+                stat_queue.module_id = module_id
+                stat_queue.object_id = object_id
+                stat_queue.user_id = user_id
+                stat_queue.open_id = open_id
+                stat_queue.key_name = item["key"]
+                stat_queue.key_value = item["value"]
+                stat_queue.create_date = SevenHelper.get_now_datetime()
+                stat_queue.process_date = SevenHelper.get_now_datetime()
+                if stat_process_ways == "mysql":
+                    stat_queue_list.append(stat_queue)
+                else:
+                    stat_queue_list.append(SevenHelper.json_dumps(stat_queue))
+        else:
+            for key,value in stat_data.items():
+                stat_queue = StatQueue()
+                stat_queue.app_id = app_id
+                stat_queue.act_id = act_id
+                stat_queue.module_id = module_id
+                stat_queue.object_id = object_id
+                stat_queue.user_id = user_id
+                stat_queue.open_id = open_id
+                stat_queue.key_name = key
+                stat_queue.key_value = value
+                stat_queue.create_date = SevenHelper.get_now_datetime()
+                stat_queue.process_date = SevenHelper.get_now_datetime()
+                if stat_process_ways == "mysql":
+                    stat_queue_list.append(stat_queue)
+                else:
+                    stat_queue_list.append(SevenHelper.json_dumps(stat_queue))
+
+        if stat_process_ways == "mysql":
+            stat_queue_model = StatQueueModel(db_connect_key=self.db_connect_key,context=self.context)
+            return stat_queue_model.add_list(stat_queue_list)
+        else:
+            if len(stat_queue_list) > 0:
+                redis_init = SevenHelper.redis_init(config_dict=self.redis_config_dict)
+                redis_init.rpush(f"stat_queue_list:{str(user_id % 10)}", *stat_queue_list)
+
+    def get_stat_report_list(self, app_id, act_id, module_id, start_date, end_date, order_by="sort_index asc", is_only_module=False, orm_condition=None, orm_params=None, report_condition=None, report_params=None, object_id=''):
+        """
+        :description: 报表数据列表(表格)
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param module_id：活动模块标识
+        :param start_date：开始时间
+        :param end_date：结束时间
+        :param order_by：orm排序
+        :param is_only_module：是否只取module的数据
+        :param orm_condition：orm查询条件
+        :param orm_params：orm参数数组
+        :param report_condition：report查询条件
+        :param report_params：report参数数组
+        :param object_id：对象标识
+        :return list
+        :last_editors: HuangJianYi
+        """
+        if not report_condition:
+            report_condition = "app_id=%s and act_id=%s and module_id=%s and object_id=%s"
+        if not report_params:
+            report_params = [app_id, act_id, module_id, object_id]
+        if start_date != "":
+            report_condition += " and create_date>=%s"
+            report_params.append(start_date)
+        if end_date != "":
+            report_condition += " and create_date<%s"
+            report_params.append(end_date)
+        if is_only_module == True:
+            if not orm_condition:
+                orm_condition = "act_id=%s and module_id=%s and object_id=%s and is_show=1"
+            if not orm_params:
+                orm_params = [act_id, module_id, object_id]
+        else:
+            if not orm_condition:
+                orm_condition = "((act_id=%s and module_id=%s and object_id=%s) or (act_id=0 and module_id=0 and object_id='')) and is_show=1"
+            if not orm_params:
+                orm_params = [act_id, module_id, object_id]
+        stat_orm_list = StatOrmModel(db_connect_key=self.db_connect_key,context=self.context).get_list(where=orm_condition, group_by="key_name", order_by=order_by, params=orm_params)
+        if len(stat_orm_list)<=0:
+            return []
+        key_name_s = ','.join(["'%s'" % str(stat_orm.key_name) for stat_orm in stat_orm_list])
+        report_condition += f" and key_name in({key_name_s})"
+        stat_report_model = StatReportModel(db_connect_key=self.db_connect_key,context=self.context)
+        behavior_report_list = stat_report_model.get_dict_list(report_condition, group_by="key_name", field="key_name,SUM(key_value) AS key_value",params=report_params)
+        #公共映射组（未去重）
+        common_groups_1 = [orm.group_name for orm in stat_orm_list]
+        #公共映射组(去重)
+        common_groups = list(set(common_groups_1))
+        common_groups.sort(key=common_groups_1.index)
+
+        common_group_data_list = []
+
+        for common_group in common_groups:
+            group_data = {}
+            group_data["group_name"] = common_group
+            data_list = []
+
+            # 无子节点
+            orm_list = [orm for orm in stat_orm_list if orm.group_name == common_group and orm.group_sub_name == '']
+            for orm in orm_list:
+                data = {}
+                data["title"] = orm.key_value
+                data["tip_title"] = orm.tip_title
+                data["name"] = orm.key_name
+                data["value"] = 0
+                for behavior_report in behavior_report_list:
+                    if behavior_report["key_name"] == orm.key_name:
+                        if orm.value_type == 2:
+                            data["value"] = behavior_report["key_value"]
+                        else:
+                            data["value"] = int(behavior_report["key_value"])
+                data_list.append(data)
+            if len(data_list) > 0:
+                group_data["data_list"] = data_list
+
+            # 有子节点
+            orm_list_sub = [orm for orm in stat_orm_list if orm.group_name == common_group and orm.group_sub_name != '']
+            if orm_list_sub:
+                groups_sub_name = [orm.group_sub_name for orm in orm_list_sub]
+                #公共映射组(去重)
+                sub_names = list(set(groups_sub_name))
+                sub_names.sort(key=groups_sub_name.index)
+                sub_group_data_list = []
+                for sub_name in sub_names:
+                    sub_group_data = {}
+                    sub_group_data["group_name"] = sub_name
+                    sub_data_list = []
+
+                    # 无子节点
+                    orm_list_1 = [orm for orm in stat_orm_list if orm.group_sub_name == sub_name]
+                    for orm in orm_list_1:
+                        data = {}
+                        data["title"] = orm.key_value
+                        data["tip_title"] = orm.tip_title
+                        data["name"] = orm.key_name
+                        data["value"] = 0
+                        for behavior_report in behavior_report_list:
+                            if behavior_report["key_name"] == orm.key_name:
+                                if orm.value_type == 2:
+                                    data["value"] = behavior_report["key_value"]
+                                else:
+                                    data["value"] = int(behavior_report["key_value"])
+                        sub_data_list.append(data)
+                    sub_group_data["data_list"] = sub_data_list
+                    sub_group_data_list.append(sub_group_data)
+                group_data["sub_data_list"] = sub_group_data_list
+
+            common_group_data_list.append(group_data)
+
+        return common_group_data_list
+
+    def get_trend_report_list(self, app_id, act_id, module_id, start_date, end_date, order_by="sort_index asc", is_only_module=False, orm_condition=None, orm_params=None, report_condition=None, report_params=None, object_id=''):
+        """
+        :description: 报表数据列表(趋势图)
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param module_id：活动模块标识
+        :param start_date：开始时间
+        :param end_date：结束时间
+        :param order_by：orm排序
+        :param is_only_module：是否只取module的数据
+        :param orm_condition：orm查询条件
+        :param orm_params：orm参数数组
+        :param report_condition：report查询条件
+        :param report_params：report参数数组
+        :param object_id：对象标识
+        :return list
+        :last_editors: HuangJianYi
+        """
+        if not report_condition:
+            report_condition = "app_id=%s and act_id=%s and module_id=%s and object_id=%s"
+        if not report_params:
+            report_params = [app_id, act_id, module_id, object_id]
+        if start_date != "":
+            report_condition += " and create_date>=%s"
+            report_params.append(start_date)
+        if end_date != "":
+            report_condition += " and create_date<%s"
+            report_params.append(end_date)
+        if is_only_module == True:
+            if not orm_condition:
+                orm_condition = "act_id=%s and module_id=%s and object_id=%s and is_show=1"
+            if not orm_params:
+                orm_params = [act_id, module_id, object_id]
+        else:
+            if not orm_condition:
+                orm_condition = "((act_id=%s and module_id=%s and object_id=%s) or (act_id=0 and module_id=0 and object_id='')) and is_show=1"
+            if not orm_params:
+                orm_params = [act_id, module_id, object_id]
+        stat_orm_list = StatOrmModel(db_connect_key=self.db_connect_key,context=self.context).get_list(where=orm_condition, group_by="key_name", order_by=order_by, params=orm_params)
+        if len(stat_orm_list)<=0:
+            return []
+        key_name_s = ','.join(["'%s'" % str(stat_orm.key_name) for stat_orm in stat_orm_list])
+        report_condition += f" and key_name in({key_name_s})"
+        stat_report_model = StatReportModel(db_connect_key=self.db_connect_key,context=self.context)
+        stat_report_list = stat_report_model.get_dict_list(report_condition, field="key_name,key_value,DATE_FORMAT(create_date,'%%Y-%%m-%%d') AS create_date",params=report_params)
+        date_list = SevenHelper.get_date_list(start_date, end_date)
+        #公共映射组（未去重）
+        common_groups_1 = [orm.group_name for orm in stat_orm_list]
+        #公共映射组(去重)
+        common_groups = list(set(common_groups_1))
+        common_groups.sort(key=common_groups_1.index)
+
+        common_group_data_list = []
+
+        for common_group in common_groups:
+            group_data = {}
+            group_data["group_name"] = common_group
+            data_list = []
+
+            # 无子节点
+            orm_list = [orm for orm in stat_orm_list if orm.group_name == common_group and orm.group_sub_name == '']
+            for orm in orm_list:
+                data = {}
+                data["title"] = orm.key_value
+                data["name"] = orm.key_name
+                data["value"] = []
+                for date_day in date_list:
+                    behavior_date_report = {}
+                    for behavior_report in stat_report_list:
+                        if behavior_report["key_name"] == orm.key_name and behavior_report["create_date"] == date_day:
+                            if orm.value_type != 2:
+                                behavior_report["key_value"] = int(behavior_report["key_value"])
+                            behavior_date_report = {"title": orm.key_value, "date": date_day, "value": behavior_report["key_value"]}
+                            break
+                    if not behavior_date_report:
+                        behavior_date_report = {"title": orm.key_value, "date": date_day, "value": 0}
+                    data["value"].append(behavior_date_report)
+                data_list.append(data)
+            if len(data_list) > 0:
+                group_data["data_list"] = data_list
+
+            # 有子节点
+            orm_list_sub = [orm for orm in stat_orm_list if orm.group_name == common_group and orm.group_sub_name != '']
+            if orm_list_sub:
+                groups_sub_name = [orm.group_sub_name for orm in orm_list_sub]
+                #公共映射组(去重)
+                sub_names = list(set(groups_sub_name))
+                sub_names.sort(key=groups_sub_name.index)
+                sub_group_data_list = []
+                for sub_name in sub_names:
+                    sub_group_data = {}
+                    sub_group_data["group_name"] = sub_name
+                    sub_data_list = []
+
+                    # 无子节点
+                    orm_list_1 = [orm for orm in stat_orm_list if orm.group_sub_name == sub_name]
+                    for orm in orm_list_1:
+                        data = {}
+                        data["title"] = orm.key_value
+                        data["name"] = orm.key_name
+                        data["value"] = []
+                        for date_day in date_list:
+                            behavior_date_report = {}
+                            for behavior_report in stat_report_list:
+                                if behavior_report["key_name"] == orm.key_name and behavior_report["create_date"] == date_day:
+                                    if orm.value_type != 2:
+                                        behavior_report["key_value"] = int(behavior_report["key_value"])
+                                    behavior_date_report = {"title": orm.key_value, "date": date_day, "value": behavior_report["key_value"]}
+                                    break
+                            if not behavior_date_report:
+                                behavior_date_report = {"title": orm.key_value, "date": date_day, "value": 0}
+                            data["value"].append(behavior_date_report)
+                        sub_data_list.append(data)
+                    sub_group_data["data_list"] = sub_data_list
+                    sub_group_data_list.append(sub_group_data)
+                group_data["sub_data_list"] = sub_group_data_list
+
+            common_group_data_list.append(group_data)
+
+        return common_group_data_list
+
+    def process_invite_report(self, app_id, act_id, module_id, user_id, open_id, invite_user_id):
+        """
+        :description: 处理邀请进入上报
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param user_id:用户标识
+        :param open_id:open_id
+        :param invite_user_id:邀请人用户标识
+        :param handler_name:接口名称
+        :return 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        try:
+            if user_id == invite_user_id:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "error"
+                invoke_result_data.error_message = "无效邀请"
+                return invoke_result_data
+            key_list_dict = {}
+            key_list_dict["AddBeInvitedUserCount"] = 1 #从分享进入新增用户数
+            key_list_dict["BeInvitedUserCount"] = 1  #从分享进入用户数
+            key_list_dict["BeInvitedCount"] = 1  #从分享进入次数
+            self.add_stat_list(app_id, act_id, module_id, user_id, open_id, key_list_dict)
+        except Exception as ex:
+            if self.context:
+                self.context.logging_link_error("【处理邀请上报】" + traceback.format_exc())
+            elif self.logging_link_error:
+                self.logging_link_error("【处理邀请上报】" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "exception"
+            invoke_result_data.error_message = "系统繁忙,请稍后再试"
+            return invoke_result_data
+
+        return invoke_result_data
+
+    def process_share_report(self, app_id, act_id, module_id, user_id, open_id):
+        """
+        :description: 处理分享上报
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param user_id:用户标识
+        :param open_id:open_id
+        :return 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        try:
+            key_list_dict = {}
+            key_list_dict["ShareUserCount"] = 1 #分享用户数
+            key_list_dict["ShareCount"] = 1 #分享次数
+            self.add_stat_list(app_id, act_id, module_id, user_id, open_id, key_list_dict)
+        except Exception as ex:
+            if self.context:
+                self.context.logging_link_error("【处理分享上报】" + traceback.format_exc())
+            elif self.logging_link_error:
+                self.logging_link_error("【处理分享上报】" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "exception"
+            invoke_result_data.error_message = "系统繁忙,请稍后再试"
+            return invoke_result_data
+
+        return invoke_result_data
+
+    def add_stat_user_list(self, app_id, act_id, module_id, user_id, open_id, stat_data, object_id=''):
+        """
+        :description: 添加用户行为上报
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param module_id：活动模块标识
+        :param user_id：用户标识
+        :param open_id：open_id
+        :param stat_data:统计数据
+        :param object_id：对象标识
+        :return:
+        :last_editors: HuangJianYi
+        """
+        stat_queue_list = []
+        if isinstance(stat_data,list):
+            for item in stat_data:
+                stat_queue = StatQueue()
+                stat_queue.app_id = app_id
+                stat_queue.act_id = act_id
+                stat_queue.module_id = module_id
+                stat_queue.object_id = object_id
+                stat_queue.user_id = user_id
+                stat_queue.open_id = open_id
+                stat_queue.key_name = item["key"]
+                stat_queue.key_value = item["value"]
+                if hasattr(self.context, "request_code"):
+                    stat_queue.request_code = self.context.request_code
+                stat_queue.create_date = SevenHelper.get_now_datetime()
+                stat_queue.process_date = SevenHelper.get_now_datetime()
+                stat_queue_list.append(SevenHelper.json_dumps(stat_queue))
+        else:
+            for key,value in stat_data.items():
+                stat_queue = StatQueue()
+                stat_queue.app_id = app_id
+                stat_queue.act_id = act_id
+                stat_queue.module_id = module_id
+                stat_queue.object_id = object_id
+                stat_queue.user_id = user_id
+                stat_queue.open_id = open_id
+                stat_queue.key_name = key
+                stat_queue.key_value = value
+                if hasattr(self.context, "request_code"):
+                    stat_queue.request_code = self.context.request_code
+                stat_queue.create_date = SevenHelper.get_now_datetime()
+                stat_queue.process_date = SevenHelper.get_now_datetime()
+                stat_queue_list.append(SevenHelper.json_dumps(stat_queue))
+
+        redis_init = SevenHelper.redis_init(config_dict=self.redis_config_dict)
+        for stat_queue in stat_queue_list:
             redis_init.rpush(f"stat_user_queue_list:{str(user_id % 10)}", *stat_queue_list)
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/task_base_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/task_base_model.py`

 * *Ordering differences only*

 * *Files 15% similar despite different names*

```diff
@@ -1,3903 +1,3903 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-08-10 10:41:13
-@LastEditTime: 2023-07-21 16:10:01
-@LastEditors: HuangJianYi
-@Description: 
-"""
-from asq.initiators import query
-from seven_cloudapp_frame.models.enum import *
-from seven_cloudapp_frame.models.top_base_model import *
-from seven_cloudapp_frame.models.frame_base_model import FrameBaseModel
-from seven_cloudapp_frame.models.asset_base_model import *
-from seven_cloudapp_frame.models.stat_base_model import *
-from seven_cloudapp_frame.models.user_base_model import *
-from seven_cloudapp_frame.models.app_base_model import *
-from seven_cloudapp_frame.models.order_base_model import *
-from seven_cloudapp_frame.models.db_models.user.user_info_model import *
-from seven_cloudapp_frame.models.db_models.task.task_info_model import *
-from seven_cloudapp_frame.models.db_models.task.task_count_model import *
-from seven_cloudapp_frame.models.db_models.invite.invite_log_model import *
-from seven_cloudapp_frame.models.db_models.invite.invite_help_model import *
-from seven_cloudapp_frame.models.db_models.collect.collect_log_model import *
-from seven_cloudapp_frame.models.db_models.browse.browse_log_model import *
-from seven_cloudapp_frame.models.db_models.task.task_gear_count_model import *
-from seven_cloudapp_frame.models.db_models.task.task_log_model import *
-
-
-
-class TaskBaseModel(FrameBaseModel):
-    """
-    :description: 任务业务模型
-    """
-    def __init__(self, context=None,logging_error=None, logging_info=None):
-        self.context = context
-        self.logging_link_error = logging_error
-        self.logging_link_info = logging_info
-        super(TaskBaseModel,self).__init__(context)
-
-    def _delete_task_info_dependency_key(self, act_id, task_id=0, delay_delete_time=0.01):
-        """
-        :description: 删除任务依赖建
-        :param act_id: 活动标识
-        :param task_id: 任务标识
-        :param delay_delete_time: 延迟删除时间，传0则不进行延迟
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        dependency_key_list = []
-        if task_id:
-            dependency_key_list.append(DependencyKey.task_info(task_id))
-        if act_id:
-            dependency_key_list.append(DependencyKey.task_info_list(act_id))
-        TaskInfoModel().delete_dependency_key(dependency_key_list,delay_delete_time)
-
-    def get_task_info_dict_list(self,app_id,act_id,module_id,is_release,is_cache=True):
-        """
-        :description: 获取任务列表
-        :param app_id: 应用标识
-        :param act_id: 活动标识
-        :param module_id: 活动模块标识
-        :param is_release: 是否发布
-        :param is_cache: 是否缓存
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        order_by = "sort_index desc,id asc"
-        condition = "act_id=%s"
-        params = [act_id]
-        if is_release !=-1:
-            condition += " and is_release=%s"
-            params.append(is_release)
-        if module_id !=-1:
-            condition += " and module_id=%s"
-            params.append(module_id)
-        if app_id:
-            condition += " and app_id=%s"
-            params.append(app_id)
-
-        task_info_model = TaskInfoModel(context=self.context)
-        if is_cache:
-            dict_list = task_info_model.get_cache_dict_list(condition, group_by="", order_by=order_by, params=params,dependency_key=DependencyKey.task_info_list(act_id))
-        else:
-            dict_list = task_info_model.get_dict_list(condition, group_by="", order_by=order_by, params=params)
-        for task_info in dict_list:
-            task_info["config_json"] = SevenHelper.json_loads(task_info["config_json"]) if task_info["config_json"] else {}
-        return dict_list
-
-    def get_task_info_dict(self,task_id,is_cache=True,is_filter=True):
-        """
-        :description: 获取任务信息
-        :param task_id: 任务标识
-        :param is_cache: 是否缓存
-        :param is_filter: 是否过滤未发布的数据
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        task_info_model = TaskInfoModel(context=self.context)
-        task_info_dict = None
-        if is_cache:
-            task_info_dict = task_info_model.get_cache_dict_by_id(task_id,dependency_key=DependencyKey.task_info(task_id))
-        else:
-            task_info_dict = task_info_model.get_dict_by_id(task_id)
-        if is_filter == True:
-            if not task_info_dict or task_info_dict["is_release"] == 0:
-                return None
-        return task_info_dict
-
-    def get_task_asset_type(self, task_asset_type_json, task_type):
-        """
-        :description: 获取任务奖励资产类型 (先取配置文件的值没有用默认值，如果数据库有配置则使用数据库的值)
-        :param task_asset_type:任务资产类型配置  key:1次数2积分3价格档位4店铺会员积分9999其他（混合搭配）
-        :param task_type:任务类型
-        :return 任务奖励资产类型
-        :last_editors: HuangJianYi
-        """
-        asset_type = int(share_config.get_value("task_asset_type",2))
-        if task_asset_type_json == "":
-            return asset_type
-        task_asset_type_dict = SevenHelper.json_loads(task_asset_type_json)
-        if not task_asset_type_dict:
-            return asset_type
-        if int(task_asset_type_dict["key"]) != 9999:
-            asset_type = int(task_asset_type_dict["key"])
-            return asset_type
-        value_dict = task_asset_type_dict["value"]
-        if not value_dict:
-            return asset_type
-        if str(task_type) in value_dict.keys():
-            asset_type = value_dict[str(task_type)]
-        return asset_type
-
-    def get_business_map_frame_task_type(self,task_type):
-        """
-        :description: 映射任务类型，如果配置文件有配置相应的任务类型key，则会替换key对应枚举中的值，使用场景：用于在把业务写的方法整合到框架的时候，任务类型不一致的情况，业务可以使用原本定义的任务类型调用框架里的方法
-        :param task_type:任务类型值
-        :return 最终的任务类型值
-        :last_editors: HuangJianYi
-        """
-        key = ""
-        try:
-            key = TaskType(task_type).name
-        except ValueError:
-            pass
-        task_type_dict = share_config.get_value("business_map_frame_task_type",{})
-        if key and str(key) in task_type_dict.keys():
-            task_type = int(task_type_dict[str(key)])
-        return task_type
-
-    def _get_task_count_id_md5(self,act_id,module_id,task_type,task_sub_type,user_id):
-        """
-        :description: 获取任务计数标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param task_type:任务类型
-        :param task_sub_type:任务子类型
-        :param user_id:用户标识
-        :return 获取任务计数标识
-        :last_editors: HuangJianYi
-        """
-        if not act_id or not task_type or not user_id:
-            return 0
-        return CryptoHelper.md5_encrypt_int(f"{act_id}_{module_id}_{task_type}_{task_sub_type}_{user_id}")
-
-    def check_task_info(self,act_id,module_id,task_type=0,task_id=0):
-        """
-        :description: 校验任务信息
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param task_type:任务类型
-        :param task_id:任务标识
-        :return 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        try:
-            task_info_model = TaskInfoModel(context=self.context)
-            if task_id>0:
-                task_info_dict = self.get_task_info_dict(task_id)
-            else:
-                task_info_dict = task_info_model.get_cache_dict("act_id=%s and is_release=1 and task_type=%s and module_id=%s",limit="1",params=[act_id,task_type,module_id],dependency_key=f"task_info_list:actid_{act_id}")
-            if not task_info_dict or task_info_dict["is_release"] == 0:
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "error"
-                invoke_result_data.error_message = "任务信息不存在"
-                return invoke_result_data
-            config_json = SevenHelper.json_loads(task_info_dict["config_json"])
-            if not config_json:
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "error"
-                invoke_result_data.error_message = "任务信息配置不存在"
-                return invoke_result_data
-            task_info_dict["config_json"] = config_json
-            invoke_result_data.data = task_info_dict
-        except Exception as ex:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "exception"
-            invoke_result_data.error_message = "任务信息不存在"
-            return invoke_result_data
-        return invoke_result_data
-
-    def get_only_id(self,user_id,complete_type,task_type,task_sub_type="",complete_count=1):
-        """
-        :description: 获取only_id
-        :param user_id:用户标识
-        :param complete_type:完成类型(1每日任务2每周任务3持久任务)
-        :param task_type:任务类型
-        :param task_sub_type:任务子类型
-        :param complete_count:完成次数
-        :return only_id
-        :last_editors: HuangJianYi
-        """
-        only_id = f"task_{user_id}_{task_type}_{task_sub_type}"
-        if complete_type == 1:
-            only_id += f"_{TimeExHelper.get_now_day_int()}"
-        elif complete_type == 2:
-            only_id += f"_{str(datetime.datetime.now().year)+str(datetime.datetime.now().isocalendar()[1])}"
-        else:
-            only_id += f"_0"
-        only_id += f"_{complete_count}"
-        return only_id
-
-    def add_task_stat(self, task_type, app_id, act_id, module_id, user_id, open_id, reward_value, is_stat=True, complete_count=1):
-        """
-        :description: 添加任务统计
-        :param task_type:任务类型
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:模块标识
-        :param user_id:用户标识
-        :param open_id:open_id
-        :param open_id:open_id
-        :param reward_value:奖励值
-        :param is_stat:是否统计
-        :param complete_count:完成次数
-        :last_editors: HuangJianYi
-        """
-        if is_stat == True:
-            stat_base_model = StatBaseModel(context=self.context)
-            key_list_dict = {}
-            if task_type == int(TaskType.collect_goods.value):
-                key_list_dict["CollectUserCount"] = 1 #完成人数
-                key_list_dict["CollectCount"] = complete_count #完成次数
-                key_list_dict["CollectRewardCount"] = reward_value #奖励值
-            elif task_type == int(TaskType.browse_goods.value):
-                key_list_dict["BrowseUserCount"] = 1 #完成人数
-                key_list_dict["BrowseCount"] = complete_count #完成次数
-                key_list_dict["BrowseRewardCount"] = reward_value #奖励值
-            elif task_type == int(TaskType.invite_new_user.value):
-                key_list_dict["InviteUserCount"] = 1 #完成人数
-                key_list_dict["InviteCount"] = complete_count #完成次数
-                key_list_dict["InviteRewardCount"] = reward_value #奖励值
-            elif task_type == int(TaskType.invite_join_member.value):
-                key_list_dict["InviteJoinMemberUserCount"] = 1 #完成人数
-                key_list_dict["InviteJoinMemberCount"] = complete_count #完成次数
-                key_list_dict["InviteJoinMemberRewardCount"] = reward_value #奖励值
-            elif task_type == int(TaskType.invite_user_help.value):
-                key_list_dict["InviteHelpUserCount"] = 1 #完成人数
-                key_list_dict["InviteHelpCount"] = complete_count #完成次数
-                key_list_dict["InviteHelpRewardCount"] = reward_value #奖励值
-            elif task_type == int(TaskType.browse_store.value):
-                key_list_dict["BrowseStoreUserCount"] = 1 #完成人数
-                key_list_dict["BrowseStoreCount"] = complete_count #完成次数
-                key_list_dict["BrowseStoreRewardCount"] = reward_value #奖励值
-            elif task_type == int(TaskType.browse_live_room.value):
-                key_list_dict["BrowseLiveRoomUserCount"] = 1 #完成人数
-                key_list_dict["BrowseLiveRoomCount"] = complete_count #完成次数
-                key_list_dict["BrowseLiveRoomRewardCount"] = reward_value #奖励值
-            elif task_type == int(TaskType.browse_special_topic.value):
-                key_list_dict["BrowseSpecialTopicUserCount"] = 1 #完成人数
-                key_list_dict["BrowseSpecialTopicCount"] = complete_count #完成次数
-                key_list_dict["BrowseSpecialTopicRewardCount"] = reward_value #奖励值
-            elif task_type == int(TaskType.share.value):
-                key_list_dict["TaskShareUserCount"] = 1 #完成人数
-                key_list_dict["TaskShareCount"] = complete_count #完成次数
-                key_list_dict["TaskShareRewardCount"] = reward_value #奖励值
-            elif task_type == int(TaskType.free_gift.value):
-                key_list_dict["FreeGiftUserCount"] = 1 #完成人数
-                key_list_dict["FreeGiftCount"] = complete_count #完成次数
-                key_list_dict["FreeGiftRewardCount"] = reward_value #完成奖励值
-            elif task_type == int(TaskType.one_sign.value):
-                key_list_dict["OneSignUserCount"] = 1 #完成人数
-                key_list_dict["OneSignCount"] = complete_count #完成次数
-                key_list_dict["OneSignRewardCount"] = reward_value #奖励值
-            elif task_type == int(TaskType.weekly_sign.value):
-                key_list_dict["WeeklySignUserCount"] = 1 #完成人数
-                key_list_dict["WeeklySignCount"] = complete_count #完成次数
-                key_list_dict["WeeklySignRewardCount"] = reward_value #奖励值
-            elif task_type == int(TaskType.cumulative_sign.value):
-                key_list_dict["CumulativeSignUserCount"] = 1 #完成人数
-                key_list_dict["CumulativeSignCount"] = complete_count #完成次数
-                key_list_dict["CumulativeSignRewardCount"] = reward_value #奖励值
-            elif task_type == int(TaskType.successive_sign.value):
-                key_list_dict["SuccessiveSignUserCount"] = 1 #完成人数
-                key_list_dict["SuccessiveSignCount"] = complete_count #完成次数
-                key_list_dict["SuccessiveSignRewardCount"] = reward_value #奖励值
-            elif task_type == int(TaskType.favor_store.value):
-                key_list_dict["FollowUserCount"] = 1 #完成人数
-                key_list_dict["FollowCount"] = complete_count #完成次数
-                key_list_dict["FollowRewardCount"] = reward_value #奖励值
-            elif task_type == int(TaskType.join_member.value):
-                key_list_dict["MemberUserCount"] = 1 #加入会员完成人数
-                key_list_dict["MemberCount"] = complete_count #加入会员完成次数
-                key_list_dict["MemberRewardCount"] = reward_value #奖励值
-            elif task_type == int(TaskType.secret_code.value):
-                key_list_dict["SecretCodeUserCount"] = 1 #完成人数
-                key_list_dict["SecretCodeCount"] = complete_count #完成次数
-                key_list_dict["SecretCodeRewardCount"] = reward_value #奖励值
-            elif task_type == int(TaskType.crm_point_exchange_asset.value):
-                key_list_dict["CrmPointExchangeAssetUserCount"] = 1 #完成人数
-                key_list_dict["CrmPointExchangeAssetCount"] = complete_count #完成次数
-                key_list_dict["CrmPointExchangeAssetRewardCount"] = reward_value #奖励值
-            elif task_type == int(TaskType.buy_appoint_goods.value):
-                key_list_dict["BuyAppointGoodsUserCount"] = 1   #完成人数
-                key_list_dict["BuyAppointGoodsCount"] = complete_count #完成次数
-                key_list_dict["BuyAppointGoodsRewardCount"] = reward_value #奖励值
-            elif task_type == int(TaskType.buy_appoint_goods_price.value):
-                key_list_dict["BuyAppointGoodsPriceUserCount"] = 1   #完成人数
-                key_list_dict["BuyAppointGoodsPriceCount"] = complete_count #完成次数
-                key_list_dict["BuyAppointGoodsPriceRewardCount"] = reward_value #奖励值
-            elif task_type == int(TaskType.buy_appoint_goods_price_gear.value):
-                key_list_dict["BuyAppointGoodsPriceGearUserCount"] = 1   #完成人数
-                key_list_dict["BuyAppointGoodsPriceGearCount"] = complete_count #完成次数
-                key_list_dict["BuyAppointGoodsPriceGearRewardCount"] = reward_value #奖励值
-            elif task_type == int(TaskType.buy_store_price.value):
-                key_list_dict["BuyStorePriceUserCount"] = 1   #完成人数
-                key_list_dict["BuyStorePriceCount"] = complete_count  #完成次数
-                key_list_dict["BuyStorePriceRewardCount"] = reward_value  #奖励值
-            elif task_type == int(TaskType.buy_store_price_gear.value):
-                key_list_dict["BuyStorePriceGearUserCount"] = 1   #完成人数
-                key_list_dict["BuyStorePriceGearCount"] = complete_count #完成次数
-                key_list_dict["BuyStorePriceGearRewardCount"] = reward_value #奖励值
-            elif task_type == int(TaskType.lottery.value):
-                key_list_dict["LotteryTaskUserCount"] = 1   #完成人数
-                key_list_dict["LotteryTaskCount"] = complete_count #完成次数
-                key_list_dict["LotteryTaskRewardCount"] = reward_value #奖励值
-            elif task_type == int(TaskType.lottery_try.value):
-                key_list_dict["TryLotteryTaskUserCount"] = 1   #完成人数
-                key_list_dict["TryLotteryTaskCount"] = complete_count  #完成次数
-                key_list_dict["TryLotteryTaskRewardCount"] = reward_value #奖励值
-            elif task_type == int(TaskType.lottery_gear.value):
-                key_list_dict["LotteryGearTaskUserCount"] = 1   #完成人数
-                key_list_dict["LotteryGearTaskCount"] = complete_count #完成次数
-                key_list_dict["LotteryGearTaskRewardCount"] = reward_value  #奖励值
-
-            key_list_dict["JoinTaskUserCount"] = 1  #参与任务完成人数
-            key_list_dict["AddJoinTaskUserCount"] = 1  #新增参与任务完成人数
-            key_list_dict["JoinTaskCount"] = 1  #参与任务完成次数
-            key_list_dict["JoinTaskRewardCount"] = reward_value  #参与任务奖励值
-
-            stat_base_model.add_stat_list(app_id, act_id, module_id, user_id, open_id, key_list_dict)
-
-    def init_task_count(self, task_info_dict, task_count_list, task_sub_type=""):
-        """
-        :description: 初始化任务计数
-        :param task_info_dict:任务信息字典
-        :param task_count_list:任务计数列表
-        :param task_sub_type:子任务类型标识
-        :return 
-        :last_editors: HuangJianYi
-        """
-        if task_sub_type:
-            task_count = [task_count for task_count in task_count_list if task_info_dict["task_type"] == task_count.task_type and task_count.task_sub_type == str(task_sub_type)]
-        else:
-            task_count = [task_count for task_count in task_count_list if task_info_dict["task_type"] == task_count.task_type]
-        if not task_count:
-            task_count = TaskCount()
-        else:
-            task_count = task_count[0]
-        if task_info_dict["complete_type"] == TaskCompleteType.day.value and task_count.modify_day != SevenHelper.get_now_day_int():
-            task_count.complete_count = 0
-            task_count.now_count = 0
-            task_count.remark = ""
-        elif task_info_dict["complete_type"] == TaskCompleteType.week.value and not TimeHelper.is_this_week(task_count.modify_date):
-            task_count.complete_count = 0
-            task_count.now_count = 0
-            task_count.remark = ""
-        elif task_info_dict["complete_type"] == TaskCompleteType.month.value and not TimeHelper.is_this_month(task_count.modify_date):
-            task_count.complete_count = 0
-            task_count.now_count = 0
-            task_count.remark = ""
-        elif task_info_dict["complete_type"] == TaskCompleteType.long.value and task_count.id == 0:
-            task_count.complete_count = 0
-            task_count.now_count = 0
-        return task_count
-
-    def get_complete_type_name(self, complete_type):
-        """
-        :description: 获取任务类型名称
-        :param complete_type:任务类型
-        :param now_day:当前时间天
-        :return 
-        :last_editors: HuangJianYi
-        """
-        complete_type_name = ""
-        if complete_type == TaskCompleteType.day.value:
-            complete_type_name = "每日"
-        elif complete_type == TaskCompleteType.week.value:
-            complete_type_name = "每周"
-        elif complete_type == TaskCompleteType.month.value:
-            complete_type_name = "每月"
-        return complete_type_name
-
-    def add_task_log(self, task_type, task_sub_type, app_id, act_id, module_id, user_id, open_id, user_nick, task_name, log_title, reward_type, reward_object_id, reward_name, reward_num, handler_name, request_code, info_json={}):
-        """
-        :description: 添加任务日志
-        :param task_type:任务类型
-        :param task_sub_type:任务子类型
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_id:用户标识
-        :param open_id:open_id
-        :param user_nick:user_nick
-        :param task_name:任务名称
-        :param log_title:标题
-        :param reward_type: 奖励类型
-        :param reward_object_id: 奖励对象标识
-        :param reward_name: 奖励名称
-        :param reward_num: 奖励数量
-        :param handler_name:接口名称
-        :param request_code:请求代码
-        :param info_json:日志详细信息
-        :return 
-        :last_editors: HuangJianYi
-        """
-        task_config = share_config.get_value("task_config",{})
-        if task_config.get("is_task_log",False) == True:
-            try:
-                task_log = TaskLog()
-                task_log.app_id = app_id
-                task_log.act_id = act_id
-                task_log.module_id = module_id
-                task_log.user_id = user_id
-                task_log.open_id = open_id
-                task_log.user_nick = user_nick
-                task_log.log_title = log_title
-                task_log.task_type = task_type
-                task_log.task_sub_type =task_sub_type
-                task_log.task_name = task_name if task_name else ""
-                task_log.reward_type = reward_type if reward_type else 0
-                task_log.reward_object_id = str(reward_object_id) if reward_object_id else ""
-                task_log.reward_name = reward_name if reward_name else ""
-                task_log.reward_num = reward_num if reward_num else 0
-                task_log.handler_name = handler_name
-                task_log.request_code = request_code
-                task_log.info_json = SevenHelper.json_dumps(info_json) if info_json else {}
-                task_log.create_date = SevenHelper.get_now_datetime()
-                task_log.create_day = SevenHelper.get_now_day_int()
-                task_log_model = TaskLogModel(sub_table=self.get_business_sub_table("task_log_tb",{"app_id":app_id}), context=self.context)
-                task_log_model.add_entity(task_log)
-            except Exception as ex:
-                self.context.logging_link_error("【添加任务日志】" + traceback.format_exc())
-
-    def add_gear_task_count(self, app_id, act_id, module_id, user_id, open_id, task_type, value, remark='', is_async=True):
-        """
-        :description: 添加档位任务累计值，目前支持消费类任务、累计抽盒/抽奖次数档位任务
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param module_id：活动模块标识
-        :param user_id：用户标识(比传)
-        :param open_id：open_id
-        :param task_type：任务类型
-        :param value：计数值
-        :param remark：备注
-        :param is_async：是否异步处理（1-是 0-否）
-        :return:
-        :last_editors: HuangJianYi
-        """
-        if is_async == True:
-            task_gear_count = TaskGearCount()
-            task_gear_count.app_id = app_id
-            task_gear_count.act_id = act_id
-            task_gear_count.module_id = module_id
-            task_gear_count.user_id = user_id
-            task_gear_count.open_id = open_id
-            task_gear_count.task_type = task_type
-            task_gear_count.now_count = value
-            task_gear_count.create_day = SevenHelper.get_now_day_int()
-            task_gear_count.create_month = SevenHelper.get_now_month_int()
-            task_gear_count.create_date = SevenHelper.get_now_datetime()
-            task_gear_count.remark = remark
-            redis_init = SevenHelper.redis_init()
-            redis_init.rpush(f"task_gear_list:{str(user_id % 10)}", SevenHelper.json_dumps(task_gear_count))
-        else:
-            self.add_gear_task_count_to_db(app_id, act_id, module_id, user_id, open_id, task_type, value, remark)
-
-    def add_gear_task_count_to_db(self, app_id, act_id, module_id, user_id, open_id, task_type, value, remark=''):
-        """
-        :description: 添加档位任务累计值，目前支持消费类任务、累计抽盒/抽奖次数档位任务
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param module_id：活动模块标识
-        :param user_id：用户标识(比传)
-        :param open_id：open_id
-        :param task_type：任务类型
-        :param value：计数值
-        :param remark：备注
-        :return:
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        try:
-            create_day = SevenHelper.get_now_day_int()
-            create_month = SevenHelper.get_now_month_int()
-            task_info_model = TaskInfoModel(context=self.context)
-            db_transaction = DbTransaction(db_config_dict=config.get_value("db_cloudapp"))
-            frame_base_model = FrameBaseModel()
-            task_count_model = TaskCountModel(sub_table=frame_base_model.get_business_sub_table("task_count_tb", {"app_id": app_id}), db_transaction=db_transaction)
-            task_gear_count_model = TaskGearCountModel(sub_table=frame_base_model.get_business_sub_table("task_gear_count_tb", {"app_id": app_id}), db_transaction=db_transaction)
-            task_info_dict = task_info_model.get_dict("act_id=%s and module_id=%s and task_type=%s", params=[act_id, module_id, task_type])
-            task_gear_count_id_md5 = CryptoHelper.md5_encrypt_int(f"{act_id}_{module_id}_{task_type}_{user_id}")
-            task_gear_count = task_gear_count_model.get_entity("id_md5=%s and create_day=%s", params=[task_gear_count_id_md5, create_day])
-            db_transaction.begin_transaction()
-            if not task_gear_count:
-                task_gear_count = TaskGearCount()
-                task_gear_count.id_md5 = task_gear_count_id_md5
-                task_gear_count.app_id = app_id
-                task_gear_count.act_id = act_id
-                task_gear_count.module_id = module_id
-                task_gear_count.user_id = user_id
-                task_gear_count.open_id = open_id
-                task_gear_count.task_type = task_type
-                task_gear_count.now_count = value
-                task_gear_count.create_day = create_day
-                task_gear_count.create_month = create_month
-                task_gear_count.create_date = SevenHelper.get_now_datetime()
-                task_gear_count.remark = remark
-                task_gear_count_model.add_entity(task_gear_count)
-            else:
-                task_gear_count.now_count = decimal.Decimal(task_gear_count.now_count) + decimal.Decimal(value)
-                task_gear_count.remark = task_gear_count.remark + "," + remark if  task_gear_count.remark else remark
-                task_gear_count_model.update_table("now_count=%s,remark=%s,modify_date=%s", "id=%s", params=[task_gear_count.now_count, task_gear_count.remark, task_gear_count.create_date, task_gear_count.id])
-            if task_info_dict:
-                #判断子任务是否完成
-                config_json = SevenHelper.json_loads(task_info_dict["config_json"])
-                if config_json and config_json.__contains__("gear_list"):
-                    now_count = decimal.Decimal(self.get_gear_task_count(app_id, act_id, module_id, user_id, task_type, task_info_dict["complete_type"])) + decimal.Decimal(value)
-                    task_count_list = task_count_model.get_list("act_id=%s and module_id=%s and user_id=%s and task_type=%s", params=[act_id, module_id, user_id, task_type])
-                    config_json = config_json["gear_list"]
-                    for sub_config_json in config_json:
-                        task_count = self.init_task_count(task_info_dict, task_count_list, sub_config_json["id"])
-                        if task_count.complete_count == 1:
-                            continue
-                        task_count_id_md5 = CryptoHelper.md5_encrypt_int(f"{act_id}_{module_id}_{task_type}_{sub_config_json['id']}_{user_id}")
-                        if now_count >= decimal.Decimal(sub_config_json["gear"]):
-                            task_count = TaskCount()
-                            task_count.id_md5 = task_count_id_md5
-                            task_count.app_id = app_id
-                            task_count.act_id = act_id
-                            task_count.module_id = module_id
-                            task_count.user_id = user_id
-                            task_count.open_id = open_id
-                            task_count.task_type = task_type
-                            task_count.task_sub_type = sub_config_json["id"]
-                            task_count.complete_count = 0
-                            task_count.now_count = 1
-                            task_count.create_date = SevenHelper.get_now_datetime()
-                            task_count.modify_date = SevenHelper.get_now_datetime()
-                            task_count.modify_day = SevenHelper.get_now_day_int()
-                            task_count_model.add_update_entity(task_count, "complete_count=0,now_count=1,modify_date=%s,modify_day=%s", params=[task_count.modify_date, task_count.modify_day])
-
-            result, message = db_transaction.commit_transaction(True)
-            if result == False:
-                raise Exception("执行事务失败", message)
-        except Exception as ex:
-            if self.context:
-                self.context.logging_link_error("【添加档位任务累计值】" + traceback.format_exc())
-            elif self.logging_link_error:
-                self.logging_link_error("【添加档位任务累计值】" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "添加档位任务累计值失败"
-        return invoke_result_data
-
-    def add_task_count(self, app_id, act_id, module_id, user_id, open_id, task_type, value, task_info_dict=None, task_sub_type=''):
-        """
-        :description: 添加常规任务计数
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param module_id：活动模块标识
-        :param user_id：用户标识(比传)
-        :param open_id：open_id
-        :param task_type：任务类型
-        :param value：计数值
-        :param task_info_dict：任务信息
-        :param task_sub_type：任务子类型
-        :return:
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        if not task_info_dict:
-            task_invoke_result_data = self.check_task_info(act_id,module_id,task_type)
-            if task_invoke_result_data.success == True:
-                task_info_dict = task_invoke_result_data.data
-        if task_info_dict:
-            if task_sub_type and isinstance(task_info_dict["config_json"],list):
-                sub_config_json = [sub_config_json for sub_config_json in task_info_dict["config_json"] if task_sub_type == sub_config_json["id"]]
-                if not sub_config_json:
-                    invoke_result_data.succsess = False
-                    invoke_result_data.error_code = "error"
-                    invoke_result_data.error_message = "完成上限"
-                    return invoke_result_data
-                limit_num = int(sub_config_json["limit_num"]) if sub_config_json.__contains__("limit_num") else 1
-                satisfy_num = int(sub_config_json["satisfy_num"]) if sub_config_json.__contains__("satisfy_num") else 1
-            else:
-                config_json = task_info_dict["config_json"]
-                limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
-                satisfy_num = int(config_json["satisfy_num"]) if config_json.__contains__("satisfy_num") else 1
-            task_count_model = TaskCountModel(sub_table=self.get_business_sub_table("task_count_tb",{"app_id":app_id}),context=self.context)
-            task_count_id_md5 = self._get_task_count_id_md5(act_id,module_id,task_info_dict["task_type"],task_sub_type,user_id)
-            task_count = task_count_model.get_entity("id_md5=%s",params=[task_count_id_md5])
-            task_count_list = [task_count] if task_count else []
-            task_count = self.init_task_count(task_info_dict, task_count_list, task_sub_type)
-            count = int(task_count.complete_count * satisfy_num) + task_count.now_count
-            is_limit = True if count >= (limit_num * satisfy_num) else False
-            if is_limit == True:
-                invoke_result_data.succsess = False
-                invoke_result_data.error_code = "error"
-                invoke_result_data.error_message = "完成上限"
-                return invoke_result_data
-            now_datetime = SevenHelper.get_now_datetime()
-            now_day = SevenHelper.get_now_day_int()
-            task_count.id_md5 = task_count_id_md5
-            task_count.app_id = app_id
-            task_count.act_id = act_id
-            task_count.module_id = module_id
-            task_count.user_id = user_id
-            task_count.open_id = open_id
-            task_count.task_type = task_info_dict["task_type"]
-            task_count.now_count = task_count.now_count + int(value)
-            task_count.create_date = now_datetime
-            task_count.modify_date = now_datetime
-            task_count.modify_day = now_day
-            update_sql = "complete_count=%s,now_count=%s,modify_date=%s,modify_day=%s"
-            params = [task_count.complete_count, task_count.now_count, task_count.modify_date, task_count.modify_day]
-            if task_count.complete_count > 0:
-                update_sql = "now_count=%s,modify_date=%s,modify_day=%s"
-                params = [task_count.now_count, task_count.modify_date, task_count.modify_day]
-            task_count_model.add_update_entity(task_count, update_sql, params=params)
-
-            return invoke_result_data
-
-    def get_gear_task_count(self, app_id, act_id, module_id, user_id, task_type, complete_type):
-        """
-        :description: 获取累计消费金额，累计抽盒次数等等
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param module_id：活动模块标识
-        :param user_id：用户标识(比传)
-        :param task_type：任务类型
-        :param complete_type：完成类型
-        :return:
-        :last_editors: HuangJianYi
-        """
-        task_gear_count_model = TaskGearCountModel(sub_table=self.get_business_sub_table("task_gear_count_tb", {"app_id": app_id}), context=self.context)
-        condition_where = ConditionWhere()
-        task_gear_count_id_md5 = CryptoHelper.md5_encrypt_int(f"{act_id}_{module_id}_{task_type}_{user_id}")
-        condition_where.add_condition("id_md5=%s")
-        params = [task_gear_count_id_md5]
-        if complete_type == TaskCompleteType.day.value:
-            condition_where.add_condition("create_day=%s")
-            params.append(SevenHelper.get_now_day_int())
-        elif complete_type == TaskCompleteType.week.value:
-            start_day = int(TimeHelper.get_first_day_of_the_week().strftime('%Y%m%d'))
-            end_day = int(TimeHelper.get_last_day_of_the_week().strftime('%Y%m%d'))
-            condition_where.add_condition("create_day>=%s and create_day<=%s")
-            params.append(start_day)
-            params.append(end_day)
-        elif complete_type == TaskCompleteType.month.value:
-            condition_where.add_condition("create_month=%s")
-            params.append(SevenHelper.get_now_month_int())
-        if module_id:
-            condition_where.add_condition("module_id=%s")
-            params.append(module_id)
-        task_gear_count_dict = task_gear_count_model.get_dict(condition_where.to_string(),field="sum(now_count) as now_count",params=params)
-        current = task_gear_count_dict["now_count"] if task_gear_count_dict["now_count"] else 0  # 当前总累计值
-        return current
-
-    def convert_task_node(self, task_id, sort_index, task_type, task_type_name, title, desc='', current=0, total=1, data=[], complete_count=1, current_complete_count=0, reward_value=0, completed_ids=[], get_ways=0, status=0, btn_text=[], route_url=''):
-        """
-        :description: 合成任务节点
-        :param task_id：任务id
-        :param sort_index：排序
-        :param task_type：任务类型
-        :param task_type_name：任务类型名称
-        :param title：标题
-        :param desc：描述
-        :param current：当前轮计数值
-        :param total：当前轮领取阀值(消费任务表示领取奖励需要消费的金额)
-        :param data：如果有额外数据放这里，如果商品数据，或者子任务数据
-        :param complete_count：可以完成的次数
-        :param current_complete_count：当前完成的次数
-        :param reward_value：奖励值
-        :param completed_ids：完成的ids，比如：已收藏的商品ids或者已完成的子任务ids
-        :param get_ways：领取方式(0-直接领取 1-通过领取接口领取)
-        :param status：状态
-        :param btn_text：按钮文本数组
-        :param route_url：路由地址
-        :return:
-        :last_editors: HuangJianYi
-        """
-        result = {}
-        result["sort_index"] = sort_index
-        result["id"] = task_id
-        result["task_type"] = task_type
-        result["task_type_name"] = task_type_name
-        result["title"] = title
-        result["desc"] = desc
-        result["current"] = current
-        result["total"] = total
-        result["data"] = data
-        result["complete_count"] = complete_count
-        result["current_complete_count"] = current_complete_count
-        result["reward_value"] = reward_value
-        result["completed_ids"] = completed_ids
-        result["get_ways"] = get_ways
-        result["status"] = status
-        result["btn_text"] = btn_text
-        result["route_url"] = route_url
-        return result
-
-    def convert_gear_task_node(self, app_id, act_id, module_id, user_id, task_info_dict, config_json, task_count_list):
-        """
-        :description: 合成档位任务结果
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_id:用户标识
-        :param task_info_dict:任务信息
-        :param config_json:{"gear_list":[{"id":1,"gear":0,"reward_type":1,"reward_name":"","asset_object_id":"","reward_value":0}]} 字段说明：id:前端生成的唯一标识 gear:档位阀值 reward_value:奖励值(等于0无法领取) satisfy_num:满足数 reward_type:奖励类型 reward_name:奖励奖品名称 asset_object_id:对象标识(如果奖励类型是资产对应资产对象标识，如果是奖品对应奖品标识，如果是卡片对应卡片标识)
-        :param task_count_list:计数列表
-        :return 
-        :last_editors: HuangJianYi
-        """
-        result = deepcopy(self.convert_task_node(task_info_dict["id"],task_info_dict["sort_index"],task_info_dict["task_type"],SevenHelper.get_enum_key(TaskType, task_info_dict["task_type"]),task_info_dict["task_name"],get_ways=1,route_url="receive_reward"))
-        result["current"] =  self.get_gear_task_count(app_id, act_id, module_id, user_id, task_info_dict["task_type"], task_info_dict["complete_type"])
-        if not any(word in task_info_dict["task_name"] for word in ["消费金额","购买金额"]):
-            result["current"] = int(result["current"])
-        for sub_config_json in config_json["gear_list"]:
-            sub_task_count = self.init_task_count(task_info_dict, task_count_list, sub_config_json["id"])
-            if sub_task_count.complete_count > 0:
-                result["completed_ids"].append(sub_config_json["id"])
-            sub_info = {}
-            sub_info["id"] = sub_config_json["id"] #子任务id
-            sub_info["gear"] = sub_config_json["gear"] #档位阀值
-            sub_info["reward_name"] = sub_config_json["reward_name"] #奖励名称
-            sub_info["reward_value"] = sub_config_json["reward_value"] #奖励数量
-            result["data"].append(sub_info)
-        result["current_complete_count"] = 1 if len(result["completed_ids"]) == len(sub_config_json) else 0
-
-        return result
-
-    def get_client_task_list(self, app_id, act_id, module_id, user_id, task_types="", app_key="", app_secret="", is_log=False, daily_repeat_browse=False, mix_nick=""):
-        """
-        :description: 获取任务列表
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_id:用户标识
-        :param task_types:任务类型 多个逗号,分隔
-        :param app_key:app_key
-        :param app_secret:app_secret
-        :param is_log:是否记录top请求日志
-        :param daily_repeat_browse:单个商品可每日重复浏览 True是False否
-        :param mix_nick:混淆昵称
-        :return 
-        :last_editors: HuangJianYi
-        """
-        task_info_list = self.get_task_info_dict_list(app_id,act_id,module_id,1)
-        task_count_model = TaskCountModel(sub_table=self.get_business_sub_table("task_count_tb",{"app_id":app_id}),context=self.context)
-        task_count_list = task_count_model.get_list("act_id=%s and module_id=%s and user_id=%s", params=[act_id, module_id, user_id])
-        now_day = TimeExHelper.get_now_day_int()
-        app_info_dict = None
-        result_list = []
-        for task_info_dict in task_info_list:
-            if task_types:
-                if str(task_info_dict["task_type"]) not in task_types.split(','):
-                    continue
-            config_json = SevenHelper.json_loads(task_info_dict["config_json"])
-            if not config_json:
-                continue
-
-            result = {}
-            result["sort_index"] = task_info_dict["sort_index"]
-            result["task_id"] = task_info_dict["id"]
-            result["task_type"] = task_info_dict["task_type"]
-            result["title"] = task_info_dict["task_name"]
-            result["config_json"] = config_json
-            result["reward_value"] = int(config_json["reward_value"]) if config_json.__contains__("reward_value") else 0
-
-            task_count = self.init_task_count(task_info_dict, task_count_list)
-
-            #掌柜有礼、免费领取、新人有礼
-            if task_info_dict["task_type"] == TaskType.free_gift.value:
-                limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
-                result["content"] = f"完成次数上限{limit_num}次，当前剩余{limit_num-task_count.complete_count}次"
-                result["status"] = 1 if task_count.complete_count >= limit_num else 0
-                result["text"] = ["领取", "已领取"]
-                result_list.append(result)
-            #单次签到
-            elif task_info_dict["task_type"] == TaskType.one_sign.value:
-                result["content"] = ""
-                result["status"] = 1 if task_count.complete_count > 0 else 0
-                result["text"] = ["签到", "已签到"]
-                result_list.append(result)
-            #每周签到(指定天数签到)(status:0当天未签到1当天已签到2已完成)
-            elif task_info_dict["task_type"] == TaskType.weekly_sign.value:
-                result["complete_count"] = task_count.complete_count
-                result["content"] = f"已签到{task_count.complete_count}天"
-                if isinstance(config_json["day_list"],list):
-                    max_sign_day = max(query(config_json["day_list"]).select(lambda x: int(x["day"])).to_list())
-                else:
-                    max_sign_day = int(max(config_json["day_list"])) if len(config_json["day_list"].keys()) > 0 else 0
-                if task_count.complete_count >= max_sign_day:
-                    result["status"] = 2
-                else:
-                    result["status"] = 1 if task_count.modify_day == now_day else 0
-                result["text"] = ["签到", "已签到","已完成"]
-                result_list.append(result)
-            #累计签到(status:0当天未签到1当天已签到2已完成)
-            elif task_info_dict["task_type"] == TaskType.cumulative_sign.value:
-                result["complete_count"] = task_count.complete_count
-                result["content"] = f"已签到{task_count.complete_count}天"
-                if isinstance(config_json["day_list"],list):
-                    max_sign_day = max(query(config_json["day_list"]).select(lambda x: int(x["day"])).to_list())
-                else:
-                    max_sign_day = int(max(config_json["day_list"])) if len(config_json["day_list"].keys()) > 0 else 0
-                if task_count.complete_count >= max_sign_day:
-                    result["status"] = 2
-                else:
-                    result["status"] = 1 if task_count.modify_day == now_day else 0
-                result["text"] = ["签到", "已签到","已完成"]
-                result_list.append(result)
-            #连续签到(status:0当天未签到1当天已签到2已完成)
-            elif task_info_dict["task_type"] == TaskType.successive_sign.value:
-                result["complete_count"] = task_count.complete_count
-                result["content"] = f"已签到{task_count.complete_count}天"
-                if isinstance(config_json["day_list"],list):
-                    max_sign_day = max(query(config_json["day_list"]).select(lambda x: int(x["day"])).to_list())
-                else:
-                    max_sign_day = int(max(config_json["day_list"])) if len(config_json["day_list"].keys()) > 0 else 0
-                if task_count.complete_count >= max_sign_day:
-                    result["status"] = 2
-                else:
-                    result["status"] = 1 if task_count.modify_day == now_day else 0
-                result["text"] = ["签到", "已签到","已完成"]
-                result_list.append(result)
-            #邀请新用户
-            elif task_info_dict["task_type"] == TaskType.invite_new_user.value:
-                limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
-                satisfy_num = int(config_json["satisfy_num"]) if config_json.__contains__("satisfy_num") else 1
-                if task_count.complete_count >= limit_num:
-                    result["status"] = 2
-                elif task_count.now_count >= satisfy_num:
-                    result["status"] = 1
-                else:
-                    result["status"] = 0
-                result["complete_count"] = task_count.complete_count
-                result["now_count"] = task_count.now_count
-                result["limit_num"] = limit_num
-                result["satisfy_num"] = satisfy_num
-                result["content"] = f"完成次数上限{limit_num}次，当前剩余{limit_num-task_count.complete_count}次"
-                result["text"] = ["去邀请", "领取", "已完成"]
-                result_list.append(result)
-            #邀请加入会员
-            elif task_info_dict["task_type"] == TaskType.invite_join_member.value:
-                limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
-                satisfy_num = int(config_json["satisfy_num"]) if config_json.__contains__("satisfy_num") else 1
-                if task_count.complete_count >= limit_num:
-                    result["status"] = 2
-                elif task_count.now_count >= satisfy_num:
-                    result["status"] = 1
-                else:
-                    result["status"] = 0
-                result["complete_count"] = task_count.complete_count
-                result["now_count"] = task_count.now_count
-                result["limit_num"] = limit_num
-                result["satisfy_num"] = satisfy_num
-                result["content"] = f"完成次数上限{limit_num}次，当前剩余{limit_num-task_count.complete_count}次"
-                result["text"] = ["去邀请", "领取", "已完成"]
-                result_list.append(result)
-            #关注店铺
-            elif task_info_dict["task_type"] == TaskType.favor_store.value:
-                if not app_info_dict:
-                    app_base_model = AppBaseModel(context=self.context)
-                    app_info_dict = app_base_model.get_app_info_dict(app_id)
-                once_favor_reward = int(config_json["once_favor_reward"]) if config_json.__contains__("once_favor_reward") else 1
-                user_base_model = UserBaseModel(context=self.context)
-                user_info_dict = user_base_model.get_user_info_dict(app_id,act_id,user_id)
-                if not user_info_dict:
-                    result["status"] = 0
-                if module_id:
-                    if task_count.complete_count >= 1:
-                        result["status"] = 1
-                    elif user_info_dict["is_favor_before"] == 1 and once_favor_reward == 0:
-                        result["status"] = 1
-                    else:
-                        result["status"] = 0
-                else:
-                    if user_info_dict["is_favor"] == 1:
-                        result["status"] = 1
-                    elif user_info_dict["is_favor_before"] == 1 and once_favor_reward == 0:
-                        result["status"] = 1
-                    else:
-                        result["status"] = 0
-                result["content"] = ""
-                result["store_name"] = app_info_dict["store_name"] if app_info_dict else ""
-                result["text"] = ["去关注", "已关注"]
-                result_list.append(result)
-            #加入会员
-            elif task_info_dict["task_type"] == TaskType.join_member.value:
-                if not app_info_dict:
-                    app_base_model = AppBaseModel(context=self.context)
-                    app_info_dict = app_base_model.get_app_info_dict(app_id)
-                once_member_reward = int(config_json["once_member_reward"]) if config_json.__contains__("once_member_reward") else 1
-                user_base_model = UserBaseModel(context=self.context)
-                user_info_dict = user_base_model.get_user_info_dict(app_id,act_id,user_id)
-                if not user_info_dict:
-                    result["status"] = 0
-                if module_id:
-                    if task_count.complete_count >= 1:
-                        result["status"] = 2
-                    elif user_info_dict["is_member_before"] == 1 and once_member_reward == 0:
-                        result["status"] = 2
-                    else:
-                        access_token = app_info_dict["access_token"] if app_info_dict else ""
-                        top_base_model = TopBaseModel(context=self.context)
-                        if top_base_model.check_is_member(mix_nick,'',access_token,app_key,app_secret,is_log) == True:
-                            result["status"] = 1
-                        else:
-                            result["status"] = 0
-                else:
-                    if user_info_dict["is_member"] == 1:
-                        result["status"] = 2
-                    elif user_info_dict["is_member_before"] == 1 and once_member_reward == 0:
-                        result["status"] = 2
-                    else:
-                        access_token = app_info_dict["access_token"] if app_info_dict else ""
-                        top_base_model = TopBaseModel(context=self.context)
-                        if top_base_model.check_is_member(mix_nick,'',access_token,app_key,app_secret,is_log) == True:
-                            result["status"] = 1
-                        else:
-                            result["status"] = 0
-                result["content"] = ""
-                result["text"] = ["立即入会", "立即领取", "已领取"]
-                result_list.append(result)
-            #收藏商品
-            elif task_info_dict["task_type"] == TaskType.collect_goods.value:
-                limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
-                satisfy_num = int(config_json["satisfy_num"]) if config_json.__contains__("satisfy_num") else 1
-                if task_count.complete_count >= limit_num:
-                    result["status"] = 2
-                elif task_count.now_count >= satisfy_num:
-                    result["status"] = 1
-                else:
-                    result["status"] = 0
-                collect_log_model = CollectLogModel(context=self.context)
-                condition = "act_id=%s and user_id=%s"
-                params = [act_id, user_id]
-                user_goods_list = collect_log_model.get_cache_list(condition, params=params,dependency_key=f"collect_log:actid_{act_id}_userid_{user_id}")
-                result["goods_list"] = config_json["goods_list"] if config_json.__contains__("goods_list") else []
-                result["user_goods_list"] = [str(i.goods_id) for i in user_goods_list] if len(user_goods_list) > 0 else []
-                result["complete_count"] = task_count.complete_count
-                result["now_count"] = task_count.now_count
-                result["limit_num"] = limit_num
-                result["satisfy_num"] = satisfy_num
-                result["content"] = f"完成次数上限{limit_num}次，当前剩余{limit_num-task_count.complete_count}次"
-                result["text"] = ["去收藏", "已收藏","已完成"]
-                result_list.append(result)
-            #浏览商品
-            elif task_info_dict["task_type"] == TaskType.browse_goods.value:
-                limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
-                satisfy_num = int(config_json["satisfy_num"]) if config_json.__contains__("satisfy_num") else 1
-                if task_count.complete_count >= limit_num:
-                    result["status"] = 2
-                elif task_count.now_count >= satisfy_num:
-                    result["status"] = 1
-                else:
-                    result["status"] = 0
-                browse_log_model = BrowseLogModel(context=self.context)
-                condition = "act_id=%s and user_id=%s"
-                params = [act_id,user_id]
-                if daily_repeat_browse == True:
-                    condition += " and create_day=%s"
-                    params.append(now_day)
-                user_goods_list = browse_log_model.get_cache_list(condition, params=params,dependency_key=f"browse_log:actid_{act_id}_userid_{user_id}")
-                result["goods_list"] = config_json["goods_list"] if config_json.__contains__("goods_list") else []
-                result["user_goods_list"] = [str(i.goods_id) for i in user_goods_list] if len(user_goods_list) > 0 else []
-                result["complete_count"] = task_count.complete_count
-                result["now_count"] = task_count.now_count
-                result["limit_num"] = limit_num
-                result["satisfy_num"] = satisfy_num
-                result["content"] = f"完成次数上限{limit_num}次，当前剩余{limit_num-task_count.complete_count}次"
-                result["text"] = ["去浏览", "已浏览","已完成"]
-                result_list.append(result)
-            #浏览网址
-            elif isinstance(config_json, list) and task_info_dict["task_type"] in [TaskType.browse_store.value,TaskType.browse_live_room.value,TaskType.browse_special_topic.value]:
-                for sub_config_json in config_json:
-                    sub_task_count = [task_count for task_count in task_count_list if task_info_dict["task_type"] == task_count.task_type and task_count.task_sub_type == sub_config_json["id"]]
-                    if not sub_task_count:
-                        sub_task_count = TaskCount()
-                    else:
-                        sub_task_count = sub_task_count[0]
-                    if task_info_dict["complete_type"] == 1 and sub_task_count.modify_day != now_day:
-                        sub_task_count.complete_count = 0
-                        sub_task_count.now_count = 0
-                    elif task_info_dict["complete_type"] == 2 and not TimeHelper.is_this_week(sub_task_count.modify_date):
-                        sub_task_count.complete_count = 0
-                        sub_task_count.now_count = 0
-                    elif task_info_dict["complete_type"] == 3 and sub_task_count.id == 0:
-                        sub_task_count.complete_count = 0
-                        sub_task_count.now_count = 0
-                    limit_num = int(sub_config_json["limit_num"]) if sub_config_json.__contains__("limit_num") else 1
-                    satisfy_num = int(sub_config_json["satisfy_num"]) if sub_config_json.__contains__("satisfy_num") else 1
-                    result = {}
-                    result["sort_index"] = task_info_dict["sort_index"]
-                    result["task_id"] = task_info_dict["id"]
-                    result["task_type"] = task_info_dict["task_type"]
-                    result["task_sub_type"] = sub_config_json["id"]
-                    result["title"] = task_info_dict["task_name"]
-                    result["config_json"] = sub_config_json
-                    result["reward_value"] = int(sub_config_json["reward_value"]) if sub_config_json.__contains__("reward_value") else 0
-                    if sub_task_count.complete_count >= limit_num:
-                        result["status"] = 1
-                    else:
-                        result["status"] = 0
-                    result["link_url"] = sub_config_json["link_url"] if sub_config_json.__contains__("link_url") else ""
-                    result["complete_count"] = sub_task_count.complete_count
-                    result["now_count"] = sub_task_count.now_count
-                    result["limit_num"] = limit_num
-                    result["satisfy_num"] = satisfy_num
-                    result["content"] = f"完成次数上限{limit_num}次，当前剩余{limit_num-sub_task_count.complete_count}次"
-                    result["text"] = ["去浏览", "已完成"]
-                    result_list.append(result)
-            #分享奖励
-            elif task_info_dict["task_type"] == TaskType.share.value:
-                limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
-                satisfy_num = int(config_json["satisfy_num"]) if config_json.__contains__("satisfy_num") else 1
-                if task_count.complete_count >= limit_num:
-                    result["status"] = 2
-                elif task_count.now_count >= satisfy_num:
-                    result["status"] = 1
-                else:
-                    result["status"] = 0
-                result["content"] = f"完成次数上限{limit_num}次，当前剩余{limit_num-task_count.complete_count}次"
-                result["text"] = ["去分享", "领取","已完成"]
-                result_list.append(result)
-            #浏览店铺
-            elif task_info_dict["task_type"] == TaskType.browse_store.value:
-                limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
-                satisfy_num = int(config_json["satisfy_num"]) if config_json.__contains__("satisfy_num") else 1
-                if task_count.complete_count >= limit_num:
-                    result["status"] = 2
-                elif task_count.now_count >= satisfy_num:
-                    result["status"] = 1
-                else:
-                    result["status"] = 0
-                result["content"] = f"完成次数上限{limit_num}次，当前剩余{limit_num-task_count.complete_count}次"
-                result["text"] = ["去完成", "领取","已完成"]
-                result_list.append(result)
-            #浏览直播间
-            elif task_info_dict["task_type"] == TaskType.browse_live_room.value:
-                limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
-                satisfy_num = int(config_json["satisfy_num"]) if config_json.__contains__("satisfy_num") else 1
-                if task_count.complete_count >= limit_num:
-                    result["status"] = 2
-                elif task_count.now_count >= satisfy_num:
-                    result["status"] = 1
-                else:
-                    result["status"] = 0
-                result["complete_count"] = task_count.complete_count
-                result["limit_num"] = limit_num
-                result["satisfy_num"] = satisfy_num
-                result["content"] = f"完成次数上限{limit_num}次，当前剩余{limit_num-task_count.complete_count}次"
-                result["text"] = ["去浏览", "领取","已完成"]
-                result_list.append(result)
-            #邀请助力
-            elif task_info_dict["task_type"] == TaskType.invite_user_help.value:
-                limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
-                satisfy_num = int(config_json["satisfy_num"]) if config_json.__contains__("satisfy_num") else 1
-                if task_count.complete_count >= limit_num:
-                    result["status"] = 2
-                elif task_count.now_count >= satisfy_num:
-                    result["status"] = 1
-                else:
-                    result["status"] = 0
-                invite_help_model = InviteHelpModel(context=self.context)
-                help_type = 1
-                help_object_id = ''
-                help_id_md5 = CryptoHelper.md5_encrypt_int(f"{app_id}_{act_id}_{module_id}_{help_type}_{help_object_id}")
-                invite_help_list = invite_help_model.get_cache_dict_list("id_md5=%s and user_id=%s and create_day=%s", "", order_by="id desc", field="invited_avatar", params=[help_id_md5, user_id, SevenHelper.get_now_day_int()], dependency_key=DependencyKey.invite_user_help_list(help_id_md5,user_id))
-                result["data"] = invite_help_list if len(invite_help_list) > 0 else []
-                result["complete_count"] = task_count.complete_count
-                result["now_count"] = task_count.now_count
-                result["limit_num"] = limit_num
-                result["satisfy_num"] = satisfy_num
-                result["content"] = f"完成次数上限{limit_num}次，当前剩余{limit_num-task_count.complete_count}次"
-                result["text"] = ["去邀请", "领取", "已完成"]
-                result_list.append(result)
-            #神秘暗号
-            elif task_info_dict["task_type"] == TaskType.secret_code.value:
-                limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
-                if task_count.complete_count >= limit_num:
-                    result["status"] = 1
-                else:
-                    result["status"] = 0
-                result["content"] = f"完成次数上限{limit_num}次，当前剩余{limit_num-task_count.complete_count}次"
-                result["text"] = ["输入暗号","已完成"]
-                result_list.append(result)
-            #店铺会员积分兑换资产
-            elif task_info_dict["task_type"] == TaskType.crm_point_exchange_asset.value:
-                limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
-                satisfy_num = int(config_json["satisfy_num"]) if config_json.__contains__("satisfy_num") else 1
-                if task_count.complete_count >= limit_num:
-                    result["status"] = 1
-                else:
-                    result["status"] = 0
-                result["complete_count"] = task_count.complete_count
-                result["limit_num"] = limit_num
-                result["satisfy_num"] = satisfy_num
-                result["content"] = f"完成次数上限{limit_num}次，当前剩余{limit_num-task_count.complete_count}次"
-                result["text"] = ["兑换","已完成"]
-                result_list.append(result)
-
-        return result_list,task_info_list,task_count_list
-
-    def get_client_task_list_v2(self, app_id, act_id, module_id, user_id, task_types="", daily_repeat_browse=False):
-        """
-        :description: 获取任务列表
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_id:用户标识
-        :param task_types:任务类型 多个逗号,分隔
-        :param daily_repeat_browse:单个商品可每日重复浏览 True是False否
-        :return 
-        :last_editors: HuangJianYi
-        """
-        task_info_list = self.get_task_info_dict_list(app_id,act_id,module_id,1)
-        task_count_model = TaskCountModel(sub_table=self.get_business_sub_table("task_count_tb",{"app_id":app_id}),context=self.context)
-        task_count_list = task_count_model.get_list("act_id=%s and module_id=%s and user_id=%s", params=[act_id, module_id, user_id])
-        now_day = TimeExHelper.get_now_day_int()
-        result_list = []
-        for task_info_dict in task_info_list:
-            if task_types:
-                if str(task_info_dict["task_type"]) not in task_types.split(','):
-                    continue
-            config_json = SevenHelper.json_loads(task_info_dict["config_json"])
-            if not config_json:
-                continue
-            result = self.convert_task_node(task_info_dict["id"],
-                                       task_info_dict["sort_index"],
-                                       task_info_dict["task_type"],
-                                       SevenHelper.get_enum_key(TaskType, task_info_dict["task_type"]),
-                                       task_info_dict["task_name"]
-                                       )
-            if result["task_type"] == TaskType.weekly_sign.value:
-                if isinstance(config_json["day_list"],list):
-                    result["data"] = query(config_json["day_list"]).select(lambda x: int(x["day"])).to_list()
-                    result["reward_value"] = query(config_json["day_list"]).select(lambda x: int(x["reward_value"])).to_list()
-                else:
-                    result["data"] = list(config_json["day_list"].keys())
-                    result["reward_value"] = list(config_json["day_list"].values())
-
-            elif result["task_type"] in [TaskType.cumulative_sign.value, TaskType.successive_sign.value]:
-                if isinstance(config_json["day_list"],list):
-                    if len(config_json["day_list"]) == 0:
-                        result["reward_value"] = 0
-                    elif config_json["day_list"] == 1:
-                        result["data"] = [config_json["day_list"][0]["day"]]
-                        result["reward_value"] = config_json["day_list"][0]["reward_value"]
-                        result["total"] = int(result["data"][0])
-                    else:
-                        result["data"] = query(config_json["day_list"]).select(lambda x: int(x["day"])).to_list()
-                        result["reward_value"] = query(config_json["day_list"]).select(lambda x: int(x["reward_value"])).to_list()
-                else:
-                    result["data"] = list(config_json["day_list"].keys())
-                    if len(result["data"]) == 0:
-                        result["reward_value"] = 0
-                    elif len(result["data"]) == 1:
-                        result["total"] = int(result["data"][0])
-                        result["reward_value"] = config_json["day_list"][str(result["data"][0])]
-                    else:
-                        result["reward_value"] = list(config_json["day_list"].values())
-
-            else:
-                result["reward_value"] = int(config_json["reward_value"]) if config_json.__contains__("reward_value") else 0
-
-            complete_type_name = self.get_complete_type_name(task_info_dict["complete_type"]) # 完成类型名称
-            task_count = self.init_task_count(task_info_dict, task_count_list)
-
-            #掌柜有礼、免费领取、新人有礼
-            if task_info_dict["task_type"] == TaskType.free_gift.value:
-                limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
-                result["complete_count"] = limit_num #可以完成的次数
-                result["current_complete_count"] = task_count.complete_count #当前完成的次数
-                result["current"] = task_count.complete_count
-                result["status"] = 1 if task_count.complete_count >= limit_num else 0
-                result["btn_text"] = ["领取", "已领取"]
-                result["route_url"] = "free_gift"
-                result_list.append(result)
-            #单次签到
-            elif task_info_dict["task_type"] == TaskType.one_sign.value:
-                result["current_complete_count"] = task_count.complete_count #当前完成的次数
-                result["current"] = task_count.complete_count
-                result["status"] = 1 if task_count.complete_count > 0 else 0
-                result["btn_text"] = ["签到", "已签到"]
-                result["route_url"] = "one_sign"
-                result_list.append(result)
-            #每周签到(status:0当天未签到1当天已签到2已完成)
-            elif task_info_dict["task_type"] == TaskType.weekly_sign.value:
-                result["current"] = task_count.complete_count
-                if isinstance(config_json["day_list"],list):
-                    max_sign_day = max(query(config_json["day_list"]).select(lambda x: int(x["day"])).to_list())
-                else:
-                    max_sign_day = int(max(config_json["day_list"])) if len(config_json["day_list"].keys()) > 0 else 0
-                if task_count.complete_count >= max_sign_day:
-                    result["status"] = 2
-                else:
-                    result["status"] = 1 if task_count.modify_day == now_day else 0
-                result["total"] = max_sign_day
-                result["complete_count"] = 1 #可以完成的次数
-                result["current_complete_count"] = 1 if task_count.complete_count == max_sign_day else 0 #当前完成的次数
-                result["btn_text"] = ["签到", "已签到","已完成"]
-                result["route_url"] = "weekly_sign"
-                result_list.append(result)
-            #累计签到(status:0当天未签到1当天已签到2已完成)
-            elif task_info_dict["task_type"] == TaskType.cumulative_sign.value:
-                result["current"] = task_count.complete_count
-                if isinstance(config_json["day_list"],list):
-                    max_sign_day = max(query(config_json["day_list"]).select(lambda x: int(x["day"])).to_list())
-                else:
-                    max_sign_day = int(max(config_json["day_list"])) if len(config_json["day_list"].keys()) > 0 else 0
-                if task_count.complete_count >= max_sign_day:
-                    result["status"] = 2
-                else:
-                    result["status"] = 1 if task_count.modify_day == now_day else 0
-                result["total"] = max_sign_day
-                result["complete_count"] = 1 #可以完成的次数
-                result["current_complete_count"] = 1 if task_count.complete_count == max_sign_day else 0 #当前完成的次数
-                result["btn_text"] = ["签到", "已签到","已完成"]
-                result["route_url"] = "cumulative_sign"
-                result_list.append(result)
-            #连续签到(status:0当天未签到1当天已签到2已完成)
-            elif task_info_dict["task_type"] == TaskType.successive_sign.value:
-                result["current"] = task_count.complete_count
-                if isinstance(config_json["day_list"],list):
-                    max_sign_day = max(query(config_json["day_list"]).select(lambda x: int(x["day"])).to_list())
-                else:
-                    max_sign_day = int(max(config_json["day_list"])) if len(config_json["day_list"].keys()) > 0 else 0
-                if task_count.complete_count >= max_sign_day:
-                    result["status"] = 2
-                else:
-                    result["status"] = 1 if task_count.modify_day == now_day else 0
-                result["total"] = max_sign_day
-                result["complete_count"] = 1 #可以完成的次数
-                result["current_complete_count"] = 1 if task_count.complete_count == max_sign_day else 0 #当前完成的次数
-                result["btn_text"] = ["签到", "已签到","已完成"]
-                result["route_url"] = "successive_sign"
-                result_list.append(result)
-            #邀请新用户
-            elif task_info_dict["task_type"] == TaskType.invite_new_user.value:
-                limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
-                satisfy_num = int(config_json["satisfy_num"]) if config_json.__contains__("satisfy_num") else 0
-                get_ways = config_json["get_ways"] if config_json.__contains__("get_ways") else 1
-                if task_count.complete_count >= limit_num:
-                    result["status"] = 1
-                else:
-                    result["status"] = 0
-                invite_log_model = InviteLogModel(context=self.context)
-                invite_log_list = invite_log_model.get_cache_dict_list("act_id=%s and user_id=%s and create_day=%s", "", order_by="id desc", field="invite_avatar", params=[act_id, user_id, SevenHelper.get_now_day_int()], dependency_key=DependencyKey.invite_log_list(act_id,user_id))
-                result["data"] = invite_log_list if len(invite_log_list) > 0 else []
-                result["title"] = f"每日邀请{satisfy_num}名新用户"
-                result["total"] = satisfy_num
-                result["current"] = task_count.now_count
-                result["complete_count"] = limit_num #可以完成的次数
-                result["current_complete_count"] = task_count.complete_count #当前完成的次数
-                result["desc"] = f"{complete_type_name}完成上限{limit_num}次，当前剩余" + "{remain_complete_count}次"
-                result["get_ways"] = get_ways
-                result["btn_text"] = ["去邀请", "已完成"]
-                result["route_url"] = "task_inivite"
-                result_list.append(result)
-            #邀请加入会员
-            elif task_info_dict["task_type"] == TaskType.invite_join_member.value:
-                limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
-                satisfy_num = int(config_json["satisfy_num"]) if config_json.__contains__("satisfy_num") else 0
-                get_ways = config_json["get_ways"] if config_json.__contains__("get_ways") else 1
-                if task_count.complete_count >= limit_num:
-                    result["status"] = 1
-                else:
-                    result["status"] = 0
-                invite_log_model = InviteLogModel(context=self.context, sub_table="member")
-                invite_log_list = invite_log_model.get_cache_dict_list("act_id=%s and user_id=%s and create_day=%s", "", order_by="id desc", field="invite_avatar", params=[act_id, user_id, SevenHelper.get_now_day_int()], dependency_key=DependencyKey.invite_log_member_list(act_id,user_id))
-                result["data"] = invite_log_list if len(invite_log_list) > 0 else []
-                result["title"] = f"每日邀请{satisfy_num}名入会"
-                result["total"] = satisfy_num
-                result["current"] = task_count.now_count
-                result["complete_count"] = limit_num #可以完成的次数
-                result["current_complete_count"] = task_count.complete_count #当前完成的次数
-                result["desc"] = f"{complete_type_name}完成上限{limit_num}次，当前剩余" + "{remain_complete_count}次"
-                result["get_ways"] = get_ways
-                result["btn_text"] = ["去邀请", "已完成"]
-                result["route_url"] = "task_invite_member"
-                result_list.append(result)
-            #关注店铺
-            elif task_info_dict["task_type"] == TaskType.favor_store.value:
-                once_favor_reward = int(config_json["once_favor_reward"]) if config_json.__contains__("once_favor_reward") else 1
-                user_base_model = UserBaseModel(context=self.context)
-                user_info_dict = user_base_model.get_user_info_dict(app_id,act_id,user_id)
-                if not user_info_dict:
-                    result["status"] = 0
-                if module_id:
-                    if task_count.complete_count >= 1:
-                        result["status"] = 1
-                    elif user_info_dict["is_favor_before"] == 1 and once_favor_reward == 0:
-                        result["status"] = 1
-                    else:
-                        result["status"] = 0
-                else:
-                    if task_count.complete_count >= 1 or user_info_dict["is_favor"] == 1:
-                        result["status"] = 1
-                    elif user_info_dict["is_favor_before"] == 1 and once_favor_reward == 0:
-                        result["status"] = 1
-                    else:
-                        result["status"] = 0
-                result["current_complete_count"] = task_count.complete_count #当前完成的次数
-                result["btn_text"] = ["去关注", "已关注"]
-                result["route_url"] = "task_favor"
-                result_list.append(result)
-            #加入会员
-            elif task_info_dict["task_type"] == TaskType.join_member.value:
-                once_member_reward = int(config_json["once_member_reward"]) if config_json.__contains__("once_member_reward") else 1
-                user_base_model = UserBaseModel(context=self.context)
-                user_info_dict = user_base_model.get_user_info_dict(app_id,act_id,user_id)
-                if not user_info_dict:
-                    result["status"] = 0
-                if module_id:
-                    if task_count.complete_count >= 1:
-                        result["status"] = 1
-                    elif user_info_dict["is_member_before"] == 1 and once_member_reward == 0:
-                        result["status"] = 1
-                    else:
-                        result["status"] = 0
-                else:
-                    if task_count.complete_count >= 1 or user_info_dict["is_member"] == 1:
-                        result["status"] = 1
-                    elif user_info_dict["is_member_before"] == 1 and once_member_reward == 0:
-                        result["status"] = 1
-                    else:
-                        result["status"] = 0
-                result["current_complete_count"] = task_count.complete_count #当前完成的次数
-                result["btn_text"] = ["立即入会", "已领取"]
-                result["route_url"] = "task_member"
-                result_list.append(result)
-            #收藏商品
-            elif task_info_dict["task_type"] == TaskType.collect_goods.value:
-                get_ways = config_json["get_ways"] if config_json.__contains__("get_ways") else 1
-                collect_log_model = CollectLogModel(context=self.context)
-                condition = "act_id=%s and user_id=%s"
-                params = [act_id, user_id]
-                user_goods_list = collect_log_model.get_cache_list(condition, params=params,dependency_key=DependencyKey.collect_log(act_id,user_id))
-                result["data"] = config_json["goods_list"] if config_json.__contains__("goods_list") else []
-                result["completed_ids"] = [str(i.goods_id) for i in user_goods_list] if len(user_goods_list) > 0 else []
-                result["current"] = task_count.now_count
-                result["total"] = len(result["data"])
-                result["status"] = 1 if len(result["data"]) == len(result["completed_ids"]) else 0
-                result["get_ways"] = get_ways
-                result["current_complete_count"] = 1 if result["status"] == 1 else 0 #当前完成的次数
-                result["btn_text"] = ["去收藏", "已完成"]
-                result["route_url"] = "task_collect"
-                result_list.append(result)
-            #浏览商品
-            elif task_info_dict["task_type"] == TaskType.browse_goods.value:
-                get_ways = config_json["get_ways"] if config_json.__contains__("get_ways") else 1
-                browse_log_model = BrowseLogModel(context=self.context)
-                condition = "act_id=%s and user_id=%s"
-                params = [act_id,user_id]
-                if daily_repeat_browse == True:
-                    condition += " and create_day=%s"
-                    params.append(now_day)
-                user_goods_list = browse_log_model.get_cache_list(condition, params=params,dependency_key=DependencyKey.browse_log(act_id,user_id))
-                result["data"] = config_json["goods_list"] if config_json.__contains__("goods_list") else []
-                result["completed_ids"] = [str(i.goods_id) for i in user_goods_list] if len(user_goods_list) > 0 else []
-                result["current"] = task_count.now_count
-                result["total"] = len(result["data"])
-                result["status"] = 1 if len(result["data"]) == len(result["completed_ids"]) else 0
-                result["get_ways"] = get_ways
-                result["current_complete_count"] = 1 if result["status"] == 1 else 0 #当前完成的次数
-                result["btn_text"] = ["去浏览", "已完成"]
-                result["route_url"] = "task_browse"
-                result_list.append(result)
-            #分享奖励
-            elif task_info_dict["task_type"] == TaskType.share.value:
-                get_ways = config_json["get_ways"] if config_json.__contains__("get_ways") else 0
-                limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
-                satisfy_num = int(config_json["satisfy_num"]) if config_json.__contains__("satisfy_num") else 1
-                result["current"] = task_count.now_count
-                result["total"] = satisfy_num
-                if task_count.complete_count >= limit_num:
-                    result["status"] = 1
-                else:
-                    result["status"] = 0
-                result["get_ways"] = get_ways
-                result["complete_count"] = limit_num #可以完成的次数
-                result["current_complete_count"] = task_count.complete_count #当前完成的次数
-                result["btn_text"] = ["去分享","已完成"]
-                result["route_url"] = "task_share"
-                result_list.append(result)
-            #浏览店铺
-            elif task_info_dict["task_type"] == TaskType.browse_store.value:
-                get_ways = config_json["get_ways"] if config_json.__contains__("get_ways") else 1
-                limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
-                result["current"] = task_count.complete_count
-                result["status"] = 1 if task_count.complete_count >= limit_num else 0
-                result["get_ways"] = get_ways
-                result["complete_count"] = limit_num #可以完成的次数
-                result["current_complete_count"] = task_count.complete_count #当前完成的次数
-                result["btn_text"] = ["去浏览", "已完成"]
-                result["route_url"] = "task_browse_store"
-                result_list.append(result)
-            #浏览直播间
-            elif task_info_dict["task_type"] == TaskType.browse_live_room.value:
-                get_ways = config_json["get_ways"] if config_json.__contains__("get_ways") else 1
-                limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
-                result["data"] = [config_json["link_url"]] if config_json.__contains__("link_url") else []
-                result["current"] = task_count.complete_count
-                result["status"] = 1 if task_count.complete_count >= limit_num else 0
-                result["get_ways"] = get_ways
-                result["complete_count"] = limit_num #可以完成的次数
-                result["current_complete_count"] = task_count.complete_count #当前完成的次数
-                result["btn_text"] = ["去浏览", "已完成"]
-                result["route_url"] = "task_browse_liveroom"
-                result_list.append(result)
-            #邀请助力
-            elif task_info_dict["task_type"] == TaskType.invite_user_help.value:
-                get_ways = config_json["get_ways"] if config_json.__contains__("get_ways") else 1
-                limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
-                satisfy_num = int(config_json["satisfy_num"]) if config_json.__contains__("satisfy_num") else 0
-                if task_count.complete_count >= limit_num:
-                    result["status"] = 1
-                else:
-                    result["status"] = 0
-                invite_help_model = InviteHelpModel(context=self.context)
-                help_type = 1
-                help_object_id = ''
-                help_id_md5 = CryptoHelper.md5_encrypt_int(f"{app_id}_{act_id}_{module_id}_{help_type}_{help_object_id}")
-                invite_help_list = invite_help_model.get_cache_dict_list("id_md5=%s and user_id=%s", "", order_by="id desc", field="invited_avatar", params=[help_id_md5, user_id], dependency_key=DependencyKey.invite_user_help_list(help_id_md5, user_id))
-                result["data"] = invite_help_list if len(invite_help_list) > 0 else []
-                result["title"] = f"每日邀请{satisfy_num}名用户"
-                result["total"] = satisfy_num
-                result["current"] = task_count.now_count
-                result["get_ways"] = get_ways
-                result["complete_count"] = limit_num #可以完成的次数
-                result["current_complete_count"] = task_count.complete_count #当前完成的次数
-                result["btn_text"] = ["去邀请", "已完成"]
-                result["route_url"] = "task_inivite_help"
-                result_list.append(result)
-            #神秘暗号
-            elif task_info_dict["task_type"] == TaskType.secret_code.value:
-                limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
-                result["current"] = task_count.complete_count
-                result["status"] = 1 if task_count.complete_count >= limit_num else 0
-                result["complete_count"] = limit_num #可以完成的次数
-                result["current_complete_count"] = task_count.complete_count #当前完成的次数
-                result["btn_text"] = ["输入暗号", "已完成"]
-                result["route_url"] = "task_secret_code"
-                result_list.append(result)
-            #店铺会员积分兑换资产
-            elif task_info_dict["task_type"] == TaskType.crm_point_exchange_asset.value:
-                limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
-                satisfy_num = int(config_json["satisfy_num"]) if config_json.__contains__("satisfy_num") else 0
-                result["status"] = 1 if task_count.complete_count >= limit_num else 0
-                result["total"] = satisfy_num
-                result["complete_count"] = limit_num #可以完成的次数
-                result["current_complete_count"] = task_count.complete_count #当前完成的次数
-                result["btn_text"] = ["兑换", "已完成"]
-                result["route_url"] = "task_crm_exchange_asset"
-                result_list.append(result)
-            #购买指定商品
-            elif task_info_dict["task_type"] == TaskType.buy_appoint_goods.value:
-                get_ways = config_json["get_ways"] if config_json.__contains__("get_ways") else 1
-                limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
-                satisfy_num = int(config_json["satisfy_num"]) if config_json.__contains__("satisfy_num") else 0
-                remark = SevenHelper.json_loads(task_count.remark) if task_count.remark else {"goods_id_list":[]}
-                result["data"] = config_json["goods_list"] if config_json.__contains__("goods_list") else []
-                result["completed_ids"] = list(set(remark.get("goods_id_list",[])))
-                result["total"] = satisfy_num
-                result["current"] = task_count.now_count
-                if task_count.complete_count >= limit_num:
-                    result["status"] = 1
-                else:
-                    result["status"] = 0
-                result["desc"] = f"{complete_type_name}完成上限{limit_num}次，当前剩余" + "{remain_complete_count}次"
-                result["get_ways"] = get_ways
-                result["complete_count"] = limit_num #可以完成的次数
-                result["current_complete_count"] = task_count.complete_count #当前完成的次数
-                result["btn_text"] = ["去完成", "已完成"]
-                result["route_url"] = "receive_reward"
-                result_list.append(result)
-            #购买指定商品每多少金额
-            elif task_info_dict["task_type"] == TaskType.buy_appoint_goods_price.value:
-                total_price =  self.get_gear_task_count(app_id, act_id, module_id, user_id, task_info_dict["task_type"], task_info_dict["complete_type"])
-                get_ways = config_json["get_ways"] if config_json.__contains__("get_ways") else 1
-                limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
-                satisfy_num = decimal.Decimal(config_json["satisfy_num"]) if config_json.__contains__("satisfy_num") else 0
-                result["data"] = config_json["goods_list"] if config_json.__contains__("goods_list") else []
-                result["total"] = satisfy_num
-                result["current"] = decimal.Decimal(total_price) - (satisfy_num * task_count.complete_count)
-                if task_count.complete_count >= limit_num:
-                    result["status"] = 1
-                else:
-                    result["status"] = 0
-                result["desc"] = f"{complete_type_name}完成上限{limit_num}次，当前剩余" + "{remain_complete_count}次"
-                result["get_ways"] = get_ways
-                result["complete_count"] = limit_num #可以完成的次数
-                result["current_complete_count"] = task_count.complete_count #当前完成的次数
-                result["btn_text"] = ["去完成", "已完成"]
-                result["route_url"] = "receive_reward"
-                result_list.append(result)
-            #购买全店商品每多少金额
-            elif task_info_dict["task_type"] == TaskType.buy_store_price.value:
-                total_price =  self.get_gear_task_count(app_id, act_id, module_id, user_id, task_info_dict["task_type"], task_info_dict["complete_type"])
-                get_ways = config_json["get_ways"] if config_json.__contains__("get_ways") else 1
-                limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
-                satisfy_num = decimal.Decimal(config_json["satisfy_num"]) if config_json.__contains__("satisfy_num") else 0
-                result["data"] = config_json["goods_list"] if config_json.__contains__("goods_list") else []
-                result["total"] = satisfy_num
-                result["current"] = decimal.Decimal(total_price) - (satisfy_num * task_count.complete_count)
-                if task_count.complete_count >= limit_num:
-                    result["status"] = 1
-                else:
-                    result["status"] = 0
-                result["desc"] = f"{complete_type_name}完成上限{limit_num}次，当前剩余" + "{remain_complete_count}次"
-                result["get_ways"] = get_ways
-                result["complete_count"] = limit_num #可以完成的次数
-                result["current_complete_count"] = task_count.complete_count #当前完成的次数
-                result["btn_text"] = ["去完成", "已完成"]
-                result["route_url"] = "receive_reward"
-                result_list.append(result)
-            #抽盒/抽包/抽奖
-            elif task_info_dict["task_type"] == TaskType.lottery.value:
-                get_ways = config_json["get_ways"] if config_json.__contains__("get_ways") else 1
-                limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
-                satisfy_num = int(config_json["satisfy_num"]) if config_json.__contains__("satisfy_num") else 0
-                result["current"] = task_count.now_count
-                result["total"] = satisfy_num
-                result["status"] = 1 if task_count.complete_count >= limit_num else 0
-                result["get_ways"] = get_ways
-                result["complete_count"] = limit_num #可以完成的次数
-                result["current_complete_count"] = task_count.complete_count #当前完成的次数
-                result["btn_text"] = ["去完成", "已完成"]
-                result["route_url"] = "receive_reward"
-                result_list.append(result)
-            #试抽
-            elif task_info_dict["task_type"] == TaskType.lottery_try.value:
-                get_ways = config_json["get_ways"] if config_json.__contains__("get_ways") else 1
-                limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
-                satisfy_num = int(config_json["satisfy_num"]) if config_json.__contains__("satisfy_num") else 0
-                result["current"] = task_count.now_count
-                result["total"] = satisfy_num
-                result["status"] = 1 if task_count.complete_count >= limit_num else 0
-                result["get_ways"] = get_ways
-                result["complete_count"] = limit_num #可以完成的次数
-                result["current_complete_count"] = task_count.complete_count #当前完成的次数
-                result["btn_text"] = ["去完成", "已完成"]
-                result["route_url"] = "receive_reward"
-                result_list.append(result)
-            #有档位任务列表的相关累计任务
-            elif config_json.__contains__("gear_list") == True:
-                result = self.convert_gear_task_node(app_id,act_id,module_id,user_id,task_info_dict,config_json,task_count_list)
-                result_list.append(result)
-
-        return result_list,task_info_list,task_count_list
-
-    def process_receive_reward(self,app_id,act_id,module_id,user_id,login_token,task_id,task_sub_type,handler_name,request_code,task_type=0,check_new_user=False,check_user_nick=True,continue_request_expire=5,is_stat=True,info_json=None,check_act_info_release=True,check_act_module_release=True):
-        """
-        :description: 处理领取任务奖励
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_id:用户标识
-        :param login_token:访问令牌
-        :param task_id:任务标识
-        :param task_sub_type:子任务类型,对应配置里的id字段
-        :param handler_name:接口名称
-        :param request_code:请求代码
-        :param task_type:任务类型，task_type和task_id二选一，task_id有的话用task_id，没有用task_type
-        :param check_new_user:是否新用户才能领取 1是0否
-        :param check_user_nick:是否校验昵称为空
-        :param continue_request_expire:连续请求过期时间，为0不进行校验，单位秒
-        :param is_stat:是否统计上报
-        :param info_json:资产日志详细信息
-        :param check_act_info_release:校验活动信息是否发布
-        :param check_act_module_release:校验活动模块是否发布
-        :return 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        if not task_id and not task_type:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "param_error"
-            invoke_result_data.error_message = "参数错误,task_id和task_type不能同时为空"
-            return invoke_result_data
-        if task_id:
-            source_object_id = f"taskid_{task_id}"
-            acquire_lock_name = f"process_receive_reward_taskid:{act_id}_{module_id}_{task_id}_{user_id}"
-        else:
-            source_object_id = f"tasktype_{task_type}"
-            acquire_lock_name = f"process_receive_reward_tasktype:{act_id}_{module_id}_{task_type}_{user_id}"
-
-        log_title = ""
-        now_day = TimeExHelper.get_now_day_int()
-        db_transaction = DbTransaction(db_config_dict=config.get_value("db_cloudapp"),context=self.context)
-        try:
-            invoke_result_data = self.business_process_executing(app_id, act_id, module_id, user_id, login_token, handler_name, check_new_user, check_user_nick, continue_request_expire, acquire_lock_name, source_object_id=source_object_id,check_act_info_release=check_act_info_release,check_act_module_release=check_act_module_release)
-            if invoke_result_data.success == True:
-                task_invoke_result_data = self.check_task_info(act_id,module_id,task_type=task_type,task_id=task_id)
-                if task_invoke_result_data.success == True:
-                    task_info_dict = task_invoke_result_data.data
-                    config_json = task_info_dict["config_json"]
-                    if task_sub_type:
-                        sub_config_json = []
-                        if isinstance(config_json, list): # 每个子任务使用单独的计数
-                            sub_config_json = [sub_config_json for sub_config_json in config_json if str(sub_config_json["id"]) == task_sub_type]
-                        elif config_json.__contains__("gear_list") == True: # 每个子任务使用总的累加计数
-                            sub_config_json = [sub_config_json for sub_config_json in config_json["gear_list"] if str(sub_config_json["id"]) == task_sub_type]
-                        config_json = sub_config_json[0] if len(sub_config_json) > 0 else {}
-                    task_type = task_info_dict["task_type"]
-                    reward_value = int(config_json["reward_value"]) if config_json.__contains__("reward_value") else 0
-                    asset_object_id = config_json["asset_object_id"] if config_json.__contains__("asset_object_id") else ""
-                    satisfy_num = decimal.Decimal(config_json["satisfy_num"]) if config_json.__contains__("satisfy_num") else 1
-                    limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
-                    act_info_dict = invoke_result_data.data["act_info_dict"]
-                    user_info_dict = invoke_result_data.data["user_info_dict"]
-                    invoke_result_data.data["task_info_dict"] = task_info_dict
-                    task_count_model = TaskCountModel(sub_table=self.get_business_sub_table("task_count_tb",{"app_id":app_id}),db_transaction=db_transaction, context=self.context)
-                    task_count_id_md5 = self._get_task_count_id_md5(act_id,module_id,task_type,task_sub_type,user_id)
-                    task_count = task_count_model.get_entity("id_md5=%s",params=[task_count_id_md5])
-                    task_count = TaskCount() if not task_count else task_count
-                    if task_info_dict["complete_type"] == TaskCompleteType.day.value and task_count.modify_day != now_day:
-                        task_count.complete_count = 0
-                        task_count.now_count = 0
-                        task_count.remark = ""
-                    elif task_info_dict["complete_type"] == TaskCompleteType.week.value and not TimeHelper.is_this_week(task_count.modify_date):
-                        task_count.complete_count = 0
-                        task_count.now_count = 0
-                        task_count.remark = ""
-                    elif task_info_dict["complete_type"] == TaskCompleteType.month.value and not TimeHelper.is_this_month(task_count.modify_date):
-                        task_count.complete_count = 0
-                        task_count.now_count = 0
-                        task_count.remark = ""
-                    if task_type in [TaskType.buy_appoint_goods_price.value, TaskType.buy_store_price.value]:
-                        total_price =  decimal.Decimal(self.get_gear_task_count(app_id, act_id, module_id, user_id, task_type, task_info_dict["complete_type"]))
-                        task_count.now_count = total_price - (task_count.complete_count * satisfy_num)
-                    if reward_value <= 0 or task_count.now_count <= 0:
-                        invoke_result_data.success = False
-                        invoke_result_data.error_code = "error"
-                        invoke_result_data.error_message = "无法领取"
-                    elif task_count.now_count < satisfy_num:
-                        invoke_result_data.success = False
-                        invoke_result_data.error_code = "error"
-                        invoke_result_data.error_message = "任务未完成"
-                    elif task_count.complete_count >= limit_num:
-                        invoke_result_data.success = False
-                        invoke_result_data.error_code = "error"
-                        invoke_result_data.error_message = "领取奖励已达上限"
-                    else:
-                        invite_list = None
-                        collect_list = None
-                        browse_list = None
-                        invite_help_list = None
-                        if task_type in [TaskType.invite_new_user.value, TaskType.invite_join_member.value]:
-                            if task_count.complete_count + int(task_count.now_count/satisfy_num) > limit_num:
-                                cur_complete_count = limit_num - task_count.complete_count
-                            else:
-                                cur_complete_count = int(task_count.now_count / satisfy_num)
-                            reward_value = cur_complete_count * reward_value
-                            cur_now_count = task_count.now_count - (cur_complete_count * satisfy_num)
-                            if task_type == TaskType.invite_new_user.value:
-                                invite_sub_table = ""
-                            else:
-                                invite_sub_table = "member"
-                            invite_log_model = InviteLogModel(sub_table=invite_sub_table,db_transaction=db_transaction,context=self.context)
-                            #获取邀请用户数
-                            if task_info_dict["complete_type"] == 1:
-                                invite_list = invite_log_model.get_list("act_id=%s and user_id=%s and is_handle=0 and create_day=%s",limit=str(cur_complete_count * satisfy_num), params=[act_id,user_id, now_day])
-                            elif task_info_dict["complete_type"] == 2:
-                                start_day = int(TimeHelper.get_first_day_of_the_week().strftime('%Y%m%d'))
-                                end_day = int(TimeHelper.get_last_day_of_the_week().strftime('%Y%m%d'))
-                                invite_list = invite_log_model.get_list("act_id=%s and user_id=%s and is_handle=0 and create_day>=%s and create_day<=%s",limit=str(cur_complete_count * satisfy_num), params=[act_id,user_id, start_day,end_day])
-                            else:
-                                invite_list = invite_log_model.get_list("act_id=%s and user_id=%s and is_handle=0",limit=str(cur_complete_count * satisfy_num), params=[act_id,user_id])
-                            if not info_json:
-                                info_json = {}
-                                info_json["title"] = f"邀请{len(invite_list)}人"
-                                info_json["list"] = invite_list
-                            invite_user_nick_list = []
-                            for invite_log in invite_list:
-                                if invite_log.invite_user_nick:
-                                    invite_user_nick_list.append(invite_log.invite_user_nick)
-                                else:
-                                    invite_user_nick_list.append(invite_log.invite_open_id)
-                            log_title = "被邀请用户：" + ",".join(invite_user_nick_list)
-                        elif task_type == TaskType.invite_user_help.value:
-                            if task_count.complete_count + int(task_count.now_count/satisfy_num) > limit_num:
-                                cur_complete_count = limit_num - task_count.complete_count
-                            else:
-                                cur_complete_count = int(task_count.now_count / satisfy_num)
-                            reward_value = cur_complete_count * reward_value
-                            cur_now_count = task_count.now_count - (cur_complete_count * satisfy_num)
-                            invite_help_model = InviteHelpModel(db_transaction=db_transaction,context=self.context)
-                            #获取邀请用户数
-                            help_type = 1
-                            help_object_id = ''
-                            help_id_md5 = CryptoHelper.md5_encrypt_int(f"{app_id}_{act_id}_{module_id}_{help_type}_{help_object_id}")
-                            invite_help_list = invite_help_model.get_list("id_md5=%s and user_id=%s and is_handle=0",limit=str(cur_complete_count * satisfy_num), params=[help_id_md5,user_id])
-                            if not info_json:
-                                info_json = {}
-                                info_json["title"] = f"邀请{len(invite_help_list)}人"
-                                info_json["list"] = invite_help_list
-                            invited_user_nick_list = []
-                            for invite_help in invite_help_list:
-                                if invite_help.invited_user_nick:
-                                    invited_user_nick_list.append(invite_help.invited_user_nick)
-                                else:
-                                    invited_user_nick_list.append(invite.invited_open_id)
-                            log_title = "被邀请用户：" + ",".join(invited_user_nick_list)
-                        elif task_type in [TaskType.collect_goods.value, TaskType.browse_goods.value]:
-                            if task_count.complete_count + int(task_count.now_count/satisfy_num) > limit_num:
-                                cur_complete_count = limit_num - task_count.complete_count
-                            else:
-                                cur_complete_count = int(task_count.now_count / satisfy_num)
-                            reward_value = cur_complete_count * reward_value
-                            cur_now_count = task_count.now_count - (cur_complete_count * satisfy_num)
-                            if task_type == TaskType.collect_goods.value:
-                                collect_log_model = CollectLogModel(db_transaction=db_transaction,context=self.context)
-                                if task_info_dict["complete_type"] == 1:
-                                    collect_list = collect_log_model.get_list("act_id=%s and user_id=%s and is_handle=0 and create_day=%s",limit=str(cur_complete_count * satisfy_num), params=[act_id,user_id, now_day])
-                                elif task_info_dict["complete_type"] == 2:
-                                    start_day = int(TimeHelper.get_first_day_of_the_week().strftime('%Y%m%d'))
-                                    end_day = int(TimeHelper.get_last_day_of_the_week().strftime('%Y%m%d'))
-                                    collect_list = collect_log_model.get_list("act_id=%s and user_id=%s and is_handle=0 and create_day>=%s and create_day<=%s",limit=str(cur_complete_count * satisfy_num), params=[act_id,user_id, start_day,end_day])
-                                else:
-                                    collect_list = collect_log_model.get_list("act_id=%s and user_id=%s and is_handle=0",limit=str(cur_complete_count * satisfy_num), params=[act_id,user_id])
-                                if not info_json:
-                                    info_json = {}
-                                    info_json["title"] = f"收藏{len(collect_list)}个"
-                                    info_json["list"] = collect_list
-                                collect_goods_id_list = [str(i.goods_id) for i in collect_list]
-                                log_title = "被收藏商品ID：" + ",".join(collect_goods_id_list)
-                            else:
-                                browse_log_model = BrowseLogModel(db_transaction=db_transaction,context=self.context)
-                                if task_info_dict["complete_type"] == 1:
-                                    browse_list = browse_log_model.get_list("act_id=%s and user_id=%s and is_handle=0 and create_day=%s",limit=str(cur_complete_count * satisfy_num), params=[act_id,user_id, now_day])
-                                elif task_info_dict["complete_type"] == 2:
-                                    start_day = int(TimeHelper.get_first_day_of_the_week().strftime('%Y%m%d'))
-                                    end_day = int(TimeHelper.get_last_day_of_the_week().strftime('%Y%m%d'))
-                                    browse_list = browse_log_model.get_list("act_id=%s and user_id=%s and is_handle=0 and create_day>=%s and create_day<=%s",limit=str(cur_complete_count * satisfy_num), params=[act_id,user_id, start_day,end_day])
-                                else:
-                                    browse_list = browse_log_model.get_list("act_id=%s and user_id=%s and is_handle=0",limit=str(cur_complete_count * satisfy_num), params=[act_id,user_id])
-                                if not info_json:
-                                    info_json = {}
-                                    info_json["title"] = f"收藏{len(browse_list)}个"
-                                    info_json["list"] = browse_list
-                                browse_goods_id_list = [str(i.goods_id) for i in browse_list]
-                                log_title = "被浏览商品ID：" + ",".join(browse_goods_id_list)
-                        elif task_type == TaskType.buy_appoint_goods.value:
-                            if task_count.complete_count + int(task_count.now_count/satisfy_num) > limit_num:
-                                cur_complete_count = limit_num - task_count.complete_count
-                            else:
-                                cur_complete_count = int(task_count.now_count / satisfy_num)
-                            reward_value = cur_complete_count * reward_value
-                            cur_now_count = task_count.now_count - (cur_complete_count * satisfy_num)
-                            remark = SevenHelper.json_loads(task_count.remark) if task_count.remark else {"goods_id_list":[]}
-                            goods_id_list = []
-                            task_goods_id_list = remark.get("goods_id_list",[])
-                            if len(task_goods_id_list) >= (cur_complete_count * satisfy_num):
-                                start_index = 0
-                                end_index = int(cur_complete_count * satisfy_num)
-                                goods_id_list = task_goods_id_list[start_index : end_index]
-                                del task_goods_id_list[start_index : end_index]
-                            if not info_json:
-                                info_json = {}
-                                info_json["title"] = f"购买{len(goods_id_list)}个"
-                                info_json["list"] = goods_id_list
-                            log_title = "购买商品ID：" + ",".join(goods_id_list)
-                            task_count.remark = SevenHelper.json_dumps({"goods_id_list":task_goods_id_list})
-                        else:
-                            if task_count.complete_count + int(task_count.now_count/satisfy_num) > limit_num:
-                                cur_complete_count = limit_num - task_count.complete_count
-                            else:
-                                cur_complete_count = int(task_count.now_count / satisfy_num)
-                            reward_value = cur_complete_count * reward_value
-                            cur_now_count = task_count.now_count - (cur_complete_count * satisfy_num)
-
-                        if invoke_result_data.success == True:
-                            try:
-                                db_transaction.begin_transaction()
-                                task_count.complete_count += cur_complete_count
-                                task_count.now_count = cur_now_count
-
-                                #更新邀请记录表
-                                if invite_list:
-                                    for invite in invite_list:
-                                        invite.is_handle = 1
-                                    invite_log_model.update_list(invite_list, "is_handle")
-                                #更新收藏记录表
-                                elif collect_list:
-                                    for collect in collect_list:
-                                        collect.is_handle = 1
-                                    collect_log_model.update_list(collect_list, "is_handle")
-                                #更新浏览记录表
-                                elif browse_list:
-                                    for browse in browse_list:
-                                        browse.is_handle = 1
-                                    browse_log_model.update_list(browse_list, "is_handle")
-                                #更新邀请助力记录表
-                                elif invite_help_list:
-                                    for invite_help in invite_help_list:
-                                        invite_help.is_handle = 1
-                                    invite_help_model.update_list(invite_help_list, "is_handle")
-
-                                #更新任务计数表
-                                task_count_model.update_entity(task_count, "complete_count,now_count,remark")
-                                result,message = db_transaction.commit_transaction(True)
-                                if result == False:
-                                    raise Exception("执行事务失败",message)
-                            except Exception as ex:
-                                if self.context:
-                                    self.context.logging_link_error("【领取任务奖励】" + traceback.format_exc())
-                                elif self.logging_link_error:
-                                    self.logging_link_error("【领取任务奖励】" + traceback.format_exc())
-                                self.business_process_executed()
-                                invoke_result_data.success = False
-                                invoke_result_data.error_code = "exception"
-                                invoke_result_data.error_message = "系统繁忙,请稍后再试"
-                                return invoke_result_data
-
-                            reward_object_id = asset_object_id
-                            reward_name = config_json.get("reward_name","")
-                            task_reward_type = config_json.get("reward_type", TaskRewardType.asset.value)
-                            #奖励类型为资产走资产系统
-                            if task_reward_type == TaskRewardType.asset.value:
-                                only_id = self.get_only_id(user_id,task_info_dict["complete_type"],task_info_dict["task_type"],task_sub_type,task_count.complete_count)
-                                if module_id > 0:
-                                    only_id = f"{module_id}_{only_id}"
-                                asset_type = self.get_task_asset_type(act_info_dict["task_asset_type_json"],task_info_dict["task_type"])
-                                reward_object_id = asset_type
-                                asset_base_model = AssetBaseModel(context=self.context)
-                                log_title = log_title if log_title else task_info_dict["task_name"]
-                                asset_invoke_result_data = asset_base_model.update_user_asset(app_id,act_id,module_id,user_id,user_info_dict["open_id"],user_info_dict["user_nick"],asset_type,reward_value,asset_object_id,2,task_info_dict["task_type"],task_info_dict["task_name"],log_title,only_id,handler_name,request_code,info_json=info_json)
-                                if asset_invoke_result_data.success == False:
-                                    reward_value = 0
-                            invoke_result_data.data["config_json"] = config_json
-                            invoke_result_data.data["reward_value"] = reward_value
-
-                            self.add_task_stat(task_type, app_id, act_id, module_id, user_info_dict["user_id"], user_info_dict["open_id"], reward_value, is_stat, cur_complete_count)
-                            self.add_task_log(task_type=task_type, task_sub_type=task_sub_type, app_id=app_id, act_id=act_id, module_id=module_id, user_id=user_info_dict["user_id"], open_id=user_info_dict["open_id"], user_nick=user_info_dict["user_nick"],task_name=task_info_dict["task_name"],log_title=log_title,reward_type=task_reward_type, reward_object_id=reward_object_id, reward_name=reward_name, reward_num=reward_value, handler_name=handler_name, request_code=request_code, info_json=info_json)
-                else:
-                    invoke_result_data.success = False
-                    invoke_result_data.error_code = task_invoke_result_data.error_code
-                    invoke_result_data.error_message = task_invoke_result_data.error_message
-        except Exception as ex:
-            if self.context:
-                self.context.logging_link_error("【领取任务奖励】" + traceback.format_exc())
-            elif self.logging_link_error:
-                self.logging_link_error("【领取任务奖励】" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "exception"
-            invoke_result_data.error_message = "系统繁忙,请稍后再试"
-
-        self.business_process_executed()
-
-        return invoke_result_data
-
-    def process_free_gift(self,app_id,act_id,module_id,user_id,login_token,handler_name,request_code,check_new_user=False,check_user_nick=True,continue_request_expire=5,is_stat=True,info_json=None):
-        """
-        :description: 处理掌柜有礼、新人有礼、免费领取等相似任务
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_id:用户标识
-        :param login_token:访问令牌
-        :param handler_name:接口名称
-        :param request_code:请求代码
-        :param check_new_user:是否新用户才能领取 1是0否
-        :param check_user_nick:是否校验昵称为空
-        :param continue_request_expire:连续请求过期时间，为0不进行校验，单位秒
-        :param is_stat:是否统计上报
-        :param info_json:资产日志详细信息
-        :return 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        acquire_lock_name = f"process_free_gift:{act_id}_{module_id}_{user_id}"
-        task_type = TaskType.free_gift.value
-        now_day = TimeExHelper.get_now_day_int()
-        now_datetime = TimeHelper.get_now_format_time()
-        if not info_json:
-            info_json = {}
-        try:
-            invoke_result_data = self.business_process_executing(app_id,act_id,module_id,user_id,login_token,handler_name,check_new_user,check_user_nick,continue_request_expire,acquire_lock_name)
-            if invoke_result_data.success == True:
-                task_invoke_result_data = self.check_task_info(act_id,module_id,task_type)
-                if task_invoke_result_data.success == True:
-                    task_info_dict = task_invoke_result_data.data
-                    config_json = task_info_dict["config_json"]
-                    reward_value = int(config_json["reward_value"]) if config_json.__contains__("reward_value") else 0
-                    limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
-                    asset_object_id = config_json["asset_object_id"] if config_json.__contains__("asset_object_id") else ""
-                    act_info_dict = invoke_result_data.data["act_info_dict"]
-                    act_module_dict = invoke_result_data.data["act_module_dict"]
-                    user_info_dict = invoke_result_data.data["user_info_dict"]
-                    task_count_model = TaskCountModel(sub_table=self.get_business_sub_table("task_count_tb",{"app_id":app_id}),context=self.context)
-                    task_count_id_md5 = self._get_task_count_id_md5(act_id,module_id,task_info_dict["task_type"],"",user_id)
-                    task_count = task_count_model.get_entity("id_md5=%s",params=[task_count_id_md5])
-                    task_count = TaskCount() if not task_count else task_count
-                    limit_meaasge = ""
-                    if task_info_dict["complete_type"] == 1:
-                        limit_meaasge = "今日领取上限"
-                        if task_count.modify_day != now_day:
-                            task_count.complete_count = 0
-                            task_count.now_count = 0
-                    elif task_info_dict["complete_type"] == 2:
-                        limit_meaasge = "每周领取上限"
-                        if TimeHelper.is_this_week(task_count.modify_date) == False:
-                            task_count.complete_count = 0
-                            task_count.now_count = 0
-                    else:
-                        limit_meaasge = "领取上限"
-                    is_limit = True if task_count.complete_count >= limit_num else False
-                    if is_limit == True:
-                        invoke_result_data.success = False
-                        invoke_result_data.error_code = "error"
-                        invoke_result_data.error_message = limit_meaasge
-                    else:
-                        task_count.id_md5 = task_count_id_md5
-                        task_count.app_id = app_id
-                        task_count.act_id = act_id
-                        task_count.module_id = module_id
-                        task_count.user_id = user_id
-                        task_count.open_id = user_info_dict["open_id"]
-                        task_count.task_type = task_type
-                        task_count.task_sub_type = ""
-                        task_count.complete_count = task_count.complete_count+1
-                        task_count.now_count = 0
-                        task_count.create_date = now_datetime
-                        task_count.modify_date = now_datetime
-                        task_count.modify_day = now_day
-                        task_count_model.add_update_entity(task_count,"complete_count=%s,modify_date=%s,modify_day=%s",params=[task_count.complete_count,task_count.modify_date,now_day])
-
-                        reward_object_id = ""
-                        if reward_value > 0:
-                            only_id = self.get_only_id(user_id,task_info_dict["complete_type"],task_type,complete_count=task_count.complete_count)
-                            if module_id > 0:
-                                only_id = f"{module_id}_{only_id}"
-                            asset_type = self.get_task_asset_type(act_info_dict["task_asset_type_json"],task_type)
-                            reward_object_id = asset_type
-                            asset_base_model = AssetBaseModel(context=self.context)
-                            asset_invoke_result_data = asset_base_model.update_user_asset(app_id,act_id,module_id,user_id,user_info_dict["open_id"],user_info_dict["user_nick"],asset_type,reward_value,asset_object_id,2,task_type,task_info_dict["task_name"],task_info_dict["task_name"],only_id,handler_name,request_code,info_json=info_json)
-                            if asset_invoke_result_data.success == False:
-                                reward_value = 0
-                        invoke_result_data.data["reward_value"] = reward_value
-                        self.add_task_stat(task_type, app_id, act_id, module_id, user_info_dict["user_id"], user_info_dict["open_id"], reward_value, is_stat)
-                        self.add_task_log(task_type=task_type, task_sub_type='', app_id=app_id, act_id=act_id, module_id=module_id, user_id=user_info_dict["user_id"], open_id=user_info_dict["open_id"], user_nick=user_info_dict["user_nick"],task_name=task_info_dict["task_name"],log_title=task_info_dict["task_name"],reward_type=1, reward_object_id=reward_object_id, reward_name="", reward_num=reward_value, handler_name=handler_name, request_code=request_code, info_json=info_json)
-                else:
-                    invoke_result_data.success = False
-                    invoke_result_data.error_code = task_invoke_result_data.error_code
-                    invoke_result_data.error_message = task_invoke_result_data.error_message
-        except Exception as ex:
-            self.context.logging_link_error("【掌柜有礼任务】" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "exception"
-            invoke_result_data.error_message = "系统繁忙,请稍后再试"
-
-        self.business_process_executed()
-
-        return invoke_result_data
-
-    def process_one_sign(self,app_id,act_id,module_id,user_id,login_token,handler_name,request_code,check_new_user=False,check_user_nick=True,continue_request_expire=5,is_stat=True,info_json=None):
-        """
-        :description: 处理单次签到任务
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_id:用户标识
-        :param login_token:访问令牌
-        :param handler_name:接口名称
-        :param request_code:请求代码
-        :param check_new_user:是否新用户才能领取 1是0否
-        :param check_user_nick:是否校验昵称为空
-        :param continue_request_expire:连续请求过期时间，为0不进行校验，单位秒
-        :param is_stat:是否统计上报
-        :param info_json:资产日志详细信息
-        :return 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        acquire_lock_name = f"process_one_sign:{act_id}_{module_id}_{user_id}"
-        task_type = TaskType.one_sign.value
-        now_day = TimeExHelper.get_now_day_int()
-        now_datetime = TimeHelper.get_now_format_time()
-        if not info_json:
-            info_json = {}
-        try:
-            invoke_result_data = self.business_process_executing(app_id,act_id,module_id,user_id,login_token,handler_name,check_new_user,check_user_nick,continue_request_expire,acquire_lock_name)
-            if invoke_result_data.success == True:
-                task_invoke_result_data = self.check_task_info(act_id,module_id,task_type)
-                if task_invoke_result_data.success == True:
-                    task_info_dict = task_invoke_result_data.data
-                    config_json = task_info_dict["config_json"]
-                    reward_value = int(config_json["reward_value"]) if config_json.__contains__("reward_value") else 0
-                    asset_object_id = config_json["asset_object_id"] if config_json.__contains__("asset_object_id") else ""
-                    act_info_dict = invoke_result_data.data["act_info_dict"]
-                    act_module_dict = invoke_result_data.data["act_module_dict"]
-                    user_info_dict = invoke_result_data.data["user_info_dict"]
-                    task_count_model = TaskCountModel(sub_table=self.get_business_sub_table("task_count_tb",{"app_id":app_id}),context=self.context)
-                    task_count_id_md5 = self._get_task_count_id_md5(act_id,module_id,task_info_dict["task_type"],"",user_id)
-                    task_count = task_count_model.get_entity("id_md5=%s",params=[task_count_id_md5])
-                    task_count = TaskCount() if not task_count else task_count
-                    if task_info_dict["complete_type"] == 1 and task_count.modify_day == now_day:
-                        invoke_result_data.success = False
-                        invoke_result_data.error_code = "error"
-                        invoke_result_data.error_message = "今日已签到"
-                    elif task_info_dict["complete_type"] == 2 and TimeHelper.is_this_week(task_count.modify_date):
-                        invoke_result_data.success = False
-                        invoke_result_data.error_code = "error"
-                        invoke_result_data.error_message = "本周已签到"
-                    elif task_info_dict["complete_type"] == 3 and task_count:
-                        invoke_result_data.success = False
-                        invoke_result_data.error_code = "error"
-                        invoke_result_data.error_message = "已签到"
-                    else:
-                        task_count.id_md5 = task_count_id_md5
-                        task_count.app_id = app_id
-                        task_count.act_id = act_id
-                        task_count.module_id = module_id
-                        task_count.user_id = user_id
-                        task_count.open_id = user_info_dict["open_id"]
-                        task_count.task_type = task_type
-                        task_count.task_sub_type = ""
-                        task_count.complete_count = 1
-                        task_count.now_count = 1
-                        task_count.create_date = now_datetime
-                        task_count.modify_date = now_datetime
-                        task_count.modify_day = now_day
-                        task_count_model.add_update_entity(task_count,"complete_count=1,now_count=1,modify_date=%s,modify_day=%s",params=[task_count.modify_date,now_day])
-                        reward_object_id = ""
-                        if reward_value > 0:
-                            only_id = self.get_only_id(user_id,task_info_dict["complete_type"],task_type,complete_count=task_count.complete_count)
-                            if module_id > 0:
-                                only_id = f"{module_id}_{only_id}"
-                            asset_type = self.get_task_asset_type(act_info_dict["task_asset_type_json"],task_type)
-                            reward_object_id = asset_type
-                            asset_base_model = AssetBaseModel(context=self.context)
-                            asset_invoke_result_data = asset_base_model.update_user_asset(app_id,act_id,module_id,user_id,user_info_dict["open_id"],user_info_dict["user_nick"],asset_type,reward_value,asset_object_id,2,task_type,task_info_dict["task_name"],"签到1天",only_id,handler_name,request_code,info_json=info_json)
-                            if asset_invoke_result_data.success == False:
-                                reward_value = 0
-                        invoke_result_data.data["reward_value"] = reward_value
-                        self.add_task_stat(task_type,app_id, act_id, module_id, user_info_dict["user_id"], user_info_dict["open_id"], reward_value, is_stat)
-                        self.add_task_log(task_type=task_type, task_sub_type='', app_id=app_id, act_id=act_id, module_id=module_id, user_id=user_info_dict["user_id"], open_id=user_info_dict["open_id"], user_nick=user_info_dict["user_nick"],task_name=task_info_dict["task_name"],log_title=log_title,reward_type=1, reward_object_id=reward_object_id, reward_name="", reward_num=reward_value, handler_name=handler_name, request_code=request_code, info_json=info_json)
-                else:
-                    invoke_result_data.success = False
-                    invoke_result_data.error_code = task_invoke_result_data.error_code
-                    invoke_result_data.error_message = task_invoke_result_data.error_message
-        except Exception as ex:
-            self.context.logging_link_error("【单次签到任务】" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "exception"
-            invoke_result_data.error_message = "系统繁忙,请稍后再试"
-
-        self.business_process_executed()
-
-        return invoke_result_data
-
-    def process_weekly_sign(self,app_id,act_id,module_id,user_id,login_token,handler_name,request_code,check_new_user=False,check_user_nick=True,continue_request_expire=5,is_stat=True,info_json=None,check_act_info_release=True,check_act_module_release=True):
-        """
-        :description: 处理每周签到任务
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_id:用户标识
-        :param login_token:访问令牌
-        :param handler_name:接口名称
-        :param request_code:请求代码
-        :param check_new_user:是否新用户才能领取 1是0否
-        :param check_user_nick:是否校验昵称为空
-        :param continue_request_expire:连续请求过期时间，为0不进行校验，单位秒
-        :param is_stat:是否统计上报
-        :param info_json:资产日志详细信息
-        :param check_act_info_release:校验活动信息是否发布
-        :param check_act_module_release:校验活动模块是否发布
-        :return 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        acquire_lock_name = f"process_weekly_sign:{act_id}_{module_id}_{user_id}"
-        task_type = TaskType.weekly_sign.value
-        now_day = TimeExHelper.get_now_day_int()
-        now_datetime = TimeHelper.get_now_format_time()
-        if not info_json:
-            info_json = {}
-        try:
-            invoke_result_data = self.business_process_executing(app_id,act_id,module_id,user_id,login_token,handler_name,check_new_user,check_user_nick,continue_request_expire,acquire_lock_name,check_act_info_release=check_act_info_release,check_act_module_release=check_act_module_release)
-            if invoke_result_data.success == True:
-                task_invoke_result_data = self.check_task_info(act_id,module_id,task_type)
-                if task_invoke_result_data.success == True:
-                    task_info_dict = task_invoke_result_data.data
-                    config_json = task_info_dict["config_json"]
-                    asset_object_id = config_json["asset_object_id"] if config_json.__contains__("asset_object_id") else ""
-                    day_list = config_json["day_list"] if config_json.__contains__("day_list") else {}
-                    act_info_dict = invoke_result_data.data["act_info_dict"]
-                    act_module_dict = invoke_result_data.data["act_module_dict"]
-                    user_info_dict = invoke_result_data.data["user_info_dict"]
-                    task_count_model = TaskCountModel(sub_table=self.get_business_sub_table("task_count_tb",{"app_id":app_id}),context=self.context)
-                    task_count_id_md5 = self._get_task_count_id_md5(act_id,module_id,task_info_dict["task_type"],"",user_id)
-                    task_count = task_count_model.get_entity("id_md5=%s",params=[task_count_id_md5])
-                    task_count = TaskCount() if not task_count else task_count
-                    if task_count.modify_day == now_day:
-                        invoke_result_data.success = False
-                        invoke_result_data.error_code = "error"
-                        invoke_result_data.error_message = "今日已签到"
-                    else:
-                        task_count.id_md5 = task_count_id_md5
-                        task_count.app_id = app_id
-                        task_count.act_id = act_id
-                        task_count.module_id = module_id
-                        task_count.user_id = user_id
-                        task_count.open_id = user_info_dict["open_id"]
-                        task_count.task_type = task_type
-                        task_count.task_sub_type = ""
-                        task_count.complete_count = task_count.complete_count+1 if TimeHelper.is_this_week(task_count.modify_date) else 1
-                        task_count.now_count = 1
-                        task_count.create_date = now_datetime
-                        task_count.modify_date = now_datetime
-                        task_count.modify_day = now_day
-                        task_count_model.add_update_entity(task_count,"complete_count=%s,now_count=%s,modify_date=%s,modify_day=%s",params=[task_count.complete_count,task_count.now_count,task_count.modify_date,now_day])
-                        if isinstance(day_list,list):
-                            cur_day = query(day_list).first_or_default(None,lambda x: int(x["day"]) == task_count.complete_count)
-                            if cur_day:
-                                reward_value = int(cur_day["reward_value"])
-                            else:
-                                reward_value = 0
-                        else:
-                            reward_value = int(day_list[str(task_count.complete_count)]) if day_list.__contains__(str(task_count.complete_count)) else 0
-                        reward_object_id = ""
-                        if reward_value > 0:
-                            only_id = self.get_only_id(user_id,2,task_type,complete_count=task_count.complete_count)
-                            if module_id > 0:
-                                only_id = f"{module_id}_{only_id}"
-                            asset_type = self.get_task_asset_type(act_info_dict["task_asset_type_json"],task_type)
-                            reward_object_id = asset_type
-                            asset_base_model = AssetBaseModel(context=self.context)
-                            asset_invoke_result_data = asset_base_model.update_user_asset(app_id,act_id,module_id,user_id,user_info_dict["open_id"],user_info_dict["user_nick"],asset_type,reward_value,asset_object_id,2,task_type,task_info_dict["task_name"],f"签到{task_count.complete_count}天",only_id,handler_name,request_code,info_json=info_json)
-                            if asset_invoke_result_data.success == False:
-                                reward_value = 0
-                        invoke_result_data.data["reward_value"] = reward_value
-                        self.add_task_stat(task_type,app_id, act_id, module_id, user_info_dict["user_id"], user_info_dict["open_id"], reward_value, is_stat)
-                        self.add_task_log(task_type=task_type, task_sub_type='', app_id=app_id, act_id=act_id, module_id=module_id, user_id=user_info_dict["user_id"], open_id=user_info_dict["open_id"], user_nick=user_info_dict["user_nick"],task_name=task_info_dict["task_name"],log_title=f"签到{task_count.complete_count}天",reward_type=1, reward_object_id=reward_object_id, reward_name="", reward_num=reward_value, handler_name=handler_name, request_code=request_code, info_json=info_json)
-                else:
-                    invoke_result_data.success = False
-                    invoke_result_data.error_code = task_invoke_result_data.error_code
-                    invoke_result_data.error_message = task_invoke_result_data.error_message
-        except Exception as ex:
-            self.context.logging_link_error("【每周签到任务】" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "exception"
-            invoke_result_data.error_message = "系统繁忙,请稍后再试"
-
-        self.business_process_executed()
-
-        return invoke_result_data
-
-    def process_cumulative_sign(self,app_id,act_id,module_id,user_id,login_token,handler_name,request_code,check_new_user=False,check_user_nick=True,continue_request_expire=5,is_stat=True,info_json=None,task_type=0):
-        """
-        :description: 处理累计签到任务
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_id:用户标识
-        :param login_token:访问令牌
-        :param handler_name:接口名称
-        :param request_code:请求代码
-        :param check_new_user:是否新用户才能领取 1是0否
-        :param check_user_nick:是否校验昵称为空
-        :param continue_request_expire:连续请求过期时间，为0不进行校验，单位秒
-        :param is_stat:是否统计上报
-        :param info_json:资产日志详细信息
-        :param task_type:任务类型
-        :return 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        acquire_lock_name = f"process_cumulative_sign:{act_id}_{module_id}_{user_id}"
-        task_type = TaskType.cumulative_sign.value if task_type == 0 else task_type
-        now_day = TimeExHelper.get_now_day_int()
-        now_datetime = TimeHelper.get_now_format_time()
-        if not info_json:
-            info_json = {}
-        try:
-            invoke_result_data = self.business_process_executing(app_id,act_id,module_id,user_id,login_token,handler_name,check_new_user,check_user_nick,continue_request_expire,acquire_lock_name)
-            if invoke_result_data.success == True:
-                task_invoke_result_data = self.check_task_info(act_id,module_id,task_type)
-                if task_invoke_result_data.success == True:
-                    task_info_dict = task_invoke_result_data.data
-                    config_json = task_info_dict["config_json"]
-                    asset_object_id = config_json["asset_object_id"] if config_json.__contains__("asset_object_id") else ""
-                    day_list = config_json["day_list"] if config_json.__contains__("day_list") else {}
-                    act_info_dict = invoke_result_data.data["act_info_dict"]
-                    act_module_dict = invoke_result_data.data["act_module_dict"]
-                    user_info_dict = invoke_result_data.data["user_info_dict"]
-                    task_count_model = TaskCountModel(sub_table=self.get_business_sub_table("task_count_tb",{"app_id":app_id}),context=self.context)
-                    task_count_id_md5 = self._get_task_count_id_md5(act_id,module_id,task_info_dict["task_type"],"",user_id)
-                    task_count = task_count_model.get_entity("id_md5=%s",params=[task_count_id_md5])
-                    task_count = TaskCount() if not task_count else task_count
-                    if task_count.modify_day == now_day:
-                        invoke_result_data.success = False
-                        invoke_result_data.error_code = "error"
-                        invoke_result_data.error_message = "今日已签到"
-                    else:
-                        task_count.id_md5 = task_count_id_md5
-                        task_count.app_id = app_id
-                        task_count.act_id = act_id
-                        task_count.module_id = module_id
-                        task_count.user_id = user_id
-                        task_count.open_id = user_info_dict["open_id"]
-                        task_count.task_type = task_type
-                        task_count.task_sub_type = ""
-
-                        if isinstance(day_list,list):
-                            max_sign_day = max(query(day_list).select(lambda x: int(x["day"])).to_list())
-                        else:
-                            max_sign_day = int(max(day_list)) if len(day_list.keys()) > 0 else 0
-                        if task_count.complete_count == max_sign_day:
-                            invoke_result_data.success = False
-                            invoke_result_data.error_code = "error"
-                            invoke_result_data.error_message = "任务已完成"
-                        else:
-                            task_count.complete_count = task_count.complete_count+1 if task_count.complete_count < max_sign_day else 1
-                            task_count.now_count = 1
-                            task_count.create_date = now_datetime
-                            task_count.modify_date = now_datetime
-                            task_count.modify_day = now_day
-                            task_count_model.add_update_entity(task_count,"complete_count=%s,now_count=%s,modify_date=%s,modify_day=%s",params=[task_count.complete_count,task_count.now_count,task_count.modify_date,now_day])
-                            if isinstance(day_list,list):
-                                cur_day = query(day_list).first_or_default(None,lambda x: int(x["day"]) == task_count.complete_count)
-                                if cur_day:
-                                    reward_value = int(cur_day["reward_value"])
-                                else:
-                                    reward_value = 0
-                            else:
-                                reward_value = int(day_list[str(task_count.complete_count)]) if day_list.__contains__(str(task_count.complete_count)) else 0
-                            reward_object_id = ""
-                            if reward_value > 0:
-                                only_id = self.get_only_id(user_id,3,task_type,complete_count=task_count.complete_count)
-                                if module_id > 0:
-                                    only_id = f"{module_id}_{only_id}"
-                                asset_type = self.get_task_asset_type(act_info_dict["task_asset_type_json"],task_type)
-                                reward_object_id = asset_type
-                                asset_base_model = AssetBaseModel(context=self.context)
-                                asset_invoke_result_data = asset_base_model.update_user_asset(app_id,act_id,module_id,user_id,user_info_dict["open_id"],user_info_dict["user_nick"],asset_type,reward_value,asset_object_id,2,task_type,task_info_dict["task_name"],f"签到{task_count.complete_count}天",only_id,handler_name,request_code,info_json=info_json)
-                                if asset_invoke_result_data.success == False:
-                                    reward_value = 0
-                            invoke_result_data.data["reward_value"] = reward_value
-                            self.add_task_stat(task_type,app_id, act_id, module_id, user_info_dict["user_id"], user_info_dict["open_id"], reward_value, is_stat)
-                            self.add_task_log(task_type=task_type, task_sub_type='', app_id=app_id, act_id=act_id, module_id=module_id, user_id=user_info_dict["user_id"], open_id=user_info_dict["open_id"], user_nick=user_info_dict["user_nick"],task_name=task_info_dict["task_name"],log_title=f"签到{task_count.complete_count}天",reward_type=1, reward_object_id=reward_object_id, reward_name="", reward_num=reward_value, handler_name=handler_name, request_code=request_code, info_json=info_json)
-                else:
-                    invoke_result_data.success = False
-                    invoke_result_data.error_code = task_invoke_result_data.error_code
-                    invoke_result_data.error_message = task_invoke_result_data.error_message
-        except Exception as ex:
-            self.context.logging_link_error("【累计签到任务】" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "exception"
-            invoke_result_data.error_message = "系统繁忙,请稍后再试"
-
-        self.business_process_executed()
-
-        return invoke_result_data
-
-    def process_invite_user(self,app_id,act_id,module_id,user_id,login_token,from_user_id,handler_name,check_user_nick=True,check_new_user=True,continue_request_expire=5,close_invite_limit=False,check_act_info_release=True,check_act_module_release=True):
-        """
-        :description: 处理邀请用户任务
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_id:当前用户标识
-        :param login_token:访问令牌
-        :param from_user_id:邀请人用户标识
-        :param handler_name:接口名称
-        :param check_user_nick:是否校验昵称为空
-        :param check_new_user:是否校验新用户
-        :param continue_request_expire:连续请求过期时间，为0不进行校验，单位秒
-        :param close_invite_limit:是否关闭邀请限制 True是 False否
-        :param check_act_info_release:校验活动信息是否发布
-        :param check_act_module_release:校验活动模块是否发布
-        :return 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        acquire_lock_name = f"process_invite_user:{act_id}_{module_id}_{user_id}"
-        task_type = TaskType.invite_new_user.value
-        now_day = TimeExHelper.get_now_day_int()
-        now_datetime = TimeHelper.get_now_format_time()
-        try:
-            invoke_result_data = InvokeResultData()
-            if user_id == from_user_id:
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "error"
-                invoke_result_data.error_message = "无效邀请"
-                return invoke_result_data
-
-            invoke_result_data = self.business_process_executing(app_id,act_id,module_id,user_id,login_token,handler_name,check_new_user,check_user_nick,continue_request_expire,acquire_lock_name,check_act_info_release=check_act_info_release,check_act_module_release=check_act_module_release)
-            if invoke_result_data.success == True:
-                act_info_dict = invoke_result_data.data["act_info_dict"]
-                act_module_dict = invoke_result_data.data["act_module_dict"]
-                user_info_dict = invoke_result_data.data["user_info_dict"]
-
-                user_base_model = UserBaseModel(context=self.context)
-                from_user_info_dict = user_base_model.get_user_info_dict(app_id,act_id,from_user_id)
-                invite_log_model = InviteLogModel(context=self.context)
-                invite_log_dict = invite_log_model.get_dict("act_id=%s and invite_user_id=%s", params=[act_id, user_id])
-                if invite_log_dict:
-                    invoke_result_data.success = False
-                    invoke_result_data.error_code = "error"
-                    invoke_result_data.error_message = "此用户已经被邀请过"
-                elif not from_user_info_dict:
-                    invoke_result_data.success = False
-                    invoke_result_data.error_code = "error"
-                    invoke_result_data.error_message = "邀请人不存在"
-                else:
-                    task_invoke_result_data = self.check_task_info(act_id,module_id,task_type)
-                    if task_invoke_result_data.success == True:
-                        task_info_dict = task_invoke_result_data.data
-                        config_json = task_info_dict["config_json"]
-                        limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
-                        satisfy_num = int(config_json["satisfy_num"]) if config_json.__contains__("satisfy_num") else 1
-                        task_count_model = TaskCountModel(sub_table=self.get_business_sub_table("task_count_tb",{"app_id":app_id}),context=self.context)
-                        task_count_id_md5 = self._get_task_count_id_md5(act_id,module_id,task_info_dict["task_type"],"",from_user_id)
-                        task_count = task_count_model.get_entity("id_md5=%s",params=[task_count_id_md5])
-                        task_count = TaskCount() if not task_count else task_count
-                        limit_meaasge = ""
-                        if task_info_dict["complete_type"] == 1:
-                            limit_meaasge = "今日邀请上限"
-                            if task_count.modify_day != now_day:
-                                task_count.complete_count = 0
-                                task_count.now_count = 0
-                        elif task_info_dict["complete_type"] == 2:
-                            limit_meaasge = "每周邀请上限"
-                            if TimeHelper.is_this_week(task_count.modify_date) == False:
-                                task_count.complete_count = 0
-                                task_count.now_count = 0
-                        else:
-                            limit_meaasge = "邀请上限"
-                        invite_count = int(task_count.complete_count * satisfy_num) + task_count.now_count
-                        is_invite_limit = True if invite_count >= limit_num else False
-                        if is_invite_limit == True and close_invite_limit == False:
-                            invoke_result_data.success = False
-                            invoke_result_data.error_code = "error"
-                            invoke_result_data.error_message = limit_meaasge
-                        else:
-                            invite_log = InviteLog()
-                            invite_log.app_id = app_id
-                            invite_log.act_id = act_id
-                            invite_log.user_id = from_user_id
-                            invite_log.open_id = from_user_info_dict["open_id"]
-                            invite_log.invite_user_id = user_info_dict["user_id"]
-                            invite_log.invite_open_id = user_info_dict["open_id"]
-                            invite_log.invite_user_nick = user_info_dict["user_nick"]
-                            invite_log.invite_avatar = user_info_dict["avatar"]
-                            invite_log.is_handle = 0
-                            invite_log.create_date = now_datetime
-                            invite_log.create_day = now_day
-                            invite_log_model.add_entity(invite_log)
-
-                            task_count.id_md5 = task_count_id_md5
-                            task_count.app_id = app_id
-                            task_count.act_id = act_id
-                            task_count.module_id = module_id
-                            task_count.user_id = from_user_id
-                            task_count.open_id = from_user_info_dict["open_id"]
-                            task_count.task_type = task_type
-                            task_count.task_sub_type = ""
-                            task_count.now_count = task_count.now_count + 1
-                            task_count.create_date = now_datetime
-                            task_count.modify_date = now_datetime
-                            task_count.modify_day = now_day
-                            task_count_model.add_update_entity(task_count,"complete_count=%s,now_count=%s,modify_date=%s,modify_day=%s",params=[task_count.complete_count,task_count.now_count,task_count.modify_date,now_day])
-                            invite_log_model.delete_dependency_key(DependencyKey.invite_log_list(act_id,from_user_id))
-                    else:
-                        invoke_result_data.success = False
-                        invoke_result_data.error_code = task_invoke_result_data.error_code
-                        invoke_result_data.error_message = task_invoke_result_data.error_message
-
-        except Exception as ex:
-            if self.context:
-                self.context.logging_link_error("【邀请新用户任务】" + traceback.format_exc())
-            elif self.logging_link_error:
-                self.logging_link_error("【邀请新用户任务】" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "exception"
-            invoke_result_data.error_message = "系统繁忙,请稍后再试"
-
-        self.business_process_executed()
-
-        return invoke_result_data
-
-    def process_invite_join_member(self, app_id, act_id, module_id, user_id, login_token, from_user_id, handler_name, check_user_nick=True, continue_request_expire=5, close_invite_limit=False):
-        """
-        :description: 处理邀请加入会员任务,目前只支持淘宝会员体系
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_id:当前用户标识
-        :param login_token:访问令牌
-        :param from_user_id:邀请人用户标识
-        :param handler_name:接口名称
-        :param check_user_nick:是否校验昵称为空
-        :param continue_request_expire:连续请求过期时间，为0不进行校验，单位秒
-        :param close_invite_limit:是否关闭邀请限制 True是 False否
-        :return 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        acquire_lock_name = f"process_invite_join_member:{act_id}_{module_id}_{user_id}"
-        task_type = TaskType.invite_join_member.value
-        now_day = TimeExHelper.get_now_day_int()
-        now_datetime = TimeHelper.get_now_format_time()
-        try:
-            invoke_result_data = InvokeResultData()
-            if user_id == from_user_id:
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "error"
-                invoke_result_data.error_message = "无效邀请"
-                return invoke_result_data
-
-            invoke_result_data = self.business_process_executing(app_id,act_id,module_id,user_id,login_token,handler_name,False,check_user_nick,continue_request_expire,acquire_lock_name)
-
-            if invoke_result_data.success == True:
-                act_info_dict = invoke_result_data.data["act_info_dict"]
-                act_module_dict = invoke_result_data.data["act_module_dict"]
-                user_info_dict = invoke_result_data.data["user_info_dict"]
-
-                user_base_model = UserBaseModel(context=self.context)
-                from_user_info_dict = user_base_model.get_user_info_dict(app_id, act_id, from_user_id)
-                invite_log_model = InviteLogModel(context=self.context,sub_table="member")
-                invite_log_dict = invite_log_model.get_dict("act_id=%s and invite_user_id=%s", params=[act_id, user_id])
-                if invite_log_dict:
-                    invoke_result_data.success = False
-                    invoke_result_data.error_code = "error"
-                    invoke_result_data.error_message = "此用户已经被邀请过"
-                elif not from_user_info_dict:
-                    invoke_result_data.success = False
-                    invoke_result_data.error_code = "error"
-                    invoke_result_data.error_message = "邀请人不存在"
-                else:
-                    task_invoke_result_data = self.check_task_info(act_id,module_id,task_type)
-                    if task_invoke_result_data.success == True:
-                        task_info_dict = task_invoke_result_data.data
-                        config_json = task_info_dict["config_json"]
-                        limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
-                        satisfy_num = int(config_json["satisfy_num"]) if config_json.__contains__("satisfy_num") else 1
-                        task_count_model = TaskCountModel(sub_table=self.get_business_sub_table("task_count_tb",{"app_id":app_id}),context=self.context)
-                        task_count_id_md5 = self._get_task_count_id_md5(act_id,module_id,task_info_dict["task_type"],"",from_user_id)
-                        task_count = task_count_model.get_entity("id_md5=%s",params=[task_count_id_md5])
-                        task_count = TaskCount() if not task_count else task_count
-                        limit_meaasge = ""
-                        if task_info_dict["complete_type"] == 1:
-                            limit_meaasge = "今日邀请上限"
-                            if task_count.modify_day != now_day:
-                                task_count.complete_count = 0
-                                task_count.now_count = 0
-                        elif task_info_dict["complete_type"] == 2:
-                            limit_meaasge = "每周邀请上限"
-                            if TimeHelper.is_this_week(task_count.modify_date) == False:
-                                task_count.complete_count = 0
-                                task_count.now_count = 0
-                        else:
-                            limit_meaasge = "邀请上限"
-                        invite_count = int(task_count.complete_count * satisfy_num) + task_count.now_count
-                        is_invite_limit = True if invite_count >= limit_num else False
-                        if is_invite_limit == True and close_invite_limit == False:
-                            invoke_result_data.success = False
-                            invoke_result_data.error_code = "error"
-                            invoke_result_data.error_message = limit_meaasge
-                        else:
-
-                            invite_log = InviteLog()
-                            invite_log.app_id = app_id
-                            invite_log.act_id = act_id
-                            invite_log.user_id = from_user_id
-                            invite_log.open_id = from_user_info_dict["open_id"]
-                            invite_log.invite_user_id = user_info_dict["user_id"]
-                            invite_log.invite_open_id = user_info_dict["open_id"]
-                            invite_log.invite_user_nick = user_info_dict["user_nick"]
-                            invite_log.invite_avatar = user_info_dict["avatar"]
-                            invite_log.is_handle = 0
-                            invite_log.create_date = now_datetime
-                            invite_log.create_day = now_day
-                            invite_log_model.add_entity(invite_log)
-
-                            task_count.id_md5 = task_count_id_md5
-                            task_count.app_id = app_id
-                            task_count.act_id = act_id
-                            task_count.module_id = module_id
-                            task_count.user_id = from_user_id
-                            task_count.open_id = from_user_info_dict["open_id"]
-                            task_count.task_type = task_type
-                            task_count.task_sub_type = ""
-                            task_count.now_count = task_count.now_count + 1
-                            task_count.create_date = now_datetime
-                            task_count.modify_date = now_datetime
-                            task_count.modify_day = now_day
-                            task_count_model.add_update_entity(task_count,"complete_count=%s,now_count=%s,modify_date=%s,modify_day=%s",params=[task_count.complete_count,task_count.now_count,task_count.modify_date,now_day])
-                            invite_log_model.delete_dependency_key(DependencyKey.invite_log_member_list(act_id,from_user_id))
-                    else:
-                        invoke_result_data.success = False
-                        invoke_result_data.error_code = task_invoke_result_data.error_code
-                        invoke_result_data.error_message = task_invoke_result_data.error_message
-
-        except Exception as ex:
-            if self.context:
-                self.context.logging_link_error("【邀请加入会员任务】" + traceback.format_exc())
-            elif self.logging_link_error:
-                self.logging_link_error("【邀请加入会员任务】" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "exception"
-            invoke_result_data.error_message = "系统繁忙,请稍后再试"
-
-        self.business_process_executed()
-
-        return invoke_result_data
-
-    def process_collect_goods(self,app_id,act_id,module_id,user_id,login_token,goods_id,handler_name,check_user_nick=True,continue_request_expire=5):
-        """
-        :description: 处理收藏商品任务
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_id:用户标识
-        :param login_token:访问令牌
-        :param goods_id:收藏商品ID
-        :param handler_name:接口名称
-        :param check_user_nick:是否校验昵称为空
-        :param continue_request_expire:连续请求过期时间，为0不进行校验，单位秒
-        :return 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        acquire_lock_name = f"process_collect_goods:{act_id}_{module_id}_{user_id}"
-        task_type = TaskType.collect_goods.value
-        now_day = TimeExHelper.get_now_day_int()
-        now_datetime = TimeHelper.get_now_format_time()
-        try:
-            invoke_result_data = self.business_process_executing(app_id,act_id,module_id,user_id,login_token,handler_name,False,check_user_nick,continue_request_expire,acquire_lock_name)
-            if invoke_result_data.success == True:
-                user_info_dict = invoke_result_data.data["user_info_dict"]
-                collect_log_model = CollectLogModel(context=self.context)
-                where = "act_id=%s and user_id=%s and goods_id=%s"
-                params = [act_id, user_id, goods_id]
-                collect_log_dict = collect_log_model.get_dict(where, params=params)
-                if collect_log_dict:
-                    invoke_result_data.success = False
-                    invoke_result_data.error_code = "error"
-                    invoke_result_data.error_message = "此商品已经收藏过"
-                else:
-                    task_invoke_result_data = self.check_task_info(act_id,module_id,task_type)
-                    if task_invoke_result_data.success == True:
-                        task_info_dict = task_invoke_result_data.data
-                        config_json = task_info_dict["config_json"]
-                        limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
-                        satisfy_num = int(config_json["satisfy_num"]) if config_json.__contains__("satisfy_num") else 1
-                        goods_ids_list = list(set(str(config_json["goods_ids"]).split(','))) if config_json.__contains__("goods_ids") else []
-                        task_count_model = TaskCountModel(sub_table=self.get_business_sub_table("task_count_tb",{"app_id":app_id}),context=self.context)
-                        task_count_id_md5 = self._get_task_count_id_md5(act_id,module_id,task_info_dict["task_type"],"",user_id)
-                        task_count = task_count_model.get_entity("id_md5=%s",params=[task_count_id_md5])
-                        task_count = TaskCount() if not task_count else task_count
-                        limit_meaasge = ""
-                        if str(goods_id) not in goods_ids_list:
-                            invoke_result_data.success = False
-                            invoke_result_data.error_code = "error"
-                            invoke_result_data.error_message = "此商品不在收藏任务里"
-                        else:
-                            if task_info_dict["complete_type"] == 1:
-                                limit_meaasge = "今日收藏上限"
-                                if task_count.modify_day != now_day:
-                                    task_count.complete_count = 0
-                                    task_count.now_count = 0
-                            elif task_info_dict["complete_type"] == 2:
-                                limit_meaasge = "每周收藏上限"
-                                if TimeHelper.is_this_week(task_count.modify_date) == False:
-                                    task_count.complete_count = 0
-                                    task_count.now_count = 0
-                            else:
-                                limit_meaasge = "收藏上限"
-                        collect_count = int(task_count.complete_count * satisfy_num) + task_count.now_count
-                        is_collect_limit = True if collect_count >= (limit_num * satisfy_num) else False
-                        if is_collect_limit == True:
-                            invoke_result_data.success = False
-                            invoke_result_data.error_code = "error"
-                            invoke_result_data.error_message = limit_meaasge
-                        else:
-                            collect_log_model = CollectLogModel(context=self.context)
-                            collect_log = CollectLog()
-                            collect_log.app_id = app_id
-                            collect_log.act_id = act_id
-                            collect_log.user_id = user_id
-                            collect_log.open_id = user_info_dict["open_id"]
-                            collect_log.goods_id = goods_id
-                            collect_log.is_handle = 0
-                            collect_log.create_date = now_datetime
-                            collect_log.create_day = now_day
-                            collect_log_model.add_entity(collect_log)
-                            collect_log_model.delete_dependency_key(DependencyKey.collect_log(act_id,user_id))
-
-                            task_count.id_md5 = task_count_id_md5
-                            task_count.app_id = app_id
-                            task_count.act_id = act_id
-                            task_count.module_id = module_id
-                            task_count.user_id = user_id
-                            task_count.open_id = user_info_dict["open_id"]
-                            task_count.task_type = task_type
-                            task_count.task_sub_type = ""
-                            task_count.now_count = task_count.now_count + 1
-                            task_count.create_date = now_datetime
-                            task_count.modify_date = now_datetime
-                            task_count.modify_day = now_day
-                            task_count_model.add_update_entity(task_count,"complete_count=%s,now_count=%s,modify_date=%s,modify_day=%s",params=[task_count.complete_count,task_count.now_count,task_count.modify_date,now_day])
-
-                    else:
-                        invoke_result_data.success = False
-                        invoke_result_data.error_code = task_invoke_result_data.error_code
-                        invoke_result_data.error_message = task_invoke_result_data.error_message
-
-
-        except Exception as ex:
-            if self.context:
-                self.context.logging_link_error("【收藏商品任务】" + traceback.format_exc())
-            elif self.logging_link_error:
-                self.logging_link_error("【收藏商品任务】" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "exception"
-            invoke_result_data.error_message = "系统繁忙,请稍后再试"
-
-        self.business_process_executed()
-
-        return invoke_result_data
-
-    def process_browse_goods(self,app_id,act_id,module_id,user_id,login_token,goods_id,handler_name,daily_repeat_browse=True,check_user_nick=True,continue_request_expire=5):
-        """
-        :description: 处理浏览商品任务
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_id:用户标识
-        :param login_token:访问令牌
-        :param goods_id:浏览商品ID
-        :param handler_name:接口名称
-        :param daily_repeat_browse:单个商品可每日重复浏览 True是False否
-        :param check_user_nick:是否校验昵称为空
-        :param continue_request_expire:连续请求过期时间，为0不进行校验，单位秒
-        :return 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        acquire_lock_name = f"process_browse_goods:{act_id}_{module_id}_{user_id}"
-        task_type = TaskType.browse_goods.value
-        now_day = TimeExHelper.get_now_day_int()
-        now_datetime = TimeHelper.get_now_format_time()
-        try:
-            invoke_result_data = self.business_process_executing(app_id,act_id,module_id,user_id,login_token,handler_name,False,check_user_nick,continue_request_expire,acquire_lock_name)
-            if invoke_result_data.success == True:
-                user_info_dict = invoke_result_data.data["user_info_dict"]
-                browse_log_model = BrowseLogModel(context=self.context)
-                where = "act_id=%s and user_id=%s and goods_id=%s"
-                params = [act_id, user_id, goods_id]
-                if daily_repeat_browse == True:
-                    where+=" and create_day=%s"
-                    params.append(TimeExHelper.get_now_day_int())
-                browse_log_dict = browse_log_model.get_dict(where, params=params)
-                if browse_log_dict:
-                    invoke_result_data.success = False
-                    invoke_result_data.error_code = "error"
-                    invoke_result_data.error_message = "此商品已经浏览过"
-                else:
-                    task_invoke_result_data = self.check_task_info(act_id,module_id,task_type)
-                    if task_invoke_result_data.success == True:
-                        task_info_dict = task_invoke_result_data.data
-                        config_json = task_info_dict["config_json"]
-                        limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
-                        satisfy_num = int(config_json["satisfy_num"]) if config_json.__contains__("satisfy_num") else 1
-                        goods_ids_list = list(set(str(config_json["goods_ids"]).split(','))) if config_json.__contains__("goods_ids") else []
-                        task_count_model = TaskCountModel(sub_table=self.get_business_sub_table("task_count_tb",{"app_id":app_id}),context=self.context)
-                        task_count_id_md5 = self._get_task_count_id_md5(act_id,module_id,task_info_dict["task_type"],"",user_id)
-                        task_count = task_count_model.get_entity("id_md5=%s",params=[task_count_id_md5])
-                        task_count = TaskCount() if not task_count else task_count
-                        limit_meaasge = ""
-                        if str(goods_id) not in goods_ids_list:
-                            invoke_result_data.success = False
-                            invoke_result_data.error_code = "error"
-                            invoke_result_data.error_message = "此商品不在浏览任务里"
-                        else:
-                            if task_info_dict["complete_type"] == 1:
-                                limit_meaasge = "今日浏览上限"
-                                if task_count.modify_day != now_day:
-                                    task_count.complete_count = 0
-                                    task_count.now_count = 0
-                            elif task_info_dict["complete_type"] == 2:
-                                limit_meaasge = "每周浏览上限"
-                                if TimeHelper.is_this_week(task_count.modify_date) == False:
-                                    task_count.complete_count = 0
-                                    task_count.now_count = 0
-                            else:
-                                limit_meaasge = "浏览上限"
-                        browse_count = int(task_count.complete_count * satisfy_num) + task_count.now_count
-                        is_browse_limit = True if browse_count >= (limit_num * satisfy_num) else False
-                        if is_browse_limit == True:
-                            invoke_result_data.success = False
-                            invoke_result_data.error_code = "error"
-                            invoke_result_data.error_message = limit_meaasge
-                        else:
-                            browse_log_model = BrowseLogModel(context=self.context)
-                            browse_log = BrowseLog()
-                            browse_log.app_id = app_id
-                            browse_log.act_id = act_id
-                            browse_log.user_id = user_id
-                            browse_log.open_id = user_info_dict["open_id"]
-                            browse_log.goods_id = goods_id
-                            browse_log.is_handle = 0
-                            browse_log.create_date = now_datetime
-                            browse_log.create_day = now_day
-                            browse_log_model.add_entity(browse_log)
-                            browse_log_model.delete_dependency_key(DependencyKey.browse_log(act_id,user_id))
-
-                            task_count.id_md5 = task_count_id_md5
-                            task_count.app_id = app_id
-                            task_count.act_id = act_id
-                            task_count.module_id = module_id
-                            task_count.user_id = user_id
-                            task_count.open_id = user_info_dict["open_id"]
-                            task_count.task_type = task_type
-                            task_count.task_sub_type = ""
-                            task_count.now_count = task_count.now_count + 1
-                            task_count.create_date = now_datetime
-                            task_count.modify_date = now_datetime
-                            task_count.modify_day = now_day
-                            task_count_model.add_update_entity(task_count,"complete_count=%s,now_count=%s,modify_date=%s,modify_day=%s",params=[task_count.complete_count,task_count.now_count,task_count.modify_date,now_day])
-
-                    else:
-                        invoke_result_data.success = False
-                        invoke_result_data.error_code = task_invoke_result_data.error_code
-                        invoke_result_data.error_message = task_invoke_result_data.error_message
-
-
-        except Exception as ex:
-            if self.context:
-                self.context.logging_link_error("【浏览商品任务】" + traceback.format_exc())
-            elif self.logging_link_error:
-                self.logging_link_error("【浏览商品任务】" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "exception"
-            invoke_result_data.error_message = "系统繁忙,请稍后再试"
-
-        self.business_process_executed()
-
-        return invoke_result_data
-
-    def process_favor_store(self,app_id,act_id,module_id,user_id,login_token,handler_name,request_code,check_user_nick=True,continue_request_expire=5,is_stat=True,info_json=None):
-        """
-        :description: 处理关注店铺,有任务给奖励，没有则直接关注
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_id:用户标识
-        :param login_token:访问令牌
-        :param handler_name:接口名称
-        :param request_code:请求代码
-        :param check_user_nick:是否校验昵称为空
-        :param continue_request_expire:连续请求过期时间，为0不进行校验，单位秒
-        :param is_stat:是否统计上报
-        :param info_json:资产日志详细信息
-        :return 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        acquire_lock_name = f"process_favor_store:{act_id}_{module_id}_{user_id}"
-        task_type = TaskType.favor_store.value
-        now_day = TimeExHelper.get_now_day_int()
-        now_datetime = TimeHelper.get_now_format_time()
-        stat_base_model = StatBaseModel(context=self.context)
-        if not info_json:
-            info_json = {}
-        try:
-            invoke_result_data = self.business_process_executing(app_id,act_id,module_id,user_id,login_token,handler_name,False,check_user_nick,continue_request_expire,acquire_lock_name)
-            if invoke_result_data.success == True:
-                act_info_dict = invoke_result_data.data["act_info_dict"]
-                act_module_dict = invoke_result_data.data["act_module_dict"]
-                user_info_dict = invoke_result_data.data["user_info_dict"]
-
-                if user_info_dict["is_favor_before"] == 0:
-                    if is_stat == True:
-                        #新增关注用户数
-                        stat_base_model.add_stat(app_id, act_id, module_id, user_info_dict["user_id"], user_info_dict["open_id"], "AddFollowUserCount",1)
-                is_limit = False
-                task_count_model = TaskCountModel(sub_table=self.get_business_sub_table("task_count_tb",{"app_id":app_id}),context=self.context)
-                task_count_id_md5 = self._get_task_count_id_md5(act_id,module_id,task_type,"",user_id)
-                task_count = task_count_model.get_entity("id_md5=%s",params=[task_count_id_md5])
-                task_count = task_count if task_count else TaskCount()
-                if module_id:
-                    is_limit = True if task_count.complete_count >= 1 else False
-                else:
-                    is_limit = True if task_count.complete_count >= 1 or user_info_dict["is_favor"] == 1 else False
-                if is_limit == True:
-                    invoke_result_data.success = False
-                    invoke_result_data.error_code = "error"
-                    invoke_result_data.error_message = "已经关注过店铺了"
-                else:
-                    user_info_model = UserInfoModel(sub_table=self.get_business_sub_table("user_info_tb",{"app_id":app_id}),context=self.context)
-                    user_info_model.update_table("is_favor=1","id=%s",params=[user_info_dict["id"]])
-                    UserBaseModel(context=self.context)._delete_user_info_cache(user_info_dict["act_id"],user_info_dict["id_md5"])
-                    reward_value = 0
-                    reward_object_id =""
-                    task_invoke_result_data = self.check_task_info(act_id,module_id,task_type)
-                    if task_invoke_result_data.success == True:
-                        task_info_dict = task_invoke_result_data.data
-                        config_json = task_info_dict["config_json"]
-                        reward_value = int(config_json["reward_value"]) if config_json.__contains__("reward_value") else 0
-                        once_favor_reward = int(config_json["once_favor_reward"]) if config_json.__contains__("once_favor_reward") else 1
-                        asset_object_id = config_json["asset_object_id"] if config_json.__contains__("asset_object_id") else ""
-
-                        task_count.id_md5 = task_count_id_md5
-                        task_count.app_id = app_id
-                        task_count.act_id = act_id
-                        task_count.module_id = module_id
-                        task_count.user_id = user_id
-                        task_count.open_id = user_info_dict["open_id"]
-                        task_count.task_type = task_type
-                        task_count.task_sub_type = ""
-                        task_count.complete_count = task_count.complete_count+1
-                        task_count.now_count = 0
-                        task_count.create_date = now_datetime
-                        task_count.modify_date = now_datetime
-                        task_count.modify_day = now_day
-                        task_count_model.add_update_entity(task_count,"complete_count=%s,modify_date=%s,modify_day=%s",params=[task_count.complete_count,task_count.modify_date,now_day])
-
-                        if user_info_dict["is_favor_before"] == 1 and once_favor_reward == 0:
-                            reward_value = 0
-                        if reward_value > 0:
-                            only_id = self.get_only_id(user_id,task_info_dict["complete_type"],task_type)
-                            if module_id > 0:
-                                only_id = f"{module_id}_{only_id}"
-                            asset_type = self.get_task_asset_type(act_info_dict["task_asset_type_json"],task_type)
-                            reward_object_id = asset_type
-                            asset_base_model = AssetBaseModel(context=self.context)
-                            asset_invoke_result_data = asset_base_model.update_user_asset(app_id,act_id,module_id,user_id,user_info_dict["open_id"],user_info_dict["user_nick"],asset_type,reward_value,asset_object_id,2,task_type,task_info_dict["task_name"],task_info_dict["task_name"],only_id,handler_name,request_code,info_json=info_json)
-                            if asset_invoke_result_data.success == False:
-                                reward_value = 0
-                    invoke_result_data.data["reward_value"] = reward_value
-                    self.add_task_stat(task_type, app_id, act_id, module_id, user_info_dict["user_id"], user_info_dict["open_id"], reward_value, is_stat)
-                    self.add_task_log(task_type=task_type, task_sub_type='', app_id=app_id, act_id=act_id, module_id=module_id, user_id=user_info_dict["user_id"], open_id=user_info_dict["open_id"], user_nick=user_info_dict["user_nick"],task_name=task_info_dict["task_name"],log_title=task_info_dict["task_name"],reward_type=1, reward_object_id=reward_object_id, reward_name="", reward_num=reward_value, handler_name=handler_name, request_code=request_code, info_json=info_json)
-
-        except Exception as ex:
-            if self.context:
-                self.context.logging_link_error("【关注店铺】" + traceback.format_exc())
-            elif self.logging_link_error:
-                self.logging_link_error("【关注店铺】" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "exception"
-            invoke_result_data.error_message = "系统繁忙,请稍后再试"
-
-        self.business_process_executed()
-
-        return invoke_result_data
-
-    def process_join_member(self,app_id,act_id,module_id,user_id,login_token,handler_name,request_code,check_user_nick=True,continue_request_expire=5,is_stat=True,info_json=None):
-        """
-        :description: 处理加入店铺会员,有任务给奖励，没有则直接加入
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_id:用户标识
-        :param login_token:访问令牌
-        :param handler_name:接口名称
-        :param request_code:请求代码
-        :param check_user_nick:是否校验昵称为空
-        :param continue_request_expire:连续请求过期时间，为0不进行校验，单位秒
-        :param is_stat:是否统计上报
-        :param info_json:资产日志详细信息
-        :return 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        acquire_lock_name = f"process_join_member:{act_id}_{module_id}_{user_id}"
-        task_type = TaskType.join_member.value
-        now_day = TimeExHelper.get_now_day_int()
-        now_datetime = TimeHelper.get_now_format_time()
-        stat_base_model = StatBaseModel(context=self.context)
-        if not info_json:
-            info_json = {}
-        try:
-            invoke_result_data = self.business_process_executing(app_id,act_id,module_id,user_id,login_token,handler_name,False,check_user_nick,continue_request_expire,acquire_lock_name)
-            if invoke_result_data.success == True:
-                act_info_dict = invoke_result_data.data["act_info_dict"]
-                user_info_dict = invoke_result_data.data["user_info_dict"]
-
-                if user_info_dict["is_member_before"] == 0:
-                    #新增入会用户数
-                    if is_stat == True:
-                        stat_base_model.add_stat(app_id, act_id, module_id, user_info_dict["user_id"], user_info_dict["open_id"], "AddMemberUserCount",1)
-                is_limit = False
-                task_count_model = TaskCountModel(sub_table=self.get_business_sub_table("task_count_tb",{"app_id":app_id}),context=self.context)
-                task_count_id_md5 = self._get_task_count_id_md5(act_id,module_id,task_type,"",user_id)
-                task_count = task_count_model.get_entity("id_md5=%s",params=[task_count_id_md5])
-                task_count = task_count if task_count else TaskCount()
-                if module_id:
-                    is_limit = True if task_count.complete_count >= 1 else False
-                else:
-                    is_limit = True if task_count.complete_count >= 1 or user_info_dict["is_member"] == 1 else False
-                if is_limit == True:
-                    invoke_result_data.success = False
-                    invoke_result_data.error_code = "error"
-                    invoke_result_data.error_message = "已经完成入会任务"
-                else:
-                    user_info_model = UserInfoModel(sub_table=self.get_business_sub_table("user_info_tb",{"app_id":app_id}),context=self.context)
-                    user_info_model.update_table("is_member=1","id=%s",params=[user_info_dict["id"]])
-                    UserBaseModel(context=self.context)._delete_user_info_cache(user_info_dict["act_id"],user_info_dict["id_md5"])
-                    reward_value = 0
-                    reward_object_id = ""
-                    task_invoke_result_data = self.check_task_info(act_id,module_id,task_type)
-                    if task_invoke_result_data.success == True:
-                        task_info_dict = task_invoke_result_data.data
-                        config_json = task_info_dict["config_json"]
-                        reward_value = int(config_json["reward_value"]) if config_json.__contains__("reward_value") else 0
-                        once_member_reward = int(config_json["once_member_reward"]) if config_json.__contains__("once_member_reward") else 1
-                        asset_object_id = config_json["asset_object_id"] if config_json.__contains__("asset_object_id") else ""
-
-                        task_count.id_md5 = task_count_id_md5
-                        task_count.app_id = app_id
-                        task_count.act_id = act_id
-                        task_count.module_id = module_id
-                        task_count.user_id = user_id
-                        task_count.open_id = user_info_dict["open_id"]
-                        task_count.task_type = task_type
-                        task_count.task_sub_type = ""
-                        task_count.complete_count = task_count.complete_count+1
-                        task_count.now_count = 0
-                        task_count.create_date = now_datetime
-                        task_count.modify_date = now_datetime
-                        task_count.modify_day = now_day
-                        task_count_model.add_update_entity(task_count,"complete_count=%s,modify_date=%s,modify_day=%s",params=[task_count.complete_count,task_count.modify_date,now_day])
-
-                        if user_info_dict["is_member_before"] == 1 and once_member_reward == 0: #判断已经入会是否给奖励
-                            reward_value = 0
-                        if reward_value > 0:
-                            only_id = self.get_only_id(user_id,task_info_dict["complete_type"],task_type)
-                            if module_id > 0:
-                                only_id = f"{module_id}_{only_id}"
-                            asset_type = self.get_task_asset_type(act_info_dict["task_asset_type_json"],task_type)
-                            reward_object_id = asset_type
-                            asset_base_model = AssetBaseModel(context=self.context)
-                            asset_invoke_result_data = asset_base_model.update_user_asset(app_id,act_id,module_id,user_id,user_info_dict["open_id"],user_info_dict["user_nick"],asset_type,reward_value,asset_object_id,2,task_type,task_info_dict["task_name"],task_info_dict["task_name"],only_id,handler_name,request_code,info_json=info_json)
-                            if asset_invoke_result_data.success == False:
-                                reward_value = 0
-                    invoke_result_data.data["reward_value"] = reward_value
-                    self.add_task_stat(task_type, app_id, act_id, module_id, user_info_dict["user_id"], user_info_dict["open_id"], reward_value, is_stat)
-                    self.add_task_log(task_type=task_type, task_sub_type='', app_id=app_id, act_id=act_id, module_id=module_id, user_id=user_info_dict["user_id"], open_id=user_info_dict["open_id"], user_nick=user_info_dict["user_nick"],task_name=task_info_dict["task_name"],log_title=task_info_dict["task_name"],reward_type=1, reward_object_id=reward_object_id, reward_name="", reward_num=reward_value, handler_name=handler_name, request_code=request_code, info_json=info_json)
-        except Exception as ex:
-            if self.context:
-                self.context.logging_link_error("【加入店铺会员】" + traceback.format_exc())
-            elif self.logging_link_error:
-                self.logging_link_error("【加入店铺会员】" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "exception"
-            invoke_result_data.error_message = "系统繁忙,请稍后再试"
-
-        self.business_process_executed()
-
-        return invoke_result_data
-
-    def process_browse_site(self,app_id,act_id,module_id,user_id,login_token,task_type,task_sub_type,handler_name,check_user_nick=True,continue_request_expire=5):
-        """
-        :description: 处理浏览网址任务
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_id:用户标识
-        :param login_token:访问令牌
-        :param task_type:任务类型
-        :param task_sub_type:子任务类型
-        :param handler_name:接口名称
-        :param check_user_nick:是否校验昵称为空
-        :param continue_request_expire:连续请求过期时间，为0不进行校验，单位秒
-        :return 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        acquire_lock_name = f"process_browse_site:{act_id}_{module_id}_{user_id}_{task_type}"
-        now_day = TimeExHelper.get_now_day_int()
-        now_datetime = TimeHelper.get_now_format_time()
-        try:
-            invoke_result_data = self.business_process_executing(app_id,act_id,module_id,user_id,login_token,handler_name,False,check_user_nick,continue_request_expire,acquire_lock_name)
-            if invoke_result_data.success == True:
-                act_info_dict = invoke_result_data.data["act_info_dict"]
-                act_module_dict = invoke_result_data.data["act_module_dict"]
-                user_info_dict = invoke_result_data.data["user_info_dict"]
-
-                task_invoke_result_data = self.check_task_info(act_id,module_id,task_type)
-                if task_invoke_result_data.success == True:
-                    task_info_dict = task_invoke_result_data.data
-                    sub_config_json = [sub_config_json for sub_config_json in task_info_dict["config_json"] if task_sub_type == sub_config_json["id"]]
-                    if sub_config_json:
-                        limit_num = int(sub_config_json["limit_num"]) if sub_config_json.__contains__("limit_num") else 1
-                        satisfy_num = int(sub_config_json["satisfy_num"]) if sub_config_json.__contains__("satisfy_num") else 1
-                        task_count_model = TaskCountModel(sub_table=self.get_business_sub_table("task_count_tb",{"app_id":app_id}),context=self.context)
-                        task_count_id_md5 = self._get_task_count_id_md5(act_id,module_id,task_info_dict["task_type"],task_sub_type,user_id)
-                        task_count = task_count_model.get_entity("id_md5=%s",params=[task_count_id_md5])
-                        task_count = TaskCount() if not task_count else task_count
-                        limit_meaasge = ""
-                        if task_info_dict["complete_type"] == 1:
-                            limit_meaasge = "今日浏览上限"
-                            if task_count.modify_day != now_day:
-                                task_count.complete_count = 0
-                                task_count.now_count = 0
-                        elif task_info_dict["complete_type"] == 2:
-                            limit_meaasge = "每周浏览上限"
-                            if TimeHelper.is_this_week(task_count.modify_date) == False:
-                                task_count.complete_count = 0
-                                task_count.now_count = 0
-                        else:
-                            limit_meaasge = "浏览上限"
-
-                        count = int(task_count.complete_count * satisfy_num) + task_count.now_count
-                        is_limit = True if count >= (limit_num * satisfy_num) else False
-                        if is_limit == True:
-                            invoke_result_data.success = False
-                            invoke_result_data.error_code = "error"
-                            invoke_result_data.error_message = limit_meaasge
-                        else:
-                            task_count.id_md5 = task_count_id_md5
-                            task_count.app_id = app_id
-                            task_count.act_id = act_id
-                            task_count.module_id = module_id
-                            task_count.user_id = user_id
-                            task_count.open_id = user_info_dict["open_id"]
-                            task_count.task_type = task_type
-                            task_count.task_sub_type = task_sub_type
-                            task_count.now_count = task_count.now_count + 1
-                            task_count.create_date = now_datetime
-                            task_count.modify_date = now_datetime
-                            task_count.modify_day = now_day
-                            task_count_model.add_update_entity(task_count,"complete_count=%s,now_count=%s,modify_date=%s,modify_day=%s",params=[task_count.complete_count, task_count.now_count, task_count.modify_date, now_day])
-                    else:
-                        invoke_result_data.success = False
-                        invoke_result_data.error_code = "error"
-                        invoke_result_data.error_message = "子任务不存在"
-                else:
-                    invoke_result_data.success = False
-                    invoke_result_data.error_code = task_invoke_result_data.error_code
-                    invoke_result_data.error_message = task_invoke_result_data.error_message
-
-        except Exception as ex:
-            if self.context:
-                self.context.logging_link_error("【浏览网址任务】" + traceback.format_exc())
-            elif self.logging_link_error:
-                self.logging_link_error("【浏览网址任务】" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "exception"
-            invoke_result_data.error_message = "系统繁忙,请稍后再试"
-
-        self.business_process_executed()
-
-        return invoke_result_data
-
-    def process_share(self,app_id,act_id,module_id,user_id,login_token,handler_name,check_new_user=False,check_user_nick=True,continue_request_expire=5):
-        """
-        :description: 处理分享奖励任务
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_id:用户标识
-        :param login_token:访问令牌
-        :param handler_name:接口名称
-        :param check_new_user:是否新用户才能领取 1是0否
-        :param check_user_nick:是否校验昵称为空
-        :param continue_request_expire:连续请求过期时间，为0不进行校验，单位秒
-        :return 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        acquire_lock_name = f"process_share:{act_id}_{module_id}_{user_id}"
-        task_type = TaskType.share.value
-        now_day = TimeExHelper.get_now_day_int()
-        now_datetime = TimeHelper.get_now_format_time()
-        try:
-            invoke_result_data = self.business_process_executing(app_id,act_id,module_id,user_id,login_token,handler_name,check_new_user,check_user_nick,continue_request_expire,acquire_lock_name)
-            if invoke_result_data.success == True:
-                task_invoke_result_data = self.check_task_info(act_id,module_id,task_type)
-                if task_invoke_result_data.success == True:
-                    task_info_dict = task_invoke_result_data.data
-                    config_json = task_info_dict["config_json"]
-                    limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
-                    user_info_dict = invoke_result_data.data["user_info_dict"]
-                    task_count_model = TaskCountModel(sub_table=self.get_business_sub_table("task_count_tb",{"app_id":app_id}),context=self.context)
-                    task_count_id_md5 = self._get_task_count_id_md5(act_id,module_id,task_info_dict["task_type"],"",user_id)
-                    task_count = task_count_model.get_entity("id_md5=%s",params=[task_count_id_md5])
-                    task_count = TaskCount() if not task_count else task_count
-                    limit_meaasge = ""
-                    if task_info_dict["complete_type"] == 1:
-                        limit_meaasge = "今日领取上限"
-                        if task_count.modify_day != now_day:
-                            task_count.complete_count = 0
-                            task_count.now_count = 0
-                    elif task_info_dict["complete_type"] == 2:
-                        limit_meaasge = "每周领取上限"
-                        if TimeHelper.is_this_week(task_count.modify_date) == False:
-                            task_count.complete_count = 0
-                            task_count.now_count = 0
-                    else:
-                        limit_meaasge = "领取上限"
-                    is_limit = True if task_count.complete_count >= limit_num else False
-                    if is_limit == True:
-                        invoke_result_data.success = False
-                        invoke_result_data.error_code = "error"
-                        invoke_result_data.error_message = limit_meaasge
-                    else:
-                        task_count.id_md5 = task_count_id_md5
-                        task_count.app_id = app_id
-                        task_count.act_id = act_id
-                        task_count.module_id = module_id
-                        task_count.user_id = user_id
-                        task_count.open_id = user_info_dict["open_id"]
-                        task_count.task_type = task_type
-                        task_count.task_sub_type = ""
-                        task_count.now_count = task_count.now_count + 1
-                        task_count.create_date = now_datetime
-                        task_count.modify_date = now_datetime
-                        task_count.modify_day = now_day
-                        task_count_model.add_update_entity(task_count,"complete_count=%s,now_count=%s,modify_date=%s,modify_day=%s",params=[task_count.complete_count,task_count.now_count,task_count.modify_date,now_day])
-                else:
-                    invoke_result_data.success = False
-                    invoke_result_data.error_code = task_invoke_result_data.error_code
-                    invoke_result_data.error_message = task_invoke_result_data.error_message
-        except Exception as ex:
-            if self.context:
-                self.context.logging_link_error("【分享任务】" + traceback.format_exc())
-            elif self.logging_link_error:
-                self.logging_link_error("【分享任务】" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "exception"
-            invoke_result_data.error_message = "系统繁忙,请稍后再试"
-
-        self.business_process_executed()
-
-        return invoke_result_data
-
-    def process_invite_user_help(self,app_id,act_id,module_id,user_id,login_token,from_user_id,handler_name,check_new_user=False,check_user_nick=True,continue_request_expire=5,check_act_info_release=True,check_act_module_release=True):
-        """
-        :description: 处理邀请用户助力
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_id:当前用户标识
-        :param login_token:访问令牌
-        :param from_user_id:邀请人用户标识
-        :param handler_name:接口名称
-        :param check_new_user:是否新用户才能领取 1是0否
-        :param check_user_nick:是否校验昵称为空
-        :param continue_request_expire:连续请求过期时间，为0不进行校验，单位秒
-        :param check_act_info_release:校验活动信息是否发布
-        :param check_act_module_release:校验活动模块是否发布
-        :return 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        acquire_lock_name = f"process_invite_user_help:{act_id}_{module_id}_{user_id}"
-        task_type = TaskType.invite_user_help.value
-        now_day = TimeExHelper.get_now_day_int()
-        now_datetime = TimeHelper.get_now_format_time()
-        try:
-            invoke_result_data = InvokeResultData()
-            if user_id == from_user_id:
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "error"
-                invoke_result_data.error_message = "无效邀请"
-                return invoke_result_data
-
-            invoke_result_data = self.business_process_executing(app_id,act_id,module_id,user_id,login_token,handler_name,check_new_user,check_user_nick,continue_request_expire,acquire_lock_name,check_act_info_release=check_act_info_release,check_act_module_release=check_act_module_release)
-            if invoke_result_data.success == True:
-                user_info_dict = invoke_result_data.data["user_info_dict"]
-
-                user_base_model = UserBaseModel(context=self.context)
-                from_user_info_dict = user_base_model.get_user_info_dict(app_id,act_id,from_user_id)
-                invite_help_model = InviteHelpModel(context=self.context)
-                help_type = 1
-                help_object_id = ''
-                help_id_md5 = CryptoHelper.md5_encrypt_int(f"{app_id}_{act_id}_{module_id}_{help_type}_{help_object_id}")
-                invite_help_dict = invite_help_model.get_dict("id_md5=%s and user_id=%s and invited_user_id=%s", params=[help_id_md5, from_user_id, user_id])
-                if invite_help_dict:
-                    invoke_result_data.success = False
-                    invoke_result_data.error_code = "error"
-                    invoke_result_data.error_message = "此用户已经被邀请过"
-                elif not from_user_info_dict:
-                    invoke_result_data.success = False
-                    invoke_result_data.error_code = "error"
-                    invoke_result_data.error_message = "邀请人不存在"
-                else:
-                    task_invoke_result_data = self.check_task_info(act_id,module_id,task_type)
-                    if task_invoke_result_data.success == True:
-                        task_info_dict = task_invoke_result_data.data
-                        config_json = task_info_dict["config_json"]
-                        limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
-                        satisfy_num = int(config_json["satisfy_num"]) if config_json.__contains__("satisfy_num") else 1
-                        task_count_model = TaskCountModel(sub_table=self.get_business_sub_table("task_count_tb",{"app_id":app_id}),context=self.context)
-                        task_count_id_md5 = self._get_task_count_id_md5(act_id,module_id,task_info_dict["task_type"],"",from_user_id)
-                        task_count = task_count_model.get_entity("id_md5=%s",params=[task_count_id_md5])
-                        task_count = TaskCount() if not task_count else task_count
-                        limit_meaasge = ""
-                        if task_info_dict["complete_type"] == 1:
-                            limit_meaasge = "今日邀请上限"
-                            if task_count.modify_day != now_day:
-                                task_count.complete_count = 0
-                                task_count.now_count = 0
-                        elif task_info_dict["complete_type"] == 2:
-                            limit_meaasge = "每周邀请上限"
-                            if TimeHelper.is_this_week(task_count.modify_date) == False:
-                                task_count.complete_count = 0
-                                task_count.now_count = 0
-                        else:
-                            limit_meaasge = "邀请上限"
-                        invite_count = int(task_count.complete_count * satisfy_num) + task_count.now_count
-                        is_invite_limit = True if invite_count >= limit_num else False
-                        if is_invite_limit == True:
-                            invoke_result_data.success = False
-                            invoke_result_data.error_code = "error"
-                            invoke_result_data.error_message = limit_meaasge
-                        else:
-                            invite_help = InviteHelp()
-                            invite_help.id_md5 = help_id_md5
-                            invite_help.app_id = app_id
-                            invite_help.act_id = act_id
-                            invite_help.module_id = module_id
-                            invite_help.help_type = 1
-                            invite_help.object_id = ''
-                            invite_help.user_id = from_user_id
-                            invite_help.open_id = from_user_info_dict["open_id"]
-                            invite_help.invited_user_id = user_info_dict["user_id"]
-                            invite_help.invited_open_id = user_info_dict["open_id"]
-                            invite_help.invited_user_nick = user_info_dict["user_nick"]
-                            invite_help.invited_avatar = user_info_dict["avatar"]
-                            invite_help.is_handle = 0
-                            invite_help.create_date = now_datetime
-                            invite_help.create_day = now_day
-                            invite_help_model.add_entity(invite_help)
-
-                            task_count.id_md5 = task_count_id_md5
-                            task_count.app_id = app_id
-                            task_count.act_id = act_id
-                            task_count.module_id = module_id
-                            task_count.user_id = from_user_id
-                            task_count.open_id = from_user_info_dict["open_id"]
-                            task_count.task_type = task_type
-                            task_count.task_sub_type = ""
-                            task_count.now_count = task_count.now_count + 1
-                            task_count.create_date = now_datetime
-                            task_count.modify_date = now_datetime
-                            task_count.modify_day = now_day
-                            task_count_model.add_update_entity(task_count,"complete_count=%s,now_count=%s,modify_date=%s,modify_day=%s",params=[task_count.complete_count,task_count.now_count,task_count.modify_date,now_day])
-                            invite_help_model.delete_dependency_key(DependencyKey.invite_user_help_list(help_id_md5,from_user_id))
-                    else:
-                        invoke_result_data.success = False
-                        invoke_result_data.error_code = task_invoke_result_data.error_code
-                        invoke_result_data.error_message = task_invoke_result_data.error_message
-
-        except Exception as ex:
-            if self.context:
-                self.context.logging_link_error("【邀请用户助力任务】" + traceback.format_exc())
-            elif self.logging_link_error:
-                self.logging_link_error("【邀请用户助力任务】" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "exception"
-            invoke_result_data.error_message = "系统繁忙,请稍后再试"
-
-        self.business_process_executed()
-
-        return invoke_result_data
-
-    def process_secret_code(self,app_id,act_id,module_id,user_id,login_token,handler_name,request_code,secret_code,check_new_user=False,check_user_nick=True,continue_request_expire=5,is_stat=True,info_json=None):
-        """
-        :description: 处理神秘暗号任务
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_id:用户标识
-        :param login_token:访问令牌
-        :param handler_name:接口名称
-        :param request_code:请求代码
-        :param secret_code:暗号
-        :param check_new_user:是否新用户才能领取 1是0否
-        :param check_user_nick:是否校验昵称为空
-        :param continue_request_expire:连续请求过期时间，为0不进行校验，单位秒
-        :param is_stat:是否统计上报
-        :param info_json:资产日志详细信息
-        :return 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        acquire_lock_name = f"process_secret_code:{act_id}_{module_id}_{user_id}"
-        task_type = TaskType.secret_code.value
-        now_day = TimeExHelper.get_now_day_int()
-        now_datetime = TimeHelper.get_now_format_time()
-        if not info_json:
-            info_json = {}
-        try:
-            invoke_result_data = self.business_process_executing(app_id,act_id,module_id,user_id,login_token,handler_name,check_new_user,check_user_nick,continue_request_expire,acquire_lock_name)
-            if invoke_result_data.success == True:
-                task_invoke_result_data = self.check_task_info(act_id,module_id,task_type)
-                if task_invoke_result_data.success == True:
-                    task_info_dict = task_invoke_result_data.data
-                    config_json = task_info_dict["config_json"]
-                    reward_value = int(config_json["reward_value"]) if config_json.__contains__("reward_value") else 0
-                    asset_object_id = config_json["asset_object_id"] if config_json.__contains__("asset_object_id") else ""
-                    limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
-                    cur_secret_code = config_json["secret_code"] if config_json.__contains__("secret_code") else ''
-                    act_info_dict = invoke_result_data.data["act_info_dict"]
-                    user_info_dict = invoke_result_data.data["user_info_dict"]
-                    task_count_model = TaskCountModel(sub_table=self.get_business_sub_table("task_count_tb",{"app_id":app_id}),context=self.context)
-                    task_count_id_md5 = self._get_task_count_id_md5(act_id,module_id,task_info_dict["task_type"],"",user_id)
-                    task_count = task_count_model.get_entity("id_md5=%s",params=[task_count_id_md5])
-                    task_count = TaskCount() if not task_count else task_count
-                    limit_meaasge = ""
-
-                    if task_info_dict["complete_type"] == 1:
-                        limit_meaasge = "今日领取上限"
-                        if task_count.modify_day != now_day:
-                            task_count.complete_count = 0
-                            task_count.now_count = 0
-                    elif task_info_dict["complete_type"] == 2:
-                        limit_meaasge = "每周领取上限"
-                        if TimeHelper.is_this_week(task_count.modify_date) == False:
-                            task_count.complete_count = 0
-                            task_count.now_count = 0
-                    else:
-                        limit_meaasge = "领取上限"
-                    is_limit = True if task_count.complete_count >= limit_num else False
-                    if is_limit == True:
-                        invoke_result_data.success = False
-                        invoke_result_data.error_code = "error"
-                        invoke_result_data.error_message = limit_meaasge
-                    elif cur_secret_code != secret_code:
-                        invoke_result_data.success = False
-                        invoke_result_data.error_code = "error"
-                        invoke_result_data.error_message = "暗号不正确"
-                    else:
-                        task_count.id_md5 = task_count_id_md5
-                        task_count.app_id = app_id
-                        task_count.act_id = act_id
-                        task_count.module_id = module_id
-                        task_count.user_id = user_id
-                        task_count.open_id = user_info_dict["open_id"]
-                        task_count.task_type = task_type
-                        task_count.task_sub_type = ""
-                        task_count.complete_count = task_count.complete_count+1
-                        task_count.now_count = 0
-                        task_count.create_date = now_datetime
-                        task_count.modify_date = now_datetime
-                        task_count.modify_day = now_day
-                        task_count_model.add_update_entity(task_count,"complete_count=%s,modify_date=%s,modify_day=%s",params=[task_count.complete_count,task_count.modify_date,now_day])
-                        reward_object_id = ""
-                        if reward_value > 0:
-                            only_id = self.get_only_id(user_id,task_info_dict["complete_type"],task_type,complete_count=task_count.complete_count)
-                            if module_id > 0:
-                                only_id = f"{module_id}_{only_id}"
-                            asset_type = self.get_task_asset_type(act_info_dict["task_asset_type_json"],task_type)
-                            reward_object_id = asset_type
-                            asset_base_model = AssetBaseModel(context=self.context)
-                            asset_invoke_result_data = asset_base_model.update_user_asset(app_id,act_id,module_id,user_id,user_info_dict["open_id"],user_info_dict["user_nick"],asset_type,reward_value,asset_object_id,2,task_type,task_info_dict["task_name"],task_info_dict["task_name"],only_id,handler_name,request_code,info_json=info_json)
-                            if asset_invoke_result_data.success == False:
-                                reward_value = 0
-                        invoke_result_data.data["reward_value"] = reward_value
-                        self.add_task_stat(task_type, app_id, act_id, module_id, user_info_dict["user_id"], user_info_dict["open_id"], reward_value, is_stat)
-                        self.add_task_log(task_type=task_type, task_sub_type='', app_id=app_id, act_id=act_id, module_id=module_id, user_id=user_info_dict["user_id"], open_id=user_info_dict["open_id"], user_nick=user_info_dict["user_nick"],task_name=task_info_dict["task_name"],log_title=task_info_dict["task_name"],reward_type=1, reward_object_id=reward_object_id, reward_name="", reward_num=reward_value, handler_name=handler_name, request_code=request_code, info_json=info_json)
-
-                else:
-                    invoke_result_data.success = False
-                    invoke_result_data.error_code = task_invoke_result_data.error_code
-                    invoke_result_data.error_message = task_invoke_result_data.error_message
-        except Exception as ex:
-            if self.context:
-                self.context.logging_link_error("【神秘暗号任务】" + traceback.format_exc())
-            elif self.logging_link_error:
-                self.logging_link_error("【神秘暗号任务】" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "exception"
-            invoke_result_data.error_message = "系统繁忙,请稍后再试"
-
-        self.business_process_executed()
-
-        return invoke_result_data
-
-    def process_crm_point_exchange_asset(self,app_id,act_id,module_id,user_id,login_token,handler_name,request_code,mix_nick,access_token,app_key,app_secret,check_new_user=False,check_user_nick=True,continue_request_expire=5,is_stat=True,info_json=None):
-        """
-        :description: 处理店铺会员积分兑换资产
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_id:用户标识
-        :param login_token:访问令牌
-        :param handler_name:接口名称
-        :param request_code:请求代码
-        :param mix_nick:mix_nick
-        :param access_token:access_token
-        :param app_key:app_key
-        :param app_secret:app_secret
-        :param check_new_user:是否新用户才能领取 1是0否
-        :param check_user_nick:是否校验昵称为空
-        :param continue_request_expire:连续请求过期时间，为0不进行校验，单位秒
-        :param is_stat:是否统计上报
-        :param info_json:资产日志详细信息
-        :return 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        acquire_lock_name = f"process_crm_point_exchange_asset:{act_id}_{module_id}_{user_id}"
-
-        task_type = TaskType.crm_point_exchange_asset.value
-        now_day = TimeExHelper.get_now_day_int()
-        now_datetime = TimeHelper.get_now_format_time()
-        if not info_json:
-            info_json = {}
-        try:
-            invoke_result_data = self.business_process_executing(app_id,act_id,module_id,user_id,login_token,handler_name,check_new_user,check_user_nick,continue_request_expire,acquire_lock_name)
-            if invoke_result_data.success == True:
-                task_invoke_result_data = self.check_task_info(act_id,module_id,task_type)
-                if task_invoke_result_data.success == True:
-                    task_info_dict = task_invoke_result_data.data
-                    config_json = task_info_dict["config_json"]
-                    reward_value = int(config_json["reward_value"]) if config_json.__contains__("reward_value") else 0
-                    asset_object_id = config_json["asset_object_id"] if config_json.__contains__("asset_object_id") else ""
-                    limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
-                    need_crm_point = int(config_json["satisfy_num"]) if config_json.__contains__("satisfy_num") else 0
-                    act_info_dict = invoke_result_data.data["act_info_dict"]
-                    user_info_dict = invoke_result_data.data["user_info_dict"]
-                    task_count_model = TaskCountModel(sub_table=self.get_business_sub_table("task_count_tb",{"app_id":app_id}),context=self.context)
-                    task_count_id_md5 = self._get_task_count_id_md5(act_id,module_id,task_info_dict["task_type"],"",user_id)
-                    task_count = task_count_model.get_entity("id_md5=%s",params=[task_count_id_md5])
-                    task_count = TaskCount() if not task_count else task_count
-                    limit_meaasge = ""
-                    top_base_model = TopBaseModel(context=self.context)
-
-                    if task_info_dict["complete_type"] == 1:
-                        limit_meaasge = "今日领取上限"
-                        if task_count.modify_day != now_day:
-                            task_count.complete_count = 0
-                            task_count.now_count = 0
-                    elif task_info_dict["complete_type"] == 2:
-                        limit_meaasge = "每周领取上限"
-                        if TimeHelper.is_this_week(task_count.modify_date) == False:
-                            task_count.complete_count = 0
-                            task_count.now_count = 0
-                    else:
-                        limit_meaasge = "领取上限"
-                    is_limit = True if task_count.complete_count >= limit_num else False
-                    if is_limit == True:
-                        invoke_result_data.success = False
-                        invoke_result_data.error_code = "error"
-                        invoke_result_data.error_message = limit_meaasge
-                    elif not need_crm_point:
-                        invoke_result_data.success = False
-                        invoke_result_data.error_code = "error"
-                        invoke_result_data.error_message = "配置异常无法兑换"
-                    else:
-                        member_invoke_result_data = top_base_model.get_crm_point_available(mix_nick, access_token, app_key, app_secret, user_info_dict["open_id"])
-                        if member_invoke_result_data.success == False:
-                            invoke_result_data.success = False
-                            invoke_result_data.error_code = "member_error"
-                            invoke_result_data.error_message = "获取会员积分失败"
-                        elif member_invoke_result_data.data < need_crm_point:
-                            invoke_result_data.success = False
-                            invoke_result_data.error_code = "member_error"
-                            invoke_result_data.error_message = f"会员积分不足，当前只有{member_invoke_result_data.data}积分"
-                        else:
-                            invoke_result_data.data["need_crm_point"] = need_crm_point
-
-                            task_count.id_md5 = task_count_id_md5
-                            task_count.app_id = app_id
-                            task_count.act_id = act_id
-                            task_count.module_id = module_id
-                            task_count.user_id = user_id
-                            task_count.open_id = user_info_dict["open_id"]
-                            task_count.task_type = task_type
-                            task_count.task_sub_type = ""
-                            task_count.complete_count = task_count.complete_count+1
-                            task_count.now_count = 0
-                            task_count.create_date = now_datetime
-                            task_count.modify_date = now_datetime
-                            task_count.modify_day = now_day
-                            task_count_model.add_update_entity(task_count,"complete_count=%s,modify_date=%s,modify_day=%s",params=[task_count.complete_count,task_count.modify_date,now_day])
-                            reward_object_id = ""
-                            if reward_value > 0:
-                                crm_point_invoke_result_data = top_base_model.change_crm_point(user_info_dict["open_id"], mix_nick, 1, 1, need_crm_point, access_token, app_key, app_secret, 0, "", True)
-                                if crm_point_invoke_result_data.success == True:
-                                    only_id = self.get_only_id(user_id,task_info_dict["complete_type"],task_type,complete_count=task_count.complete_count)
-                                    if module_id > 0:
-                                        only_id = f"{module_id}_{only_id}"
-                                    asset_type = self.get_task_asset_type(act_info_dict["task_asset_type_json"],task_type)
-                                    reward_object_id = asset_type
-                                    asset_base_model = AssetBaseModel(context=self.context)
-                                    asset_invoke_result_data = asset_base_model.update_user_asset(app_id,act_id,module_id,user_id,user_info_dict["open_id"],user_info_dict["user_nick"],asset_type,reward_value,asset_object_id,2,task_type,task_info_dict["task_name"],task_info_dict["task_name"],only_id,handler_name,request_code,info_json=info_json)
-                                    if asset_invoke_result_data.success == False:
-                                        reward_value = 0
-                                else:
-                                    reward_value = 0
-
-                            invoke_result_data.data["reward_value"] = reward_value
-                            self.add_task_stat(task_type, app_id, act_id, module_id, user_info_dict["user_id"], user_info_dict["open_id"], reward_value, is_stat)
-                            self.add_task_log(task_type=task_type, task_sub_type='', app_id=app_id, act_id=act_id, module_id=module_id, user_id=user_info_dict["user_id"], open_id=user_info_dict["open_id"], user_nick=user_info_dict["user_nick"],task_name=task_info_dict["task_name"],log_title=task_info_dict["task_name"],reward_type=1, reward_object_id=reward_object_id, reward_name="", reward_num=reward_value, handler_name=handler_name, request_code=request_code, info_json=info_json)
-                else:
-                    invoke_result_data.success = False
-                    invoke_result_data.error_code = task_invoke_result_data.error_code
-                    invoke_result_data.error_message = task_invoke_result_data.error_message
-        except Exception as ex:
-            if self.context:
-                self.context.logging_link_error("【店铺会员积分兑换资产任务】" + traceback.format_exc())
-            elif self.logging_link_error:
-                self.logging_link_error("【店铺会员积分兑换资产任务】" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "exception"
-            invoke_result_data.error_message = "系统繁忙,请稍后再试"
-
-        self.business_process_executed()
-
-        return invoke_result_data
-
-    def process_routine_task(self,app_id,act_id,module_id,user_id,login_token,handler_name,task_type,task_sub_type,check_new_user=False,check_user_nick=True,continue_request_expire=5):
-        """
-        :description: 处理常规任务 只计数不领取奖励
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_id:用户标识
-        :param login_token:访问令牌
-        :param handler_name:接口名称
-        :param task_type:任务类型
-        :param task_sub_type:子任务类型，没有传空
-        :param check_new_user:是否新用户才能领取 1是0否
-        :param check_user_nick:是否校验昵称为空
-        :param continue_request_expire:连续请求过期时间，为0不进行校验，单位秒
-        :return 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        acquire_lock_name = f"process_routine_task:{act_id}_{module_id}_{user_id}_{task_type}"
-        try:
-            invoke_result_data = self.business_process_executing(app_id,act_id,module_id,user_id,login_token,handler_name,check_new_user,check_user_nick,continue_request_expire,acquire_lock_name)
-            if invoke_result_data.success == True:
-                user_info_dict = invoke_result_data.data["user_info_dict"]
-                task_invoke_result_data = self.check_task_info(act_id,module_id,task_type)
-                if task_invoke_result_data.success == True:
-                    task_info_dict = task_invoke_result_data.data
-                    task_count_invoke_result_data = self.add_task_count(app_id, act_id, module_id, user_id, user_info_dict["open_id"], task_type, 1, task_info_dict, task_sub_type)
-                    if task_count_invoke_result_data.success == False:
-                        invoke_result_data.success = False
-                        invoke_result_data.error_code = task_count_invoke_result_data.error_code
-                        invoke_result_data.error_message = task_count_invoke_result_data.error_message
-                else:
-                    invoke_result_data.success = False
-                    invoke_result_data.error_code = task_invoke_result_data.error_code
-                    invoke_result_data.error_message = task_invoke_result_data.error_message
-        except Exception as ex:
-            if self.context:
-                self.context.logging_link_error("【通用任务】" + traceback.format_exc())
-            elif self.logging_link_error:
-                self.logging_link_error("【通用任务】" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "exception"
-            invoke_result_data.error_message = "系统繁忙,请稍后再试"
-
-        self.business_process_executed()
-
-        return invoke_result_data
-
-    def process_routine_invite_task(self,task_type,invite_sub_table,app_id,act_id,module_id,user_id,login_token,from_user_id,handler_name,check_new_user=True,check_user_nick=True,continue_request_expire=5,close_invite_limit=False):
-        """
-        :description: 处理常规邀请任务(当一个活动有多个邀请任务时，可以使用当前方法)
-        :param task_type:任务类型
-        :param invite_sub_table:分表名
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_id:当前用户标识
-        :param login_token:访问令牌
-        :param from_user_id:邀请人用户标识
-        :param handler_name:接口名称
-        :param check_new_user:是否校验新用户
-        :param check_user_nick:是否校验昵称为空
-        :param continue_request_expire:连续请求过期时间，为0不进行校验，单位秒
-        :param close_invite_limit:是否关闭邀请限制 True是(老用户也可以邀请成功) False否
-        :return 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        acquire_lock_name = f"process_routine_invite_task:{act_id}_{module_id}_{user_id}_{task_type}"
-        now_day = TimeExHelper.get_now_day_int()
-        now_datetime = TimeHelper.get_now_format_time()
-        try:
-            invoke_result_data = InvokeResultData()
-            if user_id == from_user_id:
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "error"
-                invoke_result_data.error_message = "无效邀请"
-                return invoke_result_data
-
-            invoke_result_data = self.business_process_executing(app_id,act_id,module_id,user_id,login_token,handler_name,check_new_user,check_user_nick,continue_request_expire,acquire_lock_name)
-            if invoke_result_data.success == True:
-                user_info_dict = invoke_result_data.data["user_info_dict"]
-                user_base_model = UserBaseModel(context=self.context)
-                from_user_info_dict = user_base_model.get_user_info_dict(app_id,act_id,from_user_id)
-                invite_log_model = InviteLogModel(context=self.context,sub_table=invite_sub_table)
-                is_invite = invite_log_model.get_total("act_id=%s and invite_user_id=%s", params=[act_id, user_id])
-                if is_invite > 0:
-                    invoke_result_data.success = False
-                    invoke_result_data.error_code = "error"
-                    invoke_result_data.error_message = "此用户已经被邀请过"
-                elif not from_user_info_dict:
-                    invoke_result_data.success = False
-                    invoke_result_data.error_code = "error"
-                    invoke_result_data.error_message = "邀请人不存在"
-                else:
-                    task_invoke_result_data = self.check_task_info(act_id,module_id,task_type)
-                    if task_invoke_result_data.success == True:
-                        task_info_dict = task_invoke_result_data.data
-                        config_json = task_info_dict["config_json"]
-                        limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
-                        satisfy_num = int(config_json["satisfy_num"]) if config_json.__contains__("satisfy_num") else 1
-                        task_count_model = TaskCountModel(sub_table=self.get_business_sub_table("task_count_tb",{"app_id":app_id}),context=self.context)
-                        task_count_id_md5 = self._get_task_count_id_md5(act_id,module_id,task_info_dict["task_type"],"",from_user_id)
-                        task_count = task_count_model.get_entity("id_md5=%s",params=[task_count_id_md5])
-                        task_count = TaskCount() if not task_count else task_count
-                        limit_meaasge = ""
-                        if task_info_dict["complete_type"] == TaskCompleteType.day.value:
-                            limit_meaasge = "今日邀请上限"
-                            if task_count.modify_day != now_day:
-                                task_count.complete_count = 0
-                                task_count.now_count = 0
-                        elif task_info_dict["complete_type"] == TaskCompleteType.week.value:
-                            limit_meaasge = "每周邀请上限"
-                            if TimeHelper.is_this_week(task_count.modify_date) == False:
-                                task_count.complete_count = 0
-                                task_count.now_count = 0
-                        elif task_info_dict["complete_type"] == TaskCompleteType.month.value:
-                            limit_meaasge = "每月邀请上限"
-                            if TimeHelper.is_this_month(task_count.modify_date) == False:
-                                task_count.complete_count = 0
-                                task_count.now_count = 0
-                        else:
-                            limit_meaasge = "邀请上限"
-                        invite_count = int(task_count.complete_count * satisfy_num) + task_count.now_count
-                        is_invite_limit = True if invite_count >= limit_num else False
-                        if is_invite_limit == True and close_invite_limit == False:
-                            invoke_result_data.success = False
-                            invoke_result_data.error_code = "error"
-                            invoke_result_data.error_message = limit_meaasge
-                        else:
-
-                            invite_log = InviteLog()
-                            invite_log.app_id = app_id
-                            invite_log.act_id = act_id
-                            invite_log.user_id = from_user_id
-                            invite_log.open_id = from_user_info_dict["open_id"]
-                            invite_log.invite_user_id = user_info_dict["user_id"]
-                            invite_log.invite_open_id = user_info_dict["open_id"]
-                            invite_log.invite_user_nick = user_info_dict["user_nick"]
-                            invite_log.invite_avatar = user_info_dict["avatar"]
-                            invite_log.is_handle = 0
-                            invite_log.create_date = now_datetime
-                            invite_log.create_day = now_day
-                            invite_log_model.add_entity(invite_log)
-
-                            task_count.id_md5 = task_count_id_md5
-                            task_count.app_id = app_id
-                            task_count.act_id = act_id
-                            task_count.module_id = module_id
-                            task_count.user_id = from_user_id
-                            task_count.open_id = from_user_info_dict["open_id"]
-                            task_count.task_type = task_type
-                            task_count.task_sub_type = ""
-                            task_count.now_count = task_count.now_count + 1
-                            task_count.create_date = now_datetime
-                            task_count.modify_date = now_datetime
-                            task_count.modify_day = now_day
-                            task_count_model.add_update_entity(task_count,"complete_count=%s,now_count=%s,modify_date=%s,modify_day=%s",params=[task_count.complete_count,task_count.now_count,task_count.modify_date,now_day])
-                    else:
-                        invoke_result_data.success = False
-                        invoke_result_data.error_code = task_invoke_result_data.error_code
-                        invoke_result_data.error_message = task_invoke_result_data.error_message
-
-        except Exception as ex:
-            if self.context:
-                self.context.logging_link_error("【处理常规邀请任务】" + traceback.format_exc())
-            elif self.logging_link_error:
-                self.logging_link_error("【处理常规邀请任务】" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "exception"
-            invoke_result_data.error_message = "系统繁忙,请稍后再试"
-
-        self.business_process_executed()
-
-        return invoke_result_data
-
-    def process_buy_appoint_goods_task(self,app_id,act_id,module_id,user_id,login_token,handler_name,order_data=[],app_key="",app_secret="",is_log=False,check_user_nick=True,continue_request_expire=5,is_stat=True,support_presale_order=False):
-        """
-        :description: 购买指定商品任务
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_id:用户标识
-        :param login_token:访问令牌
-        :param handler_name:接口名称
-        :param order_data:订单数据
-        :param app_key:app_key
-        :param app_secret:app_secret
-        :param is_log:是否记录top请求日志
-        :param check_user_nick:是否校验昵称为空
-        :param continue_request_expire:连续请求过期时间，为0不进行校验，单位秒
-        :param is_stat:是否统计上报
-        :param support_presale_order:是否支持预售订单
-        :return 
-        :last_editors: HuangJianYi
-        """
-        task_type = TaskType.buy_appoint_goods.value
-        acquire_lock_name = f"process_buy_appoint_goods_task:{act_id}_{module_id}_{user_id}"
-        now_day = TimeExHelper.get_now_day_int()
-        now_datetime = TimeHelper.get_now_format_time()
-        try:
-            invoke_result_data = self.business_process_executing(app_id,act_id,module_id,user_id,login_token,handler_name,False,check_user_nick,continue_request_expire,acquire_lock_name)
-            if invoke_result_data.success == True:
-                task_invoke_result_data = self.check_task_info(act_id,module_id,task_type)
-                if task_invoke_result_data.success == True:
-                    task_info_dict = task_invoke_result_data.data
-                    config_json = task_info_dict["config_json"]
-                    act_info_dict = invoke_result_data.data["act_info_dict"]
-                    act_module_dict = invoke_result_data.data["act_module_dict"]
-                    user_info_dict = invoke_result_data.data["user_info_dict"]
-                    goods_ids_list = list(set(str(config_json["goods_ids"]).split(','))) if config_json.__contains__("goods_ids") else []
-                    limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
-                    satisfy_num = int(config_json["satisfy_num"]) if config_json.__contains__("satisfy_num") else 1
-                    task_count_model = TaskCountModel(sub_table=self.get_business_sub_table("task_count_tb",{"app_id":app_id}),context=self.context)
-                    task_count_id_md5 = self._get_task_count_id_md5(act_id,module_id,task_info_dict["task_type"],"",user_id)
-                    task_count = task_count_model.get_entity("id_md5=%s",params=[task_count_id_md5])
-                    task_count = TaskCount() if not task_count else task_count
-                    limit_meaasge = ""
-                    if task_info_dict["complete_type"] == 1:
-                        limit_meaasge = "今日购买上限"
-                        if task_count.modify_day != now_day:
-                            task_count.complete_count = 0
-                            task_count.now_count = 0
-                            task_count.remark = ""
-                    elif task_info_dict["complete_type"] == 2:
-                        limit_meaasge = "每周购买上限"
-                        if TimeHelper.is_this_week(task_count.modify_date) == False:
-                            task_count.complete_count = 0
-                            task_count.now_count = 0
-                            task_count.remark = ""
-                    else:
-                        limit_meaasge = "购买上限"
-                    buy_count = int(task_count.complete_count * satisfy_num) + task_count.now_count
-                    is_buy_limit = True if buy_count >= (limit_num * satisfy_num) else False
-                    if is_buy_limit == True:
-                        invoke_result_data.success = False
-                        invoke_result_data.error_code = "error"
-                        invoke_result_data.error_message = limit_meaasge
-                    else:
-                        app_info_dict = AppBaseModel(context=self.context).get_app_info_dict(app_id=app_id,is_cache=True,field="access_token")
-                        access_token = app_info_dict["access_token"] if app_info_dict else ""
-                        top_base_model = TopBaseModel(context=self.context)
-                        if len(order_data) <= 0:
-                            start_date = act_info_dict['start_date']
-                            start_date = act_module_dict['start_date'] if act_module_dict and act_module_dict['start_date'] else start_date
-                            if start_date and start_date != '1900-01-01 00:00:00':
-                                invoke_result_data = top_base_model.get_buy_order_list(user_info_dict["open_id"], access_token, app_key, app_secret, start_date, is_log=is_log)
-                                if invoke_result_data.success == True:
-                                    order_data = invoke_result_data.data
-                            else:
-                                invoke_result_data = top_base_model.get_buy_order_list(user_info_dict["open_id"], access_token, app_key, app_secret, is_log=is_log)
-                                if invoke_result_data.success == True:
-                                    order_data = invoke_result_data.data
-                        if len(order_data) > 0:
-                            invoke_result_data.data = {}
-                            order_base_model = OrderBaseModel(context=self.context)
-                            pay_order_no_list, redis_init, pay_order_cache_key = order_base_model._get_tao_pay_order_no_list(app_id,user_id)
-
-                            #满足奖励条件的订单
-                            reward_order_list = []
-                            for item in order_data:
-                                for order in item["orders"]["order"]:
-                                    if str(order["num_iid"]) in goods_ids_list:
-                                        order["step_paid_fee"] = item["step_paid_fee"] if "step_paid_fee" in item.keys() else 0
-                                        order["type"] = item["type"]
-                                        if "pay_time" in item:
-                                            order["pay_time"] = item["pay_time"]
-                                            order["tid"] = item["tid"]
-                                        if support_presale_order == True:
-                                            if order["status"] in self.rewards_status() or (order["type"] == "step" and order["step_trade_status"] != "FRONT_NOPAID_FINAL_NOPAID"):
-                                                reward_order_list.append(order)
-                                        else:
-                                            if order["status"] in self.rewards_status():
-                                                reward_order_list.append(order)
-
-                            pay_price = 0 #总支付金额
-                            pay_num = 0  #总支付笔数
-                            buy_num = 0  #总购买数量
-                            appoint_goods_id_list = [] #购买指定商品ID集合
-                            tao_pay_order_list = []
-
-                            for order in reward_order_list:
-                                try:
-                                    #判断是否已经统计过
-                                    if order["oid"] not in pay_order_no_list:
-                                        appoint_goods_id_list.append(str(order["num_iid"]))
-                                        tao_pay_order = TaoPayOrder()
-                                        tao_pay_order.app_id = app_id
-                                        tao_pay_order.act_id = act_id
-                                        tao_pay_order.ascription_type = 2
-                                        tao_pay_order.user_id = user_id
-                                        tao_pay_order.open_id = user_info_dict["open_id"]
-                                        tao_pay_order.user_nick = user_info_dict["user_nick"]
-                                        tao_pay_order.main_pay_order_no = order['tid']
-                                        tao_pay_order.sub_pay_order_no = order['oid']
-                                        tao_pay_order.goods_code = order['num_iid']
-                                        tao_pay_order.goods_name = order['title']
-                                        if "sku_id" in order.keys():
-                                            tao_pay_order.sku_id = order['sku_id']
-                                            sku_invoke_result_data = top_base_model.get_sku_name(int(order['num_iid']), int(order['sku_id']), access_token, app_key, app_secret,is_log)
-                                            tao_pay_order.sku_name = sku_invoke_result_data.data if sku_invoke_result_data.success == True else ""
-                                        tao_pay_order.buy_num = order['num']
-                                        tao_pay_order.pay_price = order['payment']
-                                        tao_pay_order.order_status = order['status']
-                                        tao_pay_order.create_date = SevenHelper.get_now_datetime()
-                                        tao_pay_order.pay_date = order['pay_time']
-                                        tao_pay_order_list.append(tao_pay_order)
-                                        if support_presale_order == True:
-                                            payment = decimal.Decimal(order["step_paid_fee"]) if order["type"] == "step" and decimal.Decimal(order["step_paid_fee"]) > 0 else decimal.Decimal(order["payment"])
-                                        else:
-                                            payment = decimal.Decimal(order["payment"])
-                                        pay_price = decimal.Decimal(pay_price) + payment
-                                        pay_num = pay_num + 1
-                                        buy_num = buy_num + order['num']
-                                except Exception as ex:
-                                    if self.context:
-                                        self.context.logging_link_info(str(order) + "【购买指定商品任务】" + traceback.format_exc())
-                                    elif self.logging_link_info:
-                                        self.logging_link_info(str(order) + "【购买指定商品任务】" + traceback.format_exc())
-                                    continue
-                            if len(tao_pay_order_list) > 0:
-                                task_count.id_md5 = task_count_id_md5
-                                task_count.app_id = app_id
-                                task_count.act_id = act_id
-                                task_count.module_id = module_id
-                                task_count.user_id = user_id
-                                task_count.open_id = user_info_dict["open_id"]
-                                task_count.task_type = task_type
-                                task_count.now_count = task_count.now_count + pay_num
-                                task_count.create_date = now_datetime
-                                task_count.modify_date = now_datetime
-                                task_count.modify_day = now_day
-                                remark = SevenHelper.json_loads(task_count.remark) if task_count.remark else {"goods_id_list":[]}
-                                remark["goods_id_list"].extend(appoint_goods_id_list)
-                                task_count.remark = SevenHelper.json_dumps(remark)
-                                TaoPayOrderModel(context=self.context).add_list(tao_pay_order_list)
-                                task_count_model.add_update_entity(task_count,"complete_count=%s,modify_date=%s,modify_day=%s,remark=%s",params=[task_count.complete_count,task_count.modify_date,now_day,task_count.remark])
-                                for item in tao_pay_order_list:
-                                    redis_init.lpush(pay_order_cache_key,item.sub_pay_order_no)
-                                    redis_init.expire(pay_order_cache_key, 30 * 24 * 3600)
-
-                                invoke_result_data.data["buy_num"] = buy_num
-                                invoke_result_data.data["pay_price"] = pay_price
-                                invoke_result_data.data["pay_num"] = pay_num
-                                if is_stat == True:
-                                    stat_base_model = StatBaseModel(context=self.context)
-                                    key_list_dict = {}
-                                    key_list_dict["TotalBuyAppointGoodsMoneyCount"] = pay_price #支付金额
-                                    stat_base_model.add_stat_list(app_id, act_id, 0, user_id, user_info_dict["open_id"], key_list_dict)
-                            else:
-                                invoke_result_data.success = False
-                                invoke_result_data.error_code = "error"
-                                invoke_result_data.error_message = "没有匹配订单"
-                else:
-                    invoke_result_data.success = False
-                    invoke_result_data.error_code = "error"
-                    invoke_result_data.error_message = "没有开启或配置购买指定商品任务"
-        except Exception as ex:
-            if self.context:
-                self.context.logging_link_error("【购买指定商品任务】" + traceback.format_exc())
-            elif self.logging_link_error:
-                self.logging_link_error("【购买指定商品任务】" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "exception"
-            invoke_result_data.error_message = "系统繁忙,请稍后再试"
-        finally:
-            self.business_process_executed()
-
-        return invoke_result_data
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-08-10 10:41:13
+@LastEditTime: 2023-07-21 16:10:01
+@LastEditors: HuangJianYi
+@Description: 
+"""
+from asq.initiators import query
+from seven_cloudapp_frame.models.enum import *
+from seven_cloudapp_frame.models.top_base_model import *
+from seven_cloudapp_frame.models.frame_base_model import FrameBaseModel
+from seven_cloudapp_frame.models.asset_base_model import *
+from seven_cloudapp_frame.models.stat_base_model import *
+from seven_cloudapp_frame.models.user_base_model import *
+from seven_cloudapp_frame.models.app_base_model import *
+from seven_cloudapp_frame.models.order_base_model import *
+from seven_cloudapp_frame.models.db_models.user.user_info_model import *
+from seven_cloudapp_frame.models.db_models.task.task_info_model import *
+from seven_cloudapp_frame.models.db_models.task.task_count_model import *
+from seven_cloudapp_frame.models.db_models.invite.invite_log_model import *
+from seven_cloudapp_frame.models.db_models.invite.invite_help_model import *
+from seven_cloudapp_frame.models.db_models.collect.collect_log_model import *
+from seven_cloudapp_frame.models.db_models.browse.browse_log_model import *
+from seven_cloudapp_frame.models.db_models.task.task_gear_count_model import *
+from seven_cloudapp_frame.models.db_models.task.task_log_model import *
+
+
+
+class TaskBaseModel(FrameBaseModel):
+    """
+    :description: 任务业务模型
+    """
+    def __init__(self, context=None,logging_error=None, logging_info=None):
+        self.context = context
+        self.logging_link_error = logging_error
+        self.logging_link_info = logging_info
+        super(TaskBaseModel,self).__init__(context)
+
+    def _delete_task_info_dependency_key(self, act_id, task_id=0, delay_delete_time=0.01):
+        """
+        :description: 删除任务依赖建
+        :param act_id: 活动标识
+        :param task_id: 任务标识
+        :param delay_delete_time: 延迟删除时间，传0则不进行延迟
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        dependency_key_list = []
+        if task_id:
+            dependency_key_list.append(DependencyKey.task_info(task_id))
+        if act_id:
+            dependency_key_list.append(DependencyKey.task_info_list(act_id))
+        TaskInfoModel().delete_dependency_key(dependency_key_list,delay_delete_time)
+
+    def get_task_info_dict_list(self,app_id,act_id,module_id,is_release,is_cache=True):
+        """
+        :description: 获取任务列表
+        :param app_id: 应用标识
+        :param act_id: 活动标识
+        :param module_id: 活动模块标识
+        :param is_release: 是否发布
+        :param is_cache: 是否缓存
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        order_by = "sort_index desc,id asc"
+        condition = "act_id=%s"
+        params = [act_id]
+        if is_release !=-1:
+            condition += " and is_release=%s"
+            params.append(is_release)
+        if module_id !=-1:
+            condition += " and module_id=%s"
+            params.append(module_id)
+        if app_id:
+            condition += " and app_id=%s"
+            params.append(app_id)
+
+        task_info_model = TaskInfoModel(context=self.context)
+        if is_cache:
+            dict_list = task_info_model.get_cache_dict_list(condition, group_by="", order_by=order_by, params=params,dependency_key=DependencyKey.task_info_list(act_id))
+        else:
+            dict_list = task_info_model.get_dict_list(condition, group_by="", order_by=order_by, params=params)
+        for task_info in dict_list:
+            task_info["config_json"] = SevenHelper.json_loads(task_info["config_json"]) if task_info["config_json"] else {}
+        return dict_list
+
+    def get_task_info_dict(self,task_id,is_cache=True,is_filter=True):
+        """
+        :description: 获取任务信息
+        :param task_id: 任务标识
+        :param is_cache: 是否缓存
+        :param is_filter: 是否过滤未发布的数据
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        task_info_model = TaskInfoModel(context=self.context)
+        task_info_dict = None
+        if is_cache:
+            task_info_dict = task_info_model.get_cache_dict_by_id(task_id,dependency_key=DependencyKey.task_info(task_id))
+        else:
+            task_info_dict = task_info_model.get_dict_by_id(task_id)
+        if is_filter == True:
+            if not task_info_dict or task_info_dict["is_release"] == 0:
+                return None
+        return task_info_dict
+
+    def get_task_asset_type(self, task_asset_type_json, task_type):
+        """
+        :description: 获取任务奖励资产类型 (先取配置文件的值没有用默认值，如果数据库有配置则使用数据库的值)
+        :param task_asset_type:任务资产类型配置  key:1次数2积分3价格档位4店铺会员积分9999其他（混合搭配）
+        :param task_type:任务类型
+        :return 任务奖励资产类型
+        :last_editors: HuangJianYi
+        """
+        asset_type = int(share_config.get_value("task_asset_type",2))
+        if task_asset_type_json == "":
+            return asset_type
+        task_asset_type_dict = SevenHelper.json_loads(task_asset_type_json)
+        if not task_asset_type_dict:
+            return asset_type
+        if int(task_asset_type_dict["key"]) != 9999:
+            asset_type = int(task_asset_type_dict["key"])
+            return asset_type
+        value_dict = task_asset_type_dict["value"]
+        if not value_dict:
+            return asset_type
+        if str(task_type) in value_dict.keys():
+            asset_type = value_dict[str(task_type)]
+        return asset_type
+
+    def get_business_map_frame_task_type(self,task_type):
+        """
+        :description: 映射任务类型，如果配置文件有配置相应的任务类型key，则会替换key对应枚举中的值，使用场景：用于在把业务写的方法整合到框架的时候，任务类型不一致的情况，业务可以使用原本定义的任务类型调用框架里的方法
+        :param task_type:任务类型值
+        :return 最终的任务类型值
+        :last_editors: HuangJianYi
+        """
+        key = ""
+        try:
+            key = TaskType(task_type).name
+        except ValueError:
+            pass
+        task_type_dict = share_config.get_value("business_map_frame_task_type",{})
+        if key and str(key) in task_type_dict.keys():
+            task_type = int(task_type_dict[str(key)])
+        return task_type
+
+    def _get_task_count_id_md5(self,act_id,module_id,task_type,task_sub_type,user_id):
+        """
+        :description: 获取任务计数标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param task_type:任务类型
+        :param task_sub_type:任务子类型
+        :param user_id:用户标识
+        :return 获取任务计数标识
+        :last_editors: HuangJianYi
+        """
+        if not act_id or not task_type or not user_id:
+            return 0
+        return CryptoHelper.md5_encrypt_int(f"{act_id}_{module_id}_{task_type}_{task_sub_type}_{user_id}")
+
+    def check_task_info(self,act_id,module_id,task_type=0,task_id=0):
+        """
+        :description: 校验任务信息
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param task_type:任务类型
+        :param task_id:任务标识
+        :return 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        try:
+            task_info_model = TaskInfoModel(context=self.context)
+            if task_id>0:
+                task_info_dict = self.get_task_info_dict(task_id)
+            else:
+                task_info_dict = task_info_model.get_cache_dict("act_id=%s and is_release=1 and task_type=%s and module_id=%s",limit="1",params=[act_id,task_type,module_id],dependency_key=f"task_info_list:actid_{act_id}")
+            if not task_info_dict or task_info_dict["is_release"] == 0:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "error"
+                invoke_result_data.error_message = "任务信息不存在"
+                return invoke_result_data
+            config_json = SevenHelper.json_loads(task_info_dict["config_json"])
+            if not config_json:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "error"
+                invoke_result_data.error_message = "任务信息配置不存在"
+                return invoke_result_data
+            task_info_dict["config_json"] = config_json
+            invoke_result_data.data = task_info_dict
+        except Exception as ex:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "exception"
+            invoke_result_data.error_message = "任务信息不存在"
+            return invoke_result_data
+        return invoke_result_data
+
+    def get_only_id(self,user_id,complete_type,task_type,task_sub_type="",complete_count=1):
+        """
+        :description: 获取only_id
+        :param user_id:用户标识
+        :param complete_type:完成类型(1每日任务2每周任务3持久任务)
+        :param task_type:任务类型
+        :param task_sub_type:任务子类型
+        :param complete_count:完成次数
+        :return only_id
+        :last_editors: HuangJianYi
+        """
+        only_id = f"task_{user_id}_{task_type}_{task_sub_type}"
+        if complete_type == 1:
+            only_id += f"_{TimeExHelper.get_now_day_int()}"
+        elif complete_type == 2:
+            only_id += f"_{str(datetime.datetime.now().year)+str(datetime.datetime.now().isocalendar()[1])}"
+        else:
+            only_id += f"_0"
+        only_id += f"_{complete_count}"
+        return only_id
+
+    def add_task_stat(self, task_type, app_id, act_id, module_id, user_id, open_id, reward_value, is_stat=True, complete_count=1):
+        """
+        :description: 添加任务统计
+        :param task_type:任务类型
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:模块标识
+        :param user_id:用户标识
+        :param open_id:open_id
+        :param open_id:open_id
+        :param reward_value:奖励值
+        :param is_stat:是否统计
+        :param complete_count:完成次数
+        :last_editors: HuangJianYi
+        """
+        if is_stat == True:
+            stat_base_model = StatBaseModel(context=self.context)
+            key_list_dict = {}
+            if task_type == int(TaskType.collect_goods.value):
+                key_list_dict["CollectUserCount"] = 1 #完成人数
+                key_list_dict["CollectCount"] = complete_count #完成次数
+                key_list_dict["CollectRewardCount"] = reward_value #奖励值
+            elif task_type == int(TaskType.browse_goods.value):
+                key_list_dict["BrowseUserCount"] = 1 #完成人数
+                key_list_dict["BrowseCount"] = complete_count #完成次数
+                key_list_dict["BrowseRewardCount"] = reward_value #奖励值
+            elif task_type == int(TaskType.invite_new_user.value):
+                key_list_dict["InviteUserCount"] = 1 #完成人数
+                key_list_dict["InviteCount"] = complete_count #完成次数
+                key_list_dict["InviteRewardCount"] = reward_value #奖励值
+            elif task_type == int(TaskType.invite_join_member.value):
+                key_list_dict["InviteJoinMemberUserCount"] = 1 #完成人数
+                key_list_dict["InviteJoinMemberCount"] = complete_count #完成次数
+                key_list_dict["InviteJoinMemberRewardCount"] = reward_value #奖励值
+            elif task_type == int(TaskType.invite_user_help.value):
+                key_list_dict["InviteHelpUserCount"] = 1 #完成人数
+                key_list_dict["InviteHelpCount"] = complete_count #完成次数
+                key_list_dict["InviteHelpRewardCount"] = reward_value #奖励值
+            elif task_type == int(TaskType.browse_store.value):
+                key_list_dict["BrowseStoreUserCount"] = 1 #完成人数
+                key_list_dict["BrowseStoreCount"] = complete_count #完成次数
+                key_list_dict["BrowseStoreRewardCount"] = reward_value #奖励值
+            elif task_type == int(TaskType.browse_live_room.value):
+                key_list_dict["BrowseLiveRoomUserCount"] = 1 #完成人数
+                key_list_dict["BrowseLiveRoomCount"] = complete_count #完成次数
+                key_list_dict["BrowseLiveRoomRewardCount"] = reward_value #奖励值
+            elif task_type == int(TaskType.browse_special_topic.value):
+                key_list_dict["BrowseSpecialTopicUserCount"] = 1 #完成人数
+                key_list_dict["BrowseSpecialTopicCount"] = complete_count #完成次数
+                key_list_dict["BrowseSpecialTopicRewardCount"] = reward_value #奖励值
+            elif task_type == int(TaskType.share.value):
+                key_list_dict["TaskShareUserCount"] = 1 #完成人数
+                key_list_dict["TaskShareCount"] = complete_count #完成次数
+                key_list_dict["TaskShareRewardCount"] = reward_value #奖励值
+            elif task_type == int(TaskType.free_gift.value):
+                key_list_dict["FreeGiftUserCount"] = 1 #完成人数
+                key_list_dict["FreeGiftCount"] = complete_count #完成次数
+                key_list_dict["FreeGiftRewardCount"] = reward_value #完成奖励值
+            elif task_type == int(TaskType.one_sign.value):
+                key_list_dict["OneSignUserCount"] = 1 #完成人数
+                key_list_dict["OneSignCount"] = complete_count #完成次数
+                key_list_dict["OneSignRewardCount"] = reward_value #奖励值
+            elif task_type == int(TaskType.weekly_sign.value):
+                key_list_dict["WeeklySignUserCount"] = 1 #完成人数
+                key_list_dict["WeeklySignCount"] = complete_count #完成次数
+                key_list_dict["WeeklySignRewardCount"] = reward_value #奖励值
+            elif task_type == int(TaskType.cumulative_sign.value):
+                key_list_dict["CumulativeSignUserCount"] = 1 #完成人数
+                key_list_dict["CumulativeSignCount"] = complete_count #完成次数
+                key_list_dict["CumulativeSignRewardCount"] = reward_value #奖励值
+            elif task_type == int(TaskType.successive_sign.value):
+                key_list_dict["SuccessiveSignUserCount"] = 1 #完成人数
+                key_list_dict["SuccessiveSignCount"] = complete_count #完成次数
+                key_list_dict["SuccessiveSignRewardCount"] = reward_value #奖励值
+            elif task_type == int(TaskType.favor_store.value):
+                key_list_dict["FollowUserCount"] = 1 #完成人数
+                key_list_dict["FollowCount"] = complete_count #完成次数
+                key_list_dict["FollowRewardCount"] = reward_value #奖励值
+            elif task_type == int(TaskType.join_member.value):
+                key_list_dict["MemberUserCount"] = 1 #加入会员完成人数
+                key_list_dict["MemberCount"] = complete_count #加入会员完成次数
+                key_list_dict["MemberRewardCount"] = reward_value #奖励值
+            elif task_type == int(TaskType.secret_code.value):
+                key_list_dict["SecretCodeUserCount"] = 1 #完成人数
+                key_list_dict["SecretCodeCount"] = complete_count #完成次数
+                key_list_dict["SecretCodeRewardCount"] = reward_value #奖励值
+            elif task_type == int(TaskType.crm_point_exchange_asset.value):
+                key_list_dict["CrmPointExchangeAssetUserCount"] = 1 #完成人数
+                key_list_dict["CrmPointExchangeAssetCount"] = complete_count #完成次数
+                key_list_dict["CrmPointExchangeAssetRewardCount"] = reward_value #奖励值
+            elif task_type == int(TaskType.buy_appoint_goods.value):
+                key_list_dict["BuyAppointGoodsUserCount"] = 1   #完成人数
+                key_list_dict["BuyAppointGoodsCount"] = complete_count #完成次数
+                key_list_dict["BuyAppointGoodsRewardCount"] = reward_value #奖励值
+            elif task_type == int(TaskType.buy_appoint_goods_price.value):
+                key_list_dict["BuyAppointGoodsPriceUserCount"] = 1   #完成人数
+                key_list_dict["BuyAppointGoodsPriceCount"] = complete_count #完成次数
+                key_list_dict["BuyAppointGoodsPriceRewardCount"] = reward_value #奖励值
+            elif task_type == int(TaskType.buy_appoint_goods_price_gear.value):
+                key_list_dict["BuyAppointGoodsPriceGearUserCount"] = 1   #完成人数
+                key_list_dict["BuyAppointGoodsPriceGearCount"] = complete_count #完成次数
+                key_list_dict["BuyAppointGoodsPriceGearRewardCount"] = reward_value #奖励值
+            elif task_type == int(TaskType.buy_store_price.value):
+                key_list_dict["BuyStorePriceUserCount"] = 1   #完成人数
+                key_list_dict["BuyStorePriceCount"] = complete_count  #完成次数
+                key_list_dict["BuyStorePriceRewardCount"] = reward_value  #奖励值
+            elif task_type == int(TaskType.buy_store_price_gear.value):
+                key_list_dict["BuyStorePriceGearUserCount"] = 1   #完成人数
+                key_list_dict["BuyStorePriceGearCount"] = complete_count #完成次数
+                key_list_dict["BuyStorePriceGearRewardCount"] = reward_value #奖励值
+            elif task_type == int(TaskType.lottery.value):
+                key_list_dict["LotteryTaskUserCount"] = 1   #完成人数
+                key_list_dict["LotteryTaskCount"] = complete_count #完成次数
+                key_list_dict["LotteryTaskRewardCount"] = reward_value #奖励值
+            elif task_type == int(TaskType.lottery_try.value):
+                key_list_dict["TryLotteryTaskUserCount"] = 1   #完成人数
+                key_list_dict["TryLotteryTaskCount"] = complete_count  #完成次数
+                key_list_dict["TryLotteryTaskRewardCount"] = reward_value #奖励值
+            elif task_type == int(TaskType.lottery_gear.value):
+                key_list_dict["LotteryGearTaskUserCount"] = 1   #完成人数
+                key_list_dict["LotteryGearTaskCount"] = complete_count #完成次数
+                key_list_dict["LotteryGearTaskRewardCount"] = reward_value  #奖励值
+
+            key_list_dict["JoinTaskUserCount"] = 1  #参与任务完成人数
+            key_list_dict["AddJoinTaskUserCount"] = 1  #新增参与任务完成人数
+            key_list_dict["JoinTaskCount"] = 1  #参与任务完成次数
+            key_list_dict["JoinTaskRewardCount"] = reward_value  #参与任务奖励值
+
+            stat_base_model.add_stat_list(app_id, act_id, module_id, user_id, open_id, key_list_dict)
+
+    def init_task_count(self, task_info_dict, task_count_list, task_sub_type=""):
+        """
+        :description: 初始化任务计数
+        :param task_info_dict:任务信息字典
+        :param task_count_list:任务计数列表
+        :param task_sub_type:子任务类型标识
+        :return 
+        :last_editors: HuangJianYi
+        """
+        if task_sub_type:
+            task_count = [task_count for task_count in task_count_list if task_info_dict["task_type"] == task_count.task_type and task_count.task_sub_type == str(task_sub_type)]
+        else:
+            task_count = [task_count for task_count in task_count_list if task_info_dict["task_type"] == task_count.task_type]
+        if not task_count:
+            task_count = TaskCount()
+        else:
+            task_count = task_count[0]
+        if task_info_dict["complete_type"] == TaskCompleteType.day.value and task_count.modify_day != SevenHelper.get_now_day_int():
+            task_count.complete_count = 0
+            task_count.now_count = 0
+            task_count.remark = ""
+        elif task_info_dict["complete_type"] == TaskCompleteType.week.value and not TimeHelper.is_this_week(task_count.modify_date):
+            task_count.complete_count = 0
+            task_count.now_count = 0
+            task_count.remark = ""
+        elif task_info_dict["complete_type"] == TaskCompleteType.month.value and not TimeHelper.is_this_month(task_count.modify_date):
+            task_count.complete_count = 0
+            task_count.now_count = 0
+            task_count.remark = ""
+        elif task_info_dict["complete_type"] == TaskCompleteType.long.value and task_count.id == 0:
+            task_count.complete_count = 0
+            task_count.now_count = 0
+        return task_count
+
+    def get_complete_type_name(self, complete_type):
+        """
+        :description: 获取任务类型名称
+        :param complete_type:任务类型
+        :param now_day:当前时间天
+        :return 
+        :last_editors: HuangJianYi
+        """
+        complete_type_name = ""
+        if complete_type == TaskCompleteType.day.value:
+            complete_type_name = "每日"
+        elif complete_type == TaskCompleteType.week.value:
+            complete_type_name = "每周"
+        elif complete_type == TaskCompleteType.month.value:
+            complete_type_name = "每月"
+        return complete_type_name
+
+    def add_task_log(self, task_type, task_sub_type, app_id, act_id, module_id, user_id, open_id, user_nick, task_name, log_title, reward_type, reward_object_id, reward_name, reward_num, handler_name, request_code, info_json={}):
+        """
+        :description: 添加任务日志
+        :param task_type:任务类型
+        :param task_sub_type:任务子类型
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param user_id:用户标识
+        :param open_id:open_id
+        :param user_nick:user_nick
+        :param task_name:任务名称
+        :param log_title:标题
+        :param reward_type: 奖励类型
+        :param reward_object_id: 奖励对象标识
+        :param reward_name: 奖励名称
+        :param reward_num: 奖励数量
+        :param handler_name:接口名称
+        :param request_code:请求代码
+        :param info_json:日志详细信息
+        :return 
+        :last_editors: HuangJianYi
+        """
+        task_config = share_config.get_value("task_config",{})
+        if task_config.get("is_task_log",False) == True:
+            try:
+                task_log = TaskLog()
+                task_log.app_id = app_id
+                task_log.act_id = act_id
+                task_log.module_id = module_id
+                task_log.user_id = user_id
+                task_log.open_id = open_id
+                task_log.user_nick = user_nick
+                task_log.log_title = log_title
+                task_log.task_type = task_type
+                task_log.task_sub_type =task_sub_type
+                task_log.task_name = task_name if task_name else ""
+                task_log.reward_type = reward_type if reward_type else 0
+                task_log.reward_object_id = str(reward_object_id) if reward_object_id else ""
+                task_log.reward_name = reward_name if reward_name else ""
+                task_log.reward_num = reward_num if reward_num else 0
+                task_log.handler_name = handler_name
+                task_log.request_code = request_code
+                task_log.info_json = SevenHelper.json_dumps(info_json) if info_json else {}
+                task_log.create_date = SevenHelper.get_now_datetime()
+                task_log.create_day = SevenHelper.get_now_day_int()
+                task_log_model = TaskLogModel(sub_table=self.get_business_sub_table("task_log_tb",{"app_id":app_id}), context=self.context)
+                task_log_model.add_entity(task_log)
+            except Exception as ex:
+                self.context.logging_link_error("【添加任务日志】" + traceback.format_exc())
+
+    def add_gear_task_count(self, app_id, act_id, module_id, user_id, open_id, task_type, value, remark='', is_async=True):
+        """
+        :description: 添加档位任务累计值，目前支持消费类任务、累计抽盒/抽奖次数档位任务
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param module_id：活动模块标识
+        :param user_id：用户标识(比传)
+        :param open_id：open_id
+        :param task_type：任务类型
+        :param value：计数值
+        :param remark：备注
+        :param is_async：是否异步处理（1-是 0-否）
+        :return:
+        :last_editors: HuangJianYi
+        """
+        if is_async == True:
+            task_gear_count = TaskGearCount()
+            task_gear_count.app_id = app_id
+            task_gear_count.act_id = act_id
+            task_gear_count.module_id = module_id
+            task_gear_count.user_id = user_id
+            task_gear_count.open_id = open_id
+            task_gear_count.task_type = task_type
+            task_gear_count.now_count = value
+            task_gear_count.create_day = SevenHelper.get_now_day_int()
+            task_gear_count.create_month = SevenHelper.get_now_month_int()
+            task_gear_count.create_date = SevenHelper.get_now_datetime()
+            task_gear_count.remark = remark
+            redis_init = SevenHelper.redis_init()
+            redis_init.rpush(f"task_gear_list:{str(user_id % 10)}", SevenHelper.json_dumps(task_gear_count))
+        else:
+            self.add_gear_task_count_to_db(app_id, act_id, module_id, user_id, open_id, task_type, value, remark)
+
+    def add_gear_task_count_to_db(self, app_id, act_id, module_id, user_id, open_id, task_type, value, remark=''):
+        """
+        :description: 添加档位任务累计值，目前支持消费类任务、累计抽盒/抽奖次数档位任务
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param module_id：活动模块标识
+        :param user_id：用户标识(比传)
+        :param open_id：open_id
+        :param task_type：任务类型
+        :param value：计数值
+        :param remark：备注
+        :return:
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        try:
+            create_day = SevenHelper.get_now_day_int()
+            create_month = SevenHelper.get_now_month_int()
+            task_info_model = TaskInfoModel(context=self.context)
+            db_transaction = DbTransaction(db_config_dict=config.get_value("db_cloudapp"))
+            frame_base_model = FrameBaseModel()
+            task_count_model = TaskCountModel(sub_table=frame_base_model.get_business_sub_table("task_count_tb", {"app_id": app_id}), db_transaction=db_transaction)
+            task_gear_count_model = TaskGearCountModel(sub_table=frame_base_model.get_business_sub_table("task_gear_count_tb", {"app_id": app_id}), db_transaction=db_transaction)
+            task_info_dict = task_info_model.get_dict("act_id=%s and module_id=%s and task_type=%s", params=[act_id, module_id, task_type])
+            task_gear_count_id_md5 = CryptoHelper.md5_encrypt_int(f"{act_id}_{module_id}_{task_type}_{user_id}")
+            task_gear_count = task_gear_count_model.get_entity("id_md5=%s and create_day=%s", params=[task_gear_count_id_md5, create_day])
+            db_transaction.begin_transaction()
+            if not task_gear_count:
+                task_gear_count = TaskGearCount()
+                task_gear_count.id_md5 = task_gear_count_id_md5
+                task_gear_count.app_id = app_id
+                task_gear_count.act_id = act_id
+                task_gear_count.module_id = module_id
+                task_gear_count.user_id = user_id
+                task_gear_count.open_id = open_id
+                task_gear_count.task_type = task_type
+                task_gear_count.now_count = value
+                task_gear_count.create_day = create_day
+                task_gear_count.create_month = create_month
+                task_gear_count.create_date = SevenHelper.get_now_datetime()
+                task_gear_count.remark = remark
+                task_gear_count_model.add_entity(task_gear_count)
+            else:
+                task_gear_count.now_count = decimal.Decimal(task_gear_count.now_count) + decimal.Decimal(value)
+                task_gear_count.remark = task_gear_count.remark + "," + remark if  task_gear_count.remark else remark
+                task_gear_count_model.update_table("now_count=%s,remark=%s,modify_date=%s", "id=%s", params=[task_gear_count.now_count, task_gear_count.remark, task_gear_count.create_date, task_gear_count.id])
+            if task_info_dict:
+                #判断子任务是否完成
+                config_json = SevenHelper.json_loads(task_info_dict["config_json"])
+                if config_json and config_json.__contains__("gear_list"):
+                    now_count = decimal.Decimal(self.get_gear_task_count(app_id, act_id, module_id, user_id, task_type, task_info_dict["complete_type"])) + decimal.Decimal(value)
+                    task_count_list = task_count_model.get_list("act_id=%s and module_id=%s and user_id=%s and task_type=%s", params=[act_id, module_id, user_id, task_type])
+                    config_json = config_json["gear_list"]
+                    for sub_config_json in config_json:
+                        task_count = self.init_task_count(task_info_dict, task_count_list, sub_config_json["id"])
+                        if task_count.complete_count == 1:
+                            continue
+                        task_count_id_md5 = CryptoHelper.md5_encrypt_int(f"{act_id}_{module_id}_{task_type}_{sub_config_json['id']}_{user_id}")
+                        if now_count >= decimal.Decimal(sub_config_json["gear"]):
+                            task_count = TaskCount()
+                            task_count.id_md5 = task_count_id_md5
+                            task_count.app_id = app_id
+                            task_count.act_id = act_id
+                            task_count.module_id = module_id
+                            task_count.user_id = user_id
+                            task_count.open_id = open_id
+                            task_count.task_type = task_type
+                            task_count.task_sub_type = sub_config_json["id"]
+                            task_count.complete_count = 0
+                            task_count.now_count = 1
+                            task_count.create_date = SevenHelper.get_now_datetime()
+                            task_count.modify_date = SevenHelper.get_now_datetime()
+                            task_count.modify_day = SevenHelper.get_now_day_int()
+                            task_count_model.add_update_entity(task_count, "complete_count=0,now_count=1,modify_date=%s,modify_day=%s", params=[task_count.modify_date, task_count.modify_day])
+
+            result, message = db_transaction.commit_transaction(True)
+            if result == False:
+                raise Exception("执行事务失败", message)
+        except Exception as ex:
+            if self.context:
+                self.context.logging_link_error("【添加档位任务累计值】" + traceback.format_exc())
+            elif self.logging_link_error:
+                self.logging_link_error("【添加档位任务累计值】" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "添加档位任务累计值失败"
+        return invoke_result_data
+
+    def add_task_count(self, app_id, act_id, module_id, user_id, open_id, task_type, value, task_info_dict=None, task_sub_type=''):
+        """
+        :description: 添加常规任务计数
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param module_id：活动模块标识
+        :param user_id：用户标识(比传)
+        :param open_id：open_id
+        :param task_type：任务类型
+        :param value：计数值
+        :param task_info_dict：任务信息
+        :param task_sub_type：任务子类型
+        :return:
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        if not task_info_dict:
+            task_invoke_result_data = self.check_task_info(act_id,module_id,task_type)
+            if task_invoke_result_data.success == True:
+                task_info_dict = task_invoke_result_data.data
+        if task_info_dict:
+            if task_sub_type and isinstance(task_info_dict["config_json"],list):
+                sub_config_json = [sub_config_json for sub_config_json in task_info_dict["config_json"] if task_sub_type == sub_config_json["id"]]
+                if not sub_config_json:
+                    invoke_result_data.succsess = False
+                    invoke_result_data.error_code = "error"
+                    invoke_result_data.error_message = "完成上限"
+                    return invoke_result_data
+                limit_num = int(sub_config_json["limit_num"]) if sub_config_json.__contains__("limit_num") else 1
+                satisfy_num = int(sub_config_json["satisfy_num"]) if sub_config_json.__contains__("satisfy_num") else 1
+            else:
+                config_json = task_info_dict["config_json"]
+                limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
+                satisfy_num = int(config_json["satisfy_num"]) if config_json.__contains__("satisfy_num") else 1
+            task_count_model = TaskCountModel(sub_table=self.get_business_sub_table("task_count_tb",{"app_id":app_id}),context=self.context)
+            task_count_id_md5 = self._get_task_count_id_md5(act_id,module_id,task_info_dict["task_type"],task_sub_type,user_id)
+            task_count = task_count_model.get_entity("id_md5=%s",params=[task_count_id_md5])
+            task_count_list = [task_count] if task_count else []
+            task_count = self.init_task_count(task_info_dict, task_count_list, task_sub_type)
+            count = int(task_count.complete_count * satisfy_num) + task_count.now_count
+            is_limit = True if count >= (limit_num * satisfy_num) else False
+            if is_limit == True:
+                invoke_result_data.succsess = False
+                invoke_result_data.error_code = "error"
+                invoke_result_data.error_message = "完成上限"
+                return invoke_result_data
+            now_datetime = SevenHelper.get_now_datetime()
+            now_day = SevenHelper.get_now_day_int()
+            task_count.id_md5 = task_count_id_md5
+            task_count.app_id = app_id
+            task_count.act_id = act_id
+            task_count.module_id = module_id
+            task_count.user_id = user_id
+            task_count.open_id = open_id
+            task_count.task_type = task_info_dict["task_type"]
+            task_count.now_count = task_count.now_count + int(value)
+            task_count.create_date = now_datetime
+            task_count.modify_date = now_datetime
+            task_count.modify_day = now_day
+            update_sql = "complete_count=%s,now_count=%s,modify_date=%s,modify_day=%s"
+            params = [task_count.complete_count, task_count.now_count, task_count.modify_date, task_count.modify_day]
+            if task_count.complete_count > 0:
+                update_sql = "now_count=%s,modify_date=%s,modify_day=%s"
+                params = [task_count.now_count, task_count.modify_date, task_count.modify_day]
+            task_count_model.add_update_entity(task_count, update_sql, params=params)
+
+            return invoke_result_data
+
+    def get_gear_task_count(self, app_id, act_id, module_id, user_id, task_type, complete_type):
+        """
+        :description: 获取累计消费金额，累计抽盒次数等等
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param module_id：活动模块标识
+        :param user_id：用户标识(比传)
+        :param task_type：任务类型
+        :param complete_type：完成类型
+        :return:
+        :last_editors: HuangJianYi
+        """
+        task_gear_count_model = TaskGearCountModel(sub_table=self.get_business_sub_table("task_gear_count_tb", {"app_id": app_id}), context=self.context)
+        condition_where = ConditionWhere()
+        task_gear_count_id_md5 = CryptoHelper.md5_encrypt_int(f"{act_id}_{module_id}_{task_type}_{user_id}")
+        condition_where.add_condition("id_md5=%s")
+        params = [task_gear_count_id_md5]
+        if complete_type == TaskCompleteType.day.value:
+            condition_where.add_condition("create_day=%s")
+            params.append(SevenHelper.get_now_day_int())
+        elif complete_type == TaskCompleteType.week.value:
+            start_day = int(TimeHelper.get_first_day_of_the_week().strftime('%Y%m%d'))
+            end_day = int(TimeHelper.get_last_day_of_the_week().strftime('%Y%m%d'))
+            condition_where.add_condition("create_day>=%s and create_day<=%s")
+            params.append(start_day)
+            params.append(end_day)
+        elif complete_type == TaskCompleteType.month.value:
+            condition_where.add_condition("create_month=%s")
+            params.append(SevenHelper.get_now_month_int())
+        if module_id:
+            condition_where.add_condition("module_id=%s")
+            params.append(module_id)
+        task_gear_count_dict = task_gear_count_model.get_dict(condition_where.to_string(),field="sum(now_count) as now_count",params=params)
+        current = task_gear_count_dict["now_count"] if task_gear_count_dict["now_count"] else 0  # 当前总累计值
+        return current
+
+    def convert_task_node(self, task_id, sort_index, task_type, task_type_name, title, desc='', current=0, total=1, data=[], complete_count=1, current_complete_count=0, reward_value=0, completed_ids=[], get_ways=0, status=0, btn_text=[], route_url=''):
+        """
+        :description: 合成任务节点
+        :param task_id：任务id
+        :param sort_index：排序
+        :param task_type：任务类型
+        :param task_type_name：任务类型名称
+        :param title：标题
+        :param desc：描述
+        :param current：当前轮计数值
+        :param total：当前轮领取阀值(消费任务表示领取奖励需要消费的金额)
+        :param data：如果有额外数据放这里，如果商品数据，或者子任务数据
+        :param complete_count：可以完成的次数
+        :param current_complete_count：当前完成的次数
+        :param reward_value：奖励值
+        :param completed_ids：完成的ids，比如：已收藏的商品ids或者已完成的子任务ids
+        :param get_ways：领取方式(0-直接领取 1-通过领取接口领取)
+        :param status：状态
+        :param btn_text：按钮文本数组
+        :param route_url：路由地址
+        :return:
+        :last_editors: HuangJianYi
+        """
+        result = {}
+        result["sort_index"] = sort_index
+        result["id"] = task_id
+        result["task_type"] = task_type
+        result["task_type_name"] = task_type_name
+        result["title"] = title
+        result["desc"] = desc
+        result["current"] = current
+        result["total"] = total
+        result["data"] = data
+        result["complete_count"] = complete_count
+        result["current_complete_count"] = current_complete_count
+        result["reward_value"] = reward_value
+        result["completed_ids"] = completed_ids
+        result["get_ways"] = get_ways
+        result["status"] = status
+        result["btn_text"] = btn_text
+        result["route_url"] = route_url
+        return result
+
+    def convert_gear_task_node(self, app_id, act_id, module_id, user_id, task_info_dict, config_json, task_count_list):
+        """
+        :description: 合成档位任务结果
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param user_id:用户标识
+        :param task_info_dict:任务信息
+        :param config_json:{"gear_list":[{"id":1,"gear":0,"reward_type":1,"reward_name":"","asset_object_id":"","reward_value":0}]} 字段说明：id:前端生成的唯一标识 gear:档位阀值 reward_value:奖励值(等于0无法领取) satisfy_num:满足数 reward_type:奖励类型 reward_name:奖励奖品名称 asset_object_id:对象标识(如果奖励类型是资产对应资产对象标识，如果是奖品对应奖品标识，如果是卡片对应卡片标识)
+        :param task_count_list:计数列表
+        :return 
+        :last_editors: HuangJianYi
+        """
+        result = deepcopy(self.convert_task_node(task_info_dict["id"],task_info_dict["sort_index"],task_info_dict["task_type"],SevenHelper.get_enum_key(TaskType, task_info_dict["task_type"]),task_info_dict["task_name"],get_ways=1,route_url="receive_reward"))
+        result["current"] =  self.get_gear_task_count(app_id, act_id, module_id, user_id, task_info_dict["task_type"], task_info_dict["complete_type"])
+        if not any(word in task_info_dict["task_name"] for word in ["消费金额","购买金额"]):
+            result["current"] = int(result["current"])
+        for sub_config_json in config_json["gear_list"]:
+            sub_task_count = self.init_task_count(task_info_dict, task_count_list, sub_config_json["id"])
+            if sub_task_count.complete_count > 0:
+                result["completed_ids"].append(sub_config_json["id"])
+            sub_info = {}
+            sub_info["id"] = sub_config_json["id"] #子任务id
+            sub_info["gear"] = sub_config_json["gear"] #档位阀值
+            sub_info["reward_name"] = sub_config_json["reward_name"] #奖励名称
+            sub_info["reward_value"] = sub_config_json["reward_value"] #奖励数量
+            result["data"].append(sub_info)
+        result["current_complete_count"] = 1 if len(result["completed_ids"]) == len(sub_config_json) else 0
+
+        return result
+
+    def get_client_task_list(self, app_id, act_id, module_id, user_id, task_types="", app_key="", app_secret="", is_log=False, daily_repeat_browse=False, mix_nick=""):
+        """
+        :description: 获取任务列表
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param user_id:用户标识
+        :param task_types:任务类型 多个逗号,分隔
+        :param app_key:app_key
+        :param app_secret:app_secret
+        :param is_log:是否记录top请求日志
+        :param daily_repeat_browse:单个商品可每日重复浏览 True是False否
+        :param mix_nick:混淆昵称
+        :return 
+        :last_editors: HuangJianYi
+        """
+        task_info_list = self.get_task_info_dict_list(app_id,act_id,module_id,1)
+        task_count_model = TaskCountModel(sub_table=self.get_business_sub_table("task_count_tb",{"app_id":app_id}),context=self.context)
+        task_count_list = task_count_model.get_list("act_id=%s and module_id=%s and user_id=%s", params=[act_id, module_id, user_id])
+        now_day = TimeExHelper.get_now_day_int()
+        app_info_dict = None
+        result_list = []
+        for task_info_dict in task_info_list:
+            if task_types:
+                if str(task_info_dict["task_type"]) not in task_types.split(','):
+                    continue
+            config_json = SevenHelper.json_loads(task_info_dict["config_json"])
+            if not config_json:
+                continue
+
+            result = {}
+            result["sort_index"] = task_info_dict["sort_index"]
+            result["task_id"] = task_info_dict["id"]
+            result["task_type"] = task_info_dict["task_type"]
+            result["title"] = task_info_dict["task_name"]
+            result["config_json"] = config_json
+            result["reward_value"] = int(config_json["reward_value"]) if config_json.__contains__("reward_value") else 0
+
+            task_count = self.init_task_count(task_info_dict, task_count_list)
+
+            #掌柜有礼、免费领取、新人有礼
+            if task_info_dict["task_type"] == TaskType.free_gift.value:
+                limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
+                result["content"] = f"完成次数上限{limit_num}次，当前剩余{limit_num-task_count.complete_count}次"
+                result["status"] = 1 if task_count.complete_count >= limit_num else 0
+                result["text"] = ["领取", "已领取"]
+                result_list.append(result)
+            #单次签到
+            elif task_info_dict["task_type"] == TaskType.one_sign.value:
+                result["content"] = ""
+                result["status"] = 1 if task_count.complete_count > 0 else 0
+                result["text"] = ["签到", "已签到"]
+                result_list.append(result)
+            #每周签到(指定天数签到)(status:0当天未签到1当天已签到2已完成)
+            elif task_info_dict["task_type"] == TaskType.weekly_sign.value:
+                result["complete_count"] = task_count.complete_count
+                result["content"] = f"已签到{task_count.complete_count}天"
+                if isinstance(config_json["day_list"],list):
+                    max_sign_day = max(query(config_json["day_list"]).select(lambda x: int(x["day"])).to_list())
+                else:
+                    max_sign_day = int(max(config_json["day_list"])) if len(config_json["day_list"].keys()) > 0 else 0
+                if task_count.complete_count >= max_sign_day:
+                    result["status"] = 2
+                else:
+                    result["status"] = 1 if task_count.modify_day == now_day else 0
+                result["text"] = ["签到", "已签到","已完成"]
+                result_list.append(result)
+            #累计签到(status:0当天未签到1当天已签到2已完成)
+            elif task_info_dict["task_type"] == TaskType.cumulative_sign.value:
+                result["complete_count"] = task_count.complete_count
+                result["content"] = f"已签到{task_count.complete_count}天"
+                if isinstance(config_json["day_list"],list):
+                    max_sign_day = max(query(config_json["day_list"]).select(lambda x: int(x["day"])).to_list())
+                else:
+                    max_sign_day = int(max(config_json["day_list"])) if len(config_json["day_list"].keys()) > 0 else 0
+                if task_count.complete_count >= max_sign_day:
+                    result["status"] = 2
+                else:
+                    result["status"] = 1 if task_count.modify_day == now_day else 0
+                result["text"] = ["签到", "已签到","已完成"]
+                result_list.append(result)
+            #连续签到(status:0当天未签到1当天已签到2已完成)
+            elif task_info_dict["task_type"] == TaskType.successive_sign.value:
+                result["complete_count"] = task_count.complete_count
+                result["content"] = f"已签到{task_count.complete_count}天"
+                if isinstance(config_json["day_list"],list):
+                    max_sign_day = max(query(config_json["day_list"]).select(lambda x: int(x["day"])).to_list())
+                else:
+                    max_sign_day = int(max(config_json["day_list"])) if len(config_json["day_list"].keys()) > 0 else 0
+                if task_count.complete_count >= max_sign_day:
+                    result["status"] = 2
+                else:
+                    result["status"] = 1 if task_count.modify_day == now_day else 0
+                result["text"] = ["签到", "已签到","已完成"]
+                result_list.append(result)
+            #邀请新用户
+            elif task_info_dict["task_type"] == TaskType.invite_new_user.value:
+                limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
+                satisfy_num = int(config_json["satisfy_num"]) if config_json.__contains__("satisfy_num") else 1
+                if task_count.complete_count >= limit_num:
+                    result["status"] = 2
+                elif task_count.now_count >= satisfy_num:
+                    result["status"] = 1
+                else:
+                    result["status"] = 0
+                result["complete_count"] = task_count.complete_count
+                result["now_count"] = task_count.now_count
+                result["limit_num"] = limit_num
+                result["satisfy_num"] = satisfy_num
+                result["content"] = f"完成次数上限{limit_num}次，当前剩余{limit_num-task_count.complete_count}次"
+                result["text"] = ["去邀请", "领取", "已完成"]
+                result_list.append(result)
+            #邀请加入会员
+            elif task_info_dict["task_type"] == TaskType.invite_join_member.value:
+                limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
+                satisfy_num = int(config_json["satisfy_num"]) if config_json.__contains__("satisfy_num") else 1
+                if task_count.complete_count >= limit_num:
+                    result["status"] = 2
+                elif task_count.now_count >= satisfy_num:
+                    result["status"] = 1
+                else:
+                    result["status"] = 0
+                result["complete_count"] = task_count.complete_count
+                result["now_count"] = task_count.now_count
+                result["limit_num"] = limit_num
+                result["satisfy_num"] = satisfy_num
+                result["content"] = f"完成次数上限{limit_num}次，当前剩余{limit_num-task_count.complete_count}次"
+                result["text"] = ["去邀请", "领取", "已完成"]
+                result_list.append(result)
+            #关注店铺
+            elif task_info_dict["task_type"] == TaskType.favor_store.value:
+                if not app_info_dict:
+                    app_base_model = AppBaseModel(context=self.context)
+                    app_info_dict = app_base_model.get_app_info_dict(app_id)
+                once_favor_reward = int(config_json["once_favor_reward"]) if config_json.__contains__("once_favor_reward") else 1
+                user_base_model = UserBaseModel(context=self.context)
+                user_info_dict = user_base_model.get_user_info_dict(app_id,act_id,user_id)
+                if not user_info_dict:
+                    result["status"] = 0
+                if module_id:
+                    if task_count.complete_count >= 1:
+                        result["status"] = 1
+                    elif user_info_dict["is_favor_before"] == 1 and once_favor_reward == 0:
+                        result["status"] = 1
+                    else:
+                        result["status"] = 0
+                else:
+                    if user_info_dict["is_favor"] == 1:
+                        result["status"] = 1
+                    elif user_info_dict["is_favor_before"] == 1 and once_favor_reward == 0:
+                        result["status"] = 1
+                    else:
+                        result["status"] = 0
+                result["content"] = ""
+                result["store_name"] = app_info_dict["store_name"] if app_info_dict else ""
+                result["text"] = ["去关注", "已关注"]
+                result_list.append(result)
+            #加入会员
+            elif task_info_dict["task_type"] == TaskType.join_member.value:
+                if not app_info_dict:
+                    app_base_model = AppBaseModel(context=self.context)
+                    app_info_dict = app_base_model.get_app_info_dict(app_id)
+                once_member_reward = int(config_json["once_member_reward"]) if config_json.__contains__("once_member_reward") else 1
+                user_base_model = UserBaseModel(context=self.context)
+                user_info_dict = user_base_model.get_user_info_dict(app_id,act_id,user_id)
+                if not user_info_dict:
+                    result["status"] = 0
+                if module_id:
+                    if task_count.complete_count >= 1:
+                        result["status"] = 2
+                    elif user_info_dict["is_member_before"] == 1 and once_member_reward == 0:
+                        result["status"] = 2
+                    else:
+                        access_token = app_info_dict["access_token"] if app_info_dict else ""
+                        top_base_model = TopBaseModel(context=self.context)
+                        if top_base_model.check_is_member(mix_nick,'',access_token,app_key,app_secret,is_log) == True:
+                            result["status"] = 1
+                        else:
+                            result["status"] = 0
+                else:
+                    if user_info_dict["is_member"] == 1:
+                        result["status"] = 2
+                    elif user_info_dict["is_member_before"] == 1 and once_member_reward == 0:
+                        result["status"] = 2
+                    else:
+                        access_token = app_info_dict["access_token"] if app_info_dict else ""
+                        top_base_model = TopBaseModel(context=self.context)
+                        if top_base_model.check_is_member(mix_nick,'',access_token,app_key,app_secret,is_log) == True:
+                            result["status"] = 1
+                        else:
+                            result["status"] = 0
+                result["content"] = ""
+                result["text"] = ["立即入会", "立即领取", "已领取"]
+                result_list.append(result)
+            #收藏商品
+            elif task_info_dict["task_type"] == TaskType.collect_goods.value:
+                limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
+                satisfy_num = int(config_json["satisfy_num"]) if config_json.__contains__("satisfy_num") else 1
+                if task_count.complete_count >= limit_num:
+                    result["status"] = 2
+                elif task_count.now_count >= satisfy_num:
+                    result["status"] = 1
+                else:
+                    result["status"] = 0
+                collect_log_model = CollectLogModel(context=self.context)
+                condition = "act_id=%s and user_id=%s"
+                params = [act_id, user_id]
+                user_goods_list = collect_log_model.get_cache_list(condition, params=params,dependency_key=f"collect_log:actid_{act_id}_userid_{user_id}")
+                result["goods_list"] = config_json["goods_list"] if config_json.__contains__("goods_list") else []
+                result["user_goods_list"] = [str(i.goods_id) for i in user_goods_list] if len(user_goods_list) > 0 else []
+                result["complete_count"] = task_count.complete_count
+                result["now_count"] = task_count.now_count
+                result["limit_num"] = limit_num
+                result["satisfy_num"] = satisfy_num
+                result["content"] = f"完成次数上限{limit_num}次，当前剩余{limit_num-task_count.complete_count}次"
+                result["text"] = ["去收藏", "已收藏","已完成"]
+                result_list.append(result)
+            #浏览商品
+            elif task_info_dict["task_type"] == TaskType.browse_goods.value:
+                limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
+                satisfy_num = int(config_json["satisfy_num"]) if config_json.__contains__("satisfy_num") else 1
+                if task_count.complete_count >= limit_num:
+                    result["status"] = 2
+                elif task_count.now_count >= satisfy_num:
+                    result["status"] = 1
+                else:
+                    result["status"] = 0
+                browse_log_model = BrowseLogModel(context=self.context)
+                condition = "act_id=%s and user_id=%s"
+                params = [act_id,user_id]
+                if daily_repeat_browse == True:
+                    condition += " and create_day=%s"
+                    params.append(now_day)
+                user_goods_list = browse_log_model.get_cache_list(condition, params=params,dependency_key=f"browse_log:actid_{act_id}_userid_{user_id}")
+                result["goods_list"] = config_json["goods_list"] if config_json.__contains__("goods_list") else []
+                result["user_goods_list"] = [str(i.goods_id) for i in user_goods_list] if len(user_goods_list) > 0 else []
+                result["complete_count"] = task_count.complete_count
+                result["now_count"] = task_count.now_count
+                result["limit_num"] = limit_num
+                result["satisfy_num"] = satisfy_num
+                result["content"] = f"完成次数上限{limit_num}次，当前剩余{limit_num-task_count.complete_count}次"
+                result["text"] = ["去浏览", "已浏览","已完成"]
+                result_list.append(result)
+            #浏览网址
+            elif isinstance(config_json, list) and task_info_dict["task_type"] in [TaskType.browse_store.value,TaskType.browse_live_room.value,TaskType.browse_special_topic.value]:
+                for sub_config_json in config_json:
+                    sub_task_count = [task_count for task_count in task_count_list if task_info_dict["task_type"] == task_count.task_type and task_count.task_sub_type == sub_config_json["id"]]
+                    if not sub_task_count:
+                        sub_task_count = TaskCount()
+                    else:
+                        sub_task_count = sub_task_count[0]
+                    if task_info_dict["complete_type"] == 1 and sub_task_count.modify_day != now_day:
+                        sub_task_count.complete_count = 0
+                        sub_task_count.now_count = 0
+                    elif task_info_dict["complete_type"] == 2 and not TimeHelper.is_this_week(sub_task_count.modify_date):
+                        sub_task_count.complete_count = 0
+                        sub_task_count.now_count = 0
+                    elif task_info_dict["complete_type"] == 3 and sub_task_count.id == 0:
+                        sub_task_count.complete_count = 0
+                        sub_task_count.now_count = 0
+                    limit_num = int(sub_config_json["limit_num"]) if sub_config_json.__contains__("limit_num") else 1
+                    satisfy_num = int(sub_config_json["satisfy_num"]) if sub_config_json.__contains__("satisfy_num") else 1
+                    result = {}
+                    result["sort_index"] = task_info_dict["sort_index"]
+                    result["task_id"] = task_info_dict["id"]
+                    result["task_type"] = task_info_dict["task_type"]
+                    result["task_sub_type"] = sub_config_json["id"]
+                    result["title"] = task_info_dict["task_name"]
+                    result["config_json"] = sub_config_json
+                    result["reward_value"] = int(sub_config_json["reward_value"]) if sub_config_json.__contains__("reward_value") else 0
+                    if sub_task_count.complete_count >= limit_num:
+                        result["status"] = 1
+                    else:
+                        result["status"] = 0
+                    result["link_url"] = sub_config_json["link_url"] if sub_config_json.__contains__("link_url") else ""
+                    result["complete_count"] = sub_task_count.complete_count
+                    result["now_count"] = sub_task_count.now_count
+                    result["limit_num"] = limit_num
+                    result["satisfy_num"] = satisfy_num
+                    result["content"] = f"完成次数上限{limit_num}次，当前剩余{limit_num-sub_task_count.complete_count}次"
+                    result["text"] = ["去浏览", "已完成"]
+                    result_list.append(result)
+            #分享奖励
+            elif task_info_dict["task_type"] == TaskType.share.value:
+                limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
+                satisfy_num = int(config_json["satisfy_num"]) if config_json.__contains__("satisfy_num") else 1
+                if task_count.complete_count >= limit_num:
+                    result["status"] = 2
+                elif task_count.now_count >= satisfy_num:
+                    result["status"] = 1
+                else:
+                    result["status"] = 0
+                result["content"] = f"完成次数上限{limit_num}次，当前剩余{limit_num-task_count.complete_count}次"
+                result["text"] = ["去分享", "领取","已完成"]
+                result_list.append(result)
+            #浏览店铺
+            elif task_info_dict["task_type"] == TaskType.browse_store.value:
+                limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
+                satisfy_num = int(config_json["satisfy_num"]) if config_json.__contains__("satisfy_num") else 1
+                if task_count.complete_count >= limit_num:
+                    result["status"] = 2
+                elif task_count.now_count >= satisfy_num:
+                    result["status"] = 1
+                else:
+                    result["status"] = 0
+                result["content"] = f"完成次数上限{limit_num}次，当前剩余{limit_num-task_count.complete_count}次"
+                result["text"] = ["去完成", "领取","已完成"]
+                result_list.append(result)
+            #浏览直播间
+            elif task_info_dict["task_type"] == TaskType.browse_live_room.value:
+                limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
+                satisfy_num = int(config_json["satisfy_num"]) if config_json.__contains__("satisfy_num") else 1
+                if task_count.complete_count >= limit_num:
+                    result["status"] = 2
+                elif task_count.now_count >= satisfy_num:
+                    result["status"] = 1
+                else:
+                    result["status"] = 0
+                result["complete_count"] = task_count.complete_count
+                result["limit_num"] = limit_num
+                result["satisfy_num"] = satisfy_num
+                result["content"] = f"完成次数上限{limit_num}次，当前剩余{limit_num-task_count.complete_count}次"
+                result["text"] = ["去浏览", "领取","已完成"]
+                result_list.append(result)
+            #邀请助力
+            elif task_info_dict["task_type"] == TaskType.invite_user_help.value:
+                limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
+                satisfy_num = int(config_json["satisfy_num"]) if config_json.__contains__("satisfy_num") else 1
+                if task_count.complete_count >= limit_num:
+                    result["status"] = 2
+                elif task_count.now_count >= satisfy_num:
+                    result["status"] = 1
+                else:
+                    result["status"] = 0
+                invite_help_model = InviteHelpModel(context=self.context)
+                help_type = 1
+                help_object_id = ''
+                help_id_md5 = CryptoHelper.md5_encrypt_int(f"{app_id}_{act_id}_{module_id}_{help_type}_{help_object_id}")
+                invite_help_list = invite_help_model.get_cache_dict_list("id_md5=%s and user_id=%s and create_day=%s", "", order_by="id desc", field="invited_avatar", params=[help_id_md5, user_id, SevenHelper.get_now_day_int()], dependency_key=DependencyKey.invite_user_help_list(help_id_md5,user_id))
+                result["data"] = invite_help_list if len(invite_help_list) > 0 else []
+                result["complete_count"] = task_count.complete_count
+                result["now_count"] = task_count.now_count
+                result["limit_num"] = limit_num
+                result["satisfy_num"] = satisfy_num
+                result["content"] = f"完成次数上限{limit_num}次，当前剩余{limit_num-task_count.complete_count}次"
+                result["text"] = ["去邀请", "领取", "已完成"]
+                result_list.append(result)
+            #神秘暗号
+            elif task_info_dict["task_type"] == TaskType.secret_code.value:
+                limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
+                if task_count.complete_count >= limit_num:
+                    result["status"] = 1
+                else:
+                    result["status"] = 0
+                result["content"] = f"完成次数上限{limit_num}次，当前剩余{limit_num-task_count.complete_count}次"
+                result["text"] = ["输入暗号","已完成"]
+                result_list.append(result)
+            #店铺会员积分兑换资产
+            elif task_info_dict["task_type"] == TaskType.crm_point_exchange_asset.value:
+                limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
+                satisfy_num = int(config_json["satisfy_num"]) if config_json.__contains__("satisfy_num") else 1
+                if task_count.complete_count >= limit_num:
+                    result["status"] = 1
+                else:
+                    result["status"] = 0
+                result["complete_count"] = task_count.complete_count
+                result["limit_num"] = limit_num
+                result["satisfy_num"] = satisfy_num
+                result["content"] = f"完成次数上限{limit_num}次，当前剩余{limit_num-task_count.complete_count}次"
+                result["text"] = ["兑换","已完成"]
+                result_list.append(result)
+
+        return result_list,task_info_list,task_count_list
+
+    def get_client_task_list_v2(self, app_id, act_id, module_id, user_id, task_types="", daily_repeat_browse=False):
+        """
+        :description: 获取任务列表
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param user_id:用户标识
+        :param task_types:任务类型 多个逗号,分隔
+        :param daily_repeat_browse:单个商品可每日重复浏览 True是False否
+        :return 
+        :last_editors: HuangJianYi
+        """
+        task_info_list = self.get_task_info_dict_list(app_id,act_id,module_id,1)
+        task_count_model = TaskCountModel(sub_table=self.get_business_sub_table("task_count_tb",{"app_id":app_id}),context=self.context)
+        task_count_list = task_count_model.get_list("act_id=%s and module_id=%s and user_id=%s", params=[act_id, module_id, user_id])
+        now_day = TimeExHelper.get_now_day_int()
+        result_list = []
+        for task_info_dict in task_info_list:
+            if task_types:
+                if str(task_info_dict["task_type"]) not in task_types.split(','):
+                    continue
+            config_json = SevenHelper.json_loads(task_info_dict["config_json"])
+            if not config_json:
+                continue
+            result = self.convert_task_node(task_info_dict["id"],
+                                       task_info_dict["sort_index"],
+                                       task_info_dict["task_type"],
+                                       SevenHelper.get_enum_key(TaskType, task_info_dict["task_type"]),
+                                       task_info_dict["task_name"]
+                                       )
+            if result["task_type"] == TaskType.weekly_sign.value:
+                if isinstance(config_json["day_list"],list):
+                    result["data"] = query(config_json["day_list"]).select(lambda x: int(x["day"])).to_list()
+                    result["reward_value"] = query(config_json["day_list"]).select(lambda x: int(x["reward_value"])).to_list()
+                else:
+                    result["data"] = list(config_json["day_list"].keys())
+                    result["reward_value"] = list(config_json["day_list"].values())
+
+            elif result["task_type"] in [TaskType.cumulative_sign.value, TaskType.successive_sign.value]:
+                if isinstance(config_json["day_list"],list):
+                    if len(config_json["day_list"]) == 0:
+                        result["reward_value"] = 0
+                    elif config_json["day_list"] == 1:
+                        result["data"] = [config_json["day_list"][0]["day"]]
+                        result["reward_value"] = config_json["day_list"][0]["reward_value"]
+                        result["total"] = int(result["data"][0])
+                    else:
+                        result["data"] = query(config_json["day_list"]).select(lambda x: int(x["day"])).to_list()
+                        result["reward_value"] = query(config_json["day_list"]).select(lambda x: int(x["reward_value"])).to_list()
+                else:
+                    result["data"] = list(config_json["day_list"].keys())
+                    if len(result["data"]) == 0:
+                        result["reward_value"] = 0
+                    elif len(result["data"]) == 1:
+                        result["total"] = int(result["data"][0])
+                        result["reward_value"] = config_json["day_list"][str(result["data"][0])]
+                    else:
+                        result["reward_value"] = list(config_json["day_list"].values())
+
+            else:
+                result["reward_value"] = int(config_json["reward_value"]) if config_json.__contains__("reward_value") else 0
+
+            complete_type_name = self.get_complete_type_name(task_info_dict["complete_type"]) # 完成类型名称
+            task_count = self.init_task_count(task_info_dict, task_count_list)
+
+            #掌柜有礼、免费领取、新人有礼
+            if task_info_dict["task_type"] == TaskType.free_gift.value:
+                limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
+                result["complete_count"] = limit_num #可以完成的次数
+                result["current_complete_count"] = task_count.complete_count #当前完成的次数
+                result["current"] = task_count.complete_count
+                result["status"] = 1 if task_count.complete_count >= limit_num else 0
+                result["btn_text"] = ["领取", "已领取"]
+                result["route_url"] = "free_gift"
+                result_list.append(result)
+            #单次签到
+            elif task_info_dict["task_type"] == TaskType.one_sign.value:
+                result["current_complete_count"] = task_count.complete_count #当前完成的次数
+                result["current"] = task_count.complete_count
+                result["status"] = 1 if task_count.complete_count > 0 else 0
+                result["btn_text"] = ["签到", "已签到"]
+                result["route_url"] = "one_sign"
+                result_list.append(result)
+            #每周签到(status:0当天未签到1当天已签到2已完成)
+            elif task_info_dict["task_type"] == TaskType.weekly_sign.value:
+                result["current"] = task_count.complete_count
+                if isinstance(config_json["day_list"],list):
+                    max_sign_day = max(query(config_json["day_list"]).select(lambda x: int(x["day"])).to_list())
+                else:
+                    max_sign_day = int(max(config_json["day_list"])) if len(config_json["day_list"].keys()) > 0 else 0
+                if task_count.complete_count >= max_sign_day:
+                    result["status"] = 2
+                else:
+                    result["status"] = 1 if task_count.modify_day == now_day else 0
+                result["total"] = max_sign_day
+                result["complete_count"] = 1 #可以完成的次数
+                result["current_complete_count"] = 1 if task_count.complete_count == max_sign_day else 0 #当前完成的次数
+                result["btn_text"] = ["签到", "已签到","已完成"]
+                result["route_url"] = "weekly_sign"
+                result_list.append(result)
+            #累计签到(status:0当天未签到1当天已签到2已完成)
+            elif task_info_dict["task_type"] == TaskType.cumulative_sign.value:
+                result["current"] = task_count.complete_count
+                if isinstance(config_json["day_list"],list):
+                    max_sign_day = max(query(config_json["day_list"]).select(lambda x: int(x["day"])).to_list())
+                else:
+                    max_sign_day = int(max(config_json["day_list"])) if len(config_json["day_list"].keys()) > 0 else 0
+                if task_count.complete_count >= max_sign_day:
+                    result["status"] = 2
+                else:
+                    result["status"] = 1 if task_count.modify_day == now_day else 0
+                result["total"] = max_sign_day
+                result["complete_count"] = 1 #可以完成的次数
+                result["current_complete_count"] = 1 if task_count.complete_count == max_sign_day else 0 #当前完成的次数
+                result["btn_text"] = ["签到", "已签到","已完成"]
+                result["route_url"] = "cumulative_sign"
+                result_list.append(result)
+            #连续签到(status:0当天未签到1当天已签到2已完成)
+            elif task_info_dict["task_type"] == TaskType.successive_sign.value:
+                result["current"] = task_count.complete_count
+                if isinstance(config_json["day_list"],list):
+                    max_sign_day = max(query(config_json["day_list"]).select(lambda x: int(x["day"])).to_list())
+                else:
+                    max_sign_day = int(max(config_json["day_list"])) if len(config_json["day_list"].keys()) > 0 else 0
+                if task_count.complete_count >= max_sign_day:
+                    result["status"] = 2
+                else:
+                    result["status"] = 1 if task_count.modify_day == now_day else 0
+                result["total"] = max_sign_day
+                result["complete_count"] = 1 #可以完成的次数
+                result["current_complete_count"] = 1 if task_count.complete_count == max_sign_day else 0 #当前完成的次数
+                result["btn_text"] = ["签到", "已签到","已完成"]
+                result["route_url"] = "successive_sign"
+                result_list.append(result)
+            #邀请新用户
+            elif task_info_dict["task_type"] == TaskType.invite_new_user.value:
+                limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
+                satisfy_num = int(config_json["satisfy_num"]) if config_json.__contains__("satisfy_num") else 0
+                get_ways = config_json["get_ways"] if config_json.__contains__("get_ways") else 1
+                if task_count.complete_count >= limit_num:
+                    result["status"] = 1
+                else:
+                    result["status"] = 0
+                invite_log_model = InviteLogModel(context=self.context)
+                invite_log_list = invite_log_model.get_cache_dict_list("act_id=%s and user_id=%s and create_day=%s", "", order_by="id desc", field="invite_avatar", params=[act_id, user_id, SevenHelper.get_now_day_int()], dependency_key=DependencyKey.invite_log_list(act_id,user_id))
+                result["data"] = invite_log_list if len(invite_log_list) > 0 else []
+                result["title"] = f"每日邀请{satisfy_num}名新用户"
+                result["total"] = satisfy_num
+                result["current"] = task_count.now_count
+                result["complete_count"] = limit_num #可以完成的次数
+                result["current_complete_count"] = task_count.complete_count #当前完成的次数
+                result["desc"] = f"{complete_type_name}完成上限{limit_num}次，当前剩余" + "{remain_complete_count}次"
+                result["get_ways"] = get_ways
+                result["btn_text"] = ["去邀请", "已完成"]
+                result["route_url"] = "task_inivite"
+                result_list.append(result)
+            #邀请加入会员
+            elif task_info_dict["task_type"] == TaskType.invite_join_member.value:
+                limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
+                satisfy_num = int(config_json["satisfy_num"]) if config_json.__contains__("satisfy_num") else 0
+                get_ways = config_json["get_ways"] if config_json.__contains__("get_ways") else 1
+                if task_count.complete_count >= limit_num:
+                    result["status"] = 1
+                else:
+                    result["status"] = 0
+                invite_log_model = InviteLogModel(context=self.context, sub_table="member")
+                invite_log_list = invite_log_model.get_cache_dict_list("act_id=%s and user_id=%s and create_day=%s", "", order_by="id desc", field="invite_avatar", params=[act_id, user_id, SevenHelper.get_now_day_int()], dependency_key=DependencyKey.invite_log_member_list(act_id,user_id))
+                result["data"] = invite_log_list if len(invite_log_list) > 0 else []
+                result["title"] = f"每日邀请{satisfy_num}名入会"
+                result["total"] = satisfy_num
+                result["current"] = task_count.now_count
+                result["complete_count"] = limit_num #可以完成的次数
+                result["current_complete_count"] = task_count.complete_count #当前完成的次数
+                result["desc"] = f"{complete_type_name}完成上限{limit_num}次，当前剩余" + "{remain_complete_count}次"
+                result["get_ways"] = get_ways
+                result["btn_text"] = ["去邀请", "已完成"]
+                result["route_url"] = "task_invite_member"
+                result_list.append(result)
+            #关注店铺
+            elif task_info_dict["task_type"] == TaskType.favor_store.value:
+                once_favor_reward = int(config_json["once_favor_reward"]) if config_json.__contains__("once_favor_reward") else 1
+                user_base_model = UserBaseModel(context=self.context)
+                user_info_dict = user_base_model.get_user_info_dict(app_id,act_id,user_id)
+                if not user_info_dict:
+                    result["status"] = 0
+                if module_id:
+                    if task_count.complete_count >= 1:
+                        result["status"] = 1
+                    elif user_info_dict["is_favor_before"] == 1 and once_favor_reward == 0:
+                        result["status"] = 1
+                    else:
+                        result["status"] = 0
+                else:
+                    if task_count.complete_count >= 1 or user_info_dict["is_favor"] == 1:
+                        result["status"] = 1
+                    elif user_info_dict["is_favor_before"] == 1 and once_favor_reward == 0:
+                        result["status"] = 1
+                    else:
+                        result["status"] = 0
+                result["current_complete_count"] = task_count.complete_count #当前完成的次数
+                result["btn_text"] = ["去关注", "已关注"]
+                result["route_url"] = "task_favor"
+                result_list.append(result)
+            #加入会员
+            elif task_info_dict["task_type"] == TaskType.join_member.value:
+                once_member_reward = int(config_json["once_member_reward"]) if config_json.__contains__("once_member_reward") else 1
+                user_base_model = UserBaseModel(context=self.context)
+                user_info_dict = user_base_model.get_user_info_dict(app_id,act_id,user_id)
+                if not user_info_dict:
+                    result["status"] = 0
+                if module_id:
+                    if task_count.complete_count >= 1:
+                        result["status"] = 1
+                    elif user_info_dict["is_member_before"] == 1 and once_member_reward == 0:
+                        result["status"] = 1
+                    else:
+                        result["status"] = 0
+                else:
+                    if task_count.complete_count >= 1 or user_info_dict["is_member"] == 1:
+                        result["status"] = 1
+                    elif user_info_dict["is_member_before"] == 1 and once_member_reward == 0:
+                        result["status"] = 1
+                    else:
+                        result["status"] = 0
+                result["current_complete_count"] = task_count.complete_count #当前完成的次数
+                result["btn_text"] = ["立即入会", "已领取"]
+                result["route_url"] = "task_member"
+                result_list.append(result)
+            #收藏商品
+            elif task_info_dict["task_type"] == TaskType.collect_goods.value:
+                get_ways = config_json["get_ways"] if config_json.__contains__("get_ways") else 1
+                collect_log_model = CollectLogModel(context=self.context)
+                condition = "act_id=%s and user_id=%s"
+                params = [act_id, user_id]
+                user_goods_list = collect_log_model.get_cache_list(condition, params=params,dependency_key=DependencyKey.collect_log(act_id,user_id))
+                result["data"] = config_json["goods_list"] if config_json.__contains__("goods_list") else []
+                result["completed_ids"] = [str(i.goods_id) for i in user_goods_list] if len(user_goods_list) > 0 else []
+                result["current"] = task_count.now_count
+                result["total"] = len(result["data"])
+                result["status"] = 1 if len(result["data"]) == len(result["completed_ids"]) else 0
+                result["get_ways"] = get_ways
+                result["current_complete_count"] = 1 if result["status"] == 1 else 0 #当前完成的次数
+                result["btn_text"] = ["去收藏", "已完成"]
+                result["route_url"] = "task_collect"
+                result_list.append(result)
+            #浏览商品
+            elif task_info_dict["task_type"] == TaskType.browse_goods.value:
+                get_ways = config_json["get_ways"] if config_json.__contains__("get_ways") else 1
+                browse_log_model = BrowseLogModel(context=self.context)
+                condition = "act_id=%s and user_id=%s"
+                params = [act_id,user_id]
+                if daily_repeat_browse == True:
+                    condition += " and create_day=%s"
+                    params.append(now_day)
+                user_goods_list = browse_log_model.get_cache_list(condition, params=params,dependency_key=DependencyKey.browse_log(act_id,user_id))
+                result["data"] = config_json["goods_list"] if config_json.__contains__("goods_list") else []
+                result["completed_ids"] = [str(i.goods_id) for i in user_goods_list] if len(user_goods_list) > 0 else []
+                result["current"] = task_count.now_count
+                result["total"] = len(result["data"])
+                result["status"] = 1 if len(result["data"]) == len(result["completed_ids"]) else 0
+                result["get_ways"] = get_ways
+                result["current_complete_count"] = 1 if result["status"] == 1 else 0 #当前完成的次数
+                result["btn_text"] = ["去浏览", "已完成"]
+                result["route_url"] = "task_browse"
+                result_list.append(result)
+            #分享奖励
+            elif task_info_dict["task_type"] == TaskType.share.value:
+                get_ways = config_json["get_ways"] if config_json.__contains__("get_ways") else 0
+                limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
+                satisfy_num = int(config_json["satisfy_num"]) if config_json.__contains__("satisfy_num") else 1
+                result["current"] = task_count.now_count
+                result["total"] = satisfy_num
+                if task_count.complete_count >= limit_num:
+                    result["status"] = 1
+                else:
+                    result["status"] = 0
+                result["get_ways"] = get_ways
+                result["complete_count"] = limit_num #可以完成的次数
+                result["current_complete_count"] = task_count.complete_count #当前完成的次数
+                result["btn_text"] = ["去分享","已完成"]
+                result["route_url"] = "task_share"
+                result_list.append(result)
+            #浏览店铺
+            elif task_info_dict["task_type"] == TaskType.browse_store.value:
+                get_ways = config_json["get_ways"] if config_json.__contains__("get_ways") else 1
+                limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
+                result["current"] = task_count.complete_count
+                result["status"] = 1 if task_count.complete_count >= limit_num else 0
+                result["get_ways"] = get_ways
+                result["complete_count"] = limit_num #可以完成的次数
+                result["current_complete_count"] = task_count.complete_count #当前完成的次数
+                result["btn_text"] = ["去浏览", "已完成"]
+                result["route_url"] = "task_browse_store"
+                result_list.append(result)
+            #浏览直播间
+            elif task_info_dict["task_type"] == TaskType.browse_live_room.value:
+                get_ways = config_json["get_ways"] if config_json.__contains__("get_ways") else 1
+                limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
+                result["data"] = [config_json["link_url"]] if config_json.__contains__("link_url") else []
+                result["current"] = task_count.complete_count
+                result["status"] = 1 if task_count.complete_count >= limit_num else 0
+                result["get_ways"] = get_ways
+                result["complete_count"] = limit_num #可以完成的次数
+                result["current_complete_count"] = task_count.complete_count #当前完成的次数
+                result["btn_text"] = ["去浏览", "已完成"]
+                result["route_url"] = "task_browse_liveroom"
+                result_list.append(result)
+            #邀请助力
+            elif task_info_dict["task_type"] == TaskType.invite_user_help.value:
+                get_ways = config_json["get_ways"] if config_json.__contains__("get_ways") else 1
+                limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
+                satisfy_num = int(config_json["satisfy_num"]) if config_json.__contains__("satisfy_num") else 0
+                if task_count.complete_count >= limit_num:
+                    result["status"] = 1
+                else:
+                    result["status"] = 0
+                invite_help_model = InviteHelpModel(context=self.context)
+                help_type = 1
+                help_object_id = ''
+                help_id_md5 = CryptoHelper.md5_encrypt_int(f"{app_id}_{act_id}_{module_id}_{help_type}_{help_object_id}")
+                invite_help_list = invite_help_model.get_cache_dict_list("id_md5=%s and user_id=%s", "", order_by="id desc", field="invited_avatar", params=[help_id_md5, user_id], dependency_key=DependencyKey.invite_user_help_list(help_id_md5, user_id))
+                result["data"] = invite_help_list if len(invite_help_list) > 0 else []
+                result["title"] = f"每日邀请{satisfy_num}名用户"
+                result["total"] = satisfy_num
+                result["current"] = task_count.now_count
+                result["get_ways"] = get_ways
+                result["complete_count"] = limit_num #可以完成的次数
+                result["current_complete_count"] = task_count.complete_count #当前完成的次数
+                result["btn_text"] = ["去邀请", "已完成"]
+                result["route_url"] = "task_inivite_help"
+                result_list.append(result)
+            #神秘暗号
+            elif task_info_dict["task_type"] == TaskType.secret_code.value:
+                limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
+                result["current"] = task_count.complete_count
+                result["status"] = 1 if task_count.complete_count >= limit_num else 0
+                result["complete_count"] = limit_num #可以完成的次数
+                result["current_complete_count"] = task_count.complete_count #当前完成的次数
+                result["btn_text"] = ["输入暗号", "已完成"]
+                result["route_url"] = "task_secret_code"
+                result_list.append(result)
+            #店铺会员积分兑换资产
+            elif task_info_dict["task_type"] == TaskType.crm_point_exchange_asset.value:
+                limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
+                satisfy_num = int(config_json["satisfy_num"]) if config_json.__contains__("satisfy_num") else 0
+                result["status"] = 1 if task_count.complete_count >= limit_num else 0
+                result["total"] = satisfy_num
+                result["complete_count"] = limit_num #可以完成的次数
+                result["current_complete_count"] = task_count.complete_count #当前完成的次数
+                result["btn_text"] = ["兑换", "已完成"]
+                result["route_url"] = "task_crm_exchange_asset"
+                result_list.append(result)
+            #购买指定商品
+            elif task_info_dict["task_type"] == TaskType.buy_appoint_goods.value:
+                get_ways = config_json["get_ways"] if config_json.__contains__("get_ways") else 1
+                limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
+                satisfy_num = int(config_json["satisfy_num"]) if config_json.__contains__("satisfy_num") else 0
+                remark = SevenHelper.json_loads(task_count.remark) if task_count.remark else {"goods_id_list":[]}
+                result["data"] = config_json["goods_list"] if config_json.__contains__("goods_list") else []
+                result["completed_ids"] = list(set(remark.get("goods_id_list",[])))
+                result["total"] = satisfy_num
+                result["current"] = task_count.now_count
+                if task_count.complete_count >= limit_num:
+                    result["status"] = 1
+                else:
+                    result["status"] = 0
+                result["desc"] = f"{complete_type_name}完成上限{limit_num}次，当前剩余" + "{remain_complete_count}次"
+                result["get_ways"] = get_ways
+                result["complete_count"] = limit_num #可以完成的次数
+                result["current_complete_count"] = task_count.complete_count #当前完成的次数
+                result["btn_text"] = ["去完成", "已完成"]
+                result["route_url"] = "receive_reward"
+                result_list.append(result)
+            #购买指定商品每多少金额
+            elif task_info_dict["task_type"] == TaskType.buy_appoint_goods_price.value:
+                total_price =  self.get_gear_task_count(app_id, act_id, module_id, user_id, task_info_dict["task_type"], task_info_dict["complete_type"])
+                get_ways = config_json["get_ways"] if config_json.__contains__("get_ways") else 1
+                limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
+                satisfy_num = decimal.Decimal(config_json["satisfy_num"]) if config_json.__contains__("satisfy_num") else 0
+                result["data"] = config_json["goods_list"] if config_json.__contains__("goods_list") else []
+                result["total"] = satisfy_num
+                result["current"] = decimal.Decimal(total_price) - (satisfy_num * task_count.complete_count)
+                if task_count.complete_count >= limit_num:
+                    result["status"] = 1
+                else:
+                    result["status"] = 0
+                result["desc"] = f"{complete_type_name}完成上限{limit_num}次，当前剩余" + "{remain_complete_count}次"
+                result["get_ways"] = get_ways
+                result["complete_count"] = limit_num #可以完成的次数
+                result["current_complete_count"] = task_count.complete_count #当前完成的次数
+                result["btn_text"] = ["去完成", "已完成"]
+                result["route_url"] = "receive_reward"
+                result_list.append(result)
+            #购买全店商品每多少金额
+            elif task_info_dict["task_type"] == TaskType.buy_store_price.value:
+                total_price =  self.get_gear_task_count(app_id, act_id, module_id, user_id, task_info_dict["task_type"], task_info_dict["complete_type"])
+                get_ways = config_json["get_ways"] if config_json.__contains__("get_ways") else 1
+                limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
+                satisfy_num = decimal.Decimal(config_json["satisfy_num"]) if config_json.__contains__("satisfy_num") else 0
+                result["data"] = config_json["goods_list"] if config_json.__contains__("goods_list") else []
+                result["total"] = satisfy_num
+                result["current"] = decimal.Decimal(total_price) - (satisfy_num * task_count.complete_count)
+                if task_count.complete_count >= limit_num:
+                    result["status"] = 1
+                else:
+                    result["status"] = 0
+                result["desc"] = f"{complete_type_name}完成上限{limit_num}次，当前剩余" + "{remain_complete_count}次"
+                result["get_ways"] = get_ways
+                result["complete_count"] = limit_num #可以完成的次数
+                result["current_complete_count"] = task_count.complete_count #当前完成的次数
+                result["btn_text"] = ["去完成", "已完成"]
+                result["route_url"] = "receive_reward"
+                result_list.append(result)
+            #抽盒/抽包/抽奖
+            elif task_info_dict["task_type"] == TaskType.lottery.value:
+                get_ways = config_json["get_ways"] if config_json.__contains__("get_ways") else 1
+                limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
+                satisfy_num = int(config_json["satisfy_num"]) if config_json.__contains__("satisfy_num") else 0
+                result["current"] = task_count.now_count
+                result["total"] = satisfy_num
+                result["status"] = 1 if task_count.complete_count >= limit_num else 0
+                result["get_ways"] = get_ways
+                result["complete_count"] = limit_num #可以完成的次数
+                result["current_complete_count"] = task_count.complete_count #当前完成的次数
+                result["btn_text"] = ["去完成", "已完成"]
+                result["route_url"] = "receive_reward"
+                result_list.append(result)
+            #试抽
+            elif task_info_dict["task_type"] == TaskType.lottery_try.value:
+                get_ways = config_json["get_ways"] if config_json.__contains__("get_ways") else 1
+                limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
+                satisfy_num = int(config_json["satisfy_num"]) if config_json.__contains__("satisfy_num") else 0
+                result["current"] = task_count.now_count
+                result["total"] = satisfy_num
+                result["status"] = 1 if task_count.complete_count >= limit_num else 0
+                result["get_ways"] = get_ways
+                result["complete_count"] = limit_num #可以完成的次数
+                result["current_complete_count"] = task_count.complete_count #当前完成的次数
+                result["btn_text"] = ["去完成", "已完成"]
+                result["route_url"] = "receive_reward"
+                result_list.append(result)
+            #有档位任务列表的相关累计任务
+            elif config_json.__contains__("gear_list") == True:
+                result = self.convert_gear_task_node(app_id,act_id,module_id,user_id,task_info_dict,config_json,task_count_list)
+                result_list.append(result)
+
+        return result_list,task_info_list,task_count_list
+
+    def process_receive_reward(self,app_id,act_id,module_id,user_id,login_token,task_id,task_sub_type,handler_name,request_code,task_type=0,check_new_user=False,check_user_nick=True,continue_request_expire=5,is_stat=True,info_json=None,check_act_info_release=True,check_act_module_release=True):
+        """
+        :description: 处理领取任务奖励
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param user_id:用户标识
+        :param login_token:访问令牌
+        :param task_id:任务标识
+        :param task_sub_type:子任务类型,对应配置里的id字段
+        :param handler_name:接口名称
+        :param request_code:请求代码
+        :param task_type:任务类型，task_type和task_id二选一，task_id有的话用task_id，没有用task_type
+        :param check_new_user:是否新用户才能领取 1是0否
+        :param check_user_nick:是否校验昵称为空
+        :param continue_request_expire:连续请求过期时间，为0不进行校验，单位秒
+        :param is_stat:是否统计上报
+        :param info_json:资产日志详细信息
+        :param check_act_info_release:校验活动信息是否发布
+        :param check_act_module_release:校验活动模块是否发布
+        :return 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        if not task_id and not task_type:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "param_error"
+            invoke_result_data.error_message = "参数错误,task_id和task_type不能同时为空"
+            return invoke_result_data
+        if task_id:
+            source_object_id = f"taskid_{task_id}"
+            acquire_lock_name = f"process_receive_reward_taskid:{act_id}_{module_id}_{task_id}_{user_id}"
+        else:
+            source_object_id = f"tasktype_{task_type}"
+            acquire_lock_name = f"process_receive_reward_tasktype:{act_id}_{module_id}_{task_type}_{user_id}"
+
+        log_title = ""
+        now_day = TimeExHelper.get_now_day_int()
+        db_transaction = DbTransaction(db_config_dict=config.get_value("db_cloudapp"),context=self.context)
+        try:
+            invoke_result_data = self.business_process_executing(app_id, act_id, module_id, user_id, login_token, handler_name, check_new_user, check_user_nick, continue_request_expire, acquire_lock_name, source_object_id=source_object_id,check_act_info_release=check_act_info_release,check_act_module_release=check_act_module_release)
+            if invoke_result_data.success == True:
+                task_invoke_result_data = self.check_task_info(act_id,module_id,task_type=task_type,task_id=task_id)
+                if task_invoke_result_data.success == True:
+                    task_info_dict = task_invoke_result_data.data
+                    config_json = task_info_dict["config_json"]
+                    if task_sub_type:
+                        sub_config_json = []
+                        if isinstance(config_json, list): # 每个子任务使用单独的计数
+                            sub_config_json = [sub_config_json for sub_config_json in config_json if str(sub_config_json["id"]) == task_sub_type]
+                        elif config_json.__contains__("gear_list") == True: # 每个子任务使用总的累加计数
+                            sub_config_json = [sub_config_json for sub_config_json in config_json["gear_list"] if str(sub_config_json["id"]) == task_sub_type]
+                        config_json = sub_config_json[0] if len(sub_config_json) > 0 else {}
+                    task_type = task_info_dict["task_type"]
+                    reward_value = int(config_json["reward_value"]) if config_json.__contains__("reward_value") else 0
+                    asset_object_id = config_json["asset_object_id"] if config_json.__contains__("asset_object_id") else ""
+                    satisfy_num = decimal.Decimal(config_json["satisfy_num"]) if config_json.__contains__("satisfy_num") else 1
+                    limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
+                    act_info_dict = invoke_result_data.data["act_info_dict"]
+                    user_info_dict = invoke_result_data.data["user_info_dict"]
+                    invoke_result_data.data["task_info_dict"] = task_info_dict
+                    task_count_model = TaskCountModel(sub_table=self.get_business_sub_table("task_count_tb",{"app_id":app_id}),db_transaction=db_transaction, context=self.context)
+                    task_count_id_md5 = self._get_task_count_id_md5(act_id,module_id,task_type,task_sub_type,user_id)
+                    task_count = task_count_model.get_entity("id_md5=%s",params=[task_count_id_md5])
+                    task_count = TaskCount() if not task_count else task_count
+                    if task_info_dict["complete_type"] == TaskCompleteType.day.value and task_count.modify_day != now_day:
+                        task_count.complete_count = 0
+                        task_count.now_count = 0
+                        task_count.remark = ""
+                    elif task_info_dict["complete_type"] == TaskCompleteType.week.value and not TimeHelper.is_this_week(task_count.modify_date):
+                        task_count.complete_count = 0
+                        task_count.now_count = 0
+                        task_count.remark = ""
+                    elif task_info_dict["complete_type"] == TaskCompleteType.month.value and not TimeHelper.is_this_month(task_count.modify_date):
+                        task_count.complete_count = 0
+                        task_count.now_count = 0
+                        task_count.remark = ""
+                    if task_type in [TaskType.buy_appoint_goods_price.value, TaskType.buy_store_price.value]:
+                        total_price =  decimal.Decimal(self.get_gear_task_count(app_id, act_id, module_id, user_id, task_type, task_info_dict["complete_type"]))
+                        task_count.now_count = total_price - (task_count.complete_count * satisfy_num)
+                    if reward_value <= 0 or task_count.now_count <= 0:
+                        invoke_result_data.success = False
+                        invoke_result_data.error_code = "error"
+                        invoke_result_data.error_message = "无法领取"
+                    elif task_count.now_count < satisfy_num:
+                        invoke_result_data.success = False
+                        invoke_result_data.error_code = "error"
+                        invoke_result_data.error_message = "任务未完成"
+                    elif task_count.complete_count >= limit_num:
+                        invoke_result_data.success = False
+                        invoke_result_data.error_code = "error"
+                        invoke_result_data.error_message = "领取奖励已达上限"
+                    else:
+                        invite_list = None
+                        collect_list = None
+                        browse_list = None
+                        invite_help_list = None
+                        if task_type in [TaskType.invite_new_user.value, TaskType.invite_join_member.value]:
+                            if task_count.complete_count + int(task_count.now_count/satisfy_num) > limit_num:
+                                cur_complete_count = limit_num - task_count.complete_count
+                            else:
+                                cur_complete_count = int(task_count.now_count / satisfy_num)
+                            reward_value = cur_complete_count * reward_value
+                            cur_now_count = task_count.now_count - (cur_complete_count * satisfy_num)
+                            if task_type == TaskType.invite_new_user.value:
+                                invite_sub_table = ""
+                            else:
+                                invite_sub_table = "member"
+                            invite_log_model = InviteLogModel(sub_table=invite_sub_table,db_transaction=db_transaction,context=self.context)
+                            #获取邀请用户数
+                            if task_info_dict["complete_type"] == 1:
+                                invite_list = invite_log_model.get_list("act_id=%s and user_id=%s and is_handle=0 and create_day=%s",limit=str(cur_complete_count * satisfy_num), params=[act_id,user_id, now_day])
+                            elif task_info_dict["complete_type"] == 2:
+                                start_day = int(TimeHelper.get_first_day_of_the_week().strftime('%Y%m%d'))
+                                end_day = int(TimeHelper.get_last_day_of_the_week().strftime('%Y%m%d'))
+                                invite_list = invite_log_model.get_list("act_id=%s and user_id=%s and is_handle=0 and create_day>=%s and create_day<=%s",limit=str(cur_complete_count * satisfy_num), params=[act_id,user_id, start_day,end_day])
+                            else:
+                                invite_list = invite_log_model.get_list("act_id=%s and user_id=%s and is_handle=0",limit=str(cur_complete_count * satisfy_num), params=[act_id,user_id])
+                            if not info_json:
+                                info_json = {}
+                                info_json["title"] = f"邀请{len(invite_list)}人"
+                                info_json["list"] = invite_list
+                            invite_user_nick_list = []
+                            for invite_log in invite_list:
+                                if invite_log.invite_user_nick:
+                                    invite_user_nick_list.append(invite_log.invite_user_nick)
+                                else:
+                                    invite_user_nick_list.append(invite_log.invite_open_id)
+                            log_title = "被邀请用户：" + ",".join(invite_user_nick_list)
+                        elif task_type == TaskType.invite_user_help.value:
+                            if task_count.complete_count + int(task_count.now_count/satisfy_num) > limit_num:
+                                cur_complete_count = limit_num - task_count.complete_count
+                            else:
+                                cur_complete_count = int(task_count.now_count / satisfy_num)
+                            reward_value = cur_complete_count * reward_value
+                            cur_now_count = task_count.now_count - (cur_complete_count * satisfy_num)
+                            invite_help_model = InviteHelpModel(db_transaction=db_transaction,context=self.context)
+                            #获取邀请用户数
+                            help_type = 1
+                            help_object_id = ''
+                            help_id_md5 = CryptoHelper.md5_encrypt_int(f"{app_id}_{act_id}_{module_id}_{help_type}_{help_object_id}")
+                            invite_help_list = invite_help_model.get_list("id_md5=%s and user_id=%s and is_handle=0",limit=str(cur_complete_count * satisfy_num), params=[help_id_md5,user_id])
+                            if not info_json:
+                                info_json = {}
+                                info_json["title"] = f"邀请{len(invite_help_list)}人"
+                                info_json["list"] = invite_help_list
+                            invited_user_nick_list = []
+                            for invite_help in invite_help_list:
+                                if invite_help.invited_user_nick:
+                                    invited_user_nick_list.append(invite_help.invited_user_nick)
+                                else:
+                                    invited_user_nick_list.append(invite.invited_open_id)
+                            log_title = "被邀请用户：" + ",".join(invited_user_nick_list)
+                        elif task_type in [TaskType.collect_goods.value, TaskType.browse_goods.value]:
+                            if task_count.complete_count + int(task_count.now_count/satisfy_num) > limit_num:
+                                cur_complete_count = limit_num - task_count.complete_count
+                            else:
+                                cur_complete_count = int(task_count.now_count / satisfy_num)
+                            reward_value = cur_complete_count * reward_value
+                            cur_now_count = task_count.now_count - (cur_complete_count * satisfy_num)
+                            if task_type == TaskType.collect_goods.value:
+                                collect_log_model = CollectLogModel(db_transaction=db_transaction,context=self.context)
+                                if task_info_dict["complete_type"] == 1:
+                                    collect_list = collect_log_model.get_list("act_id=%s and user_id=%s and is_handle=0 and create_day=%s",limit=str(cur_complete_count * satisfy_num), params=[act_id,user_id, now_day])
+                                elif task_info_dict["complete_type"] == 2:
+                                    start_day = int(TimeHelper.get_first_day_of_the_week().strftime('%Y%m%d'))
+                                    end_day = int(TimeHelper.get_last_day_of_the_week().strftime('%Y%m%d'))
+                                    collect_list = collect_log_model.get_list("act_id=%s and user_id=%s and is_handle=0 and create_day>=%s and create_day<=%s",limit=str(cur_complete_count * satisfy_num), params=[act_id,user_id, start_day,end_day])
+                                else:
+                                    collect_list = collect_log_model.get_list("act_id=%s and user_id=%s and is_handle=0",limit=str(cur_complete_count * satisfy_num), params=[act_id,user_id])
+                                if not info_json:
+                                    info_json = {}
+                                    info_json["title"] = f"收藏{len(collect_list)}个"
+                                    info_json["list"] = collect_list
+                                collect_goods_id_list = [str(i.goods_id) for i in collect_list]
+                                log_title = "被收藏商品ID：" + ",".join(collect_goods_id_list)
+                            else:
+                                browse_log_model = BrowseLogModel(db_transaction=db_transaction,context=self.context)
+                                if task_info_dict["complete_type"] == 1:
+                                    browse_list = browse_log_model.get_list("act_id=%s and user_id=%s and is_handle=0 and create_day=%s",limit=str(cur_complete_count * satisfy_num), params=[act_id,user_id, now_day])
+                                elif task_info_dict["complete_type"] == 2:
+                                    start_day = int(TimeHelper.get_first_day_of_the_week().strftime('%Y%m%d'))
+                                    end_day = int(TimeHelper.get_last_day_of_the_week().strftime('%Y%m%d'))
+                                    browse_list = browse_log_model.get_list("act_id=%s and user_id=%s and is_handle=0 and create_day>=%s and create_day<=%s",limit=str(cur_complete_count * satisfy_num), params=[act_id,user_id, start_day,end_day])
+                                else:
+                                    browse_list = browse_log_model.get_list("act_id=%s and user_id=%s and is_handle=0",limit=str(cur_complete_count * satisfy_num), params=[act_id,user_id])
+                                if not info_json:
+                                    info_json = {}
+                                    info_json["title"] = f"收藏{len(browse_list)}个"
+                                    info_json["list"] = browse_list
+                                browse_goods_id_list = [str(i.goods_id) for i in browse_list]
+                                log_title = "被浏览商品ID：" + ",".join(browse_goods_id_list)
+                        elif task_type == TaskType.buy_appoint_goods.value:
+                            if task_count.complete_count + int(task_count.now_count/satisfy_num) > limit_num:
+                                cur_complete_count = limit_num - task_count.complete_count
+                            else:
+                                cur_complete_count = int(task_count.now_count / satisfy_num)
+                            reward_value = cur_complete_count * reward_value
+                            cur_now_count = task_count.now_count - (cur_complete_count * satisfy_num)
+                            remark = SevenHelper.json_loads(task_count.remark) if task_count.remark else {"goods_id_list":[]}
+                            goods_id_list = []
+                            task_goods_id_list = remark.get("goods_id_list",[])
+                            if len(task_goods_id_list) >= (cur_complete_count * satisfy_num):
+                                start_index = 0
+                                end_index = int(cur_complete_count * satisfy_num)
+                                goods_id_list = task_goods_id_list[start_index : end_index]
+                                del task_goods_id_list[start_index : end_index]
+                            if not info_json:
+                                info_json = {}
+                                info_json["title"] = f"购买{len(goods_id_list)}个"
+                                info_json["list"] = goods_id_list
+                            log_title = "购买商品ID：" + ",".join(goods_id_list)
+                            task_count.remark = SevenHelper.json_dumps({"goods_id_list":task_goods_id_list})
+                        else:
+                            if task_count.complete_count + int(task_count.now_count/satisfy_num) > limit_num:
+                                cur_complete_count = limit_num - task_count.complete_count
+                            else:
+                                cur_complete_count = int(task_count.now_count / satisfy_num)
+                            reward_value = cur_complete_count * reward_value
+                            cur_now_count = task_count.now_count - (cur_complete_count * satisfy_num)
+
+                        if invoke_result_data.success == True:
+                            try:
+                                db_transaction.begin_transaction()
+                                task_count.complete_count += cur_complete_count
+                                task_count.now_count = cur_now_count
+
+                                #更新邀请记录表
+                                if invite_list:
+                                    for invite in invite_list:
+                                        invite.is_handle = 1
+                                    invite_log_model.update_list(invite_list, "is_handle")
+                                #更新收藏记录表
+                                elif collect_list:
+                                    for collect in collect_list:
+                                        collect.is_handle = 1
+                                    collect_log_model.update_list(collect_list, "is_handle")
+                                #更新浏览记录表
+                                elif browse_list:
+                                    for browse in browse_list:
+                                        browse.is_handle = 1
+                                    browse_log_model.update_list(browse_list, "is_handle")
+                                #更新邀请助力记录表
+                                elif invite_help_list:
+                                    for invite_help in invite_help_list:
+                                        invite_help.is_handle = 1
+                                    invite_help_model.update_list(invite_help_list, "is_handle")
+
+                                #更新任务计数表
+                                task_count_model.update_entity(task_count, "complete_count,now_count,remark")
+                                result,message = db_transaction.commit_transaction(True)
+                                if result == False:
+                                    raise Exception("执行事务失败",message)
+                            except Exception as ex:
+                                if self.context:
+                                    self.context.logging_link_error("【领取任务奖励】" + traceback.format_exc())
+                                elif self.logging_link_error:
+                                    self.logging_link_error("【领取任务奖励】" + traceback.format_exc())
+                                self.business_process_executed()
+                                invoke_result_data.success = False
+                                invoke_result_data.error_code = "exception"
+                                invoke_result_data.error_message = "系统繁忙,请稍后再试"
+                                return invoke_result_data
+
+                            reward_object_id = asset_object_id
+                            reward_name = config_json.get("reward_name","")
+                            task_reward_type = config_json.get("reward_type", TaskRewardType.asset.value)
+                            #奖励类型为资产走资产系统
+                            if task_reward_type == TaskRewardType.asset.value:
+                                only_id = self.get_only_id(user_id,task_info_dict["complete_type"],task_info_dict["task_type"],task_sub_type,task_count.complete_count)
+                                if module_id > 0:
+                                    only_id = f"{module_id}_{only_id}"
+                                asset_type = self.get_task_asset_type(act_info_dict["task_asset_type_json"],task_info_dict["task_type"])
+                                reward_object_id = asset_type
+                                asset_base_model = AssetBaseModel(context=self.context)
+                                log_title = log_title if log_title else task_info_dict["task_name"]
+                                asset_invoke_result_data = asset_base_model.update_user_asset(app_id,act_id,module_id,user_id,user_info_dict["open_id"],user_info_dict["user_nick"],asset_type,reward_value,asset_object_id,2,task_info_dict["task_type"],task_info_dict["task_name"],log_title,only_id,handler_name,request_code,info_json=info_json)
+                                if asset_invoke_result_data.success == False:
+                                    reward_value = 0
+                            invoke_result_data.data["config_json"] = config_json
+                            invoke_result_data.data["reward_value"] = reward_value
+
+                            self.add_task_stat(task_type, app_id, act_id, module_id, user_info_dict["user_id"], user_info_dict["open_id"], reward_value, is_stat, cur_complete_count)
+                            self.add_task_log(task_type=task_type, task_sub_type=task_sub_type, app_id=app_id, act_id=act_id, module_id=module_id, user_id=user_info_dict["user_id"], open_id=user_info_dict["open_id"], user_nick=user_info_dict["user_nick"],task_name=task_info_dict["task_name"],log_title=log_title,reward_type=task_reward_type, reward_object_id=reward_object_id, reward_name=reward_name, reward_num=reward_value, handler_name=handler_name, request_code=request_code, info_json=info_json)
+                else:
+                    invoke_result_data.success = False
+                    invoke_result_data.error_code = task_invoke_result_data.error_code
+                    invoke_result_data.error_message = task_invoke_result_data.error_message
+        except Exception as ex:
+            if self.context:
+                self.context.logging_link_error("【领取任务奖励】" + traceback.format_exc())
+            elif self.logging_link_error:
+                self.logging_link_error("【领取任务奖励】" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "exception"
+            invoke_result_data.error_message = "系统繁忙,请稍后再试"
+
+        self.business_process_executed()
+
+        return invoke_result_data
+
+    def process_free_gift(self,app_id,act_id,module_id,user_id,login_token,handler_name,request_code,check_new_user=False,check_user_nick=True,continue_request_expire=5,is_stat=True,info_json=None):
+        """
+        :description: 处理掌柜有礼、新人有礼、免费领取等相似任务
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param user_id:用户标识
+        :param login_token:访问令牌
+        :param handler_name:接口名称
+        :param request_code:请求代码
+        :param check_new_user:是否新用户才能领取 1是0否
+        :param check_user_nick:是否校验昵称为空
+        :param continue_request_expire:连续请求过期时间，为0不进行校验，单位秒
+        :param is_stat:是否统计上报
+        :param info_json:资产日志详细信息
+        :return 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        acquire_lock_name = f"process_free_gift:{act_id}_{module_id}_{user_id}"
+        task_type = TaskType.free_gift.value
+        now_day = TimeExHelper.get_now_day_int()
+        now_datetime = TimeHelper.get_now_format_time()
+        if not info_json:
+            info_json = {}
+        try:
+            invoke_result_data = self.business_process_executing(app_id,act_id,module_id,user_id,login_token,handler_name,check_new_user,check_user_nick,continue_request_expire,acquire_lock_name)
+            if invoke_result_data.success == True:
+                task_invoke_result_data = self.check_task_info(act_id,module_id,task_type)
+                if task_invoke_result_data.success == True:
+                    task_info_dict = task_invoke_result_data.data
+                    config_json = task_info_dict["config_json"]
+                    reward_value = int(config_json["reward_value"]) if config_json.__contains__("reward_value") else 0
+                    limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
+                    asset_object_id = config_json["asset_object_id"] if config_json.__contains__("asset_object_id") else ""
+                    act_info_dict = invoke_result_data.data["act_info_dict"]
+                    act_module_dict = invoke_result_data.data["act_module_dict"]
+                    user_info_dict = invoke_result_data.data["user_info_dict"]
+                    task_count_model = TaskCountModel(sub_table=self.get_business_sub_table("task_count_tb",{"app_id":app_id}),context=self.context)
+                    task_count_id_md5 = self._get_task_count_id_md5(act_id,module_id,task_info_dict["task_type"],"",user_id)
+                    task_count = task_count_model.get_entity("id_md5=%s",params=[task_count_id_md5])
+                    task_count = TaskCount() if not task_count else task_count
+                    limit_meaasge = ""
+                    if task_info_dict["complete_type"] == 1:
+                        limit_meaasge = "今日领取上限"
+                        if task_count.modify_day != now_day:
+                            task_count.complete_count = 0
+                            task_count.now_count = 0
+                    elif task_info_dict["complete_type"] == 2:
+                        limit_meaasge = "每周领取上限"
+                        if TimeHelper.is_this_week(task_count.modify_date) == False:
+                            task_count.complete_count = 0
+                            task_count.now_count = 0
+                    else:
+                        limit_meaasge = "领取上限"
+                    is_limit = True if task_count.complete_count >= limit_num else False
+                    if is_limit == True:
+                        invoke_result_data.success = False
+                        invoke_result_data.error_code = "error"
+                        invoke_result_data.error_message = limit_meaasge
+                    else:
+                        task_count.id_md5 = task_count_id_md5
+                        task_count.app_id = app_id
+                        task_count.act_id = act_id
+                        task_count.module_id = module_id
+                        task_count.user_id = user_id
+                        task_count.open_id = user_info_dict["open_id"]
+                        task_count.task_type = task_type
+                        task_count.task_sub_type = ""
+                        task_count.complete_count = task_count.complete_count+1
+                        task_count.now_count = 0
+                        task_count.create_date = now_datetime
+                        task_count.modify_date = now_datetime
+                        task_count.modify_day = now_day
+                        task_count_model.add_update_entity(task_count,"complete_count=%s,modify_date=%s,modify_day=%s",params=[task_count.complete_count,task_count.modify_date,now_day])
+
+                        reward_object_id = ""
+                        if reward_value > 0:
+                            only_id = self.get_only_id(user_id,task_info_dict["complete_type"],task_type,complete_count=task_count.complete_count)
+                            if module_id > 0:
+                                only_id = f"{module_id}_{only_id}"
+                            asset_type = self.get_task_asset_type(act_info_dict["task_asset_type_json"],task_type)
+                            reward_object_id = asset_type
+                            asset_base_model = AssetBaseModel(context=self.context)
+                            asset_invoke_result_data = asset_base_model.update_user_asset(app_id,act_id,module_id,user_id,user_info_dict["open_id"],user_info_dict["user_nick"],asset_type,reward_value,asset_object_id,2,task_type,task_info_dict["task_name"],task_info_dict["task_name"],only_id,handler_name,request_code,info_json=info_json)
+                            if asset_invoke_result_data.success == False:
+                                reward_value = 0
+                        invoke_result_data.data["reward_value"] = reward_value
+                        self.add_task_stat(task_type, app_id, act_id, module_id, user_info_dict["user_id"], user_info_dict["open_id"], reward_value, is_stat)
+                        self.add_task_log(task_type=task_type, task_sub_type='', app_id=app_id, act_id=act_id, module_id=module_id, user_id=user_info_dict["user_id"], open_id=user_info_dict["open_id"], user_nick=user_info_dict["user_nick"],task_name=task_info_dict["task_name"],log_title=task_info_dict["task_name"],reward_type=1, reward_object_id=reward_object_id, reward_name="", reward_num=reward_value, handler_name=handler_name, request_code=request_code, info_json=info_json)
+                else:
+                    invoke_result_data.success = False
+                    invoke_result_data.error_code = task_invoke_result_data.error_code
+                    invoke_result_data.error_message = task_invoke_result_data.error_message
+        except Exception as ex:
+            self.context.logging_link_error("【掌柜有礼任务】" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "exception"
+            invoke_result_data.error_message = "系统繁忙,请稍后再试"
+
+        self.business_process_executed()
+
+        return invoke_result_data
+
+    def process_one_sign(self,app_id,act_id,module_id,user_id,login_token,handler_name,request_code,check_new_user=False,check_user_nick=True,continue_request_expire=5,is_stat=True,info_json=None):
+        """
+        :description: 处理单次签到任务
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param user_id:用户标识
+        :param login_token:访问令牌
+        :param handler_name:接口名称
+        :param request_code:请求代码
+        :param check_new_user:是否新用户才能领取 1是0否
+        :param check_user_nick:是否校验昵称为空
+        :param continue_request_expire:连续请求过期时间，为0不进行校验，单位秒
+        :param is_stat:是否统计上报
+        :param info_json:资产日志详细信息
+        :return 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        acquire_lock_name = f"process_one_sign:{act_id}_{module_id}_{user_id}"
+        task_type = TaskType.one_sign.value
+        now_day = TimeExHelper.get_now_day_int()
+        now_datetime = TimeHelper.get_now_format_time()
+        if not info_json:
+            info_json = {}
+        try:
+            invoke_result_data = self.business_process_executing(app_id,act_id,module_id,user_id,login_token,handler_name,check_new_user,check_user_nick,continue_request_expire,acquire_lock_name)
+            if invoke_result_data.success == True:
+                task_invoke_result_data = self.check_task_info(act_id,module_id,task_type)
+                if task_invoke_result_data.success == True:
+                    task_info_dict = task_invoke_result_data.data
+                    config_json = task_info_dict["config_json"]
+                    reward_value = int(config_json["reward_value"]) if config_json.__contains__("reward_value") else 0
+                    asset_object_id = config_json["asset_object_id"] if config_json.__contains__("asset_object_id") else ""
+                    act_info_dict = invoke_result_data.data["act_info_dict"]
+                    act_module_dict = invoke_result_data.data["act_module_dict"]
+                    user_info_dict = invoke_result_data.data["user_info_dict"]
+                    task_count_model = TaskCountModel(sub_table=self.get_business_sub_table("task_count_tb",{"app_id":app_id}),context=self.context)
+                    task_count_id_md5 = self._get_task_count_id_md5(act_id,module_id,task_info_dict["task_type"],"",user_id)
+                    task_count = task_count_model.get_entity("id_md5=%s",params=[task_count_id_md5])
+                    task_count = TaskCount() if not task_count else task_count
+                    if task_info_dict["complete_type"] == 1 and task_count.modify_day == now_day:
+                        invoke_result_data.success = False
+                        invoke_result_data.error_code = "error"
+                        invoke_result_data.error_message = "今日已签到"
+                    elif task_info_dict["complete_type"] == 2 and TimeHelper.is_this_week(task_count.modify_date):
+                        invoke_result_data.success = False
+                        invoke_result_data.error_code = "error"
+                        invoke_result_data.error_message = "本周已签到"
+                    elif task_info_dict["complete_type"] == 3 and task_count:
+                        invoke_result_data.success = False
+                        invoke_result_data.error_code = "error"
+                        invoke_result_data.error_message = "已签到"
+                    else:
+                        task_count.id_md5 = task_count_id_md5
+                        task_count.app_id = app_id
+                        task_count.act_id = act_id
+                        task_count.module_id = module_id
+                        task_count.user_id = user_id
+                        task_count.open_id = user_info_dict["open_id"]
+                        task_count.task_type = task_type
+                        task_count.task_sub_type = ""
+                        task_count.complete_count = 1
+                        task_count.now_count = 1
+                        task_count.create_date = now_datetime
+                        task_count.modify_date = now_datetime
+                        task_count.modify_day = now_day
+                        task_count_model.add_update_entity(task_count,"complete_count=1,now_count=1,modify_date=%s,modify_day=%s",params=[task_count.modify_date,now_day])
+                        reward_object_id = ""
+                        if reward_value > 0:
+                            only_id = self.get_only_id(user_id,task_info_dict["complete_type"],task_type,complete_count=task_count.complete_count)
+                            if module_id > 0:
+                                only_id = f"{module_id}_{only_id}"
+                            asset_type = self.get_task_asset_type(act_info_dict["task_asset_type_json"],task_type)
+                            reward_object_id = asset_type
+                            asset_base_model = AssetBaseModel(context=self.context)
+                            asset_invoke_result_data = asset_base_model.update_user_asset(app_id,act_id,module_id,user_id,user_info_dict["open_id"],user_info_dict["user_nick"],asset_type,reward_value,asset_object_id,2,task_type,task_info_dict["task_name"],"签到1天",only_id,handler_name,request_code,info_json=info_json)
+                            if asset_invoke_result_data.success == False:
+                                reward_value = 0
+                        invoke_result_data.data["reward_value"] = reward_value
+                        self.add_task_stat(task_type,app_id, act_id, module_id, user_info_dict["user_id"], user_info_dict["open_id"], reward_value, is_stat)
+                        self.add_task_log(task_type=task_type, task_sub_type='', app_id=app_id, act_id=act_id, module_id=module_id, user_id=user_info_dict["user_id"], open_id=user_info_dict["open_id"], user_nick=user_info_dict["user_nick"],task_name=task_info_dict["task_name"],log_title=log_title,reward_type=1, reward_object_id=reward_object_id, reward_name="", reward_num=reward_value, handler_name=handler_name, request_code=request_code, info_json=info_json)
+                else:
+                    invoke_result_data.success = False
+                    invoke_result_data.error_code = task_invoke_result_data.error_code
+                    invoke_result_data.error_message = task_invoke_result_data.error_message
+        except Exception as ex:
+            self.context.logging_link_error("【单次签到任务】" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "exception"
+            invoke_result_data.error_message = "系统繁忙,请稍后再试"
+
+        self.business_process_executed()
+
+        return invoke_result_data
+
+    def process_weekly_sign(self,app_id,act_id,module_id,user_id,login_token,handler_name,request_code,check_new_user=False,check_user_nick=True,continue_request_expire=5,is_stat=True,info_json=None,check_act_info_release=True,check_act_module_release=True):
+        """
+        :description: 处理每周签到任务
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param user_id:用户标识
+        :param login_token:访问令牌
+        :param handler_name:接口名称
+        :param request_code:请求代码
+        :param check_new_user:是否新用户才能领取 1是0否
+        :param check_user_nick:是否校验昵称为空
+        :param continue_request_expire:连续请求过期时间，为0不进行校验，单位秒
+        :param is_stat:是否统计上报
+        :param info_json:资产日志详细信息
+        :param check_act_info_release:校验活动信息是否发布
+        :param check_act_module_release:校验活动模块是否发布
+        :return 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        acquire_lock_name = f"process_weekly_sign:{act_id}_{module_id}_{user_id}"
+        task_type = TaskType.weekly_sign.value
+        now_day = TimeExHelper.get_now_day_int()
+        now_datetime = TimeHelper.get_now_format_time()
+        if not info_json:
+            info_json = {}
+        try:
+            invoke_result_data = self.business_process_executing(app_id,act_id,module_id,user_id,login_token,handler_name,check_new_user,check_user_nick,continue_request_expire,acquire_lock_name,check_act_info_release=check_act_info_release,check_act_module_release=check_act_module_release)
+            if invoke_result_data.success == True:
+                task_invoke_result_data = self.check_task_info(act_id,module_id,task_type)
+                if task_invoke_result_data.success == True:
+                    task_info_dict = task_invoke_result_data.data
+                    config_json = task_info_dict["config_json"]
+                    asset_object_id = config_json["asset_object_id"] if config_json.__contains__("asset_object_id") else ""
+                    day_list = config_json["day_list"] if config_json.__contains__("day_list") else {}
+                    act_info_dict = invoke_result_data.data["act_info_dict"]
+                    act_module_dict = invoke_result_data.data["act_module_dict"]
+                    user_info_dict = invoke_result_data.data["user_info_dict"]
+                    task_count_model = TaskCountModel(sub_table=self.get_business_sub_table("task_count_tb",{"app_id":app_id}),context=self.context)
+                    task_count_id_md5 = self._get_task_count_id_md5(act_id,module_id,task_info_dict["task_type"],"",user_id)
+                    task_count = task_count_model.get_entity("id_md5=%s",params=[task_count_id_md5])
+                    task_count = TaskCount() if not task_count else task_count
+                    if task_count.modify_day == now_day:
+                        invoke_result_data.success = False
+                        invoke_result_data.error_code = "error"
+                        invoke_result_data.error_message = "今日已签到"
+                    else:
+                        task_count.id_md5 = task_count_id_md5
+                        task_count.app_id = app_id
+                        task_count.act_id = act_id
+                        task_count.module_id = module_id
+                        task_count.user_id = user_id
+                        task_count.open_id = user_info_dict["open_id"]
+                        task_count.task_type = task_type
+                        task_count.task_sub_type = ""
+                        task_count.complete_count = task_count.complete_count+1 if TimeHelper.is_this_week(task_count.modify_date) else 1
+                        task_count.now_count = 1
+                        task_count.create_date = now_datetime
+                        task_count.modify_date = now_datetime
+                        task_count.modify_day = now_day
+                        task_count_model.add_update_entity(task_count,"complete_count=%s,now_count=%s,modify_date=%s,modify_day=%s",params=[task_count.complete_count,task_count.now_count,task_count.modify_date,now_day])
+                        if isinstance(day_list,list):
+                            cur_day = query(day_list).first_or_default(None,lambda x: int(x["day"]) == task_count.complete_count)
+                            if cur_day:
+                                reward_value = int(cur_day["reward_value"])
+                            else:
+                                reward_value = 0
+                        else:
+                            reward_value = int(day_list[str(task_count.complete_count)]) if day_list.__contains__(str(task_count.complete_count)) else 0
+                        reward_object_id = ""
+                        if reward_value > 0:
+                            only_id = self.get_only_id(user_id,2,task_type,complete_count=task_count.complete_count)
+                            if module_id > 0:
+                                only_id = f"{module_id}_{only_id}"
+                            asset_type = self.get_task_asset_type(act_info_dict["task_asset_type_json"],task_type)
+                            reward_object_id = asset_type
+                            asset_base_model = AssetBaseModel(context=self.context)
+                            asset_invoke_result_data = asset_base_model.update_user_asset(app_id,act_id,module_id,user_id,user_info_dict["open_id"],user_info_dict["user_nick"],asset_type,reward_value,asset_object_id,2,task_type,task_info_dict["task_name"],f"签到{task_count.complete_count}天",only_id,handler_name,request_code,info_json=info_json)
+                            if asset_invoke_result_data.success == False:
+                                reward_value = 0
+                        invoke_result_data.data["reward_value"] = reward_value
+                        self.add_task_stat(task_type,app_id, act_id, module_id, user_info_dict["user_id"], user_info_dict["open_id"], reward_value, is_stat)
+                        self.add_task_log(task_type=task_type, task_sub_type='', app_id=app_id, act_id=act_id, module_id=module_id, user_id=user_info_dict["user_id"], open_id=user_info_dict["open_id"], user_nick=user_info_dict["user_nick"],task_name=task_info_dict["task_name"],log_title=f"签到{task_count.complete_count}天",reward_type=1, reward_object_id=reward_object_id, reward_name="", reward_num=reward_value, handler_name=handler_name, request_code=request_code, info_json=info_json)
+                else:
+                    invoke_result_data.success = False
+                    invoke_result_data.error_code = task_invoke_result_data.error_code
+                    invoke_result_data.error_message = task_invoke_result_data.error_message
+        except Exception as ex:
+            self.context.logging_link_error("【每周签到任务】" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "exception"
+            invoke_result_data.error_message = "系统繁忙,请稍后再试"
+
+        self.business_process_executed()
+
+        return invoke_result_data
+
+    def process_cumulative_sign(self,app_id,act_id,module_id,user_id,login_token,handler_name,request_code,check_new_user=False,check_user_nick=True,continue_request_expire=5,is_stat=True,info_json=None,task_type=0):
+        """
+        :description: 处理累计签到任务
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param user_id:用户标识
+        :param login_token:访问令牌
+        :param handler_name:接口名称
+        :param request_code:请求代码
+        :param check_new_user:是否新用户才能领取 1是0否
+        :param check_user_nick:是否校验昵称为空
+        :param continue_request_expire:连续请求过期时间，为0不进行校验，单位秒
+        :param is_stat:是否统计上报
+        :param info_json:资产日志详细信息
+        :param task_type:任务类型
+        :return 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        acquire_lock_name = f"process_cumulative_sign:{act_id}_{module_id}_{user_id}"
+        task_type = TaskType.cumulative_sign.value if task_type == 0 else task_type
+        now_day = TimeExHelper.get_now_day_int()
+        now_datetime = TimeHelper.get_now_format_time()
+        if not info_json:
+            info_json = {}
+        try:
+            invoke_result_data = self.business_process_executing(app_id,act_id,module_id,user_id,login_token,handler_name,check_new_user,check_user_nick,continue_request_expire,acquire_lock_name)
+            if invoke_result_data.success == True:
+                task_invoke_result_data = self.check_task_info(act_id,module_id,task_type)
+                if task_invoke_result_data.success == True:
+                    task_info_dict = task_invoke_result_data.data
+                    config_json = task_info_dict["config_json"]
+                    asset_object_id = config_json["asset_object_id"] if config_json.__contains__("asset_object_id") else ""
+                    day_list = config_json["day_list"] if config_json.__contains__("day_list") else {}
+                    act_info_dict = invoke_result_data.data["act_info_dict"]
+                    act_module_dict = invoke_result_data.data["act_module_dict"]
+                    user_info_dict = invoke_result_data.data["user_info_dict"]
+                    task_count_model = TaskCountModel(sub_table=self.get_business_sub_table("task_count_tb",{"app_id":app_id}),context=self.context)
+                    task_count_id_md5 = self._get_task_count_id_md5(act_id,module_id,task_info_dict["task_type"],"",user_id)
+                    task_count = task_count_model.get_entity("id_md5=%s",params=[task_count_id_md5])
+                    task_count = TaskCount() if not task_count else task_count
+                    if task_count.modify_day == now_day:
+                        invoke_result_data.success = False
+                        invoke_result_data.error_code = "error"
+                        invoke_result_data.error_message = "今日已签到"
+                    else:
+                        task_count.id_md5 = task_count_id_md5
+                        task_count.app_id = app_id
+                        task_count.act_id = act_id
+                        task_count.module_id = module_id
+                        task_count.user_id = user_id
+                        task_count.open_id = user_info_dict["open_id"]
+                        task_count.task_type = task_type
+                        task_count.task_sub_type = ""
+
+                        if isinstance(day_list,list):
+                            max_sign_day = max(query(day_list).select(lambda x: int(x["day"])).to_list())
+                        else:
+                            max_sign_day = int(max(day_list)) if len(day_list.keys()) > 0 else 0
+                        if task_count.complete_count == max_sign_day:
+                            invoke_result_data.success = False
+                            invoke_result_data.error_code = "error"
+                            invoke_result_data.error_message = "任务已完成"
+                        else:
+                            task_count.complete_count = task_count.complete_count+1 if task_count.complete_count < max_sign_day else 1
+                            task_count.now_count = 1
+                            task_count.create_date = now_datetime
+                            task_count.modify_date = now_datetime
+                            task_count.modify_day = now_day
+                            task_count_model.add_update_entity(task_count,"complete_count=%s,now_count=%s,modify_date=%s,modify_day=%s",params=[task_count.complete_count,task_count.now_count,task_count.modify_date,now_day])
+                            if isinstance(day_list,list):
+                                cur_day = query(day_list).first_or_default(None,lambda x: int(x["day"]) == task_count.complete_count)
+                                if cur_day:
+                                    reward_value = int(cur_day["reward_value"])
+                                else:
+                                    reward_value = 0
+                            else:
+                                reward_value = int(day_list[str(task_count.complete_count)]) if day_list.__contains__(str(task_count.complete_count)) else 0
+                            reward_object_id = ""
+                            if reward_value > 0:
+                                only_id = self.get_only_id(user_id,3,task_type,complete_count=task_count.complete_count)
+                                if module_id > 0:
+                                    only_id = f"{module_id}_{only_id}"
+                                asset_type = self.get_task_asset_type(act_info_dict["task_asset_type_json"],task_type)
+                                reward_object_id = asset_type
+                                asset_base_model = AssetBaseModel(context=self.context)
+                                asset_invoke_result_data = asset_base_model.update_user_asset(app_id,act_id,module_id,user_id,user_info_dict["open_id"],user_info_dict["user_nick"],asset_type,reward_value,asset_object_id,2,task_type,task_info_dict["task_name"],f"签到{task_count.complete_count}天",only_id,handler_name,request_code,info_json=info_json)
+                                if asset_invoke_result_data.success == False:
+                                    reward_value = 0
+                            invoke_result_data.data["reward_value"] = reward_value
+                            self.add_task_stat(task_type,app_id, act_id, module_id, user_info_dict["user_id"], user_info_dict["open_id"], reward_value, is_stat)
+                            self.add_task_log(task_type=task_type, task_sub_type='', app_id=app_id, act_id=act_id, module_id=module_id, user_id=user_info_dict["user_id"], open_id=user_info_dict["open_id"], user_nick=user_info_dict["user_nick"],task_name=task_info_dict["task_name"],log_title=f"签到{task_count.complete_count}天",reward_type=1, reward_object_id=reward_object_id, reward_name="", reward_num=reward_value, handler_name=handler_name, request_code=request_code, info_json=info_json)
+                else:
+                    invoke_result_data.success = False
+                    invoke_result_data.error_code = task_invoke_result_data.error_code
+                    invoke_result_data.error_message = task_invoke_result_data.error_message
+        except Exception as ex:
+            self.context.logging_link_error("【累计签到任务】" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "exception"
+            invoke_result_data.error_message = "系统繁忙,请稍后再试"
+
+        self.business_process_executed()
+
+        return invoke_result_data
+
+    def process_invite_user(self,app_id,act_id,module_id,user_id,login_token,from_user_id,handler_name,check_user_nick=True,check_new_user=True,continue_request_expire=5,close_invite_limit=False,check_act_info_release=True,check_act_module_release=True):
+        """
+        :description: 处理邀请用户任务
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param user_id:当前用户标识
+        :param login_token:访问令牌
+        :param from_user_id:邀请人用户标识
+        :param handler_name:接口名称
+        :param check_user_nick:是否校验昵称为空
+        :param check_new_user:是否校验新用户
+        :param continue_request_expire:连续请求过期时间，为0不进行校验，单位秒
+        :param close_invite_limit:是否关闭邀请限制 True是 False否
+        :param check_act_info_release:校验活动信息是否发布
+        :param check_act_module_release:校验活动模块是否发布
+        :return 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        acquire_lock_name = f"process_invite_user:{act_id}_{module_id}_{user_id}"
+        task_type = TaskType.invite_new_user.value
+        now_day = TimeExHelper.get_now_day_int()
+        now_datetime = TimeHelper.get_now_format_time()
+        try:
+            invoke_result_data = InvokeResultData()
+            if user_id == from_user_id:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "error"
+                invoke_result_data.error_message = "无效邀请"
+                return invoke_result_data
+
+            invoke_result_data = self.business_process_executing(app_id,act_id,module_id,user_id,login_token,handler_name,check_new_user,check_user_nick,continue_request_expire,acquire_lock_name,check_act_info_release=check_act_info_release,check_act_module_release=check_act_module_release)
+            if invoke_result_data.success == True:
+                act_info_dict = invoke_result_data.data["act_info_dict"]
+                act_module_dict = invoke_result_data.data["act_module_dict"]
+                user_info_dict = invoke_result_data.data["user_info_dict"]
+
+                user_base_model = UserBaseModel(context=self.context)
+                from_user_info_dict = user_base_model.get_user_info_dict(app_id,act_id,from_user_id)
+                invite_log_model = InviteLogModel(context=self.context)
+                invite_log_dict = invite_log_model.get_dict("act_id=%s and invite_user_id=%s", params=[act_id, user_id])
+                if invite_log_dict:
+                    invoke_result_data.success = False
+                    invoke_result_data.error_code = "error"
+                    invoke_result_data.error_message = "此用户已经被邀请过"
+                elif not from_user_info_dict:
+                    invoke_result_data.success = False
+                    invoke_result_data.error_code = "error"
+                    invoke_result_data.error_message = "邀请人不存在"
+                else:
+                    task_invoke_result_data = self.check_task_info(act_id,module_id,task_type)
+                    if task_invoke_result_data.success == True:
+                        task_info_dict = task_invoke_result_data.data
+                        config_json = task_info_dict["config_json"]
+                        limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
+                        satisfy_num = int(config_json["satisfy_num"]) if config_json.__contains__("satisfy_num") else 1
+                        task_count_model = TaskCountModel(sub_table=self.get_business_sub_table("task_count_tb",{"app_id":app_id}),context=self.context)
+                        task_count_id_md5 = self._get_task_count_id_md5(act_id,module_id,task_info_dict["task_type"],"",from_user_id)
+                        task_count = task_count_model.get_entity("id_md5=%s",params=[task_count_id_md5])
+                        task_count = TaskCount() if not task_count else task_count
+                        limit_meaasge = ""
+                        if task_info_dict["complete_type"] == 1:
+                            limit_meaasge = "今日邀请上限"
+                            if task_count.modify_day != now_day:
+                                task_count.complete_count = 0
+                                task_count.now_count = 0
+                        elif task_info_dict["complete_type"] == 2:
+                            limit_meaasge = "每周邀请上限"
+                            if TimeHelper.is_this_week(task_count.modify_date) == False:
+                                task_count.complete_count = 0
+                                task_count.now_count = 0
+                        else:
+                            limit_meaasge = "邀请上限"
+                        invite_count = int(task_count.complete_count * satisfy_num) + task_count.now_count
+                        is_invite_limit = True if invite_count >= limit_num else False
+                        if is_invite_limit == True and close_invite_limit == False:
+                            invoke_result_data.success = False
+                            invoke_result_data.error_code = "error"
+                            invoke_result_data.error_message = limit_meaasge
+                        else:
+                            invite_log = InviteLog()
+                            invite_log.app_id = app_id
+                            invite_log.act_id = act_id
+                            invite_log.user_id = from_user_id
+                            invite_log.open_id = from_user_info_dict["open_id"]
+                            invite_log.invite_user_id = user_info_dict["user_id"]
+                            invite_log.invite_open_id = user_info_dict["open_id"]
+                            invite_log.invite_user_nick = user_info_dict["user_nick"]
+                            invite_log.invite_avatar = user_info_dict["avatar"]
+                            invite_log.is_handle = 0
+                            invite_log.create_date = now_datetime
+                            invite_log.create_day = now_day
+                            invite_log_model.add_entity(invite_log)
+
+                            task_count.id_md5 = task_count_id_md5
+                            task_count.app_id = app_id
+                            task_count.act_id = act_id
+                            task_count.module_id = module_id
+                            task_count.user_id = from_user_id
+                            task_count.open_id = from_user_info_dict["open_id"]
+                            task_count.task_type = task_type
+                            task_count.task_sub_type = ""
+                            task_count.now_count = task_count.now_count + 1
+                            task_count.create_date = now_datetime
+                            task_count.modify_date = now_datetime
+                            task_count.modify_day = now_day
+                            task_count_model.add_update_entity(task_count,"complete_count=%s,now_count=%s,modify_date=%s,modify_day=%s",params=[task_count.complete_count,task_count.now_count,task_count.modify_date,now_day])
+                            invite_log_model.delete_dependency_key(DependencyKey.invite_log_list(act_id,from_user_id))
+                    else:
+                        invoke_result_data.success = False
+                        invoke_result_data.error_code = task_invoke_result_data.error_code
+                        invoke_result_data.error_message = task_invoke_result_data.error_message
+
+        except Exception as ex:
+            if self.context:
+                self.context.logging_link_error("【邀请新用户任务】" + traceback.format_exc())
+            elif self.logging_link_error:
+                self.logging_link_error("【邀请新用户任务】" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "exception"
+            invoke_result_data.error_message = "系统繁忙,请稍后再试"
+
+        self.business_process_executed()
+
+        return invoke_result_data
+
+    def process_invite_join_member(self, app_id, act_id, module_id, user_id, login_token, from_user_id, handler_name, check_user_nick=True, continue_request_expire=5, close_invite_limit=False):
+        """
+        :description: 处理邀请加入会员任务,目前只支持淘宝会员体系
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param user_id:当前用户标识
+        :param login_token:访问令牌
+        :param from_user_id:邀请人用户标识
+        :param handler_name:接口名称
+        :param check_user_nick:是否校验昵称为空
+        :param continue_request_expire:连续请求过期时间，为0不进行校验，单位秒
+        :param close_invite_limit:是否关闭邀请限制 True是 False否
+        :return 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        acquire_lock_name = f"process_invite_join_member:{act_id}_{module_id}_{user_id}"
+        task_type = TaskType.invite_join_member.value
+        now_day = TimeExHelper.get_now_day_int()
+        now_datetime = TimeHelper.get_now_format_time()
+        try:
+            invoke_result_data = InvokeResultData()
+            if user_id == from_user_id:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "error"
+                invoke_result_data.error_message = "无效邀请"
+                return invoke_result_data
+
+            invoke_result_data = self.business_process_executing(app_id,act_id,module_id,user_id,login_token,handler_name,False,check_user_nick,continue_request_expire,acquire_lock_name)
+
+            if invoke_result_data.success == True:
+                act_info_dict = invoke_result_data.data["act_info_dict"]
+                act_module_dict = invoke_result_data.data["act_module_dict"]
+                user_info_dict = invoke_result_data.data["user_info_dict"]
+
+                user_base_model = UserBaseModel(context=self.context)
+                from_user_info_dict = user_base_model.get_user_info_dict(app_id, act_id, from_user_id)
+                invite_log_model = InviteLogModel(context=self.context,sub_table="member")
+                invite_log_dict = invite_log_model.get_dict("act_id=%s and invite_user_id=%s", params=[act_id, user_id])
+                if invite_log_dict:
+                    invoke_result_data.success = False
+                    invoke_result_data.error_code = "error"
+                    invoke_result_data.error_message = "此用户已经被邀请过"
+                elif not from_user_info_dict:
+                    invoke_result_data.success = False
+                    invoke_result_data.error_code = "error"
+                    invoke_result_data.error_message = "邀请人不存在"
+                else:
+                    task_invoke_result_data = self.check_task_info(act_id,module_id,task_type)
+                    if task_invoke_result_data.success == True:
+                        task_info_dict = task_invoke_result_data.data
+                        config_json = task_info_dict["config_json"]
+                        limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
+                        satisfy_num = int(config_json["satisfy_num"]) if config_json.__contains__("satisfy_num") else 1
+                        task_count_model = TaskCountModel(sub_table=self.get_business_sub_table("task_count_tb",{"app_id":app_id}),context=self.context)
+                        task_count_id_md5 = self._get_task_count_id_md5(act_id,module_id,task_info_dict["task_type"],"",from_user_id)
+                        task_count = task_count_model.get_entity("id_md5=%s",params=[task_count_id_md5])
+                        task_count = TaskCount() if not task_count else task_count
+                        limit_meaasge = ""
+                        if task_info_dict["complete_type"] == 1:
+                            limit_meaasge = "今日邀请上限"
+                            if task_count.modify_day != now_day:
+                                task_count.complete_count = 0
+                                task_count.now_count = 0
+                        elif task_info_dict["complete_type"] == 2:
+                            limit_meaasge = "每周邀请上限"
+                            if TimeHelper.is_this_week(task_count.modify_date) == False:
+                                task_count.complete_count = 0
+                                task_count.now_count = 0
+                        else:
+                            limit_meaasge = "邀请上限"
+                        invite_count = int(task_count.complete_count * satisfy_num) + task_count.now_count
+                        is_invite_limit = True if invite_count >= limit_num else False
+                        if is_invite_limit == True and close_invite_limit == False:
+                            invoke_result_data.success = False
+                            invoke_result_data.error_code = "error"
+                            invoke_result_data.error_message = limit_meaasge
+                        else:
+
+                            invite_log = InviteLog()
+                            invite_log.app_id = app_id
+                            invite_log.act_id = act_id
+                            invite_log.user_id = from_user_id
+                            invite_log.open_id = from_user_info_dict["open_id"]
+                            invite_log.invite_user_id = user_info_dict["user_id"]
+                            invite_log.invite_open_id = user_info_dict["open_id"]
+                            invite_log.invite_user_nick = user_info_dict["user_nick"]
+                            invite_log.invite_avatar = user_info_dict["avatar"]
+                            invite_log.is_handle = 0
+                            invite_log.create_date = now_datetime
+                            invite_log.create_day = now_day
+                            invite_log_model.add_entity(invite_log)
+
+                            task_count.id_md5 = task_count_id_md5
+                            task_count.app_id = app_id
+                            task_count.act_id = act_id
+                            task_count.module_id = module_id
+                            task_count.user_id = from_user_id
+                            task_count.open_id = from_user_info_dict["open_id"]
+                            task_count.task_type = task_type
+                            task_count.task_sub_type = ""
+                            task_count.now_count = task_count.now_count + 1
+                            task_count.create_date = now_datetime
+                            task_count.modify_date = now_datetime
+                            task_count.modify_day = now_day
+                            task_count_model.add_update_entity(task_count,"complete_count=%s,now_count=%s,modify_date=%s,modify_day=%s",params=[task_count.complete_count,task_count.now_count,task_count.modify_date,now_day])
+                            invite_log_model.delete_dependency_key(DependencyKey.invite_log_member_list(act_id,from_user_id))
+                    else:
+                        invoke_result_data.success = False
+                        invoke_result_data.error_code = task_invoke_result_data.error_code
+                        invoke_result_data.error_message = task_invoke_result_data.error_message
+
+        except Exception as ex:
+            if self.context:
+                self.context.logging_link_error("【邀请加入会员任务】" + traceback.format_exc())
+            elif self.logging_link_error:
+                self.logging_link_error("【邀请加入会员任务】" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "exception"
+            invoke_result_data.error_message = "系统繁忙,请稍后再试"
+
+        self.business_process_executed()
+
+        return invoke_result_data
+
+    def process_collect_goods(self,app_id,act_id,module_id,user_id,login_token,goods_id,handler_name,check_user_nick=True,continue_request_expire=5):
+        """
+        :description: 处理收藏商品任务
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param user_id:用户标识
+        :param login_token:访问令牌
+        :param goods_id:收藏商品ID
+        :param handler_name:接口名称
+        :param check_user_nick:是否校验昵称为空
+        :param continue_request_expire:连续请求过期时间，为0不进行校验，单位秒
+        :return 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        acquire_lock_name = f"process_collect_goods:{act_id}_{module_id}_{user_id}"
+        task_type = TaskType.collect_goods.value
+        now_day = TimeExHelper.get_now_day_int()
+        now_datetime = TimeHelper.get_now_format_time()
+        try:
+            invoke_result_data = self.business_process_executing(app_id,act_id,module_id,user_id,login_token,handler_name,False,check_user_nick,continue_request_expire,acquire_lock_name)
+            if invoke_result_data.success == True:
+                user_info_dict = invoke_result_data.data["user_info_dict"]
+                collect_log_model = CollectLogModel(context=self.context)
+                where = "act_id=%s and user_id=%s and goods_id=%s"
+                params = [act_id, user_id, goods_id]
+                collect_log_dict = collect_log_model.get_dict(where, params=params)
+                if collect_log_dict:
+                    invoke_result_data.success = False
+                    invoke_result_data.error_code = "error"
+                    invoke_result_data.error_message = "此商品已经收藏过"
+                else:
+                    task_invoke_result_data = self.check_task_info(act_id,module_id,task_type)
+                    if task_invoke_result_data.success == True:
+                        task_info_dict = task_invoke_result_data.data
+                        config_json = task_info_dict["config_json"]
+                        limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
+                        satisfy_num = int(config_json["satisfy_num"]) if config_json.__contains__("satisfy_num") else 1
+                        goods_ids_list = list(set(str(config_json["goods_ids"]).split(','))) if config_json.__contains__("goods_ids") else []
+                        task_count_model = TaskCountModel(sub_table=self.get_business_sub_table("task_count_tb",{"app_id":app_id}),context=self.context)
+                        task_count_id_md5 = self._get_task_count_id_md5(act_id,module_id,task_info_dict["task_type"],"",user_id)
+                        task_count = task_count_model.get_entity("id_md5=%s",params=[task_count_id_md5])
+                        task_count = TaskCount() if not task_count else task_count
+                        limit_meaasge = ""
+                        if str(goods_id) not in goods_ids_list:
+                            invoke_result_data.success = False
+                            invoke_result_data.error_code = "error"
+                            invoke_result_data.error_message = "此商品不在收藏任务里"
+                        else:
+                            if task_info_dict["complete_type"] == 1:
+                                limit_meaasge = "今日收藏上限"
+                                if task_count.modify_day != now_day:
+                                    task_count.complete_count = 0
+                                    task_count.now_count = 0
+                            elif task_info_dict["complete_type"] == 2:
+                                limit_meaasge = "每周收藏上限"
+                                if TimeHelper.is_this_week(task_count.modify_date) == False:
+                                    task_count.complete_count = 0
+                                    task_count.now_count = 0
+                            else:
+                                limit_meaasge = "收藏上限"
+                        collect_count = int(task_count.complete_count * satisfy_num) + task_count.now_count
+                        is_collect_limit = True if collect_count >= (limit_num * satisfy_num) else False
+                        if is_collect_limit == True:
+                            invoke_result_data.success = False
+                            invoke_result_data.error_code = "error"
+                            invoke_result_data.error_message = limit_meaasge
+                        else:
+                            collect_log_model = CollectLogModel(context=self.context)
+                            collect_log = CollectLog()
+                            collect_log.app_id = app_id
+                            collect_log.act_id = act_id
+                            collect_log.user_id = user_id
+                            collect_log.open_id = user_info_dict["open_id"]
+                            collect_log.goods_id = goods_id
+                            collect_log.is_handle = 0
+                            collect_log.create_date = now_datetime
+                            collect_log.create_day = now_day
+                            collect_log_model.add_entity(collect_log)
+                            collect_log_model.delete_dependency_key(DependencyKey.collect_log(act_id,user_id))
+
+                            task_count.id_md5 = task_count_id_md5
+                            task_count.app_id = app_id
+                            task_count.act_id = act_id
+                            task_count.module_id = module_id
+                            task_count.user_id = user_id
+                            task_count.open_id = user_info_dict["open_id"]
+                            task_count.task_type = task_type
+                            task_count.task_sub_type = ""
+                            task_count.now_count = task_count.now_count + 1
+                            task_count.create_date = now_datetime
+                            task_count.modify_date = now_datetime
+                            task_count.modify_day = now_day
+                            task_count_model.add_update_entity(task_count,"complete_count=%s,now_count=%s,modify_date=%s,modify_day=%s",params=[task_count.complete_count,task_count.now_count,task_count.modify_date,now_day])
+
+                    else:
+                        invoke_result_data.success = False
+                        invoke_result_data.error_code = task_invoke_result_data.error_code
+                        invoke_result_data.error_message = task_invoke_result_data.error_message
+
+
+        except Exception as ex:
+            if self.context:
+                self.context.logging_link_error("【收藏商品任务】" + traceback.format_exc())
+            elif self.logging_link_error:
+                self.logging_link_error("【收藏商品任务】" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "exception"
+            invoke_result_data.error_message = "系统繁忙,请稍后再试"
+
+        self.business_process_executed()
+
+        return invoke_result_data
+
+    def process_browse_goods(self,app_id,act_id,module_id,user_id,login_token,goods_id,handler_name,daily_repeat_browse=True,check_user_nick=True,continue_request_expire=5):
+        """
+        :description: 处理浏览商品任务
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param user_id:用户标识
+        :param login_token:访问令牌
+        :param goods_id:浏览商品ID
+        :param handler_name:接口名称
+        :param daily_repeat_browse:单个商品可每日重复浏览 True是False否
+        :param check_user_nick:是否校验昵称为空
+        :param continue_request_expire:连续请求过期时间，为0不进行校验，单位秒
+        :return 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        acquire_lock_name = f"process_browse_goods:{act_id}_{module_id}_{user_id}"
+        task_type = TaskType.browse_goods.value
+        now_day = TimeExHelper.get_now_day_int()
+        now_datetime = TimeHelper.get_now_format_time()
+        try:
+            invoke_result_data = self.business_process_executing(app_id,act_id,module_id,user_id,login_token,handler_name,False,check_user_nick,continue_request_expire,acquire_lock_name)
+            if invoke_result_data.success == True:
+                user_info_dict = invoke_result_data.data["user_info_dict"]
+                browse_log_model = BrowseLogModel(context=self.context)
+                where = "act_id=%s and user_id=%s and goods_id=%s"
+                params = [act_id, user_id, goods_id]
+                if daily_repeat_browse == True:
+                    where+=" and create_day=%s"
+                    params.append(TimeExHelper.get_now_day_int())
+                browse_log_dict = browse_log_model.get_dict(where, params=params)
+                if browse_log_dict:
+                    invoke_result_data.success = False
+                    invoke_result_data.error_code = "error"
+                    invoke_result_data.error_message = "此商品已经浏览过"
+                else:
+                    task_invoke_result_data = self.check_task_info(act_id,module_id,task_type)
+                    if task_invoke_result_data.success == True:
+                        task_info_dict = task_invoke_result_data.data
+                        config_json = task_info_dict["config_json"]
+                        limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
+                        satisfy_num = int(config_json["satisfy_num"]) if config_json.__contains__("satisfy_num") else 1
+                        goods_ids_list = list(set(str(config_json["goods_ids"]).split(','))) if config_json.__contains__("goods_ids") else []
+                        task_count_model = TaskCountModel(sub_table=self.get_business_sub_table("task_count_tb",{"app_id":app_id}),context=self.context)
+                        task_count_id_md5 = self._get_task_count_id_md5(act_id,module_id,task_info_dict["task_type"],"",user_id)
+                        task_count = task_count_model.get_entity("id_md5=%s",params=[task_count_id_md5])
+                        task_count = TaskCount() if not task_count else task_count
+                        limit_meaasge = ""
+                        if str(goods_id) not in goods_ids_list:
+                            invoke_result_data.success = False
+                            invoke_result_data.error_code = "error"
+                            invoke_result_data.error_message = "此商品不在浏览任务里"
+                        else:
+                            if task_info_dict["complete_type"] == 1:
+                                limit_meaasge = "今日浏览上限"
+                                if task_count.modify_day != now_day:
+                                    task_count.complete_count = 0
+                                    task_count.now_count = 0
+                            elif task_info_dict["complete_type"] == 2:
+                                limit_meaasge = "每周浏览上限"
+                                if TimeHelper.is_this_week(task_count.modify_date) == False:
+                                    task_count.complete_count = 0
+                                    task_count.now_count = 0
+                            else:
+                                limit_meaasge = "浏览上限"
+                        browse_count = int(task_count.complete_count * satisfy_num) + task_count.now_count
+                        is_browse_limit = True if browse_count >= (limit_num * satisfy_num) else False
+                        if is_browse_limit == True:
+                            invoke_result_data.success = False
+                            invoke_result_data.error_code = "error"
+                            invoke_result_data.error_message = limit_meaasge
+                        else:
+                            browse_log_model = BrowseLogModel(context=self.context)
+                            browse_log = BrowseLog()
+                            browse_log.app_id = app_id
+                            browse_log.act_id = act_id
+                            browse_log.user_id = user_id
+                            browse_log.open_id = user_info_dict["open_id"]
+                            browse_log.goods_id = goods_id
+                            browse_log.is_handle = 0
+                            browse_log.create_date = now_datetime
+                            browse_log.create_day = now_day
+                            browse_log_model.add_entity(browse_log)
+                            browse_log_model.delete_dependency_key(DependencyKey.browse_log(act_id,user_id))
+
+                            task_count.id_md5 = task_count_id_md5
+                            task_count.app_id = app_id
+                            task_count.act_id = act_id
+                            task_count.module_id = module_id
+                            task_count.user_id = user_id
+                            task_count.open_id = user_info_dict["open_id"]
+                            task_count.task_type = task_type
+                            task_count.task_sub_type = ""
+                            task_count.now_count = task_count.now_count + 1
+                            task_count.create_date = now_datetime
+                            task_count.modify_date = now_datetime
+                            task_count.modify_day = now_day
+                            task_count_model.add_update_entity(task_count,"complete_count=%s,now_count=%s,modify_date=%s,modify_day=%s",params=[task_count.complete_count,task_count.now_count,task_count.modify_date,now_day])
+
+                    else:
+                        invoke_result_data.success = False
+                        invoke_result_data.error_code = task_invoke_result_data.error_code
+                        invoke_result_data.error_message = task_invoke_result_data.error_message
+
+
+        except Exception as ex:
+            if self.context:
+                self.context.logging_link_error("【浏览商品任务】" + traceback.format_exc())
+            elif self.logging_link_error:
+                self.logging_link_error("【浏览商品任务】" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "exception"
+            invoke_result_data.error_message = "系统繁忙,请稍后再试"
+
+        self.business_process_executed()
+
+        return invoke_result_data
+
+    def process_favor_store(self,app_id,act_id,module_id,user_id,login_token,handler_name,request_code,check_user_nick=True,continue_request_expire=5,is_stat=True,info_json=None):
+        """
+        :description: 处理关注店铺,有任务给奖励，没有则直接关注
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param user_id:用户标识
+        :param login_token:访问令牌
+        :param handler_name:接口名称
+        :param request_code:请求代码
+        :param check_user_nick:是否校验昵称为空
+        :param continue_request_expire:连续请求过期时间，为0不进行校验，单位秒
+        :param is_stat:是否统计上报
+        :param info_json:资产日志详细信息
+        :return 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        acquire_lock_name = f"process_favor_store:{act_id}_{module_id}_{user_id}"
+        task_type = TaskType.favor_store.value
+        now_day = TimeExHelper.get_now_day_int()
+        now_datetime = TimeHelper.get_now_format_time()
+        stat_base_model = StatBaseModel(context=self.context)
+        if not info_json:
+            info_json = {}
+        try:
+            invoke_result_data = self.business_process_executing(app_id,act_id,module_id,user_id,login_token,handler_name,False,check_user_nick,continue_request_expire,acquire_lock_name)
+            if invoke_result_data.success == True:
+                act_info_dict = invoke_result_data.data["act_info_dict"]
+                act_module_dict = invoke_result_data.data["act_module_dict"]
+                user_info_dict = invoke_result_data.data["user_info_dict"]
+
+                if user_info_dict["is_favor_before"] == 0:
+                    if is_stat == True:
+                        #新增关注用户数
+                        stat_base_model.add_stat(app_id, act_id, module_id, user_info_dict["user_id"], user_info_dict["open_id"], "AddFollowUserCount",1)
+                is_limit = False
+                task_count_model = TaskCountModel(sub_table=self.get_business_sub_table("task_count_tb",{"app_id":app_id}),context=self.context)
+                task_count_id_md5 = self._get_task_count_id_md5(act_id,module_id,task_type,"",user_id)
+                task_count = task_count_model.get_entity("id_md5=%s",params=[task_count_id_md5])
+                task_count = task_count if task_count else TaskCount()
+                if module_id:
+                    is_limit = True if task_count.complete_count >= 1 else False
+                else:
+                    is_limit = True if task_count.complete_count >= 1 or user_info_dict["is_favor"] == 1 else False
+                if is_limit == True:
+                    invoke_result_data.success = False
+                    invoke_result_data.error_code = "error"
+                    invoke_result_data.error_message = "已经关注过店铺了"
+                else:
+                    user_info_model = UserInfoModel(sub_table=self.get_business_sub_table("user_info_tb",{"app_id":app_id}),context=self.context)
+                    user_info_model.update_table("is_favor=1","id=%s",params=[user_info_dict["id"]])
+                    UserBaseModel(context=self.context)._delete_user_info_cache(user_info_dict["act_id"],user_info_dict["id_md5"])
+                    reward_value = 0
+                    reward_object_id =""
+                    task_invoke_result_data = self.check_task_info(act_id,module_id,task_type)
+                    if task_invoke_result_data.success == True:
+                        task_info_dict = task_invoke_result_data.data
+                        config_json = task_info_dict["config_json"]
+                        reward_value = int(config_json["reward_value"]) if config_json.__contains__("reward_value") else 0
+                        once_favor_reward = int(config_json["once_favor_reward"]) if config_json.__contains__("once_favor_reward") else 1
+                        asset_object_id = config_json["asset_object_id"] if config_json.__contains__("asset_object_id") else ""
+
+                        task_count.id_md5 = task_count_id_md5
+                        task_count.app_id = app_id
+                        task_count.act_id = act_id
+                        task_count.module_id = module_id
+                        task_count.user_id = user_id
+                        task_count.open_id = user_info_dict["open_id"]
+                        task_count.task_type = task_type
+                        task_count.task_sub_type = ""
+                        task_count.complete_count = task_count.complete_count+1
+                        task_count.now_count = 0
+                        task_count.create_date = now_datetime
+                        task_count.modify_date = now_datetime
+                        task_count.modify_day = now_day
+                        task_count_model.add_update_entity(task_count,"complete_count=%s,modify_date=%s,modify_day=%s",params=[task_count.complete_count,task_count.modify_date,now_day])
+
+                        if user_info_dict["is_favor_before"] == 1 and once_favor_reward == 0:
+                            reward_value = 0
+                        if reward_value > 0:
+                            only_id = self.get_only_id(user_id,task_info_dict["complete_type"],task_type)
+                            if module_id > 0:
+                                only_id = f"{module_id}_{only_id}"
+                            asset_type = self.get_task_asset_type(act_info_dict["task_asset_type_json"],task_type)
+                            reward_object_id = asset_type
+                            asset_base_model = AssetBaseModel(context=self.context)
+                            asset_invoke_result_data = asset_base_model.update_user_asset(app_id,act_id,module_id,user_id,user_info_dict["open_id"],user_info_dict["user_nick"],asset_type,reward_value,asset_object_id,2,task_type,task_info_dict["task_name"],task_info_dict["task_name"],only_id,handler_name,request_code,info_json=info_json)
+                            if asset_invoke_result_data.success == False:
+                                reward_value = 0
+                    invoke_result_data.data["reward_value"] = reward_value
+                    self.add_task_stat(task_type, app_id, act_id, module_id, user_info_dict["user_id"], user_info_dict["open_id"], reward_value, is_stat)
+                    self.add_task_log(task_type=task_type, task_sub_type='', app_id=app_id, act_id=act_id, module_id=module_id, user_id=user_info_dict["user_id"], open_id=user_info_dict["open_id"], user_nick=user_info_dict["user_nick"],task_name=task_info_dict["task_name"],log_title=task_info_dict["task_name"],reward_type=1, reward_object_id=reward_object_id, reward_name="", reward_num=reward_value, handler_name=handler_name, request_code=request_code, info_json=info_json)
+
+        except Exception as ex:
+            if self.context:
+                self.context.logging_link_error("【关注店铺】" + traceback.format_exc())
+            elif self.logging_link_error:
+                self.logging_link_error("【关注店铺】" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "exception"
+            invoke_result_data.error_message = "系统繁忙,请稍后再试"
+
+        self.business_process_executed()
+
+        return invoke_result_data
+
+    def process_join_member(self,app_id,act_id,module_id,user_id,login_token,handler_name,request_code,check_user_nick=True,continue_request_expire=5,is_stat=True,info_json=None):
+        """
+        :description: 处理加入店铺会员,有任务给奖励，没有则直接加入
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param user_id:用户标识
+        :param login_token:访问令牌
+        :param handler_name:接口名称
+        :param request_code:请求代码
+        :param check_user_nick:是否校验昵称为空
+        :param continue_request_expire:连续请求过期时间，为0不进行校验，单位秒
+        :param is_stat:是否统计上报
+        :param info_json:资产日志详细信息
+        :return 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        acquire_lock_name = f"process_join_member:{act_id}_{module_id}_{user_id}"
+        task_type = TaskType.join_member.value
+        now_day = TimeExHelper.get_now_day_int()
+        now_datetime = TimeHelper.get_now_format_time()
+        stat_base_model = StatBaseModel(context=self.context)
+        if not info_json:
+            info_json = {}
+        try:
+            invoke_result_data = self.business_process_executing(app_id,act_id,module_id,user_id,login_token,handler_name,False,check_user_nick,continue_request_expire,acquire_lock_name)
+            if invoke_result_data.success == True:
+                act_info_dict = invoke_result_data.data["act_info_dict"]
+                user_info_dict = invoke_result_data.data["user_info_dict"]
+
+                if user_info_dict["is_member_before"] == 0:
+                    #新增入会用户数
+                    if is_stat == True:
+                        stat_base_model.add_stat(app_id, act_id, module_id, user_info_dict["user_id"], user_info_dict["open_id"], "AddMemberUserCount",1)
+                is_limit = False
+                task_count_model = TaskCountModel(sub_table=self.get_business_sub_table("task_count_tb",{"app_id":app_id}),context=self.context)
+                task_count_id_md5 = self._get_task_count_id_md5(act_id,module_id,task_type,"",user_id)
+                task_count = task_count_model.get_entity("id_md5=%s",params=[task_count_id_md5])
+                task_count = task_count if task_count else TaskCount()
+                if module_id:
+                    is_limit = True if task_count.complete_count >= 1 else False
+                else:
+                    is_limit = True if task_count.complete_count >= 1 or user_info_dict["is_member"] == 1 else False
+                if is_limit == True:
+                    invoke_result_data.success = False
+                    invoke_result_data.error_code = "error"
+                    invoke_result_data.error_message = "已经完成入会任务"
+                else:
+                    user_info_model = UserInfoModel(sub_table=self.get_business_sub_table("user_info_tb",{"app_id":app_id}),context=self.context)
+                    user_info_model.update_table("is_member=1","id=%s",params=[user_info_dict["id"]])
+                    UserBaseModel(context=self.context)._delete_user_info_cache(user_info_dict["act_id"],user_info_dict["id_md5"])
+                    reward_value = 0
+                    reward_object_id = ""
+                    task_invoke_result_data = self.check_task_info(act_id,module_id,task_type)
+                    if task_invoke_result_data.success == True:
+                        task_info_dict = task_invoke_result_data.data
+                        config_json = task_info_dict["config_json"]
+                        reward_value = int(config_json["reward_value"]) if config_json.__contains__("reward_value") else 0
+                        once_member_reward = int(config_json["once_member_reward"]) if config_json.__contains__("once_member_reward") else 1
+                        asset_object_id = config_json["asset_object_id"] if config_json.__contains__("asset_object_id") else ""
+
+                        task_count.id_md5 = task_count_id_md5
+                        task_count.app_id = app_id
+                        task_count.act_id = act_id
+                        task_count.module_id = module_id
+                        task_count.user_id = user_id
+                        task_count.open_id = user_info_dict["open_id"]
+                        task_count.task_type = task_type
+                        task_count.task_sub_type = ""
+                        task_count.complete_count = task_count.complete_count+1
+                        task_count.now_count = 0
+                        task_count.create_date = now_datetime
+                        task_count.modify_date = now_datetime
+                        task_count.modify_day = now_day
+                        task_count_model.add_update_entity(task_count,"complete_count=%s,modify_date=%s,modify_day=%s",params=[task_count.complete_count,task_count.modify_date,now_day])
+
+                        if user_info_dict["is_member_before"] == 1 and once_member_reward == 0: #判断已经入会是否给奖励
+                            reward_value = 0
+                        if reward_value > 0:
+                            only_id = self.get_only_id(user_id,task_info_dict["complete_type"],task_type)
+                            if module_id > 0:
+                                only_id = f"{module_id}_{only_id}"
+                            asset_type = self.get_task_asset_type(act_info_dict["task_asset_type_json"],task_type)
+                            reward_object_id = asset_type
+                            asset_base_model = AssetBaseModel(context=self.context)
+                            asset_invoke_result_data = asset_base_model.update_user_asset(app_id,act_id,module_id,user_id,user_info_dict["open_id"],user_info_dict["user_nick"],asset_type,reward_value,asset_object_id,2,task_type,task_info_dict["task_name"],task_info_dict["task_name"],only_id,handler_name,request_code,info_json=info_json)
+                            if asset_invoke_result_data.success == False:
+                                reward_value = 0
+                    invoke_result_data.data["reward_value"] = reward_value
+                    self.add_task_stat(task_type, app_id, act_id, module_id, user_info_dict["user_id"], user_info_dict["open_id"], reward_value, is_stat)
+                    self.add_task_log(task_type=task_type, task_sub_type='', app_id=app_id, act_id=act_id, module_id=module_id, user_id=user_info_dict["user_id"], open_id=user_info_dict["open_id"], user_nick=user_info_dict["user_nick"],task_name=task_info_dict["task_name"],log_title=task_info_dict["task_name"],reward_type=1, reward_object_id=reward_object_id, reward_name="", reward_num=reward_value, handler_name=handler_name, request_code=request_code, info_json=info_json)
+        except Exception as ex:
+            if self.context:
+                self.context.logging_link_error("【加入店铺会员】" + traceback.format_exc())
+            elif self.logging_link_error:
+                self.logging_link_error("【加入店铺会员】" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "exception"
+            invoke_result_data.error_message = "系统繁忙,请稍后再试"
+
+        self.business_process_executed()
+
+        return invoke_result_data
+
+    def process_browse_site(self,app_id,act_id,module_id,user_id,login_token,task_type,task_sub_type,handler_name,check_user_nick=True,continue_request_expire=5):
+        """
+        :description: 处理浏览网址任务
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param user_id:用户标识
+        :param login_token:访问令牌
+        :param task_type:任务类型
+        :param task_sub_type:子任务类型
+        :param handler_name:接口名称
+        :param check_user_nick:是否校验昵称为空
+        :param continue_request_expire:连续请求过期时间，为0不进行校验，单位秒
+        :return 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        acquire_lock_name = f"process_browse_site:{act_id}_{module_id}_{user_id}_{task_type}"
+        now_day = TimeExHelper.get_now_day_int()
+        now_datetime = TimeHelper.get_now_format_time()
+        try:
+            invoke_result_data = self.business_process_executing(app_id,act_id,module_id,user_id,login_token,handler_name,False,check_user_nick,continue_request_expire,acquire_lock_name)
+            if invoke_result_data.success == True:
+                act_info_dict = invoke_result_data.data["act_info_dict"]
+                act_module_dict = invoke_result_data.data["act_module_dict"]
+                user_info_dict = invoke_result_data.data["user_info_dict"]
+
+                task_invoke_result_data = self.check_task_info(act_id,module_id,task_type)
+                if task_invoke_result_data.success == True:
+                    task_info_dict = task_invoke_result_data.data
+                    sub_config_json = [sub_config_json for sub_config_json in task_info_dict["config_json"] if task_sub_type == sub_config_json["id"]]
+                    if sub_config_json:
+                        limit_num = int(sub_config_json["limit_num"]) if sub_config_json.__contains__("limit_num") else 1
+                        satisfy_num = int(sub_config_json["satisfy_num"]) if sub_config_json.__contains__("satisfy_num") else 1
+                        task_count_model = TaskCountModel(sub_table=self.get_business_sub_table("task_count_tb",{"app_id":app_id}),context=self.context)
+                        task_count_id_md5 = self._get_task_count_id_md5(act_id,module_id,task_info_dict["task_type"],task_sub_type,user_id)
+                        task_count = task_count_model.get_entity("id_md5=%s",params=[task_count_id_md5])
+                        task_count = TaskCount() if not task_count else task_count
+                        limit_meaasge = ""
+                        if task_info_dict["complete_type"] == 1:
+                            limit_meaasge = "今日浏览上限"
+                            if task_count.modify_day != now_day:
+                                task_count.complete_count = 0
+                                task_count.now_count = 0
+                        elif task_info_dict["complete_type"] == 2:
+                            limit_meaasge = "每周浏览上限"
+                            if TimeHelper.is_this_week(task_count.modify_date) == False:
+                                task_count.complete_count = 0
+                                task_count.now_count = 0
+                        else:
+                            limit_meaasge = "浏览上限"
+
+                        count = int(task_count.complete_count * satisfy_num) + task_count.now_count
+                        is_limit = True if count >= (limit_num * satisfy_num) else False
+                        if is_limit == True:
+                            invoke_result_data.success = False
+                            invoke_result_data.error_code = "error"
+                            invoke_result_data.error_message = limit_meaasge
+                        else:
+                            task_count.id_md5 = task_count_id_md5
+                            task_count.app_id = app_id
+                            task_count.act_id = act_id
+                            task_count.module_id = module_id
+                            task_count.user_id = user_id
+                            task_count.open_id = user_info_dict["open_id"]
+                            task_count.task_type = task_type
+                            task_count.task_sub_type = task_sub_type
+                            task_count.now_count = task_count.now_count + 1
+                            task_count.create_date = now_datetime
+                            task_count.modify_date = now_datetime
+                            task_count.modify_day = now_day
+                            task_count_model.add_update_entity(task_count,"complete_count=%s,now_count=%s,modify_date=%s,modify_day=%s",params=[task_count.complete_count, task_count.now_count, task_count.modify_date, now_day])
+                    else:
+                        invoke_result_data.success = False
+                        invoke_result_data.error_code = "error"
+                        invoke_result_data.error_message = "子任务不存在"
+                else:
+                    invoke_result_data.success = False
+                    invoke_result_data.error_code = task_invoke_result_data.error_code
+                    invoke_result_data.error_message = task_invoke_result_data.error_message
+
+        except Exception as ex:
+            if self.context:
+                self.context.logging_link_error("【浏览网址任务】" + traceback.format_exc())
+            elif self.logging_link_error:
+                self.logging_link_error("【浏览网址任务】" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "exception"
+            invoke_result_data.error_message = "系统繁忙,请稍后再试"
+
+        self.business_process_executed()
+
+        return invoke_result_data
+
+    def process_share(self,app_id,act_id,module_id,user_id,login_token,handler_name,check_new_user=False,check_user_nick=True,continue_request_expire=5):
+        """
+        :description: 处理分享奖励任务
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param user_id:用户标识
+        :param login_token:访问令牌
+        :param handler_name:接口名称
+        :param check_new_user:是否新用户才能领取 1是0否
+        :param check_user_nick:是否校验昵称为空
+        :param continue_request_expire:连续请求过期时间，为0不进行校验，单位秒
+        :return 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        acquire_lock_name = f"process_share:{act_id}_{module_id}_{user_id}"
+        task_type = TaskType.share.value
+        now_day = TimeExHelper.get_now_day_int()
+        now_datetime = TimeHelper.get_now_format_time()
+        try:
+            invoke_result_data = self.business_process_executing(app_id,act_id,module_id,user_id,login_token,handler_name,check_new_user,check_user_nick,continue_request_expire,acquire_lock_name)
+            if invoke_result_data.success == True:
+                task_invoke_result_data = self.check_task_info(act_id,module_id,task_type)
+                if task_invoke_result_data.success == True:
+                    task_info_dict = task_invoke_result_data.data
+                    config_json = task_info_dict["config_json"]
+                    limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
+                    user_info_dict = invoke_result_data.data["user_info_dict"]
+                    task_count_model = TaskCountModel(sub_table=self.get_business_sub_table("task_count_tb",{"app_id":app_id}),context=self.context)
+                    task_count_id_md5 = self._get_task_count_id_md5(act_id,module_id,task_info_dict["task_type"],"",user_id)
+                    task_count = task_count_model.get_entity("id_md5=%s",params=[task_count_id_md5])
+                    task_count = TaskCount() if not task_count else task_count
+                    limit_meaasge = ""
+                    if task_info_dict["complete_type"] == 1:
+                        limit_meaasge = "今日领取上限"
+                        if task_count.modify_day != now_day:
+                            task_count.complete_count = 0
+                            task_count.now_count = 0
+                    elif task_info_dict["complete_type"] == 2:
+                        limit_meaasge = "每周领取上限"
+                        if TimeHelper.is_this_week(task_count.modify_date) == False:
+                            task_count.complete_count = 0
+                            task_count.now_count = 0
+                    else:
+                        limit_meaasge = "领取上限"
+                    is_limit = True if task_count.complete_count >= limit_num else False
+                    if is_limit == True:
+                        invoke_result_data.success = False
+                        invoke_result_data.error_code = "error"
+                        invoke_result_data.error_message = limit_meaasge
+                    else:
+                        task_count.id_md5 = task_count_id_md5
+                        task_count.app_id = app_id
+                        task_count.act_id = act_id
+                        task_count.module_id = module_id
+                        task_count.user_id = user_id
+                        task_count.open_id = user_info_dict["open_id"]
+                        task_count.task_type = task_type
+                        task_count.task_sub_type = ""
+                        task_count.now_count = task_count.now_count + 1
+                        task_count.create_date = now_datetime
+                        task_count.modify_date = now_datetime
+                        task_count.modify_day = now_day
+                        task_count_model.add_update_entity(task_count,"complete_count=%s,now_count=%s,modify_date=%s,modify_day=%s",params=[task_count.complete_count,task_count.now_count,task_count.modify_date,now_day])
+                else:
+                    invoke_result_data.success = False
+                    invoke_result_data.error_code = task_invoke_result_data.error_code
+                    invoke_result_data.error_message = task_invoke_result_data.error_message
+        except Exception as ex:
+            if self.context:
+                self.context.logging_link_error("【分享任务】" + traceback.format_exc())
+            elif self.logging_link_error:
+                self.logging_link_error("【分享任务】" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "exception"
+            invoke_result_data.error_message = "系统繁忙,请稍后再试"
+
+        self.business_process_executed()
+
+        return invoke_result_data
+
+    def process_invite_user_help(self,app_id,act_id,module_id,user_id,login_token,from_user_id,handler_name,check_new_user=False,check_user_nick=True,continue_request_expire=5,check_act_info_release=True,check_act_module_release=True):
+        """
+        :description: 处理邀请用户助力
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param user_id:当前用户标识
+        :param login_token:访问令牌
+        :param from_user_id:邀请人用户标识
+        :param handler_name:接口名称
+        :param check_new_user:是否新用户才能领取 1是0否
+        :param check_user_nick:是否校验昵称为空
+        :param continue_request_expire:连续请求过期时间，为0不进行校验，单位秒
+        :param check_act_info_release:校验活动信息是否发布
+        :param check_act_module_release:校验活动模块是否发布
+        :return 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        acquire_lock_name = f"process_invite_user_help:{act_id}_{module_id}_{user_id}"
+        task_type = TaskType.invite_user_help.value
+        now_day = TimeExHelper.get_now_day_int()
+        now_datetime = TimeHelper.get_now_format_time()
+        try:
+            invoke_result_data = InvokeResultData()
+            if user_id == from_user_id:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "error"
+                invoke_result_data.error_message = "无效邀请"
+                return invoke_result_data
+
+            invoke_result_data = self.business_process_executing(app_id,act_id,module_id,user_id,login_token,handler_name,check_new_user,check_user_nick,continue_request_expire,acquire_lock_name,check_act_info_release=check_act_info_release,check_act_module_release=check_act_module_release)
+            if invoke_result_data.success == True:
+                user_info_dict = invoke_result_data.data["user_info_dict"]
+
+                user_base_model = UserBaseModel(context=self.context)
+                from_user_info_dict = user_base_model.get_user_info_dict(app_id,act_id,from_user_id)
+                invite_help_model = InviteHelpModel(context=self.context)
+                help_type = 1
+                help_object_id = ''
+                help_id_md5 = CryptoHelper.md5_encrypt_int(f"{app_id}_{act_id}_{module_id}_{help_type}_{help_object_id}")
+                invite_help_dict = invite_help_model.get_dict("id_md5=%s and user_id=%s and invited_user_id=%s", params=[help_id_md5, from_user_id, user_id])
+                if invite_help_dict:
+                    invoke_result_data.success = False
+                    invoke_result_data.error_code = "error"
+                    invoke_result_data.error_message = "此用户已经被邀请过"
+                elif not from_user_info_dict:
+                    invoke_result_data.success = False
+                    invoke_result_data.error_code = "error"
+                    invoke_result_data.error_message = "邀请人不存在"
+                else:
+                    task_invoke_result_data = self.check_task_info(act_id,module_id,task_type)
+                    if task_invoke_result_data.success == True:
+                        task_info_dict = task_invoke_result_data.data
+                        config_json = task_info_dict["config_json"]
+                        limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
+                        satisfy_num = int(config_json["satisfy_num"]) if config_json.__contains__("satisfy_num") else 1
+                        task_count_model = TaskCountModel(sub_table=self.get_business_sub_table("task_count_tb",{"app_id":app_id}),context=self.context)
+                        task_count_id_md5 = self._get_task_count_id_md5(act_id,module_id,task_info_dict["task_type"],"",from_user_id)
+                        task_count = task_count_model.get_entity("id_md5=%s",params=[task_count_id_md5])
+                        task_count = TaskCount() if not task_count else task_count
+                        limit_meaasge = ""
+                        if task_info_dict["complete_type"] == 1:
+                            limit_meaasge = "今日邀请上限"
+                            if task_count.modify_day != now_day:
+                                task_count.complete_count = 0
+                                task_count.now_count = 0
+                        elif task_info_dict["complete_type"] == 2:
+                            limit_meaasge = "每周邀请上限"
+                            if TimeHelper.is_this_week(task_count.modify_date) == False:
+                                task_count.complete_count = 0
+                                task_count.now_count = 0
+                        else:
+                            limit_meaasge = "邀请上限"
+                        invite_count = int(task_count.complete_count * satisfy_num) + task_count.now_count
+                        is_invite_limit = True if invite_count >= limit_num else False
+                        if is_invite_limit == True:
+                            invoke_result_data.success = False
+                            invoke_result_data.error_code = "error"
+                            invoke_result_data.error_message = limit_meaasge
+                        else:
+                            invite_help = InviteHelp()
+                            invite_help.id_md5 = help_id_md5
+                            invite_help.app_id = app_id
+                            invite_help.act_id = act_id
+                            invite_help.module_id = module_id
+                            invite_help.help_type = 1
+                            invite_help.object_id = ''
+                            invite_help.user_id = from_user_id
+                            invite_help.open_id = from_user_info_dict["open_id"]
+                            invite_help.invited_user_id = user_info_dict["user_id"]
+                            invite_help.invited_open_id = user_info_dict["open_id"]
+                            invite_help.invited_user_nick = user_info_dict["user_nick"]
+                            invite_help.invited_avatar = user_info_dict["avatar"]
+                            invite_help.is_handle = 0
+                            invite_help.create_date = now_datetime
+                            invite_help.create_day = now_day
+                            invite_help_model.add_entity(invite_help)
+
+                            task_count.id_md5 = task_count_id_md5
+                            task_count.app_id = app_id
+                            task_count.act_id = act_id
+                            task_count.module_id = module_id
+                            task_count.user_id = from_user_id
+                            task_count.open_id = from_user_info_dict["open_id"]
+                            task_count.task_type = task_type
+                            task_count.task_sub_type = ""
+                            task_count.now_count = task_count.now_count + 1
+                            task_count.create_date = now_datetime
+                            task_count.modify_date = now_datetime
+                            task_count.modify_day = now_day
+                            task_count_model.add_update_entity(task_count,"complete_count=%s,now_count=%s,modify_date=%s,modify_day=%s",params=[task_count.complete_count,task_count.now_count,task_count.modify_date,now_day])
+                            invite_help_model.delete_dependency_key(DependencyKey.invite_user_help_list(help_id_md5,from_user_id))
+                    else:
+                        invoke_result_data.success = False
+                        invoke_result_data.error_code = task_invoke_result_data.error_code
+                        invoke_result_data.error_message = task_invoke_result_data.error_message
+
+        except Exception as ex:
+            if self.context:
+                self.context.logging_link_error("【邀请用户助力任务】" + traceback.format_exc())
+            elif self.logging_link_error:
+                self.logging_link_error("【邀请用户助力任务】" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "exception"
+            invoke_result_data.error_message = "系统繁忙,请稍后再试"
+
+        self.business_process_executed()
+
+        return invoke_result_data
+
+    def process_secret_code(self,app_id,act_id,module_id,user_id,login_token,handler_name,request_code,secret_code,check_new_user=False,check_user_nick=True,continue_request_expire=5,is_stat=True,info_json=None):
+        """
+        :description: 处理神秘暗号任务
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param user_id:用户标识
+        :param login_token:访问令牌
+        :param handler_name:接口名称
+        :param request_code:请求代码
+        :param secret_code:暗号
+        :param check_new_user:是否新用户才能领取 1是0否
+        :param check_user_nick:是否校验昵称为空
+        :param continue_request_expire:连续请求过期时间，为0不进行校验，单位秒
+        :param is_stat:是否统计上报
+        :param info_json:资产日志详细信息
+        :return 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        acquire_lock_name = f"process_secret_code:{act_id}_{module_id}_{user_id}"
+        task_type = TaskType.secret_code.value
+        now_day = TimeExHelper.get_now_day_int()
+        now_datetime = TimeHelper.get_now_format_time()
+        if not info_json:
+            info_json = {}
+        try:
+            invoke_result_data = self.business_process_executing(app_id,act_id,module_id,user_id,login_token,handler_name,check_new_user,check_user_nick,continue_request_expire,acquire_lock_name)
+            if invoke_result_data.success == True:
+                task_invoke_result_data = self.check_task_info(act_id,module_id,task_type)
+                if task_invoke_result_data.success == True:
+                    task_info_dict = task_invoke_result_data.data
+                    config_json = task_info_dict["config_json"]
+                    reward_value = int(config_json["reward_value"]) if config_json.__contains__("reward_value") else 0
+                    asset_object_id = config_json["asset_object_id"] if config_json.__contains__("asset_object_id") else ""
+                    limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
+                    cur_secret_code = config_json["secret_code"] if config_json.__contains__("secret_code") else ''
+                    act_info_dict = invoke_result_data.data["act_info_dict"]
+                    user_info_dict = invoke_result_data.data["user_info_dict"]
+                    task_count_model = TaskCountModel(sub_table=self.get_business_sub_table("task_count_tb",{"app_id":app_id}),context=self.context)
+                    task_count_id_md5 = self._get_task_count_id_md5(act_id,module_id,task_info_dict["task_type"],"",user_id)
+                    task_count = task_count_model.get_entity("id_md5=%s",params=[task_count_id_md5])
+                    task_count = TaskCount() if not task_count else task_count
+                    limit_meaasge = ""
+
+                    if task_info_dict["complete_type"] == 1:
+                        limit_meaasge = "今日领取上限"
+                        if task_count.modify_day != now_day:
+                            task_count.complete_count = 0
+                            task_count.now_count = 0
+                    elif task_info_dict["complete_type"] == 2:
+                        limit_meaasge = "每周领取上限"
+                        if TimeHelper.is_this_week(task_count.modify_date) == False:
+                            task_count.complete_count = 0
+                            task_count.now_count = 0
+                    else:
+                        limit_meaasge = "领取上限"
+                    is_limit = True if task_count.complete_count >= limit_num else False
+                    if is_limit == True:
+                        invoke_result_data.success = False
+                        invoke_result_data.error_code = "error"
+                        invoke_result_data.error_message = limit_meaasge
+                    elif cur_secret_code != secret_code:
+                        invoke_result_data.success = False
+                        invoke_result_data.error_code = "error"
+                        invoke_result_data.error_message = "暗号不正确"
+                    else:
+                        task_count.id_md5 = task_count_id_md5
+                        task_count.app_id = app_id
+                        task_count.act_id = act_id
+                        task_count.module_id = module_id
+                        task_count.user_id = user_id
+                        task_count.open_id = user_info_dict["open_id"]
+                        task_count.task_type = task_type
+                        task_count.task_sub_type = ""
+                        task_count.complete_count = task_count.complete_count+1
+                        task_count.now_count = 0
+                        task_count.create_date = now_datetime
+                        task_count.modify_date = now_datetime
+                        task_count.modify_day = now_day
+                        task_count_model.add_update_entity(task_count,"complete_count=%s,modify_date=%s,modify_day=%s",params=[task_count.complete_count,task_count.modify_date,now_day])
+                        reward_object_id = ""
+                        if reward_value > 0:
+                            only_id = self.get_only_id(user_id,task_info_dict["complete_type"],task_type,complete_count=task_count.complete_count)
+                            if module_id > 0:
+                                only_id = f"{module_id}_{only_id}"
+                            asset_type = self.get_task_asset_type(act_info_dict["task_asset_type_json"],task_type)
+                            reward_object_id = asset_type
+                            asset_base_model = AssetBaseModel(context=self.context)
+                            asset_invoke_result_data = asset_base_model.update_user_asset(app_id,act_id,module_id,user_id,user_info_dict["open_id"],user_info_dict["user_nick"],asset_type,reward_value,asset_object_id,2,task_type,task_info_dict["task_name"],task_info_dict["task_name"],only_id,handler_name,request_code,info_json=info_json)
+                            if asset_invoke_result_data.success == False:
+                                reward_value = 0
+                        invoke_result_data.data["reward_value"] = reward_value
+                        self.add_task_stat(task_type, app_id, act_id, module_id, user_info_dict["user_id"], user_info_dict["open_id"], reward_value, is_stat)
+                        self.add_task_log(task_type=task_type, task_sub_type='', app_id=app_id, act_id=act_id, module_id=module_id, user_id=user_info_dict["user_id"], open_id=user_info_dict["open_id"], user_nick=user_info_dict["user_nick"],task_name=task_info_dict["task_name"],log_title=task_info_dict["task_name"],reward_type=1, reward_object_id=reward_object_id, reward_name="", reward_num=reward_value, handler_name=handler_name, request_code=request_code, info_json=info_json)
+
+                else:
+                    invoke_result_data.success = False
+                    invoke_result_data.error_code = task_invoke_result_data.error_code
+                    invoke_result_data.error_message = task_invoke_result_data.error_message
+        except Exception as ex:
+            if self.context:
+                self.context.logging_link_error("【神秘暗号任务】" + traceback.format_exc())
+            elif self.logging_link_error:
+                self.logging_link_error("【神秘暗号任务】" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "exception"
+            invoke_result_data.error_message = "系统繁忙,请稍后再试"
+
+        self.business_process_executed()
+
+        return invoke_result_data
+
+    def process_crm_point_exchange_asset(self,app_id,act_id,module_id,user_id,login_token,handler_name,request_code,mix_nick,access_token,app_key,app_secret,check_new_user=False,check_user_nick=True,continue_request_expire=5,is_stat=True,info_json=None):
+        """
+        :description: 处理店铺会员积分兑换资产
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param user_id:用户标识
+        :param login_token:访问令牌
+        :param handler_name:接口名称
+        :param request_code:请求代码
+        :param mix_nick:mix_nick
+        :param access_token:access_token
+        :param app_key:app_key
+        :param app_secret:app_secret
+        :param check_new_user:是否新用户才能领取 1是0否
+        :param check_user_nick:是否校验昵称为空
+        :param continue_request_expire:连续请求过期时间，为0不进行校验，单位秒
+        :param is_stat:是否统计上报
+        :param info_json:资产日志详细信息
+        :return 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        acquire_lock_name = f"process_crm_point_exchange_asset:{act_id}_{module_id}_{user_id}"
+
+        task_type = TaskType.crm_point_exchange_asset.value
+        now_day = TimeExHelper.get_now_day_int()
+        now_datetime = TimeHelper.get_now_format_time()
+        if not info_json:
+            info_json = {}
+        try:
+            invoke_result_data = self.business_process_executing(app_id,act_id,module_id,user_id,login_token,handler_name,check_new_user,check_user_nick,continue_request_expire,acquire_lock_name)
+            if invoke_result_data.success == True:
+                task_invoke_result_data = self.check_task_info(act_id,module_id,task_type)
+                if task_invoke_result_data.success == True:
+                    task_info_dict = task_invoke_result_data.data
+                    config_json = task_info_dict["config_json"]
+                    reward_value = int(config_json["reward_value"]) if config_json.__contains__("reward_value") else 0
+                    asset_object_id = config_json["asset_object_id"] if config_json.__contains__("asset_object_id") else ""
+                    limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
+                    need_crm_point = int(config_json["satisfy_num"]) if config_json.__contains__("satisfy_num") else 0
+                    act_info_dict = invoke_result_data.data["act_info_dict"]
+                    user_info_dict = invoke_result_data.data["user_info_dict"]
+                    task_count_model = TaskCountModel(sub_table=self.get_business_sub_table("task_count_tb",{"app_id":app_id}),context=self.context)
+                    task_count_id_md5 = self._get_task_count_id_md5(act_id,module_id,task_info_dict["task_type"],"",user_id)
+                    task_count = task_count_model.get_entity("id_md5=%s",params=[task_count_id_md5])
+                    task_count = TaskCount() if not task_count else task_count
+                    limit_meaasge = ""
+                    top_base_model = TopBaseModel(context=self.context)
+
+                    if task_info_dict["complete_type"] == 1:
+                        limit_meaasge = "今日领取上限"
+                        if task_count.modify_day != now_day:
+                            task_count.complete_count = 0
+                            task_count.now_count = 0
+                    elif task_info_dict["complete_type"] == 2:
+                        limit_meaasge = "每周领取上限"
+                        if TimeHelper.is_this_week(task_count.modify_date) == False:
+                            task_count.complete_count = 0
+                            task_count.now_count = 0
+                    else:
+                        limit_meaasge = "领取上限"
+                    is_limit = True if task_count.complete_count >= limit_num else False
+                    if is_limit == True:
+                        invoke_result_data.success = False
+                        invoke_result_data.error_code = "error"
+                        invoke_result_data.error_message = limit_meaasge
+                    elif not need_crm_point:
+                        invoke_result_data.success = False
+                        invoke_result_data.error_code = "error"
+                        invoke_result_data.error_message = "配置异常无法兑换"
+                    else:
+                        member_invoke_result_data = top_base_model.get_crm_point_available(mix_nick, access_token, app_key, app_secret, user_info_dict["open_id"])
+                        if member_invoke_result_data.success == False:
+                            invoke_result_data.success = False
+                            invoke_result_data.error_code = "member_error"
+                            invoke_result_data.error_message = "获取会员积分失败"
+                        elif member_invoke_result_data.data < need_crm_point:
+                            invoke_result_data.success = False
+                            invoke_result_data.error_code = "member_error"
+                            invoke_result_data.error_message = f"会员积分不足，当前只有{member_invoke_result_data.data}积分"
+                        else:
+                            invoke_result_data.data["need_crm_point"] = need_crm_point
+
+                            task_count.id_md5 = task_count_id_md5
+                            task_count.app_id = app_id
+                            task_count.act_id = act_id
+                            task_count.module_id = module_id
+                            task_count.user_id = user_id
+                            task_count.open_id = user_info_dict["open_id"]
+                            task_count.task_type = task_type
+                            task_count.task_sub_type = ""
+                            task_count.complete_count = task_count.complete_count+1
+                            task_count.now_count = 0
+                            task_count.create_date = now_datetime
+                            task_count.modify_date = now_datetime
+                            task_count.modify_day = now_day
+                            task_count_model.add_update_entity(task_count,"complete_count=%s,modify_date=%s,modify_day=%s",params=[task_count.complete_count,task_count.modify_date,now_day])
+                            reward_object_id = ""
+                            if reward_value > 0:
+                                crm_point_invoke_result_data = top_base_model.change_crm_point(user_info_dict["open_id"], mix_nick, 1, 1, need_crm_point, access_token, app_key, app_secret, 0, "", True)
+                                if crm_point_invoke_result_data.success == True:
+                                    only_id = self.get_only_id(user_id,task_info_dict["complete_type"],task_type,complete_count=task_count.complete_count)
+                                    if module_id > 0:
+                                        only_id = f"{module_id}_{only_id}"
+                                    asset_type = self.get_task_asset_type(act_info_dict["task_asset_type_json"],task_type)
+                                    reward_object_id = asset_type
+                                    asset_base_model = AssetBaseModel(context=self.context)
+                                    asset_invoke_result_data = asset_base_model.update_user_asset(app_id,act_id,module_id,user_id,user_info_dict["open_id"],user_info_dict["user_nick"],asset_type,reward_value,asset_object_id,2,task_type,task_info_dict["task_name"],task_info_dict["task_name"],only_id,handler_name,request_code,info_json=info_json)
+                                    if asset_invoke_result_data.success == False:
+                                        reward_value = 0
+                                else:
+                                    reward_value = 0
+
+                            invoke_result_data.data["reward_value"] = reward_value
+                            self.add_task_stat(task_type, app_id, act_id, module_id, user_info_dict["user_id"], user_info_dict["open_id"], reward_value, is_stat)
+                            self.add_task_log(task_type=task_type, task_sub_type='', app_id=app_id, act_id=act_id, module_id=module_id, user_id=user_info_dict["user_id"], open_id=user_info_dict["open_id"], user_nick=user_info_dict["user_nick"],task_name=task_info_dict["task_name"],log_title=task_info_dict["task_name"],reward_type=1, reward_object_id=reward_object_id, reward_name="", reward_num=reward_value, handler_name=handler_name, request_code=request_code, info_json=info_json)
+                else:
+                    invoke_result_data.success = False
+                    invoke_result_data.error_code = task_invoke_result_data.error_code
+                    invoke_result_data.error_message = task_invoke_result_data.error_message
+        except Exception as ex:
+            if self.context:
+                self.context.logging_link_error("【店铺会员积分兑换资产任务】" + traceback.format_exc())
+            elif self.logging_link_error:
+                self.logging_link_error("【店铺会员积分兑换资产任务】" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "exception"
+            invoke_result_data.error_message = "系统繁忙,请稍后再试"
+
+        self.business_process_executed()
+
+        return invoke_result_data
+
+    def process_routine_task(self,app_id,act_id,module_id,user_id,login_token,handler_name,task_type,task_sub_type,check_new_user=False,check_user_nick=True,continue_request_expire=5):
+        """
+        :description: 处理常规任务 只计数不领取奖励
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param user_id:用户标识
+        :param login_token:访问令牌
+        :param handler_name:接口名称
+        :param task_type:任务类型
+        :param task_sub_type:子任务类型，没有传空
+        :param check_new_user:是否新用户才能领取 1是0否
+        :param check_user_nick:是否校验昵称为空
+        :param continue_request_expire:连续请求过期时间，为0不进行校验，单位秒
+        :return 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        acquire_lock_name = f"process_routine_task:{act_id}_{module_id}_{user_id}_{task_type}"
+        try:
+            invoke_result_data = self.business_process_executing(app_id,act_id,module_id,user_id,login_token,handler_name,check_new_user,check_user_nick,continue_request_expire,acquire_lock_name)
+            if invoke_result_data.success == True:
+                user_info_dict = invoke_result_data.data["user_info_dict"]
+                task_invoke_result_data = self.check_task_info(act_id,module_id,task_type)
+                if task_invoke_result_data.success == True:
+                    task_info_dict = task_invoke_result_data.data
+                    task_count_invoke_result_data = self.add_task_count(app_id, act_id, module_id, user_id, user_info_dict["open_id"], task_type, 1, task_info_dict, task_sub_type)
+                    if task_count_invoke_result_data.success == False:
+                        invoke_result_data.success = False
+                        invoke_result_data.error_code = task_count_invoke_result_data.error_code
+                        invoke_result_data.error_message = task_count_invoke_result_data.error_message
+                else:
+                    invoke_result_data.success = False
+                    invoke_result_data.error_code = task_invoke_result_data.error_code
+                    invoke_result_data.error_message = task_invoke_result_data.error_message
+        except Exception as ex:
+            if self.context:
+                self.context.logging_link_error("【通用任务】" + traceback.format_exc())
+            elif self.logging_link_error:
+                self.logging_link_error("【通用任务】" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "exception"
+            invoke_result_data.error_message = "系统繁忙,请稍后再试"
+
+        self.business_process_executed()
+
+        return invoke_result_data
+
+    def process_routine_invite_task(self,task_type,invite_sub_table,app_id,act_id,module_id,user_id,login_token,from_user_id,handler_name,check_new_user=True,check_user_nick=True,continue_request_expire=5,close_invite_limit=False):
+        """
+        :description: 处理常规邀请任务(当一个活动有多个邀请任务时，可以使用当前方法)
+        :param task_type:任务类型
+        :param invite_sub_table:分表名
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param user_id:当前用户标识
+        :param login_token:访问令牌
+        :param from_user_id:邀请人用户标识
+        :param handler_name:接口名称
+        :param check_new_user:是否校验新用户
+        :param check_user_nick:是否校验昵称为空
+        :param continue_request_expire:连续请求过期时间，为0不进行校验，单位秒
+        :param close_invite_limit:是否关闭邀请限制 True是(老用户也可以邀请成功) False否
+        :return 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        acquire_lock_name = f"process_routine_invite_task:{act_id}_{module_id}_{user_id}_{task_type}"
+        now_day = TimeExHelper.get_now_day_int()
+        now_datetime = TimeHelper.get_now_format_time()
+        try:
+            invoke_result_data = InvokeResultData()
+            if user_id == from_user_id:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "error"
+                invoke_result_data.error_message = "无效邀请"
+                return invoke_result_data
+
+            invoke_result_data = self.business_process_executing(app_id,act_id,module_id,user_id,login_token,handler_name,check_new_user,check_user_nick,continue_request_expire,acquire_lock_name)
+            if invoke_result_data.success == True:
+                user_info_dict = invoke_result_data.data["user_info_dict"]
+                user_base_model = UserBaseModel(context=self.context)
+                from_user_info_dict = user_base_model.get_user_info_dict(app_id,act_id,from_user_id)
+                invite_log_model = InviteLogModel(context=self.context,sub_table=invite_sub_table)
+                is_invite = invite_log_model.get_total("act_id=%s and invite_user_id=%s", params=[act_id, user_id])
+                if is_invite > 0:
+                    invoke_result_data.success = False
+                    invoke_result_data.error_code = "error"
+                    invoke_result_data.error_message = "此用户已经被邀请过"
+                elif not from_user_info_dict:
+                    invoke_result_data.success = False
+                    invoke_result_data.error_code = "error"
+                    invoke_result_data.error_message = "邀请人不存在"
+                else:
+                    task_invoke_result_data = self.check_task_info(act_id,module_id,task_type)
+                    if task_invoke_result_data.success == True:
+                        task_info_dict = task_invoke_result_data.data
+                        config_json = task_info_dict["config_json"]
+                        limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
+                        satisfy_num = int(config_json["satisfy_num"]) if config_json.__contains__("satisfy_num") else 1
+                        task_count_model = TaskCountModel(sub_table=self.get_business_sub_table("task_count_tb",{"app_id":app_id}),context=self.context)
+                        task_count_id_md5 = self._get_task_count_id_md5(act_id,module_id,task_info_dict["task_type"],"",from_user_id)
+                        task_count = task_count_model.get_entity("id_md5=%s",params=[task_count_id_md5])
+                        task_count = TaskCount() if not task_count else task_count
+                        limit_meaasge = ""
+                        if task_info_dict["complete_type"] == TaskCompleteType.day.value:
+                            limit_meaasge = "今日邀请上限"
+                            if task_count.modify_day != now_day:
+                                task_count.complete_count = 0
+                                task_count.now_count = 0
+                        elif task_info_dict["complete_type"] == TaskCompleteType.week.value:
+                            limit_meaasge = "每周邀请上限"
+                            if TimeHelper.is_this_week(task_count.modify_date) == False:
+                                task_count.complete_count = 0
+                                task_count.now_count = 0
+                        elif task_info_dict["complete_type"] == TaskCompleteType.month.value:
+                            limit_meaasge = "每月邀请上限"
+                            if TimeHelper.is_this_month(task_count.modify_date) == False:
+                                task_count.complete_count = 0
+                                task_count.now_count = 0
+                        else:
+                            limit_meaasge = "邀请上限"
+                        invite_count = int(task_count.complete_count * satisfy_num) + task_count.now_count
+                        is_invite_limit = True if invite_count >= limit_num else False
+                        if is_invite_limit == True and close_invite_limit == False:
+                            invoke_result_data.success = False
+                            invoke_result_data.error_code = "error"
+                            invoke_result_data.error_message = limit_meaasge
+                        else:
+
+                            invite_log = InviteLog()
+                            invite_log.app_id = app_id
+                            invite_log.act_id = act_id
+                            invite_log.user_id = from_user_id
+                            invite_log.open_id = from_user_info_dict["open_id"]
+                            invite_log.invite_user_id = user_info_dict["user_id"]
+                            invite_log.invite_open_id = user_info_dict["open_id"]
+                            invite_log.invite_user_nick = user_info_dict["user_nick"]
+                            invite_log.invite_avatar = user_info_dict["avatar"]
+                            invite_log.is_handle = 0
+                            invite_log.create_date = now_datetime
+                            invite_log.create_day = now_day
+                            invite_log_model.add_entity(invite_log)
+
+                            task_count.id_md5 = task_count_id_md5
+                            task_count.app_id = app_id
+                            task_count.act_id = act_id
+                            task_count.module_id = module_id
+                            task_count.user_id = from_user_id
+                            task_count.open_id = from_user_info_dict["open_id"]
+                            task_count.task_type = task_type
+                            task_count.task_sub_type = ""
+                            task_count.now_count = task_count.now_count + 1
+                            task_count.create_date = now_datetime
+                            task_count.modify_date = now_datetime
+                            task_count.modify_day = now_day
+                            task_count_model.add_update_entity(task_count,"complete_count=%s,now_count=%s,modify_date=%s,modify_day=%s",params=[task_count.complete_count,task_count.now_count,task_count.modify_date,now_day])
+                    else:
+                        invoke_result_data.success = False
+                        invoke_result_data.error_code = task_invoke_result_data.error_code
+                        invoke_result_data.error_message = task_invoke_result_data.error_message
+
+        except Exception as ex:
+            if self.context:
+                self.context.logging_link_error("【处理常规邀请任务】" + traceback.format_exc())
+            elif self.logging_link_error:
+                self.logging_link_error("【处理常规邀请任务】" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "exception"
+            invoke_result_data.error_message = "系统繁忙,请稍后再试"
+
+        self.business_process_executed()
+
+        return invoke_result_data
+
+    def process_buy_appoint_goods_task(self,app_id,act_id,module_id,user_id,login_token,handler_name,order_data=[],app_key="",app_secret="",is_log=False,check_user_nick=True,continue_request_expire=5,is_stat=True,support_presale_order=False):
+        """
+        :description: 购买指定商品任务
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param user_id:用户标识
+        :param login_token:访问令牌
+        :param handler_name:接口名称
+        :param order_data:订单数据
+        :param app_key:app_key
+        :param app_secret:app_secret
+        :param is_log:是否记录top请求日志
+        :param check_user_nick:是否校验昵称为空
+        :param continue_request_expire:连续请求过期时间，为0不进行校验，单位秒
+        :param is_stat:是否统计上报
+        :param support_presale_order:是否支持预售订单
+        :return 
+        :last_editors: HuangJianYi
+        """
+        task_type = TaskType.buy_appoint_goods.value
+        acquire_lock_name = f"process_buy_appoint_goods_task:{act_id}_{module_id}_{user_id}"
+        now_day = TimeExHelper.get_now_day_int()
+        now_datetime = TimeHelper.get_now_format_time()
+        try:
+            invoke_result_data = self.business_process_executing(app_id,act_id,module_id,user_id,login_token,handler_name,False,check_user_nick,continue_request_expire,acquire_lock_name)
+            if invoke_result_data.success == True:
+                task_invoke_result_data = self.check_task_info(act_id,module_id,task_type)
+                if task_invoke_result_data.success == True:
+                    task_info_dict = task_invoke_result_data.data
+                    config_json = task_info_dict["config_json"]
+                    act_info_dict = invoke_result_data.data["act_info_dict"]
+                    act_module_dict = invoke_result_data.data["act_module_dict"]
+                    user_info_dict = invoke_result_data.data["user_info_dict"]
+                    goods_ids_list = list(set(str(config_json["goods_ids"]).split(','))) if config_json.__contains__("goods_ids") else []
+                    limit_num = int(config_json["limit_num"]) if config_json.__contains__("limit_num") else 1
+                    satisfy_num = int(config_json["satisfy_num"]) if config_json.__contains__("satisfy_num") else 1
+                    task_count_model = TaskCountModel(sub_table=self.get_business_sub_table("task_count_tb",{"app_id":app_id}),context=self.context)
+                    task_count_id_md5 = self._get_task_count_id_md5(act_id,module_id,task_info_dict["task_type"],"",user_id)
+                    task_count = task_count_model.get_entity("id_md5=%s",params=[task_count_id_md5])
+                    task_count = TaskCount() if not task_count else task_count
+                    limit_meaasge = ""
+                    if task_info_dict["complete_type"] == 1:
+                        limit_meaasge = "今日购买上限"
+                        if task_count.modify_day != now_day:
+                            task_count.complete_count = 0
+                            task_count.now_count = 0
+                            task_count.remark = ""
+                    elif task_info_dict["complete_type"] == 2:
+                        limit_meaasge = "每周购买上限"
+                        if TimeHelper.is_this_week(task_count.modify_date) == False:
+                            task_count.complete_count = 0
+                            task_count.now_count = 0
+                            task_count.remark = ""
+                    else:
+                        limit_meaasge = "购买上限"
+                    buy_count = int(task_count.complete_count * satisfy_num) + task_count.now_count
+                    is_buy_limit = True if buy_count >= (limit_num * satisfy_num) else False
+                    if is_buy_limit == True:
+                        invoke_result_data.success = False
+                        invoke_result_data.error_code = "error"
+                        invoke_result_data.error_message = limit_meaasge
+                    else:
+                        app_info_dict = AppBaseModel(context=self.context).get_app_info_dict(app_id=app_id,is_cache=True,field="access_token")
+                        access_token = app_info_dict["access_token"] if app_info_dict else ""
+                        top_base_model = TopBaseModel(context=self.context)
+                        if len(order_data) <= 0:
+                            start_date = act_info_dict['start_date']
+                            start_date = act_module_dict['start_date'] if act_module_dict and act_module_dict['start_date'] else start_date
+                            if start_date and start_date != '1900-01-01 00:00:00':
+                                invoke_result_data = top_base_model.get_buy_order_list(user_info_dict["open_id"], access_token, app_key, app_secret, start_date, is_log=is_log)
+                                if invoke_result_data.success == True:
+                                    order_data = invoke_result_data.data
+                            else:
+                                invoke_result_data = top_base_model.get_buy_order_list(user_info_dict["open_id"], access_token, app_key, app_secret, is_log=is_log)
+                                if invoke_result_data.success == True:
+                                    order_data = invoke_result_data.data
+                        if len(order_data) > 0:
+                            invoke_result_data.data = {}
+                            order_base_model = OrderBaseModel(context=self.context)
+                            pay_order_no_list, redis_init, pay_order_cache_key = order_base_model._get_tao_pay_order_no_list(app_id,user_id)
+
+                            #满足奖励条件的订单
+                            reward_order_list = []
+                            for item in order_data:
+                                for order in item["orders"]["order"]:
+                                    if str(order["num_iid"]) in goods_ids_list:
+                                        order["step_paid_fee"] = item["step_paid_fee"] if "step_paid_fee" in item.keys() else 0
+                                        order["type"] = item["type"]
+                                        if "pay_time" in item:
+                                            order["pay_time"] = item["pay_time"]
+                                            order["tid"] = item["tid"]
+                                        if support_presale_order == True:
+                                            if order["status"] in self.rewards_status() or (order["type"] == "step" and order["step_trade_status"] != "FRONT_NOPAID_FINAL_NOPAID"):
+                                                reward_order_list.append(order)
+                                        else:
+                                            if order["status"] in self.rewards_status():
+                                                reward_order_list.append(order)
+
+                            pay_price = 0 #总支付金额
+                            pay_num = 0  #总支付笔数
+                            buy_num = 0  #总购买数量
+                            appoint_goods_id_list = [] #购买指定商品ID集合
+                            tao_pay_order_list = []
+
+                            for order in reward_order_list:
+                                try:
+                                    #判断是否已经统计过
+                                    if order["oid"] not in pay_order_no_list:
+                                        appoint_goods_id_list.append(str(order["num_iid"]))
+                                        tao_pay_order = TaoPayOrder()
+                                        tao_pay_order.app_id = app_id
+                                        tao_pay_order.act_id = act_id
+                                        tao_pay_order.ascription_type = 2
+                                        tao_pay_order.user_id = user_id
+                                        tao_pay_order.open_id = user_info_dict["open_id"]
+                                        tao_pay_order.user_nick = user_info_dict["user_nick"]
+                                        tao_pay_order.main_pay_order_no = order['tid']
+                                        tao_pay_order.sub_pay_order_no = order['oid']
+                                        tao_pay_order.goods_code = order['num_iid']
+                                        tao_pay_order.goods_name = order['title']
+                                        if "sku_id" in order.keys():
+                                            tao_pay_order.sku_id = order['sku_id']
+                                            sku_invoke_result_data = top_base_model.get_sku_name(int(order['num_iid']), int(order['sku_id']), access_token, app_key, app_secret,is_log)
+                                            tao_pay_order.sku_name = sku_invoke_result_data.data if sku_invoke_result_data.success == True else ""
+                                        tao_pay_order.buy_num = order['num']
+                                        tao_pay_order.pay_price = order['payment']
+                                        tao_pay_order.order_status = order['status']
+                                        tao_pay_order.create_date = SevenHelper.get_now_datetime()
+                                        tao_pay_order.pay_date = order['pay_time']
+                                        tao_pay_order_list.append(tao_pay_order)
+                                        if support_presale_order == True:
+                                            payment = decimal.Decimal(order["step_paid_fee"]) if order["type"] == "step" and decimal.Decimal(order["step_paid_fee"]) > 0 else decimal.Decimal(order["payment"])
+                                        else:
+                                            payment = decimal.Decimal(order["payment"])
+                                        pay_price = decimal.Decimal(pay_price) + payment
+                                        pay_num = pay_num + 1
+                                        buy_num = buy_num + order['num']
+                                except Exception as ex:
+                                    if self.context:
+                                        self.context.logging_link_info(str(order) + "【购买指定商品任务】" + traceback.format_exc())
+                                    elif self.logging_link_info:
+                                        self.logging_link_info(str(order) + "【购买指定商品任务】" + traceback.format_exc())
+                                    continue
+                            if len(tao_pay_order_list) > 0:
+                                task_count.id_md5 = task_count_id_md5
+                                task_count.app_id = app_id
+                                task_count.act_id = act_id
+                                task_count.module_id = module_id
+                                task_count.user_id = user_id
+                                task_count.open_id = user_info_dict["open_id"]
+                                task_count.task_type = task_type
+                                task_count.now_count = task_count.now_count + pay_num
+                                task_count.create_date = now_datetime
+                                task_count.modify_date = now_datetime
+                                task_count.modify_day = now_day
+                                remark = SevenHelper.json_loads(task_count.remark) if task_count.remark else {"goods_id_list":[]}
+                                remark["goods_id_list"].extend(appoint_goods_id_list)
+                                task_count.remark = SevenHelper.json_dumps(remark)
+                                TaoPayOrderModel(context=self.context).add_list(tao_pay_order_list)
+                                task_count_model.add_update_entity(task_count,"complete_count=%s,modify_date=%s,modify_day=%s,remark=%s",params=[task_count.complete_count,task_count.modify_date,now_day,task_count.remark])
+                                for item in tao_pay_order_list:
+                                    redis_init.lpush(pay_order_cache_key,item.sub_pay_order_no)
+                                    redis_init.expire(pay_order_cache_key, 30 * 24 * 3600)
+
+                                invoke_result_data.data["buy_num"] = buy_num
+                                invoke_result_data.data["pay_price"] = pay_price
+                                invoke_result_data.data["pay_num"] = pay_num
+                                if is_stat == True:
+                                    stat_base_model = StatBaseModel(context=self.context)
+                                    key_list_dict = {}
+                                    key_list_dict["TotalBuyAppointGoodsMoneyCount"] = pay_price #支付金额
+                                    stat_base_model.add_stat_list(app_id, act_id, 0, user_id, user_info_dict["open_id"], key_list_dict)
+                            else:
+                                invoke_result_data.success = False
+                                invoke_result_data.error_code = "error"
+                                invoke_result_data.error_message = "没有匹配订单"
+                else:
+                    invoke_result_data.success = False
+                    invoke_result_data.error_code = "error"
+                    invoke_result_data.error_message = "没有开启或配置购买指定商品任务"
+        except Exception as ex:
+            if self.context:
+                self.context.logging_link_error("【购买指定商品任务】" + traceback.format_exc())
+            elif self.logging_link_error:
+                self.logging_link_error("【购买指定商品任务】" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "exception"
+            invoke_result_data.error_message = "系统繁忙,请稍后再试"
+        finally:
+            self.business_process_executed()
+
+        return invoke_result_data
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/top_base_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/top_base_model.py`

 * *Ordering differences only*

 * *Files 22% similar despite different names*

```diff
@@ -1,1792 +1,1792 @@
-# -*- coding: utf-8 -*-
-"""
-:Author: HuangJianYi
-:Date: 2020-08-12 09:06:24
-@LastEditTime: 2023-04-03 11:20:58
-@LastEditors: HuangJianYi
-:description: 淘宝top接口基础类
-"""
-from seven_cloudapp_frame.libs.common import *
-from seven_cloudapp_frame.libs.customize.seven_helper import SevenHelper
-from seven_top import top
-from seven_cloudapp_frame.models.db_models.base.base_info_model import *
-from seven_cloudapp_frame.models.db_models.app.app_info_model import *
-from seven_cloudapp_frame.models.seven_model import *
-
-class TopBaseModel():
-    """
-    :description: 淘宝top接口业务模型
-    """
-    def __init__(self, context=None, logging_error=None, logging_info=None):
-        self.context = context
-        self.logging_link_error = logging_error
-        self.logging_link_info = logging_info
-
-    def instantiate(self, app_id, user_nick, access_token, app_key, app_secret, is_log=False, main_user_open_id=''):
-        """
-        :description: 实例化
-        :param app_id:应用标识
-        :param user_nick:用户昵称
-        :param access_token:access_token
-        :param app_key:app_key
-        :param app_secret:app_secret
-        :param is_log：是否记录返回信息
-        :return
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        base_info = BaseInfoModel(context=self.context).get_entity()
-        if not base_info:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "基础信息未配置"
-            return invoke_result_data
-        app_name = base_info.product_name
-        description = base_info.product_desc
-        icon = base_info.product_icon
-        template_id = share_config.get_value("client_template_id")
-        template_version = base_info.client_ver
-        app_info_model = AppInfoModel(context=self.context)
-        app_info = None
-        is_change_project_code = False #是否改变了项目代码，用于判断是否进行了服务市场套餐的改变,第一次实例化默认False
-
-        # 产品千牛后台GM工具（运营人员模拟登录）
-        if app_id:
-            app_info = app_info_model.get_entity(where="app_id=%s", params=app_id)
-            if app_info:
-                invoke_result_data.data = {"app_id": app_info.app_id, "store_user_nick": app_info.store_user_nick, "user_nick": app_info.store_user_nick, "access_token": app_info.access_token, "seller_id":app_info.seller_id}
-                return invoke_result_data
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "对不起，该店铺未实例化。"
-            return invoke_result_data
-
-        if not user_nick:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "对不起,请先授权登录"
-            return invoke_result_data
-        store_user_nick = user_nick.split(':')[0]
-        if not store_user_nick:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "对不起,请先授权登录"
-            return invoke_result_data
-        app_info = app_info_model.get_entity(where="store_user_nick=%s", params=store_user_nick)
-        # 有效时间获取
-        invoke_result_data = self.get_dead_date(store_user_nick, access_token, app_key, app_secret, is_log)
-        if invoke_result_data.success == False:
-            return invoke_result_data
-        dead_date = invoke_result_data.data
-        project_code = self.get_project_code(store_user_nick,access_token, app_key, app_secret, is_log)
-        if app_info:
-            if main_user_open_id !="" and app_info.main_user_open_id == "":
-                app_info.main_user_open_id = main_user_open_id
-            if dead_date != "expire":
-                app_info.expiration_date = dead_date
-            if project_code != "":
-                if project_code != app_info.project_code:
-                    is_change_project_code = True
-                app_info.project_code = project_code
-            # invoke_result_data = self.get_goods_list(0, 1, "", "", "", access_token, app_key, app_secret)
-            invoke_result_data = self.get_shop(access_token, app_key, app_secret, is_log)
-            if invoke_result_data.success == True:
-                app_info.access_token = access_token
-            app_info_model.update_entity(app_info, "main_user_open_id,expiration_date,project_code,access_token")
-            app_info_model.delete_dependency_key(DependencyKey.app_info(app_info.app_id))
-            invoke_result_data.data = {"app_id": app_info.app_id, "store_user_nick": app_info.store_user_nick, "user_nick": user_nick, "access_token": app_info.access_token, "seller_id":app_info.seller_id, "is_change_project_code":is_change_project_code}
-            return invoke_result_data
-
-        # if ":" in user_nick:
-        #     invoke_result_data.success = False
-        #     invoke_result_data.error_code = "account_error"
-        #     invoke_result_data.error_message = "对不起，初次创建活动包含实例化，请使用主账号进行创建。"
-        #     return invoke_result_data
-
-        # invoke_result_data = self.get_goods_list(0, 1, "", "", "", access_token, app_key, app_secret)
-        # if invoke_result_data.success == False:
-        #     invoke_result_data.error_code = "account_error"
-        #     invoke_result_data.error_message = "对不起，请使用主账号或者授权的子账号进行创建"
-        #     return invoke_result_data
-        
-        invoke_result_data = self.get_shop(access_token, app_key, app_secret, is_log)
-        if invoke_result_data.success == False:
-            if invoke_result_data.error_code == "no_power":
-                invoke_result_data.error_code = "account_error"
-                invoke_result_data.error_message = "对不起，初次创建活动包含实例化，请使用主账号进行创建。"
-            return invoke_result_data
-
-        shop_info = invoke_result_data.data if invoke_result_data.success == True else {}
-
-        try:
-            top.setDefaultAppInfo(app_key, app_secret)
-            req = top.api.MiniappTemplateInstantiateRequest()
-            req.clients = share_config.get_value("instantiate_clients","taobao,tmall")
-            req.description = description
-            req.ext_json = "{ \"name\":\"" + app_name + "\"}"
-            req.icon = icon
-            req.alias = app_name
-            req.template_id = template_id
-            req.template_version = template_version
-            resp = req.getResponse(access_token)
-            if is_log:
-                log_info = str(resp) + "【access_token】：" + access_token + "【小程序实例化】" + SevenHelper.json_dumps(req)
-                if self.context:
-                    self.context.logging_link_info(log_info)
-                elif self.logging_link_info:
-                    self.logging_link_info(log_info)
-
-            #录入数据库
-            result_app = resp["miniapp_template_instantiate_response"]
-            app_info = AppInfo()
-            app_info.clients = req.clients
-            app_info.app_desc = result_app["app_description"]
-            app_info.app_icon = result_app["app_icon"]
-            app_info.app_id = result_app["app_id"]
-            app_info.app_name = result_app["app_name"]
-            app_info.app_ver = result_app["app_version"]
-            app_info.app_key = result_app["appkey"]
-            app_info.preview_url = result_app["pre_view_url"]
-            app_info.template_id = req.template_id
-            app_info.template_ver = req.template_version
-            app_info.access_token = access_token
-            app_info.expiration_date = dead_date
-            app_info.project_code = project_code
-            app_info.main_user_open_id = main_user_open_id
-
-            if "shop_seller_get_response" in shop_info.keys():
-                app_info.store_name = shop_info["shop_seller_get_response"]["shop"]["title"]
-                app_info.store_id = shop_info["shop_seller_get_response"]["shop"]["sid"]
-                app_info.store_icon = shop_info["shop_seller_get_response"]["shop"]["pic_path"]
-                if app_info.store_icon != "":
-                    app_info.store_icon = "http://logo.taobao.com/shop-logo" + app_info.store_icon
-
-            invoke_result_data = self.get_user_seller(access_token,app_key,app_secret, is_log)
-            user_seller = invoke_result_data.data if invoke_result_data.success == True else {}
-            if "user_seller_get_response" in user_seller.keys():
-                app_info.seller_id = user_seller["user_seller_get_response"]["user"]["user_id"]
-
-            app_info.is_instance = 1
-            app_info.store_user_nick = store_user_nick
-            app_info.instance_date = SevenHelper.get_now_datetime()
-            app_info.modify_date = SevenHelper.get_now_datetime()
-            #上线
-            invoke_result_data = self.online_app(app_info.app_id, template_id, template_version, app_info.app_ver, access_token, app_key, app_secret, is_log)
-            if invoke_result_data.success == False:
-                return invoke_result_data
-            online_app_info = invoke_result_data.data
-            if "miniapp_template_onlineapp_response" in online_app_info.keys():
-                app_info.app_url = online_app_info["miniapp_template_onlineapp_response"]["app_info"]["online_url"]
-            app_info.id = app_info_model.add_entity(app_info)
-            invoke_result_data.data = {"app_id": app_info.app_id, "store_user_nick": store_user_nick, "user_nick": user_nick, "access_token": access_token, "seller_id":app_info.seller_id, "is_change_project_code":is_change_project_code}
-            return invoke_result_data
-        except Exception as ex:
-            if self.context:
-                self.context.logging_link_error(traceback.format_exc())
-            elif self.logging_link_error:
-                self.logging_link_error(traceback.format_exc())
-            if "submsg" in str(ex):
-                content_list = str(ex).split()
-                for content in content_list:
-                    if "submsg=" in content:
-                        invoke_result_data.success = False
-                        invoke_result_data.error_code = "create_error"
-                        invoke_result_data.error_message = content[len("submsg="):]
-                        invoke_result_data.data = {"icon": icon, "app_name": app_name}
-                        return invoke_result_data
-
-    def version_upgrade(self, app_id, client_template_id, client_ver, access_token, app_key, app_secret, app_info, is_log=False):
-        """
-        :description: app更新 接口权限包：商家应用-模板实例化权限包
-        :param app_id:app_id
-        :param client_template_id:模板id
-        :param client_ver:更新的版本号
-        :param access_token:access_token
-        :param app_info:app_info
-        :param is_log：是否记录返回信息
-        :return InvokeResultData
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        try:
-            top.setDefaultAppInfo(app_key, app_secret)
-            req = top.api.MiniappTemplateUpdateappRequest()
-
-            req.clients = share_config.get_value("instantiate_clients","taobao,tmall")
-            req.app_id = app_id
-            req.template_id = client_template_id
-            req.template_version = client_ver
-            resp = req.getResponse(access_token)
-            if is_log:
-                log_info = str(resp) + "【access_token】：" + access_token + "【app更新】" + SevenHelper.json_dumps(req)
-                if self.context:
-                    self.context.logging_link_info(log_info)
-                elif self.logging_link_info:
-                    self.logging_link_info(log_info)
-            if resp and ("miniapp_template_updateapp_response" in resp.keys()):
-                app_version = resp["miniapp_template_updateapp_response"]["app_version"]
-                invoke_result_data = self.online_app(app_id, client_template_id, client_ver, app_version, access_token, app_key, app_secret, is_log)
-                online_app_info = invoke_result_data.data if invoke_result_data.success == True else {}
-                if "miniapp_template_onlineapp_response" in online_app_info.keys():
-                    app_info.app_ver = resp["miniapp_template_updateapp_response"]["app_version"]
-                    app_info.template_ver = client_ver
-                    app_info.modify_date = SevenHelper.get_now_datetime()
-                    AppInfoModel(context=self.context).update_entity(app_info, "app_ver,template_ver,modify_date")
-            return invoke_result_data
-        except Exception as ex:
-            if self.context:
-                self.context.logging_link_error(traceback.format_exc())
-            elif self.logging_link_error:
-                self.logging_link_error(traceback.format_exc())
-            invoke_result_data.success = False
-            if "submsg" in str(ex):
-                content_list = str(ex).split()
-                for content in content_list:
-                    if "submsg=该子帐号无此操作权限" in content:
-                        invoke_result_data.error_code = "no_power"
-                        invoke_result_data.error_message = content[len("submsg="):]
-                        return invoke_result_data
-                    if "submsg=" in content:
-                        invoke_result_data.error_code = "error"
-                        invoke_result_data.error_message = content[len("submsg="):]
-                        return invoke_result_data
-            return invoke_result_data
-
-    def get_sku_name(self, num_iids, sku_id, access_token, app_key, app_secret,is_log=False):
-        """
-        :description: 获取sku名称
-        :param num_iids：num_iids
-        :param sku_id：sku_id
-        :param access_token：access_token
-        :param app_key:app_key
-        :param app_secret:app_secret
-        :param is_log：是否记录返回信息
-        :return InvokeResultData
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        invoke_result_data.data = ""
-        if not num_iids or not sku_id:
-            return invoke_result_data
-        try:
-            top.setDefaultAppInfo(app_key, app_secret)
-            req = top.api.ItemsSellerListGetRequest()
-            req.fields = "num_iid,title,nick,input_str,property_alias,sku,props_name,pic_url"
-            req.num_iids = num_iids
-            resp = req.getResponse(access_token)
-            if is_log:
-                log_info = str(resp) + "【access_token】：" + access_token + "【获取sku名称】"
-                if self.context:
-                    self.context.logging_link_info(log_info)
-                elif self.logging_link_info:
-                    self.logging_link_info(log_info)
-            if "items_seller_list_get_response" in resp.keys():
-                if "items" in resp["items_seller_list_get_response"].keys():
-                    props_names = resp["items_seller_list_get_response"]["items"]["item"][0]["props_name"].split(';')
-                    if "skus" in resp["items_seller_list_get_response"]["items"]["item"][0]:
-                        for sku in resp["items_seller_list_get_response"]["items"]["item"][0]["skus"]["sku"]:
-                            if sku["sku_id"] == sku_id:
-                                props_name = [i for i in props_names if sku["properties"] in i]
-                                if len(props_name) > 0:
-                                    invoke_result_data.data = props_name[0][(len(sku["properties"]) + 1):]
-                                else:
-                                    invoke_result_data.data = sku["properties_name"].split(':')[1]
-                                return invoke_result_data
-            return invoke_result_data
-        except Exception as ex:
-            if self.context:
-                self.context.logging_link_error(traceback.format_exc())
-            elif self.logging_link_error:
-                self.logging_link_error(traceback.format_exc())
-            invoke_result_data.success = False
-            if "submsg" in str(ex):
-                content_list = str(ex).split()
-                for content in content_list:
-                    if "submsg=该子帐号无此操作权限" in content:
-                        invoke_result_data.error_code = "no_power"
-                        invoke_result_data.error_message = content[len("submsg="):]
-                        return invoke_result_data
-                    if "submsg=" in content:
-                        invoke_result_data.error_code = "error"
-                        invoke_result_data.error_message = content[len("submsg="):]
-                        return invoke_result_data
-            return invoke_result_data
-
-    def get_buy_order_info(self, order_no, access_token, app_key, app_secret,is_log=False):
-        """
-        :description: 获取单笔订单
-        :param order_no：订单编号
-        :param access_token：access_token
-        :param app_key:app_key
-        :param app_secret:app_secret
-        :param is_log：是否记录返回信息
-        :return: InvokeResultData
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        try:
-            top.setDefaultAppInfo(app_key, app_secret)
-            req = top.api.OpenTradeGetRequest()
-
-            req.fields = "tid,status,payment,price,created,orders,num,pay_time,buyer_open_uid"
-            req.tid = order_no
-            resp = req.getResponse(access_token)
-            if is_log:
-                log_info = str(resp) + "【access_token】：" + access_token + "【获取单笔订单】"
-                if self.context:
-                    self.context.logging_link_info(log_info)
-                elif self.logging_link_info:
-                    self.logging_link_info(log_info)
-            if "open_trade_get_response" in resp.keys():
-                if "trade" in resp["open_trade_get_response"]:
-                    invoke_result_data.data = resp["open_trade_get_response"]["trade"]
-                    return invoke_result_data
-            return invoke_result_data
-        except Exception as ex:
-            if self.context:
-                self.context.logging_link_error(traceback.format_exc())
-            elif self.logging_link_error:
-                self.logging_link_error(traceback.format_exc())
-            invoke_result_data.success = False
-            if "submsg" in str(ex):
-                content_list = str(ex).split()
-                for content in content_list:
-                    if "submsg=该子帐号无此操作权限" in content:
-                        invoke_result_data.error_code = "no_power"
-                        invoke_result_data.error_message = content[len("submsg="):]
-                        return invoke_result_data
-                    if "submsg=" in content:
-                        invoke_result_data.error_code = "error"
-                        invoke_result_data.error_message = content[len("submsg="):]
-                        return invoke_result_data
-            return invoke_result_data
-
-    def get_buy_order_list(self, open_id, access_token, app_key, app_secret, start_created="", end_created="", page_size=50, is_log=False, type="fixed,step",field="tid,status,payment,price,created,orders,num,pay_time,step_trade_status,step_paid_fee,type"):
-        """
-        :description: 获取淘宝购买订单，出现API字段映射错误，请提供参数信息联系小二处理。字段名:buyer_nick，说明open_id跟app_key没对应上，不是app_key下产品的open_id
-        :param open_id：open_id
-        :param access_token：access_token
-        :param app_key:app_key
-        :param app_secret:app_secret
-        :param start_created：开始时间
-        :param end_created：结束时间
-        :param page_size：页大小
-        :param is_log：是否记录返回信息
-        :param type：订单类型
-        :param field：返回字段
-        :return InvokeResultData
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        all_order = []
-        has_next = True
-        try:
-            top.setDefaultAppInfo(app_key, app_secret)
-            req = top.api.OpenTradesSoldGetRequest()
-            req.fields = field
-            req.type = type
-            req.buyer_open_id = open_id
-            req.page_size = page_size
-            req.page_no = 1
-            req.use_has_next = "true"
-
-            if start_created == "":
-                start_timestamp = TimeHelper.get_now_timestamp() - 90 * 24 * 60 * 60
-                start_created = TimeHelper.timestamp_to_format_time(start_timestamp)
-            req.start_created = start_created
-            if end_created != "":
-                req.end_created = end_created
-
-            while has_next:
-                resp = req.getResponse(access_token)
-                if is_log:
-                    log_info = str(resp) + "【access_token】：" + access_token + "【获取购买订单】"
-                    if self.context:
-                        self.context.logging_link_info(log_info)
-                    elif self.logging_link_info:
-                        self.logging_link_info(log_info)
-                if "open_trades_sold_get_response" in resp.keys():
-                    if "trades" in resp["open_trades_sold_get_response"].keys():
-                        all_order = all_order + resp["open_trades_sold_get_response"]["trades"]["trade"]
-                    req.page_no += 1
-                    has_next = resp["open_trades_sold_get_response"]["has_next"]
-            invoke_result_data.data = all_order
-            return invoke_result_data
-        except Exception as ex:
-            if self.context:
-                self.context.logging_link_error(traceback.format_exc())
-            elif self.logging_link_error:
-                self.logging_link_error(traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.data = []
-            if "submsg" in str(ex):
-                content_list = str(ex).split()
-                for content in content_list:
-                    if "submsg=该子帐号无此操作权限" in content:
-                        invoke_result_data.error_code = "no_power"
-                        invoke_result_data.error_message = content[len("submsg="):]
-                        return invoke_result_data
-                    if "submsg=" in content:
-                        invoke_result_data.error_code = "error"
-                        invoke_result_data.error_message = content[len("submsg="):]
-                        return invoke_result_data
-            return invoke_result_data
-
-    def get_refund_order_list(self, open_id, access_token, app_key, app_secret, start_modified="", end_modified="", page_size=50, is_log=False):
-        """
-        :description: 获取淘宝退款订单
-        :param open_id：open_id
-        :param access_token：access_token
-        :param app_key:app_key
-        :param app_secret:app_secret
-        :param start_modified：开始时间
-        :param end_modified：结束时间
-        :param page_size：页大小
-        :param is_log：是否记录返回信息
-        :return InvokeResultData
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        all_order = []
-        has_next = True
-        try:
-            top.setDefaultAppInfo(app_key, app_secret)
-            req = top.api.RefundsReceiveGetRequest()
-            req.fields = "refund_id,tid,oid,title,total_fee,status,created,refund_fee,modified,num"
-            # refund_id：退款单号, tid：淘宝交易单号, oid：子订单号, title：商品名称 , total_fee：订单总价, status：退款状态,
-            # created：退款申请时间, refund_fee：退款金额, modified：更新时间, num: 购买数量
-            req.type = "fixed"
-            req.page_size = page_size
-            req.page_no = 1
-            req.use_has_next = "true"
-            if open_id:
-                req.buyer_open_uid = open_id
-            if start_modified == "":
-                start_timestamp = TimeHelper.get_now_timestamp() - 90 * 24 * 60 * 60
-                start_modified = TimeHelper.timestamp_to_format_time(start_timestamp)
-            req.start_modified = start_modified
-            if end_modified != "":
-                req.end_modified = end_modified
-            while has_next:
-                resp = req.getResponse(access_token)
-                if is_log:
-                    log_info = str(resp) + "【access_token】：" + access_token + "【获取退单订单】"
-                    if self.context:
-                        self.context.logging_link_info(log_info)
-                elif self.logging_link_info:
-                    self.logging_link_info(log_info)
-                if "refunds_receive_get_response" in resp.keys():
-                    if "refunds" in resp["refunds_receive_get_response"].keys():
-                        all_order = all_order + resp["refunds_receive_get_response"]["refunds"]["refund"]
-                    req.page_no += 1
-                    has_next = resp["refunds_receive_get_response"]["has_next"]
-            invoke_result_data.data = all_order
-            return invoke_result_data
-        except Exception as ex:
-            if self.context:
-                self.context.logging_link_error(traceback.format_exc())
-            elif self.logging_link_error:
-                self.logging_link_error(traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.data = []
-            if "submsg" in str(ex):
-                content_list = str(ex).split()
-                for content in content_list:
-                    if "submsg=该子帐号无此操作权限" in content:
-                        invoke_result_data.error_code = "no_power"
-                        invoke_result_data.error_message = content[len("submsg="):]
-                        return invoke_result_data
-                    if "submsg=" in content:
-                        invoke_result_data.error_code = "error"
-                        invoke_result_data.error_message = content[len("submsg="):]
-                        return invoke_result_data
-            return invoke_result_data
-
-    def online_app(self, app_id, template_id, template_version, app_version, access_token, app_key, app_secret, is_log=False):
-        """
-        :description: app上线
-        :param app_id：app_id
-        :param template_id：模板id
-        :param template_version：模板版本
-        :param app_version：app版本
-        :param access_token：access_token
-        :param app_key:app_key
-        :param app_secret:app_secret
-        :param is_log：是否记录返回信息
-        :return InvokeResultData
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        try:
-            top.setDefaultAppInfo(app_key, app_secret)
-            req = top.api.MiniappTemplateOnlineappRequest()
-
-            req.clients = share_config.get_value("instantiate_clients","taobao,tmall")
-            req.app_id = app_id
-            req.template_id = template_id
-            req.template_version = template_version
-            req.app_version = app_version
-            resp = req.getResponse(access_token)
-            if is_log:
-                log_info = str(resp) + "【access_token】：" + access_token + "【app上线】"
-                if self.context:
-                    self.context.logging_link_info(log_info)
-                elif self.logging_link_info:
-                    self.logging_link_info(log_info)
-            invoke_result_data.data = resp
-            return invoke_result_data
-        except Exception as ex:
-            if self.context:
-                self.context.logging_link_error(traceback.format_exc())
-            elif self.logging_link_error:
-                self.logging_link_error(traceback.format_exc())
-            invoke_result_data.success = False
-            if "submsg" in str(ex):
-                content_list = str(ex).split()
-                for content in content_list:
-                    if "submsg=该子帐号无此操作权限" in content:
-                        invoke_result_data.error_code = "no_power"
-                        invoke_result_data.error_message = content[len("submsg="):]
-                        return invoke_result_data
-                    if "submsg=" in content:
-                        invoke_result_data.error_code = "error"
-                        invoke_result_data.error_message = content[len("submsg="):]
-                        return invoke_result_data
-            return invoke_result_data
-
-    def get_shop(self, access_token, app_key, app_secret, is_log=False):
-        """
-        :description: 获取店铺信息
-        :param access_token：access_token
-        :param app_key：app_key
-        :param app_secret：app_secret
-        :param is_log：是否记录返回信息
-        :return: InvokeResultData
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        try:
-            top.setDefaultAppInfo(app_key, app_secret)
-            req = top.api.ShopSellerGetRequest()
-            req.fields = "sid,title,pic_path"
-            resp = req.getResponse(access_token)
-            if is_log:
-                log_info = str(resp) + "【access_token】：" + access_token + "【获取店铺信息】"
-                if self.context:
-                    self.context.logging_link_info(log_info)
-                elif self.logging_link_info:
-                    self.logging_link_info(log_info)
-            invoke_result_data.data = resp
-            return invoke_result_data
-        except Exception as ex:
-            if self.context:
-                self.context.logging_link_error(traceback.format_exc())
-            elif self.logging_link_error:
-                self.logging_link_error(traceback.format_exc())
-            invoke_result_data.success = False
-            if "submsg" in str(ex):
-                content_list = str(ex).split()
-                for content in content_list:
-                    if "submsg=该子帐号无此操作权限" in content:
-                        invoke_result_data.error_code = "no_power"
-                        invoke_result_data.error_message = content[len("submsg="):]
-                        return invoke_result_data
-                    if "submsg=" in content:
-                        invoke_result_data.error_code = "error"
-                        invoke_result_data.error_message = content[len("submsg="):]
-                        return invoke_result_data
-            return invoke_result_data
-
-    def get_user_seller(self, access_token, app_key, app_secret, is_log=False):
-        """
-        :description: 获取关注店铺用户信息
-        :param access_token：access_token
-        :param app_key：app_key
-        :param app_secret：app_secret
-        :param is_log：是否记录返回信息
-        :return: InvokeResultData
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        try:
-            top.setDefaultAppInfo(app_key, app_secret)
-            req = top.api.UserSellerGetRequest()
-            req.fields = "user_id,nick,sex"
-            resp = req.getResponse(access_token)
-            if is_log:
-                log_info = str(resp) + "【access_token】：" + access_token + "【获取关注店铺用户信息】"
-                if self.context:
-                    self.context.logging_link_info(log_info)
-                elif self.logging_link_info:
-                    self.logging_link_info(log_info)
-            invoke_result_data.data = resp
-            return invoke_result_data
-        except Exception as ex:
-            if self.context:
-                self.context.logging_link_error(traceback.format_exc())
-            elif self.logging_link_error:
-                self.logging_link_error(traceback.format_exc())
-            invoke_result_data.success = False
-            if "submsg" in str(ex):
-                content_list = str(ex).split()
-                for content in content_list:
-                    if "submsg=该子帐号无此操作权限" in content:
-                        invoke_result_data.error_code = "no_power"
-                        invoke_result_data.error_message = content[len("submsg="):]
-                        return invoke_result_data
-                    if "submsg=" in content:
-                        invoke_result_data.error_code = "error"
-                        invoke_result_data.error_message = content[len("submsg="):]
-                        return invoke_result_data
-            return invoke_result_data
-
-    def get_dead_date(self, user_nick, access_token, app_key, app_secret, is_log=False):
-        """
-        :description: 获取订购过期时间
-        :param user_nick：用户昵称
-        :param access_token：access_token
-        :param app_key:app_key
-        :param app_secret:app_secret
-        :param is_log：是否记录返回信息
-        :return InvokeResultData
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        try:
-            vas_subscribe_get_response = self.get_vas_subscribe(user_nick, access_token, app_key, app_secret, is_log)
-            if not vas_subscribe_get_response:
-                invoke_result_data.data = "expire"
-                return invoke_result_data
-            if "article_user_subscribe" not in vas_subscribe_get_response["article_user_subscribes"].keys():
-                invoke_result_data.data = "expire"
-                return invoke_result_data
-            invoke_result_data.data = vas_subscribe_get_response["article_user_subscribes"]["article_user_subscribe"][0]["deadline"]
-            return invoke_result_data
-        except Exception as ex:
-            if self.context:
-                self.context.logging_link_error(traceback.format_exc())
-            elif self.logging_link_error:
-                self.logging_link_error(traceback.format_exc())
-            invoke_result_data.success = False
-            if "submsg" in str(ex):
-                content_list = str(ex).split()
-                for content in content_list:
-                    if "submsg=该子帐号无此操作权限" in content:
-                        invoke_result_data.error_code = "no_power"
-                        invoke_result_data.error_message = content[len("submsg="):]
-                        return invoke_result_data
-                    if "submsg=" in content:
-                        invoke_result_data.error_code = "error"
-                        invoke_result_data.error_message = content[len("submsg="):]
-                        return invoke_result_data
-            return invoke_result_data
-
-    def get_goods_list_by_goodsids(self, num_iids, access_token,app_key, app_secret, field="num_iid,title,nick,pic_url,price,input_str,property_alias,sku,props_name,outer_id,prop_img",is_log=False):
-        """
-        :description: 获取在售商品列表(num_iids上限20个，超过淘宝会报错)
-        :param num_iids：商品id列表
-        :param access_token：access_token
-        :param app_key:app_key
-        :param app_secret:app_secret
-        :param field：返回字段
-        :param is_log：是否记录返回信息
-        :return InvokeResultData
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        num_iid_list = num_iids.split(',')
-        page_size = 20
-        page_count = int(len(num_iid_list) / page_size) if len(num_iid_list) % page_size == 0 else int(len(num_iid_list) / page_size) + 1
-        goods_list = []
-        for i in range(0, page_count):
-            cur_num_iids = ",".join(num_iid_list[i * page_size:page_size * (i + 1)])
-            try:
-                top.setDefaultAppInfo(app_key, app_secret)
-                req = top.api.ItemsSellerListGetRequest()
-                req.fields = field
-                req.num_iids = cur_num_iids
-                resp = req.getResponse(access_token)
-                if is_log:
-                    log_info = str(resp) + "【access_token】：" + access_token + "【获取在售商品列表by_goodsids】"
-                    if self.context:
-                        self.context.logging_link_info(log_info)
-                    elif self.logging_link_info:
-                        self.logging_link_info(log_info)
-
-                if "items_seller_list_get_response" in resp.keys():
-                    if "items" in resp["items_seller_list_get_response"].keys():
-                        if "item" in resp["items_seller_list_get_response"]["items"].keys():
-                            goods_list.extend(resp["items_seller_list_get_response"]["items"]["item"])
-            except Exception as ex:
-                if self.context:
-                    self.context.logging_link_error(traceback.format_exc())
-                elif self.logging_link_error:
-                    self.logging_link_error(traceback.format_exc())
-                invoke_result_data.success = False
-                if "submsg" in str(ex):
-                    content_list = str(ex).split()
-                    for content in content_list:
-                        if "submsg=该子帐号无此操作权限" in content:
-                            invoke_result_data.error_code = "no_power"
-                            invoke_result_data.error_message = content[len("submsg="):]
-                            return invoke_result_data
-                        if "submsg=num_iid有误，必须大于0" in content:
-                            invoke_result_data.error_code = "param_error"
-                            invoke_result_data.error_message = content[len("submsg="):]
-                            return invoke_result_data
-                        if "submsg=" in content:
-                            invoke_result_data.error_code = "error"
-                            invoke_result_data.error_message = content[len("submsg="):]
-                            return invoke_result_data
-                return invoke_result_data
-        invoke_result_data.data = {"items_seller_list_get_response": {"items": {"item": goods_list}}}
-        return invoke_result_data
-
-    def get_goods_list(self, page_index, page_size, goods_name, order_tag, order_by, access_token,app_key, app_secret, field="num_iid,title,nick,price,input_str,property_alias,sku,props_name,pic_url", is_log=False):
-        """
-        :description: 获取在售商品列表（获取当前会话用户出售中的商品列表）
-        :param page_index：页索引
-        :param page_size：页大小
-        :param goods_name：商品名称
-        :param order_tag：order_tag
-        :param order_by：排序类型
-        :param access_token：access_token
-        :param app_key:app_key
-        :param app_secret:app_secret
-        :param field:查询字段
-        :param is_log：是否记录返回信息
-        :return InvokeResultData
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-
-        try:
-            top.setDefaultAppInfo(app_key, app_secret)
-            req = top.api.ItemsOnsaleGetRequest()
-            req.fields = field
-            req.page_no = page_index + 1
-            req.page_size = page_size
-            if goods_name != "":
-                req.q = goods_name
-            if order_tag !="" and order_by !="":
-                req.order_by = order_tag + ":" + order_by
-            resp = req.getResponse(access_token)
-            if is_log:
-                log_info = str(resp) + "【access_token】：" + access_token + "【获取在售商品列表】"
-                if self.context:
-                    self.context.logging_link_info(log_info)
-                elif self.logging_link_info:
-                    self.logging_link_info(log_info)
-            if resp:
-                resp["pageSize"] = page_size
-                resp["pageIndex"] = page_index
-            invoke_result_data.data = resp
-            return invoke_result_data
-        except Exception as ex:
-            if self.context:
-                self.context.logging_link_error(traceback.format_exc())
-            elif self.logging_link_error:
-                self.logging_link_error(traceback.format_exc())
-            invoke_result_data.success = False
-            if "submsg" in str(ex):
-                content_list = str(ex).split()
-                for content in content_list:
-                    if "submsg=该子帐号无此操作权限" in content:
-                        invoke_result_data.error_code = "no_power"
-                        invoke_result_data.error_message = content[len("submsg="):]
-                        return invoke_result_data
-                    if "submsg=" in content:
-                        invoke_result_data.error_code = "error"
-                        invoke_result_data.error_message = content[len("submsg="):]
-                        return invoke_result_data
-            return invoke_result_data
-
-    def get_goods_info(self, num_iid, access_token,app_key, app_secret, field="num_iid,title,nick,pic_url,price,item_img.url,outer_id,sku,approve_status,prop_img", is_log=False):
-        """
-        :description: 获取单个商品详细信息
-        :param num_iid：num_iid
-        :param access_token：access_token
-        :param app_key:app_key
-        :param app_secret:app_secret
-        :param field：查询字段
-        :param is_log：是否记录返回信息
-        :return InvokeResultData
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        try:
-            top.setDefaultAppInfo(app_key, app_secret)
-            req = top.api.ItemSellerGetRequest()
-
-            req.fields = field
-            req.num_iid = num_iid
-            resp = req.getResponse(access_token)
-            if is_log:
-                log_info = str(resp) + "【access_token】：" + access_token + "【获取单个商品详细信息】"
-                if self.context:
-                    self.context.logging_link_info(log_info)
-                elif self.logging_link_info:
-                    self.logging_link_info(log_info)
-            invoke_result_data.data = resp
-            return invoke_result_data
-        except Exception as ex:
-            if self.context:
-                self.context.logging_link_error(traceback.format_exc())
-            elif self.logging_link_error:
-                self.logging_link_error(traceback.format_exc())
-            invoke_result_data.success = False
-            if "submsg" in str(ex):
-                content_list = str(ex).split()
-                for content in content_list:
-                    if "submsg=该子帐号无此操作权限" in content:
-                        invoke_result_data.error_code = "no_power"
-                        invoke_result_data.error_message = content[len("submsg="):]
-                        return invoke_result_data
-                    if "submsg=" in content:
-                        invoke_result_data.error_code = "error"
-                        invoke_result_data.error_message = content[len("submsg="):]
-                        return invoke_result_data
-            return invoke_result_data
-
-    def get_goods_inventory_list(self, page_index, page_size, goods_name, order_tag, order_by, access_token,app_key, app_secret, field="num_iid,title,nick,price,input_str,property_alias,sku,props_name,pic_url", is_log=False):
-        """
-        :description: 获取仓库商品列表（获取当前用户作为卖家的仓库中的商品列表）
-        :param page_index：页索引
-        :param page_size：页大小
-        :param goods_name：商品名称
-        :param order_tag：order_tag
-        :param order_by：排序类型
-        :param access_token：access_token
-        :param app_key:app_key
-        :param app_secret:app_secret
-        :param field：查询字段
-        :param is_log：是否记录返回信息
-        :return InvokeResultData
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        try:
-            top.setDefaultAppInfo(app_key, app_secret)
-            req = top.api.ItemsInventoryGetRequest()
-
-            req.fields = field
-            req.page_no = page_index
-            req.page_size = page_size
-            if goods_name != "":
-                req.q = goods_name
-            req.order_by = order_tag + ":" + order_by
-
-            resp = req.getResponse(access_token)
-            if resp:
-                resp["pageSize"] = page_size
-                resp["pageIndex"] = page_index
-            if is_log:
-                log_info = str(resp) + "【access_token】：" + access_token+ "【获取仓库商品列表】"
-                if self.context:
-                    self.context.logging_link_info(log_info)
-                elif self.logging_link_info:
-                    self.logging_link_info(log_info)
-            invoke_result_data.data = resp
-            return invoke_result_data
-        except Exception as ex:
-            if self.context:
-                self.context.logging_link_error(traceback.format_exc())
-            elif self.logging_link_error:
-                self.logging_link_error(traceback.format_exc())
-            invoke_result_data.success = False
-            if "submsg" in str(ex):
-                content_list = str(ex).split()
-                for content in content_list:
-                    if "submsg=该子帐号无此操作权限" in content:
-                        invoke_result_data.error_code = "no_power"
-                        invoke_result_data.error_message = content[len("submsg="):]
-                        return invoke_result_data
-                    if "submsg=" in content:
-                        invoke_result_data.error_code = "error"
-                        invoke_result_data.error_message = content[len("submsg="):]
-                        return invoke_result_data
-            return invoke_result_data
-
-    def miniapp_distribution_items_bind(self, goods_ids, url, status, access_token, app_key, app_secret, is_log=False):
-        """
-        :description: 小程序投放-商品绑定/解绑（提供给使用了投放插件的服务商，可以调用该API实现帮助商家更新已创建的投放单中的绑定商品信息。）
-        :param goods_ids：商品id列表逗号，分隔
-        :param url：投放的商家应用完整链接
-        :param status：true表示新增绑定，false表示解绑
-        :param access_token:access_token
-        :param app_key:app_key
-        :param app_secret:app_secret
-        :param is_log：是否记录返回信息
-        :return InvokeResultData
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        try:
-            top.setDefaultAppInfo(app_key, app_secret)
-            req = top.api.MiniappDistributionItemsBindRequest()
-
-            req.target_entity_list = goods_ids
-            req.url = url
-            req.add_bind = status
-            resp = req.getResponse(access_token)
-            if is_log:
-                log_info = str(resp) + "【access_token】：" + access_token + "【小程序投放商品】"
-                if self.context:
-                    self.context.logging_link_info(log_info)
-                elif self.logging_link_info:
-                    self.logging_link_info(log_info)
-            invoke_result_data.data = resp
-            return invoke_result_data
-        except Exception as ex:
-            if self.context:
-                self.context.logging_link_error(traceback.format_exc())
-            elif self.logging_link_error:
-                self.logging_link_error(traceback.format_exc())
-            invoke_result_data.success = False
-            if "submsg" in str(ex):
-                content_list = str(ex).split()
-                for content in content_list:
-                    if "submsg=该子帐号无此操作权限" in content:
-                        invoke_result_data.error_code = "no_power"
-                        invoke_result_data.error_message = content[len("submsg="):]
-                        return invoke_result_data
-                    if "submsg=" in content:
-                        invoke_result_data.error_code = "error"
-                        invoke_result_data.error_message = content[len("submsg="):]
-                        return invoke_result_data
-            return invoke_result_data
-
-    def miniapp_distribution_order_get(self, order_id_list, access_token, app_key, app_secret, is_log=False):
-        """
-        :description: 小程序投放-查询小程序投放计划信息
-        :param order_id_list:投放计划的id列表 示例值：[1,2,3]
-        :param access_token:access_token
-        :param app_key:app_key
-        :param app_secret:app_secret
-        :param is_log：是否记录返回信息
-        :return InvokeResultData
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        try:
-            top.setDefaultAppInfo(app_key, app_secret)
-            req = top.api.MiniappDistributionOrderGetRequest()
-            req.order_id_request = {}
-            req.order_id_request["order_id_list"] = order_id_list
-            resp = req.getResponse(access_token)
-            if is_log:
-                log_info = str(resp) + "【access_token】：" + access_token + "【查询小程序投放计划】"
-                if self.context:
-                    self.context.logging_link_info(log_info)
-                elif self.logging_link_info:
-                    self.logging_link_info(log_info)
-            invoke_result_data.data = resp
-            return invoke_result_data
-
-        except Exception as ex:
-            if self.context:
-                self.context.logging_link_error(traceback.format_exc())
-            elif self.logging_link_error:
-                self.logging_link_error(traceback.format_exc())
-            invoke_result_data.success = False
-            if "submsg" in str(ex):
-                content_list = str(ex).split()
-                for content in content_list:
-                    if "submsg=该子帐号无此操作权限" in content:
-                        invoke_result_data.error_code = "no_power"
-                        invoke_result_data.error_message = content[len("submsg="):]
-                        return invoke_result_data
-                    if "submsg=" in content:
-                        invoke_result_data.error_code = "error"
-                        invoke_result_data.error_message = content[len("submsg="):]
-                        return invoke_result_data
-            return invoke_result_data
-    
-    def alibaba_benefit_query(self, right_ename, access_token, app_key, app_secret, is_log=False):
-        """
-        :description: 查询优惠券详情信息
-        :param right_ename:奖池ID
-        :param access_token:access_token
-        :param app_key:app_key
-        :param app_secret:app_secret
-        :param is_log：是否记录返回信息
-        :return: InvokeResultData
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        try:
-            top.setDefaultAppInfo(app_key, app_secret)
-            req = top.api.AlibabaBenefitQueryRequest()
-            req.ename = right_ename
-            req.app_name = "promotioncenter-" + share_config.get_value("server_template_id")
-            req.award_type = "1"
-            resp = req.getResponse(access_token)
-            if is_log:
-                log_info = str(resp) + "【access_token】：" + access_token + "【查询优惠券详情信息】"
-                if self.context:
-                    self.context.logging_link_info(log_info)
-                elif self.logging_link_info:
-                    self.logging_link_info(log_info)
-            invoke_result_data.data = resp
-            return invoke_result_data
-        except Exception as ex:
-            if self.context:
-                self.context.logging_link_error(traceback.format_exc())
-            elif self.logging_link_error:
-                self.logging_link_error(traceback.format_exc())
-            invoke_result_data.success = False
-            if "submsg" in str(ex):
-                content_list = str(ex).split()
-                for content in content_list:
-                    if "submsg=该子帐号无此操作权限" in content:
-                        invoke_result_data.error_code = "no_power"
-                        invoke_result_data.error_message = content[len("submsg="):]
-                        return invoke_result_data
-                    if "submsg=" in content:
-                        invoke_result_data.error_code = "error"
-                        invoke_result_data.error_message = content[len("submsg="):]
-                        return invoke_result_data
-            return invoke_result_data
-
-    def alibaba_benefit_send(self, right_ename, open_id, access_token,app_key, app_secret, is_log=False):
-        """
-        :description: 发放优惠劵
-        :param right_ename:奖池ID
-        :param open_id:open_id
-        :param access_token:access_token
-        :param app_key:app_key
-        :param app_secret:app_secret
-        :param is_log：是否记录返回信息
-        :return: InvokeResultData
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        try:
-            top.setDefaultAppInfo(app_key, app_secret)
-            req = top.api.AlibabaBenefitSendRequest()
-            req.right_ename = right_ename
-            req.receiver_id = open_id
-            req.user_type = "taobao"
-            req.unique_id = str(open_id) + str(right_ename) + str(TimeHelper.get_now_timestamp())
-            req.app_name = "promotioncenter-" + share_config.get_value("server_template_id")
-            resp = req.getResponse(access_token)
-            if is_log:
-                log_info = str(resp) + "【access_token】：" + access_token + "【发放优惠劵】"
-                if self.context:
-                    self.context.logging_link_info(log_info)
-                elif self.logging_link_info:
-                    self.logging_link_info(log_info)
-            invoke_result_data.data = resp
-            return invoke_result_data
-        except Exception as ex:
-            if self.context:
-                self.context.logging_link_error(traceback.format_exc())
-            elif self.logging_link_error:
-                self.logging_link_error(traceback.format_exc())
-            invoke_result_data.success = False
-            if "submsg" in str(ex):
-                content_list = str(ex).split()
-                for content in content_list:
-                    if "submsg=该子帐号无此操作权限" in content:
-                        invoke_result_data.error_code = "no_power"
-                        invoke_result_data.error_message = content[len("submsg="):]
-                        return invoke_result_data
-                    if "submsg=" in content:
-                        invoke_result_data.error_code = "error"
-                        invoke_result_data.error_message = content[len("submsg="):]
-                        return invoke_result_data
-            return invoke_result_data
-
-    def get_member_info(self, mix_nick, nick, access_token, app_key, app_secret, is_log=False):
-        """
-        :description: 获取淘宝会员信息
-        :param mix_nick:mix_nick
-        :param nick:nick（淘宝废弃使用）
-        :param access_token:access_token
-        :param app_key:app_key
-        :param app_secret:app_secret
-        :param is_log：是否记录返回信息
-        :return:InvokeResultData
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        try:
-            top.setDefaultAppInfo(app_key, app_secret)
-            req = top.api.CrmMemberIdentityGetRequest()
-            if mix_nick:
-                req.mix_nick = mix_nick
-            if nick:
-                req.nick = nick
-            resp = req.getResponse(access_token)
-            if is_log:
-                log_info = str(resp) + "【access_token】：" + access_token + "【获取淘宝会员信息】"
-                if self.context:
-                    self.context.logging_link_info(log_info)
-                elif self.logging_link_info:
-                    self.logging_link_info(log_info)
-            invoke_result_data.data = resp
-            return invoke_result_data
-        except Exception as ex:
-            if self.context:
-                self.context.logging_link_error(traceback.format_exc())
-            elif self.logging_link_error:
-                self.logging_link_error(traceback.format_exc())
-            invoke_result_data.success = False
-            if "submsg" in str(ex):
-                content_list = str(ex).split()
-                for content in content_list:
-                    if "submsg=该子帐号无此操作权限" in content:
-                        invoke_result_data.error_code = "no_power"
-                        invoke_result_data.error_message = content[len("submsg="):]
-                        return invoke_result_data
-                    if "submsg=" in content:
-                        invoke_result_data.error_code = "error"
-                        invoke_result_data.error_message = content[len("submsg="):]
-                        return invoke_result_data
-            return invoke_result_data
-
-    def check_is_member(self, mix_nick, nick, access_token, app_key, app_secret, is_log=False):
-        """
-        :description: 实时查询当前是否店铺会员
-        :param mix_nick:mix_nick
-        :param nick:nick（淘宝废弃使用）
-        :param access_token:access_token
-        :param app_key:app_key
-        :param app_secret:app_secret
-        :param is_log：是否记录返回信息
-        :return:True是会员 False不是会员
-        :last_editors: HuangJianYi
-        """
-        is_member = False
-        invoke_result_data = self.get_member_info(mix_nick, nick, access_token, app_key, app_secret, is_log)
-        if invoke_result_data.success == False:
-            return is_member
-        resp = invoke_result_data.data
-        if "crm_member_identity_get_response" in resp.keys():
-            if "result" in resp["crm_member_identity_get_response"].keys():
-                if "member_info" in resp["crm_member_identity_get_response"]["result"].keys():
-                    is_member = True
-        return is_member
-    
-    def get_member_grade(self, mix_nick, access_token, app_key, app_secret, is_log=False):
-        """
-        :description: 查询会员等级
-        :param mix_nick:mix_nick
-        :param access_token:access_token
-        :param app_key:app_key
-        :param app_secret:app_secret
-        :param is_log：是否记录返回信息
-        :return:会员信息
-        :last_editors: HuangJianYi
-        """
-        member_info = {}
-        invoke_result_data = self.get_member_info(mix_nick,'', access_token, app_key, app_secret, is_log)
-        if invoke_result_data.success == False:
-            return invoke_result_data
-        resp = invoke_result_data.data
-        if "crm_member_identity_get_response" in resp.keys():
-                if "result" in resp["crm_member_identity_get_response"].keys():
-                    if "member_info" in resp["crm_member_identity_get_response"]["result"].keys():
-                        if "grade" in resp["crm_member_identity_get_response"]["result"]["member_info"].keys() and "grade_name" in resp["crm_member_identity_get_response"]["result"]["member_info"].keys():
-                            member_info = resp["crm_member_identity_get_response"]["result"]["member_info"]
-        
-        invoke_result_data.data = member_info
-        return invoke_result_data
-
-    def get_join_member_url(self, access_token, app_key, app_secret, is_log=False):
-        """
-        :description: 获取加入会员地址
-        :param access_token:access_token
-        :param app_key:app_key
-        :param app_secret:app_secret
-        :param is_log：是否记录返回信息
-        :return:InvokeResultData
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        try:
-            top.setDefaultAppInfo(app_key, app_secret)
-            req = top.api.CrmMemberJoinurlGetRequest()
-            req.callback_url = ""
-            req.extra_info = "{\"source\":\"isvapp\",\"activityId\":\"\",\"entrance\":\"hudong\"}"
-            resp = req.getResponse(access_token)
-            if is_log:
-                log_info = str(resp) + "【access_token】：" + access_token + "【获取加入会员地址】"
-                if self.context:
-                    self.context.logging_link_info(log_info)
-                elif self.logging_link_info:
-                    self.logging_link_info(log_info)
-            if "crm_member_joinurl_get_response" in resp.keys():
-                if "result" in resp["crm_member_joinurl_get_response"].keys():
-                    if "result" in resp["crm_member_joinurl_get_response"]["result"].keys():
-                        invoke_result_data.data = resp["crm_member_joinurl_get_response"]["result"]["result"]
-                        if invoke_result_data.data and "https:" not in invoke_result_data.data and "http:" not in invoke_result_data.data:
-                            invoke_result_data.data = "https:" + invoke_result_data.data
-                        return invoke_result_data
-            else:
-                invoke_result_data.data = ""
-                return invoke_result_data
-        except Exception as ex:
-            if self.context:
-                self.context.logging_link_error(traceback.format_exc())
-            elif self.logging_link_error:
-                self.logging_link_error(traceback.format_exc())
-            invoke_result_data.success = False
-            if "submsg" in str(ex):
-                content_list = str(ex).split()
-                for content in content_list:
-                    if "submsg=该子帐号无此操作权限" in content:
-                        invoke_result_data.error_code = "no_power"
-                        invoke_result_data.error_message = content[len("submsg="):]
-                        return invoke_result_data
-                    if "submsg=" in content:
-                        invoke_result_data.error_code = "error"
-                        invoke_result_data.error_message = content[len("submsg="):]
-                        return invoke_result_data
-            return invoke_result_data
-
-    def open_trade_special_items_query(self, app_id, access_token, app_key, app_secret, is_log=False):
-        """
-        :description: 专属下单查询
-        :param app_id：app_id
-        :param access_token：access_token
-        :param app_key:app_key
-        :param app_secret:app_secret
-        :param is_log：是否记录返回信息
-        :return InvokeResultData
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        resp = {}
-        try:
-            top.setDefaultAppInfo(app_key, app_secret)
-            req = top.api.OpentradeSpecialItemsQueryRequest()
-            req.miniapp_id = app_id
-            resp = req.getResponse(access_token)
-            if is_log:
-                log_info = str(resp) + "【access_token】：" + access_token + "【专属下单查询】"
-                if self.context:
-                    self.context.logging_link_info(log_info)
-                elif self.logging_link_info:
-                    self.logging_link_info(log_info)
-            invoke_result_data.data = resp
-            return invoke_result_data
-        except Exception as ex:
-            if self.context:
-                self.context.logging_link_error(traceback.format_exc())
-            elif self.logging_link_error:
-                self.logging_link_error(traceback.format_exc())
-            invoke_result_data.success = False
-            if "submsg" in str(ex):
-                content_list = str(ex).split()
-                for content in content_list:
-                    if "submsg=该子帐号无此操作权限" in content:
-                        invoke_result_data.error_code = "no_power"
-                        invoke_result_data.error_message = content[len("submsg="):]
-                        return invoke_result_data
-                    if "submsg=" in content:
-                        invoke_result_data.error_code = "error"
-                        invoke_result_data.error_message = content[len("submsg="):]
-                        return invoke_result_data
-            return invoke_result_data
-
-    def open_trade_special_userk_mark(self, goods_id, open_id, access_token, app_key, app_secret, is_log=False):
-        """
-        :description: 专属下单可购买用户标记
-        :param goods_id：商品id
-        :param open_id：open_id
-        :param access_token：access_token
-        :param app_key:app_key
-        :param app_secret:app_secret
-        :param is_log：是否记录返回信息
-        :return 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        try:
-            top.setDefaultAppInfo(app_key, app_secret)
-            req = top.api.OpentradeSpecialUsersMarkRequest()
-            req.hit = "true"
-            req.open_user_ids = str(open_id)
-            req.item_id = int(goods_id)
-            req.sku_id = 0
-            req.status = "MARK"
-            req.limit_num = 1
-            resp = req.getResponse(access_token)
-            if is_log:
-                log_info = str(resp) + "【access_token】：" + access_token + "【专属下单可购买用户标记】"
-                if self.context:
-                    self.context.logging_link_info(log_info)
-                elif self.logging_link_info:
-                    self.logging_link_info(log_info)
-            if resp and resp["opentrade_special_users_mark_response"]["result"] == 1:
-                #  ------------ TopOpentradeSpecialUserMark: {'opentrade_special_users_mark_response': {'result': 1, 'request_id': 'rsk23xhlk310'}}
-                invoke_result_data.data = True
-            else:
-                invoke_result_data.data = False
-            return invoke_result_data
-
-        except Exception as ex:
-            if self.context:
-                self.context.logging_link_error(traceback.format_exc())
-            elif self.logging_link_error:
-                self.logging_link_error(traceback.format_exc())
-            invoke_result_data.success = False
-            if "submsg" in str(ex):
-                content_list = str(ex).split()
-                for content in content_list:
-                    if "submsg=该子帐号无此操作权限" in content:
-                        invoke_result_data.error_code = "no_power"
-                        invoke_result_data.error_message = content[len("submsg="):]
-                        return invoke_result_data
-                    if "submsg=" in content:
-                        invoke_result_data.error_code = "error"
-                        invoke_result_data.error_message = content[len("submsg="):]
-                        return invoke_result_data
-            return invoke_result_data
-
-    def open_trade_special_items_bind(self, app_id, goods_id, access_token, app_key, app_secret, is_log=False):
-        """
-        :description: 专属下单商品绑定
-        :param app_id：app_id
-        :param goods_id：goods_id
-        :param access_token：access_token
-        :param app_key:app_key
-        :param app_secret:app_secret
-        :param is_log：是否记录返回信息
-        :return 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        try:
-            top.setDefaultAppInfo(app_key, app_secret)
-            req = top.api.OpentradeSpecialItemsBindRequest()
-
-            req.miniapp_id = app_id
-            req.item_ids = str(goods_id)
-            resp = req.getResponse(access_token)
-            if is_log:
-                log_info = str(resp) + "【access_token】：" + access_token + "【专属下单商品绑定】"
-                if self.context:
-                    self.context.logging_link_info(log_info)
-                elif self.logging_link_info:
-                    self.logging_link_info(log_info)
-            # {'opentrade_special_items_bind_response': {'results': {'item_bind_result': [{'bind_ok': False, 'error_message': '商品已绑定到小程序:情之缘1993_好货跳一跳_[3000000029278805]', 'item_id': 632007280726}]}, 'request_id': 'zrq8mt8d8xdo'}}
-            if resp["opentrade_special_items_bind_response"]["results"]["item_bind_result"][0]:
-                if not resp["opentrade_special_items_bind_response"]["results"]["item_bind_result"][0]["bind_ok"]:
-                    invoke_result_data.success = False
-                    invoke_result_data.error_code = "error"
-                    invoke_result_data.error_message = resp["opentrade_special_items_bind_response"]["results"]["item_bind_result"][0]["error_message"]
-            return invoke_result_data
-        except Exception as ex:
-            if self.context:
-                self.context.logging_link_error(traceback.format_exc())
-            elif self.logging_link_error:
-                self.logging_link_error(traceback.format_exc())
-            invoke_result_data.success = False
-            if "submsg" in str(ex):
-                content_list = str(ex).split()
-                for content in content_list:
-                    if "submsg=该子帐号无此操作权限" in content:
-                        invoke_result_data.error_code = "no_power"
-                        invoke_result_data.error_message = content[len("submsg="):]
-                        return invoke_result_data
-                    if "submsg=" in content:
-                        invoke_result_data.error_code = "error"
-                        invoke_result_data.error_message = content[len("submsg="):]
-                        return invoke_result_data
-            return invoke_result_data
-
-    def get_project_code(self, user_nick, access_token, app_key, app_secret, is_log=False):
-        """
-        :description: 获取项目编码
-        :param user_nick：用户昵称
-        :param access_token：access_token
-        :param app_key:app_key
-        :param app_secret:app_secret
-        :param is_log：是否记录返回信息
-        :return list
-        :last_editors: HuangJianYi
-        """
-        try:
-            vas_subscribe_get_response = self.get_vas_subscribe(user_nick, access_token, app_key, app_secret, is_log)
-            if not vas_subscribe_get_response:
-                return ""
-            if "article_user_subscribe" not in vas_subscribe_get_response["article_user_subscribes"].keys():
-                return ""
-            return vas_subscribe_get_response["article_user_subscribes"]["article_user_subscribe"][0]["item_code"]
-        except Exception as ex:
-            if self.context:
-                self.context.logging_link_error(traceback.format_exc())
-            elif self.logging_link_error:
-                self.logging_link_error(traceback.format_exc())
-            return ""
-
-    def get_vas_subscribe(self, user_nick, access_token, app_key, app_secret, is_log=False):
-        """
-        :description:订购关系查询 用于ISV根据登录进来的淘宝会员名查询该为该会员开通哪些收费项目，ISV只能查询自己名下的应用及收费项目的订购情况
-        :param user_nick：用户昵称
-        :param access_token：access_token
-        :param app_key:app_key
-        :param app_secret:app_secret
-        :param is_log：是否记录返回信息
-        :return 订购关系
-        :last_editors: HuangJianYi
-        """
-        try:
-            redis_init = SevenHelper.redis_init()
-            cache_key = f"get_vas_subscribe:{user_nick}"
-            vas_subscribe_get_response = redis_init.get(cache_key)
-            if vas_subscribe_get_response:
-                return json.loads(vas_subscribe_get_response)
-            top.setDefaultAppInfo(app_key, app_secret)
-            req = top.api.VasSubscribeGetRequest()
-            req.article_code = share_config.get_value("article_code")
-            req.nick = user_nick
-            resp = req.getResponse(access_token)
-            if is_log:
-                log_info = str(resp) + "【access_token】：" + access_token + "【订购关系查询】"
-                if self.context:
-                    self.context.logging_link_info(log_info)
-                elif self.logging_link_info:
-                    self.logging_link_info(log_info)
-            redis_init.set(cache_key, json.dumps(resp["vas_subscribe_get_response"]),5)
-            return resp["vas_subscribe_get_response"]
-        except Exception as ex:
-            if self.context:
-                self.context.logging_link_error(traceback.format_exc())
-            elif self.logging_link_error:
-                self.logging_link_error(traceback.format_exc())
-            return None
-
-    def get_short_url(self, url, access_token, app_key, app_secret, is_log=False):
-        """
-        :description: 获取短链接
-        :param url：链接地址
-        :param access_token：access_token
-        :param app_key:app_key
-        :param app_secret:app_secret
-        :param is_log：是否记录返回信息
-        :return 短链接地址
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        try:
-            top.setDefaultAppInfo(app_key, app_secret)
-            req = top.api.MiniappShorturlCreateRequest()
-            req.article_code = share_config.get_value("article_code")
-            req.miniapp_url = url
-            resp = req.getResponse(access_token)
-            if is_log:
-                log_info = str(resp) + "【access_token】：" + access_token + "【获取短链接】"
-                if self.context:
-                    self.context.logging_link_info(log_info)
-                elif self.logging_link_info:
-                    self.logging_link_info(log_info)
-            if "miniapp_shorturl_create_response" not in  resp:
-                invoke_result_data.success = False
-                return invoke_result_data
-            if "result" not in resp["miniapp_shorturl_create_response"]:
-                invoke_result_data.success = False
-                return invoke_result_data
-            if "model" not in resp["miniapp_shorturl_create_response"]["result"]:
-                invoke_result_data.success = False
-                return invoke_result_data
-            if "short_url" not in resp["miniapp_shorturl_create_response"]["result"]["model"]:
-                invoke_result_data.success = False
-                return invoke_result_data
-            invoke_result_data.data = resp["miniapp_shorturl_create_response"]["result"]["model"]["short_url"]
-            return invoke_result_data
-        except Exception as ex:
-            if self.context:
-                self.context.logging_link_error(traceback.format_exc())
-            elif self.logging_link_error:
-                self.logging_link_error(traceback.format_exc())
-            invoke_result_data.success = False
-            return invoke_result_data
-
-    def get_crm_point_available(self, mix_nick, access_token, app_key, app_secret, is_log=False, open_id=""):
-        """
-        :description: 获取店铺会员积分
-        :param mix_nick：混淆昵称
-        :param access_token：access_token
-        :param app_key:app_key
-        :param app_secret:app_secret
-        :param is_log：是否记录返回信息
-        :param open_id：open_id
-        :return 返回店铺会员积分
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        try:
-            top.setDefaultAppInfo(app_key, app_secret)
-            req = top.api.CrmPointAvailableGetRequest()
-            if mix_nick:
-                req.mix_nick = mix_nick
-            if open_id:
-                req.open_uid = open_id
-            resp = req.getResponse(access_token)
-            if is_log:
-                log_info = "【req】:" + SevenHelper.json_dumps(req) + "【resp】:" + str(resp) +  "【access_token】：" + access_token + "【获取店铺会员积分】"
-                if self.context:
-                    self.context.logging_link_info(log_info)
-                elif self.logging_link_info:
-                    self.logging_link_info(log_info)
-            if "crm_point_available_get_response" not in  resp:
-                invoke_result_data.success = False
-                return invoke_result_data
-            if "result" not in resp["crm_point_available_get_response"]:
-                invoke_result_data.success = False
-                return invoke_result_data
-            invoke_result_data.data = resp["crm_point_available_get_response"]["result"]
-            return invoke_result_data
-        except Exception as ex:
-            if self.context:
-                self.context.logging_link_error(traceback.format_exc())
-            elif self.logging_link_error:
-                self.logging_link_error(traceback.format_exc())
-            invoke_result_data.success = False
-            if "submsg" in str(ex):
-                content_list = str(ex).split()
-                for content in content_list:
-                    if "submsg=该子帐号无此操作权限" in content:
-                        invoke_result_data.error_code = "no_power"
-                        invoke_result_data.error_message = content[len("submsg="):]
-                        return invoke_result_data
-                    if "submsg=" in content:
-                        invoke_result_data.error_code = "error"
-                        invoke_result_data.error_message = content[len("submsg="):]
-                        return invoke_result_data
-            return invoke_result_data
-
-    def change_crm_point(self, open_id, mix_nick, change_type, opt_type, quantity, access_token, app_key, app_secret, activity_id=0, activity_name="", is_log=False):
-        """
-        :description: 操作店铺会员积分
-        :param open_id：买家open_id
-        :param mix_nick：混淆昵称
-        :param change_type：变更类型：0交易，1：互动活动，2：权益兑换，3：手工调整
-        :param opt_type：操作类型，0：增加，1：扣减
-        :param quantity：积分数量
-        :param access_token：access_token
-        :param app_key:app_key
-        :param app_secret:app_secret
-        :param activity_id：活动Id
-        :param activity_name：活动名称
-        :param is_log：是否记录返回信息
-        :return 返回操作结果
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        try:
-            top.setDefaultAppInfo(app_key, app_secret)
-            req = top.api.CrmPointChangeRequest()
-            if activity_id > 0:
-                req.activity_id = activity_id
-            if activity_name:
-                req.activity_name = activity_name
-            req.change_type = change_type
-            req.opt_type = opt_type
-            req.quantity = quantity
-            if open_id:
-                req.open_id = open_id
-            if mix_nick:
-                req.mix_nick = mix_nick
-            resp = req.getResponse(access_token)
-            if is_log:
-                log_info = "【req】:" + SevenHelper.json_dumps(req) + "【resp】:" + str(resp) + "【access_token】：" + access_token + "【操作店铺会员积分】"
-                if self.context:
-                    self.context.logging_link_info(log_info)
-                elif self.logging_link_info:
-                    self.logging_link_info(log_info)
-            if "crm_point_change_response" not in resp:
-                invoke_result_data.success = False
-                return invoke_result_data
-            if "result" not in resp["crm_point_change_response"]:
-                invoke_result_data.success = False
-                return invoke_result_data
-            invoke_result_data.data = resp["crm_point_change_response"]["result"]
-            return invoke_result_data
-        except Exception as ex:
-            if self.context:
-                self.context.logging_link_error(traceback.format_exc())
-            elif self.logging_link_error:
-                self.logging_link_error(traceback.format_exc())
-            invoke_result_data.success = False
-            if "submsg" in str(ex):
-                content_list = str(ex).split()
-                for content in content_list:
-                    if "submsg=该子帐号无此操作权限" in content:
-                        invoke_result_data.error_code = "no_power"
-                        invoke_result_data.error_message = content[len("submsg="):]
-                        return invoke_result_data
-                    if "submsg=" in content:
-                        invoke_result_data.error_code = "error"
-                        invoke_result_data.error_message = content[len("submsg="):]
-                        return invoke_result_data
-            return invoke_result_data
-
-    def miniapp_widget_template_instance_query(self, widget_template_id, access_token, app_key, app_secret, is_log=False):
-        """
-        :description: 查询淘宝小部件信息
-        :param widget_template_id：小部件模版id
-        :param access_token：access_token
-        :param app_key:app_key
-        :param app_secret:app_secret
-        :param is_log：是否记录返回信息
-        :return 小部件实例化信息
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        try:
-            top.setDefaultAppInfo(app_key, app_secret)
-            req = top.api.MiniappWidgetTemplateInstanceQueryRequest()
-            req.param0 = {}
-            req.param0["page_size"] = 20
-            req.param0["page_num"] = 1
-            req.param0["template_id"] = widget_template_id
-            resp = req.getResponse(access_token)
-            if is_log:
-                log_info = str(resp) + "【access_token】：" + access_token + "【查询淘宝小部件信息】"
-                if self.context:
-                    self.context.logging_link_info(log_info)
-                elif self.logging_link_info:
-                    self.logging_link_info(log_info)
-            return invoke_result_data
-
-        except Exception as ex:
-            if self.context:
-                self.context.logging_link_error(traceback.format_exc())
-            elif self.logging_link_error:
-                self.logging_link_error(traceback.format_exc())
-            invoke_result_data.success = False
-            if "submsg" in str(ex):
-                content_list = str(ex).split()
-                for content in content_list:
-                    if "submsg=该子帐号无此操作权限" in content:
-                        invoke_result_data.error_code = "no_power"
-                        invoke_result_data.error_message = content[len("submsg="):]
-                        return invoke_result_data
-                    if "submsg=" in content:
-                        invoke_result_data.error_code = "error"
-                        invoke_result_data.error_message = content[len("submsg="):]
-                        return invoke_result_data
-            return invoke_result_data
-        
-    def miniapp_widget_template_instantiate(self, template_version, description, widget_template_id, access_token, app_key, app_secret, is_log=False):
-        """
-        :description: 实例化小部件 resp={"miniapp_widget_template_instantiate_response": {"result": {"model": {"app_description": "提供商家会员权益集合", "app_icon": "https://ossgw.alicdn.com/taobao-miniapp/img/39eb12a3c266c7a8d72e8dcb1b6a1530.png", "app_name": "天志C店_会员身份卡片", "appkey": "400013325276", "id": "3000000070599924", "online_code": "https://m.duanqu.com/?_ariver_appid=3000000070599924&_mp_code=tb&transition=present", "online_version": "0.0.1"}, "success": True}, "request_id": "15rv0rkcwiqtn"}}
-        :param template_version：小部件版本
-        :param description：小部件描述
-        :param widget_template_id：小部件模版id
-        :param access_token：access_token
-        :param app_key:app_key
-        :param app_secret:app_secret
-        :param is_log：是否记录返回信息
-        :return 实例化后的信息
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        try:
-            top.setDefaultAppInfo(app_key, app_secret)
-            req = top.api.MiniappWidgetTemplateInstantiateRequest()
-            req.param_mini_app_instantiate_template_app_simple_request = {}
-            req.param_mini_app_instantiate_template_app_simple_request["template_id"] = widget_template_id
-            req.param_mini_app_instantiate_template_app_simple_request["template_version"] = template_version
-            req.param_mini_app_instantiate_template_app_simple_request["description"] = description
-            resp = req.getResponse(access_token)
-            if is_log:
-                log_info = str(resp) + "【access_token】：" + access_token + "【实例化小部件】"
-                if self.context:
-                    self.context.logging_link_info(log_info)
-                elif self.logging_link_info:
-                    self.logging_link_info(log_info)
-            if "miniapp_widget_template_instantiate_response" not in resp:
-                invoke_result_data.success = False
-                return invoke_result_data
-            if "result" not in resp["miniapp_widget_template_instantiate_response"]:
-                invoke_result_data.success = False
-                return invoke_result_data
-            if resp["miniapp_widget_template_instantiate_response"]["result"]["success"] == False:
-                invoke_result_data.success = False
-                return invoke_result_data
-
-            invoke_result_data.data = resp["miniapp_widget_template_instantiate_response"]["result"]["model"]
-            return invoke_result_data
-
-        except Exception as ex:
-            if self.context:
-                self.context.logging_link_error(traceback.format_exc())
-            elif self.logging_link_error:
-                self.logging_link_error(traceback.format_exc())
-            invoke_result_data.success = False
-            if "submsg" in str(ex):
-                content_list = str(ex).split()
-                for content in content_list:
-                    if "submsg=该子帐号无此操作权限" in content:
-                        invoke_result_data.error_code = "no_power"
-                        invoke_result_data.error_message = content[len("submsg="):]
-                        return invoke_result_data
-                    if "submsg=" in content:
-                        invoke_result_data.error_code = "error"
-                        invoke_result_data.error_message = content[len("submsg="):]
-                        return invoke_result_data
-            return invoke_result_data
-        
-    def miniapp_widget_template_instance_update(self, widgets_id, widget_template_id, template_version, access_token, app_key, app_secret, is_log=False):
-        """
-        :description: 更新小部件版本
-        :param widgets_id：小部件id
-        :param widget_template_id：小部件模版id
-        :param template_version：小部件模版版本
-        :param access_token：access_token
-        :param app_key:app_key
-        :param app_secret:app_secret
-        :param is_log：是否记录返回信息
-        :return
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        try:
-            top.setDefaultAppInfo(app_key, app_secret)
-            req = top.api.MiniappWidgetTemplateInstanceUpdateRequest()
-            req.param_mini_app_instantiate_template_app_update_request = {}
-            req.param_mini_app_instantiate_template_app_update_request["entity_id"] = widgets_id
-            req.param_mini_app_instantiate_template_app_update_request["template_id"] = widget_template_id
-            req.param_mini_app_instantiate_template_app_update_request["template_version"] = template_version
-            resp = req.getResponse(access_token)
-            if is_log:
-                log_info = str(resp) + "【access_token】：" + access_token + "【更新小部件版本】"
-                if self.context:
-                    self.context.logging_link_info(log_info)
-                elif self.logging_link_info:
-                    self.logging_link_info(log_info)
-            if "miniapp_widget_template_instance_update_response" not in resp:
-                invoke_result_data.success = False
-                return invoke_result_data
-            if "result" not in resp["miniapp_widget_template_instance_update_response"]:
-                invoke_result_data.success = False
-                return invoke_result_data
-            if resp["miniapp_widget_template_instance_update_response"]["result"]["success"] == False:
-                invoke_result_data.success = False
-                return invoke_result_data
-            invoke_result_data.data = resp["miniapp_widget_template_instance_update_response"]["result"]["model"]
-            return invoke_result_data
-
-        except Exception as ex:
-            if self.context:
-                self.context.logging_link_error(traceback.format_exc())
-            elif self.logging_link_error:
-                self.logging_link_error(traceback.format_exc())
-            invoke_result_data.success = False
-            if "submsg" in str(ex):
-                content_list = str(ex).split()
-                for content in content_list:
-                    if "submsg=该子帐号无此操作权限" in content:
-                        invoke_result_data.error_code = "no_power"
-                        invoke_result_data.error_message = content[len("submsg="):]
-                        return invoke_result_data
-                    if "submsg=" in content:
-                        invoke_result_data.error_code = "error"
-                        invoke_result_data.error_message = content[len("submsg="):]
-                        return invoke_result_data
+# -*- coding: utf-8 -*-
+"""
+:Author: HuangJianYi
+:Date: 2020-08-12 09:06:24
+@LastEditTime: 2023-04-03 11:20:58
+@LastEditors: HuangJianYi
+:description: 淘宝top接口基础类
+"""
+from seven_cloudapp_frame.libs.common import *
+from seven_cloudapp_frame.libs.customize.seven_helper import SevenHelper
+from seven_top import top
+from seven_cloudapp_frame.models.db_models.base.base_info_model import *
+from seven_cloudapp_frame.models.db_models.app.app_info_model import *
+from seven_cloudapp_frame.models.seven_model import *
+
+class TopBaseModel():
+    """
+    :description: 淘宝top接口业务模型
+    """
+    def __init__(self, context=None, logging_error=None, logging_info=None):
+        self.context = context
+        self.logging_link_error = logging_error
+        self.logging_link_info = logging_info
+
+    def instantiate(self, app_id, user_nick, access_token, app_key, app_secret, is_log=False, main_user_open_id=''):
+        """
+        :description: 实例化
+        :param app_id:应用标识
+        :param user_nick:用户昵称
+        :param access_token:access_token
+        :param app_key:app_key
+        :param app_secret:app_secret
+        :param is_log：是否记录返回信息
+        :return
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        base_info = BaseInfoModel(context=self.context).get_entity()
+        if not base_info:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "基础信息未配置"
+            return invoke_result_data
+        app_name = base_info.product_name
+        description = base_info.product_desc
+        icon = base_info.product_icon
+        template_id = share_config.get_value("client_template_id")
+        template_version = base_info.client_ver
+        app_info_model = AppInfoModel(context=self.context)
+        app_info = None
+        is_change_project_code = False #是否改变了项目代码，用于判断是否进行了服务市场套餐的改变,第一次实例化默认False
+
+        # 产品千牛后台GM工具（运营人员模拟登录）
+        if app_id:
+            app_info = app_info_model.get_entity(where="app_id=%s", params=app_id)
+            if app_info:
+                invoke_result_data.data = {"app_id": app_info.app_id, "store_user_nick": app_info.store_user_nick, "user_nick": app_info.store_user_nick, "access_token": app_info.access_token, "seller_id":app_info.seller_id}
+                return invoke_result_data
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "对不起，该店铺未实例化。"
+            return invoke_result_data
+
+        if not user_nick:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "对不起,请先授权登录"
+            return invoke_result_data
+        store_user_nick = user_nick.split(':')[0]
+        if not store_user_nick:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "对不起,请先授权登录"
+            return invoke_result_data
+        app_info = app_info_model.get_entity(where="store_user_nick=%s", params=store_user_nick)
+        # 有效时间获取
+        invoke_result_data = self.get_dead_date(store_user_nick, access_token, app_key, app_secret, is_log)
+        if invoke_result_data.success == False:
+            return invoke_result_data
+        dead_date = invoke_result_data.data
+        project_code = self.get_project_code(store_user_nick,access_token, app_key, app_secret, is_log)
+        if app_info:
+            if main_user_open_id !="" and app_info.main_user_open_id == "":
+                app_info.main_user_open_id = main_user_open_id
+            if dead_date != "expire":
+                app_info.expiration_date = dead_date
+            if project_code != "":
+                if project_code != app_info.project_code:
+                    is_change_project_code = True
+                app_info.project_code = project_code
+            # invoke_result_data = self.get_goods_list(0, 1, "", "", "", access_token, app_key, app_secret)
+            invoke_result_data = self.get_shop(access_token, app_key, app_secret, is_log)
+            if invoke_result_data.success == True:
+                app_info.access_token = access_token
+            app_info_model.update_entity(app_info, "main_user_open_id,expiration_date,project_code,access_token")
+            app_info_model.delete_dependency_key(DependencyKey.app_info(app_info.app_id))
+            invoke_result_data.data = {"app_id": app_info.app_id, "store_user_nick": app_info.store_user_nick, "user_nick": user_nick, "access_token": app_info.access_token, "seller_id":app_info.seller_id, "is_change_project_code":is_change_project_code}
+            return invoke_result_data
+
+        # if ":" in user_nick:
+        #     invoke_result_data.success = False
+        #     invoke_result_data.error_code = "account_error"
+        #     invoke_result_data.error_message = "对不起，初次创建活动包含实例化，请使用主账号进行创建。"
+        #     return invoke_result_data
+
+        # invoke_result_data = self.get_goods_list(0, 1, "", "", "", access_token, app_key, app_secret)
+        # if invoke_result_data.success == False:
+        #     invoke_result_data.error_code = "account_error"
+        #     invoke_result_data.error_message = "对不起，请使用主账号或者授权的子账号进行创建"
+        #     return invoke_result_data
+        
+        invoke_result_data = self.get_shop(access_token, app_key, app_secret, is_log)
+        if invoke_result_data.success == False:
+            if invoke_result_data.error_code == "no_power":
+                invoke_result_data.error_code = "account_error"
+                invoke_result_data.error_message = "对不起，初次创建活动包含实例化，请使用主账号进行创建。"
+            return invoke_result_data
+
+        shop_info = invoke_result_data.data if invoke_result_data.success == True else {}
+
+        try:
+            top.setDefaultAppInfo(app_key, app_secret)
+            req = top.api.MiniappTemplateInstantiateRequest()
+            req.clients = share_config.get_value("instantiate_clients","taobao,tmall")
+            req.description = description
+            req.ext_json = "{ \"name\":\"" + app_name + "\"}"
+            req.icon = icon
+            req.alias = app_name
+            req.template_id = template_id
+            req.template_version = template_version
+            resp = req.getResponse(access_token)
+            if is_log:
+                log_info = str(resp) + "【access_token】：" + access_token + "【小程序实例化】" + SevenHelper.json_dumps(req)
+                if self.context:
+                    self.context.logging_link_info(log_info)
+                elif self.logging_link_info:
+                    self.logging_link_info(log_info)
+
+            #录入数据库
+            result_app = resp["miniapp_template_instantiate_response"]
+            app_info = AppInfo()
+            app_info.clients = req.clients
+            app_info.app_desc = result_app["app_description"]
+            app_info.app_icon = result_app["app_icon"]
+            app_info.app_id = result_app["app_id"]
+            app_info.app_name = result_app["app_name"]
+            app_info.app_ver = result_app["app_version"]
+            app_info.app_key = result_app["appkey"]
+            app_info.preview_url = result_app["pre_view_url"]
+            app_info.template_id = req.template_id
+            app_info.template_ver = req.template_version
+            app_info.access_token = access_token
+            app_info.expiration_date = dead_date
+            app_info.project_code = project_code
+            app_info.main_user_open_id = main_user_open_id
+
+            if "shop_seller_get_response" in shop_info.keys():
+                app_info.store_name = shop_info["shop_seller_get_response"]["shop"]["title"]
+                app_info.store_id = shop_info["shop_seller_get_response"]["shop"]["sid"]
+                app_info.store_icon = shop_info["shop_seller_get_response"]["shop"]["pic_path"]
+                if app_info.store_icon != "":
+                    app_info.store_icon = "http://logo.taobao.com/shop-logo" + app_info.store_icon
+
+            invoke_result_data = self.get_user_seller(access_token,app_key,app_secret, is_log)
+            user_seller = invoke_result_data.data if invoke_result_data.success == True else {}
+            if "user_seller_get_response" in user_seller.keys():
+                app_info.seller_id = user_seller["user_seller_get_response"]["user"]["user_id"]
+
+            app_info.is_instance = 1
+            app_info.store_user_nick = store_user_nick
+            app_info.instance_date = SevenHelper.get_now_datetime()
+            app_info.modify_date = SevenHelper.get_now_datetime()
+            #上线
+            invoke_result_data = self.online_app(app_info.app_id, template_id, template_version, app_info.app_ver, access_token, app_key, app_secret, is_log)
+            if invoke_result_data.success == False:
+                return invoke_result_data
+            online_app_info = invoke_result_data.data
+            if "miniapp_template_onlineapp_response" in online_app_info.keys():
+                app_info.app_url = online_app_info["miniapp_template_onlineapp_response"]["app_info"]["online_url"]
+            app_info.id = app_info_model.add_entity(app_info)
+            invoke_result_data.data = {"app_id": app_info.app_id, "store_user_nick": store_user_nick, "user_nick": user_nick, "access_token": access_token, "seller_id":app_info.seller_id, "is_change_project_code":is_change_project_code}
+            return invoke_result_data
+        except Exception as ex:
+            if self.context:
+                self.context.logging_link_error(traceback.format_exc())
+            elif self.logging_link_error:
+                self.logging_link_error(traceback.format_exc())
+            if "submsg" in str(ex):
+                content_list = str(ex).split()
+                for content in content_list:
+                    if "submsg=" in content:
+                        invoke_result_data.success = False
+                        invoke_result_data.error_code = "create_error"
+                        invoke_result_data.error_message = content[len("submsg="):]
+                        invoke_result_data.data = {"icon": icon, "app_name": app_name}
+                        return invoke_result_data
+
+    def version_upgrade(self, app_id, client_template_id, client_ver, access_token, app_key, app_secret, app_info, is_log=False):
+        """
+        :description: app更新 接口权限包：商家应用-模板实例化权限包
+        :param app_id:app_id
+        :param client_template_id:模板id
+        :param client_ver:更新的版本号
+        :param access_token:access_token
+        :param app_info:app_info
+        :param is_log：是否记录返回信息
+        :return InvokeResultData
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        try:
+            top.setDefaultAppInfo(app_key, app_secret)
+            req = top.api.MiniappTemplateUpdateappRequest()
+
+            req.clients = share_config.get_value("instantiate_clients","taobao,tmall")
+            req.app_id = app_id
+            req.template_id = client_template_id
+            req.template_version = client_ver
+            resp = req.getResponse(access_token)
+            if is_log:
+                log_info = str(resp) + "【access_token】：" + access_token + "【app更新】" + SevenHelper.json_dumps(req)
+                if self.context:
+                    self.context.logging_link_info(log_info)
+                elif self.logging_link_info:
+                    self.logging_link_info(log_info)
+            if resp and ("miniapp_template_updateapp_response" in resp.keys()):
+                app_version = resp["miniapp_template_updateapp_response"]["app_version"]
+                invoke_result_data = self.online_app(app_id, client_template_id, client_ver, app_version, access_token, app_key, app_secret, is_log)
+                online_app_info = invoke_result_data.data if invoke_result_data.success == True else {}
+                if "miniapp_template_onlineapp_response" in online_app_info.keys():
+                    app_info.app_ver = resp["miniapp_template_updateapp_response"]["app_version"]
+                    app_info.template_ver = client_ver
+                    app_info.modify_date = SevenHelper.get_now_datetime()
+                    AppInfoModel(context=self.context).update_entity(app_info, "app_ver,template_ver,modify_date")
+            return invoke_result_data
+        except Exception as ex:
+            if self.context:
+                self.context.logging_link_error(traceback.format_exc())
+            elif self.logging_link_error:
+                self.logging_link_error(traceback.format_exc())
+            invoke_result_data.success = False
+            if "submsg" in str(ex):
+                content_list = str(ex).split()
+                for content in content_list:
+                    if "submsg=该子帐号无此操作权限" in content:
+                        invoke_result_data.error_code = "no_power"
+                        invoke_result_data.error_message = content[len("submsg="):]
+                        return invoke_result_data
+                    if "submsg=" in content:
+                        invoke_result_data.error_code = "error"
+                        invoke_result_data.error_message = content[len("submsg="):]
+                        return invoke_result_data
+            return invoke_result_data
+
+    def get_sku_name(self, num_iids, sku_id, access_token, app_key, app_secret,is_log=False):
+        """
+        :description: 获取sku名称
+        :param num_iids：num_iids
+        :param sku_id：sku_id
+        :param access_token：access_token
+        :param app_key:app_key
+        :param app_secret:app_secret
+        :param is_log：是否记录返回信息
+        :return InvokeResultData
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        invoke_result_data.data = ""
+        if not num_iids or not sku_id:
+            return invoke_result_data
+        try:
+            top.setDefaultAppInfo(app_key, app_secret)
+            req = top.api.ItemsSellerListGetRequest()
+            req.fields = "num_iid,title,nick,input_str,property_alias,sku,props_name,pic_url"
+            req.num_iids = num_iids
+            resp = req.getResponse(access_token)
+            if is_log:
+                log_info = str(resp) + "【access_token】：" + access_token + "【获取sku名称】"
+                if self.context:
+                    self.context.logging_link_info(log_info)
+                elif self.logging_link_info:
+                    self.logging_link_info(log_info)
+            if "items_seller_list_get_response" in resp.keys():
+                if "items" in resp["items_seller_list_get_response"].keys():
+                    props_names = resp["items_seller_list_get_response"]["items"]["item"][0]["props_name"].split(';')
+                    if "skus" in resp["items_seller_list_get_response"]["items"]["item"][0]:
+                        for sku in resp["items_seller_list_get_response"]["items"]["item"][0]["skus"]["sku"]:
+                            if sku["sku_id"] == sku_id:
+                                props_name = [i for i in props_names if sku["properties"] in i]
+                                if len(props_name) > 0:
+                                    invoke_result_data.data = props_name[0][(len(sku["properties"]) + 1):]
+                                else:
+                                    invoke_result_data.data = sku["properties_name"].split(':')[1]
+                                return invoke_result_data
+            return invoke_result_data
+        except Exception as ex:
+            if self.context:
+                self.context.logging_link_error(traceback.format_exc())
+            elif self.logging_link_error:
+                self.logging_link_error(traceback.format_exc())
+            invoke_result_data.success = False
+            if "submsg" in str(ex):
+                content_list = str(ex).split()
+                for content in content_list:
+                    if "submsg=该子帐号无此操作权限" in content:
+                        invoke_result_data.error_code = "no_power"
+                        invoke_result_data.error_message = content[len("submsg="):]
+                        return invoke_result_data
+                    if "submsg=" in content:
+                        invoke_result_data.error_code = "error"
+                        invoke_result_data.error_message = content[len("submsg="):]
+                        return invoke_result_data
+            return invoke_result_data
+
+    def get_buy_order_info(self, order_no, access_token, app_key, app_secret,is_log=False):
+        """
+        :description: 获取单笔订单
+        :param order_no：订单编号
+        :param access_token：access_token
+        :param app_key:app_key
+        :param app_secret:app_secret
+        :param is_log：是否记录返回信息
+        :return: InvokeResultData
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        try:
+            top.setDefaultAppInfo(app_key, app_secret)
+            req = top.api.OpenTradeGetRequest()
+
+            req.fields = "tid,status,payment,price,created,orders,num,pay_time,buyer_open_uid"
+            req.tid = order_no
+            resp = req.getResponse(access_token)
+            if is_log:
+                log_info = str(resp) + "【access_token】：" + access_token + "【获取单笔订单】"
+                if self.context:
+                    self.context.logging_link_info(log_info)
+                elif self.logging_link_info:
+                    self.logging_link_info(log_info)
+            if "open_trade_get_response" in resp.keys():
+                if "trade" in resp["open_trade_get_response"]:
+                    invoke_result_data.data = resp["open_trade_get_response"]["trade"]
+                    return invoke_result_data
+            return invoke_result_data
+        except Exception as ex:
+            if self.context:
+                self.context.logging_link_error(traceback.format_exc())
+            elif self.logging_link_error:
+                self.logging_link_error(traceback.format_exc())
+            invoke_result_data.success = False
+            if "submsg" in str(ex):
+                content_list = str(ex).split()
+                for content in content_list:
+                    if "submsg=该子帐号无此操作权限" in content:
+                        invoke_result_data.error_code = "no_power"
+                        invoke_result_data.error_message = content[len("submsg="):]
+                        return invoke_result_data
+                    if "submsg=" in content:
+                        invoke_result_data.error_code = "error"
+                        invoke_result_data.error_message = content[len("submsg="):]
+                        return invoke_result_data
+            return invoke_result_data
+
+    def get_buy_order_list(self, open_id, access_token, app_key, app_secret, start_created="", end_created="", page_size=50, is_log=False, type="fixed,step",field="tid,status,payment,price,created,orders,num,pay_time,step_trade_status,step_paid_fee,type"):
+        """
+        :description: 获取淘宝购买订单，出现API字段映射错误，请提供参数信息联系小二处理。字段名:buyer_nick，说明open_id跟app_key没对应上，不是app_key下产品的open_id
+        :param open_id：open_id
+        :param access_token：access_token
+        :param app_key:app_key
+        :param app_secret:app_secret
+        :param start_created：开始时间
+        :param end_created：结束时间
+        :param page_size：页大小
+        :param is_log：是否记录返回信息
+        :param type：订单类型
+        :param field：返回字段
+        :return InvokeResultData
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        all_order = []
+        has_next = True
+        try:
+            top.setDefaultAppInfo(app_key, app_secret)
+            req = top.api.OpenTradesSoldGetRequest()
+            req.fields = field
+            req.type = type
+            req.buyer_open_id = open_id
+            req.page_size = page_size
+            req.page_no = 1
+            req.use_has_next = "true"
+
+            if start_created == "":
+                start_timestamp = TimeHelper.get_now_timestamp() - 90 * 24 * 60 * 60
+                start_created = TimeHelper.timestamp_to_format_time(start_timestamp)
+            req.start_created = start_created
+            if end_created != "":
+                req.end_created = end_created
+
+            while has_next:
+                resp = req.getResponse(access_token)
+                if is_log:
+                    log_info = str(resp) + "【access_token】：" + access_token + "【获取购买订单】"
+                    if self.context:
+                        self.context.logging_link_info(log_info)
+                    elif self.logging_link_info:
+                        self.logging_link_info(log_info)
+                if "open_trades_sold_get_response" in resp.keys():
+                    if "trades" in resp["open_trades_sold_get_response"].keys():
+                        all_order = all_order + resp["open_trades_sold_get_response"]["trades"]["trade"]
+                    req.page_no += 1
+                    has_next = resp["open_trades_sold_get_response"]["has_next"]
+            invoke_result_data.data = all_order
+            return invoke_result_data
+        except Exception as ex:
+            if self.context:
+                self.context.logging_link_error(traceback.format_exc())
+            elif self.logging_link_error:
+                self.logging_link_error(traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.data = []
+            if "submsg" in str(ex):
+                content_list = str(ex).split()
+                for content in content_list:
+                    if "submsg=该子帐号无此操作权限" in content:
+                        invoke_result_data.error_code = "no_power"
+                        invoke_result_data.error_message = content[len("submsg="):]
+                        return invoke_result_data
+                    if "submsg=" in content:
+                        invoke_result_data.error_code = "error"
+                        invoke_result_data.error_message = content[len("submsg="):]
+                        return invoke_result_data
+            return invoke_result_data
+
+    def get_refund_order_list(self, open_id, access_token, app_key, app_secret, start_modified="", end_modified="", page_size=50, is_log=False):
+        """
+        :description: 获取淘宝退款订单
+        :param open_id：open_id
+        :param access_token：access_token
+        :param app_key:app_key
+        :param app_secret:app_secret
+        :param start_modified：开始时间
+        :param end_modified：结束时间
+        :param page_size：页大小
+        :param is_log：是否记录返回信息
+        :return InvokeResultData
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        all_order = []
+        has_next = True
+        try:
+            top.setDefaultAppInfo(app_key, app_secret)
+            req = top.api.RefundsReceiveGetRequest()
+            req.fields = "refund_id,tid,oid,title,total_fee,status,created,refund_fee,modified,num"
+            # refund_id：退款单号, tid：淘宝交易单号, oid：子订单号, title：商品名称 , total_fee：订单总价, status：退款状态,
+            # created：退款申请时间, refund_fee：退款金额, modified：更新时间, num: 购买数量
+            req.type = "fixed"
+            req.page_size = page_size
+            req.page_no = 1
+            req.use_has_next = "true"
+            if open_id:
+                req.buyer_open_uid = open_id
+            if start_modified == "":
+                start_timestamp = TimeHelper.get_now_timestamp() - 90 * 24 * 60 * 60
+                start_modified = TimeHelper.timestamp_to_format_time(start_timestamp)
+            req.start_modified = start_modified
+            if end_modified != "":
+                req.end_modified = end_modified
+            while has_next:
+                resp = req.getResponse(access_token)
+                if is_log:
+                    log_info = str(resp) + "【access_token】：" + access_token + "【获取退单订单】"
+                    if self.context:
+                        self.context.logging_link_info(log_info)
+                elif self.logging_link_info:
+                    self.logging_link_info(log_info)
+                if "refunds_receive_get_response" in resp.keys():
+                    if "refunds" in resp["refunds_receive_get_response"].keys():
+                        all_order = all_order + resp["refunds_receive_get_response"]["refunds"]["refund"]
+                    req.page_no += 1
+                    has_next = resp["refunds_receive_get_response"]["has_next"]
+            invoke_result_data.data = all_order
+            return invoke_result_data
+        except Exception as ex:
+            if self.context:
+                self.context.logging_link_error(traceback.format_exc())
+            elif self.logging_link_error:
+                self.logging_link_error(traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.data = []
+            if "submsg" in str(ex):
+                content_list = str(ex).split()
+                for content in content_list:
+                    if "submsg=该子帐号无此操作权限" in content:
+                        invoke_result_data.error_code = "no_power"
+                        invoke_result_data.error_message = content[len("submsg="):]
+                        return invoke_result_data
+                    if "submsg=" in content:
+                        invoke_result_data.error_code = "error"
+                        invoke_result_data.error_message = content[len("submsg="):]
+                        return invoke_result_data
+            return invoke_result_data
+
+    def online_app(self, app_id, template_id, template_version, app_version, access_token, app_key, app_secret, is_log=False):
+        """
+        :description: app上线
+        :param app_id：app_id
+        :param template_id：模板id
+        :param template_version：模板版本
+        :param app_version：app版本
+        :param access_token：access_token
+        :param app_key:app_key
+        :param app_secret:app_secret
+        :param is_log：是否记录返回信息
+        :return InvokeResultData
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        try:
+            top.setDefaultAppInfo(app_key, app_secret)
+            req = top.api.MiniappTemplateOnlineappRequest()
+
+            req.clients = share_config.get_value("instantiate_clients","taobao,tmall")
+            req.app_id = app_id
+            req.template_id = template_id
+            req.template_version = template_version
+            req.app_version = app_version
+            resp = req.getResponse(access_token)
+            if is_log:
+                log_info = str(resp) + "【access_token】：" + access_token + "【app上线】"
+                if self.context:
+                    self.context.logging_link_info(log_info)
+                elif self.logging_link_info:
+                    self.logging_link_info(log_info)
+            invoke_result_data.data = resp
+            return invoke_result_data
+        except Exception as ex:
+            if self.context:
+                self.context.logging_link_error(traceback.format_exc())
+            elif self.logging_link_error:
+                self.logging_link_error(traceback.format_exc())
+            invoke_result_data.success = False
+            if "submsg" in str(ex):
+                content_list = str(ex).split()
+                for content in content_list:
+                    if "submsg=该子帐号无此操作权限" in content:
+                        invoke_result_data.error_code = "no_power"
+                        invoke_result_data.error_message = content[len("submsg="):]
+                        return invoke_result_data
+                    if "submsg=" in content:
+                        invoke_result_data.error_code = "error"
+                        invoke_result_data.error_message = content[len("submsg="):]
+                        return invoke_result_data
+            return invoke_result_data
+
+    def get_shop(self, access_token, app_key, app_secret, is_log=False):
+        """
+        :description: 获取店铺信息
+        :param access_token：access_token
+        :param app_key：app_key
+        :param app_secret：app_secret
+        :param is_log：是否记录返回信息
+        :return: InvokeResultData
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        try:
+            top.setDefaultAppInfo(app_key, app_secret)
+            req = top.api.ShopSellerGetRequest()
+            req.fields = "sid,title,pic_path"
+            resp = req.getResponse(access_token)
+            if is_log:
+                log_info = str(resp) + "【access_token】：" + access_token + "【获取店铺信息】"
+                if self.context:
+                    self.context.logging_link_info(log_info)
+                elif self.logging_link_info:
+                    self.logging_link_info(log_info)
+            invoke_result_data.data = resp
+            return invoke_result_data
+        except Exception as ex:
+            if self.context:
+                self.context.logging_link_error(traceback.format_exc())
+            elif self.logging_link_error:
+                self.logging_link_error(traceback.format_exc())
+            invoke_result_data.success = False
+            if "submsg" in str(ex):
+                content_list = str(ex).split()
+                for content in content_list:
+                    if "submsg=该子帐号无此操作权限" in content:
+                        invoke_result_data.error_code = "no_power"
+                        invoke_result_data.error_message = content[len("submsg="):]
+                        return invoke_result_data
+                    if "submsg=" in content:
+                        invoke_result_data.error_code = "error"
+                        invoke_result_data.error_message = content[len("submsg="):]
+                        return invoke_result_data
+            return invoke_result_data
+
+    def get_user_seller(self, access_token, app_key, app_secret, is_log=False):
+        """
+        :description: 获取关注店铺用户信息
+        :param access_token：access_token
+        :param app_key：app_key
+        :param app_secret：app_secret
+        :param is_log：是否记录返回信息
+        :return: InvokeResultData
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        try:
+            top.setDefaultAppInfo(app_key, app_secret)
+            req = top.api.UserSellerGetRequest()
+            req.fields = "user_id,nick,sex"
+            resp = req.getResponse(access_token)
+            if is_log:
+                log_info = str(resp) + "【access_token】：" + access_token + "【获取关注店铺用户信息】"
+                if self.context:
+                    self.context.logging_link_info(log_info)
+                elif self.logging_link_info:
+                    self.logging_link_info(log_info)
+            invoke_result_data.data = resp
+            return invoke_result_data
+        except Exception as ex:
+            if self.context:
+                self.context.logging_link_error(traceback.format_exc())
+            elif self.logging_link_error:
+                self.logging_link_error(traceback.format_exc())
+            invoke_result_data.success = False
+            if "submsg" in str(ex):
+                content_list = str(ex).split()
+                for content in content_list:
+                    if "submsg=该子帐号无此操作权限" in content:
+                        invoke_result_data.error_code = "no_power"
+                        invoke_result_data.error_message = content[len("submsg="):]
+                        return invoke_result_data
+                    if "submsg=" in content:
+                        invoke_result_data.error_code = "error"
+                        invoke_result_data.error_message = content[len("submsg="):]
+                        return invoke_result_data
+            return invoke_result_data
+
+    def get_dead_date(self, user_nick, access_token, app_key, app_secret, is_log=False):
+        """
+        :description: 获取订购过期时间
+        :param user_nick：用户昵称
+        :param access_token：access_token
+        :param app_key:app_key
+        :param app_secret:app_secret
+        :param is_log：是否记录返回信息
+        :return InvokeResultData
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        try:
+            vas_subscribe_get_response = self.get_vas_subscribe(user_nick, access_token, app_key, app_secret, is_log)
+            if not vas_subscribe_get_response:
+                invoke_result_data.data = "expire"
+                return invoke_result_data
+            if "article_user_subscribe" not in vas_subscribe_get_response["article_user_subscribes"].keys():
+                invoke_result_data.data = "expire"
+                return invoke_result_data
+            invoke_result_data.data = vas_subscribe_get_response["article_user_subscribes"]["article_user_subscribe"][0]["deadline"]
+            return invoke_result_data
+        except Exception as ex:
+            if self.context:
+                self.context.logging_link_error(traceback.format_exc())
+            elif self.logging_link_error:
+                self.logging_link_error(traceback.format_exc())
+            invoke_result_data.success = False
+            if "submsg" in str(ex):
+                content_list = str(ex).split()
+                for content in content_list:
+                    if "submsg=该子帐号无此操作权限" in content:
+                        invoke_result_data.error_code = "no_power"
+                        invoke_result_data.error_message = content[len("submsg="):]
+                        return invoke_result_data
+                    if "submsg=" in content:
+                        invoke_result_data.error_code = "error"
+                        invoke_result_data.error_message = content[len("submsg="):]
+                        return invoke_result_data
+            return invoke_result_data
+
+    def get_goods_list_by_goodsids(self, num_iids, access_token,app_key, app_secret, field="num_iid,title,nick,pic_url,price,input_str,property_alias,sku,props_name,outer_id,prop_img",is_log=False):
+        """
+        :description: 获取在售商品列表(num_iids上限20个，超过淘宝会报错)
+        :param num_iids：商品id列表
+        :param access_token：access_token
+        :param app_key:app_key
+        :param app_secret:app_secret
+        :param field：返回字段
+        :param is_log：是否记录返回信息
+        :return InvokeResultData
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        num_iid_list = num_iids.split(',')
+        page_size = 20
+        page_count = int(len(num_iid_list) / page_size) if len(num_iid_list) % page_size == 0 else int(len(num_iid_list) / page_size) + 1
+        goods_list = []
+        for i in range(0, page_count):
+            cur_num_iids = ",".join(num_iid_list[i * page_size:page_size * (i + 1)])
+            try:
+                top.setDefaultAppInfo(app_key, app_secret)
+                req = top.api.ItemsSellerListGetRequest()
+                req.fields = field
+                req.num_iids = cur_num_iids
+                resp = req.getResponse(access_token)
+                if is_log:
+                    log_info = str(resp) + "【access_token】：" + access_token + "【获取在售商品列表by_goodsids】"
+                    if self.context:
+                        self.context.logging_link_info(log_info)
+                    elif self.logging_link_info:
+                        self.logging_link_info(log_info)
+
+                if "items_seller_list_get_response" in resp.keys():
+                    if "items" in resp["items_seller_list_get_response"].keys():
+                        if "item" in resp["items_seller_list_get_response"]["items"].keys():
+                            goods_list.extend(resp["items_seller_list_get_response"]["items"]["item"])
+            except Exception as ex:
+                if self.context:
+                    self.context.logging_link_error(traceback.format_exc())
+                elif self.logging_link_error:
+                    self.logging_link_error(traceback.format_exc())
+                invoke_result_data.success = False
+                if "submsg" in str(ex):
+                    content_list = str(ex).split()
+                    for content in content_list:
+                        if "submsg=该子帐号无此操作权限" in content:
+                            invoke_result_data.error_code = "no_power"
+                            invoke_result_data.error_message = content[len("submsg="):]
+                            return invoke_result_data
+                        if "submsg=num_iid有误，必须大于0" in content:
+                            invoke_result_data.error_code = "param_error"
+                            invoke_result_data.error_message = content[len("submsg="):]
+                            return invoke_result_data
+                        if "submsg=" in content:
+                            invoke_result_data.error_code = "error"
+                            invoke_result_data.error_message = content[len("submsg="):]
+                            return invoke_result_data
+                return invoke_result_data
+        invoke_result_data.data = {"items_seller_list_get_response": {"items": {"item": goods_list}}}
+        return invoke_result_data
+
+    def get_goods_list(self, page_index, page_size, goods_name, order_tag, order_by, access_token,app_key, app_secret, field="num_iid,title,nick,price,input_str,property_alias,sku,props_name,pic_url", is_log=False):
+        """
+        :description: 获取在售商品列表（获取当前会话用户出售中的商品列表）
+        :param page_index：页索引
+        :param page_size：页大小
+        :param goods_name：商品名称
+        :param order_tag：order_tag
+        :param order_by：排序类型
+        :param access_token：access_token
+        :param app_key:app_key
+        :param app_secret:app_secret
+        :param field:查询字段
+        :param is_log：是否记录返回信息
+        :return InvokeResultData
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+
+        try:
+            top.setDefaultAppInfo(app_key, app_secret)
+            req = top.api.ItemsOnsaleGetRequest()
+            req.fields = field
+            req.page_no = page_index + 1
+            req.page_size = page_size
+            if goods_name != "":
+                req.q = goods_name
+            if order_tag !="" and order_by !="":
+                req.order_by = order_tag + ":" + order_by
+            resp = req.getResponse(access_token)
+            if is_log:
+                log_info = str(resp) + "【access_token】：" + access_token + "【获取在售商品列表】"
+                if self.context:
+                    self.context.logging_link_info(log_info)
+                elif self.logging_link_info:
+                    self.logging_link_info(log_info)
+            if resp:
+                resp["pageSize"] = page_size
+                resp["pageIndex"] = page_index
+            invoke_result_data.data = resp
+            return invoke_result_data
+        except Exception as ex:
+            if self.context:
+                self.context.logging_link_error(traceback.format_exc())
+            elif self.logging_link_error:
+                self.logging_link_error(traceback.format_exc())
+            invoke_result_data.success = False
+            if "submsg" in str(ex):
+                content_list = str(ex).split()
+                for content in content_list:
+                    if "submsg=该子帐号无此操作权限" in content:
+                        invoke_result_data.error_code = "no_power"
+                        invoke_result_data.error_message = content[len("submsg="):]
+                        return invoke_result_data
+                    if "submsg=" in content:
+                        invoke_result_data.error_code = "error"
+                        invoke_result_data.error_message = content[len("submsg="):]
+                        return invoke_result_data
+            return invoke_result_data
+
+    def get_goods_info(self, num_iid, access_token,app_key, app_secret, field="num_iid,title,nick,pic_url,price,item_img.url,outer_id,sku,approve_status,prop_img", is_log=False):
+        """
+        :description: 获取单个商品详细信息
+        :param num_iid：num_iid
+        :param access_token：access_token
+        :param app_key:app_key
+        :param app_secret:app_secret
+        :param field：查询字段
+        :param is_log：是否记录返回信息
+        :return InvokeResultData
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        try:
+            top.setDefaultAppInfo(app_key, app_secret)
+            req = top.api.ItemSellerGetRequest()
+
+            req.fields = field
+            req.num_iid = num_iid
+            resp = req.getResponse(access_token)
+            if is_log:
+                log_info = str(resp) + "【access_token】：" + access_token + "【获取单个商品详细信息】"
+                if self.context:
+                    self.context.logging_link_info(log_info)
+                elif self.logging_link_info:
+                    self.logging_link_info(log_info)
+            invoke_result_data.data = resp
+            return invoke_result_data
+        except Exception as ex:
+            if self.context:
+                self.context.logging_link_error(traceback.format_exc())
+            elif self.logging_link_error:
+                self.logging_link_error(traceback.format_exc())
+            invoke_result_data.success = False
+            if "submsg" in str(ex):
+                content_list = str(ex).split()
+                for content in content_list:
+                    if "submsg=该子帐号无此操作权限" in content:
+                        invoke_result_data.error_code = "no_power"
+                        invoke_result_data.error_message = content[len("submsg="):]
+                        return invoke_result_data
+                    if "submsg=" in content:
+                        invoke_result_data.error_code = "error"
+                        invoke_result_data.error_message = content[len("submsg="):]
+                        return invoke_result_data
+            return invoke_result_data
+
+    def get_goods_inventory_list(self, page_index, page_size, goods_name, order_tag, order_by, access_token,app_key, app_secret, field="num_iid,title,nick,price,input_str,property_alias,sku,props_name,pic_url", is_log=False):
+        """
+        :description: 获取仓库商品列表（获取当前用户作为卖家的仓库中的商品列表）
+        :param page_index：页索引
+        :param page_size：页大小
+        :param goods_name：商品名称
+        :param order_tag：order_tag
+        :param order_by：排序类型
+        :param access_token：access_token
+        :param app_key:app_key
+        :param app_secret:app_secret
+        :param field：查询字段
+        :param is_log：是否记录返回信息
+        :return InvokeResultData
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        try:
+            top.setDefaultAppInfo(app_key, app_secret)
+            req = top.api.ItemsInventoryGetRequest()
+
+            req.fields = field
+            req.page_no = page_index
+            req.page_size = page_size
+            if goods_name != "":
+                req.q = goods_name
+            req.order_by = order_tag + ":" + order_by
+
+            resp = req.getResponse(access_token)
+            if resp:
+                resp["pageSize"] = page_size
+                resp["pageIndex"] = page_index
+            if is_log:
+                log_info = str(resp) + "【access_token】：" + access_token+ "【获取仓库商品列表】"
+                if self.context:
+                    self.context.logging_link_info(log_info)
+                elif self.logging_link_info:
+                    self.logging_link_info(log_info)
+            invoke_result_data.data = resp
+            return invoke_result_data
+        except Exception as ex:
+            if self.context:
+                self.context.logging_link_error(traceback.format_exc())
+            elif self.logging_link_error:
+                self.logging_link_error(traceback.format_exc())
+            invoke_result_data.success = False
+            if "submsg" in str(ex):
+                content_list = str(ex).split()
+                for content in content_list:
+                    if "submsg=该子帐号无此操作权限" in content:
+                        invoke_result_data.error_code = "no_power"
+                        invoke_result_data.error_message = content[len("submsg="):]
+                        return invoke_result_data
+                    if "submsg=" in content:
+                        invoke_result_data.error_code = "error"
+                        invoke_result_data.error_message = content[len("submsg="):]
+                        return invoke_result_data
+            return invoke_result_data
+
+    def miniapp_distribution_items_bind(self, goods_ids, url, status, access_token, app_key, app_secret, is_log=False):
+        """
+        :description: 小程序投放-商品绑定/解绑（提供给使用了投放插件的服务商，可以调用该API实现帮助商家更新已创建的投放单中的绑定商品信息。）
+        :param goods_ids：商品id列表逗号，分隔
+        :param url：投放的商家应用完整链接
+        :param status：true表示新增绑定，false表示解绑
+        :param access_token:access_token
+        :param app_key:app_key
+        :param app_secret:app_secret
+        :param is_log：是否记录返回信息
+        :return InvokeResultData
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        try:
+            top.setDefaultAppInfo(app_key, app_secret)
+            req = top.api.MiniappDistributionItemsBindRequest()
+
+            req.target_entity_list = goods_ids
+            req.url = url
+            req.add_bind = status
+            resp = req.getResponse(access_token)
+            if is_log:
+                log_info = str(resp) + "【access_token】：" + access_token + "【小程序投放商品】"
+                if self.context:
+                    self.context.logging_link_info(log_info)
+                elif self.logging_link_info:
+                    self.logging_link_info(log_info)
+            invoke_result_data.data = resp
+            return invoke_result_data
+        except Exception as ex:
+            if self.context:
+                self.context.logging_link_error(traceback.format_exc())
+            elif self.logging_link_error:
+                self.logging_link_error(traceback.format_exc())
+            invoke_result_data.success = False
+            if "submsg" in str(ex):
+                content_list = str(ex).split()
+                for content in content_list:
+                    if "submsg=该子帐号无此操作权限" in content:
+                        invoke_result_data.error_code = "no_power"
+                        invoke_result_data.error_message = content[len("submsg="):]
+                        return invoke_result_data
+                    if "submsg=" in content:
+                        invoke_result_data.error_code = "error"
+                        invoke_result_data.error_message = content[len("submsg="):]
+                        return invoke_result_data
+            return invoke_result_data
+
+    def miniapp_distribution_order_get(self, order_id_list, access_token, app_key, app_secret, is_log=False):
+        """
+        :description: 小程序投放-查询小程序投放计划信息
+        :param order_id_list:投放计划的id列表 示例值：[1,2,3]
+        :param access_token:access_token
+        :param app_key:app_key
+        :param app_secret:app_secret
+        :param is_log：是否记录返回信息
+        :return InvokeResultData
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        try:
+            top.setDefaultAppInfo(app_key, app_secret)
+            req = top.api.MiniappDistributionOrderGetRequest()
+            req.order_id_request = {}
+            req.order_id_request["order_id_list"] = order_id_list
+            resp = req.getResponse(access_token)
+            if is_log:
+                log_info = str(resp) + "【access_token】：" + access_token + "【查询小程序投放计划】"
+                if self.context:
+                    self.context.logging_link_info(log_info)
+                elif self.logging_link_info:
+                    self.logging_link_info(log_info)
+            invoke_result_data.data = resp
+            return invoke_result_data
+
+        except Exception as ex:
+            if self.context:
+                self.context.logging_link_error(traceback.format_exc())
+            elif self.logging_link_error:
+                self.logging_link_error(traceback.format_exc())
+            invoke_result_data.success = False
+            if "submsg" in str(ex):
+                content_list = str(ex).split()
+                for content in content_list:
+                    if "submsg=该子帐号无此操作权限" in content:
+                        invoke_result_data.error_code = "no_power"
+                        invoke_result_data.error_message = content[len("submsg="):]
+                        return invoke_result_data
+                    if "submsg=" in content:
+                        invoke_result_data.error_code = "error"
+                        invoke_result_data.error_message = content[len("submsg="):]
+                        return invoke_result_data
+            return invoke_result_data
+    
+    def alibaba_benefit_query(self, right_ename, access_token, app_key, app_secret, is_log=False):
+        """
+        :description: 查询优惠券详情信息
+        :param right_ename:奖池ID
+        :param access_token:access_token
+        :param app_key:app_key
+        :param app_secret:app_secret
+        :param is_log：是否记录返回信息
+        :return: InvokeResultData
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        try:
+            top.setDefaultAppInfo(app_key, app_secret)
+            req = top.api.AlibabaBenefitQueryRequest()
+            req.ename = right_ename
+            req.app_name = "promotioncenter-" + share_config.get_value("server_template_id")
+            req.award_type = "1"
+            resp = req.getResponse(access_token)
+            if is_log:
+                log_info = str(resp) + "【access_token】：" + access_token + "【查询优惠券详情信息】"
+                if self.context:
+                    self.context.logging_link_info(log_info)
+                elif self.logging_link_info:
+                    self.logging_link_info(log_info)
+            invoke_result_data.data = resp
+            return invoke_result_data
+        except Exception as ex:
+            if self.context:
+                self.context.logging_link_error(traceback.format_exc())
+            elif self.logging_link_error:
+                self.logging_link_error(traceback.format_exc())
+            invoke_result_data.success = False
+            if "submsg" in str(ex):
+                content_list = str(ex).split()
+                for content in content_list:
+                    if "submsg=该子帐号无此操作权限" in content:
+                        invoke_result_data.error_code = "no_power"
+                        invoke_result_data.error_message = content[len("submsg="):]
+                        return invoke_result_data
+                    if "submsg=" in content:
+                        invoke_result_data.error_code = "error"
+                        invoke_result_data.error_message = content[len("submsg="):]
+                        return invoke_result_data
+            return invoke_result_data
+
+    def alibaba_benefit_send(self, right_ename, open_id, access_token,app_key, app_secret, is_log=False):
+        """
+        :description: 发放优惠劵
+        :param right_ename:奖池ID
+        :param open_id:open_id
+        :param access_token:access_token
+        :param app_key:app_key
+        :param app_secret:app_secret
+        :param is_log：是否记录返回信息
+        :return: InvokeResultData
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        try:
+            top.setDefaultAppInfo(app_key, app_secret)
+            req = top.api.AlibabaBenefitSendRequest()
+            req.right_ename = right_ename
+            req.receiver_id = open_id
+            req.user_type = "taobao"
+            req.unique_id = str(open_id) + str(right_ename) + str(TimeHelper.get_now_timestamp())
+            req.app_name = "promotioncenter-" + share_config.get_value("server_template_id")
+            resp = req.getResponse(access_token)
+            if is_log:
+                log_info = str(resp) + "【access_token】：" + access_token + "【发放优惠劵】"
+                if self.context:
+                    self.context.logging_link_info(log_info)
+                elif self.logging_link_info:
+                    self.logging_link_info(log_info)
+            invoke_result_data.data = resp
+            return invoke_result_data
+        except Exception as ex:
+            if self.context:
+                self.context.logging_link_error(traceback.format_exc())
+            elif self.logging_link_error:
+                self.logging_link_error(traceback.format_exc())
+            invoke_result_data.success = False
+            if "submsg" in str(ex):
+                content_list = str(ex).split()
+                for content in content_list:
+                    if "submsg=该子帐号无此操作权限" in content:
+                        invoke_result_data.error_code = "no_power"
+                        invoke_result_data.error_message = content[len("submsg="):]
+                        return invoke_result_data
+                    if "submsg=" in content:
+                        invoke_result_data.error_code = "error"
+                        invoke_result_data.error_message = content[len("submsg="):]
+                        return invoke_result_data
+            return invoke_result_data
+
+    def get_member_info(self, mix_nick, nick, access_token, app_key, app_secret, is_log=False):
+        """
+        :description: 获取淘宝会员信息
+        :param mix_nick:mix_nick
+        :param nick:nick（淘宝废弃使用）
+        :param access_token:access_token
+        :param app_key:app_key
+        :param app_secret:app_secret
+        :param is_log：是否记录返回信息
+        :return:InvokeResultData
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        try:
+            top.setDefaultAppInfo(app_key, app_secret)
+            req = top.api.CrmMemberIdentityGetRequest()
+            if mix_nick:
+                req.mix_nick = mix_nick
+            if nick:
+                req.nick = nick
+            resp = req.getResponse(access_token)
+            if is_log:
+                log_info = str(resp) + "【access_token】：" + access_token + "【获取淘宝会员信息】"
+                if self.context:
+                    self.context.logging_link_info(log_info)
+                elif self.logging_link_info:
+                    self.logging_link_info(log_info)
+            invoke_result_data.data = resp
+            return invoke_result_data
+        except Exception as ex:
+            if self.context:
+                self.context.logging_link_error(traceback.format_exc())
+            elif self.logging_link_error:
+                self.logging_link_error(traceback.format_exc())
+            invoke_result_data.success = False
+            if "submsg" in str(ex):
+                content_list = str(ex).split()
+                for content in content_list:
+                    if "submsg=该子帐号无此操作权限" in content:
+                        invoke_result_data.error_code = "no_power"
+                        invoke_result_data.error_message = content[len("submsg="):]
+                        return invoke_result_data
+                    if "submsg=" in content:
+                        invoke_result_data.error_code = "error"
+                        invoke_result_data.error_message = content[len("submsg="):]
+                        return invoke_result_data
+            return invoke_result_data
+
+    def check_is_member(self, mix_nick, nick, access_token, app_key, app_secret, is_log=False):
+        """
+        :description: 实时查询当前是否店铺会员
+        :param mix_nick:mix_nick
+        :param nick:nick（淘宝废弃使用）
+        :param access_token:access_token
+        :param app_key:app_key
+        :param app_secret:app_secret
+        :param is_log：是否记录返回信息
+        :return:True是会员 False不是会员
+        :last_editors: HuangJianYi
+        """
+        is_member = False
+        invoke_result_data = self.get_member_info(mix_nick, nick, access_token, app_key, app_secret, is_log)
+        if invoke_result_data.success == False:
+            return is_member
+        resp = invoke_result_data.data
+        if "crm_member_identity_get_response" in resp.keys():
+            if "result" in resp["crm_member_identity_get_response"].keys():
+                if "member_info" in resp["crm_member_identity_get_response"]["result"].keys():
+                    is_member = True
+        return is_member
+    
+    def get_member_grade(self, mix_nick, access_token, app_key, app_secret, is_log=False):
+        """
+        :description: 查询会员等级
+        :param mix_nick:mix_nick
+        :param access_token:access_token
+        :param app_key:app_key
+        :param app_secret:app_secret
+        :param is_log：是否记录返回信息
+        :return:会员信息
+        :last_editors: HuangJianYi
+        """
+        member_info = {}
+        invoke_result_data = self.get_member_info(mix_nick,'', access_token, app_key, app_secret, is_log)
+        if invoke_result_data.success == False:
+            return invoke_result_data
+        resp = invoke_result_data.data
+        if "crm_member_identity_get_response" in resp.keys():
+                if "result" in resp["crm_member_identity_get_response"].keys():
+                    if "member_info" in resp["crm_member_identity_get_response"]["result"].keys():
+                        if "grade" in resp["crm_member_identity_get_response"]["result"]["member_info"].keys() and "grade_name" in resp["crm_member_identity_get_response"]["result"]["member_info"].keys():
+                            member_info = resp["crm_member_identity_get_response"]["result"]["member_info"]
+        
+        invoke_result_data.data = member_info
+        return invoke_result_data
+
+    def get_join_member_url(self, access_token, app_key, app_secret, is_log=False):
+        """
+        :description: 获取加入会员地址
+        :param access_token:access_token
+        :param app_key:app_key
+        :param app_secret:app_secret
+        :param is_log：是否记录返回信息
+        :return:InvokeResultData
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        try:
+            top.setDefaultAppInfo(app_key, app_secret)
+            req = top.api.CrmMemberJoinurlGetRequest()
+            req.callback_url = ""
+            req.extra_info = "{\"source\":\"isvapp\",\"activityId\":\"\",\"entrance\":\"hudong\"}"
+            resp = req.getResponse(access_token)
+            if is_log:
+                log_info = str(resp) + "【access_token】：" + access_token + "【获取加入会员地址】"
+                if self.context:
+                    self.context.logging_link_info(log_info)
+                elif self.logging_link_info:
+                    self.logging_link_info(log_info)
+            if "crm_member_joinurl_get_response" in resp.keys():
+                if "result" in resp["crm_member_joinurl_get_response"].keys():
+                    if "result" in resp["crm_member_joinurl_get_response"]["result"].keys():
+                        invoke_result_data.data = resp["crm_member_joinurl_get_response"]["result"]["result"]
+                        if invoke_result_data.data and "https:" not in invoke_result_data.data and "http:" not in invoke_result_data.data:
+                            invoke_result_data.data = "https:" + invoke_result_data.data
+                        return invoke_result_data
+            else:
+                invoke_result_data.data = ""
+                return invoke_result_data
+        except Exception as ex:
+            if self.context:
+                self.context.logging_link_error(traceback.format_exc())
+            elif self.logging_link_error:
+                self.logging_link_error(traceback.format_exc())
+            invoke_result_data.success = False
+            if "submsg" in str(ex):
+                content_list = str(ex).split()
+                for content in content_list:
+                    if "submsg=该子帐号无此操作权限" in content:
+                        invoke_result_data.error_code = "no_power"
+                        invoke_result_data.error_message = content[len("submsg="):]
+                        return invoke_result_data
+                    if "submsg=" in content:
+                        invoke_result_data.error_code = "error"
+                        invoke_result_data.error_message = content[len("submsg="):]
+                        return invoke_result_data
+            return invoke_result_data
+
+    def open_trade_special_items_query(self, app_id, access_token, app_key, app_secret, is_log=False):
+        """
+        :description: 专属下单查询
+        :param app_id：app_id
+        :param access_token：access_token
+        :param app_key:app_key
+        :param app_secret:app_secret
+        :param is_log：是否记录返回信息
+        :return InvokeResultData
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        resp = {}
+        try:
+            top.setDefaultAppInfo(app_key, app_secret)
+            req = top.api.OpentradeSpecialItemsQueryRequest()
+            req.miniapp_id = app_id
+            resp = req.getResponse(access_token)
+            if is_log:
+                log_info = str(resp) + "【access_token】：" + access_token + "【专属下单查询】"
+                if self.context:
+                    self.context.logging_link_info(log_info)
+                elif self.logging_link_info:
+                    self.logging_link_info(log_info)
+            invoke_result_data.data = resp
+            return invoke_result_data
+        except Exception as ex:
+            if self.context:
+                self.context.logging_link_error(traceback.format_exc())
+            elif self.logging_link_error:
+                self.logging_link_error(traceback.format_exc())
+            invoke_result_data.success = False
+            if "submsg" in str(ex):
+                content_list = str(ex).split()
+                for content in content_list:
+                    if "submsg=该子帐号无此操作权限" in content:
+                        invoke_result_data.error_code = "no_power"
+                        invoke_result_data.error_message = content[len("submsg="):]
+                        return invoke_result_data
+                    if "submsg=" in content:
+                        invoke_result_data.error_code = "error"
+                        invoke_result_data.error_message = content[len("submsg="):]
+                        return invoke_result_data
+            return invoke_result_data
+
+    def open_trade_special_userk_mark(self, goods_id, open_id, access_token, app_key, app_secret, is_log=False):
+        """
+        :description: 专属下单可购买用户标记
+        :param goods_id：商品id
+        :param open_id：open_id
+        :param access_token：access_token
+        :param app_key:app_key
+        :param app_secret:app_secret
+        :param is_log：是否记录返回信息
+        :return 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        try:
+            top.setDefaultAppInfo(app_key, app_secret)
+            req = top.api.OpentradeSpecialUsersMarkRequest()
+            req.hit = "true"
+            req.open_user_ids = str(open_id)
+            req.item_id = int(goods_id)
+            req.sku_id = 0
+            req.status = "MARK"
+            req.limit_num = 1
+            resp = req.getResponse(access_token)
+            if is_log:
+                log_info = str(resp) + "【access_token】：" + access_token + "【专属下单可购买用户标记】"
+                if self.context:
+                    self.context.logging_link_info(log_info)
+                elif self.logging_link_info:
+                    self.logging_link_info(log_info)
+            if resp and resp["opentrade_special_users_mark_response"]["result"] == 1:
+                #  ------------ TopOpentradeSpecialUserMark: {'opentrade_special_users_mark_response': {'result': 1, 'request_id': 'rsk23xhlk310'}}
+                invoke_result_data.data = True
+            else:
+                invoke_result_data.data = False
+            return invoke_result_data
+
+        except Exception as ex:
+            if self.context:
+                self.context.logging_link_error(traceback.format_exc())
+            elif self.logging_link_error:
+                self.logging_link_error(traceback.format_exc())
+            invoke_result_data.success = False
+            if "submsg" in str(ex):
+                content_list = str(ex).split()
+                for content in content_list:
+                    if "submsg=该子帐号无此操作权限" in content:
+                        invoke_result_data.error_code = "no_power"
+                        invoke_result_data.error_message = content[len("submsg="):]
+                        return invoke_result_data
+                    if "submsg=" in content:
+                        invoke_result_data.error_code = "error"
+                        invoke_result_data.error_message = content[len("submsg="):]
+                        return invoke_result_data
+            return invoke_result_data
+
+    def open_trade_special_items_bind(self, app_id, goods_id, access_token, app_key, app_secret, is_log=False):
+        """
+        :description: 专属下单商品绑定
+        :param app_id：app_id
+        :param goods_id：goods_id
+        :param access_token：access_token
+        :param app_key:app_key
+        :param app_secret:app_secret
+        :param is_log：是否记录返回信息
+        :return 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        try:
+            top.setDefaultAppInfo(app_key, app_secret)
+            req = top.api.OpentradeSpecialItemsBindRequest()
+
+            req.miniapp_id = app_id
+            req.item_ids = str(goods_id)
+            resp = req.getResponse(access_token)
+            if is_log:
+                log_info = str(resp) + "【access_token】：" + access_token + "【专属下单商品绑定】"
+                if self.context:
+                    self.context.logging_link_info(log_info)
+                elif self.logging_link_info:
+                    self.logging_link_info(log_info)
+            # {'opentrade_special_items_bind_response': {'results': {'item_bind_result': [{'bind_ok': False, 'error_message': '商品已绑定到小程序:情之缘1993_好货跳一跳_[3000000029278805]', 'item_id': 632007280726}]}, 'request_id': 'zrq8mt8d8xdo'}}
+            if resp["opentrade_special_items_bind_response"]["results"]["item_bind_result"][0]:
+                if not resp["opentrade_special_items_bind_response"]["results"]["item_bind_result"][0]["bind_ok"]:
+                    invoke_result_data.success = False
+                    invoke_result_data.error_code = "error"
+                    invoke_result_data.error_message = resp["opentrade_special_items_bind_response"]["results"]["item_bind_result"][0]["error_message"]
+            return invoke_result_data
+        except Exception as ex:
+            if self.context:
+                self.context.logging_link_error(traceback.format_exc())
+            elif self.logging_link_error:
+                self.logging_link_error(traceback.format_exc())
+            invoke_result_data.success = False
+            if "submsg" in str(ex):
+                content_list = str(ex).split()
+                for content in content_list:
+                    if "submsg=该子帐号无此操作权限" in content:
+                        invoke_result_data.error_code = "no_power"
+                        invoke_result_data.error_message = content[len("submsg="):]
+                        return invoke_result_data
+                    if "submsg=" in content:
+                        invoke_result_data.error_code = "error"
+                        invoke_result_data.error_message = content[len("submsg="):]
+                        return invoke_result_data
+            return invoke_result_data
+
+    def get_project_code(self, user_nick, access_token, app_key, app_secret, is_log=False):
+        """
+        :description: 获取项目编码
+        :param user_nick：用户昵称
+        :param access_token：access_token
+        :param app_key:app_key
+        :param app_secret:app_secret
+        :param is_log：是否记录返回信息
+        :return list
+        :last_editors: HuangJianYi
+        """
+        try:
+            vas_subscribe_get_response = self.get_vas_subscribe(user_nick, access_token, app_key, app_secret, is_log)
+            if not vas_subscribe_get_response:
+                return ""
+            if "article_user_subscribe" not in vas_subscribe_get_response["article_user_subscribes"].keys():
+                return ""
+            return vas_subscribe_get_response["article_user_subscribes"]["article_user_subscribe"][0]["item_code"]
+        except Exception as ex:
+            if self.context:
+                self.context.logging_link_error(traceback.format_exc())
+            elif self.logging_link_error:
+                self.logging_link_error(traceback.format_exc())
+            return ""
+
+    def get_vas_subscribe(self, user_nick, access_token, app_key, app_secret, is_log=False):
+        """
+        :description:订购关系查询 用于ISV根据登录进来的淘宝会员名查询该为该会员开通哪些收费项目，ISV只能查询自己名下的应用及收费项目的订购情况
+        :param user_nick：用户昵称
+        :param access_token：access_token
+        :param app_key:app_key
+        :param app_secret:app_secret
+        :param is_log：是否记录返回信息
+        :return 订购关系
+        :last_editors: HuangJianYi
+        """
+        try:
+            redis_init = SevenHelper.redis_init()
+            cache_key = f"get_vas_subscribe:{user_nick}"
+            vas_subscribe_get_response = redis_init.get(cache_key)
+            if vas_subscribe_get_response:
+                return json.loads(vas_subscribe_get_response)
+            top.setDefaultAppInfo(app_key, app_secret)
+            req = top.api.VasSubscribeGetRequest()
+            req.article_code = share_config.get_value("article_code")
+            req.nick = user_nick
+            resp = req.getResponse(access_token)
+            if is_log:
+                log_info = str(resp) + "【access_token】：" + access_token + "【订购关系查询】"
+                if self.context:
+                    self.context.logging_link_info(log_info)
+                elif self.logging_link_info:
+                    self.logging_link_info(log_info)
+            redis_init.set(cache_key, json.dumps(resp["vas_subscribe_get_response"]),5)
+            return resp["vas_subscribe_get_response"]
+        except Exception as ex:
+            if self.context:
+                self.context.logging_link_error(traceback.format_exc())
+            elif self.logging_link_error:
+                self.logging_link_error(traceback.format_exc())
+            return None
+
+    def get_short_url(self, url, access_token, app_key, app_secret, is_log=False):
+        """
+        :description: 获取短链接
+        :param url：链接地址
+        :param access_token：access_token
+        :param app_key:app_key
+        :param app_secret:app_secret
+        :param is_log：是否记录返回信息
+        :return 短链接地址
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        try:
+            top.setDefaultAppInfo(app_key, app_secret)
+            req = top.api.MiniappShorturlCreateRequest()
+            req.article_code = share_config.get_value("article_code")
+            req.miniapp_url = url
+            resp = req.getResponse(access_token)
+            if is_log:
+                log_info = str(resp) + "【access_token】：" + access_token + "【获取短链接】"
+                if self.context:
+                    self.context.logging_link_info(log_info)
+                elif self.logging_link_info:
+                    self.logging_link_info(log_info)
+            if "miniapp_shorturl_create_response" not in  resp:
+                invoke_result_data.success = False
+                return invoke_result_data
+            if "result" not in resp["miniapp_shorturl_create_response"]:
+                invoke_result_data.success = False
+                return invoke_result_data
+            if "model" not in resp["miniapp_shorturl_create_response"]["result"]:
+                invoke_result_data.success = False
+                return invoke_result_data
+            if "short_url" not in resp["miniapp_shorturl_create_response"]["result"]["model"]:
+                invoke_result_data.success = False
+                return invoke_result_data
+            invoke_result_data.data = resp["miniapp_shorturl_create_response"]["result"]["model"]["short_url"]
+            return invoke_result_data
+        except Exception as ex:
+            if self.context:
+                self.context.logging_link_error(traceback.format_exc())
+            elif self.logging_link_error:
+                self.logging_link_error(traceback.format_exc())
+            invoke_result_data.success = False
+            return invoke_result_data
+
+    def get_crm_point_available(self, mix_nick, access_token, app_key, app_secret, is_log=False, open_id=""):
+        """
+        :description: 获取店铺会员积分
+        :param mix_nick：混淆昵称
+        :param access_token：access_token
+        :param app_key:app_key
+        :param app_secret:app_secret
+        :param is_log：是否记录返回信息
+        :param open_id：open_id
+        :return 返回店铺会员积分
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        try:
+            top.setDefaultAppInfo(app_key, app_secret)
+            req = top.api.CrmPointAvailableGetRequest()
+            if mix_nick:
+                req.mix_nick = mix_nick
+            if open_id:
+                req.open_uid = open_id
+            resp = req.getResponse(access_token)
+            if is_log:
+                log_info = "【req】:" + SevenHelper.json_dumps(req) + "【resp】:" + str(resp) +  "【access_token】：" + access_token + "【获取店铺会员积分】"
+                if self.context:
+                    self.context.logging_link_info(log_info)
+                elif self.logging_link_info:
+                    self.logging_link_info(log_info)
+            if "crm_point_available_get_response" not in  resp:
+                invoke_result_data.success = False
+                return invoke_result_data
+            if "result" not in resp["crm_point_available_get_response"]:
+                invoke_result_data.success = False
+                return invoke_result_data
+            invoke_result_data.data = resp["crm_point_available_get_response"]["result"]
+            return invoke_result_data
+        except Exception as ex:
+            if self.context:
+                self.context.logging_link_error(traceback.format_exc())
+            elif self.logging_link_error:
+                self.logging_link_error(traceback.format_exc())
+            invoke_result_data.success = False
+            if "submsg" in str(ex):
+                content_list = str(ex).split()
+                for content in content_list:
+                    if "submsg=该子帐号无此操作权限" in content:
+                        invoke_result_data.error_code = "no_power"
+                        invoke_result_data.error_message = content[len("submsg="):]
+                        return invoke_result_data
+                    if "submsg=" in content:
+                        invoke_result_data.error_code = "error"
+                        invoke_result_data.error_message = content[len("submsg="):]
+                        return invoke_result_data
+            return invoke_result_data
+
+    def change_crm_point(self, open_id, mix_nick, change_type, opt_type, quantity, access_token, app_key, app_secret, activity_id=0, activity_name="", is_log=False):
+        """
+        :description: 操作店铺会员积分
+        :param open_id：买家open_id
+        :param mix_nick：混淆昵称
+        :param change_type：变更类型：0交易，1：互动活动，2：权益兑换，3：手工调整
+        :param opt_type：操作类型，0：增加，1：扣减
+        :param quantity：积分数量
+        :param access_token：access_token
+        :param app_key:app_key
+        :param app_secret:app_secret
+        :param activity_id：活动Id
+        :param activity_name：活动名称
+        :param is_log：是否记录返回信息
+        :return 返回操作结果
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        try:
+            top.setDefaultAppInfo(app_key, app_secret)
+            req = top.api.CrmPointChangeRequest()
+            if activity_id > 0:
+                req.activity_id = activity_id
+            if activity_name:
+                req.activity_name = activity_name
+            req.change_type = change_type
+            req.opt_type = opt_type
+            req.quantity = quantity
+            if open_id:
+                req.open_id = open_id
+            if mix_nick:
+                req.mix_nick = mix_nick
+            resp = req.getResponse(access_token)
+            if is_log:
+                log_info = "【req】:" + SevenHelper.json_dumps(req) + "【resp】:" + str(resp) + "【access_token】：" + access_token + "【操作店铺会员积分】"
+                if self.context:
+                    self.context.logging_link_info(log_info)
+                elif self.logging_link_info:
+                    self.logging_link_info(log_info)
+            if "crm_point_change_response" not in resp:
+                invoke_result_data.success = False
+                return invoke_result_data
+            if "result" not in resp["crm_point_change_response"]:
+                invoke_result_data.success = False
+                return invoke_result_data
+            invoke_result_data.data = resp["crm_point_change_response"]["result"]
+            return invoke_result_data
+        except Exception as ex:
+            if self.context:
+                self.context.logging_link_error(traceback.format_exc())
+            elif self.logging_link_error:
+                self.logging_link_error(traceback.format_exc())
+            invoke_result_data.success = False
+            if "submsg" in str(ex):
+                content_list = str(ex).split()
+                for content in content_list:
+                    if "submsg=该子帐号无此操作权限" in content:
+                        invoke_result_data.error_code = "no_power"
+                        invoke_result_data.error_message = content[len("submsg="):]
+                        return invoke_result_data
+                    if "submsg=" in content:
+                        invoke_result_data.error_code = "error"
+                        invoke_result_data.error_message = content[len("submsg="):]
+                        return invoke_result_data
+            return invoke_result_data
+
+    def miniapp_widget_template_instance_query(self, widget_template_id, access_token, app_key, app_secret, is_log=False):
+        """
+        :description: 查询淘宝小部件信息
+        :param widget_template_id：小部件模版id
+        :param access_token：access_token
+        :param app_key:app_key
+        :param app_secret:app_secret
+        :param is_log：是否记录返回信息
+        :return 小部件实例化信息
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        try:
+            top.setDefaultAppInfo(app_key, app_secret)
+            req = top.api.MiniappWidgetTemplateInstanceQueryRequest()
+            req.param0 = {}
+            req.param0["page_size"] = 20
+            req.param0["page_num"] = 1
+            req.param0["template_id"] = widget_template_id
+            resp = req.getResponse(access_token)
+            if is_log:
+                log_info = str(resp) + "【access_token】：" + access_token + "【查询淘宝小部件信息】"
+                if self.context:
+                    self.context.logging_link_info(log_info)
+                elif self.logging_link_info:
+                    self.logging_link_info(log_info)
+            return invoke_result_data
+
+        except Exception as ex:
+            if self.context:
+                self.context.logging_link_error(traceback.format_exc())
+            elif self.logging_link_error:
+                self.logging_link_error(traceback.format_exc())
+            invoke_result_data.success = False
+            if "submsg" in str(ex):
+                content_list = str(ex).split()
+                for content in content_list:
+                    if "submsg=该子帐号无此操作权限" in content:
+                        invoke_result_data.error_code = "no_power"
+                        invoke_result_data.error_message = content[len("submsg="):]
+                        return invoke_result_data
+                    if "submsg=" in content:
+                        invoke_result_data.error_code = "error"
+                        invoke_result_data.error_message = content[len("submsg="):]
+                        return invoke_result_data
+            return invoke_result_data
+        
+    def miniapp_widget_template_instantiate(self, template_version, description, widget_template_id, access_token, app_key, app_secret, is_log=False):
+        """
+        :description: 实例化小部件 resp={"miniapp_widget_template_instantiate_response": {"result": {"model": {"app_description": "提供商家会员权益集合", "app_icon": "https://ossgw.alicdn.com/taobao-miniapp/img/39eb12a3c266c7a8d72e8dcb1b6a1530.png", "app_name": "天志C店_会员身份卡片", "appkey": "400013325276", "id": "3000000070599924", "online_code": "https://m.duanqu.com/?_ariver_appid=3000000070599924&_mp_code=tb&transition=present", "online_version": "0.0.1"}, "success": True}, "request_id": "15rv0rkcwiqtn"}}
+        :param template_version：小部件版本
+        :param description：小部件描述
+        :param widget_template_id：小部件模版id
+        :param access_token：access_token
+        :param app_key:app_key
+        :param app_secret:app_secret
+        :param is_log：是否记录返回信息
+        :return 实例化后的信息
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        try:
+            top.setDefaultAppInfo(app_key, app_secret)
+            req = top.api.MiniappWidgetTemplateInstantiateRequest()
+            req.param_mini_app_instantiate_template_app_simple_request = {}
+            req.param_mini_app_instantiate_template_app_simple_request["template_id"] = widget_template_id
+            req.param_mini_app_instantiate_template_app_simple_request["template_version"] = template_version
+            req.param_mini_app_instantiate_template_app_simple_request["description"] = description
+            resp = req.getResponse(access_token)
+            if is_log:
+                log_info = str(resp) + "【access_token】：" + access_token + "【实例化小部件】"
+                if self.context:
+                    self.context.logging_link_info(log_info)
+                elif self.logging_link_info:
+                    self.logging_link_info(log_info)
+            if "miniapp_widget_template_instantiate_response" not in resp:
+                invoke_result_data.success = False
+                return invoke_result_data
+            if "result" not in resp["miniapp_widget_template_instantiate_response"]:
+                invoke_result_data.success = False
+                return invoke_result_data
+            if resp["miniapp_widget_template_instantiate_response"]["result"]["success"] == False:
+                invoke_result_data.success = False
+                return invoke_result_data
+
+            invoke_result_data.data = resp["miniapp_widget_template_instantiate_response"]["result"]["model"]
+            return invoke_result_data
+
+        except Exception as ex:
+            if self.context:
+                self.context.logging_link_error(traceback.format_exc())
+            elif self.logging_link_error:
+                self.logging_link_error(traceback.format_exc())
+            invoke_result_data.success = False
+            if "submsg" in str(ex):
+                content_list = str(ex).split()
+                for content in content_list:
+                    if "submsg=该子帐号无此操作权限" in content:
+                        invoke_result_data.error_code = "no_power"
+                        invoke_result_data.error_message = content[len("submsg="):]
+                        return invoke_result_data
+                    if "submsg=" in content:
+                        invoke_result_data.error_code = "error"
+                        invoke_result_data.error_message = content[len("submsg="):]
+                        return invoke_result_data
+            return invoke_result_data
+        
+    def miniapp_widget_template_instance_update(self, widgets_id, widget_template_id, template_version, access_token, app_key, app_secret, is_log=False):
+        """
+        :description: 更新小部件版本
+        :param widgets_id：小部件id
+        :param widget_template_id：小部件模版id
+        :param template_version：小部件模版版本
+        :param access_token：access_token
+        :param app_key:app_key
+        :param app_secret:app_secret
+        :param is_log：是否记录返回信息
+        :return
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        try:
+            top.setDefaultAppInfo(app_key, app_secret)
+            req = top.api.MiniappWidgetTemplateInstanceUpdateRequest()
+            req.param_mini_app_instantiate_template_app_update_request = {}
+            req.param_mini_app_instantiate_template_app_update_request["entity_id"] = widgets_id
+            req.param_mini_app_instantiate_template_app_update_request["template_id"] = widget_template_id
+            req.param_mini_app_instantiate_template_app_update_request["template_version"] = template_version
+            resp = req.getResponse(access_token)
+            if is_log:
+                log_info = str(resp) + "【access_token】：" + access_token + "【更新小部件版本】"
+                if self.context:
+                    self.context.logging_link_info(log_info)
+                elif self.logging_link_info:
+                    self.logging_link_info(log_info)
+            if "miniapp_widget_template_instance_update_response" not in resp:
+                invoke_result_data.success = False
+                return invoke_result_data
+            if "result" not in resp["miniapp_widget_template_instance_update_response"]:
+                invoke_result_data.success = False
+                return invoke_result_data
+            if resp["miniapp_widget_template_instance_update_response"]["result"]["success"] == False:
+                invoke_result_data.success = False
+                return invoke_result_data
+            invoke_result_data.data = resp["miniapp_widget_template_instance_update_response"]["result"]["model"]
+            return invoke_result_data
+
+        except Exception as ex:
+            if self.context:
+                self.context.logging_link_error(traceback.format_exc())
+            elif self.logging_link_error:
+                self.logging_link_error(traceback.format_exc())
+            invoke_result_data.success = False
+            if "submsg" in str(ex):
+                content_list = str(ex).split()
+                for content in content_list:
+                    if "submsg=该子帐号无此操作权限" in content:
+                        invoke_result_data.error_code = "no_power"
+                        invoke_result_data.error_message = content[len("submsg="):]
+                        return invoke_result_data
+                    if "submsg=" in content:
+                        invoke_result_data.error_code = "error"
+                        invoke_result_data.error_message = content[len("submsg="):]
+                        return invoke_result_data
             return invoke_result_data
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/models/user_base_model.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/models/user_base_model.py`

 * *Ordering differences only*

 * *Files 12% similar despite different names*

```diff
@@ -1,916 +1,916 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-22 11:10:20
-@LastEditTime: 2023-06-19 15:22:29
-@LastEditors: HuangJianYi
-@Description: 
-"""
-from emoji import unicode_codes
-from seven_cloudapp_frame.libs.customize.cryptography_helper import CryptographyHelper
-from seven_cloudapp_frame.libs.customize.wechat_helper import WeChatHelper
-from seven_cloudapp_frame.libs.customize.seven_helper import *
-from seven_cloudapp_frame.models.top_base_model import *
-from seven_cloudapp_frame.models.frame_base_model import FrameBaseModel
-from seven_cloudapp_frame.models.db_models.user.user_account_model import *
-from seven_cloudapp_frame.models.db_models.user.user_info_model import *
-from seven_cloudapp_frame.models.db_models.user.user_black_model import *
-from seven_cloudapp_frame.models.db_models.act.act_module_model import *
-from seven_cloudapp_frame.models.db_models.act.act_prize_model import *
-from seven_cloudapp_frame.models.db_models.prize.prize_roster_model import *
-from seven_cloudapp_frame.models.db_models.user.user_address_model import *
-
-
-class UserBaseModel(FrameBaseModel):
-    """
-    :description: 用户信息业务模型
-    """
-    def __init__(self, context=None, logging_error=None, logging_info=None):
-        self.context = context
-        self.logging_link_error = logging_error
-        self.logging_link_info = logging_info
-        super(UserBaseModel, self).__init__(context)
-
-    def _get_user_info_id_md5(self, act_id, user_id):
-        """
-        :description: 生成用户信息唯一标识
-        :param act_id：活动标识
-        :param user_id：用户标识
-        :return: 用户信息唯一标识
-        :last_editors: HuangJianYi
-        """
-        if not act_id or not user_id:
-            return 0
-        return CryptoHelper.md5_encrypt_int(f"{act_id}_{user_id}")
-
-    def _delete_user_black_cache(self, act_id, user_id, delay_delete_time=0.01):
-        """
-        :description: 删除用户黑名单缓存
-        :param act_id：活动标识
-        :param user_id：用户标识
-        :param delay_delete_time: 延迟删除时间，传0则不进行延迟
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        UserBlackModel().delete_dependency_key(DependencyKey.user_black(act_id, user_id),delay_delete_time)
-
-    def _delete_user_info_cache(self, act_id, id_md5, delay_delete_time=0.01):
-        """
-        :description: 删除用户信息缓存
-        :param act_id：活动标识
-        :param id_md5：用户md5标识
-        :param delay_delete_time: 延迟删除时间，传0则不进行延迟
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        UserInfoModel().delete_dependency_key(DependencyKey.user_info(act_id, id_md5),delay_delete_time)
-
-    def get_user_info_dict(self, app_id, act_id, user_id, open_id="", is_cache=True):
-        """
-        :description: 获取用户信息单条记录
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param user_id：用户标识
-        :param is_cache：是否缓存
-        :return: 返回用户信息
-        :last_editors: HuangJianYi
-        """
-        user_info_dict = None
-        if not act_id or (not user_id and not open_id):
-            return user_info_dict
-        user_info_model = UserInfoModel(sub_table=self.get_business_sub_table("user_info_tb",{"app_id":app_id}),context=self.context)
-        id_md5 = self._get_user_info_id_md5(act_id, user_id)
-        dependency_key = DependencyKey.user_info(act_id, id_md5, open_id)
-        if id_md5:
-            if is_cache:
-                user_info_dict = user_info_model.get_cache_dict("id_md5=%s", limit="1", params=[id_md5], dependency_key=dependency_key)
-            else:
-                user_info_dict = user_info_model.get_dict("id_md5=%s", limit="1", params=[id_md5])
-        else:
-            if is_cache:
-                user_info_dict = user_info_model.get_cache_dict(where="act_id=%s and open_id=%s", limit="1", params=[act_id, open_id], dependency_key=dependency_key)
-            else:
-                user_info_dict = user_info_model.get_dict("act_id=%s and open_id=%s", limit="1", params=[act_id, open_id])
-
-        if user_info_dict and user_info_dict["app_id"] != app_id:
-            user_info_dict = None
-        return user_info_dict
-
-    def get_user_list(self, app_id, act_id, page_size=20, page_index=0, user_state=-1, user_id=0, start_date="", end_date="", user_nick="", open_id="", order_by="id desc"):
-        """
-        :description: 获取用户信息列表
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param page_size：条数
-        :param page_index：页数
-        :param user_state：用户状态
-        :param user_id：用户标识
-        :param start_date：开始时间
-        :param end_date：结束时间
-        :param user_nick：昵称
-        :param open_id：open_id
-        :param order_by：排序
-        :return: 返回PageInfo
-        :last_editors: HuangJianYi
-        """
-        page_info = PageInfo(page_index, page_size, 0, [])
-        if not act_id:
-            return page_info
-        condition = "act_id=%s"
-        params = [act_id]
-        if app_id:
-            condition += " AND app_id=%s"
-            params.append(app_id)
-        if user_id != 0:
-            condition += " AND user_id=%s"
-            params.append(user_id)
-        if user_state != -1:
-            condition += " AND user_state=%s"
-            params.append(user_state)
-        if open_id:
-            condition += " AND open_id=%s"
-            params.append(open_id)
-        if user_nick:
-            condition += " AND user_nick=%s"
-            params.append(user_nick)
-        if start_date:
-            condition += " AND create_date>=%s"
-            params.append(start_date)
-        if end_date:
-            condition += " AND create_date<=%s"
-            params.append(end_date)
-        page_list, total = UserInfoModel(sub_table=self.get_business_sub_table("user_info_tb",{"app_id":app_id}),context=self.context).get_dict_page_list("*", page_index, page_size, condition, order_by=order_by, params=params)
-        page_info = PageInfo(page_index, page_size, total, page_list)
-        return page_info
-
-    def get_join_member_url(self, access_token, app_key, app_secret, is_log):
-        """
-        :description: 获取加入会员地址
-        :param access_token:access_token
-        :param app_key:app_key
-        :param app_secret:app_secret
-        :param is_log:是否记录top请求日志
-        :return 
-        :last_editors: HuangJianYi
-        """
-        top_base_model = TopBaseModel(context=self.context)
-        return top_base_model.get_join_member_url(access_token, app_key, app_secret, is_log)
-
-    def save_user_by_openid(self, app_id, act_id, open_id, user_nick, avatar, union_id="", login_ip="", is_update_user_nick=True, mix_nick=''):
-        """
-        :description: 获取或更新用户信息（主要用于登录）
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param open_id：open_id
-        :param user_nick：昵称
-        :param avatar：头像
-        :param union_id：union_id
-        :param login_ip：登录ip地址
-        :param is_update_user_nick：是否更新用户昵称
-        :param mix_nick：混淆昵称
-        :return: 返回用户信息
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        if not act_id or not open_id:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "param_error"
-            invoke_result_data.error_message = "参数不能为空或等于0"
-            return invoke_result_data
-
-        acquire_lock_name = f"save_user_by_openid:{app_id}_{open_id}"
-        acquire_lock_status, identifier = SevenHelper.redis_acquire_lock(acquire_lock_name)
-        if acquire_lock_status == False:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "acquire_lock"
-            invoke_result_data.error_message = "请求超时,请稍后再试"
-            return invoke_result_data
-
-        user_account = None
-        user_account_model = UserAccountModel(context=self.context)
-        user_info = None
-        user_info_model = UserInfoModel(sub_table=self.get_business_sub_table("user_info_tb",{"app_id":app_id}), context=self.context)
-        now_datetime = SevenHelper.get_now_datetime()
-        try:
-            user_account = user_account_model.get_cache_entity("open_id=%s", params=[open_id],dependency_key=DependencyKey.user_account(open_id))
-            if not user_account:
-                # 设置默认昵称和头像
-                user_config = share_config.get_value("user_config",{})
-                if not user_nick:
-                    user_nick = user_config.get("default_user_nick","")
-                if not avatar:
-                    avatar = user_config.get("default_avatar", "")
-                user_account = UserAccount()
-                user_account.union_id = union_id
-                user_account.open_id = open_id
-                user_account.user_nick = CryptographyHelper.emoji_to_emoji_base64(user_nick)
-                user_account.user_nick_encrypt = CryptographyHelper.base64_encrypt(user_nick) if user_nick else ""
-                user_account.mix_nick = mix_nick
-                user_account.avatar = avatar
-                user_account.user_state = 0
-                user_account.create_date = now_datetime
-                user_account.create_ip = login_ip
-                user_account.modify_date = now_datetime
-                user_account.login_date = now_datetime
-                user_account.login_ip = login_ip
-                user_account.id = user_account_model.add_entity(user_account)
-                if share_config.get_value("is_cache_empty",False) == True:
-                    user_account_model.delete_dependency_key(DependencyKey.user_account(open_id))
-            else:
-                delete_account_cache = False
-                if user_nick and user_account.user_nick != user_nick and is_update_user_nick == True:
-                    user_account.user_nick = CryptographyHelper.emoji_to_emoji_base64(user_nick)
-                    user_account.user_nick_encrypt = CryptographyHelper.base64_encrypt(user_nick)
-                    delete_account_cache = True
-                if avatar and user_account.avatar != avatar and is_update_user_nick == True:
-                    user_account.avatar = avatar
-                    delete_account_cache = True
-                if union_id and user_account.union_id != union_id:
-                    user_account.union_id = union_id
-                    delete_account_cache = True
-                if mix_nick and user_account.mix_nick != mix_nick:
-                    user_account.mix_nick = mix_nick
-                    delete_account_cache = True
-                user_account.login_date = now_datetime
-                user_account.login_ip = login_ip
-                user_account_model.update_entity(user_account, "user_nick,user_nick_encrypt,mix_nick,avatar,union_id,login_date,login_ip")
-                if delete_account_cache == True:
-                    user_account_model.delete_dependency_key(DependencyKey.user_account(open_id))
-
-            user_info = user_info_model.get_entity("act_id=%s and open_id=%s", params=[act_id, open_id])
-            if not user_info:
-                user_info = UserInfo()
-                user_info.id_md5 = self._get_user_info_id_md5(act_id, user_account.id)
-                user_info.app_id = app_id
-                user_info.act_id = act_id
-                user_info.open_id = open_id
-                user_info.user_id = user_account.id
-                user_info.union_id = user_account.union_id
-                user_info.is_new = 1
-                user_info.user_nick = user_account.user_nick
-                user_info.user_nick_encrypt = user_account.user_nick_encrypt
-                user_info.avatar = user_account.avatar
-                user_info.is_auth = 0 if not user_info.user_nick else 1
-                user_info.create_date = now_datetime
-                user_info.modify_date = now_datetime
-                user_info.login_token = SevenHelper.get_random(16)
-                user_info.id = user_info_model.add_entity(user_info)
-            else:
-                if user_info.app_id != app_id:
-                    invoke_result_data.success = False
-                    invoke_result_data.error_code = "error"
-                    invoke_result_data.error_message = "非法操作"
-                    return invoke_result_data
-                user_info.union_id = user_account.union_id
-                user_info.user_nick = user_account.user_nick
-                user_info.user_nick_encrypt = user_account.user_nick_encrypt
-                user_info.avatar = user_account.avatar
-                user_info.is_auth = 0 if not user_info.user_nick else 1
-                # if TimeHelper.difference_minutes(now_datetime,user_info.create_date) > 1:
-                #     user_info.is_new = 0
-                user_info.is_new = 0
-                user_info.modify_date = now_datetime
-                user_info.login_token = SevenHelper.get_random(16)
-                user_info_model.update_entity(user_info, "modify_date,login_token,is_new,user_nick,user_nick_encrypt,avatar,is_auth,union_id")
-                user_info_model.delete_dependency_key([DependencyKey.user_info(act_id, user_info.id_md5), DependencyKey.user_info(act_id, "", user_info.open_id)])
-
-        except Exception as ex:
-            if self.context:
-                self.context.logging_link_error("【获取或更新用户信息】" + traceback.format_exc())
-            elif self.logging_link_error:
-                self.logging_link_error("【获取或更新用户信息】" + traceback.format_exc())
-        finally:
-            SevenHelper.redis_release_lock(acquire_lock_name, identifier)
-        if not user_info:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "fail"
-            invoke_result_data.error_message = "登录失败"
-            return invoke_result_data
-
-        user_info_dict = user_info.__dict__
-        user_info_dict["telephone"] = user_account.telephone if user_account else ""
-        user_info_dict["sex"] = user_account.sex if user_account else 0
-        user_info_dict["birthday"] = user_account.birthday if user_account and user_account.birthday != "1900-01-01" else ""
-        invoke_result_data.data = user_info_dict
-        return invoke_result_data
-
-    def update_user_info(self, app_id, act_id, user_id, open_id, user_nick, avatar, is_member_before=-1, is_favor_before=-1):
-        """
-        :description: 更新用户信息（主要用于授权更新昵称和头像）
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param user_id：用户标识
-        :param open_id：open_id
-        :param user_nick：昵称
-        :param avatar：头像
-        :param is_member_before：初始会员状态
-        :param is_favor_before：初始关注状态
-        :return: 返回用户信息
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-
-        if not act_id or (not user_id and not open_id):
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "param_error"
-            invoke_result_data.error_message = "参数不能为空或等于0"
-            return invoke_result_data
-
-        # 进行授权，有头像没昵称，则给默认的昵称
-        if avatar and not user_nick:
-            user_nick = "未知"
-
-        user_account_model = UserAccountModel(context=self.context)
-        user_info_dict = None
-        user_info_model = UserInfoModel(sub_table=self.get_business_sub_table("user_info_tb",{"app_id":app_id}),context=self.context)
-
-        try:
-            user_info_dict = self.get_user_info_dict(app_id, act_id, user_id, open_id)
-            if not user_info_dict:
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "error"
-                invoke_result_data.error_message = "更新失败，找不到用户信息"
-                return invoke_result_data
-            else:
-                if user_info_dict["app_id"] != app_id:
-                    invoke_result_data.success = False
-                    invoke_result_data.error_code = "error"
-                    invoke_result_data.error_message = "非法操作"
-                    return invoke_result_data
-                user_info_dict["is_member_before"] = is_member_before if is_member_before != -1 else user_info_dict["is_member_before"]
-                user_info_dict["is_favor_before"] = is_favor_before if is_favor_before != -1 else user_info_dict["is_favor_before"]
-                if user_nick:
-                    user_info_dict["user_nick"] = CryptographyHelper.emoji_to_emoji_base64(user_nick)
-                    user_info_dict["user_nick_encrypt"] = CryptographyHelper.base64_encrypt(user_nick)
-                user_info_dict["avatar"] = avatar if avatar else user_info_dict["avatar"]
-                user_info_dict["is_auth"] = 1 if user_info_dict["user_nick"] else 0
-                user_info_dict["modify_date"] = SevenHelper.get_now_datetime()
-                user_info_model.update_table("user_nick=%s,user_nick_encrypt=%s,avatar=%s,modify_date=%s,is_auth=%s,is_member_before=%s,is_favor_before=%s", "id=%s", params=[user_info_dict["user_nick"], user_info_dict["user_nick_encrypt"], user_info_dict["avatar"], user_info_dict["modify_date"], user_info_dict["is_auth"], user_info_dict["is_member_before"], user_info_dict["is_favor_before"], user_info_dict["id"]])
-                user_info_model.delete_dependency_key([DependencyKey.user_info(act_id, user_info_dict["id_md5"]), DependencyKey.user_info(act_id, "", user_info_dict["open_id"])])
-
-                update_sql = ""
-                params = []
-                if user_nick:
-                    update_sql = "user_nick=%s,user_nick_encrypt=%s"
-                    params.append(CryptographyHelper.emoji_to_emoji_base64(user_nick))
-                    params.append(CryptographyHelper.base64_encrypt(user_nick))
-                if avatar:
-                    update_sql += "," if update_sql else ""
-                    update_sql += "avatar=%s"
-                    params.append(avatar)
-                params.append(user_info_dict["user_id"])
-                if update_sql:
-                    user_account_model.update_table(update_sql, "id=%s", params=params)
-                    user_account_model.delete_dependency_key(DependencyKey.user_account(user_info_dict["open_id"]))
-
-        except Exception as ex:
-            if self.context:
-                self.context.logging_link_error("【更新用户信息】" + traceback.format_exc())
-            elif self.logging_link_error:
-                self.logging_link_error("【更新用户信息】" + traceback.format_exc())
-
-        return invoke_result_data
-
-    def update_user_state(self, app_id, act_id, user_id, user_state):
-        """
-        :description: 更新用户状态
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param user_id：用户标识
-        :param user_state: 用户状态（0-正常，1-黑名单）
-        :return:
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        id_md5 = self._get_user_info_id_md5(act_id, user_id)
-        user_info_model = UserInfoModel(sub_table=self.get_business_sub_table("user_info_tb",{"app_id":app_id}), context=self.context)
-        user_info = user_info_model.get_entity("id_md5=%s", params=[id_md5])
-        if not user_info:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "用户信息不存在"
-            return invoke_result_data
-        if user_info.app_id != app_id:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "非法操作"
-            return invoke_result_data
-        if user_info.user_state == user_state:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "用户状态没变无需更新"
-            return invoke_result_data
-        modify_date = SevenHelper.get_now_datetime()
-        if user_state == 0:
-            user_info.relieve_date = modify_date
-        user_info.user_state = user_state
-        user_info.modify_date = modify_date
-        user_info_model.update_entity(user_info, "user_state,relieve_date,modify_date")
-
-        self._delete_user_info_cache(user_info.act_id, user_info.id_md5)
-        invoke_result_data.data = user_info.__dict__
-        return invoke_result_data
-
-    def update_user_state_by_black(self, app_id, act_id, user_id, reason=""):
-        """
-        :description: 用户拉入黑名单
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param user_id：用户标识
-        :param reason：拉黑理由
-        :return:
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        db_transaction = DbTransaction(db_config_dict=config.get_value("db_cloudapp"),context=self.context)
-        user_info_model = UserInfoModel(sub_table=self.get_business_sub_table("user_info_tb",{"app_id":app_id}), db_transaction=db_transaction, context=self.context)
-        user_black_model = UserBlackModel(db_transaction=db_transaction, context=self.context)
-
-        user_info_dict = self.get_user_info_dict(app_id, act_id, user_id)
-        if not user_info_dict:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "用户信息不存在"
-            return invoke_result_data
-        if user_info_dict["app_id"] != app_id:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "非法操作"
-            return invoke_result_data
-        if user_info_dict["user_state"] == 1:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "该用户已是黑名单"
-            return invoke_result_data
-        modify_date = SevenHelper.get_now_datetime()
-        user_info_dict["user_state"] = 1
-        user_info_dict["modify_date"] = modify_date
-
-        user_black = user_black_model.get_entity("act_id=%s and user_id=%s", params=[act_id, user_id])
-        try:
-            db_transaction.begin_transaction()
-            user_info_model.update_table("user_state=%s,modify_date=%s", "id=%s", params=[user_info_dict["user_state"], user_info_dict["modify_date"], user_info_dict["id"]])
-            if not user_black:
-                #添加到用户黑名单管理表
-                user_black = UserBlack()
-                user_black.app_id = user_info_dict["app_id"]
-                user_black.act_id = user_info_dict["act_id"]
-                user_black.user_id = user_info_dict["user_id"]
-                user_black.open_id = user_info_dict["open_id"]
-                user_black.user_nick = user_info_dict["user_nick"]
-                user_black.black_type = 2
-                user_black.refund_order_data = []
-                user_black.reason = reason
-                user_black.create_date = SevenHelper.get_now_datetime()
-                user_black_model.add_entity(user_black)
-            else:
-                user_black.audit_status = 0
-                user_black.black_type = 2
-                user_black.reason = reason
-                user_black.create_date = SevenHelper.get_now_datetime()
-                user_black_model.update_entity(user_black)
-            result,mesage = db_transaction.commit_transaction(True)
-            if not result:
-                raise Exception("执行事务失败",mesage)
-            invoke_result_data.data = {"user_info": user_info_dict}
-            self._delete_user_info_cache(user_info_dict["act_id"], user_info_dict["id_md5"])
-            self._delete_user_black_cache(act_id, user_id)
-        except Exception as ex:
-            if self.context:
-                self.context.logging_link_error("【更新用户状态黑名单】" + traceback.format_exc())
-            elif self.logging_link_error:
-                self.logging_link_error("【更新用户状态黑名单】" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "exception"
-            invoke_result_data.error_message = "系统繁忙,请稍后再试"
-        invoke_result_data.data = user_info_dict
-        return invoke_result_data
-
-    def apply_black_unbind(self, app_id, act_id, user_id, open_id="", reason="误封号,申请解封"):
-        """
-        :description: 申请黑名单解绑
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param user_id：用户标识
-        :param open_id：open_id
-        :return:
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        if not act_id or (not user_id and not open_id):
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "param_error"
-            invoke_result_data.error_message = "参数不能为空或等于0"
-            return invoke_result_data
-        user_info_dict = self.get_user_info_dict(app_id, act_id, user_id, open_id)
-        if not user_info_dict:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "用户信息不存在"
-            return invoke_result_data
-        if user_info_dict["app_id"] != app_id:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "非法操作"
-            return invoke_result_data
-
-        if user_info_dict["user_state"] == 0:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "账号正常,无需申请解封"
-            return invoke_result_data
-        user_black_model = UserBlackModel(context=self.context)
-        user_black = user_black_model.get_cache_entity("act_id=%s and user_id=%s", order_by="create_date desc", params=[act_id, user_id], dependency_key=DependencyKey.user_black(act_id, user_id))
-        if not user_black:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "账号正常,无需申请解封"
-            return invoke_result_data
-        if user_black.audit_status == 1:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "请耐心等待客服处理"
-            return invoke_result_data
-
-        user_black.audit_status = 1
-        user_black.reason = reason
-        user_black_model.update_entity(user_black, "audit_status,reason")
-        self._delete_user_black_cache(act_id, user_id)
-        return invoke_result_data
-
-    def audit_user_black(self, app_id, black_id, audit_status, audit_remark=""):
-        """
-        :description: 审核黑名单
-        :param app_id：应用标识
-        :param black_id：用户黑名单管理id
-        :param audit_status：审核状态(0黑名单1申请中2同意3拒绝)
-        :param audit_remark：审核备注
-        :return:
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        if black_id <= 0:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "param_error"
-            invoke_result_data.error_message = "参数不能为空或等于0"
-            return invoke_result_data
-        user_black_model = UserBlackModel(context=self.context)
-        user_black = user_black_model.get_entity_by_id(black_id)
-        if not user_black:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "找不到该条记录"
-            return invoke_result_data
-        if user_black.app_id != app_id:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "非法操作"
-            return invoke_result_data
-
-        user_info_model = UserInfoModel(sub_table=self.get_business_sub_table("user_info_tb",{"app_id":app_id}),context=self.context)
-        id_md5 = self._get_user_info_id_md5(user_black.act_id, user_black.user_id)
-        user_info = user_info_model.get_entity("id_md5=%s", params=[id_md5])
-        if not user_info:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "用户信息不存在"
-            return invoke_result_data
-        audit_date = SevenHelper.get_now_datetime()
-        condition = "audit_status=%s,audit_date=%s"
-        params = [audit_status, audit_date]
-        if audit_remark:
-            condition += ",audit_remark=%s"
-            params.append(audit_remark)
-        params.append(black_id)
-        if audit_status == 0:
-            condition += ",black_type=2"
-            user_black_model.update_table(condition, "id=%s", params)
-            user_info.user_state = 1
-            user_info.modify_date = audit_date
-            user_info_model.update_entity(user_info, "user_state,modify_date")
-        elif audit_status == 2:
-            user_black_model.update_table(condition, "id=%s", params)
-            user_info.user_state = 0
-            user_info.modify_date = audit_date
-            user_info.relieve_date = audit_date
-            user_info_model.update_entity(user_info, "user_state,relieve_date,modify_date")
-        elif audit_status == 3:
-            user_black_model.update_table(condition, "id=%s", params)
-
-        invoke_result_data.data = {"user_info": user_info.__dict__}
-        self._delete_user_info_cache(user_info.act_id, user_info.id_md5)
-        self._delete_user_black_cache(user_black.act_id, user_black.user_id)
-        return invoke_result_data
-
-    def update_audit_remark(self, app_id, black_id, audit_remark):
-        """
-        :description: 修改审核备注
-        :param app_id：应用标识
-        :param black_id：用户黑名单管理id
-        :param audit_remark：审核备注
-        :return:
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        if black_id <= 0:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "param_error"
-            invoke_result_data.error_message = "参数不能为空或等于0"
-            return invoke_result_data
-        user_black_model = UserBlackModel(context=self.context)
-        user_black = user_black_model.get_entity_by_id(black_id)
-        if not user_black:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "找不到该条记录"
-            return invoke_result_data
-        if user_black.app_id != app_id:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "非法操作"
-            return invoke_result_data
-        user_black_model.update_table("audit_remark=%s", "id=%s", [audit_remark, black_id])
-        self._delete_user_black_cache(user_black.act_id, user_black.user_id)
-        invoke_result_data.data = {"user_black": user_black.__dict__}
-        return invoke_result_data
-
-    def get_black_info_dict(self, app_id, act_id, user_id, is_cache=True):
-        """
-        :description: 获取黑名单单条记录
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param user_id：用户标识
-        :param is_cache：是否缓存
-        :return:
-        :last_editors: HuangJianYi
-        """
-        user_black_dict = None
-        if not act_id or not user_id:
-            return user_black_dict
-        user_info_dict = self.get_user_info_dict(app_id, act_id, user_id)
-        if not user_info_dict:
-            return user_black_dict
-        where = "act_id=%s and user_id=%s"
-        params = [act_id, user_id]
-        user_black_model = UserBlackModel(context=self.context)
-        if is_cache:
-            user_black_dict = user_black_model.get_cache_dict(where=where, limit="1", params=params, dependency_key=DependencyKey.user_black(act_id, user_id))
-        else:
-            user_black_dict = user_black_model.get_dict(where, limit="1", params=params)
-        return user_black_dict
-
-    def get_black_list(self, app_id, act_id, page_size=20, page_index=0, audit_status=-1, user_id=0, start_date="", end_date="", user_nick="", open_id="", order_by="id desc"):
-        """
-        :description: 获取用户黑名单列表
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param page_size：条数
-        :param page_index：页数
-        :param audit_status：审核状态(0黑名单1申请中2同意3拒绝)
-        :param user_id：用户标识
-        :param start_date：开始时间
-        :param end_date：结束时间
-        :param user_nick：昵称
-        :param open_id：open_id
-        :param order_by：排序
-        :return: 返回PageInfo
-        :last_editors: HuangJianYi
-        """
-        page_info = PageInfo(page_index, page_size, 0, [])
-        if not act_id:
-            return page_info
-
-        condition = "act_id=%s"
-        params = [act_id]
-
-        if app_id:
-            condition += " AND app_id=%s"
-            params.append(app_id)
-        if user_id != 0:
-            condition += " AND user_id=%s"
-            params.append(user_id)
-        if audit_status != -1:
-            condition += " AND audit_status=%s"
-            params.append(audit_status)
-        if open_id:
-            condition += " AND open_id=%s"
-            params.append(open_id)
-        if user_nick:
-            condition += " AND user_nick=%s"
-            params.append(user_nick)
-        if start_date:
-            condition += " AND create_date>=%s"
-            params.append(start_date)
-        if end_date:
-            condition += " AND create_date<=%s"
-            params.append(end_date)
-
-        page_list, total = UserBlackModel(context=self.context).get_dict_page_list("*", page_index, page_size, condition, order_by=order_by, params=params)
-        for user_black in page_list:
-            user_black["refund_order_data"] = SevenHelper.json_loads(user_black["refund_order_data"]) if user_black["refund_order_data"] else []
-
-        page_info = PageInfo(page_index, page_size, total, page_list)
-        return page_info
-
-    def check_pull_black(self, user_info_dict, is_black, refund_count, all_order_data):
-        """
-        :description: 校验是否拉黑
-        :param user_info_dict：用户信息字典
-        :param is_black：是否拉黑
-        :param refund_count：退款次数
-        :param all_order_data:淘宝订单列表
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        result = False
-        try:
-            if user_info_dict["user_state"] == 0 and is_black == 1 and refund_count > 0:
-                #退款的订单  子订单存在退款 记录一次
-                refund_order_data = [i for i in all_order_data if i.get("refund_status") and i.get("refund_status") not in self.refund_status()]
-                #如果不是黑用户 并且存在退款时间 代表黑用户解禁
-                if user_info_dict["relieve_date"] != '1900-01-01 00:00:00':
-                    refund_order_data = [i for i in refund_order_data if TimeHelper.format_time_to_datetime(str(i['pay_time'])) > TimeHelper.format_time_to_datetime(str(user_info_dict["relieve_date"]))]
-                #超过变成黑用户
-                if len(refund_order_data) >= refund_count:
-                    result = True
-                    user_info_model = UserInfoModel(sub_table=self.get_business_sub_table("user_info_tb",{"app_id":user_info_dict["app_id"]}),context=self.context)
-                    user_info_model.update_table("user_state=1", "id=%s", user_info_dict["id"])
-                    user_black_model = UserBlackModel(context=self.context)
-                    user_black = user_black_model.get_entity("act_id=%s and user_id=%s", params=[user_info_dict["act_id"], user_info_dict["user_id"]])
-                    if user_black:
-                        user_black.black_type = 1
-                        user_black.reason = ""
-                        user_black.audit_status = 0
-                        user_black.audit_remark = ""
-                        user_black.refund_count += len(refund_order_data)
-                        all_refund_order_data = SevenHelper.json_loads(user_black.refund_order_data)
-                        if len(refund_order_data) > 0:
-                            for item in refund_order_data:
-                                all_refund_order_data.append(item)
-                        user_black.refund_order_data = SevenHelper.json_dumps(all_refund_order_data)
-                        user_black_model.update_entity(user_black)
-                    else:
-                        user_black = UserBlack()
-                        user_black.app_id = user_info_dict["app_id"]
-                        user_black.act_id = user_info_dict["act_id"]
-                        user_black.user_id = user_info_dict["user_id"]
-                        user_black.open_id = user_info_dict["open_id"]
-                        user_black.user_nick = user_info_dict["user_nick"]
-                        user_black.black_type = 1
-                        user_black.reason = ""
-                        user_black.audit_status = 0
-                        user_black.audit_remark = ""
-                        user_black.refund_count = len(refund_order_data)
-                        user_black.refund_order_data = SevenHelper.json_dumps(refund_order_data)
-                        user_black.create_date = SevenHelper.get_now_datetime()
-                        user_black_model.add_entity(user_black)
-                    self._delete_user_info_cache(user_info_dict["act_id"], user_info_dict["id_md5"])
-        except Exception as ex:
-            if self.context:
-                self.context.logging_link_error("【校验是否拉黑】" + traceback.format_exc())
-            elif self.logging_link_error:
-                self.logging_link_error("【校验是否拉黑】" + traceback.format_exc())
-            result = False
-        return result
-
-    def get_user_address_list(self, app_id, act_id, user_id, is_cache=True):
-        """
-        :description: 获取用户地址列表
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param tb_user_id：用户标识
-        :param is_cache：是否缓存
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        user_address_list = []
-        if not act_id or not user_id:
-            return user_address_list
-        condition = "act_id=%s AND user_id=%s"
-        params = [act_id, user_id]
-        if app_id:
-            condition += " AND app_id=%s"
-            params.append(app_id)
-
-        user_address_model = UserAddressModel(context=self.context)
-        if is_cache:
-            user_address_list = user_address_model.get_cache_dict_list(condition, limit="100", params=params, dependency_key=DependencyKey.user_address_list(act_id,user_id))
-        else:
-            user_address_list = user_address_model.get_dict_list(condition, limit="100", params=params)
-
-        return user_address_list
-
-    def save_user_address(self, app_id, act_id, user_id, open_id, user_address_id, real_name, telephone, province, city, county, street, address, is_default):
-        """
-        :description: 保存用户地址
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param user_id：用户标识
-        :param open_id：open_id
-        :param user_address_id:用户地址标识,如果传-1则优先获取最新一条并更新，适用于不需要获取地址列表的场景
-        :param real_name：真实姓名
-        :param telephone：手机号码
-        :param province：省
-        :param city：市
-        :param county：区
-        :param street：街道
-        :param address：地址
-        :param is_default：是否默认地址（1是0否）
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        if not act_id or (not user_id and not open_id):
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "param_error"
-            invoke_result_data.error_message = "参数不能为空或等于0"
-            return invoke_result_data
-        is_contain_emoji = False
-        for i, item in enumerate(real_name):
-            if item in unicode_codes.UNICODE_EMOJI["en"]:
-                is_contain_emoji = True
-                break
-        if is_contain_emoji == True:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "收货人不能包含表情包"
-            return invoke_result_data
-        user_info_dict = self.get_user_info_dict(app_id, act_id, user_id, open_id)
-        if not user_info_dict:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "用户信息不存在"
-            return invoke_result_data
-        if user_info_dict["app_id"] != app_id:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "非法操作"
-            return invoke_result_data
-
-        user_address_model = UserAddressModel(context=self.context)
-        if is_default == 1:
-            user_address_model.update_table("is_default=0", "act_id=%s and user_id=%s", params=[act_id, user_id])
-        user_address = None
-        if user_address_id == -1:
-            user_address = user_address_model.get_entity("act_id=%s and user_id=%s", params=[act_id, user_id])
-            user_address_id = user_address.id if user_address else 0
-
-        if user_address_id > 0:
-            if not user_address:
-                user_address = user_address_model.get_entity("id=%s", params=[user_address_id])
-            if not user_address:
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "error"
-                invoke_result_data.error_message = "地址信息不存在"
-                return invoke_result_data
-            user_address.real_name = real_name
-            user_address.telephone = telephone
-            user_address.province = province
-            user_address.city = city
-            user_address.county = county
-            user_address.street = street
-            user_address.address = address
-            user_address.is_default = is_default
-            user_address_model.update_entity(user_address, "real_name,telephone,province,city,county,street,address,is_default")
-        else:
-            user_address = UserAddress()
-            user_address.app_id = app_id
-            user_address.act_id = act_id
-            user_address.user_id = user_id
-            user_address.open_id = open_id
-            user_address.real_name = real_name
-            user_address.telephone = telephone
-            user_address.province = province
-            user_address.city = city
-            user_address.county = county
-            user_address.street = street
-            user_address.address = address
-            user_address.is_default = is_default
-            user_address.create_date = SevenHelper.get_now_datetime()
-            user_address_model.add_entity(user_address)
-        user_address_model.delete_dependency_key(DependencyKey.user_address_list(act_id,user_id))
-        return invoke_result_data
-
-    def update_user_telephone(self, open_id, telephone="", code=""):
-        """
-        :description: 更新用户手机号
-        :param open_id：open_id
-        :param telephone：手机号
-        :param code: 微信code，用于获取手机号
-        :return: InvokeResultData
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        if not telephone and not code:
-            invoke_result_data.error_code = "param_error"
-            invoke_result_data.error_message = "telephone和code不能都为空"
-            return invoke_result_data
-        if code:
-            invoke_result_data = WeChatHelper.get_user_phonenumber(code, share_config.get_value("app_id"), share_config.get_value("app_secret"))
-            if invoke_result_data.success == False:
-                return invoke_result_data
-            telephone = invoke_result_data.data.get("phoneNumber","")
-        user_account_model = UserAccountModel(context=self.context)
-        user_account_model.update_table("telephone=%s","open_id=%s",params=[telephone, open_id])
-        user_account_model.delete_dependency_key(DependencyKey.user_account(open_id))
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-22 11:10:20
+@LastEditTime: 2023-06-19 15:22:29
+@LastEditors: HuangJianYi
+@Description: 
+"""
+from emoji import unicode_codes
+from seven_cloudapp_frame.libs.customize.cryptography_helper import CryptographyHelper
+from seven_cloudapp_frame.libs.customize.wechat_helper import WeChatHelper
+from seven_cloudapp_frame.libs.customize.seven_helper import *
+from seven_cloudapp_frame.models.top_base_model import *
+from seven_cloudapp_frame.models.frame_base_model import FrameBaseModel
+from seven_cloudapp_frame.models.db_models.user.user_account_model import *
+from seven_cloudapp_frame.models.db_models.user.user_info_model import *
+from seven_cloudapp_frame.models.db_models.user.user_black_model import *
+from seven_cloudapp_frame.models.db_models.act.act_module_model import *
+from seven_cloudapp_frame.models.db_models.act.act_prize_model import *
+from seven_cloudapp_frame.models.db_models.prize.prize_roster_model import *
+from seven_cloudapp_frame.models.db_models.user.user_address_model import *
+
+
+class UserBaseModel(FrameBaseModel):
+    """
+    :description: 用户信息业务模型
+    """
+    def __init__(self, context=None, logging_error=None, logging_info=None):
+        self.context = context
+        self.logging_link_error = logging_error
+        self.logging_link_info = logging_info
+        super(UserBaseModel, self).__init__(context)
+
+    def _get_user_info_id_md5(self, act_id, user_id):
+        """
+        :description: 生成用户信息唯一标识
+        :param act_id：活动标识
+        :param user_id：用户标识
+        :return: 用户信息唯一标识
+        :last_editors: HuangJianYi
+        """
+        if not act_id or not user_id:
+            return 0
+        return CryptoHelper.md5_encrypt_int(f"{act_id}_{user_id}")
+
+    def _delete_user_black_cache(self, act_id, user_id, delay_delete_time=0.01):
+        """
+        :description: 删除用户黑名单缓存
+        :param act_id：活动标识
+        :param user_id：用户标识
+        :param delay_delete_time: 延迟删除时间，传0则不进行延迟
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        UserBlackModel().delete_dependency_key(DependencyKey.user_black(act_id, user_id),delay_delete_time)
+
+    def _delete_user_info_cache(self, act_id, id_md5, delay_delete_time=0.01):
+        """
+        :description: 删除用户信息缓存
+        :param act_id：活动标识
+        :param id_md5：用户md5标识
+        :param delay_delete_time: 延迟删除时间，传0则不进行延迟
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        UserInfoModel().delete_dependency_key(DependencyKey.user_info(act_id, id_md5),delay_delete_time)
+
+    def get_user_info_dict(self, app_id, act_id, user_id, open_id="", is_cache=True):
+        """
+        :description: 获取用户信息单条记录
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param user_id：用户标识
+        :param is_cache：是否缓存
+        :return: 返回用户信息
+        :last_editors: HuangJianYi
+        """
+        user_info_dict = None
+        if not act_id or (not user_id and not open_id):
+            return user_info_dict
+        user_info_model = UserInfoModel(sub_table=self.get_business_sub_table("user_info_tb",{"app_id":app_id}),context=self.context)
+        id_md5 = self._get_user_info_id_md5(act_id, user_id)
+        dependency_key = DependencyKey.user_info(act_id, id_md5, open_id)
+        if id_md5:
+            if is_cache:
+                user_info_dict = user_info_model.get_cache_dict("id_md5=%s", limit="1", params=[id_md5], dependency_key=dependency_key)
+            else:
+                user_info_dict = user_info_model.get_dict("id_md5=%s", limit="1", params=[id_md5])
+        else:
+            if is_cache:
+                user_info_dict = user_info_model.get_cache_dict(where="act_id=%s and open_id=%s", limit="1", params=[act_id, open_id], dependency_key=dependency_key)
+            else:
+                user_info_dict = user_info_model.get_dict("act_id=%s and open_id=%s", limit="1", params=[act_id, open_id])
+
+        if user_info_dict and user_info_dict["app_id"] != app_id:
+            user_info_dict = None
+        return user_info_dict
+
+    def get_user_list(self, app_id, act_id, page_size=20, page_index=0, user_state=-1, user_id=0, start_date="", end_date="", user_nick="", open_id="", order_by="id desc"):
+        """
+        :description: 获取用户信息列表
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param page_size：条数
+        :param page_index：页数
+        :param user_state：用户状态
+        :param user_id：用户标识
+        :param start_date：开始时间
+        :param end_date：结束时间
+        :param user_nick：昵称
+        :param open_id：open_id
+        :param order_by：排序
+        :return: 返回PageInfo
+        :last_editors: HuangJianYi
+        """
+        page_info = PageInfo(page_index, page_size, 0, [])
+        if not act_id:
+            return page_info
+        condition = "act_id=%s"
+        params = [act_id]
+        if app_id:
+            condition += " AND app_id=%s"
+            params.append(app_id)
+        if user_id != 0:
+            condition += " AND user_id=%s"
+            params.append(user_id)
+        if user_state != -1:
+            condition += " AND user_state=%s"
+            params.append(user_state)
+        if open_id:
+            condition += " AND open_id=%s"
+            params.append(open_id)
+        if user_nick:
+            condition += " AND user_nick=%s"
+            params.append(user_nick)
+        if start_date:
+            condition += " AND create_date>=%s"
+            params.append(start_date)
+        if end_date:
+            condition += " AND create_date<=%s"
+            params.append(end_date)
+        page_list, total = UserInfoModel(sub_table=self.get_business_sub_table("user_info_tb",{"app_id":app_id}),context=self.context).get_dict_page_list("*", page_index, page_size, condition, order_by=order_by, params=params)
+        page_info = PageInfo(page_index, page_size, total, page_list)
+        return page_info
+
+    def get_join_member_url(self, access_token, app_key, app_secret, is_log):
+        """
+        :description: 获取加入会员地址
+        :param access_token:access_token
+        :param app_key:app_key
+        :param app_secret:app_secret
+        :param is_log:是否记录top请求日志
+        :return 
+        :last_editors: HuangJianYi
+        """
+        top_base_model = TopBaseModel(context=self.context)
+        return top_base_model.get_join_member_url(access_token, app_key, app_secret, is_log)
+
+    def save_user_by_openid(self, app_id, act_id, open_id, user_nick, avatar, union_id="", login_ip="", is_update_user_nick=True, mix_nick=''):
+        """
+        :description: 获取或更新用户信息（主要用于登录）
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param open_id：open_id
+        :param user_nick：昵称
+        :param avatar：头像
+        :param union_id：union_id
+        :param login_ip：登录ip地址
+        :param is_update_user_nick：是否更新用户昵称
+        :param mix_nick：混淆昵称
+        :return: 返回用户信息
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        if not act_id or not open_id:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "param_error"
+            invoke_result_data.error_message = "参数不能为空或等于0"
+            return invoke_result_data
+
+        acquire_lock_name = f"save_user_by_openid:{app_id}_{open_id}"
+        acquire_lock_status, identifier = SevenHelper.redis_acquire_lock(acquire_lock_name)
+        if acquire_lock_status == False:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "acquire_lock"
+            invoke_result_data.error_message = "请求超时,请稍后再试"
+            return invoke_result_data
+
+        user_account = None
+        user_account_model = UserAccountModel(context=self.context)
+        user_info = None
+        user_info_model = UserInfoModel(sub_table=self.get_business_sub_table("user_info_tb",{"app_id":app_id}), context=self.context)
+        now_datetime = SevenHelper.get_now_datetime()
+        try:
+            user_account = user_account_model.get_cache_entity("open_id=%s", params=[open_id],dependency_key=DependencyKey.user_account(open_id))
+            if not user_account:
+                # 设置默认昵称和头像
+                user_config = share_config.get_value("user_config",{})
+                if not user_nick:
+                    user_nick = user_config.get("default_user_nick","")
+                if not avatar:
+                    avatar = user_config.get("default_avatar", "")
+                user_account = UserAccount()
+                user_account.union_id = union_id
+                user_account.open_id = open_id
+                user_account.user_nick = CryptographyHelper.emoji_to_emoji_base64(user_nick)
+                user_account.user_nick_encrypt = CryptographyHelper.base64_encrypt(user_nick) if user_nick else ""
+                user_account.mix_nick = mix_nick
+                user_account.avatar = avatar
+                user_account.user_state = 0
+                user_account.create_date = now_datetime
+                user_account.create_ip = login_ip
+                user_account.modify_date = now_datetime
+                user_account.login_date = now_datetime
+                user_account.login_ip = login_ip
+                user_account.id = user_account_model.add_entity(user_account)
+                if share_config.get_value("is_cache_empty",False) == True:
+                    user_account_model.delete_dependency_key(DependencyKey.user_account(open_id))
+            else:
+                delete_account_cache = False
+                if user_nick and user_account.user_nick != user_nick and is_update_user_nick == True:
+                    user_account.user_nick = CryptographyHelper.emoji_to_emoji_base64(user_nick)
+                    user_account.user_nick_encrypt = CryptographyHelper.base64_encrypt(user_nick)
+                    delete_account_cache = True
+                if avatar and user_account.avatar != avatar and is_update_user_nick == True:
+                    user_account.avatar = avatar
+                    delete_account_cache = True
+                if union_id and user_account.union_id != union_id:
+                    user_account.union_id = union_id
+                    delete_account_cache = True
+                if mix_nick and user_account.mix_nick != mix_nick:
+                    user_account.mix_nick = mix_nick
+                    delete_account_cache = True
+                user_account.login_date = now_datetime
+                user_account.login_ip = login_ip
+                user_account_model.update_entity(user_account, "user_nick,user_nick_encrypt,mix_nick,avatar,union_id,login_date,login_ip")
+                if delete_account_cache == True:
+                    user_account_model.delete_dependency_key(DependencyKey.user_account(open_id))
+
+            user_info = user_info_model.get_entity("act_id=%s and open_id=%s", params=[act_id, open_id])
+            if not user_info:
+                user_info = UserInfo()
+                user_info.id_md5 = self._get_user_info_id_md5(act_id, user_account.id)
+                user_info.app_id = app_id
+                user_info.act_id = act_id
+                user_info.open_id = open_id
+                user_info.user_id = user_account.id
+                user_info.union_id = user_account.union_id
+                user_info.is_new = 1
+                user_info.user_nick = user_account.user_nick
+                user_info.user_nick_encrypt = user_account.user_nick_encrypt
+                user_info.avatar = user_account.avatar
+                user_info.is_auth = 0 if not user_info.user_nick else 1
+                user_info.create_date = now_datetime
+                user_info.modify_date = now_datetime
+                user_info.login_token = SevenHelper.get_random(16)
+                user_info.id = user_info_model.add_entity(user_info)
+            else:
+                if user_info.app_id != app_id:
+                    invoke_result_data.success = False
+                    invoke_result_data.error_code = "error"
+                    invoke_result_data.error_message = "非法操作"
+                    return invoke_result_data
+                user_info.union_id = user_account.union_id
+                user_info.user_nick = user_account.user_nick
+                user_info.user_nick_encrypt = user_account.user_nick_encrypt
+                user_info.avatar = user_account.avatar
+                user_info.is_auth = 0 if not user_info.user_nick else 1
+                # if TimeHelper.difference_minutes(now_datetime,user_info.create_date) > 1:
+                #     user_info.is_new = 0
+                user_info.is_new = 0
+                user_info.modify_date = now_datetime
+                user_info.login_token = SevenHelper.get_random(16)
+                user_info_model.update_entity(user_info, "modify_date,login_token,is_new,user_nick,user_nick_encrypt,avatar,is_auth,union_id")
+                user_info_model.delete_dependency_key([DependencyKey.user_info(act_id, user_info.id_md5), DependencyKey.user_info(act_id, "", user_info.open_id)])
+
+        except Exception as ex:
+            if self.context:
+                self.context.logging_link_error("【获取或更新用户信息】" + traceback.format_exc())
+            elif self.logging_link_error:
+                self.logging_link_error("【获取或更新用户信息】" + traceback.format_exc())
+        finally:
+            SevenHelper.redis_release_lock(acquire_lock_name, identifier)
+        if not user_info:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "fail"
+            invoke_result_data.error_message = "登录失败"
+            return invoke_result_data
+
+        user_info_dict = user_info.__dict__
+        user_info_dict["telephone"] = user_account.telephone if user_account else ""
+        user_info_dict["sex"] = user_account.sex if user_account else 0
+        user_info_dict["birthday"] = user_account.birthday if user_account and user_account.birthday != "1900-01-01" else ""
+        invoke_result_data.data = user_info_dict
+        return invoke_result_data
+
+    def update_user_info(self, app_id, act_id, user_id, open_id, user_nick, avatar, is_member_before=-1, is_favor_before=-1):
+        """
+        :description: 更新用户信息（主要用于授权更新昵称和头像）
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param user_id：用户标识
+        :param open_id：open_id
+        :param user_nick：昵称
+        :param avatar：头像
+        :param is_member_before：初始会员状态
+        :param is_favor_before：初始关注状态
+        :return: 返回用户信息
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+
+        if not act_id or (not user_id and not open_id):
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "param_error"
+            invoke_result_data.error_message = "参数不能为空或等于0"
+            return invoke_result_data
+
+        # 进行授权，有头像没昵称，则给默认的昵称
+        if avatar and not user_nick:
+            user_nick = "未知"
+
+        user_account_model = UserAccountModel(context=self.context)
+        user_info_dict = None
+        user_info_model = UserInfoModel(sub_table=self.get_business_sub_table("user_info_tb",{"app_id":app_id}),context=self.context)
+
+        try:
+            user_info_dict = self.get_user_info_dict(app_id, act_id, user_id, open_id)
+            if not user_info_dict:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "error"
+                invoke_result_data.error_message = "更新失败，找不到用户信息"
+                return invoke_result_data
+            else:
+                if user_info_dict["app_id"] != app_id:
+                    invoke_result_data.success = False
+                    invoke_result_data.error_code = "error"
+                    invoke_result_data.error_message = "非法操作"
+                    return invoke_result_data
+                user_info_dict["is_member_before"] = is_member_before if is_member_before != -1 else user_info_dict["is_member_before"]
+                user_info_dict["is_favor_before"] = is_favor_before if is_favor_before != -1 else user_info_dict["is_favor_before"]
+                if user_nick:
+                    user_info_dict["user_nick"] = CryptographyHelper.emoji_to_emoji_base64(user_nick)
+                    user_info_dict["user_nick_encrypt"] = CryptographyHelper.base64_encrypt(user_nick)
+                user_info_dict["avatar"] = avatar if avatar else user_info_dict["avatar"]
+                user_info_dict["is_auth"] = 1 if user_info_dict["user_nick"] else 0
+                user_info_dict["modify_date"] = SevenHelper.get_now_datetime()
+                user_info_model.update_table("user_nick=%s,user_nick_encrypt=%s,avatar=%s,modify_date=%s,is_auth=%s,is_member_before=%s,is_favor_before=%s", "id=%s", params=[user_info_dict["user_nick"], user_info_dict["user_nick_encrypt"], user_info_dict["avatar"], user_info_dict["modify_date"], user_info_dict["is_auth"], user_info_dict["is_member_before"], user_info_dict["is_favor_before"], user_info_dict["id"]])
+                user_info_model.delete_dependency_key([DependencyKey.user_info(act_id, user_info_dict["id_md5"]), DependencyKey.user_info(act_id, "", user_info_dict["open_id"])])
+
+                update_sql = ""
+                params = []
+                if user_nick:
+                    update_sql = "user_nick=%s,user_nick_encrypt=%s"
+                    params.append(CryptographyHelper.emoji_to_emoji_base64(user_nick))
+                    params.append(CryptographyHelper.base64_encrypt(user_nick))
+                if avatar:
+                    update_sql += "," if update_sql else ""
+                    update_sql += "avatar=%s"
+                    params.append(avatar)
+                params.append(user_info_dict["user_id"])
+                if update_sql:
+                    user_account_model.update_table(update_sql, "id=%s", params=params)
+                    user_account_model.delete_dependency_key(DependencyKey.user_account(user_info_dict["open_id"]))
+
+        except Exception as ex:
+            if self.context:
+                self.context.logging_link_error("【更新用户信息】" + traceback.format_exc())
+            elif self.logging_link_error:
+                self.logging_link_error("【更新用户信息】" + traceback.format_exc())
+
+        return invoke_result_data
+
+    def update_user_state(self, app_id, act_id, user_id, user_state):
+        """
+        :description: 更新用户状态
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param user_id：用户标识
+        :param user_state: 用户状态（0-正常，1-黑名单）
+        :return:
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        id_md5 = self._get_user_info_id_md5(act_id, user_id)
+        user_info_model = UserInfoModel(sub_table=self.get_business_sub_table("user_info_tb",{"app_id":app_id}), context=self.context)
+        user_info = user_info_model.get_entity("id_md5=%s", params=[id_md5])
+        if not user_info:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "用户信息不存在"
+            return invoke_result_data
+        if user_info.app_id != app_id:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "非法操作"
+            return invoke_result_data
+        if user_info.user_state == user_state:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "用户状态没变无需更新"
+            return invoke_result_data
+        modify_date = SevenHelper.get_now_datetime()
+        if user_state == 0:
+            user_info.relieve_date = modify_date
+        user_info.user_state = user_state
+        user_info.modify_date = modify_date
+        user_info_model.update_entity(user_info, "user_state,relieve_date,modify_date")
+
+        self._delete_user_info_cache(user_info.act_id, user_info.id_md5)
+        invoke_result_data.data = user_info.__dict__
+        return invoke_result_data
+
+    def update_user_state_by_black(self, app_id, act_id, user_id, reason=""):
+        """
+        :description: 用户拉入黑名单
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param user_id：用户标识
+        :param reason：拉黑理由
+        :return:
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        db_transaction = DbTransaction(db_config_dict=config.get_value("db_cloudapp"),context=self.context)
+        user_info_model = UserInfoModel(sub_table=self.get_business_sub_table("user_info_tb",{"app_id":app_id}), db_transaction=db_transaction, context=self.context)
+        user_black_model = UserBlackModel(db_transaction=db_transaction, context=self.context)
+
+        user_info_dict = self.get_user_info_dict(app_id, act_id, user_id)
+        if not user_info_dict:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "用户信息不存在"
+            return invoke_result_data
+        if user_info_dict["app_id"] != app_id:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "非法操作"
+            return invoke_result_data
+        if user_info_dict["user_state"] == 1:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "该用户已是黑名单"
+            return invoke_result_data
+        modify_date = SevenHelper.get_now_datetime()
+        user_info_dict["user_state"] = 1
+        user_info_dict["modify_date"] = modify_date
+
+        user_black = user_black_model.get_entity("act_id=%s and user_id=%s", params=[act_id, user_id])
+        try:
+            db_transaction.begin_transaction()
+            user_info_model.update_table("user_state=%s,modify_date=%s", "id=%s", params=[user_info_dict["user_state"], user_info_dict["modify_date"], user_info_dict["id"]])
+            if not user_black:
+                #添加到用户黑名单管理表
+                user_black = UserBlack()
+                user_black.app_id = user_info_dict["app_id"]
+                user_black.act_id = user_info_dict["act_id"]
+                user_black.user_id = user_info_dict["user_id"]
+                user_black.open_id = user_info_dict["open_id"]
+                user_black.user_nick = user_info_dict["user_nick"]
+                user_black.black_type = 2
+                user_black.refund_order_data = []
+                user_black.reason = reason
+                user_black.create_date = SevenHelper.get_now_datetime()
+                user_black_model.add_entity(user_black)
+            else:
+                user_black.audit_status = 0
+                user_black.black_type = 2
+                user_black.reason = reason
+                user_black.create_date = SevenHelper.get_now_datetime()
+                user_black_model.update_entity(user_black)
+            result,mesage = db_transaction.commit_transaction(True)
+            if not result:
+                raise Exception("执行事务失败",mesage)
+            invoke_result_data.data = {"user_info": user_info_dict}
+            self._delete_user_info_cache(user_info_dict["act_id"], user_info_dict["id_md5"])
+            self._delete_user_black_cache(act_id, user_id)
+        except Exception as ex:
+            if self.context:
+                self.context.logging_link_error("【更新用户状态黑名单】" + traceback.format_exc())
+            elif self.logging_link_error:
+                self.logging_link_error("【更新用户状态黑名单】" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "exception"
+            invoke_result_data.error_message = "系统繁忙,请稍后再试"
+        invoke_result_data.data = user_info_dict
+        return invoke_result_data
+
+    def apply_black_unbind(self, app_id, act_id, user_id, open_id="", reason="误封号,申请解封"):
+        """
+        :description: 申请黑名单解绑
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param user_id：用户标识
+        :param open_id：open_id
+        :return:
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        if not act_id or (not user_id and not open_id):
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "param_error"
+            invoke_result_data.error_message = "参数不能为空或等于0"
+            return invoke_result_data
+        user_info_dict = self.get_user_info_dict(app_id, act_id, user_id, open_id)
+        if not user_info_dict:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "用户信息不存在"
+            return invoke_result_data
+        if user_info_dict["app_id"] != app_id:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "非法操作"
+            return invoke_result_data
+
+        if user_info_dict["user_state"] == 0:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "账号正常,无需申请解封"
+            return invoke_result_data
+        user_black_model = UserBlackModel(context=self.context)
+        user_black = user_black_model.get_cache_entity("act_id=%s and user_id=%s", order_by="create_date desc", params=[act_id, user_id], dependency_key=DependencyKey.user_black(act_id, user_id))
+        if not user_black:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "账号正常,无需申请解封"
+            return invoke_result_data
+        if user_black.audit_status == 1:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "请耐心等待客服处理"
+            return invoke_result_data
+
+        user_black.audit_status = 1
+        user_black.reason = reason
+        user_black_model.update_entity(user_black, "audit_status,reason")
+        self._delete_user_black_cache(act_id, user_id)
+        return invoke_result_data
+
+    def audit_user_black(self, app_id, black_id, audit_status, audit_remark=""):
+        """
+        :description: 审核黑名单
+        :param app_id：应用标识
+        :param black_id：用户黑名单管理id
+        :param audit_status：审核状态(0黑名单1申请中2同意3拒绝)
+        :param audit_remark：审核备注
+        :return:
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        if black_id <= 0:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "param_error"
+            invoke_result_data.error_message = "参数不能为空或等于0"
+            return invoke_result_data
+        user_black_model = UserBlackModel(context=self.context)
+        user_black = user_black_model.get_entity_by_id(black_id)
+        if not user_black:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "找不到该条记录"
+            return invoke_result_data
+        if user_black.app_id != app_id:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "非法操作"
+            return invoke_result_data
+
+        user_info_model = UserInfoModel(sub_table=self.get_business_sub_table("user_info_tb",{"app_id":app_id}),context=self.context)
+        id_md5 = self._get_user_info_id_md5(user_black.act_id, user_black.user_id)
+        user_info = user_info_model.get_entity("id_md5=%s", params=[id_md5])
+        if not user_info:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "用户信息不存在"
+            return invoke_result_data
+        audit_date = SevenHelper.get_now_datetime()
+        condition = "audit_status=%s,audit_date=%s"
+        params = [audit_status, audit_date]
+        if audit_remark:
+            condition += ",audit_remark=%s"
+            params.append(audit_remark)
+        params.append(black_id)
+        if audit_status == 0:
+            condition += ",black_type=2"
+            user_black_model.update_table(condition, "id=%s", params)
+            user_info.user_state = 1
+            user_info.modify_date = audit_date
+            user_info_model.update_entity(user_info, "user_state,modify_date")
+        elif audit_status == 2:
+            user_black_model.update_table(condition, "id=%s", params)
+            user_info.user_state = 0
+            user_info.modify_date = audit_date
+            user_info.relieve_date = audit_date
+            user_info_model.update_entity(user_info, "user_state,relieve_date,modify_date")
+        elif audit_status == 3:
+            user_black_model.update_table(condition, "id=%s", params)
+
+        invoke_result_data.data = {"user_info": user_info.__dict__}
+        self._delete_user_info_cache(user_info.act_id, user_info.id_md5)
+        self._delete_user_black_cache(user_black.act_id, user_black.user_id)
+        return invoke_result_data
+
+    def update_audit_remark(self, app_id, black_id, audit_remark):
+        """
+        :description: 修改审核备注
+        :param app_id：应用标识
+        :param black_id：用户黑名单管理id
+        :param audit_remark：审核备注
+        :return:
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        if black_id <= 0:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "param_error"
+            invoke_result_data.error_message = "参数不能为空或等于0"
+            return invoke_result_data
+        user_black_model = UserBlackModel(context=self.context)
+        user_black = user_black_model.get_entity_by_id(black_id)
+        if not user_black:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "找不到该条记录"
+            return invoke_result_data
+        if user_black.app_id != app_id:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "非法操作"
+            return invoke_result_data
+        user_black_model.update_table("audit_remark=%s", "id=%s", [audit_remark, black_id])
+        self._delete_user_black_cache(user_black.act_id, user_black.user_id)
+        invoke_result_data.data = {"user_black": user_black.__dict__}
+        return invoke_result_data
+
+    def get_black_info_dict(self, app_id, act_id, user_id, is_cache=True):
+        """
+        :description: 获取黑名单单条记录
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param user_id：用户标识
+        :param is_cache：是否缓存
+        :return:
+        :last_editors: HuangJianYi
+        """
+        user_black_dict = None
+        if not act_id or not user_id:
+            return user_black_dict
+        user_info_dict = self.get_user_info_dict(app_id, act_id, user_id)
+        if not user_info_dict:
+            return user_black_dict
+        where = "act_id=%s and user_id=%s"
+        params = [act_id, user_id]
+        user_black_model = UserBlackModel(context=self.context)
+        if is_cache:
+            user_black_dict = user_black_model.get_cache_dict(where=where, limit="1", params=params, dependency_key=DependencyKey.user_black(act_id, user_id))
+        else:
+            user_black_dict = user_black_model.get_dict(where, limit="1", params=params)
+        return user_black_dict
+
+    def get_black_list(self, app_id, act_id, page_size=20, page_index=0, audit_status=-1, user_id=0, start_date="", end_date="", user_nick="", open_id="", order_by="id desc"):
+        """
+        :description: 获取用户黑名单列表
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param page_size：条数
+        :param page_index：页数
+        :param audit_status：审核状态(0黑名单1申请中2同意3拒绝)
+        :param user_id：用户标识
+        :param start_date：开始时间
+        :param end_date：结束时间
+        :param user_nick：昵称
+        :param open_id：open_id
+        :param order_by：排序
+        :return: 返回PageInfo
+        :last_editors: HuangJianYi
+        """
+        page_info = PageInfo(page_index, page_size, 0, [])
+        if not act_id:
+            return page_info
+
+        condition = "act_id=%s"
+        params = [act_id]
+
+        if app_id:
+            condition += " AND app_id=%s"
+            params.append(app_id)
+        if user_id != 0:
+            condition += " AND user_id=%s"
+            params.append(user_id)
+        if audit_status != -1:
+            condition += " AND audit_status=%s"
+            params.append(audit_status)
+        if open_id:
+            condition += " AND open_id=%s"
+            params.append(open_id)
+        if user_nick:
+            condition += " AND user_nick=%s"
+            params.append(user_nick)
+        if start_date:
+            condition += " AND create_date>=%s"
+            params.append(start_date)
+        if end_date:
+            condition += " AND create_date<=%s"
+            params.append(end_date)
+
+        page_list, total = UserBlackModel(context=self.context).get_dict_page_list("*", page_index, page_size, condition, order_by=order_by, params=params)
+        for user_black in page_list:
+            user_black["refund_order_data"] = SevenHelper.json_loads(user_black["refund_order_data"]) if user_black["refund_order_data"] else []
+
+        page_info = PageInfo(page_index, page_size, total, page_list)
+        return page_info
+
+    def check_pull_black(self, user_info_dict, is_black, refund_count, all_order_data):
+        """
+        :description: 校验是否拉黑
+        :param user_info_dict：用户信息字典
+        :param is_black：是否拉黑
+        :param refund_count：退款次数
+        :param all_order_data:淘宝订单列表
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        result = False
+        try:
+            if user_info_dict["user_state"] == 0 and is_black == 1 and refund_count > 0:
+                #退款的订单  子订单存在退款 记录一次
+                refund_order_data = [i for i in all_order_data if i.get("refund_status") and i.get("refund_status") not in self.refund_status()]
+                #如果不是黑用户 并且存在退款时间 代表黑用户解禁
+                if user_info_dict["relieve_date"] != '1900-01-01 00:00:00':
+                    refund_order_data = [i for i in refund_order_data if TimeHelper.format_time_to_datetime(str(i['pay_time'])) > TimeHelper.format_time_to_datetime(str(user_info_dict["relieve_date"]))]
+                #超过变成黑用户
+                if len(refund_order_data) >= refund_count:
+                    result = True
+                    user_info_model = UserInfoModel(sub_table=self.get_business_sub_table("user_info_tb",{"app_id":user_info_dict["app_id"]}),context=self.context)
+                    user_info_model.update_table("user_state=1", "id=%s", user_info_dict["id"])
+                    user_black_model = UserBlackModel(context=self.context)
+                    user_black = user_black_model.get_entity("act_id=%s and user_id=%s", params=[user_info_dict["act_id"], user_info_dict["user_id"]])
+                    if user_black:
+                        user_black.black_type = 1
+                        user_black.reason = ""
+                        user_black.audit_status = 0
+                        user_black.audit_remark = ""
+                        user_black.refund_count += len(refund_order_data)
+                        all_refund_order_data = SevenHelper.json_loads(user_black.refund_order_data)
+                        if len(refund_order_data) > 0:
+                            for item in refund_order_data:
+                                all_refund_order_data.append(item)
+                        user_black.refund_order_data = SevenHelper.json_dumps(all_refund_order_data)
+                        user_black_model.update_entity(user_black)
+                    else:
+                        user_black = UserBlack()
+                        user_black.app_id = user_info_dict["app_id"]
+                        user_black.act_id = user_info_dict["act_id"]
+                        user_black.user_id = user_info_dict["user_id"]
+                        user_black.open_id = user_info_dict["open_id"]
+                        user_black.user_nick = user_info_dict["user_nick"]
+                        user_black.black_type = 1
+                        user_black.reason = ""
+                        user_black.audit_status = 0
+                        user_black.audit_remark = ""
+                        user_black.refund_count = len(refund_order_data)
+                        user_black.refund_order_data = SevenHelper.json_dumps(refund_order_data)
+                        user_black.create_date = SevenHelper.get_now_datetime()
+                        user_black_model.add_entity(user_black)
+                    self._delete_user_info_cache(user_info_dict["act_id"], user_info_dict["id_md5"])
+        except Exception as ex:
+            if self.context:
+                self.context.logging_link_error("【校验是否拉黑】" + traceback.format_exc())
+            elif self.logging_link_error:
+                self.logging_link_error("【校验是否拉黑】" + traceback.format_exc())
+            result = False
+        return result
+
+    def get_user_address_list(self, app_id, act_id, user_id, is_cache=True):
+        """
+        :description: 获取用户地址列表
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param tb_user_id：用户标识
+        :param is_cache：是否缓存
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        user_address_list = []
+        if not act_id or not user_id:
+            return user_address_list
+        condition = "act_id=%s AND user_id=%s"
+        params = [act_id, user_id]
+        if app_id:
+            condition += " AND app_id=%s"
+            params.append(app_id)
+
+        user_address_model = UserAddressModel(context=self.context)
+        if is_cache:
+            user_address_list = user_address_model.get_cache_dict_list(condition, limit="100", params=params, dependency_key=DependencyKey.user_address_list(act_id,user_id))
+        else:
+            user_address_list = user_address_model.get_dict_list(condition, limit="100", params=params)
+
+        return user_address_list
+
+    def save_user_address(self, app_id, act_id, user_id, open_id, user_address_id, real_name, telephone, province, city, county, street, address, is_default):
+        """
+        :description: 保存用户地址
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param user_id：用户标识
+        :param open_id：open_id
+        :param user_address_id:用户地址标识,如果传-1则优先获取最新一条并更新，适用于不需要获取地址列表的场景
+        :param real_name：真实姓名
+        :param telephone：手机号码
+        :param province：省
+        :param city：市
+        :param county：区
+        :param street：街道
+        :param address：地址
+        :param is_default：是否默认地址（1是0否）
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        if not act_id or (not user_id and not open_id):
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "param_error"
+            invoke_result_data.error_message = "参数不能为空或等于0"
+            return invoke_result_data
+        is_contain_emoji = False
+        for i, item in enumerate(real_name):
+            if item in unicode_codes.UNICODE_EMOJI["en"]:
+                is_contain_emoji = True
+                break
+        if is_contain_emoji == True:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "收货人不能包含表情包"
+            return invoke_result_data
+        user_info_dict = self.get_user_info_dict(app_id, act_id, user_id, open_id)
+        if not user_info_dict:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "用户信息不存在"
+            return invoke_result_data
+        if user_info_dict["app_id"] != app_id:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "非法操作"
+            return invoke_result_data
+
+        user_address_model = UserAddressModel(context=self.context)
+        if is_default == 1:
+            user_address_model.update_table("is_default=0", "act_id=%s and user_id=%s", params=[act_id, user_id])
+        user_address = None
+        if user_address_id == -1:
+            user_address = user_address_model.get_entity("act_id=%s and user_id=%s", params=[act_id, user_id])
+            user_address_id = user_address.id if user_address else 0
+
+        if user_address_id > 0:
+            if not user_address:
+                user_address = user_address_model.get_entity("id=%s", params=[user_address_id])
+            if not user_address:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "error"
+                invoke_result_data.error_message = "地址信息不存在"
+                return invoke_result_data
+            user_address.real_name = real_name
+            user_address.telephone = telephone
+            user_address.province = province
+            user_address.city = city
+            user_address.county = county
+            user_address.street = street
+            user_address.address = address
+            user_address.is_default = is_default
+            user_address_model.update_entity(user_address, "real_name,telephone,province,city,county,street,address,is_default")
+        else:
+            user_address = UserAddress()
+            user_address.app_id = app_id
+            user_address.act_id = act_id
+            user_address.user_id = user_id
+            user_address.open_id = open_id
+            user_address.real_name = real_name
+            user_address.telephone = telephone
+            user_address.province = province
+            user_address.city = city
+            user_address.county = county
+            user_address.street = street
+            user_address.address = address
+            user_address.is_default = is_default
+            user_address.create_date = SevenHelper.get_now_datetime()
+            user_address_model.add_entity(user_address)
+        user_address_model.delete_dependency_key(DependencyKey.user_address_list(act_id,user_id))
+        return invoke_result_data
+
+    def update_user_telephone(self, open_id, telephone="", code=""):
+        """
+        :description: 更新用户手机号
+        :param open_id：open_id
+        :param telephone：手机号
+        :param code: 微信code，用于获取手机号
+        :return: InvokeResultData
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        if not telephone and not code:
+            invoke_result_data.error_code = "param_error"
+            invoke_result_data.error_message = "telephone和code不能都为空"
+            return invoke_result_data
+        if code:
+            invoke_result_data = WeChatHelper.get_user_phonenumber(code, share_config.get_value("app_id"), share_config.get_value("app_secret"))
+            if invoke_result_data.success == False:
+                return invoke_result_data
+            telephone = invoke_result_data.data.get("phoneNumber","")
+        user_account_model = UserAccountModel(context=self.context)
+        user_account_model.update_table("telephone=%s","open_id=%s",params=[telephone, open_id])
+        user_account_model.delete_dependency_key(DependencyKey.user_account(open_id))
         return invoke_result_data
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame/route.py` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame/route.py`

 * *Ordering differences only*

 * *Files 10% similar despite different names*

```diff
@@ -1,174 +1,174 @@
-﻿# -*- coding: utf-8 -*-
-"""
-:Author: HuangJianYi
-:Date: 2020-04-16 14:38:22
-@LastEditTime: 2023-02-16 17:56:48
-@LastEditors: HuangJianYi
-:Description: 基础路由   业务方可以直接使用语句 handlers.extend(seven_cloudapp_frame.route.seven_cloudapp_frame_route()) 引入
-"""
-# 框架引用
-from seven_framework.web_tornado.monitor import MonitorHandler
-from seven_cloudapp_frame.handlers.core import *
-from seven_cloudapp_frame.handlers.server import *
-from seven_cloudapp_frame.handlers.client import *
-
-
-def seven_cloudapp_frame_route():
-    return [
-        (r"/monitor", MonitorHandler),
-        (r"/", IndexHandler),
-        #客户端
-        (r"/client/address_list", address.AddressInfoListHandler),  #行政区列表
-        (r"/client/login", user.LoginHandler),  #小程序登录
-        (r"/client/update_user_info", user.UpdateUserInfoHandler),  #更新用户信息如昵称、头像等
-        (r"/client/check_is_member", user.CheckIsMemberHandler),  #校验是否是店铺会员
-        (r"/client/apply_black_unbind", user.ApplyBlackUnbindHandler),  #申请黑名单解封
-        (r"/client/get_unbind_apply", user.GetUnbindApplyHandler),  #获取黑名单解封申请记录
-        (r"/client/user_asset_list", user.GetUserAssetHandler),  #获取单条用户资产
-        (r"/client/user_asset_list", user.UserAssetListHandler),  #用户资产列表
-        (r"/client/asset_log_list", user.AssetLogListHandler),  #用户资产流水列表
-        (r"/client/get_join_member_url", user.GetJoinMemberUrlHandler),  #加入会员地址
-        (r"/client/get_coupon_prize", user.GetCouponPrizeHandler),  #领取淘宝优惠券
-        (r"/client/user_address_list", user.UserAddressListHandler),  #收货地址列表
-        (r"/client/save_user_address", user.SaveUserAddressHandler),  #保存收货地址
-        (r"/client/get_crm_integral", user.GetCrmIntegralHandler),  #获取淘宝店铺积分
-        (r"/client/theme_info", theme.ThemeInfoHandler),  #主题信息
-        (r"/client/save_theme", theme.SaveThemeHandler),  #保存主题信息，由前端通过工具进行保存
-        (r"/client/save_skin", theme.SaveSkinHandler),  #保存皮肤信息，由前端通过工具进行保存
-        (r"/client/theme_info_list", theme.ThemeInfoListHandler),  #主题列表
-        (r"/client/skin_info_list", theme.SkinInfoListHandler),  #皮肤列表
-        (r"/client/ip_info_list", ip_c.IpInfoListHandler),  #ip信息列表
-        (r"/client/act_info", act.ActInfoHandler),  #活动信息
-        (r"/client/act_prize_list", act.ActPrizeListHandler),  #活动奖品列表
-        (r"/client/cms_info_list", act.CmsInfoListHandler),  #位置信息列表
-        (r"/client/price_gear_list", act.PriceGearListHandler),  #价格档位列表
-        (r"/client/create_wechat_qrcode", app.CreateWeChatQrCodeHandler),  # 获取微信小程序码 
-        (r"/client/app_expire", app.AppExpireHandler),  #小程序过期时间
-        (r"/client/get_high_power_list", app.GetHighPowerListHandler),  #获取中台配置的高级权限列表
-        (r"/client/add_wechat_subscribe", app.AddWechatSubscribeHandler),  #添加微信订阅次数
-        (r"/client/upload_file", app.UploadFileHandler),  #上传文件
-        (r"/client/sku_info", goods.SkuInfoHandler),  #sku信息
-        (r"/client/goods_list", goods.GoodsListHandler),  #商品列表
-        (r"/client/horseracelamp_list", order.HorseracelampListHandler),  #中奖记录跑马灯列表
-        (r"/client/prize_order_list", order.PrizeOrderListHandler),  #用户订单列表
-        (r"/client/create_prize_order", order.SelectPrizeOrderHandler),  #选择中奖记录进行下单
-        (r"/client/submit_sku", order.SubmitSkuHandler),  #中奖记录选择sku
-        (r"/client/prize_roster_list", order.PrizeRosterListHandler),  #中奖记录列表
-        (r"/client/sync_pay_order", order.SyncPayOrderHandler),  #同步淘宝支付订单给用户加资产
-        (r"/client/task_info_list", task.TaskInfoListHandler),  #任务列表
-        (r"/client/receive_reward", task.ReceiveRewardHandler),  #统一领取任务奖励
-        (r"/client/free_gift", task.FreeGiftHandler),  #免费领取、新人有礼等任务
-        (r"/client/one_sign", task.OneSignHandler),  #单次签到任务
-        (r"/client/weekly_sign", task.WeeklySignHandler),  #每周签到任务
-        (r"/client/cumulative_sign", task.CumulativeSignHandler),  #累计签到任务
-        (r"/client/invite_new_user", task.InviteNewUserHandler),  #邀请新用户任务
-        (r"/client/invite_join_member", task.InviteJoinMemberHandler),  #邀请加入会员任务
-        (r"/client/browse_site", task.BrowseSiteHandler),  #处理浏览网址相关任务 如：浏览店铺、浏览直播间、浏览会场/专题
-        (r"/client/collect_goods", task.CollectGoodsHandler),  #收藏商品任务
-        (r"/client/browse_goods", task.BrowseGoodsHandler),  #浏览商品任务
-        (r"/client/favor_store", task.FavorStoreHandler),  #关注店铺任务
-        (r"/client/join_member", task.JoinMemberHandler),  #加入会员任务
-        (r"/client/task_share", task.ShareHandler),  #分享奖励任务
-        (r"/client/share_report", stat.ShareReportHandler),  #分享统计上报
-        (r"/client/invite_report", stat.InviteReportHandler),  #邀请进入统计上报
-        (r"/client/stat_report", stat.StatReportHandler),  #通用统计上报
-        (r"/client/wvoucher_order", pay.WechatVoucherOrderHandler),  #创建微信预订单
-        (r"/client/wpay_notify", pay.WechatPayNotifyHandler),  #微信支付异步通知
-        (r"/client/wrefund_notify", pay.WechatRefundNotifyHandler),  #微信退款异步通知
-        (r"/client/tvoucher_order", pay.TiktokVoucherOrderHandler),  #创建抖音预订单
-        (r"/client/tpay_notify", pay.TiktokPayNotifyHandler),  #抖音支付异步通知
-        (r"/client/trefund_notify", pay.TiktokRefundNotifyHandler),  #抖音退款异步通知
-
-        #后台和千牛端
-        (r"/server/left_navigation", base_s.LeftNavigationHandler),  #左侧导航
-        (r"/server/friend_link_list", base_s.FriendLinkListHandler),  #获取友情链接产品互推列表
-        (r"/server/send_sms", base_s.SendSmsHandler),  #发短信
-        (r"/server/get_product_price", base_s.GetProductPriceHandler),  #获取产品价格信息
-        (r"/server/get_high_power_list", app_s.GetHighPowerListHandler),  #获取中台配置的高级权限列表
-        (r"/server/app_info", app_s.AppInfoHandler),  #应用信息
-        (r"/server/check_gm_power", app_s.CheckGmPowerHandler),  #根据店铺名称返回应用标识 用于GM工具
-        (r"/server/get_appid_by_gm", app_s.GetAppidByGmHandler),  #获取是否有GM工具权限 用于GM工具
-        (r"/server/instantiate", app_s.InstantiateAppHandler),  #实例化小程序
-        (r"/server/version_upgrade", app_s.VersionUpgradeHandler),  #小程序端版本升级
-        (r"/server/update_telephone", app_s.UpdateTelephoneHandler),  #更新手机号
-        (r"/server/get_short_url", app_s.GetShortUrlHandler),  #淘宝短链接
-        (r"/server/update_store_asset", app_s.UpdateStoreAssetHandler),  #更新商家资产值
-        (r"/server/store_asset_list", app_s.StoreAssetListHandler),  #商家资产列表
-        (r"/server/store_asset_log_list", app_s.StoreAssetLogListHandler),  #商家资产流水列表
-        (r"/server/cms_info_list", cms_s.CmsInfoListHandler),  #获取资讯列表
-        (r"/server/save_cms_info", cms_s.SaveCmsInfoHandler),  #保存资讯信息
-        (r"/server/act_type_list", act_s.ActTypeListHandler),  #活动类型列表
-        (r"/server/next_progress", act_s.NextProgressHandler),  #活动下一步操作
-        (r"/server/add_act_info", act_s.AddActInfoHandler),  #添加活动
-        (r"/server/update_act_info", act_s.UpdateActInfoHandler),  #修改活动
-        (r"/server/act_info_list", act_s.ActInfoListHandler),  #活动列表
-        (r"/server/act_info", act_s.ActInfoHandler),  #单条活动信息
-        (r"/server/delete_act_info", act_s.DeleteActInfoHandler),  #删除活动（假删除）
-        (r"/server/review_act_info", act_s.ReviewActInfoHandler),  #还原活动
-        (r"/server/release_act_info", act_s.ReleaseActInfoHandler),  #上下架活动
-        (r"/server/create_act_qrcode", act_s.CreateActQrCodeHandler),  #生成小程序二维码
-        (r"/server/save_act_module", module_s.SaveActModuleHandler),  #保存活动模块信息（保存新增和修改）
-        (r"/server/act_module", module_s.ActModuleHandler),  #单条活动模块信息
-        (r"/server/act_module_list", module_s.ActModuleListHandler),  #活动模块列表
-        (r"/server/delete_act_module", module_s.DeleteActModuleHandler),  #删除活动模块（假删除）
-        (r"/server/review_act_module", module_s.ReviewActModuleHandler),  #还原活动模块
-        (r"/server/release_act_module", module_s.ReleaseActModuleHandler),  #上下架活动模块
-        (r"/server/save_act_prize", prize_s.SaveActPrizeHandler),  #保存活动奖品
-        (r"/server/act_prize_list", prize_s.ActPrizeListHandler),  #活动奖品列表
-        (r"/server/delete_act_prize", prize_s.DeleteActPrizeHandler),  #删除活动奖品（假删除）
-        (r"/server/review_act_prize", prize_s.ReviewActPrizeHandler),  #还原活动奖品
-        (r"/server/release_act_prize", prize_s.ReleaseActPrizeHandler),  #上下架活动奖品
-        (r"/server/act_prize_export", prize_s.ActPrizeExportHandler),  #导出活动奖品列表
-        (r"/server/pay_order_list", order_s.PayOrderListHandler),  #淘宝支付订单列表
-        (r"/server/prize_order_list", order_s.PrizeOrderListHandler),  #奖品订单列表
-        (r"/server/prize_roster_list", order_s.PrizeRosterListHandler),  #用户中奖记录列表
-        (r"/server/prize_order_export", order_s.PrizeOrderExportHandler),  #导出奖品订单列表
-        (r"/server/prize_roster_export", order_s.PrizeRosterExportHandler),  #导出用户中奖记录列表
-        (r"/server/tao_pay_order_export", order_s.TaoPayOrderExportHandler),  #导出淘宝订单列表
-        (r"/server/update_prize_order_status", order_s.UpdatePrizeOrderStatusHandler),  #更新奖品订单状态
-        (r"/server/update_prize_order_seller_remark", order_s.UpdatePrizeOrderSellerRemarkHandler),  #更新奖品订单卖家备注
-        (r"/server/import_prize_order", order_s.ImportPrizeOrderHandler),  #导入发货订单
-        (r"/server/stat_report_list", report_s.StatReportListHandler),  #报表数据列表(表格)
-        (r"/server/trend_report_list", report_s.TrendReportListHandler),  #报表数据列表(趋势图)
-        (r"/server/login", user_s.LoginHandler),  #千牛端登录
-        (r"/server/user_info_list", user_s.UserInfoListHandler),  #用户信息列表
-        (r"/server/update_user_status", user_s.UpdateUserStatusHandler),  #更新用户状态（0正常1黑名单）
-        (r"/server/update_user_status_by_black", user_s.UpdateUserStatusByBlackHandler),  #更新用户状态(黑名单管理模式)
-        (r"/server/audit_user_black", user_s.AuditUserBlackHandler),  #审核黑名单状态
-        (r"/server/update_audit_remark", user_s.UpdateAuditRemarkHandler),  #修改审核备注
-        (r"/server/user_black_list", user_s.UserBlackListHandler),  #黑名单列表
-        (r"/server/update_user_asset", user_s.UpdateUserAssetHandler),  #更新用户资产值
-        (r"/server/batch_update_user_asset", user_s.BatchUpdateUserAssetHandler),  #批量更新用户资产值
-        (r"/server/user_asset_list", user_s.UserAssetListHandler),  #用户资产列表
-        (r"/server/asset_log_list", user_s.AssetLogListHandler),  #资产流水列表
-        (r"/server/init_launch_goods", launch_s.ResetLaunchGoodsHandler),  #重置商品投放 删除已投放的记录并将活动投放状态改为未投放
-        (r"/server/init_launch_goods", launch_s.InitLaunchGoodsHandler),  #初始化投放商品
-        (r"/server/async_launch_goods", launch_s.AsyncLaunchGoodsHandler),  #同步投放商品（小程序投放-商品绑定/解绑）
-        (r"/server/launch_goods_list", launch_s.LaunchGoodsListHandler),  #投放商品列表
-        (r"/server/update_launch_goods_status", launch_s.UpdateLaunchGoodsStatusHandler),  #更新投放商品的状态
-        (r"/server/init_launch_goods_callback", launch_s.InitLaunchGoodsCallBackHandler),  #初始化投放商品回调接口
-        (r"/server/update_theme", theme_s.UpdateThemeHandler),  #更新主题
-        (r"/server/theme_info_list", theme_s.ThemeInfoListHandler),  #主题信息列表
-        (r"/server/skin_info_list", theme_s.SkinInfoListHandler),  #皮肤信息列表
-        (r"/server/save_ip_type", ip_s.SaveIpTypeHandler),  #保存ip类型
-        (r"/server/ip_type_list", ip_s.IpTypeListHandler),  #ip类型列表
-        (r"/server/release_ip_type", ip_s.ReleaseIpTypeHandler),  #上下架ip类型
-        (r"/server/save_ip_info", ip_s.SaveIpInfoHandler),  #保存ip信息
-        (r"/server/delete_ip_info", ip_s.DeleteIpInfoHandler),  #删除ip信息
-        (r"/server/ip_info_list", ip_s.IpInfoListHandler),  #ip信息列表
-        (r"/server/release_ip_info", ip_s.ReleaseIpInfoHandler),  #上下架ip信息
-        (r"/server/save_price_gear", price_s.SavePriceGearHandler),  #保存价格档位信息
-        (r"/server/price_gear_list", price_s.PriceGearListHandler),  #价格档位列表
-        (r"/server/delete_price_gear", price_s.DeletePriceGearHandler),  #删除价格档位（假删除）
-        (r"/server/review_price_gear", price_s.ReviewPriceGearHandler),  #还原价格档位
-        (r"/server/check_price_gear", price_s.CheckPriceGearHandler),  #校验价格档位
-        (r"/server/inventory_goods_list", goods_s.InventoryGoodsListHandler),  #仓库中的商品列表
-        (r"/server/goods_list", goods_s.GoodsListHandler),  #在售中的商品列表
-        (r"/server/goods_list_by_goodsids", goods_s.GoodsListByGoodsIDHandler),  #根据商品ID返回在售中商品列表
-        (r"/server/goods_info", goods_s.GoodsInfoHandler),  #商品信息
-        (r"/server/benefit_detail", goods_s.BenefitDetailHandler),  #获取优惠券详情信息
-        (r"/server/special_goods_list", goods_s.SpecialGoodsListHandler),  #专属下单商品列表
-        (r"/server/bind_special_goods", goods_s.BindSpecialGoodsHandler),  #专属下单商品绑定
-        (r"/server/cms_info_list", cms_s.CmsInfoListHandler),  #获取资讯列表
-        (r"/server/save_cms_info", cms_s.SaveCmsInfoHandler),  #保存资讯信息
+﻿# -*- coding: utf-8 -*-
+"""
+:Author: HuangJianYi
+:Date: 2020-04-16 14:38:22
+@LastEditTime: 2023-02-16 17:56:48
+@LastEditors: HuangJianYi
+:Description: 基础路由   业务方可以直接使用语句 handlers.extend(seven_cloudapp_frame.route.seven_cloudapp_frame_route()) 引入
+"""
+# 框架引用
+from seven_framework.web_tornado.monitor import MonitorHandler
+from seven_cloudapp_frame.handlers.core import *
+from seven_cloudapp_frame.handlers.server import *
+from seven_cloudapp_frame.handlers.client import *
+
+
+def seven_cloudapp_frame_route():
+    return [
+        (r"/monitor", MonitorHandler),
+        (r"/", IndexHandler),
+        #客户端
+        (r"/client/address_list", address.AddressInfoListHandler),  #行政区列表
+        (r"/client/login", user.LoginHandler),  #小程序登录
+        (r"/client/update_user_info", user.UpdateUserInfoHandler),  #更新用户信息如昵称、头像等
+        (r"/client/check_is_member", user.CheckIsMemberHandler),  #校验是否是店铺会员
+        (r"/client/apply_black_unbind", user.ApplyBlackUnbindHandler),  #申请黑名单解封
+        (r"/client/get_unbind_apply", user.GetUnbindApplyHandler),  #获取黑名单解封申请记录
+        (r"/client/user_asset_list", user.GetUserAssetHandler),  #获取单条用户资产
+        (r"/client/user_asset_list", user.UserAssetListHandler),  #用户资产列表
+        (r"/client/asset_log_list", user.AssetLogListHandler),  #用户资产流水列表
+        (r"/client/get_join_member_url", user.GetJoinMemberUrlHandler),  #加入会员地址
+        (r"/client/get_coupon_prize", user.GetCouponPrizeHandler),  #领取淘宝优惠券
+        (r"/client/user_address_list", user.UserAddressListHandler),  #收货地址列表
+        (r"/client/save_user_address", user.SaveUserAddressHandler),  #保存收货地址
+        (r"/client/get_crm_integral", user.GetCrmIntegralHandler),  #获取淘宝店铺积分
+        (r"/client/theme_info", theme.ThemeInfoHandler),  #主题信息
+        (r"/client/save_theme", theme.SaveThemeHandler),  #保存主题信息，由前端通过工具进行保存
+        (r"/client/save_skin", theme.SaveSkinHandler),  #保存皮肤信息，由前端通过工具进行保存
+        (r"/client/theme_info_list", theme.ThemeInfoListHandler),  #主题列表
+        (r"/client/skin_info_list", theme.SkinInfoListHandler),  #皮肤列表
+        (r"/client/ip_info_list", ip_c.IpInfoListHandler),  #ip信息列表
+        (r"/client/act_info", act.ActInfoHandler),  #活动信息
+        (r"/client/act_prize_list", act.ActPrizeListHandler),  #活动奖品列表
+        (r"/client/cms_info_list", act.CmsInfoListHandler),  #位置信息列表
+        (r"/client/price_gear_list", act.PriceGearListHandler),  #价格档位列表
+        (r"/client/create_wechat_qrcode", app.CreateWeChatQrCodeHandler),  # 获取微信小程序码 
+        (r"/client/app_expire", app.AppExpireHandler),  #小程序过期时间
+        (r"/client/get_high_power_list", app.GetHighPowerListHandler),  #获取中台配置的高级权限列表
+        (r"/client/add_wechat_subscribe", app.AddWechatSubscribeHandler),  #添加微信订阅次数
+        (r"/client/upload_file", app.UploadFileHandler),  #上传文件
+        (r"/client/sku_info", goods.SkuInfoHandler),  #sku信息
+        (r"/client/goods_list", goods.GoodsListHandler),  #商品列表
+        (r"/client/horseracelamp_list", order.HorseracelampListHandler),  #中奖记录跑马灯列表
+        (r"/client/prize_order_list", order.PrizeOrderListHandler),  #用户订单列表
+        (r"/client/create_prize_order", order.SelectPrizeOrderHandler),  #选择中奖记录进行下单
+        (r"/client/submit_sku", order.SubmitSkuHandler),  #中奖记录选择sku
+        (r"/client/prize_roster_list", order.PrizeRosterListHandler),  #中奖记录列表
+        (r"/client/sync_pay_order", order.SyncPayOrderHandler),  #同步淘宝支付订单给用户加资产
+        (r"/client/task_info_list", task.TaskInfoListHandler),  #任务列表
+        (r"/client/receive_reward", task.ReceiveRewardHandler),  #统一领取任务奖励
+        (r"/client/free_gift", task.FreeGiftHandler),  #免费领取、新人有礼等任务
+        (r"/client/one_sign", task.OneSignHandler),  #单次签到任务
+        (r"/client/weekly_sign", task.WeeklySignHandler),  #每周签到任务
+        (r"/client/cumulative_sign", task.CumulativeSignHandler),  #累计签到任务
+        (r"/client/invite_new_user", task.InviteNewUserHandler),  #邀请新用户任务
+        (r"/client/invite_join_member", task.InviteJoinMemberHandler),  #邀请加入会员任务
+        (r"/client/browse_site", task.BrowseSiteHandler),  #处理浏览网址相关任务 如：浏览店铺、浏览直播间、浏览会场/专题
+        (r"/client/collect_goods", task.CollectGoodsHandler),  #收藏商品任务
+        (r"/client/browse_goods", task.BrowseGoodsHandler),  #浏览商品任务
+        (r"/client/favor_store", task.FavorStoreHandler),  #关注店铺任务
+        (r"/client/join_member", task.JoinMemberHandler),  #加入会员任务
+        (r"/client/task_share", task.ShareHandler),  #分享奖励任务
+        (r"/client/share_report", stat.ShareReportHandler),  #分享统计上报
+        (r"/client/invite_report", stat.InviteReportHandler),  #邀请进入统计上报
+        (r"/client/stat_report", stat.StatReportHandler),  #通用统计上报
+        (r"/client/wvoucher_order", pay.WechatVoucherOrderHandler),  #创建微信预订单
+        (r"/client/wpay_notify", pay.WechatPayNotifyHandler),  #微信支付异步通知
+        (r"/client/wrefund_notify", pay.WechatRefundNotifyHandler),  #微信退款异步通知
+        (r"/client/tvoucher_order", pay.TiktokVoucherOrderHandler),  #创建抖音预订单
+        (r"/client/tpay_notify", pay.TiktokPayNotifyHandler),  #抖音支付异步通知
+        (r"/client/trefund_notify", pay.TiktokRefundNotifyHandler),  #抖音退款异步通知
+
+        #后台和千牛端
+        (r"/server/left_navigation", base_s.LeftNavigationHandler),  #左侧导航
+        (r"/server/friend_link_list", base_s.FriendLinkListHandler),  #获取友情链接产品互推列表
+        (r"/server/send_sms", base_s.SendSmsHandler),  #发短信
+        (r"/server/get_product_price", base_s.GetProductPriceHandler),  #获取产品价格信息
+        (r"/server/get_high_power_list", app_s.GetHighPowerListHandler),  #获取中台配置的高级权限列表
+        (r"/server/app_info", app_s.AppInfoHandler),  #应用信息
+        (r"/server/check_gm_power", app_s.CheckGmPowerHandler),  #根据店铺名称返回应用标识 用于GM工具
+        (r"/server/get_appid_by_gm", app_s.GetAppidByGmHandler),  #获取是否有GM工具权限 用于GM工具
+        (r"/server/instantiate", app_s.InstantiateAppHandler),  #实例化小程序
+        (r"/server/version_upgrade", app_s.VersionUpgradeHandler),  #小程序端版本升级
+        (r"/server/update_telephone", app_s.UpdateTelephoneHandler),  #更新手机号
+        (r"/server/get_short_url", app_s.GetShortUrlHandler),  #淘宝短链接
+        (r"/server/update_store_asset", app_s.UpdateStoreAssetHandler),  #更新商家资产值
+        (r"/server/store_asset_list", app_s.StoreAssetListHandler),  #商家资产列表
+        (r"/server/store_asset_log_list", app_s.StoreAssetLogListHandler),  #商家资产流水列表
+        (r"/server/cms_info_list", cms_s.CmsInfoListHandler),  #获取资讯列表
+        (r"/server/save_cms_info", cms_s.SaveCmsInfoHandler),  #保存资讯信息
+        (r"/server/act_type_list", act_s.ActTypeListHandler),  #活动类型列表
+        (r"/server/next_progress", act_s.NextProgressHandler),  #活动下一步操作
+        (r"/server/add_act_info", act_s.AddActInfoHandler),  #添加活动
+        (r"/server/update_act_info", act_s.UpdateActInfoHandler),  #修改活动
+        (r"/server/act_info_list", act_s.ActInfoListHandler),  #活动列表
+        (r"/server/act_info", act_s.ActInfoHandler),  #单条活动信息
+        (r"/server/delete_act_info", act_s.DeleteActInfoHandler),  #删除活动（假删除）
+        (r"/server/review_act_info", act_s.ReviewActInfoHandler),  #还原活动
+        (r"/server/release_act_info", act_s.ReleaseActInfoHandler),  #上下架活动
+        (r"/server/create_act_qrcode", act_s.CreateActQrCodeHandler),  #生成小程序二维码
+        (r"/server/save_act_module", module_s.SaveActModuleHandler),  #保存活动模块信息（保存新增和修改）
+        (r"/server/act_module", module_s.ActModuleHandler),  #单条活动模块信息
+        (r"/server/act_module_list", module_s.ActModuleListHandler),  #活动模块列表
+        (r"/server/delete_act_module", module_s.DeleteActModuleHandler),  #删除活动模块（假删除）
+        (r"/server/review_act_module", module_s.ReviewActModuleHandler),  #还原活动模块
+        (r"/server/release_act_module", module_s.ReleaseActModuleHandler),  #上下架活动模块
+        (r"/server/save_act_prize", prize_s.SaveActPrizeHandler),  #保存活动奖品
+        (r"/server/act_prize_list", prize_s.ActPrizeListHandler),  #活动奖品列表
+        (r"/server/delete_act_prize", prize_s.DeleteActPrizeHandler),  #删除活动奖品（假删除）
+        (r"/server/review_act_prize", prize_s.ReviewActPrizeHandler),  #还原活动奖品
+        (r"/server/release_act_prize", prize_s.ReleaseActPrizeHandler),  #上下架活动奖品
+        (r"/server/act_prize_export", prize_s.ActPrizeExportHandler),  #导出活动奖品列表
+        (r"/server/pay_order_list", order_s.PayOrderListHandler),  #淘宝支付订单列表
+        (r"/server/prize_order_list", order_s.PrizeOrderListHandler),  #奖品订单列表
+        (r"/server/prize_roster_list", order_s.PrizeRosterListHandler),  #用户中奖记录列表
+        (r"/server/prize_order_export", order_s.PrizeOrderExportHandler),  #导出奖品订单列表
+        (r"/server/prize_roster_export", order_s.PrizeRosterExportHandler),  #导出用户中奖记录列表
+        (r"/server/tao_pay_order_export", order_s.TaoPayOrderExportHandler),  #导出淘宝订单列表
+        (r"/server/update_prize_order_status", order_s.UpdatePrizeOrderStatusHandler),  #更新奖品订单状态
+        (r"/server/update_prize_order_seller_remark", order_s.UpdatePrizeOrderSellerRemarkHandler),  #更新奖品订单卖家备注
+        (r"/server/import_prize_order", order_s.ImportPrizeOrderHandler),  #导入发货订单
+        (r"/server/stat_report_list", report_s.StatReportListHandler),  #报表数据列表(表格)
+        (r"/server/trend_report_list", report_s.TrendReportListHandler),  #报表数据列表(趋势图)
+        (r"/server/login", user_s.LoginHandler),  #千牛端登录
+        (r"/server/user_info_list", user_s.UserInfoListHandler),  #用户信息列表
+        (r"/server/update_user_status", user_s.UpdateUserStatusHandler),  #更新用户状态（0正常1黑名单）
+        (r"/server/update_user_status_by_black", user_s.UpdateUserStatusByBlackHandler),  #更新用户状态(黑名单管理模式)
+        (r"/server/audit_user_black", user_s.AuditUserBlackHandler),  #审核黑名单状态
+        (r"/server/update_audit_remark", user_s.UpdateAuditRemarkHandler),  #修改审核备注
+        (r"/server/user_black_list", user_s.UserBlackListHandler),  #黑名单列表
+        (r"/server/update_user_asset", user_s.UpdateUserAssetHandler),  #更新用户资产值
+        (r"/server/batch_update_user_asset", user_s.BatchUpdateUserAssetHandler),  #批量更新用户资产值
+        (r"/server/user_asset_list", user_s.UserAssetListHandler),  #用户资产列表
+        (r"/server/asset_log_list", user_s.AssetLogListHandler),  #资产流水列表
+        (r"/server/init_launch_goods", launch_s.ResetLaunchGoodsHandler),  #重置商品投放 删除已投放的记录并将活动投放状态改为未投放
+        (r"/server/init_launch_goods", launch_s.InitLaunchGoodsHandler),  #初始化投放商品
+        (r"/server/async_launch_goods", launch_s.AsyncLaunchGoodsHandler),  #同步投放商品（小程序投放-商品绑定/解绑）
+        (r"/server/launch_goods_list", launch_s.LaunchGoodsListHandler),  #投放商品列表
+        (r"/server/update_launch_goods_status", launch_s.UpdateLaunchGoodsStatusHandler),  #更新投放商品的状态
+        (r"/server/init_launch_goods_callback", launch_s.InitLaunchGoodsCallBackHandler),  #初始化投放商品回调接口
+        (r"/server/update_theme", theme_s.UpdateThemeHandler),  #更新主题
+        (r"/server/theme_info_list", theme_s.ThemeInfoListHandler),  #主题信息列表
+        (r"/server/skin_info_list", theme_s.SkinInfoListHandler),  #皮肤信息列表
+        (r"/server/save_ip_type", ip_s.SaveIpTypeHandler),  #保存ip类型
+        (r"/server/ip_type_list", ip_s.IpTypeListHandler),  #ip类型列表
+        (r"/server/release_ip_type", ip_s.ReleaseIpTypeHandler),  #上下架ip类型
+        (r"/server/save_ip_info", ip_s.SaveIpInfoHandler),  #保存ip信息
+        (r"/server/delete_ip_info", ip_s.DeleteIpInfoHandler),  #删除ip信息
+        (r"/server/ip_info_list", ip_s.IpInfoListHandler),  #ip信息列表
+        (r"/server/release_ip_info", ip_s.ReleaseIpInfoHandler),  #上下架ip信息
+        (r"/server/save_price_gear", price_s.SavePriceGearHandler),  #保存价格档位信息
+        (r"/server/price_gear_list", price_s.PriceGearListHandler),  #价格档位列表
+        (r"/server/delete_price_gear", price_s.DeletePriceGearHandler),  #删除价格档位（假删除）
+        (r"/server/review_price_gear", price_s.ReviewPriceGearHandler),  #还原价格档位
+        (r"/server/check_price_gear", price_s.CheckPriceGearHandler),  #校验价格档位
+        (r"/server/inventory_goods_list", goods_s.InventoryGoodsListHandler),  #仓库中的商品列表
+        (r"/server/goods_list", goods_s.GoodsListHandler),  #在售中的商品列表
+        (r"/server/goods_list_by_goodsids", goods_s.GoodsListByGoodsIDHandler),  #根据商品ID返回在售中商品列表
+        (r"/server/goods_info", goods_s.GoodsInfoHandler),  #商品信息
+        (r"/server/benefit_detail", goods_s.BenefitDetailHandler),  #获取优惠券详情信息
+        (r"/server/special_goods_list", goods_s.SpecialGoodsListHandler),  #专属下单商品列表
+        (r"/server/bind_special_goods", goods_s.BindSpecialGoodsHandler),  #专属下单商品绑定
+        (r"/server/cms_info_list", cms_s.CmsInfoListHandler),  #获取资讯列表
+        (r"/server/save_cms_info", cms_s.SaveCmsInfoHandler),  #保存资讯信息
     ]
```

### Comparing `seven_cloudapp_frame-1.0.98/seven_cloudapp_frame.egg-info/SOURCES.txt` & `seven_cloudapp_frame-1.0.99/seven_cloudapp_frame.egg-info/SOURCES.txt`

 * *Files 0% similar despite different names*

```diff
@@ -1,7 +1,8 @@
+LICENSE
 README.md
 setup.py
 seven_cloudapp_frame/__init__.py
 seven_cloudapp_frame/route.py
 seven_cloudapp_frame.egg-info/PKG-INFO
 seven_cloudapp_frame.egg-info/SOURCES.txt
 seven_cloudapp_frame.egg-info/dependency_links.txt
```

