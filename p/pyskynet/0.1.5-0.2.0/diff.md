# Comparing `tmp/pyskynet-0.1.5.tar.gz` & `tmp/pyskynet-0.2.0.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "dist/pyskynet-0.1.5.tar", last modified: Tue Dec  7 11:17:40 2021, max compression
+gzip compressed data, was "dist/pyskynet-0.2.0.tar", last modified: Mon Aug  7 03:14:43 2023, max compression
```

## Comparing `pyskynet-0.1.5.tar` & `pyskynet-0.2.0.tar`

### file list

```diff
@@ -1,654 +1,781 @@
-drwxr-xr-x   0 root         (0) root         (0)        0 2021-12-07 11:17:40.000000 pyskynet-0.1.5/
--rw-r--r--   0 root         (0) root         (0)       38 2021-12-07 11:17:40.000000 pyskynet-0.1.5/setup.cfg
-drwxr-xr-x   0 root         (0) root         (0)        0 2021-12-07 11:17:39.000000 pyskynet-0.1.5/pyskynet.egg-info/
--rw-r--r--   0 root         (0) root         (0)       34 2021-12-07 11:17:35.000000 pyskynet-0.1.5/pyskynet.egg-info/requires.txt
--rw-r--r--   0 root         (0) root         (0)       49 2021-12-07 11:17:35.000000 pyskynet-0.1.5/pyskynet.egg-info/entry_points.txt
--rw-r--r--   0 root         (0) root         (0)    21957 2021-12-07 11:17:38.000000 pyskynet-0.1.5/pyskynet.egg-info/SOURCES.txt
--rw-r--r--   0 root         (0) root         (0)       16 2021-12-07 11:17:35.000000 pyskynet-0.1.5/pyskynet.egg-info/top_level.txt
--rw-r--r--   0 root         (0) root         (0)        1 2021-12-07 11:17:35.000000 pyskynet-0.1.5/pyskynet.egg-info/dependency_links.txt
--rw-r--r--   0 root         (0) root         (0)        1 2021-11-10 06:36:04.000000 pyskynet-0.1.5/pyskynet.egg-info/not-zip-safe
--rw-r--r--   0 root         (0) root         (0)      286 2021-12-07 11:17:35.000000 pyskynet-0.1.5/pyskynet.egg-info/PKG-INFO
--rw-r--r--   0 root         (0) root         (0)      613 2021-11-10 06:33:56.000000 pyskynet-0.1.5/MANIFEST.in
-drwxr-xr-x   0 root         (0) root         (0)        0 2021-12-07 11:17:38.000000 pyskynet-0.1.5/3rd/
-drwxr-xr-x   0 root         (0) root         (0)        0 2021-12-07 11:17:39.000000 pyskynet-0.1.5/3rd/rapidxml/
--rw-r--r--   0 root         (0) root         (0)    16092 2021-09-29 08:06:28.000000 pyskynet-0.1.5/3rd/rapidxml/rapidxml_print.hpp
--rw-r--r--   0 root         (0) root         (0)     2511 2021-09-29 08:06:28.000000 pyskynet-0.1.5/3rd/rapidxml/lua-rapidxml.cpp
--rw-r--r--   0 root         (0) root         (0)     2804 2021-09-29 08:06:28.000000 pyskynet-0.1.5/3rd/rapidxml/license.txt
--rw-r--r--   0 root         (0) root         (0)   120937 2021-09-29 08:06:28.000000 pyskynet-0.1.5/3rd/rapidxml/rapidxml.hpp
--rw-r--r--   0 root         (0) root         (0)     4092 2021-09-29 08:06:28.000000 pyskynet-0.1.5/3rd/rapidxml/rapidxml_iterators.hpp
--rw-r--r--   0 root         (0) root         (0)     3539 2021-09-29 08:06:28.000000 pyskynet-0.1.5/3rd/rapidxml/rapidxml_utils.hpp
--rw-r--r--   0 root         (0) root         (0)      106 2021-09-29 08:06:28.000000 pyskynet-0.1.5/3rd/rapidxml/Makefile
-drwxr-xr-x   0 root         (0) root         (0)        0 2021-12-07 11:17:39.000000 pyskynet-0.1.5/3rd/lua-protobuf/
--rw-r--r--   0 root         (0) root         (0)      107 2021-09-29 08:11:53.000000 pyskynet-0.1.5/3rd/lua-protobuf/.gitignore
--rw-r--r--   0 root         (0) root         (0)    35128 2021-09-29 08:11:53.000000 pyskynet-0.1.5/3rd/lua-protobuf/README.zh.md
--rw-r--r--   0 root         (0) root         (0)    53331 2021-09-29 08:11:53.000000 pyskynet-0.1.5/3rd/lua-protobuf/pb.h
--rw-r--r--   0 root         (0) root         (0)     1022 2021-09-29 08:11:53.000000 pyskynet-0.1.5/3rd/lua-protobuf/.travis.yml
--rw-r--r--   0 root         (0) root         (0)    34050 2021-09-29 08:11:53.000000 pyskynet-0.1.5/3rd/lua-protobuf/protoc.lua
--rw-r--r--   0 root         (0) root         (0)    60112 2021-09-29 08:11:53.000000 pyskynet-0.1.5/3rd/lua-protobuf/pb.c
-drwxr-xr-x   0 root         (0) root         (0)        0 2021-12-07 11:17:38.000000 pyskynet-0.1.5/3rd/lua-protobuf/.github/
-drwxr-xr-x   0 root         (0) root         (0)        0 2021-12-07 11:17:39.000000 pyskynet-0.1.5/3rd/lua-protobuf/.github/workflows/
--rw-r--r--   0 root         (0) root         (0)     2182 2021-09-29 08:11:53.000000 pyskynet-0.1.5/3rd/lua-protobuf/.github/workflows/test.yml
--rw-r--r--   0 root         (0) root         (0)    25649 2021-09-29 08:11:53.000000 pyskynet-0.1.5/3rd/lua-protobuf/README.md
--rw-r--r--   0 root         (0) root         (0)   107116 2021-09-29 08:11:53.000000 pyskynet-0.1.5/3rd/lua-protobuf/luaunit.lua
-drwxr-xr-x   0 root         (0) root         (0)        0 2021-12-07 11:17:39.000000 pyskynet-0.1.5/3rd/lua-protobuf/rockspecs/
--rw-r--r--   0 root         (0) root         (0)      492 2021-09-29 08:11:53.000000 pyskynet-0.1.5/3rd/lua-protobuf/rockspecs/lua-protobuf-scm-1.rockspec
--rw-r--r--   0 root         (0) root         (0)    39060 2021-09-29 08:11:53.000000 pyskynet-0.1.5/3rd/lua-protobuf/test.lua
--rw-r--r--   0 root         (0) root         (0)       44 2021-09-29 08:06:39.000000 pyskynet-0.1.5/3rd/lua-protobuf/.git
--rw-r--r--   0 root         (0) root         (0)     1068 2021-09-29 08:11:53.000000 pyskynet-0.1.5/3rd/lua-protobuf/LICENSE
--rw-r--r--   0 root         (0) root         (0)     8682 2021-09-29 08:11:53.000000 pyskynet-0.1.5/3rd/lua-protobuf/serpent.lua
-drwxr-xr-x   0 root         (0) root         (0)        0 2021-12-07 11:17:39.000000 pyskynet-0.1.5/3rd/TinyGL/
--rw-r--r--   0 root         (0) root         (0)   247721 2021-09-29 08:06:28.000000 pyskynet-0.1.5/3rd/TinyGL/bitmap_image.hpp
-drwxr-xr-x   0 root         (0) root         (0)        0 2021-12-07 11:17:39.000000 pyskynet-0.1.5/3rd/TinyGL/tinygl/
--rw-r--r--   0 root         (0) root         (0)     1778 2021-11-10 06:33:56.000000 pyskynet-0.1.5/3rd/TinyGL/tinygl/Camera.h
--rw-r--r--   0 root         (0) root         (0)     4636 2021-11-10 06:33:56.000000 pyskynet-0.1.5/3rd/TinyGL/tinygl/Mesh.cpp
--rw-r--r--   0 root         (0) root         (0)      808 2021-09-29 08:06:28.000000 pyskynet-0.1.5/3rd/TinyGL/tinygl/Shader.h
--rw-r--r--   0 root         (0) root         (0)     6017 2021-11-10 06:33:56.000000 pyskynet-0.1.5/3rd/TinyGL/tinygl/point.h
--rw-r--r--   0 root         (0) root         (0)     8050 2021-09-29 08:06:28.000000 pyskynet-0.1.5/3rd/TinyGL/tinygl/Screen.cpp
--rw-r--r--   0 root         (0) root         (0)      812 2021-09-29 08:06:28.000000 pyskynet-0.1.5/3rd/TinyGL/tinygl/Transform.h
--rw-r--r--   0 root         (0) root         (0)     1563 2021-11-10 06:33:56.000000 pyskynet-0.1.5/3rd/TinyGL/tinygl/Screen.h
--rw-r--r--   0 root         (0) root         (0)     8479 2021-09-29 08:06:28.000000 pyskynet-0.1.5/3rd/TinyGL/tinygl/Camera.cpp
--rw-r--r--   0 root         (0) root         (0)     1476 2021-11-10 06:33:56.000000 pyskynet-0.1.5/3rd/TinyGL/tinygl/Mesh.h
--rw-r--r--   0 root         (0) root         (0)     1012 2021-09-29 08:06:28.000000 pyskynet-0.1.5/3rd/TinyGL/LICENCE
--rw-r--r--   0 root         (0) root         (0)     1778 2021-09-29 08:06:28.000000 pyskynet-0.1.5/3rd/TinyGL/example.cpp
--rw-r--r--   0 root         (0) root         (0)      157 2021-09-29 08:06:28.000000 pyskynet-0.1.5/3rd/TinyGL/Makefile
-drwxr-xr-x   0 root         (0) root         (0)        0 2021-12-07 11:17:39.000000 pyskynet-0.1.5/3rd/unqlite/
--rw-r--r--   0 root         (0) root         (0)      104 2021-09-29 08:11:53.000000 pyskynet-0.1.5/3rd/unqlite/.gitignore
--rw-r--r--   0 root         (0) root         (0)     4621 2021-09-29 08:11:53.000000 pyskynet-0.1.5/3rd/unqlite/update-md5.py
--rw-r--r--   0 root         (0) root         (0)    48708 2021-09-29 08:11:53.000000 pyskynet-0.1.5/3rd/unqlite/unqlite.h
--rw-r--r--   0 root         (0) root         (0)  1954992 2021-09-29 08:11:53.000000 pyskynet-0.1.5/3rd/unqlite/unqlite.c
--rw-r--r--   0 root         (0) root         (0)      522 2021-09-29 08:11:53.000000 pyskynet-0.1.5/3rd/unqlite/.travis.yml
--rw-r--r--   0 root         (0) root         (0)      964 2021-09-29 08:11:53.000000 pyskynet-0.1.5/3rd/unqlite/CMakeLists.txt
-drwxr-xr-x   0 root         (0) root         (0)        0 2021-12-07 11:17:39.000000 pyskynet-0.1.5/3rd/unqlite/.github/
--rw-r--r--   0 root         (0) root         (0)      720 2021-09-29 08:11:53.000000 pyskynet-0.1.5/3rd/unqlite/.github/FUNDING.yml
--rw-r--r--   0 root         (0) root         (0)     3235 2021-09-29 08:11:53.000000 pyskynet-0.1.5/3rd/unqlite/README.md
-drwxr-xr-x   0 root         (0) root         (0)        0 2021-12-07 11:17:39.000000 pyskynet-0.1.5/3rd/unqlite/src/
--rw-r--r--   0 root         (0) root         (0)     5384 2021-09-29 08:11:53.000000 pyskynet-0.1.5/3rd/unqlite/src/bitvec.c
--rw-r--r--   0 root         (0) root         (0)    29383 2021-09-29 08:11:53.000000 pyskynet-0.1.5/3rd/unqlite/src/unqlite_vm.c
--rw-r--r--   0 root         (0) root         (0)    36179 2021-09-29 08:11:53.000000 pyskynet-0.1.5/3rd/unqlite/src/jx9_const.c
--rw-r--r--   0 root         (0) root         (0)     3465 2021-09-29 08:11:53.000000 pyskynet-0.1.5/3rd/unqlite/src/os.c
--rw-r--r--   0 root         (0) root         (0)    78173 2021-09-29 08:11:53.000000 pyskynet-0.1.5/3rd/unqlite/src/jx9Int.h
--rw-r--r--   0 root         (0) root         (0)    48861 2021-09-29 08:11:53.000000 pyskynet-0.1.5/3rd/unqlite/src/unqlite.h
--rw-r--r--   0 root         (0) root         (0)    90721 2021-09-29 08:11:53.000000 pyskynet-0.1.5/3rd/unqlite/src/api.c
--rw-r--r--   0 root         (0) root         (0)   239237 2021-09-29 08:11:53.000000 pyskynet-0.1.5/3rd/unqlite/src/jx9_builtin.c
--rw-r--r--   0 root         (0) root         (0)    19056 2021-09-29 08:11:53.000000 pyskynet-0.1.5/3rd/unqlite/src/mem_kv.c
--rw-r--r--   0 root         (0) root         (0)    28083 2021-09-29 08:11:53.000000 pyskynet-0.1.5/3rd/unqlite/src/jx9.h
--rw-r--r--   0 root         (0) root         (0)    34926 2021-09-29 08:11:53.000000 pyskynet-0.1.5/3rd/unqlite/src/jx9_memobj.c
--rw-r--r--   0 root         (0) root         (0)   250161 2021-09-29 08:11:53.000000 pyskynet-0.1.5/3rd/unqlite/src/jx9_vfs.c
--rw-r--r--   0 root         (0) root         (0)    84873 2021-09-29 08:11:53.000000 pyskynet-0.1.5/3rd/unqlite/src/jx9_hashmap.c
--rw-r--r--   0 root         (0) root         (0)    54147 2021-09-29 08:11:53.000000 pyskynet-0.1.5/3rd/unqlite/src/jx9_api.c
--rw-r--r--   0 root         (0) root         (0)    29992 2021-09-29 08:11:53.000000 pyskynet-0.1.5/3rd/unqlite/src/unqlite_jx9.c
--rw-r--r--   0 root         (0) root         (0)    24591 2021-09-29 08:11:53.000000 pyskynet-0.1.5/3rd/unqlite/src/jx9_json.c
--rw-r--r--   0 root         (0) root         (0)    14227 2021-09-29 08:11:53.000000 pyskynet-0.1.5/3rd/unqlite/src/unqliteInt.h
--rw-r--r--   0 root         (0) root         (0)   133653 2021-09-29 08:11:53.000000 pyskynet-0.1.5/3rd/unqlite/src/jx9_lib.c
--rw-r--r--   0 root         (0) root         (0)   124352 2021-09-29 08:11:53.000000 pyskynet-0.1.5/3rd/unqlite/src/jx9_compile.c
--rw-r--r--   0 root         (0) root         (0)    42637 2021-09-29 08:11:53.000000 pyskynet-0.1.5/3rd/unqlite/src/jx9_parse.c
--rw-r--r--   0 root         (0) root         (0)    29005 2021-09-29 08:11:53.000000 pyskynet-0.1.5/3rd/unqlite/src/os_win.c
--rw-r--r--   0 root         (0) root         (0)    89463 2021-09-29 08:11:53.000000 pyskynet-0.1.5/3rd/unqlite/src/pager.c
--rw-r--r--   0 root         (0) root         (0)     2469 2021-09-29 08:11:53.000000 pyskynet-0.1.5/3rd/unqlite/src/jx9_license.txt
--rw-r--r--   0 root         (0) root         (0)     1412 2021-09-29 08:11:53.000000 pyskynet-0.1.5/3rd/unqlite/src/license.txt
--rw-r--r--   0 root         (0) root         (0)    25417 2021-09-29 08:11:53.000000 pyskynet-0.1.5/3rd/unqlite/src/jx9_lex.c
--rw-r--r--   0 root         (0) root         (0)    58896 2021-09-29 08:11:53.000000 pyskynet-0.1.5/3rd/unqlite/src/os_unix.c
--rw-r--r--   0 root         (0) root         (0)    10352 2021-09-29 08:11:53.000000 pyskynet-0.1.5/3rd/unqlite/src/fastjson.c
--rw-r--r--   0 root         (0) root         (0)    86569 2021-09-29 08:11:53.000000 pyskynet-0.1.5/3rd/unqlite/src/lhash_kv.c
--rw-r--r--   0 root         (0) root         (0)   213326 2021-09-29 08:11:53.000000 pyskynet-0.1.5/3rd/unqlite/src/jx9_vm.c
--rw-r--r--   0 root         (0) root         (0)      567 2021-09-29 08:11:53.000000 pyskynet-0.1.5/3rd/unqlite/CHANGELOG.md
--rw-r--r--   0 root         (0) root         (0)       39 2021-09-29 08:11:49.000000 pyskynet-0.1.5/3rd/unqlite/.git
--rw-r--r--   0 root         (0) root         (0)      317 2021-09-29 08:11:53.000000 pyskynet-0.1.5/3rd/unqlite/.gitlab-ci.yml
--rw-r--r--   0 root         (0) root         (0)     1441 2021-09-29 08:11:53.000000 pyskynet-0.1.5/3rd/unqlite/LICENSE
-drwxr-xr-x   0 root         (0) root         (0)        0 2021-12-07 11:17:39.000000 pyskynet-0.1.5/3rd/unqlite/example/
--rw-r--r--   0 root         (0) root         (0)    21105 2021-09-29 08:11:53.000000 pyskynet-0.1.5/3rd/unqlite/example/5.c
--rw-r--r--   0 root         (0) root         (0)     9404 2021-09-29 08:11:53.000000 pyskynet-0.1.5/3rd/unqlite/example/2.c
-drwxr-xr-x   0 root         (0) root         (0)        0 2021-12-07 11:17:39.000000 pyskynet-0.1.5/3rd/unqlite/example/demovfs/
--rw-r--r--   0 root         (0) root         (0)    21679 2021-09-29 08:11:53.000000 pyskynet-0.1.5/3rd/unqlite/example/demovfs/unqlite_demovfs.c
--rw-r--r--   0 root         (0) root         (0)    10146 2021-09-29 08:11:53.000000 pyskynet-0.1.5/3rd/unqlite/example/unqlite_mp3.c
--rw-r--r--   0 root         (0) root         (0)     7679 2021-09-29 08:11:53.000000 pyskynet-0.1.5/3rd/unqlite/example/unqlite_huge.c
--rw-r--r--   0 root         (0) root         (0)     8406 2021-09-29 08:11:53.000000 pyskynet-0.1.5/3rd/unqlite/example/4.c
--rw-r--r--   0 root         (0) root         (0)     7217 2021-09-29 08:11:53.000000 pyskynet-0.1.5/3rd/unqlite/example/3.c
--rw-r--r--   0 root         (0) root         (0)     7175 2021-09-29 08:11:53.000000 pyskynet-0.1.5/3rd/unqlite/example/1.c
--rw-r--r--   0 root         (0) root         (0)     7656 2021-09-29 08:11:53.000000 pyskynet-0.1.5/3rd/unqlite/example/unqlite_tar.c
--rw-r--r--   0 root         (0) root         (0)    10810 2021-09-29 08:11:53.000000 pyskynet-0.1.5/3rd/unqlite/example/6.c
-drwxr-xr-x   0 root         (0) root         (0)        0 2021-12-07 11:17:38.000000 pyskynet-0.1.5/3rd/numsky/
-drwxr-xr-x   0 root         (0) root         (0)        0 2021-12-07 11:17:39.000000 pyskynet-0.1.5/3rd/numsky/src/
--rw-r--r--   0 root         (0) root         (0)    12683 2021-11-10 06:33:56.000000 pyskynet-0.1.5/3rd/numsky/src/lua-foreign_seri.c
--rw-r--r--   0 root         (0) root         (0)    13782 2021-11-10 06:33:56.000000 pyskynet-0.1.5/3rd/numsky/src/lua-cluster.c
--rw-r--r--   0 root         (0) root         (0)    12866 2021-11-10 06:33:56.000000 pyskynet-0.1.5/3rd/numsky/src/lua-serialize.c
--rw-r--r--   0 root         (0) root         (0)     9827 2021-11-10 06:33:56.000000 pyskynet-0.1.5/3rd/numsky/src/lua-binding.h
-drwxr-xr-x   0 root         (0) root         (0)        0 2021-12-07 11:17:39.000000 pyskynet-0.1.5/3rd/numsky/src/numsky/
-drwxr-xr-x   0 root         (0) root         (0)        0 2021-12-07 11:17:39.000000 pyskynet-0.1.5/3rd/numsky/src/numsky/canvas/
--rw-r--r--   0 root         (0) root         (0)      325 2021-09-29 08:06:28.000000 pyskynet-0.1.5/3rd/numsky/src/numsky/canvas/ExpandControl.h
--rw-r--r--   0 root         (0) root         (0)    11948 2021-09-29 08:06:28.000000 pyskynet-0.1.5/3rd/numsky/src/numsky/canvas/ValNode.cpp
--rw-r--r--   0 root         (0) root         (0)     5715 2021-11-10 06:33:56.000000 pyskynet-0.1.5/3rd/numsky/src/numsky/canvas/AstNode.cpp
--rw-r--r--   0 root         (0) root         (0)    10167 2021-11-10 06:33:56.000000 pyskynet-0.1.5/3rd/numsky/src/numsky/canvas/CameraAstNode.cpp
--rw-r--r--   0 root         (0) root         (0)     1119 2021-11-10 06:33:56.000000 pyskynet-0.1.5/3rd/numsky/src/numsky/canvas/DefinedException.h
--rw-r--r--   0 root         (0) root         (0)      955 2021-11-10 06:33:56.000000 pyskynet-0.1.5/3rd/numsky/src/numsky/canvas/DefinedException.cpp
--rw-r--r--   0 root         (0) root         (0)     5371 2021-09-29 08:06:28.000000 pyskynet-0.1.5/3rd/numsky/src/numsky/canvas/ValNode.h
--rw-r--r--   0 root         (0) root         (0)     7627 2021-11-10 06:33:56.000000 pyskynet-0.1.5/3rd/numsky/src/numsky/canvas/EvalContext.h
--rw-r--r--   0 root         (0) root         (0)     2618 2021-11-10 06:33:56.000000 pyskynet-0.1.5/3rd/numsky/src/numsky/canvas/ArrayAstNode.h
--rw-r--r--   0 root         (0) root         (0)     2682 2021-11-10 06:33:56.000000 pyskynet-0.1.5/3rd/numsky/src/numsky/canvas/AstNode.h
--rw-r--r--   0 root         (0) root         (0)     1498 2021-11-10 06:33:56.000000 pyskynet-0.1.5/3rd/numsky/src/numsky/canvas/ParseContext.cpp
--rw-r--r--   0 root         (0) root         (0)     5767 2021-11-10 06:33:56.000000 pyskynet-0.1.5/3rd/numsky/src/numsky/canvas/ArrayAstNode.cpp
--rw-r--r--   0 root         (0) root         (0)     2125 2021-09-29 08:06:28.000000 pyskynet-0.1.5/3rd/numsky/src/numsky/canvas/TypeGuard.h
--rw-r--r--   0 root         (0) root         (0)    21296 2021-11-10 06:33:56.000000 pyskynet-0.1.5/3rd/numsky/src/numsky/canvas/IAstNode.cpp
--rw-r--r--   0 root         (0) root         (0)     5070 2021-11-10 06:33:56.000000 pyskynet-0.1.5/3rd/numsky/src/numsky/canvas/CameraAstNode.h
--rw-r--r--   0 root         (0) root         (0)     3084 2021-11-10 06:33:56.000000 pyskynet-0.1.5/3rd/numsky/src/numsky/canvas/lua-numsky_canvas.cpp
--rw-r--r--   0 root         (0) root         (0)     2307 2021-11-10 06:33:56.000000 pyskynet-0.1.5/3rd/numsky/src/numsky/canvas/LuaAstNode.h
--rw-r--r--   0 root         (0) root         (0)    10369 2021-11-10 06:33:56.000000 pyskynet-0.1.5/3rd/numsky/src/numsky/canvas/ParseContext.h
--rw-r--r--   0 root         (0) root         (0)     3028 2021-11-10 06:33:56.000000 pyskynet-0.1.5/3rd/numsky/src/numsky/canvas/LuaAstNode.cpp
--rw-r--r--   0 root         (0) root         (0)     6229 2021-11-10 06:33:56.000000 pyskynet-0.1.5/3rd/numsky/src/numsky/canvas/IAstNode.h
-drwxr-xr-x   0 root         (0) root         (0)        0 2021-12-07 11:17:39.000000 pyskynet-0.1.5/3rd/numsky/src/numsky/ndarray/
--rw-r--r--   0 root         (0) root         (0)     1895 2021-11-10 06:33:56.000000 pyskynet-0.1.5/3rd/numsky/src/numsky/ndarray/ndarray_tostring.cpp
--rw-r--r--   0 root         (0) root         (0)     4282 2021-11-10 06:33:56.000000 pyskynet-0.1.5/3rd/numsky/src/numsky/ndarray/lua-numsky_ndarray.cpp
--rw-r--r--   0 root         (0) root         (0)    17669 2021-11-10 06:33:56.000000 pyskynet-0.1.5/3rd/numsky/src/numsky/ndarray/ndarray_indexing.cpp
--rw-r--r--   0 root         (0) root         (0)    11339 2021-11-10 06:33:56.000000 pyskynet-0.1.5/3rd/numsky/src/numsky/ndarray/ndarray_ctor.cpp
--rw-r--r--   0 root         (0) root         (0)    10055 2021-11-10 06:33:56.000000 pyskynet-0.1.5/3rd/numsky/src/numsky/ndarray/lua-numsky_ndarray.h
--rw-r--r--   0 root         (0) root         (0)     4282 2021-11-10 06:33:56.000000 pyskynet-0.1.5/3rd/numsky/src/numsky/ndarray/ndarray_methods.cpp
-drwxr-xr-x   0 root         (0) root         (0)        0 2021-12-07 11:17:39.000000 pyskynet-0.1.5/3rd/numsky/src/numsky/ufunc/
--rw-r--r--   0 root         (0) root         (0)     4871 2021-11-10 06:33:56.000000 pyskynet-0.1.5/3rd/numsky/src/numsky/ufunc/ufunc_reduce.cpp
--rw-r--r--   0 root         (0) root         (0)    15782 2021-11-10 06:33:56.000000 pyskynet-0.1.5/3rd/numsky/src/numsky/ufunc/ufunc_21.cpp
--rw-r--r--   0 root         (0) root         (0)     3172 2021-11-10 06:33:56.000000 pyskynet-0.1.5/3rd/numsky/src/numsky/ufunc/lua-numsky_ufunc.cpp
--rw-r--r--   0 root         (0) root         (0)     2677 2021-09-29 08:06:28.000000 pyskynet-0.1.5/3rd/numsky/src/numsky/ufunc/lua-numsky_ufunc.h
--rw-r--r--   0 root         (0) root         (0)     8065 2021-11-10 06:33:56.000000 pyskynet-0.1.5/3rd/numsky/src/numsky/ufunc/ufunc_oper.cpp
--rw-r--r--   0 root         (0) root         (0)     6979 2021-11-10 06:33:56.000000 pyskynet-0.1.5/3rd/numsky/src/numsky/ufunc/ufunc_11.cpp
--rw-r--r--   0 root         (0) root         (0)     1301 2021-09-29 08:06:28.000000 pyskynet-0.1.5/3rd/numsky/src/numsky/lua-numsky_tuple.cpp
--rw-r--r--   0 root         (0) root         (0)     3200 2021-09-29 08:06:28.000000 pyskynet-0.1.5/3rd/numsky/src/numsky/lua-numsky_slice.cpp
--rw-r--r--   0 root         (0) root         (0)     1326 2021-11-10 06:33:56.000000 pyskynet-0.1.5/3rd/numsky/src/numsky/lua-numsky_name.cpp
--rw-r--r--   0 root         (0) root         (0)     6897 2021-11-10 06:33:56.000000 pyskynet-0.1.5/3rd/numsky/src/numsky/lua-numsky.h
--rw-r--r--   0 root         (0) root         (0)     1515 2021-11-10 06:33:56.000000 pyskynet-0.1.5/3rd/numsky/src/numsky/lua-numsky_export.cpp
-drwxr-xr-x   0 root         (0) root         (0)        0 2021-12-07 11:17:39.000000 pyskynet-0.1.5/3rd/numsky/src/numsky/tinygl/
--rw-r--r--   0 root         (0) root         (0)     4508 2021-11-10 06:33:56.000000 pyskynet-0.1.5/3rd/numsky/src/numsky/tinygl/tinygl_mesh.cpp
--rw-r--r--   0 root         (0) root         (0)     3079 2021-11-10 06:33:56.000000 pyskynet-0.1.5/3rd/numsky/src/numsky/tinygl/lua-numsky_tinygl.h
--rw-r--r--   0 root         (0) root         (0)     5781 2021-11-10 06:33:56.000000 pyskynet-0.1.5/3rd/numsky/src/numsky/tinygl/lua-numsky_tinygl.cpp
--rw-r--r--   0 root         (0) root         (0)     4060 2021-11-10 06:33:56.000000 pyskynet-0.1.5/3rd/numsky/src/numsky/lua-numsky.cpp
--rw-r--r--   0 root         (0) root         (0)     2214 2021-11-10 06:33:56.000000 pyskynet-0.1.5/3rd/numsky/src/numsky/lua-numsky_dtype.cpp
--rw-r--r--   0 root         (0) root         (0)     1143 2021-11-10 06:33:56.000000 pyskynet-0.1.5/3rd/numsky/src/numsky/lua-numsky_nditer.cpp
-drwxr-xr-x   0 root         (0) root         (0)        0 2021-12-07 11:17:39.000000 pyskynet-0.1.5/3rd/numsky/src/skynet_foreign/
--rw-r--r--   0 root         (0) root         (0)     2013 2021-09-29 08:06:28.000000 pyskynet-0.1.5/3rd/numsky/src/skynet_foreign/skynet_foreign.h
--rw-r--r--   0 root         (0) root         (0)     4517 2021-11-10 06:33:56.000000 pyskynet-0.1.5/3rd/numsky/src/skynet_foreign/numsky.h
--rw-r--r--   0 root         (0) root         (0)      775 2021-11-10 06:33:56.000000 pyskynet-0.1.5/3rd/numsky/src/skynet_foreign/hook_skynet_py.h
--rw-r--r--   0 root         (0) root         (0)      418 2021-09-29 08:06:28.000000 pyskynet-0.1.5/3rd/numsky/src/skynet_foreign/numsky_nditer.c
--rw-r--r--   0 root         (0) root         (0)     4235 2021-09-29 08:06:28.000000 pyskynet-0.1.5/3rd/numsky/src/skynet_foreign/numsky_dtype.c
--rw-r--r--   0 root         (0) root         (0)      700 2021-09-29 08:06:28.000000 pyskynet-0.1.5/3rd/numsky/src/skynet_foreign/numsky.c
--rw-r--r--   0 root         (0) root         (0)     1102 2021-09-29 08:06:28.000000 pyskynet-0.1.5/3rd/numsky/src/skynet_foreign/skynet_foreign.c
-drwxr-xr-x   0 root         (0) root         (0)        0 2021-12-07 11:17:39.000000 pyskynet-0.1.5/3rd/numsky/src/foreign_seri/
--rw-r--r--   0 root         (0) root         (0)      410 2021-09-29 08:06:28.000000 pyskynet-0.1.5/3rd/numsky/src/foreign_seri/ReadBlock.h
--rw-r--r--   0 root         (0) root         (0)     4080 2021-09-29 08:06:28.000000 pyskynet-0.1.5/3rd/numsky/src/foreign_seri/LuaWriteBlock.cpp
--rw-r--r--   0 root         (0) root         (0)      791 2021-09-29 08:06:28.000000 pyskynet-0.1.5/3rd/numsky/src/foreign_seri/SeriMode.h
--rw-r--r--   0 root         (0) root         (0)      679 2021-09-29 08:06:28.000000 pyskynet-0.1.5/3rd/numsky/src/foreign_seri/LuaWriteBlock.h
--rw-r--r--   0 root         (0) root         (0)      489 2021-09-29 08:06:28.000000 pyskynet-0.1.5/3rd/numsky/src/foreign_seri/lua-seri_v2.cpp
--rw-r--r--   0 root         (0) root         (0)     2885 2021-09-29 08:06:28.000000 pyskynet-0.1.5/3rd/numsky/src/foreign_seri/WriteBlock.h
-drwxr-xr-x   0 root         (0) root         (0)        0 2021-12-07 11:17:39.000000 pyskynet-0.1.5/3rd/lua-rapidjson/
--rw-r--r--   0 root         (0) root         (0)       10 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/.busted
--rw-r--r--   0 root         (0) root         (0)      525 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/.gitignore
--rw-r--r--   0 root         (0) root         (0)      689 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/appveyor.yml
-drwxr-xr-x   0 root         (0) root         (0)        0 2021-12-07 11:17:39.000000 pyskynet-0.1.5/3rd/lua-rapidjson/performance/
--rw-r--r--   0 root         (0) root         (0)    33764 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/performance/paragraphs.json
--rw-r--r--   0 root         (0) root         (0)     1713 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/performance/run.lua
--rw-r--r--   0 root         (0) root         (0)      802 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/performance/nulls.json
--rw-r--r--   0 root         (0) root         (0)     1698 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/performance/floats.json
--rw-r--r--   0 root         (0) root         (0)     4202 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/performance/guids.json
--rw-r--r--   0 root         (0) root         (0)      849 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/performance/booleans.json
--rw-r--r--   0 root         (0) root         (0)     1098 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/performance/integers.json
--rw-r--r--   0 root         (0) root         (0)    15142 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/performance/mixed.json
--rw-r--r--   0 root         (0) root         (0)      717 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson-0.7.1-1.rockspec
-drwxr-xr-x   0 root         (0) root         (0)        0 2021-12-07 11:17:39.000000 pyskynet-0.1.5/3rd/lua-rapidjson/spec/
--rw-r--r--   0 root         (0) root         (0)     4175 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/spec/Schema_spec.lua
--rw-r--r--   0 root         (0) root         (0)     5095 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/spec/json_dump_spec.lua
--rw-r--r--   0 root         (0) root         (0)        3 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/spec/empty-object.json
--rw-r--r--   0 root         (0) root         (0)     5574 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/spec/Document_spec.lua
--rw-r--r--   0 root         (0) root         (0)        3 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/spec/empty-array.json
--rw-r--r--   0 root         (0) root         (0)     1132 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/spec/json_null_spec.lua
--rw-r--r--   0 root         (0) root         (0)     6405 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/spec/json_decode_spec.lua
--rw-r--r--   0 root         (0) root         (0)     9513 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/spec/json_load_spec.lua
--rw-r--r--   0 root         (0) root         (0)      913 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/spec/json_array_spec.lua
--rw-r--r--   0 root         (0) root         (0)     5612 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/spec/json_encode_spec.lua
--rw-r--r--   0 root         (0) root         (0)      914 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/spec/json_object_spec.lua
--rw-r--r--   0 root         (0) root         (0)        0 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/spec/empty-file.json
--rw-r--r--   0 root         (0) root         (0)      124 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/.editorconfig
--rw-r--r--   0 root         (0) root         (0)     1037 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/.travis.yml
--rw-r--r--   0 root         (0) root         (0)     2927 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/CMakeLists.txt
-drwxr-xr-x   0 root         (0) root         (0)        0 2021-12-07 11:17:38.000000 pyskynet-0.1.5/3rd/lua-rapidjson/.github/
-drwxr-xr-x   0 root         (0) root         (0)        0 2021-12-07 11:17:39.000000 pyskynet-0.1.5/3rd/lua-rapidjson/.github/workflows/
--rw-r--r--   0 root         (0) root         (0)      624 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/.github/workflows/main.yml
--rw-r--r--   0 root         (0) root         (0)     8267 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/API.md
--rw-r--r--   0 root         (0) root         (0)     5295 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/README.md
-drwxr-xr-x   0 root         (0) root         (0)        0 2021-12-07 11:17:39.000000 pyskynet-0.1.5/3rd/lua-rapidjson/src/
--rw-r--r--   0 root         (0) root         (0)     1988 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/src/Userdata.hpp
--rw-r--r--   0 root         (0) root         (0)     1439 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/src/StringStream.hpp
--rw-r--r--   0 root         (0) root         (0)      305 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/src/file.hpp
--rw-r--r--   0 root         (0) root         (0)     3863 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/src/Document.cpp
--rw-r--r--   0 root         (0) root         (0)     9848 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/src/rapidjson.cpp
--rw-r--r--   0 root         (0) root         (0)     3052 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/src/values.cpp
--rw-r--r--   0 root         (0) root         (0)     2558 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/src/Schema.cpp
--rw-r--r--   0 root         (0) root         (0)     6617 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/src/values.hpp
--rw-r--r--   0 root         (0) root         (0)     2202 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/src/luax.hpp
--rw-r--r--   0 root         (0) root         (0)       45 2021-09-29 08:09:29.000000 pyskynet-0.1.5/3rd/lua-rapidjson/.git
-drwxr-xr-x   0 root         (0) root         (0)        0 2021-12-07 11:17:38.000000 pyskynet-0.1.5/3rd/lua-rapidjson/cmake/
-drwxr-xr-x   0 root         (0) root         (0)        0 2021-12-07 11:17:39.000000 pyskynet-0.1.5/3rd/lua-rapidjson/cmake/Modules/
--rw-r--r--   0 root         (0) root         (0)     5053 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/cmake/Modules/FindLua.cmake
--rw-r--r--   0 root         (0) root         (0)     1052 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/LICENSE
--rw-r--r--   0 root         (0) root         (0)      115 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/.luacheckrc
-drwxr-xr-x   0 root         (0) root         (0)        0 2021-12-07 11:17:39.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/
--rw-r--r--   0 root         (0) root         (0)      383 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/.gitignore
-drwxr-xr-x   0 root         (0) root         (0)        0 2021-12-07 11:17:38.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/bin/
-drwxr-xr-x   0 root         (0) root         (0)        0 2021-12-07 11:17:39.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/bin/encodings/
--rw-r--r--   0 root         (0) root         (0)      740 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/bin/encodings/utf32lebom.json
--rw-r--r--   0 root         (0) root         (0)      368 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/bin/encodings/utf16le.json
--rw-r--r--   0 root         (0) root         (0)      740 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/bin/encodings/utf32bebom.json
--rw-r--r--   0 root         (0) root         (0)      325 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/bin/encodings/utf8bom.json
--rw-r--r--   0 root         (0) root         (0)      368 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/bin/encodings/utf16be.json
--rw-r--r--   0 root         (0) root         (0)      322 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/bin/encodings/utf8.json
--rw-r--r--   0 root         (0) root         (0)      370 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/bin/encodings/utf16lebom.json
--rw-r--r--   0 root         (0) root         (0)      736 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/bin/encodings/utf32le.json
--rw-r--r--   0 root         (0) root         (0)      370 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/bin/encodings/utf16bebom.json
--rw-r--r--   0 root         (0) root         (0)      736 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/bin/encodings/utf32be.json
-drwxr-xr-x   0 root         (0) root         (0)        0 2021-12-07 11:17:39.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/
--rw-r--r--   0 root         (0) root         (0)       33 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/fail22.json
--rw-r--r--   0 root         (0) root         (0)       20 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/fail23.json
--rw-r--r--   0 root         (0) root         (0)       34 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/fail15.json
--rw-r--r--   0 root         (0) root         (0)       34 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/fail17.json
--rw-r--r--   0 root         (0) root         (0)       24 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/fail5.json
--rw-r--r--   0 root         (0) root         (0)       29 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/fail11.json
--rw-r--r--   0 root         (0) root         (0)       38 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/fail26.json
--rw-r--r--   0 root         (0) root         (0)       17 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/fail2.json
--rw-r--r--   0 root         (0) root         (0)       12 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/fail33.json
--rw-r--r--   0 root         (0) root         (0)       58 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/fail10.json
--rw-r--r--   0 root         (0) root         (0)       32 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/fail21.json
--rw-r--r--   0 root         (0) root         (0)       16 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/fail24.json
--rw-r--r--   0 root         (0) root         (0)       23 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/fail20.json
--rw-r--r--   0 root         (0) root         (0)       50 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/fail18.json
--rw-r--r--   0 root         (0) root         (0)        5 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/fail30.json
--rw-r--r--   0 root         (0) root         (0)       16 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/fail8.json
--rw-r--r--   0 root         (0) root         (0)        8 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/fail16.json
--rw-r--r--   0 root         (0) root         (0)       31 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/fail14.json
--rw-r--r--   0 root         (0) root         (0)       26 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/fail7.json
--rw-r--r--   0 root         (0) root         (0)       31 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/fail12.json
--rw-r--r--   0 root         (0) root         (0)       16 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/fail4.json
--rw-r--r--   0 root         (0) root         (0)       29 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/fail25.json
--rw-r--r--   0 root         (0) root         (0)      173 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/readme.txt
--rw-r--r--   0 root         (0) root         (0)       15 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/fail28.json
--rw-r--r--   0 root         (0) root         (0)        7 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/fail31.json
--rw-r--r--   0 root         (0) root         (0)       37 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/fail3.json
--rw-r--r--   0 root         (0) root         (0)       40 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/fail32.json
--rw-r--r--   0 root         (0) root         (0)       60 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/fail1.json
--rw-r--r--   0 root         (0) root         (0)       52 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/pass2.json
--rw-r--r--   0 root         (0) root         (0)     1441 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/pass1.json
--rw-r--r--   0 root         (0) root         (0)      148 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/pass3.json
--rw-r--r--   0 root         (0) root         (0)       43 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/fail13.json
--rw-r--r--   0 root         (0) root         (0)       26 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/fail6.json
--rw-r--r--   0 root         (0) root         (0)        4 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/fail29.json
--rw-r--r--   0 root         (0) root         (0)       14 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/fail27.json
--rw-r--r--   0 root         (0) root         (0)       22 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/fail19.json
--rw-r--r--   0 root         (0) root         (0)       22 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/fail9.json
-drwxr-xr-x   0 root         (0) root         (0)        0 2021-12-07 11:17:39.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/bin/types/
--rwxr-xr-x   0 root         (0) root         (0)    33764 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/bin/types/paragraphs.json
--rwxr-xr-x   0 root         (0) root         (0)      802 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/bin/types/nulls.json
--rwxr-xr-x   0 root         (0) root         (0)     1698 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/bin/types/floats.json
--rwxr-xr-x   0 root         (0) root         (0)     4202 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/bin/types/guids.json
--rwxr-xr-x   0 root         (0) root         (0)      849 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/bin/types/booleans.json
--rwxr-xr-x   0 root         (0) root         (0)     1098 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/bin/types/integers.json
--rw-r--r--   0 root         (0) root         (0)       86 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/bin/types/readme.txt
--rwxr-xr-x   0 root         (0) root         (0)    15142 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/bin/types/mixed.json
-drwxr-xr-x   0 root         (0) root         (0)        0 2021-12-07 11:17:38.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/
-drwxr-xr-x   0 root         (0) root         (0)        0 2021-12-07 11:17:39.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/
--rw-r--r--   0 root         (0) root         (0)     3001 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/filereadstream.h
--rw-r--r--   0 root         (0) root         (0)     3146 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/filewritestream.h
--rw-r--r--   0 root         (0) root         (0)    10675 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/allocators.h
--rw-r--r--   0 root         (0) root         (0)     4082 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/istreamwrapper.h
--rw-r--r--   0 root         (0) root         (0)   103633 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/schema.h
--rw-r--r--   0 root         (0) root         (0)     4034 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/fwd.h
-drwxr-xr-x   0 root         (0) root         (0)        0 2021-12-07 11:17:39.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/internal/
--rw-r--r--   0 root         (0) root         (0)     2994 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/internal/ieee754.h
--rw-r--r--   0 root         (0) root         (0)     9143 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/internal/biginteger.h
--rw-r--r--   0 root         (0) root         (0)     1419 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/internal/swap.h
--rw-r--r--   0 root         (0) root         (0)     8994 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/internal/strtod.h
--rw-r--r--   0 root         (0) root         (0)    11509 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/internal/diyfp.h
--rw-r--r--   0 root         (0) root         (0)     6641 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/internal/meta.h
--rw-r--r--   0 root         (0) root         (0)     2199 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/internal/strfunc.h
--rw-r--r--   0 root         (0) root         (0)     3595 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/internal/pow10.h
--rw-r--r--   0 root         (0) root         (0)    26141 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/internal/regex.h
--rw-r--r--   0 root         (0) root         (0)     7184 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/internal/stack.h
--rw-r--r--   0 root         (0) root         (0)     2018 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/internal/clzll.h
--rw-r--r--   0 root         (0) root         (0)    10131 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/internal/itoa.h
--rw-r--r--   0 root         (0) root         (0)     8125 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/internal/dtoa.h
--rw-r--r--   0 root         (0) root         (0)     2331 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/ostreamwrapper.h
-drwxr-xr-x   0 root         (0) root         (0)        0 2021-12-07 11:17:39.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/msinttypes/
--rw-r--r--   0 root         (0) root         (0)     9386 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/msinttypes/stdint.h
--rw-r--r--   0 root         (0) root         (0)     8372 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/msinttypes/inttypes.h
--rw-r--r--   0 root         (0) root         (0)    60889 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/pointer.h
-drwxr-xr-x   0 root         (0) root         (0)        0 2021-12-07 11:17:39.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/error/
--rw-r--r--   0 root         (0) root         (0)     3870 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/error/en.h
--rw-r--r--   0 root         (0) root         (0)     6213 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/error/error.h
--rw-r--r--   0 root         (0) root         (0)     3993 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/stringbuffer.h
--rw-r--r--   0 root         (0) root         (0)   121069 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/document.h
--rw-r--r--   0 root         (0) root         (0)     2667 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/memorystream.h
--rw-r--r--   0 root         (0) root         (0)    26877 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/writer.h
--rw-r--r--   0 root         (0) root         (0)    29281 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/encodings.h
--rw-r--r--   0 root         (0) root         (0)    10681 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/encodedstream.h
--rw-r--r--   0 root         (0) root         (0)    93391 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/reader.h
--rw-r--r--   0 root         (0) root         (0)     2560 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/memorybuffer.h
--rw-r--r--   0 root         (0) root         (0)     2281 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/cursorstreamwrapper.h
--rw-r--r--   0 root         (0) root         (0)    23663 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/rapidjson.h
--rw-r--r--   0 root         (0) root         (0)    10539 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/prettywriter.h
--rw-r--r--   0 root         (0) root         (0)     6753 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/stream.h
--rw-r--r--   0 root         (0) root         (0)     8815 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/readme.zh-cn.md
--rw-r--r--   0 root         (0) root         (0)     5152 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/license.txt
--rw-r--r--   0 root         (0) root         (0)    11187 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/readme.md
--rw-r--r--   0 root         (0) root         (0)     6818 2021-11-10 06:37:12.000000 pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/CHANGELOG.md
-drwxr-xr-x   0 root         (0) root         (0)        0 2021-12-07 11:17:40.000000 pyskynet-0.1.5/test/
--rw-r--r--   0 root         (0) root         (0)     1209 2021-09-29 08:06:28.000000 pyskynet-0.1.5/test/test_luacluster.py
--rw-r--r--   0 root         (0) root         (0)     2378 2021-09-29 08:06:28.000000 pyskynet-0.1.5/test/test_tinygl.py
--rw-r--r--   0 root         (0) root         (0)     2818 2021-09-29 08:06:28.000000 pyskynet-0.1.5/test/test_seri.py
--rw-r--r--   0 root         (0) root         (0)      557 2021-09-29 08:06:28.000000 pyskynet-0.1.5/test/test_foreign.py
--rw-r--r--   0 root         (0) root         (0)      517 2021-09-29 08:06:28.000000 pyskynet-0.1.5/test/test_cluster.py
--rw-r--r--   0 root         (0) root         (0)      474 2021-09-29 08:06:28.000000 pyskynet-0.1.5/test/test_env.py
--rw-r--r--   0 root         (0) root         (0)     5646 2021-11-10 06:33:56.000000 pyskynet-0.1.5/setup_ext.py
--rw-r--r--   0 root         (0) root         (0)     1539 2021-09-29 08:06:28.000000 pyskynet-0.1.5/README.md
-drwxr-xr-x   0 root         (0) root         (0)        0 2021-12-07 11:17:39.000000 pyskynet-0.1.5/pyskynet/
--rw-r--r--   0 root         (0) root         (0)     5863 2021-12-07 11:17:06.000000 pyskynet-0.1.5/pyskynet/proto.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2021-12-07 11:17:39.000000 pyskynet-0.1.5/pyskynet/lualib/
--rw-r--r--   0 root         (0) root         (0)     2619 2021-11-10 06:33:56.000000 pyskynet-0.1.5/pyskynet/lualib/pyskynet.lua
--rw-r--r--   0 root         (0) root         (0)    34696 2021-09-29 08:06:28.000000 pyskynet-0.1.5/pyskynet/lualib/protoc.lua
-drwxr-xr-x   0 root         (0) root         (0)        0 2021-12-07 11:17:39.000000 pyskynet-0.1.5/pyskynet/lualib/pyskynet/
--rw-r--r--   0 root         (0) root         (0)     2423 2021-09-29 08:06:28.000000 pyskynet-0.1.5/pyskynet/lualib/pyskynet/cluster.lua
--rw-r--r--   0 root         (0) root         (0)     2379 2021-09-29 08:06:28.000000 pyskynet-0.1.5/pyskynet/lualib/pyskynet/utils.lua
--rw-r--r--   0 root         (0) root         (0)     1907 2021-09-29 08:06:28.000000 pyskynet-0.1.5/pyskynet/lualib/pyskynet/foreign.lua
--rw-r--r--   0 root         (0) root         (0)     4262 2021-12-07 11:17:06.000000 pyskynet-0.1.5/pyskynet/__init__.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2021-12-07 11:17:39.000000 pyskynet-0.1.5/pyskynet/service/
--rw-r--r--   0 root         (0) root         (0)     2534 2021-09-29 08:06:28.000000 pyskynet-0.1.5/pyskynet/service/skynet_py_logger.lua
--rw-r--r--   0 root         (0) root         (0)      454 2021-11-10 06:33:56.000000 pyskynet-0.1.5/pyskynet/service/canvas_service.lua
--rw-r--r--   0 root         (0) root         (0)     5753 2021-09-29 08:06:28.000000 pyskynet-0.1.5/pyskynet/service/foreign_clusterd.lua
--rw-r--r--   0 root         (0) root         (0)     3531 2021-09-29 08:06:28.000000 pyskynet-0.1.5/pyskynet/service/foreign_clusteragent.lua
--rw-r--r--   0 root         (0) root         (0)     3395 2021-09-29 08:06:28.000000 pyskynet-0.1.5/pyskynet/service/skynet_py_boot.lua
--rw-r--r--   0 root         (0) root         (0)      424 2021-09-29 08:06:28.000000 pyskynet-0.1.5/pyskynet/service/script_service.lua
--rw-r--r--   0 root         (0) root         (0)     2040 2021-09-29 08:06:28.000000 pyskynet-0.1.5/pyskynet/cluster.py
--rw-r--r--   0 root         (0) root         (0)     5174 2021-12-07 11:17:06.000000 pyskynet-0.1.5/pyskynet/boot.py
--rw-r--r--   0 root         (0) root         (0)     2727 2021-11-10 06:33:56.000000 pyskynet-0.1.5/pyskynet/foreign.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2021-12-07 11:17:38.000000 pyskynet-0.1.5/src/
-drwxr-xr-x   0 root         (0) root         (0)        0 2021-12-07 11:17:40.000000 pyskynet-0.1.5/src/skynet_modify/
--rw-r--r--   0 root         (0) root         (0)     7468 2021-09-29 08:06:28.000000 pyskynet-0.1.5/src/skynet_modify/skynet_start_modify.c
--rw-r--r--   0 root         (0) root         (0)     1791 2021-09-29 08:06:28.000000 pyskynet-0.1.5/src/skynet_modify/skynet_py.h
--rw-r--r--   0 root         (0) root         (0)     3382 2021-09-29 08:06:28.000000 pyskynet-0.1.5/src/skynet_modify/skynet_py.c
--rw-r--r--   0 root         (0) root         (0)     3242 2021-09-29 08:06:28.000000 pyskynet-0.1.5/src/skynet_modify/skynet_env_modify.c
-drwxr-xr-x   0 root         (0) root         (0)        0 2021-12-07 11:17:40.000000 pyskynet-0.1.5/src/cy_src/
--rw-r--r--   0 root         (0) root         (0)     1788 2021-09-29 08:06:28.000000 pyskynet-0.1.5/src/cy_src/skynet_py.pxd
--rw-r--r--   0 root         (0) root         (0)     3151 2021-09-29 08:06:28.000000 pyskynet-0.1.5/src/cy_src/skynet_py_main.pyx
--rw-r--r--   0 root         (0) root         (0)   206737 2021-11-10 06:37:53.000000 pyskynet-0.1.5/src/cy_src/skynet_py_main.c
--rw-r--r--   0 root         (0) root         (0)   318563 2021-12-07 11:17:37.000000 pyskynet-0.1.5/src/cy_src/skynet_py_mq.c
--rw-r--r--   0 root         (0) root         (0)     5148 2021-12-07 11:17:06.000000 pyskynet-0.1.5/src/cy_src/skynet_py_mq.pyx
--rw-r--r--   0 root         (0) root         (0)   453380 2021-11-10 06:37:53.000000 pyskynet-0.1.5/src/cy_src/skynet_py_foreign_seri.c
--rw-r--r--   0 root         (0) root         (0)    14930 2021-09-29 08:06:28.000000 pyskynet-0.1.5/src/cy_src/skynet_py_foreign_seri.pyx
-drwxr-xr-x   0 root         (0) root         (0)        0 2021-12-07 11:17:40.000000 pyskynet-0.1.5/src/c_src/
--rw-r--r--   0 root         (0) root         (0)      936 2021-09-29 08:06:28.000000 pyskynet-0.1.5/src/c_src/service_pyholder.c
--rw-r--r--   0 root         (0) root         (0)    12304 2021-09-29 08:06:28.000000 pyskynet-0.1.5/src/c_src/lua-tflite.cpp
--rw-r--r--   0 root         (0) root         (0)     5326 2021-09-29 08:06:28.000000 pyskynet-0.1.5/src/c_src/skynet_py_foreign_seri_ext.c
--rw-r--r--   0 root         (0) root         (0)    12706 2021-11-10 06:33:56.000000 pyskynet-0.1.5/src/c_src/lua-unqlite.cpp
--rw-r--r--   0 root         (0) root         (0)     1827 2021-09-29 08:06:28.000000 pyskynet-0.1.5/src/c_src/lua-modify.c
--rw-r--r--   0 root         (0) root         (0)     6681 2021-11-10 06:33:56.000000 pyskynet-0.1.5/setup.py
--rw-r--r--   0 root         (0) root         (0)      286 2021-12-07 11:17:40.000000 pyskynet-0.1.5/PKG-INFO
-drwxr-xr-x   0 root         (0) root         (0)        0 2021-12-07 11:17:38.000000 pyskynet-0.1.5/skynet/
-drwxr-xr-x   0 root         (0) root         (0)        0 2021-12-07 11:17:39.000000 pyskynet-0.1.5/skynet/lualib-src/
--rw-r--r--   0 root         (0) root         (0)    11737 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib-src/lua-skynet.c
--rw-r--r--   0 root         (0) root         (0)     4472 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib-src/lua-clientsocket.c
--rw-r--r--   0 root         (0) root         (0)      141 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib-src/lua-seri.h
--rw-r--r--   0 root         (0) root         (0)    11998 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib-src/lua-mongo.c
--rw-r--r--   0 root         (0) root         (0)     5846 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib-src/lua-sharetable.c
--rw-r--r--   0 root         (0) root         (0)     2035 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib-src/lua-memory.c
--rw-r--r--   0 root         (0) root         (0)    10495 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib-src/lua-netpack.c
--rw-r--r--   0 root         (0) root         (0)    13932 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib-src/lua-cluster.c
--rw-r--r--   0 root         (0) root         (0)    11771 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib-src/ltls.c
--rw-r--r--   0 root         (0) root         (0)     6306 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib-src/lua-debugchannel.c
--rw-r--r--   0 root         (0) root         (0)    12689 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib-src/lua-seri.c
--rw-r--r--   0 root         (0) root         (0)     9405 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib-src/lsha1.c
--rw-r--r--   0 root         (0) root         (0)    19629 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib-src/lua-socket.c
--rw-r--r--   0 root         (0) root         (0)    29843 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib-src/lua-bson.c
--rw-r--r--   0 root         (0) root         (0)     5417 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib-src/lua-stm.c
--rw-r--r--   0 root         (0) root         (0)     3470 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib-src/lua-multicast.c
--rw-r--r--   0 root         (0) root         (0)     8285 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib-src/lua-datasheet.c
-drwxr-xr-x   0 root         (0) root         (0)        0 2021-12-07 11:17:39.000000 pyskynet-0.1.5/skynet/lualib-src/sproto/
--rw-r--r--   0 root         (0) root         (0)      696 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib-src/sproto/msvcint.h
--rw-r--r--   0 root         (0) root         (0)       49 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib-src/sproto/README
--rw-r--r--   0 root         (0) root         (0)    14249 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib-src/sproto/README.md
--rw-r--r--   0 root         (0) root         (0)    29771 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib-src/sproto/sproto.c
--rw-r--r--   0 root         (0) root         (0)     2032 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib-src/sproto/sproto.h
--rw-r--r--   0 root         (0) root         (0)    21067 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib-src/sproto/lsproto.c
--rw-r--r--   0 root         (0) root         (0)    16637 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib-src/lua-sharedata.c
--rw-r--r--   0 root         (0) root         (0)    28930 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib-src/lua-crypt.c
-drwxr-xr-x   0 root         (0) root         (0)        0 2021-12-07 11:17:40.000000 pyskynet-0.1.5/skynet/service-src/
--rw-r--r--   0 root         (0) root         (0)     3216 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/service-src/databuffer.h
--rw-r--r--   0 root         (0) root         (0)     1930 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/service-src/service_logger.c
--rw-r--r--   0 root         (0) root         (0)     2080 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/service-src/hashid.h
--rw-r--r--   0 root         (0) root         (0)     9662 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/service-src/service_gate.c
--rw-r--r--   0 root         (0) root         (0)    12860 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/service-src/service_snlua.c
--rw-r--r--   0 root         (0) root         (0)    18864 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/service-src/service_harbor.c
-drwxr-xr-x   0 root         (0) root         (0)        0 2021-12-07 11:17:38.000000 pyskynet-0.1.5/skynet/3rd/
-drwxr-xr-x   0 root         (0) root         (0)        0 2021-12-07 11:17:39.000000 pyskynet-0.1.5/skynet/3rd/lua/
--rw-r--r--   0 root         (0) root         (0)     1621 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lua/linit.c
--rw-r--r--   0 root         (0) root         (0)    13191 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lua/ltablib.c
--rw-r--r--   0 root         (0) root         (0)     1663 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lua/ljumptab.h
--rw-r--r--   0 root         (0) root         (0)     2402 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lua/llex.h
--rw-r--r--   0 root         (0) root         (0)     4836 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lua/lcorolib.c
--rw-r--r--   0 root         (0) root         (0)     9241 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lua/lauxlib.h
--rw-r--r--   0 root         (0) root         (0)     1229 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lua/lualib.h
--rw-r--r--   0 root         (0) root         (0)    36805 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lua/lapi.c
--rw-r--r--   0 root         (0) root         (0)     1786 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lua/lstring.h
--rw-r--r--   0 root         (0) root         (0)     4603 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lua/lvm.h
--rwxr-xr-x   0 root         (0) root         (0)   930280 2021-09-29 08:14:03.000000 pyskynet-0.1.5/skynet/3rd/lua/luac
--rw-r--r--   0 root         (0) root         (0)    11125 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lua/lstate.c
--rw-r--r--   0 root         (0) root         (0)     2926 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lua/ldo.h
--rw-r--r--   0 root         (0) root         (0)     2461 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lua/lctype.c
--rw-r--r--   0 root         (0) root         (0)      191 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lua/lua.hpp
--rw-r--r--   0 root         (0) root         (0)    54654 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lua/lstrlib.c
--rw-r--r--   0 root         (0) root         (0)     8853 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lua/lfunc.c
--rw-r--r--   0 root         (0) root         (0)     1322 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lua/lzio.c
--rw-r--r--   0 root         (0) root         (0)     8218 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lua/ltm.c
--rw-r--r--   0 root         (0) root         (0)    51130 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lua/lcode.c
--rwxr-xr-x   0 root         (0) root         (0)  1247720 2021-09-29 08:14:02.000000 pyskynet-0.1.5/skynet/3rd/lua/lua
--rw-r--r--   0 root         (0) root         (0)    16068 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lua/lua.h
--rw-r--r--   0 root         (0) root         (0)     8639 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lua/llimits.h
--rw-r--r--   0 root         (0) root         (0)    56342 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lua/lgc.c
--rw-r--r--   0 root         (0) root         (0)     1395 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lua/lapi.h
--rw-r--r--   0 root         (0) root         (0)    57403 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lua/lvm.c
--rw-r--r--   0 root         (0) root         (0)     5894 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lua/lmem.c
--rw-r--r--   0 root         (0) root         (0)     2236 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lua/ltable.h
--rw-r--r--   0 root         (0) root         (0)      863 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lua/lundump.h
--rw-r--r--   0 root         (0) root         (0)    12716 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lua/lopcodes.h
--rw-r--r--   0 root         (0) root         (0)    31824 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lua/ltable.c
--rw-r--r--   0 root         (0) root         (0)      293 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lua/README
--rw-r--r--   0 root         (0) root         (0)    11859 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lua/loslib.c
--rw-r--r--   0 root         (0) root         (0)    23030 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lua/loadlib.c
--rw-r--r--   0 root         (0) root         (0)     5927 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lua/lparser.h
--rw-r--r--   0 root         (0) root         (0)    14902 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lua/lbaselib.c
--rw-r--r--   0 root         (0) root         (0)     2115 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lua/lctype.h
--rw-r--r--   0 root         (0) root         (0)    22058 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lua/liolib.c
--rw-r--r--   0 root         (0) root         (0)     2168 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lua/ldebug.h
--rw-r--r--   0 root         (0) root         (0)     1143 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lua/lopnames.h
--rw-r--r--   0 root         (0) root         (0)     7865 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lua/lundump.c
--rw-r--r--   0 root         (0) root         (0)     8414 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lua/lstring.c
--rw-r--r--   0 root         (0) root         (0)     1438 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lua/lzio.h
--rw-r--r--   0 root         (0) root         (0)     4771 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lua/ldump.c
--rw-r--r--   0 root         (0) root         (0)      828 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lua/lprefix.h
--rw-r--r--   0 root         (0) root         (0)    13356 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lua/ldblib.c
--rw-r--r--   0 root         (0) root         (0)    21511 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lua/luaconf.h
--rw-r--r--   0 root         (0) root         (0)    36190 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lua/lauxlib.c
--rw-r--r--   0 root         (0) root         (0)     3368 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lua/lmem.h
--rw-r--r--   0 root         (0) root         (0)     2907 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lua/ltm.h
--rw-r--r--   0 root         (0) root         (0)    17095 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lua/llex.c
--rw-r--r--   0 root         (0) root         (0)    15144 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lua/lstate.h
--rw-r--r--   0 root         (0) root         (0)    19320 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lua/lua.c
--rw-r--r--   0 root         (0) root         (0)  2176672 2021-09-29 08:14:02.000000 pyskynet-0.1.5/skynet/3rd/lua/liblua.a
--rw-r--r--   0 root         (0) root         (0)    18890 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lua/lobject.c
--rw-r--r--   0 root         (0) root         (0)     3801 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lua/lcode.h
--rw-r--r--   0 root         (0) root         (0)    32454 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lua/ldo.c
--rw-r--r--   0 root         (0) root         (0)    18884 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lua/lmathlib.c
--rw-r--r--   0 root         (0) root         (0)     1748 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lua/lfunc.h
--rw-r--r--   0 root         (0) root         (0)    22458 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lua/lobject.h
--rw-r--r--   0 root         (0) root         (0)     6209 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lua/lgc.h
--rw-r--r--   0 root         (0) root         (0)    56053 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lua/lparser.c
--rw-r--r--   0 root         (0) root         (0)    26604 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lua/ldebug.c
--rw-r--r--   0 root         (0) root         (0)     8093 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lua/lutf8lib.c
--rw-r--r--   0 root         (0) root         (0)     7525 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lua/Makefile
--rw-r--r--   0 root         (0) root         (0)    15145 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lua/luac.c
--rw-r--r--   0 root         (0) root         (0)     4126 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lua/lopcodes.c
-drwxr-xr-x   0 root         (0) root         (0)        0 2021-12-07 11:17:39.000000 pyskynet-0.1.5/skynet/3rd/lua-md5/
--rw-r--r--   0 root         (0) root         (0)     6416 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lua-md5/md5.c
--rw-r--r--   0 root         (0) root         (0)      349 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lua-md5/compat-5.2.h
--rw-r--r--   0 root         (0) root         (0)      369 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lua-md5/README
--rw-r--r--   0 root         (0) root         (0)     5335 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lua-md5/md5lib.c
--rw-r--r--   0 root         (0) root         (0)      305 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lua-md5/md5.h
--rw-r--r--   0 root         (0) root         (0)      706 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lua-md5/compat-5.2.c
-drwxr-xr-x   0 root         (0) root         (0)        0 2021-12-07 11:17:39.000000 pyskynet-0.1.5/skynet/3rd/lpeg/
--rw-r--r--   0 root         (0) root         (0)     2976 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lpeg/lptypes.h
--rw-r--r--   0 root         (0) root         (0)     4923 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lpeg/lpeg-128.gif
--rw-r--r--   0 root         (0) root         (0)     1646 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lpeg/lpvm.h
--rw-r--r--   0 root         (0) root         (0)      783 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lpeg/lpcode.h
--rw-r--r--   0 root         (0) root         (0)    31666 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lpeg/lpcode.c
--rw-r--r--   0 root         (0) root         (0)     3165 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lpeg/HISTORY
--rw-r--r--   0 root         (0) root         (0)    14838 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lpeg/re.html
--rw-r--r--   0 root         (0) root         (0)    15957 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lpeg/lpcap.c
--rw-r--r--   0 root         (0) root         (0)    43349 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lpeg/lpeg.html
--rw-r--r--   0 root         (0) root         (0)     5668 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lpeg/lpprint.c
--rw-r--r--   0 root         (0) root         (0)     1976 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lpeg/lptree.h
--rw-r--r--   0 root         (0) root         (0)    11085 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lpeg/lpvm.c
--rwxr-xr-x   0 root         (0) root         (0)    45895 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lpeg/test.lua
--rw-r--r--   0 root         (0) root         (0)      731 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lpeg/lpprint.h
--rw-r--r--   0 root         (0) root         (0)     1694 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lpeg/lpcap.h
--rw-r--r--   0 root         (0) root         (0)     6286 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lpeg/re.lua
--rw-r--r--   0 root         (0) root         (0)    36573 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lpeg/lptree.c
--rw-r--r--   0 root         (0) root         (0)     1124 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/3rd/lpeg/makefile
-drwxr-xr-x   0 root         (0) root         (0)        0 2021-12-07 11:17:39.000000 pyskynet-0.1.5/skynet/lualib/
--rw-r--r--   0 root         (0) root         (0)     5663 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib/sproto.lua
-drwxr-xr-x   0 root         (0) root         (0)        0 2021-12-07 11:17:39.000000 pyskynet-0.1.5/skynet/lualib/http/
--rw-r--r--   0 root         (0) root         (0)     4777 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib/http/internal.lua
--rw-r--r--   0 root         (0) root         (0)     3358 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib/http/httpc.lua
--rw-r--r--   0 root         (0) root         (0)     3708 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib/http/httpd.lua
--rw-r--r--   0 root         (0) root         (0)     2357 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib/http/tlshelper.lua
--rw-r--r--   0 root         (0) root         (0)     1991 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib/http/sockethelper.lua
--rw-r--r--   0 root         (0) root         (0)      466 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib/http/url.lua
--rwxr-xr-x   0 root         (0) root         (0)    15412 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib/http/websocket.lua
--rw-r--r--   0 root         (0) root         (0)    25533 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib/skynet.lua
-drwxr-xr-x   0 root         (0) root         (0)        0 2021-12-07 11:17:40.000000 pyskynet-0.1.5/skynet/lualib/snax/
--rw-r--r--   0 root         (0) root         (0)     2420 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib/snax/hotfix.lua
--rw-r--r--   0 root         (0) root         (0)     7404 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib/snax/msgserver.lua
--rw-r--r--   0 root         (0) root         (0)     3361 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib/snax/gateserver.lua
--rw-r--r--   0 root         (0) root         (0)     5318 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib/snax/loginserver.lua
--rw-r--r--   0 root         (0) root         (0)     2040 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib/snax/interface.lua
--rw-r--r--   0 root         (0) root         (0)     1017 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib/loader.lua
--rw-r--r--   0 root         (0) root         (0)     1054 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib/md5.lua
--rw-r--r--   0 root         (0) root         (0)      576 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib/sprotoloader.lua
--rw-r--r--   0 root         (0) root         (0)    12274 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib/sprotoparser.lua
-drwxr-xr-x   0 root         (0) root         (0)        0 2021-12-07 11:17:39.000000 pyskynet-0.1.5/skynet/lualib/compat10/
--rw-r--r--   0 root         (0) root         (0)       30 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib/compat10/memory.lua
--rw-r--r--   0 root         (0) root         (0)       33 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib/compat10/multicast.lua
--rw-r--r--   0 root         (0) root         (0)       31 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib/compat10/cluster.lua
--rw-r--r--   0 root         (0) root         (0)       33 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib/compat10/sharedata.lua
--rw-r--r--   0 root         (0) root         (0)       32 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib/compat10/redis.lua
--rw-r--r--   0 root         (0) root         (0)       34 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib/compat10/datacenter.lua
--rw-r--r--   0 root         (0) root         (0)       31 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib/compat10/profile.lua
--rw-r--r--   0 root         (0) root         (0)       29 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib/compat10/crypt.lua
--rw-r--r--   0 root         (0) root         (0)       32 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib/compat10/mongo.lua
--rw-r--r--   0 root         (0) root         (0)       27 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib/compat10/stm.lua
--rw-r--r--   0 root         (0) root         (0)       30 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib/compat10/socket.lua
--rw-r--r--   0 root         (0) root         (0)       36 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib/compat10/socketdriver.lua
--rw-r--r--   0 root         (0) root         (0)       30 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib/compat10/mqueue.lua
--rw-r--r--   0 root         (0) root         (0)       27 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib/compat10/dns.lua
--rw-r--r--   0 root         (0) root         (0)       31 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib/compat10/netpack.lua
--rw-r--r--   0 root         (0) root         (0)       37 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib/compat10/socketchannel.lua
--rw-r--r--   0 root         (0) root         (0)       32 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib/compat10/sharemap.lua
--rw-r--r--   0 root         (0) root         (0)       28 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib/compat10/snax.lua
--rw-r--r--   0 root         (0) root         (0)       32 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib/compat10/mysql.lua
-drwxr-xr-x   0 root         (0) root         (0)        0 2021-12-07 11:17:40.000000 pyskynet-0.1.5/skynet/lualib/skynet/
--rw-r--r--   0 root         (0) root         (0)     1986 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib/skynet/manager.lua
-drwxr-xr-x   0 root         (0) root         (0)        0 2021-12-07 11:17:40.000000 pyskynet-0.1.5/skynet/lualib/skynet/sharedata/
--rw-r--r--   0 root         (0) root         (0)     3313 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib/skynet/sharedata/corelib.lua
--rw-r--r--   0 root         (0) root         (0)     2190 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib/skynet/multicast.lua
--rw-r--r--   0 root         (0) root         (0)     2752 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib/skynet/cluster.lua
--rw-r--r--   0 root         (0) root         (0)     1624 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib/skynet/sharedata.lua
--rw-r--r--   0 root         (0) root         (0)     2555 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib/skynet/require.lua
--rw-r--r--   0 root         (0) root         (0)      801 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib/skynet/queue.lua
--rw-r--r--   0 root         (0) root         (0)      343 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib/skynet/datacenter.lua
--rw-r--r--   0 root         (0) root         (0)     5651 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib/skynet/remotedebug.lua
--rw-r--r--   0 root         (0) root         (0)      528 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib/skynet/harbor.lua
--rw-r--r--   0 root         (0) root         (0)     3382 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib/skynet/debug.lua
--rw-r--r--   0 root         (0) root         (0)     3123 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib/skynet/coroutine.lua
--rw-r--r--   0 root         (0) root         (0)     9719 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib/skynet/socket.lua
--rw-r--r--   0 root         (0) root         (0)     1798 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib/skynet/mqueue.lua
--rw-r--r--   0 root         (0) root         (0)    12001 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib/skynet/dns.lua
--rw-r--r--   0 root         (0) root         (0)    10876 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib/skynet/sharetable.lua
--rw-r--r--   0 root         (0) root         (0)      933 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib/skynet/service.lua
-drwxr-xr-x   0 root         (0) root         (0)        0 2021-12-07 11:17:40.000000 pyskynet-0.1.5/skynet/lualib/skynet/datasheet/
--rw-r--r--   0 root         (0) root         (0)     1487 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib/skynet/datasheet/init.lua
--rw-r--r--   0 root         (0) root         (0)     6547 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib/skynet/datasheet/dump.lua
--rw-r--r--   0 root         (0) root         (0)     4493 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib/skynet/datasheet/builder.lua
--rw-r--r--   0 root         (0) root         (0)    12823 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib/skynet/socketchannel.lua
--rw-r--r--   0 root         (0) root         (0)     1503 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib/skynet/sharemap.lua
-drwxr-xr-x   0 root         (0) root         (0)        0 2021-12-07 11:17:40.000000 pyskynet-0.1.5/skynet/lualib/skynet/db/
--rw-r--r--   0 root         (0) root         (0)     6860 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib/skynet/db/redis.lua
--rw-r--r--   0 root         (0) root         (0)    17224 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib/skynet/db/mongo.lua
--rw-r--r--   0 root         (0) root         (0)    29437 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib/skynet/db/mysql.lua
--rw-r--r--   0 root         (0) root         (0)     3697 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib/skynet/snax.lua
--rw-r--r--   0 root         (0) root         (0)     2610 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib/skynet/injectcode.lua
--rw-r--r--   0 root         (0) root         (0)     1445 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/lualib/skynet/inject.lua
-drwxr-xr-x   0 root         (0) root         (0)        0 2021-12-07 11:17:40.000000 pyskynet-0.1.5/skynet/service/
--rw-r--r--   0 root         (0) root         (0)     4834 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/service/service_mgr.lua
--rw-r--r--   0 root         (0) root         (0)      329 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/service/cmemory.lua
--rw-r--r--   0 root         (0) root         (0)     2242 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/service/service_provider.lua
--rw-r--r--   0 root         (0) root         (0)     2244 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/service/snaxd.lua
--rw-r--r--   0 root         (0) root         (0)    11179 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/service/debug_console.lua
--rw-r--r--   0 root         (0) root         (0)      677 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/service/console.lua
--rw-r--r--   0 root         (0) root         (0)     1797 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/service/cdummy.lua
--rw-r--r--   0 root         (0) root         (0)      746 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/service/debug_agent.lua
--rw-r--r--   0 root         (0) root         (0)      930 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/service/clusterproxy.lua
--rw-r--r--   0 root         (0) root         (0)     3399 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/service/sharedatad.lua
--rw-r--r--   0 root         (0) root         (0)     3455 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/service/clusteragent.lua
--rw-r--r--   0 root         (0) root         (0)     6688 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/service/cslave.lua
--rw-r--r--   0 root         (0) root         (0)     1280 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/service/bootstrap.lua
--rw-r--r--   0 root         (0) root         (0)     3263 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/service/cmaster.lua
--rw-r--r--   0 root         (0) root         (0)      808 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/service/dbg.lua
--rw-r--r--   0 root         (0) root         (0)      489 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/service/service_cell.lua
--rw-r--r--   0 root         (0) root         (0)     4124 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/service/launcher.lua
--rw-r--r--   0 root         (0) root         (0)     5618 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/service/multicastd.lua
--rw-r--r--   0 root         (0) root         (0)     5666 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/service/clusterd.lua
--rw-r--r--   0 root         (0) root         (0)     2015 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/service/clustersender.lua
--rw-r--r--   0 root         (0) root         (0)     2079 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/service/gate.lua
--rw-r--r--   0 root         (0) root         (0)     1949 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/service/datacenterd.lua
-drwxr-xr-x   0 root         (0) root         (0)        0 2021-12-07 11:17:40.000000 pyskynet-0.1.5/skynet/skynet-src/
--rw-r--r--   0 root         (0) root         (0)     1206 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/skynet-src/skynet_server.h
--rw-r--r--   0 root         (0) root         (0)     5399 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/skynet-src/skynet_handle.c
--rw-r--r--   0 root         (0) root         (0)      409 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/skynet-src/skynet_imp.h
--rw-r--r--   0 root         (0) root         (0)      628 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/skynet-src/malloc_hook.h
--rw-r--r--   0 root         (0) root         (0)      586 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/skynet-src/socket_info.h
--rw-r--r--   0 root         (0) root         (0)     1515 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/skynet-src/socket_epoll.h
--rw-r--r--   0 root         (0) root         (0)     1046 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/skynet-src/skynet_monitor.c
--rw-r--r--   0 root         (0) root         (0)      782 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/skynet-src/skynet_env.c
--rw-r--r--   0 root         (0) root         (0)     2319 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/skynet-src/socket_kqueue.h
--rw-r--r--   0 root         (0) root         (0)      348 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/skynet-src/skynet_monitor.h
--rw-r--r--   0 root         (0) root         (0)      575 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/skynet-src/skynet_handle.h
--rw-r--r--   0 root         (0) root         (0)     3955 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/skynet-src/skynet_main.c
--rw-r--r--   0 root         (0) root         (0)     2781 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/skynet-src/skynet_socket.h
--rw-r--r--   0 root         (0) root         (0)      297 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/skynet-src/skynet_timer.h
--rw-r--r--   0 root         (0) root         (0)     5278 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/skynet-src/skynet_socket.c
--rw-r--r--   0 root         (0) root         (0)      259 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/skynet-src/socket_buffer.h
--rw-r--r--   0 root         (0) root         (0)      774 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/skynet-src/skynet_malloc.h
--rw-r--r--   0 root         (0) root         (0)      731 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/skynet-src/socket_poll.h
--rw-r--r--   0 root         (0) root         (0)     1253 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/skynet-src/skynet_error.c
--rw-r--r--   0 root         (0) root         (0)     3589 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/skynet-src/skynet_module.c
--rw-r--r--   0 root         (0) root         (0)    20172 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/skynet-src/skynet_server.c
--rw-r--r--   0 root         (0) root         (0)     3111 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/skynet-src/socket_server.h
--rw-r--r--   0 root         (0) root         (0)     1523 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/skynet-src/atomic.h
--rw-r--r--   0 root         (0) root         (0)      177 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/skynet-src/skynet_env.h
--rw-r--r--   0 root         (0) root         (0)      981 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/skynet-src/skynet_module.h
--rw-r--r--   0 root         (0) root         (0)      571 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/skynet-src/skynet_harbor.h
--rw-r--r--   0 root         (0) root         (0)     1472 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/skynet-src/rwlock.h
--rw-r--r--   0 root         (0) root         (0)    57365 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/skynet-src/socket_server.c
--rw-r--r--   0 root         (0) root         (0)     1128 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/skynet-src/skynet_mq.h
--rw-r--r--   0 root         (0) root         (0)     1163 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/skynet-src/skynet_harbor.c
--rw-r--r--   0 root         (0) root         (0)     2172 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/skynet-src/skynet_daemon.c
--rw-r--r--   0 root         (0) root         (0)     7784 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/skynet-src/malloc_hook.c
--rw-r--r--   0 root         (0) root         (0)     6145 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/skynet-src/skynet_start.c
--rw-r--r--   0 root         (0) root         (0)     4632 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/skynet-src/skynet_mq.c
--rw-r--r--   0 root         (0) root         (0)     1966 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/skynet-src/spinlock.h
--rw-r--r--   0 root         (0) root         (0)     1967 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/skynet-src/skynet_log.c
--rw-r--r--   0 root         (0) root         (0)     5839 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/skynet-src/skynet_timer.c
--rw-r--r--   0 root         (0) root         (0)     1633 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/skynet-src/skynet.h
--rw-r--r--   0 root         (0) root         (0)      382 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/skynet-src/skynet_log.h
--rw-r--r--   0 root         (0) root         (0)      133 2021-09-29 08:11:53.000000 pyskynet-0.1.5/skynet/skynet-src/skynet_daemon.h
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:43.000000 pyskynet-0.2.0/
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:41.000000 pyskynet-0.2.0/3rd/
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:41.000000 pyskynet-0.2.0/3rd/TinyGL/
+-rw-r--r--   0 root         (0) root         (0)     1012 2021-09-29 08:06:28.000000 pyskynet-0.2.0/3rd/TinyGL/LICENCE
+-rw-r--r--   0 root         (0) root         (0)      157 2021-09-29 08:06:28.000000 pyskynet-0.2.0/3rd/TinyGL/Makefile
+-rw-r--r--   0 root         (0) root         (0)   247721 2021-09-29 08:06:28.000000 pyskynet-0.2.0/3rd/TinyGL/bitmap_image.hpp
+-rw-r--r--   0 root         (0) root         (0)     1778 2021-09-29 08:06:28.000000 pyskynet-0.2.0/3rd/TinyGL/example.cpp
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:41.000000 pyskynet-0.2.0/3rd/TinyGL/tinygl/
+-rw-r--r--   0 root         (0) root         (0)     8479 2021-09-29 08:06:28.000000 pyskynet-0.2.0/3rd/TinyGL/tinygl/Camera.cpp
+-rw-r--r--   0 root         (0) root         (0)     1778 2021-11-10 06:33:56.000000 pyskynet-0.2.0/3rd/TinyGL/tinygl/Camera.h
+-rw-r--r--   0 root         (0) root         (0)     4636 2021-11-10 06:33:56.000000 pyskynet-0.2.0/3rd/TinyGL/tinygl/Mesh.cpp
+-rw-r--r--   0 root         (0) root         (0)     1476 2021-11-10 06:33:56.000000 pyskynet-0.2.0/3rd/TinyGL/tinygl/Mesh.h
+-rw-r--r--   0 root         (0) root         (0)     8050 2021-09-29 08:06:28.000000 pyskynet-0.2.0/3rd/TinyGL/tinygl/Screen.cpp
+-rw-r--r--   0 root         (0) root         (0)     1563 2021-11-10 06:33:56.000000 pyskynet-0.2.0/3rd/TinyGL/tinygl/Screen.h
+-rw-r--r--   0 root         (0) root         (0)      808 2021-09-29 08:06:28.000000 pyskynet-0.2.0/3rd/TinyGL/tinygl/Shader.h
+-rw-r--r--   0 root         (0) root         (0)      812 2021-09-29 08:06:28.000000 pyskynet-0.2.0/3rd/TinyGL/tinygl/Transform.h
+-rw-r--r--   0 root         (0) root         (0)     6017 2021-11-10 06:33:56.000000 pyskynet-0.2.0/3rd/TinyGL/tinygl/point.h
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:41.000000 pyskynet-0.2.0/3rd/lua-protobuf/
+-rw-r--r--   0 root         (0) root         (0)       44 2021-09-29 08:06:39.000000 pyskynet-0.2.0/3rd/lua-protobuf/.git
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:41.000000 pyskynet-0.2.0/3rd/lua-protobuf/.github/
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:41.000000 pyskynet-0.2.0/3rd/lua-protobuf/.github/workflows/
+-rw-r--r--   0 root         (0) root         (0)     2182 2021-09-29 08:11:53.000000 pyskynet-0.2.0/3rd/lua-protobuf/.github/workflows/test.yml
+-rw-r--r--   0 root         (0) root         (0)      107 2021-09-29 08:11:53.000000 pyskynet-0.2.0/3rd/lua-protobuf/.gitignore
+-rw-r--r--   0 root         (0) root         (0)     1022 2021-09-29 08:11:53.000000 pyskynet-0.2.0/3rd/lua-protobuf/.travis.yml
+-rw-r--r--   0 root         (0) root         (0)     1068 2021-09-29 08:11:53.000000 pyskynet-0.2.0/3rd/lua-protobuf/LICENSE
+-rw-r--r--   0 root         (0) root         (0)    25649 2021-09-29 08:11:53.000000 pyskynet-0.2.0/3rd/lua-protobuf/README.md
+-rw-r--r--   0 root         (0) root         (0)    35128 2021-09-29 08:11:53.000000 pyskynet-0.2.0/3rd/lua-protobuf/README.zh.md
+-rw-r--r--   0 root         (0) root         (0)   107116 2021-09-29 08:11:53.000000 pyskynet-0.2.0/3rd/lua-protobuf/luaunit.lua
+-rw-r--r--   0 root         (0) root         (0)    60112 2021-09-29 08:11:53.000000 pyskynet-0.2.0/3rd/lua-protobuf/pb.c
+-rw-r--r--   0 root         (0) root         (0)    53331 2021-09-29 08:11:53.000000 pyskynet-0.2.0/3rd/lua-protobuf/pb.h
+-rw-r--r--   0 root         (0) root         (0)    34050 2021-09-29 08:11:53.000000 pyskynet-0.2.0/3rd/lua-protobuf/protoc.lua
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:41.000000 pyskynet-0.2.0/3rd/lua-protobuf/rockspecs/
+-rw-r--r--   0 root         (0) root         (0)      492 2021-09-29 08:11:53.000000 pyskynet-0.2.0/3rd/lua-protobuf/rockspecs/lua-protobuf-scm-1.rockspec
+-rw-r--r--   0 root         (0) root         (0)     8682 2021-09-29 08:11:53.000000 pyskynet-0.2.0/3rd/lua-protobuf/serpent.lua
+-rw-r--r--   0 root         (0) root         (0)    39060 2021-09-29 08:11:53.000000 pyskynet-0.2.0/3rd/lua-protobuf/test.lua
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:41.000000 pyskynet-0.2.0/3rd/lua-rapidjson/
+-rw-r--r--   0 root         (0) root         (0)       10 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/.busted
+-rw-r--r--   0 root         (0) root         (0)      124 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/.editorconfig
+-rw-r--r--   0 root         (0) root         (0)       45 2021-09-29 08:09:29.000000 pyskynet-0.2.0/3rd/lua-rapidjson/.git
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:41.000000 pyskynet-0.2.0/3rd/lua-rapidjson/.github/
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:41.000000 pyskynet-0.2.0/3rd/lua-rapidjson/.github/workflows/
+-rw-r--r--   0 root         (0) root         (0)      624 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/.github/workflows/main.yml
+-rw-r--r--   0 root         (0) root         (0)      525 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/.gitignore
+-rw-r--r--   0 root         (0) root         (0)      115 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/.luacheckrc
+-rw-r--r--   0 root         (0) root         (0)     1037 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/.travis.yml
+-rw-r--r--   0 root         (0) root         (0)     8267 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/API.md
+-rw-r--r--   0 root         (0) root         (0)     2927 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/CMakeLists.txt
+-rw-r--r--   0 root         (0) root         (0)     1052 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/LICENSE
+-rw-r--r--   0 root         (0) root         (0)     5295 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/README.md
+-rw-r--r--   0 root         (0) root         (0)      689 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/appveyor.yml
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:41.000000 pyskynet-0.2.0/3rd/lua-rapidjson/cmake/
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:41.000000 pyskynet-0.2.0/3rd/lua-rapidjson/cmake/Modules/
+-rw-r--r--   0 root         (0) root         (0)     5053 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/cmake/Modules/FindLua.cmake
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:41.000000 pyskynet-0.2.0/3rd/lua-rapidjson/performance/
+-rw-r--r--   0 root         (0) root         (0)      849 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/performance/booleans.json
+-rw-r--r--   0 root         (0) root         (0)     1698 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/performance/floats.json
+-rw-r--r--   0 root         (0) root         (0)     4202 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/performance/guids.json
+-rw-r--r--   0 root         (0) root         (0)     1098 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/performance/integers.json
+-rw-r--r--   0 root         (0) root         (0)    15142 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/performance/mixed.json
+-rw-r--r--   0 root         (0) root         (0)      802 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/performance/nulls.json
+-rw-r--r--   0 root         (0) root         (0)    33764 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/performance/paragraphs.json
+-rw-r--r--   0 root         (0) root         (0)     1713 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/performance/run.lua
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:41.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/
+-rw-r--r--   0 root         (0) root         (0)      383 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/.gitignore
+-rw-r--r--   0 root         (0) root         (0)     6818 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/CHANGELOG.md
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:41.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/bin/
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:41.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/bin/encodings/
+-rw-r--r--   0 root         (0) root         (0)      368 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/bin/encodings/utf16be.json
+-rw-r--r--   0 root         (0) root         (0)      370 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/bin/encodings/utf16bebom.json
+-rw-r--r--   0 root         (0) root         (0)      368 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/bin/encodings/utf16le.json
+-rw-r--r--   0 root         (0) root         (0)      370 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/bin/encodings/utf16lebom.json
+-rw-r--r--   0 root         (0) root         (0)      736 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/bin/encodings/utf32be.json
+-rw-r--r--   0 root         (0) root         (0)      740 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/bin/encodings/utf32bebom.json
+-rw-r--r--   0 root         (0) root         (0)      736 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/bin/encodings/utf32le.json
+-rw-r--r--   0 root         (0) root         (0)      740 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/bin/encodings/utf32lebom.json
+-rw-r--r--   0 root         (0) root         (0)      322 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/bin/encodings/utf8.json
+-rw-r--r--   0 root         (0) root         (0)      325 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/bin/encodings/utf8bom.json
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:41.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/
+-rw-r--r--   0 root         (0) root         (0)       60 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/fail1.json
+-rw-r--r--   0 root         (0) root         (0)       58 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/fail10.json
+-rw-r--r--   0 root         (0) root         (0)       29 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/fail11.json
+-rw-r--r--   0 root         (0) root         (0)       31 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/fail12.json
+-rw-r--r--   0 root         (0) root         (0)       43 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/fail13.json
+-rw-r--r--   0 root         (0) root         (0)       31 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/fail14.json
+-rw-r--r--   0 root         (0) root         (0)       34 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/fail15.json
+-rw-r--r--   0 root         (0) root         (0)        8 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/fail16.json
+-rw-r--r--   0 root         (0) root         (0)       34 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/fail17.json
+-rw-r--r--   0 root         (0) root         (0)       50 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/fail18.json
+-rw-r--r--   0 root         (0) root         (0)       22 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/fail19.json
+-rw-r--r--   0 root         (0) root         (0)       17 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/fail2.json
+-rw-r--r--   0 root         (0) root         (0)       23 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/fail20.json
+-rw-r--r--   0 root         (0) root         (0)       32 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/fail21.json
+-rw-r--r--   0 root         (0) root         (0)       33 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/fail22.json
+-rw-r--r--   0 root         (0) root         (0)       20 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/fail23.json
+-rw-r--r--   0 root         (0) root         (0)       16 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/fail24.json
+-rw-r--r--   0 root         (0) root         (0)       29 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/fail25.json
+-rw-r--r--   0 root         (0) root         (0)       38 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/fail26.json
+-rw-r--r--   0 root         (0) root         (0)       14 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/fail27.json
+-rw-r--r--   0 root         (0) root         (0)       15 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/fail28.json
+-rw-r--r--   0 root         (0) root         (0)        4 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/fail29.json
+-rw-r--r--   0 root         (0) root         (0)       37 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/fail3.json
+-rw-r--r--   0 root         (0) root         (0)        5 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/fail30.json
+-rw-r--r--   0 root         (0) root         (0)        7 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/fail31.json
+-rw-r--r--   0 root         (0) root         (0)       40 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/fail32.json
+-rw-r--r--   0 root         (0) root         (0)       12 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/fail33.json
+-rw-r--r--   0 root         (0) root         (0)       16 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/fail4.json
+-rw-r--r--   0 root         (0) root         (0)       24 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/fail5.json
+-rw-r--r--   0 root         (0) root         (0)       26 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/fail6.json
+-rw-r--r--   0 root         (0) root         (0)       26 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/fail7.json
+-rw-r--r--   0 root         (0) root         (0)       16 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/fail8.json
+-rw-r--r--   0 root         (0) root         (0)       22 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/fail9.json
+-rw-r--r--   0 root         (0) root         (0)     1441 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/pass1.json
+-rw-r--r--   0 root         (0) root         (0)       52 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/pass2.json
+-rw-r--r--   0 root         (0) root         (0)      148 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/pass3.json
+-rw-r--r--   0 root         (0) root         (0)      173 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/readme.txt
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:41.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/bin/types/
+-rwxr-xr-x   0 root         (0) root         (0)      849 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/bin/types/booleans.json
+-rwxr-xr-x   0 root         (0) root         (0)     1698 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/bin/types/floats.json
+-rwxr-xr-x   0 root         (0) root         (0)     4202 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/bin/types/guids.json
+-rwxr-xr-x   0 root         (0) root         (0)     1098 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/bin/types/integers.json
+-rwxr-xr-x   0 root         (0) root         (0)    15142 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/bin/types/mixed.json
+-rwxr-xr-x   0 root         (0) root         (0)      802 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/bin/types/nulls.json
+-rwxr-xr-x   0 root         (0) root         (0)    33764 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/bin/types/paragraphs.json
+-rw-r--r--   0 root         (0) root         (0)       86 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/bin/types/readme.txt
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:41.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:42.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/
+-rw-r--r--   0 root         (0) root         (0)    10675 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/allocators.h
+-rw-r--r--   0 root         (0) root         (0)     2281 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/cursorstreamwrapper.h
+-rw-r--r--   0 root         (0) root         (0)   121069 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/document.h
+-rw-r--r--   0 root         (0) root         (0)    10681 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/encodedstream.h
+-rw-r--r--   0 root         (0) root         (0)    29281 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/encodings.h
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:42.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/error/
+-rw-r--r--   0 root         (0) root         (0)     3870 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/error/en.h
+-rw-r--r--   0 root         (0) root         (0)     6213 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/error/error.h
+-rw-r--r--   0 root         (0) root         (0)     3001 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/filereadstream.h
+-rw-r--r--   0 root         (0) root         (0)     3146 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/filewritestream.h
+-rw-r--r--   0 root         (0) root         (0)     4034 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/fwd.h
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:42.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/internal/
+-rw-r--r--   0 root         (0) root         (0)     9143 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/internal/biginteger.h
+-rw-r--r--   0 root         (0) root         (0)     2018 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/internal/clzll.h
+-rw-r--r--   0 root         (0) root         (0)    11509 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/internal/diyfp.h
+-rw-r--r--   0 root         (0) root         (0)     8125 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/internal/dtoa.h
+-rw-r--r--   0 root         (0) root         (0)     2994 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/internal/ieee754.h
+-rw-r--r--   0 root         (0) root         (0)    10131 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/internal/itoa.h
+-rw-r--r--   0 root         (0) root         (0)     6641 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/internal/meta.h
+-rw-r--r--   0 root         (0) root         (0)     3595 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/internal/pow10.h
+-rw-r--r--   0 root         (0) root         (0)    26141 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/internal/regex.h
+-rw-r--r--   0 root         (0) root         (0)     7184 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/internal/stack.h
+-rw-r--r--   0 root         (0) root         (0)     2199 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/internal/strfunc.h
+-rw-r--r--   0 root         (0) root         (0)     8994 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/internal/strtod.h
+-rw-r--r--   0 root         (0) root         (0)     1419 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/internal/swap.h
+-rw-r--r--   0 root         (0) root         (0)     4082 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/istreamwrapper.h
+-rw-r--r--   0 root         (0) root         (0)     2560 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/memorybuffer.h
+-rw-r--r--   0 root         (0) root         (0)     2667 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/memorystream.h
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:42.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/msinttypes/
+-rw-r--r--   0 root         (0) root         (0)     8372 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/msinttypes/inttypes.h
+-rw-r--r--   0 root         (0) root         (0)     9386 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/msinttypes/stdint.h
+-rw-r--r--   0 root         (0) root         (0)     2331 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/ostreamwrapper.h
+-rw-r--r--   0 root         (0) root         (0)    60889 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/pointer.h
+-rw-r--r--   0 root         (0) root         (0)    10539 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/prettywriter.h
+-rw-r--r--   0 root         (0) root         (0)    23663 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/rapidjson.h
+-rw-r--r--   0 root         (0) root         (0)    93391 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/reader.h
+-rw-r--r--   0 root         (0) root         (0)   103633 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/schema.h
+-rw-r--r--   0 root         (0) root         (0)     6753 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/stream.h
+-rw-r--r--   0 root         (0) root         (0)     3993 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/stringbuffer.h
+-rw-r--r--   0 root         (0) root         (0)    26877 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/writer.h
+-rw-r--r--   0 root         (0) root         (0)     5152 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/license.txt
+-rw-r--r--   0 root         (0) root         (0)    11187 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/readme.md
+-rw-r--r--   0 root         (0) root         (0)     8815 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/readme.zh-cn.md
+-rw-r--r--   0 root         (0) root         (0)      717 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson-0.7.1-1.rockspec
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:42.000000 pyskynet-0.2.0/3rd/lua-rapidjson/spec/
+-rw-r--r--   0 root         (0) root         (0)     5574 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/spec/Document_spec.lua
+-rw-r--r--   0 root         (0) root         (0)     4175 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/spec/Schema_spec.lua
+-rw-r--r--   0 root         (0) root         (0)        3 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/spec/empty-array.json
+-rw-r--r--   0 root         (0) root         (0)        0 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/spec/empty-file.json
+-rw-r--r--   0 root         (0) root         (0)        3 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/spec/empty-object.json
+-rw-r--r--   0 root         (0) root         (0)      913 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/spec/json_array_spec.lua
+-rw-r--r--   0 root         (0) root         (0)     6405 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/spec/json_decode_spec.lua
+-rw-r--r--   0 root         (0) root         (0)     5095 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/spec/json_dump_spec.lua
+-rw-r--r--   0 root         (0) root         (0)     5612 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/spec/json_encode_spec.lua
+-rw-r--r--   0 root         (0) root         (0)     9513 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/spec/json_load_spec.lua
+-rw-r--r--   0 root         (0) root         (0)     1132 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/spec/json_null_spec.lua
+-rw-r--r--   0 root         (0) root         (0)      914 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/spec/json_object_spec.lua
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:42.000000 pyskynet-0.2.0/3rd/lua-rapidjson/src/
+-rw-r--r--   0 root         (0) root         (0)     3863 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/src/Document.cpp
+-rw-r--r--   0 root         (0) root         (0)     2558 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/src/Schema.cpp
+-rw-r--r--   0 root         (0) root         (0)     1439 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/src/StringStream.hpp
+-rw-r--r--   0 root         (0) root         (0)     1988 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/src/Userdata.hpp
+-rw-r--r--   0 root         (0) root         (0)      305 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/src/file.hpp
+-rw-r--r--   0 root         (0) root         (0)     2202 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/src/luax.hpp
+-rw-r--r--   0 root         (0) root         (0)     9848 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/src/rapidjson.cpp
+-rw-r--r--   0 root         (0) root         (0)     3052 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/src/values.cpp
+-rw-r--r--   0 root         (0) root         (0)     6617 2021-11-10 06:37:12.000000 pyskynet-0.2.0/3rd/lua-rapidjson/src/values.hpp
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:41.000000 pyskynet-0.2.0/3rd/numsky/
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:42.000000 pyskynet-0.2.0/3rd/numsky/src/
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:42.000000 pyskynet-0.2.0/3rd/numsky/src/foreign_seri/
+-rw-r--r--   0 root         (0) root         (0)    10318 2023-06-12 13:57:38.000000 pyskynet-0.2.0/3rd/numsky/src/foreign_seri/lua-foreign_seri.c
+-rw-r--r--   0 root         (0) root         (0)     4445 2023-06-12 13:57:38.000000 pyskynet-0.2.0/3rd/numsky/src/foreign_seri/read_block.c
+-rw-r--r--   0 root         (0) root         (0)      576 2023-06-12 13:57:38.000000 pyskynet-0.2.0/3rd/numsky/src/foreign_seri/read_block.h
+-rw-r--r--   0 root         (0) root         (0)      819 2023-06-12 13:57:38.000000 pyskynet-0.2.0/3rd/numsky/src/foreign_seri/seri.h
+-rw-r--r--   0 root         (0) root         (0)     2850 2023-06-12 13:57:38.000000 pyskynet-0.2.0/3rd/numsky/src/foreign_seri/write_block.c
+-rw-r--r--   0 root         (0) root         (0)      614 2023-06-12 13:57:38.000000 pyskynet-0.2.0/3rd/numsky/src/foreign_seri/write_block.h
+-rw-r--r--   0 root         (0) root         (0)     9827 2021-11-10 06:33:56.000000 pyskynet-0.2.0/3rd/numsky/src/lua-binding.h
+-rw-r--r--   0 root         (0) root         (0)    13782 2021-11-10 06:33:56.000000 pyskynet-0.2.0/3rd/numsky/src/lua-cluster.c
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:42.000000 pyskynet-0.2.0/3rd/numsky/src/numsky/
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:42.000000 pyskynet-0.2.0/3rd/numsky/src/numsky/canvas/
+-rw-r--r--   0 root         (0) root         (0)     5767 2021-11-10 06:33:56.000000 pyskynet-0.2.0/3rd/numsky/src/numsky/canvas/ArrayAstNode.cpp
+-rw-r--r--   0 root         (0) root         (0)     2618 2021-11-10 06:33:56.000000 pyskynet-0.2.0/3rd/numsky/src/numsky/canvas/ArrayAstNode.h
+-rw-r--r--   0 root         (0) root         (0)     5715 2021-11-10 06:33:56.000000 pyskynet-0.2.0/3rd/numsky/src/numsky/canvas/AstNode.cpp
+-rw-r--r--   0 root         (0) root         (0)     2682 2021-11-10 06:33:56.000000 pyskynet-0.2.0/3rd/numsky/src/numsky/canvas/AstNode.h
+-rw-r--r--   0 root         (0) root         (0)    10167 2021-11-10 06:33:56.000000 pyskynet-0.2.0/3rd/numsky/src/numsky/canvas/CameraAstNode.cpp
+-rw-r--r--   0 root         (0) root         (0)     5070 2021-11-10 06:33:56.000000 pyskynet-0.2.0/3rd/numsky/src/numsky/canvas/CameraAstNode.h
+-rw-r--r--   0 root         (0) root         (0)      955 2021-11-10 06:33:56.000000 pyskynet-0.2.0/3rd/numsky/src/numsky/canvas/DefinedException.cpp
+-rw-r--r--   0 root         (0) root         (0)     1119 2021-11-10 06:33:56.000000 pyskynet-0.2.0/3rd/numsky/src/numsky/canvas/DefinedException.h
+-rw-r--r--   0 root         (0) root         (0)     7627 2021-11-10 06:33:56.000000 pyskynet-0.2.0/3rd/numsky/src/numsky/canvas/EvalContext.h
+-rw-r--r--   0 root         (0) root         (0)      325 2021-09-29 08:06:28.000000 pyskynet-0.2.0/3rd/numsky/src/numsky/canvas/ExpandControl.h
+-rw-r--r--   0 root         (0) root         (0)    13057 2023-06-12 13:55:13.000000 pyskynet-0.2.0/3rd/numsky/src/numsky/canvas/IAstNode.cpp
+-rw-r--r--   0 root         (0) root         (0)     6316 2023-06-12 13:55:13.000000 pyskynet-0.2.0/3rd/numsky/src/numsky/canvas/IAstNode.h
+-rw-r--r--   0 root         (0) root         (0)    14600 2023-06-12 13:55:13.000000 pyskynet-0.2.0/3rd/numsky/src/numsky/canvas/LiteralParser.cpp
+-rw-r--r--   0 root         (0) root         (0)     1167 2023-06-12 13:55:13.000000 pyskynet-0.2.0/3rd/numsky/src/numsky/canvas/LiteralParser.h
+-rw-r--r--   0 root         (0) root         (0)     2852 2023-06-12 13:55:13.000000 pyskynet-0.2.0/3rd/numsky/src/numsky/canvas/LuaAstNode.cpp
+-rw-r--r--   0 root         (0) root         (0)     2203 2023-06-12 13:55:13.000000 pyskynet-0.2.0/3rd/numsky/src/numsky/canvas/LuaAstNode.h
+-rw-r--r--   0 root         (0) root         (0)     1498 2021-11-10 06:33:56.000000 pyskynet-0.2.0/3rd/numsky/src/numsky/canvas/ParseContext.cpp
+-rw-r--r--   0 root         (0) root         (0)    10369 2021-11-10 06:33:56.000000 pyskynet-0.2.0/3rd/numsky/src/numsky/canvas/ParseContext.h
+-rw-r--r--   0 root         (0) root         (0)     2125 2021-09-29 08:06:28.000000 pyskynet-0.2.0/3rd/numsky/src/numsky/canvas/TypeGuard.h
+-rw-r--r--   0 root         (0) root         (0)    11948 2021-09-29 08:06:28.000000 pyskynet-0.2.0/3rd/numsky/src/numsky/canvas/ValNode.cpp
+-rw-r--r--   0 root         (0) root         (0)     5371 2021-09-29 08:06:28.000000 pyskynet-0.2.0/3rd/numsky/src/numsky/canvas/ValNode.h
+-rw-r--r--   0 root         (0) root         (0)     3084 2021-11-10 06:33:56.000000 pyskynet-0.2.0/3rd/numsky/src/numsky/canvas/lua-numsky_canvas.cpp
+-rw-r--r--   0 root         (0) root         (0)     4116 2023-06-12 13:57:38.000000 pyskynet-0.2.0/3rd/numsky/src/numsky/lua-numsky.cpp
+-rw-r--r--   0 root         (0) root         (0)     6897 2021-11-10 06:33:56.000000 pyskynet-0.2.0/3rd/numsky/src/numsky/lua-numsky.h
+-rw-r--r--   0 root         (0) root         (0)     2214 2021-11-10 06:33:56.000000 pyskynet-0.2.0/3rd/numsky/src/numsky/lua-numsky_dtype.cpp
+-rw-r--r--   0 root         (0) root         (0)     1515 2021-11-10 06:33:56.000000 pyskynet-0.2.0/3rd/numsky/src/numsky/lua-numsky_export.cpp
+-rw-r--r--   0 root         (0) root         (0)     1326 2021-11-10 06:33:56.000000 pyskynet-0.2.0/3rd/numsky/src/numsky/lua-numsky_name.cpp
+-rw-r--r--   0 root         (0) root         (0)     1143 2021-11-10 06:33:56.000000 pyskynet-0.2.0/3rd/numsky/src/numsky/lua-numsky_nditer.cpp
+-rw-r--r--   0 root         (0) root         (0)     3200 2021-09-29 08:06:28.000000 pyskynet-0.2.0/3rd/numsky/src/numsky/lua-numsky_slice.cpp
+-rw-r--r--   0 root         (0) root         (0)     1301 2021-09-29 08:06:28.000000 pyskynet-0.2.0/3rd/numsky/src/numsky/lua-numsky_tuple.cpp
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:42.000000 pyskynet-0.2.0/3rd/numsky/src/numsky/ndarray/
+-rw-r--r--   0 root         (0) root         (0)     4351 2023-06-12 13:57:38.000000 pyskynet-0.2.0/3rd/numsky/src/numsky/ndarray/lua-numsky_ndarray.cpp
+-rw-r--r--   0 root         (0) root         (0)    10136 2023-06-12 13:57:38.000000 pyskynet-0.2.0/3rd/numsky/src/numsky/ndarray/lua-numsky_ndarray.h
+-rw-r--r--   0 root         (0) root         (0)    12001 2023-06-12 13:57:38.000000 pyskynet-0.2.0/3rd/numsky/src/numsky/ndarray/ndarray_ctor.cpp
+-rw-r--r--   0 root         (0) root         (0)    17669 2021-11-10 06:33:56.000000 pyskynet-0.2.0/3rd/numsky/src/numsky/ndarray/ndarray_indexing.cpp
+-rw-r--r--   0 root         (0) root         (0)     4663 2023-06-12 13:57:38.000000 pyskynet-0.2.0/3rd/numsky/src/numsky/ndarray/ndarray_methods.cpp
+-rw-r--r--   0 root         (0) root         (0)     1894 2023-06-12 13:57:38.000000 pyskynet-0.2.0/3rd/numsky/src/numsky/ndarray/ndarray_tostring.cpp
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:42.000000 pyskynet-0.2.0/3rd/numsky/src/numsky/tinygl/
+-rw-r--r--   0 root         (0) root         (0)     5781 2021-11-10 06:33:56.000000 pyskynet-0.2.0/3rd/numsky/src/numsky/tinygl/lua-numsky_tinygl.cpp
+-rw-r--r--   0 root         (0) root         (0)     3079 2021-11-10 06:33:56.000000 pyskynet-0.2.0/3rd/numsky/src/numsky/tinygl/lua-numsky_tinygl.h
+-rw-r--r--   0 root         (0) root         (0)     4508 2021-11-10 06:33:56.000000 pyskynet-0.2.0/3rd/numsky/src/numsky/tinygl/tinygl_mesh.cpp
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:42.000000 pyskynet-0.2.0/3rd/numsky/src/numsky/ufunc/
+-rw-r--r--   0 root         (0) root         (0)     3172 2021-11-10 06:33:56.000000 pyskynet-0.2.0/3rd/numsky/src/numsky/ufunc/lua-numsky_ufunc.cpp
+-rw-r--r--   0 root         (0) root         (0)     2677 2021-09-29 08:06:28.000000 pyskynet-0.2.0/3rd/numsky/src/numsky/ufunc/lua-numsky_ufunc.h
+-rw-r--r--   0 root         (0) root         (0)     6979 2021-11-10 06:33:56.000000 pyskynet-0.2.0/3rd/numsky/src/numsky/ufunc/ufunc_11.cpp
+-rw-r--r--   0 root         (0) root         (0)    15782 2021-11-10 06:33:56.000000 pyskynet-0.2.0/3rd/numsky/src/numsky/ufunc/ufunc_21.cpp
+-rw-r--r--   0 root         (0) root         (0)     8065 2021-11-10 06:33:56.000000 pyskynet-0.2.0/3rd/numsky/src/numsky/ufunc/ufunc_oper.cpp
+-rw-r--r--   0 root         (0) root         (0)     4871 2021-11-10 06:33:56.000000 pyskynet-0.2.0/3rd/numsky/src/numsky/ufunc/ufunc_reduce.cpp
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:42.000000 pyskynet-0.2.0/3rd/numsky/src/skynet_foreign/
+-rw-r--r--   0 root         (0) root         (0)      775 2023-06-12 13:57:38.000000 pyskynet-0.2.0/3rd/numsky/src/skynet_foreign/hook_pyskynet.h
+-rw-r--r--   0 root         (0) root         (0)      700 2021-09-29 08:06:28.000000 pyskynet-0.2.0/3rd/numsky/src/skynet_foreign/numsky.c
+-rw-r--r--   0 root         (0) root         (0)     4517 2021-11-10 06:33:56.000000 pyskynet-0.2.0/3rd/numsky/src/skynet_foreign/numsky.h
+-rw-r--r--   0 root         (0) root         (0)     4234 2023-06-12 13:57:38.000000 pyskynet-0.2.0/3rd/numsky/src/skynet_foreign/numsky_dtype.c
+-rw-r--r--   0 root         (0) root         (0)      418 2021-09-29 08:06:28.000000 pyskynet-0.2.0/3rd/numsky/src/skynet_foreign/numsky_nditer.c
+-rw-r--r--   0 root         (0) root         (0)      857 2023-06-12 13:57:38.000000 pyskynet-0.2.0/3rd/numsky/src/skynet_foreign/skynet_foreign.c
+-rw-r--r--   0 root         (0) root         (0)     1483 2023-06-12 13:57:38.000000 pyskynet-0.2.0/3rd/numsky/src/skynet_foreign/skynet_foreign.h
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:42.000000 pyskynet-0.2.0/3rd/rapidxml/
+-rw-r--r--   0 root         (0) root         (0)      106 2021-09-29 08:06:28.000000 pyskynet-0.2.0/3rd/rapidxml/Makefile
+-rw-r--r--   0 root         (0) root         (0)     2804 2021-09-29 08:06:28.000000 pyskynet-0.2.0/3rd/rapidxml/license.txt
+-rw-r--r--   0 root         (0) root         (0)     2511 2021-09-29 08:06:28.000000 pyskynet-0.2.0/3rd/rapidxml/lua-rapidxml.cpp
+-rw-r--r--   0 root         (0) root         (0)   120937 2021-09-29 08:06:28.000000 pyskynet-0.2.0/3rd/rapidxml/rapidxml.hpp
+-rw-r--r--   0 root         (0) root         (0)     4092 2021-09-29 08:06:28.000000 pyskynet-0.2.0/3rd/rapidxml/rapidxml_iterators.hpp
+-rw-r--r--   0 root         (0) root         (0)    16092 2021-09-29 08:06:28.000000 pyskynet-0.2.0/3rd/rapidxml/rapidxml_print.hpp
+-rw-r--r--   0 root         (0) root         (0)     3539 2021-09-29 08:06:28.000000 pyskynet-0.2.0/3rd/rapidxml/rapidxml_utils.hpp
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:42.000000 pyskynet-0.2.0/3rd/unqlite/
+-rw-r--r--   0 root         (0) root         (0)       39 2021-09-29 08:11:49.000000 pyskynet-0.2.0/3rd/unqlite/.git
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:42.000000 pyskynet-0.2.0/3rd/unqlite/.github/
+-rw-r--r--   0 root         (0) root         (0)      720 2021-09-29 08:11:53.000000 pyskynet-0.2.0/3rd/unqlite/.github/FUNDING.yml
+-rw-r--r--   0 root         (0) root         (0)      104 2021-09-29 08:11:53.000000 pyskynet-0.2.0/3rd/unqlite/.gitignore
+-rw-r--r--   0 root         (0) root         (0)      317 2021-09-29 08:11:53.000000 pyskynet-0.2.0/3rd/unqlite/.gitlab-ci.yml
+-rw-r--r--   0 root         (0) root         (0)      522 2021-09-29 08:11:53.000000 pyskynet-0.2.0/3rd/unqlite/.travis.yml
+-rw-r--r--   0 root         (0) root         (0)      567 2021-09-29 08:11:53.000000 pyskynet-0.2.0/3rd/unqlite/CHANGELOG.md
+-rw-r--r--   0 root         (0) root         (0)      964 2021-09-29 08:11:53.000000 pyskynet-0.2.0/3rd/unqlite/CMakeLists.txt
+-rw-r--r--   0 root         (0) root         (0)     1441 2021-09-29 08:11:53.000000 pyskynet-0.2.0/3rd/unqlite/LICENSE
+-rw-r--r--   0 root         (0) root         (0)     3235 2021-09-29 08:11:53.000000 pyskynet-0.2.0/3rd/unqlite/README.md
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:42.000000 pyskynet-0.2.0/3rd/unqlite/example/
+-rw-r--r--   0 root         (0) root         (0)     7175 2021-09-29 08:11:53.000000 pyskynet-0.2.0/3rd/unqlite/example/1.c
+-rw-r--r--   0 root         (0) root         (0)     9404 2021-09-29 08:11:53.000000 pyskynet-0.2.0/3rd/unqlite/example/2.c
+-rw-r--r--   0 root         (0) root         (0)     7217 2021-09-29 08:11:53.000000 pyskynet-0.2.0/3rd/unqlite/example/3.c
+-rw-r--r--   0 root         (0) root         (0)     8406 2021-09-29 08:11:53.000000 pyskynet-0.2.0/3rd/unqlite/example/4.c
+-rw-r--r--   0 root         (0) root         (0)    21105 2021-09-29 08:11:53.000000 pyskynet-0.2.0/3rd/unqlite/example/5.c
+-rw-r--r--   0 root         (0) root         (0)    10810 2021-09-29 08:11:53.000000 pyskynet-0.2.0/3rd/unqlite/example/6.c
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:42.000000 pyskynet-0.2.0/3rd/unqlite/example/demovfs/
+-rw-r--r--   0 root         (0) root         (0)    21679 2021-09-29 08:11:53.000000 pyskynet-0.2.0/3rd/unqlite/example/demovfs/unqlite_demovfs.c
+-rw-r--r--   0 root         (0) root         (0)     7679 2021-09-29 08:11:53.000000 pyskynet-0.2.0/3rd/unqlite/example/unqlite_huge.c
+-rw-r--r--   0 root         (0) root         (0)    10146 2021-09-29 08:11:53.000000 pyskynet-0.2.0/3rd/unqlite/example/unqlite_mp3.c
+-rw-r--r--   0 root         (0) root         (0)     7656 2021-09-29 08:11:53.000000 pyskynet-0.2.0/3rd/unqlite/example/unqlite_tar.c
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:42.000000 pyskynet-0.2.0/3rd/unqlite/src/
+-rw-r--r--   0 root         (0) root         (0)    90721 2021-09-29 08:11:53.000000 pyskynet-0.2.0/3rd/unqlite/src/api.c
+-rw-r--r--   0 root         (0) root         (0)     5384 2021-09-29 08:11:53.000000 pyskynet-0.2.0/3rd/unqlite/src/bitvec.c
+-rw-r--r--   0 root         (0) root         (0)    10352 2021-09-29 08:11:53.000000 pyskynet-0.2.0/3rd/unqlite/src/fastjson.c
+-rw-r--r--   0 root         (0) root         (0)    28083 2021-09-29 08:11:53.000000 pyskynet-0.2.0/3rd/unqlite/src/jx9.h
+-rw-r--r--   0 root         (0) root         (0)    78173 2021-09-29 08:11:53.000000 pyskynet-0.2.0/3rd/unqlite/src/jx9Int.h
+-rw-r--r--   0 root         (0) root         (0)    54147 2021-09-29 08:11:53.000000 pyskynet-0.2.0/3rd/unqlite/src/jx9_api.c
+-rw-r--r--   0 root         (0) root         (0)   239237 2021-09-29 08:11:53.000000 pyskynet-0.2.0/3rd/unqlite/src/jx9_builtin.c
+-rw-r--r--   0 root         (0) root         (0)   124352 2021-09-29 08:11:53.000000 pyskynet-0.2.0/3rd/unqlite/src/jx9_compile.c
+-rw-r--r--   0 root         (0) root         (0)    36179 2021-09-29 08:11:53.000000 pyskynet-0.2.0/3rd/unqlite/src/jx9_const.c
+-rw-r--r--   0 root         (0) root         (0)    84873 2021-09-29 08:11:53.000000 pyskynet-0.2.0/3rd/unqlite/src/jx9_hashmap.c
+-rw-r--r--   0 root         (0) root         (0)    24591 2021-09-29 08:11:53.000000 pyskynet-0.2.0/3rd/unqlite/src/jx9_json.c
+-rw-r--r--   0 root         (0) root         (0)    25417 2021-09-29 08:11:53.000000 pyskynet-0.2.0/3rd/unqlite/src/jx9_lex.c
+-rw-r--r--   0 root         (0) root         (0)   133653 2021-09-29 08:11:53.000000 pyskynet-0.2.0/3rd/unqlite/src/jx9_lib.c
+-rw-r--r--   0 root         (0) root         (0)     2469 2021-09-29 08:11:53.000000 pyskynet-0.2.0/3rd/unqlite/src/jx9_license.txt
+-rw-r--r--   0 root         (0) root         (0)    34926 2021-09-29 08:11:53.000000 pyskynet-0.2.0/3rd/unqlite/src/jx9_memobj.c
+-rw-r--r--   0 root         (0) root         (0)    42637 2021-09-29 08:11:53.000000 pyskynet-0.2.0/3rd/unqlite/src/jx9_parse.c
+-rw-r--r--   0 root         (0) root         (0)   250161 2021-09-29 08:11:53.000000 pyskynet-0.2.0/3rd/unqlite/src/jx9_vfs.c
+-rw-r--r--   0 root         (0) root         (0)   213326 2021-09-29 08:11:53.000000 pyskynet-0.2.0/3rd/unqlite/src/jx9_vm.c
+-rw-r--r--   0 root         (0) root         (0)    86569 2021-09-29 08:11:53.000000 pyskynet-0.2.0/3rd/unqlite/src/lhash_kv.c
+-rw-r--r--   0 root         (0) root         (0)     1412 2021-09-29 08:11:53.000000 pyskynet-0.2.0/3rd/unqlite/src/license.txt
+-rw-r--r--   0 root         (0) root         (0)    19056 2021-09-29 08:11:53.000000 pyskynet-0.2.0/3rd/unqlite/src/mem_kv.c
+-rw-r--r--   0 root         (0) root         (0)     3465 2021-09-29 08:11:53.000000 pyskynet-0.2.0/3rd/unqlite/src/os.c
+-rw-r--r--   0 root         (0) root         (0)    58896 2021-09-29 08:11:53.000000 pyskynet-0.2.0/3rd/unqlite/src/os_unix.c
+-rw-r--r--   0 root         (0) root         (0)    29005 2021-09-29 08:11:53.000000 pyskynet-0.2.0/3rd/unqlite/src/os_win.c
+-rw-r--r--   0 root         (0) root         (0)    89463 2021-09-29 08:11:53.000000 pyskynet-0.2.0/3rd/unqlite/src/pager.c
+-rw-r--r--   0 root         (0) root         (0)    48861 2021-09-29 08:11:53.000000 pyskynet-0.2.0/3rd/unqlite/src/unqlite.h
+-rw-r--r--   0 root         (0) root         (0)    14227 2021-09-29 08:11:53.000000 pyskynet-0.2.0/3rd/unqlite/src/unqliteInt.h
+-rw-r--r--   0 root         (0) root         (0)    29992 2021-09-29 08:11:53.000000 pyskynet-0.2.0/3rd/unqlite/src/unqlite_jx9.c
+-rw-r--r--   0 root         (0) root         (0)    29383 2021-09-29 08:11:53.000000 pyskynet-0.2.0/3rd/unqlite/src/unqlite_vm.c
+-rw-r--r--   0 root         (0) root         (0)  1954992 2021-09-29 08:11:53.000000 pyskynet-0.2.0/3rd/unqlite/unqlite.c
+-rw-r--r--   0 root         (0) root         (0)    48708 2021-09-29 08:11:53.000000 pyskynet-0.2.0/3rd/unqlite/unqlite.h
+-rw-r--r--   0 root         (0) root         (0)     4621 2021-09-29 08:11:53.000000 pyskynet-0.2.0/3rd/unqlite/update-md5.py
+-rw-r--r--   0 root         (0) root         (0)     1071 2021-09-29 08:06:28.000000 pyskynet-0.2.0/LICENSE
+-rw-r--r--   0 root         (0) root         (0)      613 2021-11-10 06:33:56.000000 pyskynet-0.2.0/MANIFEST.in
+-rw-r--r--   0 root         (0) root         (0)      296 2023-08-07 03:14:43.000000 pyskynet-0.2.0/PKG-INFO
+-rw-r--r--   0 root         (0) root         (0)     1310 2023-06-12 13:57:57.000000 pyskynet-0.2.0/README.md
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:42.000000 pyskynet-0.2.0/pyskynet/
+-rw-r--r--   0 root         (0) root         (0)     2925 2023-08-07 02:12:04.000000 pyskynet-0.2.0/pyskynet/__init__.py
+-rw-r--r--   0 root         (0) root         (0)     5198 2023-06-12 13:58:03.000000 pyskynet-0.2.0/pyskynet/boot.py
+-rw-r--r--   0 root         (0) root         (0)     1993 2023-06-12 13:57:38.000000 pyskynet-0.2.0/pyskynet/cluster.py
+-rw-r--r--   0 root         (0) root         (0)     2859 2023-06-12 13:57:38.000000 pyskynet-0.2.0/pyskynet/foreign.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:42.000000 pyskynet-0.2.0/pyskynet/lualib/
+-rw-r--r--   0 root         (0) root         (0)       34 2023-06-12 13:58:03.000000 pyskynet-0.2.0/pyskynet/lualib/numsky.d.thlua
+-rw-r--r--   0 root         (0) root         (0)    34696 2021-09-29 08:06:28.000000 pyskynet-0.2.0/pyskynet/lualib/protoc.lua
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:42.000000 pyskynet-0.2.0/pyskynet/lualib/pyskynet/
+-rw-r--r--   0 root         (0) root         (0)     2423 2021-09-29 08:06:28.000000 pyskynet-0.2.0/pyskynet/lualib/pyskynet/cluster.lua
+-rw-r--r--   0 root         (0) root         (0)     1955 2023-06-12 13:58:03.000000 pyskynet-0.2.0/pyskynet/lualib/pyskynet/foreign.thlua
+-rw-r--r--   0 root         (0) root         (0)      636 2023-06-12 13:58:03.000000 pyskynet-0.2.0/pyskynet/lualib/pyskynet/foreign_seri.d.thlua
+-rw-r--r--   0 root         (0) root         (0)      418 2023-08-07 02:12:04.000000 pyskynet-0.2.0/pyskynet/lualib/pyskynet/modify.d.thlua
+-rw-r--r--   0 root         (0) root         (0)     2379 2021-09-29 08:06:28.000000 pyskynet-0.2.0/pyskynet/lualib/pyskynet/utils.lua
+-rw-r--r--   0 root         (0) root         (0)     1636 2023-08-07 02:12:04.000000 pyskynet-0.2.0/pyskynet/lualib/pyskynet.thlua
+-rw-r--r--   0 root         (0) root         (0)      741 2023-06-12 13:58:03.000000 pyskynet-0.2.0/pyskynet/lualib/skynet.d.thlua
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:42.000000 pyskynet-0.2.0/pyskynet/service/
+-rw-r--r--   0 root         (0) root         (0)      454 2021-11-10 06:33:56.000000 pyskynet-0.2.0/pyskynet/service/canvas_service.lua
+-rw-r--r--   0 root         (0) root         (0)     3531 2021-09-29 08:06:28.000000 pyskynet-0.2.0/pyskynet/service/foreign_clusteragent.lua
+-rw-r--r--   0 root         (0) root         (0)     5753 2021-09-29 08:06:28.000000 pyskynet-0.2.0/pyskynet/service/foreign_clusterd.lua
+-rw-r--r--   0 root         (0) root         (0)      493 2023-08-07 03:14:31.000000 pyskynet-0.2.0/pyskynet/service/script_service.lua
+-rw-r--r--   0 root         (0) root         (0)     3127 2023-06-12 13:58:03.000000 pyskynet-0.2.0/pyskynet/service/skynet_py_boot.lua
+-rw-r--r--   0 root         (0) root         (0)     2534 2021-09-29 08:06:28.000000 pyskynet-0.2.0/pyskynet/service/skynet_py_logger.lua
+-rw-r--r--   0 root         (0) root         (0)     6155 2023-06-12 13:57:38.000000 pyskynet-0.2.0/pyskynet/skynet.py
+-rw-r--r--   0 root         (0) root         (0)    27753 2023-08-07 03:14:31.000000 pyskynet-0.2.0/pyskynet/thlua_loader.lua
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:42.000000 pyskynet-0.2.0/pyskynet.egg-info/
+-rw-r--r--   0 root         (0) root         (0)      296 2023-08-07 03:14:40.000000 pyskynet-0.2.0/pyskynet.egg-info/PKG-INFO
+-rw-r--r--   0 root         (0) root         (0)    27309 2023-08-07 03:14:41.000000 pyskynet-0.2.0/pyskynet.egg-info/SOURCES.txt
+-rw-r--r--   0 root         (0) root         (0)        1 2023-08-07 03:14:40.000000 pyskynet-0.2.0/pyskynet.egg-info/dependency_links.txt
+-rw-r--r--   0 root         (0) root         (0)       48 2023-08-07 03:14:40.000000 pyskynet-0.2.0/pyskynet.egg-info/entry_points.txt
+-rw-r--r--   0 root         (0) root         (0)        1 2023-08-07 02:15:39.000000 pyskynet-0.2.0/pyskynet.egg-info/not-zip-safe
+-rw-r--r--   0 root         (0) root         (0)       34 2023-08-07 03:14:40.000000 pyskynet-0.2.0/pyskynet.egg-info/requires.txt
+-rw-r--r--   0 root         (0) root         (0)       16 2023-08-07 03:14:40.000000 pyskynet-0.2.0/pyskynet.egg-info/top_level.txt
+-rw-r--r--   0 root         (0) root         (0)       38 2023-08-07 03:14:43.000000 pyskynet-0.2.0/setup.cfg
+-rw-r--r--   0 root         (0) root         (0)     6837 2023-06-12 13:58:03.000000 pyskynet-0.2.0/setup.py
+-rw-r--r--   0 root         (0) root         (0)     5724 2023-06-12 13:57:38.000000 pyskynet-0.2.0/setup_ext.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:41.000000 pyskynet-0.2.0/skynet/
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:41.000000 pyskynet-0.2.0/skynet/3rd/
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:42.000000 pyskynet-0.2.0/skynet/3rd/lpeg/
+-rw-r--r--   0 root         (0) root         (0)     3165 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lpeg/HISTORY
+-rw-r--r--   0 root         (0) root         (0)    15957 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lpeg/lpcap.c
+-rw-r--r--   0 root         (0) root         (0)     1694 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lpeg/lpcap.h
+-rw-r--r--   0 root         (0) root         (0)    31666 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lpeg/lpcode.c
+-rw-r--r--   0 root         (0) root         (0)      783 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lpeg/lpcode.h
+-rw-r--r--   0 root         (0) root         (0)     4923 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lpeg/lpeg-128.gif
+-rw-r--r--   0 root         (0) root         (0)    43349 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lpeg/lpeg.html
+-rw-r--r--   0 root         (0) root         (0)     5668 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lpeg/lpprint.c
+-rw-r--r--   0 root         (0) root         (0)      731 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lpeg/lpprint.h
+-rw-r--r--   0 root         (0) root         (0)    36573 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lpeg/lptree.c
+-rw-r--r--   0 root         (0) root         (0)     1976 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lpeg/lptree.h
+-rw-r--r--   0 root         (0) root         (0)     2976 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lpeg/lptypes.h
+-rw-r--r--   0 root         (0) root         (0)    11085 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lpeg/lpvm.c
+-rw-r--r--   0 root         (0) root         (0)     1646 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lpeg/lpvm.h
+-rw-r--r--   0 root         (0) root         (0)     1124 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lpeg/makefile
+-rw-r--r--   0 root         (0) root         (0)    14838 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lpeg/re.html
+-rw-r--r--   0 root         (0) root         (0)     6286 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lpeg/re.lua
+-rwxr-xr-x   0 root         (0) root         (0)    45895 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lpeg/test.lua
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:42.000000 pyskynet-0.2.0/skynet/3rd/lua/
+-rw-r--r--   0 root         (0) root         (0)     7525 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lua/Makefile
+-rw-r--r--   0 root         (0) root         (0)      293 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lua/README
+-rw-r--r--   0 root         (0) root         (0)      353 2023-04-05 05:43:59.000000 pyskynet-0.2.0/skynet/3rd/lua/build.sh
+-rw-r--r--   0 root         (0) root         (0)    36805 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lua/lapi.c
+-rw-r--r--   0 root         (0) root         (0)     1395 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lua/lapi.h
+-rw-r--r--   0 root         (0) root         (0)    36190 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lua/lauxlib.c
+-rw-r--r--   0 root         (0) root         (0)     9241 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lua/lauxlib.h
+-rw-r--r--   0 root         (0) root         (0)    14902 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lua/lbaselib.c
+-rw-r--r--   0 root         (0) root         (0)    51130 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lua/lcode.c
+-rw-r--r--   0 root         (0) root         (0)     3801 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lua/lcode.h
+-rw-r--r--   0 root         (0) root         (0)     4836 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lua/lcorolib.c
+-rw-r--r--   0 root         (0) root         (0)     2461 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lua/lctype.c
+-rw-r--r--   0 root         (0) root         (0)     2115 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lua/lctype.h
+-rw-r--r--   0 root         (0) root         (0)    13356 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lua/ldblib.c
+-rw-r--r--   0 root         (0) root         (0)    26604 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lua/ldebug.c
+-rw-r--r--   0 root         (0) root         (0)     2168 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lua/ldebug.h
+-rw-r--r--   0 root         (0) root         (0)    32454 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lua/ldo.c
+-rw-r--r--   0 root         (0) root         (0)     2926 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lua/ldo.h
+-rw-r--r--   0 root         (0) root         (0)     4771 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lua/ldump.c
+-rw-r--r--   0 root         (0) root         (0)     8853 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lua/lfunc.c
+-rw-r--r--   0 root         (0) root         (0)     1748 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lua/lfunc.h
+-rw-r--r--   0 root         (0) root         (0)    56327 2022-07-26 04:12:08.000000 pyskynet-0.2.0/skynet/3rd/lua/lgc.c
+-rw-r--r--   0 root         (0) root         (0)     6208 2022-07-26 04:12:08.000000 pyskynet-0.2.0/skynet/3rd/lua/lgc.h
+-rw-r--r--   0 root         (0) root         (0)  2176672 2021-09-29 08:14:02.000000 pyskynet-0.2.0/skynet/3rd/lua/liblua.a
+-rw-r--r--   0 root         (0) root         (0)     1621 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lua/linit.c
+-rw-r--r--   0 root         (0) root         (0)    22058 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lua/liolib.c
+-rw-r--r--   0 root         (0) root         (0)     1663 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lua/ljumptab.h
+-rw-r--r--   0 root         (0) root         (0)    17095 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lua/llex.c
+-rw-r--r--   0 root         (0) root         (0)     2402 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lua/llex.h
+-rw-r--r--   0 root         (0) root         (0)     8639 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lua/llimits.h
+-rw-r--r--   0 root         (0) root         (0)    18884 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lua/lmathlib.c
+-rw-r--r--   0 root         (0) root         (0)     5894 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lua/lmem.c
+-rw-r--r--   0 root         (0) root         (0)     3368 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lua/lmem.h
+-rw-r--r--   0 root         (0) root         (0)    23030 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lua/loadlib.c
+-rw-r--r--   0 root         (0) root         (0)    18890 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lua/lobject.c
+-rw-r--r--   0 root         (0) root         (0)    22458 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lua/lobject.h
+-rw-r--r--   0 root         (0) root         (0)     4126 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lua/lopcodes.c
+-rw-r--r--   0 root         (0) root         (0)    12716 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lua/lopcodes.h
+-rw-r--r--   0 root         (0) root         (0)     1143 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lua/lopnames.h
+-rw-r--r--   0 root         (0) root         (0)    11859 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lua/loslib.c
+-rw-r--r--   0 root         (0) root         (0)    56053 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lua/lparser.c
+-rw-r--r--   0 root         (0) root         (0)     5927 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lua/lparser.h
+-rw-r--r--   0 root         (0) root         (0)      828 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lua/lprefix.h
+-rw-r--r--   0 root         (0) root         (0)    11125 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lua/lstate.c
+-rw-r--r--   0 root         (0) root         (0)    15144 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lua/lstate.h
+-rw-r--r--   0 root         (0) root         (0)     8414 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lua/lstring.c
+-rw-r--r--   0 root         (0) root         (0)     1786 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lua/lstring.h
+-rw-r--r--   0 root         (0) root         (0)    54654 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lua/lstrlib.c
+-rw-r--r--   0 root         (0) root         (0)    31824 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lua/ltable.c
+-rw-r--r--   0 root         (0) root         (0)     2236 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lua/ltable.h
+-rw-r--r--   0 root         (0) root         (0)    13191 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lua/ltablib.c
+-rw-r--r--   0 root         (0) root         (0)     8218 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lua/ltm.c
+-rw-r--r--   0 root         (0) root         (0)     2907 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lua/ltm.h
+-rwxr-xr-x   0 root         (0) root         (0)  1247720 2021-09-29 08:14:02.000000 pyskynet-0.2.0/skynet/3rd/lua/lua
+-rw-r--r--   0 root         (0) root         (0)    19320 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lua/lua.c
+-rw-r--r--   0 root         (0) root         (0)    16068 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lua/lua.h
+-rw-r--r--   0 root         (0) root         (0)      191 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lua/lua.hpp
+-rwxr-xr-x   0 root         (0) root         (0)   930280 2021-09-29 08:14:03.000000 pyskynet-0.2.0/skynet/3rd/lua/luac
+-rw-r--r--   0 root         (0) root         (0)    15145 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lua/luac.c
+-rw-r--r--   0 root         (0) root         (0)    21511 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lua/luaconf.h
+-rw-r--r--   0 root         (0) root         (0)     1229 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lua/lualib.h
+-rw-r--r--   0 root         (0) root         (0)     7865 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lua/lundump.c
+-rw-r--r--   0 root         (0) root         (0)      863 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lua/lundump.h
+-rw-r--r--   0 root         (0) root         (0)     8093 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lua/lutf8lib.c
+-rw-r--r--   0 root         (0) root         (0)    57403 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lua/lvm.c
+-rw-r--r--   0 root         (0) root         (0)     4603 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lua/lvm.h
+-rw-r--r--   0 root         (0) root         (0)     1322 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lua/lzio.c
+-rw-r--r--   0 root         (0) root         (0)     1438 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lua/lzio.h
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:42.000000 pyskynet-0.2.0/skynet/3rd/lua/test/
+-rw-r--r--   0 root         (0) root         (0)      383 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/.gitignore
+-rw-r--r--   0 root         (0) root         (0)     6818 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/CHANGELOG.md
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:41.000000 pyskynet-0.2.0/skynet/3rd/lua/test/bin/
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:42.000000 pyskynet-0.2.0/skynet/3rd/lua/test/bin/encodings/
+-rw-r--r--   0 root         (0) root         (0)      368 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/bin/encodings/utf16be.json
+-rw-r--r--   0 root         (0) root         (0)      370 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/bin/encodings/utf16bebom.json
+-rw-r--r--   0 root         (0) root         (0)      368 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/bin/encodings/utf16le.json
+-rw-r--r--   0 root         (0) root         (0)      370 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/bin/encodings/utf16lebom.json
+-rw-r--r--   0 root         (0) root         (0)      736 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/bin/encodings/utf32be.json
+-rw-r--r--   0 root         (0) root         (0)      740 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/bin/encodings/utf32bebom.json
+-rw-r--r--   0 root         (0) root         (0)      736 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/bin/encodings/utf32le.json
+-rw-r--r--   0 root         (0) root         (0)      740 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/bin/encodings/utf32lebom.json
+-rw-r--r--   0 root         (0) root         (0)      322 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/bin/encodings/utf8.json
+-rw-r--r--   0 root         (0) root         (0)      325 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/bin/encodings/utf8bom.json
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:42.000000 pyskynet-0.2.0/skynet/3rd/lua/test/bin/jsonchecker/
+-rw-r--r--   0 root         (0) root         (0)       60 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/bin/jsonchecker/fail1.json
+-rw-r--r--   0 root         (0) root         (0)       58 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/bin/jsonchecker/fail10.json
+-rw-r--r--   0 root         (0) root         (0)       29 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/bin/jsonchecker/fail11.json
+-rw-r--r--   0 root         (0) root         (0)       31 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/bin/jsonchecker/fail12.json
+-rw-r--r--   0 root         (0) root         (0)       43 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/bin/jsonchecker/fail13.json
+-rw-r--r--   0 root         (0) root         (0)       31 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/bin/jsonchecker/fail14.json
+-rw-r--r--   0 root         (0) root         (0)       34 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/bin/jsonchecker/fail15.json
+-rw-r--r--   0 root         (0) root         (0)        8 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/bin/jsonchecker/fail16.json
+-rw-r--r--   0 root         (0) root         (0)       34 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/bin/jsonchecker/fail17.json
+-rw-r--r--   0 root         (0) root         (0)       50 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/bin/jsonchecker/fail18.json
+-rw-r--r--   0 root         (0) root         (0)       22 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/bin/jsonchecker/fail19.json
+-rw-r--r--   0 root         (0) root         (0)       17 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/bin/jsonchecker/fail2.json
+-rw-r--r--   0 root         (0) root         (0)       23 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/bin/jsonchecker/fail20.json
+-rw-r--r--   0 root         (0) root         (0)       32 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/bin/jsonchecker/fail21.json
+-rw-r--r--   0 root         (0) root         (0)       33 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/bin/jsonchecker/fail22.json
+-rw-r--r--   0 root         (0) root         (0)       20 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/bin/jsonchecker/fail23.json
+-rw-r--r--   0 root         (0) root         (0)       16 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/bin/jsonchecker/fail24.json
+-rw-r--r--   0 root         (0) root         (0)       29 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/bin/jsonchecker/fail25.json
+-rw-r--r--   0 root         (0) root         (0)       38 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/bin/jsonchecker/fail26.json
+-rw-r--r--   0 root         (0) root         (0)       14 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/bin/jsonchecker/fail27.json
+-rw-r--r--   0 root         (0) root         (0)       15 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/bin/jsonchecker/fail28.json
+-rw-r--r--   0 root         (0) root         (0)        4 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/bin/jsonchecker/fail29.json
+-rw-r--r--   0 root         (0) root         (0)       37 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/bin/jsonchecker/fail3.json
+-rw-r--r--   0 root         (0) root         (0)        5 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/bin/jsonchecker/fail30.json
+-rw-r--r--   0 root         (0) root         (0)        7 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/bin/jsonchecker/fail31.json
+-rw-r--r--   0 root         (0) root         (0)       40 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/bin/jsonchecker/fail32.json
+-rw-r--r--   0 root         (0) root         (0)       12 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/bin/jsonchecker/fail33.json
+-rw-r--r--   0 root         (0) root         (0)       16 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/bin/jsonchecker/fail4.json
+-rw-r--r--   0 root         (0) root         (0)       24 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/bin/jsonchecker/fail5.json
+-rw-r--r--   0 root         (0) root         (0)       26 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/bin/jsonchecker/fail6.json
+-rw-r--r--   0 root         (0) root         (0)       26 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/bin/jsonchecker/fail7.json
+-rw-r--r--   0 root         (0) root         (0)       16 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/bin/jsonchecker/fail8.json
+-rw-r--r--   0 root         (0) root         (0)       22 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/bin/jsonchecker/fail9.json
+-rw-r--r--   0 root         (0) root         (0)     1441 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/bin/jsonchecker/pass1.json
+-rw-r--r--   0 root         (0) root         (0)       52 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/bin/jsonchecker/pass2.json
+-rw-r--r--   0 root         (0) root         (0)      148 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/bin/jsonchecker/pass3.json
+-rw-r--r--   0 root         (0) root         (0)      173 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/bin/jsonchecker/readme.txt
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:42.000000 pyskynet-0.2.0/skynet/3rd/lua/test/bin/types/
+-rwxr-xr-x   0 root         (0) root         (0)      849 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/bin/types/booleans.json
+-rwxr-xr-x   0 root         (0) root         (0)     1698 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/bin/types/floats.json
+-rwxr-xr-x   0 root         (0) root         (0)     4202 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/bin/types/guids.json
+-rwxr-xr-x   0 root         (0) root         (0)     1098 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/bin/types/integers.json
+-rwxr-xr-x   0 root         (0) root         (0)    15142 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/bin/types/mixed.json
+-rwxr-xr-x   0 root         (0) root         (0)      802 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/bin/types/nulls.json
+-rwxr-xr-x   0 root         (0) root         (0)    33764 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/bin/types/paragraphs.json
+-rw-r--r--   0 root         (0) root         (0)       86 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/bin/types/readme.txt
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:41.000000 pyskynet-0.2.0/skynet/3rd/lua/test/include/
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:42.000000 pyskynet-0.2.0/skynet/3rd/lua/test/include/rapidjson/
+-rw-r--r--   0 root         (0) root         (0)    10675 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/include/rapidjson/allocators.h
+-rw-r--r--   0 root         (0) root         (0)     2281 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/include/rapidjson/cursorstreamwrapper.h
+-rw-r--r--   0 root         (0) root         (0)   121069 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/include/rapidjson/document.h
+-rw-r--r--   0 root         (0) root         (0)    10681 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/include/rapidjson/encodedstream.h
+-rw-r--r--   0 root         (0) root         (0)    29281 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/include/rapidjson/encodings.h
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:42.000000 pyskynet-0.2.0/skynet/3rd/lua/test/include/rapidjson/error/
+-rw-r--r--   0 root         (0) root         (0)     3870 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/include/rapidjson/error/en.h
+-rw-r--r--   0 root         (0) root         (0)     6213 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/include/rapidjson/error/error.h
+-rw-r--r--   0 root         (0) root         (0)     3001 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/include/rapidjson/filereadstream.h
+-rw-r--r--   0 root         (0) root         (0)     3146 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/include/rapidjson/filewritestream.h
+-rw-r--r--   0 root         (0) root         (0)     4034 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/include/rapidjson/fwd.h
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:42.000000 pyskynet-0.2.0/skynet/3rd/lua/test/include/rapidjson/internal/
+-rw-r--r--   0 root         (0) root         (0)     9143 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/include/rapidjson/internal/biginteger.h
+-rw-r--r--   0 root         (0) root         (0)     2018 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/include/rapidjson/internal/clzll.h
+-rw-r--r--   0 root         (0) root         (0)    11509 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/include/rapidjson/internal/diyfp.h
+-rw-r--r--   0 root         (0) root         (0)     8125 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/include/rapidjson/internal/dtoa.h
+-rw-r--r--   0 root         (0) root         (0)     2994 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/include/rapidjson/internal/ieee754.h
+-rw-r--r--   0 root         (0) root         (0)    10131 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/include/rapidjson/internal/itoa.h
+-rw-r--r--   0 root         (0) root         (0)     6641 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/include/rapidjson/internal/meta.h
+-rw-r--r--   0 root         (0) root         (0)     3595 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/include/rapidjson/internal/pow10.h
+-rw-r--r--   0 root         (0) root         (0)    26141 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/include/rapidjson/internal/regex.h
+-rw-r--r--   0 root         (0) root         (0)     7184 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/include/rapidjson/internal/stack.h
+-rw-r--r--   0 root         (0) root         (0)     2199 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/include/rapidjson/internal/strfunc.h
+-rw-r--r--   0 root         (0) root         (0)     8994 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/include/rapidjson/internal/strtod.h
+-rw-r--r--   0 root         (0) root         (0)     1419 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/include/rapidjson/internal/swap.h
+-rw-r--r--   0 root         (0) root         (0)     4082 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/include/rapidjson/istreamwrapper.h
+-rw-r--r--   0 root         (0) root         (0)     2560 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/include/rapidjson/memorybuffer.h
+-rw-r--r--   0 root         (0) root         (0)     2667 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/include/rapidjson/memorystream.h
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:42.000000 pyskynet-0.2.0/skynet/3rd/lua/test/include/rapidjson/msinttypes/
+-rw-r--r--   0 root         (0) root         (0)     8372 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/include/rapidjson/msinttypes/inttypes.h
+-rw-r--r--   0 root         (0) root         (0)     9386 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/include/rapidjson/msinttypes/stdint.h
+-rw-r--r--   0 root         (0) root         (0)     2331 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/include/rapidjson/ostreamwrapper.h
+-rw-r--r--   0 root         (0) root         (0)    60889 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/include/rapidjson/pointer.h
+-rw-r--r--   0 root         (0) root         (0)    10539 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/include/rapidjson/prettywriter.h
+-rw-r--r--   0 root         (0) root         (0)    23663 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/include/rapidjson/rapidjson.h
+-rw-r--r--   0 root         (0) root         (0)    93391 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/include/rapidjson/reader.h
+-rw-r--r--   0 root         (0) root         (0)   103633 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/include/rapidjson/schema.h
+-rw-r--r--   0 root         (0) root         (0)     6753 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/include/rapidjson/stream.h
+-rw-r--r--   0 root         (0) root         (0)     3993 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/include/rapidjson/stringbuffer.h
+-rw-r--r--   0 root         (0) root         (0)    26877 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/include/rapidjson/writer.h
+-rw-r--r--   0 root         (0) root         (0)     5152 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/license.txt
+-rw-r--r--   0 root         (0) root         (0)    11187 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/readme.md
+-rw-r--r--   0 root         (0) root         (0)     8815 2023-04-06 11:41:00.000000 pyskynet-0.2.0/skynet/3rd/lua/test/readme.zh-cn.md
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:42.000000 pyskynet-0.2.0/skynet/3rd/lua/test/src/
+-rw-r--r--   0 root         (0) root         (0)     3863 2023-04-06 11:41:09.000000 pyskynet-0.2.0/skynet/3rd/lua/test/src/Document.cpp
+-rw-r--r--   0 root         (0) root         (0)     2558 2023-04-06 11:41:09.000000 pyskynet-0.2.0/skynet/3rd/lua/test/src/Schema.cpp
+-rw-r--r--   0 root         (0) root         (0)     1439 2023-04-06 11:41:09.000000 pyskynet-0.2.0/skynet/3rd/lua/test/src/StringStream.hpp
+-rw-r--r--   0 root         (0) root         (0)     1988 2023-04-06 11:41:09.000000 pyskynet-0.2.0/skynet/3rd/lua/test/src/Userdata.hpp
+-rw-r--r--   0 root         (0) root         (0)      305 2023-04-06 11:41:09.000000 pyskynet-0.2.0/skynet/3rd/lua/test/src/file.hpp
+-rw-r--r--   0 root         (0) root         (0)     2202 2023-04-06 11:41:09.000000 pyskynet-0.2.0/skynet/3rd/lua/test/src/luax.hpp
+-rw-r--r--   0 root         (0) root         (0)     9848 2023-04-06 11:41:09.000000 pyskynet-0.2.0/skynet/3rd/lua/test/src/rapidjson.cpp
+-rw-r--r--   0 root         (0) root         (0)     3052 2023-04-06 11:41:09.000000 pyskynet-0.2.0/skynet/3rd/lua/test/src/values.cpp
+-rw-r--r--   0 root         (0) root         (0)     6617 2023-04-06 11:41:09.000000 pyskynet-0.2.0/skynet/3rd/lua/test/src/values.hpp
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:42.000000 pyskynet-0.2.0/skynet/3rd/lua-md5/
+-rw-r--r--   0 root         (0) root         (0)      369 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lua-md5/README
+-rw-r--r--   0 root         (0) root         (0)      706 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lua-md5/compat-5.2.c
+-rw-r--r--   0 root         (0) root         (0)      349 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lua-md5/compat-5.2.h
+-rw-r--r--   0 root         (0) root         (0)     6416 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lua-md5/md5.c
+-rw-r--r--   0 root         (0) root         (0)      305 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lua-md5/md5.h
+-rw-r--r--   0 root         (0) root         (0)     5335 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/3rd/lua-md5/md5lib.c
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:42.000000 pyskynet-0.2.0/skynet/lualib/
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:42.000000 pyskynet-0.2.0/skynet/lualib/compat10/
+-rw-r--r--   0 root         (0) root         (0)       31 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib/compat10/cluster.lua
+-rw-r--r--   0 root         (0) root         (0)       29 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib/compat10/crypt.lua
+-rw-r--r--   0 root         (0) root         (0)       34 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib/compat10/datacenter.lua
+-rw-r--r--   0 root         (0) root         (0)       27 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib/compat10/dns.lua
+-rw-r--r--   0 root         (0) root         (0)       30 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib/compat10/memory.lua
+-rw-r--r--   0 root         (0) root         (0)       32 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib/compat10/mongo.lua
+-rw-r--r--   0 root         (0) root         (0)       30 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib/compat10/mqueue.lua
+-rw-r--r--   0 root         (0) root         (0)       33 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib/compat10/multicast.lua
+-rw-r--r--   0 root         (0) root         (0)       32 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib/compat10/mysql.lua
+-rw-r--r--   0 root         (0) root         (0)       31 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib/compat10/netpack.lua
+-rw-r--r--   0 root         (0) root         (0)       31 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib/compat10/profile.lua
+-rw-r--r--   0 root         (0) root         (0)       32 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib/compat10/redis.lua
+-rw-r--r--   0 root         (0) root         (0)       33 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib/compat10/sharedata.lua
+-rw-r--r--   0 root         (0) root         (0)       32 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib/compat10/sharemap.lua
+-rw-r--r--   0 root         (0) root         (0)       28 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib/compat10/snax.lua
+-rw-r--r--   0 root         (0) root         (0)       30 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib/compat10/socket.lua
+-rw-r--r--   0 root         (0) root         (0)       37 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib/compat10/socketchannel.lua
+-rw-r--r--   0 root         (0) root         (0)       36 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib/compat10/socketdriver.lua
+-rw-r--r--   0 root         (0) root         (0)       27 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib/compat10/stm.lua
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:43.000000 pyskynet-0.2.0/skynet/lualib/http/
+-rw-r--r--   0 root         (0) root         (0)     4551 2022-07-26 04:12:08.000000 pyskynet-0.2.0/skynet/lualib/http/httpc.lua
+-rw-r--r--   0 root         (0) root         (0)     3688 2022-07-26 04:12:08.000000 pyskynet-0.2.0/skynet/lualib/http/httpd.lua
+-rw-r--r--   0 root         (0) root         (0)     7689 2022-07-26 04:12:08.000000 pyskynet-0.2.0/skynet/lualib/http/internal.lua
+-rw-r--r--   0 root         (0) root         (0)     1991 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib/http/sockethelper.lua
+-rw-r--r--   0 root         (0) root         (0)     2336 2022-07-26 04:12:08.000000 pyskynet-0.2.0/skynet/lualib/http/tlshelper.lua
+-rw-r--r--   0 root         (0) root         (0)      466 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib/http/url.lua
+-rwxr-xr-x   0 root         (0) root         (0)    15535 2022-07-26 04:12:08.000000 pyskynet-0.2.0/skynet/lualib/http/websocket.lua
+-rw-r--r--   0 root         (0) root         (0)     1017 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib/loader.lua
+-rw-r--r--   0 root         (0) root         (0)     1054 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib/md5.lua
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:43.000000 pyskynet-0.2.0/skynet/lualib/skynet/
+-rw-r--r--   0 root         (0) root         (0)     2752 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib/skynet/cluster.lua
+-rw-r--r--   0 root         (0) root         (0)     3123 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib/skynet/coroutine.lua
+-rw-r--r--   0 root         (0) root         (0)      343 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib/skynet/datacenter.lua
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:43.000000 pyskynet-0.2.0/skynet/lualib/skynet/datasheet/
+-rw-r--r--   0 root         (0) root         (0)     4493 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib/skynet/datasheet/builder.lua
+-rw-r--r--   0 root         (0) root         (0)     6547 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib/skynet/datasheet/dump.lua
+-rw-r--r--   0 root         (0) root         (0)     1487 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib/skynet/datasheet/init.lua
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:43.000000 pyskynet-0.2.0/skynet/lualib/skynet/db/
+-rw-r--r--   0 root         (0) root         (0)    17501 2022-07-26 04:12:08.000000 pyskynet-0.2.0/skynet/lualib/skynet/db/mongo.lua
+-rw-r--r--   0 root         (0) root         (0)    29437 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib/skynet/db/mysql.lua
+-rw-r--r--   0 root         (0) root         (0)     6860 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib/skynet/db/redis.lua
+-rw-r--r--   0 root         (0) root         (0)     3382 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib/skynet/debug.lua
+-rw-r--r--   0 root         (0) root         (0)    12001 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib/skynet/dns.lua
+-rw-r--r--   0 root         (0) root         (0)      528 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib/skynet/harbor.lua
+-rw-r--r--   0 root         (0) root         (0)     1445 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib/skynet/inject.lua
+-rw-r--r--   0 root         (0) root         (0)     2610 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib/skynet/injectcode.lua
+-rw-r--r--   0 root         (0) root         (0)     1986 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib/skynet/manager.lua
+-rw-r--r--   0 root         (0) root         (0)     1798 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib/skynet/mqueue.lua
+-rw-r--r--   0 root         (0) root         (0)     2190 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib/skynet/multicast.lua
+-rw-r--r--   0 root         (0) root         (0)      801 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib/skynet/queue.lua
+-rw-r--r--   0 root         (0) root         (0)     5651 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib/skynet/remotedebug.lua
+-rw-r--r--   0 root         (0) root         (0)     2555 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib/skynet/require.lua
+-rw-r--r--   0 root         (0) root         (0)      933 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib/skynet/service.lua
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:43.000000 pyskynet-0.2.0/skynet/lualib/skynet/sharedata/
+-rw-r--r--   0 root         (0) root         (0)     3313 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib/skynet/sharedata/corelib.lua
+-rw-r--r--   0 root         (0) root         (0)     1624 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib/skynet/sharedata.lua
+-rw-r--r--   0 root         (0) root         (0)     1503 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib/skynet/sharemap.lua
+-rw-r--r--   0 root         (0) root         (0)    10876 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib/skynet/sharetable.lua
+-rw-r--r--   0 root         (0) root         (0)     3697 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib/skynet/snax.lua
+-rw-r--r--   0 root         (0) root         (0)     9719 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib/skynet/socket.lua
+-rw-r--r--   0 root         (0) root         (0)    12823 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib/skynet/socketchannel.lua
+-rw-r--r--   0 root         (0) root         (0)    25533 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib/skynet.lua
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:43.000000 pyskynet-0.2.0/skynet/lualib/snax/
+-rw-r--r--   0 root         (0) root         (0)     3361 2022-07-26 04:12:08.000000 pyskynet-0.2.0/skynet/lualib/snax/gateserver.lua
+-rw-r--r--   0 root         (0) root         (0)     2420 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib/snax/hotfix.lua
+-rw-r--r--   0 root         (0) root         (0)     2040 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib/snax/interface.lua
+-rw-r--r--   0 root         (0) root         (0)     5318 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib/snax/loginserver.lua
+-rw-r--r--   0 root         (0) root         (0)     7404 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib/snax/msgserver.lua
+-rw-r--r--   0 root         (0) root         (0)     5663 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib/sproto.lua
+-rw-r--r--   0 root         (0) root         (0)      576 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib/sprotoloader.lua
+-rw-r--r--   0 root         (0) root         (0)    12274 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib/sprotoparser.lua
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:42.000000 pyskynet-0.2.0/skynet/lualib-src/
+-rw-r--r--   0 root         (0) root         (0)     9405 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib-src/lsha1.c
+-rw-r--r--   0 root         (0) root         (0)    11938 2022-07-26 04:12:08.000000 pyskynet-0.2.0/skynet/lualib-src/ltls.c
+-rw-r--r--   0 root         (0) root         (0)    29843 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib-src/lua-bson.c
+-rw-r--r--   0 root         (0) root         (0)     4472 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib-src/lua-clientsocket.c
+-rw-r--r--   0 root         (0) root         (0)    13932 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib-src/lua-cluster.c
+-rw-r--r--   0 root         (0) root         (0)    28930 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib-src/lua-crypt.c
+-rw-r--r--   0 root         (0) root         (0)     8285 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib-src/lua-datasheet.c
+-rw-r--r--   0 root         (0) root         (0)     6306 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib-src/lua-debugchannel.c
+-rw-r--r--   0 root         (0) root         (0)     2035 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib-src/lua-memory.c
+-rw-r--r--   0 root         (0) root         (0)    11998 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib-src/lua-mongo.c
+-rw-r--r--   0 root         (0) root         (0)     3470 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib-src/lua-multicast.c
+-rw-r--r--   0 root         (0) root         (0)    10495 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib-src/lua-netpack.c
+-rw-r--r--   0 root         (0) root         (0)    12824 2022-07-26 04:12:08.000000 pyskynet-0.2.0/skynet/lualib-src/lua-seri.c
+-rw-r--r--   0 root         (0) root         (0)      141 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib-src/lua-seri.h
+-rw-r--r--   0 root         (0) root         (0)    16637 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib-src/lua-sharedata.c
+-rw-r--r--   0 root         (0) root         (0)     5846 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib-src/lua-sharetable.c
+-rw-r--r--   0 root         (0) root         (0)    11737 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib-src/lua-skynet.c
+-rw-r--r--   0 root         (0) root         (0)    19629 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib-src/lua-socket.c
+-rw-r--r--   0 root         (0) root         (0)     5417 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib-src/lua-stm.c
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:42.000000 pyskynet-0.2.0/skynet/lualib-src/sproto/
+-rw-r--r--   0 root         (0) root         (0)       49 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib-src/sproto/README
+-rw-r--r--   0 root         (0) root         (0)    14249 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib-src/sproto/README.md
+-rw-r--r--   0 root         (0) root         (0)    21067 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib-src/sproto/lsproto.c
+-rw-r--r--   0 root         (0) root         (0)      696 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib-src/sproto/msvcint.h
+-rw-r--r--   0 root         (0) root         (0)    29771 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib-src/sproto/sproto.c
+-rw-r--r--   0 root         (0) root         (0)     2032 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/lualib-src/sproto/sproto.h
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:43.000000 pyskynet-0.2.0/skynet/service/
+-rw-r--r--   0 root         (0) root         (0)     1280 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/service/bootstrap.lua
+-rw-r--r--   0 root         (0) root         (0)     1797 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/service/cdummy.lua
+-rw-r--r--   0 root         (0) root         (0)     3455 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/service/clusteragent.lua
+-rw-r--r--   0 root         (0) root         (0)     5985 2022-07-26 04:12:08.000000 pyskynet-0.2.0/skynet/service/clusterd.lua
+-rw-r--r--   0 root         (0) root         (0)      930 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/service/clusterproxy.lua
+-rw-r--r--   0 root         (0) root         (0)     2156 2022-07-26 04:12:08.000000 pyskynet-0.2.0/skynet/service/clustersender.lua
+-rw-r--r--   0 root         (0) root         (0)     3263 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/service/cmaster.lua
+-rw-r--r--   0 root         (0) root         (0)      329 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/service/cmemory.lua
+-rw-r--r--   0 root         (0) root         (0)      677 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/service/console.lua
+-rw-r--r--   0 root         (0) root         (0)     6688 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/service/cslave.lua
+-rw-r--r--   0 root         (0) root         (0)     1949 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/service/datacenterd.lua
+-rw-r--r--   0 root         (0) root         (0)      808 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/service/dbg.lua
+-rw-r--r--   0 root         (0) root         (0)      746 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/service/debug_agent.lua
+-rw-r--r--   0 root         (0) root         (0)    11179 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/service/debug_console.lua
+-rw-r--r--   0 root         (0) root         (0)     2079 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/service/gate.lua
+-rw-r--r--   0 root         (0) root         (0)     4124 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/service/launcher.lua
+-rw-r--r--   0 root         (0) root         (0)     5618 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/service/multicastd.lua
+-rw-r--r--   0 root         (0) root         (0)      489 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/service/service_cell.lua
+-rw-r--r--   0 root         (0) root         (0)     4834 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/service/service_mgr.lua
+-rw-r--r--   0 root         (0) root         (0)     2242 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/service/service_provider.lua
+-rw-r--r--   0 root         (0) root         (0)     3384 2022-07-26 04:12:08.000000 pyskynet-0.2.0/skynet/service/sharedatad.lua
+-rw-r--r--   0 root         (0) root         (0)     2244 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/service/snaxd.lua
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:43.000000 pyskynet-0.2.0/skynet/service-src/
+-rw-r--r--   0 root         (0) root         (0)     3216 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/service-src/databuffer.h
+-rw-r--r--   0 root         (0) root         (0)     2080 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/service-src/hashid.h
+-rw-r--r--   0 root         (0) root         (0)     9662 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/service-src/service_gate.c
+-rw-r--r--   0 root         (0) root         (0)    18864 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/service-src/service_harbor.c
+-rw-r--r--   0 root         (0) root         (0)     1942 2022-07-26 04:12:08.000000 pyskynet-0.2.0/skynet/service-src/service_logger.c
+-rw-r--r--   0 root         (0) root         (0)    12860 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/service-src/service_snlua.c
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:43.000000 pyskynet-0.2.0/skynet/skynet-src/
+-rw-r--r--   0 root         (0) root         (0)     1523 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/skynet-src/atomic.h
+-rw-r--r--   0 root         (0) root         (0)     7784 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/skynet-src/malloc_hook.c
+-rw-r--r--   0 root         (0) root         (0)      628 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/skynet-src/malloc_hook.h
+-rw-r--r--   0 root         (0) root         (0)     1472 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/skynet-src/rwlock.h
+-rw-r--r--   0 root         (0) root         (0)     1633 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/skynet-src/skynet.h
+-rw-r--r--   0 root         (0) root         (0)     2172 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/skynet-src/skynet_daemon.c
+-rw-r--r--   0 root         (0) root         (0)      133 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/skynet-src/skynet_daemon.h
+-rw-r--r--   0 root         (0) root         (0)      782 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/skynet-src/skynet_env.c
+-rw-r--r--   0 root         (0) root         (0)      177 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/skynet-src/skynet_env.h
+-rw-r--r--   0 root         (0) root         (0)     1253 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/skynet-src/skynet_error.c
+-rw-r--r--   0 root         (0) root         (0)     5399 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/skynet-src/skynet_handle.c
+-rw-r--r--   0 root         (0) root         (0)      575 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/skynet-src/skynet_handle.h
+-rw-r--r--   0 root         (0) root         (0)     1163 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/skynet-src/skynet_harbor.c
+-rw-r--r--   0 root         (0) root         (0)      571 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/skynet-src/skynet_harbor.h
+-rw-r--r--   0 root         (0) root         (0)      409 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/skynet-src/skynet_imp.h
+-rw-r--r--   0 root         (0) root         (0)     1967 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/skynet-src/skynet_log.c
+-rw-r--r--   0 root         (0) root         (0)      382 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/skynet-src/skynet_log.h
+-rw-r--r--   0 root         (0) root         (0)     3955 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/skynet-src/skynet_main.c
+-rw-r--r--   0 root         (0) root         (0)      774 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/skynet-src/skynet_malloc.h
+-rw-r--r--   0 root         (0) root         (0)     3589 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/skynet-src/skynet_module.c
+-rw-r--r--   0 root         (0) root         (0)      981 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/skynet-src/skynet_module.h
+-rw-r--r--   0 root         (0) root         (0)     1046 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/skynet-src/skynet_monitor.c
+-rw-r--r--   0 root         (0) root         (0)      348 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/skynet-src/skynet_monitor.h
+-rw-r--r--   0 root         (0) root         (0)     4632 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/skynet-src/skynet_mq.c
+-rw-r--r--   0 root         (0) root         (0)     1128 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/skynet-src/skynet_mq.h
+-rw-r--r--   0 root         (0) root         (0)    20172 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/skynet-src/skynet_server.c
+-rw-r--r--   0 root         (0) root         (0)     1206 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/skynet-src/skynet_server.h
+-rw-r--r--   0 root         (0) root         (0)     5278 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/skynet-src/skynet_socket.c
+-rw-r--r--   0 root         (0) root         (0)     2781 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/skynet-src/skynet_socket.h
+-rw-r--r--   0 root         (0) root         (0)     6145 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/skynet-src/skynet_start.c
+-rw-r--r--   0 root         (0) root         (0)     5839 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/skynet-src/skynet_timer.c
+-rw-r--r--   0 root         (0) root         (0)      297 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/skynet-src/skynet_timer.h
+-rw-r--r--   0 root         (0) root         (0)      259 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/skynet-src/socket_buffer.h
+-rw-r--r--   0 root         (0) root         (0)     1515 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/skynet-src/socket_epoll.h
+-rw-r--r--   0 root         (0) root         (0)      586 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/skynet-src/socket_info.h
+-rw-r--r--   0 root         (0) root         (0)     2319 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/skynet-src/socket_kqueue.h
+-rw-r--r--   0 root         (0) root         (0)      731 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/skynet-src/socket_poll.h
+-rw-r--r--   0 root         (0) root         (0)    57428 2022-07-26 04:12:08.000000 pyskynet-0.2.0/skynet/skynet-src/socket_server.c
+-rw-r--r--   0 root         (0) root         (0)     3111 2021-09-29 08:11:53.000000 pyskynet-0.2.0/skynet/skynet-src/socket_server.h
+-rw-r--r--   0 root         (0) root         (0)     2874 2022-07-26 04:12:08.000000 pyskynet-0.2.0/skynet/skynet-src/spinlock.h
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:41.000000 pyskynet-0.2.0/src/
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:43.000000 pyskynet-0.2.0/src/c_src/
+-rw-r--r--   0 root         (0) root         (0)     2557 2023-08-07 02:12:04.000000 pyskynet-0.2.0/src/c_src/lua-modify.c
+-rw-r--r--   0 root         (0) root         (0)    12304 2021-09-29 08:06:28.000000 pyskynet-0.2.0/src/c_src/lua-tflite.cpp
+-rw-r--r--   0 root         (0) root         (0)    12706 2021-11-10 06:33:56.000000 pyskynet-0.2.0/src/c_src/lua-unqlite.cpp
+-rw-r--r--   0 root         (0) root         (0)      936 2021-09-29 08:06:28.000000 pyskynet-0.2.0/src/c_src/service_pyholder.c
+-rw-r--r--   0 root         (0) root         (0)     2596 2023-06-12 13:57:38.000000 pyskynet-0.2.0/src/c_src/skynet_py_foreign_seri_ext.c
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:43.000000 pyskynet-0.2.0/src/cy_src/
+-rw-r--r--   0 root         (0) root         (0)     1788 2021-09-29 08:06:28.000000 pyskynet-0.2.0/src/cy_src/skynet_py.pxd
+-rw-r--r--   0 root         (0) root         (0)   569307 2023-08-07 02:15:41.000000 pyskynet-0.2.0/src/cy_src/skynet_py_foreign_seri.c
+-rw-r--r--   0 root         (0) root         (0)    10215 2023-06-12 13:57:38.000000 pyskynet-0.2.0/src/cy_src/skynet_py_foreign_seri.pyx
+-rw-r--r--   0 root         (0) root         (0)   356561 2023-08-07 03:14:41.000000 pyskynet-0.2.0/src/cy_src/skynet_py_main.c
+-rw-r--r--   0 root         (0) root         (0)     3565 2023-08-07 03:14:31.000000 pyskynet-0.2.0/src/cy_src/skynet_py_main.pyx
+-rw-r--r--   0 root         (0) root         (0)   438787 2023-08-07 03:14:41.000000 pyskynet-0.2.0/src/cy_src/skynet_py_mq.c
+-rw-r--r--   0 root         (0) root         (0)     5213 2023-08-07 03:14:31.000000 pyskynet-0.2.0/src/cy_src/skynet_py_mq.pyx
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:43.000000 pyskynet-0.2.0/src/skynet_modify/
+-rw-r--r--   0 root         (0) root         (0)     3297 2023-08-07 02:12:04.000000 pyskynet-0.2.0/src/skynet_modify/skynet_env_modify.c
+-rw-r--r--   0 root         (0) root         (0)     3469 2023-06-12 13:58:03.000000 pyskynet-0.2.0/src/skynet_modify/skynet_py.c
+-rw-r--r--   0 root         (0) root         (0)     2201 2023-08-07 02:12:04.000000 pyskynet-0.2.0/src/skynet_modify/skynet_py.h
+-rw-r--r--   0 root         (0) root         (0)     2985 2023-06-12 13:58:03.000000 pyskynet-0.2.0/src/skynet_modify/skynet_py_codecache.c
+-rw-r--r--   0 root         (0) root         (0)     1509 2023-06-12 13:58:03.000000 pyskynet-0.2.0/src/skynet_modify/skynet_py_scriptpool.c
+-rw-r--r--   0 root         (0) root         (0)    21330 2023-06-12 13:57:38.000000 pyskynet-0.2.0/src/skynet_modify/skynet_server_modify.c
+-rw-r--r--   0 root         (0) root         (0)     7543 2023-06-12 13:58:03.000000 pyskynet-0.2.0/src/skynet_modify/skynet_start_modify.c
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-08-07 03:14:43.000000 pyskynet-0.2.0/test/
+-rw-r--r--   0 root         (0) root         (0)      517 2021-09-29 08:06:28.000000 pyskynet-0.2.0/test/test_cluster.py
+-rw-r--r--   0 root         (0) root         (0)      474 2021-09-29 08:06:28.000000 pyskynet-0.2.0/test/test_env.py
+-rw-r--r--   0 root         (0) root         (0)      557 2021-09-29 08:06:28.000000 pyskynet-0.2.0/test/test_foreign.py
+-rw-r--r--   0 root         (0) root         (0)     1209 2021-09-29 08:06:28.000000 pyskynet-0.2.0/test/test_luacluster.py
+-rw-r--r--   0 root         (0) root         (0)     2818 2021-09-29 08:06:28.000000 pyskynet-0.2.0/test/test_seri.py
+-rw-r--r--   0 root         (0) root         (0)     2378 2021-09-29 08:06:28.000000 pyskynet-0.2.0/test/test_tinygl.py
```

### Comparing `pyskynet-0.1.5/pyskynet.egg-info/SOURCES.txt` & `pyskynet-0.2.0/pyskynet.egg-info/SOURCES.txt`

 * *Files 23% similar despite different names*

```diff
@@ -1,7 +1,8 @@
+LICENSE
 MANIFEST.in
 README.md
 setup.py
 setup_ext.py
 ./skynet/3rd/lua/lapi.c
 ./skynet/3rd/lua/lauxlib.c
 ./skynet/3rd/lua/lbaselib.c
@@ -39,15 +40,14 @@
 ./skynet/skynet-src/skynet_error.c
 ./skynet/skynet-src/skynet_handle.c
 ./skynet/skynet-src/skynet_harbor.c
 ./skynet/skynet-src/skynet_log.c
 ./skynet/skynet-src/skynet_module.c
 ./skynet/skynet-src/skynet_monitor.c
 ./skynet/skynet-src/skynet_mq.c
-./skynet/skynet-src/skynet_server.c
 ./skynet/skynet-src/skynet_socket.c
 ./skynet/skynet-src/skynet_timer.c
 ./skynet/skynet-src/socket_server.c
 3rd/TinyGL/LICENCE
 3rd/TinyGL/Makefile
 3rd/TinyGL/bitmap_image.hpp
 3rd/TinyGL/example.cpp
@@ -212,22 +212,20 @@
 3rd/lua-rapidjson/src/file.hpp
 3rd/lua-rapidjson/src/luax.hpp
 3rd/lua-rapidjson/src/rapidjson.cpp
 3rd/lua-rapidjson/src/values.cpp
 3rd/lua-rapidjson/src/values.hpp
 3rd/numsky/src/lua-binding.h
 3rd/numsky/src/lua-cluster.c
-3rd/numsky/src/lua-foreign_seri.c
-3rd/numsky/src/lua-serialize.c
-3rd/numsky/src/foreign_seri/LuaWriteBlock.cpp
-3rd/numsky/src/foreign_seri/LuaWriteBlock.h
-3rd/numsky/src/foreign_seri/ReadBlock.h
-3rd/numsky/src/foreign_seri/SeriMode.h
-3rd/numsky/src/foreign_seri/WriteBlock.h
-3rd/numsky/src/foreign_seri/lua-seri_v2.cpp
+3rd/numsky/src/foreign_seri/lua-foreign_seri.c
+3rd/numsky/src/foreign_seri/read_block.c
+3rd/numsky/src/foreign_seri/read_block.h
+3rd/numsky/src/foreign_seri/seri.h
+3rd/numsky/src/foreign_seri/write_block.c
+3rd/numsky/src/foreign_seri/write_block.h
 3rd/numsky/src/numsky/lua-numsky.cpp
 3rd/numsky/src/numsky/lua-numsky.h
 3rd/numsky/src/numsky/lua-numsky_dtype.cpp
 3rd/numsky/src/numsky/lua-numsky_export.cpp
 3rd/numsky/src/numsky/lua-numsky_name.cpp
 3rd/numsky/src/numsky/lua-numsky_nditer.cpp
 3rd/numsky/src/numsky/lua-numsky_slice.cpp
@@ -240,14 +238,16 @@
 3rd/numsky/src/numsky/canvas/CameraAstNode.h
 3rd/numsky/src/numsky/canvas/DefinedException.cpp
 3rd/numsky/src/numsky/canvas/DefinedException.h
 3rd/numsky/src/numsky/canvas/EvalContext.h
 3rd/numsky/src/numsky/canvas/ExpandControl.h
 3rd/numsky/src/numsky/canvas/IAstNode.cpp
 3rd/numsky/src/numsky/canvas/IAstNode.h
+3rd/numsky/src/numsky/canvas/LiteralParser.cpp
+3rd/numsky/src/numsky/canvas/LiteralParser.h
 3rd/numsky/src/numsky/canvas/LuaAstNode.cpp
 3rd/numsky/src/numsky/canvas/LuaAstNode.h
 3rd/numsky/src/numsky/canvas/ParseContext.cpp
 3rd/numsky/src/numsky/canvas/ParseContext.h
 3rd/numsky/src/numsky/canvas/TypeGuard.h
 3rd/numsky/src/numsky/canvas/ValNode.cpp
 3rd/numsky/src/numsky/canvas/ValNode.h
@@ -263,15 +263,15 @@
 3rd/numsky/src/numsky/tinygl/tinygl_mesh.cpp
 3rd/numsky/src/numsky/ufunc/lua-numsky_ufunc.cpp
 3rd/numsky/src/numsky/ufunc/lua-numsky_ufunc.h
 3rd/numsky/src/numsky/ufunc/ufunc_11.cpp
 3rd/numsky/src/numsky/ufunc/ufunc_21.cpp
 3rd/numsky/src/numsky/ufunc/ufunc_oper.cpp
 3rd/numsky/src/numsky/ufunc/ufunc_reduce.cpp
-3rd/numsky/src/skynet_foreign/hook_skynet_py.h
+3rd/numsky/src/skynet_foreign/hook_pyskynet.h
 3rd/numsky/src/skynet_foreign/numsky.c
 3rd/numsky/src/skynet_foreign/numsky.h
 3rd/numsky/src/skynet_foreign/numsky_dtype.c
 3rd/numsky/src/skynet_foreign/numsky_nditer.c
 3rd/numsky/src/skynet_foreign/skynet_foreign.c
 3rd/numsky/src/skynet_foreign/skynet_foreign.h
 3rd/rapidxml/Makefile
@@ -332,26 +332,31 @@
 3rd/unqlite/src/unqliteInt.h
 3rd/unqlite/src/unqlite_jx9.c
 3rd/unqlite/src/unqlite_vm.c
 pyskynet/__init__.py
 pyskynet/boot.py
 pyskynet/cluster.py
 pyskynet/foreign.py
-pyskynet/proto.py
+pyskynet/skynet.py
+pyskynet/thlua_loader.lua
 pyskynet.egg-info/PKG-INFO
 pyskynet.egg-info/SOURCES.txt
 pyskynet.egg-info/dependency_links.txt
 pyskynet.egg-info/entry_points.txt
 pyskynet.egg-info/not-zip-safe
 pyskynet.egg-info/requires.txt
 pyskynet.egg-info/top_level.txt
+pyskynet/lualib/numsky.d.thlua
 pyskynet/lualib/protoc.lua
-pyskynet/lualib/pyskynet.lua
+pyskynet/lualib/pyskynet.thlua
+pyskynet/lualib/skynet.d.thlua
 pyskynet/lualib/pyskynet/cluster.lua
-pyskynet/lualib/pyskynet/foreign.lua
+pyskynet/lualib/pyskynet/foreign.thlua
+pyskynet/lualib/pyskynet/foreign_seri.d.thlua
+pyskynet/lualib/pyskynet/modify.d.thlua
 pyskynet/lualib/pyskynet/utils.lua
 pyskynet/service/canvas_service.lua
 pyskynet/service/foreign_clusteragent.lua
 pyskynet/service/foreign_clusterd.lua
 pyskynet/service/script_service.lua
 pyskynet/service/skynet_py_boot.lua
 pyskynet/service/skynet_py_logger.lua
@@ -371,14 +376,15 @@
 skynet/3rd/lpeg/lpvm.h
 skynet/3rd/lpeg/makefile
 skynet/3rd/lpeg/re.html
 skynet/3rd/lpeg/re.lua
 skynet/3rd/lpeg/test.lua
 skynet/3rd/lua/Makefile
 skynet/3rd/lua/README
+skynet/3rd/lua/build.sh
 skynet/3rd/lua/lapi.c
 skynet/3rd/lua/lapi.h
 skynet/3rd/lua/lauxlib.c
 skynet/3rd/lua/lauxlib.h
 skynet/3rd/lua/lbaselib.c
 skynet/3rd/lua/lcode.c
 skynet/3rd/lua/lcode.h
@@ -442,14 +448,120 @@
 skynet/3rd/lua/lzio.h
 skynet/3rd/lua-md5/README
 skynet/3rd/lua-md5/compat-5.2.c
 skynet/3rd/lua-md5/compat-5.2.h
 skynet/3rd/lua-md5/md5.c
 skynet/3rd/lua-md5/md5.h
 skynet/3rd/lua-md5/md5lib.c
+skynet/3rd/lua/test/.gitignore
+skynet/3rd/lua/test/CHANGELOG.md
+skynet/3rd/lua/test/license.txt
+skynet/3rd/lua/test/readme.md
+skynet/3rd/lua/test/readme.zh-cn.md
+skynet/3rd/lua/test/bin/encodings/utf16be.json
+skynet/3rd/lua/test/bin/encodings/utf16bebom.json
+skynet/3rd/lua/test/bin/encodings/utf16le.json
+skynet/3rd/lua/test/bin/encodings/utf16lebom.json
+skynet/3rd/lua/test/bin/encodings/utf32be.json
+skynet/3rd/lua/test/bin/encodings/utf32bebom.json
+skynet/3rd/lua/test/bin/encodings/utf32le.json
+skynet/3rd/lua/test/bin/encodings/utf32lebom.json
+skynet/3rd/lua/test/bin/encodings/utf8.json
+skynet/3rd/lua/test/bin/encodings/utf8bom.json
+skynet/3rd/lua/test/bin/jsonchecker/fail1.json
+skynet/3rd/lua/test/bin/jsonchecker/fail10.json
+skynet/3rd/lua/test/bin/jsonchecker/fail11.json
+skynet/3rd/lua/test/bin/jsonchecker/fail12.json
+skynet/3rd/lua/test/bin/jsonchecker/fail13.json
+skynet/3rd/lua/test/bin/jsonchecker/fail14.json
+skynet/3rd/lua/test/bin/jsonchecker/fail15.json
+skynet/3rd/lua/test/bin/jsonchecker/fail16.json
+skynet/3rd/lua/test/bin/jsonchecker/fail17.json
+skynet/3rd/lua/test/bin/jsonchecker/fail18.json
+skynet/3rd/lua/test/bin/jsonchecker/fail19.json
+skynet/3rd/lua/test/bin/jsonchecker/fail2.json
+skynet/3rd/lua/test/bin/jsonchecker/fail20.json
+skynet/3rd/lua/test/bin/jsonchecker/fail21.json
+skynet/3rd/lua/test/bin/jsonchecker/fail22.json
+skynet/3rd/lua/test/bin/jsonchecker/fail23.json
+skynet/3rd/lua/test/bin/jsonchecker/fail24.json
+skynet/3rd/lua/test/bin/jsonchecker/fail25.json
+skynet/3rd/lua/test/bin/jsonchecker/fail26.json
+skynet/3rd/lua/test/bin/jsonchecker/fail27.json
+skynet/3rd/lua/test/bin/jsonchecker/fail28.json
+skynet/3rd/lua/test/bin/jsonchecker/fail29.json
+skynet/3rd/lua/test/bin/jsonchecker/fail3.json
+skynet/3rd/lua/test/bin/jsonchecker/fail30.json
+skynet/3rd/lua/test/bin/jsonchecker/fail31.json
+skynet/3rd/lua/test/bin/jsonchecker/fail32.json
+skynet/3rd/lua/test/bin/jsonchecker/fail33.json
+skynet/3rd/lua/test/bin/jsonchecker/fail4.json
+skynet/3rd/lua/test/bin/jsonchecker/fail5.json
+skynet/3rd/lua/test/bin/jsonchecker/fail6.json
+skynet/3rd/lua/test/bin/jsonchecker/fail7.json
+skynet/3rd/lua/test/bin/jsonchecker/fail8.json
+skynet/3rd/lua/test/bin/jsonchecker/fail9.json
+skynet/3rd/lua/test/bin/jsonchecker/pass1.json
+skynet/3rd/lua/test/bin/jsonchecker/pass2.json
+skynet/3rd/lua/test/bin/jsonchecker/pass3.json
+skynet/3rd/lua/test/bin/jsonchecker/readme.txt
+skynet/3rd/lua/test/bin/types/booleans.json
+skynet/3rd/lua/test/bin/types/floats.json
+skynet/3rd/lua/test/bin/types/guids.json
+skynet/3rd/lua/test/bin/types/integers.json
+skynet/3rd/lua/test/bin/types/mixed.json
+skynet/3rd/lua/test/bin/types/nulls.json
+skynet/3rd/lua/test/bin/types/paragraphs.json
+skynet/3rd/lua/test/bin/types/readme.txt
+skynet/3rd/lua/test/include/rapidjson/allocators.h
+skynet/3rd/lua/test/include/rapidjson/cursorstreamwrapper.h
+skynet/3rd/lua/test/include/rapidjson/document.h
+skynet/3rd/lua/test/include/rapidjson/encodedstream.h
+skynet/3rd/lua/test/include/rapidjson/encodings.h
+skynet/3rd/lua/test/include/rapidjson/filereadstream.h
+skynet/3rd/lua/test/include/rapidjson/filewritestream.h
+skynet/3rd/lua/test/include/rapidjson/fwd.h
+skynet/3rd/lua/test/include/rapidjson/istreamwrapper.h
+skynet/3rd/lua/test/include/rapidjson/memorybuffer.h
+skynet/3rd/lua/test/include/rapidjson/memorystream.h
+skynet/3rd/lua/test/include/rapidjson/ostreamwrapper.h
+skynet/3rd/lua/test/include/rapidjson/pointer.h
+skynet/3rd/lua/test/include/rapidjson/prettywriter.h
+skynet/3rd/lua/test/include/rapidjson/rapidjson.h
+skynet/3rd/lua/test/include/rapidjson/reader.h
+skynet/3rd/lua/test/include/rapidjson/schema.h
+skynet/3rd/lua/test/include/rapidjson/stream.h
+skynet/3rd/lua/test/include/rapidjson/stringbuffer.h
+skynet/3rd/lua/test/include/rapidjson/writer.h
+skynet/3rd/lua/test/include/rapidjson/error/en.h
+skynet/3rd/lua/test/include/rapidjson/error/error.h
+skynet/3rd/lua/test/include/rapidjson/internal/biginteger.h
+skynet/3rd/lua/test/include/rapidjson/internal/clzll.h
+skynet/3rd/lua/test/include/rapidjson/internal/diyfp.h
+skynet/3rd/lua/test/include/rapidjson/internal/dtoa.h
+skynet/3rd/lua/test/include/rapidjson/internal/ieee754.h
+skynet/3rd/lua/test/include/rapidjson/internal/itoa.h
+skynet/3rd/lua/test/include/rapidjson/internal/meta.h
+skynet/3rd/lua/test/include/rapidjson/internal/pow10.h
+skynet/3rd/lua/test/include/rapidjson/internal/regex.h
+skynet/3rd/lua/test/include/rapidjson/internal/stack.h
+skynet/3rd/lua/test/include/rapidjson/internal/strfunc.h
+skynet/3rd/lua/test/include/rapidjson/internal/strtod.h
+skynet/3rd/lua/test/include/rapidjson/internal/swap.h
+skynet/3rd/lua/test/include/rapidjson/msinttypes/inttypes.h
+skynet/3rd/lua/test/include/rapidjson/msinttypes/stdint.h
+skynet/3rd/lua/test/src/Document.cpp
+skynet/3rd/lua/test/src/Schema.cpp
+skynet/3rd/lua/test/src/StringStream.hpp
+skynet/3rd/lua/test/src/Userdata.hpp
+skynet/3rd/lua/test/src/file.hpp
+skynet/3rd/lua/test/src/luax.hpp
+skynet/3rd/lua/test/src/rapidjson.cpp
+skynet/3rd/lua/test/src/values.cpp
+skynet/3rd/lua/test/src/values.hpp
 skynet/lualib/loader.lua
 skynet/lualib/md5.lua
 skynet/lualib/skynet.lua
 skynet/lualib/sproto.lua
 skynet/lualib/sprotoloader.lua
 skynet/lualib/sprotoparser.lua
 skynet/lualib-src/lsha1.c
@@ -615,14 +727,17 @@
 src/cy_src/skynet_py_main.c
 src/cy_src/skynet_py_main.pyx
 src/cy_src/skynet_py_mq.c
 src/cy_src/skynet_py_mq.pyx
 src/skynet_modify/skynet_env_modify.c
 src/skynet_modify/skynet_py.c
 src/skynet_modify/skynet_py.h
+src/skynet_modify/skynet_py_codecache.c
+src/skynet_modify/skynet_py_scriptpool.c
+src/skynet_modify/skynet_server_modify.c
 src/skynet_modify/skynet_start_modify.c
 test/test_cluster.py
 test/test_env.py
 test/test_foreign.py
 test/test_luacluster.py
 test/test_seri.py
 test/test_tinygl.py
```

### Comparing `pyskynet-0.1.5/MANIFEST.in` & `pyskynet-0.2.0/MANIFEST.in`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/rapidxml/rapidxml_print.hpp` & `pyskynet-0.2.0/3rd/rapidxml/rapidxml_print.hpp`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/rapidxml/lua-rapidxml.cpp` & `pyskynet-0.2.0/3rd/rapidxml/lua-rapidxml.cpp`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/rapidxml/license.txt` & `pyskynet-0.2.0/3rd/rapidxml/license.txt`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/rapidxml/rapidxml.hpp` & `pyskynet-0.2.0/3rd/rapidxml/rapidxml.hpp`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/rapidxml/rapidxml_iterators.hpp` & `pyskynet-0.2.0/3rd/rapidxml/rapidxml_iterators.hpp`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/rapidxml/rapidxml_utils.hpp` & `pyskynet-0.2.0/3rd/rapidxml/rapidxml_utils.hpp`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-protobuf/README.zh.md` & `pyskynet-0.2.0/3rd/lua-protobuf/README.zh.md`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-protobuf/pb.h` & `pyskynet-0.2.0/3rd/lua-protobuf/pb.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-protobuf/.travis.yml` & `pyskynet-0.2.0/3rd/lua-protobuf/.travis.yml`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-protobuf/protoc.lua` & `pyskynet-0.2.0/3rd/lua-protobuf/protoc.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-protobuf/pb.c` & `pyskynet-0.2.0/3rd/lua-protobuf/pb.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-protobuf/.github/workflows/test.yml` & `pyskynet-0.2.0/3rd/lua-protobuf/.github/workflows/test.yml`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-protobuf/README.md` & `pyskynet-0.2.0/3rd/lua-protobuf/README.md`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-protobuf/luaunit.lua` & `pyskynet-0.2.0/3rd/lua-protobuf/luaunit.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-protobuf/test.lua` & `pyskynet-0.2.0/3rd/lua-protobuf/test.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-protobuf/LICENSE` & `pyskynet-0.2.0/3rd/lua-protobuf/LICENSE`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-protobuf/serpent.lua` & `pyskynet-0.2.0/3rd/lua-protobuf/serpent.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/TinyGL/bitmap_image.hpp` & `pyskynet-0.2.0/3rd/TinyGL/bitmap_image.hpp`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/TinyGL/tinygl/Camera.h` & `pyskynet-0.2.0/3rd/TinyGL/tinygl/Camera.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/TinyGL/tinygl/Mesh.cpp` & `pyskynet-0.2.0/3rd/TinyGL/tinygl/Mesh.cpp`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/TinyGL/tinygl/Shader.h` & `pyskynet-0.2.0/3rd/TinyGL/tinygl/Shader.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/TinyGL/tinygl/point.h` & `pyskynet-0.2.0/3rd/TinyGL/tinygl/point.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/TinyGL/tinygl/Screen.cpp` & `pyskynet-0.2.0/3rd/TinyGL/tinygl/Screen.cpp`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/TinyGL/tinygl/Transform.h` & `pyskynet-0.2.0/3rd/TinyGL/tinygl/Transform.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/TinyGL/tinygl/Screen.h` & `pyskynet-0.2.0/3rd/TinyGL/tinygl/Screen.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/TinyGL/tinygl/Camera.cpp` & `pyskynet-0.2.0/3rd/TinyGL/tinygl/Camera.cpp`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/TinyGL/tinygl/Mesh.h` & `pyskynet-0.2.0/3rd/TinyGL/tinygl/Mesh.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/TinyGL/LICENCE` & `pyskynet-0.2.0/3rd/TinyGL/LICENCE`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/TinyGL/example.cpp` & `pyskynet-0.2.0/3rd/TinyGL/example.cpp`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/unqlite/update-md5.py` & `pyskynet-0.2.0/3rd/unqlite/update-md5.py`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/unqlite/unqlite.h` & `pyskynet-0.2.0/3rd/unqlite/unqlite.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/unqlite/unqlite.c` & `pyskynet-0.2.0/3rd/unqlite/unqlite.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/unqlite/.travis.yml` & `pyskynet-0.2.0/3rd/unqlite/.travis.yml`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/unqlite/CMakeLists.txt` & `pyskynet-0.2.0/3rd/unqlite/CMakeLists.txt`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/unqlite/.github/FUNDING.yml` & `pyskynet-0.2.0/3rd/unqlite/.github/FUNDING.yml`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/unqlite/README.md` & `pyskynet-0.2.0/3rd/unqlite/README.md`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/unqlite/src/bitvec.c` & `pyskynet-0.2.0/3rd/unqlite/src/bitvec.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/unqlite/src/unqlite_vm.c` & `pyskynet-0.2.0/3rd/unqlite/src/unqlite_vm.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/unqlite/src/jx9_const.c` & `pyskynet-0.2.0/3rd/unqlite/src/jx9_const.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/unqlite/src/os.c` & `pyskynet-0.2.0/3rd/unqlite/src/os.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/unqlite/src/jx9Int.h` & `pyskynet-0.2.0/3rd/unqlite/src/jx9Int.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/unqlite/src/unqlite.h` & `pyskynet-0.2.0/3rd/unqlite/src/unqlite.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/unqlite/src/api.c` & `pyskynet-0.2.0/3rd/unqlite/src/api.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/unqlite/src/jx9_builtin.c` & `pyskynet-0.2.0/3rd/unqlite/src/jx9_builtin.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/unqlite/src/mem_kv.c` & `pyskynet-0.2.0/3rd/unqlite/src/mem_kv.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/unqlite/src/jx9.h` & `pyskynet-0.2.0/3rd/unqlite/src/jx9.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/unqlite/src/jx9_memobj.c` & `pyskynet-0.2.0/3rd/unqlite/src/jx9_memobj.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/unqlite/src/jx9_vfs.c` & `pyskynet-0.2.0/3rd/unqlite/src/jx9_vfs.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/unqlite/src/jx9_hashmap.c` & `pyskynet-0.2.0/3rd/unqlite/src/jx9_hashmap.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/unqlite/src/jx9_api.c` & `pyskynet-0.2.0/3rd/unqlite/src/jx9_api.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/unqlite/src/unqlite_jx9.c` & `pyskynet-0.2.0/3rd/unqlite/src/unqlite_jx9.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/unqlite/src/jx9_json.c` & `pyskynet-0.2.0/3rd/unqlite/src/jx9_json.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/unqlite/src/unqliteInt.h` & `pyskynet-0.2.0/3rd/unqlite/src/unqliteInt.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/unqlite/src/jx9_lib.c` & `pyskynet-0.2.0/3rd/unqlite/src/jx9_lib.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/unqlite/src/jx9_compile.c` & `pyskynet-0.2.0/3rd/unqlite/src/jx9_compile.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/unqlite/src/jx9_parse.c` & `pyskynet-0.2.0/3rd/unqlite/src/jx9_parse.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/unqlite/src/os_win.c` & `pyskynet-0.2.0/3rd/unqlite/src/os_win.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/unqlite/src/pager.c` & `pyskynet-0.2.0/3rd/unqlite/src/pager.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/unqlite/src/jx9_license.txt` & `pyskynet-0.2.0/3rd/unqlite/src/jx9_license.txt`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/unqlite/src/license.txt` & `pyskynet-0.2.0/3rd/unqlite/src/license.txt`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/unqlite/src/jx9_lex.c` & `pyskynet-0.2.0/3rd/unqlite/src/jx9_lex.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/unqlite/src/os_unix.c` & `pyskynet-0.2.0/3rd/unqlite/src/os_unix.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/unqlite/src/fastjson.c` & `pyskynet-0.2.0/3rd/unqlite/src/fastjson.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/unqlite/src/lhash_kv.c` & `pyskynet-0.2.0/3rd/unqlite/src/lhash_kv.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/unqlite/src/jx9_vm.c` & `pyskynet-0.2.0/3rd/unqlite/src/jx9_vm.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/unqlite/CHANGELOG.md` & `pyskynet-0.2.0/3rd/unqlite/CHANGELOG.md`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/unqlite/LICENSE` & `pyskynet-0.2.0/3rd/unqlite/LICENSE`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/unqlite/example/5.c` & `pyskynet-0.2.0/3rd/unqlite/example/5.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/unqlite/example/2.c` & `pyskynet-0.2.0/3rd/unqlite/example/2.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/unqlite/example/demovfs/unqlite_demovfs.c` & `pyskynet-0.2.0/3rd/unqlite/example/demovfs/unqlite_demovfs.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/unqlite/example/unqlite_mp3.c` & `pyskynet-0.2.0/3rd/unqlite/example/unqlite_mp3.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/unqlite/example/unqlite_huge.c` & `pyskynet-0.2.0/3rd/unqlite/example/unqlite_huge.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/unqlite/example/4.c` & `pyskynet-0.2.0/3rd/unqlite/example/4.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/unqlite/example/3.c` & `pyskynet-0.2.0/3rd/unqlite/example/3.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/unqlite/example/1.c` & `pyskynet-0.2.0/3rd/unqlite/example/1.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/unqlite/example/unqlite_tar.c` & `pyskynet-0.2.0/3rd/unqlite/example/unqlite_tar.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/unqlite/example/6.c` & `pyskynet-0.2.0/3rd/unqlite/example/6.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/numsky/src/lua-cluster.c` & `pyskynet-0.2.0/3rd/numsky/src/lua-cluster.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/numsky/src/lua-serialize.c` & `pyskynet-0.2.0/skynet/lualib-src/lua-seri.c`

 * *Files 4% similar despite different names*

```diff
@@ -1,14 +1,14 @@
 /*
 	modify from https://github.com/cloudwu/lua-serialize
  */
 
 #define LUA_LIB
 
-#include "skynet_foreign/skynet_foreign.h"
+#include "skynet_malloc.h"
 
 #include <lua.h>
 #include <lauxlib.h>
 #include <stdlib.h>
 #include <stdint.h>
 #include <assert.h>
 #include <string.h>
@@ -53,22 +53,22 @@
 	char * buffer;
 	int len;
 	int ptr;
 };
 
 inline static struct block *
 blk_alloc(void) {
-	struct block *b = (struct block*)skynet_malloc(sizeof(struct block));
+	struct block *b = skynet_malloc(sizeof(struct block));
 	b->next = NULL;
 	return b;
 }
 
 inline static void
 wb_push(struct write_block *b, const void *buf, int sz) {
-	const char * buffer = (const char*)buf;
+	const char * buffer = buf;
 	if (b->ptr == BLOCK_SIZE) {
 _again:
 		b->current = b->current->next = blk_alloc();
 		b->ptr = 0;
 	}
 	if (b->ptr <= BLOCK_SIZE - sz) {
 		memcpy(b->current->buffer + b->ptr, buffer, sz);
@@ -111,15 +111,15 @@
 static void
 rball_init(struct read_block * rb, char * buffer, int size) {
 	rb->buffer = buffer;
 	rb->len = size;
 	rb->ptr = 0;
 }
 
-static void *
+static const void *
 rb_read(struct read_block *rb, int sz) {
 	if (rb->len < sz) {
 		return NULL;
 	}
 
 	int ptr = rb->ptr;
 	rb->ptr += sz;
@@ -310,15 +310,15 @@
 			wb_integer(b, x);
 		} else {
 			lua_Number n = lua_tonumber(L,index);
 			wb_real(b,n);
 		}
 		break;
 	}
-	case LUA_TBOOLEAN:
+	case LUA_TBOOLEAN: 
 		wb_boolean(b, lua_toboolean(L,index));
 		break;
 	case LUA_TSTRING: {
 		size_t sz = 0;
 		const char *str = lua_tolstring(L,index,&sz);
 		wb_string(b, str, (int)sz);
 		break;
@@ -359,87 +359,87 @@
 static lua_Integer
 get_integer(lua_State *L, struct read_block *rb, int cookie) {
 	switch (cookie) {
 	case TYPE_NUMBER_ZERO:
 		return 0;
 	case TYPE_NUMBER_BYTE: {
 		uint8_t n;
-		uint8_t * pn = (uint8_t *)rb_read(rb,sizeof(n));
+		const uint8_t * pn = (const uint8_t *)rb_read(rb,sizeof(n));
 		if (pn == NULL)
 			invalid_stream(L,rb);
 		n = *pn;
 		return n;
 	}
 	case TYPE_NUMBER_WORD: {
 		uint16_t n;
-		uint16_t * pn = (uint16_t *)rb_read(rb,sizeof(n));
+		const void * pn = rb_read(rb,sizeof(n));
 		if (pn == NULL)
 			invalid_stream(L,rb);
 		memcpy(&n, pn, sizeof(n));
 		return n;
 	}
 	case TYPE_NUMBER_DWORD: {
 		int32_t n;
-		int32_t * pn = (int32_t *)rb_read(rb,sizeof(n));
+		const void * pn = rb_read(rb,sizeof(n));
 		if (pn == NULL)
 			invalid_stream(L,rb);
 		memcpy(&n, pn, sizeof(n));
 		return n;
 	}
 	case TYPE_NUMBER_QWORD: {
 		int64_t n;
-		int64_t * pn = (int64_t *)rb_read(rb,sizeof(n));
+		const void * pn = rb_read(rb,sizeof(n));
 		if (pn == NULL)
 			invalid_stream(L,rb);
 		memcpy(&n, pn, sizeof(n));
 		return n;
 	}
 	default:
 		invalid_stream(L,rb);
 		return 0;
 	}
 }
 
 static double
 get_real(lua_State *L, struct read_block *rb) {
 	double n;
-	double * pn = (double *)rb_read(rb,sizeof(n));
+	const void * pn = rb_read(rb,sizeof(n));
 	if (pn == NULL)
 		invalid_stream(L,rb);
 	memcpy(&n, pn, sizeof(n));
 	return n;
 }
 
 static void *
 get_pointer(lua_State *L, struct read_block *rb) {
 	void * userdata = 0;
-	void ** v = (void **)rb_read(rb,sizeof(userdata));
+	const void * v = rb_read(rb,sizeof(userdata));
 	if (v == NULL) {
 		invalid_stream(L,rb);
 	}
 	memcpy(&userdata, v, sizeof(userdata));
 	return userdata;
 }
 
 static void
 get_buffer(lua_State *L, struct read_block *rb, int len) {
-	char * p = (char *)rb_read(rb,len);
+	const char * p = (const char *)rb_read(rb,len);
 	if (p == NULL) {
 		invalid_stream(L,rb);
 	}
 	lua_pushlstring(L,p,len);
 }
 
 static void unpack_one(lua_State *L, struct read_block *rb);
 
 static void
 unpack_table(lua_State *L, struct read_block *rb, int array_size) {
 	if (array_size == MAX_COOKIE-1) {
 		uint8_t type;
-		uint8_t *t = (uint8_t *)rb_read(rb, sizeof(type));
+		const uint8_t * t = (const uint8_t *)rb_read(rb, sizeof(type));
 		if (t==NULL) {
 			invalid_stream(L,rb);
 		}
 		type = *t;
 		int cookie = type >> 3;
 		if ((type & 7) != TYPE_NUMBER || cookie == TYPE_NUMBER_REAL) {
 			invalid_stream(L,rb);
@@ -484,26 +484,26 @@
 		lua_pushlightuserdata(L,get_pointer(L,rb));
 		break;
 	case TYPE_SHORT_STRING:
 		get_buffer(L,rb,cookie);
 		break;
 	case TYPE_LONG_STRING: {
 		if (cookie == 2) {
-			uint16_t *plen = (uint16_t *)rb_read(rb, 2);
+			const void * plen = rb_read(rb, 2);
 			if (plen == NULL) {
 				invalid_stream(L,rb);
 			}
 			uint16_t n;
 			memcpy(&n, plen, sizeof(n));
 			get_buffer(L,rb,n);
 		} else {
 			if (cookie != 4) {
 				invalid_stream(L,rb);
 			}
-			uint32_t *plen = (uint32_t *)rb_read(rb, 4);
+			const void * plen = rb_read(rb, 4);
 			if (plen == NULL) {
 				invalid_stream(L,rb);
 			}
 			uint32_t n;
 			memcpy(&n, plen, sizeof(n));
 			get_buffer(L,rb,n);
 		}
@@ -519,39 +519,39 @@
 	}
 	}
 }
 
 static void
 unpack_one(lua_State *L, struct read_block *rb) {
 	uint8_t type;
-	uint8_t *t = (uint8_t*)rb_read(rb, sizeof(type));
+	const uint8_t * t = (const uint8_t *)rb_read(rb, sizeof(type));
 	if (t==NULL) {
 		invalid_stream(L, rb);
 	}
 	type = *t;
 	push_value(L, rb, type & 0x7, type>>3);
 }
 
 static void
 seri(lua_State *L, struct block *b, int len) {
-	uint8_t * buffer = (uint8_t*)skynet_malloc(len);
+	uint8_t * buffer = skynet_malloc(len);
 	uint8_t * ptr = buffer;
 	int sz = len;
 	while(len>0) {
 		if (len >= BLOCK_SIZE) {
 			memcpy(ptr, b->buffer, BLOCK_SIZE);
 			ptr += BLOCK_SIZE;
 			len -= BLOCK_SIZE;
 			b = b->next;
 		} else {
 			memcpy(ptr, b->buffer, len);
 			break;
 		}
 	}
-
+	
 	lua_pushlightuserdata(L, buffer);
 	lua_pushinteger(L, sz);
 }
 
 int
 luaseri_unpack(lua_State *L) {
 	if (lua_isnoneornil(L,1)) {
@@ -572,23 +572,23 @@
 	}
 	if (buffer == NULL) {
 		return luaL_error(L, "deserialize null pointer");
 	}
 
 	lua_settop(L,1);
 	struct read_block rb;
-	rball_init(&rb, (char*)buffer, len);
+	rball_init(&rb, buffer, len);
 
 	int i;
 	for (i=0;;i++) {
 		if (i%8==7) {
 			luaL_checkstack(L,LUA_MINSTACK,NULL);
 		}
 		uint8_t type = 0;
-		uint8_t *t = (uint8_t*)rb_read(&rb, sizeof(type));
+		const uint8_t * t = (const uint8_t *)rb_read(&rb, sizeof(type));
 		if (t==NULL)
 			break;
 		type = *t;
 		push_value(L, &rb, type & 0x7, type>>3);
 	}
 
 	// Need not free buffer
```

### Comparing `pyskynet-0.1.5/3rd/numsky/src/lua-binding.h` & `pyskynet-0.2.0/3rd/numsky/src/lua-binding.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/numsky/src/numsky/canvas/ValNode.cpp` & `pyskynet-0.2.0/3rd/numsky/src/numsky/canvas/ValNode.cpp`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/numsky/src/numsky/canvas/AstNode.cpp` & `pyskynet-0.2.0/3rd/numsky/src/numsky/canvas/AstNode.cpp`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/numsky/src/numsky/canvas/CameraAstNode.cpp` & `pyskynet-0.2.0/3rd/numsky/src/numsky/canvas/CameraAstNode.cpp`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/numsky/src/numsky/canvas/DefinedException.h` & `pyskynet-0.2.0/3rd/numsky/src/numsky/canvas/DefinedException.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/numsky/src/numsky/canvas/DefinedException.cpp` & `pyskynet-0.2.0/3rd/numsky/src/numsky/canvas/DefinedException.cpp`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/numsky/src/numsky/canvas/ValNode.h` & `pyskynet-0.2.0/3rd/numsky/src/numsky/canvas/ValNode.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/numsky/src/numsky/canvas/EvalContext.h` & `pyskynet-0.2.0/3rd/numsky/src/numsky/canvas/EvalContext.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/numsky/src/numsky/canvas/ArrayAstNode.h` & `pyskynet-0.2.0/3rd/numsky/src/numsky/canvas/ArrayAstNode.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/numsky/src/numsky/canvas/AstNode.h` & `pyskynet-0.2.0/3rd/numsky/src/numsky/canvas/AstNode.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/numsky/src/numsky/canvas/ParseContext.cpp` & `pyskynet-0.2.0/3rd/numsky/src/numsky/canvas/ParseContext.cpp`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/numsky/src/numsky/canvas/ArrayAstNode.cpp` & `pyskynet-0.2.0/3rd/numsky/src/numsky/canvas/ArrayAstNode.cpp`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/numsky/src/numsky/canvas/TypeGuard.h` & `pyskynet-0.2.0/3rd/numsky/src/numsky/canvas/TypeGuard.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/numsky/src/numsky/canvas/CameraAstNode.h` & `pyskynet-0.2.0/3rd/numsky/src/numsky/canvas/CameraAstNode.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/numsky/src/numsky/canvas/lua-numsky_canvas.cpp` & `pyskynet-0.2.0/3rd/numsky/src/numsky/canvas/lua-numsky_canvas.cpp`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/numsky/src/numsky/canvas/LuaAstNode.h` & `pyskynet-0.2.0/3rd/numsky/src/numsky/canvas/LuaAstNode.h`

 * *Files 1% similar despite different names*

```diff
@@ -11,15 +11,14 @@
 		protected:
 			BaseAstNode *xparse_child_any(ParseContext *ctx, rapidxml::xml_node<> *xnode) final;
 			BaseAstNode *xparse_child_block(ParseContext *ctx, rapidxml::xml_node<> *xnode) final;
 			BaseAstNode *xparse_child_table(ParseContext *ctx, rapidxml::xml_node<> *xnode) final;
 			BaseAstNode *xparse_child_arr(ParseContext *ctx, rapidxml::xml_node<> *xnode, int child_ndim) final;
 			BaseAstNode *xparse_child_scalar(ParseContext *ctx, rapidxml::xml_node<> *xnode, numsky_dtype *scalar_dtype) final;
 			BaseAstNode *xparse_child_camera(ParseContext *ctx, rapidxml::xml_node<> *xnode) final;
-			BaseAstNode* xparse_child_mesh(ParseContext *ctx, rapidxml::xml_node<> *xnode, int mesh_enum) final;
 			bool xparse_has_scope() final;
 		public:
 			AbstractLuaAstNode(): BaseAstNode() {}
 		};
 
 		class TableAstNode : public AbstractLuaAstNode {
 		public:
```

### Comparing `pyskynet-0.1.5/3rd/numsky/src/numsky/canvas/ParseContext.h` & `pyskynet-0.2.0/3rd/numsky/src/numsky/canvas/ParseContext.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/numsky/src/numsky/canvas/LuaAstNode.cpp` & `pyskynet-0.2.0/3rd/numsky/src/numsky/canvas/LuaAstNode.cpp`

 * *Files 5% similar despite different names*

```diff
@@ -32,18 +32,14 @@
 			return child;
 		}
 		BaseAstNode* AbstractLuaAstNode::xparse_child_camera(ParseContext *ctx, rapidxml::xml_node<> *xnode) {
 			BaseAstNode *child = new CameraAstNode();
 			child->parse_xml(ctx, xnode);
 			return child;
 		}
-		BaseAstNode* AbstractLuaAstNode::xparse_child_mesh(ParseContext *ctx, rapidxml::xml_node<> *xnode, int mesh_enum) {
-			ctx->raise(xnode->name(), "TODO");
-			return NULL;
-		}
 		bool AbstractLuaAstNode::xparse_has_scope() {
 			return true;
 		}
 	}
 	// TableAstNode
 	namespace canvas {
 		IValNode* TableAstNode::eval(EvalContext *ctx) {
```

### Comparing `pyskynet-0.1.5/3rd/numsky/src/numsky/canvas/IAstNode.h` & `pyskynet-0.2.0/3rd/numsky/src/numsky/canvas/IAstNode.h`

 * *Files 4% similar despite different names*

```diff
@@ -22,14 +22,15 @@
 
 		class IAstNode {
 		public:
 			rapidxml::xml_node<>* self_xnode;
 			int line;
 			IAstNode() : line(0) {}
 			friend class AttrParse;
+			template <int A> friend struct AttrDesc;
 		protected:
 			// attrs
 			virtual void xparse_attr_xname(ParseContext *ctx, rapidxml::xml_attribute<> *xattr);
 
 			// control
 			virtual void xparse_attr_xfor(ParseContext *ctx, rapidxml::xml_attribute<> *xattr);
 			virtual void xparse_attr_xif(ParseContext *ctx, rapidxml::xml_attribute<> *xattr);
@@ -84,14 +85,15 @@
 
 		class BaseAstNode : public IAstNode {
 		public:
 			char* xname;
 			ExpandControl ctrl;
 			std::vector<IAstNode*> children;
 			friend class TagParse;
+			template <int A> friend struct TagDesc;
 
 		protected:
 			// attrs
 			void xparse_attr_xname(ParseContext *ctx, rapidxml::xml_attribute<> *xattr) final;
 			void xparse_attr_xif(ParseContext *ctx, rapidxml::xml_attribute<> *xattr) final;
 			void xparse_attr_xsort(ParseContext *ctx, rapidxml::xml_attribute<> *xattr) final;
 			void xparse_attr_xfor(ParseContext *ctx, rapidxml::xml_attribute<> *xattr) final;
```

### Comparing `pyskynet-0.1.5/3rd/numsky/src/numsky/ndarray/ndarray_tostring.cpp` & `pyskynet-0.2.0/3rd/numsky/src/numsky/ndarray/ndarray_tostring.cpp`

 * *Files 0% similar despite different names*

```diff
@@ -75,8 +75,7 @@
 
 // API
 int numsky::ndarray__tostring(lua_State *L){
 	auto arr_obj = luabinding::ClassUtil<numsky_ndarray>::check(L, 1);
 	auto fp_tostring = lnumsky_template_fp(L, arr_obj->dtype->typechar, _ndarray__tostring);
 	return fp_tostring(L, arr_obj);
 }
-
```

### Comparing `pyskynet-0.1.5/3rd/numsky/src/numsky/ndarray/lua-numsky_ndarray.cpp` & `pyskynet-0.2.0/3rd/numsky/src/numsky/ndarray/lua-numsky_ndarray.cpp`

 * *Files 0% similar despite different names*

```diff
@@ -72,14 +72,15 @@
 		   .setFieldProperty("dtype", lnumsky_ndarray_dtype_getter, NULL)
 
 		   .setFieldFunction("flatten", numsky::ndarray_methods_flatten)
 		   .setFieldFunction("reshape", numsky::ndarray_methods_reshape)
 		   .setFieldFunction("copy", numsky::ndarray_methods_copy)
 		   .setFieldFunction("astype", numsky::ndarray_methods_astype)
 		   .setFieldFunction("roll", numsky::ndarray_methods_roll)
+		   .setFieldFunction("tostring", numsky::ndarray_methods_tostring)
 
 		   .setMetaFunction("__len", lnumsky_ndarray__len)
 		   .setMetaFunction("__gc", lnumsky_ndarray__gc)
 		   .setMetaFunction("__index", numsky::ndarray__index)
 		   .setMetaFunction("__newindex", numsky::ndarray__newindex)
 		   .setMetaFunction("__tostring", numsky::ndarray__tostring)
```

### Comparing `pyskynet-0.1.5/3rd/numsky/src/numsky/ndarray/ndarray_indexing.cpp` & `pyskynet-0.2.0/3rd/numsky/src/numsky/ndarray/ndarray_indexing.cpp`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/numsky/src/numsky/ndarray/ndarray_ctor.cpp` & `pyskynet-0.2.0/3rd/numsky/src/numsky/ndarray/ndarray_ctor.cpp`

 * *Files 3% similar despite different names*

```diff
@@ -144,14 +144,34 @@
 template std::unique_ptr<numsky_ndarray, void(*)(numsky_ndarray*)>
 numsky::table_to_array<false>(numsky::ThrowableContext *ctx, int table_idx, char typechar);
 
 /*********************
  * routines creation *
  *********************/
 
+int numsky::ctor_fromstring(lua_State *L) {
+    char typechar = 'f';
+    if(!lua_isnone(L, 2)) {
+	   struct numsky_dtype *dtype = luabinding::ClassUtil<numsky_dtype>::check(L, 2);
+	   typechar = dtype->typechar;
+    }
+    auto dtype = numsky_get_dtype_by_char(typechar);
+	size_t strLen = 0;
+	const char* strPtr = luaL_checklstring(L, 1, &strLen);
+	if (strLen % dtype->elsize!=0) {
+		luaL_error(L, "string size must be a multiple of element size");
+		return 0;
+	}
+	numsky_ndarray* arr = numsky::ndarray_new_alloc<true>(L, 1, typechar, [&](int i) -> npy_intp {
+		return strLen / dtype->elsize;
+	}).get();
+    memcpy(arr->dataptr, strPtr, strLen);
+    return 1;
+}
+
 static numsky_ndarray* lnumsky_empty_prebuild(lua_State *L) {
     char typechar = 'f';
     if(!lua_isnone(L, 2)) {
 	   struct numsky_dtype *dtype = luabinding::ClassUtil<numsky_dtype>::check(L, 2);
 	   typechar = dtype->typechar;
     }
 	numsky_ndarray* arr = NULL;
```

### Comparing `pyskynet-0.1.5/3rd/numsky/src/numsky/ndarray/lua-numsky_ndarray.h` & `pyskynet-0.2.0/3rd/numsky/src/numsky/ndarray/lua-numsky_ndarray.h`

 * *Files 2% similar despite different names*

```diff
@@ -235,28 +235,30 @@
 		} else if(type1 == LUA_TTABLE){
 			return table_to_array<false>(ctx, table_idx, default_typechar);
 		}
 		ctx->throw_func("only table or numsky.ndarray can be checked to numsky.ndarray");
 		return std::unique_ptr<numsky_ndarray, void(*)(numsky_ndarray*)>(nullptr, [](numsky_ndarray*l){});
 	}
 
+	int ctor_fromstring(lua_State *L);
 	int ctor_empty(lua_State *L);
 	int ctor_zeros(lua_State *L);
 	int ctor_ones(lua_State *L);
 
 	int ctor_arange(lua_State *L);
 	int ctor_linspace(lua_State *L);
 	//int ctor_logspace(lua_State *L);
 
 	/**********************
 	* ndarray_methods.cpp *
 	***********************/
 	int ndarray_methods_flatten(lua_State *L);
 	int ndarray_methods_reshape(lua_State *L);
 	int ndarray_methods_copy(lua_State *L);
+	int ndarray_methods_tostring(lua_State *L);
 	int ndarray_methods_roll(lua_State *L);
 	int ndarray_methods_astype(lua_State *L);
 
 
 	// http://lua-users.org/wiki/MetatableEvents
 
 	/***********************
```

### Comparing `pyskynet-0.1.5/3rd/numsky/src/numsky/ndarray/ndarray_methods.cpp` & `pyskynet-0.2.0/3rd/numsky/src/numsky/ndarray/ndarray_methods.cpp`

 * *Files 4% similar despite different names*

```diff
@@ -66,14 +66,23 @@
 	auto new_arr_ptr = numsky::ndarray_new_alloc<true>(L, old_arr->nd, old_arr->dtype->typechar, [&](int i)-> npy_intp {
 			return old_arr->dimensions[i];
 	});
 	lnumsky_template_fp2(L, old_arr->dtype->typechar, new_arr_ptr->dtype->typechar, numsky::ndarray_t_copyto)(old_arr, new_arr_ptr->dataptr);
 	return 1;
 }
 
+int numsky::ndarray_methods_tostring(lua_State *L){
+	auto arr = luabinding::ClassUtil<numsky_ndarray>::check(L, 1);
+	size_t sz = arr->dtype->elsize * arr->count;
+	std::unique_ptr<char []> tempBuf(new char[sz]);
+	lnumsky_template_fp2(L, arr->dtype->typechar, arr->dtype->typechar, numsky::ndarray_t_copyto)(arr, tempBuf.get());
+	lua_pushlstring(L, tempBuf.get(), sz);
+	return 1;
+}
+
 int numsky::ndarray_methods_roll(lua_State *L) {
 	auto old_arr = luabinding::ClassUtil<numsky_ndarray>::check(L, 1);
 	npy_intp shift = luaL_checkinteger(L, 2);
 	int axis = 0;
 	int top = lua_gettop(L);
 	if(top == 3) {
 		int axis_args = luaL_checkinteger(L, 3);
```

### Comparing `pyskynet-0.1.5/3rd/numsky/src/numsky/ufunc/ufunc_reduce.cpp` & `pyskynet-0.2.0/3rd/numsky/src/numsky/ufunc/ufunc_reduce.cpp`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/numsky/src/numsky/ufunc/ufunc_21.cpp` & `pyskynet-0.2.0/3rd/numsky/src/numsky/ufunc/ufunc_21.cpp`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/numsky/src/numsky/ufunc/lua-numsky_ufunc.cpp` & `pyskynet-0.2.0/3rd/numsky/src/numsky/ufunc/lua-numsky_ufunc.cpp`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/numsky/src/numsky/ufunc/lua-numsky_ufunc.h` & `pyskynet-0.2.0/3rd/numsky/src/numsky/ufunc/lua-numsky_ufunc.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/numsky/src/numsky/ufunc/ufunc_oper.cpp` & `pyskynet-0.2.0/3rd/numsky/src/numsky/ufunc/ufunc_oper.cpp`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/numsky/src/numsky/ufunc/ufunc_11.cpp` & `pyskynet-0.2.0/3rd/numsky/src/numsky/ufunc/ufunc_11.cpp`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/numsky/src/numsky/lua-numsky_tuple.cpp` & `pyskynet-0.2.0/3rd/numsky/src/numsky/lua-numsky_tuple.cpp`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/numsky/src/numsky/lua-numsky_slice.cpp` & `pyskynet-0.2.0/3rd/numsky/src/numsky/lua-numsky_slice.cpp`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/numsky/src/numsky/lua-numsky_name.cpp` & `pyskynet-0.2.0/3rd/numsky/src/numsky/lua-numsky_name.cpp`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/numsky/src/numsky/lua-numsky.h` & `pyskynet-0.2.0/3rd/numsky/src/numsky/lua-numsky.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/numsky/src/numsky/lua-numsky_export.cpp` & `pyskynet-0.2.0/3rd/numsky/src/numsky/lua-numsky_export.cpp`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/numsky/src/numsky/tinygl/tinygl_mesh.cpp` & `pyskynet-0.2.0/3rd/numsky/src/numsky/tinygl/tinygl_mesh.cpp`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/numsky/src/numsky/tinygl/lua-numsky_tinygl.h` & `pyskynet-0.2.0/3rd/numsky/src/numsky/tinygl/lua-numsky_tinygl.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/numsky/src/numsky/tinygl/lua-numsky_tinygl.cpp` & `pyskynet-0.2.0/3rd/numsky/src/numsky/tinygl/lua-numsky_tinygl.cpp`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/numsky/src/numsky/lua-numsky.cpp` & `pyskynet-0.2.0/3rd/numsky/src/numsky/lua-numsky.cpp`

 * *Files 1% similar despite different names*

```diff
@@ -122,14 +122,15 @@
 		// tuple
 		lnumsky_tuple_bind_lib(m);
 
 
 		// ndarray
 		m.setFunction("array", luabinding::Class_<numsky_ndarray>::ctor);
 
+		m.setFunction("fromstring", numsky::ctor_fromstring);
 		m.setFunction("empty", numsky::ctor_empty);
 		m.setFunction("zeros", numsky::ctor_zeros);
 		m.setFunction("ones", numsky::ctor_ones);
 
 		m.setFunction("arange", numsky::ctor_arange);
 		m.setFunction("linspace", numsky::ctor_linspace);
```

### Comparing `pyskynet-0.1.5/3rd/numsky/src/numsky/lua-numsky_dtype.cpp` & `pyskynet-0.2.0/3rd/numsky/src/numsky/lua-numsky_dtype.cpp`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/numsky/src/numsky/lua-numsky_nditer.cpp` & `pyskynet-0.2.0/3rd/numsky/src/numsky/lua-numsky_nditer.cpp`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/numsky/src/skynet_foreign/numsky.h` & `pyskynet-0.2.0/3rd/numsky/src/skynet_foreign/numsky.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/numsky/src/skynet_foreign/hook_skynet_py.h` & `pyskynet-0.2.0/3rd/numsky/src/skynet_foreign/hook_pyskynet.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/numsky/src/skynet_foreign/numsky_dtype.c` & `pyskynet-0.2.0/3rd/numsky/src/skynet_foreign/numsky_dtype.c`

 * *Files 0% similar despite different names*

```diff
@@ -1,8 +1,8 @@
-#include "skynet_foreign/hook_skynet_py.h"
+#include "skynet_foreign/hook_pyskynet.h"
 #include "skynet_foreign/numsky.h"
 #include <stdio.h>
 #include <stdbool.h>
 
 
 #define MAKE_DATAPTR_FUNC(T, lua_push, lua_check) \
 static void dataptr_push_##T(lua_State*L, char* dataptr) { \
```

### Comparing `pyskynet-0.1.5/3rd/numsky/src/skynet_foreign/numsky.c` & `pyskynet-0.2.0/3rd/numsky/src/skynet_foreign/numsky.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/numsky/src/skynet_foreign/skynet_foreign.c` & `pyskynet-0.2.0/3rd/numsky/src/skynet_foreign/skynet_foreign.c`

 * *Files 8% similar despite different names*

```diff
@@ -1,29 +1,21 @@
 
-#include "skynet_foreign/hook_skynet_py.h"
 #include "skynet_foreign/skynet_foreign.h"
 #ifdef BUILD_FOR_PYSKYNET
 #include "skynet_modify/skynet_py.h" // for include skynet_py_decref_python
 #endif
 
 #include <stdio.h>
 
 static inline void skynet_foreign_delete(struct skynet_foreign *obj){
-    if(obj->ref_type == SF_REF_SELF) {
-    } else  {
 #ifdef BUILD_FOR_PYSKYNET
-	   if(obj->ref_type == SF_REF_PYTHON) {
-		  skynet_py_decref_python(obj->ref_obj);
-	   } else {
-		  printf("ERROR!!!!!, delete unexception branch < 0\n");
-	   }
-#else
-	   printf("ERROR!!!!!, delete unexception branch < 0\n");
-#endif
+    if(obj->ref_obj != NULL) {
+        skynet_py_decref_python(obj->ref_obj);
     }
+#endif
     SPIN_DESTROY(obj);
     foreign_free(obj);
 }
 
 void skynet_foreign_incref(struct skynet_foreign *obj) {
 	SPIN_LOCK(obj)
     obj->ref_count ++;
```

### Comparing `pyskynet-0.1.5/3rd/numsky/src/foreign_seri/SeriMode.h` & `pyskynet-0.2.0/3rd/numsky/src/foreign_seri/seri.h`

 * *Files 22% similar despite different names*

```diff
@@ -1,14 +1,13 @@
+#pragma once
 
-#define LUA_LIB
-
-extern "C" {
 #include "skynet_foreign/numsky.h"
-}
 
+#include <lua.h>
+#include <lauxlib.h>
 #include <stdlib.h>
 #include <stdint.h>
 #include <assert.h>
 #include <string.h>
 
 #define TYPE_NIL 0
 #define TYPE_BOOLEAN 1
@@ -23,19 +22,19 @@
 #define TYPE_NUMBER_REAL 8
 
 #define TYPE_USERDATA 3
 #define TYPE_SHORT_STRING 4
 // hibits 0~31 : len
 #define TYPE_LONG_STRING 5
 #define TYPE_TABLE 6
+
+// numsky array
 #define TYPE_FOREIGN_USERDATA 7
 
+#define MODE_LUA 0
+#define MODE_FOREIGN 1
+#define MODE_FOREIGN_REMOTE 2
+
 #define MAX_COOKIE 32
 #define COMBINE_TYPE(t,v) ((t) | (v) << 3)
 
-#define MAX_DEPTH 32
-
-enum SeriMode {
-	MODE_LUA = 0,
-	MODE_FOREIGN = 1,
-	MODE_FOREIGN_REMOTE = 2,
-};
+#define MAX_DEPTH 32
```

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/.gitignore` & `pyskynet-0.2.0/3rd/lua-rapidjson/.gitignore`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/appveyor.yml` & `pyskynet-0.2.0/3rd/lua-rapidjson/appveyor.yml`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/performance/paragraphs.json` & `pyskynet-0.2.0/3rd/lua-rapidjson/performance/paragraphs.json`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/performance/run.lua` & `pyskynet-0.2.0/3rd/lua-rapidjson/performance/run.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/performance/floats.json` & `pyskynet-0.2.0/3rd/lua-rapidjson/performance/floats.json`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/performance/guids.json` & `pyskynet-0.2.0/3rd/lua-rapidjson/performance/guids.json`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/performance/integers.json` & `pyskynet-0.2.0/3rd/lua-rapidjson/performance/integers.json`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/performance/mixed.json` & `pyskynet-0.2.0/3rd/lua-rapidjson/performance/mixed.json`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson-0.7.1-1.rockspec` & `pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson-0.7.1-1.rockspec`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/spec/Schema_spec.lua` & `pyskynet-0.2.0/3rd/lua-rapidjson/spec/Schema_spec.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/spec/json_dump_spec.lua` & `pyskynet-0.2.0/3rd/lua-rapidjson/spec/json_dump_spec.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/spec/Document_spec.lua` & `pyskynet-0.2.0/3rd/lua-rapidjson/spec/Document_spec.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/spec/json_null_spec.lua` & `pyskynet-0.2.0/3rd/lua-rapidjson/spec/json_null_spec.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/spec/json_decode_spec.lua` & `pyskynet-0.2.0/3rd/lua-rapidjson/spec/json_decode_spec.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/spec/json_load_spec.lua` & `pyskynet-0.2.0/3rd/lua-rapidjson/spec/json_load_spec.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/spec/json_array_spec.lua` & `pyskynet-0.2.0/3rd/lua-rapidjson/spec/json_array_spec.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/spec/json_encode_spec.lua` & `pyskynet-0.2.0/3rd/lua-rapidjson/spec/json_encode_spec.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/spec/json_object_spec.lua` & `pyskynet-0.2.0/3rd/lua-rapidjson/spec/json_object_spec.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/.travis.yml` & `pyskynet-0.2.0/3rd/lua-rapidjson/.travis.yml`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/CMakeLists.txt` & `pyskynet-0.2.0/3rd/lua-rapidjson/CMakeLists.txt`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/.github/workflows/main.yml` & `pyskynet-0.2.0/3rd/lua-rapidjson/.github/workflows/main.yml`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/API.md` & `pyskynet-0.2.0/3rd/lua-rapidjson/API.md`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/README.md` & `pyskynet-0.2.0/3rd/lua-rapidjson/README.md`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/src/Userdata.hpp` & `pyskynet-0.2.0/3rd/lua-rapidjson/src/Userdata.hpp`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/src/StringStream.hpp` & `pyskynet-0.2.0/3rd/lua-rapidjson/src/StringStream.hpp`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/src/Document.cpp` & `pyskynet-0.2.0/3rd/lua-rapidjson/src/Document.cpp`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/src/rapidjson.cpp` & `pyskynet-0.2.0/3rd/lua-rapidjson/src/rapidjson.cpp`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/src/values.cpp` & `pyskynet-0.2.0/3rd/lua-rapidjson/src/values.cpp`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/src/Schema.cpp` & `pyskynet-0.2.0/3rd/lua-rapidjson/src/Schema.cpp`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/src/values.hpp` & `pyskynet-0.2.0/3rd/lua-rapidjson/src/values.hpp`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/src/luax.hpp` & `pyskynet-0.2.0/3rd/lua-rapidjson/src/luax.hpp`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/cmake/Modules/FindLua.cmake` & `pyskynet-0.2.0/3rd/lua-rapidjson/cmake/Modules/FindLua.cmake`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/LICENSE` & `pyskynet-0.2.0/3rd/lua-rapidjson/LICENSE`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/bin/encodings/utf32lebom.json` & `pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/bin/encodings/utf32lebom.json`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/bin/encodings/utf32bebom.json` & `pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/bin/encodings/utf32bebom.json`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/bin/encodings/utf32le.json` & `pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/bin/encodings/utf32le.json`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/bin/encodings/utf32be.json` & `pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/bin/encodings/utf32be.json`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/pass1.json` & `pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/bin/jsonchecker/pass1.json`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/bin/types/paragraphs.json` & `pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/bin/types/paragraphs.json`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/bin/types/floats.json` & `pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/bin/types/floats.json`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/bin/types/guids.json` & `pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/bin/types/guids.json`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/bin/types/integers.json` & `pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/bin/types/integers.json`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/bin/types/mixed.json` & `pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/bin/types/mixed.json`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/filereadstream.h` & `pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/filereadstream.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/filewritestream.h` & `pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/filewritestream.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/allocators.h` & `pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/allocators.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/istreamwrapper.h` & `pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/istreamwrapper.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/schema.h` & `pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/schema.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/fwd.h` & `pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/fwd.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/internal/ieee754.h` & `pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/internal/ieee754.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/internal/biginteger.h` & `pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/internal/biginteger.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/internal/swap.h` & `pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/internal/swap.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/internal/strtod.h` & `pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/internal/strtod.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/internal/diyfp.h` & `pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/internal/diyfp.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/internal/meta.h` & `pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/internal/meta.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/internal/strfunc.h` & `pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/internal/strfunc.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/internal/pow10.h` & `pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/internal/pow10.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/internal/regex.h` & `pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/internal/regex.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/internal/stack.h` & `pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/internal/stack.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/internal/clzll.h` & `pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/internal/clzll.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/internal/itoa.h` & `pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/internal/itoa.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/internal/dtoa.h` & `pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/internal/dtoa.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/ostreamwrapper.h` & `pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/ostreamwrapper.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/msinttypes/stdint.h` & `pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/msinttypes/stdint.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/msinttypes/inttypes.h` & `pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/msinttypes/inttypes.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/pointer.h` & `pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/pointer.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/error/en.h` & `pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/error/en.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/error/error.h` & `pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/error/error.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/stringbuffer.h` & `pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/stringbuffer.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/document.h` & `pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/document.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/memorystream.h` & `pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/memorystream.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/writer.h` & `pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/writer.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/encodings.h` & `pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/encodings.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/encodedstream.h` & `pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/encodedstream.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/reader.h` & `pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/reader.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/memorybuffer.h` & `pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/memorybuffer.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/cursorstreamwrapper.h` & `pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/cursorstreamwrapper.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/rapidjson.h` & `pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/rapidjson.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/prettywriter.h` & `pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/prettywriter.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/include/rapidjson/stream.h` & `pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/include/rapidjson/stream.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/readme.zh-cn.md` & `pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/readme.zh-cn.md`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/license.txt` & `pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/license.txt`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/readme.md` & `pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/readme.md`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/3rd/lua-rapidjson/rapidjson/CHANGELOG.md` & `pyskynet-0.2.0/3rd/lua-rapidjson/rapidjson/CHANGELOG.md`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/test/test_luacluster.py` & `pyskynet-0.2.0/test/test_luacluster.py`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/test/test_tinygl.py` & `pyskynet-0.2.0/test/test_tinygl.py`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/test/test_seri.py` & `pyskynet-0.2.0/test/test_seri.py`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/test/test_foreign.py` & `pyskynet-0.2.0/test/test_foreign.py`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/test/test_cluster.py` & `pyskynet-0.2.0/test/test_cluster.py`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/setup_ext.py` & `pyskynet-0.2.0/setup_ext.py`

 * *Files 2% similar despite different names*

```diff
@@ -88,21 +88,22 @@
         include_dirs=[SKYNET_SRC_PATH, LUA_PATH, "skynet/lualib-src/lua-bson"],
         sources=["skynet/lualib-src/lua-bson.c"],
         define_macros=MACROS,
         extra_objects=[])
     return ext_cservices + [ext_skynet, ext_lpeg, ext_md5, ext_bson]
 
 def create_lua_extensions():
-    lua_service_pyholder = Extension('pyskynet.service.pyholder',
+    lua_service_pyholder = Extension('skynet.cservice.pyholder',
         sources=['src/c_src/service_pyholder.c'],
         include_dirs=INCLUDE_DIRS,
         define_macros=MACROS,
         libraries=LIBRARIES)
     lua_foreign_seri = Extension('pyskynet.lualib.pyskynet.foreign_seri',
-        sources=['3rd/numsky/src/lua-foreign_seri.c'],
+        #sources=['3rd/numsky/src/foreign_seri/lua-foreign_seri.c'],
+        sources=list_path('3rd/numsky/src/foreign_seri/', '.c'),
         include_dirs=INCLUDE_DIRS,
         define_macros=MACROS,
         libraries=LIBRARIES)
     #lua_seri_v2 = Extension('pyskynet.lualib.pyskynet.seri_v2',
     #    sources=list_path('3rd/numsky/src/foreign_seri/', '.cpp'),
     #    include_dirs=INCLUDE_DIRS,
     #    define_macros=MACROS,
```

### Comparing `pyskynet-0.1.5/README.md` & `pyskynet-0.2.0/README.md`

 * *Files 13% similar despite different names*

```diff
@@ -6,27 +6,14 @@
 
 Default install, find ssl by default. If ssl is not found, ltls.so will not be installed
 
 ~~~~sh
 $ pip install pyskynet
 ~~~~
 
-Install with specific ssl path.
-
-~~~~sh
-$ pip install pyskynet --install-option="--ssl=/path/to"
-~~~~
-
-In mac maybe:
-
-~~~~sh
-$ brew install openssl
-$ pip install pyskynet --install-option="--ssl=/usr/local/opt/openssl@1.1"
-~~~~
-
 ### Quick Start
 
 Call lua from python
 
 ```python
 import pyskynet
 import pyskynet.foreign as foreign
```

### Comparing `pyskynet-0.1.5/pyskynet/proto.py` & `pyskynet-0.2.0/pyskynet/skynet.py`

 * *Files 3% similar despite different names*

```diff
@@ -1,27 +1,31 @@
 
 import pyskynet.skynet_py_mq as skynet_py_mq
 import pyskynet.skynet_py_foreign_seri as foreign_seri
 import gevent
 from gevent.event import AsyncResult
 import traceback
 
+PTYPE_TEXT = skynet_py_mq.SKYNET_PTYPE.PTYPE_TEXT
+PTYPE_CLIENT = skynet_py_mq.SKYNET_PTYPE.PTYPE_CLIENT
+PTYPE_SOCKET = skynet_py_mq.SKYNET_PTYPE.PTYPE_SOCKET
+PTYPE_LUA = skynet_py_mq.SKYNET_PTYPE.PTYPE_LUA
+
 SKYNET_PTYPE = skynet_py_mq.SKYNET_PTYPE
 
 #####################
 # py<->skynet proto #
 #####################
 
 local_session_to_ar = {}
 
 pyskynet_proto_dict = {}
 
-def hook_print(*args, **kwargs):
-    kwargs["flush"] = True
-    print("pyskynet:", *args, **kwargs)
+def hook_print(*args):
+    print("pyskynet:", *args, flush=True)
 
 class PySkynetProto(object):
     def __init__(self, id, name, pack=None, unpack=None, dispatch=None):
         self.id = id
         self.name = name
         self.pack = pack
         self.unpack = unpack
@@ -99,80 +103,83 @@
         raise PySkynetCallException("send to invalid address %08x" % dst)
     ar = AsyncResult()
     local_session_to_ar[session] = ar
     re = ar.get()
     if re:
         return re
     else:
-        gevent.sleep(0.01)
+        #gevent.sleep(0.01)
         raise PySkynetCallException("call failed from %s" % dst)
 
 
 # skynet.lua
 def rawsend(dst, type_name_or_id, msg_ptr, msg_size):
     """
         rawsend in skynet.lua, send don't need ret
     """
     psproto = pyskynet_proto_dict[type_name_or_id]
-    skynet_py_mq.csend(dst, psproto.id, 0, msg_ptr, msg_size)
+    return skynet_py_mq.csend(dst, psproto.id, 0, msg_ptr, msg_size)
 
 
 # skynet.lua
 def call(addr, type_name_or_id, *args):
-    return foreign_seri.unpack(*rawcall(addr, type_name_or_id, *foreign_seri.pack(*args)))
+    psproto = pyskynet_proto_dict[type_name_or_id]
+    msg_ptr, msg_size = psproto.pack(*args)
+    return psproto.unpack(*rawcall(addr, type_name_or_id, msg_ptr, msg_size))
 
 
 # skynet.lua
 def send(addr, type_name_or_id, *args):
-    rawsend(addr, type_name_or_id, *foreign_seri.pack(*args))
+    psproto = pyskynet_proto_dict[type_name_or_id]
+    msg_ptr, msg_size = psproto.pack(*args)
+    return rawsend(addr, type_name_or_id, msg_ptr, msg_size)
 
 
 # skynet.lua
 def ret(ret_msg_ptr, ret_size):
     """
         ret in skynet.lua, return for other's call
     """
     co = gevent.getcurrent()
     session = co_to_remote_session.pop(co)
     source = co_to_remote_address.pop(co)
     if session == 0:
-        pass  # send don't need ret
+        return False
     else:
-        skynet_py_mq.csend(source, SKYNET_PTYPE.PTYPE_RESPONSE, session, ret_msg_ptr, ret_size)
-    # TODO if package is to large, c++ will trigger some exception...
+        return skynet_py_mq.csend(source, SKYNET_PTYPE.PTYPE_RESPONSE, session, ret_msg_ptr, ret_size) is not None
 
 
 ################
 # raw dispatch #
 ################
-def async_handle():
+def __async_handle():
     """
         python actor's main loop, recv and deal message
     """
     source, type_id, session, ptr, length = skynet_py_mq.crecv()
     if source is None:
         return
     else:
-        gevent.spawn(async_handle)
+        gevent.spawn(__async_handle)
     if type_id == SKYNET_PTYPE.PTYPE_RESPONSE:
         # TODO exception
         try:
             ar = local_session_to_ar.pop(session)
             ar.set((ptr, length))
         except KeyError as e:
-            hook_print("[ERROR] unknown response session: %d from %x"%(session, address))
+            hook_print("[ERROR] unknown response session: %d from %x"%(session, source))
     else:
         # TODO exception
         try:
             psproto = pyskynet_proto_dict[type_id]
         except KeyError as e:
             if session != 0:
                 skynet_py_mq.csend(source, SKYNET_PTYPE.PTYPE_ERROR, session, "")
             else:
-                hook_print("[ERROR] unknown request with unexcept type_id %s, session: %d from %x"%(type_id, session, address))
+                hook_print("[ERROR] unknown request with unexcept type_id %s, session: %d from %x"%(type_id, session, source))
             return
         co = gevent.getcurrent()
         co_to_remote_session[co] = session
         co_to_remote_address[co] = source
         if callable(psproto.dispatch):
             try:
                 psproto.dispatch(session, source, psproto.unpack(ptr, length))
```

### Comparing `pyskynet-0.1.5/pyskynet/lualib/pyskynet.lua` & `pyskynet-0.2.0/pyskynet/lualib/pyskynet.thlua`

 * *Files 24% similar despite different names*

```diff
@@ -1,101 +1,63 @@
 
 local skynet = require("skynet")
-local core = require("skynet.core")
 local foreign = require("pyskynet.foreign")
 local pyskynet_modify = require("pyskynet.modify")
 
 local pyskynet = {}
 pyskynet.foreign = foreign
+pyskynet.skynet = skynet
 
 pyskynet.start = skynet.start
 
-----------------
--- proto api ---
-----------------
-
-pyskynet.PTYPE_TEXT = skynet.PTYPE_TEXT
-pyskynet.PTYPE_CLIENT = skynet.PTYPE_CLIENT
-pyskynet.PTYPE_SOCKET = skynet.PTYPE_SOCKET
-pyskynet.PTYPE_LUA = skynet.PTYPE_LUA
-pyskynet.PTYPE_FOREIGN_REMOTE = foreign.PTYPE_FOREIGN_REMOTE
-pyskynet.PTYPE_FOREIGN = foreign.PTYPE_FOREIGN
-
-pyskynet.rawcall = skynet.rawcall
-pyskynet.rawsend = skynet.rawsend
-pyskynet.ret = skynet.ret
-
 ------------------
 -- service api ---
 ------------------
 
 pyskynet.self = skynet.self
 
-local foreign_seri = require "pyskynet.foreign_seri"
-
-function pyskynet.seri(...)
-	local msg_ptr, msg_size = foreign_seri.remotepack(...)
-	local re_str = skynet.tostring(msg_ptr, msg_size)
-	skynet.trash(msg_ptr, msg_size)
-	return re_str
-end
-
-function pyskynet.deseri(arg_str)
-	return foreign_seri.remoteunpack(arg_str)
-end
-
-function pyskynet.getenv(k)
-	local data = pyskynet_modify.getlenv(k)
-	return (foreign_seri.remoteunpack(data))
+function pyskynet.getenv(k:String):Ret(Any)
+	const data = pyskynet_modify.getlenv(k)
+	return (foreign.remoteunpack(data, #data))
 end
 
-function pyskynet.setenv(k, v)
-	if k ~= nil then
-		assert(pyskynet.getenv(k) == nil, "Can't setenv exist key : " .. k)
-	end
-	local msg_ptr, msg_size = foreign_seri.remotepack(v)
-	local newkey = pyskynet_modify.setlenv(k, msg_ptr, msg_size)
+function pyskynet.setenv(k:String, v:Truth)
+	local msg_ptr, msg_size = foreign.remotepack(v)
+	pyskynet_modify.setlenv(k, msg_ptr, msg_size)
 	skynet.trash(msg_ptr, msg_size)
-	return newkey
 end
 
 function pyskynet.envs()
-	local re = {}
-	local function nextenv(t, k)
+	const re:Dict(String, Any) = {}
+	local function nextenv(_:Nil, k)
 		return pyskynet_modify.nextenv(k)
 	end
 	for key in nextenv, nil, nil do
 		re[key] = pyskynet.getenv(key)
 	end
 	return re
 end
 
-function pyskynet.newservice(...)
+function pyskynet.newservice(name:String, ...:String)
 	for i=1, select("#", ...) do
 		local arg = select(i, ...)
 		assert(type(arg)=="string", "newservice's arg must be string")
 	end
-	return skynet.newservice(...)
+	return skynet.newservice(name, ...)
 end
 
-function pyskynet.uniqueservice(...)
+function pyskynet.uniqueservice(name:String, ...:String)
 	for i=1, select("#", ...) do
 		local arg = select(i, ...)
 		assert(type(arg)=="string", "uniqueservice's arg must be string")
 	end
-	return skynet.uniqueservice(...)
+	return skynet.uniqueservice(name, ...)
 end
 
-function pyskynet.scriptservice(scriptaddr_or_loadargs, ...)
-    local t1 = type(scriptaddr_or_loadargs)
-    local scriptaddr
-    if t1 == "string" and scriptaddr_or_loadargs:find("0x") == 1 then
-        scriptaddr = scriptaddr_or_loadargs
-    elseif t1 == "string" then
-        scriptaddr = pyskynet.setenv(nil, {scriptaddr_or_loadargs})
-    elseif t1 == "table" then
-        scriptaddr = pyskynet.setenv(nil, scriptaddr_or_loadargs)
-    end
-	return pyskynet.newservice("script_service", scriptaddr, ...)
+function pyskynet.scriptservice(script:String, ...)
+	const nDebugInfo = debug.getinfo(2)
+	const nSourceName = nDebugInfo.source ..":".. nDebugInfo.currentline
+	const nScriptIndex = pyskynet_modify.refscript(script)
+	return pyskynet.newservice("script_service", nSourceName, tostring(nScriptIndex), ...)
 end
 
 return pyskynet
```

### Comparing `pyskynet-0.1.5/pyskynet/lualib/protoc.lua` & `pyskynet-0.2.0/pyskynet/lualib/protoc.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/pyskynet/lualib/pyskynet/cluster.lua` & `pyskynet-0.2.0/pyskynet/lualib/pyskynet/cluster.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/pyskynet/lualib/pyskynet/utils.lua` & `pyskynet-0.2.0/pyskynet/lualib/pyskynet/utils.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/pyskynet/lualib/pyskynet/foreign.lua` & `pyskynet-0.2.0/pyskynet/lualib/pyskynet/foreign.thlua`

 * *Files 7% similar despite different names*

```diff
@@ -1,15 +1,15 @@
 
 local foreign_seri = require("pyskynet.foreign_seri")
 local numsky = require("numsky")
 
 local skynet = require("skynet")
 
-collectgarbage("setpause", 100)
-collectgarbage("setstepmul", 200)
+--collectgarbage("setpause", 100)
+--collectgarbage("setstepmul", 200)
 
 local foreign = {}
 
 local PTYPE_FOREIGN_REMOTE = 254
 local PTYPE_FOREIGN = 255
 
 foreign.PTYPE_FOREIGN_REMOTE = PTYPE_FOREIGN_REMOTE
@@ -26,33 +26,33 @@
 		if not f then
 			error("cmd "..tostring(first).." not found")
 		end
 		return f(...)
 	end
 })
 
-local function __foreign_dispatch(session, source, ...)
+const function __foreign_dispatch(session:Integer, source:Integer, ...)
 	if session ~= 0 then
 		skynet.ret(foreign_seri.pack(foreign.CMD(...)))
 	else
 		foreign.CMD(...)
 	end
 end
 
-local function __foreign_remote_dispatch(session, source, ...)
+local function __foreign_remote_dispatch(session:Integer, source:Integer, ...)
 	if session ~= 0 then
 		skynet.ret(foreign_seri.remotepack(foreign.CMD(...)))
      else
 		foreign.CMD(...)
 	end
 end
 
 
 do
-	local REG = skynet.register_protocol
+	const REG = skynet.register_protocol
 
 	REG {
 		name = "foreign",
 		id = PTYPE_FOREIGN,
 		pack = foreign_seri.pack,
 		unpack = foreign_seri.unpack,
 		dispatch = __foreign_dispatch,
@@ -78,15 +78,15 @@
 	elseif type(cmd) == "function" then
 		foreign.CMD = cmd
 	else
 		error("dispatch failed for args")
 	end
 end
 
-function foreign.call(addr, ...)
+function foreign.call(addr:Integer, ...:Any)
 	return skynet.call(addr, PTYPE_FOREIGN, ...)
 end
 
 function foreign.send(addr, ...)
 	skynet.send(addr, PTYPE_FOREIGN, ...)
 end
```

### Comparing `pyskynet-0.1.5/pyskynet/service/skynet_py_logger.lua` & `pyskynet-0.2.0/pyskynet/service/skynet_py_logger.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/pyskynet/service/foreign_clusterd.lua` & `pyskynet-0.2.0/pyskynet/service/foreign_clusterd.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/pyskynet/service/foreign_clusteragent.lua` & `pyskynet-0.2.0/pyskynet/service/foreign_clusteragent.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/pyskynet/service/skynet_py_boot.lua` & `pyskynet-0.2.0/pyskynet/service/skynet_py_boot.lua`

 * *Files 4% similar despite different names*

```diff
@@ -1,31 +1,22 @@
 local skynet = require "skynet"
 require "skynet.manager"	-- import skynet.launch, ...
 local core = require "skynet.core"
 
 local foreign = require "pyskynet.foreign"
+local modify = require "pyskynet.modify"
 
 ----------------
 -- BOOT items --
 ----------------
 local BOOT = {}
 
--- for pyskynet xxx
-function BOOT.run(script, ...)
-    local func, sth = load(script)
-    if not func then
-		error(sth)
-    else
-		return func(...)
-    end
-end
-
 -- for pyskynet repl
 function BOOT.repl(script)
-	local func, err = load("return "..script)
+	local func, err = load("return "..script, "(pyskynet repl)")
     if not func then
 		func, err = load(script)
     end
     if not func then
 		print(err)
 	else
 		local function evalprint(ok, ...)
@@ -37,22 +28,15 @@
 			print(...)
 			print(debug.traceback())
 		end))
     end
 end
 
 -- foreign message for boot, command line pyskynet xxx
-skynet.dispatch("foreign", function (session,source,command,...)
-	local f = assert(BOOT[command])
-	if session ~= 0 then
-		skynet.ret(foreign.pack(f(...)))
-	else
-		foreign.CMD(...)
-	end
-end)
+foreign.dispatch(BOOT)
 
 ------------------
 -- HARBOR items --
 ------------------
 
 local globalname = {}
 local queryname = {}
```

### Comparing `pyskynet-0.1.5/pyskynet/cluster.py` & `pyskynet-0.2.0/pyskynet/cluster.py`

 * *Files 25% similar despite different names*

```diff
@@ -1,13 +1,13 @@
 
 
 import pyskynet
 
 import pyskynet.boot
-import pyskynet.proto as pyskynet_proto
+import pyskynet.skynet as skynet
 from pyskynet.skynet_py_foreign_seri import remotepack, remoteunpack, luapack
 import gevent
 import gevent.event
 
 clusterd = None
 
 
@@ -19,21 +19,21 @@
 pyskynet.boot.init(__load_clusterd)
 
 node_to_sender = {}
 node_to_task_queue = {}
 
 
 def __request_sender(task_queue, node):
-    sender = pyskynet_proto.call(clusterd, "lua", "sender", node)[0]
+    sender = skynet.call(clusterd, "lua", "sender", node)[0]
     i = 0
     while i < len(task_queue):
         task = task_queue[i]
         # tuple for send task, AsyncResult for call task
         if type(task) == tuple:
-            pyskynet_proto.send(sender, "lua", "push", task[0], remotepack(*task[1]))
+            skynet.send(sender, "lua", "push", task[0], remotepack(*task[1]))
         else:
             confirm = gevent.event.Event()
             task.set((confirm, sender))
             confirm.wait()
         i += 1
     node_to_task_queue.pop(node)
     node_to_sender[node] = sender
@@ -54,22 +54,22 @@
         confirm.set()
         return sender
     else:
         return sender
 
 
 def call(node, address, *args):
-    return remoteunpack(*pyskynet_proto.rawcall(
+    return remoteunpack(*skynet.rawcall(
         __get_sender(node), "lua", *luapack("req", address, *remotepack(*args))))
 
 
 def send(node, address, *args):
     sender = node_to_sender.get(node)
     if sender is None:
         node_to_task_queue[node].append((address, args))
     else:
-        pyskynet_proto.send(sender, "lua", "push", address, remotepack(*args))
+        skynet.send(sender, "lua", "push", address, remotepack(*args))
 
 
 def open(port):
     assert 0 <= port <= 65535, "cluster.open's port must be in [0, 65535]"
-    pyskynet_proto.call(clusterd, "lua", "listen", "0.0.0.0", port)
+    skynet.call(clusterd, "lua", "listen", "0.0.0.0", port)
```

### Comparing `pyskynet-0.1.5/pyskynet/boot.py` & `pyskynet-0.2.0/pyskynet/boot.py`

 * *Files 5% similar despite different names*

```diff
@@ -10,15 +10,15 @@
 # 2. dlopen with flags RTLD_GLOBAL
 flags = sys.getdlopenflags()
 sys.setdlopenflags(flags | os.RTLD_GLOBAL)
 import pyskynet.skynet_py_main as skynet_py_main
 sys.setdlopenflags(flags)
 
 # 3. some module
-import pyskynet.proto as pyskynet_proto
+import pyskynet.skynet as skynet
 import pyskynet.skynet_py_mq as skynet_py_mq
 
 __boot_event = gevent.event.Event()
 __exit_event = gevent.event.Event()
 __watcher = gevent.get_hub().loop.async_()
 
 boot_service = None
@@ -30,17 +30,17 @@
 def __first_msg_callback():
     global boot_service
     import pyskynet.skynet_py_foreign_seri
     source, type_id, session, ptr, length = skynet_py_mq.crecv()
     # assert first message ( c.send(".python", 0, 0, "") )
     assert type_id == 0, "first message type must be 0 but get %s" % type_id
     assert session == 0, "first message session must be 0 but get %s" % session
-    boot_service, = pyskynet.skynet_py_foreign_seri.unpack(ptr, length)
-    __watcher.callback = lambda: gevent.spawn(pyskynet_proto.async_handle)
-    gevent.spawn(pyskynet_proto.async_handle)
+    boot_service, = pyskynet.skynet_py_foreign_seri.luaunpack(ptr, length)
+    __watcher.callback = lambda: gevent.spawn(skynet.__async_handle)
+    gevent.spawn(skynet.__async_handle)
     __boot_event.set()
 
 
 # preinit, register libuv items
 def __preinit():
     __watcher.start(__first_msg_callback)
     p_uv_async_send = libuv_cffi.ffi.addressof(libuv_cffi.lib, "uv_async_send")
@@ -51,39 +51,47 @@
 __preinit()
 
 SKYNET_ROOT = os.path.join(os.path.abspath(
     os.path.dirname(__file__)), "../skynet")
 PYSKYNET_ROOT = os.path.abspath(os.path.dirname(__file__))
 
 boot_config = {
-    "thread": 1,
+    "thread": 2,
 
     # skynet service path
-    "cservice": [SKYNET_ROOT+"/cservice/?.so", PYSKYNET_ROOT+"/service/?.so"],
-    "luaservice": [SKYNET_ROOT+"/service/?.lua", PYSKYNET_ROOT+"/service/?.lua", "./?.lua"],
+    "cservice": [SKYNET_ROOT+"/cservice/?.so"],
+    "luaservice": [
+        SKYNET_ROOT+"/service/?.lua",
+        PYSKYNET_ROOT+"/service/?.lua", PYSKYNET_ROOT+"/service/?.thlua",
+        "./?.lua", "./?.thlua"
+    ],
 
     # lua require path
     "lua_cpath": [SKYNET_ROOT+"/luaclib/?.so", PYSKYNET_ROOT+"/lualib/?.so", "./?.so"],
-    "lua_path": [SKYNET_ROOT+"/lualib/?.lua", PYSKYNET_ROOT+"/lualib/?.lua", "./?.lua"],
+    "lua_path": [
+        SKYNET_ROOT+"/lualib/?.lua",
+        PYSKYNET_ROOT+"/lualib/?.lua", PYSKYNET_ROOT+"/lualib/?.thlua",
+        "./?.lua", "./?.thlua"
+    ],
 
     # script
-    "lualoader": SKYNET_ROOT+"/lualib/loader.lua",
+    #"lualoader": SKYNET_ROOT+"/lualib/loader.lua",
+    "lualoader": PYSKYNET_ROOT+"/thlua_loader.lua",
     "bootstrap": "snlua skynet_py_boot",
     "logservice": "snlua",
     "logger": "skynet_py_logger",
 
     # profile
     "profile": 0,
 
     # immutable setting, don't use this ...
     "standalone": "1",  # used by service_mgr.lua
     "harbor": "0",  # used by cdummy
 }
 
-
 def init(func):
     if __init_funcs is None:
         func()
     else:
         __init_funcs.append(func)
 
 
@@ -95,15 +103,15 @@
     global __init_funcs
     assert type(path) == list, "start path must be list"
     for f in path:
         for key in ["lua_path", "luaservice"]:
             boot_config[key].append(f)
     assert type(cpath) == list, "start cpath must be list"
     for f in cpath:
-        for key in ["lua_cpath", "cservice"]:
+        for key in ["lua_cpath"]:
             boot_config[key].append(f)
     boot_config["thread"] = thread
     import pyskynet
     for k, v in boot_config.items():
         if type(v) == list:
             v = ";".join(v)
         pyskynet.setenv(k, v)
@@ -138,19 +146,16 @@
     args = parser.parse_args()
     if args.script != "":
         import pyskynet
         start()
         try:
             with open(args.script) as fo:
                 script = fo.read()
-            pyskynet.scriptservice([script, args.script], *args.args)
+            pyskynet.scriptservice(script, scriptName=args.script, *args.args)
             join()
-        except pyskynet.proto.PySkynetCallException as err:
-            pyskynet_proto.hook_print(err)
-            gevent.sleep(1)
         except KeyboardInterrupt:
             return
     else:
         import pyskynet
         import pyskynet.foreign
         start()
         import code
```

### Comparing `pyskynet-0.1.5/pyskynet/foreign.py` & `pyskynet-0.2.0/pyskynet/foreign.py`

 * *Files 16% similar despite different names*

```diff
@@ -1,15 +1,15 @@
 
 import pyskynet.skynet_py_foreign_seri as foreign_seri
-import pyskynet.proto as pyskynet_proto
-import pyskynet.skynet_py_mq
+import pyskynet.skynet as skynet
+import pyskynet.skynet_py_mq as skynet_py_mq
 
 
-PTYPE_FOREIGN = pyskynet.skynet_py_mq.PTYPE_FOREIGN
-PTYPE_FOREIGN_REMOTE = pyskynet.skynet_py_mq.PTYPE_FOREIGN_REMOTE
+PTYPE_FOREIGN = skynet_py_mq.PTYPE_FOREIGN
+PTYPE_FOREIGN_REMOTE = skynet_py_mq.PTYPE_FOREIGN_REMOTE
 
 
 class CMDDispatcher(object):
     def __init__(self):
         self.cmd2func = {}
 
     def __call__(self, first, *args):
@@ -32,47 +32,53 @@
 CMD = CMDDispatcher()
 
 pack = foreign_seri.pack
 unpack = foreign_seri.unpack
 remotepack = foreign_seri.remotepack
 remoteunpack = foreign_seri.remoteunpack
 
+trash = foreign_seri.trash
+
 
 def __foreign_dispatch(session, source, argtuple):
     ret = CMD(*argtuple)
     if session != 0:
         if type(ret) == tuple:
-            pyskynet_proto.ret(*foreign_seri.pack(*ret))
+            msg_ptr, msg_size = foreign_seri.pack(*ret)
+            skynet.ret(msg_ptr, msg_size)
         else:
-            pyskynet_proto.ret(*foreign_seri.pack(ret))
+            msg_ptr, msg_size = foreign_seri.pack(ret)
+            skynet.ret(msg_ptr, msg_size)
 
 
 def __foreign_remote_dispatch(session, source, argtuple):
     ret = CMD(*argtuple)
     if session != 0:
         if type(ret) == tuple:
-            pyskynet_proto.ret(*foreign_seri.remotepack(*ret))
+            skynet.ret(*foreign_seri.remotepack(*ret))
         else:
-            pyskynet_proto.ret(*foreign_seri.remotepack(ret))
+            skynet.ret(*foreign_seri.remotepack(ret))
 
+def __dontpackhere():
+    raise skynet.PySkynetCallException("don't use pack here")
 
 # dispatch foreign message
-pyskynet_proto.register_protocol(
+skynet.register_protocol(
         id=PTYPE_FOREIGN,
         name="foreign",
-        pack=foreign_seri.pack,
+        pack=__dontpackhere,
         unpack=foreign_seri.unpack,
         dispatch=__foreign_dispatch,
         )
 
 # dispatch foreign message
-pyskynet_proto.register_protocol(
+skynet.register_protocol(
         id=PTYPE_FOREIGN_REMOTE,
         name="foreign_remote",
-        pack=foreign_seri.remotepack,
+        pack=__dontpackhere,
         unpack=foreign_seri.remoteunpack,
         dispatch=__foreign_remote_dispatch,
         )
 
 
 def dispatch(cmd=None, func=None):
     global CMD
@@ -91,13 +97,13 @@
     elif isinstance(cmd, str) or isinstance(cmd, bytes):
         return wrapper
     else:
         raise Exception("dispatch failed for unexception args")
 
 
 def call(addr, *args):
-    return foreign_seri.unpack(*pyskynet_proto.rawcall(
+    return foreign_seri.unpack(*skynet.rawcall(
         addr, PTYPE_FOREIGN, *foreign_seri.pack(*args)))
 
 
 def send(addr, *args):
-    pyskynet_proto.rawsend(addr, PTYPE_FOREIGN, *foreign_seri.pack(*args))
+    return skynet.rawsend(addr, PTYPE_FOREIGN, *foreign_seri.pack(*args))
```

### Comparing `pyskynet-0.1.5/src/skynet_modify/skynet_start_modify.c` & `pyskynet-0.2.0/src/skynet_modify/skynet_start_modify.c`

 * *Files 2% similar despite different names*

```diff
@@ -1,7 +1,12 @@
+/**
+ * @cz
+ * this file is modified from skynet_start.c in skynet
+ * expose a non-block start function into python
+*/
 #include "skynet.h"
 #include "skynet_server.h"
 #include "skynet_imp.h"
 #include "skynet_mq.h"
 #include "skynet_handle.h"
 #include "skynet_module.h"
 #include "skynet_timer.h"
@@ -314,15 +319,14 @@
         pthread_cancel(pid[i]);
     }
 
     skynet_free(G_SKYNET_PY.temp_pids);
 
 	free_monitor(G_SKYNET_PY.temp_monitor);
 
-    skynet_free(G_SKYNET_PY.temp_monitor);
     skynet_free(G_SKYNET_PY.temp_wps);
 
 	// harbor_exit may call socket send, so it should exit before socket_free
 	skynet_harbor_exit();
 	skynet_socket_free();
 	skynet_globalexit();
```

### Comparing `pyskynet-0.1.5/src/skynet_modify/skynet_py.h` & `pyskynet-0.2.0/src/skynet_modify/skynet_py.h`

 * *Files 16% similar despite different names*

```diff
@@ -47,18 +47,28 @@
 
 void skynet_py_queue_push(struct SkynetPyMessage* message); // return session
 int skynet_py_queue_pop(struct SkynetPyMessage* message); // return if empty 1 else 0
 int skynet_py_send(uint32_t lua_destination, int type, int session, void* msg, size_t sz);
 int skynet_py_sendname(const char *lua_destination, int type, int session, void* msg, size_t sz);
 
 void skynet_py_decref_python(void * pyobj); // decref python object, called by foreign
+uint32_t skynet_py_address(); // get pyholder's address
+void skynet_py_init(int (*p_uv_async_send)(void *), void * p_uv_async_t); // binding libuv items
 
-void skynet_py_init(int (*p_uv_async_send)(void *), void * p_uv_async_t);
+/* function in skynet_start_modify.c */
 void skynet_py_start(struct skynet_config * config);
 void skynet_py_wakeup();
 void skynet_py_exit();
-uint32_t skynet_py_address();
 
-/* function for env */
-void *skynet_py_setlenv(const char *key, const char *value_str, size_t sz);
+/* function in skynet_env_modify.c */
+int skynet_py_setlenv(const char *key, const char *value_str, size_t sz);
 const char *skynet_py_getlenv(const char *key, size_t *sz);
 const char *skynet_py_nextenv(const char *key);
+
+/* function in skynet_py_codecache.c */
+void skynet_py_initcodecache(void);
+int pyskynet_modify_cacheload(lua_State *L);
+
+/* function in skynet_py_scriptpool.c */
+void skynet_py_initscriptpool(void);
+const char *skynet_py_getscript(int index, size_t *sz);
+int skynet_py_refscript(const char*key, size_t sz);
```

### Comparing `pyskynet-0.1.5/src/skynet_modify/skynet_py.c` & `pyskynet-0.2.0/src/skynet_modify/skynet_py.c`

 * *Files 3% similar despite different names*

```diff
@@ -131,14 +131,17 @@
 	skynet_env_init();
 
 	sigign();
 
 #ifdef LUA_CACHELIB
 	// init the lock of code cache
 	luaL_initcodecache();
+	// @cz init thlua load cache
+	skynet_py_initcodecache();
+	skynet_py_initscriptpool();
 #endif
 
 }
 
 // if pyholder not started, return 0
 uint32_t skynet_py_address() {
 	return G_SKYNET_PY.holder_address;
```

### Comparing `pyskynet-0.1.5/src/skynet_modify/skynet_env_modify.c` & `pyskynet-0.2.0/src/skynet_modify/skynet_env_modify.c`

 * *Files 8% similar despite different names*

```diff
@@ -1,7 +1,13 @@
+/**
+ * @cz
+ * this file try to replace skynet_env.c
+ * old function skynet_getenv, skynet_setenv, ... is compatible with skynet's api
+ * new function skynet_getlenv, skynet_setlenv, ... is used for pyskynet.getenv, pyskynet.setenv, this can take lua table as value
+*/
 #include "skynet.h"
 #include "skynet_env.h"
 #include "spinlock.h"
 #include "skynet_py.h"
 
 #include <lua.h>
 #include <lauxlib.h>
@@ -29,37 +35,31 @@
 	    *sz = 0;
 	}
 	lua_pop(L, 1);
 	SPIN_UNLOCK(E);
 	return value_data;
 }
 
-void *skynet_py_setlenv(const char *key, const char *value_str, size_t sz) {
+// if conflict, return -1 else return 0
+int skynet_py_setlenv(const char *key, const char *value_str, size_t sz) {
 	SPIN_LOCK(E)
 
 	lua_State *L = E->L;
-	void *newkey = NULL;
-	if(key==NULL) {
-		char addr[32];
-		newkey = (void*)lua_pushlstring(L, value_str, sz);
-		sprintf(addr, "%p", newkey);
-		lua_setglobal(L, addr);
+	lua_getglobal(L, key);
+	int ret = 0;
+	if(lua_isnil(L, -1)) {
+		lua_pop(L, 1);
+		lua_pushlstring(L, value_str, sz);
+		lua_setglobal(L, key);
 	} else {
-		lua_getglobal(L, key);
-		if(lua_isnil(L, -1) || skynet_py_address() == 0) {
-			lua_pop(L, 1);
-			lua_pushlstring(L, value_str, sz);
-			lua_setglobal(L, key);
-		} else {
-			printf("can't set existed env after pyskynet start\n");
-			lua_pop(L, 1);
-		}
+		lua_pop(L, 1);
+		ret = -1;
 	}
 	SPIN_UNLOCK(E)
-	return newkey;
+	return ret;
 }
 
 // nextkey
 const char *skynet_py_nextenv(const char *key) {
     const char * next_key = NULL;
 
 	SPIN_LOCK(E);
```

### Comparing `pyskynet-0.1.5/src/cy_src/skynet_py.pxd` & `pyskynet-0.2.0/src/cy_src/skynet_py.pxd`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/src/cy_src/skynet_py_main.pyx` & `pyskynet-0.2.0/src/cy_src/skynet_py_main.pyx`

 * *Files 16% similar despite different names*

```diff
@@ -1,23 +1,26 @@
 # cython: language_level=3
+# cython: legacy_implicit_noexcept=True
 
 import _cffi_backend
 from cpython.pycapsule cimport PyCapsule_GetPointer, PyCapsule_New, PyCapsule_CheckExact
 from cpython.bytes cimport PyBytes_FromString, PyBytes_FromStringAndSize, PyBytes_CheckExact
 from libc.stdio cimport sscanf, sprintf
 
 from skynet_py cimport *
 
 cdef extern from "skynet_env.h":
     const char * skynet_getenv(const char *key);
 
 cdef extern from "skynet_modify/skynet_py.h":
-    void *skynet_py_setlenv(const char *key, const char *value_str, size_t sz)
+    int skynet_py_setlenv(const char *key, const char *value_str, size_t sz)
     const char *skynet_py_getlenv(const char *key, size_t *sz);
     const char *skynet_py_nextenv(const char *key)
+    const char *skynet_py_getscript(int index, size_t *sz);
+    int skynet_py_refscript(const char*key, size_t sz);
 
 ctypedef (char *)(* f_type)(object, object)
 
 def init(ffi, async_send, async_handle):
     # because gevent's libuv bind with cffi, so we can get pointer by this way
     cdef void ** _cffi_exports = <void **>PyCapsule_GetPointer(_cffi_backend._C_API, "cffi")
     # get the '_cffi_to_c_pointer' function in _cffi_include.h of cffi
@@ -43,45 +46,55 @@
         ptr = <char *>PyCapsule_GetPointer(capsule_or_bytes, "cptr")
         sz = py_sz
     elif PyBytes_CheckExact(capsule_or_bytes):
         ptr = capsule_or_bytes
         sz = len(capsule_or_bytes)
     else:
         raise Exception("skynet_py env value must be bytes or pointer")
-    if not (key is None):
-        key = __check_bytes(key)
-        skynet_py_setlenv(key, ptr, sz)
-        return None
-    cdef void *newkey = skynet_py_setlenv(NULL, ptr, sz)
-    cdef char addr[32];
-    cdef int k = sprintf(addr, "%p", newkey)
-    return addr[:k]
+    key = __check_bytes(key)
+    cdef int ret = skynet_py_setlenv(key, ptr, sz)
+    if ret != 0:
+        raise Exception("setlenv but key conflict")
+
 
 
 def getlenv(key):
     key = __check_bytes(key)
     cdef size_t sz
     cdef const char * value = skynet_py_getlenv(key, &sz);
     if value != NULL:
         return PyBytes_FromStringAndSize(value, sz);
     else:
-        return None
+        raise Exception("getlenv but value not existed")
 
 def nextenv(key):
     cdef const char * ptr
     if key is None:
         ptr = skynet_py_nextenv(NULL)
     else:
         key = __check_bytes(key)
         ptr = skynet_py_nextenv(key)
     if ptr == NULL:
         return None
     else:
         return PyBytes_FromString(ptr)
 
+def refscript(script):
+    script = __check_bytes(script)
+    index = skynet_py_refscript(script, len(script))
+    return index
+
+def getscript(index):
+    cdef size_t sz
+    cdef const char * value = skynet_py_getscript(index, &sz)
+    if value != NULL:
+        return PyBytes_FromStringAndSize(value, sz);
+    else:
+        return None
+
 def start(int thread, int profile):
     cdef skynet_config config;
     config.thread = thread
     config.profile = profile
     # use getenv for a stable ptr
     config.module_path = skynet_getenv("cservice")
     config.bootstrap = skynet_getenv("bootstrap")
```

### Comparing `pyskynet-0.1.5/src/cy_src/skynet_py_mq.c` & `pyskynet-0.2.0/src/cy_src/skynet_py_main.c`

 * *Files 7% similar despite different names*

```diff
@@ -1,8 +1,8 @@
-/* Generated by Cython 0.29.21 */
+/* Generated by Cython 3.0.0 */
 
 /* BEGIN: Cython Metadata
 {
     "distutils": {
         "define_macros": [
             [
                 "NOUSE_JEMALLOC",
@@ -18,55 +18,128 @@
             ],
             [
                 "LUA_USE_LINUX",
                 null
             ]
         ],
         "depends": [
-            "src/cy_src/skynet_py.pxd"
+            "3rd/numsky/src/skynet_foreign/skynet_foreign.h",
+            "skynet/3rd/lua/lua.h",
+            "skynet/skynet-src/skynet.h",
+            "skynet/skynet-src/skynet_env.h",
+            "src/cy_src/skynet_py.pxd",
+            "src/skynet_modify/skynet_py.h"
         ],
         "include_dirs": [
             "./skynet/skynet-src",
             "./skynet/3rd/lua",
             "./src",
             "./src/c_src",
             "./skynet/lualib-src",
             "3rd/numsky/src",
-            "/root/pyenv/lib/python3.6/site-packages/numpy/core/include"
+            "/root/pyenv37/lib/python3.7/site-packages/numpy/core/include"
         ],
         "libraries": [
             "pthread",
             "m",
             "readline",
             "dl"
         ],
-        "name": "pyskynet.skynet_py_mq",
+        "name": "pyskynet.skynet_py_main",
         "sources": [
-            "src/cy_src/skynet_py_mq.pyx"
+            "src/cy_src/skynet_py_main.pyx",
+            "./skynet/skynet-src/skynet_handle.c",
+            "./skynet/skynet-src/skynet_monitor.c",
+            "./skynet/skynet-src/skynet_socket.c",
+            "./skynet/skynet-src/skynet_error.c",
+            "./skynet/skynet-src/skynet_module.c",
+            "./skynet/skynet-src/socket_server.c",
+            "./skynet/skynet-src/skynet_harbor.c",
+            "./skynet/skynet-src/skynet_daemon.c",
+            "./skynet/skynet-src/malloc_hook.c",
+            "./skynet/skynet-src/skynet_mq.c",
+            "./skynet/skynet-src/skynet_log.c",
+            "./skynet/skynet-src/skynet_timer.c",
+            "src/skynet_modify/skynet_start_modify.c",
+            "src/skynet_modify/skynet_py_codecache.c",
+            "src/skynet_modify/skynet_server_modify.c",
+            "src/skynet_modify/skynet_py.c",
+            "src/skynet_modify/skynet_py_scriptpool.c",
+            "src/skynet_modify/skynet_env_modify.c",
+            "3rd/numsky/src/skynet_foreign/numsky_nditer.c",
+            "3rd/numsky/src/skynet_foreign/numsky_dtype.c",
+            "3rd/numsky/src/skynet_foreign/numsky.c",
+            "3rd/numsky/src/skynet_foreign/skynet_foreign.c",
+            "./skynet/3rd/lua/linit.c",
+            "./skynet/3rd/lua/ltablib.c",
+            "./skynet/3rd/lua/lcorolib.c",
+            "./skynet/3rd/lua/lapi.c",
+            "./skynet/3rd/lua/lstate.c",
+            "./skynet/3rd/lua/lctype.c",
+            "./skynet/3rd/lua/lstrlib.c",
+            "./skynet/3rd/lua/lfunc.c",
+            "./skynet/3rd/lua/lzio.c",
+            "./skynet/3rd/lua/ltm.c",
+            "./skynet/3rd/lua/lcode.c",
+            "./skynet/3rd/lua/lgc.c",
+            "./skynet/3rd/lua/lvm.c",
+            "./skynet/3rd/lua/lmem.c",
+            "./skynet/3rd/lua/ltable.c",
+            "./skynet/3rd/lua/loslib.c",
+            "./skynet/3rd/lua/loadlib.c",
+            "./skynet/3rd/lua/lbaselib.c",
+            "./skynet/3rd/lua/liolib.c",
+            "./skynet/3rd/lua/lundump.c",
+            "./skynet/3rd/lua/lstring.c",
+            "./skynet/3rd/lua/ldump.c",
+            "./skynet/3rd/lua/ldblib.c",
+            "./skynet/3rd/lua/lauxlib.c",
+            "./skynet/3rd/lua/llex.c",
+            "./skynet/3rd/lua/lobject.c",
+            "./skynet/3rd/lua/ldo.c",
+            "./skynet/3rd/lua/lmathlib.c",
+            "./skynet/3rd/lua/lparser.c",
+            "./skynet/3rd/lua/ldebug.c",
+            "./skynet/3rd/lua/lutf8lib.c",
+            "./skynet/3rd/lua/lopcodes.c"
         ]
     },
-    "module_name": "pyskynet.skynet_py_mq"
+    "module_name": "pyskynet.skynet_py_main"
 }
 END: Cython Metadata */
 
+#ifndef PY_SSIZE_T_CLEAN
 #define PY_SSIZE_T_CLEAN
+#endif /* PY_SSIZE_T_CLEAN */
+#if defined(CYTHON_LIMITED_API) && 0
+  #ifndef Py_LIMITED_API
+    #if CYTHON_LIMITED_API+0 > 0x03030000
+      #define Py_LIMITED_API CYTHON_LIMITED_API
+    #else
+      #define Py_LIMITED_API 0x03030000
+    #endif
+  #endif
+#endif
+
 #include "Python.h"
 #ifndef Py_PYTHON_H
     #error Python headers needed to compile C extensions, please install development version of Python.
-#elif PY_VERSION_HEX < 0x02060000 || (0x03000000 <= PY_VERSION_HEX && PY_VERSION_HEX < 0x03030000)
-    #error Cython requires Python 2.6+ or Python 3.3+.
+#elif PY_VERSION_HEX < 0x02070000 || (0x03000000 <= PY_VERSION_HEX && PY_VERSION_HEX < 0x03030000)
+    #error Cython requires Python 2.7+ or Python 3.3+.
 #else
-#define CYTHON_ABI "0_29_21"
-#define CYTHON_HEX_VERSION 0x001D15F0
+#define CYTHON_ABI "3_0_0"
+#define __PYX_ABI_MODULE_NAME "_cython_" CYTHON_ABI
+#define __PYX_TYPE_MODULE_PREFIX __PYX_ABI_MODULE_NAME "."
+#define CYTHON_HEX_VERSION 0x030000F0
 #define CYTHON_FUTURE_DIVISION 1
 #include <stddef.h>
 #ifndef offsetof
   #define offsetof(type, member) ( (size_t) & ((type*)0) -> member )
 #endif
-#if !defined(WIN32) && !defined(MS_WINDOWS)
+#if !defined(_WIN32) && !defined(WIN32) && !defined(MS_WINDOWS)
   #ifndef __stdcall
     #define __stdcall
   #endif
   #ifndef __cdecl
     #define __cdecl
   #endif
   #ifndef __fastcall
@@ -77,30 +150,34 @@
   #define DL_IMPORT(t) t
 #endif
 #ifndef DL_EXPORT
   #define DL_EXPORT(t) t
 #endif
 #define __PYX_COMMA ,
 #ifndef HAVE_LONG_LONG
-  #if PY_VERSION_HEX >= 0x02070000
-    #define HAVE_LONG_LONG
-  #endif
+  #define HAVE_LONG_LONG
 #endif
 #ifndef PY_LONG_LONG
   #define PY_LONG_LONG LONG_LONG
 #endif
 #ifndef Py_HUGE_VAL
   #define Py_HUGE_VAL HUGE_VAL
 #endif
-#ifdef PYPY_VERSION
-  #define CYTHON_COMPILING_IN_PYPY 1
-  #define CYTHON_COMPILING_IN_PYSTON 0
+#if defined(GRAALVM_PYTHON)
+  /* For very preliminary testing purposes. Most variables are set the same as PyPy.
+     The existence of this section does not imply that anything works or is even tested */
+  #define CYTHON_COMPILING_IN_PYPY 0
   #define CYTHON_COMPILING_IN_CPYTHON 0
+  #define CYTHON_COMPILING_IN_LIMITED_API 0
+  #define CYTHON_COMPILING_IN_GRAAL 1
+  #define CYTHON_COMPILING_IN_NOGIL 0
   #undef CYTHON_USE_TYPE_SLOTS
   #define CYTHON_USE_TYPE_SLOTS 0
+  #undef CYTHON_USE_TYPE_SPECS
+  #define CYTHON_USE_TYPE_SPECS 0
   #undef CYTHON_USE_PYTYPE_LOOKUP
   #define CYTHON_USE_PYTYPE_LOOKUP 0
   #if PY_VERSION_HEX < 0x03050000
     #undef CYTHON_USE_ASYNC_SLOTS
     #define CYTHON_USE_ASYNC_SLOTS 0
   #elif !defined(CYTHON_USE_ASYNC_SLOTS)
     #define CYTHON_USE_ASYNC_SLOTS 1
@@ -117,35 +194,167 @@
   #define CYTHON_AVOID_BORROWED_REFS 1
   #undef CYTHON_ASSUME_SAFE_MACROS
   #define CYTHON_ASSUME_SAFE_MACROS 0
   #undef CYTHON_UNPACK_METHODS
   #define CYTHON_UNPACK_METHODS 0
   #undef CYTHON_FAST_THREAD_STATE
   #define CYTHON_FAST_THREAD_STATE 0
+  #undef CYTHON_FAST_GIL
+  #define CYTHON_FAST_GIL 0
+  #undef CYTHON_METH_FASTCALL
+  #define CYTHON_METH_FASTCALL 0
   #undef CYTHON_FAST_PYCALL
   #define CYTHON_FAST_PYCALL 0
+  #ifndef CYTHON_PEP487_INIT_SUBCLASS
+    #define CYTHON_PEP487_INIT_SUBCLASS (PY_MAJOR_VERSION >= 3)
+  #endif
   #undef CYTHON_PEP489_MULTI_PHASE_INIT
-  #define CYTHON_PEP489_MULTI_PHASE_INIT 0
+  #define CYTHON_PEP489_MULTI_PHASE_INIT 1
+  #undef CYTHON_USE_MODULE_STATE
+  #define CYTHON_USE_MODULE_STATE 0
   #undef CYTHON_USE_TP_FINALIZE
   #define CYTHON_USE_TP_FINALIZE 0
   #undef CYTHON_USE_DICT_VERSIONS
   #define CYTHON_USE_DICT_VERSIONS 0
   #undef CYTHON_USE_EXC_INFO_STACK
   #define CYTHON_USE_EXC_INFO_STACK 0
-#elif defined(PYSTON_VERSION)
+  #ifndef CYTHON_UPDATE_DESCRIPTOR_DOC
+    #define CYTHON_UPDATE_DESCRIPTOR_DOC 0
+  #endif
+#elif defined(PYPY_VERSION)
+  #define CYTHON_COMPILING_IN_PYPY 1
+  #define CYTHON_COMPILING_IN_CPYTHON 0
+  #define CYTHON_COMPILING_IN_LIMITED_API 0
+  #define CYTHON_COMPILING_IN_GRAAL 0
+  #define CYTHON_COMPILING_IN_NOGIL 0
+  #undef CYTHON_USE_TYPE_SLOTS
+  #define CYTHON_USE_TYPE_SLOTS 0
+  #undef CYTHON_USE_TYPE_SPECS
+  #define CYTHON_USE_TYPE_SPECS 0
+  #undef CYTHON_USE_PYTYPE_LOOKUP
+  #define CYTHON_USE_PYTYPE_LOOKUP 0
+  #if PY_VERSION_HEX < 0x03050000
+    #undef CYTHON_USE_ASYNC_SLOTS
+    #define CYTHON_USE_ASYNC_SLOTS 0
+  #elif !defined(CYTHON_USE_ASYNC_SLOTS)
+    #define CYTHON_USE_ASYNC_SLOTS 1
+  #endif
+  #undef CYTHON_USE_PYLIST_INTERNALS
+  #define CYTHON_USE_PYLIST_INTERNALS 0
+  #undef CYTHON_USE_UNICODE_INTERNALS
+  #define CYTHON_USE_UNICODE_INTERNALS 0
+  #undef CYTHON_USE_UNICODE_WRITER
+  #define CYTHON_USE_UNICODE_WRITER 0
+  #undef CYTHON_USE_PYLONG_INTERNALS
+  #define CYTHON_USE_PYLONG_INTERNALS 0
+  #undef CYTHON_AVOID_BORROWED_REFS
+  #define CYTHON_AVOID_BORROWED_REFS 1
+  #undef CYTHON_ASSUME_SAFE_MACROS
+  #define CYTHON_ASSUME_SAFE_MACROS 0
+  #undef CYTHON_UNPACK_METHODS
+  #define CYTHON_UNPACK_METHODS 0
+  #undef CYTHON_FAST_THREAD_STATE
+  #define CYTHON_FAST_THREAD_STATE 0
+  #undef CYTHON_FAST_GIL
+  #define CYTHON_FAST_GIL 0
+  #undef CYTHON_METH_FASTCALL
+  #define CYTHON_METH_FASTCALL 0
+  #undef CYTHON_FAST_PYCALL
+  #define CYTHON_FAST_PYCALL 0
+  #ifndef CYTHON_PEP487_INIT_SUBCLASS
+    #define CYTHON_PEP487_INIT_SUBCLASS (PY_MAJOR_VERSION >= 3)
+  #endif
+  #if PY_VERSION_HEX < 0x03090000
+    #undef CYTHON_PEP489_MULTI_PHASE_INIT
+    #define CYTHON_PEP489_MULTI_PHASE_INIT 0
+  #elif !defined(CYTHON_PEP489_MULTI_PHASE_INIT)
+    #define CYTHON_PEP489_MULTI_PHASE_INIT 1
+  #endif
+  #undef CYTHON_USE_MODULE_STATE
+  #define CYTHON_USE_MODULE_STATE 0
+  #undef CYTHON_USE_TP_FINALIZE
+  #define CYTHON_USE_TP_FINALIZE (PY_VERSION_HEX >= 0x030400a1 && PYPY_VERSION_NUM >= 0x07030C00)
+  #undef CYTHON_USE_DICT_VERSIONS
+  #define CYTHON_USE_DICT_VERSIONS 0
+  #undef CYTHON_USE_EXC_INFO_STACK
+  #define CYTHON_USE_EXC_INFO_STACK 0
+  #ifndef CYTHON_UPDATE_DESCRIPTOR_DOC
+    #define CYTHON_UPDATE_DESCRIPTOR_DOC 0
+  #endif
+#elif defined(CYTHON_LIMITED_API)
   #define CYTHON_COMPILING_IN_PYPY 0
-  #define CYTHON_COMPILING_IN_PYSTON 1
   #define CYTHON_COMPILING_IN_CPYTHON 0
+  #define CYTHON_COMPILING_IN_LIMITED_API 1
+  #define CYTHON_COMPILING_IN_GRAAL 0
+  #define CYTHON_COMPILING_IN_NOGIL 0
+  #undef CYTHON_CLINE_IN_TRACEBACK
+  #define CYTHON_CLINE_IN_TRACEBACK 0
+  #undef CYTHON_USE_TYPE_SLOTS
+  #define CYTHON_USE_TYPE_SLOTS 0
+  #undef CYTHON_USE_TYPE_SPECS
+  #define CYTHON_USE_TYPE_SPECS 1
+  #undef CYTHON_USE_PYTYPE_LOOKUP
+  #define CYTHON_USE_PYTYPE_LOOKUP 0
+  #undef CYTHON_USE_ASYNC_SLOTS
+  #define CYTHON_USE_ASYNC_SLOTS 0
+  #undef CYTHON_USE_PYLIST_INTERNALS
+  #define CYTHON_USE_PYLIST_INTERNALS 0
+  #undef CYTHON_USE_UNICODE_INTERNALS
+  #define CYTHON_USE_UNICODE_INTERNALS 0
+  #ifndef CYTHON_USE_UNICODE_WRITER
+    #define CYTHON_USE_UNICODE_WRITER 0
+  #endif
+  #undef CYTHON_USE_PYLONG_INTERNALS
+  #define CYTHON_USE_PYLONG_INTERNALS 0
+  #ifndef CYTHON_AVOID_BORROWED_REFS
+    #define CYTHON_AVOID_BORROWED_REFS 0
+  #endif
+  #undef CYTHON_ASSUME_SAFE_MACROS
+  #define CYTHON_ASSUME_SAFE_MACROS 0
+  #undef CYTHON_UNPACK_METHODS
+  #define CYTHON_UNPACK_METHODS 0
+  #undef CYTHON_FAST_THREAD_STATE
+  #define CYTHON_FAST_THREAD_STATE 0
+  #undef CYTHON_FAST_GIL
+  #define CYTHON_FAST_GIL 0
+  #undef CYTHON_METH_FASTCALL
+  #define CYTHON_METH_FASTCALL 0
+  #undef CYTHON_FAST_PYCALL
+  #define CYTHON_FAST_PYCALL 0
+  #ifndef CYTHON_PEP487_INIT_SUBCLASS
+    #define CYTHON_PEP487_INIT_SUBCLASS 1
+  #endif
+  #undef CYTHON_PEP489_MULTI_PHASE_INIT
+  #define CYTHON_PEP489_MULTI_PHASE_INIT 0
+  #undef CYTHON_USE_MODULE_STATE
+  #define CYTHON_USE_MODULE_STATE 1
+  #ifndef CYTHON_USE_TP_FINALIZE
+    #define CYTHON_USE_TP_FINALIZE 1
+  #endif
+  #undef CYTHON_USE_DICT_VERSIONS
+  #define CYTHON_USE_DICT_VERSIONS 0
+  #undef CYTHON_USE_EXC_INFO_STACK
+  #define CYTHON_USE_EXC_INFO_STACK 0
+  #ifndef CYTHON_UPDATE_DESCRIPTOR_DOC
+    #define CYTHON_UPDATE_DESCRIPTOR_DOC 0
+  #endif
+#elif defined(PY_NOGIL)
+  #define CYTHON_COMPILING_IN_PYPY 0
+  #define CYTHON_COMPILING_IN_CPYTHON 0
+  #define CYTHON_COMPILING_IN_LIMITED_API 0
+  #define CYTHON_COMPILING_IN_GRAAL 0
+  #define CYTHON_COMPILING_IN_NOGIL 1
   #ifndef CYTHON_USE_TYPE_SLOTS
     #define CYTHON_USE_TYPE_SLOTS 1
   #endif
   #undef CYTHON_USE_PYTYPE_LOOKUP
   #define CYTHON_USE_PYTYPE_LOOKUP 0
-  #undef CYTHON_USE_ASYNC_SLOTS
-  #define CYTHON_USE_ASYNC_SLOTS 0
+  #ifndef CYTHON_USE_ASYNC_SLOTS
+    #define CYTHON_USE_ASYNC_SLOTS 1
+  #endif
   #undef CYTHON_USE_PYLIST_INTERNALS
   #define CYTHON_USE_PYLIST_INTERNALS 0
   #ifndef CYTHON_USE_UNICODE_INTERNALS
     #define CYTHON_USE_UNICODE_INTERNALS 1
   #endif
   #undef CYTHON_USE_UNICODE_WRITER
   #define CYTHON_USE_UNICODE_WRITER 0
@@ -160,54 +369,55 @@
   #ifndef CYTHON_UNPACK_METHODS
     #define CYTHON_UNPACK_METHODS 1
   #endif
   #undef CYTHON_FAST_THREAD_STATE
   #define CYTHON_FAST_THREAD_STATE 0
   #undef CYTHON_FAST_PYCALL
   #define CYTHON_FAST_PYCALL 0
-  #undef CYTHON_PEP489_MULTI_PHASE_INIT
-  #define CYTHON_PEP489_MULTI_PHASE_INIT 0
-  #undef CYTHON_USE_TP_FINALIZE
-  #define CYTHON_USE_TP_FINALIZE 0
+  #ifndef CYTHON_PEP489_MULTI_PHASE_INIT
+    #define CYTHON_PEP489_MULTI_PHASE_INIT 1
+  #endif
+  #ifndef CYTHON_USE_TP_FINALIZE
+    #define CYTHON_USE_TP_FINALIZE 1
+  #endif
   #undef CYTHON_USE_DICT_VERSIONS
   #define CYTHON_USE_DICT_VERSIONS 0
   #undef CYTHON_USE_EXC_INFO_STACK
   #define CYTHON_USE_EXC_INFO_STACK 0
 #else
   #define CYTHON_COMPILING_IN_PYPY 0
-  #define CYTHON_COMPILING_IN_PYSTON 0
   #define CYTHON_COMPILING_IN_CPYTHON 1
+  #define CYTHON_COMPILING_IN_LIMITED_API 0
+  #define CYTHON_COMPILING_IN_GRAAL 0
+  #define CYTHON_COMPILING_IN_NOGIL 0
   #ifndef CYTHON_USE_TYPE_SLOTS
     #define CYTHON_USE_TYPE_SLOTS 1
   #endif
-  #if PY_VERSION_HEX < 0x02070000
-    #undef CYTHON_USE_PYTYPE_LOOKUP
-    #define CYTHON_USE_PYTYPE_LOOKUP 0
-  #elif !defined(CYTHON_USE_PYTYPE_LOOKUP)
+  #ifndef CYTHON_USE_TYPE_SPECS
+    #define CYTHON_USE_TYPE_SPECS 0
+  #endif
+  #ifndef CYTHON_USE_PYTYPE_LOOKUP
     #define CYTHON_USE_PYTYPE_LOOKUP 1
   #endif
   #if PY_MAJOR_VERSION < 3
     #undef CYTHON_USE_ASYNC_SLOTS
     #define CYTHON_USE_ASYNC_SLOTS 0
   #elif !defined(CYTHON_USE_ASYNC_SLOTS)
     #define CYTHON_USE_ASYNC_SLOTS 1
   #endif
-  #if PY_VERSION_HEX < 0x02070000
-    #undef CYTHON_USE_PYLONG_INTERNALS
-    #define CYTHON_USE_PYLONG_INTERNALS 0
-  #elif !defined(CYTHON_USE_PYLONG_INTERNALS)
+  #ifndef CYTHON_USE_PYLONG_INTERNALS
     #define CYTHON_USE_PYLONG_INTERNALS 1
   #endif
   #ifndef CYTHON_USE_PYLIST_INTERNALS
     #define CYTHON_USE_PYLIST_INTERNALS 1
   #endif
   #ifndef CYTHON_USE_UNICODE_INTERNALS
     #define CYTHON_USE_UNICODE_INTERNALS 1
   #endif
-  #if PY_VERSION_HEX < 0x030300F0
+  #if PY_VERSION_HEX < 0x030300F0 || PY_VERSION_HEX >= 0x030B00A2
     #undef CYTHON_USE_UNICODE_WRITER
     #define CYTHON_USE_UNICODE_WRITER 0
   #elif !defined(CYTHON_USE_UNICODE_WRITER)
     #define CYTHON_USE_UNICODE_WRITER 1
   #endif
   #ifndef CYTHON_AVOID_BORROWED_REFS
     #define CYTHON_AVOID_BORROWED_REFS 0
@@ -217,35 +427,68 @@
   #endif
   #ifndef CYTHON_UNPACK_METHODS
     #define CYTHON_UNPACK_METHODS 1
   #endif
   #ifndef CYTHON_FAST_THREAD_STATE
     #define CYTHON_FAST_THREAD_STATE 1
   #endif
+  #ifndef CYTHON_FAST_GIL
+    #define CYTHON_FAST_GIL (PY_MAJOR_VERSION < 3 || PY_VERSION_HEX >= 0x03060000 && PY_VERSION_HEX < 0x030C00A6)
+  #endif
+  #ifndef CYTHON_METH_FASTCALL
+    #define CYTHON_METH_FASTCALL (PY_VERSION_HEX >= 0x030700A1)
+  #endif
   #ifndef CYTHON_FAST_PYCALL
     #define CYTHON_FAST_PYCALL 1
   #endif
-  #ifndef CYTHON_PEP489_MULTI_PHASE_INIT
-    #define CYTHON_PEP489_MULTI_PHASE_INIT (PY_VERSION_HEX >= 0x03050000)
-  #endif
-  #ifndef CYTHON_USE_TP_FINALIZE
-    #define CYTHON_USE_TP_FINALIZE (PY_VERSION_HEX >= 0x030400a1)
+  #ifndef CYTHON_PEP487_INIT_SUBCLASS
+    #define CYTHON_PEP487_INIT_SUBCLASS 1
   #endif
-  #ifndef CYTHON_USE_DICT_VERSIONS
-    #define CYTHON_USE_DICT_VERSIONS (PY_VERSION_HEX >= 0x030600B1)
+  #if PY_VERSION_HEX < 0x03050000
+    #undef CYTHON_PEP489_MULTI_PHASE_INIT
+    #define CYTHON_PEP489_MULTI_PHASE_INIT 0
+  #elif !defined(CYTHON_PEP489_MULTI_PHASE_INIT)
+    #define CYTHON_PEP489_MULTI_PHASE_INIT 1
+  #endif
+  #ifndef CYTHON_USE_MODULE_STATE
+    #define CYTHON_USE_MODULE_STATE 0
+  #endif
+  #if PY_VERSION_HEX < 0x030400a1
+    #undef CYTHON_USE_TP_FINALIZE
+    #define CYTHON_USE_TP_FINALIZE 0
+  #elif !defined(CYTHON_USE_TP_FINALIZE)
+    #define CYTHON_USE_TP_FINALIZE 1
+  #endif
+  #if PY_VERSION_HEX < 0x030600B1
+    #undef CYTHON_USE_DICT_VERSIONS
+    #define CYTHON_USE_DICT_VERSIONS 0
+  #elif !defined(CYTHON_USE_DICT_VERSIONS)
+    #define CYTHON_USE_DICT_VERSIONS  (PY_VERSION_HEX < 0x030C00A5)
+  #endif
+  #if PY_VERSION_HEX < 0x030700A3
+    #undef CYTHON_USE_EXC_INFO_STACK
+    #define CYTHON_USE_EXC_INFO_STACK 0
+  #elif !defined(CYTHON_USE_EXC_INFO_STACK)
+    #define CYTHON_USE_EXC_INFO_STACK 1
   #endif
-  #ifndef CYTHON_USE_EXC_INFO_STACK
-    #define CYTHON_USE_EXC_INFO_STACK (PY_VERSION_HEX >= 0x030700A3)
+  #ifndef CYTHON_UPDATE_DESCRIPTOR_DOC
+    #define CYTHON_UPDATE_DESCRIPTOR_DOC 1
   #endif
 #endif
 #if !defined(CYTHON_FAST_PYCCALL)
 #define CYTHON_FAST_PYCCALL  (CYTHON_FAST_PYCALL && PY_VERSION_HEX >= 0x030600B1)
 #endif
+#if !defined(CYTHON_VECTORCALL)
+#define CYTHON_VECTORCALL  (CYTHON_FAST_PYCCALL && PY_VERSION_HEX >= 0x030800B1)
+#endif
+#define CYTHON_BACKPORT_VECTORCALL (CYTHON_METH_FASTCALL && PY_VERSION_HEX < 0x030800B1)
 #if CYTHON_USE_PYLONG_INTERNALS
-  #include "longintrepr.h"
+  #if PY_MAJOR_VERSION < 3
+    #include "longintrepr.h"
+  #endif
   #undef SHIFT
   #undef BASE
   #undef MASK
   #ifdef SIZEOF_VOID_P
     enum { __pyx_check_sizeof_voidp = 1 / (int)(SIZEOF_VOID_P == sizeof(void*)) };
   #endif
 #endif
@@ -263,78 +506,128 @@
   #elif defined (__STDC_VERSION__) && __STDC_VERSION__ >= 199901L
     #define CYTHON_RESTRICT restrict
   #else
     #define CYTHON_RESTRICT
   #endif
 #endif
 #ifndef CYTHON_UNUSED
+  #if defined(__cplusplus)
+    /* for clang __has_cpp_attribute(maybe_unused) is true even before C++17
+     * but leads to warnings with -pedantic, since it is a C++17 feature */
+    #if ((defined(_MSVC_LANG) && _MSVC_LANG >= 201703L) || __cplusplus >= 201703L)
+      #if __has_cpp_attribute(maybe_unused)
+        #define CYTHON_UNUSED [[maybe_unused]]
+      #endif
+    #endif
+  #endif
+#endif
+#ifndef CYTHON_UNUSED
 # if defined(__GNUC__)
 #   if !(defined(__cplusplus)) || (__GNUC__ > 3 || (__GNUC__ == 3 && __GNUC_MINOR__ >= 4))
 #     define CYTHON_UNUSED __attribute__ ((__unused__))
 #   else
 #     define CYTHON_UNUSED
 #   endif
 # elif defined(__ICC) || (defined(__INTEL_COMPILER) && !defined(_MSC_VER))
 #   define CYTHON_UNUSED __attribute__ ((__unused__))
 # else
 #   define CYTHON_UNUSED
 # endif
 #endif
-#ifndef CYTHON_MAYBE_UNUSED_VAR
+#ifndef CYTHON_UNUSED_VAR
 #  if defined(__cplusplus)
-     template<class T> void CYTHON_MAYBE_UNUSED_VAR( const T& ) { }
+     template<class T> void CYTHON_UNUSED_VAR( const T& ) { }
 #  else
-#    define CYTHON_MAYBE_UNUSED_VAR(x) (void)(x)
+#    define CYTHON_UNUSED_VAR(x) (void)(x)
 #  endif
 #endif
+#ifndef CYTHON_MAYBE_UNUSED_VAR
+  #define CYTHON_MAYBE_UNUSED_VAR(x) CYTHON_UNUSED_VAR(x)
+#endif
 #ifndef CYTHON_NCP_UNUSED
 # if CYTHON_COMPILING_IN_CPYTHON
 #  define CYTHON_NCP_UNUSED
 # else
 #  define CYTHON_NCP_UNUSED CYTHON_UNUSED
 # endif
 #endif
 #define __Pyx_void_to_None(void_result) ((void)(void_result), Py_INCREF(Py_None), Py_None)
 #ifdef _MSC_VER
     #ifndef _MSC_STDINT_H_
         #if _MSC_VER < 1300
-           typedef unsigned char     uint8_t;
-           typedef unsigned int      uint32_t;
+            typedef unsigned char     uint8_t;
+            typedef unsigned short    uint16_t;
+            typedef unsigned int      uint32_t;
+        #else
+            typedef unsigned __int8   uint8_t;
+            typedef unsigned __int16  uint16_t;
+            typedef unsigned __int32  uint32_t;
+        #endif
+    #endif
+    #if _MSC_VER < 1300
+        #ifdef _WIN64
+            typedef unsigned long long  __pyx_uintptr_t;
         #else
-           typedef unsigned __int8   uint8_t;
-           typedef unsigned __int32  uint32_t;
+            typedef unsigned int        __pyx_uintptr_t;
+        #endif
+    #else
+        #ifdef _WIN64
+            typedef unsigned __int64    __pyx_uintptr_t;
+        #else
+            typedef unsigned __int32    __pyx_uintptr_t;
         #endif
     #endif
 #else
-   #include <stdint.h>
+    #include <stdint.h>
+    typedef uintptr_t  __pyx_uintptr_t;
 #endif
 #ifndef CYTHON_FALLTHROUGH
-  #if defined(__cplusplus) && __cplusplus >= 201103L
-    #if __has_cpp_attribute(fallthrough)
-      #define CYTHON_FALLTHROUGH [[fallthrough]]
-    #elif __has_cpp_attribute(clang::fallthrough)
-      #define CYTHON_FALLTHROUGH [[clang::fallthrough]]
-    #elif __has_cpp_attribute(gnu::fallthrough)
-      #define CYTHON_FALLTHROUGH [[gnu::fallthrough]]
+  #if defined(__cplusplus)
+    /* for clang __has_cpp_attribute(fallthrough) is true even before C++17
+     * but leads to warnings with -pedantic, since it is a C++17 feature */
+    #if ((defined(_MSVC_LANG) && _MSVC_LANG >= 201703L) || __cplusplus >= 201703L)
+      #if __has_cpp_attribute(fallthrough)
+        #define CYTHON_FALLTHROUGH [[fallthrough]]
+      #endif
+    #endif
+    #ifndef CYTHON_FALLTHROUGH
+      #if __has_cpp_attribute(clang::fallthrough)
+        #define CYTHON_FALLTHROUGH [[clang::fallthrough]]
+      #elif __has_cpp_attribute(gnu::fallthrough)
+        #define CYTHON_FALLTHROUGH [[gnu::fallthrough]]
+      #endif
     #endif
   #endif
   #ifndef CYTHON_FALLTHROUGH
     #if __has_attribute(fallthrough)
       #define CYTHON_FALLTHROUGH __attribute__((fallthrough))
     #else
       #define CYTHON_FALLTHROUGH
     #endif
   #endif
-  #if defined(__clang__ ) && defined(__apple_build_version__)
+  #if defined(__clang__) && defined(__apple_build_version__)
     #if __apple_build_version__ < 7000000
       #undef  CYTHON_FALLTHROUGH
       #define CYTHON_FALLTHROUGH
     #endif
   #endif
 #endif
+#ifdef __cplusplus
+  template <typename T>
+  struct __PYX_IS_UNSIGNED_IMPL {static const bool value = T(0) < T(-1);};
+  #define __PYX_IS_UNSIGNED(type) (__PYX_IS_UNSIGNED_IMPL<type>::value)
+#else
+  #define __PYX_IS_UNSIGNED(type) (((type)-1) > 0)
+#endif
+#if CYTHON_COMPILING_IN_PYPY == 1
+  #define __PYX_NEED_TP_PRINT_SLOT  (PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x030A0000)
+#else
+  #define __PYX_NEED_TP_PRINT_SLOT  (PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000)
+#endif
+#define __PYX_REINTERPRET_FUNCION(func_pointer, other_pointer) ((func_pointer)(void(*)(void))(other_pointer))
 
 #ifndef CYTHON_INLINE
   #if defined(__clang__)
     #define CYTHON_INLINE __inline__ __attribute__ ((__unused__))
   #elif defined(__GNUC__)
     #define CYTHON_INLINE __inline__
   #elif defined(_MSC_VER)
@@ -342,93 +635,225 @@
   #elif defined (__STDC_VERSION__) && __STDC_VERSION__ >= 199901L
     #define CYTHON_INLINE inline
   #else
     #define CYTHON_INLINE
   #endif
 #endif
 
-#if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX < 0x02070600 && !defined(Py_OptimizeFlag)
-  #define Py_OptimizeFlag 0
-#endif
 #define __PYX_BUILD_PY_SSIZE_T "n"
 #define CYTHON_FORMAT_SSIZE_T "z"
 #if PY_MAJOR_VERSION < 3
   #define __Pyx_BUILTIN_MODULE_NAME "__builtin__"
-  #define __Pyx_PyCode_New(a, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)\
-          PyCode_New(a+k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)
   #define __Pyx_DefaultClassType PyClass_Type
+  #define __Pyx_PyCode_New(a, p, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)\
+          PyCode_New(a+k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)
 #else
   #define __Pyx_BUILTIN_MODULE_NAME "builtins"
-#if PY_VERSION_HEX >= 0x030800A4 && PY_VERSION_HEX < 0x030800B2
-  #define __Pyx_PyCode_New(a, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)\
-          PyCode_New(a, 0, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)
+  #define __Pyx_DefaultClassType PyType_Type
+#if PY_VERSION_HEX >= 0x030B00A1
+    static CYTHON_INLINE PyCodeObject* __Pyx_PyCode_New(int a, int p, int k, int l, int s, int f,
+                                                    PyObject *code, PyObject *c, PyObject* n, PyObject *v,
+                                                    PyObject *fv, PyObject *cell, PyObject* fn,
+                                                    PyObject *name, int fline, PyObject *lnos) {
+        PyObject *kwds=NULL, *argcount=NULL, *posonlyargcount=NULL, *kwonlyargcount=NULL;
+        PyObject *nlocals=NULL, *stacksize=NULL, *flags=NULL, *replace=NULL, *empty=NULL;
+        const char *fn_cstr=NULL;
+        const char *name_cstr=NULL;
+        PyCodeObject *co=NULL, *result=NULL;
+        PyObject *type, *value, *traceback;
+        PyErr_Fetch(&type, &value, &traceback);
+        if (!(kwds=PyDict_New())) goto end;
+        if (!(argcount=PyLong_FromLong(a))) goto end;
+        if (PyDict_SetItemString(kwds, "co_argcount", argcount) != 0) goto end;
+        if (!(posonlyargcount=PyLong_FromLong(p))) goto end;
+        if (PyDict_SetItemString(kwds, "co_posonlyargcount", posonlyargcount) != 0) goto end;
+        if (!(kwonlyargcount=PyLong_FromLong(k))) goto end;
+        if (PyDict_SetItemString(kwds, "co_kwonlyargcount", kwonlyargcount) != 0) goto end;
+        if (!(nlocals=PyLong_FromLong(l))) goto end;
+        if (PyDict_SetItemString(kwds, "co_nlocals", nlocals) != 0) goto end;
+        if (!(stacksize=PyLong_FromLong(s))) goto end;
+        if (PyDict_SetItemString(kwds, "co_stacksize", stacksize) != 0) goto end;
+        if (!(flags=PyLong_FromLong(f))) goto end;
+        if (PyDict_SetItemString(kwds, "co_flags", flags) != 0) goto end;
+        if (PyDict_SetItemString(kwds, "co_code", code) != 0) goto end;
+        if (PyDict_SetItemString(kwds, "co_consts", c) != 0) goto end;
+        if (PyDict_SetItemString(kwds, "co_names", n) != 0) goto end;
+        if (PyDict_SetItemString(kwds, "co_varnames", v) != 0) goto end;
+        if (PyDict_SetItemString(kwds, "co_freevars", fv) != 0) goto end;
+        if (PyDict_SetItemString(kwds, "co_cellvars", cell) != 0) goto end;
+        if (PyDict_SetItemString(kwds, "co_linetable", lnos) != 0) goto end;
+        if (!(fn_cstr=PyUnicode_AsUTF8AndSize(fn, NULL))) goto end;
+        if (!(name_cstr=PyUnicode_AsUTF8AndSize(name, NULL))) goto end;
+        if (!(co = PyCode_NewEmpty(fn_cstr, name_cstr, fline))) goto end;
+        if (!(replace = PyObject_GetAttrString((PyObject*)co, "replace"))) goto end;
+        if (!(empty = PyTuple_New(0))) goto end;
+        result = (PyCodeObject*) PyObject_Call(replace, empty, kwds);
+    end:
+        Py_XDECREF((PyObject*) co);
+        Py_XDECREF(kwds);
+        Py_XDECREF(argcount);
+        Py_XDECREF(posonlyargcount);
+        Py_XDECREF(kwonlyargcount);
+        Py_XDECREF(nlocals);
+        Py_XDECREF(stacksize);
+        Py_XDECREF(replace);
+        Py_XDECREF(empty);
+        if (type) {
+            PyErr_Restore(type, value, traceback);
+        }
+        return result;
+    }
+#elif PY_VERSION_HEX >= 0x030800B2 && !CYTHON_COMPILING_IN_PYPY
+  #define __Pyx_PyCode_New(a, p, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)\
+          PyCode_NewWithPosOnlyArgs(a, p, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)
 #else
-  #define __Pyx_PyCode_New(a, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)\
+  #define __Pyx_PyCode_New(a, p, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)\
           PyCode_New(a, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)
 #endif
-  #define __Pyx_DefaultClassType PyType_Type
+#endif
+#if PY_VERSION_HEX >= 0x030900A4 || defined(Py_IS_TYPE)
+  #define __Pyx_IS_TYPE(ob, type) Py_IS_TYPE(ob, type)
+#else
+  #define __Pyx_IS_TYPE(ob, type) (((const PyObject*)ob)->ob_type == (type))
+#endif
+#if PY_VERSION_HEX >= 0x030A00B1 || defined(Py_Is)
+  #define __Pyx_Py_Is(x, y)  Py_Is(x, y)
+#else
+  #define __Pyx_Py_Is(x, y) ((x) == (y))
+#endif
+#if PY_VERSION_HEX >= 0x030A00B1 || defined(Py_IsNone)
+  #define __Pyx_Py_IsNone(ob) Py_IsNone(ob)
+#else
+  #define __Pyx_Py_IsNone(ob) __Pyx_Py_Is((ob), Py_None)
+#endif
+#if PY_VERSION_HEX >= 0x030A00B1 || defined(Py_IsTrue)
+  #define __Pyx_Py_IsTrue(ob) Py_IsTrue(ob)
+#else
+  #define __Pyx_Py_IsTrue(ob) __Pyx_Py_Is((ob), Py_True)
+#endif
+#if PY_VERSION_HEX >= 0x030A00B1 || defined(Py_IsFalse)
+  #define __Pyx_Py_IsFalse(ob) Py_IsFalse(ob)
+#else
+  #define __Pyx_Py_IsFalse(ob) __Pyx_Py_Is((ob), Py_False)
+#endif
+#define __Pyx_NoneAsNull(obj)  (__Pyx_Py_IsNone(obj) ? NULL : (obj))
+#if PY_VERSION_HEX >= 0x030900F0 && !CYTHON_COMPILING_IN_PYPY
+  #define __Pyx_PyObject_GC_IsFinalized(o) PyObject_GC_IsFinalized(o)
+#else
+  #define __Pyx_PyObject_GC_IsFinalized(o) _PyGC_FINALIZED(o)
+#endif
+#ifndef CO_COROUTINE
+  #define CO_COROUTINE 0x80
+#endif
+#ifndef CO_ASYNC_GENERATOR
+  #define CO_ASYNC_GENERATOR 0x200
 #endif
 #ifndef Py_TPFLAGS_CHECKTYPES
   #define Py_TPFLAGS_CHECKTYPES 0
 #endif
 #ifndef Py_TPFLAGS_HAVE_INDEX
   #define Py_TPFLAGS_HAVE_INDEX 0
 #endif
 #ifndef Py_TPFLAGS_HAVE_NEWBUFFER
   #define Py_TPFLAGS_HAVE_NEWBUFFER 0
 #endif
 #ifndef Py_TPFLAGS_HAVE_FINALIZE
   #define Py_TPFLAGS_HAVE_FINALIZE 0
 #endif
+#ifndef Py_TPFLAGS_SEQUENCE
+  #define Py_TPFLAGS_SEQUENCE 0
+#endif
+#ifndef Py_TPFLAGS_MAPPING
+  #define Py_TPFLAGS_MAPPING 0
+#endif
 #ifndef METH_STACKLESS
   #define METH_STACKLESS 0
 #endif
 #if PY_VERSION_HEX <= 0x030700A3 || !defined(METH_FASTCALL)
   #ifndef METH_FASTCALL
      #define METH_FASTCALL 0x80
   #endif
   typedef PyObject *(*__Pyx_PyCFunctionFast) (PyObject *self, PyObject *const *args, Py_ssize_t nargs);
   typedef PyObject *(*__Pyx_PyCFunctionFastWithKeywords) (PyObject *self, PyObject *const *args,
                                                           Py_ssize_t nargs, PyObject *kwnames);
 #else
   #define __Pyx_PyCFunctionFast _PyCFunctionFast
   #define __Pyx_PyCFunctionFastWithKeywords _PyCFunctionFastWithKeywords
 #endif
-#if CYTHON_FAST_PYCCALL
-#define __Pyx_PyFastCFunction_Check(func)\
-    ((PyCFunction_Check(func) && (METH_FASTCALL == (PyCFunction_GET_FLAGS(func) & ~(METH_CLASS | METH_STATIC | METH_COEXIST | METH_KEYWORDS | METH_STACKLESS)))))
+#if CYTHON_METH_FASTCALL
+  #define __Pyx_METH_FASTCALL METH_FASTCALL
+  #define __Pyx_PyCFunction_FastCall __Pyx_PyCFunctionFast
+  #define __Pyx_PyCFunction_FastCallWithKeywords __Pyx_PyCFunctionFastWithKeywords
+#else
+  #define __Pyx_METH_FASTCALL METH_VARARGS
+  #define __Pyx_PyCFunction_FastCall PyCFunction
+  #define __Pyx_PyCFunction_FastCallWithKeywords PyCFunctionWithKeywords
+#endif
+#if CYTHON_VECTORCALL
+  #define __pyx_vectorcallfunc vectorcallfunc
+  #define __Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET  PY_VECTORCALL_ARGUMENTS_OFFSET
+  #define __Pyx_PyVectorcall_NARGS(n)  PyVectorcall_NARGS((size_t)(n))
+#elif CYTHON_BACKPORT_VECTORCALL
+  typedef PyObject *(*__pyx_vectorcallfunc)(PyObject *callable, PyObject *const *args,
+                                            size_t nargsf, PyObject *kwnames);
+  #define __Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET  ((size_t)1 << (8 * sizeof(size_t) - 1))
+  #define __Pyx_PyVectorcall_NARGS(n)  ((Py_ssize_t)(((size_t)(n)) & ~__Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET))
+#else
+  #define __Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET  0
+  #define __Pyx_PyVectorcall_NARGS(n)  ((Py_ssize_t)(n))
+#endif
+#if PY_VERSION_HEX < 0x030900B1
+  #define __Pyx_PyType_FromModuleAndSpec(m, s, b)  ((void)m, PyType_FromSpecWithBases(s, b))
+  typedef PyObject *(*__Pyx_PyCMethod)(PyObject *, PyTypeObject *, PyObject *const *, size_t, PyObject *);
 #else
-#define __Pyx_PyFastCFunction_Check(func) 0
+  #define __Pyx_PyType_FromModuleAndSpec(m, s, b)  PyType_FromModuleAndSpec(m, s, b)
+  #define __Pyx_PyCMethod  PyCMethod
+#endif
+#ifndef METH_METHOD
+  #define METH_METHOD 0x200
 #endif
 #if CYTHON_COMPILING_IN_PYPY && !defined(PyObject_Malloc)
   #define PyObject_Malloc(s)   PyMem_Malloc(s)
   #define PyObject_Free(p)     PyMem_Free(p)
   #define PyObject_Realloc(p)  PyMem_Realloc(p)
 #endif
-#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX < 0x030400A1
-  #define PyMem_RawMalloc(n)           PyMem_Malloc(n)
-  #define PyMem_RawRealloc(p, n)       PyMem_Realloc(p, n)
-  #define PyMem_RawFree(p)             PyMem_Free(p)
-#endif
-#if CYTHON_COMPILING_IN_PYSTON
-  #define __Pyx_PyCode_HasFreeVars(co)  PyCode_HasFreeVars(co)
-  #define __Pyx_PyFrame_SetLineNumber(frame, lineno) PyFrame_SetLineNumber(frame, lineno)
+#if CYTHON_COMPILING_IN_LIMITED_API
+  #define __Pyx_PyCode_HasFreeVars(co)  (PyCode_GetNumFree(co) > 0)
+  #define __Pyx_PyFrame_SetLineNumber(frame, lineno)
 #else
   #define __Pyx_PyCode_HasFreeVars(co)  (PyCode_GetNumFree(co) > 0)
   #define __Pyx_PyFrame_SetLineNumber(frame, lineno)  (frame)->f_lineno = (lineno)
 #endif
-#if !CYTHON_FAST_THREAD_STATE || PY_VERSION_HEX < 0x02070000
+#if CYTHON_COMPILING_IN_LIMITED_API
+  #define __Pyx_PyThreadState_Current PyThreadState_Get()
+#elif !CYTHON_FAST_THREAD_STATE
   #define __Pyx_PyThreadState_Current PyThreadState_GET()
 #elif PY_VERSION_HEX >= 0x03060000
   #define __Pyx_PyThreadState_Current _PyThreadState_UncheckedGet()
 #elif PY_VERSION_HEX >= 0x03000000
   #define __Pyx_PyThreadState_Current PyThreadState_GET()
 #else
   #define __Pyx_PyThreadState_Current _PyThreadState_Current
 #endif
+#if CYTHON_COMPILING_IN_LIMITED_API
+static CYTHON_INLINE void *__Pyx_PyModule_GetState(PyObject *op)
+{
+    void *result;
+    result = PyModule_GetState(op);
+    if (!result)
+        Py_FatalError("Couldn't find the module state");
+    return result;
+}
+#endif
+#define __Pyx_PyObject_GetSlot(obj, name, func_ctype)  __Pyx_PyType_GetSlot(Py_TYPE(obj), name, func_ctype)
+#if CYTHON_COMPILING_IN_LIMITED_API
+  #define __Pyx_PyType_GetSlot(type, name, func_ctype)  ((func_ctype) PyType_GetSlot((type), Py_##name))
+#else
+  #define __Pyx_PyType_GetSlot(type, name, func_ctype)  ((type)->name)
+#endif
 #if PY_VERSION_HEX < 0x030700A2 && !defined(PyThread_tss_create) && !defined(Py_tss_NEEDS_INIT)
 #include "pythread.h"
 #define Py_tss_NEEDS_INIT 0
 typedef int Py_tss_t;
 static CYTHON_INLINE int PyThread_tss_create(Py_tss_t *key) {
   *key = PyThread_create_key();
   return 0;
@@ -451,78 +876,166 @@
 static CYTHON_INLINE int PyThread_tss_set(Py_tss_t *key, void *value) {
   return PyThread_set_key_value(*key, value);
 }
 static CYTHON_INLINE void * PyThread_tss_get(Py_tss_t *key) {
   return PyThread_get_key_value(*key);
 }
 #endif
+#if PY_MAJOR_VERSION < 3
+    #if CYTHON_COMPILING_IN_PYPY
+        #if PYPY_VERSION_NUM < 0x07030600
+            #if defined(__cplusplus) && __cplusplus >= 201402L
+                [[deprecated("`with nogil:` inside a nogil function will not release the GIL in PyPy2 < 7.3.6")]]
+            #elif defined(__GNUC__) || defined(__clang__)
+                __attribute__ ((__deprecated__("`with nogil:` inside a nogil function will not release the GIL in PyPy2 < 7.3.6")))
+            #elif defined(_MSC_VER)
+                __declspec(deprecated("`with nogil:` inside a nogil function will not release the GIL in PyPy2 < 7.3.6"))
+            #endif
+            static CYTHON_INLINE int PyGILState_Check(void) {
+                return 0;
+            }
+        #else  // PYPY_VERSION_NUM < 0x07030600
+        #endif  // PYPY_VERSION_NUM < 0x07030600
+    #else
+        static CYTHON_INLINE int PyGILState_Check(void) {
+            PyThreadState * tstate = _PyThreadState_Current;
+            return tstate && (tstate == PyGILState_GetThisThreadState());
+        }
+    #endif
+#endif
 #if CYTHON_COMPILING_IN_CPYTHON || defined(_PyDict_NewPresized)
 #define __Pyx_PyDict_NewPresized(n)  ((n <= 8) ? PyDict_New() : _PyDict_NewPresized(n))
 #else
 #define __Pyx_PyDict_NewPresized(n)  PyDict_New()
 #endif
 #if PY_MAJOR_VERSION >= 3 || CYTHON_FUTURE_DIVISION
   #define __Pyx_PyNumber_Divide(x,y)         PyNumber_TrueDivide(x,y)
   #define __Pyx_PyNumber_InPlaceDivide(x,y)  PyNumber_InPlaceTrueDivide(x,y)
 #else
   #define __Pyx_PyNumber_Divide(x,y)         PyNumber_Divide(x,y)
   #define __Pyx_PyNumber_InPlaceDivide(x,y)  PyNumber_InPlaceDivide(x,y)
 #endif
-#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x030500A1 && CYTHON_USE_UNICODE_INTERNALS
-#define __Pyx_PyDict_GetItemStr(dict, name)  _PyDict_GetItem_KnownHash(dict, name, ((PyASCIIObject *) name)->hash)
+#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX > 0x030600B4 && CYTHON_USE_UNICODE_INTERNALS
+#define __Pyx_PyDict_GetItemStrWithError(dict, name)  _PyDict_GetItem_KnownHash(dict, name, ((PyASCIIObject *) name)->hash)
+static CYTHON_INLINE PyObject * __Pyx_PyDict_GetItemStr(PyObject *dict, PyObject *name) {
+    PyObject *res = __Pyx_PyDict_GetItemStrWithError(dict, name);
+    if (res == NULL) PyErr_Clear();
+    return res;
+}
+#elif PY_MAJOR_VERSION >= 3 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07020000)
+#define __Pyx_PyDict_GetItemStrWithError  PyDict_GetItemWithError
+#define __Pyx_PyDict_GetItemStr           PyDict_GetItem
+#else
+static CYTHON_INLINE PyObject * __Pyx_PyDict_GetItemStrWithError(PyObject *dict, PyObject *name) {
+#if CYTHON_COMPILING_IN_PYPY
+    return PyDict_GetItem(dict, name);
+#else
+    PyDictEntry *ep;
+    PyDictObject *mp = (PyDictObject*) dict;
+    long hash = ((PyStringObject *) name)->ob_shash;
+    assert(hash != -1);
+    ep = (mp->ma_lookup)(mp, name, hash);
+    if (ep == NULL) {
+        return NULL;
+    }
+    return ep->me_value;
+#endif
+}
+#define __Pyx_PyDict_GetItemStr           PyDict_GetItem
+#endif
+#if CYTHON_USE_TYPE_SLOTS
+  #define __Pyx_PyType_GetFlags(tp)   (((PyTypeObject *)tp)->tp_flags)
+  #define __Pyx_PyType_HasFeature(type, feature)  ((__Pyx_PyType_GetFlags(type) & (feature)) != 0)
+  #define __Pyx_PyObject_GetIterNextFunc(obj)  (Py_TYPE(obj)->tp_iternext)
 #else
-#define __Pyx_PyDict_GetItemStr(dict, name)  PyDict_GetItem(dict, name)
+  #define __Pyx_PyType_GetFlags(tp)   (PyType_GetFlags((PyTypeObject *)tp))
+  #define __Pyx_PyType_HasFeature(type, feature)  PyType_HasFeature(type, feature)
+  #define __Pyx_PyObject_GetIterNextFunc(obj)  PyIter_Next
 #endif
-#if PY_VERSION_HEX > 0x03030000 && defined(PyUnicode_KIND)
+#if CYTHON_USE_TYPE_SPECS && PY_VERSION_HEX >= 0x03080000
+#define __Pyx_PyHeapTypeObject_GC_Del(obj)  {\
+    PyTypeObject *type = Py_TYPE(obj);\
+    assert(__Pyx_PyType_HasFeature(type, Py_TPFLAGS_HEAPTYPE));\
+    PyObject_GC_Del(obj);\
+    Py_DECREF(type);\
+}
+#else
+#define __Pyx_PyHeapTypeObject_GC_Del(obj)  PyObject_GC_Del(obj)
+#endif
+#if CYTHON_COMPILING_IN_LIMITED_API
+  #define CYTHON_PEP393_ENABLED 1
+  #define __Pyx_PyUnicode_READY(op)       (0)
+  #define __Pyx_PyUnicode_GET_LENGTH(u)   PyUnicode_GetLength(u)
+  #define __Pyx_PyUnicode_READ_CHAR(u, i) PyUnicode_ReadChar(u, i)
+  #define __Pyx_PyUnicode_MAX_CHAR_VALUE(u)   ((void)u, 1114111U)
+  #define __Pyx_PyUnicode_KIND(u)         ((void)u, (0))
+  #define __Pyx_PyUnicode_DATA(u)         ((void*)u)
+  #define __Pyx_PyUnicode_READ(k, d, i)   ((void)k, PyUnicode_ReadChar((PyObject*)(d), i))
+  #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != PyUnicode_GetLength(u))
+#elif PY_VERSION_HEX > 0x03030000 && defined(PyUnicode_KIND)
   #define CYTHON_PEP393_ENABLED 1
-  #define __Pyx_PyUnicode_READY(op)       (likely(PyUnicode_IS_READY(op)) ?\
-                                              0 : _PyUnicode_Ready((PyObject *)(op)))
+  #if PY_VERSION_HEX >= 0x030C0000
+    #define __Pyx_PyUnicode_READY(op)       (0)
+  #else
+    #define __Pyx_PyUnicode_READY(op)       (likely(PyUnicode_IS_READY(op)) ?\
+                                                0 : _PyUnicode_Ready((PyObject *)(op)))
+  #endif
   #define __Pyx_PyUnicode_GET_LENGTH(u)   PyUnicode_GET_LENGTH(u)
   #define __Pyx_PyUnicode_READ_CHAR(u, i) PyUnicode_READ_CHAR(u, i)
   #define __Pyx_PyUnicode_MAX_CHAR_VALUE(u)   PyUnicode_MAX_CHAR_VALUE(u)
-  #define __Pyx_PyUnicode_KIND(u)         PyUnicode_KIND(u)
+  #define __Pyx_PyUnicode_KIND(u)         ((int)PyUnicode_KIND(u))
   #define __Pyx_PyUnicode_DATA(u)         PyUnicode_DATA(u)
   #define __Pyx_PyUnicode_READ(k, d, i)   PyUnicode_READ(k, d, i)
-  #define __Pyx_PyUnicode_WRITE(k, d, i, ch)  PyUnicode_WRITE(k, d, i, ch)
-  #if defined(PyUnicode_IS_READY) && defined(PyUnicode_GET_SIZE)
-  #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != (likely(PyUnicode_IS_READY(u)) ? PyUnicode_GET_LENGTH(u) : PyUnicode_GET_SIZE(u)))
+  #define __Pyx_PyUnicode_WRITE(k, d, i, ch)  PyUnicode_WRITE(k, d, i, (Py_UCS4) ch)
+  #if PY_VERSION_HEX >= 0x030C0000
+    #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != PyUnicode_GET_LENGTH(u))
   #else
-  #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != PyUnicode_GET_LENGTH(u))
+    #if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x03090000
+    #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != (likely(PyUnicode_IS_READY(u)) ? PyUnicode_GET_LENGTH(u) : ((PyCompactUnicodeObject *)(u))->wstr_length))
+    #else
+    #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != (likely(PyUnicode_IS_READY(u)) ? PyUnicode_GET_LENGTH(u) : PyUnicode_GET_SIZE(u)))
+    #endif
   #endif
 #else
   #define CYTHON_PEP393_ENABLED 0
   #define PyUnicode_1BYTE_KIND  1
   #define PyUnicode_2BYTE_KIND  2
   #define PyUnicode_4BYTE_KIND  4
   #define __Pyx_PyUnicode_READY(op)       (0)
   #define __Pyx_PyUnicode_GET_LENGTH(u)   PyUnicode_GET_SIZE(u)
   #define __Pyx_PyUnicode_READ_CHAR(u, i) ((Py_UCS4)(PyUnicode_AS_UNICODE(u)[i]))
-  #define __Pyx_PyUnicode_MAX_CHAR_VALUE(u)   ((sizeof(Py_UNICODE) == 2) ? 65535 : 1114111)
-  #define __Pyx_PyUnicode_KIND(u)         (sizeof(Py_UNICODE))
+  #define __Pyx_PyUnicode_MAX_CHAR_VALUE(u)   ((sizeof(Py_UNICODE) == 2) ? 65535U : 1114111U)
+  #define __Pyx_PyUnicode_KIND(u)         ((int)sizeof(Py_UNICODE))
   #define __Pyx_PyUnicode_DATA(u)         ((void*)PyUnicode_AS_UNICODE(u))
   #define __Pyx_PyUnicode_READ(k, d, i)   ((void)(k), (Py_UCS4)(((Py_UNICODE*)d)[i]))
-  #define __Pyx_PyUnicode_WRITE(k, d, i, ch)  (((void)(k)), ((Py_UNICODE*)d)[i] = ch)
+  #define __Pyx_PyUnicode_WRITE(k, d, i, ch)  (((void)(k)), ((Py_UNICODE*)d)[i] = (Py_UNICODE) ch)
   #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != PyUnicode_GET_SIZE(u))
 #endif
 #if CYTHON_COMPILING_IN_PYPY
   #define __Pyx_PyUnicode_Concat(a, b)      PyNumber_Add(a, b)
   #define __Pyx_PyUnicode_ConcatSafe(a, b)  PyNumber_Add(a, b)
 #else
   #define __Pyx_PyUnicode_Concat(a, b)      PyUnicode_Concat(a, b)
   #define __Pyx_PyUnicode_ConcatSafe(a, b)  ((unlikely((a) == Py_None) || unlikely((b) == Py_None)) ?\
       PyNumber_Add(a, b) : __Pyx_PyUnicode_Concat(a, b))
 #endif
-#if CYTHON_COMPILING_IN_PYPY && !defined(PyUnicode_Contains)
-  #define PyUnicode_Contains(u, s)  PySequence_Contains(u, s)
-#endif
-#if CYTHON_COMPILING_IN_PYPY && !defined(PyByteArray_Check)
-  #define PyByteArray_Check(obj)  PyObject_TypeCheck(obj, &PyByteArray_Type)
-#endif
-#if CYTHON_COMPILING_IN_PYPY && !defined(PyObject_Format)
-  #define PyObject_Format(obj, fmt)  PyObject_CallMethod(obj, "__format__", "O", fmt)
+#if CYTHON_COMPILING_IN_PYPY
+  #if !defined(PyUnicode_DecodeUnicodeEscape)
+    #define PyUnicode_DecodeUnicodeEscape(s, size, errors)  PyUnicode_Decode(s, size, "unicode_escape", errors)
+  #endif
+  #if !defined(PyUnicode_Contains) || (PY_MAJOR_VERSION == 2 && PYPY_VERSION_NUM < 0x07030500)
+    #undef PyUnicode_Contains
+    #define PyUnicode_Contains(u, s)  PySequence_Contains(u, s)
+  #endif
+  #if !defined(PyByteArray_Check)
+    #define PyByteArray_Check(obj)  PyObject_TypeCheck(obj, &PyByteArray_Type)
+  #endif
+  #if !defined(PyObject_Format)
+    #define PyObject_Format(obj, fmt)  PyObject_CallMethod(obj, "__format__", "O", fmt)
+  #endif
 #endif
 #define __Pyx_PyString_FormatSafe(a, b)   ((unlikely((a) == Py_None || (PyString_Check(b) && !PyString_CheckExact(b)))) ? PyNumber_Remainder(a, b) : __Pyx_PyString_Format(a, b))
 #define __Pyx_PyUnicode_FormatSafe(a, b)  ((unlikely((a) == Py_None || (PyUnicode_Check(b) && !PyUnicode_CheckExact(b)))) ? PyNumber_Remainder(a, b) : PyUnicode_Format(a, b))
 #if PY_MAJOR_VERSION >= 3
   #define __Pyx_PyString_Format(a, b)  PyUnicode_Format(a, b)
 #else
   #define __Pyx_PyString_Format(a, b)  PyString_Format(a, b)
@@ -543,16 +1056,22 @@
 #if PY_MAJOR_VERSION >= 3
   #define __Pyx_PyBaseString_Check(obj) PyUnicode_Check(obj)
   #define __Pyx_PyBaseString_CheckExact(obj) PyUnicode_CheckExact(obj)
 #else
   #define __Pyx_PyBaseString_Check(obj) (PyString_Check(obj) || PyUnicode_Check(obj))
   #define __Pyx_PyBaseString_CheckExact(obj) (PyString_CheckExact(obj) || PyUnicode_CheckExact(obj))
 #endif
+#if CYTHON_COMPILING_IN_CPYTHON
+  #define __Pyx_PySequence_ListKeepNew(obj)\
+    (likely(PyList_CheckExact(obj) && Py_REFCNT(obj) == 1) ? __Pyx_NewRef(obj) : PySequence_List(obj))
+#else
+  #define __Pyx_PySequence_ListKeepNew(obj)  PySequence_List(obj)
+#endif
 #ifndef PySet_CheckExact
-  #define PySet_CheckExact(obj)        (Py_TYPE(obj) == &PySet_Type)
+  #define PySet_CheckExact(obj)        __Pyx_IS_TYPE(obj, &PySet_Type)
 #endif
 #if PY_VERSION_HEX >= 0x030900A4
   #define __Pyx_SET_REFCNT(obj, refcnt) Py_SET_REFCNT(obj, refcnt)
   #define __Pyx_SET_SIZE(obj, size) Py_SET_SIZE(obj, size)
 #else
   #define __Pyx_SET_REFCNT(obj, refcnt) Py_REFCNT(obj) = (refcnt)
   #define __Pyx_SET_SIZE(obj, size) Py_SIZE(obj) = (size)
@@ -563,46 +1082,46 @@
   #define __Pyx_PySequence_SIZE(seq)  PySequence_Size(seq)
 #endif
 #if PY_MAJOR_VERSION >= 3
   #define PyIntObject                  PyLongObject
   #define PyInt_Type                   PyLong_Type
   #define PyInt_Check(op)              PyLong_Check(op)
   #define PyInt_CheckExact(op)         PyLong_CheckExact(op)
+  #define __Pyx_Py3Int_Check(op)       PyLong_Check(op)
+  #define __Pyx_Py3Int_CheckExact(op)  PyLong_CheckExact(op)
   #define PyInt_FromString             PyLong_FromString
   #define PyInt_FromUnicode            PyLong_FromUnicode
   #define PyInt_FromLong               PyLong_FromLong
   #define PyInt_FromSize_t             PyLong_FromSize_t
   #define PyInt_FromSsize_t            PyLong_FromSsize_t
   #define PyInt_AsLong                 PyLong_AsLong
   #define PyInt_AS_LONG                PyLong_AS_LONG
   #define PyInt_AsSsize_t              PyLong_AsSsize_t
   #define PyInt_AsUnsignedLongMask     PyLong_AsUnsignedLongMask
   #define PyInt_AsUnsignedLongLongMask PyLong_AsUnsignedLongLongMask
   #define PyNumber_Int                 PyNumber_Long
+#else
+  #define __Pyx_Py3Int_Check(op)       (PyLong_Check(op) || PyInt_Check(op))
+  #define __Pyx_Py3Int_CheckExact(op)  (PyLong_CheckExact(op) || PyInt_CheckExact(op))
 #endif
 #if PY_MAJOR_VERSION >= 3
   #define PyBoolObject                 PyLongObject
 #endif
 #if PY_MAJOR_VERSION >= 3 && CYTHON_COMPILING_IN_PYPY
   #ifndef PyUnicode_InternFromString
     #define PyUnicode_InternFromString(s) PyUnicode_FromString(s)
   #endif
 #endif
 #if PY_VERSION_HEX < 0x030200A4
   typedef long Py_hash_t;
   #define __Pyx_PyInt_FromHash_t PyInt_FromLong
-  #define __Pyx_PyInt_AsHash_t   PyInt_AsLong
+  #define __Pyx_PyInt_AsHash_t   __Pyx_PyIndex_AsHash_t
 #else
   #define __Pyx_PyInt_FromHash_t PyInt_FromSsize_t
-  #define __Pyx_PyInt_AsHash_t   PyInt_AsSsize_t
-#endif
-#if PY_MAJOR_VERSION >= 3
-  #define __Pyx_PyMethod_New(func, self, klass) ((self) ? ((void)(klass), PyMethod_New(func, self)) : __Pyx_NewRef(func))
-#else
-  #define __Pyx_PyMethod_New(func, self, klass) PyMethod_New(func, self, klass)
+  #define __Pyx_PyInt_AsHash_t   __Pyx_PyIndex_AsSsize_t
 #endif
 #if CYTHON_USE_ASYNC_SLOTS
   #if PY_VERSION_HEX >= 0x030500B1
     #define __Pyx_PyAsyncMethodsStruct PyAsyncMethods
     #define __Pyx_PyType_AsAsync(obj) (Py_TYPE(obj)->tp_as_async)
   #else
     #define __Pyx_PyType_AsAsync(obj) ((__Pyx_PyAsyncMethodsStruct*) (Py_TYPE(obj)->tp_reserved))
@@ -614,16 +1133,18 @@
     typedef struct {
         unaryfunc am_await;
         unaryfunc am_aiter;
         unaryfunc am_anext;
     } __Pyx_PyAsyncMethodsStruct;
 #endif
 
-#if defined(WIN32) || defined(MS_WINDOWS)
-  #define _USE_MATH_DEFINES
+#if defined(_WIN32) || defined(WIN32) || defined(MS_WINDOWS)
+  #if !defined(_USE_MATH_DEFINES)
+    #define _USE_MATH_DEFINES
+  #endif
 #endif
 #include <math.h>
 #ifdef NAN
 #define __PYX_NAN() ((float) NAN)
 #else
 static CYTHON_INLINE float __PYX_NAN() {
   float value;
@@ -638,31 +1159,41 @@
 #endif
 
 #define __PYX_MARK_ERR_POS(f_index, lineno) \
     { __pyx_filename = __pyx_f[f_index]; (void)__pyx_filename; __pyx_lineno = lineno; (void)__pyx_lineno; __pyx_clineno = __LINE__; (void)__pyx_clineno; }
 #define __PYX_ERR(f_index, lineno, Ln_error) \
     { __PYX_MARK_ERR_POS(f_index, lineno) goto Ln_error; }
 
-#ifndef __PYX_EXTERN_C
+#ifdef CYTHON_EXTERN_C
+    #undef __PYX_EXTERN_C
+    #define __PYX_EXTERN_C CYTHON_EXTERN_C
+#elif defined(__PYX_EXTERN_C)
+    #ifdef _MSC_VER
+    #pragma message ("Please do not define the '__PYX_EXTERN_C' macro externally. Use 'CYTHON_EXTERN_C' instead.")
+    #else
+    #warning Please do not define the '__PYX_EXTERN_C' macro externally. Use 'CYTHON_EXTERN_C' instead.
+    #endif
+#else
   #ifdef __cplusplus
     #define __PYX_EXTERN_C extern "C"
   #else
     #define __PYX_EXTERN_C extern
   #endif
 #endif
 
-#define __PYX_HAVE__pyskynet__skynet_py_mq
-#define __PYX_HAVE_API__pyskynet__skynet_py_mq
+#define __PYX_HAVE__pyskynet__skynet_py_main
+#define __PYX_HAVE_API__pyskynet__skynet_py_main
 /* Early includes */
 #include <string.h>
 #include <stdio.h>
 #include "lua.h"
 #include "skynet.h"
 #include "skynet_foreign/skynet_foreign.h"
 #include "skynet_modify/skynet_py.h"
+#include "skynet_env.h"
 #ifdef _OPENMP
 #include <omp.h>
 #endif /* _OPENMP */
 
 #if defined(PYREX_WITHOUT_ASSERTIONS) && !defined(CYTHON_WITHOUT_ASSERTIONS)
 #define CYTHON_WITHOUT_ASSERTIONS
 #endif
@@ -723,54 +1254,111 @@
 #endif
 #define __Pyx_PyBytes_AsWritableString(s)     ((char*) PyBytes_AS_STRING(s))
 #define __Pyx_PyBytes_AsWritableSString(s)    ((signed char*) PyBytes_AS_STRING(s))
 #define __Pyx_PyBytes_AsWritableUString(s)    ((unsigned char*) PyBytes_AS_STRING(s))
 #define __Pyx_PyBytes_AsString(s)     ((const char*) PyBytes_AS_STRING(s))
 #define __Pyx_PyBytes_AsSString(s)    ((const signed char*) PyBytes_AS_STRING(s))
 #define __Pyx_PyBytes_AsUString(s)    ((const unsigned char*) PyBytes_AS_STRING(s))
-#define __Pyx_PyObject_AsWritableString(s)    ((char*) __Pyx_PyObject_AsString(s))
-#define __Pyx_PyObject_AsWritableSString(s)    ((signed char*) __Pyx_PyObject_AsString(s))
-#define __Pyx_PyObject_AsWritableUString(s)    ((unsigned char*) __Pyx_PyObject_AsString(s))
+#define __Pyx_PyObject_AsWritableString(s)    ((char*)(__pyx_uintptr_t) __Pyx_PyObject_AsString(s))
+#define __Pyx_PyObject_AsWritableSString(s)    ((signed char*)(__pyx_uintptr_t) __Pyx_PyObject_AsString(s))
+#define __Pyx_PyObject_AsWritableUString(s)    ((unsigned char*)(__pyx_uintptr_t) __Pyx_PyObject_AsString(s))
 #define __Pyx_PyObject_AsSString(s)    ((const signed char*) __Pyx_PyObject_AsString(s))
 #define __Pyx_PyObject_AsUString(s)    ((const unsigned char*) __Pyx_PyObject_AsString(s))
 #define __Pyx_PyObject_FromCString(s)  __Pyx_PyObject_FromString((const char*)s)
 #define __Pyx_PyBytes_FromCString(s)   __Pyx_PyBytes_FromString((const char*)s)
 #define __Pyx_PyByteArray_FromCString(s)   __Pyx_PyByteArray_FromString((const char*)s)
 #define __Pyx_PyStr_FromCString(s)     __Pyx_PyStr_FromString((const char*)s)
 #define __Pyx_PyUnicode_FromCString(s) __Pyx_PyUnicode_FromString((const char*)s)
-static CYTHON_INLINE size_t __Pyx_Py_UNICODE_strlen(const Py_UNICODE *u) {
+#if CYTHON_COMPILING_IN_LIMITED_API
+static CYTHON_INLINE size_t __Pyx_Py_UNICODE_strlen(const wchar_t *u)
+{
+    const wchar_t *u_end = u;
+    while (*u_end++) ;
+    return (size_t)(u_end - u - 1);
+}
+#else
+static CYTHON_INLINE size_t __Pyx_Py_UNICODE_strlen(const Py_UNICODE *u)
+{
     const Py_UNICODE *u_end = u;
     while (*u_end++) ;
     return (size_t)(u_end - u - 1);
 }
+#endif
+#define __Pyx_PyUnicode_FromOrdinal(o)       PyUnicode_FromOrdinal((int)o)
 #define __Pyx_PyUnicode_FromUnicode(u)       PyUnicode_FromUnicode(u, __Pyx_Py_UNICODE_strlen(u))
 #define __Pyx_PyUnicode_FromUnicodeAndLength PyUnicode_FromUnicode
 #define __Pyx_PyUnicode_AsUnicode            PyUnicode_AsUnicode
 #define __Pyx_NewRef(obj) (Py_INCREF(obj), obj)
 #define __Pyx_Owned_Py_None(b) __Pyx_NewRef(Py_None)
 static CYTHON_INLINE PyObject * __Pyx_PyBool_FromLong(long b);
 static CYTHON_INLINE int __Pyx_PyObject_IsTrue(PyObject*);
 static CYTHON_INLINE int __Pyx_PyObject_IsTrueAndDecref(PyObject*);
 static CYTHON_INLINE PyObject* __Pyx_PyNumber_IntOrLong(PyObject* x);
 #define __Pyx_PySequence_Tuple(obj)\
     (likely(PyTuple_CheckExact(obj)) ? __Pyx_NewRef(obj) : PySequence_Tuple(obj))
 static CYTHON_INLINE Py_ssize_t __Pyx_PyIndex_AsSsize_t(PyObject*);
 static CYTHON_INLINE PyObject * __Pyx_PyInt_FromSize_t(size_t);
+static CYTHON_INLINE Py_hash_t __Pyx_PyIndex_AsHash_t(PyObject*);
 #if CYTHON_ASSUME_SAFE_MACROS
 #define __pyx_PyFloat_AsDouble(x) (PyFloat_CheckExact(x) ? PyFloat_AS_DOUBLE(x) : PyFloat_AsDouble(x))
 #else
 #define __pyx_PyFloat_AsDouble(x) PyFloat_AsDouble(x)
 #endif
 #define __pyx_PyFloat_AsFloat(x) ((float) __pyx_PyFloat_AsDouble(x))
 #if PY_MAJOR_VERSION >= 3
 #define __Pyx_PyNumber_Int(x) (PyLong_CheckExact(x) ? __Pyx_NewRef(x) : PyNumber_Long(x))
 #else
 #define __Pyx_PyNumber_Int(x) (PyInt_CheckExact(x) ? __Pyx_NewRef(x) : PyNumber_Int(x))
 #endif
-#define __Pyx_PyNumber_Float(x) (PyFloat_CheckExact(x) ? __Pyx_NewRef(x) : PyNumber_Float(x))
+#if CYTHON_USE_PYLONG_INTERNALS
+  #if PY_VERSION_HEX >= 0x030C00A7
+  #ifndef _PyLong_SIGN_MASK
+    #define _PyLong_SIGN_MASK 3
+  #endif
+  #ifndef _PyLong_NON_SIZE_BITS
+    #define _PyLong_NON_SIZE_BITS 3
+  #endif
+  #define __Pyx_PyLong_Sign(x)  (((PyLongObject*)x)->long_value.lv_tag & _PyLong_SIGN_MASK)
+  #define __Pyx_PyLong_IsNeg(x)  ((__Pyx_PyLong_Sign(x) & 2) != 0)
+  #define __Pyx_PyLong_IsNonNeg(x)  (!__Pyx_PyLong_IsNeg(x))
+  #define __Pyx_PyLong_IsZero(x)  (__Pyx_PyLong_Sign(x) & 1)
+  #define __Pyx_PyLong_IsPos(x)  (__Pyx_PyLong_Sign(x) == 0)
+  #define __Pyx_PyLong_CompactValueUnsigned(x)  (__Pyx_PyLong_Digits(x)[0])
+  #define __Pyx_PyLong_DigitCount(x)  ((Py_ssize_t) (((PyLongObject*)x)->long_value.lv_tag >> _PyLong_NON_SIZE_BITS))
+  #define __Pyx_PyLong_SignedDigitCount(x)\
+        ((1 - (Py_ssize_t) __Pyx_PyLong_Sign(x)) * __Pyx_PyLong_DigitCount(x))
+  #if defined(PyUnstable_Long_IsCompact) && defined(PyUnstable_Long_CompactValue)
+    #define __Pyx_PyLong_IsCompact(x)     PyUnstable_Long_IsCompact((PyLongObject*) x)
+    #define __Pyx_PyLong_CompactValue(x)  PyUnstable_Long_CompactValue((PyLongObject*) x)
+  #else
+    #define __Pyx_PyLong_IsCompact(x)     (((PyLongObject*)x)->long_value.lv_tag < (2 << _PyLong_NON_SIZE_BITS))
+    #define __Pyx_PyLong_CompactValue(x)  ((1 - (Py_ssize_t) __Pyx_PyLong_Sign(x)) * (Py_ssize_t) __Pyx_PyLong_Digits(x)[0])
+  #endif
+  typedef Py_ssize_t  __Pyx_compact_pylong;
+  typedef size_t  __Pyx_compact_upylong;
+  #else  // Py < 3.12
+  #define __Pyx_PyLong_IsNeg(x)  (Py_SIZE(x) < 0)
+  #define __Pyx_PyLong_IsNonNeg(x)  (Py_SIZE(x) >= 0)
+  #define __Pyx_PyLong_IsZero(x)  (Py_SIZE(x) == 0)
+  #define __Pyx_PyLong_IsPos(x)  (Py_SIZE(x) > 0)
+  #define __Pyx_PyLong_CompactValueUnsigned(x)  ((Py_SIZE(x) == 0) ? 0 : __Pyx_PyLong_Digits(x)[0])
+  #define __Pyx_PyLong_DigitCount(x)  __Pyx_sst_abs(Py_SIZE(x))
+  #define __Pyx_PyLong_SignedDigitCount(x)  Py_SIZE(x)
+  #define __Pyx_PyLong_IsCompact(x)  (Py_SIZE(x) == 0 || Py_SIZE(x) == 1 || Py_SIZE(x) == -1)
+  #define __Pyx_PyLong_CompactValue(x)\
+        ((Py_SIZE(x) == 0) ? (sdigit) 0 : ((Py_SIZE(x) < 0) ? -(sdigit)__Pyx_PyLong_Digits(x)[0] : (sdigit)__Pyx_PyLong_Digits(x)[0]))
+  typedef sdigit  __Pyx_compact_pylong;
+  typedef digit  __Pyx_compact_upylong;
+  #endif
+  #if PY_VERSION_HEX >= 0x030C00A5
+  #define __Pyx_PyLong_Digits(x)  (((PyLongObject*)x)->long_value.ob_digit)
+  #else
+  #define __Pyx_PyLong_Digits(x)  (((PyLongObject*)x)->ob_digit)
+  #endif
+#endif
 #if PY_MAJOR_VERSION < 3 && __PYX_DEFAULT_STRING_ENCODING_IS_ASCII
 static int __Pyx_sys_getdefaultencoding_not_ascii;
 static int __Pyx_init_sys_getdefaultencoding_params(void) {
     PyObject* sys;
     PyObject* default_encoding = NULL;
     PyObject* ascii_chars_u = NULL;
     PyObject* ascii_chars_b = NULL;
@@ -784,15 +1372,15 @@
     if (!default_encoding_c) goto bad;
     if (strcmp(default_encoding_c, "ascii") == 0) {
         __Pyx_sys_getdefaultencoding_not_ascii = 0;
     } else {
         char ascii_chars[128];
         int c;
         for (c = 0; c < 128; c++) {
-            ascii_chars[c] = c;
+            ascii_chars[c] = (char) c;
         }
         __Pyx_sys_getdefaultencoding_not_ascii = 1;
         ascii_chars_u = PyUnicode_DecodeASCII(ascii_chars, 128, NULL);
         if (!ascii_chars_u) goto bad;
         ascii_chars_b = PyUnicode_AsEncodedString(ascii_chars_u, default_encoding_c, NULL);
         if (!ascii_chars_b || !PyBytes_Check(ascii_chars_b) || memcmp(ascii_chars, PyBytes_AS_STRING(ascii_chars_b), 128) != 0) {
             PyErr_Format(
@@ -849,129 +1437,216 @@
   #define unlikely(x) __builtin_expect(!!(x), 0)
 #else /* !__GNUC__ or GCC < 2.95 */
   #define likely(x)   (x)
   #define unlikely(x) (x)
 #endif /* __GNUC__ */
 static CYTHON_INLINE void __Pyx_pretend_to_initialize(void* ptr) { (void)ptr; }
 
+#if !CYTHON_USE_MODULE_STATE
 static PyObject *__pyx_m = NULL;
-static PyObject *__pyx_d;
-static PyObject *__pyx_b;
-static PyObject *__pyx_cython_runtime = NULL;
-static PyObject *__pyx_empty_tuple;
-static PyObject *__pyx_empty_bytes;
-static PyObject *__pyx_empty_unicode;
+#endif
 static int __pyx_lineno;
 static int __pyx_clineno = 0;
-static const char * __pyx_cfilenm= __FILE__;
+static const char * __pyx_cfilenm = __FILE__;
 static const char *__pyx_filename;
 
+/* #### Code section: filename_table ### */
 
 static const char *__pyx_f[] = {
-  "src/cy_src/skynet_py_mq.pyx",
+  "src/cy_src/skynet_py_main.pyx",
   "type.pxd",
 };
+/* #### Code section: utility_code_proto_before_types ### */
+/* #### Code section: numeric_typedefs ### */
+/* #### Code section: complex_type_declarations ### */
+/* #### Code section: type_declarations ### */
 
 /*--- Type declarations ---*/
 
+/* "src/cy_src/skynet_py_main.pyx":21
+ *     int skynet_py_refscript(const char*key, size_t sz);
+ * 
+ * ctypedef (char *)(* f_type)(object, object)             # <<<<<<<<<<<<<<
+ * 
+ * def init(ffi, async_send, async_handle):
+ */
+typedef char *(*__pyx_t_8pyskynet_14skynet_py_main_f_type)(PyObject *, PyObject *);
+/* #### Code section: utility_code_proto ### */
+
 /* --- Runtime support code (head) --- */
 /* Refnanny.proto */
 #ifndef CYTHON_REFNANNY
   #define CYTHON_REFNANNY 0
 #endif
 #if CYTHON_REFNANNY
   typedef struct {
-    void (*INCREF)(void*, PyObject*, int);
-    void (*DECREF)(void*, PyObject*, int);
-    void (*GOTREF)(void*, PyObject*, int);
-    void (*GIVEREF)(void*, PyObject*, int);
-    void* (*SetupContext)(const char*, int, const char*);
+    void (*INCREF)(void*, PyObject*, Py_ssize_t);
+    void (*DECREF)(void*, PyObject*, Py_ssize_t);
+    void (*GOTREF)(void*, PyObject*, Py_ssize_t);
+    void (*GIVEREF)(void*, PyObject*, Py_ssize_t);
+    void* (*SetupContext)(const char*, Py_ssize_t, const char*);
     void (*FinishContext)(void**);
   } __Pyx_RefNannyAPIStruct;
   static __Pyx_RefNannyAPIStruct *__Pyx_RefNanny = NULL;
   static __Pyx_RefNannyAPIStruct *__Pyx_RefNannyImportAPI(const char *modname);
   #define __Pyx_RefNannyDeclarations void *__pyx_refnanny = NULL;
 #ifdef WITH_THREAD
   #define __Pyx_RefNannySetupContext(name, acquire_gil)\
           if (acquire_gil) {\
               PyGILState_STATE __pyx_gilstate_save = PyGILState_Ensure();\
-              __pyx_refnanny = __Pyx_RefNanny->SetupContext((name), __LINE__, __FILE__);\
+              __pyx_refnanny = __Pyx_RefNanny->SetupContext((name), (__LINE__), (__FILE__));\
               PyGILState_Release(__pyx_gilstate_save);\
           } else {\
-              __pyx_refnanny = __Pyx_RefNanny->SetupContext((name), __LINE__, __FILE__);\
+              __pyx_refnanny = __Pyx_RefNanny->SetupContext((name), (__LINE__), (__FILE__));\
+          }
+  #define __Pyx_RefNannyFinishContextNogil() {\
+              PyGILState_STATE __pyx_gilstate_save = PyGILState_Ensure();\
+              __Pyx_RefNannyFinishContext();\
+              PyGILState_Release(__pyx_gilstate_save);\
           }
 #else
   #define __Pyx_RefNannySetupContext(name, acquire_gil)\
-          __pyx_refnanny = __Pyx_RefNanny->SetupContext((name), __LINE__, __FILE__)
+          __pyx_refnanny = __Pyx_RefNanny->SetupContext((name), (__LINE__), (__FILE__))
+  #define __Pyx_RefNannyFinishContextNogil() __Pyx_RefNannyFinishContext()
 #endif
+  #define __Pyx_RefNannyFinishContextNogil() {\
+              PyGILState_STATE __pyx_gilstate_save = PyGILState_Ensure();\
+              __Pyx_RefNannyFinishContext();\
+              PyGILState_Release(__pyx_gilstate_save);\
+          }
   #define __Pyx_RefNannyFinishContext()\
           __Pyx_RefNanny->FinishContext(&__pyx_refnanny)
-  #define __Pyx_INCREF(r)  __Pyx_RefNanny->INCREF(__pyx_refnanny, (PyObject *)(r), __LINE__)
-  #define __Pyx_DECREF(r)  __Pyx_RefNanny->DECREF(__pyx_refnanny, (PyObject *)(r), __LINE__)
-  #define __Pyx_GOTREF(r)  __Pyx_RefNanny->GOTREF(__pyx_refnanny, (PyObject *)(r), __LINE__)
-  #define __Pyx_GIVEREF(r) __Pyx_RefNanny->GIVEREF(__pyx_refnanny, (PyObject *)(r), __LINE__)
-  #define __Pyx_XINCREF(r)  do { if((r) != NULL) {__Pyx_INCREF(r); }} while(0)
-  #define __Pyx_XDECREF(r)  do { if((r) != NULL) {__Pyx_DECREF(r); }} while(0)
-  #define __Pyx_XGOTREF(r)  do { if((r) != NULL) {__Pyx_GOTREF(r); }} while(0)
-  #define __Pyx_XGIVEREF(r) do { if((r) != NULL) {__Pyx_GIVEREF(r);}} while(0)
+  #define __Pyx_INCREF(r)  __Pyx_RefNanny->INCREF(__pyx_refnanny, (PyObject *)(r), (__LINE__))
+  #define __Pyx_DECREF(r)  __Pyx_RefNanny->DECREF(__pyx_refnanny, (PyObject *)(r), (__LINE__))
+  #define __Pyx_GOTREF(r)  __Pyx_RefNanny->GOTREF(__pyx_refnanny, (PyObject *)(r), (__LINE__))
+  #define __Pyx_GIVEREF(r) __Pyx_RefNanny->GIVEREF(__pyx_refnanny, (PyObject *)(r), (__LINE__))
+  #define __Pyx_XINCREF(r)  do { if((r) == NULL); else {__Pyx_INCREF(r); }} while(0)
+  #define __Pyx_XDECREF(r)  do { if((r) == NULL); else {__Pyx_DECREF(r); }} while(0)
+  #define __Pyx_XGOTREF(r)  do { if((r) == NULL); else {__Pyx_GOTREF(r); }} while(0)
+  #define __Pyx_XGIVEREF(r) do { if((r) == NULL); else {__Pyx_GIVEREF(r);}} while(0)
 #else
   #define __Pyx_RefNannyDeclarations
   #define __Pyx_RefNannySetupContext(name, acquire_gil)
+  #define __Pyx_RefNannyFinishContextNogil()
   #define __Pyx_RefNannyFinishContext()
   #define __Pyx_INCREF(r) Py_INCREF(r)
   #define __Pyx_DECREF(r) Py_DECREF(r)
   #define __Pyx_GOTREF(r)
   #define __Pyx_GIVEREF(r)
   #define __Pyx_XINCREF(r) Py_XINCREF(r)
   #define __Pyx_XDECREF(r) Py_XDECREF(r)
   #define __Pyx_XGOTREF(r)
   #define __Pyx_XGIVEREF(r)
 #endif
+#define __Pyx_Py_XDECREF_SET(r, v) do {\
+        PyObject *tmp = (PyObject *) r;\
+        r = v; Py_XDECREF(tmp);\
+    } while (0)
 #define __Pyx_XDECREF_SET(r, v) do {\
         PyObject *tmp = (PyObject *) r;\
         r = v; __Pyx_XDECREF(tmp);\
     } while (0)
 #define __Pyx_DECREF_SET(r, v) do {\
         PyObject *tmp = (PyObject *) r;\
         r = v; __Pyx_DECREF(tmp);\
     } while (0)
 #define __Pyx_CLEAR(r)    do { PyObject* tmp = ((PyObject*)(r)); r = NULL; __Pyx_DECREF(tmp);} while(0)
 #define __Pyx_XCLEAR(r)   do { if((r) != NULL) {PyObject* tmp = ((PyObject*)(r)); r = NULL; __Pyx_DECREF(tmp);}} while(0)
 
-/* PyObjectGetAttrStr.proto */
-#if CYTHON_USE_TYPE_SLOTS
-static CYTHON_INLINE PyObject* __Pyx_PyObject_GetAttrStr(PyObject* obj, PyObject* attr_name);
+/* TupleAndListFromArray.proto */
+#if CYTHON_COMPILING_IN_CPYTHON
+static CYTHON_INLINE PyObject* __Pyx_PyList_FromArray(PyObject *const *src, Py_ssize_t n);
+static CYTHON_INLINE PyObject* __Pyx_PyTuple_FromArray(PyObject *const *src, Py_ssize_t n);
+#endif
+
+/* IncludeStringH.proto */
+#include <string.h>
+
+/* BytesEquals.proto */
+static CYTHON_INLINE int __Pyx_PyBytes_Equals(PyObject* s1, PyObject* s2, int equals);
+
+/* UnicodeEquals.proto */
+static CYTHON_INLINE int __Pyx_PyUnicode_Equals(PyObject* s1, PyObject* s2, int equals);
+
+/* fastcall.proto */
+#define __Pyx_Arg_VARARGS(args, i) PyTuple_GET_ITEM(args, i)
+#define __Pyx_NumKwargs_VARARGS(kwds) PyDict_Size(kwds)
+#define __Pyx_KwValues_VARARGS(args, nargs) NULL
+#define __Pyx_GetKwValue_VARARGS(kw, kwvalues, s) __Pyx_PyDict_GetItemStrWithError(kw, s)
+#define __Pyx_KwargsAsDict_VARARGS(kw, kwvalues) PyDict_Copy(kw)
+#if CYTHON_METH_FASTCALL
+    #define __Pyx_Arg_FASTCALL(args, i) args[i]
+    #define __Pyx_NumKwargs_FASTCALL(kwds) PyTuple_GET_SIZE(kwds)
+    #define __Pyx_KwValues_FASTCALL(args, nargs) ((args) + (nargs))
+    static CYTHON_INLINE PyObject * __Pyx_GetKwValue_FASTCALL(PyObject *kwnames, PyObject *const *kwvalues, PyObject *s);
+    #define __Pyx_KwargsAsDict_FASTCALL(kw, kwvalues) _PyStack_AsDict(kwvalues, kw)
+#else
+    #define __Pyx_Arg_FASTCALL __Pyx_Arg_VARARGS
+    #define __Pyx_NumKwargs_FASTCALL __Pyx_NumKwargs_VARARGS
+    #define __Pyx_KwValues_FASTCALL __Pyx_KwValues_VARARGS
+    #define __Pyx_GetKwValue_FASTCALL __Pyx_GetKwValue_VARARGS
+    #define __Pyx_KwargsAsDict_FASTCALL __Pyx_KwargsAsDict_VARARGS
+#endif
+#if CYTHON_COMPILING_IN_CPYTHON
+#define __Pyx_ArgsSlice_VARARGS(args, start, stop) __Pyx_PyTuple_FromArray(&__Pyx_Arg_VARARGS(args, start), stop - start)
+#define __Pyx_ArgsSlice_FASTCALL(args, start, stop) __Pyx_PyTuple_FromArray(&__Pyx_Arg_FASTCALL(args, start), stop - start)
 #else
-#define __Pyx_PyObject_GetAttrStr(o,n) PyObject_GetAttr(o,n)
+#define __Pyx_ArgsSlice_VARARGS(args, start, stop) PyTuple_GetSlice(args, start, stop)
+#define __Pyx_ArgsSlice_FASTCALL(args, start, stop) PyTuple_GetSlice(args, start, stop)
 #endif
 
-/* GetBuiltinName.proto */
-static PyObject *__Pyx_GetBuiltinName(PyObject *name);
+/* RaiseArgTupleInvalid.proto */
+static void __Pyx_RaiseArgtupleInvalid(const char* func_name, int exact,
+    Py_ssize_t num_min, Py_ssize_t num_max, Py_ssize_t num_found);
+
+/* RaiseDoubleKeywords.proto */
+static void __Pyx_RaiseDoubleKeywordsError(const char* func_name, PyObject* kw_name);
+
+/* ParseKeywords.proto */
+static int __Pyx_ParseOptionalKeywords(PyObject *kwds, PyObject *const *kwvalues,
+    PyObject **argnames[],
+    PyObject *kwds2, PyObject *values[], Py_ssize_t num_pos_args,
+    const char* function_name);
+
+/* PyErrExceptionMatches.proto */
+#if CYTHON_FAST_THREAD_STATE
+#define __Pyx_PyErr_ExceptionMatches(err) __Pyx_PyErr_ExceptionMatchesInState(__pyx_tstate, err)
+static CYTHON_INLINE int __Pyx_PyErr_ExceptionMatchesInState(PyThreadState* tstate, PyObject* err);
+#else
+#define __Pyx_PyErr_ExceptionMatches(err)  PyErr_ExceptionMatches(err)
+#endif
 
 /* PyThreadStateGet.proto */
 #if CYTHON_FAST_THREAD_STATE
 #define __Pyx_PyThreadState_declare  PyThreadState *__pyx_tstate;
 #define __Pyx_PyThreadState_assign  __pyx_tstate = __Pyx_PyThreadState_Current;
-#define __Pyx_PyErr_Occurred()  __pyx_tstate->curexc_type
+#if PY_VERSION_HEX >= 0x030C00A6
+#define __Pyx_PyErr_Occurred()  (__pyx_tstate->current_exception != NULL)
+#define __Pyx_PyErr_CurrentExceptionType()  (__pyx_tstate->current_exception ? (PyObject*) Py_TYPE(__pyx_tstate->current_exception) : (PyObject*) NULL)
+#else
+#define __Pyx_PyErr_Occurred()  (__pyx_tstate->curexc_type != NULL)
+#define __Pyx_PyErr_CurrentExceptionType()  (__pyx_tstate->curexc_type)
+#endif
 #else
 #define __Pyx_PyThreadState_declare
 #define __Pyx_PyThreadState_assign
-#define __Pyx_PyErr_Occurred()  PyErr_Occurred()
+#define __Pyx_PyErr_Occurred()  (PyErr_Occurred() != NULL)
+#define __Pyx_PyErr_CurrentExceptionType()  PyErr_Occurred()
 #endif
 
 /* PyErrFetchRestore.proto */
 #if CYTHON_FAST_THREAD_STATE
 #define __Pyx_PyErr_Clear() __Pyx_ErrRestore(NULL, NULL, NULL)
 #define __Pyx_ErrRestoreWithState(type, value, tb)  __Pyx_ErrRestoreInState(PyThreadState_GET(), type, value, tb)
 #define __Pyx_ErrFetchWithState(type, value, tb)    __Pyx_ErrFetchInState(PyThreadState_GET(), type, value, tb)
 #define __Pyx_ErrRestore(type, value, tb)  __Pyx_ErrRestoreInState(__pyx_tstate, type, value, tb)
 #define __Pyx_ErrFetch(type, value, tb)    __Pyx_ErrFetchInState(__pyx_tstate, type, value, tb)
 static CYTHON_INLINE void __Pyx_ErrRestoreInState(PyThreadState *tstate, PyObject *type, PyObject *value, PyObject *tb);
 static CYTHON_INLINE void __Pyx_ErrFetchInState(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb);
-#if CYTHON_COMPILING_IN_CPYTHON
+#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX < 0x030C00A6
 #define __Pyx_PyErr_SetNone(exc) (Py_INCREF(exc), __Pyx_ErrRestore((exc), NULL, NULL))
 #else
 #define __Pyx_PyErr_SetNone(exc) PyErr_SetNone(exc)
 #endif
 #else
 #define __Pyx_PyErr_Clear() PyErr_Clear()
 #define __Pyx_PyErr_SetNone(exc) PyErr_SetNone(exc)
@@ -979,78 +1654,26 @@
 #define __Pyx_ErrFetchWithState(type, value, tb)  PyErr_Fetch(type, value, tb)
 #define __Pyx_ErrRestoreInState(tstate, type, value, tb)  PyErr_Restore(type, value, tb)
 #define __Pyx_ErrFetchInState(tstate, type, value, tb)  PyErr_Fetch(type, value, tb)
 #define __Pyx_ErrRestore(type, value, tb)  PyErr_Restore(type, value, tb)
 #define __Pyx_ErrFetch(type, value, tb)  PyErr_Fetch(type, value, tb)
 #endif
 
-/* WriteUnraisableException.proto */
-static void __Pyx_WriteUnraisable(const char *name, int clineno,
-                                  int lineno, const char *filename,
-                                  int full_traceback, int nogil);
-
-/* RaiseArgTupleInvalid.proto */
-static void __Pyx_RaiseArgtupleInvalid(const char* func_name, int exact,
-    Py_ssize_t num_min, Py_ssize_t num_max, Py_ssize_t num_found);
-
-/* RaiseDoubleKeywords.proto */
-static void __Pyx_RaiseDoubleKeywordsError(const char* func_name, PyObject* kw_name);
-
-/* ParseKeywords.proto */
-static int __Pyx_ParseOptionalKeywords(PyObject *kwds, PyObject **argnames[],\
-    PyObject *kwds2, PyObject *values[], Py_ssize_t num_pos_args,\
-    const char* function_name);
-
-/* PyCFunctionFastCall.proto */
-#if CYTHON_FAST_PYCCALL
-static CYTHON_INLINE PyObject *__Pyx_PyCFunction_FastCall(PyObject *func, PyObject **args, Py_ssize_t nargs);
-#else
-#define __Pyx_PyCFunction_FastCall(func, args, nargs)  (assert(0), NULL)
-#endif
-
-/* PyFunctionFastCall.proto */
-#if CYTHON_FAST_PYCALL
-#define __Pyx_PyFunction_FastCall(func, args, nargs)\
-    __Pyx_PyFunction_FastCallDict((func), (args), (nargs), NULL)
-#if 1 || PY_VERSION_HEX < 0x030600B1
-static PyObject *__Pyx_PyFunction_FastCallDict(PyObject *func, PyObject **args, Py_ssize_t nargs, PyObject *kwargs);
-#else
-#define __Pyx_PyFunction_FastCallDict(func, args, nargs, kwargs) _PyFunction_FastCallDict(func, args, nargs, kwargs)
-#endif
-#define __Pyx_BUILD_ASSERT_EXPR(cond)\
-    (sizeof(char [1 - 2*!(cond)]) - 1)
-#ifndef Py_MEMBER_SIZE
-#define Py_MEMBER_SIZE(type, member) sizeof(((type *)0)->member)
-#endif
-  static size_t __pyx_pyframe_localsplus_offset = 0;
-  #include "frameobject.h"
-  #define __Pxy_PyFrame_Initialize_Offsets()\
-    ((void)__Pyx_BUILD_ASSERT_EXPR(sizeof(PyFrameObject) == offsetof(PyFrameObject, f_localsplus) + Py_MEMBER_SIZE(PyFrameObject, f_localsplus)),\
-     (void)(__pyx_pyframe_localsplus_offset = ((size_t)PyFrame_Type.tp_basicsize) - Py_MEMBER_SIZE(PyFrameObject, f_localsplus)))
-  #define __Pyx_PyFrame_GetLocalsplus(frame)\
-    (assert(__pyx_pyframe_localsplus_offset), (PyObject **)(((char *)(frame)) + __pyx_pyframe_localsplus_offset))
-#endif
-
-/* PyObjectCall.proto */
-#if CYTHON_COMPILING_IN_CPYTHON
-static CYTHON_INLINE PyObject* __Pyx_PyObject_Call(PyObject *func, PyObject *arg, PyObject *kw);
+/* PyObjectGetAttrStr.proto */
+#if CYTHON_USE_TYPE_SLOTS
+static CYTHON_INLINE PyObject* __Pyx_PyObject_GetAttrStr(PyObject* obj, PyObject* attr_name);
 #else
-#define __Pyx_PyObject_Call(func, arg, kw) PyObject_Call(func, arg, kw)
+#define __Pyx_PyObject_GetAttrStr(o,n) PyObject_GetAttr(o,n)
 #endif
 
-/* PyObjectCallMethO.proto */
-#if CYTHON_COMPILING_IN_CPYTHON
-static CYTHON_INLINE PyObject* __Pyx_PyObject_CallMethO(PyObject *func, PyObject *arg);
-#endif
+/* PyObjectGetAttrStrNoError.proto */
+static CYTHON_INLINE PyObject* __Pyx_PyObject_GetAttrStrNoError(PyObject* obj, PyObject* attr_name);
 
-/* PyObjectCallOneArg.proto */
-static CYTHON_INLINE PyObject* __Pyx_PyObject_CallOneArg(PyObject *func, PyObject *arg);
-
-/* RaiseException.proto */
-static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb, PyObject *cause);
+/* GetBuiltinName.proto */
+static PyObject *__Pyx_GetBuiltinName(PyObject *name);
 
 /* PyDictVersioning.proto */
 #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_TYPE_SLOTS
 #define __PYX_DICT_VERSION_INIT  ((PY_UINT64_T) -1)
 #define __PYX_GET_DICT_VERSION(dict)  (((PyDictObject*)(dict))->ma_version_tag)
 #define __PYX_UPDATE_DICT_CACHE(dict, value, cache_var, version_var)\
     (version_var) = __PYX_GET_DICT_VERSION(dict);\
@@ -1072,2721 +1695,2810 @@
 #define __PYX_GET_DICT_VERSION(dict)  (0)
 #define __PYX_UPDATE_DICT_CACHE(dict, value, cache_var, version_var)
 #define __PYX_PY_DICT_LOOKUP_IF_MODIFIED(VAR, DICT, LOOKUP)  (VAR) = (LOOKUP);
 #endif
 
 /* GetModuleGlobalName.proto */
 #if CYTHON_USE_DICT_VERSIONS
-#define __Pyx_GetModuleGlobalName(var, name)  {\
+#define __Pyx_GetModuleGlobalName(var, name)  do {\
     static PY_UINT64_T __pyx_dict_version = 0;\
     static PyObject *__pyx_dict_cached_value = NULL;\
     (var) = (likely(__pyx_dict_version == __PYX_GET_DICT_VERSION(__pyx_d))) ?\
         (likely(__pyx_dict_cached_value) ? __Pyx_NewRef(__pyx_dict_cached_value) : __Pyx_GetBuiltinName(name)) :\
         __Pyx__GetModuleGlobalName(name, &__pyx_dict_version, &__pyx_dict_cached_value);\
-}
-#define __Pyx_GetModuleGlobalNameUncached(var, name)  {\
+} while(0)
+#define __Pyx_GetModuleGlobalNameUncached(var, name)  do {\
     PY_UINT64_T __pyx_dict_version;\
     PyObject *__pyx_dict_cached_value;\
     (var) = __Pyx__GetModuleGlobalName(name, &__pyx_dict_version, &__pyx_dict_cached_value);\
-}
+} while(0)
 static PyObject *__Pyx__GetModuleGlobalName(PyObject *name, PY_UINT64_T *dict_version, PyObject **dict_cached_value);
 #else
 #define __Pyx_GetModuleGlobalName(var, name)  (var) = __Pyx__GetModuleGlobalName(name)
 #define __Pyx_GetModuleGlobalNameUncached(var, name)  (var) = __Pyx__GetModuleGlobalName(name)
 static CYTHON_INLINE PyObject *__Pyx__GetModuleGlobalName(PyObject *name);
 #endif
 
-/* PyObjectCallNoArg.proto */
-#if CYTHON_COMPILING_IN_CPYTHON
-static CYTHON_INLINE PyObject* __Pyx_PyObject_CallNoArg(PyObject *func);
+/* PyFunctionFastCall.proto */
+#if CYTHON_FAST_PYCALL
+#if !CYTHON_VECTORCALL
+#define __Pyx_PyFunction_FastCall(func, args, nargs)\
+    __Pyx_PyFunction_FastCallDict((func), (args), (nargs), NULL)
+static PyObject *__Pyx_PyFunction_FastCallDict(PyObject *func, PyObject **args, Py_ssize_t nargs, PyObject *kwargs);
+#endif
+#define __Pyx_BUILD_ASSERT_EXPR(cond)\
+    (sizeof(char [1 - 2*!(cond)]) - 1)
+#ifndef Py_MEMBER_SIZE
+#define Py_MEMBER_SIZE(type, member) sizeof(((type *)0)->member)
+#endif
+#if !CYTHON_VECTORCALL
+#if PY_VERSION_HEX >= 0x03080000
+  #include "frameobject.h"
+#if PY_VERSION_HEX >= 0x030b00a6
+  #ifndef Py_BUILD_CORE
+    #define Py_BUILD_CORE 1
+  #endif
+  #include "internal/pycore_frame.h"
+#endif
+  #define __Pxy_PyFrame_Initialize_Offsets()
+  #define __Pyx_PyFrame_GetLocalsplus(frame)  ((frame)->f_localsplus)
 #else
-#define __Pyx_PyObject_CallNoArg(func) __Pyx_PyObject_Call(func, __pyx_empty_tuple, NULL)
+  static size_t __pyx_pyframe_localsplus_offset = 0;
+  #include "frameobject.h"
+  #define __Pxy_PyFrame_Initialize_Offsets()\
+    ((void)__Pyx_BUILD_ASSERT_EXPR(sizeof(PyFrameObject) == offsetof(PyFrameObject, f_localsplus) + Py_MEMBER_SIZE(PyFrameObject, f_localsplus)),\
+     (void)(__pyx_pyframe_localsplus_offset = ((size_t)PyFrame_Type.tp_basicsize) - Py_MEMBER_SIZE(PyFrameObject, f_localsplus)))
+  #define __Pyx_PyFrame_GetLocalsplus(frame)\
+    (assert(__pyx_pyframe_localsplus_offset), (PyObject **)(((char *)(frame)) + __pyx_pyframe_localsplus_offset))
+#endif
+#endif
 #endif
 
-/* PyObjectSetAttrStr.proto */
-#if CYTHON_USE_TYPE_SLOTS
-#define __Pyx_PyObject_DelAttrStr(o,n) __Pyx_PyObject_SetAttrStr(o, n, NULL)
-static CYTHON_INLINE int __Pyx_PyObject_SetAttrStr(PyObject* obj, PyObject* attr_name, PyObject* value);
+/* PyObjectCall.proto */
+#if CYTHON_COMPILING_IN_CPYTHON
+static CYTHON_INLINE PyObject* __Pyx_PyObject_Call(PyObject *func, PyObject *arg, PyObject *kw);
 #else
-#define __Pyx_PyObject_DelAttrStr(o,n)   PyObject_DelAttr(o,n)
-#define __Pyx_PyObject_SetAttrStr(o,n,v) PyObject_SetAttr(o,n,v)
+#define __Pyx_PyObject_Call(func, arg, kw) PyObject_Call(func, arg, kw)
 #endif
 
-/* PySequenceContains.proto */
-static CYTHON_INLINE int __Pyx_PySequence_ContainsTF(PyObject* item, PyObject* seq, int eq) {
-    int result = PySequence_Contains(seq, item);
-    return unlikely(result < 0) ? result : (result == (eq == Py_EQ));
-}
-
-/* GetItemInt.proto */
-#define __Pyx_GetItemInt(o, i, type, is_signed, to_py_func, is_list, wraparound, boundscheck)\
-    (__Pyx_fits_Py_ssize_t(i, type, is_signed) ?\
-    __Pyx_GetItemInt_Fast(o, (Py_ssize_t)i, is_list, wraparound, boundscheck) :\
-    (is_list ? (PyErr_SetString(PyExc_IndexError, "list index out of range"), (PyObject*)NULL) :\
-               __Pyx_GetItemInt_Generic(o, to_py_func(i))))
-#define __Pyx_GetItemInt_List(o, i, type, is_signed, to_py_func, is_list, wraparound, boundscheck)\
-    (__Pyx_fits_Py_ssize_t(i, type, is_signed) ?\
-    __Pyx_GetItemInt_List_Fast(o, (Py_ssize_t)i, wraparound, boundscheck) :\
-    (PyErr_SetString(PyExc_IndexError, "list index out of range"), (PyObject*)NULL))
-static CYTHON_INLINE PyObject *__Pyx_GetItemInt_List_Fast(PyObject *o, Py_ssize_t i,
-                                                              int wraparound, int boundscheck);
-#define __Pyx_GetItemInt_Tuple(o, i, type, is_signed, to_py_func, is_list, wraparound, boundscheck)\
-    (__Pyx_fits_Py_ssize_t(i, type, is_signed) ?\
-    __Pyx_GetItemInt_Tuple_Fast(o, (Py_ssize_t)i, wraparound, boundscheck) :\
-    (PyErr_SetString(PyExc_IndexError, "tuple index out of range"), (PyObject*)NULL))
-static CYTHON_INLINE PyObject *__Pyx_GetItemInt_Tuple_Fast(PyObject *o, Py_ssize_t i,
-                                                              int wraparound, int boundscheck);
-static PyObject *__Pyx_GetItemInt_Generic(PyObject *o, PyObject* j);
-static CYTHON_INLINE PyObject *__Pyx_GetItemInt_Fast(PyObject *o, Py_ssize_t i,
-                                                     int is_list, int wraparound, int boundscheck);
-
-/* ObjectGetItem.proto */
-#if CYTHON_USE_TYPE_SLOTS
-static CYTHON_INLINE PyObject *__Pyx_PyObject_GetItem(PyObject *obj, PyObject* key);
-#else
-#define __Pyx_PyObject_GetItem(obj, key)  PyObject_GetItem(obj, key)
+/* PyObjectCallMethO.proto */
+#if CYTHON_COMPILING_IN_CPYTHON
+static CYTHON_INLINE PyObject* __Pyx_PyObject_CallMethO(PyObject *func, PyObject *arg);
 #endif
 
-/* PyObjectFormatAndDecref.proto */
-static CYTHON_INLINE PyObject* __Pyx_PyObject_FormatSimpleAndDecref(PyObject* s, PyObject* f);
-static CYTHON_INLINE PyObject* __Pyx_PyObject_FormatAndDecref(PyObject* s, PyObject* f);
+/* PyObjectFastCall.proto */
+#define __Pyx_PyObject_FastCall(func, args, nargs)  __Pyx_PyObject_FastCallDict(func, args, (size_t)(nargs), NULL)
+static CYTHON_INLINE PyObject* __Pyx_PyObject_FastCallDict(PyObject *func, PyObject **args, size_t nargs, PyObject *kwargs);
+
+/* PyObject_Str.proto */
+#define __Pyx_PyObject_Str(obj)\
+    (likely(PyString_CheckExact(obj)) ? __Pyx_NewRef(obj) : PyObject_Str(obj))
 
-/* IncludeStringH.proto */
-#include <string.h>
+/* PyObjectCallOneArg.proto */
+static CYTHON_INLINE PyObject* __Pyx_PyObject_CallOneArg(PyObject *func, PyObject *arg);
 
-/* JoinPyUnicode.proto */
-static PyObject* __Pyx_PyUnicode_Join(PyObject* value_tuple, Py_ssize_t value_count, Py_ssize_t result_ulength,
-                                      Py_UCS4 max_char);
+/* RaiseException.proto */
+static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb, PyObject *cause);
 
 /* TypeImport.proto */
-#ifndef __PYX_HAVE_RT_ImportType_proto
-#define __PYX_HAVE_RT_ImportType_proto
-enum __Pyx_ImportType_CheckSize {
-   __Pyx_ImportType_CheckSize_Error = 0,
-   __Pyx_ImportType_CheckSize_Warn = 1,
-   __Pyx_ImportType_CheckSize_Ignore = 2
+#ifndef __PYX_HAVE_RT_ImportType_proto_3_0_0
+#define __PYX_HAVE_RT_ImportType_proto_3_0_0
+#if defined (__STDC_VERSION__) && __STDC_VERSION__ >= 201112L
+#include <stdalign.h>
+#endif
+#if (defined (__STDC_VERSION__) && __STDC_VERSION__ >= 201112L) || __cplusplus >= 201103L
+#define __PYX_GET_STRUCT_ALIGNMENT_3_0_0(s) alignof(s)
+#else
+#define __PYX_GET_STRUCT_ALIGNMENT_3_0_0(s) sizeof(void*)
+#endif
+enum __Pyx_ImportType_CheckSize_3_0_0 {
+   __Pyx_ImportType_CheckSize_Error_3_0_0 = 0,
+   __Pyx_ImportType_CheckSize_Warn_3_0_0 = 1,
+   __Pyx_ImportType_CheckSize_Ignore_3_0_0 = 2
 };
-static PyTypeObject *__Pyx_ImportType(PyObject* module, const char *module_name, const char *class_name, size_t size, enum __Pyx_ImportType_CheckSize check_size);
+static PyTypeObject *__Pyx_ImportType_3_0_0(PyObject* module, const char *module_name, const char *class_name, size_t size, size_t alignment, enum __Pyx_ImportType_CheckSize_3_0_0 check_size);
+#endif
+
+/* Import.proto */
+static PyObject *__Pyx_Import(PyObject *name, PyObject *from_list, int level);
+
+/* ImportDottedModule.proto */
+static PyObject *__Pyx_ImportDottedModule(PyObject *name, PyObject *parts_tuple);
+#if PY_MAJOR_VERSION >= 3
+static PyObject *__Pyx_ImportDottedModule_WalkParts(PyObject *module, PyObject *name, PyObject *parts_tuple);
+#endif
+
+/* IncludeStructmemberH.proto */
+#include <structmember.h>
+
+/* FixUpExtensionType.proto */
+#if CYTHON_USE_TYPE_SPECS
+static int __Pyx_fix_up_extension_type_from_spec(PyType_Spec *spec, PyTypeObject *type);
 #endif
 
-/* CalculateMetaclass.proto */
-static PyObject *__Pyx_CalculateMetaclass(PyTypeObject *metaclass, PyObject *bases);
+/* FetchSharedCythonModule.proto */
+static PyObject *__Pyx_FetchSharedCythonABIModule(void);
 
 /* FetchCommonType.proto */
+#if !CYTHON_USE_TYPE_SPECS
 static PyTypeObject* __Pyx_FetchCommonType(PyTypeObject* type);
+#else
+static PyTypeObject* __Pyx_FetchCommonTypeFromSpec(PyObject *module, PyType_Spec *spec, PyObject *bases);
+#endif
+
+/* PyMethodNew.proto */
+#if PY_MAJOR_VERSION >= 3
+static PyObject *__Pyx_PyMethod_New(PyObject *func, PyObject *self, PyObject *typ) {
+    CYTHON_UNUSED_VAR(typ);
+    if (!self)
+        return __Pyx_NewRef(func);
+    return PyMethod_New(func, self);
+}
+#else
+    #define __Pyx_PyMethod_New PyMethod_New
+#endif
+
+/* PyVectorcallFastCallDict.proto */
+#if CYTHON_METH_FASTCALL
+static CYTHON_INLINE PyObject *__Pyx_PyVectorcall_FastCallDict(PyObject *func, __pyx_vectorcallfunc vc, PyObject *const *args, size_t nargs, PyObject *kw);
+#endif
 
 /* CythonFunctionShared.proto */
-#define __Pyx_CyFunction_USED 1
+#define __Pyx_CyFunction_USED
 #define __Pyx_CYFUNCTION_STATICMETHOD  0x01
 #define __Pyx_CYFUNCTION_CLASSMETHOD   0x02
 #define __Pyx_CYFUNCTION_CCLASS        0x04
+#define __Pyx_CYFUNCTION_COROUTINE     0x08
 #define __Pyx_CyFunction_GetClosure(f)\
     (((__pyx_CyFunctionObject *) (f))->func_closure)
-#define __Pyx_CyFunction_GetClassObj(f)\
-    (((__pyx_CyFunctionObject *) (f))->func_classobj)
+#if PY_VERSION_HEX < 0x030900B1
+  #define __Pyx_CyFunction_GetClassObj(f)\
+      (((__pyx_CyFunctionObject *) (f))->func_classobj)
+#else
+  #define __Pyx_CyFunction_GetClassObj(f)\
+      ((PyObject*) ((PyCMethodObject *) (f))->mm_class)
+#endif
+#define __Pyx_CyFunction_SetClassObj(f, classobj)\
+    __Pyx__CyFunction_SetClassObj((__pyx_CyFunctionObject *) (f), (classobj))
 #define __Pyx_CyFunction_Defaults(type, f)\
     ((type *)(((__pyx_CyFunctionObject *) (f))->defaults))
 #define __Pyx_CyFunction_SetDefaultsGetter(f, g)\
     ((__pyx_CyFunctionObject *) (f))->defaults_getter = (g)
 typedef struct {
+#if PY_VERSION_HEX < 0x030900B1
     PyCFunctionObject func;
+#else
+    PyCMethodObject func;
+#endif
+#if CYTHON_BACKPORT_VECTORCALL
+    __pyx_vectorcallfunc func_vectorcall;
+#endif
 #if PY_VERSION_HEX < 0x030500A0
     PyObject *func_weakreflist;
 #endif
     PyObject *func_dict;
     PyObject *func_name;
     PyObject *func_qualname;
     PyObject *func_doc;
     PyObject *func_globals;
     PyObject *func_code;
     PyObject *func_closure;
+#if PY_VERSION_HEX < 0x030900B1
     PyObject *func_classobj;
+#endif
     void *defaults;
     int defaults_pyobjects;
     size_t defaults_size;  // used by FusedFunction for copying defaults
     int flags;
     PyObject *defaults_tuple;
     PyObject *defaults_kwdict;
     PyObject *(*defaults_getter)(PyObject *);
     PyObject *func_annotations;
+    PyObject *func_is_coroutine;
 } __pyx_CyFunctionObject;
-static PyTypeObject *__pyx_CyFunctionType = 0;
-#define __Pyx_CyFunction_Check(obj)  (__Pyx_TypeCheck(obj, __pyx_CyFunctionType))
+#define __Pyx_CyFunction_Check(obj)  __Pyx_TypeCheck(obj, __pyx_CyFunctionType)
+#define __Pyx_IsCyOrPyCFunction(obj)  __Pyx_TypeCheck2(obj, __pyx_CyFunctionType, &PyCFunction_Type)
+#define __Pyx_CyFunction_CheckExact(obj)  __Pyx_IS_TYPE(obj, __pyx_CyFunctionType)
 static PyObject *__Pyx_CyFunction_Init(__pyx_CyFunctionObject* op, PyMethodDef *ml,
                                       int flags, PyObject* qualname,
-                                      PyObject *self,
+                                      PyObject *closure,
                                       PyObject *module, PyObject *globals,
                                       PyObject* code);
+static CYTHON_INLINE void __Pyx__CyFunction_SetClassObj(__pyx_CyFunctionObject* f, PyObject* classobj);
 static CYTHON_INLINE void *__Pyx_CyFunction_InitDefaults(PyObject *m,
                                                          size_t size,
                                                          int pyobjects);
 static CYTHON_INLINE void __Pyx_CyFunction_SetDefaultsTuple(PyObject *m,
                                                             PyObject *tuple);
 static CYTHON_INLINE void __Pyx_CyFunction_SetDefaultsKwDict(PyObject *m,
                                                              PyObject *dict);
 static CYTHON_INLINE void __Pyx_CyFunction_SetAnnotationsDict(PyObject *m,
                                                               PyObject *dict);
-static int __pyx_CyFunction_init(void);
+static int __pyx_CyFunction_init(PyObject *module);
+#if CYTHON_METH_FASTCALL
+static PyObject * __Pyx_CyFunction_Vectorcall_NOARGS(PyObject *func, PyObject *const *args, size_t nargsf, PyObject *kwnames);
+static PyObject * __Pyx_CyFunction_Vectorcall_O(PyObject *func, PyObject *const *args, size_t nargsf, PyObject *kwnames);
+static PyObject * __Pyx_CyFunction_Vectorcall_FASTCALL_KEYWORDS(PyObject *func, PyObject *const *args, size_t nargsf, PyObject *kwnames);
+static PyObject * __Pyx_CyFunction_Vectorcall_FASTCALL_KEYWORDS_METHOD(PyObject *func, PyObject *const *args, size_t nargsf, PyObject *kwnames);
+#if CYTHON_BACKPORT_VECTORCALL
+#define __Pyx_CyFunction_func_vectorcall(f) (((__pyx_CyFunctionObject*)f)->func_vectorcall)
+#else
+#define __Pyx_CyFunction_func_vectorcall(f) (((PyCFunctionObject*)f)->vectorcall)
+#endif
+#endif
 
 /* CythonFunction.proto */
 static PyObject *__Pyx_CyFunction_New(PyMethodDef *ml,
                                       int flags, PyObject* qualname,
                                       PyObject *closure,
                                       PyObject *module, PyObject *globals,
                                       PyObject* code);
 
-/* SetNameInClass.proto */
-#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x030500A1
-#define __Pyx_SetNameInClass(ns, name, value)\
-    (likely(PyDict_CheckExact(ns)) ? _PyDict_SetItem_KnownHash(ns, name, value, ((PyASCIIObject *) name)->hash) : PyObject_SetItem(ns, name, value))
-#elif CYTHON_COMPILING_IN_CPYTHON
-#define __Pyx_SetNameInClass(ns, name, value)\
-    (likely(PyDict_CheckExact(ns)) ? PyDict_SetItem(ns, name, value) : PyObject_SetItem(ns, name, value))
-#else
-#define __Pyx_SetNameInClass(ns, name, value)  PyObject_SetItem(ns, name, value)
-#endif
-
-/* Py3ClassCreate.proto */
-static PyObject *__Pyx_Py3MetaclassPrepare(PyObject *metaclass, PyObject *bases, PyObject *name, PyObject *qualname,
-                                           PyObject *mkw, PyObject *modname, PyObject *doc);
-static PyObject *__Pyx_Py3ClassCreate(PyObject *metaclass, PyObject *name, PyObject *bases, PyObject *dict,
-                                      PyObject *mkw, int calculate_metaclass, int allow_py2_metaclass);
-
-/* IterFinish.proto */
-static CYTHON_INLINE int __Pyx_IterFinish(void);
-
-/* PyObjectGetMethod.proto */
-static int __Pyx_PyObject_GetMethod(PyObject *obj, PyObject *name, PyObject **method);
-
-/* PyObjectCallMethod0.proto */
-static PyObject* __Pyx_PyObject_CallMethod0(PyObject* obj, PyObject* method_name);
-
-/* RaiseNeedMoreValuesToUnpack.proto */
-static CYTHON_INLINE void __Pyx_RaiseNeedMoreValuesError(Py_ssize_t index);
-
-/* RaiseTooManyValuesToUnpack.proto */
-static CYTHON_INLINE void __Pyx_RaiseTooManyValuesError(Py_ssize_t expected);
-
-/* UnpackItemEndCheck.proto */
-static int __Pyx_IternextUnpackEndCheck(PyObject *retval, Py_ssize_t expected);
-
-/* RaiseNoneIterError.proto */
-static CYTHON_INLINE void __Pyx_RaiseNoneNotIterableError(void);
-
-/* UnpackTupleError.proto */
-static void __Pyx_UnpackTupleError(PyObject *, Py_ssize_t index);
-
-/* UnpackTuple2.proto */
-#define __Pyx_unpack_tuple2(tuple, value1, value2, is_tuple, has_known_size, decref_tuple)\
-    (likely(is_tuple || PyTuple_Check(tuple)) ?\
-        (likely(has_known_size || PyTuple_GET_SIZE(tuple) == 2) ?\
-            __Pyx_unpack_tuple2_exact(tuple, value1, value2, decref_tuple) :\
-            (__Pyx_UnpackTupleError(tuple, 2), -1)) :\
-        __Pyx_unpack_tuple2_generic(tuple, value1, value2, has_known_size, decref_tuple))
-static CYTHON_INLINE int __Pyx_unpack_tuple2_exact(
-    PyObject* tuple, PyObject** value1, PyObject** value2, int decref_tuple);
-static int __Pyx_unpack_tuple2_generic(
-    PyObject* tuple, PyObject** value1, PyObject** value2, int has_known_size, int decref_tuple);
-
-/* dict_iter.proto */
-static CYTHON_INLINE PyObject* __Pyx_dict_iterator(PyObject* dict, int is_dict, PyObject* method_name,
-                                                   Py_ssize_t* p_orig_length, int* p_is_dict);
-static CYTHON_INLINE int __Pyx_dict_iter_next(PyObject* dict_or_iter, Py_ssize_t orig_length, Py_ssize_t* ppos,
-                                              PyObject** pkey, PyObject** pvalue, PyObject** pitem, int is_dict);
-
-/* SliceObject.proto */
-static CYTHON_INLINE PyObject* __Pyx_PyObject_GetSlice(
-        PyObject* obj, Py_ssize_t cstart, Py_ssize_t cstop,
-        PyObject** py_start, PyObject** py_stop, PyObject** py_slice,
-        int has_cstart, int has_cstop, int wraparound);
-
 /* CLineInTraceback.proto */
 #ifdef CYTHON_CLINE_IN_TRACEBACK
 #define __Pyx_CLineForTraceback(tstate, c_line)  (((CYTHON_CLINE_IN_TRACEBACK)) ? c_line : 0)
 #else
 static int __Pyx_CLineForTraceback(PyThreadState *tstate, int c_line);
 #endif
 
 /* CodeObjectCache.proto */
+#if !CYTHON_COMPILING_IN_LIMITED_API
 typedef struct {
     PyCodeObject* code_object;
     int code_line;
 } __Pyx_CodeObjectCacheEntry;
 struct __Pyx_CodeObjectCache {
     int count;
     int max_count;
     __Pyx_CodeObjectCacheEntry* entries;
 };
 static struct __Pyx_CodeObjectCache __pyx_code_cache = {0,0,NULL};
 static int __pyx_bisect_code_objects(__Pyx_CodeObjectCacheEntry* entries, int count, int code_line);
 static PyCodeObject *__pyx_find_code_object(int code_line);
 static void __pyx_insert_code_object(int code_line, PyCodeObject* code_object);
+#endif
 
 /* AddTraceback.proto */
 static void __Pyx_AddTraceback(const char *funcname, int c_line,
                                int py_line, const char *filename);
 
-/* CIntToPy.proto */
-static CYTHON_INLINE PyObject* __Pyx_PyInt_From_uint32_t(uint32_t value);
-
-/* CIntToPy.proto */
-static CYTHON_INLINE PyObject* __Pyx_PyInt_From_int(int value);
+/* GCCDiagnostics.proto */
+#if !defined(__INTEL_COMPILER) && defined(__GNUC__) && (__GNUC__ > 4 || (__GNUC__ == 4 && __GNUC_MINOR__ >= 6))
+#define __Pyx_HAS_GCC_DIAGNOSTIC
+#endif
 
 /* CIntFromPy.proto */
 static CYTHON_INLINE int __Pyx_PyInt_As_int(PyObject *);
 
 /* CIntFromPy.proto */
 static CYTHON_INLINE size_t __Pyx_PyInt_As_size_t(PyObject *);
 
-/* GetAttr.proto */
-static CYTHON_INLINE PyObject *__Pyx_GetAttr(PyObject *, PyObject *);
+/* CIntToPy.proto */
+static CYTHON_INLINE PyObject* __Pyx_PyInt_From_int(int value);
+
+/* CIntToPy.proto */
+static CYTHON_INLINE PyObject* __Pyx_PyInt_From_uint32_t(uint32_t value);
 
-/* Globals.proto */
-static PyObject* __Pyx_Globals(void);
+/* FormatTypeName.proto */
+#if CYTHON_COMPILING_IN_LIMITED_API
+typedef PyObject *__Pyx_TypeName;
+#define __Pyx_FMT_TYPENAME "%U"
+static __Pyx_TypeName __Pyx_PyType_GetName(PyTypeObject* tp);
+#define __Pyx_DECREF_TypeName(obj) Py_XDECREF(obj)
+#else
+typedef const char *__Pyx_TypeName;
+#define __Pyx_FMT_TYPENAME "%.200s"
+#define __Pyx_PyType_GetName(tp) ((tp)->tp_name)
+#define __Pyx_DECREF_TypeName(obj)
+#endif
 
 /* CIntToPy.proto */
 static CYTHON_INLINE PyObject* __Pyx_PyInt_From_long(long value);
 
 /* CIntFromPy.proto */
 static CYTHON_INLINE long __Pyx_PyInt_As_long(PyObject *);
 
 /* FastTypeChecks.proto */
 #if CYTHON_COMPILING_IN_CPYTHON
 #define __Pyx_TypeCheck(obj, type) __Pyx_IsSubtype(Py_TYPE(obj), (PyTypeObject *)type)
+#define __Pyx_TypeCheck2(obj, type1, type2) __Pyx_IsAnySubtype2(Py_TYPE(obj), (PyTypeObject *)type1, (PyTypeObject *)type2)
 static CYTHON_INLINE int __Pyx_IsSubtype(PyTypeObject *a, PyTypeObject *b);
+static CYTHON_INLINE int __Pyx_IsAnySubtype2(PyTypeObject *cls, PyTypeObject *a, PyTypeObject *b);
 static CYTHON_INLINE int __Pyx_PyErr_GivenExceptionMatches(PyObject *err, PyObject *type);
 static CYTHON_INLINE int __Pyx_PyErr_GivenExceptionMatches2(PyObject *err, PyObject *type1, PyObject *type2);
 #else
 #define __Pyx_TypeCheck(obj, type) PyObject_TypeCheck(obj, (PyTypeObject *)type)
+#define __Pyx_TypeCheck2(obj, type1, type2) (PyObject_TypeCheck(obj, (PyTypeObject *)type1) || PyObject_TypeCheck(obj, (PyTypeObject *)type2))
 #define __Pyx_PyErr_GivenExceptionMatches(err, type) PyErr_GivenExceptionMatches(err, type)
 #define __Pyx_PyErr_GivenExceptionMatches2(err, type1, type2) (PyErr_GivenExceptionMatches(err, type1) || PyErr_GivenExceptionMatches(err, type2))
 #endif
+#define __Pyx_PyErr_ExceptionMatches2(err1, err2)  __Pyx_PyErr_GivenExceptionMatches2(__Pyx_PyErr_CurrentExceptionType(), err1, err2)
 #define __Pyx_PyException_Check(obj) __Pyx_TypeCheck(obj, PyExc_Exception)
 
 /* CheckBinaryVersion.proto */
 static int __Pyx_check_binary_version(void);
 
 /* InitStrings.proto */
 static int __Pyx_InitStrings(__Pyx_StringTabEntry *t);
 
+/* #### Code section: module_declarations ### */
 
-/* Module declarations from 'cpython.pycapsule' */
-
-/* Module declarations from 'cpython.unicode' */
-
-/* Module declarations from 'libc.string' */
+/* Module declarations from "cpython.pycapsule" */
 
-/* Module declarations from 'libc.stdio' */
+/* Module declarations from "libc.string" */
 
-/* Module declarations from '__builtin__' */
+/* Module declarations from "libc.stdio" */
 
-/* Module declarations from 'cpython.type' */
-static PyTypeObject *__pyx_ptype_7cpython_4type_type = 0;
+/* Module declarations from "__builtin__" */
 
-/* Module declarations from 'cpython' */
+/* Module declarations from "cpython.type" */
 
-/* Module declarations from 'cpython.object' */
+/* Module declarations from "cpython" */
 
-/* Module declarations from 'cpython.bytes' */
+/* Module declarations from "cpython.object" */
 
-/* Module declarations from 'cpython.ref' */
+/* Module declarations from "cpython.bytes" */
 
-/* Module declarations from 'skynet_py' */
+/* Module declarations from "skynet_py" */
 
-/* Module declarations from 'pyskynet.skynet_py_mq' */
-static void __pyx_f_8pyskynet_12skynet_py_mq_free_pyptr(PyObject *); /*proto*/
-#define __Pyx_MODULE_NAME "pyskynet.skynet_py_mq"
-extern int __pyx_module_is_main_pyskynet__skynet_py_mq;
-int __pyx_module_is_main_pyskynet__skynet_py_mq = 0;
+/* Module declarations from "pyskynet.skynet_py_main" */
+static PyObject *__pyx_f_8pyskynet_14skynet_py_main___check_bytes(PyObject *); /*proto*/
+/* #### Code section: typeinfo ### */
+/* #### Code section: before_global_var ### */
+#define __Pyx_MODULE_NAME "pyskynet.skynet_py_main"
+extern int __pyx_module_is_main_pyskynet__skynet_py_main;
+int __pyx_module_is_main_pyskynet__skynet_py_main = 0;
 
-/* Implementation of 'pyskynet.skynet_py_mq' */
-static PyObject *__pyx_builtin_object;
-static const char __pyx_k_b[] = "b";
-static const char __pyx_k_s[] = "s";
-static const char __pyx_k__2[] = "";
-static const char __pyx_k_id[] = "id";
-static const char __pyx_k_doc[] = "__doc__";
-static const char __pyx_k_dst[] = "dst";
+/* Implementation of "pyskynet.skynet_py_main" */
+/* #### Code section: global_var ### */
+/* #### Code section: string_decls ### */
+static const char __pyx_k__4[] = "*";
+static const char __pyx_k_sz[] = "sz";
+static const char __pyx_k__22[] = "?";
+static const char __pyx_k_ffi[] = "ffi";
 static const char __pyx_k_key[] = "key";
-static const char __pyx_k_msg[] = "msg";
 static const char __pyx_k_ptr[] = "ptr";
 static const char __pyx_k_ret[] = "ret";
-static const char __pyx_k_dict[] = "__dict__";
-static const char __pyx_k_init[] = "__init__";
+static const char __pyx_k_exit[] = "exit";
+static const char __pyx_k_init[] = "init";
 static const char __pyx_k_main[] = "__main__";
-static const char __pyx_k_name[] = "name";
+static const char __pyx_k_name[] = "__name__";
 static const char __pyx_k_self[] = "self";
-static const char __pyx_k_size[] = "size";
+static const char __pyx_k_spec[] = "__spec__";
 static const char __pyx_k_test[] = "__test__";
-static const char __pyx_k_crecv[] = "crecv";
-static const char __pyx_k_csend[] = "csend";
-static const char __pyx_k_items[] = "items";
-static const char __pyx_k_lower[] = "lower";
-static const char __pyx_k_decode[] = "decode";
-static const char __pyx_k_module[] = "__module__";
-static const char __pyx_k_name_2[] = "__name__";
-static const char __pyx_k_object[] = "object";
-static const char __pyx_k_py_dst[] = "py_dst";
-static const char __pyx_k_py_msg[] = "py_msg";
-static const char __pyx_k_capsule[] = "capsule";
-static const char __pyx_k_dstname[] = "dstname";
-static const char __pyx_k_prepare[] = "__prepare__";
-static const char __pyx_k_py_size[] = "py_size";
-static const char __pyx_k_session[] = "session";
-static const char __pyx_k_tobytes[] = "tobytes";
-static const char __pyx_k_type_id[] = "type_id";
-static const char __pyx_k_qualname[] = "__qualname__";
-static const char __pyx_k_tostring[] = "tostring";
-static const char __pyx_k_PTYPEEnum[] = "PTYPEEnum";
-static const char __pyx_k_PTYPE_LUA[] = "PTYPE_LUA";
-static const char __pyx_k_metaclass[] = "__metaclass__";
-static const char __pyx_k_PTYPE_SNAX[] = "PTYPE_SNAX";
-static const char __pyx_k_PTYPE_TEXT[] = "PTYPE_TEXT";
-static const char __pyx_k_is_builtin[] = "is_builtin";
-static const char __pyx_k_py_session[] = "py_session";
-static const char __pyx_k_PTYPE_DEBUG[] = "PTYPE_DEBUG";
-static const char __pyx_k_PTYPE_ERROR[] = "PTYPE_ERROR";
-static const char __pyx_k_PTYPE_QUEUE[] = "PTYPE_QUEUE";
-static const char __pyx_k_PTYPE_TRACE[] = "PTYPE_TRACE";
-static const char __pyx_k_PTYPE_CLIENT[] = "PTYPE_CLIENT";
-static const char __pyx_k_PTYPE_HARBOR[] = "PTYPE_HARBOR";
-static const char __pyx_k_PTYPE_SOCKET[] = "PTYPE_SOCKET";
-static const char __pyx_k_PTYPE_SYSTEM[] = "PTYPE_SYSTEM";
-static const char __pyx_k_SKYNET_PTYPE[] = "SKYNET_PTYPE";
-static const char __pyx_k_must_bind_id[] = " must bind id=";
-static const char __pyx_k_py_dst_bytes[] = "py_dst_bytes";
-static const char __pyx_k_py_msg_bytes[] = "py_msg_bytes";
-static const char __pyx_k_PTYPE_FOREIGN[] = "PTYPE_FOREIGN";
-static const char __pyx_k_PTYPE_RESPONSE[] = "PTYPE_RESPONSE";
-static const char __pyx_k_must_bind_name[] = " must bind name=";
-static const char __pyx_k_PTYPE_MULTICAST[] = "PTYPE_MULTICAST";
-static const char __pyx_k_PTYPEEnum___init[] = "PTYPEEnum.__init__";
-static const char __pyx_k_PTYPE_TAG_DONTCOPY[] = "PTYPE_TAG_DONTCOPY";
+static const char __pyx_k_C_API[] = "_C_API";
+static const char __pyx_k_index[] = "index";
+static const char __pyx_k_py_sz[] = "py_sz";
+static const char __pyx_k_start[] = "start";
+static const char __pyx_k_utf_8[] = "utf-8";
+static const char __pyx_k_value[] = "value";
+static const char __pyx_k_config[] = "config";
+static const char __pyx_k_encode[] = "encode";
+static const char __pyx_k_import[] = "__import__";
+static const char __pyx_k_script[] = "script";
+static const char __pyx_k_thread[] = "thread";
+static const char __pyx_k_typeof[] = "typeof";
+static const char __pyx_k_getlenv[] = "getlenv";
+static const char __pyx_k_nextenv[] = "nextenv";
+static const char __pyx_k_profile[] = "profile";
+static const char __pyx_k_setlenv[] = "setlenv";
+static const char __pyx_k_getscript[] = "getscript";
+static const char __pyx_k_refscript[] = "refscript";
+static const char __pyx_k_async_send[] = "async_send";
+static const char __pyx_k_async_handle[] = "async_handle";
+static const char __pyx_k_cffi_backend[] = "_cffi_backend";
+static const char __pyx_k_cffi_exports[] = "_cffi_exports";
+static const char __pyx_k_initializing[] = "_initializing";
+static const char __pyx_k_is_coroutine[] = "_is_coroutine";
+static const char __pyx_k_capsule_or_bytes[] = "capsule_or_bytes";
+static const char __pyx_k_cffi_to_c_pointer[] = "_cffi_to_c_pointer";
+static const char __pyx_k_asyncio_coroutines[] = "asyncio.coroutines";
 static const char __pyx_k_cline_in_traceback[] = "cline_in_traceback";
-static const char __pyx_k_user_assert_id_name[] = "user_assert_id_name";
-static const char __pyx_k_PTYPE_FOREIGN_REMOTE[] = "PTYPE_FOREIGN_REMOTE";
-static const char __pyx_k_skynet_proto_type_id[] = "skynet proto type id=";
-static const char __pyx_k_pyskynet_skynet_py_mq[] = "pyskynet.skynet_py_mq";
-static const char __pyx_k_PTYPE_TAG_ALLOCSESSION[] = "PTYPE_TAG_ALLOCSESSION";
-static const char __pyx_k_package_is_too_large_s[] = "package is too large:%s";
-static const char __pyx_k_skynet_proto_type_name[] = "skynet proto type name=";
-static const char __pyx_k_SKYNET_PTYPE_id_to_name[] = "SKYNET_PTYPE_id_to_name";
-static const char __pyx_k_SKYNET_PTYPE_name_to_id[] = "SKYNET_PTYPE_name_to_id";
-static const char __pyx_k_src_cy_src_skynet_py_mq_pyx[] = "src/cy_src/skynet_py_mq.pyx";
-static const char __pyx_k_SKYNET_PTYPE_user_builtin_ids[] = "SKYNET_PTYPE_user_builtin_ids";
-static const char __pyx_k_capsule_unpack_failed_for_name_s[] = "capsule unpack failed for name = %s";
-static const char __pyx_k_skynet_proto_can_only_register_b[] = "skynet proto can only register builtin proto 'lua' or 'client' or 'socket' or 'text' or 'foreign' or 'foreign_remote', but get name=%s";
-static const char __pyx_k_skynet_proto_type_id_must_be_les[] = "skynet proto type id must be less than 256 but get id=%s";
-static const char __pyx_k_skynet_threads_has_not_been_star[] = "skynet threads has not been started yet, call 'pyskynet.start()' first.";
-static const char __pyx_k_type_s_unexcept_when_skynet_csen[] = "type:%s unexcept when skynet csend";
-static PyObject *__pyx_n_s_PTYPEEnum;
-static PyObject *__pyx_n_s_PTYPEEnum___init;
-static PyObject *__pyx_n_s_PTYPE_CLIENT;
-static PyObject *__pyx_n_s_PTYPE_DEBUG;
-static PyObject *__pyx_n_s_PTYPE_ERROR;
-static PyObject *__pyx_n_s_PTYPE_FOREIGN;
-static PyObject *__pyx_n_s_PTYPE_FOREIGN_REMOTE;
-static PyObject *__pyx_n_s_PTYPE_HARBOR;
-static PyObject *__pyx_n_s_PTYPE_LUA;
-static PyObject *__pyx_n_s_PTYPE_MULTICAST;
-static PyObject *__pyx_n_s_PTYPE_QUEUE;
-static PyObject *__pyx_n_s_PTYPE_RESPONSE;
-static PyObject *__pyx_n_s_PTYPE_SNAX;
-static PyObject *__pyx_n_s_PTYPE_SOCKET;
-static PyObject *__pyx_n_s_PTYPE_SYSTEM;
-static PyObject *__pyx_n_s_PTYPE_TAG_ALLOCSESSION;
-static PyObject *__pyx_n_s_PTYPE_TAG_DONTCOPY;
-static PyObject *__pyx_n_s_PTYPE_TEXT;
-static PyObject *__pyx_n_s_PTYPE_TRACE;
-static PyObject *__pyx_n_s_SKYNET_PTYPE;
-static PyObject *__pyx_n_s_SKYNET_PTYPE_id_to_name;
-static PyObject *__pyx_n_s_SKYNET_PTYPE_name_to_id;
-static PyObject *__pyx_n_s_SKYNET_PTYPE_user_builtin_ids;
-static PyObject *__pyx_kp_b__2;
-static PyObject *__pyx_n_s_b;
-static PyObject *__pyx_n_s_capsule;
-static PyObject *__pyx_kp_u_capsule_unpack_failed_for_name_s;
-static PyObject *__pyx_n_s_cline_in_traceback;
-static PyObject *__pyx_n_s_crecv;
-static PyObject *__pyx_n_s_csend;
-static PyObject *__pyx_n_s_decode;
-static PyObject *__pyx_n_s_dict;
-static PyObject *__pyx_n_s_doc;
-static PyObject *__pyx_n_s_dst;
-static PyObject *__pyx_n_s_dstname;
-static PyObject *__pyx_n_s_id;
-static PyObject *__pyx_n_s_init;
-static PyObject *__pyx_n_s_is_builtin;
-static PyObject *__pyx_n_s_items;
-static PyObject *__pyx_n_s_key;
-static PyObject *__pyx_n_s_lower;
-static PyObject *__pyx_n_s_main;
-static PyObject *__pyx_n_s_metaclass;
-static PyObject *__pyx_n_s_module;
-static PyObject *__pyx_n_s_msg;
-static PyObject *__pyx_kp_u_must_bind_id;
-static PyObject *__pyx_kp_u_must_bind_name;
-static PyObject *__pyx_n_s_name;
-static PyObject *__pyx_n_s_name_2;
-static PyObject *__pyx_n_s_object;
-static PyObject *__pyx_kp_u_package_is_too_large_s;
-static PyObject *__pyx_n_s_prepare;
-static PyObject *__pyx_n_s_ptr;
-static PyObject *__pyx_n_s_py_dst;
-static PyObject *__pyx_n_s_py_dst_bytes;
-static PyObject *__pyx_n_s_py_msg;
-static PyObject *__pyx_n_s_py_msg_bytes;
-static PyObject *__pyx_n_s_py_session;
-static PyObject *__pyx_n_s_py_size;
-static PyObject *__pyx_n_s_pyskynet_skynet_py_mq;
-static PyObject *__pyx_n_s_qualname;
-static PyObject *__pyx_n_s_ret;
-static PyObject *__pyx_n_s_s;
-static PyObject *__pyx_n_s_self;
-static PyObject *__pyx_n_s_session;
-static PyObject *__pyx_n_s_size;
-static PyObject *__pyx_kp_u_skynet_proto_can_only_register_b;
-static PyObject *__pyx_kp_u_skynet_proto_type_id;
-static PyObject *__pyx_kp_u_skynet_proto_type_id_must_be_les;
-static PyObject *__pyx_kp_u_skynet_proto_type_name;
-static PyObject *__pyx_kp_u_skynet_threads_has_not_been_star;
-static PyObject *__pyx_kp_s_src_cy_src_skynet_py_mq_pyx;
-static PyObject *__pyx_n_s_test;
-static PyObject *__pyx_n_s_tobytes;
-static PyObject *__pyx_n_s_tostring;
-static PyObject *__pyx_n_s_type_id;
-static PyObject *__pyx_kp_u_type_s_unexcept_when_skynet_csen;
-static PyObject *__pyx_n_s_user_assert_id_name;
-static PyObject *__pyx_pf_8pyskynet_12skynet_py_mq_crecv(CYTHON_UNUSED PyObject *__pyx_self); /* proto */
-static PyObject *__pyx_pf_8pyskynet_12skynet_py_mq_2csend(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_py_dst, int __pyx_v_type_id, PyObject *__pyx_v_py_session, PyObject *__pyx_v_py_msg, PyObject *__pyx_v_py_size); /* proto */
-static PyObject *__pyx_pf_8pyskynet_12skynet_py_mq_4tostring(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_capsule, size_t __pyx_v_size); /* proto */
-static PyObject *__pyx_pf_8pyskynet_12skynet_py_mq_6tobytes(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_capsule, size_t __pyx_v_size); /* proto */
-static PyObject *__pyx_pf_8pyskynet_12skynet_py_mq_9PTYPEEnum___init__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self); /* proto */
-static PyObject *__pyx_pf_8pyskynet_12skynet_py_mq_8user_assert_id_name(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_id, PyObject *__pyx_v_name); /* proto */
-static PyObject *__pyx_int_0;
-static PyObject *__pyx_int_6;
-static PyObject *__pyx_int_12;
-static PyObject *__pyx_int_255;
-static PyObject *__pyx_tuple_;
-static PyObject *__pyx_tuple__3;
-static PyObject *__pyx_tuple__4;
-static PyObject *__pyx_tuple__6;
-static PyObject *__pyx_tuple__8;
-static PyObject *__pyx_slice__15;
-static PyObject *__pyx_tuple__10;
-static PyObject *__pyx_tuple__12;
-static PyObject *__pyx_tuple__13;
-static PyObject *__pyx_tuple__16;
-static PyObject *__pyx_codeobj__5;
-static PyObject *__pyx_codeobj__7;
-static PyObject *__pyx_codeobj__9;
-static PyObject *__pyx_codeobj__11;
-static PyObject *__pyx_codeobj__14;
-static PyObject *__pyx_codeobj__17;
-/* Late includes */
-
-/* "src/cy_src/skynet_py_mq.pyx":13
- * 
- * 
- * cdef void free_pyptr(object capsule):             # <<<<<<<<<<<<<<
- *     cdef void *ptr = PyCapsule_GetPointer(capsule, "pyptr")
- *     skynet_free(ptr)
+static const char __pyx_k_pyskynet_skynet_py_main[] = "pyskynet.skynet_py_main";
+static const char __pyx_k_setlenv_but_key_conflict[] = "setlenv but key conflict";
+static const char __pyx_k_getlenv_but_value_not_existed[] = "getlenv but value not existed";
+static const char __pyx_k_src_cy_src_skynet_py_main_pyx[] = "src/cy_src/skynet_py_main.pyx";
+static const char __pyx_k_type_s_can_t_convert_to_bytes[] = "type %s can't convert to bytes";
+static const char __pyx_k_skynet_py_env_value_must_be_byte[] = "skynet_py env value must be bytes or pointer";
+/* #### Code section: decls ### */
+static PyObject *__pyx_pf_8pyskynet_14skynet_py_main_init(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_ffi, PyObject *__pyx_v_async_send, PyObject *__pyx_v_async_handle); /* proto */
+static PyObject *__pyx_pf_8pyskynet_14skynet_py_main_2setlenv(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_key, PyObject *__pyx_v_capsule_or_bytes, PyObject *__pyx_v_py_sz); /* proto */
+static PyObject *__pyx_pf_8pyskynet_14skynet_py_main_4getlenv(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_key); /* proto */
+static PyObject *__pyx_pf_8pyskynet_14skynet_py_main_6nextenv(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_key); /* proto */
+static PyObject *__pyx_pf_8pyskynet_14skynet_py_main_8refscript(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_script); /* proto */
+static PyObject *__pyx_pf_8pyskynet_14skynet_py_main_10getscript(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_index); /* proto */
+static PyObject *__pyx_pf_8pyskynet_14skynet_py_main_12start(CYTHON_UNUSED PyObject *__pyx_self, int __pyx_v_thread, int __pyx_v_profile); /* proto */
+static PyObject *__pyx_pf_8pyskynet_14skynet_py_main_14exit(CYTHON_UNUSED PyObject *__pyx_self); /* proto */
+static PyObject *__pyx_pf_8pyskynet_14skynet_py_main_16self(CYTHON_UNUSED PyObject *__pyx_self); /* proto */
+/* #### Code section: late_includes ### */
+/* #### Code section: module_state ### */
+typedef struct {
+  PyObject *__pyx_d;
+  PyObject *__pyx_b;
+  PyObject *__pyx_cython_runtime;
+  PyObject *__pyx_empty_tuple;
+  PyObject *__pyx_empty_bytes;
+  PyObject *__pyx_empty_unicode;
+  #ifdef __Pyx_CyFunction_USED
+  PyTypeObject *__pyx_CyFunctionType;
+  #endif
+  #ifdef __Pyx_FusedFunction_USED
+  PyTypeObject *__pyx_FusedFunctionType;
+  #endif
+  #ifdef __Pyx_Generator_USED
+  PyTypeObject *__pyx_GeneratorType;
+  #endif
+  #ifdef __Pyx_IterableCoroutine_USED
+  PyTypeObject *__pyx_IterableCoroutineType;
+  #endif
+  #ifdef __Pyx_Coroutine_USED
+  PyTypeObject *__pyx_CoroutineAwaitType;
+  #endif
+  #ifdef __Pyx_Coroutine_USED
+  PyTypeObject *__pyx_CoroutineType;
+  #endif
+  #if CYTHON_USE_MODULE_STATE
+  #endif
+  #if CYTHON_USE_MODULE_STATE
+  #endif
+  #if CYTHON_USE_MODULE_STATE
+  #endif
+  #if CYTHON_USE_MODULE_STATE
+  #endif
+  #if CYTHON_USE_MODULE_STATE
+  #endif
+  PyTypeObject *__pyx_ptype_7cpython_4type_type;
+  #if CYTHON_USE_MODULE_STATE
+  #endif
+  #if CYTHON_USE_MODULE_STATE
+  #endif
+  #if CYTHON_USE_MODULE_STATE
+  #endif
+  #if CYTHON_USE_MODULE_STATE
+  #endif
+  #if CYTHON_USE_MODULE_STATE
+  #endif
+  PyObject *__pyx_n_s_C_API;
+  PyObject *__pyx_n_s__22;
+  PyObject *__pyx_n_s__4;
+  PyObject *__pyx_n_s_async_handle;
+  PyObject *__pyx_n_s_async_send;
+  PyObject *__pyx_n_s_asyncio_coroutines;
+  PyObject *__pyx_n_s_capsule_or_bytes;
+  PyObject *__pyx_n_s_cffi_backend;
+  PyObject *__pyx_n_s_cffi_exports;
+  PyObject *__pyx_n_s_cffi_to_c_pointer;
+  PyObject *__pyx_n_s_cline_in_traceback;
+  PyObject *__pyx_n_s_config;
+  PyObject *__pyx_n_s_encode;
+  PyObject *__pyx_n_s_exit;
+  PyObject *__pyx_n_s_ffi;
+  PyObject *__pyx_n_s_getlenv;
+  PyObject *__pyx_kp_u_getlenv_but_value_not_existed;
+  PyObject *__pyx_n_s_getscript;
+  PyObject *__pyx_n_s_import;
+  PyObject *__pyx_n_s_index;
+  PyObject *__pyx_n_s_init;
+  PyObject *__pyx_n_s_initializing;
+  PyObject *__pyx_n_s_is_coroutine;
+  PyObject *__pyx_n_s_key;
+  PyObject *__pyx_n_s_main;
+  PyObject *__pyx_n_s_name;
+  PyObject *__pyx_n_s_nextenv;
+  PyObject *__pyx_n_s_profile;
+  PyObject *__pyx_n_s_ptr;
+  PyObject *__pyx_n_s_py_sz;
+  PyObject *__pyx_n_s_pyskynet_skynet_py_main;
+  PyObject *__pyx_n_s_refscript;
+  PyObject *__pyx_n_s_ret;
+  PyObject *__pyx_n_s_script;
+  PyObject *__pyx_n_s_self;
+  PyObject *__pyx_n_s_setlenv;
+  PyObject *__pyx_kp_u_setlenv_but_key_conflict;
+  PyObject *__pyx_kp_u_skynet_py_env_value_must_be_byte;
+  PyObject *__pyx_n_s_spec;
+  PyObject *__pyx_kp_s_src_cy_src_skynet_py_main_pyx;
+  PyObject *__pyx_n_s_start;
+  PyObject *__pyx_n_s_sz;
+  PyObject *__pyx_n_s_test;
+  PyObject *__pyx_n_s_thread;
+  PyObject *__pyx_kp_u_type_s_can_t_convert_to_bytes;
+  PyObject *__pyx_n_s_typeof;
+  PyObject *__pyx_kp_u_utf_8;
+  PyObject *__pyx_n_s_value;
+  PyObject *__pyx_tuple_;
+  PyObject *__pyx_tuple__2;
+  PyObject *__pyx_tuple__3;
+  PyObject *__pyx_tuple__5;
+  PyObject *__pyx_tuple__7;
+  PyObject *__pyx_tuple__9;
+  PyObject *__pyx_tuple__10;
+  PyObject *__pyx_tuple__12;
+  PyObject *__pyx_tuple__14;
+  PyObject *__pyx_tuple__16;
+  PyObject *__pyx_tuple__18;
+  PyObject *__pyx_codeobj__6;
+  PyObject *__pyx_codeobj__8;
+  PyObject *__pyx_codeobj__11;
+  PyObject *__pyx_codeobj__13;
+  PyObject *__pyx_codeobj__15;
+  PyObject *__pyx_codeobj__17;
+  PyObject *__pyx_codeobj__19;
+  PyObject *__pyx_codeobj__20;
+  PyObject *__pyx_codeobj__21;
+} __pyx_mstate;
+
+#if CYTHON_USE_MODULE_STATE
+#ifdef __cplusplus
+namespace {
+  extern struct PyModuleDef __pyx_moduledef;
+} /* anonymous namespace */
+#else
+static struct PyModuleDef __pyx_moduledef;
+#endif
+
+#define __pyx_mstate(o) ((__pyx_mstate *)__Pyx_PyModule_GetState(o))
+
+#define __pyx_mstate_global (__pyx_mstate(PyState_FindModule(&__pyx_moduledef)))
+
+#define __pyx_m (PyState_FindModule(&__pyx_moduledef))
+#else
+static __pyx_mstate __pyx_mstate_global_static =
+#ifdef __cplusplus
+    {};
+#else
+    {0};
+#endif
+static __pyx_mstate *__pyx_mstate_global = &__pyx_mstate_global_static;
+#endif
+/* #### Code section: module_state_clear ### */
+#if CYTHON_USE_MODULE_STATE
+static int __pyx_m_clear(PyObject *m) {
+  __pyx_mstate *clear_module_state = __pyx_mstate(m);
+  if (!clear_module_state) return 0;
+  Py_CLEAR(clear_module_state->__pyx_d);
+  Py_CLEAR(clear_module_state->__pyx_b);
+  Py_CLEAR(clear_module_state->__pyx_cython_runtime);
+  Py_CLEAR(clear_module_state->__pyx_empty_tuple);
+  Py_CLEAR(clear_module_state->__pyx_empty_bytes);
+  Py_CLEAR(clear_module_state->__pyx_empty_unicode);
+  #ifdef __Pyx_CyFunction_USED
+  Py_CLEAR(clear_module_state->__pyx_CyFunctionType);
+  #endif
+  #ifdef __Pyx_FusedFunction_USED
+  Py_CLEAR(clear_module_state->__pyx_FusedFunctionType);
+  #endif
+  Py_CLEAR(clear_module_state->__pyx_ptype_7cpython_4type_type);
+  Py_CLEAR(clear_module_state->__pyx_n_s_C_API);
+  Py_CLEAR(clear_module_state->__pyx_n_s__22);
+  Py_CLEAR(clear_module_state->__pyx_n_s__4);
+  Py_CLEAR(clear_module_state->__pyx_n_s_async_handle);
+  Py_CLEAR(clear_module_state->__pyx_n_s_async_send);
+  Py_CLEAR(clear_module_state->__pyx_n_s_asyncio_coroutines);
+  Py_CLEAR(clear_module_state->__pyx_n_s_capsule_or_bytes);
+  Py_CLEAR(clear_module_state->__pyx_n_s_cffi_backend);
+  Py_CLEAR(clear_module_state->__pyx_n_s_cffi_exports);
+  Py_CLEAR(clear_module_state->__pyx_n_s_cffi_to_c_pointer);
+  Py_CLEAR(clear_module_state->__pyx_n_s_cline_in_traceback);
+  Py_CLEAR(clear_module_state->__pyx_n_s_config);
+  Py_CLEAR(clear_module_state->__pyx_n_s_encode);
+  Py_CLEAR(clear_module_state->__pyx_n_s_exit);
+  Py_CLEAR(clear_module_state->__pyx_n_s_ffi);
+  Py_CLEAR(clear_module_state->__pyx_n_s_getlenv);
+  Py_CLEAR(clear_module_state->__pyx_kp_u_getlenv_but_value_not_existed);
+  Py_CLEAR(clear_module_state->__pyx_n_s_getscript);
+  Py_CLEAR(clear_module_state->__pyx_n_s_import);
+  Py_CLEAR(clear_module_state->__pyx_n_s_index);
+  Py_CLEAR(clear_module_state->__pyx_n_s_init);
+  Py_CLEAR(clear_module_state->__pyx_n_s_initializing);
+  Py_CLEAR(clear_module_state->__pyx_n_s_is_coroutine);
+  Py_CLEAR(clear_module_state->__pyx_n_s_key);
+  Py_CLEAR(clear_module_state->__pyx_n_s_main);
+  Py_CLEAR(clear_module_state->__pyx_n_s_name);
+  Py_CLEAR(clear_module_state->__pyx_n_s_nextenv);
+  Py_CLEAR(clear_module_state->__pyx_n_s_profile);
+  Py_CLEAR(clear_module_state->__pyx_n_s_ptr);
+  Py_CLEAR(clear_module_state->__pyx_n_s_py_sz);
+  Py_CLEAR(clear_module_state->__pyx_n_s_pyskynet_skynet_py_main);
+  Py_CLEAR(clear_module_state->__pyx_n_s_refscript);
+  Py_CLEAR(clear_module_state->__pyx_n_s_ret);
+  Py_CLEAR(clear_module_state->__pyx_n_s_script);
+  Py_CLEAR(clear_module_state->__pyx_n_s_self);
+  Py_CLEAR(clear_module_state->__pyx_n_s_setlenv);
+  Py_CLEAR(clear_module_state->__pyx_kp_u_setlenv_but_key_conflict);
+  Py_CLEAR(clear_module_state->__pyx_kp_u_skynet_py_env_value_must_be_byte);
+  Py_CLEAR(clear_module_state->__pyx_n_s_spec);
+  Py_CLEAR(clear_module_state->__pyx_kp_s_src_cy_src_skynet_py_main_pyx);
+  Py_CLEAR(clear_module_state->__pyx_n_s_start);
+  Py_CLEAR(clear_module_state->__pyx_n_s_sz);
+  Py_CLEAR(clear_module_state->__pyx_n_s_test);
+  Py_CLEAR(clear_module_state->__pyx_n_s_thread);
+  Py_CLEAR(clear_module_state->__pyx_kp_u_type_s_can_t_convert_to_bytes);
+  Py_CLEAR(clear_module_state->__pyx_n_s_typeof);
+  Py_CLEAR(clear_module_state->__pyx_kp_u_utf_8);
+  Py_CLEAR(clear_module_state->__pyx_n_s_value);
+  Py_CLEAR(clear_module_state->__pyx_tuple_);
+  Py_CLEAR(clear_module_state->__pyx_tuple__2);
+  Py_CLEAR(clear_module_state->__pyx_tuple__3);
+  Py_CLEAR(clear_module_state->__pyx_tuple__5);
+  Py_CLEAR(clear_module_state->__pyx_tuple__7);
+  Py_CLEAR(clear_module_state->__pyx_tuple__9);
+  Py_CLEAR(clear_module_state->__pyx_tuple__10);
+  Py_CLEAR(clear_module_state->__pyx_tuple__12);
+  Py_CLEAR(clear_module_state->__pyx_tuple__14);
+  Py_CLEAR(clear_module_state->__pyx_tuple__16);
+  Py_CLEAR(clear_module_state->__pyx_tuple__18);
+  Py_CLEAR(clear_module_state->__pyx_codeobj__6);
+  Py_CLEAR(clear_module_state->__pyx_codeobj__8);
+  Py_CLEAR(clear_module_state->__pyx_codeobj__11);
+  Py_CLEAR(clear_module_state->__pyx_codeobj__13);
+  Py_CLEAR(clear_module_state->__pyx_codeobj__15);
+  Py_CLEAR(clear_module_state->__pyx_codeobj__17);
+  Py_CLEAR(clear_module_state->__pyx_codeobj__19);
+  Py_CLEAR(clear_module_state->__pyx_codeobj__20);
+  Py_CLEAR(clear_module_state->__pyx_codeobj__21);
+  return 0;
+}
+#endif
+/* #### Code section: module_state_traverse ### */
+#if CYTHON_USE_MODULE_STATE
+static int __pyx_m_traverse(PyObject *m, visitproc visit, void *arg) {
+  __pyx_mstate *traverse_module_state = __pyx_mstate(m);
+  if (!traverse_module_state) return 0;
+  Py_VISIT(traverse_module_state->__pyx_d);
+  Py_VISIT(traverse_module_state->__pyx_b);
+  Py_VISIT(traverse_module_state->__pyx_cython_runtime);
+  Py_VISIT(traverse_module_state->__pyx_empty_tuple);
+  Py_VISIT(traverse_module_state->__pyx_empty_bytes);
+  Py_VISIT(traverse_module_state->__pyx_empty_unicode);
+  #ifdef __Pyx_CyFunction_USED
+  Py_VISIT(traverse_module_state->__pyx_CyFunctionType);
+  #endif
+  #ifdef __Pyx_FusedFunction_USED
+  Py_VISIT(traverse_module_state->__pyx_FusedFunctionType);
+  #endif
+  Py_VISIT(traverse_module_state->__pyx_ptype_7cpython_4type_type);
+  Py_VISIT(traverse_module_state->__pyx_n_s_C_API);
+  Py_VISIT(traverse_module_state->__pyx_n_s__22);
+  Py_VISIT(traverse_module_state->__pyx_n_s__4);
+  Py_VISIT(traverse_module_state->__pyx_n_s_async_handle);
+  Py_VISIT(traverse_module_state->__pyx_n_s_async_send);
+  Py_VISIT(traverse_module_state->__pyx_n_s_asyncio_coroutines);
+  Py_VISIT(traverse_module_state->__pyx_n_s_capsule_or_bytes);
+  Py_VISIT(traverse_module_state->__pyx_n_s_cffi_backend);
+  Py_VISIT(traverse_module_state->__pyx_n_s_cffi_exports);
+  Py_VISIT(traverse_module_state->__pyx_n_s_cffi_to_c_pointer);
+  Py_VISIT(traverse_module_state->__pyx_n_s_cline_in_traceback);
+  Py_VISIT(traverse_module_state->__pyx_n_s_config);
+  Py_VISIT(traverse_module_state->__pyx_n_s_encode);
+  Py_VISIT(traverse_module_state->__pyx_n_s_exit);
+  Py_VISIT(traverse_module_state->__pyx_n_s_ffi);
+  Py_VISIT(traverse_module_state->__pyx_n_s_getlenv);
+  Py_VISIT(traverse_module_state->__pyx_kp_u_getlenv_but_value_not_existed);
+  Py_VISIT(traverse_module_state->__pyx_n_s_getscript);
+  Py_VISIT(traverse_module_state->__pyx_n_s_import);
+  Py_VISIT(traverse_module_state->__pyx_n_s_index);
+  Py_VISIT(traverse_module_state->__pyx_n_s_init);
+  Py_VISIT(traverse_module_state->__pyx_n_s_initializing);
+  Py_VISIT(traverse_module_state->__pyx_n_s_is_coroutine);
+  Py_VISIT(traverse_module_state->__pyx_n_s_key);
+  Py_VISIT(traverse_module_state->__pyx_n_s_main);
+  Py_VISIT(traverse_module_state->__pyx_n_s_name);
+  Py_VISIT(traverse_module_state->__pyx_n_s_nextenv);
+  Py_VISIT(traverse_module_state->__pyx_n_s_profile);
+  Py_VISIT(traverse_module_state->__pyx_n_s_ptr);
+  Py_VISIT(traverse_module_state->__pyx_n_s_py_sz);
+  Py_VISIT(traverse_module_state->__pyx_n_s_pyskynet_skynet_py_main);
+  Py_VISIT(traverse_module_state->__pyx_n_s_refscript);
+  Py_VISIT(traverse_module_state->__pyx_n_s_ret);
+  Py_VISIT(traverse_module_state->__pyx_n_s_script);
+  Py_VISIT(traverse_module_state->__pyx_n_s_self);
+  Py_VISIT(traverse_module_state->__pyx_n_s_setlenv);
+  Py_VISIT(traverse_module_state->__pyx_kp_u_setlenv_but_key_conflict);
+  Py_VISIT(traverse_module_state->__pyx_kp_u_skynet_py_env_value_must_be_byte);
+  Py_VISIT(traverse_module_state->__pyx_n_s_spec);
+  Py_VISIT(traverse_module_state->__pyx_kp_s_src_cy_src_skynet_py_main_pyx);
+  Py_VISIT(traverse_module_state->__pyx_n_s_start);
+  Py_VISIT(traverse_module_state->__pyx_n_s_sz);
+  Py_VISIT(traverse_module_state->__pyx_n_s_test);
+  Py_VISIT(traverse_module_state->__pyx_n_s_thread);
+  Py_VISIT(traverse_module_state->__pyx_kp_u_type_s_can_t_convert_to_bytes);
+  Py_VISIT(traverse_module_state->__pyx_n_s_typeof);
+  Py_VISIT(traverse_module_state->__pyx_kp_u_utf_8);
+  Py_VISIT(traverse_module_state->__pyx_n_s_value);
+  Py_VISIT(traverse_module_state->__pyx_tuple_);
+  Py_VISIT(traverse_module_state->__pyx_tuple__2);
+  Py_VISIT(traverse_module_state->__pyx_tuple__3);
+  Py_VISIT(traverse_module_state->__pyx_tuple__5);
+  Py_VISIT(traverse_module_state->__pyx_tuple__7);
+  Py_VISIT(traverse_module_state->__pyx_tuple__9);
+  Py_VISIT(traverse_module_state->__pyx_tuple__10);
+  Py_VISIT(traverse_module_state->__pyx_tuple__12);
+  Py_VISIT(traverse_module_state->__pyx_tuple__14);
+  Py_VISIT(traverse_module_state->__pyx_tuple__16);
+  Py_VISIT(traverse_module_state->__pyx_tuple__18);
+  Py_VISIT(traverse_module_state->__pyx_codeobj__6);
+  Py_VISIT(traverse_module_state->__pyx_codeobj__8);
+  Py_VISIT(traverse_module_state->__pyx_codeobj__11);
+  Py_VISIT(traverse_module_state->__pyx_codeobj__13);
+  Py_VISIT(traverse_module_state->__pyx_codeobj__15);
+  Py_VISIT(traverse_module_state->__pyx_codeobj__17);
+  Py_VISIT(traverse_module_state->__pyx_codeobj__19);
+  Py_VISIT(traverse_module_state->__pyx_codeobj__20);
+  Py_VISIT(traverse_module_state->__pyx_codeobj__21);
+  return 0;
+}
+#endif
+/* #### Code section: module_state_defines ### */
+#define __pyx_d __pyx_mstate_global->__pyx_d
+#define __pyx_b __pyx_mstate_global->__pyx_b
+#define __pyx_cython_runtime __pyx_mstate_global->__pyx_cython_runtime
+#define __pyx_empty_tuple __pyx_mstate_global->__pyx_empty_tuple
+#define __pyx_empty_bytes __pyx_mstate_global->__pyx_empty_bytes
+#define __pyx_empty_unicode __pyx_mstate_global->__pyx_empty_unicode
+#ifdef __Pyx_CyFunction_USED
+#define __pyx_CyFunctionType __pyx_mstate_global->__pyx_CyFunctionType
+#endif
+#ifdef __Pyx_FusedFunction_USED
+#define __pyx_FusedFunctionType __pyx_mstate_global->__pyx_FusedFunctionType
+#endif
+#ifdef __Pyx_Generator_USED
+#define __pyx_GeneratorType __pyx_mstate_global->__pyx_GeneratorType
+#endif
+#ifdef __Pyx_IterableCoroutine_USED
+#define __pyx_IterableCoroutineType __pyx_mstate_global->__pyx_IterableCoroutineType
+#endif
+#ifdef __Pyx_Coroutine_USED
+#define __pyx_CoroutineAwaitType __pyx_mstate_global->__pyx_CoroutineAwaitType
+#endif
+#ifdef __Pyx_Coroutine_USED
+#define __pyx_CoroutineType __pyx_mstate_global->__pyx_CoroutineType
+#endif
+#if CYTHON_USE_MODULE_STATE
+#endif
+#if CYTHON_USE_MODULE_STATE
+#endif
+#if CYTHON_USE_MODULE_STATE
+#endif
+#if CYTHON_USE_MODULE_STATE
+#endif
+#if CYTHON_USE_MODULE_STATE
+#endif
+#define __pyx_ptype_7cpython_4type_type __pyx_mstate_global->__pyx_ptype_7cpython_4type_type
+#if CYTHON_USE_MODULE_STATE
+#endif
+#if CYTHON_USE_MODULE_STATE
+#endif
+#if CYTHON_USE_MODULE_STATE
+#endif
+#if CYTHON_USE_MODULE_STATE
+#endif
+#if CYTHON_USE_MODULE_STATE
+#endif
+#define __pyx_n_s_C_API __pyx_mstate_global->__pyx_n_s_C_API
+#define __pyx_n_s__22 __pyx_mstate_global->__pyx_n_s__22
+#define __pyx_n_s__4 __pyx_mstate_global->__pyx_n_s__4
+#define __pyx_n_s_async_handle __pyx_mstate_global->__pyx_n_s_async_handle
+#define __pyx_n_s_async_send __pyx_mstate_global->__pyx_n_s_async_send
+#define __pyx_n_s_asyncio_coroutines __pyx_mstate_global->__pyx_n_s_asyncio_coroutines
+#define __pyx_n_s_capsule_or_bytes __pyx_mstate_global->__pyx_n_s_capsule_or_bytes
+#define __pyx_n_s_cffi_backend __pyx_mstate_global->__pyx_n_s_cffi_backend
+#define __pyx_n_s_cffi_exports __pyx_mstate_global->__pyx_n_s_cffi_exports
+#define __pyx_n_s_cffi_to_c_pointer __pyx_mstate_global->__pyx_n_s_cffi_to_c_pointer
+#define __pyx_n_s_cline_in_traceback __pyx_mstate_global->__pyx_n_s_cline_in_traceback
+#define __pyx_n_s_config __pyx_mstate_global->__pyx_n_s_config
+#define __pyx_n_s_encode __pyx_mstate_global->__pyx_n_s_encode
+#define __pyx_n_s_exit __pyx_mstate_global->__pyx_n_s_exit
+#define __pyx_n_s_ffi __pyx_mstate_global->__pyx_n_s_ffi
+#define __pyx_n_s_getlenv __pyx_mstate_global->__pyx_n_s_getlenv
+#define __pyx_kp_u_getlenv_but_value_not_existed __pyx_mstate_global->__pyx_kp_u_getlenv_but_value_not_existed
+#define __pyx_n_s_getscript __pyx_mstate_global->__pyx_n_s_getscript
+#define __pyx_n_s_import __pyx_mstate_global->__pyx_n_s_import
+#define __pyx_n_s_index __pyx_mstate_global->__pyx_n_s_index
+#define __pyx_n_s_init __pyx_mstate_global->__pyx_n_s_init
+#define __pyx_n_s_initializing __pyx_mstate_global->__pyx_n_s_initializing
+#define __pyx_n_s_is_coroutine __pyx_mstate_global->__pyx_n_s_is_coroutine
+#define __pyx_n_s_key __pyx_mstate_global->__pyx_n_s_key
+#define __pyx_n_s_main __pyx_mstate_global->__pyx_n_s_main
+#define __pyx_n_s_name __pyx_mstate_global->__pyx_n_s_name
+#define __pyx_n_s_nextenv __pyx_mstate_global->__pyx_n_s_nextenv
+#define __pyx_n_s_profile __pyx_mstate_global->__pyx_n_s_profile
+#define __pyx_n_s_ptr __pyx_mstate_global->__pyx_n_s_ptr
+#define __pyx_n_s_py_sz __pyx_mstate_global->__pyx_n_s_py_sz
+#define __pyx_n_s_pyskynet_skynet_py_main __pyx_mstate_global->__pyx_n_s_pyskynet_skynet_py_main
+#define __pyx_n_s_refscript __pyx_mstate_global->__pyx_n_s_refscript
+#define __pyx_n_s_ret __pyx_mstate_global->__pyx_n_s_ret
+#define __pyx_n_s_script __pyx_mstate_global->__pyx_n_s_script
+#define __pyx_n_s_self __pyx_mstate_global->__pyx_n_s_self
+#define __pyx_n_s_setlenv __pyx_mstate_global->__pyx_n_s_setlenv
+#define __pyx_kp_u_setlenv_but_key_conflict __pyx_mstate_global->__pyx_kp_u_setlenv_but_key_conflict
+#define __pyx_kp_u_skynet_py_env_value_must_be_byte __pyx_mstate_global->__pyx_kp_u_skynet_py_env_value_must_be_byte
+#define __pyx_n_s_spec __pyx_mstate_global->__pyx_n_s_spec
+#define __pyx_kp_s_src_cy_src_skynet_py_main_pyx __pyx_mstate_global->__pyx_kp_s_src_cy_src_skynet_py_main_pyx
+#define __pyx_n_s_start __pyx_mstate_global->__pyx_n_s_start
+#define __pyx_n_s_sz __pyx_mstate_global->__pyx_n_s_sz
+#define __pyx_n_s_test __pyx_mstate_global->__pyx_n_s_test
+#define __pyx_n_s_thread __pyx_mstate_global->__pyx_n_s_thread
+#define __pyx_kp_u_type_s_can_t_convert_to_bytes __pyx_mstate_global->__pyx_kp_u_type_s_can_t_convert_to_bytes
+#define __pyx_n_s_typeof __pyx_mstate_global->__pyx_n_s_typeof
+#define __pyx_kp_u_utf_8 __pyx_mstate_global->__pyx_kp_u_utf_8
+#define __pyx_n_s_value __pyx_mstate_global->__pyx_n_s_value
+#define __pyx_tuple_ __pyx_mstate_global->__pyx_tuple_
+#define __pyx_tuple__2 __pyx_mstate_global->__pyx_tuple__2
+#define __pyx_tuple__3 __pyx_mstate_global->__pyx_tuple__3
+#define __pyx_tuple__5 __pyx_mstate_global->__pyx_tuple__5
+#define __pyx_tuple__7 __pyx_mstate_global->__pyx_tuple__7
+#define __pyx_tuple__9 __pyx_mstate_global->__pyx_tuple__9
+#define __pyx_tuple__10 __pyx_mstate_global->__pyx_tuple__10
+#define __pyx_tuple__12 __pyx_mstate_global->__pyx_tuple__12
+#define __pyx_tuple__14 __pyx_mstate_global->__pyx_tuple__14
+#define __pyx_tuple__16 __pyx_mstate_global->__pyx_tuple__16
+#define __pyx_tuple__18 __pyx_mstate_global->__pyx_tuple__18
+#define __pyx_codeobj__6 __pyx_mstate_global->__pyx_codeobj__6
+#define __pyx_codeobj__8 __pyx_mstate_global->__pyx_codeobj__8
+#define __pyx_codeobj__11 __pyx_mstate_global->__pyx_codeobj__11
+#define __pyx_codeobj__13 __pyx_mstate_global->__pyx_codeobj__13
+#define __pyx_codeobj__15 __pyx_mstate_global->__pyx_codeobj__15
+#define __pyx_codeobj__17 __pyx_mstate_global->__pyx_codeobj__17
+#define __pyx_codeobj__19 __pyx_mstate_global->__pyx_codeobj__19
+#define __pyx_codeobj__20 __pyx_mstate_global->__pyx_codeobj__20
+#define __pyx_codeobj__21 __pyx_mstate_global->__pyx_codeobj__21
+/* #### Code section: module_code ### */
+
+/* "src/cy_src/skynet_py_main.pyx":23
+ * ctypedef (char *)(* f_type)(object, object)
+ * 
+ * def init(ffi, async_send, async_handle):             # <<<<<<<<<<<<<<
+ *     # because gevent's libuv bind with cffi, so we can get pointer by this way
+ *     cdef void ** _cffi_exports = <void **>PyCapsule_GetPointer(_cffi_backend._C_API, "cffi")
  */
 
-static void __pyx_f_8pyskynet_12skynet_py_mq_free_pyptr(PyObject *__pyx_v_capsule) {
-  void *__pyx_v_ptr;
+/* Python wrapper */
+static PyObject *__pyx_pw_8pyskynet_14skynet_py_main_1init(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+); /*proto*/
+static PyMethodDef __pyx_mdef_8pyskynet_14skynet_py_main_1init = {"init", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_8pyskynet_14skynet_py_main_1init, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_8pyskynet_14skynet_py_main_1init(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+) {
+  PyObject *__pyx_v_ffi = 0;
+  PyObject *__pyx_v_async_send = 0;
+  PyObject *__pyx_v_async_handle = 0;
+  #if !CYTHON_METH_FASTCALL
+  CYTHON_UNUSED const Py_ssize_t __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
+  #endif
+  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
-  void *__pyx_t_1;
+  __Pyx_RefNannySetupContext("init (wrapper)", 0);
+  {
+    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_ffi,&__pyx_n_s_async_send,&__pyx_n_s_async_handle,0};
+    PyObject* values[3] = {0,0,0};
+    if (__pyx_kwds) {
+      Py_ssize_t kw_args;
+      switch (__pyx_nargs) {
+        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
+        CYTHON_FALLTHROUGH;
+        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
+        CYTHON_FALLTHROUGH;
+        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+        CYTHON_FALLTHROUGH;
+        case  0: break;
+        default: goto __pyx_L5_argtuple_error;
+      }
+      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
+      switch (__pyx_nargs) {
+        case  0:
+        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_ffi)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 23, __pyx_L3_error)
+        else goto __pyx_L5_argtuple_error;
+        CYTHON_FALLTHROUGH;
+        case  1:
+        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_async_send)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 23, __pyx_L3_error)
+        else {
+          __Pyx_RaiseArgtupleInvalid("init", 1, 3, 3, 1); __PYX_ERR(0, 23, __pyx_L3_error)
+        }
+        CYTHON_FALLTHROUGH;
+        case  2:
+        if (likely((values[2] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_async_handle)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 23, __pyx_L3_error)
+        else {
+          __Pyx_RaiseArgtupleInvalid("init", 1, 3, 3, 2); __PYX_ERR(0, 23, __pyx_L3_error)
+        }
+      }
+      if (unlikely(kw_args > 0)) {
+        const Py_ssize_t kwd_pos_args = __pyx_nargs;
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "init") < 0)) __PYX_ERR(0, 23, __pyx_L3_error)
+      }
+    } else if (unlikely(__pyx_nargs != 3)) {
+      goto __pyx_L5_argtuple_error;
+    } else {
+      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+      values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
+      values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
+    }
+    __pyx_v_ffi = values[0];
+    __pyx_v_async_send = values[1];
+    __pyx_v_async_handle = values[2];
+  }
+  goto __pyx_L4_argument_unpacking_done;
+  __pyx_L5_argtuple_error:;
+  __Pyx_RaiseArgtupleInvalid("init", 1, 3, 3, __pyx_nargs); __PYX_ERR(0, 23, __pyx_L3_error)
+  __pyx_L3_error:;
+  __Pyx_AddTraceback("pyskynet.skynet_py_main.init", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_RefNannyFinishContext();
+  return NULL;
+  __pyx_L4_argument_unpacking_done:;
+  __pyx_r = __pyx_pf_8pyskynet_14skynet_py_main_init(__pyx_self, __pyx_v_ffi, __pyx_v_async_send, __pyx_v_async_handle);
+
+  /* function exit code */
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+static PyObject *__pyx_pf_8pyskynet_14skynet_py_main_init(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_ffi, PyObject *__pyx_v_async_send, PyObject *__pyx_v_async_handle) {
+  void **__pyx_v__cffi_exports;
+  __pyx_t_8pyskynet_14skynet_py_main_f_type __pyx_v__cffi_to_c_pointer;
+  PyObject *__pyx_r = NULL;
+  __Pyx_RefNannyDeclarations
+  PyObject *__pyx_t_1 = NULL;
+  PyObject *__pyx_t_2 = NULL;
+  void *__pyx_t_3;
+  PyObject *__pyx_t_4 = NULL;
+  int __pyx_t_5;
+  PyObject *__pyx_t_6 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
-  __Pyx_RefNannySetupContext("free_pyptr", 0);
+  __Pyx_RefNannySetupContext("init", 0);
 
-  /* "src/cy_src/skynet_py_mq.pyx":14
- * 
- * cdef void free_pyptr(object capsule):
- *     cdef void *ptr = PyCapsule_GetPointer(capsule, "pyptr")             # <<<<<<<<<<<<<<
- *     skynet_free(ptr)
- * 
+  /* "src/cy_src/skynet_py_main.pyx":25
+ * def init(ffi, async_send, async_handle):
+ *     # because gevent's libuv bind with cffi, so we can get pointer by this way
+ *     cdef void ** _cffi_exports = <void **>PyCapsule_GetPointer(_cffi_backend._C_API, "cffi")             # <<<<<<<<<<<<<<
+ *     # get the '_cffi_to_c_pointer' function in _cffi_include.h of cffi
+ *     cdef f_type _cffi_to_c_pointer = <f_type>_cffi_exports[11]
  */
-  __pyx_t_1 = PyCapsule_GetPointer(__pyx_v_capsule, ((char *)"pyptr")); if (unlikely(__pyx_t_1 == ((void *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 14, __pyx_L1_error)
-  __pyx_v_ptr = __pyx_t_1;
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_cffi_backend); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 25, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_C_API); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 25, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_3 = PyCapsule_GetPointer(__pyx_t_2, ((char const *)"cffi")); if (unlikely(__pyx_t_3 == ((void *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 25, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_v__cffi_exports = ((void **)__pyx_t_3);
 
-  /* "src/cy_src/skynet_py_mq.pyx":15
- * cdef void free_pyptr(object capsule):
- *     cdef void *ptr = PyCapsule_GetPointer(capsule, "pyptr")
- *     skynet_free(ptr)             # <<<<<<<<<<<<<<
- * 
- * def crecv():
+  /* "src/cy_src/skynet_py_main.pyx":27
+ *     cdef void ** _cffi_exports = <void **>PyCapsule_GetPointer(_cffi_backend._C_API, "cffi")
+ *     # get the '_cffi_to_c_pointer' function in _cffi_include.h of cffi
+ *     cdef f_type _cffi_to_c_pointer = <f_type>_cffi_exports[11]             # <<<<<<<<<<<<<<
+ *     skynet_py_init(
+ *             <int (*)(void*)>_cffi_to_c_pointer(async_send, ffi.typeof(async_send)),
+ */
+  __pyx_v__cffi_to_c_pointer = ((__pyx_t_8pyskynet_14skynet_py_main_f_type)(__pyx_v__cffi_exports[11]));
+
+  /* "src/cy_src/skynet_py_main.pyx":29
+ *     cdef f_type _cffi_to_c_pointer = <f_type>_cffi_exports[11]
+ *     skynet_py_init(
+ *             <int (*)(void*)>_cffi_to_c_pointer(async_send, ffi.typeof(async_send)),             # <<<<<<<<<<<<<<
+ *             <void *>_cffi_to_c_pointer(async_handle, ffi.typeof(async_handle))
+ *             )
  */
-  skynet_free(__pyx_v_ptr);
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_v_ffi, __pyx_n_s_typeof); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 29, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_t_4 = NULL;
+  __pyx_t_5 = 0;
+  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
+    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_1);
+    if (likely(__pyx_t_4)) {
+      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
+      __Pyx_INCREF(__pyx_t_4);
+      __Pyx_INCREF(function);
+      __Pyx_DECREF_SET(__pyx_t_1, function);
+      __pyx_t_5 = 1;
+    }
+  }
+  {
+    PyObject *__pyx_callargs[2] = {__pyx_t_4, __pyx_v_async_send};
+    __pyx_t_2 = __Pyx_PyObject_FastCall(__pyx_t_1, __pyx_callargs+1-__pyx_t_5, 1+__pyx_t_5);
+    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
+    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 29, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_2);
+    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  }
 
-  /* "src/cy_src/skynet_py_mq.pyx":13
+  /* "src/cy_src/skynet_py_main.pyx":30
+ *     skynet_py_init(
+ *             <int (*)(void*)>_cffi_to_c_pointer(async_send, ffi.typeof(async_send)),
+ *             <void *>_cffi_to_c_pointer(async_handle, ffi.typeof(async_handle))             # <<<<<<<<<<<<<<
+ *             )
  * 
+ */
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_ffi, __pyx_n_s_typeof); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 30, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_4);
+  __pyx_t_6 = NULL;
+  __pyx_t_5 = 0;
+  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
+    __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_4);
+    if (likely(__pyx_t_6)) {
+      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
+      __Pyx_INCREF(__pyx_t_6);
+      __Pyx_INCREF(function);
+      __Pyx_DECREF_SET(__pyx_t_4, function);
+      __pyx_t_5 = 1;
+    }
+  }
+  {
+    PyObject *__pyx_callargs[2] = {__pyx_t_6, __pyx_v_async_handle};
+    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_4, __pyx_callargs+1-__pyx_t_5, 1+__pyx_t_5);
+    __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
+    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 30, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_1);
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+  }
+
+  /* "src/cy_src/skynet_py_main.pyx":28
+ *     # get the '_cffi_to_c_pointer' function in _cffi_include.h of cffi
+ *     cdef f_type _cffi_to_c_pointer = <f_type>_cffi_exports[11]
+ *     skynet_py_init(             # <<<<<<<<<<<<<<
+ *             <int (*)(void*)>_cffi_to_c_pointer(async_send, ffi.typeof(async_send)),
+ *             <void *>_cffi_to_c_pointer(async_handle, ffi.typeof(async_handle))
+ */
+  skynet_py_init(((int (*)(void *))__pyx_v__cffi_to_c_pointer(__pyx_v_async_send, __pyx_t_2)), ((void *)__pyx_v__cffi_to_c_pointer(__pyx_v_async_handle, __pyx_t_1)));
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+
+  /* "src/cy_src/skynet_py_main.pyx":23
+ * ctypedef (char *)(* f_type)(object, object)
  * 
- * cdef void free_pyptr(object capsule):             # <<<<<<<<<<<<<<
- *     cdef void *ptr = PyCapsule_GetPointer(capsule, "pyptr")
- *     skynet_free(ptr)
+ * def init(ffi, async_send, async_handle):             # <<<<<<<<<<<<<<
+ *     # because gevent's libuv bind with cffi, so we can get pointer by this way
+ *     cdef void ** _cffi_exports = <void **>PyCapsule_GetPointer(_cffi_backend._C_API, "cffi")
  */
 
   /* function exit code */
+  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
   __pyx_L1_error:;
-  __Pyx_WriteUnraisable("pyskynet.skynet_py_mq.free_pyptr", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
+  __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_XDECREF(__pyx_t_4);
+  __Pyx_XDECREF(__pyx_t_6);
+  __Pyx_AddTraceback("pyskynet.skynet_py_main.init", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = NULL;
   __pyx_L0:;
+  __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
+  return __pyx_r;
 }
 
-/* "src/cy_src/skynet_py_mq.pyx":17
- *     skynet_free(ptr)
+/* "src/cy_src/skynet_py_main.pyx":33
+ *             )
  * 
- * def crecv():             # <<<<<<<<<<<<<<
- *     cdef SkynetPyMessage msg
- *     cdef int ret = skynet_py_queue_pop(&msg)
+ * cdef __check_bytes(s):             # <<<<<<<<<<<<<<
+ *     t = type(s)
+ *     if t == str:
  */
 
-/* Python wrapper */
-static PyObject *__pyx_pw_8pyskynet_12skynet_py_mq_1crecv(PyObject *__pyx_self, CYTHON_UNUSED PyObject *unused); /*proto*/
-static PyMethodDef __pyx_mdef_8pyskynet_12skynet_py_mq_1crecv = {"crecv", (PyCFunction)__pyx_pw_8pyskynet_12skynet_py_mq_1crecv, METH_NOARGS, 0};
-static PyObject *__pyx_pw_8pyskynet_12skynet_py_mq_1crecv(PyObject *__pyx_self, CYTHON_UNUSED PyObject *unused) {
-  PyObject *__pyx_r = 0;
-  __Pyx_RefNannyDeclarations
-  __Pyx_RefNannySetupContext("crecv (wrapper)", 0);
-  __pyx_r = __pyx_pf_8pyskynet_12skynet_py_mq_crecv(__pyx_self);
-
-  /* function exit code */
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-static PyObject *__pyx_pf_8pyskynet_12skynet_py_mq_crecv(CYTHON_UNUSED PyObject *__pyx_self) {
-  struct SkynetPyMessage __pyx_v_msg;
-  int __pyx_v_ret;
+static PyObject *__pyx_f_8pyskynet_14skynet_py_main___check_bytes(PyObject *__pyx_v_s) {
+  PyTypeObject *__pyx_v_t = NULL;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
-  int __pyx_t_1;
+  PyObject *__pyx_t_1 = NULL;
   int __pyx_t_2;
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
-  PyObject *__pyx_t_5 = NULL;
-  PyObject *__pyx_t_6 = NULL;
-  PyObject *__pyx_t_7 = NULL;
-  PyObject *__pyx_t_8 = NULL;
+  int __pyx_t_5;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
-  __Pyx_RefNannySetupContext("crecv", 0);
+  __Pyx_RefNannySetupContext("__check_bytes", 0);
 
-  /* "src/cy_src/skynet_py_mq.pyx":19
- * def crecv():
- *     cdef SkynetPyMessage msg
- *     cdef int ret = skynet_py_queue_pop(&msg)             # <<<<<<<<<<<<<<
- *     while ret == 0 and msg.type == PTYPE_DECREF_PYTHON:
- *         Py_XDECREF(<PyObject*>msg.data)
- */
-  __pyx_v_ret = skynet_py_queue_pop((&__pyx_v_msg));
-
-  /* "src/cy_src/skynet_py_mq.pyx":20
- *     cdef SkynetPyMessage msg
- *     cdef int ret = skynet_py_queue_pop(&msg)
- *     while ret == 0 and msg.type == PTYPE_DECREF_PYTHON:             # <<<<<<<<<<<<<<
- *         Py_XDECREF(<PyObject*>msg.data)
- *         ret = skynet_py_queue_pop(&msg)
- */
-  while (1) {
-    __pyx_t_2 = ((__pyx_v_ret == 0) != 0);
-    if (__pyx_t_2) {
-    } else {
-      __pyx_t_1 = __pyx_t_2;
-      goto __pyx_L5_bool_binop_done;
-    }
-    __pyx_t_2 = ((__pyx_v_msg.type == PTYPE_DECREF_PYTHON) != 0);
-    __pyx_t_1 = __pyx_t_2;
-    __pyx_L5_bool_binop_done:;
-    if (!__pyx_t_1) break;
-
-    /* "src/cy_src/skynet_py_mq.pyx":21
- *     cdef int ret = skynet_py_queue_pop(&msg)
- *     while ret == 0 and msg.type == PTYPE_DECREF_PYTHON:
- *         Py_XDECREF(<PyObject*>msg.data)             # <<<<<<<<<<<<<<
- *         ret = skynet_py_queue_pop(&msg)
- *     if ret != 0:
+  /* "src/cy_src/skynet_py_main.pyx":34
+ * 
+ * cdef __check_bytes(s):
+ *     t = type(s)             # <<<<<<<<<<<<<<
+ *     if t == str:
+ *         return s.encode("utf-8")
+ */
+  __Pyx_INCREF(((PyObject *)Py_TYPE(__pyx_v_s)));
+  __pyx_v_t = ((PyTypeObject*)((PyObject *)Py_TYPE(__pyx_v_s)));
+
+  /* "src/cy_src/skynet_py_main.pyx":35
+ * cdef __check_bytes(s):
+ *     t = type(s)
+ *     if t == str:             # <<<<<<<<<<<<<<
+ *         return s.encode("utf-8")
+ *     elif t == bytes:
  */
-    Py_XDECREF(((PyObject *)__pyx_v_msg.data));
+  __pyx_t_1 = PyObject_RichCompare(((PyObject *)__pyx_v_t), ((PyObject *)(&PyUnicode_Type)), Py_EQ); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 35, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely((__pyx_t_2 < 0))) __PYX_ERR(0, 35, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  if (__pyx_t_2) {
 
-    /* "src/cy_src/skynet_py_mq.pyx":22
- *     while ret == 0 and msg.type == PTYPE_DECREF_PYTHON:
- *         Py_XDECREF(<PyObject*>msg.data)
- *         ret = skynet_py_queue_pop(&msg)             # <<<<<<<<<<<<<<
- *     if ret != 0:
- *         return None, None, None, None, None
+    /* "src/cy_src/skynet_py_main.pyx":36
+ *     t = type(s)
+ *     if t == str:
+ *         return s.encode("utf-8")             # <<<<<<<<<<<<<<
+ *     elif t == bytes:
+ *         return s
+ */
+    __Pyx_XDECREF(__pyx_r);
+    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_s, __pyx_n_s_encode); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 36, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_3);
+    __pyx_t_4 = NULL;
+    __pyx_t_5 = 0;
+    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
+      __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
+      if (likely(__pyx_t_4)) {
+        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
+        __Pyx_INCREF(__pyx_t_4);
+        __Pyx_INCREF(function);
+        __Pyx_DECREF_SET(__pyx_t_3, function);
+        __pyx_t_5 = 1;
+      }
+    }
+    {
+      PyObject *__pyx_callargs[2] = {__pyx_t_4, __pyx_kp_u_utf_8};
+      __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_3, __pyx_callargs+1-__pyx_t_5, 1+__pyx_t_5);
+      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
+      if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 36, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_1);
+      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    }
+    __pyx_r = __pyx_t_1;
+    __pyx_t_1 = 0;
+    goto __pyx_L0;
+
+    /* "src/cy_src/skynet_py_main.pyx":35
+ * cdef __check_bytes(s):
+ *     t = type(s)
+ *     if t == str:             # <<<<<<<<<<<<<<
+ *         return s.encode("utf-8")
+ *     elif t == bytes:
  */
-    __pyx_v_ret = skynet_py_queue_pop((&__pyx_v_msg));
   }
 
-  /* "src/cy_src/skynet_py_mq.pyx":23
- *         Py_XDECREF(<PyObject*>msg.data)
- *         ret = skynet_py_queue_pop(&msg)
- *     if ret != 0:             # <<<<<<<<<<<<<<
- *         return None, None, None, None, None
+  /* "src/cy_src/skynet_py_main.pyx":37
+ *     if t == str:
+ *         return s.encode("utf-8")
+ *     elif t == bytes:             # <<<<<<<<<<<<<<
+ *         return s
  *     else:
  */
-  __pyx_t_1 = ((__pyx_v_ret != 0) != 0);
-  if (__pyx_t_1) {
+  __pyx_t_1 = PyObject_RichCompare(((PyObject *)__pyx_v_t), ((PyObject *)(&PyBytes_Type)), Py_EQ); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 37, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely((__pyx_t_2 < 0))) __PYX_ERR(0, 37, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  if (likely(__pyx_t_2)) {
 
-    /* "src/cy_src/skynet_py_mq.pyx":24
- *         ret = skynet_py_queue_pop(&msg)
- *     if ret != 0:
- *         return None, None, None, None, None             # <<<<<<<<<<<<<<
+    /* "src/cy_src/skynet_py_main.pyx":38
+ *         return s.encode("utf-8")
+ *     elif t == bytes:
+ *         return s             # <<<<<<<<<<<<<<
  *     else:
- *         # TODO when msg.type is error , msg.data will be nil ?
+ *         raise Exception("type %s can't convert to bytes" % str(t))
  */
     __Pyx_XDECREF(__pyx_r);
-    __Pyx_INCREF(__pyx_tuple_);
-    __pyx_r = __pyx_tuple_;
+    __Pyx_INCREF(__pyx_v_s);
+    __pyx_r = __pyx_v_s;
     goto __pyx_L0;
 
-    /* "src/cy_src/skynet_py_mq.pyx":23
- *         Py_XDECREF(<PyObject*>msg.data)
- *         ret = skynet_py_queue_pop(&msg)
- *     if ret != 0:             # <<<<<<<<<<<<<<
- *         return None, None, None, None, None
+    /* "src/cy_src/skynet_py_main.pyx":37
+ *     if t == str:
+ *         return s.encode("utf-8")
+ *     elif t == bytes:             # <<<<<<<<<<<<<<
+ *         return s
  *     else:
  */
   }
 
-  /* "src/cy_src/skynet_py_mq.pyx":27
+  /* "src/cy_src/skynet_py_main.pyx":40
+ *         return s
  *     else:
- *         # TODO when msg.type is error , msg.data will be nil ?
- *         if msg.data != NULL:             # <<<<<<<<<<<<<<
- *             return msg.source, msg.type, msg.session, PyCapsule_New(msg.data, "pyptr", free_pyptr), msg.size
- *         else:
+ *         raise Exception("type %s can't convert to bytes" % str(t))             # <<<<<<<<<<<<<<
+ * 
+ * def setlenv(key, capsule_or_bytes, py_sz=None):
  */
   /*else*/ {
-    __pyx_t_1 = ((__pyx_v_msg.data != NULL) != 0);
-    if (__pyx_t_1) {
-
-      /* "src/cy_src/skynet_py_mq.pyx":28
- *         # TODO when msg.type is error , msg.data will be nil ?
- *         if msg.data != NULL:
- *             return msg.source, msg.type, msg.session, PyCapsule_New(msg.data, "pyptr", free_pyptr), msg.size             # <<<<<<<<<<<<<<
- *         else:
- *             return msg.source, msg.type, msg.session, b"", 0
- */
-      __Pyx_XDECREF(__pyx_r);
-      __pyx_t_3 = __Pyx_PyInt_From_uint32_t(__pyx_v_msg.source); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 28, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_3);
-      __pyx_t_4 = __Pyx_PyInt_From_int(__pyx_v_msg.type); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 28, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_4);
-      __pyx_t_5 = __Pyx_PyInt_From_int(__pyx_v_msg.session); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 28, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_5);
-      __pyx_t_6 = PyCapsule_New(__pyx_v_msg.data, ((char *)"pyptr"), __pyx_f_8pyskynet_12skynet_py_mq_free_pyptr); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 28, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_6);
-      __pyx_t_7 = __Pyx_PyInt_FromSize_t(__pyx_v_msg.size); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 28, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_7);
-      __pyx_t_8 = PyTuple_New(5); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 28, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_8);
-      __Pyx_GIVEREF(__pyx_t_3);
-      PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_3);
-      __Pyx_GIVEREF(__pyx_t_4);
-      PyTuple_SET_ITEM(__pyx_t_8, 1, __pyx_t_4);
-      __Pyx_GIVEREF(__pyx_t_5);
-      PyTuple_SET_ITEM(__pyx_t_8, 2, __pyx_t_5);
-      __Pyx_GIVEREF(__pyx_t_6);
-      PyTuple_SET_ITEM(__pyx_t_8, 3, __pyx_t_6);
-      __Pyx_GIVEREF(__pyx_t_7);
-      PyTuple_SET_ITEM(__pyx_t_8, 4, __pyx_t_7);
-      __pyx_t_3 = 0;
-      __pyx_t_4 = 0;
-      __pyx_t_5 = 0;
-      __pyx_t_6 = 0;
-      __pyx_t_7 = 0;
-      __pyx_r = __pyx_t_8;
-      __pyx_t_8 = 0;
-      goto __pyx_L0;
-
-      /* "src/cy_src/skynet_py_mq.pyx":27
- *     else:
- *         # TODO when msg.type is error , msg.data will be nil ?
- *         if msg.data != NULL:             # <<<<<<<<<<<<<<
- *             return msg.source, msg.type, msg.session, PyCapsule_New(msg.data, "pyptr", free_pyptr), msg.size
- *         else:
- */
-    }
-
-    /* "src/cy_src/skynet_py_mq.pyx":30
- *             return msg.source, msg.type, msg.session, PyCapsule_New(msg.data, "pyptr", free_pyptr), msg.size
- *         else:
- *             return msg.source, msg.type, msg.session, b"", 0             # <<<<<<<<<<<<<<
- * 
- * # see lsend in lua-skynet.c
- */
-    /*else*/ {
-      __Pyx_XDECREF(__pyx_r);
-      __pyx_t_8 = __Pyx_PyInt_From_uint32_t(__pyx_v_msg.source); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 30, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_8);
-      __pyx_t_7 = __Pyx_PyInt_From_int(__pyx_v_msg.type); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 30, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_7);
-      __pyx_t_6 = __Pyx_PyInt_From_int(__pyx_v_msg.session); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 30, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_6);
-      __pyx_t_5 = PyTuple_New(5); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 30, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_5);
-      __Pyx_GIVEREF(__pyx_t_8);
-      PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_8);
-      __Pyx_GIVEREF(__pyx_t_7);
-      PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_7);
-      __Pyx_GIVEREF(__pyx_t_6);
-      PyTuple_SET_ITEM(__pyx_t_5, 2, __pyx_t_6);
-      __Pyx_INCREF(__pyx_kp_b__2);
-      __Pyx_GIVEREF(__pyx_kp_b__2);
-      PyTuple_SET_ITEM(__pyx_t_5, 3, __pyx_kp_b__2);
-      __Pyx_INCREF(__pyx_int_0);
-      __Pyx_GIVEREF(__pyx_int_0);
-      PyTuple_SET_ITEM(__pyx_t_5, 4, __pyx_int_0);
-      __pyx_t_8 = 0;
-      __pyx_t_7 = 0;
-      __pyx_t_6 = 0;
-      __pyx_r = __pyx_t_5;
-      __pyx_t_5 = 0;
-      goto __pyx_L0;
-    }
+    __pyx_t_1 = __Pyx_PyObject_Str(((PyObject *)__pyx_v_t)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 40, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_1);
+    __pyx_t_3 = __Pyx_PyUnicode_FormatSafe(__pyx_kp_u_type_s_can_t_convert_to_bytes, __pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 40, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_3);
+    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+    __pyx_t_1 = __Pyx_PyObject_CallOneArg(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])), __pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 40, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_1);
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    __Pyx_Raise(__pyx_t_1, 0, 0, 0);
+    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+    __PYX_ERR(0, 40, __pyx_L1_error)
   }
 
-  /* "src/cy_src/skynet_py_mq.pyx":17
- *     skynet_free(ptr)
+  /* "src/cy_src/skynet_py_main.pyx":33
+ *             )
  * 
- * def crecv():             # <<<<<<<<<<<<<<
- *     cdef SkynetPyMessage msg
- *     cdef int ret = skynet_py_queue_pop(&msg)
+ * cdef __check_bytes(s):             # <<<<<<<<<<<<<<
+ *     t = type(s)
+ *     if t == str:
  */
 
   /* function exit code */
   __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_3);
   __Pyx_XDECREF(__pyx_t_4);
-  __Pyx_XDECREF(__pyx_t_5);
-  __Pyx_XDECREF(__pyx_t_6);
-  __Pyx_XDECREF(__pyx_t_7);
-  __Pyx_XDECREF(__pyx_t_8);
-  __Pyx_AddTraceback("pyskynet.skynet_py_mq.crecv", __pyx_clineno, __pyx_lineno, __pyx_filename);
-  __pyx_r = NULL;
+  __Pyx_AddTraceback("pyskynet.skynet_py_main.__check_bytes", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = 0;
   __pyx_L0:;
+  __Pyx_XDECREF((PyObject *)__pyx_v_t);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "src/cy_src/skynet_py_mq.pyx":33
+/* "src/cy_src/skynet_py_main.pyx":42
+ *         raise Exception("type %s can't convert to bytes" % str(t))
  * 
- * # see lsend in lua-skynet.c
- * def csend(py_dst, int type_id, py_session, py_msg, py_size=None):             # <<<<<<<<<<<<<<
- *     assert skynet_py_address() > 0, "skynet threads has not been started yet, call 'pyskynet.start()' first."
- *     # 1. check dst
+ * def setlenv(key, capsule_or_bytes, py_sz=None):             # <<<<<<<<<<<<<<
+ *     cdef size_t sz
+ *     cdef const char *ptr
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_8pyskynet_12skynet_py_mq_3csend(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_mdef_8pyskynet_12skynet_py_mq_3csend = {"csend", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_8pyskynet_12skynet_py_mq_3csend, METH_VARARGS|METH_KEYWORDS, 0};
-static PyObject *__pyx_pw_8pyskynet_12skynet_py_mq_3csend(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
-  PyObject *__pyx_v_py_dst = 0;
-  int __pyx_v_type_id;
-  PyObject *__pyx_v_py_session = 0;
-  PyObject *__pyx_v_py_msg = 0;
-  PyObject *__pyx_v_py_size = 0;
+static PyObject *__pyx_pw_8pyskynet_14skynet_py_main_3setlenv(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+); /*proto*/
+static PyMethodDef __pyx_mdef_8pyskynet_14skynet_py_main_3setlenv = {"setlenv", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_8pyskynet_14skynet_py_main_3setlenv, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_8pyskynet_14skynet_py_main_3setlenv(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+) {
+  PyObject *__pyx_v_key = 0;
+  PyObject *__pyx_v_capsule_or_bytes = 0;
+  PyObject *__pyx_v_py_sz = 0;
+  #if !CYTHON_METH_FASTCALL
+  CYTHON_UNUSED const Py_ssize_t __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
+  #endif
+  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
-  __Pyx_RefNannySetupContext("csend (wrapper)", 0);
+  __Pyx_RefNannySetupContext("setlenv (wrapper)", 0);
   {
-    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_py_dst,&__pyx_n_s_type_id,&__pyx_n_s_py_session,&__pyx_n_s_py_msg,&__pyx_n_s_py_size,0};
-    PyObject* values[5] = {0,0,0,0,0};
-    values[4] = ((PyObject *)Py_None);
-    if (unlikely(__pyx_kwds)) {
+    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_key,&__pyx_n_s_capsule_or_bytes,&__pyx_n_s_py_sz,0};
+    PyObject* values[3] = {0,0,0};
+    values[2] = ((PyObject *)((PyObject *)Py_None));
+    if (__pyx_kwds) {
       Py_ssize_t kw_args;
-      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
-      switch (pos_args) {
-        case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
-        CYTHON_FALLTHROUGH;
-        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
+      switch (__pyx_nargs) {
+        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
         CYTHON_FALLTHROUGH;
-        case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
+        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
         CYTHON_FALLTHROUGH;
-        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
-        CYTHON_FALLTHROUGH;
-        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
+        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
         CYTHON_FALLTHROUGH;
         case  0: break;
         default: goto __pyx_L5_argtuple_error;
       }
-      kw_args = PyDict_Size(__pyx_kwds);
-      switch (pos_args) {
+      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
+      switch (__pyx_nargs) {
         case  0:
-        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_py_dst)) != 0)) kw_args--;
+        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_key)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 42, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
-        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_type_id)) != 0)) kw_args--;
+        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_capsule_or_bytes)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 42, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("csend", 0, 4, 5, 1); __PYX_ERR(0, 33, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("setlenv", 0, 2, 3, 1); __PYX_ERR(0, 42, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
-        if (likely((values[2] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_py_session)) != 0)) kw_args--;
-        else {
-          __Pyx_RaiseArgtupleInvalid("csend", 0, 4, 5, 2); __PYX_ERR(0, 33, __pyx_L3_error)
-        }
-        CYTHON_FALLTHROUGH;
-        case  3:
-        if (likely((values[3] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_py_msg)) != 0)) kw_args--;
-        else {
-          __Pyx_RaiseArgtupleInvalid("csend", 0, 4, 5, 3); __PYX_ERR(0, 33, __pyx_L3_error)
-        }
-        CYTHON_FALLTHROUGH;
-        case  4:
         if (kw_args > 0) {
-          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_py_size);
-          if (value) { values[4] = value; kw_args--; }
+          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_py_sz);
+          if (value) { values[2] = value; kw_args--; }
+          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 42, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "csend") < 0)) __PYX_ERR(0, 33, __pyx_L3_error)
+        const Py_ssize_t kwd_pos_args = __pyx_nargs;
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "setlenv") < 0)) __PYX_ERR(0, 42, __pyx_L3_error)
       }
     } else {
-      switch (PyTuple_GET_SIZE(__pyx_args)) {
-        case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
+      switch (__pyx_nargs) {
+        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
         CYTHON_FALLTHROUGH;
-        case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
-        values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
-        values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
-        values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
+        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
+        values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
         break;
         default: goto __pyx_L5_argtuple_error;
       }
     }
-    __pyx_v_py_dst = values[0];
-    __pyx_v_type_id = __Pyx_PyInt_As_int(values[1]); if (unlikely((__pyx_v_type_id == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 33, __pyx_L3_error)
-    __pyx_v_py_session = values[2];
-    __pyx_v_py_msg = values[3];
-    __pyx_v_py_size = values[4];
+    __pyx_v_key = values[0];
+    __pyx_v_capsule_or_bytes = values[1];
+    __pyx_v_py_sz = values[2];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("csend", 0, 4, 5, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 33, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("setlenv", 0, 2, 3, __pyx_nargs); __PYX_ERR(0, 42, __pyx_L3_error)
   __pyx_L3_error:;
-  __Pyx_AddTraceback("pyskynet.skynet_py_mq.csend", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("pyskynet.skynet_py_main.setlenv", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_8pyskynet_12skynet_py_mq_2csend(__pyx_self, __pyx_v_py_dst, __pyx_v_type_id, __pyx_v_py_session, __pyx_v_py_msg, __pyx_v_py_size);
+  __pyx_r = __pyx_pf_8pyskynet_14skynet_py_main_2setlenv(__pyx_self, __pyx_v_key, __pyx_v_capsule_or_bytes, __pyx_v_py_sz);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8pyskynet_12skynet_py_mq_2csend(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_py_dst, int __pyx_v_type_id, PyObject *__pyx_v_py_session, PyObject *__pyx_v_py_msg, PyObject *__pyx_v_py_size) {
-  char *__pyx_v_dstname;
-  int __pyx_v_dst;
-  PyObject *__pyx_v_py_dst_bytes = 0;
-  int __pyx_v_session;
-  char *__pyx_v_ptr;
-  int __pyx_v_size;
-  CYTHON_UNUSED PyObject *__pyx_v_py_msg_bytes = 0;
+static PyObject *__pyx_pf_8pyskynet_14skynet_py_main_2setlenv(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_key, PyObject *__pyx_v_capsule_or_bytes, PyObject *__pyx_v_py_sz) {
+  size_t __pyx_v_sz;
+  char const *__pyx_v_ptr;
+  int __pyx_v_ret;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   int __pyx_t_1;
-  char *__pyx_t_2;
-  PyObject *__pyx_t_3 = NULL;
-  int __pyx_t_4;
-  int __pyx_t_5;
-  void *__pyx_t_6;
-  Py_ssize_t __pyx_t_7;
-  PyObject *__pyx_t_8 = NULL;
+  void *__pyx_t_2;
+  size_t __pyx_t_3;
+  char const *__pyx_t_4;
+  Py_ssize_t __pyx_t_5;
+  PyObject *__pyx_t_6 = NULL;
+  char const *__pyx_t_7;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
-  __Pyx_RefNannySetupContext("csend", 0);
+  __Pyx_RefNannySetupContext("setlenv", 0);
+  __Pyx_INCREF(__pyx_v_key);
 
-  /* "src/cy_src/skynet_py_mq.pyx":34
- * # see lsend in lua-skynet.c
- * def csend(py_dst, int type_id, py_session, py_msg, py_size=None):
- *     assert skynet_py_address() > 0, "skynet threads has not been started yet, call 'pyskynet.start()' first."             # <<<<<<<<<<<<<<
- *     # 1. check dst
- *     cdef char * dstname = NULL
- */
-  #ifndef CYTHON_WITHOUT_ASSERTIONS
-  if (unlikely(!Py_OptimizeFlag)) {
-    if (unlikely(!((skynet_py_address() > 0) != 0))) {
-      PyErr_SetObject(PyExc_AssertionError, __pyx_kp_u_skynet_threads_has_not_been_star);
-      __PYX_ERR(0, 34, __pyx_L1_error)
-    }
-  }
-  #endif
-
-  /* "src/cy_src/skynet_py_mq.pyx":36
- *     assert skynet_py_address() > 0, "skynet threads has not been started yet, call 'pyskynet.start()' first."
- *     # 1. check dst
- *     cdef char * dstname = NULL             # <<<<<<<<<<<<<<
- *     cdef int dst = 0
- *     cdef bytes py_dst_bytes
- */
-  __pyx_v_dstname = NULL;
-
-  /* "src/cy_src/skynet_py_mq.pyx":37
- *     # 1. check dst
- *     cdef char * dstname = NULL
- *     cdef int dst = 0             # <<<<<<<<<<<<<<
- *     cdef bytes py_dst_bytes
- *     if PyBytes_CheckExact(py_dst):
- */
-  __pyx_v_dst = 0;
-
-  /* "src/cy_src/skynet_py_mq.pyx":39
- *     cdef int dst = 0
- *     cdef bytes py_dst_bytes
- *     if PyBytes_CheckExact(py_dst):             # <<<<<<<<<<<<<<
- *         dstname = py_dst
- *     elif PyUnicode_CheckExact(py_dst):
+  /* "src/cy_src/skynet_py_main.pyx":45
+ *     cdef size_t sz
+ *     cdef const char *ptr
+ *     if PyCapsule_CheckExact(capsule_or_bytes):             # <<<<<<<<<<<<<<
+ *         ptr = <char *>PyCapsule_GetPointer(capsule_or_bytes, "cptr")
+ *         sz = py_sz
  */
-  __pyx_t_1 = (PyBytes_CheckExact(__pyx_v_py_dst) != 0);
+  __pyx_t_1 = PyCapsule_CheckExact(__pyx_v_capsule_or_bytes);
   if (__pyx_t_1) {
 
-    /* "src/cy_src/skynet_py_mq.pyx":40
- *     cdef bytes py_dst_bytes
- *     if PyBytes_CheckExact(py_dst):
- *         dstname = py_dst             # <<<<<<<<<<<<<<
- *     elif PyUnicode_CheckExact(py_dst):
- *         py_dst_bytes = PyUnicode_AsUTF8String(py_dst)
- */
-    __pyx_t_2 = __Pyx_PyObject_AsWritableString(__pyx_v_py_dst); if (unlikely((!__pyx_t_2) && PyErr_Occurred())) __PYX_ERR(0, 40, __pyx_L1_error)
-    __pyx_v_dstname = __pyx_t_2;
-
-    /* "src/cy_src/skynet_py_mq.pyx":39
- *     cdef int dst = 0
- *     cdef bytes py_dst_bytes
- *     if PyBytes_CheckExact(py_dst):             # <<<<<<<<<<<<<<
- *         dstname = py_dst
- *     elif PyUnicode_CheckExact(py_dst):
+    /* "src/cy_src/skynet_py_main.pyx":46
+ *     cdef const char *ptr
+ *     if PyCapsule_CheckExact(capsule_or_bytes):
+ *         ptr = <char *>PyCapsule_GetPointer(capsule_or_bytes, "cptr")             # <<<<<<<<<<<<<<
+ *         sz = py_sz
+ *     elif PyBytes_CheckExact(capsule_or_bytes):
+ */
+    __pyx_t_2 = PyCapsule_GetPointer(__pyx_v_capsule_or_bytes, ((char const *)"cptr")); if (unlikely(__pyx_t_2 == ((void *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 46, __pyx_L1_error)
+    __pyx_v_ptr = ((char *)__pyx_t_2);
+
+    /* "src/cy_src/skynet_py_main.pyx":47
+ *     if PyCapsule_CheckExact(capsule_or_bytes):
+ *         ptr = <char *>PyCapsule_GetPointer(capsule_or_bytes, "cptr")
+ *         sz = py_sz             # <<<<<<<<<<<<<<
+ *     elif PyBytes_CheckExact(capsule_or_bytes):
+ *         ptr = capsule_or_bytes
+ */
+    __pyx_t_3 = __Pyx_PyInt_As_size_t(__pyx_v_py_sz); if (unlikely((__pyx_t_3 == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 47, __pyx_L1_error)
+    __pyx_v_sz = __pyx_t_3;
+
+    /* "src/cy_src/skynet_py_main.pyx":45
+ *     cdef size_t sz
+ *     cdef const char *ptr
+ *     if PyCapsule_CheckExact(capsule_or_bytes):             # <<<<<<<<<<<<<<
+ *         ptr = <char *>PyCapsule_GetPointer(capsule_or_bytes, "cptr")
+ *         sz = py_sz
  */
     goto __pyx_L3;
   }
 
-  /* "src/cy_src/skynet_py_mq.pyx":41
- *     if PyBytes_CheckExact(py_dst):
- *         dstname = py_dst
- *     elif PyUnicode_CheckExact(py_dst):             # <<<<<<<<<<<<<<
- *         py_dst_bytes = PyUnicode_AsUTF8String(py_dst)
- *         dstname = py_dst_bytes
- */
-  __pyx_t_1 = (PyUnicode_CheckExact(__pyx_v_py_dst) != 0);
-  if (__pyx_t_1) {
-
-    /* "src/cy_src/skynet_py_mq.pyx":42
- *         dstname = py_dst
- *     elif PyUnicode_CheckExact(py_dst):
- *         py_dst_bytes = PyUnicode_AsUTF8String(py_dst)             # <<<<<<<<<<<<<<
- *         dstname = py_dst_bytes
+  /* "src/cy_src/skynet_py_main.pyx":48
+ *         ptr = <char *>PyCapsule_GetPointer(capsule_or_bytes, "cptr")
+ *         sz = py_sz
+ *     elif PyBytes_CheckExact(capsule_or_bytes):             # <<<<<<<<<<<<<<
+ *         ptr = capsule_or_bytes
+ *         sz = len(capsule_or_bytes)
+ */
+  __pyx_t_1 = PyBytes_CheckExact(__pyx_v_capsule_or_bytes);
+  if (likely(__pyx_t_1)) {
+
+    /* "src/cy_src/skynet_py_main.pyx":49
+ *         sz = py_sz
+ *     elif PyBytes_CheckExact(capsule_or_bytes):
+ *         ptr = capsule_or_bytes             # <<<<<<<<<<<<<<
+ *         sz = len(capsule_or_bytes)
  *     else:
  */
-    __pyx_t_3 = PyUnicode_AsUTF8String(__pyx_v_py_dst); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 42, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_3);
-    __pyx_v_py_dst_bytes = ((PyObject*)__pyx_t_3);
-    __pyx_t_3 = 0;
+    __pyx_t_4 = __Pyx_PyObject_AsString(__pyx_v_capsule_or_bytes); if (unlikely((!__pyx_t_4) && PyErr_Occurred())) __PYX_ERR(0, 49, __pyx_L1_error)
+    __pyx_v_ptr = __pyx_t_4;
 
-    /* "src/cy_src/skynet_py_mq.pyx":43
- *     elif PyUnicode_CheckExact(py_dst):
- *         py_dst_bytes = PyUnicode_AsUTF8String(py_dst)
- *         dstname = py_dst_bytes             # <<<<<<<<<<<<<<
+    /* "src/cy_src/skynet_py_main.pyx":50
+ *     elif PyBytes_CheckExact(capsule_or_bytes):
+ *         ptr = capsule_or_bytes
+ *         sz = len(capsule_or_bytes)             # <<<<<<<<<<<<<<
  *     else:
- *         dst = py_dst
+ *         raise Exception("skynet_py env value must be bytes or pointer")
  */
-    if (unlikely(__pyx_v_py_dst_bytes == Py_None)) {
-      PyErr_SetString(PyExc_TypeError, "expected bytes, NoneType found");
-      __PYX_ERR(0, 43, __pyx_L1_error)
-    }
-    __pyx_t_2 = __Pyx_PyBytes_AsWritableString(__pyx_v_py_dst_bytes); if (unlikely((!__pyx_t_2) && PyErr_Occurred())) __PYX_ERR(0, 43, __pyx_L1_error)
-    __pyx_v_dstname = __pyx_t_2;
-
-    /* "src/cy_src/skynet_py_mq.pyx":41
- *     if PyBytes_CheckExact(py_dst):
- *         dstname = py_dst
- *     elif PyUnicode_CheckExact(py_dst):             # <<<<<<<<<<<<<<
- *         py_dst_bytes = PyUnicode_AsUTF8String(py_dst)
- *         dstname = py_dst_bytes
+    __pyx_t_5 = PyObject_Length(__pyx_v_capsule_or_bytes); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 50, __pyx_L1_error)
+    __pyx_v_sz = __pyx_t_5;
+
+    /* "src/cy_src/skynet_py_main.pyx":48
+ *         ptr = <char *>PyCapsule_GetPointer(capsule_or_bytes, "cptr")
+ *         sz = py_sz
+ *     elif PyBytes_CheckExact(capsule_or_bytes):             # <<<<<<<<<<<<<<
+ *         ptr = capsule_or_bytes
+ *         sz = len(capsule_or_bytes)
  */
     goto __pyx_L3;
   }
 
-  /* "src/cy_src/skynet_py_mq.pyx":45
- *         dstname = py_dst_bytes
+  /* "src/cy_src/skynet_py_main.pyx":52
+ *         sz = len(capsule_or_bytes)
  *     else:
- *         dst = py_dst             # <<<<<<<<<<<<<<
- *     # 2. check session
- *     cdef int session = 0
+ *         raise Exception("skynet_py env value must be bytes or pointer")             # <<<<<<<<<<<<<<
+ *     key = __check_bytes(key)
+ *     cdef int ret = skynet_py_setlenv(key, ptr, sz)
  */
   /*else*/ {
-    __pyx_t_4 = __Pyx_PyInt_As_int(__pyx_v_py_dst); if (unlikely((__pyx_t_4 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 45, __pyx_L1_error)
-    __pyx_v_dst = __pyx_t_4;
+    __pyx_t_6 = __Pyx_PyObject_Call(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])), __pyx_tuple_, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 52, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_6);
+    __Pyx_Raise(__pyx_t_6, 0, 0, 0);
+    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
+    __PYX_ERR(0, 52, __pyx_L1_error)
   }
   __pyx_L3:;
 
-  /* "src/cy_src/skynet_py_mq.pyx":47
- *         dst = py_dst
- *     # 2. check session
- *     cdef int session = 0             # <<<<<<<<<<<<<<
- *     if py_session is None:
- *         type_id |= PTYPE_TAG_ALLOCSESSION
- */
-  __pyx_v_session = 0;
-
-  /* "src/cy_src/skynet_py_mq.pyx":48
- *     # 2. check session
- *     cdef int session = 0
- *     if py_session is None:             # <<<<<<<<<<<<<<
- *         type_id |= PTYPE_TAG_ALLOCSESSION
- *         session = 0
- */
-  __pyx_t_1 = (__pyx_v_py_session == Py_None);
-  __pyx_t_5 = (__pyx_t_1 != 0);
-  if (__pyx_t_5) {
-
-    /* "src/cy_src/skynet_py_mq.pyx":49
- *     cdef int session = 0
- *     if py_session is None:
- *         type_id |= PTYPE_TAG_ALLOCSESSION             # <<<<<<<<<<<<<<
- *         session = 0
- *     else:
- */
-    __pyx_v_type_id = (__pyx_v_type_id | PTYPE_TAG_ALLOCSESSION);
-
-    /* "src/cy_src/skynet_py_mq.pyx":50
- *     if py_session is None:
- *         type_id |= PTYPE_TAG_ALLOCSESSION
- *         session = 0             # <<<<<<<<<<<<<<
- *     else:
- *         session = py_session
- */
-    __pyx_v_session = 0;
-
-    /* "src/cy_src/skynet_py_mq.pyx":48
- *     # 2. check session
- *     cdef int session = 0
- *     if py_session is None:             # <<<<<<<<<<<<<<
- *         type_id |= PTYPE_TAG_ALLOCSESSION
- *         session = 0
- */
-    goto __pyx_L4;
-  }
-
-  /* "src/cy_src/skynet_py_mq.pyx":52
- *         session = 0
- *     else:
- *         session = py_session             # <<<<<<<<<<<<<<
- *     # 3. check ptr, size
- *     cdef char * ptr = NULL
- */
-  /*else*/ {
-    __pyx_t_4 = __Pyx_PyInt_As_int(__pyx_v_py_session); if (unlikely((__pyx_t_4 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 52, __pyx_L1_error)
-    __pyx_v_session = __pyx_t_4;
-  }
-  __pyx_L4:;
-
-  /* "src/cy_src/skynet_py_mq.pyx":54
- *         session = py_session
- *     # 3. check ptr, size
- *     cdef char * ptr = NULL             # <<<<<<<<<<<<<<
- *     cdef int size = 0
- *     cdef bytes py_msg_bytes
- */
-  __pyx_v_ptr = NULL;
-
-  /* "src/cy_src/skynet_py_mq.pyx":55
- *     # 3. check ptr, size
- *     cdef char * ptr = NULL
- *     cdef int size = 0             # <<<<<<<<<<<<<<
- *     cdef bytes py_msg_bytes
- *     if PyCapsule_CheckExact(py_msg):
- */
-  __pyx_v_size = 0;
-
-  /* "src/cy_src/skynet_py_mq.pyx":57
- *     cdef int size = 0
- *     cdef bytes py_msg_bytes
- *     if PyCapsule_CheckExact(py_msg):             # <<<<<<<<<<<<<<
- *         type_id |= PTYPE_TAG_DONTCOPY
- *         ptr = <char *>PyCapsule_GetPointer(py_msg, "cptr")
- */
-  __pyx_t_5 = (PyCapsule_CheckExact(__pyx_v_py_msg) != 0);
-  if (__pyx_t_5) {
-
-    /* "src/cy_src/skynet_py_mq.pyx":58
- *     cdef bytes py_msg_bytes
- *     if PyCapsule_CheckExact(py_msg):
- *         type_id |= PTYPE_TAG_DONTCOPY             # <<<<<<<<<<<<<<
- *         ptr = <char *>PyCapsule_GetPointer(py_msg, "cptr")
- *         size = py_size
- */
-    __pyx_v_type_id = (__pyx_v_type_id | PTYPE_TAG_DONTCOPY);
-
-    /* "src/cy_src/skynet_py_mq.pyx":59
- *     if PyCapsule_CheckExact(py_msg):
- *         type_id |= PTYPE_TAG_DONTCOPY
- *         ptr = <char *>PyCapsule_GetPointer(py_msg, "cptr")             # <<<<<<<<<<<<<<
- *         size = py_size
- *     elif PyBytes_CheckExact(py_msg):
- */
-    __pyx_t_6 = PyCapsule_GetPointer(__pyx_v_py_msg, ((char *)"cptr")); if (unlikely(__pyx_t_6 == ((void *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 59, __pyx_L1_error)
-    __pyx_v_ptr = ((char *)__pyx_t_6);
-
-    /* "src/cy_src/skynet_py_mq.pyx":60
- *         type_id |= PTYPE_TAG_DONTCOPY
- *         ptr = <char *>PyCapsule_GetPointer(py_msg, "cptr")
- *         size = py_size             # <<<<<<<<<<<<<<
- *     elif PyBytes_CheckExact(py_msg):
- *         ptr = py_msg
- */
-    __pyx_t_4 = __Pyx_PyInt_As_int(__pyx_v_py_size); if (unlikely((__pyx_t_4 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 60, __pyx_L1_error)
-    __pyx_v_size = __pyx_t_4;
-
-    /* "src/cy_src/skynet_py_mq.pyx":57
- *     cdef int size = 0
- *     cdef bytes py_msg_bytes
- *     if PyCapsule_CheckExact(py_msg):             # <<<<<<<<<<<<<<
- *         type_id |= PTYPE_TAG_DONTCOPY
- *         ptr = <char *>PyCapsule_GetPointer(py_msg, "cptr")
- */
-    goto __pyx_L5;
-  }
-
-  /* "src/cy_src/skynet_py_mq.pyx":61
- *         ptr = <char *>PyCapsule_GetPointer(py_msg, "cptr")
- *         size = py_size
- *     elif PyBytes_CheckExact(py_msg):             # <<<<<<<<<<<<<<
- *         ptr = py_msg
- *         size = len(py_msg)
- */
-  __pyx_t_5 = (PyBytes_CheckExact(__pyx_v_py_msg) != 0);
-  if (__pyx_t_5) {
-
-    /* "src/cy_src/skynet_py_mq.pyx":62
- *         size = py_size
- *     elif PyBytes_CheckExact(py_msg):
- *         ptr = py_msg             # <<<<<<<<<<<<<<
- *         size = len(py_msg)
- *     elif PyUnicode_CheckExact(py_msg):
- */
-    __pyx_t_2 = __Pyx_PyObject_AsWritableString(__pyx_v_py_msg); if (unlikely((!__pyx_t_2) && PyErr_Occurred())) __PYX_ERR(0, 62, __pyx_L1_error)
-    __pyx_v_ptr = __pyx_t_2;
-
-    /* "src/cy_src/skynet_py_mq.pyx":63
- *     elif PyBytes_CheckExact(py_msg):
- *         ptr = py_msg
- *         size = len(py_msg)             # <<<<<<<<<<<<<<
- *     elif PyUnicode_CheckExact(py_msg):
- *         py_msg_bytes = PyUnicode_AsUTF8String(py_msg)
- */
-    __pyx_t_7 = PyObject_Length(__pyx_v_py_msg); if (unlikely(__pyx_t_7 == ((Py_ssize_t)-1))) __PYX_ERR(0, 63, __pyx_L1_error)
-    __pyx_v_size = __pyx_t_7;
-
-    /* "src/cy_src/skynet_py_mq.pyx":61
- *         ptr = <char *>PyCapsule_GetPointer(py_msg, "cptr")
- *         size = py_size
- *     elif PyBytes_CheckExact(py_msg):             # <<<<<<<<<<<<<<
- *         ptr = py_msg
- *         size = len(py_msg)
- */
-    goto __pyx_L5;
-  }
-
-  /* "src/cy_src/skynet_py_mq.pyx":64
- *         ptr = py_msg
- *         size = len(py_msg)
- *     elif PyUnicode_CheckExact(py_msg):             # <<<<<<<<<<<<<<
- *         py_msg_bytes = PyUnicode_AsUTF8String(py_msg)
- *     else:
- */
-  __pyx_t_5 = (PyUnicode_CheckExact(__pyx_v_py_msg) != 0);
-  if (likely(__pyx_t_5)) {
-
-    /* "src/cy_src/skynet_py_mq.pyx":65
- *         size = len(py_msg)
- *     elif PyUnicode_CheckExact(py_msg):
- *         py_msg_bytes = PyUnicode_AsUTF8String(py_msg)             # <<<<<<<<<<<<<<
+  /* "src/cy_src/skynet_py_main.pyx":53
  *     else:
- *         raise Exception("type:%s unexcept when skynet csend"%type(py_msg))
+ *         raise Exception("skynet_py env value must be bytes or pointer")
+ *     key = __check_bytes(key)             # <<<<<<<<<<<<<<
+ *     cdef int ret = skynet_py_setlenv(key, ptr, sz)
+ *     if ret != 0:
  */
-    __pyx_t_3 = PyUnicode_AsUTF8String(__pyx_v_py_msg); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 65, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_3);
-    __pyx_v_py_msg_bytes = ((PyObject*)__pyx_t_3);
-    __pyx_t_3 = 0;
-
-    /* "src/cy_src/skynet_py_mq.pyx":64
- *         ptr = py_msg
- *         size = len(py_msg)
- *     elif PyUnicode_CheckExact(py_msg):             # <<<<<<<<<<<<<<
- *         py_msg_bytes = PyUnicode_AsUTF8String(py_msg)
- *     else:
+  __pyx_t_6 = __pyx_f_8pyskynet_14skynet_py_main___check_bytes(__pyx_v_key); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 53, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_6);
+  __Pyx_DECREF_SET(__pyx_v_key, __pyx_t_6);
+  __pyx_t_6 = 0;
+
+  /* "src/cy_src/skynet_py_main.pyx":54
+ *         raise Exception("skynet_py env value must be bytes or pointer")
+ *     key = __check_bytes(key)
+ *     cdef int ret = skynet_py_setlenv(key, ptr, sz)             # <<<<<<<<<<<<<<
+ *     if ret != 0:
+ *         raise Exception("setlenv but key conflict")
  */
-    goto __pyx_L5;
-  }
+  __pyx_t_7 = __Pyx_PyObject_AsString(__pyx_v_key); if (unlikely((!__pyx_t_7) && PyErr_Occurred())) __PYX_ERR(0, 54, __pyx_L1_error)
+  __pyx_v_ret = skynet_py_setlenv(__pyx_t_7, __pyx_v_ptr, __pyx_v_sz);
 
-  /* "src/cy_src/skynet_py_mq.pyx":67
- *         py_msg_bytes = PyUnicode_AsUTF8String(py_msg)
- *     else:
- *         raise Exception("type:%s unexcept when skynet csend"%type(py_msg))             # <<<<<<<<<<<<<<
+  /* "src/cy_src/skynet_py_main.pyx":55
+ *     key = __check_bytes(key)
+ *     cdef int ret = skynet_py_setlenv(key, ptr, sz)
+ *     if ret != 0:             # <<<<<<<<<<<<<<
+ *         raise Exception("setlenv but key conflict")
  * 
- *     if dstname == NULL:
  */
-  /*else*/ {
-    __pyx_t_3 = __Pyx_PyUnicode_FormatSafe(__pyx_kp_u_type_s_unexcept_when_skynet_csen, ((PyObject *)Py_TYPE(__pyx_v_py_msg))); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 67, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_8 = __Pyx_PyObject_CallOneArg(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])), __pyx_t_3); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 67, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_8);
-    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __Pyx_Raise(__pyx_t_8, 0, 0, 0);
-    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-    __PYX_ERR(0, 67, __pyx_L1_error)
-  }
-  __pyx_L5:;
+  __pyx_t_1 = (__pyx_v_ret != 0);
+  if (unlikely(__pyx_t_1)) {
 
-  /* "src/cy_src/skynet_py_mq.pyx":69
- *         raise Exception("type:%s unexcept when skynet csend"%type(py_msg))
+    /* "src/cy_src/skynet_py_main.pyx":56
+ *     cdef int ret = skynet_py_setlenv(key, ptr, sz)
+ *     if ret != 0:
+ *         raise Exception("setlenv but key conflict")             # <<<<<<<<<<<<<<
  * 
- *     if dstname == NULL:             # <<<<<<<<<<<<<<
- *         session = skynet_py_send(dst, type_id, session, ptr, size)
- *     else:
- */
-  __pyx_t_5 = ((__pyx_v_dstname == NULL) != 0);
-  if (__pyx_t_5) {
-
-    /* "src/cy_src/skynet_py_mq.pyx":70
  * 
- *     if dstname == NULL:
- *         session = skynet_py_send(dst, type_id, session, ptr, size)             # <<<<<<<<<<<<<<
- *     else:
- *         session = skynet_py_sendname(dstname, type_id, session, ptr, size)
  */
-    __pyx_v_session = skynet_py_send(__pyx_v_dst, __pyx_v_type_id, __pyx_v_session, __pyx_v_ptr, __pyx_v_size);
+    __pyx_t_6 = __Pyx_PyObject_Call(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])), __pyx_tuple__2, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 56, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_6);
+    __Pyx_Raise(__pyx_t_6, 0, 0, 0);
+    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
+    __PYX_ERR(0, 56, __pyx_L1_error)
 
-    /* "src/cy_src/skynet_py_mq.pyx":69
- *         raise Exception("type:%s unexcept when skynet csend"%type(py_msg))
+    /* "src/cy_src/skynet_py_main.pyx":55
+ *     key = __check_bytes(key)
+ *     cdef int ret = skynet_py_setlenv(key, ptr, sz)
+ *     if ret != 0:             # <<<<<<<<<<<<<<
+ *         raise Exception("setlenv but key conflict")
  * 
- *     if dstname == NULL:             # <<<<<<<<<<<<<<
- *         session = skynet_py_send(dst, type_id, session, ptr, size)
- *     else:
  */
-    goto __pyx_L6;
-  }
-
-  /* "src/cy_src/skynet_py_mq.pyx":72
- *         session = skynet_py_send(dst, type_id, session, ptr, size)
- *     else:
- *         session = skynet_py_sendname(dstname, type_id, session, ptr, size)             # <<<<<<<<<<<<<<
- *     if session < 0:
- *         if session == -2:
- */
-  /*else*/ {
-    __pyx_v_session = skynet_py_sendname(__pyx_v_dstname, __pyx_v_type_id, __pyx_v_session, __pyx_v_ptr, __pyx_v_size);
   }
-  __pyx_L6:;
 
-  /* "src/cy_src/skynet_py_mq.pyx":73
- *     else:
- *         session = skynet_py_sendname(dstname, type_id, session, ptr, size)
- *     if session < 0:             # <<<<<<<<<<<<<<
- *         if session == -2:
- *             raise Exception("package is too large:%s"%session)
- */
-  __pyx_t_5 = ((__pyx_v_session < 0) != 0);
-  if (__pyx_t_5) {
-
-    /* "src/cy_src/skynet_py_mq.pyx":74
- *         session = skynet_py_sendname(dstname, type_id, session, ptr, size)
- *     if session < 0:
- *         if session == -2:             # <<<<<<<<<<<<<<
- *             raise Exception("package is too large:%s"%session)
- *         else:
- */
-    __pyx_t_5 = ((__pyx_v_session == -2L) != 0);
-    if (unlikely(__pyx_t_5)) {
-
-      /* "src/cy_src/skynet_py_mq.pyx":75
- *     if session < 0:
- *         if session == -2:
- *             raise Exception("package is too large:%s"%session)             # <<<<<<<<<<<<<<
- *         else:
- *             return None
- */
-      __pyx_t_8 = __Pyx_PyInt_From_int(__pyx_v_session); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 75, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_8);
-      __pyx_t_3 = PyUnicode_Format(__pyx_kp_u_package_is_too_large_s, __pyx_t_8); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 75, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_3);
-      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-      __pyx_t_8 = __Pyx_PyObject_CallOneArg(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])), __pyx_t_3); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 75, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_8);
-      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-      __Pyx_Raise(__pyx_t_8, 0, 0, 0);
-      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-      __PYX_ERR(0, 75, __pyx_L1_error)
-
-      /* "src/cy_src/skynet_py_mq.pyx":74
- *         session = skynet_py_sendname(dstname, type_id, session, ptr, size)
- *     if session < 0:
- *         if session == -2:             # <<<<<<<<<<<<<<
- *             raise Exception("package is too large:%s"%session)
- *         else:
- */
-    }
-
-    /* "src/cy_src/skynet_py_mq.pyx":77
- *             raise Exception("package is too large:%s"%session)
- *         else:
- *             return None             # <<<<<<<<<<<<<<
- *     else:
- *         return session
- */
-    /*else*/ {
-      __Pyx_XDECREF(__pyx_r);
-      __pyx_r = Py_None; __Pyx_INCREF(Py_None);
-      goto __pyx_L0;
-    }
-
-    /* "src/cy_src/skynet_py_mq.pyx":73
- *     else:
- *         session = skynet_py_sendname(dstname, type_id, session, ptr, size)
- *     if session < 0:             # <<<<<<<<<<<<<<
- *         if session == -2:
- *             raise Exception("package is too large:%s"%session)
- */
-  }
-
-  /* "src/cy_src/skynet_py_mq.pyx":79
- *             return None
- *     else:
- *         return session             # <<<<<<<<<<<<<<
+  /* "src/cy_src/skynet_py_main.pyx":42
+ *         raise Exception("type %s can't convert to bytes" % str(t))
  * 
- * # extern
- */
-  /*else*/ {
-    __Pyx_XDECREF(__pyx_r);
-    __pyx_t_8 = __Pyx_PyInt_From_int(__pyx_v_session); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 79, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_8);
-    __pyx_r = __pyx_t_8;
-    __pyx_t_8 = 0;
-    goto __pyx_L0;
-  }
-
-  /* "src/cy_src/skynet_py_mq.pyx":33
- * 
- * # see lsend in lua-skynet.c
- * def csend(py_dst, int type_id, py_session, py_msg, py_size=None):             # <<<<<<<<<<<<<<
- *     assert skynet_py_address() > 0, "skynet threads has not been started yet, call 'pyskynet.start()' first."
- *     # 1. check dst
+ * def setlenv(key, capsule_or_bytes, py_sz=None):             # <<<<<<<<<<<<<<
+ *     cdef size_t sz
+ *     cdef const char *ptr
  */
 
   /* function exit code */
+  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
+  goto __pyx_L0;
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_3);
-  __Pyx_XDECREF(__pyx_t_8);
-  __Pyx_AddTraceback("pyskynet.skynet_py_mq.csend", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_XDECREF(__pyx_t_6);
+  __Pyx_AddTraceback("pyskynet.skynet_py_main.setlenv", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
-  __Pyx_XDECREF(__pyx_v_py_dst_bytes);
-  __Pyx_XDECREF(__pyx_v_py_msg_bytes);
+  __Pyx_XDECREF(__pyx_v_key);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "src/cy_src/skynet_py_mq.pyx":82
+/* "src/cy_src/skynet_py_main.pyx":60
+ * 
  * 
- * # extern
- * def tostring(capsule, size_t size):             # <<<<<<<<<<<<<<
- *     b = tobytes(capsule, size)
- *     return b.decode()
+ * def getlenv(key):             # <<<<<<<<<<<<<<
+ *     key = __check_bytes(key)
+ *     cdef size_t sz
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_8pyskynet_12skynet_py_mq_5tostring(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_mdef_8pyskynet_12skynet_py_mq_5tostring = {"tostring", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_8pyskynet_12skynet_py_mq_5tostring, METH_VARARGS|METH_KEYWORDS, 0};
-static PyObject *__pyx_pw_8pyskynet_12skynet_py_mq_5tostring(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
-  PyObject *__pyx_v_capsule = 0;
-  size_t __pyx_v_size;
+static PyObject *__pyx_pw_8pyskynet_14skynet_py_main_5getlenv(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+); /*proto*/
+static PyMethodDef __pyx_mdef_8pyskynet_14skynet_py_main_5getlenv = {"getlenv", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_8pyskynet_14skynet_py_main_5getlenv, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_8pyskynet_14skynet_py_main_5getlenv(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+) {
+  PyObject *__pyx_v_key = 0;
+  #if !CYTHON_METH_FASTCALL
+  CYTHON_UNUSED const Py_ssize_t __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
+  #endif
+  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
-  __Pyx_RefNannySetupContext("tostring (wrapper)", 0);
+  __Pyx_RefNannySetupContext("getlenv (wrapper)", 0);
   {
-    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_capsule,&__pyx_n_s_size,0};
-    PyObject* values[2] = {0,0};
-    if (unlikely(__pyx_kwds)) {
+    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_key,0};
+    PyObject* values[1] = {0};
+    if (__pyx_kwds) {
       Py_ssize_t kw_args;
-      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
-      switch (pos_args) {
-        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
-        CYTHON_FALLTHROUGH;
-        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
+      switch (__pyx_nargs) {
+        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
         CYTHON_FALLTHROUGH;
         case  0: break;
         default: goto __pyx_L5_argtuple_error;
       }
-      kw_args = PyDict_Size(__pyx_kwds);
-      switch (pos_args) {
+      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
+      switch (__pyx_nargs) {
         case  0:
-        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_capsule)) != 0)) kw_args--;
+        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_key)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 60, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
-        CYTHON_FALLTHROUGH;
-        case  1:
-        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_size)) != 0)) kw_args--;
-        else {
-          __Pyx_RaiseArgtupleInvalid("tostring", 1, 2, 2, 1); __PYX_ERR(0, 82, __pyx_L3_error)
-        }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "tostring") < 0)) __PYX_ERR(0, 82, __pyx_L3_error)
+        const Py_ssize_t kwd_pos_args = __pyx_nargs;
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "getlenv") < 0)) __PYX_ERR(0, 60, __pyx_L3_error)
       }
-    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
+    } else if (unlikely(__pyx_nargs != 1)) {
       goto __pyx_L5_argtuple_error;
     } else {
-      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
-      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
+      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
     }
-    __pyx_v_capsule = values[0];
-    __pyx_v_size = __Pyx_PyInt_As_size_t(values[1]); if (unlikely((__pyx_v_size == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 82, __pyx_L3_error)
+    __pyx_v_key = values[0];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("tostring", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 82, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("getlenv", 1, 1, 1, __pyx_nargs); __PYX_ERR(0, 60, __pyx_L3_error)
   __pyx_L3_error:;
-  __Pyx_AddTraceback("pyskynet.skynet_py_mq.tostring", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("pyskynet.skynet_py_main.getlenv", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_8pyskynet_12skynet_py_mq_4tostring(__pyx_self, __pyx_v_capsule, __pyx_v_size);
+  __pyx_r = __pyx_pf_8pyskynet_14skynet_py_main_4getlenv(__pyx_self, __pyx_v_key);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8pyskynet_12skynet_py_mq_4tostring(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_capsule, size_t __pyx_v_size) {
-  PyObject *__pyx_v_b = NULL;
+static PyObject *__pyx_pf_8pyskynet_14skynet_py_main_4getlenv(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_key) {
+  size_t __pyx_v_sz;
+  char const *__pyx_v_value;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
-  PyObject *__pyx_t_2 = NULL;
-  PyObject *__pyx_t_3 = NULL;
-  PyObject *__pyx_t_4 = NULL;
-  int __pyx_t_5;
-  PyObject *__pyx_t_6 = NULL;
+  char const *__pyx_t_2;
+  int __pyx_t_3;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
-  __Pyx_RefNannySetupContext("tostring", 0);
+  __Pyx_RefNannySetupContext("getlenv", 0);
+  __Pyx_INCREF(__pyx_v_key);
 
-  /* "src/cy_src/skynet_py_mq.pyx":83
- * # extern
- * def tostring(capsule, size_t size):
- *     b = tobytes(capsule, size)             # <<<<<<<<<<<<<<
- *     return b.decode()
+  /* "src/cy_src/skynet_py_main.pyx":61
  * 
+ * def getlenv(key):
+ *     key = __check_bytes(key)             # <<<<<<<<<<<<<<
+ *     cdef size_t sz
+ *     cdef const char * value = skynet_py_getlenv(key, &sz);
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_tobytes); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 83, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = __Pyx_PyInt_FromSize_t(__pyx_v_size); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 83, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = NULL;
-  __pyx_t_5 = 0;
-  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
-    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
-    if (likely(__pyx_t_4)) {
-      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
-      __Pyx_INCREF(__pyx_t_4);
-      __Pyx_INCREF(function);
-      __Pyx_DECREF_SET(__pyx_t_2, function);
-      __pyx_t_5 = 1;
-    }
-  }
-  #if CYTHON_FAST_PYCALL
-  if (PyFunction_Check(__pyx_t_2)) {
-    PyObject *__pyx_temp[3] = {__pyx_t_4, __pyx_v_capsule, __pyx_t_3};
-    __pyx_t_1 = __Pyx_PyFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 83, __pyx_L1_error)
-    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __Pyx_GOTREF(__pyx_t_1);
-    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  } else
-  #endif
-  #if CYTHON_FAST_PYCCALL
-  if (__Pyx_PyFastCFunction_Check(__pyx_t_2)) {
-    PyObject *__pyx_temp[3] = {__pyx_t_4, __pyx_v_capsule, __pyx_t_3};
-    __pyx_t_1 = __Pyx_PyCFunction_FastCall(__pyx_t_2, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 83, __pyx_L1_error)
-    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __Pyx_GOTREF(__pyx_t_1);
-    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  } else
-  #endif
-  {
-    __pyx_t_6 = PyTuple_New(2+__pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 83, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_6);
-    if (__pyx_t_4) {
-      __Pyx_GIVEREF(__pyx_t_4); PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_4); __pyx_t_4 = NULL;
-    }
-    __Pyx_INCREF(__pyx_v_capsule);
-    __Pyx_GIVEREF(__pyx_v_capsule);
-    PyTuple_SET_ITEM(__pyx_t_6, 0+__pyx_t_5, __pyx_v_capsule);
-    __Pyx_GIVEREF(__pyx_t_3);
-    PyTuple_SET_ITEM(__pyx_t_6, 1+__pyx_t_5, __pyx_t_3);
-    __pyx_t_3 = 0;
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_t_2, __pyx_t_6, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 83, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_8pyskynet_14skynet_py_main___check_bytes(__pyx_v_key); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 61, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  __Pyx_DECREF_SET(__pyx_v_key, __pyx_t_1);
+  __pyx_t_1 = 0;
+
+  /* "src/cy_src/skynet_py_main.pyx":63
+ *     key = __check_bytes(key)
+ *     cdef size_t sz
+ *     cdef const char * value = skynet_py_getlenv(key, &sz);             # <<<<<<<<<<<<<<
+ *     if value != NULL:
+ *         return PyBytes_FromStringAndSize(value, sz);
+ */
+  __pyx_t_2 = __Pyx_PyObject_AsString(__pyx_v_key); if (unlikely((!__pyx_t_2) && PyErr_Occurred())) __PYX_ERR(0, 63, __pyx_L1_error)
+  __pyx_v_value = skynet_py_getlenv(__pyx_t_2, (&__pyx_v_sz));
+
+  /* "src/cy_src/skynet_py_main.pyx":64
+ *     cdef size_t sz
+ *     cdef const char * value = skynet_py_getlenv(key, &sz);
+ *     if value != NULL:             # <<<<<<<<<<<<<<
+ *         return PyBytes_FromStringAndSize(value, sz);
+ *     else:
+ */
+  __pyx_t_3 = (__pyx_v_value != NULL);
+  if (likely(__pyx_t_3)) {
+
+    /* "src/cy_src/skynet_py_main.pyx":65
+ *     cdef const char * value = skynet_py_getlenv(key, &sz);
+ *     if value != NULL:
+ *         return PyBytes_FromStringAndSize(value, sz);             # <<<<<<<<<<<<<<
+ *     else:
+ *         raise Exception("getlenv but value not existed")
+ */
+    __Pyx_XDECREF(__pyx_r);
+    __pyx_t_1 = PyBytes_FromStringAndSize(__pyx_v_value, __pyx_v_sz); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 65, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
+    __pyx_r = __pyx_t_1;
+    __pyx_t_1 = 0;
+    goto __pyx_L0;
+
+    /* "src/cy_src/skynet_py_main.pyx":64
+ *     cdef size_t sz
+ *     cdef const char * value = skynet_py_getlenv(key, &sz);
+ *     if value != NULL:             # <<<<<<<<<<<<<<
+ *         return PyBytes_FromStringAndSize(value, sz);
+ *     else:
+ */
   }
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_v_b = __pyx_t_1;
-  __pyx_t_1 = 0;
 
-  /* "src/cy_src/skynet_py_mq.pyx":84
- * def tostring(capsule, size_t size):
- *     b = tobytes(capsule, size)
- *     return b.decode()             # <<<<<<<<<<<<<<
+  /* "src/cy_src/skynet_py_main.pyx":67
+ *         return PyBytes_FromStringAndSize(value, sz);
+ *     else:
+ *         raise Exception("getlenv but value not existed")             # <<<<<<<<<<<<<<
  * 
- * # extern
+ * def nextenv(key):
  */
-  __Pyx_XDECREF(__pyx_r);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_b, __pyx_n_s_decode); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 84, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_6 = NULL;
-  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
-    __pyx_t_6 = PyMethod_GET_SELF(__pyx_t_2);
-    if (likely(__pyx_t_6)) {
-      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
-      __Pyx_INCREF(__pyx_t_6);
-      __Pyx_INCREF(function);
-      __Pyx_DECREF_SET(__pyx_t_2, function);
-    }
+  /*else*/ {
+    __pyx_t_1 = __Pyx_PyObject_Call(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])), __pyx_tuple__3, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 67, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_1);
+    __Pyx_Raise(__pyx_t_1, 0, 0, 0);
+    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+    __PYX_ERR(0, 67, __pyx_L1_error)
   }
-  __pyx_t_1 = (__pyx_t_6) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_6) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
-  __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 84, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_r = __pyx_t_1;
-  __pyx_t_1 = 0;
-  goto __pyx_L0;
 
-  /* "src/cy_src/skynet_py_mq.pyx":82
+  /* "src/cy_src/skynet_py_main.pyx":60
+ * 
  * 
- * # extern
- * def tostring(capsule, size_t size):             # <<<<<<<<<<<<<<
- *     b = tobytes(capsule, size)
- *     return b.decode()
+ * def getlenv(key):             # <<<<<<<<<<<<<<
+ *     key = __check_bytes(key)
+ *     cdef size_t sz
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_XDECREF(__pyx_t_2);
-  __Pyx_XDECREF(__pyx_t_3);
-  __Pyx_XDECREF(__pyx_t_4);
-  __Pyx_XDECREF(__pyx_t_6);
-  __Pyx_AddTraceback("pyskynet.skynet_py_mq.tostring", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("pyskynet.skynet_py_main.getlenv", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
-  __Pyx_XDECREF(__pyx_v_b);
+  __Pyx_XDECREF(__pyx_v_key);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "src/cy_src/skynet_py_mq.pyx":87
+/* "src/cy_src/skynet_py_main.pyx":69
+ *         raise Exception("getlenv but value not existed")
  * 
- * # extern
- * def tobytes(capsule, size_t size):             # <<<<<<<<<<<<<<
- *     cdef char *name = PyCapsule_GetName(capsule)
- *     cdef char *ptr = <char *>PyCapsule_GetPointer(capsule, name)
+ * def nextenv(key):             # <<<<<<<<<<<<<<
+ *     cdef const char * ptr
+ *     if key is None:
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_8pyskynet_12skynet_py_mq_7tobytes(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_mdef_8pyskynet_12skynet_py_mq_7tobytes = {"tobytes", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_8pyskynet_12skynet_py_mq_7tobytes, METH_VARARGS|METH_KEYWORDS, 0};
-static PyObject *__pyx_pw_8pyskynet_12skynet_py_mq_7tobytes(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
-  PyObject *__pyx_v_capsule = 0;
-  size_t __pyx_v_size;
+static PyObject *__pyx_pw_8pyskynet_14skynet_py_main_7nextenv(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+); /*proto*/
+static PyMethodDef __pyx_mdef_8pyskynet_14skynet_py_main_7nextenv = {"nextenv", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_8pyskynet_14skynet_py_main_7nextenv, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_8pyskynet_14skynet_py_main_7nextenv(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+) {
+  PyObject *__pyx_v_key = 0;
+  #if !CYTHON_METH_FASTCALL
+  CYTHON_UNUSED const Py_ssize_t __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
+  #endif
+  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
-  __Pyx_RefNannySetupContext("tobytes (wrapper)", 0);
+  __Pyx_RefNannySetupContext("nextenv (wrapper)", 0);
   {
-    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_capsule,&__pyx_n_s_size,0};
-    PyObject* values[2] = {0,0};
-    if (unlikely(__pyx_kwds)) {
+    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_key,0};
+    PyObject* values[1] = {0};
+    if (__pyx_kwds) {
       Py_ssize_t kw_args;
-      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
-      switch (pos_args) {
-        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
-        CYTHON_FALLTHROUGH;
-        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
+      switch (__pyx_nargs) {
+        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
         CYTHON_FALLTHROUGH;
         case  0: break;
         default: goto __pyx_L5_argtuple_error;
       }
-      kw_args = PyDict_Size(__pyx_kwds);
-      switch (pos_args) {
+      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
+      switch (__pyx_nargs) {
         case  0:
-        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_capsule)) != 0)) kw_args--;
+        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_key)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 69, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
-        CYTHON_FALLTHROUGH;
-        case  1:
-        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_size)) != 0)) kw_args--;
-        else {
-          __Pyx_RaiseArgtupleInvalid("tobytes", 1, 2, 2, 1); __PYX_ERR(0, 87, __pyx_L3_error)
-        }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "tobytes") < 0)) __PYX_ERR(0, 87, __pyx_L3_error)
+        const Py_ssize_t kwd_pos_args = __pyx_nargs;
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "nextenv") < 0)) __PYX_ERR(0, 69, __pyx_L3_error)
       }
-    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
+    } else if (unlikely(__pyx_nargs != 1)) {
       goto __pyx_L5_argtuple_error;
     } else {
-      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
-      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
+      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
     }
-    __pyx_v_capsule = values[0];
-    __pyx_v_size = __Pyx_PyInt_As_size_t(values[1]); if (unlikely((__pyx_v_size == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 87, __pyx_L3_error)
+    __pyx_v_key = values[0];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("tobytes", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 87, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("nextenv", 1, 1, 1, __pyx_nargs); __PYX_ERR(0, 69, __pyx_L3_error)
   __pyx_L3_error:;
-  __Pyx_AddTraceback("pyskynet.skynet_py_mq.tobytes", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("pyskynet.skynet_py_main.nextenv", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_8pyskynet_12skynet_py_mq_6tobytes(__pyx_self, __pyx_v_capsule, __pyx_v_size);
+  __pyx_r = __pyx_pf_8pyskynet_14skynet_py_main_6nextenv(__pyx_self, __pyx_v_key);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8pyskynet_12skynet_py_mq_6tobytes(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_capsule, size_t __pyx_v_size) {
-  char *__pyx_v_name;
-  char *__pyx_v_ptr;
-  PyObject *__pyx_v_s = 0;
+static PyObject *__pyx_pf_8pyskynet_14skynet_py_main_6nextenv(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_key) {
+  char const *__pyx_v_ptr;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
-  char *__pyx_t_1;
-  void *__pyx_t_2;
-  int __pyx_t_3;
-  int __pyx_t_4;
-  PyObject *__pyx_t_5 = NULL;
+  int __pyx_t_1;
+  PyObject *__pyx_t_2 = NULL;
+  char const *__pyx_t_3;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
-  __Pyx_RefNannySetupContext("tobytes", 0);
+  __Pyx_RefNannySetupContext("nextenv", 0);
+  __Pyx_INCREF(__pyx_v_key);
 
-  /* "src/cy_src/skynet_py_mq.pyx":88
- * # extern
- * def tobytes(capsule, size_t size):
- *     cdef char *name = PyCapsule_GetName(capsule)             # <<<<<<<<<<<<<<
- *     cdef char *ptr = <char *>PyCapsule_GetPointer(capsule, name)
- *     cdef bytes s
- */
-  __pyx_t_1 = PyCapsule_GetName(__pyx_v_capsule); if (unlikely(__pyx_t_1 == ((char *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 88, __pyx_L1_error)
-  __pyx_v_name = __pyx_t_1;
-
-  /* "src/cy_src/skynet_py_mq.pyx":89
- * def tobytes(capsule, size_t size):
- *     cdef char *name = PyCapsule_GetName(capsule)
- *     cdef char *ptr = <char *>PyCapsule_GetPointer(capsule, name)             # <<<<<<<<<<<<<<
- *     cdef bytes s
- *     if strcmp(name, "cptr") == 0 or strcmp(name, "pyptr") == 0:
- */
-  __pyx_t_2 = PyCapsule_GetPointer(__pyx_v_capsule, __pyx_v_name); if (unlikely(__pyx_t_2 == ((void *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 89, __pyx_L1_error)
-  __pyx_v_ptr = ((char *)__pyx_t_2);
-
-  /* "src/cy_src/skynet_py_mq.pyx":91
- *     cdef char *ptr = <char *>PyCapsule_GetPointer(capsule, name)
- *     cdef bytes s
- *     if strcmp(name, "cptr") == 0 or strcmp(name, "pyptr") == 0:             # <<<<<<<<<<<<<<
- *         s = ptr[:size]
- *         return s
+  /* "src/cy_src/skynet_py_main.pyx":71
+ * def nextenv(key):
+ *     cdef const char * ptr
+ *     if key is None:             # <<<<<<<<<<<<<<
+ *         ptr = skynet_py_nextenv(NULL)
+ *     else:
  */
-  __pyx_t_4 = ((strcmp(__pyx_v_name, ((char const *)"cptr")) == 0) != 0);
-  if (!__pyx_t_4) {
-  } else {
-    __pyx_t_3 = __pyx_t_4;
-    goto __pyx_L4_bool_binop_done;
+  __pyx_t_1 = (__pyx_v_key == Py_None);
+  if (__pyx_t_1) {
+
+    /* "src/cy_src/skynet_py_main.pyx":72
+ *     cdef const char * ptr
+ *     if key is None:
+ *         ptr = skynet_py_nextenv(NULL)             # <<<<<<<<<<<<<<
+ *     else:
+ *         key = __check_bytes(key)
+ */
+    __pyx_v_ptr = skynet_py_nextenv(NULL);
+
+    /* "src/cy_src/skynet_py_main.pyx":71
+ * def nextenv(key):
+ *     cdef const char * ptr
+ *     if key is None:             # <<<<<<<<<<<<<<
+ *         ptr = skynet_py_nextenv(NULL)
+ *     else:
+ */
+    goto __pyx_L3;
   }
-  __pyx_t_4 = ((strcmp(__pyx_v_name, ((char const *)"pyptr")) == 0) != 0);
-  __pyx_t_3 = __pyx_t_4;
-  __pyx_L4_bool_binop_done:;
-  if (likely(__pyx_t_3)) {
 
-    /* "src/cy_src/skynet_py_mq.pyx":92
- *     cdef bytes s
- *     if strcmp(name, "cptr") == 0 or strcmp(name, "pyptr") == 0:
- *         s = ptr[:size]             # <<<<<<<<<<<<<<
- *         return s
+  /* "src/cy_src/skynet_py_main.pyx":74
+ *         ptr = skynet_py_nextenv(NULL)
  *     else:
+ *         key = __check_bytes(key)             # <<<<<<<<<<<<<<
+ *         ptr = skynet_py_nextenv(key)
+ *     if ptr == NULL:
  */
-    __pyx_t_5 = __Pyx_PyBytes_FromStringAndSize(__pyx_v_ptr + 0, __pyx_v_size - 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 92, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_5);
-    __pyx_v_s = ((PyObject*)__pyx_t_5);
-    __pyx_t_5 = 0;
+  /*else*/ {
+    __pyx_t_2 = __pyx_f_8pyskynet_14skynet_py_main___check_bytes(__pyx_v_key); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 74, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_2);
+    __Pyx_DECREF_SET(__pyx_v_key, __pyx_t_2);
+    __pyx_t_2 = 0;
 
-    /* "src/cy_src/skynet_py_mq.pyx":93
- *     if strcmp(name, "cptr") == 0 or strcmp(name, "pyptr") == 0:
- *         s = ptr[:size]
- *         return s             # <<<<<<<<<<<<<<
+    /* "src/cy_src/skynet_py_main.pyx":75
  *     else:
- *         raise Exception("capsule unpack failed for name = %s")
+ *         key = __check_bytes(key)
+ *         ptr = skynet_py_nextenv(key)             # <<<<<<<<<<<<<<
+ *     if ptr == NULL:
+ *         return None
+ */
+    __pyx_t_3 = __Pyx_PyObject_AsString(__pyx_v_key); if (unlikely((!__pyx_t_3) && PyErr_Occurred())) __PYX_ERR(0, 75, __pyx_L1_error)
+    __pyx_v_ptr = skynet_py_nextenv(__pyx_t_3);
+  }
+  __pyx_L3:;
+
+  /* "src/cy_src/skynet_py_main.pyx":76
+ *         key = __check_bytes(key)
+ *         ptr = skynet_py_nextenv(key)
+ *     if ptr == NULL:             # <<<<<<<<<<<<<<
+ *         return None
+ *     else:
+ */
+  __pyx_t_1 = (__pyx_v_ptr == NULL);
+  if (__pyx_t_1) {
+
+    /* "src/cy_src/skynet_py_main.pyx":77
+ *         ptr = skynet_py_nextenv(key)
+ *     if ptr == NULL:
+ *         return None             # <<<<<<<<<<<<<<
+ *     else:
+ *         return PyBytes_FromString(ptr)
  */
     __Pyx_XDECREF(__pyx_r);
-    __Pyx_INCREF(__pyx_v_s);
-    __pyx_r = __pyx_v_s;
+    __pyx_r = Py_None; __Pyx_INCREF(Py_None);
     goto __pyx_L0;
 
-    /* "src/cy_src/skynet_py_mq.pyx":91
- *     cdef char *ptr = <char *>PyCapsule_GetPointer(capsule, name)
- *     cdef bytes s
- *     if strcmp(name, "cptr") == 0 or strcmp(name, "pyptr") == 0:             # <<<<<<<<<<<<<<
- *         s = ptr[:size]
- *         return s
+    /* "src/cy_src/skynet_py_main.pyx":76
+ *         key = __check_bytes(key)
+ *         ptr = skynet_py_nextenv(key)
+ *     if ptr == NULL:             # <<<<<<<<<<<<<<
+ *         return None
+ *     else:
  */
   }
 
-  /* "src/cy_src/skynet_py_mq.pyx":95
- *         return s
+  /* "src/cy_src/skynet_py_main.pyx":79
+ *         return None
  *     else:
- *         raise Exception("capsule unpack failed for name = %s")             # <<<<<<<<<<<<<<
+ *         return PyBytes_FromString(ptr)             # <<<<<<<<<<<<<<
  * 
- * class PTYPEEnum(object):
+ * def refscript(script):
  */
   /*else*/ {
-    __pyx_t_5 = __Pyx_PyObject_Call(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])), __pyx_tuple__3, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 95, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_5);
-    __Pyx_Raise(__pyx_t_5, 0, 0, 0);
-    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    __PYX_ERR(0, 95, __pyx_L1_error)
+    __Pyx_XDECREF(__pyx_r);
+    __pyx_t_2 = PyBytes_FromString(__pyx_v_ptr); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 79, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_2);
+    __pyx_r = __pyx_t_2;
+    __pyx_t_2 = 0;
+    goto __pyx_L0;
   }
 
-  /* "src/cy_src/skynet_py_mq.pyx":87
+  /* "src/cy_src/skynet_py_main.pyx":69
+ *         raise Exception("getlenv but value not existed")
  * 
- * # extern
- * def tobytes(capsule, size_t size):             # <<<<<<<<<<<<<<
- *     cdef char *name = PyCapsule_GetName(capsule)
- *     cdef char *ptr = <char *>PyCapsule_GetPointer(capsule, name)
+ * def nextenv(key):             # <<<<<<<<<<<<<<
+ *     cdef const char * ptr
+ *     if key is None:
  */
 
   /* function exit code */
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_5);
-  __Pyx_AddTraceback("pyskynet.skynet_py_mq.tobytes", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_AddTraceback("pyskynet.skynet_py_main.nextenv", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
-  __Pyx_XDECREF(__pyx_v_s);
+  __Pyx_XDECREF(__pyx_v_key);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "src/cy_src/skynet_py_mq.pyx":98
+/* "src/cy_src/skynet_py_main.pyx":81
+ *         return PyBytes_FromString(ptr)
  * 
- * class PTYPEEnum(object):
- *     def __init__(self):             # <<<<<<<<<<<<<<
- *         self.PTYPE_TEXT=PTYPE_TEXT
- *         self.PTYPE_RESPONSE=PTYPE_RESPONSE
+ * def refscript(script):             # <<<<<<<<<<<<<<
+ *     script = __check_bytes(script)
+ *     index = skynet_py_refscript(script, len(script))
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_8pyskynet_12skynet_py_mq_9PTYPEEnum_1__init__(PyObject *__pyx_self, PyObject *__pyx_v_self); /*proto*/
-static PyMethodDef __pyx_mdef_8pyskynet_12skynet_py_mq_9PTYPEEnum_1__init__ = {"__init__", (PyCFunction)__pyx_pw_8pyskynet_12skynet_py_mq_9PTYPEEnum_1__init__, METH_O, 0};
-static PyObject *__pyx_pw_8pyskynet_12skynet_py_mq_9PTYPEEnum_1__init__(PyObject *__pyx_self, PyObject *__pyx_v_self) {
+static PyObject *__pyx_pw_8pyskynet_14skynet_py_main_9refscript(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+); /*proto*/
+static PyMethodDef __pyx_mdef_8pyskynet_14skynet_py_main_9refscript = {"refscript", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_8pyskynet_14skynet_py_main_9refscript, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_8pyskynet_14skynet_py_main_9refscript(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+) {
+  PyObject *__pyx_v_script = 0;
+  #if !CYTHON_METH_FASTCALL
+  CYTHON_UNUSED const Py_ssize_t __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
+  #endif
+  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
-  __Pyx_RefNannySetupContext("__init__ (wrapper)", 0);
-  __pyx_r = __pyx_pf_8pyskynet_12skynet_py_mq_9PTYPEEnum___init__(__pyx_self, ((PyObject *)__pyx_v_self));
+  __Pyx_RefNannySetupContext("refscript (wrapper)", 0);
+  {
+    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_script,0};
+    PyObject* values[1] = {0};
+    if (__pyx_kwds) {
+      Py_ssize_t kw_args;
+      switch (__pyx_nargs) {
+        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+        CYTHON_FALLTHROUGH;
+        case  0: break;
+        default: goto __pyx_L5_argtuple_error;
+      }
+      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
+      switch (__pyx_nargs) {
+        case  0:
+        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_script)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 81, __pyx_L3_error)
+        else goto __pyx_L5_argtuple_error;
+      }
+      if (unlikely(kw_args > 0)) {
+        const Py_ssize_t kwd_pos_args = __pyx_nargs;
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "refscript") < 0)) __PYX_ERR(0, 81, __pyx_L3_error)
+      }
+    } else if (unlikely(__pyx_nargs != 1)) {
+      goto __pyx_L5_argtuple_error;
+    } else {
+      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+    }
+    __pyx_v_script = values[0];
+  }
+  goto __pyx_L4_argument_unpacking_done;
+  __pyx_L5_argtuple_error:;
+  __Pyx_RaiseArgtupleInvalid("refscript", 1, 1, 1, __pyx_nargs); __PYX_ERR(0, 81, __pyx_L3_error)
+  __pyx_L3_error:;
+  __Pyx_AddTraceback("pyskynet.skynet_py_main.refscript", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_RefNannyFinishContext();
+  return NULL;
+  __pyx_L4_argument_unpacking_done:;
+  __pyx_r = __pyx_pf_8pyskynet_14skynet_py_main_8refscript(__pyx_self, __pyx_v_script);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8pyskynet_12skynet_py_mq_9PTYPEEnum___init__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self) {
+static PyObject *__pyx_pf_8pyskynet_14skynet_py_main_8refscript(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_script) {
+  int __pyx_v_index;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
+  char const *__pyx_t_2;
+  Py_ssize_t __pyx_t_3;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
-  __Pyx_RefNannySetupContext("__init__", 0);
-
-  /* "src/cy_src/skynet_py_mq.pyx":99
- * class PTYPEEnum(object):
- *     def __init__(self):
- *         self.PTYPE_TEXT=PTYPE_TEXT             # <<<<<<<<<<<<<<
- *         self.PTYPE_RESPONSE=PTYPE_RESPONSE
- *         self.PTYPE_MULTICAST=PTYPE_MULTICAST
- */
-  __pyx_t_1 = __Pyx_PyInt_From_int(PTYPE_TEXT); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 99, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_PTYPE_TEXT, __pyx_t_1) < 0) __PYX_ERR(0, 99, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-
-  /* "src/cy_src/skynet_py_mq.pyx":100
- *     def __init__(self):
- *         self.PTYPE_TEXT=PTYPE_TEXT
- *         self.PTYPE_RESPONSE=PTYPE_RESPONSE             # <<<<<<<<<<<<<<
- *         self.PTYPE_MULTICAST=PTYPE_MULTICAST
- *         self.PTYPE_CLIENT=PTYPE_CLIENT
- */
-  __pyx_t_1 = __Pyx_PyInt_From_int(PTYPE_RESPONSE); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 100, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_PTYPE_RESPONSE, __pyx_t_1) < 0) __PYX_ERR(0, 100, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-
-  /* "src/cy_src/skynet_py_mq.pyx":101
- *         self.PTYPE_TEXT=PTYPE_TEXT
- *         self.PTYPE_RESPONSE=PTYPE_RESPONSE
- *         self.PTYPE_MULTICAST=PTYPE_MULTICAST             # <<<<<<<<<<<<<<
- *         self.PTYPE_CLIENT=PTYPE_CLIENT
- *         self.PTYPE_SYSTEM=PTYPE_SYSTEM
- */
-  __pyx_t_1 = __Pyx_PyInt_From_int(PTYPE_MULTICAST); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 101, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_PTYPE_MULTICAST, __pyx_t_1) < 0) __PYX_ERR(0, 101, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __Pyx_RefNannySetupContext("refscript", 0);
+  __Pyx_INCREF(__pyx_v_script);
 
-  /* "src/cy_src/skynet_py_mq.pyx":102
- *         self.PTYPE_RESPONSE=PTYPE_RESPONSE
- *         self.PTYPE_MULTICAST=PTYPE_MULTICAST
- *         self.PTYPE_CLIENT=PTYPE_CLIENT             # <<<<<<<<<<<<<<
- *         self.PTYPE_SYSTEM=PTYPE_SYSTEM
- *         self.PTYPE_HARBOR=PTYPE_HARBOR
+  /* "src/cy_src/skynet_py_main.pyx":82
+ * 
+ * def refscript(script):
+ *     script = __check_bytes(script)             # <<<<<<<<<<<<<<
+ *     index = skynet_py_refscript(script, len(script))
+ *     return index
  */
-  __pyx_t_1 = __Pyx_PyInt_From_int(PTYPE_CLIENT); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 102, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_8pyskynet_14skynet_py_main___check_bytes(__pyx_v_script); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 82, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_PTYPE_CLIENT, __pyx_t_1) < 0) __PYX_ERR(0, 102, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __Pyx_DECREF_SET(__pyx_v_script, __pyx_t_1);
+  __pyx_t_1 = 0;
 
-  /* "src/cy_src/skynet_py_mq.pyx":103
- *         self.PTYPE_MULTICAST=PTYPE_MULTICAST
- *         self.PTYPE_CLIENT=PTYPE_CLIENT
- *         self.PTYPE_SYSTEM=PTYPE_SYSTEM             # <<<<<<<<<<<<<<
- *         self.PTYPE_HARBOR=PTYPE_HARBOR
- *         self.PTYPE_SOCKET=PTYPE_SOCKET
+  /* "src/cy_src/skynet_py_main.pyx":83
+ * def refscript(script):
+ *     script = __check_bytes(script)
+ *     index = skynet_py_refscript(script, len(script))             # <<<<<<<<<<<<<<
+ *     return index
+ * 
+ */
+  __pyx_t_2 = __Pyx_PyObject_AsString(__pyx_v_script); if (unlikely((!__pyx_t_2) && PyErr_Occurred())) __PYX_ERR(0, 83, __pyx_L1_error)
+  __pyx_t_3 = PyObject_Length(__pyx_v_script); if (unlikely(__pyx_t_3 == ((Py_ssize_t)-1))) __PYX_ERR(0, 83, __pyx_L1_error)
+  __pyx_v_index = skynet_py_refscript(__pyx_t_2, __pyx_t_3);
+
+  /* "src/cy_src/skynet_py_main.pyx":84
+ *     script = __check_bytes(script)
+ *     index = skynet_py_refscript(script, len(script))
+ *     return index             # <<<<<<<<<<<<<<
+ * 
+ * def getscript(index):
  */
-  __pyx_t_1 = __Pyx_PyInt_From_int(PTYPE_SYSTEM); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 103, __pyx_L1_error)
+  __Pyx_XDECREF(__pyx_r);
+  __pyx_t_1 = __Pyx_PyInt_From_int(__pyx_v_index); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 84, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_PTYPE_SYSTEM, __pyx_t_1) < 0) __PYX_ERR(0, 103, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_r = __pyx_t_1;
+  __pyx_t_1 = 0;
+  goto __pyx_L0;
 
-  /* "src/cy_src/skynet_py_mq.pyx":104
- *         self.PTYPE_CLIENT=PTYPE_CLIENT
- *         self.PTYPE_SYSTEM=PTYPE_SYSTEM
- *         self.PTYPE_HARBOR=PTYPE_HARBOR             # <<<<<<<<<<<<<<
- *         self.PTYPE_SOCKET=PTYPE_SOCKET
- *         self.PTYPE_ERROR=PTYPE_ERROR
+  /* "src/cy_src/skynet_py_main.pyx":81
+ *         return PyBytes_FromString(ptr)
+ * 
+ * def refscript(script):             # <<<<<<<<<<<<<<
+ *     script = __check_bytes(script)
+ *     index = skynet_py_refscript(script, len(script))
  */
-  __pyx_t_1 = __Pyx_PyInt_From_int(PTYPE_HARBOR); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 104, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_PTYPE_HARBOR, __pyx_t_1) < 0) __PYX_ERR(0, 104, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "src/cy_src/skynet_py_mq.pyx":105
- *         self.PTYPE_SYSTEM=PTYPE_SYSTEM
- *         self.PTYPE_HARBOR=PTYPE_HARBOR
- *         self.PTYPE_SOCKET=PTYPE_SOCKET             # <<<<<<<<<<<<<<
- *         self.PTYPE_ERROR=PTYPE_ERROR
- *         self.PTYPE_QUEUE=PTYPE_RESERVED_QUEUE
- */
-  __pyx_t_1 = __Pyx_PyInt_From_int(PTYPE_SOCKET); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 105, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_PTYPE_SOCKET, __pyx_t_1) < 0) __PYX_ERR(0, 105, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-
-  /* "src/cy_src/skynet_py_mq.pyx":106
- *         self.PTYPE_HARBOR=PTYPE_HARBOR
- *         self.PTYPE_SOCKET=PTYPE_SOCKET
- *         self.PTYPE_ERROR=PTYPE_ERROR             # <<<<<<<<<<<<<<
- *         self.PTYPE_QUEUE=PTYPE_RESERVED_QUEUE
- *         self.PTYPE_DEBUG=PTYPE_RESERVED_DEBUG
- */
-  __pyx_t_1 = __Pyx_PyInt_From_int(PTYPE_ERROR); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 106, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_PTYPE_ERROR, __pyx_t_1) < 0) __PYX_ERR(0, 106, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_AddTraceback("pyskynet.skynet_py_main.refscript", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = NULL;
+  __pyx_L0:;
+  __Pyx_XDECREF(__pyx_v_script);
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
 
-  /* "src/cy_src/skynet_py_mq.pyx":107
- *         self.PTYPE_SOCKET=PTYPE_SOCKET
- *         self.PTYPE_ERROR=PTYPE_ERROR
- *         self.PTYPE_QUEUE=PTYPE_RESERVED_QUEUE             # <<<<<<<<<<<<<<
- *         self.PTYPE_DEBUG=PTYPE_RESERVED_DEBUG
- *         self.PTYPE_LUA=PTYPE_RESERVED_LUA
+/* "src/cy_src/skynet_py_main.pyx":86
+ *     return index
+ * 
+ * def getscript(index):             # <<<<<<<<<<<<<<
+ *     cdef size_t sz
+ *     cdef const char * value = skynet_py_getscript(index, &sz)
  */
-  __pyx_t_1 = __Pyx_PyInt_From_int(PTYPE_RESERVED_QUEUE); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 107, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_PTYPE_QUEUE, __pyx_t_1) < 0) __PYX_ERR(0, 107, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "src/cy_src/skynet_py_mq.pyx":108
- *         self.PTYPE_ERROR=PTYPE_ERROR
- *         self.PTYPE_QUEUE=PTYPE_RESERVED_QUEUE
- *         self.PTYPE_DEBUG=PTYPE_RESERVED_DEBUG             # <<<<<<<<<<<<<<
- *         self.PTYPE_LUA=PTYPE_RESERVED_LUA
- *         self.PTYPE_SNAX=PTYPE_RESERVED_SNAX
- */
-  __pyx_t_1 = __Pyx_PyInt_From_int(PTYPE_RESERVED_DEBUG); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 108, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_PTYPE_DEBUG, __pyx_t_1) < 0) __PYX_ERR(0, 108, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+/* Python wrapper */
+static PyObject *__pyx_pw_8pyskynet_14skynet_py_main_11getscript(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+); /*proto*/
+static PyMethodDef __pyx_mdef_8pyskynet_14skynet_py_main_11getscript = {"getscript", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_8pyskynet_14skynet_py_main_11getscript, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_8pyskynet_14skynet_py_main_11getscript(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+) {
+  PyObject *__pyx_v_index = 0;
+  #if !CYTHON_METH_FASTCALL
+  CYTHON_UNUSED const Py_ssize_t __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
+  #endif
+  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  PyObject *__pyx_r = 0;
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("getscript (wrapper)", 0);
+  {
+    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_index,0};
+    PyObject* values[1] = {0};
+    if (__pyx_kwds) {
+      Py_ssize_t kw_args;
+      switch (__pyx_nargs) {
+        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+        CYTHON_FALLTHROUGH;
+        case  0: break;
+        default: goto __pyx_L5_argtuple_error;
+      }
+      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
+      switch (__pyx_nargs) {
+        case  0:
+        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_index)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 86, __pyx_L3_error)
+        else goto __pyx_L5_argtuple_error;
+      }
+      if (unlikely(kw_args > 0)) {
+        const Py_ssize_t kwd_pos_args = __pyx_nargs;
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "getscript") < 0)) __PYX_ERR(0, 86, __pyx_L3_error)
+      }
+    } else if (unlikely(__pyx_nargs != 1)) {
+      goto __pyx_L5_argtuple_error;
+    } else {
+      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+    }
+    __pyx_v_index = values[0];
+  }
+  goto __pyx_L4_argument_unpacking_done;
+  __pyx_L5_argtuple_error:;
+  __Pyx_RaiseArgtupleInvalid("getscript", 1, 1, 1, __pyx_nargs); __PYX_ERR(0, 86, __pyx_L3_error)
+  __pyx_L3_error:;
+  __Pyx_AddTraceback("pyskynet.skynet_py_main.getscript", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_RefNannyFinishContext();
+  return NULL;
+  __pyx_L4_argument_unpacking_done:;
+  __pyx_r = __pyx_pf_8pyskynet_14skynet_py_main_10getscript(__pyx_self, __pyx_v_index);
 
-  /* "src/cy_src/skynet_py_mq.pyx":109
- *         self.PTYPE_QUEUE=PTYPE_RESERVED_QUEUE
- *         self.PTYPE_DEBUG=PTYPE_RESERVED_DEBUG
- *         self.PTYPE_LUA=PTYPE_RESERVED_LUA             # <<<<<<<<<<<<<<
- *         self.PTYPE_SNAX=PTYPE_RESERVED_SNAX
- *         self.PTYPE_TRACE=12 # TRACE defined in skynet.lua
- */
-  __pyx_t_1 = __Pyx_PyInt_From_int(PTYPE_RESERVED_LUA); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 109, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_PTYPE_LUA, __pyx_t_1) < 0) __PYX_ERR(0, 109, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  /* function exit code */
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
 
-  /* "src/cy_src/skynet_py_mq.pyx":110
- *         self.PTYPE_DEBUG=PTYPE_RESERVED_DEBUG
- *         self.PTYPE_LUA=PTYPE_RESERVED_LUA
- *         self.PTYPE_SNAX=PTYPE_RESERVED_SNAX             # <<<<<<<<<<<<<<
- *         self.PTYPE_TRACE=12 # TRACE defined in skynet.lua
- *         self.PTYPE_FOREIGN=PTYPE_FOREIGN
- */
-  __pyx_t_1 = __Pyx_PyInt_From_int(PTYPE_RESERVED_SNAX); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 110, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_PTYPE_SNAX, __pyx_t_1) < 0) __PYX_ERR(0, 110, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+static PyObject *__pyx_pf_8pyskynet_14skynet_py_main_10getscript(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_index) {
+  size_t __pyx_v_sz;
+  char const *__pyx_v_value;
+  PyObject *__pyx_r = NULL;
+  __Pyx_RefNannyDeclarations
+  int __pyx_t_1;
+  int __pyx_t_2;
+  PyObject *__pyx_t_3 = NULL;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("getscript", 0);
 
-  /* "src/cy_src/skynet_py_mq.pyx":111
- *         self.PTYPE_LUA=PTYPE_RESERVED_LUA
- *         self.PTYPE_SNAX=PTYPE_RESERVED_SNAX
- *         self.PTYPE_TRACE=12 # TRACE defined in skynet.lua             # <<<<<<<<<<<<<<
- *         self.PTYPE_FOREIGN=PTYPE_FOREIGN
- *         self.PTYPE_FOREIGN_REMOTE=PTYPE_FOREIGN_REMOTE
- */
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_PTYPE_TRACE, __pyx_int_12) < 0) __PYX_ERR(0, 111, __pyx_L1_error)
-
-  /* "src/cy_src/skynet_py_mq.pyx":112
- *         self.PTYPE_SNAX=PTYPE_RESERVED_SNAX
- *         self.PTYPE_TRACE=12 # TRACE defined in skynet.lua
- *         self.PTYPE_FOREIGN=PTYPE_FOREIGN             # <<<<<<<<<<<<<<
- *         self.PTYPE_FOREIGN_REMOTE=PTYPE_FOREIGN_REMOTE
- *         self.PTYPE_TAG_ALLOCSESSION=PTYPE_TAG_ALLOCSESSION
+  /* "src/cy_src/skynet_py_main.pyx":88
+ * def getscript(index):
+ *     cdef size_t sz
+ *     cdef const char * value = skynet_py_getscript(index, &sz)             # <<<<<<<<<<<<<<
+ *     if value != NULL:
+ *         return PyBytes_FromStringAndSize(value, sz);
+ */
+  __pyx_t_1 = __Pyx_PyInt_As_int(__pyx_v_index); if (unlikely((__pyx_t_1 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 88, __pyx_L1_error)
+  __pyx_v_value = skynet_py_getscript(__pyx_t_1, (&__pyx_v_sz));
+
+  /* "src/cy_src/skynet_py_main.pyx":89
+ *     cdef size_t sz
+ *     cdef const char * value = skynet_py_getscript(index, &sz)
+ *     if value != NULL:             # <<<<<<<<<<<<<<
+ *         return PyBytes_FromStringAndSize(value, sz);
+ *     else:
  */
-  __pyx_t_1 = __Pyx_PyInt_From_int(PTYPE_FOREIGN); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 112, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_PTYPE_FOREIGN, __pyx_t_1) < 0) __PYX_ERR(0, 112, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_2 = (__pyx_v_value != NULL);
+  if (__pyx_t_2) {
 
-  /* "src/cy_src/skynet_py_mq.pyx":113
- *         self.PTYPE_TRACE=12 # TRACE defined in skynet.lua
- *         self.PTYPE_FOREIGN=PTYPE_FOREIGN
- *         self.PTYPE_FOREIGN_REMOTE=PTYPE_FOREIGN_REMOTE             # <<<<<<<<<<<<<<
- *         self.PTYPE_TAG_ALLOCSESSION=PTYPE_TAG_ALLOCSESSION
- *         self.PTYPE_TAG_DONTCOPY=PTYPE_TAG_DONTCOPY
+    /* "src/cy_src/skynet_py_main.pyx":90
+ *     cdef const char * value = skynet_py_getscript(index, &sz)
+ *     if value != NULL:
+ *         return PyBytes_FromStringAndSize(value, sz);             # <<<<<<<<<<<<<<
+ *     else:
+ *         return None
  */
-  __pyx_t_1 = __Pyx_PyInt_From_int(PTYPE_FOREIGN_REMOTE); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 113, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_PTYPE_FOREIGN_REMOTE, __pyx_t_1) < 0) __PYX_ERR(0, 113, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+    __Pyx_XDECREF(__pyx_r);
+    __pyx_t_3 = PyBytes_FromStringAndSize(__pyx_v_value, __pyx_v_sz); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 90, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_3);
+    __pyx_r = __pyx_t_3;
+    __pyx_t_3 = 0;
+    goto __pyx_L0;
 
-  /* "src/cy_src/skynet_py_mq.pyx":114
- *         self.PTYPE_FOREIGN=PTYPE_FOREIGN
- *         self.PTYPE_FOREIGN_REMOTE=PTYPE_FOREIGN_REMOTE
- *         self.PTYPE_TAG_ALLOCSESSION=PTYPE_TAG_ALLOCSESSION             # <<<<<<<<<<<<<<
- *         self.PTYPE_TAG_DONTCOPY=PTYPE_TAG_DONTCOPY
- * 
+    /* "src/cy_src/skynet_py_main.pyx":89
+ *     cdef size_t sz
+ *     cdef const char * value = skynet_py_getscript(index, &sz)
+ *     if value != NULL:             # <<<<<<<<<<<<<<
+ *         return PyBytes_FromStringAndSize(value, sz);
+ *     else:
  */
-  __pyx_t_1 = __Pyx_PyInt_From_int(PTYPE_TAG_ALLOCSESSION); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 114, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_PTYPE_TAG_ALLOCSESSION, __pyx_t_1) < 0) __PYX_ERR(0, 114, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  }
 
-  /* "src/cy_src/skynet_py_mq.pyx":115
- *         self.PTYPE_FOREIGN_REMOTE=PTYPE_FOREIGN_REMOTE
- *         self.PTYPE_TAG_ALLOCSESSION=PTYPE_TAG_ALLOCSESSION
- *         self.PTYPE_TAG_DONTCOPY=PTYPE_TAG_DONTCOPY             # <<<<<<<<<<<<<<
- * 
+  /* "src/cy_src/skynet_py_main.pyx":92
+ *         return PyBytes_FromStringAndSize(value, sz);
+ *     else:
+ *         return None             # <<<<<<<<<<<<<<
  * 
+ * def start(int thread, int profile):
  */
-  __pyx_t_1 = __Pyx_PyInt_From_int(PTYPE_TAG_DONTCOPY); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 115, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_PTYPE_TAG_DONTCOPY, __pyx_t_1) < 0) __PYX_ERR(0, 115, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  /*else*/ {
+    __Pyx_XDECREF(__pyx_r);
+    __pyx_r = Py_None; __Pyx_INCREF(Py_None);
+    goto __pyx_L0;
+  }
 
-  /* "src/cy_src/skynet_py_mq.pyx":98
+  /* "src/cy_src/skynet_py_main.pyx":86
+ *     return index
  * 
- * class PTYPEEnum(object):
- *     def __init__(self):             # <<<<<<<<<<<<<<
- *         self.PTYPE_TEXT=PTYPE_TEXT
- *         self.PTYPE_RESPONSE=PTYPE_RESPONSE
+ * def getscript(index):             # <<<<<<<<<<<<<<
+ *     cdef size_t sz
+ *     cdef const char * value = skynet_py_getscript(index, &sz)
  */
 
   /* function exit code */
-  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
-  goto __pyx_L0;
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_AddTraceback("pyskynet.skynet_py_mq.PTYPEEnum.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_XDECREF(__pyx_t_3);
+  __Pyx_AddTraceback("pyskynet.skynet_py_main.getscript", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "src/cy_src/skynet_py_mq.pyx":130
+/* "src/cy_src/skynet_py_main.pyx":94
+ *         return None
  * 
- * SKYNET_PTYPE_user_builtin_ids = [SKYNET_PTYPE.PTYPE_LUA, SKYNET_PTYPE.PTYPE_CLIENT, SKYNET_PTYPE.PTYPE_SOCKET, SKYNET_PTYPE.PTYPE_TEXT, SKYNET_PTYPE.PTYPE_FOREIGN, SKYNET_PTYPE.PTYPE_FOREIGN_REMOTE]
- * def user_assert_id_name(id, name):             # <<<<<<<<<<<<<<
- *     is_builtin = False
- *     if name in SKYNET_PTYPE_name_to_id:
+ * def start(int thread, int profile):             # <<<<<<<<<<<<<<
+ *     cdef skynet_config config;
+ *     config.thread = thread
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_8pyskynet_12skynet_py_mq_9user_assert_id_name(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_mdef_8pyskynet_12skynet_py_mq_9user_assert_id_name = {"user_assert_id_name", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_8pyskynet_12skynet_py_mq_9user_assert_id_name, METH_VARARGS|METH_KEYWORDS, 0};
-static PyObject *__pyx_pw_8pyskynet_12skynet_py_mq_9user_assert_id_name(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
-  PyObject *__pyx_v_id = 0;
-  PyObject *__pyx_v_name = 0;
+static PyObject *__pyx_pw_8pyskynet_14skynet_py_main_13start(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+); /*proto*/
+static PyMethodDef __pyx_mdef_8pyskynet_14skynet_py_main_13start = {"start", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_8pyskynet_14skynet_py_main_13start, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_8pyskynet_14skynet_py_main_13start(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+) {
+  int __pyx_v_thread;
+  int __pyx_v_profile;
+  #if !CYTHON_METH_FASTCALL
+  CYTHON_UNUSED const Py_ssize_t __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
+  #endif
+  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
-  __Pyx_RefNannySetupContext("user_assert_id_name (wrapper)", 0);
+  __Pyx_RefNannySetupContext("start (wrapper)", 0);
   {
-    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_id,&__pyx_n_s_name,0};
+    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_thread,&__pyx_n_s_profile,0};
     PyObject* values[2] = {0,0};
-    if (unlikely(__pyx_kwds)) {
+    if (__pyx_kwds) {
       Py_ssize_t kw_args;
-      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
-      switch (pos_args) {
-        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
+      switch (__pyx_nargs) {
+        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
         CYTHON_FALLTHROUGH;
-        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
+        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
         CYTHON_FALLTHROUGH;
         case  0: break;
         default: goto __pyx_L5_argtuple_error;
       }
-      kw_args = PyDict_Size(__pyx_kwds);
-      switch (pos_args) {
+      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
+      switch (__pyx_nargs) {
         case  0:
-        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_id)) != 0)) kw_args--;
+        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_thread)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 94, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
-        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_name)) != 0)) kw_args--;
+        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_profile)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 94, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("user_assert_id_name", 1, 2, 2, 1); __PYX_ERR(0, 130, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("start", 1, 2, 2, 1); __PYX_ERR(0, 94, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "user_assert_id_name") < 0)) __PYX_ERR(0, 130, __pyx_L3_error)
+        const Py_ssize_t kwd_pos_args = __pyx_nargs;
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "start") < 0)) __PYX_ERR(0, 94, __pyx_L3_error)
       }
-    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
+    } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
-      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
-      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
+      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+      values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
     }
-    __pyx_v_id = values[0];
-    __pyx_v_name = values[1];
+    __pyx_v_thread = __Pyx_PyInt_As_int(values[0]); if (unlikely((__pyx_v_thread == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 94, __pyx_L3_error)
+    __pyx_v_profile = __Pyx_PyInt_As_int(values[1]); if (unlikely((__pyx_v_profile == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 94, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("user_assert_id_name", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 130, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("start", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 94, __pyx_L3_error)
   __pyx_L3_error:;
-  __Pyx_AddTraceback("pyskynet.skynet_py_mq.user_assert_id_name", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("pyskynet.skynet_py_main.start", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_8pyskynet_12skynet_py_mq_8user_assert_id_name(__pyx_self, __pyx_v_id, __pyx_v_name);
+  __pyx_r = __pyx_pf_8pyskynet_14skynet_py_main_12start(__pyx_self, __pyx_v_thread, __pyx_v_profile);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8pyskynet_12skynet_py_mq_8user_assert_id_name(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_id, PyObject *__pyx_v_name) {
-  int __pyx_v_is_builtin;
+static PyObject *__pyx_pf_8pyskynet_14skynet_py_main_12start(CYTHON_UNUSED PyObject *__pyx_self, int __pyx_v_thread, int __pyx_v_profile) {
+  struct skynet_config __pyx_v_config;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
-  PyObject *__pyx_t_1 = NULL;
-  int __pyx_t_2;
-  int __pyx_t_3;
-  PyObject *__pyx_t_4 = NULL;
-  Py_ssize_t __pyx_t_5;
-  Py_UCS4 __pyx_t_6;
-  int __pyx_lineno = 0;
-  const char *__pyx_filename = NULL;
-  int __pyx_clineno = 0;
-  __Pyx_RefNannySetupContext("user_assert_id_name", 0);
+  __Pyx_RefNannySetupContext("start", 0);
 
-  /* "src/cy_src/skynet_py_mq.pyx":131
- * SKYNET_PTYPE_user_builtin_ids = [SKYNET_PTYPE.PTYPE_LUA, SKYNET_PTYPE.PTYPE_CLIENT, SKYNET_PTYPE.PTYPE_SOCKET, SKYNET_PTYPE.PTYPE_TEXT, SKYNET_PTYPE.PTYPE_FOREIGN, SKYNET_PTYPE.PTYPE_FOREIGN_REMOTE]
- * def user_assert_id_name(id, name):
- *     is_builtin = False             # <<<<<<<<<<<<<<
- *     if name in SKYNET_PTYPE_name_to_id:
- *         assert id == SKYNET_PTYPE_name_to_id[name], "skynet proto type name=%s must bind id=%s" % (name, id)
- */
-  __pyx_v_is_builtin = 0;
-
-  /* "src/cy_src/skynet_py_mq.pyx":132
- * def user_assert_id_name(id, name):
- *     is_builtin = False
- *     if name in SKYNET_PTYPE_name_to_id:             # <<<<<<<<<<<<<<
- *         assert id == SKYNET_PTYPE_name_to_id[name], "skynet proto type name=%s must bind id=%s" % (name, id)
- *         is_builtin = True
+  /* "src/cy_src/skynet_py_main.pyx":96
+ * def start(int thread, int profile):
+ *     cdef skynet_config config;
+ *     config.thread = thread             # <<<<<<<<<<<<<<
+ *     config.profile = profile
+ *     # use getenv for a stable ptr
+ */
+  __pyx_v_config.thread = __pyx_v_thread;
+
+  /* "src/cy_src/skynet_py_main.pyx":97
+ *     cdef skynet_config config;
+ *     config.thread = thread
+ *     config.profile = profile             # <<<<<<<<<<<<<<
+ *     # use getenv for a stable ptr
+ *     config.module_path = skynet_getenv("cservice")
+ */
+  __pyx_v_config.profile = __pyx_v_profile;
+
+  /* "src/cy_src/skynet_py_main.pyx":99
+ *     config.profile = profile
+ *     # use getenv for a stable ptr
+ *     config.module_path = skynet_getenv("cservice")             # <<<<<<<<<<<<<<
+ *     config.bootstrap = skynet_getenv("bootstrap")
+ *     config.logservice = skynet_getenv("logservice")
+ */
+  __pyx_v_config.module_path = skynet_getenv(((char const *)"cservice"));
+
+  /* "src/cy_src/skynet_py_main.pyx":100
+ *     # use getenv for a stable ptr
+ *     config.module_path = skynet_getenv("cservice")
+ *     config.bootstrap = skynet_getenv("bootstrap")             # <<<<<<<<<<<<<<
+ *     config.logservice = skynet_getenv("logservice")
+ *     config.logger = skynet_getenv("logger")
+ */
+  __pyx_v_config.bootstrap = skynet_getenv(((char const *)"bootstrap"));
+
+  /* "src/cy_src/skynet_py_main.pyx":101
+ *     config.module_path = skynet_getenv("cservice")
+ *     config.bootstrap = skynet_getenv("bootstrap")
+ *     config.logservice = skynet_getenv("logservice")             # <<<<<<<<<<<<<<
+ *     config.logger = skynet_getenv("logger")
+ *     # ignore
+ */
+  __pyx_v_config.logservice = skynet_getenv(((char const *)"logservice"));
+
+  /* "src/cy_src/skynet_py_main.pyx":102
+ *     config.bootstrap = skynet_getenv("bootstrap")
+ *     config.logservice = skynet_getenv("logservice")
+ *     config.logger = skynet_getenv("logger")             # <<<<<<<<<<<<<<
+ *     # ignore
+ *     config.harbor = 0
+ */
+  __pyx_v_config.logger = skynet_getenv(((char const *)"logger"));
+
+  /* "src/cy_src/skynet_py_main.pyx":104
+ *     config.logger = skynet_getenv("logger")
+ *     # ignore
+ *     config.harbor = 0             # <<<<<<<<<<<<<<
+ *     config.daemon = NULL # just ignore daemon
+ *     skynet_py_start(&config)
+ */
+  __pyx_v_config.harbor = 0;
+
+  /* "src/cy_src/skynet_py_main.pyx":105
+ *     # ignore
+ *     config.harbor = 0
+ *     config.daemon = NULL # just ignore daemon             # <<<<<<<<<<<<<<
+ *     skynet_py_start(&config)
+ * 
+ */
+  __pyx_v_config.daemon = NULL;
+
+  /* "src/cy_src/skynet_py_main.pyx":106
+ *     config.harbor = 0
+ *     config.daemon = NULL # just ignore daemon
+ *     skynet_py_start(&config)             # <<<<<<<<<<<<<<
+ * 
+ * def exit():
+ */
+  skynet_py_start((&__pyx_v_config));
+
+  /* "src/cy_src/skynet_py_main.pyx":94
+ *         return None
+ * 
+ * def start(int thread, int profile):             # <<<<<<<<<<<<<<
+ *     cdef skynet_config config;
+ *     config.thread = thread
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_SKYNET_PTYPE_name_to_id); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 132, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = (__Pyx_PySequence_ContainsTF(__pyx_v_name, __pyx_t_1, Py_EQ)); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 132, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_3 = (__pyx_t_2 != 0);
-  if (__pyx_t_3) {
 
-    /* "src/cy_src/skynet_py_mq.pyx":133
- *     is_builtin = False
- *     if name in SKYNET_PTYPE_name_to_id:
- *         assert id == SKYNET_PTYPE_name_to_id[name], "skynet proto type name=%s must bind id=%s" % (name, id)             # <<<<<<<<<<<<<<
- *         is_builtin = True
- *     if id in SKYNET_PTYPE_id_to_name:
- */
-    #ifndef CYTHON_WITHOUT_ASSERTIONS
-    if (unlikely(!Py_OptimizeFlag)) {
-      __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_SKYNET_PTYPE_name_to_id); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 133, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_1);
-      __pyx_t_4 = __Pyx_PyObject_GetItem(__pyx_t_1, __pyx_v_name); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 133, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_4);
-      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-      __pyx_t_1 = PyObject_RichCompare(__pyx_v_id, __pyx_t_4, Py_EQ); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 133, __pyx_L1_error)
-      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-      __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 133, __pyx_L1_error)
-      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-      if (unlikely(!__pyx_t_3)) {
-        __pyx_t_1 = PyTuple_New(4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 133, __pyx_L1_error)
-        __Pyx_GOTREF(__pyx_t_1);
-        __pyx_t_5 = 0;
-        __pyx_t_6 = 127;
-        __Pyx_INCREF(__pyx_kp_u_skynet_proto_type_name);
-        __pyx_t_5 += 23;
-        __Pyx_GIVEREF(__pyx_kp_u_skynet_proto_type_name);
-        PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_u_skynet_proto_type_name);
-        __pyx_t_4 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Unicode(__pyx_v_name), __pyx_empty_unicode); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 133, __pyx_L1_error)
-        __Pyx_GOTREF(__pyx_t_4);
-        __pyx_t_6 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_4) > __pyx_t_6) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_4) : __pyx_t_6;
-        __pyx_t_5 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_4);
-        __Pyx_GIVEREF(__pyx_t_4);
-        PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_4);
-        __pyx_t_4 = 0;
-        __Pyx_INCREF(__pyx_kp_u_must_bind_id);
-        __pyx_t_5 += 14;
-        __Pyx_GIVEREF(__pyx_kp_u_must_bind_id);
-        PyTuple_SET_ITEM(__pyx_t_1, 2, __pyx_kp_u_must_bind_id);
-        __pyx_t_4 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Unicode(__pyx_v_id), __pyx_empty_unicode); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 133, __pyx_L1_error)
-        __Pyx_GOTREF(__pyx_t_4);
-        __pyx_t_6 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_4) > __pyx_t_6) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_4) : __pyx_t_6;
-        __pyx_t_5 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_4);
-        __Pyx_GIVEREF(__pyx_t_4);
-        PyTuple_SET_ITEM(__pyx_t_1, 3, __pyx_t_4);
-        __pyx_t_4 = 0;
-        __pyx_t_4 = __Pyx_PyUnicode_Join(__pyx_t_1, 4, __pyx_t_5, __pyx_t_6); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 133, __pyx_L1_error)
-        __Pyx_GOTREF(__pyx_t_4);
-        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-        PyErr_SetObject(PyExc_AssertionError, __pyx_t_4);
-        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-        __PYX_ERR(0, 133, __pyx_L1_error)
-      }
-    }
-    #endif
+  /* function exit code */
+  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
 
-    /* "src/cy_src/skynet_py_mq.pyx":134
- *     if name in SKYNET_PTYPE_name_to_id:
- *         assert id == SKYNET_PTYPE_name_to_id[name], "skynet proto type name=%s must bind id=%s" % (name, id)
- *         is_builtin = True             # <<<<<<<<<<<<<<
- *     if id in SKYNET_PTYPE_id_to_name:
- *         assert name == SKYNET_PTYPE_id_to_name[id], "skynet proto type id=%s must bind name=%s" % (id, name)
- */
-    __pyx_v_is_builtin = 1;
-
-    /* "src/cy_src/skynet_py_mq.pyx":132
- * def user_assert_id_name(id, name):
- *     is_builtin = False
- *     if name in SKYNET_PTYPE_name_to_id:             # <<<<<<<<<<<<<<
- *         assert id == SKYNET_PTYPE_name_to_id[name], "skynet proto type name=%s must bind id=%s" % (name, id)
- *         is_builtin = True
+/* "src/cy_src/skynet_py_main.pyx":108
+ *     skynet_py_start(&config)
+ * 
+ * def exit():             # <<<<<<<<<<<<<<
+ *     skynet_py_exit()
+ * 
  */
-  }
 
-  /* "src/cy_src/skynet_py_mq.pyx":135
- *         assert id == SKYNET_PTYPE_name_to_id[name], "skynet proto type name=%s must bind id=%s" % (name, id)
- *         is_builtin = True
- *     if id in SKYNET_PTYPE_id_to_name:             # <<<<<<<<<<<<<<
- *         assert name == SKYNET_PTYPE_id_to_name[id], "skynet proto type id=%s must bind name=%s" % (id, name)
- *         is_builtin = True
- */
-  __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_SKYNET_PTYPE_id_to_name); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 135, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_3 = (__Pyx_PySequence_ContainsTF(__pyx_v_id, __pyx_t_4, Py_EQ)); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 135, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_2 = (__pyx_t_3 != 0);
-  if (__pyx_t_2) {
+/* Python wrapper */
+static PyObject *__pyx_pw_8pyskynet_14skynet_py_main_15exit(PyObject *__pyx_self, CYTHON_UNUSED PyObject *unused); /*proto*/
+static PyMethodDef __pyx_mdef_8pyskynet_14skynet_py_main_15exit = {"exit", (PyCFunction)__pyx_pw_8pyskynet_14skynet_py_main_15exit, METH_NOARGS, 0};
+static PyObject *__pyx_pw_8pyskynet_14skynet_py_main_15exit(PyObject *__pyx_self, CYTHON_UNUSED PyObject *unused) {
+  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_VARARGS(__pyx_args, __pyx_nargs);
+  PyObject *__pyx_r = 0;
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("exit (wrapper)", 0);
+  __pyx_r = __pyx_pf_8pyskynet_14skynet_py_main_14exit(__pyx_self);
 
-    /* "src/cy_src/skynet_py_mq.pyx":136
- *         is_builtin = True
- *     if id in SKYNET_PTYPE_id_to_name:
- *         assert name == SKYNET_PTYPE_id_to_name[id], "skynet proto type id=%s must bind name=%s" % (id, name)             # <<<<<<<<<<<<<<
- *         is_builtin = True
- *     if is_builtin:
- */
-    #ifndef CYTHON_WITHOUT_ASSERTIONS
-    if (unlikely(!Py_OptimizeFlag)) {
-      __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_SKYNET_PTYPE_id_to_name); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 136, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_4);
-      __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_t_4, __pyx_v_id); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 136, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_1);
-      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-      __pyx_t_4 = PyObject_RichCompare(__pyx_v_name, __pyx_t_1, Py_EQ); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 136, __pyx_L1_error)
-      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-      __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 136, __pyx_L1_error)
-      __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-      if (unlikely(!__pyx_t_2)) {
-        __pyx_t_4 = PyTuple_New(4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 136, __pyx_L1_error)
-        __Pyx_GOTREF(__pyx_t_4);
-        __pyx_t_5 = 0;
-        __pyx_t_6 = 127;
-        __Pyx_INCREF(__pyx_kp_u_skynet_proto_type_id);
-        __pyx_t_5 += 21;
-        __Pyx_GIVEREF(__pyx_kp_u_skynet_proto_type_id);
-        PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_kp_u_skynet_proto_type_id);
-        __pyx_t_1 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Unicode(__pyx_v_id), __pyx_empty_unicode); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 136, __pyx_L1_error)
-        __Pyx_GOTREF(__pyx_t_1);
-        __pyx_t_6 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_1) > __pyx_t_6) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_1) : __pyx_t_6;
-        __pyx_t_5 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_1);
-        __Pyx_GIVEREF(__pyx_t_1);
-        PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_t_1);
-        __pyx_t_1 = 0;
-        __Pyx_INCREF(__pyx_kp_u_must_bind_name);
-        __pyx_t_5 += 16;
-        __Pyx_GIVEREF(__pyx_kp_u_must_bind_name);
-        PyTuple_SET_ITEM(__pyx_t_4, 2, __pyx_kp_u_must_bind_name);
-        __pyx_t_1 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Unicode(__pyx_v_name), __pyx_empty_unicode); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 136, __pyx_L1_error)
-        __Pyx_GOTREF(__pyx_t_1);
-        __pyx_t_6 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_1) > __pyx_t_6) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_1) : __pyx_t_6;
-        __pyx_t_5 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_1);
-        __Pyx_GIVEREF(__pyx_t_1);
-        PyTuple_SET_ITEM(__pyx_t_4, 3, __pyx_t_1);
-        __pyx_t_1 = 0;
-        __pyx_t_1 = __Pyx_PyUnicode_Join(__pyx_t_4, 4, __pyx_t_5, __pyx_t_6); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 136, __pyx_L1_error)
-        __Pyx_GOTREF(__pyx_t_1);
-        __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-        PyErr_SetObject(PyExc_AssertionError, __pyx_t_1);
-        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-        __PYX_ERR(0, 136, __pyx_L1_error)
-      }
-    }
-    #endif
+  /* function exit code */
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
 
-    /* "src/cy_src/skynet_py_mq.pyx":137
- *     if id in SKYNET_PTYPE_id_to_name:
- *         assert name == SKYNET_PTYPE_id_to_name[id], "skynet proto type id=%s must bind name=%s" % (id, name)
- *         is_builtin = True             # <<<<<<<<<<<<<<
- *     if is_builtin:
- *         assert id in SKYNET_PTYPE_user_builtin_ids, "skynet proto can only register builtin proto 'lua' or 'client' or 'socket' or 'text' or 'foreign' or 'foreign_remote', but get name=%s" % name
- */
-    __pyx_v_is_builtin = 1;
-
-    /* "src/cy_src/skynet_py_mq.pyx":135
- *         assert id == SKYNET_PTYPE_name_to_id[name], "skynet proto type name=%s must bind id=%s" % (name, id)
- *         is_builtin = True
- *     if id in SKYNET_PTYPE_id_to_name:             # <<<<<<<<<<<<<<
- *         assert name == SKYNET_PTYPE_id_to_name[id], "skynet proto type id=%s must bind name=%s" % (id, name)
- *         is_builtin = True
+static PyObject *__pyx_pf_8pyskynet_14skynet_py_main_14exit(CYTHON_UNUSED PyObject *__pyx_self) {
+  PyObject *__pyx_r = NULL;
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("exit", 0);
+
+  /* "src/cy_src/skynet_py_main.pyx":109
+ * 
+ * def exit():
+ *     skynet_py_exit()             # <<<<<<<<<<<<<<
+ * 
+ * def self():
  */
-  }
+  skynet_py_exit();
 
-  /* "src/cy_src/skynet_py_mq.pyx":138
- *         assert name == SKYNET_PTYPE_id_to_name[id], "skynet proto type id=%s must bind name=%s" % (id, name)
- *         is_builtin = True
- *     if is_builtin:             # <<<<<<<<<<<<<<
- *         assert id in SKYNET_PTYPE_user_builtin_ids, "skynet proto can only register builtin proto 'lua' or 'client' or 'socket' or 'text' or 'foreign' or 'foreign_remote', but get name=%s" % name
+  /* "src/cy_src/skynet_py_main.pyx":108
+ *     skynet_py_start(&config)
+ * 
+ * def exit():             # <<<<<<<<<<<<<<
+ *     skynet_py_exit()
  * 
  */
-  __pyx_t_2 = (__pyx_v_is_builtin != 0);
-  if (__pyx_t_2) {
 
-    /* "src/cy_src/skynet_py_mq.pyx":139
- *         is_builtin = True
- *     if is_builtin:
- *         assert id in SKYNET_PTYPE_user_builtin_ids, "skynet proto can only register builtin proto 'lua' or 'client' or 'socket' or 'text' or 'foreign' or 'foreign_remote', but get name=%s" % name             # <<<<<<<<<<<<<<
- * 
- *     assert 0 <= id and id <= 255, "skynet proto type id must be less than 256 but get id=%s" % id
- */
-    #ifndef CYTHON_WITHOUT_ASSERTIONS
-    if (unlikely(!Py_OptimizeFlag)) {
-      __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_SKYNET_PTYPE_user_builtin_ids); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 139, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_1);
-      __pyx_t_2 = (__Pyx_PySequence_ContainsTF(__pyx_v_id, __pyx_t_1, Py_EQ)); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 139, __pyx_L1_error)
-      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-      if (unlikely(!(__pyx_t_2 != 0))) {
-        __pyx_t_1 = __Pyx_PyUnicode_FormatSafe(__pyx_kp_u_skynet_proto_can_only_register_b, __pyx_v_name); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 139, __pyx_L1_error)
-        __Pyx_GOTREF(__pyx_t_1);
-        PyErr_SetObject(PyExc_AssertionError, __pyx_t_1);
-        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-        __PYX_ERR(0, 139, __pyx_L1_error)
-      }
-    }
-    #endif
+  /* function exit code */
+  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
+  __Pyx_XGIVEREF(__pyx_r);
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
 
-    /* "src/cy_src/skynet_py_mq.pyx":138
- *         assert name == SKYNET_PTYPE_id_to_name[id], "skynet proto type id=%s must bind name=%s" % (id, name)
- *         is_builtin = True
- *     if is_builtin:             # <<<<<<<<<<<<<<
- *         assert id in SKYNET_PTYPE_user_builtin_ids, "skynet proto can only register builtin proto 'lua' or 'client' or 'socket' or 'text' or 'foreign' or 'foreign_remote', but get name=%s" % name
+/* "src/cy_src/skynet_py_main.pyx":111
+ *     skynet_py_exit()
  * 
+ * def self():             # <<<<<<<<<<<<<<
+ *     return skynet_py_address()
  */
-  }
 
-  /* "src/cy_src/skynet_py_mq.pyx":141
- *         assert id in SKYNET_PTYPE_user_builtin_ids, "skynet proto can only register builtin proto 'lua' or 'client' or 'socket' or 'text' or 'foreign' or 'foreign_remote', but get name=%s" % name
+/* Python wrapper */
+static PyObject *__pyx_pw_8pyskynet_14skynet_py_main_17self(PyObject *__pyx_self, CYTHON_UNUSED PyObject *unused); /*proto*/
+static PyMethodDef __pyx_mdef_8pyskynet_14skynet_py_main_17self = {"self", (PyCFunction)__pyx_pw_8pyskynet_14skynet_py_main_17self, METH_NOARGS, 0};
+static PyObject *__pyx_pw_8pyskynet_14skynet_py_main_17self(PyObject *__pyx_self, CYTHON_UNUSED PyObject *unused) {
+  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_VARARGS(__pyx_args, __pyx_nargs);
+  PyObject *__pyx_r = 0;
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("self (wrapper)", 0);
+  __pyx_r = __pyx_pf_8pyskynet_14skynet_py_main_16self(__pyx_self);
+
+  /* function exit code */
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+static PyObject *__pyx_pf_8pyskynet_14skynet_py_main_16self(CYTHON_UNUSED PyObject *__pyx_self) {
+  PyObject *__pyx_r = NULL;
+  __Pyx_RefNannyDeclarations
+  PyObject *__pyx_t_1 = NULL;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("self", 0);
+
+  /* "src/cy_src/skynet_py_main.pyx":112
  * 
- *     assert 0 <= id and id <= 255, "skynet proto type id must be less than 256 but get id=%s" % id             # <<<<<<<<<<<<<<
+ * def self():
+ *     return skynet_py_address()             # <<<<<<<<<<<<<<
  */
-  #ifndef CYTHON_WITHOUT_ASSERTIONS
-  if (unlikely(!Py_OptimizeFlag)) {
-    __pyx_t_1 = PyObject_RichCompare(__pyx_int_0, __pyx_v_id, Py_LE); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 141, __pyx_L1_error)
-    __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 141, __pyx_L1_error)
-    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    if (__pyx_t_3) {
-    } else {
-      __pyx_t_2 = __pyx_t_3;
-      goto __pyx_L6_bool_binop_done;
-    }
-    __pyx_t_1 = PyObject_RichCompare(__pyx_v_id, __pyx_int_255, Py_LE); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 141, __pyx_L1_error)
-    __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 141, __pyx_L1_error)
-    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __pyx_t_2 = __pyx_t_3;
-    __pyx_L6_bool_binop_done:;
-    if (unlikely(!__pyx_t_2)) {
-      __pyx_t_1 = __Pyx_PyUnicode_FormatSafe(__pyx_kp_u_skynet_proto_type_id_must_be_les, __pyx_v_id); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 141, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_1);
-      PyErr_SetObject(PyExc_AssertionError, __pyx_t_1);
-      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-      __PYX_ERR(0, 141, __pyx_L1_error)
-    }
-  }
-  #endif
+  __Pyx_XDECREF(__pyx_r);
+  __pyx_t_1 = __Pyx_PyInt_From_uint32_t(skynet_py_address()); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 112, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_r = __pyx_t_1;
+  __pyx_t_1 = 0;
+  goto __pyx_L0;
 
-  /* "src/cy_src/skynet_py_mq.pyx":130
+  /* "src/cy_src/skynet_py_main.pyx":111
+ *     skynet_py_exit()
  * 
- * SKYNET_PTYPE_user_builtin_ids = [SKYNET_PTYPE.PTYPE_LUA, SKYNET_PTYPE.PTYPE_CLIENT, SKYNET_PTYPE.PTYPE_SOCKET, SKYNET_PTYPE.PTYPE_TEXT, SKYNET_PTYPE.PTYPE_FOREIGN, SKYNET_PTYPE.PTYPE_FOREIGN_REMOTE]
- * def user_assert_id_name(id, name):             # <<<<<<<<<<<<<<
- *     is_builtin = False
- *     if name in SKYNET_PTYPE_name_to_id:
+ * def self():             # <<<<<<<<<<<<<<
+ *     return skynet_py_address()
  */
 
   /* function exit code */
-  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
-  goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_XDECREF(__pyx_t_4);
-  __Pyx_AddTraceback("pyskynet.skynet_py_mq.user_assert_id_name", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("pyskynet.skynet_py_main.self", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 static PyMethodDef __pyx_methods[] = {
   {0, 0, 0, 0}
 };
-
-#if PY_MAJOR_VERSION >= 3
-#if CYTHON_PEP489_MULTI_PHASE_INIT
-static PyObject* __pyx_pymod_create(PyObject *spec, PyModuleDef *def); /*proto*/
-static int __pyx_pymod_exec_skynet_py_mq(PyObject* module); /*proto*/
-static PyModuleDef_Slot __pyx_moduledef_slots[] = {
-  {Py_mod_create, (void*)__pyx_pymod_create},
-  {Py_mod_exec, (void*)__pyx_pymod_exec_skynet_py_mq},
-  {0, NULL}
-};
-#endif
-
-static struct PyModuleDef __pyx_moduledef = {
-    PyModuleDef_HEAD_INIT,
-    "skynet_py_mq",
-    0, /* m_doc */
-  #if CYTHON_PEP489_MULTI_PHASE_INIT
-    0, /* m_size */
-  #else
-    -1, /* m_size */
-  #endif
-    __pyx_methods /* m_methods */,
-  #if CYTHON_PEP489_MULTI_PHASE_INIT
-    __pyx_moduledef_slots, /* m_slots */
-  #else
-    NULL, /* m_reload */
-  #endif
-    NULL, /* m_traverse */
-    NULL, /* m_clear */
-    NULL /* m_free */
-};
-#endif
 #ifndef CYTHON_SMALL_CODE
 #if defined(__clang__)
     #define CYTHON_SMALL_CODE
 #elif defined(__GNUC__) && (__GNUC__ > 4 || (__GNUC__ == 4 && __GNUC_MINOR__ >= 3))
     #define CYTHON_SMALL_CODE __attribute__((cold))
 #else
     #define CYTHON_SMALL_CODE
 #endif
 #endif
+/* #### Code section: pystring_table ### */
 
-static __Pyx_StringTabEntry __pyx_string_tab[] = {
-  {&__pyx_n_s_PTYPEEnum, __pyx_k_PTYPEEnum, sizeof(__pyx_k_PTYPEEnum), 0, 0, 1, 1},
-  {&__pyx_n_s_PTYPEEnum___init, __pyx_k_PTYPEEnum___init, sizeof(__pyx_k_PTYPEEnum___init), 0, 0, 1, 1},
-  {&__pyx_n_s_PTYPE_CLIENT, __pyx_k_PTYPE_CLIENT, sizeof(__pyx_k_PTYPE_CLIENT), 0, 0, 1, 1},
-  {&__pyx_n_s_PTYPE_DEBUG, __pyx_k_PTYPE_DEBUG, sizeof(__pyx_k_PTYPE_DEBUG), 0, 0, 1, 1},
-  {&__pyx_n_s_PTYPE_ERROR, __pyx_k_PTYPE_ERROR, sizeof(__pyx_k_PTYPE_ERROR), 0, 0, 1, 1},
-  {&__pyx_n_s_PTYPE_FOREIGN, __pyx_k_PTYPE_FOREIGN, sizeof(__pyx_k_PTYPE_FOREIGN), 0, 0, 1, 1},
-  {&__pyx_n_s_PTYPE_FOREIGN_REMOTE, __pyx_k_PTYPE_FOREIGN_REMOTE, sizeof(__pyx_k_PTYPE_FOREIGN_REMOTE), 0, 0, 1, 1},
-  {&__pyx_n_s_PTYPE_HARBOR, __pyx_k_PTYPE_HARBOR, sizeof(__pyx_k_PTYPE_HARBOR), 0, 0, 1, 1},
-  {&__pyx_n_s_PTYPE_LUA, __pyx_k_PTYPE_LUA, sizeof(__pyx_k_PTYPE_LUA), 0, 0, 1, 1},
-  {&__pyx_n_s_PTYPE_MULTICAST, __pyx_k_PTYPE_MULTICAST, sizeof(__pyx_k_PTYPE_MULTICAST), 0, 0, 1, 1},
-  {&__pyx_n_s_PTYPE_QUEUE, __pyx_k_PTYPE_QUEUE, sizeof(__pyx_k_PTYPE_QUEUE), 0, 0, 1, 1},
-  {&__pyx_n_s_PTYPE_RESPONSE, __pyx_k_PTYPE_RESPONSE, sizeof(__pyx_k_PTYPE_RESPONSE), 0, 0, 1, 1},
-  {&__pyx_n_s_PTYPE_SNAX, __pyx_k_PTYPE_SNAX, sizeof(__pyx_k_PTYPE_SNAX), 0, 0, 1, 1},
-  {&__pyx_n_s_PTYPE_SOCKET, __pyx_k_PTYPE_SOCKET, sizeof(__pyx_k_PTYPE_SOCKET), 0, 0, 1, 1},
-  {&__pyx_n_s_PTYPE_SYSTEM, __pyx_k_PTYPE_SYSTEM, sizeof(__pyx_k_PTYPE_SYSTEM), 0, 0, 1, 1},
-  {&__pyx_n_s_PTYPE_TAG_ALLOCSESSION, __pyx_k_PTYPE_TAG_ALLOCSESSION, sizeof(__pyx_k_PTYPE_TAG_ALLOCSESSION), 0, 0, 1, 1},
-  {&__pyx_n_s_PTYPE_TAG_DONTCOPY, __pyx_k_PTYPE_TAG_DONTCOPY, sizeof(__pyx_k_PTYPE_TAG_DONTCOPY), 0, 0, 1, 1},
-  {&__pyx_n_s_PTYPE_TEXT, __pyx_k_PTYPE_TEXT, sizeof(__pyx_k_PTYPE_TEXT), 0, 0, 1, 1},
-  {&__pyx_n_s_PTYPE_TRACE, __pyx_k_PTYPE_TRACE, sizeof(__pyx_k_PTYPE_TRACE), 0, 0, 1, 1},
-  {&__pyx_n_s_SKYNET_PTYPE, __pyx_k_SKYNET_PTYPE, sizeof(__pyx_k_SKYNET_PTYPE), 0, 0, 1, 1},
-  {&__pyx_n_s_SKYNET_PTYPE_id_to_name, __pyx_k_SKYNET_PTYPE_id_to_name, sizeof(__pyx_k_SKYNET_PTYPE_id_to_name), 0, 0, 1, 1},
-  {&__pyx_n_s_SKYNET_PTYPE_name_to_id, __pyx_k_SKYNET_PTYPE_name_to_id, sizeof(__pyx_k_SKYNET_PTYPE_name_to_id), 0, 0, 1, 1},
-  {&__pyx_n_s_SKYNET_PTYPE_user_builtin_ids, __pyx_k_SKYNET_PTYPE_user_builtin_ids, sizeof(__pyx_k_SKYNET_PTYPE_user_builtin_ids), 0, 0, 1, 1},
-  {&__pyx_kp_b__2, __pyx_k__2, sizeof(__pyx_k__2), 0, 0, 0, 0},
-  {&__pyx_n_s_b, __pyx_k_b, sizeof(__pyx_k_b), 0, 0, 1, 1},
-  {&__pyx_n_s_capsule, __pyx_k_capsule, sizeof(__pyx_k_capsule), 0, 0, 1, 1},
-  {&__pyx_kp_u_capsule_unpack_failed_for_name_s, __pyx_k_capsule_unpack_failed_for_name_s, sizeof(__pyx_k_capsule_unpack_failed_for_name_s), 0, 1, 0, 0},
-  {&__pyx_n_s_cline_in_traceback, __pyx_k_cline_in_traceback, sizeof(__pyx_k_cline_in_traceback), 0, 0, 1, 1},
-  {&__pyx_n_s_crecv, __pyx_k_crecv, sizeof(__pyx_k_crecv), 0, 0, 1, 1},
-  {&__pyx_n_s_csend, __pyx_k_csend, sizeof(__pyx_k_csend), 0, 0, 1, 1},
-  {&__pyx_n_s_decode, __pyx_k_decode, sizeof(__pyx_k_decode), 0, 0, 1, 1},
-  {&__pyx_n_s_dict, __pyx_k_dict, sizeof(__pyx_k_dict), 0, 0, 1, 1},
-  {&__pyx_n_s_doc, __pyx_k_doc, sizeof(__pyx_k_doc), 0, 0, 1, 1},
-  {&__pyx_n_s_dst, __pyx_k_dst, sizeof(__pyx_k_dst), 0, 0, 1, 1},
-  {&__pyx_n_s_dstname, __pyx_k_dstname, sizeof(__pyx_k_dstname), 0, 0, 1, 1},
-  {&__pyx_n_s_id, __pyx_k_id, sizeof(__pyx_k_id), 0, 0, 1, 1},
-  {&__pyx_n_s_init, __pyx_k_init, sizeof(__pyx_k_init), 0, 0, 1, 1},
-  {&__pyx_n_s_is_builtin, __pyx_k_is_builtin, sizeof(__pyx_k_is_builtin), 0, 0, 1, 1},
-  {&__pyx_n_s_items, __pyx_k_items, sizeof(__pyx_k_items), 0, 0, 1, 1},
-  {&__pyx_n_s_key, __pyx_k_key, sizeof(__pyx_k_key), 0, 0, 1, 1},
-  {&__pyx_n_s_lower, __pyx_k_lower, sizeof(__pyx_k_lower), 0, 0, 1, 1},
-  {&__pyx_n_s_main, __pyx_k_main, sizeof(__pyx_k_main), 0, 0, 1, 1},
-  {&__pyx_n_s_metaclass, __pyx_k_metaclass, sizeof(__pyx_k_metaclass), 0, 0, 1, 1},
-  {&__pyx_n_s_module, __pyx_k_module, sizeof(__pyx_k_module), 0, 0, 1, 1},
-  {&__pyx_n_s_msg, __pyx_k_msg, sizeof(__pyx_k_msg), 0, 0, 1, 1},
-  {&__pyx_kp_u_must_bind_id, __pyx_k_must_bind_id, sizeof(__pyx_k_must_bind_id), 0, 1, 0, 0},
-  {&__pyx_kp_u_must_bind_name, __pyx_k_must_bind_name, sizeof(__pyx_k_must_bind_name), 0, 1, 0, 0},
-  {&__pyx_n_s_name, __pyx_k_name, sizeof(__pyx_k_name), 0, 0, 1, 1},
-  {&__pyx_n_s_name_2, __pyx_k_name_2, sizeof(__pyx_k_name_2), 0, 0, 1, 1},
-  {&__pyx_n_s_object, __pyx_k_object, sizeof(__pyx_k_object), 0, 0, 1, 1},
-  {&__pyx_kp_u_package_is_too_large_s, __pyx_k_package_is_too_large_s, sizeof(__pyx_k_package_is_too_large_s), 0, 1, 0, 0},
-  {&__pyx_n_s_prepare, __pyx_k_prepare, sizeof(__pyx_k_prepare), 0, 0, 1, 1},
-  {&__pyx_n_s_ptr, __pyx_k_ptr, sizeof(__pyx_k_ptr), 0, 0, 1, 1},
-  {&__pyx_n_s_py_dst, __pyx_k_py_dst, sizeof(__pyx_k_py_dst), 0, 0, 1, 1},
-  {&__pyx_n_s_py_dst_bytes, __pyx_k_py_dst_bytes, sizeof(__pyx_k_py_dst_bytes), 0, 0, 1, 1},
-  {&__pyx_n_s_py_msg, __pyx_k_py_msg, sizeof(__pyx_k_py_msg), 0, 0, 1, 1},
-  {&__pyx_n_s_py_msg_bytes, __pyx_k_py_msg_bytes, sizeof(__pyx_k_py_msg_bytes), 0, 0, 1, 1},
-  {&__pyx_n_s_py_session, __pyx_k_py_session, sizeof(__pyx_k_py_session), 0, 0, 1, 1},
-  {&__pyx_n_s_py_size, __pyx_k_py_size, sizeof(__pyx_k_py_size), 0, 0, 1, 1},
-  {&__pyx_n_s_pyskynet_skynet_py_mq, __pyx_k_pyskynet_skynet_py_mq, sizeof(__pyx_k_pyskynet_skynet_py_mq), 0, 0, 1, 1},
-  {&__pyx_n_s_qualname, __pyx_k_qualname, sizeof(__pyx_k_qualname), 0, 0, 1, 1},
-  {&__pyx_n_s_ret, __pyx_k_ret, sizeof(__pyx_k_ret), 0, 0, 1, 1},
-  {&__pyx_n_s_s, __pyx_k_s, sizeof(__pyx_k_s), 0, 0, 1, 1},
-  {&__pyx_n_s_self, __pyx_k_self, sizeof(__pyx_k_self), 0, 0, 1, 1},
-  {&__pyx_n_s_session, __pyx_k_session, sizeof(__pyx_k_session), 0, 0, 1, 1},
-  {&__pyx_n_s_size, __pyx_k_size, sizeof(__pyx_k_size), 0, 0, 1, 1},
-  {&__pyx_kp_u_skynet_proto_can_only_register_b, __pyx_k_skynet_proto_can_only_register_b, sizeof(__pyx_k_skynet_proto_can_only_register_b), 0, 1, 0, 0},
-  {&__pyx_kp_u_skynet_proto_type_id, __pyx_k_skynet_proto_type_id, sizeof(__pyx_k_skynet_proto_type_id), 0, 1, 0, 0},
-  {&__pyx_kp_u_skynet_proto_type_id_must_be_les, __pyx_k_skynet_proto_type_id_must_be_les, sizeof(__pyx_k_skynet_proto_type_id_must_be_les), 0, 1, 0, 0},
-  {&__pyx_kp_u_skynet_proto_type_name, __pyx_k_skynet_proto_type_name, sizeof(__pyx_k_skynet_proto_type_name), 0, 1, 0, 0},
-  {&__pyx_kp_u_skynet_threads_has_not_been_star, __pyx_k_skynet_threads_has_not_been_star, sizeof(__pyx_k_skynet_threads_has_not_been_star), 0, 1, 0, 0},
-  {&__pyx_kp_s_src_cy_src_skynet_py_mq_pyx, __pyx_k_src_cy_src_skynet_py_mq_pyx, sizeof(__pyx_k_src_cy_src_skynet_py_mq_pyx), 0, 0, 1, 0},
-  {&__pyx_n_s_test, __pyx_k_test, sizeof(__pyx_k_test), 0, 0, 1, 1},
-  {&__pyx_n_s_tobytes, __pyx_k_tobytes, sizeof(__pyx_k_tobytes), 0, 0, 1, 1},
-  {&__pyx_n_s_tostring, __pyx_k_tostring, sizeof(__pyx_k_tostring), 0, 0, 1, 1},
-  {&__pyx_n_s_type_id, __pyx_k_type_id, sizeof(__pyx_k_type_id), 0, 0, 1, 1},
-  {&__pyx_kp_u_type_s_unexcept_when_skynet_csen, __pyx_k_type_s_unexcept_when_skynet_csen, sizeof(__pyx_k_type_s_unexcept_when_skynet_csen), 0, 1, 0, 0},
-  {&__pyx_n_s_user_assert_id_name, __pyx_k_user_assert_id_name, sizeof(__pyx_k_user_assert_id_name), 0, 0, 1, 1},
-  {0, 0, 0, 0, 0, 0, 0}
-};
+static int __Pyx_CreateStringTabAndInitStrings(void) {
+  __Pyx_StringTabEntry __pyx_string_tab[] = {
+    {&__pyx_n_s_C_API, __pyx_k_C_API, sizeof(__pyx_k_C_API), 0, 0, 1, 1},
+    {&__pyx_n_s__22, __pyx_k__22, sizeof(__pyx_k__22), 0, 0, 1, 1},
+    {&__pyx_n_s__4, __pyx_k__4, sizeof(__pyx_k__4), 0, 0, 1, 1},
+    {&__pyx_n_s_async_handle, __pyx_k_async_handle, sizeof(__pyx_k_async_handle), 0, 0, 1, 1},
+    {&__pyx_n_s_async_send, __pyx_k_async_send, sizeof(__pyx_k_async_send), 0, 0, 1, 1},
+    {&__pyx_n_s_asyncio_coroutines, __pyx_k_asyncio_coroutines, sizeof(__pyx_k_asyncio_coroutines), 0, 0, 1, 1},
+    {&__pyx_n_s_capsule_or_bytes, __pyx_k_capsule_or_bytes, sizeof(__pyx_k_capsule_or_bytes), 0, 0, 1, 1},
+    {&__pyx_n_s_cffi_backend, __pyx_k_cffi_backend, sizeof(__pyx_k_cffi_backend), 0, 0, 1, 1},
+    {&__pyx_n_s_cffi_exports, __pyx_k_cffi_exports, sizeof(__pyx_k_cffi_exports), 0, 0, 1, 1},
+    {&__pyx_n_s_cffi_to_c_pointer, __pyx_k_cffi_to_c_pointer, sizeof(__pyx_k_cffi_to_c_pointer), 0, 0, 1, 1},
+    {&__pyx_n_s_cline_in_traceback, __pyx_k_cline_in_traceback, sizeof(__pyx_k_cline_in_traceback), 0, 0, 1, 1},
+    {&__pyx_n_s_config, __pyx_k_config, sizeof(__pyx_k_config), 0, 0, 1, 1},
+    {&__pyx_n_s_encode, __pyx_k_encode, sizeof(__pyx_k_encode), 0, 0, 1, 1},
+    {&__pyx_n_s_exit, __pyx_k_exit, sizeof(__pyx_k_exit), 0, 0, 1, 1},
+    {&__pyx_n_s_ffi, __pyx_k_ffi, sizeof(__pyx_k_ffi), 0, 0, 1, 1},
+    {&__pyx_n_s_getlenv, __pyx_k_getlenv, sizeof(__pyx_k_getlenv), 0, 0, 1, 1},
+    {&__pyx_kp_u_getlenv_but_value_not_existed, __pyx_k_getlenv_but_value_not_existed, sizeof(__pyx_k_getlenv_but_value_not_existed), 0, 1, 0, 0},
+    {&__pyx_n_s_getscript, __pyx_k_getscript, sizeof(__pyx_k_getscript), 0, 0, 1, 1},
+    {&__pyx_n_s_import, __pyx_k_import, sizeof(__pyx_k_import), 0, 0, 1, 1},
+    {&__pyx_n_s_index, __pyx_k_index, sizeof(__pyx_k_index), 0, 0, 1, 1},
+    {&__pyx_n_s_init, __pyx_k_init, sizeof(__pyx_k_init), 0, 0, 1, 1},
+    {&__pyx_n_s_initializing, __pyx_k_initializing, sizeof(__pyx_k_initializing), 0, 0, 1, 1},
+    {&__pyx_n_s_is_coroutine, __pyx_k_is_coroutine, sizeof(__pyx_k_is_coroutine), 0, 0, 1, 1},
+    {&__pyx_n_s_key, __pyx_k_key, sizeof(__pyx_k_key), 0, 0, 1, 1},
+    {&__pyx_n_s_main, __pyx_k_main, sizeof(__pyx_k_main), 0, 0, 1, 1},
+    {&__pyx_n_s_name, __pyx_k_name, sizeof(__pyx_k_name), 0, 0, 1, 1},
+    {&__pyx_n_s_nextenv, __pyx_k_nextenv, sizeof(__pyx_k_nextenv), 0, 0, 1, 1},
+    {&__pyx_n_s_profile, __pyx_k_profile, sizeof(__pyx_k_profile), 0, 0, 1, 1},
+    {&__pyx_n_s_ptr, __pyx_k_ptr, sizeof(__pyx_k_ptr), 0, 0, 1, 1},
+    {&__pyx_n_s_py_sz, __pyx_k_py_sz, sizeof(__pyx_k_py_sz), 0, 0, 1, 1},
+    {&__pyx_n_s_pyskynet_skynet_py_main, __pyx_k_pyskynet_skynet_py_main, sizeof(__pyx_k_pyskynet_skynet_py_main), 0, 0, 1, 1},
+    {&__pyx_n_s_refscript, __pyx_k_refscript, sizeof(__pyx_k_refscript), 0, 0, 1, 1},
+    {&__pyx_n_s_ret, __pyx_k_ret, sizeof(__pyx_k_ret), 0, 0, 1, 1},
+    {&__pyx_n_s_script, __pyx_k_script, sizeof(__pyx_k_script), 0, 0, 1, 1},
+    {&__pyx_n_s_self, __pyx_k_self, sizeof(__pyx_k_self), 0, 0, 1, 1},
+    {&__pyx_n_s_setlenv, __pyx_k_setlenv, sizeof(__pyx_k_setlenv), 0, 0, 1, 1},
+    {&__pyx_kp_u_setlenv_but_key_conflict, __pyx_k_setlenv_but_key_conflict, sizeof(__pyx_k_setlenv_but_key_conflict), 0, 1, 0, 0},
+    {&__pyx_kp_u_skynet_py_env_value_must_be_byte, __pyx_k_skynet_py_env_value_must_be_byte, sizeof(__pyx_k_skynet_py_env_value_must_be_byte), 0, 1, 0, 0},
+    {&__pyx_n_s_spec, __pyx_k_spec, sizeof(__pyx_k_spec), 0, 0, 1, 1},
+    {&__pyx_kp_s_src_cy_src_skynet_py_main_pyx, __pyx_k_src_cy_src_skynet_py_main_pyx, sizeof(__pyx_k_src_cy_src_skynet_py_main_pyx), 0, 0, 1, 0},
+    {&__pyx_n_s_start, __pyx_k_start, sizeof(__pyx_k_start), 0, 0, 1, 1},
+    {&__pyx_n_s_sz, __pyx_k_sz, sizeof(__pyx_k_sz), 0, 0, 1, 1},
+    {&__pyx_n_s_test, __pyx_k_test, sizeof(__pyx_k_test), 0, 0, 1, 1},
+    {&__pyx_n_s_thread, __pyx_k_thread, sizeof(__pyx_k_thread), 0, 0, 1, 1},
+    {&__pyx_kp_u_type_s_can_t_convert_to_bytes, __pyx_k_type_s_can_t_convert_to_bytes, sizeof(__pyx_k_type_s_can_t_convert_to_bytes), 0, 1, 0, 0},
+    {&__pyx_n_s_typeof, __pyx_k_typeof, sizeof(__pyx_k_typeof), 0, 0, 1, 1},
+    {&__pyx_kp_u_utf_8, __pyx_k_utf_8, sizeof(__pyx_k_utf_8), 0, 1, 0, 0},
+    {&__pyx_n_s_value, __pyx_k_value, sizeof(__pyx_k_value), 0, 0, 1, 1},
+    {0, 0, 0, 0, 0, 0, 0}
+  };
+  return __Pyx_InitStrings(__pyx_string_tab);
+}
+/* #### Code section: cached_builtins ### */
 static CYTHON_SMALL_CODE int __Pyx_InitCachedBuiltins(void) {
-  __pyx_builtin_object = __Pyx_GetBuiltinName(__pyx_n_s_object); if (!__pyx_builtin_object) __PYX_ERR(0, 97, __pyx_L1_error)
   return 0;
-  __pyx_L1_error:;
-  return -1;
 }
+/* #### Code section: cached_constants ### */
 
 static CYTHON_SMALL_CODE int __Pyx_InitCachedConstants(void) {
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__Pyx_InitCachedConstants", 0);
 
-  /* "src/cy_src/skynet_py_mq.pyx":24
- *         ret = skynet_py_queue_pop(&msg)
- *     if ret != 0:
- *         return None, None, None, None, None             # <<<<<<<<<<<<<<
+  /* "src/cy_src/skynet_py_main.pyx":52
+ *         sz = len(capsule_or_bytes)
  *     else:
- *         # TODO when msg.type is error , msg.data will be nil ?
+ *         raise Exception("skynet_py env value must be bytes or pointer")             # <<<<<<<<<<<<<<
+ *     key = __check_bytes(key)
+ *     cdef int ret = skynet_py_setlenv(key, ptr, sz)
  */
-  __pyx_tuple_ = PyTuple_Pack(5, Py_None, Py_None, Py_None, Py_None, Py_None); if (unlikely(!__pyx_tuple_)) __PYX_ERR(0, 24, __pyx_L1_error)
+  __pyx_tuple_ = PyTuple_Pack(1, __pyx_kp_u_skynet_py_env_value_must_be_byte); if (unlikely(!__pyx_tuple_)) __PYX_ERR(0, 52, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple_);
   __Pyx_GIVEREF(__pyx_tuple_);
 
-  /* "src/cy_src/skynet_py_mq.pyx":95
- *         return s
+  /* "src/cy_src/skynet_py_main.pyx":56
+ *     cdef int ret = skynet_py_setlenv(key, ptr, sz)
+ *     if ret != 0:
+ *         raise Exception("setlenv but key conflict")             # <<<<<<<<<<<<<<
+ * 
+ * 
+ */
+  __pyx_tuple__2 = PyTuple_Pack(1, __pyx_kp_u_setlenv_but_key_conflict); if (unlikely(!__pyx_tuple__2)) __PYX_ERR(0, 56, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__2);
+  __Pyx_GIVEREF(__pyx_tuple__2);
+
+  /* "src/cy_src/skynet_py_main.pyx":67
+ *         return PyBytes_FromStringAndSize(value, sz);
  *     else:
- *         raise Exception("capsule unpack failed for name = %s")             # <<<<<<<<<<<<<<
+ *         raise Exception("getlenv but value not existed")             # <<<<<<<<<<<<<<
  * 
- * class PTYPEEnum(object):
+ * def nextenv(key):
  */
-  __pyx_tuple__3 = PyTuple_Pack(1, __pyx_kp_u_capsule_unpack_failed_for_name_s); if (unlikely(!__pyx_tuple__3)) __PYX_ERR(0, 95, __pyx_L1_error)
+  __pyx_tuple__3 = PyTuple_Pack(1, __pyx_kp_u_getlenv_but_value_not_existed); if (unlikely(!__pyx_tuple__3)) __PYX_ERR(0, 67, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__3);
   __Pyx_GIVEREF(__pyx_tuple__3);
 
-  /* "src/cy_src/skynet_py_mq.pyx":17
- *     skynet_free(ptr)
+  /* "src/cy_src/skynet_py_main.pyx":23
+ * ctypedef (char *)(* f_type)(object, object)
  * 
- * def crecv():             # <<<<<<<<<<<<<<
- *     cdef SkynetPyMessage msg
- *     cdef int ret = skynet_py_queue_pop(&msg)
- */
-  __pyx_tuple__4 = PyTuple_Pack(2, __pyx_n_s_msg, __pyx_n_s_ret); if (unlikely(!__pyx_tuple__4)) __PYX_ERR(0, 17, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__4);
-  __Pyx_GIVEREF(__pyx_tuple__4);
-  __pyx_codeobj__5 = (PyObject*)__Pyx_PyCode_New(0, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__4, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_cy_src_skynet_py_mq_pyx, __pyx_n_s_crecv, 17, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__5)) __PYX_ERR(0, 17, __pyx_L1_error)
-
-  /* "src/cy_src/skynet_py_mq.pyx":33
- * 
- * # see lsend in lua-skynet.c
- * def csend(py_dst, int type_id, py_session, py_msg, py_size=None):             # <<<<<<<<<<<<<<
- *     assert skynet_py_address() > 0, "skynet threads has not been started yet, call 'pyskynet.start()' first."
- *     # 1. check dst
- */
-  __pyx_tuple__6 = PyTuple_Pack(12, __pyx_n_s_py_dst, __pyx_n_s_type_id, __pyx_n_s_py_session, __pyx_n_s_py_msg, __pyx_n_s_py_size, __pyx_n_s_dstname, __pyx_n_s_dst, __pyx_n_s_py_dst_bytes, __pyx_n_s_session, __pyx_n_s_ptr, __pyx_n_s_size, __pyx_n_s_py_msg_bytes); if (unlikely(!__pyx_tuple__6)) __PYX_ERR(0, 33, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__6);
-  __Pyx_GIVEREF(__pyx_tuple__6);
-  __pyx_codeobj__7 = (PyObject*)__Pyx_PyCode_New(5, 0, 12, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__6, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_cy_src_skynet_py_mq_pyx, __pyx_n_s_csend, 33, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__7)) __PYX_ERR(0, 33, __pyx_L1_error)
-
-  /* "src/cy_src/skynet_py_mq.pyx":82
- * 
- * # extern
- * def tostring(capsule, size_t size):             # <<<<<<<<<<<<<<
- *     b = tobytes(capsule, size)
- *     return b.decode()
- */
-  __pyx_tuple__8 = PyTuple_Pack(3, __pyx_n_s_capsule, __pyx_n_s_size, __pyx_n_s_b); if (unlikely(!__pyx_tuple__8)) __PYX_ERR(0, 82, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__8);
-  __Pyx_GIVEREF(__pyx_tuple__8);
-  __pyx_codeobj__9 = (PyObject*)__Pyx_PyCode_New(2, 0, 3, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__8, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_cy_src_skynet_py_mq_pyx, __pyx_n_s_tostring, 82, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__9)) __PYX_ERR(0, 82, __pyx_L1_error)
-
-  /* "src/cy_src/skynet_py_mq.pyx":87
- * 
- * # extern
- * def tobytes(capsule, size_t size):             # <<<<<<<<<<<<<<
- *     cdef char *name = PyCapsule_GetName(capsule)
- *     cdef char *ptr = <char *>PyCapsule_GetPointer(capsule, name)
+ * def init(ffi, async_send, async_handle):             # <<<<<<<<<<<<<<
+ *     # because gevent's libuv bind with cffi, so we can get pointer by this way
+ *     cdef void ** _cffi_exports = <void **>PyCapsule_GetPointer(_cffi_backend._C_API, "cffi")
  */
-  __pyx_tuple__10 = PyTuple_Pack(5, __pyx_n_s_capsule, __pyx_n_s_size, __pyx_n_s_name, __pyx_n_s_ptr, __pyx_n_s_s); if (unlikely(!__pyx_tuple__10)) __PYX_ERR(0, 87, __pyx_L1_error)
+  __pyx_tuple__5 = PyTuple_Pack(5, __pyx_n_s_ffi, __pyx_n_s_async_send, __pyx_n_s_async_handle, __pyx_n_s_cffi_exports, __pyx_n_s_cffi_to_c_pointer); if (unlikely(!__pyx_tuple__5)) __PYX_ERR(0, 23, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__5);
+  __Pyx_GIVEREF(__pyx_tuple__5);
+  __pyx_codeobj__6 = (PyObject*)__Pyx_PyCode_New(3, 0, 0, 5, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__5, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_cy_src_skynet_py_main_pyx, __pyx_n_s_init, 23, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__6)) __PYX_ERR(0, 23, __pyx_L1_error)
+
+  /* "src/cy_src/skynet_py_main.pyx":42
+ *         raise Exception("type %s can't convert to bytes" % str(t))
+ * 
+ * def setlenv(key, capsule_or_bytes, py_sz=None):             # <<<<<<<<<<<<<<
+ *     cdef size_t sz
+ *     cdef const char *ptr
+ */
+  __pyx_tuple__7 = PyTuple_Pack(6, __pyx_n_s_key, __pyx_n_s_capsule_or_bytes, __pyx_n_s_py_sz, __pyx_n_s_sz, __pyx_n_s_ptr, __pyx_n_s_ret); if (unlikely(!__pyx_tuple__7)) __PYX_ERR(0, 42, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__7);
+  __Pyx_GIVEREF(__pyx_tuple__7);
+  __pyx_codeobj__8 = (PyObject*)__Pyx_PyCode_New(3, 0, 0, 6, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__7, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_cy_src_skynet_py_main_pyx, __pyx_n_s_setlenv, 42, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__8)) __PYX_ERR(0, 42, __pyx_L1_error)
+  __pyx_tuple__9 = PyTuple_Pack(1, ((PyObject *)Py_None)); if (unlikely(!__pyx_tuple__9)) __PYX_ERR(0, 42, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__9);
+  __Pyx_GIVEREF(__pyx_tuple__9);
+
+  /* "src/cy_src/skynet_py_main.pyx":60
+ * 
+ * 
+ * def getlenv(key):             # <<<<<<<<<<<<<<
+ *     key = __check_bytes(key)
+ *     cdef size_t sz
+ */
+  __pyx_tuple__10 = PyTuple_Pack(3, __pyx_n_s_key, __pyx_n_s_sz, __pyx_n_s_value); if (unlikely(!__pyx_tuple__10)) __PYX_ERR(0, 60, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__10);
   __Pyx_GIVEREF(__pyx_tuple__10);
-  __pyx_codeobj__11 = (PyObject*)__Pyx_PyCode_New(2, 0, 5, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__10, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_cy_src_skynet_py_mq_pyx, __pyx_n_s_tobytes, 87, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__11)) __PYX_ERR(0, 87, __pyx_L1_error)
+  __pyx_codeobj__11 = (PyObject*)__Pyx_PyCode_New(1, 0, 0, 3, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__10, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_cy_src_skynet_py_main_pyx, __pyx_n_s_getlenv, 60, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__11)) __PYX_ERR(0, 60, __pyx_L1_error)
 
-  /* "src/cy_src/skynet_py_mq.pyx":97
- *         raise Exception("capsule unpack failed for name = %s")
+  /* "src/cy_src/skynet_py_main.pyx":69
+ *         raise Exception("getlenv but value not existed")
  * 
- * class PTYPEEnum(object):             # <<<<<<<<<<<<<<
- *     def __init__(self):
- *         self.PTYPE_TEXT=PTYPE_TEXT
+ * def nextenv(key):             # <<<<<<<<<<<<<<
+ *     cdef const char * ptr
+ *     if key is None:
  */
-  __pyx_tuple__12 = PyTuple_Pack(1, __pyx_builtin_object); if (unlikely(!__pyx_tuple__12)) __PYX_ERR(0, 97, __pyx_L1_error)
+  __pyx_tuple__12 = PyTuple_Pack(2, __pyx_n_s_key, __pyx_n_s_ptr); if (unlikely(!__pyx_tuple__12)) __PYX_ERR(0, 69, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__12);
   __Pyx_GIVEREF(__pyx_tuple__12);
+  __pyx_codeobj__13 = (PyObject*)__Pyx_PyCode_New(1, 0, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__12, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_cy_src_skynet_py_main_pyx, __pyx_n_s_nextenv, 69, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__13)) __PYX_ERR(0, 69, __pyx_L1_error)
 
-  /* "src/cy_src/skynet_py_mq.pyx":98
+  /* "src/cy_src/skynet_py_main.pyx":81
+ *         return PyBytes_FromString(ptr)
  * 
- * class PTYPEEnum(object):
- *     def __init__(self):             # <<<<<<<<<<<<<<
- *         self.PTYPE_TEXT=PTYPE_TEXT
- *         self.PTYPE_RESPONSE=PTYPE_RESPONSE
+ * def refscript(script):             # <<<<<<<<<<<<<<
+ *     script = __check_bytes(script)
+ *     index = skynet_py_refscript(script, len(script))
  */
-  __pyx_tuple__13 = PyTuple_Pack(1, __pyx_n_s_self); if (unlikely(!__pyx_tuple__13)) __PYX_ERR(0, 98, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__13);
-  __Pyx_GIVEREF(__pyx_tuple__13);
-  __pyx_codeobj__14 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__13, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_cy_src_skynet_py_mq_pyx, __pyx_n_s_init, 98, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__14)) __PYX_ERR(0, 98, __pyx_L1_error)
+  __pyx_tuple__14 = PyTuple_Pack(2, __pyx_n_s_script, __pyx_n_s_index); if (unlikely(!__pyx_tuple__14)) __PYX_ERR(0, 81, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__14);
+  __Pyx_GIVEREF(__pyx_tuple__14);
+  __pyx_codeobj__15 = (PyObject*)__Pyx_PyCode_New(1, 0, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__14, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_cy_src_skynet_py_main_pyx, __pyx_n_s_refscript, 81, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__15)) __PYX_ERR(0, 81, __pyx_L1_error)
 
-  /* "src/cy_src/skynet_py_mq.pyx":123
+  /* "src/cy_src/skynet_py_main.pyx":86
+ *     return index
  * 
- * for key, id in SKYNET_PTYPE.__dict__.items():
- *     name = key[6:].lower()             # <<<<<<<<<<<<<<
- *     SKYNET_PTYPE_id_to_name[id] = name
- *     SKYNET_PTYPE_name_to_id[name] = id
+ * def getscript(index):             # <<<<<<<<<<<<<<
+ *     cdef size_t sz
+ *     cdef const char * value = skynet_py_getscript(index, &sz)
  */
-  __pyx_slice__15 = PySlice_New(__pyx_int_6, Py_None, Py_None); if (unlikely(!__pyx_slice__15)) __PYX_ERR(0, 123, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_slice__15);
-  __Pyx_GIVEREF(__pyx_slice__15);
+  __pyx_tuple__16 = PyTuple_Pack(3, __pyx_n_s_index, __pyx_n_s_sz, __pyx_n_s_value); if (unlikely(!__pyx_tuple__16)) __PYX_ERR(0, 86, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__16);
+  __Pyx_GIVEREF(__pyx_tuple__16);
+  __pyx_codeobj__17 = (PyObject*)__Pyx_PyCode_New(1, 0, 0, 3, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__16, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_cy_src_skynet_py_main_pyx, __pyx_n_s_getscript, 86, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__17)) __PYX_ERR(0, 86, __pyx_L1_error)
 
-  /* "src/cy_src/skynet_py_mq.pyx":130
+  /* "src/cy_src/skynet_py_main.pyx":94
+ *         return None
  * 
- * SKYNET_PTYPE_user_builtin_ids = [SKYNET_PTYPE.PTYPE_LUA, SKYNET_PTYPE.PTYPE_CLIENT, SKYNET_PTYPE.PTYPE_SOCKET, SKYNET_PTYPE.PTYPE_TEXT, SKYNET_PTYPE.PTYPE_FOREIGN, SKYNET_PTYPE.PTYPE_FOREIGN_REMOTE]
- * def user_assert_id_name(id, name):             # <<<<<<<<<<<<<<
- *     is_builtin = False
- *     if name in SKYNET_PTYPE_name_to_id:
+ * def start(int thread, int profile):             # <<<<<<<<<<<<<<
+ *     cdef skynet_config config;
+ *     config.thread = thread
  */
-  __pyx_tuple__16 = PyTuple_Pack(3, __pyx_n_s_id, __pyx_n_s_name, __pyx_n_s_is_builtin); if (unlikely(!__pyx_tuple__16)) __PYX_ERR(0, 130, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__16);
-  __Pyx_GIVEREF(__pyx_tuple__16);
-  __pyx_codeobj__17 = (PyObject*)__Pyx_PyCode_New(2, 0, 3, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__16, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_cy_src_skynet_py_mq_pyx, __pyx_n_s_user_assert_id_name, 130, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__17)) __PYX_ERR(0, 130, __pyx_L1_error)
+  __pyx_tuple__18 = PyTuple_Pack(3, __pyx_n_s_thread, __pyx_n_s_profile, __pyx_n_s_config); if (unlikely(!__pyx_tuple__18)) __PYX_ERR(0, 94, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__18);
+  __Pyx_GIVEREF(__pyx_tuple__18);
+  __pyx_codeobj__19 = (PyObject*)__Pyx_PyCode_New(2, 0, 0, 3, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__18, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_cy_src_skynet_py_main_pyx, __pyx_n_s_start, 94, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__19)) __PYX_ERR(0, 94, __pyx_L1_error)
+
+  /* "src/cy_src/skynet_py_main.pyx":108
+ *     skynet_py_start(&config)
+ * 
+ * def exit():             # <<<<<<<<<<<<<<
+ *     skynet_py_exit()
+ * 
+ */
+  __pyx_codeobj__20 = (PyObject*)__Pyx_PyCode_New(0, 0, 0, 0, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_cy_src_skynet_py_main_pyx, __pyx_n_s_exit, 108, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__20)) __PYX_ERR(0, 108, __pyx_L1_error)
+
+  /* "src/cy_src/skynet_py_main.pyx":111
+ *     skynet_py_exit()
+ * 
+ * def self():             # <<<<<<<<<<<<<<
+ *     return skynet_py_address()
+ */
+  __pyx_codeobj__21 = (PyObject*)__Pyx_PyCode_New(0, 0, 0, 0, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_cy_src_skynet_py_main_pyx, __pyx_n_s_self, 111, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__21)) __PYX_ERR(0, 111, __pyx_L1_error)
   __Pyx_RefNannyFinishContext();
   return 0;
   __pyx_L1_error:;
   __Pyx_RefNannyFinishContext();
   return -1;
 }
+/* #### Code section: init_constants ### */
 
-static CYTHON_SMALL_CODE int __Pyx_InitGlobals(void) {
-  if (__Pyx_InitStrings(__pyx_string_tab) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
-  __pyx_int_0 = PyInt_FromLong(0); if (unlikely(!__pyx_int_0)) __PYX_ERR(0, 1, __pyx_L1_error)
-  __pyx_int_6 = PyInt_FromLong(6); if (unlikely(!__pyx_int_6)) __PYX_ERR(0, 1, __pyx_L1_error)
-  __pyx_int_12 = PyInt_FromLong(12); if (unlikely(!__pyx_int_12)) __PYX_ERR(0, 1, __pyx_L1_error)
-  __pyx_int_255 = PyInt_FromLong(255); if (unlikely(!__pyx_int_255)) __PYX_ERR(0, 1, __pyx_L1_error)
+static CYTHON_SMALL_CODE int __Pyx_InitConstants(void) {
+  if (__Pyx_CreateStringTabAndInitStrings() < 0) __PYX_ERR(0, 1, __pyx_L1_error);
   return 0;
   __pyx_L1_error:;
   return -1;
 }
+/* #### Code section: init_globals ### */
+
+static CYTHON_SMALL_CODE int __Pyx_InitGlobals(void) {
+  return 0;
+}
+/* #### Code section: init_module ### */
 
 static CYTHON_SMALL_CODE int __Pyx_modinit_global_init_code(void); /*proto*/
 static CYTHON_SMALL_CODE int __Pyx_modinit_variable_export_code(void); /*proto*/
 static CYTHON_SMALL_CODE int __Pyx_modinit_function_export_code(void); /*proto*/
 static CYTHON_SMALL_CODE int __Pyx_modinit_type_init_code(void); /*proto*/
 static CYTHON_SMALL_CODE int __Pyx_modinit_type_import_code(void); /*proto*/
 static CYTHON_SMALL_CODE int __Pyx_modinit_variable_import_code(void); /*proto*/
@@ -3830,22 +4542,23 @@
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__Pyx_modinit_type_import_code", 0);
   /*--- Type import code ---*/
   __pyx_t_1 = PyImport_ImportModule(__Pyx_BUILTIN_MODULE_NAME); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 9, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_ptype_7cpython_4type_type = __Pyx_ImportType(__pyx_t_1, __Pyx_BUILTIN_MODULE_NAME, "type", 
+  __pyx_ptype_7cpython_4type_type = __Pyx_ImportType_3_0_0(__pyx_t_1, __Pyx_BUILTIN_MODULE_NAME, "type", 
   #if defined(PYPY_VERSION_NUM) && PYPY_VERSION_NUM < 0x050B0000
-  sizeof(PyTypeObject),
+  sizeof(PyTypeObject), __PYX_GET_STRUCT_ALIGNMENT_3_0_0(PyTypeObject),
+  #elif CYTHON_COMPILING_IN_LIMITED_API
+  sizeof(PyTypeObject), __PYX_GET_STRUCT_ALIGNMENT_3_0_0(PyTypeObject),
   #else
-  sizeof(PyHeapTypeObject),
+  sizeof(PyHeapTypeObject), __PYX_GET_STRUCT_ALIGNMENT_3_0_0(PyHeapTypeObject),
   #endif
-  __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_7cpython_4type_type) __PYX_ERR(1, 9, __pyx_L1_error)
+  __Pyx_ImportType_CheckSize_Warn_3_0_0); if (!__pyx_ptype_7cpython_4type_type) __PYX_ERR(1, 9, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_RefNannyFinishContext();
   return 0;
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
   __Pyx_RefNannyFinishContext();
   return -1;
@@ -3864,14 +4577,63 @@
   __Pyx_RefNannySetupContext("__Pyx_modinit_function_import_code", 0);
   /*--- Function import code ---*/
   __Pyx_RefNannyFinishContext();
   return 0;
 }
 
 
+#if PY_MAJOR_VERSION >= 3
+#if CYTHON_PEP489_MULTI_PHASE_INIT
+static PyObject* __pyx_pymod_create(PyObject *spec, PyModuleDef *def); /*proto*/
+static int __pyx_pymod_exec_skynet_py_main(PyObject* module); /*proto*/
+static PyModuleDef_Slot __pyx_moduledef_slots[] = {
+  {Py_mod_create, (void*)__pyx_pymod_create},
+  {Py_mod_exec, (void*)__pyx_pymod_exec_skynet_py_main},
+  {0, NULL}
+};
+#endif
+
+#ifdef __cplusplus
+namespace {
+  struct PyModuleDef __pyx_moduledef =
+  #else
+  static struct PyModuleDef __pyx_moduledef =
+  #endif
+  {
+      PyModuleDef_HEAD_INIT,
+      "skynet_py_main",
+      0, /* m_doc */
+    #if CYTHON_PEP489_MULTI_PHASE_INIT
+      0, /* m_size */
+    #elif CYTHON_USE_MODULE_STATE
+      sizeof(__pyx_mstate), /* m_size */
+    #else
+      -1, /* m_size */
+    #endif
+      __pyx_methods /* m_methods */,
+    #if CYTHON_PEP489_MULTI_PHASE_INIT
+      __pyx_moduledef_slots, /* m_slots */
+    #else
+      NULL, /* m_reload */
+    #endif
+    #if CYTHON_USE_MODULE_STATE
+      __pyx_m_traverse, /* m_traverse */
+      __pyx_m_clear, /* m_clear */
+      NULL /* m_free */
+    #else
+      NULL, /* m_traverse */
+      NULL, /* m_clear */
+      NULL /* m_free */
+    #endif
+  };
+  #ifdef __cplusplus
+} /* anonymous namespace */
+#endif
+#endif
+
 #ifndef CYTHON_NO_PYINIT_EXPORT
 #define __Pyx_PyMODINIT_FUNC PyMODINIT_FUNC
 #elif PY_MAJOR_VERSION < 3
 #ifdef __cplusplus
 #define __Pyx_PyMODINIT_FUNC extern "C" void
 #else
 #define __Pyx_PyMODINIT_FUNC void
@@ -3882,19 +4644,19 @@
 #else
 #define __Pyx_PyMODINIT_FUNC PyObject *
 #endif
 #endif
 
 
 #if PY_MAJOR_VERSION < 3
-__Pyx_PyMODINIT_FUNC initskynet_py_mq(void) CYTHON_SMALL_CODE; /*proto*/
-__Pyx_PyMODINIT_FUNC initskynet_py_mq(void)
+__Pyx_PyMODINIT_FUNC initskynet_py_main(void) CYTHON_SMALL_CODE; /*proto*/
+__Pyx_PyMODINIT_FUNC initskynet_py_main(void)
 #else
-__Pyx_PyMODINIT_FUNC PyInit_skynet_py_mq(void) CYTHON_SMALL_CODE; /*proto*/
-__Pyx_PyMODINIT_FUNC PyInit_skynet_py_mq(void)
+__Pyx_PyMODINIT_FUNC PyInit_skynet_py_main(void) CYTHON_SMALL_CODE; /*proto*/
+__Pyx_PyMODINIT_FUNC PyInit_skynet_py_main(void)
 #if CYTHON_PEP489_MULTI_PHASE_INIT
 {
   return PyModuleDef_Init(&__pyx_moduledef);
 }
 static CYTHON_SMALL_CODE int __Pyx_check_single_interpreter(void) {
     #if PY_VERSION_HEX >= 0x030700A1
     static PY_INT64_T main_interpreter_id = -1;
@@ -3914,534 +4676,373 @@
         PyErr_SetString(
             PyExc_ImportError,
             "Interpreter change detected - this module can only be loaded into one interpreter per process.");
         return -1;
     }
     return 0;
 }
-static CYTHON_SMALL_CODE int __Pyx_copy_spec_to_module(PyObject *spec, PyObject *moddict, const char* from_name, const char* to_name, int allow_none) {
+#if CYTHON_COMPILING_IN_LIMITED_API
+static CYTHON_SMALL_CODE int __Pyx_copy_spec_to_module(PyObject *spec, PyObject *module, const char* from_name, const char* to_name, int allow_none)
+#else
+static CYTHON_SMALL_CODE int __Pyx_copy_spec_to_module(PyObject *spec, PyObject *moddict, const char* from_name, const char* to_name, int allow_none)
+#endif
+{
     PyObject *value = PyObject_GetAttrString(spec, from_name);
     int result = 0;
     if (likely(value)) {
         if (allow_none || value != Py_None) {
+#if CYTHON_COMPILING_IN_LIMITED_API
+            result = PyModule_AddObject(module, to_name, value);
+#else
             result = PyDict_SetItemString(moddict, to_name, value);
+#endif
         }
         Py_DECREF(value);
     } else if (PyErr_ExceptionMatches(PyExc_AttributeError)) {
         PyErr_Clear();
     } else {
         result = -1;
     }
     return result;
 }
-static CYTHON_SMALL_CODE PyObject* __pyx_pymod_create(PyObject *spec, CYTHON_UNUSED PyModuleDef *def) {
+static CYTHON_SMALL_CODE PyObject* __pyx_pymod_create(PyObject *spec, PyModuleDef *def) {
     PyObject *module = NULL, *moddict, *modname;
+    CYTHON_UNUSED_VAR(def);
     if (__Pyx_check_single_interpreter())
         return NULL;
     if (__pyx_m)
         return __Pyx_NewRef(__pyx_m);
     modname = PyObject_GetAttrString(spec, "name");
     if (unlikely(!modname)) goto bad;
     module = PyModule_NewObject(modname);
     Py_DECREF(modname);
     if (unlikely(!module)) goto bad;
+#if CYTHON_COMPILING_IN_LIMITED_API
+    moddict = module;
+#else
     moddict = PyModule_GetDict(module);
     if (unlikely(!moddict)) goto bad;
+#endif
     if (unlikely(__Pyx_copy_spec_to_module(spec, moddict, "loader", "__loader__", 1) < 0)) goto bad;
     if (unlikely(__Pyx_copy_spec_to_module(spec, moddict, "origin", "__file__", 1) < 0)) goto bad;
     if (unlikely(__Pyx_copy_spec_to_module(spec, moddict, "parent", "__package__", 1) < 0)) goto bad;
     if (unlikely(__Pyx_copy_spec_to_module(spec, moddict, "submodule_search_locations", "__path__", 0) < 0)) goto bad;
     return module;
 bad:
     Py_XDECREF(module);
     return NULL;
 }
 
 
-static CYTHON_SMALL_CODE int __pyx_pymod_exec_skynet_py_mq(PyObject *__pyx_pyinit_module)
+static CYTHON_SMALL_CODE int __pyx_pymod_exec_skynet_py_main(PyObject *__pyx_pyinit_module)
 #endif
 #endif
 {
+  int stringtab_initialized = 0;
+  #if CYTHON_USE_MODULE_STATE
+  int pystate_addmodule_run = 0;
+  #endif
   PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
-  PyObject *__pyx_t_3 = NULL;
-  Py_ssize_t __pyx_t_4;
-  Py_ssize_t __pyx_t_5;
-  int __pyx_t_6;
-  int __pyx_t_7;
-  PyObject *__pyx_t_8 = NULL;
-  PyObject *__pyx_t_9 = NULL;
-  PyObject *__pyx_t_10 = NULL;
-  PyObject *__pyx_t_11 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannyDeclarations
   #if CYTHON_PEP489_MULTI_PHASE_INIT
   if (__pyx_m) {
     if (__pyx_m == __pyx_pyinit_module) return 0;
-    PyErr_SetString(PyExc_RuntimeError, "Module 'skynet_py_mq' has already been imported. Re-initialisation is not supported.");
+    PyErr_SetString(PyExc_RuntimeError, "Module 'skynet_py_main' has already been imported. Re-initialisation is not supported.");
     return -1;
   }
   #elif PY_MAJOR_VERSION >= 3
   if (__pyx_m) return __Pyx_NewRef(__pyx_m);
   #endif
+  /*--- Module creation code ---*/
+  #if CYTHON_PEP489_MULTI_PHASE_INIT
+  __pyx_m = __pyx_pyinit_module;
+  Py_INCREF(__pyx_m);
+  #else
+  #if PY_MAJOR_VERSION < 3
+  __pyx_m = Py_InitModule4("skynet_py_main", __pyx_methods, 0, 0, PYTHON_API_VERSION); Py_XINCREF(__pyx_m);
+  if (unlikely(!__pyx_m)) __PYX_ERR(0, 1, __pyx_L1_error)
+  #elif CYTHON_USE_MODULE_STATE
+  __pyx_t_1 = PyModule_Create(&__pyx_moduledef); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1, __pyx_L1_error)
+  {
+    int add_module_result = PyState_AddModule(__pyx_t_1, &__pyx_moduledef);
+    __pyx_t_1 = 0; /* transfer ownership from __pyx_t_1 to skynet_py_main pseudovariable */
+    if (unlikely((add_module_result < 0))) __PYX_ERR(0, 1, __pyx_L1_error)
+    pystate_addmodule_run = 1;
+  }
+  #else
+  __pyx_m = PyModule_Create(&__pyx_moduledef);
+  if (unlikely(!__pyx_m)) __PYX_ERR(0, 1, __pyx_L1_error)
+  #endif
+  #endif
+  CYTHON_UNUSED_VAR(__pyx_t_1);
+  __pyx_d = PyModule_GetDict(__pyx_m); if (unlikely(!__pyx_d)) __PYX_ERR(0, 1, __pyx_L1_error)
+  Py_INCREF(__pyx_d);
+  __pyx_b = PyImport_AddModule(__Pyx_BUILTIN_MODULE_NAME); if (unlikely(!__pyx_b)) __PYX_ERR(0, 1, __pyx_L1_error)
+  Py_INCREF(__pyx_b);
+  __pyx_cython_runtime = PyImport_AddModule((char *) "cython_runtime"); if (unlikely(!__pyx_cython_runtime)) __PYX_ERR(0, 1, __pyx_L1_error)
+  Py_INCREF(__pyx_cython_runtime);
+  if (PyObject_SetAttrString(__pyx_m, "__builtins__", __pyx_b) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   #if CYTHON_REFNANNY
 __Pyx_RefNanny = __Pyx_RefNannyImportAPI("refnanny");
 if (!__Pyx_RefNanny) {
   PyErr_Clear();
   __Pyx_RefNanny = __Pyx_RefNannyImportAPI("Cython.Runtime.refnanny");
   if (!__Pyx_RefNanny)
       Py_FatalError("failed to import 'refnanny' module");
 }
 #endif
-  __Pyx_RefNannySetupContext("__Pyx_PyMODINIT_FUNC PyInit_skynet_py_mq(void)", 0);
+  __Pyx_RefNannySetupContext("__Pyx_PyMODINIT_FUNC PyInit_skynet_py_main(void)", 0);
   if (__Pyx_check_binary_version() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   #ifdef __Pxy_PyFrame_Initialize_Offsets
   __Pxy_PyFrame_Initialize_Offsets();
   #endif
   __pyx_empty_tuple = PyTuple_New(0); if (unlikely(!__pyx_empty_tuple)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_empty_bytes = PyBytes_FromStringAndSize("", 0); if (unlikely(!__pyx_empty_bytes)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_empty_unicode = PyUnicode_FromStringAndSize("", 0); if (unlikely(!__pyx_empty_unicode)) __PYX_ERR(0, 1, __pyx_L1_error)
   #ifdef __Pyx_CyFunction_USED
-  if (__pyx_CyFunction_init() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
+  if (__pyx_CyFunction_init(__pyx_m) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   #endif
   #ifdef __Pyx_FusedFunction_USED
-  if (__pyx_FusedFunction_init() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
+  if (__pyx_FusedFunction_init(__pyx_m) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   #endif
   #ifdef __Pyx_Coroutine_USED
-  if (__pyx_Coroutine_init() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
+  if (__pyx_Coroutine_init(__pyx_m) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   #endif
   #ifdef __Pyx_Generator_USED
-  if (__pyx_Generator_init() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
+  if (__pyx_Generator_init(__pyx_m) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   #endif
   #ifdef __Pyx_AsyncGen_USED
-  if (__pyx_AsyncGen_init() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
+  if (__pyx_AsyncGen_init(__pyx_m) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   #endif
   #ifdef __Pyx_StopAsyncIteration_USED
-  if (__pyx_StopAsyncIteration_init() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
+  if (__pyx_StopAsyncIteration_init(__pyx_m) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   #endif
   /*--- Library function declarations ---*/
   /*--- Threads initialization code ---*/
-  #if defined(__PYX_FORCE_INIT_THREADS) && __PYX_FORCE_INIT_THREADS
-  #ifdef WITH_THREAD /* Python build with threading support? */
+  #if defined(WITH_THREAD) && PY_VERSION_HEX < 0x030700F0 && defined(__PYX_FORCE_INIT_THREADS) && __PYX_FORCE_INIT_THREADS
   PyEval_InitThreads();
   #endif
-  #endif
-  /*--- Module creation code ---*/
-  #if CYTHON_PEP489_MULTI_PHASE_INIT
-  __pyx_m = __pyx_pyinit_module;
-  Py_INCREF(__pyx_m);
-  #else
-  #if PY_MAJOR_VERSION < 3
-  __pyx_m = Py_InitModule4("skynet_py_mq", __pyx_methods, 0, 0, PYTHON_API_VERSION); Py_XINCREF(__pyx_m);
-  #else
-  __pyx_m = PyModule_Create(&__pyx_moduledef);
-  #endif
-  if (unlikely(!__pyx_m)) __PYX_ERR(0, 1, __pyx_L1_error)
-  #endif
-  __pyx_d = PyModule_GetDict(__pyx_m); if (unlikely(!__pyx_d)) __PYX_ERR(0, 1, __pyx_L1_error)
-  Py_INCREF(__pyx_d);
-  __pyx_b = PyImport_AddModule(__Pyx_BUILTIN_MODULE_NAME); if (unlikely(!__pyx_b)) __PYX_ERR(0, 1, __pyx_L1_error)
-  Py_INCREF(__pyx_b);
-  __pyx_cython_runtime = PyImport_AddModule((char *) "cython_runtime"); if (unlikely(!__pyx_cython_runtime)) __PYX_ERR(0, 1, __pyx_L1_error)
-  Py_INCREF(__pyx_cython_runtime);
-  if (PyObject_SetAttrString(__pyx_m, "__builtins__", __pyx_b) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
   /*--- Initialize various global constants etc. ---*/
+  if (__Pyx_InitConstants() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
+  stringtab_initialized = 1;
   if (__Pyx_InitGlobals() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   #if PY_MAJOR_VERSION < 3 && (__PYX_DEFAULT_STRING_ENCODING_IS_ASCII || __PYX_DEFAULT_STRING_ENCODING_IS_DEFAULT)
   if (__Pyx_init_sys_getdefaultencoding_params() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   #endif
-  if (__pyx_module_is_main_pyskynet__skynet_py_mq) {
-    if (PyObject_SetAttr(__pyx_m, __pyx_n_s_name_2, __pyx_n_s_main) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
+  if (__pyx_module_is_main_pyskynet__skynet_py_main) {
+    if (PyObject_SetAttr(__pyx_m, __pyx_n_s_name, __pyx_n_s_main) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   }
   #if PY_MAJOR_VERSION >= 3
   {
     PyObject *modules = PyImport_GetModuleDict(); if (unlikely(!modules)) __PYX_ERR(0, 1, __pyx_L1_error)
-    if (!PyDict_GetItemString(modules, "pyskynet.skynet_py_mq")) {
-      if (unlikely(PyDict_SetItemString(modules, "pyskynet.skynet_py_mq", __pyx_m) < 0)) __PYX_ERR(0, 1, __pyx_L1_error)
+    if (!PyDict_GetItemString(modules, "pyskynet.skynet_py_main")) {
+      if (unlikely((PyDict_SetItemString(modules, "pyskynet.skynet_py_main", __pyx_m) < 0))) __PYX_ERR(0, 1, __pyx_L1_error)
     }
   }
   #endif
   /*--- Builtin init code ---*/
   if (__Pyx_InitCachedBuiltins() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   /*--- Constants init code ---*/
   if (__Pyx_InitCachedConstants() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   /*--- Global type/function init code ---*/
   (void)__Pyx_modinit_global_init_code();
   (void)__Pyx_modinit_variable_export_code();
   (void)__Pyx_modinit_function_export_code();
   (void)__Pyx_modinit_type_init_code();
-  if (unlikely(__Pyx_modinit_type_import_code() < 0)) __PYX_ERR(0, 1, __pyx_L1_error)
+  if (unlikely((__Pyx_modinit_type_import_code() < 0))) __PYX_ERR(0, 1, __pyx_L1_error)
   (void)__Pyx_modinit_variable_import_code();
   (void)__Pyx_modinit_function_import_code();
   /*--- Execution code ---*/
   #if defined(__Pyx_Generator_USED) || defined(__Pyx_Coroutine_USED)
   if (__Pyx_patch_abc() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   #endif
 
-  /* "src/cy_src/skynet_py_mq.pyx":17
- *     skynet_free(ptr)
- * 
- * def crecv():             # <<<<<<<<<<<<<<
- *     cdef SkynetPyMessage msg
- *     cdef int ret = skynet_py_queue_pop(&msg)
- */
-  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_8pyskynet_12skynet_py_mq_1crecv, NULL, __pyx_n_s_pyskynet_skynet_py_mq); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 17, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_crecv, __pyx_t_1) < 0) __PYX_ERR(0, 17, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-
-  /* "src/cy_src/skynet_py_mq.pyx":33
+  /* "src/cy_src/skynet_py_main.pyx":4
+ * # cython: legacy_implicit_noexcept=True
  * 
- * # see lsend in lua-skynet.c
- * def csend(py_dst, int type_id, py_session, py_msg, py_size=None):             # <<<<<<<<<<<<<<
- *     assert skynet_py_address() > 0, "skynet threads has not been started yet, call 'pyskynet.start()' first."
- *     # 1. check dst
+ * import _cffi_backend             # <<<<<<<<<<<<<<
+ * from cpython.pycapsule cimport PyCapsule_GetPointer, PyCapsule_New, PyCapsule_CheckExact
+ * from cpython.bytes cimport PyBytes_FromString, PyBytes_FromStringAndSize, PyBytes_CheckExact
  */
-  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_8pyskynet_12skynet_py_mq_3csend, NULL, __pyx_n_s_pyskynet_skynet_py_mq); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 33, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_csend, __pyx_t_1) < 0) __PYX_ERR(0, 33, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-
-  /* "src/cy_src/skynet_py_mq.pyx":82
- * 
- * # extern
- * def tostring(capsule, size_t size):             # <<<<<<<<<<<<<<
- *     b = tobytes(capsule, size)
- *     return b.decode()
- */
-  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_8pyskynet_12skynet_py_mq_5tostring, NULL, __pyx_n_s_pyskynet_skynet_py_mq); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 82, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_tostring, __pyx_t_1) < 0) __PYX_ERR(0, 82, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-
-  /* "src/cy_src/skynet_py_mq.pyx":87
- * 
- * # extern
- * def tobytes(capsule, size_t size):             # <<<<<<<<<<<<<<
- *     cdef char *name = PyCapsule_GetName(capsule)
- *     cdef char *ptr = <char *>PyCapsule_GetPointer(capsule, name)
- */
-  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_8pyskynet_12skynet_py_mq_7tobytes, NULL, __pyx_n_s_pyskynet_skynet_py_mq); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 87, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_tobytes, __pyx_t_1) < 0) __PYX_ERR(0, 87, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_2 = __Pyx_ImportDottedModule(__pyx_n_s_cffi_backend, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 4, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_cffi_backend, __pyx_t_2) < 0) __PYX_ERR(0, 4, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "src/cy_src/skynet_py_mq.pyx":97
- *         raise Exception("capsule unpack failed for name = %s")
+  /* "src/cy_src/skynet_py_main.pyx":23
+ * ctypedef (char *)(* f_type)(object, object)
  * 
- * class PTYPEEnum(object):             # <<<<<<<<<<<<<<
- *     def __init__(self):
- *         self.PTYPE_TEXT=PTYPE_TEXT
+ * def init(ffi, async_send, async_handle):             # <<<<<<<<<<<<<<
+ *     # because gevent's libuv bind with cffi, so we can get pointer by this way
+ *     cdef void ** _cffi_exports = <void **>PyCapsule_GetPointer(_cffi_backend._C_API, "cffi")
  */
-  __pyx_t_1 = __Pyx_CalculateMetaclass(NULL, __pyx_tuple__12); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 97, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_Py3MetaclassPrepare(__pyx_t_1, __pyx_tuple__12, __pyx_n_s_PTYPEEnum, __pyx_n_s_PTYPEEnum, (PyObject *) NULL, __pyx_n_s_pyskynet_skynet_py_mq, (PyObject *) NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 97, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_8pyskynet_14skynet_py_main_1init, 0, __pyx_n_s_init, NULL, __pyx_n_s_pyskynet_skynet_py_main, __pyx_d, ((PyObject *)__pyx_codeobj__6)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 23, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-
-  /* "src/cy_src/skynet_py_mq.pyx":98
- * 
- * class PTYPEEnum(object):
- *     def __init__(self):             # <<<<<<<<<<<<<<
- *         self.PTYPE_TEXT=PTYPE_TEXT
- *         self.PTYPE_RESPONSE=PTYPE_RESPONSE
- */
-  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_8pyskynet_12skynet_py_mq_9PTYPEEnum_1__init__, 0, __pyx_n_s_PTYPEEnum___init, NULL, __pyx_n_s_pyskynet_skynet_py_mq, __pyx_d, ((PyObject *)__pyx_codeobj__14)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 98, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_3);
-  if (__Pyx_SetNameInClass(__pyx_t_2, __pyx_n_s_init, __pyx_t_3) < 0) __PYX_ERR(0, 98, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-
-  /* "src/cy_src/skynet_py_mq.pyx":97
- *         raise Exception("capsule unpack failed for name = %s")
- * 
- * class PTYPEEnum(object):             # <<<<<<<<<<<<<<
- *     def __init__(self):
- *         self.PTYPE_TEXT=PTYPE_TEXT
- */
-  __pyx_t_3 = __Pyx_Py3ClassCreate(__pyx_t_1, __pyx_n_s_PTYPEEnum, __pyx_tuple__12, __pyx_t_2, NULL, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 97, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_3);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_PTYPEEnum, __pyx_t_3) < 0) __PYX_ERR(0, 97, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_init, __pyx_t_2) < 0) __PYX_ERR(0, 23, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "src/cy_src/skynet_py_mq.pyx":118
+  /* "src/cy_src/skynet_py_main.pyx":42
+ *         raise Exception("type %s can't convert to bytes" % str(t))
  * 
- * 
- * SKYNET_PTYPE_id_to_name = {}             # <<<<<<<<<<<<<<
- * SKYNET_PTYPE_name_to_id = {}
- * SKYNET_PTYPE = PTYPEEnum()
+ * def setlenv(key, capsule_or_bytes, py_sz=None):             # <<<<<<<<<<<<<<
+ *     cdef size_t sz
+ *     cdef const char *ptr
  */
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 118, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_SKYNET_PTYPE_id_to_name, __pyx_t_1) < 0) __PYX_ERR(0, 118, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_8pyskynet_14skynet_py_main_3setlenv, 0, __pyx_n_s_setlenv, NULL, __pyx_n_s_pyskynet_skynet_py_main, __pyx_d, ((PyObject *)__pyx_codeobj__8)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 42, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_tuple__9);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_setlenv, __pyx_t_2) < 0) __PYX_ERR(0, 42, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "src/cy_src/skynet_py_mq.pyx":119
- * 
- * SKYNET_PTYPE_id_to_name = {}
- * SKYNET_PTYPE_name_to_id = {}             # <<<<<<<<<<<<<<
- * SKYNET_PTYPE = PTYPEEnum()
+  /* "src/cy_src/skynet_py_main.pyx":60
  * 
- */
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 119, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_SKYNET_PTYPE_name_to_id, __pyx_t_1) < 0) __PYX_ERR(0, 119, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-
-  /* "src/cy_src/skynet_py_mq.pyx":120
- * SKYNET_PTYPE_id_to_name = {}
- * SKYNET_PTYPE_name_to_id = {}
- * SKYNET_PTYPE = PTYPEEnum()             # <<<<<<<<<<<<<<
  * 
- * for key, id in SKYNET_PTYPE.__dict__.items():
+ * def getlenv(key):             # <<<<<<<<<<<<<<
+ *     key = __check_bytes(key)
+ *     cdef size_t sz
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_PTYPEEnum); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 120, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_CallNoArg(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 120, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_8pyskynet_14skynet_py_main_5getlenv, 0, __pyx_n_s_getlenv, NULL, __pyx_n_s_pyskynet_skynet_py_main, __pyx_d, ((PyObject *)__pyx_codeobj__11)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 60, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_SKYNET_PTYPE, __pyx_t_2) < 0) __PYX_ERR(0, 120, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_getlenv, __pyx_t_2) < 0) __PYX_ERR(0, 60, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "src/cy_src/skynet_py_mq.pyx":122
- * SKYNET_PTYPE = PTYPEEnum()
+  /* "src/cy_src/skynet_py_main.pyx":69
+ *         raise Exception("getlenv but value not existed")
  * 
- * for key, id in SKYNET_PTYPE.__dict__.items():             # <<<<<<<<<<<<<<
- *     name = key[6:].lower()
- *     SKYNET_PTYPE_id_to_name[id] = name
+ * def nextenv(key):             # <<<<<<<<<<<<<<
+ *     cdef const char * ptr
+ *     if key is None:
  */
-  __pyx_t_4 = 0;
-  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_SKYNET_PTYPE); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 122, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_dict); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 122, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  if (unlikely(__pyx_t_3 == Py_None)) {
-    PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "items");
-    __PYX_ERR(0, 122, __pyx_L1_error)
-  }
-  __pyx_t_1 = __Pyx_dict_iterator(__pyx_t_3, 0, __pyx_n_s_items, (&__pyx_t_5), (&__pyx_t_6)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 122, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __Pyx_XDECREF(__pyx_t_2);
-  __pyx_t_2 = __pyx_t_1;
-  __pyx_t_1 = 0;
-  while (1) {
-    __pyx_t_7 = __Pyx_dict_iter_next(__pyx_t_2, __pyx_t_5, &__pyx_t_4, &__pyx_t_1, &__pyx_t_3, NULL, __pyx_t_6);
-    if (unlikely(__pyx_t_7 == 0)) break;
-    if (unlikely(__pyx_t_7 == -1)) __PYX_ERR(0, 122, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_1);
-    __Pyx_GOTREF(__pyx_t_3);
-    if (PyDict_SetItem(__pyx_d, __pyx_n_s_key, __pyx_t_1) < 0) __PYX_ERR(0, 122, __pyx_L1_error)
-    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    if (PyDict_SetItem(__pyx_d, __pyx_n_s_id, __pyx_t_3) < 0) __PYX_ERR(0, 122, __pyx_L1_error)
-    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_8pyskynet_14skynet_py_main_7nextenv, 0, __pyx_n_s_nextenv, NULL, __pyx_n_s_pyskynet_skynet_py_main, __pyx_d, ((PyObject *)__pyx_codeobj__13)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 69, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_nextenv, __pyx_t_2) < 0) __PYX_ERR(0, 69, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-    /* "src/cy_src/skynet_py_mq.pyx":123
+  /* "src/cy_src/skynet_py_main.pyx":81
+ *         return PyBytes_FromString(ptr)
  * 
- * for key, id in SKYNET_PTYPE.__dict__.items():
- *     name = key[6:].lower()             # <<<<<<<<<<<<<<
- *     SKYNET_PTYPE_id_to_name[id] = name
- *     SKYNET_PTYPE_name_to_id[name] = id
+ * def refscript(script):             # <<<<<<<<<<<<<<
+ *     script = __check_bytes(script)
+ *     index = skynet_py_refscript(script, len(script))
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_key); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 123, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_8 = __Pyx_PyObject_GetSlice(__pyx_t_1, 6, 0, NULL, NULL, &__pyx_slice__15, 1, 0, 1); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 123, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_8);
-    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_8, __pyx_n_s_lower); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 123, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_1);
-    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-    __pyx_t_8 = NULL;
-    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_1))) {
-      __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_1);
-      if (likely(__pyx_t_8)) {
-        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_1);
-        __Pyx_INCREF(__pyx_t_8);
-        __Pyx_INCREF(function);
-        __Pyx_DECREF_SET(__pyx_t_1, function);
-      }
-    }
-    __pyx_t_3 = (__pyx_t_8) ? __Pyx_PyObject_CallOneArg(__pyx_t_1, __pyx_t_8) : __Pyx_PyObject_CallNoArg(__pyx_t_1);
-    __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
-    if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 123, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_3);
-    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    if (PyDict_SetItem(__pyx_d, __pyx_n_s_name, __pyx_t_3) < 0) __PYX_ERR(0, 123, __pyx_L1_error)
-    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-
-    /* "src/cy_src/skynet_py_mq.pyx":124
- * for key, id in SKYNET_PTYPE.__dict__.items():
- *     name = key[6:].lower()
- *     SKYNET_PTYPE_id_to_name[id] = name             # <<<<<<<<<<<<<<
- *     SKYNET_PTYPE_name_to_id[name] = id
- *     locals()[key] = id
- */
-    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_name); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 124, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_3);
-    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_SKYNET_PTYPE_id_to_name); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 124, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_1);
-    __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_id); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 124, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_8);
-    if (unlikely(PyObject_SetItem(__pyx_t_1, __pyx_t_8, __pyx_t_3) < 0)) __PYX_ERR(0, 124, __pyx_L1_error)
-    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_8pyskynet_14skynet_py_main_9refscript, 0, __pyx_n_s_refscript, NULL, __pyx_n_s_pyskynet_skynet_py_main, __pyx_d, ((PyObject *)__pyx_codeobj__15)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 81, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_refscript, __pyx_t_2) < 0) __PYX_ERR(0, 81, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-    /* "src/cy_src/skynet_py_mq.pyx":125
- *     name = key[6:].lower()
- *     SKYNET_PTYPE_id_to_name[id] = name
- *     SKYNET_PTYPE_name_to_id[name] = id             # <<<<<<<<<<<<<<
- *     locals()[key] = id
+  /* "src/cy_src/skynet_py_main.pyx":86
+ *     return index
  * 
+ * def getscript(index):             # <<<<<<<<<<<<<<
+ *     cdef size_t sz
+ *     cdef const char * value = skynet_py_getscript(index, &sz)
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_id); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 125, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_3);
-    __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_SKYNET_PTYPE_name_to_id); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 125, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_8);
-    __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_name); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 125, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_1);
-    if (unlikely(PyObject_SetItem(__pyx_t_8, __pyx_t_1, __pyx_t_3) < 0)) __PYX_ERR(0, 125, __pyx_L1_error)
-    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_8pyskynet_14skynet_py_main_11getscript, 0, __pyx_n_s_getscript, NULL, __pyx_n_s_pyskynet_skynet_py_main, __pyx_d, ((PyObject *)__pyx_codeobj__17)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 86, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_getscript, __pyx_t_2) < 0) __PYX_ERR(0, 86, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-    /* "src/cy_src/skynet_py_mq.pyx":126
- *     SKYNET_PTYPE_id_to_name[id] = name
- *     SKYNET_PTYPE_name_to_id[name] = id
- *     locals()[key] = id             # <<<<<<<<<<<<<<
- * 
+  /* "src/cy_src/skynet_py_main.pyx":94
+ *         return None
  * 
+ * def start(int thread, int profile):             # <<<<<<<<<<<<<<
+ *     cdef skynet_config config;
+ *     config.thread = thread
  */
-    __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_id); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 126, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_1 = __Pyx_Globals(); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 126, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_1);
-    __Pyx_GetModuleGlobalName(__pyx_t_8, __pyx_n_s_key); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 126, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_8);
-    if (unlikely(PyDict_SetItem(__pyx_t_1, __pyx_t_8, __pyx_t_3) < 0)) __PYX_ERR(0, 126, __pyx_L1_error)
-    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  }
+  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_8pyskynet_14skynet_py_main_13start, 0, __pyx_n_s_start, NULL, __pyx_n_s_pyskynet_skynet_py_main, __pyx_d, ((PyObject *)__pyx_codeobj__19)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 94, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_start, __pyx_t_2) < 0) __PYX_ERR(0, 94, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "src/cy_src/skynet_py_mq.pyx":129
+  /* "src/cy_src/skynet_py_main.pyx":108
+ *     skynet_py_start(&config)
  * 
+ * def exit():             # <<<<<<<<<<<<<<
+ *     skynet_py_exit()
  * 
- * SKYNET_PTYPE_user_builtin_ids = [SKYNET_PTYPE.PTYPE_LUA, SKYNET_PTYPE.PTYPE_CLIENT, SKYNET_PTYPE.PTYPE_SOCKET, SKYNET_PTYPE.PTYPE_TEXT, SKYNET_PTYPE.PTYPE_FOREIGN, SKYNET_PTYPE.PTYPE_FOREIGN_REMOTE]             # <<<<<<<<<<<<<<
- * def user_assert_id_name(id, name):
- *     is_builtin = False
  */
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_SKYNET_PTYPE); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 129, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_PTYPE_LUA); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 129, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_SKYNET_PTYPE); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 129, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_PTYPE_CLIENT); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 129, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_8);
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_SKYNET_PTYPE); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 129, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_PTYPE_SOCKET); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 129, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_SKYNET_PTYPE); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 129, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_9 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_PTYPE_TEXT); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 129, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_9);
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_SKYNET_PTYPE); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 129, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_8pyskynet_14skynet_py_main_15exit, 0, __pyx_n_s_exit, NULL, __pyx_n_s_pyskynet_skynet_py_main, __pyx_d, ((PyObject *)__pyx_codeobj__20)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 108, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_PTYPE_FOREIGN); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 129, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_10);
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_SKYNET_PTYPE); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 129, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_PTYPE_FOREIGN_REMOTE); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 129, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_11);
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = PyList_New(6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 129, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_GIVEREF(__pyx_t_3);
-  PyList_SET_ITEM(__pyx_t_2, 0, __pyx_t_3);
-  __Pyx_GIVEREF(__pyx_t_8);
-  PyList_SET_ITEM(__pyx_t_2, 1, __pyx_t_8);
-  __Pyx_GIVEREF(__pyx_t_1);
-  PyList_SET_ITEM(__pyx_t_2, 2, __pyx_t_1);
-  __Pyx_GIVEREF(__pyx_t_9);
-  PyList_SET_ITEM(__pyx_t_2, 3, __pyx_t_9);
-  __Pyx_GIVEREF(__pyx_t_10);
-  PyList_SET_ITEM(__pyx_t_2, 4, __pyx_t_10);
-  __Pyx_GIVEREF(__pyx_t_11);
-  PyList_SET_ITEM(__pyx_t_2, 5, __pyx_t_11);
-  __pyx_t_3 = 0;
-  __pyx_t_8 = 0;
-  __pyx_t_1 = 0;
-  __pyx_t_9 = 0;
-  __pyx_t_10 = 0;
-  __pyx_t_11 = 0;
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_SKYNET_PTYPE_user_builtin_ids, __pyx_t_2) < 0) __PYX_ERR(0, 129, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_exit, __pyx_t_2) < 0) __PYX_ERR(0, 108, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "src/cy_src/skynet_py_mq.pyx":130
+  /* "src/cy_src/skynet_py_main.pyx":111
+ *     skynet_py_exit()
  * 
- * SKYNET_PTYPE_user_builtin_ids = [SKYNET_PTYPE.PTYPE_LUA, SKYNET_PTYPE.PTYPE_CLIENT, SKYNET_PTYPE.PTYPE_SOCKET, SKYNET_PTYPE.PTYPE_TEXT, SKYNET_PTYPE.PTYPE_FOREIGN, SKYNET_PTYPE.PTYPE_FOREIGN_REMOTE]
- * def user_assert_id_name(id, name):             # <<<<<<<<<<<<<<
- *     is_builtin = False
- *     if name in SKYNET_PTYPE_name_to_id:
+ * def self():             # <<<<<<<<<<<<<<
+ *     return skynet_py_address()
  */
-  __pyx_t_2 = PyCFunction_NewEx(&__pyx_mdef_8pyskynet_12skynet_py_mq_9user_assert_id_name, NULL, __pyx_n_s_pyskynet_skynet_py_mq); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 130, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_8pyskynet_14skynet_py_main_17self, 0, __pyx_n_s_self, NULL, __pyx_n_s_pyskynet_skynet_py_main, __pyx_d, ((PyObject *)__pyx_codeobj__21)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 111, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_user_assert_id_name, __pyx_t_2) < 0) __PYX_ERR(0, 130, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_self, __pyx_t_2) < 0) __PYX_ERR(0, 111, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "src/cy_src/skynet_py_mq.pyx":1
+  /* "src/cy_src/skynet_py_main.pyx":1
  * # cython: language_level=3             # <<<<<<<<<<<<<<
+ * # cython: legacy_implicit_noexcept=True
  * 
- * from cpython.pycapsule cimport PyCapsule_New, PyCapsule_GetPointer, PyCapsule_SetPointer, PyCapsule_GetName
  */
   __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   if (PyDict_SetItem(__pyx_d, __pyx_n_s_test, __pyx_t_2) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
   /*--- Wrapped vars code ---*/
 
   goto __pyx_L0;
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_2);
-  __Pyx_XDECREF(__pyx_t_3);
-  __Pyx_XDECREF(__pyx_t_8);
-  __Pyx_XDECREF(__pyx_t_9);
-  __Pyx_XDECREF(__pyx_t_10);
-  __Pyx_XDECREF(__pyx_t_11);
   if (__pyx_m) {
-    if (__pyx_d) {
-      __Pyx_AddTraceback("init pyskynet.skynet_py_mq", __pyx_clineno, __pyx_lineno, __pyx_filename);
+    if (__pyx_d && stringtab_initialized) {
+      __Pyx_AddTraceback("init pyskynet.skynet_py_main", __pyx_clineno, __pyx_lineno, __pyx_filename);
     }
+    #if !CYTHON_USE_MODULE_STATE
     Py_CLEAR(__pyx_m);
+    #else
+    Py_DECREF(__pyx_m);
+    if (pystate_addmodule_run) {
+      PyObject *tp, *value, *tb;
+      PyErr_Fetch(&tp, &value, &tb);
+      PyState_RemoveModule(&__pyx_moduledef);
+      PyErr_Restore(tp, value, tb);
+    }
+    #endif
   } else if (!PyErr_Occurred()) {
-    PyErr_SetString(PyExc_ImportError, "init pyskynet.skynet_py_mq");
+    PyErr_SetString(PyExc_ImportError, "init pyskynet.skynet_py_main");
   }
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   #if CYTHON_PEP489_MULTI_PHASE_INIT
   return (__pyx_m != NULL) ? 0 : -1;
   #elif PY_MAJOR_VERSION >= 3
   return __pyx_m;
   #else
   return;
   #endif
 }
+/* #### Code section: cleanup_globals ### */
+/* #### Code section: cleanup_module ### */
+/* #### Code section: main_method ### */
+/* #### Code section: utility_code_pragmas ### */
+#ifdef _MSC_VER
+#pragma warning( push )
+/* Warning 4127: conditional expression is constant
+ * Cython uses constant conditional expressions to allow in inline functions to be optimized at
+ * compile-time, so this warning is not useful
+ */
+#pragma warning( disable : 4127 )
+#endif
+
+
+
+/* #### Code section: utility_code_def ### */
 
 /* --- Runtime support code --- */
 /* Refnanny */
 #if CYTHON_REFNANNY
 static __Pyx_RefNannyAPIStruct *__Pyx_RefNannyImportAPI(const char *modname) {
     PyObject *m = NULL, *p = NULL;
     void *r = NULL;
@@ -4453,108 +5054,221 @@
 end:
     Py_XDECREF(p);
     Py_XDECREF(m);
     return (__Pyx_RefNannyAPIStruct *)r;
 }
 #endif
 
-/* PyObjectGetAttrStr */
-#if CYTHON_USE_TYPE_SLOTS
-static CYTHON_INLINE PyObject* __Pyx_PyObject_GetAttrStr(PyObject* obj, PyObject* attr_name) {
-    PyTypeObject* tp = Py_TYPE(obj);
-    if (likely(tp->tp_getattro))
-        return tp->tp_getattro(obj, attr_name);
-#if PY_MAJOR_VERSION < 3
-    if (likely(tp->tp_getattr))
-        return tp->tp_getattr(obj, PyString_AS_STRING(attr_name));
-#endif
-    return PyObject_GetAttr(obj, attr_name);
+/* TupleAndListFromArray */
+#if CYTHON_COMPILING_IN_CPYTHON
+static CYTHON_INLINE void __Pyx_copy_object_array(PyObject *const *CYTHON_RESTRICT src, PyObject** CYTHON_RESTRICT dest, Py_ssize_t length) {
+    PyObject *v;
+    Py_ssize_t i;
+    for (i = 0; i < length; i++) {
+        v = dest[i] = src[i];
+        Py_INCREF(v);
+    }
+}
+static CYTHON_INLINE PyObject *
+__Pyx_PyTuple_FromArray(PyObject *const *src, Py_ssize_t n)
+{
+    PyObject *res;
+    if (n <= 0) {
+        Py_INCREF(__pyx_empty_tuple);
+        return __pyx_empty_tuple;
+    }
+    res = PyTuple_New(n);
+    if (unlikely(res == NULL)) return NULL;
+    __Pyx_copy_object_array(src, ((PyTupleObject*)res)->ob_item, n);
+    return res;
+}
+static CYTHON_INLINE PyObject *
+__Pyx_PyList_FromArray(PyObject *const *src, Py_ssize_t n)
+{
+    PyObject *res;
+    if (n <= 0) {
+        return PyList_New(0);
+    }
+    res = PyList_New(n);
+    if (unlikely(res == NULL)) return NULL;
+    __Pyx_copy_object_array(src, ((PyListObject*)res)->ob_item, n);
+    return res;
 }
 #endif
 
-/* GetBuiltinName */
-static PyObject *__Pyx_GetBuiltinName(PyObject *name) {
-    PyObject* result = __Pyx_PyObject_GetAttrStr(__pyx_b, name);
-    if (unlikely(!result)) {
-        PyErr_Format(PyExc_NameError,
-#if PY_MAJOR_VERSION >= 3
-            "name '%U' is not defined", name);
-#else
-            "name '%.200s' is not defined", PyString_AS_STRING(name));
-#endif
+/* BytesEquals */
+static CYTHON_INLINE int __Pyx_PyBytes_Equals(PyObject* s1, PyObject* s2, int equals) {
+#if CYTHON_COMPILING_IN_PYPY || CYTHON_COMPILING_IN_LIMITED_API
+    return PyObject_RichCompareBool(s1, s2, equals);
+#else
+    if (s1 == s2) {
+        return (equals == Py_EQ);
+    } else if (PyBytes_CheckExact(s1) & PyBytes_CheckExact(s2)) {
+        const char *ps1, *ps2;
+        Py_ssize_t length = PyBytes_GET_SIZE(s1);
+        if (length != PyBytes_GET_SIZE(s2))
+            return (equals == Py_NE);
+        ps1 = PyBytes_AS_STRING(s1);
+        ps2 = PyBytes_AS_STRING(s2);
+        if (ps1[0] != ps2[0]) {
+            return (equals == Py_NE);
+        } else if (length == 1) {
+            return (equals == Py_EQ);
+        } else {
+            int result;
+#if CYTHON_USE_UNICODE_INTERNALS && (PY_VERSION_HEX < 0x030B0000)
+            Py_hash_t hash1, hash2;
+            hash1 = ((PyBytesObject*)s1)->ob_shash;
+            hash2 = ((PyBytesObject*)s2)->ob_shash;
+            if (hash1 != hash2 && hash1 != -1 && hash2 != -1) {
+                return (equals == Py_NE);
+            }
+#endif
+            result = memcmp(ps1, ps2, (size_t)length);
+            return (equals == Py_EQ) ? (result == 0) : (result != 0);
+        }
+    } else if ((s1 == Py_None) & PyBytes_CheckExact(s2)) {
+        return (equals == Py_NE);
+    } else if ((s2 == Py_None) & PyBytes_CheckExact(s1)) {
+        return (equals == Py_NE);
+    } else {
+        int result;
+        PyObject* py_result = PyObject_RichCompare(s1, s2, equals);
+        if (!py_result)
+            return -1;
+        result = __Pyx_PyObject_IsTrue(py_result);
+        Py_DECREF(py_result);
+        return result;
     }
-    return result;
+#endif
 }
 
-/* PyErrFetchRestore */
-#if CYTHON_FAST_THREAD_STATE
-static CYTHON_INLINE void __Pyx_ErrRestoreInState(PyThreadState *tstate, PyObject *type, PyObject *value, PyObject *tb) {
-    PyObject *tmp_type, *tmp_value, *tmp_tb;
-    tmp_type = tstate->curexc_type;
-    tmp_value = tstate->curexc_value;
-    tmp_tb = tstate->curexc_traceback;
-    tstate->curexc_type = type;
-    tstate->curexc_value = value;
-    tstate->curexc_traceback = tb;
-    Py_XDECREF(tmp_type);
-    Py_XDECREF(tmp_value);
-    Py_XDECREF(tmp_tb);
-}
-static CYTHON_INLINE void __Pyx_ErrFetchInState(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb) {
-    *type = tstate->curexc_type;
-    *value = tstate->curexc_value;
-    *tb = tstate->curexc_traceback;
-    tstate->curexc_type = 0;
-    tstate->curexc_value = 0;
-    tstate->curexc_traceback = 0;
-}
+/* UnicodeEquals */
+static CYTHON_INLINE int __Pyx_PyUnicode_Equals(PyObject* s1, PyObject* s2, int equals) {
+#if CYTHON_COMPILING_IN_PYPY || CYTHON_COMPILING_IN_LIMITED_API
+    return PyObject_RichCompareBool(s1, s2, equals);
+#else
+#if PY_MAJOR_VERSION < 3
+    PyObject* owned_ref = NULL;
 #endif
-
-/* WriteUnraisableException */
-static void __Pyx_WriteUnraisable(const char *name, CYTHON_UNUSED int clineno,
-                                  CYTHON_UNUSED int lineno, CYTHON_UNUSED const char *filename,
-                                  int full_traceback, CYTHON_UNUSED int nogil) {
-    PyObject *old_exc, *old_val, *old_tb;
-    PyObject *ctx;
-    __Pyx_PyThreadState_declare
-#ifdef WITH_THREAD
-    PyGILState_STATE state;
-    if (nogil)
-        state = PyGILState_Ensure();
-#ifdef _MSC_VER
-    else state = (PyGILState_STATE)-1;
+    int s1_is_unicode, s2_is_unicode;
+    if (s1 == s2) {
+        goto return_eq;
+    }
+    s1_is_unicode = PyUnicode_CheckExact(s1);
+    s2_is_unicode = PyUnicode_CheckExact(s2);
+#if PY_MAJOR_VERSION < 3
+    if ((s1_is_unicode & (!s2_is_unicode)) && PyString_CheckExact(s2)) {
+        owned_ref = PyUnicode_FromObject(s2);
+        if (unlikely(!owned_ref))
+            return -1;
+        s2 = owned_ref;
+        s2_is_unicode = 1;
+    } else if ((s2_is_unicode & (!s1_is_unicode)) && PyString_CheckExact(s1)) {
+        owned_ref = PyUnicode_FromObject(s1);
+        if (unlikely(!owned_ref))
+            return -1;
+        s1 = owned_ref;
+        s1_is_unicode = 1;
+    } else if (((!s2_is_unicode) & (!s1_is_unicode))) {
+        return __Pyx_PyBytes_Equals(s1, s2, equals);
+    }
 #endif
+    if (s1_is_unicode & s2_is_unicode) {
+        Py_ssize_t length;
+        int kind;
+        void *data1, *data2;
+        if (unlikely(__Pyx_PyUnicode_READY(s1) < 0) || unlikely(__Pyx_PyUnicode_READY(s2) < 0))
+            return -1;
+        length = __Pyx_PyUnicode_GET_LENGTH(s1);
+        if (length != __Pyx_PyUnicode_GET_LENGTH(s2)) {
+            goto return_ne;
+        }
+#if CYTHON_USE_UNICODE_INTERNALS
+        {
+            Py_hash_t hash1, hash2;
+        #if CYTHON_PEP393_ENABLED
+            hash1 = ((PyASCIIObject*)s1)->hash;
+            hash2 = ((PyASCIIObject*)s2)->hash;
+        #else
+            hash1 = ((PyUnicodeObject*)s1)->hash;
+            hash2 = ((PyUnicodeObject*)s2)->hash;
+        #endif
+            if (hash1 != hash2 && hash1 != -1 && hash2 != -1) {
+                goto return_ne;
+            }
+        }
 #endif
-    __Pyx_PyThreadState_assign
-    __Pyx_ErrFetch(&old_exc, &old_val, &old_tb);
-    if (full_traceback) {
-        Py_XINCREF(old_exc);
-        Py_XINCREF(old_val);
-        Py_XINCREF(old_tb);
-        __Pyx_ErrRestore(old_exc, old_val, old_tb);
-        PyErr_PrintEx(1);
+        kind = __Pyx_PyUnicode_KIND(s1);
+        if (kind != __Pyx_PyUnicode_KIND(s2)) {
+            goto return_ne;
+        }
+        data1 = __Pyx_PyUnicode_DATA(s1);
+        data2 = __Pyx_PyUnicode_DATA(s2);
+        if (__Pyx_PyUnicode_READ(kind, data1, 0) != __Pyx_PyUnicode_READ(kind, data2, 0)) {
+            goto return_ne;
+        } else if (length == 1) {
+            goto return_eq;
+        } else {
+            int result = memcmp(data1, data2, (size_t)(length * kind));
+            #if PY_MAJOR_VERSION < 3
+            Py_XDECREF(owned_ref);
+            #endif
+            return (equals == Py_EQ) ? (result == 0) : (result != 0);
+        }
+    } else if ((s1 == Py_None) & s2_is_unicode) {
+        goto return_ne;
+    } else if ((s2 == Py_None) & s1_is_unicode) {
+        goto return_ne;
+    } else {
+        int result;
+        PyObject* py_result = PyObject_RichCompare(s1, s2, equals);
+        #if PY_MAJOR_VERSION < 3
+        Py_XDECREF(owned_ref);
+        #endif
+        if (!py_result)
+            return -1;
+        result = __Pyx_PyObject_IsTrue(py_result);
+        Py_DECREF(py_result);
+        return result;
     }
+return_eq:
     #if PY_MAJOR_VERSION < 3
-    ctx = PyString_FromString(name);
-    #else
-    ctx = PyUnicode_FromString(name);
+    Py_XDECREF(owned_ref);
     #endif
-    __Pyx_ErrRestore(old_exc, old_val, old_tb);
-    if (!ctx) {
-        PyErr_WriteUnraisable(Py_None);
-    } else {
-        PyErr_WriteUnraisable(ctx);
-        Py_DECREF(ctx);
-    }
-#ifdef WITH_THREAD
-    if (nogil)
-        PyGILState_Release(state);
+    return (equals == Py_EQ);
+return_ne:
+    #if PY_MAJOR_VERSION < 3
+    Py_XDECREF(owned_ref);
+    #endif
+    return (equals == Py_NE);
 #endif
 }
 
+/* fastcall */
+#if CYTHON_METH_FASTCALL
+static CYTHON_INLINE PyObject * __Pyx_GetKwValue_FASTCALL(PyObject *kwnames, PyObject *const *kwvalues, PyObject *s)
+{
+    Py_ssize_t i, n = PyTuple_GET_SIZE(kwnames);
+    for (i = 0; i < n; i++)
+    {
+        if (s == PyTuple_GET_ITEM(kwnames, i)) return kwvalues[i];
+    }
+    for (i = 0; i < n; i++)
+    {
+        int eq = __Pyx_PyUnicode_Equals(s, PyTuple_GET_ITEM(kwnames, i), Py_EQ);
+        if (unlikely(eq != 0)) {
+            if (unlikely(eq < 0)) return NULL;  // error
+            return kwvalues[i];
+        }
+    }
+    return NULL;  // not found (no exception set)
+}
+#endif
+
 /* RaiseArgTupleInvalid */
 static void __Pyx_RaiseArgtupleInvalid(
     const char* func_name,
     int exact,
     Py_ssize_t num_min,
     Py_ssize_t num_max,
     Py_ssize_t num_found)
@@ -4590,25 +5304,37 @@
         PyString_AsString(kw_name));
         #endif
 }
 
 /* ParseKeywords */
 static int __Pyx_ParseOptionalKeywords(
     PyObject *kwds,
+    PyObject *const *kwvalues,
     PyObject **argnames[],
     PyObject *kwds2,
     PyObject *values[],
     Py_ssize_t num_pos_args,
     const char* function_name)
 {
     PyObject *key = 0, *value = 0;
     Py_ssize_t pos = 0;
     PyObject*** name;
     PyObject*** first_kw_arg = argnames + num_pos_args;
-    while (PyDict_Next(kwds, &pos, &key, &value)) {
+    int kwds_is_tuple = CYTHON_METH_FASTCALL && likely(PyTuple_Check(kwds));
+    while (1) {
+        if (kwds_is_tuple) {
+            if (pos >= PyTuple_GET_SIZE(kwds)) break;
+            key = PyTuple_GET_ITEM(kwds, pos);
+            value = kwvalues[pos];
+            pos++;
+        }
+        else
+        {
+            if (!PyDict_Next(kwds, &pos, &key, &value)) break;
+        }
         name = first_kw_arg;
         while (*name && (**name != key)) name++;
         if (*name) {
             values[name-argnames] = value;
             continue;
         }
         name = first_kw_arg;
@@ -4634,19 +5360,20 @@
                     argname++;
                 }
             }
         } else
         #endif
         if (likely(PyUnicode_Check(key))) {
             while (*name) {
-                int cmp = (**name == key) ? 0 :
+                int cmp = (
                 #if !CYTHON_COMPILING_IN_PYPY && PY_MAJOR_VERSION >= 3
                     (__Pyx_PyUnicode_GET_LENGTH(**name) != __Pyx_PyUnicode_GET_LENGTH(key)) ? 1 :
                 #endif
-                    PyUnicode_Compare(**name, key);
+                    PyUnicode_Compare(**name, key)
+                );
                 if (cmp < 0 && unlikely(PyErr_Occurred())) goto bad;
                 if (cmp == 0) {
                     values[name-argnames] = value;
                     break;
                 }
                 name++;
             }
@@ -4677,51 +5404,248 @@
     __Pyx_RaiseDoubleKeywordsError(function_name, key);
     goto bad;
 invalid_keyword_type:
     PyErr_Format(PyExc_TypeError,
         "%.200s() keywords must be strings", function_name);
     goto bad;
 invalid_keyword:
-    PyErr_Format(PyExc_TypeError,
     #if PY_MAJOR_VERSION < 3
+    PyErr_Format(PyExc_TypeError,
         "%.200s() got an unexpected keyword argument '%.200s'",
         function_name, PyString_AsString(key));
     #else
+    PyErr_Format(PyExc_TypeError,
         "%s() got an unexpected keyword argument '%U'",
         function_name, key);
     #endif
 bad:
     return -1;
 }
 
-/* PyCFunctionFastCall */
-#if CYTHON_FAST_PYCCALL
-static CYTHON_INLINE PyObject * __Pyx_PyCFunction_FastCall(PyObject *func_obj, PyObject **args, Py_ssize_t nargs) {
-    PyCFunctionObject *func = (PyCFunctionObject*)func_obj;
-    PyCFunction meth = PyCFunction_GET_FUNCTION(func);
-    PyObject *self = PyCFunction_GET_SELF(func);
-    int flags = PyCFunction_GET_FLAGS(func);
-    assert(PyCFunction_Check(func));
-    assert(METH_FASTCALL == (flags & ~(METH_CLASS | METH_STATIC | METH_COEXIST | METH_KEYWORDS | METH_STACKLESS)));
-    assert(nargs >= 0);
-    assert(nargs == 0 || args != NULL);
-    /* _PyCFunction_FastCallDict() must not be called with an exception set,
-       because it may clear it (directly or indirectly) and so the
-       caller loses its exception */
-    assert(!PyErr_Occurred());
-    if ((PY_VERSION_HEX < 0x030700A0) || unlikely(flags & METH_KEYWORDS)) {
-        return (*((__Pyx_PyCFunctionFastWithKeywords)(void*)meth)) (self, args, nargs, NULL);
+/* PyErrExceptionMatches */
+#if CYTHON_FAST_THREAD_STATE
+static int __Pyx_PyErr_ExceptionMatchesTuple(PyObject *exc_type, PyObject *tuple) {
+    Py_ssize_t i, n;
+    n = PyTuple_GET_SIZE(tuple);
+#if PY_MAJOR_VERSION >= 3
+    for (i=0; i<n; i++) {
+        if (exc_type == PyTuple_GET_ITEM(tuple, i)) return 1;
+    }
+#endif
+    for (i=0; i<n; i++) {
+        if (__Pyx_PyErr_GivenExceptionMatches(exc_type, PyTuple_GET_ITEM(tuple, i))) return 1;
+    }
+    return 0;
+}
+static CYTHON_INLINE int __Pyx_PyErr_ExceptionMatchesInState(PyThreadState* tstate, PyObject* err) {
+    int result;
+    PyObject *exc_type;
+#if PY_VERSION_HEX >= 0x030C00A6
+    PyObject *current_exception = tstate->current_exception;
+    if (unlikely(!current_exception)) return 0;
+    exc_type = (PyObject*) Py_TYPE(current_exception);
+    if (exc_type == err) return 1;
+#else
+    exc_type = tstate->curexc_type;
+    if (exc_type == err) return 1;
+    if (unlikely(!exc_type)) return 0;
+#endif
+    #if CYTHON_AVOID_BORROWED_REFS
+    Py_INCREF(exc_type);
+    #endif
+    if (unlikely(PyTuple_Check(err))) {
+        result = __Pyx_PyErr_ExceptionMatchesTuple(exc_type, err);
     } else {
-        return (*((__Pyx_PyCFunctionFast)(void*)meth)) (self, args, nargs);
+        result = __Pyx_PyErr_GivenExceptionMatches(exc_type, err);
     }
+    #if CYTHON_AVOID_BORROWED_REFS
+    Py_DECREF(exc_type);
+    #endif
+    return result;
+}
+#endif
+
+/* PyErrFetchRestore */
+#if CYTHON_FAST_THREAD_STATE
+static CYTHON_INLINE void __Pyx_ErrRestoreInState(PyThreadState *tstate, PyObject *type, PyObject *value, PyObject *tb) {
+#if PY_VERSION_HEX >= 0x030C00A6
+    PyObject *tmp_value;
+    assert(type == NULL || (value != NULL && type == (PyObject*) Py_TYPE(value)));
+    if (value) {
+        #if CYTHON_COMPILING_IN_CPYTHON
+        if (unlikely(((PyBaseExceptionObject*) value)->traceback != tb))
+        #endif
+            PyException_SetTraceback(value, tb);
+    }
+    tmp_value = tstate->current_exception;
+    tstate->current_exception = value;
+    Py_XDECREF(tmp_value);
+#else
+    PyObject *tmp_type, *tmp_value, *tmp_tb;
+    tmp_type = tstate->curexc_type;
+    tmp_value = tstate->curexc_value;
+    tmp_tb = tstate->curexc_traceback;
+    tstate->curexc_type = type;
+    tstate->curexc_value = value;
+    tstate->curexc_traceback = tb;
+    Py_XDECREF(tmp_type);
+    Py_XDECREF(tmp_value);
+    Py_XDECREF(tmp_tb);
+#endif
+}
+static CYTHON_INLINE void __Pyx_ErrFetchInState(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb) {
+#if PY_VERSION_HEX >= 0x030C00A6
+    PyObject* exc_value;
+    exc_value = tstate->current_exception;
+    tstate->current_exception = 0;
+    *value = exc_value;
+    *type = NULL;
+    *tb = NULL;
+    if (exc_value) {
+        *type = (PyObject*) Py_TYPE(exc_value);
+        Py_INCREF(*type);
+        #if CYTHON_COMPILING_IN_CPYTHON
+        *tb = ((PyBaseExceptionObject*) exc_value)->traceback;
+        Py_XINCREF(*tb);
+        #else
+        *tb = PyException_GetTraceback(exc_value);
+        #endif
+    }
+#else
+    *type = tstate->curexc_type;
+    *value = tstate->curexc_value;
+    *tb = tstate->curexc_traceback;
+    tstate->curexc_type = 0;
+    tstate->curexc_value = 0;
+    tstate->curexc_traceback = 0;
+#endif
+}
+#endif
+
+/* PyObjectGetAttrStr */
+#if CYTHON_USE_TYPE_SLOTS
+static CYTHON_INLINE PyObject* __Pyx_PyObject_GetAttrStr(PyObject* obj, PyObject* attr_name) {
+    PyTypeObject* tp = Py_TYPE(obj);
+    if (likely(tp->tp_getattro))
+        return tp->tp_getattro(obj, attr_name);
+#if PY_MAJOR_VERSION < 3
+    if (likely(tp->tp_getattr))
+        return tp->tp_getattr(obj, PyString_AS_STRING(attr_name));
+#endif
+    return PyObject_GetAttr(obj, attr_name);
+}
+#endif
+
+/* PyObjectGetAttrStrNoError */
+static void __Pyx_PyObject_GetAttrStr_ClearAttributeError(void) {
+    __Pyx_PyThreadState_declare
+    __Pyx_PyThreadState_assign
+    if (likely(__Pyx_PyErr_ExceptionMatches(PyExc_AttributeError)))
+        __Pyx_PyErr_Clear();
+}
+static CYTHON_INLINE PyObject* __Pyx_PyObject_GetAttrStrNoError(PyObject* obj, PyObject* attr_name) {
+    PyObject *result;
+#if CYTHON_COMPILING_IN_CPYTHON && CYTHON_USE_TYPE_SLOTS && PY_VERSION_HEX >= 0x030700B1
+    PyTypeObject* tp = Py_TYPE(obj);
+    if (likely(tp->tp_getattro == PyObject_GenericGetAttr)) {
+        return _PyObject_GenericGetAttrWithDict(obj, attr_name, NULL, 1);
+    }
+#endif
+    result = __Pyx_PyObject_GetAttrStr(obj, attr_name);
+    if (unlikely(!result)) {
+        __Pyx_PyObject_GetAttrStr_ClearAttributeError();
+    }
+    return result;
+}
+
+/* GetBuiltinName */
+static PyObject *__Pyx_GetBuiltinName(PyObject *name) {
+    PyObject* result = __Pyx_PyObject_GetAttrStrNoError(__pyx_b, name);
+    if (unlikely(!result) && !PyErr_Occurred()) {
+        PyErr_Format(PyExc_NameError,
+#if PY_MAJOR_VERSION >= 3
+            "name '%U' is not defined", name);
+#else
+            "name '%.200s' is not defined", PyString_AS_STRING(name));
+#endif
+    }
+    return result;
+}
+
+/* PyDictVersioning */
+#if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_TYPE_SLOTS
+static CYTHON_INLINE PY_UINT64_T __Pyx_get_tp_dict_version(PyObject *obj) {
+    PyObject *dict = Py_TYPE(obj)->tp_dict;
+    return likely(dict) ? __PYX_GET_DICT_VERSION(dict) : 0;
+}
+static CYTHON_INLINE PY_UINT64_T __Pyx_get_object_dict_version(PyObject *obj) {
+    PyObject **dictptr = NULL;
+    Py_ssize_t offset = Py_TYPE(obj)->tp_dictoffset;
+    if (offset) {
+#if CYTHON_COMPILING_IN_CPYTHON
+        dictptr = (likely(offset > 0)) ? (PyObject **) ((char *)obj + offset) : _PyObject_GetDictPtr(obj);
+#else
+        dictptr = _PyObject_GetDictPtr(obj);
+#endif
+    }
+    return (dictptr && *dictptr) ? __PYX_GET_DICT_VERSION(*dictptr) : 0;
 }
+static CYTHON_INLINE int __Pyx_object_dict_version_matches(PyObject* obj, PY_UINT64_T tp_dict_version, PY_UINT64_T obj_dict_version) {
+    PyObject *dict = Py_TYPE(obj)->tp_dict;
+    if (unlikely(!dict) || unlikely(tp_dict_version != __PYX_GET_DICT_VERSION(dict)))
+        return 0;
+    return obj_dict_version == __Pyx_get_object_dict_version(obj);
+}
+#endif
+
+/* GetModuleGlobalName */
+#if CYTHON_USE_DICT_VERSIONS
+static PyObject *__Pyx__GetModuleGlobalName(PyObject *name, PY_UINT64_T *dict_version, PyObject **dict_cached_value)
+#else
+static CYTHON_INLINE PyObject *__Pyx__GetModuleGlobalName(PyObject *name)
+#endif
+{
+    PyObject *result;
+#if !CYTHON_AVOID_BORROWED_REFS
+#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x030500A1
+    result = _PyDict_GetItem_KnownHash(__pyx_d, name, ((PyASCIIObject *) name)->hash);
+    __PYX_UPDATE_DICT_CACHE(__pyx_d, result, *dict_cached_value, *dict_version)
+    if (likely(result)) {
+        return __Pyx_NewRef(result);
+    } else if (unlikely(PyErr_Occurred())) {
+        return NULL;
+    }
+#elif CYTHON_COMPILING_IN_LIMITED_API
+    if (unlikely(!__pyx_m)) {
+        return NULL;
+    }
+    result = PyObject_GetAttr(__pyx_m, name);
+    if (likely(result)) {
+        return result;
+    }
+#else
+    result = PyDict_GetItem(__pyx_d, name);
+    __PYX_UPDATE_DICT_CACHE(__pyx_d, result, *dict_cached_value, *dict_version)
+    if (likely(result)) {
+        return __Pyx_NewRef(result);
+    }
+#endif
+#else
+    result = PyObject_GetItem(__pyx_d, name);
+    __PYX_UPDATE_DICT_CACHE(__pyx_d, result, *dict_cached_value, *dict_version)
+    if (likely(result)) {
+        return __Pyx_NewRef(result);
+    }
+    PyErr_Clear();
 #endif
+    return __Pyx_GetBuiltinName(name);
+}
 
 /* PyFunctionFastCall */
-#if CYTHON_FAST_PYCALL
+#if CYTHON_FAST_PYCALL && !CYTHON_VECTORCALL
 static PyObject* __Pyx_PyFunction_FastCallNoKw(PyCodeObject *co, PyObject **args, Py_ssize_t na,
                                                PyObject *globals) {
     PyFrameObject *f;
     PyThreadState *tstate = __Pyx_PyThreadState_Current;
     PyObject **fastlocals;
     Py_ssize_t i;
     PyObject *result;
@@ -4742,15 +5666,14 @@
     }
     result = PyEval_EvalFrameEx(f,0);
     ++tstate->recursion_depth;
     Py_DECREF(f);
     --tstate->recursion_depth;
     return result;
 }
-#if 1 || PY_VERSION_HEX < 0x030600B1
 static PyObject *__Pyx_PyFunction_FastCallDict(PyObject *func, PyObject **args, Py_ssize_t nargs, PyObject *kwargs) {
     PyCodeObject *co = (PyCodeObject *)PyFunction_GET_CODE(func);
     PyObject *globals = PyFunction_GET_GLOBALS(func);
     PyObject *argdefs = PyFunction_GET_DEFAULTS(func);
     PyObject *closure;
 #if PY_MAJOR_VERSION >= 3
     PyObject *kwdefs;
@@ -4758,15 +5681,15 @@
     PyObject *kwtuple, **k;
     PyObject **d;
     Py_ssize_t nd;
     Py_ssize_t nk;
     PyObject *result;
     assert(kwargs == NULL || PyDict_Check(kwargs));
     nk = kwargs ? PyDict_Size(kwargs) : 0;
-    if (Py_EnterRecursiveCall((char*)" while calling a Python object")) {
+    if (unlikely(Py_EnterRecursiveCall((char*)" while calling a Python object"))) {
         return NULL;
     }
     if (
 #if PY_MAJOR_VERSION >= 3
             co->co_kwonlyargcount == 0 &&
 #endif
             likely(kwargs == NULL || nk == 0) &&
@@ -4829,21 +5752,20 @@
 #endif
     Py_XDECREF(kwtuple);
 done:
     Py_LeaveRecursiveCall();
     return result;
 }
 #endif
-#endif
 
 /* PyObjectCall */
 #if CYTHON_COMPILING_IN_CPYTHON
 static CYTHON_INLINE PyObject* __Pyx_PyObject_Call(PyObject *func, PyObject *arg, PyObject *kw) {
     PyObject *result;
-    ternaryfunc call = func->ob_type->tp_call;
+    ternaryfunc call = Py_TYPE(func)->tp_call;
     if (unlikely(!call))
         return PyObject_Call(func, arg, kw);
     if (unlikely(Py_EnterRecursiveCall((char*)" while calling a Python object")))
         return NULL;
     result = (*call)(func, arg, kw);
     Py_LeaveRecursiveCall();
     if (unlikely(!result) && unlikely(!PyErr_Occurred())) {
@@ -4871,59 +5793,102 @@
             PyExc_SystemError,
             "NULL result without error in PyObject_Call");
     }
     return result;
 }
 #endif
 
-/* PyObjectCallOneArg */
-#if CYTHON_COMPILING_IN_CPYTHON
-static PyObject* __Pyx__PyObject_CallOneArg(PyObject *func, PyObject *arg) {
+/* PyObjectFastCall */
+static PyObject* __Pyx_PyObject_FastCall_fallback(PyObject *func, PyObject **args, size_t nargs, PyObject *kwargs) {
+    PyObject *argstuple;
     PyObject *result;
-    PyObject *args = PyTuple_New(1);
-    if (unlikely(!args)) return NULL;
-    Py_INCREF(arg);
-    PyTuple_SET_ITEM(args, 0, arg);
-    result = __Pyx_PyObject_Call(func, args, NULL);
-    Py_DECREF(args);
+    size_t i;
+    argstuple = PyTuple_New((Py_ssize_t)nargs);
+    if (unlikely(!argstuple)) return NULL;
+    for (i = 0; i < nargs; i++) {
+        Py_INCREF(args[i]);
+        PyTuple_SET_ITEM(argstuple, (Py_ssize_t)i, args[i]);
+    }
+    result = __Pyx_PyObject_Call(func, argstuple, kwargs);
+    Py_DECREF(argstuple);
     return result;
 }
-static CYTHON_INLINE PyObject* __Pyx_PyObject_CallOneArg(PyObject *func, PyObject *arg) {
-#if CYTHON_FAST_PYCALL
-    if (PyFunction_Check(func)) {
-        return __Pyx_PyFunction_FastCall(func, &arg, 1);
-    }
+static CYTHON_INLINE PyObject* __Pyx_PyObject_FastCallDict(PyObject *func, PyObject **args, size_t _nargs, PyObject *kwargs) {
+    Py_ssize_t nargs = __Pyx_PyVectorcall_NARGS(_nargs);
+#if CYTHON_COMPILING_IN_CPYTHON
+    if (nargs == 0 && kwargs == NULL) {
+#if defined(__Pyx_CyFunction_USED) && defined(NDEBUG)
+        if (__Pyx_IsCyOrPyCFunction(func))
+#else
+        if (PyCFunction_Check(func))
 #endif
-    if (likely(PyCFunction_Check(func))) {
-        if (likely(PyCFunction_GET_FLAGS(func) & METH_O)) {
-            return __Pyx_PyObject_CallMethO(func, arg);
-#if CYTHON_FAST_PYCCALL
-        } else if (PyCFunction_GET_FLAGS(func) & METH_FASTCALL) {
-            return __Pyx_PyCFunction_FastCall(func, &arg, 1);
+        {
+            if (likely(PyCFunction_GET_FLAGS(func) & METH_NOARGS)) {
+                return __Pyx_PyObject_CallMethO(func, NULL);
+            }
+        }
+    }
+    else if (nargs == 1 && kwargs == NULL) {
+        if (PyCFunction_Check(func))
+        {
+            if (likely(PyCFunction_GET_FLAGS(func) & METH_O)) {
+                return __Pyx_PyObject_CallMethO(func, args[0]);
+            }
+        }
+    }
 #endif
+    #if PY_VERSION_HEX < 0x030800B1
+    #if CYTHON_FAST_PYCCALL
+    if (PyCFunction_Check(func)) {
+        if (kwargs) {
+            return _PyCFunction_FastCallDict(func, args, nargs, kwargs);
+        } else {
+            return _PyCFunction_FastCallKeywords(func, args, nargs, NULL);
         }
     }
-    return __Pyx__PyObject_CallOneArg(func, arg);
+    #if PY_VERSION_HEX >= 0x030700A1
+    if (!kwargs && __Pyx_IS_TYPE(func, &PyMethodDescr_Type)) {
+        return _PyMethodDescr_FastCallKeywords(func, args, nargs, NULL);
+    }
+    #endif
+    #endif
+    #if CYTHON_FAST_PYCALL
+    if (PyFunction_Check(func)) {
+        return __Pyx_PyFunction_FastCallDict(func, args, nargs, kwargs);
+    }
+    #endif
+    #endif
+    #if CYTHON_VECTORCALL
+    vectorcallfunc f = _PyVectorcall_Function(func);
+    if (f) {
+        return f(func, args, (size_t)nargs, kwargs);
+    }
+    #elif defined(__Pyx_CyFunction_USED) && CYTHON_BACKPORT_VECTORCALL
+    if (__Pyx_CyFunction_CheckExact(func)) {
+        __pyx_vectorcallfunc f = __Pyx_CyFunction_func_vectorcall(func);
+        if (f) return f(func, args, (size_t)nargs, kwargs);
+    }
+    #endif
+    if (nargs == 0) {
+        return __Pyx_PyObject_Call(func, __pyx_empty_tuple, kwargs);
+    }
+    return __Pyx_PyObject_FastCall_fallback(func, args, (size_t)nargs, kwargs);
 }
-#else
+
+/* PyObjectCallOneArg */
 static CYTHON_INLINE PyObject* __Pyx_PyObject_CallOneArg(PyObject *func, PyObject *arg) {
-    PyObject *result;
-    PyObject *args = PyTuple_Pack(1, arg);
-    if (unlikely(!args)) return NULL;
-    result = __Pyx_PyObject_Call(func, args, NULL);
-    Py_DECREF(args);
-    return result;
+    PyObject *args[2] = {NULL, arg};
+    return __Pyx_PyObject_FastCall(func, args+1, 1 | __Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET);
 }
-#endif
 
 /* RaiseException */
 #if PY_MAJOR_VERSION < 3
-static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb,
-                        CYTHON_UNUSED PyObject *cause) {
+static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb, PyObject *cause) {
     __Pyx_PyThreadState_declare
+    CYTHON_UNUSED_VAR(cause);
     Py_XINCREF(type);
     if (!value || value == Py_None)
         value = NULL;
     else
         Py_INCREF(value);
     if (!tb || tb == Py_None)
         tb = NULL;
@@ -5048,621 +6013,705 @@
                             "BaseException");
             goto bad;
         }
         PyException_SetCause(value, fixed_cause);
     }
     PyErr_SetObject(type, value);
     if (tb) {
-#if CYTHON_COMPILING_IN_PYPY
-        PyObject *tmp_type, *tmp_value, *tmp_tb;
-        PyErr_Fetch(&tmp_type, &tmp_value, &tmp_tb);
-        Py_INCREF(tb);
-        PyErr_Restore(tmp_type, tmp_value, tb);
-        Py_XDECREF(tmp_tb);
-#else
+      #if PY_VERSION_HEX >= 0x030C00A6
+        PyException_SetTraceback(value, tb);
+      #elif CYTHON_FAST_THREAD_STATE
         PyThreadState *tstate = __Pyx_PyThreadState_Current;
         PyObject* tmp_tb = tstate->curexc_traceback;
         if (tb != tmp_tb) {
             Py_INCREF(tb);
             tstate->curexc_traceback = tb;
             Py_XDECREF(tmp_tb);
         }
+#else
+        PyObject *tmp_type, *tmp_value, *tmp_tb;
+        PyErr_Fetch(&tmp_type, &tmp_value, &tmp_tb);
+        Py_INCREF(tb);
+        PyErr_Restore(tmp_type, tmp_value, tb);
+        Py_XDECREF(tmp_tb);
 #endif
     }
 bad:
     Py_XDECREF(owned_instance);
     return;
 }
 #endif
 
-/* PyDictVersioning */
-#if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_TYPE_SLOTS
-static CYTHON_INLINE PY_UINT64_T __Pyx_get_tp_dict_version(PyObject *obj) {
-    PyObject *dict = Py_TYPE(obj)->tp_dict;
-    return likely(dict) ? __PYX_GET_DICT_VERSION(dict) : 0;
-}
-static CYTHON_INLINE PY_UINT64_T __Pyx_get_object_dict_version(PyObject *obj) {
-    PyObject **dictptr = NULL;
-    Py_ssize_t offset = Py_TYPE(obj)->tp_dictoffset;
-    if (offset) {
-#if CYTHON_COMPILING_IN_CPYTHON
-        dictptr = (likely(offset > 0)) ? (PyObject **) ((char *)obj + offset) : _PyObject_GetDictPtr(obj);
-#else
-        dictptr = _PyObject_GetDictPtr(obj);
-#endif
-    }
-    return (dictptr && *dictptr) ? __PYX_GET_DICT_VERSION(*dictptr) : 0;
-}
-static CYTHON_INLINE int __Pyx_object_dict_version_matches(PyObject* obj, PY_UINT64_T tp_dict_version, PY_UINT64_T obj_dict_version) {
-    PyObject *dict = Py_TYPE(obj)->tp_dict;
-    if (unlikely(!dict) || unlikely(tp_dict_version != __PYX_GET_DICT_VERSION(dict)))
-        return 0;
-    return obj_dict_version == __Pyx_get_object_dict_version(obj);
-}
-#endif
-
-/* GetModuleGlobalName */
-#if CYTHON_USE_DICT_VERSIONS
-static PyObject *__Pyx__GetModuleGlobalName(PyObject *name, PY_UINT64_T *dict_version, PyObject **dict_cached_value)
-#else
-static CYTHON_INLINE PyObject *__Pyx__GetModuleGlobalName(PyObject *name)
-#endif
-{
-    PyObject *result;
-#if !CYTHON_AVOID_BORROWED_REFS
-#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x030500A1
-    result = _PyDict_GetItem_KnownHash(__pyx_d, name, ((PyASCIIObject *) name)->hash);
-    __PYX_UPDATE_DICT_CACHE(__pyx_d, result, *dict_cached_value, *dict_version)
-    if (likely(result)) {
-        return __Pyx_NewRef(result);
-    } else if (unlikely(PyErr_Occurred())) {
-        return NULL;
-    }
-#else
-    result = PyDict_GetItem(__pyx_d, name);
-    __PYX_UPDATE_DICT_CACHE(__pyx_d, result, *dict_cached_value, *dict_version)
-    if (likely(result)) {
-        return __Pyx_NewRef(result);
-    }
-#endif
-#else
-    result = PyObject_GetItem(__pyx_d, name);
-    __PYX_UPDATE_DICT_CACHE(__pyx_d, result, *dict_cached_value, *dict_version)
-    if (likely(result)) {
-        return __Pyx_NewRef(result);
-    }
-    PyErr_Clear();
-#endif
-    return __Pyx_GetBuiltinName(name);
-}
-
-/* PyObjectCallNoArg */
-#if CYTHON_COMPILING_IN_CPYTHON
-static CYTHON_INLINE PyObject* __Pyx_PyObject_CallNoArg(PyObject *func) {
-#if CYTHON_FAST_PYCALL
-    if (PyFunction_Check(func)) {
-        return __Pyx_PyFunction_FastCall(func, NULL, 0);
-    }
-#endif
-#ifdef __Pyx_CyFunction_USED
-    if (likely(PyCFunction_Check(func) || __Pyx_CyFunction_Check(func)))
-#else
-    if (likely(PyCFunction_Check(func)))
-#endif
-    {
-        if (likely(PyCFunction_GET_FLAGS(func) & METH_NOARGS)) {
-            return __Pyx_PyObject_CallMethO(func, NULL);
-        }
-    }
-    return __Pyx_PyObject_Call(func, __pyx_empty_tuple, NULL);
-}
-#endif
-
-/* PyObjectSetAttrStr */
-#if CYTHON_USE_TYPE_SLOTS
-static CYTHON_INLINE int __Pyx_PyObject_SetAttrStr(PyObject* obj, PyObject* attr_name, PyObject* value) {
-    PyTypeObject* tp = Py_TYPE(obj);
-    if (likely(tp->tp_setattro))
-        return tp->tp_setattro(obj, attr_name, value);
-#if PY_MAJOR_VERSION < 3
-    if (likely(tp->tp_setattr))
-        return tp->tp_setattr(obj, PyString_AS_STRING(attr_name), value);
-#endif
-    return PyObject_SetAttr(obj, attr_name, value);
-}
-#endif
-
-/* GetItemInt */
-static PyObject *__Pyx_GetItemInt_Generic(PyObject *o, PyObject* j) {
-    PyObject *r;
-    if (!j) return NULL;
-    r = PyObject_GetItem(o, j);
-    Py_DECREF(j);
-    return r;
-}
-static CYTHON_INLINE PyObject *__Pyx_GetItemInt_List_Fast(PyObject *o, Py_ssize_t i,
-                                                              CYTHON_NCP_UNUSED int wraparound,
-                                                              CYTHON_NCP_UNUSED int boundscheck) {
-#if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-    Py_ssize_t wrapped_i = i;
-    if (wraparound & unlikely(i < 0)) {
-        wrapped_i += PyList_GET_SIZE(o);
-    }
-    if ((!boundscheck) || likely(__Pyx_is_valid_index(wrapped_i, PyList_GET_SIZE(o)))) {
-        PyObject *r = PyList_GET_ITEM(o, wrapped_i);
-        Py_INCREF(r);
-        return r;
-    }
-    return __Pyx_GetItemInt_Generic(o, PyInt_FromSsize_t(i));
-#else
-    return PySequence_GetItem(o, i);
-#endif
-}
-static CYTHON_INLINE PyObject *__Pyx_GetItemInt_Tuple_Fast(PyObject *o, Py_ssize_t i,
-                                                              CYTHON_NCP_UNUSED int wraparound,
-                                                              CYTHON_NCP_UNUSED int boundscheck) {
-#if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-    Py_ssize_t wrapped_i = i;
-    if (wraparound & unlikely(i < 0)) {
-        wrapped_i += PyTuple_GET_SIZE(o);
-    }
-    if ((!boundscheck) || likely(__Pyx_is_valid_index(wrapped_i, PyTuple_GET_SIZE(o)))) {
-        PyObject *r = PyTuple_GET_ITEM(o, wrapped_i);
-        Py_INCREF(r);
-        return r;
-    }
-    return __Pyx_GetItemInt_Generic(o, PyInt_FromSsize_t(i));
-#else
-    return PySequence_GetItem(o, i);
-#endif
-}
-static CYTHON_INLINE PyObject *__Pyx_GetItemInt_Fast(PyObject *o, Py_ssize_t i, int is_list,
-                                                     CYTHON_NCP_UNUSED int wraparound,
-                                                     CYTHON_NCP_UNUSED int boundscheck) {
-#if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS && CYTHON_USE_TYPE_SLOTS
-    if (is_list || PyList_CheckExact(o)) {
-        Py_ssize_t n = ((!wraparound) | likely(i >= 0)) ? i : i + PyList_GET_SIZE(o);
-        if ((!boundscheck) || (likely(__Pyx_is_valid_index(n, PyList_GET_SIZE(o))))) {
-            PyObject *r = PyList_GET_ITEM(o, n);
-            Py_INCREF(r);
-            return r;
-        }
-    }
-    else if (PyTuple_CheckExact(o)) {
-        Py_ssize_t n = ((!wraparound) | likely(i >= 0)) ? i : i + PyTuple_GET_SIZE(o);
-        if ((!boundscheck) || likely(__Pyx_is_valid_index(n, PyTuple_GET_SIZE(o)))) {
-            PyObject *r = PyTuple_GET_ITEM(o, n);
-            Py_INCREF(r);
-            return r;
-        }
-    } else {
-        PySequenceMethods *m = Py_TYPE(o)->tp_as_sequence;
-        if (likely(m && m->sq_item)) {
-            if (wraparound && unlikely(i < 0) && likely(m->sq_length)) {
-                Py_ssize_t l = m->sq_length(o);
-                if (likely(l >= 0)) {
-                    i += l;
-                } else {
-                    if (!PyErr_ExceptionMatches(PyExc_OverflowError))
-                        return NULL;
-                    PyErr_Clear();
-                }
-            }
-            return m->sq_item(o, i);
-        }
-    }
-#else
-    if (is_list || PySequence_Check(o)) {
-        return PySequence_GetItem(o, i);
-    }
-#endif
-    return __Pyx_GetItemInt_Generic(o, PyInt_FromSsize_t(i));
-}
-
-/* ObjectGetItem */
-#if CYTHON_USE_TYPE_SLOTS
-static PyObject *__Pyx_PyObject_GetIndex(PyObject *obj, PyObject* index) {
-    PyObject *runerr;
-    Py_ssize_t key_value;
-    PySequenceMethods *m = Py_TYPE(obj)->tp_as_sequence;
-    if (unlikely(!(m && m->sq_item))) {
-        PyErr_Format(PyExc_TypeError, "'%.200s' object is not subscriptable", Py_TYPE(obj)->tp_name);
-        return NULL;
-    }
-    key_value = __Pyx_PyIndex_AsSsize_t(index);
-    if (likely(key_value != -1 || !(runerr = PyErr_Occurred()))) {
-        return __Pyx_GetItemInt_Fast(obj, key_value, 0, 1, 1);
-    }
-    if (PyErr_GivenExceptionMatches(runerr, PyExc_OverflowError)) {
-        PyErr_Clear();
-        PyErr_Format(PyExc_IndexError, "cannot fit '%.200s' into an index-sized integer", Py_TYPE(index)->tp_name);
-    }
-    return NULL;
-}
-static PyObject *__Pyx_PyObject_GetItem(PyObject *obj, PyObject* key) {
-    PyMappingMethods *m = Py_TYPE(obj)->tp_as_mapping;
-    if (likely(m && m->mp_subscript)) {
-        return m->mp_subscript(obj, key);
-    }
-    return __Pyx_PyObject_GetIndex(obj, key);
-}
-#endif
-
-/* PyObjectFormatAndDecref */
-static CYTHON_INLINE PyObject* __Pyx_PyObject_FormatSimpleAndDecref(PyObject* s, PyObject* f) {
-    if (unlikely(!s)) return NULL;
-    if (likely(PyUnicode_CheckExact(s))) return s;
-    #if PY_MAJOR_VERSION < 3
-    if (likely(PyString_CheckExact(s))) {
-        PyObject *result = PyUnicode_FromEncodedObject(s, NULL, "strict");
-        Py_DECREF(s);
-        return result;
-    }
-    #endif
-    return __Pyx_PyObject_FormatAndDecref(s, f);
-}
-static CYTHON_INLINE PyObject* __Pyx_PyObject_FormatAndDecref(PyObject* s, PyObject* f) {
-    PyObject *result = PyObject_Format(s, f);
-    Py_DECREF(s);
-    return result;
-}
-
-/* JoinPyUnicode */
-static PyObject* __Pyx_PyUnicode_Join(PyObject* value_tuple, Py_ssize_t value_count, Py_ssize_t result_ulength,
-                                      CYTHON_UNUSED Py_UCS4 max_char) {
-#if CYTHON_USE_UNICODE_INTERNALS && CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-    PyObject *result_uval;
-    int result_ukind;
-    Py_ssize_t i, char_pos;
-    void *result_udata;
-#if CYTHON_PEP393_ENABLED
-    result_uval = PyUnicode_New(result_ulength, max_char);
-    if (unlikely(!result_uval)) return NULL;
-    result_ukind = (max_char <= 255) ? PyUnicode_1BYTE_KIND : (max_char <= 65535) ? PyUnicode_2BYTE_KIND : PyUnicode_4BYTE_KIND;
-    result_udata = PyUnicode_DATA(result_uval);
-#else
-    result_uval = PyUnicode_FromUnicode(NULL, result_ulength);
-    if (unlikely(!result_uval)) return NULL;
-    result_ukind = sizeof(Py_UNICODE);
-    result_udata = PyUnicode_AS_UNICODE(result_uval);
-#endif
-    char_pos = 0;
-    for (i=0; i < value_count; i++) {
-        int ukind;
-        Py_ssize_t ulength;
-        void *udata;
-        PyObject *uval = PyTuple_GET_ITEM(value_tuple, i);
-        if (unlikely(__Pyx_PyUnicode_READY(uval)))
-            goto bad;
-        ulength = __Pyx_PyUnicode_GET_LENGTH(uval);
-        if (unlikely(!ulength))
-            continue;
-        if (unlikely(char_pos + ulength < 0))
-            goto overflow;
-        ukind = __Pyx_PyUnicode_KIND(uval);
-        udata = __Pyx_PyUnicode_DATA(uval);
-        if (!CYTHON_PEP393_ENABLED || ukind == result_ukind) {
-            memcpy((char *)result_udata + char_pos * result_ukind, udata, (size_t) (ulength * result_ukind));
-        } else {
-            #if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x030300F0 || defined(_PyUnicode_FastCopyCharacters)
-            _PyUnicode_FastCopyCharacters(result_uval, char_pos, uval, 0, ulength);
-            #else
-            Py_ssize_t j;
-            for (j=0; j < ulength; j++) {
-                Py_UCS4 uchar = __Pyx_PyUnicode_READ(ukind, udata, j);
-                __Pyx_PyUnicode_WRITE(result_ukind, result_udata, char_pos+j, uchar);
-            }
-            #endif
-        }
-        char_pos += ulength;
-    }
-    return result_uval;
-overflow:
-    PyErr_SetString(PyExc_OverflowError, "join() result is too long for a Python string");
-bad:
-    Py_DECREF(result_uval);
-    return NULL;
-#else
-    result_ulength++;
-    value_count++;
-    return PyUnicode_Join(__pyx_empty_unicode, value_tuple);
-#endif
-}
-
 /* TypeImport */
-#ifndef __PYX_HAVE_RT_ImportType
-#define __PYX_HAVE_RT_ImportType
-static PyTypeObject *__Pyx_ImportType(PyObject *module, const char *module_name, const char *class_name,
-    size_t size, enum __Pyx_ImportType_CheckSize check_size)
+#ifndef __PYX_HAVE_RT_ImportType_3_0_0
+#define __PYX_HAVE_RT_ImportType_3_0_0
+static PyTypeObject *__Pyx_ImportType_3_0_0(PyObject *module, const char *module_name, const char *class_name,
+    size_t size, size_t alignment, enum __Pyx_ImportType_CheckSize_3_0_0 check_size)
 {
     PyObject *result = 0;
     char warning[200];
     Py_ssize_t basicsize;
-#ifdef Py_LIMITED_API
+    Py_ssize_t itemsize;
+#if CYTHON_COMPILING_IN_LIMITED_API
     PyObject *py_basicsize;
+    PyObject *py_itemsize;
 #endif
     result = PyObject_GetAttrString(module, class_name);
     if (!result)
         goto bad;
     if (!PyType_Check(result)) {
         PyErr_Format(PyExc_TypeError,
             "%.200s.%.200s is not a type object",
             module_name, class_name);
         goto bad;
     }
-#ifndef Py_LIMITED_API
+#if !CYTHON_COMPILING_IN_LIMITED_API
     basicsize = ((PyTypeObject *)result)->tp_basicsize;
+    itemsize = ((PyTypeObject *)result)->tp_itemsize;
 #else
     py_basicsize = PyObject_GetAttrString(result, "__basicsize__");
     if (!py_basicsize)
         goto bad;
     basicsize = PyLong_AsSsize_t(py_basicsize);
     Py_DECREF(py_basicsize);
     py_basicsize = 0;
     if (basicsize == (Py_ssize_t)-1 && PyErr_Occurred())
         goto bad;
+    py_itemsize = PyObject_GetAttrString(result, "__itemsize__");
+    if (!py_itemsize)
+        goto bad;
+    itemsize = PyLong_AsSsize_t(py_itemsize);
+    Py_DECREF(py_itemsize);
+    py_itemsize = 0;
+    if (itemsize == (Py_ssize_t)-1 && PyErr_Occurred())
+        goto bad;
 #endif
-    if ((size_t)basicsize < size) {
+    if (itemsize) {
+        if (size % alignment) {
+            alignment = size % alignment;
+        }
+        if (itemsize < (Py_ssize_t)alignment)
+            itemsize = (Py_ssize_t)alignment;
+    }
+    if ((size_t)(basicsize + itemsize) < size) {
         PyErr_Format(PyExc_ValueError,
             "%.200s.%.200s size changed, may indicate binary incompatibility. "
             "Expected %zd from C header, got %zd from PyObject",
-            module_name, class_name, size, basicsize);
+            module_name, class_name, size, basicsize+itemsize);
         goto bad;
     }
-    if (check_size == __Pyx_ImportType_CheckSize_Error && (size_t)basicsize != size) {
+    if (check_size == __Pyx_ImportType_CheckSize_Error_3_0_0 &&
+            ((size_t)basicsize > size || (size_t)(basicsize + itemsize) < size)) {
         PyErr_Format(PyExc_ValueError,
             "%.200s.%.200s size changed, may indicate binary incompatibility. "
-            "Expected %zd from C header, got %zd from PyObject",
-            module_name, class_name, size, basicsize);
+            "Expected %zd from C header, got %zd-%zd from PyObject",
+            module_name, class_name, size, basicsize, basicsize+itemsize);
         goto bad;
     }
-    else if (check_size == __Pyx_ImportType_CheckSize_Warn && (size_t)basicsize > size) {
+    else if (check_size == __Pyx_ImportType_CheckSize_Warn_3_0_0 && (size_t)basicsize > size) {
         PyOS_snprintf(warning, sizeof(warning),
             "%s.%s size changed, may indicate binary incompatibility. "
             "Expected %zd from C header, got %zd from PyObject",
             module_name, class_name, size, basicsize);
         if (PyErr_WarnEx(NULL, warning, 0) < 0) goto bad;
     }
     return (PyTypeObject *)result;
 bad:
     Py_XDECREF(result);
     return NULL;
 }
 #endif
 
-/* CalculateMetaclass */
-static PyObject *__Pyx_CalculateMetaclass(PyTypeObject *metaclass, PyObject *bases) {
-    Py_ssize_t i, nbases = PyTuple_GET_SIZE(bases);
-    for (i=0; i < nbases; i++) {
-        PyTypeObject *tmptype;
-        PyObject *tmp = PyTuple_GET_ITEM(bases, i);
-        tmptype = Py_TYPE(tmp);
-#if PY_MAJOR_VERSION < 3
-        if (tmptype == &PyClass_Type)
-            continue;
-#endif
-        if (!metaclass) {
-            metaclass = tmptype;
-            continue;
+/* Import */
+static PyObject *__Pyx_Import(PyObject *name, PyObject *from_list, int level) {
+    PyObject *module = 0;
+    PyObject *empty_dict = 0;
+    PyObject *empty_list = 0;
+    #if PY_MAJOR_VERSION < 3
+    PyObject *py_import;
+    py_import = __Pyx_PyObject_GetAttrStr(__pyx_b, __pyx_n_s_import);
+    if (unlikely(!py_import))
+        goto bad;
+    if (!from_list) {
+        empty_list = PyList_New(0);
+        if (unlikely(!empty_list))
+            goto bad;
+        from_list = empty_list;
+    }
+    #endif
+    empty_dict = PyDict_New();
+    if (unlikely(!empty_dict))
+        goto bad;
+    {
+        #if PY_MAJOR_VERSION >= 3
+        if (level == -1) {
+            if ((1) && (strchr(__Pyx_MODULE_NAME, '.'))) {
+                #if CYTHON_COMPILING_IN_LIMITED_API
+                module = PyImport_ImportModuleLevelObject(
+                    name, empty_dict, empty_dict, from_list, 1);
+                #else
+                module = PyImport_ImportModuleLevelObject(
+                    name, __pyx_d, empty_dict, from_list, 1);
+                #endif
+                if (unlikely(!module)) {
+                    if (unlikely(!PyErr_ExceptionMatches(PyExc_ImportError)))
+                        goto bad;
+                    PyErr_Clear();
+                }
+            }
+            level = 0;
         }
-        if (PyType_IsSubtype(metaclass, tmptype))
-            continue;
-        if (PyType_IsSubtype(tmptype, metaclass)) {
-            metaclass = tmptype;
-            continue;
+        #endif
+        if (!module) {
+            #if PY_MAJOR_VERSION < 3
+            PyObject *py_level = PyInt_FromLong(level);
+            if (unlikely(!py_level))
+                goto bad;
+            module = PyObject_CallFunctionObjArgs(py_import,
+                name, __pyx_d, empty_dict, from_list, py_level, (PyObject *)NULL);
+            Py_DECREF(py_level);
+            #else
+            #if CYTHON_COMPILING_IN_LIMITED_API
+            module = PyImport_ImportModuleLevelObject(
+                name, empty_dict, empty_dict, from_list, level);
+            #else
+            module = PyImport_ImportModuleLevelObject(
+                name, __pyx_d, empty_dict, from_list, level);
+            #endif
+            #endif
         }
-        PyErr_SetString(PyExc_TypeError,
-                        "metaclass conflict: "
-                        "the metaclass of a derived class "
-                        "must be a (non-strict) subclass "
-                        "of the metaclasses of all its bases");
+    }
+bad:
+    Py_XDECREF(empty_dict);
+    Py_XDECREF(empty_list);
+    #if PY_MAJOR_VERSION < 3
+    Py_XDECREF(py_import);
+    #endif
+    return module;
+}
+
+/* ImportDottedModule */
+#if PY_MAJOR_VERSION >= 3
+static PyObject *__Pyx__ImportDottedModule_Error(PyObject *name, PyObject *parts_tuple, Py_ssize_t count) {
+    PyObject *partial_name = NULL, *slice = NULL, *sep = NULL;
+    if (unlikely(PyErr_Occurred())) {
+        PyErr_Clear();
+    }
+    if (likely(PyTuple_GET_SIZE(parts_tuple) == count)) {
+        partial_name = name;
+    } else {
+        slice = PySequence_GetSlice(parts_tuple, 0, count);
+        if (unlikely(!slice))
+            goto bad;
+        sep = PyUnicode_FromStringAndSize(".", 1);
+        if (unlikely(!sep))
+            goto bad;
+        partial_name = PyUnicode_Join(sep, slice);
+    }
+    PyErr_Format(
+#if PY_MAJOR_VERSION < 3
+        PyExc_ImportError,
+        "No module named '%s'", PyString_AS_STRING(partial_name));
+#else
+#if PY_VERSION_HEX >= 0x030600B1
+        PyExc_ModuleNotFoundError,
+#else
+        PyExc_ImportError,
+#endif
+        "No module named '%U'", partial_name);
+#endif
+bad:
+    Py_XDECREF(sep);
+    Py_XDECREF(slice);
+    Py_XDECREF(partial_name);
+    return NULL;
+}
+#endif
+#if PY_MAJOR_VERSION >= 3
+static PyObject *__Pyx__ImportDottedModule_Lookup(PyObject *name) {
+    PyObject *imported_module;
+#if PY_VERSION_HEX < 0x030700A1 || (CYTHON_COMPILING_IN_PYPY && PYPY_VERSION_NUM  < 0x07030400)
+    PyObject *modules = PyImport_GetModuleDict();
+    if (unlikely(!modules))
         return NULL;
+    imported_module = __Pyx_PyDict_GetItemStr(modules, name);
+    Py_XINCREF(imported_module);
+#else
+    imported_module = PyImport_GetModule(name);
+#endif
+    return imported_module;
+}
+#endif
+#if PY_MAJOR_VERSION >= 3
+static PyObject *__Pyx_ImportDottedModule_WalkParts(PyObject *module, PyObject *name, PyObject *parts_tuple) {
+    Py_ssize_t i, nparts;
+    nparts = PyTuple_GET_SIZE(parts_tuple);
+    for (i=1; i < nparts && module; i++) {
+        PyObject *part, *submodule;
+#if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
+        part = PyTuple_GET_ITEM(parts_tuple, i);
+#else
+        part = PySequence_ITEM(parts_tuple, i);
+#endif
+        submodule = __Pyx_PyObject_GetAttrStrNoError(module, part);
+#if !(CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS)
+        Py_DECREF(part);
+#endif
+        Py_DECREF(module);
+        module = submodule;
+    }
+    if (unlikely(!module)) {
+        return __Pyx__ImportDottedModule_Error(name, parts_tuple, i);
     }
-    if (!metaclass) {
+    return module;
+}
+#endif
+static PyObject *__Pyx__ImportDottedModule(PyObject *name, PyObject *parts_tuple) {
 #if PY_MAJOR_VERSION < 3
-        metaclass = &PyClass_Type;
+    PyObject *module, *from_list, *star = __pyx_n_s__4;
+    CYTHON_UNUSED_VAR(parts_tuple);
+    from_list = PyList_New(1);
+    if (unlikely(!from_list))
+        return NULL;
+    Py_INCREF(star);
+    PyList_SET_ITEM(from_list, 0, star);
+    module = __Pyx_Import(name, from_list, 0);
+    Py_DECREF(from_list);
+    return module;
 #else
-        metaclass = &PyType_Type;
+    PyObject *imported_module;
+    PyObject *module = __Pyx_Import(name, NULL, 0);
+    if (!parts_tuple || unlikely(!module))
+        return module;
+    imported_module = __Pyx__ImportDottedModule_Lookup(name);
+    if (likely(imported_module)) {
+        Py_DECREF(module);
+        return imported_module;
+    }
+    PyErr_Clear();
+    return __Pyx_ImportDottedModule_WalkParts(module, name, parts_tuple);
 #endif
+}
+static PyObject *__Pyx_ImportDottedModule(PyObject *name, PyObject *parts_tuple) {
+#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x030400B1
+    PyObject *module = __Pyx__ImportDottedModule_Lookup(name);
+    if (likely(module)) {
+        PyObject *spec = __Pyx_PyObject_GetAttrStrNoError(module, __pyx_n_s_spec);
+        if (likely(spec)) {
+            PyObject *unsafe = __Pyx_PyObject_GetAttrStrNoError(spec, __pyx_n_s_initializing);
+            if (likely(!unsafe || !__Pyx_PyObject_IsTrue(unsafe))) {
+                Py_DECREF(spec);
+                spec = NULL;
+            }
+            Py_XDECREF(unsafe);
+        }
+        if (likely(!spec)) {
+            PyErr_Clear();
+            return module;
+        }
+        Py_DECREF(spec);
+        Py_DECREF(module);
+    } else if (PyErr_Occurred()) {
+        PyErr_Clear();
     }
-    Py_INCREF((PyObject*) metaclass);
-    return (PyObject*) metaclass;
+#endif
+    return __Pyx__ImportDottedModule(name, parts_tuple);
+}
+
+/* FixUpExtensionType */
+#if CYTHON_USE_TYPE_SPECS
+static int __Pyx_fix_up_extension_type_from_spec(PyType_Spec *spec, PyTypeObject *type) {
+#if PY_VERSION_HEX > 0x030900B1 || CYTHON_COMPILING_IN_LIMITED_API
+    CYTHON_UNUSED_VAR(spec);
+    CYTHON_UNUSED_VAR(type);
+#else
+    const PyType_Slot *slot = spec->slots;
+    while (slot && slot->slot && slot->slot != Py_tp_members)
+        slot++;
+    if (slot && slot->slot == Py_tp_members) {
+        int changed = 0;
+#if !(PY_VERSION_HEX <= 0x030900b1 && CYTHON_COMPILING_IN_CPYTHON)
+        const
+#endif
+            PyMemberDef *memb = (PyMemberDef*) slot->pfunc;
+        while (memb && memb->name) {
+            if (memb->name[0] == '_' && memb->name[1] == '_') {
+#if PY_VERSION_HEX < 0x030900b1
+                if (strcmp(memb->name, "__weaklistoffset__") == 0) {
+                    assert(memb->type == T_PYSSIZET);
+                    assert(memb->flags == READONLY);
+                    type->tp_weaklistoffset = memb->offset;
+                    changed = 1;
+                }
+                else if (strcmp(memb->name, "__dictoffset__") == 0) {
+                    assert(memb->type == T_PYSSIZET);
+                    assert(memb->flags == READONLY);
+                    type->tp_dictoffset = memb->offset;
+                    changed = 1;
+                }
+#if CYTHON_METH_FASTCALL
+                else if (strcmp(memb->name, "__vectorcalloffset__") == 0) {
+                    assert(memb->type == T_PYSSIZET);
+                    assert(memb->flags == READONLY);
+#if PY_VERSION_HEX >= 0x030800b4
+                    type->tp_vectorcall_offset = memb->offset;
+#else
+                    type->tp_print = (printfunc) memb->offset;
+#endif
+                    changed = 1;
+                }
+#endif
+#else
+                if ((0));
+#endif
+#if PY_VERSION_HEX <= 0x030900b1 && CYTHON_COMPILING_IN_CPYTHON
+                else if (strcmp(memb->name, "__module__") == 0) {
+                    PyObject *descr;
+                    assert(memb->type == T_OBJECT);
+                    assert(memb->flags == 0 || memb->flags == READONLY);
+                    descr = PyDescr_NewMember(type, memb);
+                    if (unlikely(!descr))
+                        return -1;
+                    if (unlikely(PyDict_SetItem(type->tp_dict, PyDescr_NAME(descr), descr) < 0)) {
+                        Py_DECREF(descr);
+                        return -1;
+                    }
+                    Py_DECREF(descr);
+                    changed = 1;
+                }
+#endif
+            }
+            memb++;
+        }
+        if (changed)
+            PyType_Modified(type);
+    }
+#endif
+    return 0;
+}
+#endif
+
+/* FetchSharedCythonModule */
+static PyObject *__Pyx_FetchSharedCythonABIModule(void) {
+    PyObject *abi_module = PyImport_AddModule((char*) __PYX_ABI_MODULE_NAME);
+    if (unlikely(!abi_module)) return NULL;
+    Py_INCREF(abi_module);
+    return abi_module;
 }
 
 /* FetchCommonType */
+static int __Pyx_VerifyCachedType(PyObject *cached_type,
+                               const char *name,
+                               Py_ssize_t basicsize,
+                               Py_ssize_t expected_basicsize) {
+    if (!PyType_Check(cached_type)) {
+        PyErr_Format(PyExc_TypeError,
+            "Shared Cython type %.200s is not a type object", name);
+        return -1;
+    }
+    if (basicsize != expected_basicsize) {
+        PyErr_Format(PyExc_TypeError,
+            "Shared Cython type %.200s has the wrong size, try recompiling",
+            name);
+        return -1;
+    }
+    return 0;
+}
+#if !CYTHON_USE_TYPE_SPECS
 static PyTypeObject* __Pyx_FetchCommonType(PyTypeObject* type) {
-    PyObject* fake_module;
-    PyTypeObject* cached_type = NULL;
-    fake_module = PyImport_AddModule((char*) "_cython_" CYTHON_ABI);
-    if (!fake_module) return NULL;
-    Py_INCREF(fake_module);
-    cached_type = (PyTypeObject*) PyObject_GetAttrString(fake_module, type->tp_name);
+    PyObject* abi_module;
+    const char* object_name;
+    PyTypeObject *cached_type = NULL;
+    abi_module = __Pyx_FetchSharedCythonABIModule();
+    if (!abi_module) return NULL;
+    object_name = strrchr(type->tp_name, '.');
+    object_name = object_name ? object_name+1 : type->tp_name;
+    cached_type = (PyTypeObject*) PyObject_GetAttrString(abi_module, object_name);
     if (cached_type) {
-        if (!PyType_Check((PyObject*)cached_type)) {
-            PyErr_Format(PyExc_TypeError,
-                "Shared Cython type %.200s is not a type object",
-                type->tp_name);
+        if (__Pyx_VerifyCachedType(
+              (PyObject *)cached_type,
+              object_name,
+              cached_type->tp_basicsize,
+              type->tp_basicsize) < 0) {
             goto bad;
         }
-        if (cached_type->tp_basicsize != type->tp_basicsize) {
-            PyErr_Format(PyExc_TypeError,
-                "Shared Cython type %.200s has the wrong size, try recompiling",
-                type->tp_name);
+        goto done;
+    }
+    if (!PyErr_ExceptionMatches(PyExc_AttributeError)) goto bad;
+    PyErr_Clear();
+    if (PyType_Ready(type) < 0) goto bad;
+    if (PyObject_SetAttrString(abi_module, object_name, (PyObject *)type) < 0)
+        goto bad;
+    Py_INCREF(type);
+    cached_type = type;
+done:
+    Py_DECREF(abi_module);
+    return cached_type;
+bad:
+    Py_XDECREF(cached_type);
+    cached_type = NULL;
+    goto done;
+}
+#else
+static PyTypeObject *__Pyx_FetchCommonTypeFromSpec(PyObject *module, PyType_Spec *spec, PyObject *bases) {
+    PyObject *abi_module, *cached_type = NULL;
+    const char* object_name = strrchr(spec->name, '.');
+    object_name = object_name ? object_name+1 : spec->name;
+    abi_module = __Pyx_FetchSharedCythonABIModule();
+    if (!abi_module) return NULL;
+    cached_type = PyObject_GetAttrString(abi_module, object_name);
+    if (cached_type) {
+        Py_ssize_t basicsize;
+#if CYTHON_COMPILING_IN_LIMITED_API
+        PyObject *py_basicsize;
+        py_basicsize = PyObject_GetAttrString(cached_type, "__basicsize__");
+        if (unlikely(!py_basicsize)) goto bad;
+        basicsize = PyLong_AsSsize_t(py_basicsize);
+        Py_DECREF(py_basicsize);
+        py_basicsize = 0;
+        if (unlikely(basicsize == (Py_ssize_t)-1) && PyErr_Occurred()) goto bad;
+#else
+        basicsize = likely(PyType_Check(cached_type)) ? ((PyTypeObject*) cached_type)->tp_basicsize : -1;
+#endif
+        if (__Pyx_VerifyCachedType(
+              cached_type,
+              object_name,
+              basicsize,
+              spec->basicsize) < 0) {
             goto bad;
         }
-    } else {
-        if (!PyErr_ExceptionMatches(PyExc_AttributeError)) goto bad;
-        PyErr_Clear();
-        if (PyType_Ready(type) < 0) goto bad;
-        if (PyObject_SetAttrString(fake_module, type->tp_name, (PyObject*) type) < 0)
-            goto bad;
-        Py_INCREF(type);
-        cached_type = type;
+        goto done;
     }
+    if (!PyErr_ExceptionMatches(PyExc_AttributeError)) goto bad;
+    PyErr_Clear();
+    CYTHON_UNUSED_VAR(module);
+    cached_type = __Pyx_PyType_FromModuleAndSpec(abi_module, spec, bases);
+    if (unlikely(!cached_type)) goto bad;
+    if (unlikely(__Pyx_fix_up_extension_type_from_spec(spec, (PyTypeObject *) cached_type) < 0)) goto bad;
+    if (PyObject_SetAttrString(abi_module, object_name, cached_type) < 0) goto bad;
 done:
-    Py_DECREF(fake_module);
-    return cached_type;
+    Py_DECREF(abi_module);
+    assert(cached_type == NULL || PyType_Check(cached_type));
+    return (PyTypeObject *) cached_type;
 bad:
     Py_XDECREF(cached_type);
     cached_type = NULL;
     goto done;
 }
+#endif
+
+/* PyVectorcallFastCallDict */
+#if CYTHON_METH_FASTCALL
+static PyObject *__Pyx_PyVectorcall_FastCallDict_kw(PyObject *func, __pyx_vectorcallfunc vc, PyObject *const *args, size_t nargs, PyObject *kw)
+{
+    PyObject *res = NULL;
+    PyObject *kwnames;
+    PyObject **newargs;
+    PyObject **kwvalues;
+    Py_ssize_t i, pos;
+    size_t j;
+    PyObject *key, *value;
+    unsigned long keys_are_strings;
+    Py_ssize_t nkw = PyDict_GET_SIZE(kw);
+    newargs = (PyObject **)PyMem_Malloc((nargs + (size_t)nkw) * sizeof(args[0]));
+    if (unlikely(newargs == NULL)) {
+        PyErr_NoMemory();
+        return NULL;
+    }
+    for (j = 0; j < nargs; j++) newargs[j] = args[j];
+    kwnames = PyTuple_New(nkw);
+    if (unlikely(kwnames == NULL)) {
+        PyMem_Free(newargs);
+        return NULL;
+    }
+    kwvalues = newargs + nargs;
+    pos = i = 0;
+    keys_are_strings = Py_TPFLAGS_UNICODE_SUBCLASS;
+    while (PyDict_Next(kw, &pos, &key, &value)) {
+        keys_are_strings &= Py_TYPE(key)->tp_flags;
+        Py_INCREF(key);
+        Py_INCREF(value);
+        PyTuple_SET_ITEM(kwnames, i, key);
+        kwvalues[i] = value;
+        i++;
+    }
+    if (unlikely(!keys_are_strings)) {
+        PyErr_SetString(PyExc_TypeError, "keywords must be strings");
+        goto cleanup;
+    }
+    res = vc(func, newargs, nargs, kwnames);
+cleanup:
+    Py_DECREF(kwnames);
+    for (i = 0; i < nkw; i++)
+        Py_DECREF(kwvalues[i]);
+    PyMem_Free(newargs);
+    return res;
+}
+static CYTHON_INLINE PyObject *__Pyx_PyVectorcall_FastCallDict(PyObject *func, __pyx_vectorcallfunc vc, PyObject *const *args, size_t nargs, PyObject *kw)
+{
+    if (likely(kw == NULL) || PyDict_GET_SIZE(kw) == 0) {
+        return vc(func, args, nargs, NULL);
+    }
+    return __Pyx_PyVectorcall_FastCallDict_kw(func, vc, args, nargs, kw);
+}
+#endif
 
 /* CythonFunctionShared */
-#include <structmember.h>
+static CYTHON_INLINE void __Pyx__CyFunction_SetClassObj(__pyx_CyFunctionObject* f, PyObject* classobj) {
+#if PY_VERSION_HEX < 0x030900B1
+    __Pyx_Py_XDECREF_SET(
+        __Pyx_CyFunction_GetClassObj(f),
+            ((classobj) ? __Pyx_NewRef(classobj) : NULL));
+#else
+    __Pyx_Py_XDECREF_SET(
+        ((PyCMethodObject *) (f))->mm_class,
+        (PyTypeObject*)((classobj) ? __Pyx_NewRef(classobj) : NULL));
+#endif
+}
 static PyObject *
-__Pyx_CyFunction_get_doc(__pyx_CyFunctionObject *op, CYTHON_UNUSED void *closure)
+__Pyx_CyFunction_get_doc(__pyx_CyFunctionObject *op, void *closure)
 {
+    CYTHON_UNUSED_VAR(closure);
     if (unlikely(op->func_doc == NULL)) {
-        if (op->func.m_ml->ml_doc) {
+        if (((PyCFunctionObject*)op)->m_ml->ml_doc) {
 #if PY_MAJOR_VERSION >= 3
-            op->func_doc = PyUnicode_FromString(op->func.m_ml->ml_doc);
+            op->func_doc = PyUnicode_FromString(((PyCFunctionObject*)op)->m_ml->ml_doc);
 #else
-            op->func_doc = PyString_FromString(op->func.m_ml->ml_doc);
+            op->func_doc = PyString_FromString(((PyCFunctionObject*)op)->m_ml->ml_doc);
 #endif
             if (unlikely(op->func_doc == NULL))
                 return NULL;
         } else {
             Py_INCREF(Py_None);
             return Py_None;
         }
     }
     Py_INCREF(op->func_doc);
     return op->func_doc;
 }
 static int
-__Pyx_CyFunction_set_doc(__pyx_CyFunctionObject *op, PyObject *value, CYTHON_UNUSED void *context)
+__Pyx_CyFunction_set_doc(__pyx_CyFunctionObject *op, PyObject *value, void *context)
 {
-    PyObject *tmp = op->func_doc;
+    CYTHON_UNUSED_VAR(context);
     if (value == NULL) {
         value = Py_None;
     }
     Py_INCREF(value);
-    op->func_doc = value;
-    Py_XDECREF(tmp);
+    __Pyx_Py_XDECREF_SET(op->func_doc, value);
     return 0;
 }
 static PyObject *
-__Pyx_CyFunction_get_name(__pyx_CyFunctionObject *op, CYTHON_UNUSED void *context)
+__Pyx_CyFunction_get_name(__pyx_CyFunctionObject *op, void *context)
 {
+    CYTHON_UNUSED_VAR(context);
     if (unlikely(op->func_name == NULL)) {
 #if PY_MAJOR_VERSION >= 3
-        op->func_name = PyUnicode_InternFromString(op->func.m_ml->ml_name);
+        op->func_name = PyUnicode_InternFromString(((PyCFunctionObject*)op)->m_ml->ml_name);
 #else
-        op->func_name = PyString_InternFromString(op->func.m_ml->ml_name);
+        op->func_name = PyString_InternFromString(((PyCFunctionObject*)op)->m_ml->ml_name);
 #endif
         if (unlikely(op->func_name == NULL))
             return NULL;
     }
     Py_INCREF(op->func_name);
     return op->func_name;
 }
 static int
-__Pyx_CyFunction_set_name(__pyx_CyFunctionObject *op, PyObject *value, CYTHON_UNUSED void *context)
+__Pyx_CyFunction_set_name(__pyx_CyFunctionObject *op, PyObject *value, void *context)
 {
-    PyObject *tmp;
+    CYTHON_UNUSED_VAR(context);
 #if PY_MAJOR_VERSION >= 3
     if (unlikely(value == NULL || !PyUnicode_Check(value)))
 #else
     if (unlikely(value == NULL || !PyString_Check(value)))
 #endif
     {
         PyErr_SetString(PyExc_TypeError,
                         "__name__ must be set to a string object");
         return -1;
     }
-    tmp = op->func_name;
     Py_INCREF(value);
-    op->func_name = value;
-    Py_XDECREF(tmp);
+    __Pyx_Py_XDECREF_SET(op->func_name, value);
     return 0;
 }
 static PyObject *
-__Pyx_CyFunction_get_qualname(__pyx_CyFunctionObject *op, CYTHON_UNUSED void *context)
+__Pyx_CyFunction_get_qualname(__pyx_CyFunctionObject *op, void *context)
 {
+    CYTHON_UNUSED_VAR(context);
     Py_INCREF(op->func_qualname);
     return op->func_qualname;
 }
 static int
-__Pyx_CyFunction_set_qualname(__pyx_CyFunctionObject *op, PyObject *value, CYTHON_UNUSED void *context)
+__Pyx_CyFunction_set_qualname(__pyx_CyFunctionObject *op, PyObject *value, void *context)
 {
-    PyObject *tmp;
+    CYTHON_UNUSED_VAR(context);
 #if PY_MAJOR_VERSION >= 3
     if (unlikely(value == NULL || !PyUnicode_Check(value)))
 #else
     if (unlikely(value == NULL || !PyString_Check(value)))
 #endif
     {
         PyErr_SetString(PyExc_TypeError,
                         "__qualname__ must be set to a string object");
         return -1;
     }
-    tmp = op->func_qualname;
     Py_INCREF(value);
-    op->func_qualname = value;
-    Py_XDECREF(tmp);
+    __Pyx_Py_XDECREF_SET(op->func_qualname, value);
     return 0;
 }
 static PyObject *
-__Pyx_CyFunction_get_self(__pyx_CyFunctionObject *m, CYTHON_UNUSED void *closure)
-{
-    PyObject *self;
-    self = m->func_closure;
-    if (self == NULL)
-        self = Py_None;
-    Py_INCREF(self);
-    return self;
-}
-static PyObject *
-__Pyx_CyFunction_get_dict(__pyx_CyFunctionObject *op, CYTHON_UNUSED void *context)
+__Pyx_CyFunction_get_dict(__pyx_CyFunctionObject *op, void *context)
 {
+    CYTHON_UNUSED_VAR(context);
     if (unlikely(op->func_dict == NULL)) {
         op->func_dict = PyDict_New();
         if (unlikely(op->func_dict == NULL))
             return NULL;
     }
     Py_INCREF(op->func_dict);
     return op->func_dict;
 }
 static int
-__Pyx_CyFunction_set_dict(__pyx_CyFunctionObject *op, PyObject *value, CYTHON_UNUSED void *context)
+__Pyx_CyFunction_set_dict(__pyx_CyFunctionObject *op, PyObject *value, void *context)
 {
-    PyObject *tmp;
+    CYTHON_UNUSED_VAR(context);
     if (unlikely(value == NULL)) {
         PyErr_SetString(PyExc_TypeError,
                "function's dictionary may not be deleted");
         return -1;
     }
     if (unlikely(!PyDict_Check(value))) {
         PyErr_SetString(PyExc_TypeError,
                "setting function's dictionary to a non-dict");
         return -1;
     }
-    tmp = op->func_dict;
     Py_INCREF(value);
-    op->func_dict = value;
-    Py_XDECREF(tmp);
+    __Pyx_Py_XDECREF_SET(op->func_dict, value);
     return 0;
 }
 static PyObject *
-__Pyx_CyFunction_get_globals(__pyx_CyFunctionObject *op, CYTHON_UNUSED void *context)
+__Pyx_CyFunction_get_globals(__pyx_CyFunctionObject *op, void *context)
 {
+    CYTHON_UNUSED_VAR(context);
     Py_INCREF(op->func_globals);
     return op->func_globals;
 }
 static PyObject *
-__Pyx_CyFunction_get_closure(CYTHON_UNUSED __pyx_CyFunctionObject *op, CYTHON_UNUSED void *context)
+__Pyx_CyFunction_get_closure(__pyx_CyFunctionObject *op, void *context)
 {
+    CYTHON_UNUSED_VAR(op);
+    CYTHON_UNUSED_VAR(context);
     Py_INCREF(Py_None);
     return Py_None;
 }
 static PyObject *
-__Pyx_CyFunction_get_code(__pyx_CyFunctionObject *op, CYTHON_UNUSED void *context)
+__Pyx_CyFunction_get_code(__pyx_CyFunctionObject *op, void *context)
 {
     PyObject* result = (op->func_code) ? op->func_code : Py_None;
+    CYTHON_UNUSED_VAR(context);
     Py_INCREF(result);
     return result;
 }
 static int
 __Pyx_CyFunction_init_defaults(__pyx_CyFunctionObject *op) {
     int result = 0;
     PyObject *res = op->defaults_getter((PyObject *) op);
@@ -5681,189 +6730,275 @@
         if (unlikely(!op->defaults_kwdict)) result = -1;
     }
     #endif
     Py_DECREF(res);
     return result;
 }
 static int
-__Pyx_CyFunction_set_defaults(__pyx_CyFunctionObject *op, PyObject* value, CYTHON_UNUSED void *context) {
-    PyObject* tmp;
+__Pyx_CyFunction_set_defaults(__pyx_CyFunctionObject *op, PyObject* value, void *context) {
+    CYTHON_UNUSED_VAR(context);
     if (!value) {
         value = Py_None;
-    } else if (value != Py_None && !PyTuple_Check(value)) {
+    } else if (unlikely(value != Py_None && !PyTuple_Check(value))) {
         PyErr_SetString(PyExc_TypeError,
                         "__defaults__ must be set to a tuple object");
         return -1;
     }
+    PyErr_WarnEx(PyExc_RuntimeWarning, "changes to cyfunction.__defaults__ will not "
+                 "currently affect the values used in function calls", 1);
     Py_INCREF(value);
-    tmp = op->defaults_tuple;
-    op->defaults_tuple = value;
-    Py_XDECREF(tmp);
+    __Pyx_Py_XDECREF_SET(op->defaults_tuple, value);
     return 0;
 }
 static PyObject *
-__Pyx_CyFunction_get_defaults(__pyx_CyFunctionObject *op, CYTHON_UNUSED void *context) {
+__Pyx_CyFunction_get_defaults(__pyx_CyFunctionObject *op, void *context) {
     PyObject* result = op->defaults_tuple;
+    CYTHON_UNUSED_VAR(context);
     if (unlikely(!result)) {
         if (op->defaults_getter) {
-            if (__Pyx_CyFunction_init_defaults(op) < 0) return NULL;
+            if (unlikely(__Pyx_CyFunction_init_defaults(op) < 0)) return NULL;
             result = op->defaults_tuple;
         } else {
             result = Py_None;
         }
     }
     Py_INCREF(result);
     return result;
 }
 static int
-__Pyx_CyFunction_set_kwdefaults(__pyx_CyFunctionObject *op, PyObject* value, CYTHON_UNUSED void *context) {
-    PyObject* tmp;
+__Pyx_CyFunction_set_kwdefaults(__pyx_CyFunctionObject *op, PyObject* value, void *context) {
+    CYTHON_UNUSED_VAR(context);
     if (!value) {
         value = Py_None;
-    } else if (value != Py_None && !PyDict_Check(value)) {
+    } else if (unlikely(value != Py_None && !PyDict_Check(value))) {
         PyErr_SetString(PyExc_TypeError,
                         "__kwdefaults__ must be set to a dict object");
         return -1;
     }
+    PyErr_WarnEx(PyExc_RuntimeWarning, "changes to cyfunction.__kwdefaults__ will not "
+                 "currently affect the values used in function calls", 1);
     Py_INCREF(value);
-    tmp = op->defaults_kwdict;
-    op->defaults_kwdict = value;
-    Py_XDECREF(tmp);
+    __Pyx_Py_XDECREF_SET(op->defaults_kwdict, value);
     return 0;
 }
 static PyObject *
-__Pyx_CyFunction_get_kwdefaults(__pyx_CyFunctionObject *op, CYTHON_UNUSED void *context) {
+__Pyx_CyFunction_get_kwdefaults(__pyx_CyFunctionObject *op, void *context) {
     PyObject* result = op->defaults_kwdict;
+    CYTHON_UNUSED_VAR(context);
     if (unlikely(!result)) {
         if (op->defaults_getter) {
-            if (__Pyx_CyFunction_init_defaults(op) < 0) return NULL;
+            if (unlikely(__Pyx_CyFunction_init_defaults(op) < 0)) return NULL;
             result = op->defaults_kwdict;
         } else {
             result = Py_None;
         }
     }
     Py_INCREF(result);
     return result;
 }
 static int
-__Pyx_CyFunction_set_annotations(__pyx_CyFunctionObject *op, PyObject* value, CYTHON_UNUSED void *context) {
-    PyObject* tmp;
+__Pyx_CyFunction_set_annotations(__pyx_CyFunctionObject *op, PyObject* value, void *context) {
+    CYTHON_UNUSED_VAR(context);
     if (!value || value == Py_None) {
         value = NULL;
-    } else if (!PyDict_Check(value)) {
+    } else if (unlikely(!PyDict_Check(value))) {
         PyErr_SetString(PyExc_TypeError,
                         "__annotations__ must be set to a dict object");
         return -1;
     }
     Py_XINCREF(value);
-    tmp = op->func_annotations;
-    op->func_annotations = value;
-    Py_XDECREF(tmp);
+    __Pyx_Py_XDECREF_SET(op->func_annotations, value);
     return 0;
 }
 static PyObject *
-__Pyx_CyFunction_get_annotations(__pyx_CyFunctionObject *op, CYTHON_UNUSED void *context) {
+__Pyx_CyFunction_get_annotations(__pyx_CyFunctionObject *op, void *context) {
     PyObject* result = op->func_annotations;
+    CYTHON_UNUSED_VAR(context);
     if (unlikely(!result)) {
         result = PyDict_New();
         if (unlikely(!result)) return NULL;
         op->func_annotations = result;
     }
     Py_INCREF(result);
     return result;
 }
+static PyObject *
+__Pyx_CyFunction_get_is_coroutine(__pyx_CyFunctionObject *op, void *context) {
+    int is_coroutine;
+    CYTHON_UNUSED_VAR(context);
+    if (op->func_is_coroutine) {
+        return __Pyx_NewRef(op->func_is_coroutine);
+    }
+    is_coroutine = op->flags & __Pyx_CYFUNCTION_COROUTINE;
+#if PY_VERSION_HEX >= 0x03050000
+    if (is_coroutine) {
+        PyObject *module, *fromlist, *marker = __pyx_n_s_is_coroutine;
+        fromlist = PyList_New(1);
+        if (unlikely(!fromlist)) return NULL;
+        Py_INCREF(marker);
+        PyList_SET_ITEM(fromlist, 0, marker);
+        module = PyImport_ImportModuleLevelObject(__pyx_n_s_asyncio_coroutines, NULL, NULL, fromlist, 0);
+        Py_DECREF(fromlist);
+        if (unlikely(!module)) goto ignore;
+        op->func_is_coroutine = __Pyx_PyObject_GetAttrStr(module, marker);
+        Py_DECREF(module);
+        if (likely(op->func_is_coroutine)) {
+            return __Pyx_NewRef(op->func_is_coroutine);
+        }
+ignore:
+        PyErr_Clear();
+    }
+#endif
+    op->func_is_coroutine = __Pyx_PyBool_FromLong(is_coroutine);
+    return __Pyx_NewRef(op->func_is_coroutine);
+}
 static PyGetSetDef __pyx_CyFunction_getsets[] = {
     {(char *) "func_doc", (getter)__Pyx_CyFunction_get_doc, (setter)__Pyx_CyFunction_set_doc, 0, 0},
     {(char *) "__doc__",  (getter)__Pyx_CyFunction_get_doc, (setter)__Pyx_CyFunction_set_doc, 0, 0},
     {(char *) "func_name", (getter)__Pyx_CyFunction_get_name, (setter)__Pyx_CyFunction_set_name, 0, 0},
     {(char *) "__name__", (getter)__Pyx_CyFunction_get_name, (setter)__Pyx_CyFunction_set_name, 0, 0},
     {(char *) "__qualname__", (getter)__Pyx_CyFunction_get_qualname, (setter)__Pyx_CyFunction_set_qualname, 0, 0},
-    {(char *) "__self__", (getter)__Pyx_CyFunction_get_self, 0, 0, 0},
     {(char *) "func_dict", (getter)__Pyx_CyFunction_get_dict, (setter)__Pyx_CyFunction_set_dict, 0, 0},
     {(char *) "__dict__", (getter)__Pyx_CyFunction_get_dict, (setter)__Pyx_CyFunction_set_dict, 0, 0},
     {(char *) "func_globals", (getter)__Pyx_CyFunction_get_globals, 0, 0, 0},
     {(char *) "__globals__", (getter)__Pyx_CyFunction_get_globals, 0, 0, 0},
     {(char *) "func_closure", (getter)__Pyx_CyFunction_get_closure, 0, 0, 0},
     {(char *) "__closure__", (getter)__Pyx_CyFunction_get_closure, 0, 0, 0},
     {(char *) "func_code", (getter)__Pyx_CyFunction_get_code, 0, 0, 0},
     {(char *) "__code__", (getter)__Pyx_CyFunction_get_code, 0, 0, 0},
     {(char *) "func_defaults", (getter)__Pyx_CyFunction_get_defaults, (setter)__Pyx_CyFunction_set_defaults, 0, 0},
     {(char *) "__defaults__", (getter)__Pyx_CyFunction_get_defaults, (setter)__Pyx_CyFunction_set_defaults, 0, 0},
     {(char *) "__kwdefaults__", (getter)__Pyx_CyFunction_get_kwdefaults, (setter)__Pyx_CyFunction_set_kwdefaults, 0, 0},
     {(char *) "__annotations__", (getter)__Pyx_CyFunction_get_annotations, (setter)__Pyx_CyFunction_set_annotations, 0, 0},
+    {(char *) "_is_coroutine", (getter)__Pyx_CyFunction_get_is_coroutine, 0, 0, 0},
     {0, 0, 0, 0, 0}
 };
 static PyMemberDef __pyx_CyFunction_members[] = {
-    {(char *) "__module__", T_OBJECT, offsetof(PyCFunctionObject, m_module), PY_WRITE_RESTRICTED, 0},
+    {(char *) "__module__", T_OBJECT, offsetof(PyCFunctionObject, m_module), 0, 0},
+#if CYTHON_USE_TYPE_SPECS
+    {(char *) "__dictoffset__", T_PYSSIZET, offsetof(__pyx_CyFunctionObject, func_dict), READONLY, 0},
+#if CYTHON_METH_FASTCALL
+#if CYTHON_BACKPORT_VECTORCALL
+    {(char *) "__vectorcalloffset__", T_PYSSIZET, offsetof(__pyx_CyFunctionObject, func_vectorcall), READONLY, 0},
+#else
+    {(char *) "__vectorcalloffset__", T_PYSSIZET, offsetof(PyCFunctionObject, vectorcall), READONLY, 0},
+#endif
+#endif
+#if PY_VERSION_HEX < 0x030500A0
+    {(char *) "__weaklistoffset__", T_PYSSIZET, offsetof(__pyx_CyFunctionObject, func_weakreflist), READONLY, 0},
+#else
+    {(char *) "__weaklistoffset__", T_PYSSIZET, offsetof(PyCFunctionObject, m_weakreflist), READONLY, 0},
+#endif
+#endif
     {0, 0, 0,  0, 0}
 };
 static PyObject *
-__Pyx_CyFunction_reduce(__pyx_CyFunctionObject *m, CYTHON_UNUSED PyObject *args)
+__Pyx_CyFunction_reduce(__pyx_CyFunctionObject *m, PyObject *args)
 {
+    CYTHON_UNUSED_VAR(args);
 #if PY_MAJOR_VERSION >= 3
-    return PyUnicode_FromString(m->func.m_ml->ml_name);
+    Py_INCREF(m->func_qualname);
+    return m->func_qualname;
 #else
-    return PyString_FromString(m->func.m_ml->ml_name);
+    return PyString_FromString(((PyCFunctionObject*)m)->m_ml->ml_name);
 #endif
 }
 static PyMethodDef __pyx_CyFunction_methods[] = {
     {"__reduce__", (PyCFunction)__Pyx_CyFunction_reduce, METH_VARARGS, 0},
     {0, 0, 0, 0}
 };
 #if PY_VERSION_HEX < 0x030500A0
 #define __Pyx_CyFunction_weakreflist(cyfunc) ((cyfunc)->func_weakreflist)
 #else
-#define __Pyx_CyFunction_weakreflist(cyfunc) ((cyfunc)->func.m_weakreflist)
+#define __Pyx_CyFunction_weakreflist(cyfunc) (((PyCFunctionObject*)cyfunc)->m_weakreflist)
 #endif
 static PyObject *__Pyx_CyFunction_Init(__pyx_CyFunctionObject *op, PyMethodDef *ml, int flags, PyObject* qualname,
                                        PyObject *closure, PyObject *module, PyObject* globals, PyObject* code) {
+    PyCFunctionObject *cf = (PyCFunctionObject*) op;
     if (unlikely(op == NULL))
         return NULL;
     op->flags = flags;
     __Pyx_CyFunction_weakreflist(op) = NULL;
-    op->func.m_ml = ml;
-    op->func.m_self = (PyObject *) op;
+    cf->m_ml = ml;
+    cf->m_self = (PyObject *) op;
     Py_XINCREF(closure);
     op->func_closure = closure;
     Py_XINCREF(module);
-    op->func.m_module = module;
+    cf->m_module = module;
     op->func_dict = NULL;
     op->func_name = NULL;
     Py_INCREF(qualname);
     op->func_qualname = qualname;
     op->func_doc = NULL;
+#if PY_VERSION_HEX < 0x030900B1
     op->func_classobj = NULL;
+#else
+    ((PyCMethodObject*)op)->mm_class = NULL;
+#endif
     op->func_globals = globals;
     Py_INCREF(op->func_globals);
     Py_XINCREF(code);
     op->func_code = code;
     op->defaults_pyobjects = 0;
     op->defaults_size = 0;
     op->defaults = NULL;
     op->defaults_tuple = NULL;
     op->defaults_kwdict = NULL;
     op->defaults_getter = NULL;
     op->func_annotations = NULL;
+    op->func_is_coroutine = NULL;
+#if CYTHON_METH_FASTCALL
+    switch (ml->ml_flags & (METH_VARARGS | METH_FASTCALL | METH_NOARGS | METH_O | METH_KEYWORDS | METH_METHOD)) {
+    case METH_NOARGS:
+        __Pyx_CyFunction_func_vectorcall(op) = __Pyx_CyFunction_Vectorcall_NOARGS;
+        break;
+    case METH_O:
+        __Pyx_CyFunction_func_vectorcall(op) = __Pyx_CyFunction_Vectorcall_O;
+        break;
+    case METH_METHOD | METH_FASTCALL | METH_KEYWORDS:
+        __Pyx_CyFunction_func_vectorcall(op) = __Pyx_CyFunction_Vectorcall_FASTCALL_KEYWORDS_METHOD;
+        break;
+    case METH_FASTCALL | METH_KEYWORDS:
+        __Pyx_CyFunction_func_vectorcall(op) = __Pyx_CyFunction_Vectorcall_FASTCALL_KEYWORDS;
+        break;
+    case METH_VARARGS | METH_KEYWORDS:
+        __Pyx_CyFunction_func_vectorcall(op) = NULL;
+        break;
+    default:
+        PyErr_SetString(PyExc_SystemError, "Bad call flags for CyFunction");
+        Py_DECREF(op);
+        return NULL;
+    }
+#endif
     return (PyObject *) op;
 }
 static int
 __Pyx_CyFunction_clear(__pyx_CyFunctionObject *m)
 {
     Py_CLEAR(m->func_closure);
-    Py_CLEAR(m->func.m_module);
+    Py_CLEAR(((PyCFunctionObject*)m)->m_module);
     Py_CLEAR(m->func_dict);
     Py_CLEAR(m->func_name);
     Py_CLEAR(m->func_qualname);
     Py_CLEAR(m->func_doc);
     Py_CLEAR(m->func_globals);
     Py_CLEAR(m->func_code);
-    Py_CLEAR(m->func_classobj);
+#if PY_VERSION_HEX < 0x030900B1
+    Py_CLEAR(__Pyx_CyFunction_GetClassObj(m));
+#else
+    {
+        PyObject *cls = (PyObject*) ((PyCMethodObject *) (m))->mm_class;
+        ((PyCMethodObject *) (m))->mm_class = NULL;
+        Py_XDECREF(cls);
+    }
+#endif
     Py_CLEAR(m->defaults_tuple);
     Py_CLEAR(m->defaults_kwdict);
     Py_CLEAR(m->func_annotations);
+    Py_CLEAR(m->func_is_coroutine);
     if (m->defaults) {
         PyObject **pydefaults = __Pyx_CyFunction_Defaults(PyObject *, m);
         int i;
         for (i = 0; i < m->defaults_pyobjects; i++)
             Py_XDECREF(pydefaults[i]);
         PyObject_Free(m->defaults);
         m->defaults = NULL;
@@ -5871,60 +7006,43 @@
     return 0;
 }
 static void __Pyx__CyFunction_dealloc(__pyx_CyFunctionObject *m)
 {
     if (__Pyx_CyFunction_weakreflist(m) != NULL)
         PyObject_ClearWeakRefs((PyObject *) m);
     __Pyx_CyFunction_clear(m);
-    PyObject_GC_Del(m);
+    __Pyx_PyHeapTypeObject_GC_Del(m);
 }
 static void __Pyx_CyFunction_dealloc(__pyx_CyFunctionObject *m)
 {
     PyObject_GC_UnTrack(m);
     __Pyx__CyFunction_dealloc(m);
 }
 static int __Pyx_CyFunction_traverse(__pyx_CyFunctionObject *m, visitproc visit, void *arg)
 {
     Py_VISIT(m->func_closure);
-    Py_VISIT(m->func.m_module);
+    Py_VISIT(((PyCFunctionObject*)m)->m_module);
     Py_VISIT(m->func_dict);
     Py_VISIT(m->func_name);
     Py_VISIT(m->func_qualname);
     Py_VISIT(m->func_doc);
     Py_VISIT(m->func_globals);
     Py_VISIT(m->func_code);
-    Py_VISIT(m->func_classobj);
+    Py_VISIT(__Pyx_CyFunction_GetClassObj(m));
     Py_VISIT(m->defaults_tuple);
     Py_VISIT(m->defaults_kwdict);
+    Py_VISIT(m->func_is_coroutine);
     if (m->defaults) {
         PyObject **pydefaults = __Pyx_CyFunction_Defaults(PyObject *, m);
         int i;
         for (i = 0; i < m->defaults_pyobjects; i++)
             Py_VISIT(pydefaults[i]);
     }
     return 0;
 }
-static PyObject *__Pyx_CyFunction_descr_get(PyObject *func, PyObject *obj, PyObject *type)
-{
-#if PY_MAJOR_VERSION < 3
-    __pyx_CyFunctionObject *m = (__pyx_CyFunctionObject *) func;
-    if (m->flags & __Pyx_CYFUNCTION_STATICMETHOD) {
-        Py_INCREF(func);
-        return func;
-    }
-    if (m->flags & __Pyx_CYFUNCTION_CLASSMETHOD) {
-        if (type == NULL)
-            type = (PyObject *)(Py_TYPE(obj));
-        return __Pyx_PyMethod_New(func, type, (PyObject *)(Py_TYPE(type)));
-    }
-    if (obj == Py_None)
-        obj = NULL;
-#endif
-    return __Pyx_PyMethod_New(func, obj, type);
-}
 static PyObject*
 __Pyx_CyFunction_repr(__pyx_CyFunctionObject *op)
 {
 #if PY_MAJOR_VERSION >= 3
     return PyUnicode_FromFormat("<cyfunction %U at %p>",
                                 op->func_qualname, (void *)op);
 #else
@@ -5973,56 +7091,235 @@
             PyErr_Format(PyExc_TypeError,
                 "%.200s() takes exactly one argument (%" CYTHON_FORMAT_SSIZE_T "d given)",
                 f->m_ml->ml_name, size);
             return NULL;
         }
         break;
     default:
-        PyErr_SetString(PyExc_SystemError, "Bad call flags in "
-                        "__Pyx_CyFunction_Call. METH_OLDARGS is no "
-                        "longer supported!");
+        PyErr_SetString(PyExc_SystemError, "Bad call flags for CyFunction");
         return NULL;
     }
     PyErr_Format(PyExc_TypeError, "%.200s() takes no keyword arguments",
                  f->m_ml->ml_name);
     return NULL;
 }
 static CYTHON_INLINE PyObject *__Pyx_CyFunction_Call(PyObject *func, PyObject *arg, PyObject *kw) {
     return __Pyx_CyFunction_CallMethod(func, ((PyCFunctionObject*)func)->m_self, arg, kw);
 }
 static PyObject *__Pyx_CyFunction_CallAsMethod(PyObject *func, PyObject *args, PyObject *kw) {
     PyObject *result;
     __pyx_CyFunctionObject *cyfunc = (__pyx_CyFunctionObject *) func;
+#if CYTHON_METH_FASTCALL
+     __pyx_vectorcallfunc vc = __Pyx_CyFunction_func_vectorcall(cyfunc);
+    if (vc) {
+#if CYTHON_ASSUME_SAFE_MACROS
+        return __Pyx_PyVectorcall_FastCallDict(func, vc, &PyTuple_GET_ITEM(args, 0), (size_t)PyTuple_GET_SIZE(args), kw);
+#else
+        (void) &__Pyx_PyVectorcall_FastCallDict;
+        return PyVectorcall_Call(func, args, kw);
+#endif
+    }
+#endif
     if ((cyfunc->flags & __Pyx_CYFUNCTION_CCLASS) && !(cyfunc->flags & __Pyx_CYFUNCTION_STATICMETHOD)) {
         Py_ssize_t argc;
         PyObject *new_args;
         PyObject *self;
         argc = PyTuple_GET_SIZE(args);
         new_args = PyTuple_GetSlice(args, 1, argc);
         if (unlikely(!new_args))
             return NULL;
         self = PyTuple_GetItem(args, 0);
         if (unlikely(!self)) {
             Py_DECREF(new_args);
+#if PY_MAJOR_VERSION > 2
+            PyErr_Format(PyExc_TypeError,
+                         "unbound method %.200S() needs an argument",
+                         cyfunc->func_qualname);
+#else
+            PyErr_SetString(PyExc_TypeError,
+                            "unbound method needs an argument");
+#endif
             return NULL;
         }
         result = __Pyx_CyFunction_CallMethod(func, self, new_args, kw);
         Py_DECREF(new_args);
     } else {
         result = __Pyx_CyFunction_Call(func, args, kw);
     }
     return result;
 }
+#if CYTHON_METH_FASTCALL
+static CYTHON_INLINE int __Pyx_CyFunction_Vectorcall_CheckArgs(__pyx_CyFunctionObject *cyfunc, Py_ssize_t nargs, PyObject *kwnames)
+{
+    int ret = 0;
+    if ((cyfunc->flags & __Pyx_CYFUNCTION_CCLASS) && !(cyfunc->flags & __Pyx_CYFUNCTION_STATICMETHOD)) {
+        if (unlikely(nargs < 1)) {
+            PyErr_Format(PyExc_TypeError, "%.200s() needs an argument",
+                         ((PyCFunctionObject*)cyfunc)->m_ml->ml_name);
+            return -1;
+        }
+        ret = 1;
+    }
+    if (unlikely(kwnames) && unlikely(PyTuple_GET_SIZE(kwnames))) {
+        PyErr_Format(PyExc_TypeError,
+                     "%.200s() takes no keyword arguments", ((PyCFunctionObject*)cyfunc)->m_ml->ml_name);
+        return -1;
+    }
+    return ret;
+}
+static PyObject * __Pyx_CyFunction_Vectorcall_NOARGS(PyObject *func, PyObject *const *args, size_t nargsf, PyObject *kwnames)
+{
+    __pyx_CyFunctionObject *cyfunc = (__pyx_CyFunctionObject *)func;
+    PyMethodDef* def = ((PyCFunctionObject*)cyfunc)->m_ml;
+#if CYTHON_BACKPORT_VECTORCALL
+    Py_ssize_t nargs = (Py_ssize_t)nargsf;
+#else
+    Py_ssize_t nargs = PyVectorcall_NARGS(nargsf);
+#endif
+    PyObject *self;
+    switch (__Pyx_CyFunction_Vectorcall_CheckArgs(cyfunc, nargs, kwnames)) {
+    case 1:
+        self = args[0];
+        args += 1;
+        nargs -= 1;
+        break;
+    case 0:
+        self = ((PyCFunctionObject*)cyfunc)->m_self;
+        break;
+    default:
+        return NULL;
+    }
+    if (unlikely(nargs != 0)) {
+        PyErr_Format(PyExc_TypeError,
+            "%.200s() takes no arguments (%" CYTHON_FORMAT_SSIZE_T "d given)",
+            def->ml_name, nargs);
+        return NULL;
+    }
+    return def->ml_meth(self, NULL);
+}
+static PyObject * __Pyx_CyFunction_Vectorcall_O(PyObject *func, PyObject *const *args, size_t nargsf, PyObject *kwnames)
+{
+    __pyx_CyFunctionObject *cyfunc = (__pyx_CyFunctionObject *)func;
+    PyMethodDef* def = ((PyCFunctionObject*)cyfunc)->m_ml;
+#if CYTHON_BACKPORT_VECTORCALL
+    Py_ssize_t nargs = (Py_ssize_t)nargsf;
+#else
+    Py_ssize_t nargs = PyVectorcall_NARGS(nargsf);
+#endif
+    PyObject *self;
+    switch (__Pyx_CyFunction_Vectorcall_CheckArgs(cyfunc, nargs, kwnames)) {
+    case 1:
+        self = args[0];
+        args += 1;
+        nargs -= 1;
+        break;
+    case 0:
+        self = ((PyCFunctionObject*)cyfunc)->m_self;
+        break;
+    default:
+        return NULL;
+    }
+    if (unlikely(nargs != 1)) {
+        PyErr_Format(PyExc_TypeError,
+            "%.200s() takes exactly one argument (%" CYTHON_FORMAT_SSIZE_T "d given)",
+            def->ml_name, nargs);
+        return NULL;
+    }
+    return def->ml_meth(self, args[0]);
+}
+static PyObject * __Pyx_CyFunction_Vectorcall_FASTCALL_KEYWORDS(PyObject *func, PyObject *const *args, size_t nargsf, PyObject *kwnames)
+{
+    __pyx_CyFunctionObject *cyfunc = (__pyx_CyFunctionObject *)func;
+    PyMethodDef* def = ((PyCFunctionObject*)cyfunc)->m_ml;
+#if CYTHON_BACKPORT_VECTORCALL
+    Py_ssize_t nargs = (Py_ssize_t)nargsf;
+#else
+    Py_ssize_t nargs = PyVectorcall_NARGS(nargsf);
+#endif
+    PyObject *self;
+    switch (__Pyx_CyFunction_Vectorcall_CheckArgs(cyfunc, nargs, NULL)) {
+    case 1:
+        self = args[0];
+        args += 1;
+        nargs -= 1;
+        break;
+    case 0:
+        self = ((PyCFunctionObject*)cyfunc)->m_self;
+        break;
+    default:
+        return NULL;
+    }
+    return ((_PyCFunctionFastWithKeywords)(void(*)(void))def->ml_meth)(self, args, nargs, kwnames);
+}
+static PyObject * __Pyx_CyFunction_Vectorcall_FASTCALL_KEYWORDS_METHOD(PyObject *func, PyObject *const *args, size_t nargsf, PyObject *kwnames)
+{
+    __pyx_CyFunctionObject *cyfunc = (__pyx_CyFunctionObject *)func;
+    PyMethodDef* def = ((PyCFunctionObject*)cyfunc)->m_ml;
+    PyTypeObject *cls = (PyTypeObject *) __Pyx_CyFunction_GetClassObj(cyfunc);
+#if CYTHON_BACKPORT_VECTORCALL
+    Py_ssize_t nargs = (Py_ssize_t)nargsf;
+#else
+    Py_ssize_t nargs = PyVectorcall_NARGS(nargsf);
+#endif
+    PyObject *self;
+    switch (__Pyx_CyFunction_Vectorcall_CheckArgs(cyfunc, nargs, NULL)) {
+    case 1:
+        self = args[0];
+        args += 1;
+        nargs -= 1;
+        break;
+    case 0:
+        self = ((PyCFunctionObject*)cyfunc)->m_self;
+        break;
+    default:
+        return NULL;
+    }
+    return ((__Pyx_PyCMethod)(void(*)(void))def->ml_meth)(self, cls, args, (size_t)nargs, kwnames);
+}
+#endif
+#if CYTHON_USE_TYPE_SPECS
+static PyType_Slot __pyx_CyFunctionType_slots[] = {
+    {Py_tp_dealloc, (void *)__Pyx_CyFunction_dealloc},
+    {Py_tp_repr, (void *)__Pyx_CyFunction_repr},
+    {Py_tp_call, (void *)__Pyx_CyFunction_CallAsMethod},
+    {Py_tp_traverse, (void *)__Pyx_CyFunction_traverse},
+    {Py_tp_clear, (void *)__Pyx_CyFunction_clear},
+    {Py_tp_methods, (void *)__pyx_CyFunction_methods},
+    {Py_tp_members, (void *)__pyx_CyFunction_members},
+    {Py_tp_getset, (void *)__pyx_CyFunction_getsets},
+    {Py_tp_descr_get, (void *)__Pyx_PyMethod_New},
+    {0, 0},
+};
+static PyType_Spec __pyx_CyFunctionType_spec = {
+    __PYX_TYPE_MODULE_PREFIX "cython_function_or_method",
+    sizeof(__pyx_CyFunctionObject),
+    0,
+#ifdef Py_TPFLAGS_METHOD_DESCRIPTOR
+    Py_TPFLAGS_METHOD_DESCRIPTOR |
+#endif
+#if (defined(_Py_TPFLAGS_HAVE_VECTORCALL) && CYTHON_METH_FASTCALL)
+    _Py_TPFLAGS_HAVE_VECTORCALL |
+#endif
+    Py_TPFLAGS_DEFAULT | Py_TPFLAGS_HAVE_GC | Py_TPFLAGS_BASETYPE,
+    __pyx_CyFunctionType_slots
+};
+#else
 static PyTypeObject __pyx_CyFunctionType_type = {
     PyVarObject_HEAD_INIT(0, 0)
-    "cython_function_or_method",
+    __PYX_TYPE_MODULE_PREFIX "cython_function_or_method",
     sizeof(__pyx_CyFunctionObject),
     0,
     (destructor) __Pyx_CyFunction_dealloc,
+#if !CYTHON_METH_FASTCALL
     0,
+#elif CYTHON_BACKPORT_VECTORCALL
+    (printfunc)offsetof(__pyx_CyFunctionObject, func_vectorcall),
+#else
+    offsetof(PyCFunctionObject, vectorcall),
+#endif
     0,
     0,
 #if PY_MAJOR_VERSION < 3
     0,
 #else
     0,
 #endif
@@ -6032,15 +7329,21 @@
     0,
     0,
     __Pyx_CyFunction_CallAsMethod,
     0,
     0,
     0,
     0,
-    Py_TPFLAGS_DEFAULT | Py_TPFLAGS_HAVE_GC,
+#ifdef Py_TPFLAGS_METHOD_DESCRIPTOR
+    Py_TPFLAGS_METHOD_DESCRIPTOR |
+#endif
+#ifdef _Py_TPFLAGS_HAVE_VECTORCALL
+    _Py_TPFLAGS_HAVE_VECTORCALL |
+#endif
+    Py_TPFLAGS_DEFAULT | Py_TPFLAGS_HAVE_GC | Py_TPFLAGS_BASETYPE,
     0,
     (traverseproc) __Pyx_CyFunction_traverse,
     (inquiry) __Pyx_CyFunction_clear,
     0,
 #if PY_VERSION_HEX < 0x030500A0
     offsetof(__pyx_CyFunctionObject, func_weakreflist),
 #else
@@ -6049,15 +7352,15 @@
     0,
     0,
     __pyx_CyFunction_methods,
     __pyx_CyFunction_members,
     __pyx_CyFunction_getsets,
     0,
     0,
-    __Pyx_CyFunction_descr_get,
+    __Pyx_PyMethod_New,
     0,
     offsetof(__pyx_CyFunctionObject, func_dict),
     0,
     0,
     0,
     0,
     0,
@@ -6067,23 +7370,35 @@
     0,
     0,
     0,
     0,
 #if PY_VERSION_HEX >= 0x030400a1
     0,
 #endif
-#if PY_VERSION_HEX >= 0x030800b1
+#if PY_VERSION_HEX >= 0x030800b1 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07030800)
+    0,
+#endif
+#if __PYX_NEED_TP_PRINT_SLOT
+    0,
+#endif
+#if PY_VERSION_HEX >= 0x030C0000
     0,
 #endif
-#if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
+#if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000 && PY_VERSION_HEX < 0x030a0000
     0,
 #endif
 };
-static int __pyx_CyFunction_init(void) {
+#endif
+static int __pyx_CyFunction_init(PyObject *module) {
+#if CYTHON_USE_TYPE_SPECS
+    __pyx_CyFunctionType = __Pyx_FetchCommonTypeFromSpec(module, &__pyx_CyFunctionType_spec, NULL);
+#else
+    CYTHON_UNUSED_VAR(module);
     __pyx_CyFunctionType = __Pyx_FetchCommonType(&__pyx_CyFunctionType_type);
+#endif
     if (unlikely(__pyx_CyFunctionType == NULL)) {
         return -1;
     }
     return 0;
 }
 static CYTHON_INLINE void *__Pyx_CyFunction_InitDefaults(PyObject *func, size_t size, int pyobjects) {
     __pyx_CyFunctionObject *m = (__pyx_CyFunctionObject *) func;
@@ -6120,574 +7435,59 @@
     );
     if (likely(op)) {
         PyObject_GC_Track(op);
     }
     return op;
 }
 
-/* Py3ClassCreate */
-static PyObject *__Pyx_Py3MetaclassPrepare(PyObject *metaclass, PyObject *bases, PyObject *name,
-                                           PyObject *qualname, PyObject *mkw, PyObject *modname, PyObject *doc) {
-    PyObject *ns;
-    if (metaclass) {
-        PyObject *prep = __Pyx_PyObject_GetAttrStr(metaclass, __pyx_n_s_prepare);
-        if (prep) {
-            PyObject *pargs = PyTuple_Pack(2, name, bases);
-            if (unlikely(!pargs)) {
-                Py_DECREF(prep);
-                return NULL;
-            }
-            ns = PyObject_Call(prep, pargs, mkw);
-            Py_DECREF(prep);
-            Py_DECREF(pargs);
-        } else {
-            if (unlikely(!PyErr_ExceptionMatches(PyExc_AttributeError)))
-                return NULL;
-            PyErr_Clear();
-            ns = PyDict_New();
-        }
-    } else {
-        ns = PyDict_New();
-    }
-    if (unlikely(!ns))
-        return NULL;
-    if (unlikely(PyObject_SetItem(ns, __pyx_n_s_module, modname) < 0)) goto bad;
-    if (unlikely(PyObject_SetItem(ns, __pyx_n_s_qualname, qualname) < 0)) goto bad;
-    if (unlikely(doc && PyObject_SetItem(ns, __pyx_n_s_doc, doc) < 0)) goto bad;
-    return ns;
-bad:
-    Py_DECREF(ns);
-    return NULL;
-}
-static PyObject *__Pyx_Py3ClassCreate(PyObject *metaclass, PyObject *name, PyObject *bases,
-                                      PyObject *dict, PyObject *mkw,
-                                      int calculate_metaclass, int allow_py2_metaclass) {
-    PyObject *result, *margs;
-    PyObject *owned_metaclass = NULL;
-    if (allow_py2_metaclass) {
-        owned_metaclass = PyObject_GetItem(dict, __pyx_n_s_metaclass);
-        if (owned_metaclass) {
-            metaclass = owned_metaclass;
-        } else if (likely(PyErr_ExceptionMatches(PyExc_KeyError))) {
-            PyErr_Clear();
-        } else {
-            return NULL;
-        }
-    }
-    if (calculate_metaclass && (!metaclass || PyType_Check(metaclass))) {
-        metaclass = __Pyx_CalculateMetaclass((PyTypeObject*) metaclass, bases);
-        Py_XDECREF(owned_metaclass);
-        if (unlikely(!metaclass))
-            return NULL;
-        owned_metaclass = metaclass;
-    }
-    margs = PyTuple_Pack(3, name, bases, dict);
-    if (unlikely(!margs)) {
-        result = NULL;
-    } else {
-        result = PyObject_Call(metaclass, margs, mkw);
-        Py_DECREF(margs);
-    }
-    Py_XDECREF(owned_metaclass);
-    return result;
-}
-
-/* IterFinish */
-static CYTHON_INLINE int __Pyx_IterFinish(void) {
-#if CYTHON_FAST_THREAD_STATE
-    PyThreadState *tstate = __Pyx_PyThreadState_Current;
-    PyObject* exc_type = tstate->curexc_type;
-    if (unlikely(exc_type)) {
-        if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) {
-            PyObject *exc_value, *exc_tb;
-            exc_value = tstate->curexc_value;
-            exc_tb = tstate->curexc_traceback;
-            tstate->curexc_type = 0;
-            tstate->curexc_value = 0;
-            tstate->curexc_traceback = 0;
-            Py_DECREF(exc_type);
-            Py_XDECREF(exc_value);
-            Py_XDECREF(exc_tb);
-            return 0;
-        } else {
-            return -1;
-        }
-    }
-    return 0;
-#else
-    if (unlikely(PyErr_Occurred())) {
-        if (likely(PyErr_ExceptionMatches(PyExc_StopIteration))) {
-            PyErr_Clear();
-            return 0;
-        } else {
-            return -1;
-        }
-    }
-    return 0;
-#endif
-}
-
-/* PyObjectGetMethod */
-static int __Pyx_PyObject_GetMethod(PyObject *obj, PyObject *name, PyObject **method) {
-    PyObject *attr;
-#if CYTHON_UNPACK_METHODS && CYTHON_COMPILING_IN_CPYTHON && CYTHON_USE_PYTYPE_LOOKUP
-    PyTypeObject *tp = Py_TYPE(obj);
-    PyObject *descr;
-    descrgetfunc f = NULL;
-    PyObject **dictptr, *dict;
-    int meth_found = 0;
-    assert (*method == NULL);
-    if (unlikely(tp->tp_getattro != PyObject_GenericGetAttr)) {
-        attr = __Pyx_PyObject_GetAttrStr(obj, name);
-        goto try_unpack;
-    }
-    if (unlikely(tp->tp_dict == NULL) && unlikely(PyType_Ready(tp) < 0)) {
-        return 0;
-    }
-    descr = _PyType_Lookup(tp, name);
-    if (likely(descr != NULL)) {
-        Py_INCREF(descr);
-#if PY_MAJOR_VERSION >= 3
-        #ifdef __Pyx_CyFunction_USED
-        if (likely(PyFunction_Check(descr) || (Py_TYPE(descr) == &PyMethodDescr_Type) || __Pyx_CyFunction_Check(descr)))
-        #else
-        if (likely(PyFunction_Check(descr) || (Py_TYPE(descr) == &PyMethodDescr_Type)))
-        #endif
-#else
-        #ifdef __Pyx_CyFunction_USED
-        if (likely(PyFunction_Check(descr) || __Pyx_CyFunction_Check(descr)))
-        #else
-        if (likely(PyFunction_Check(descr)))
-        #endif
-#endif
-        {
-            meth_found = 1;
-        } else {
-            f = Py_TYPE(descr)->tp_descr_get;
-            if (f != NULL && PyDescr_IsData(descr)) {
-                attr = f(descr, obj, (PyObject *)Py_TYPE(obj));
-                Py_DECREF(descr);
-                goto try_unpack;
-            }
-        }
-    }
-    dictptr = _PyObject_GetDictPtr(obj);
-    if (dictptr != NULL && (dict = *dictptr) != NULL) {
-        Py_INCREF(dict);
-        attr = __Pyx_PyDict_GetItemStr(dict, name);
-        if (attr != NULL) {
-            Py_INCREF(attr);
-            Py_DECREF(dict);
-            Py_XDECREF(descr);
-            goto try_unpack;
-        }
-        Py_DECREF(dict);
-    }
-    if (meth_found) {
-        *method = descr;
-        return 1;
-    }
-    if (f != NULL) {
-        attr = f(descr, obj, (PyObject *)Py_TYPE(obj));
-        Py_DECREF(descr);
-        goto try_unpack;
-    }
-    if (descr != NULL) {
-        *method = descr;
-        return 0;
-    }
-    PyErr_Format(PyExc_AttributeError,
-#if PY_MAJOR_VERSION >= 3
-                 "'%.50s' object has no attribute '%U'",
-                 tp->tp_name, name);
-#else
-                 "'%.50s' object has no attribute '%.400s'",
-                 tp->tp_name, PyString_AS_STRING(name));
-#endif
-    return 0;
-#else
-    attr = __Pyx_PyObject_GetAttrStr(obj, name);
-    goto try_unpack;
-#endif
-try_unpack:
-#if CYTHON_UNPACK_METHODS
-    if (likely(attr) && PyMethod_Check(attr) && likely(PyMethod_GET_SELF(attr) == obj)) {
-        PyObject *function = PyMethod_GET_FUNCTION(attr);
-        Py_INCREF(function);
-        Py_DECREF(attr);
-        *method = function;
-        return 1;
-    }
-#endif
-    *method = attr;
-    return 0;
-}
-
-/* PyObjectCallMethod0 */
-static PyObject* __Pyx_PyObject_CallMethod0(PyObject* obj, PyObject* method_name) {
-    PyObject *method = NULL, *result = NULL;
-    int is_method = __Pyx_PyObject_GetMethod(obj, method_name, &method);
-    if (likely(is_method)) {
-        result = __Pyx_PyObject_CallOneArg(method, obj);
-        Py_DECREF(method);
-        return result;
-    }
-    if (unlikely(!method)) goto bad;
-    result = __Pyx_PyObject_CallNoArg(method);
-    Py_DECREF(method);
-bad:
-    return result;
-}
-
-/* RaiseNeedMoreValuesToUnpack */
-static CYTHON_INLINE void __Pyx_RaiseNeedMoreValuesError(Py_ssize_t index) {
-    PyErr_Format(PyExc_ValueError,
-                 "need more than %" CYTHON_FORMAT_SSIZE_T "d value%.1s to unpack",
-                 index, (index == 1) ? "" : "s");
-}
-
-/* RaiseTooManyValuesToUnpack */
-static CYTHON_INLINE void __Pyx_RaiseTooManyValuesError(Py_ssize_t expected) {
-    PyErr_Format(PyExc_ValueError,
-                 "too many values to unpack (expected %" CYTHON_FORMAT_SSIZE_T "d)", expected);
-}
-
-/* UnpackItemEndCheck */
-static int __Pyx_IternextUnpackEndCheck(PyObject *retval, Py_ssize_t expected) {
-    if (unlikely(retval)) {
-        Py_DECREF(retval);
-        __Pyx_RaiseTooManyValuesError(expected);
-        return -1;
-    } else {
-        return __Pyx_IterFinish();
-    }
-    return 0;
-}
-
-/* RaiseNoneIterError */
-static CYTHON_INLINE void __Pyx_RaiseNoneNotIterableError(void) {
-    PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-}
-
-/* UnpackTupleError */
-static void __Pyx_UnpackTupleError(PyObject *t, Py_ssize_t index) {
-    if (t == Py_None) {
-      __Pyx_RaiseNoneNotIterableError();
-    } else if (PyTuple_GET_SIZE(t) < index) {
-      __Pyx_RaiseNeedMoreValuesError(PyTuple_GET_SIZE(t));
-    } else {
-      __Pyx_RaiseTooManyValuesError(index);
-    }
-}
-
-/* UnpackTuple2 */
-static CYTHON_INLINE int __Pyx_unpack_tuple2_exact(
-        PyObject* tuple, PyObject** pvalue1, PyObject** pvalue2, int decref_tuple) {
-    PyObject *value1 = NULL, *value2 = NULL;
-#if CYTHON_COMPILING_IN_PYPY
-    value1 = PySequence_ITEM(tuple, 0);  if (unlikely(!value1)) goto bad;
-    value2 = PySequence_ITEM(tuple, 1);  if (unlikely(!value2)) goto bad;
-#else
-    value1 = PyTuple_GET_ITEM(tuple, 0);  Py_INCREF(value1);
-    value2 = PyTuple_GET_ITEM(tuple, 1);  Py_INCREF(value2);
-#endif
-    if (decref_tuple) {
-        Py_DECREF(tuple);
-    }
-    *pvalue1 = value1;
-    *pvalue2 = value2;
-    return 0;
-#if CYTHON_COMPILING_IN_PYPY
-bad:
-    Py_XDECREF(value1);
-    Py_XDECREF(value2);
-    if (decref_tuple) { Py_XDECREF(tuple); }
-    return -1;
-#endif
-}
-static int __Pyx_unpack_tuple2_generic(PyObject* tuple, PyObject** pvalue1, PyObject** pvalue2,
-                                       int has_known_size, int decref_tuple) {
-    Py_ssize_t index;
-    PyObject *value1 = NULL, *value2 = NULL, *iter = NULL;
-    iternextfunc iternext;
-    iter = PyObject_GetIter(tuple);
-    if (unlikely(!iter)) goto bad;
-    if (decref_tuple) { Py_DECREF(tuple); tuple = NULL; }
-    iternext = Py_TYPE(iter)->tp_iternext;
-    value1 = iternext(iter); if (unlikely(!value1)) { index = 0; goto unpacking_failed; }
-    value2 = iternext(iter); if (unlikely(!value2)) { index = 1; goto unpacking_failed; }
-    if (!has_known_size && unlikely(__Pyx_IternextUnpackEndCheck(iternext(iter), 2))) goto bad;
-    Py_DECREF(iter);
-    *pvalue1 = value1;
-    *pvalue2 = value2;
-    return 0;
-unpacking_failed:
-    if (!has_known_size && __Pyx_IterFinish() == 0)
-        __Pyx_RaiseNeedMoreValuesError(index);
-bad:
-    Py_XDECREF(iter);
-    Py_XDECREF(value1);
-    Py_XDECREF(value2);
-    if (decref_tuple) { Py_XDECREF(tuple); }
-    return -1;
-}
-
-/* dict_iter */
-static CYTHON_INLINE PyObject* __Pyx_dict_iterator(PyObject* iterable, int is_dict, PyObject* method_name,
-                                                   Py_ssize_t* p_orig_length, int* p_source_is_dict) {
-    is_dict = is_dict || likely(PyDict_CheckExact(iterable));
-    *p_source_is_dict = is_dict;
-    if (is_dict) {
-#if !CYTHON_COMPILING_IN_PYPY
-        *p_orig_length = PyDict_Size(iterable);
-        Py_INCREF(iterable);
-        return iterable;
-#elif PY_MAJOR_VERSION >= 3
-        static PyObject *py_items = NULL, *py_keys = NULL, *py_values = NULL;
-        PyObject **pp = NULL;
-        if (method_name) {
-            const char *name = PyUnicode_AsUTF8(method_name);
-            if (strcmp(name, "iteritems") == 0) pp = &py_items;
-            else if (strcmp(name, "iterkeys") == 0) pp = &py_keys;
-            else if (strcmp(name, "itervalues") == 0) pp = &py_values;
-            if (pp) {
-                if (!*pp) {
-                    *pp = PyUnicode_FromString(name + 4);
-                    if (!*pp)
-                        return NULL;
-                }
-                method_name = *pp;
-            }
-        }
-#endif
-    }
-    *p_orig_length = 0;
-    if (method_name) {
-        PyObject* iter;
-        iterable = __Pyx_PyObject_CallMethod0(iterable, method_name);
-        if (!iterable)
-            return NULL;
-#if !CYTHON_COMPILING_IN_PYPY
-        if (PyTuple_CheckExact(iterable) || PyList_CheckExact(iterable))
-            return iterable;
-#endif
-        iter = PyObject_GetIter(iterable);
-        Py_DECREF(iterable);
-        return iter;
-    }
-    return PyObject_GetIter(iterable);
-}
-static CYTHON_INLINE int __Pyx_dict_iter_next(
-        PyObject* iter_obj, CYTHON_NCP_UNUSED Py_ssize_t orig_length, CYTHON_NCP_UNUSED Py_ssize_t* ppos,
-        PyObject** pkey, PyObject** pvalue, PyObject** pitem, int source_is_dict) {
-    PyObject* next_item;
-#if !CYTHON_COMPILING_IN_PYPY
-    if (source_is_dict) {
-        PyObject *key, *value;
-        if (unlikely(orig_length != PyDict_Size(iter_obj))) {
-            PyErr_SetString(PyExc_RuntimeError, "dictionary changed size during iteration");
-            return -1;
-        }
-        if (unlikely(!PyDict_Next(iter_obj, ppos, &key, &value))) {
-            return 0;
-        }
-        if (pitem) {
-            PyObject* tuple = PyTuple_New(2);
-            if (unlikely(!tuple)) {
-                return -1;
-            }
-            Py_INCREF(key);
-            Py_INCREF(value);
-            PyTuple_SET_ITEM(tuple, 0, key);
-            PyTuple_SET_ITEM(tuple, 1, value);
-            *pitem = tuple;
-        } else {
-            if (pkey) {
-                Py_INCREF(key);
-                *pkey = key;
-            }
-            if (pvalue) {
-                Py_INCREF(value);
-                *pvalue = value;
-            }
-        }
-        return 1;
-    } else if (PyTuple_CheckExact(iter_obj)) {
-        Py_ssize_t pos = *ppos;
-        if (unlikely(pos >= PyTuple_GET_SIZE(iter_obj))) return 0;
-        *ppos = pos + 1;
-        next_item = PyTuple_GET_ITEM(iter_obj, pos);
-        Py_INCREF(next_item);
-    } else if (PyList_CheckExact(iter_obj)) {
-        Py_ssize_t pos = *ppos;
-        if (unlikely(pos >= PyList_GET_SIZE(iter_obj))) return 0;
-        *ppos = pos + 1;
-        next_item = PyList_GET_ITEM(iter_obj, pos);
-        Py_INCREF(next_item);
-    } else
-#endif
-    {
-        next_item = PyIter_Next(iter_obj);
-        if (unlikely(!next_item)) {
-            return __Pyx_IterFinish();
-        }
-    }
-    if (pitem) {
-        *pitem = next_item;
-    } else if (pkey && pvalue) {
-        if (__Pyx_unpack_tuple2(next_item, pkey, pvalue, source_is_dict, source_is_dict, 1))
-            return -1;
-    } else if (pkey) {
-        *pkey = next_item;
-    } else {
-        *pvalue = next_item;
-    }
-    return 1;
-}
-
-/* SliceObject */
-static CYTHON_INLINE PyObject* __Pyx_PyObject_GetSlice(PyObject* obj,
-        Py_ssize_t cstart, Py_ssize_t cstop,
-        PyObject** _py_start, PyObject** _py_stop, PyObject** _py_slice,
-        int has_cstart, int has_cstop, CYTHON_UNUSED int wraparound) {
-#if CYTHON_USE_TYPE_SLOTS
-    PyMappingMethods* mp;
-#if PY_MAJOR_VERSION < 3
-    PySequenceMethods* ms = Py_TYPE(obj)->tp_as_sequence;
-    if (likely(ms && ms->sq_slice)) {
-        if (!has_cstart) {
-            if (_py_start && (*_py_start != Py_None)) {
-                cstart = __Pyx_PyIndex_AsSsize_t(*_py_start);
-                if ((cstart == (Py_ssize_t)-1) && PyErr_Occurred()) goto bad;
-            } else
-                cstart = 0;
-        }
-        if (!has_cstop) {
-            if (_py_stop && (*_py_stop != Py_None)) {
-                cstop = __Pyx_PyIndex_AsSsize_t(*_py_stop);
-                if ((cstop == (Py_ssize_t)-1) && PyErr_Occurred()) goto bad;
-            } else
-                cstop = PY_SSIZE_T_MAX;
-        }
-        if (wraparound && unlikely((cstart < 0) | (cstop < 0)) && likely(ms->sq_length)) {
-            Py_ssize_t l = ms->sq_length(obj);
-            if (likely(l >= 0)) {
-                if (cstop < 0) {
-                    cstop += l;
-                    if (cstop < 0) cstop = 0;
-                }
-                if (cstart < 0) {
-                    cstart += l;
-                    if (cstart < 0) cstart = 0;
-                }
-            } else {
-                if (!PyErr_ExceptionMatches(PyExc_OverflowError))
-                    goto bad;
-                PyErr_Clear();
-            }
-        }
-        return ms->sq_slice(obj, cstart, cstop);
-    }
-#endif
-    mp = Py_TYPE(obj)->tp_as_mapping;
-    if (likely(mp && mp->mp_subscript))
-#endif
-    {
-        PyObject* result;
-        PyObject *py_slice, *py_start, *py_stop;
-        if (_py_slice) {
-            py_slice = *_py_slice;
-        } else {
-            PyObject* owned_start = NULL;
-            PyObject* owned_stop = NULL;
-            if (_py_start) {
-                py_start = *_py_start;
-            } else {
-                if (has_cstart) {
-                    owned_start = py_start = PyInt_FromSsize_t(cstart);
-                    if (unlikely(!py_start)) goto bad;
-                } else
-                    py_start = Py_None;
-            }
-            if (_py_stop) {
-                py_stop = *_py_stop;
-            } else {
-                if (has_cstop) {
-                    owned_stop = py_stop = PyInt_FromSsize_t(cstop);
-                    if (unlikely(!py_stop)) {
-                        Py_XDECREF(owned_start);
-                        goto bad;
-                    }
-                } else
-                    py_stop = Py_None;
-            }
-            py_slice = PySlice_New(py_start, py_stop, Py_None);
-            Py_XDECREF(owned_start);
-            Py_XDECREF(owned_stop);
-            if (unlikely(!py_slice)) goto bad;
-        }
-#if CYTHON_USE_TYPE_SLOTS
-        result = mp->mp_subscript(obj, py_slice);
-#else
-        result = PyObject_GetItem(obj, py_slice);
-#endif
-        if (!_py_slice) {
-            Py_DECREF(py_slice);
-        }
-        return result;
-    }
-    PyErr_Format(PyExc_TypeError,
-        "'%.200s' object is unsliceable", Py_TYPE(obj)->tp_name);
-bad:
-    return NULL;
-}
-
 /* CLineInTraceback */
 #ifndef CYTHON_CLINE_IN_TRACEBACK
-static int __Pyx_CLineForTraceback(CYTHON_NCP_UNUSED PyThreadState *tstate, int c_line) {
+static int __Pyx_CLineForTraceback(PyThreadState *tstate, int c_line) {
     PyObject *use_cline;
     PyObject *ptype, *pvalue, *ptraceback;
 #if CYTHON_COMPILING_IN_CPYTHON
     PyObject **cython_runtime_dict;
 #endif
+    CYTHON_MAYBE_UNUSED_VAR(tstate);
     if (unlikely(!__pyx_cython_runtime)) {
         return c_line;
     }
     __Pyx_ErrFetchInState(tstate, &ptype, &pvalue, &ptraceback);
 #if CYTHON_COMPILING_IN_CPYTHON
     cython_runtime_dict = _PyObject_GetDictPtr(__pyx_cython_runtime);
     if (likely(cython_runtime_dict)) {
         __PYX_PY_DICT_LOOKUP_IF_MODIFIED(
             use_cline, *cython_runtime_dict,
             __Pyx_PyDict_GetItemStr(*cython_runtime_dict, __pyx_n_s_cline_in_traceback))
     } else
 #endif
     {
-      PyObject *use_cline_obj = __Pyx_PyObject_GetAttrStr(__pyx_cython_runtime, __pyx_n_s_cline_in_traceback);
+      PyObject *use_cline_obj = __Pyx_PyObject_GetAttrStrNoError(__pyx_cython_runtime, __pyx_n_s_cline_in_traceback);
       if (use_cline_obj) {
         use_cline = PyObject_Not(use_cline_obj) ? Py_False : Py_True;
         Py_DECREF(use_cline_obj);
       } else {
         PyErr_Clear();
         use_cline = NULL;
       }
     }
     if (!use_cline) {
         c_line = 0;
-        PyObject_SetAttr(__pyx_cython_runtime, __pyx_n_s_cline_in_traceback, Py_False);
+        (void) PyObject_SetAttr(__pyx_cython_runtime, __pyx_n_s_cline_in_traceback, Py_False);
     }
     else if (use_cline == Py_False || (use_cline != Py_True && PyObject_Not(use_cline) != 0)) {
         c_line = 0;
     }
     __Pyx_ErrRestoreInState(tstate, ptype, pvalue, ptraceback);
     return c_line;
 }
 #endif
 
 /* CodeObjectCache */
+#if !CYTHON_COMPILING_IN_LIMITED_API
 static int __pyx_bisect_code_objects(__Pyx_CodeObjectCacheEntry* entries, int count, int code_line) {
     int start = 0, mid = 0, end = count - 1;
     if (end >= 0 && code_line > entries[end].code_line) {
         return count;
     }
     while (start < end) {
         mid = start + (end - start) / 2;
@@ -6758,84 +7558,118 @@
         entries[i] = entries[i-1];
     }
     entries[pos].code_line = code_line;
     entries[pos].code_object = code_object;
     __pyx_code_cache.count++;
     Py_INCREF(code_object);
 }
+#endif
 
 /* AddTraceback */
 #include "compile.h"
 #include "frameobject.h"
 #include "traceback.h"
+#if PY_VERSION_HEX >= 0x030b00a6
+  #ifndef Py_BUILD_CORE
+    #define Py_BUILD_CORE 1
+  #endif
+  #include "internal/pycore_frame.h"
+#endif
+#if CYTHON_COMPILING_IN_LIMITED_API
+static void __Pyx_AddTraceback(const char *funcname, int c_line,
+                               int py_line, const char *filename) {
+    if (c_line) {
+        (void) __pyx_cfilenm;
+        (void) __Pyx_CLineForTraceback(__Pyx_PyThreadState_Current, c_line);
+    }
+    _PyTraceback_Add(funcname, filename, py_line);
+}
+#else
 static PyCodeObject* __Pyx_CreateCodeObjectForTraceback(
             const char *funcname, int c_line,
             int py_line, const char *filename) {
-    PyCodeObject *py_code = 0;
-    PyObject *py_srcfile = 0;
-    PyObject *py_funcname = 0;
+    PyCodeObject *py_code = NULL;
+    PyObject *py_funcname = NULL;
     #if PY_MAJOR_VERSION < 3
+    PyObject *py_srcfile = NULL;
     py_srcfile = PyString_FromString(filename);
-    #else
-    py_srcfile = PyUnicode_FromString(filename);
-    #endif
     if (!py_srcfile) goto bad;
+    #endif
     if (c_line) {
         #if PY_MAJOR_VERSION < 3
         py_funcname = PyString_FromFormat( "%s (%s:%d)", funcname, __pyx_cfilenm, c_line);
+        if (!py_funcname) goto bad;
         #else
         py_funcname = PyUnicode_FromFormat( "%s (%s:%d)", funcname, __pyx_cfilenm, c_line);
+        if (!py_funcname) goto bad;
+        funcname = PyUnicode_AsUTF8(py_funcname);
+        if (!funcname) goto bad;
         #endif
     }
     else {
         #if PY_MAJOR_VERSION < 3
         py_funcname = PyString_FromString(funcname);
-        #else
-        py_funcname = PyUnicode_FromString(funcname);
+        if (!py_funcname) goto bad;
         #endif
     }
-    if (!py_funcname) goto bad;
+    #if PY_MAJOR_VERSION < 3
     py_code = __Pyx_PyCode_New(
         0,
         0,
         0,
         0,
         0,
+        0,
         __pyx_empty_bytes, /*PyObject *code,*/
         __pyx_empty_tuple, /*PyObject *consts,*/
         __pyx_empty_tuple, /*PyObject *names,*/
         __pyx_empty_tuple, /*PyObject *varnames,*/
         __pyx_empty_tuple, /*PyObject *freevars,*/
         __pyx_empty_tuple, /*PyObject *cellvars,*/
         py_srcfile,   /*PyObject *filename,*/
         py_funcname,  /*PyObject *name,*/
         py_line,
         __pyx_empty_bytes  /*PyObject *lnotab*/
     );
     Py_DECREF(py_srcfile);
-    Py_DECREF(py_funcname);
+    #else
+    py_code = PyCode_NewEmpty(filename, funcname, py_line);
+    #endif
+    Py_XDECREF(py_funcname);  // XDECREF since it's only set on Py3 if cline
     return py_code;
 bad:
-    Py_XDECREF(py_srcfile);
     Py_XDECREF(py_funcname);
+    #if PY_MAJOR_VERSION < 3
+    Py_XDECREF(py_srcfile);
+    #endif
     return NULL;
 }
 static void __Pyx_AddTraceback(const char *funcname, int c_line,
                                int py_line, const char *filename) {
     PyCodeObject *py_code = 0;
     PyFrameObject *py_frame = 0;
     PyThreadState *tstate = __Pyx_PyThreadState_Current;
+    PyObject *ptype, *pvalue, *ptraceback;
     if (c_line) {
         c_line = __Pyx_CLineForTraceback(tstate, c_line);
     }
     py_code = __pyx_find_code_object(c_line ? -c_line : py_line);
     if (!py_code) {
+        __Pyx_ErrFetchInState(tstate, &ptype, &pvalue, &ptraceback);
         py_code = __Pyx_CreateCodeObjectForTraceback(
             funcname, c_line, py_line, filename);
-        if (!py_code) goto bad;
+        if (!py_code) {
+            /* If the code object creation fails, then we should clear the
+               fetched exception references and propagate the new exception */
+            Py_XDECREF(ptype);
+            Py_XDECREF(pvalue);
+            Py_XDECREF(ptraceback);
+            goto bad;
+        }
+        __Pyx_ErrRestoreInState(tstate, ptype, pvalue, ptraceback);
         __pyx_insert_code_object(c_line ? -c_line : py_line, py_code);
     }
     py_frame = PyFrame_New(
         tstate,            /*PyThreadState *tstate,*/
         py_code,           /*PyCodeObject *code,*/
         __pyx_d,    /*PyObject *globals,*/
         0                  /*PyObject *locals*/
@@ -6843,14 +7677,15 @@
     if (!py_frame) goto bad;
     __Pyx_PyFrame_SetLineNumber(py_frame, py_line);
     PyTraceBack_Here(py_frame);
 bad:
     Py_XDECREF(py_code);
     Py_XDECREF(py_frame);
 }
+#endif
 
 /* CIntFromPyVerify */
 #define __PYX_VERIFY_RETURN_INT(target_type, func_type, func_value)\
     __PYX__VERIFY_RETURN_INT(target_type, func_type, func_value, 0)
 #define __PYX_VERIFY_RETURN_INT_EXC(target_type, func_type, func_value)\
     __PYX__VERIFY_RETURN_INT(target_type, func_type, func_value, 1)
 #define __PYX__VERIFY_RETURN_INT(target_type, func_type, func_value, exc)\
@@ -6866,245 +7701,267 @@
                 else\
                     goto raise_overflow;\
             }\
         }\
         return (target_type) value;\
     }
 
-/* CIntToPy */
-static CYTHON_INLINE PyObject* __Pyx_PyInt_From_uint32_t(uint32_t value) {
-    const uint32_t neg_one = (uint32_t) ((uint32_t) 0 - (uint32_t) 1), const_zero = (uint32_t) 0;
-    const int is_unsigned = neg_one > const_zero;
-    if (is_unsigned) {
-        if (sizeof(uint32_t) < sizeof(long)) {
-            return PyInt_FromLong((long) value);
-        } else if (sizeof(uint32_t) <= sizeof(unsigned long)) {
-            return PyLong_FromUnsignedLong((unsigned long) value);
-#ifdef HAVE_LONG_LONG
-        } else if (sizeof(uint32_t) <= sizeof(unsigned PY_LONG_LONG)) {
-            return PyLong_FromUnsignedLongLong((unsigned PY_LONG_LONG) value);
-#endif
-        }
-    } else {
-        if (sizeof(uint32_t) <= sizeof(long)) {
-            return PyInt_FromLong((long) value);
-#ifdef HAVE_LONG_LONG
-        } else if (sizeof(uint32_t) <= sizeof(PY_LONG_LONG)) {
-            return PyLong_FromLongLong((PY_LONG_LONG) value);
-#endif
-        }
-    }
-    {
-        int one = 1; int little = (int)*(unsigned char *)&one;
-        unsigned char *bytes = (unsigned char *)&value;
-        return _PyLong_FromByteArray(bytes, sizeof(uint32_t),
-                                     little, !is_unsigned);
-    }
-}
-
-/* CIntToPy */
-static CYTHON_INLINE PyObject* __Pyx_PyInt_From_int(int value) {
-    const int neg_one = (int) ((int) 0 - (int) 1), const_zero = (int) 0;
-    const int is_unsigned = neg_one > const_zero;
-    if (is_unsigned) {
-        if (sizeof(int) < sizeof(long)) {
-            return PyInt_FromLong((long) value);
-        } else if (sizeof(int) <= sizeof(unsigned long)) {
-            return PyLong_FromUnsignedLong((unsigned long) value);
-#ifdef HAVE_LONG_LONG
-        } else if (sizeof(int) <= sizeof(unsigned PY_LONG_LONG)) {
-            return PyLong_FromUnsignedLongLong((unsigned PY_LONG_LONG) value);
-#endif
-        }
-    } else {
-        if (sizeof(int) <= sizeof(long)) {
-            return PyInt_FromLong((long) value);
-#ifdef HAVE_LONG_LONG
-        } else if (sizeof(int) <= sizeof(PY_LONG_LONG)) {
-            return PyLong_FromLongLong((PY_LONG_LONG) value);
-#endif
-        }
-    }
-    {
-        int one = 1; int little = (int)*(unsigned char *)&one;
-        unsigned char *bytes = (unsigned char *)&value;
-        return _PyLong_FromByteArray(bytes, sizeof(int),
-                                     little, !is_unsigned);
-    }
-}
-
 /* CIntFromPy */
 static CYTHON_INLINE int __Pyx_PyInt_As_int(PyObject *x) {
-    const int neg_one = (int) ((int) 0 - (int) 1), const_zero = (int) 0;
+#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
+#pragma GCC diagnostic push
+#pragma GCC diagnostic ignored "-Wconversion"
+#endif
+    const int neg_one = (int) -1, const_zero = (int) 0;
+#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
+#pragma GCC diagnostic pop
+#endif
     const int is_unsigned = neg_one > const_zero;
 #if PY_MAJOR_VERSION < 3
     if (likely(PyInt_Check(x))) {
-        if (sizeof(int) < sizeof(long)) {
+        if ((sizeof(int) < sizeof(long))) {
             __PYX_VERIFY_RETURN_INT(int, long, PyInt_AS_LONG(x))
         } else {
             long val = PyInt_AS_LONG(x);
             if (is_unsigned && unlikely(val < 0)) {
                 goto raise_neg_overflow;
             }
             return (int) val;
         }
     } else
 #endif
     if (likely(PyLong_Check(x))) {
         if (is_unsigned) {
 #if CYTHON_USE_PYLONG_INTERNALS
-            const digit* digits = ((PyLongObject*)x)->ob_digit;
-            switch (Py_SIZE(x)) {
-                case  0: return (int) 0;
-                case  1: __PYX_VERIFY_RETURN_INT(int, digit, digits[0])
-                case 2:
-                    if (8 * sizeof(int) > 1 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 2 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(int, unsigned long, (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(int) >= 2 * PyLong_SHIFT) {
-                            return (int) (((((int)digits[1]) << PyLong_SHIFT) | (int)digits[0]));
+            if (unlikely(__Pyx_PyLong_IsNeg(x))) {
+                goto raise_neg_overflow;
+            } else if (__Pyx_PyLong_IsCompact(x)) {
+                __PYX_VERIFY_RETURN_INT(int, __Pyx_compact_upylong, __Pyx_PyLong_CompactValueUnsigned(x))
+            } else {
+                const digit* digits = __Pyx_PyLong_Digits(x);
+                assert(__Pyx_PyLong_DigitCount(x) > 1);
+                switch (__Pyx_PyLong_DigitCount(x)) {
+                    case 2:
+                        if ((8 * sizeof(int) > 1 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 2 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(int, unsigned long, (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(int) >= 2 * PyLong_SHIFT)) {
+                                return (int) (((((int)digits[1]) << PyLong_SHIFT) | (int)digits[0]));
+                            }
                         }
-                    }
-                    break;
-                case 3:
-                    if (8 * sizeof(int) > 2 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 3 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(int, unsigned long, (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(int) >= 3 * PyLong_SHIFT) {
-                            return (int) (((((((int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0]));
+                        break;
+                    case 3:
+                        if ((8 * sizeof(int) > 2 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 3 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(int, unsigned long, (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(int) >= 3 * PyLong_SHIFT)) {
+                                return (int) (((((((int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0]));
+                            }
                         }
-                    }
-                    break;
-                case 4:
-                    if (8 * sizeof(int) > 3 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 4 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(int, unsigned long, (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(int) >= 4 * PyLong_SHIFT) {
-                            return (int) (((((((((int)digits[3]) << PyLong_SHIFT) | (int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0]));
+                        break;
+                    case 4:
+                        if ((8 * sizeof(int) > 3 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 4 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(int, unsigned long, (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(int) >= 4 * PyLong_SHIFT)) {
+                                return (int) (((((((((int)digits[3]) << PyLong_SHIFT) | (int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0]));
+                            }
                         }
-                    }
-                    break;
+                        break;
+                }
             }
 #endif
-#if CYTHON_COMPILING_IN_CPYTHON
+#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX < 0x030C00A7
             if (unlikely(Py_SIZE(x) < 0)) {
                 goto raise_neg_overflow;
             }
 #else
             {
                 int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
                 if (unlikely(result < 0))
                     return (int) -1;
                 if (unlikely(result == 1))
                     goto raise_neg_overflow;
             }
 #endif
-            if (sizeof(int) <= sizeof(unsigned long)) {
+            if ((sizeof(int) <= sizeof(unsigned long))) {
                 __PYX_VERIFY_RETURN_INT_EXC(int, unsigned long, PyLong_AsUnsignedLong(x))
 #ifdef HAVE_LONG_LONG
-            } else if (sizeof(int) <= sizeof(unsigned PY_LONG_LONG)) {
+            } else if ((sizeof(int) <= sizeof(unsigned PY_LONG_LONG))) {
                 __PYX_VERIFY_RETURN_INT_EXC(int, unsigned PY_LONG_LONG, PyLong_AsUnsignedLongLong(x))
 #endif
             }
         } else {
 #if CYTHON_USE_PYLONG_INTERNALS
-            const digit* digits = ((PyLongObject*)x)->ob_digit;
-            switch (Py_SIZE(x)) {
-                case  0: return (int) 0;
-                case -1: __PYX_VERIFY_RETURN_INT(int, sdigit, (sdigit) (-(sdigit)digits[0]))
-                case  1: __PYX_VERIFY_RETURN_INT(int,  digit, +digits[0])
-                case -2:
-                    if (8 * sizeof(int) - 1 > 1 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 2 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(int, long, -(long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(int) - 1 > 2 * PyLong_SHIFT) {
-                            return (int) (((int)-1)*(((((int)digits[1]) << PyLong_SHIFT) | (int)digits[0])));
+            if (__Pyx_PyLong_IsCompact(x)) {
+                __PYX_VERIFY_RETURN_INT(int, __Pyx_compact_pylong, __Pyx_PyLong_CompactValue(x))
+            } else {
+                const digit* digits = __Pyx_PyLong_Digits(x);
+                assert(__Pyx_PyLong_DigitCount(x) > 1);
+                switch (__Pyx_PyLong_SignedDigitCount(x)) {
+                    case -2:
+                        if ((8 * sizeof(int) - 1 > 1 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 2 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(int, long, -(long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(int) - 1 > 2 * PyLong_SHIFT)) {
+                                return (int) (((int)-1)*(((((int)digits[1]) << PyLong_SHIFT) | (int)digits[0])));
+                            }
                         }
-                    }
-                    break;
-                case 2:
-                    if (8 * sizeof(int) > 1 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 2 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(int, unsigned long, (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(int) - 1 > 2 * PyLong_SHIFT) {
-                            return (int) ((((((int)digits[1]) << PyLong_SHIFT) | (int)digits[0])));
+                        break;
+                    case 2:
+                        if ((8 * sizeof(int) > 1 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 2 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(int, unsigned long, (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(int) - 1 > 2 * PyLong_SHIFT)) {
+                                return (int) ((((((int)digits[1]) << PyLong_SHIFT) | (int)digits[0])));
+                            }
                         }
-                    }
-                    break;
-                case -3:
-                    if (8 * sizeof(int) - 1 > 2 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 3 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(int, long, -(long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(int) - 1 > 3 * PyLong_SHIFT) {
-                            return (int) (((int)-1)*(((((((int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0])));
+                        break;
+                    case -3:
+                        if ((8 * sizeof(int) - 1 > 2 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 3 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(int, long, -(long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(int) - 1 > 3 * PyLong_SHIFT)) {
+                                return (int) (((int)-1)*(((((((int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0])));
+                            }
                         }
-                    }
-                    break;
-                case 3:
-                    if (8 * sizeof(int) > 2 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 3 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(int, unsigned long, (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(int) - 1 > 3 * PyLong_SHIFT) {
-                            return (int) ((((((((int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0])));
+                        break;
+                    case 3:
+                        if ((8 * sizeof(int) > 2 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 3 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(int, unsigned long, (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(int) - 1 > 3 * PyLong_SHIFT)) {
+                                return (int) ((((((((int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0])));
+                            }
                         }
-                    }
-                    break;
-                case -4:
-                    if (8 * sizeof(int) - 1 > 3 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 4 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(int, long, -(long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(int) - 1 > 4 * PyLong_SHIFT) {
-                            return (int) (((int)-1)*(((((((((int)digits[3]) << PyLong_SHIFT) | (int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0])));
+                        break;
+                    case -4:
+                        if ((8 * sizeof(int) - 1 > 3 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 4 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(int, long, -(long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(int) - 1 > 4 * PyLong_SHIFT)) {
+                                return (int) (((int)-1)*(((((((((int)digits[3]) << PyLong_SHIFT) | (int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0])));
+                            }
                         }
-                    }
-                    break;
-                case 4:
-                    if (8 * sizeof(int) > 3 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 4 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(int, unsigned long, (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(int) - 1 > 4 * PyLong_SHIFT) {
-                            return (int) ((((((((((int)digits[3]) << PyLong_SHIFT) | (int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0])));
+                        break;
+                    case 4:
+                        if ((8 * sizeof(int) > 3 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 4 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(int, unsigned long, (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(int) - 1 > 4 * PyLong_SHIFT)) {
+                                return (int) ((((((((((int)digits[3]) << PyLong_SHIFT) | (int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0])));
+                            }
                         }
-                    }
-                    break;
+                        break;
+                }
             }
 #endif
-            if (sizeof(int) <= sizeof(long)) {
+            if ((sizeof(int) <= sizeof(long))) {
                 __PYX_VERIFY_RETURN_INT_EXC(int, long, PyLong_AsLong(x))
 #ifdef HAVE_LONG_LONG
-            } else if (sizeof(int) <= sizeof(PY_LONG_LONG)) {
+            } else if ((sizeof(int) <= sizeof(PY_LONG_LONG))) {
                 __PYX_VERIFY_RETURN_INT_EXC(int, PY_LONG_LONG, PyLong_AsLongLong(x))
 #endif
             }
         }
         {
-#if CYTHON_COMPILING_IN_PYPY && !defined(_PyLong_AsByteArray)
-            PyErr_SetString(PyExc_RuntimeError,
-                            "_PyLong_AsByteArray() not available in PyPy, cannot convert large numbers");
-#else
             int val;
             PyObject *v = __Pyx_PyNumber_IntOrLong(x);
- #if PY_MAJOR_VERSION < 3
+#if PY_MAJOR_VERSION < 3
             if (likely(v) && !PyLong_Check(v)) {
                 PyObject *tmp = v;
                 v = PyNumber_Long(tmp);
                 Py_DECREF(tmp);
             }
- #endif
+#endif
             if (likely(v)) {
+                int ret = -1;
+#if !(CYTHON_COMPILING_IN_PYPY || CYTHON_COMPILING_IN_LIMITED_API) || defined(_PyLong_AsByteArray)
                 int one = 1; int is_little = (int)*(unsigned char *)&one;
                 unsigned char *bytes = (unsigned char *)&val;
-                int ret = _PyLong_AsByteArray((PyLongObject *)v,
-                                              bytes, sizeof(val),
-                                              is_little, !is_unsigned);
+                ret = _PyLong_AsByteArray((PyLongObject *)v,
+                                           bytes, sizeof(val),
+                                           is_little, !is_unsigned);
+#else
+                PyObject *stepval = NULL, *mask = NULL, *shift = NULL;
+                int bits, remaining_bits, is_negative = 0;
+                long idigit;
+                int chunk_size = (sizeof(long) < 8) ? 30 : 62;
+                if (unlikely(!PyLong_CheckExact(v))) {
+                    PyObject *tmp = v;
+                    v = PyNumber_Long(v);
+                    assert(PyLong_CheckExact(v));
+                    Py_DECREF(tmp);
+                    if (unlikely(!v)) return (int) -1;
+                }
+#if CYTHON_COMPILING_IN_LIMITED_API && PY_VERSION_HEX < 0x030B0000
+                if (Py_SIZE(x) == 0)
+                    return (int) 0;
+                is_negative = Py_SIZE(x) < 0;
+#else
+                {
+                    int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
+                    if (unlikely(result < 0))
+                        return (int) -1;
+                    is_negative = result == 1;
+                }
+#endif
+                if (is_unsigned && unlikely(is_negative)) {
+                    goto raise_neg_overflow;
+                } else if (is_negative) {
+                    stepval = PyNumber_Invert(v);
+                    if (unlikely(!stepval))
+                        return (int) -1;
+                } else {
+                    stepval = __Pyx_NewRef(v);
+                }
+                val = (int) 0;
+                mask = PyLong_FromLong((1L << chunk_size) - 1); if (unlikely(!mask)) goto done;
+                shift = PyLong_FromLong(chunk_size); if (unlikely(!shift)) goto done;
+                for (bits = 0; bits < (int) sizeof(int) * 8 - chunk_size; bits += chunk_size) {
+                    PyObject *tmp, *digit;
+                    digit = PyNumber_And(stepval, mask);
+                    if (unlikely(!digit)) goto done;
+                    idigit = PyLong_AsLong(digit);
+                    Py_DECREF(digit);
+                    if (unlikely(idigit < 0)) goto done;
+                    tmp = PyNumber_Rshift(stepval, shift);
+                    if (unlikely(!tmp)) goto done;
+                    Py_DECREF(stepval); stepval = tmp;
+                    val |= ((int) idigit) << bits;
+                    #if CYTHON_COMPILING_IN_LIMITED_API && PY_VERSION_HEX < 0x030B0000
+                    if (Py_SIZE(stepval) == 0)
+                        goto unpacking_done;
+                    #endif
+                }
+                idigit = PyLong_AsLong(stepval);
+                if (unlikely(idigit < 0)) goto done;
+                remaining_bits = ((int) sizeof(int) * 8) - bits - (is_unsigned ? 0 : 1);
+                if (unlikely(idigit >= (1L << remaining_bits)))
+                    goto raise_overflow;
+                val |= ((int) idigit) << bits;
+            #if CYTHON_COMPILING_IN_LIMITED_API && PY_VERSION_HEX < 0x030B0000
+            unpacking_done:
+            #endif
+                if (!is_unsigned) {
+                    if (unlikely(val & (((int) 1) << (sizeof(int) * 8 - 1))))
+                        goto raise_overflow;
+                    if (is_negative)
+                        val = ~val;
+                }
+                ret = 0;
+            done:
+                Py_XDECREF(shift);
+                Py_XDECREF(mask);
+                Py_XDECREF(stepval);
+#endif
                 Py_DECREF(v);
                 if (likely(!ret))
                     return val;
             }
-#endif
             return (int) -1;
         }
     } else {
         int val;
         PyObject *tmp = __Pyx_PyNumber_IntOrLong(x);
         if (!tmp) return (int) -1;
         val = __Pyx_PyInt_As_int(tmp);
@@ -7119,181 +7976,265 @@
     PyErr_SetString(PyExc_OverflowError,
         "can't convert negative value to int");
     return (int) -1;
 }
 
 /* CIntFromPy */
 static CYTHON_INLINE size_t __Pyx_PyInt_As_size_t(PyObject *x) {
-    const size_t neg_one = (size_t) ((size_t) 0 - (size_t) 1), const_zero = (size_t) 0;
+#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
+#pragma GCC diagnostic push
+#pragma GCC diagnostic ignored "-Wconversion"
+#endif
+    const size_t neg_one = (size_t) -1, const_zero = (size_t) 0;
+#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
+#pragma GCC diagnostic pop
+#endif
     const int is_unsigned = neg_one > const_zero;
 #if PY_MAJOR_VERSION < 3
     if (likely(PyInt_Check(x))) {
-        if (sizeof(size_t) < sizeof(long)) {
+        if ((sizeof(size_t) < sizeof(long))) {
             __PYX_VERIFY_RETURN_INT(size_t, long, PyInt_AS_LONG(x))
         } else {
             long val = PyInt_AS_LONG(x);
             if (is_unsigned && unlikely(val < 0)) {
                 goto raise_neg_overflow;
             }
             return (size_t) val;
         }
     } else
 #endif
     if (likely(PyLong_Check(x))) {
         if (is_unsigned) {
 #if CYTHON_USE_PYLONG_INTERNALS
-            const digit* digits = ((PyLongObject*)x)->ob_digit;
-            switch (Py_SIZE(x)) {
-                case  0: return (size_t) 0;
-                case  1: __PYX_VERIFY_RETURN_INT(size_t, digit, digits[0])
-                case 2:
-                    if (8 * sizeof(size_t) > 1 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 2 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(size_t, unsigned long, (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(size_t) >= 2 * PyLong_SHIFT) {
-                            return (size_t) (((((size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0]));
+            if (unlikely(__Pyx_PyLong_IsNeg(x))) {
+                goto raise_neg_overflow;
+            } else if (__Pyx_PyLong_IsCompact(x)) {
+                __PYX_VERIFY_RETURN_INT(size_t, __Pyx_compact_upylong, __Pyx_PyLong_CompactValueUnsigned(x))
+            } else {
+                const digit* digits = __Pyx_PyLong_Digits(x);
+                assert(__Pyx_PyLong_DigitCount(x) > 1);
+                switch (__Pyx_PyLong_DigitCount(x)) {
+                    case 2:
+                        if ((8 * sizeof(size_t) > 1 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 2 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(size_t, unsigned long, (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(size_t) >= 2 * PyLong_SHIFT)) {
+                                return (size_t) (((((size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0]));
+                            }
                         }
-                    }
-                    break;
-                case 3:
-                    if (8 * sizeof(size_t) > 2 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 3 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(size_t, unsigned long, (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(size_t) >= 3 * PyLong_SHIFT) {
-                            return (size_t) (((((((size_t)digits[2]) << PyLong_SHIFT) | (size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0]));
+                        break;
+                    case 3:
+                        if ((8 * sizeof(size_t) > 2 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 3 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(size_t, unsigned long, (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(size_t) >= 3 * PyLong_SHIFT)) {
+                                return (size_t) (((((((size_t)digits[2]) << PyLong_SHIFT) | (size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0]));
+                            }
                         }
-                    }
-                    break;
-                case 4:
-                    if (8 * sizeof(size_t) > 3 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 4 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(size_t, unsigned long, (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(size_t) >= 4 * PyLong_SHIFT) {
-                            return (size_t) (((((((((size_t)digits[3]) << PyLong_SHIFT) | (size_t)digits[2]) << PyLong_SHIFT) | (size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0]));
+                        break;
+                    case 4:
+                        if ((8 * sizeof(size_t) > 3 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 4 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(size_t, unsigned long, (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(size_t) >= 4 * PyLong_SHIFT)) {
+                                return (size_t) (((((((((size_t)digits[3]) << PyLong_SHIFT) | (size_t)digits[2]) << PyLong_SHIFT) | (size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0]));
+                            }
                         }
-                    }
-                    break;
+                        break;
+                }
             }
 #endif
-#if CYTHON_COMPILING_IN_CPYTHON
+#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX < 0x030C00A7
             if (unlikely(Py_SIZE(x) < 0)) {
                 goto raise_neg_overflow;
             }
 #else
             {
                 int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
                 if (unlikely(result < 0))
                     return (size_t) -1;
                 if (unlikely(result == 1))
                     goto raise_neg_overflow;
             }
 #endif
-            if (sizeof(size_t) <= sizeof(unsigned long)) {
+            if ((sizeof(size_t) <= sizeof(unsigned long))) {
                 __PYX_VERIFY_RETURN_INT_EXC(size_t, unsigned long, PyLong_AsUnsignedLong(x))
 #ifdef HAVE_LONG_LONG
-            } else if (sizeof(size_t) <= sizeof(unsigned PY_LONG_LONG)) {
+            } else if ((sizeof(size_t) <= sizeof(unsigned PY_LONG_LONG))) {
                 __PYX_VERIFY_RETURN_INT_EXC(size_t, unsigned PY_LONG_LONG, PyLong_AsUnsignedLongLong(x))
 #endif
             }
         } else {
 #if CYTHON_USE_PYLONG_INTERNALS
-            const digit* digits = ((PyLongObject*)x)->ob_digit;
-            switch (Py_SIZE(x)) {
-                case  0: return (size_t) 0;
-                case -1: __PYX_VERIFY_RETURN_INT(size_t, sdigit, (sdigit) (-(sdigit)digits[0]))
-                case  1: __PYX_VERIFY_RETURN_INT(size_t,  digit, +digits[0])
-                case -2:
-                    if (8 * sizeof(size_t) - 1 > 1 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 2 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(size_t, long, -(long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(size_t) - 1 > 2 * PyLong_SHIFT) {
-                            return (size_t) (((size_t)-1)*(((((size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0])));
+            if (__Pyx_PyLong_IsCompact(x)) {
+                __PYX_VERIFY_RETURN_INT(size_t, __Pyx_compact_pylong, __Pyx_PyLong_CompactValue(x))
+            } else {
+                const digit* digits = __Pyx_PyLong_Digits(x);
+                assert(__Pyx_PyLong_DigitCount(x) > 1);
+                switch (__Pyx_PyLong_SignedDigitCount(x)) {
+                    case -2:
+                        if ((8 * sizeof(size_t) - 1 > 1 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 2 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(size_t, long, -(long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(size_t) - 1 > 2 * PyLong_SHIFT)) {
+                                return (size_t) (((size_t)-1)*(((((size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0])));
+                            }
                         }
-                    }
-                    break;
-                case 2:
-                    if (8 * sizeof(size_t) > 1 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 2 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(size_t, unsigned long, (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(size_t) - 1 > 2 * PyLong_SHIFT) {
-                            return (size_t) ((((((size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0])));
+                        break;
+                    case 2:
+                        if ((8 * sizeof(size_t) > 1 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 2 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(size_t, unsigned long, (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(size_t) - 1 > 2 * PyLong_SHIFT)) {
+                                return (size_t) ((((((size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0])));
+                            }
                         }
-                    }
-                    break;
-                case -3:
-                    if (8 * sizeof(size_t) - 1 > 2 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 3 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(size_t, long, -(long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(size_t) - 1 > 3 * PyLong_SHIFT) {
-                            return (size_t) (((size_t)-1)*(((((((size_t)digits[2]) << PyLong_SHIFT) | (size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0])));
+                        break;
+                    case -3:
+                        if ((8 * sizeof(size_t) - 1 > 2 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 3 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(size_t, long, -(long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(size_t) - 1 > 3 * PyLong_SHIFT)) {
+                                return (size_t) (((size_t)-1)*(((((((size_t)digits[2]) << PyLong_SHIFT) | (size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0])));
+                            }
                         }
-                    }
-                    break;
-                case 3:
-                    if (8 * sizeof(size_t) > 2 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 3 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(size_t, unsigned long, (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(size_t) - 1 > 3 * PyLong_SHIFT) {
-                            return (size_t) ((((((((size_t)digits[2]) << PyLong_SHIFT) | (size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0])));
+                        break;
+                    case 3:
+                        if ((8 * sizeof(size_t) > 2 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 3 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(size_t, unsigned long, (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(size_t) - 1 > 3 * PyLong_SHIFT)) {
+                                return (size_t) ((((((((size_t)digits[2]) << PyLong_SHIFT) | (size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0])));
+                            }
                         }
-                    }
-                    break;
-                case -4:
-                    if (8 * sizeof(size_t) - 1 > 3 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 4 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(size_t, long, -(long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(size_t) - 1 > 4 * PyLong_SHIFT) {
-                            return (size_t) (((size_t)-1)*(((((((((size_t)digits[3]) << PyLong_SHIFT) | (size_t)digits[2]) << PyLong_SHIFT) | (size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0])));
+                        break;
+                    case -4:
+                        if ((8 * sizeof(size_t) - 1 > 3 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 4 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(size_t, long, -(long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(size_t) - 1 > 4 * PyLong_SHIFT)) {
+                                return (size_t) (((size_t)-1)*(((((((((size_t)digits[3]) << PyLong_SHIFT) | (size_t)digits[2]) << PyLong_SHIFT) | (size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0])));
+                            }
                         }
-                    }
-                    break;
-                case 4:
-                    if (8 * sizeof(size_t) > 3 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 4 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(size_t, unsigned long, (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(size_t) - 1 > 4 * PyLong_SHIFT) {
-                            return (size_t) ((((((((((size_t)digits[3]) << PyLong_SHIFT) | (size_t)digits[2]) << PyLong_SHIFT) | (size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0])));
+                        break;
+                    case 4:
+                        if ((8 * sizeof(size_t) > 3 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 4 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(size_t, unsigned long, (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(size_t) - 1 > 4 * PyLong_SHIFT)) {
+                                return (size_t) ((((((((((size_t)digits[3]) << PyLong_SHIFT) | (size_t)digits[2]) << PyLong_SHIFT) | (size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0])));
+                            }
                         }
-                    }
-                    break;
+                        break;
+                }
             }
 #endif
-            if (sizeof(size_t) <= sizeof(long)) {
+            if ((sizeof(size_t) <= sizeof(long))) {
                 __PYX_VERIFY_RETURN_INT_EXC(size_t, long, PyLong_AsLong(x))
 #ifdef HAVE_LONG_LONG
-            } else if (sizeof(size_t) <= sizeof(PY_LONG_LONG)) {
+            } else if ((sizeof(size_t) <= sizeof(PY_LONG_LONG))) {
                 __PYX_VERIFY_RETURN_INT_EXC(size_t, PY_LONG_LONG, PyLong_AsLongLong(x))
 #endif
             }
         }
         {
-#if CYTHON_COMPILING_IN_PYPY && !defined(_PyLong_AsByteArray)
-            PyErr_SetString(PyExc_RuntimeError,
-                            "_PyLong_AsByteArray() not available in PyPy, cannot convert large numbers");
-#else
             size_t val;
             PyObject *v = __Pyx_PyNumber_IntOrLong(x);
- #if PY_MAJOR_VERSION < 3
+#if PY_MAJOR_VERSION < 3
             if (likely(v) && !PyLong_Check(v)) {
                 PyObject *tmp = v;
                 v = PyNumber_Long(tmp);
                 Py_DECREF(tmp);
             }
- #endif
+#endif
             if (likely(v)) {
+                int ret = -1;
+#if !(CYTHON_COMPILING_IN_PYPY || CYTHON_COMPILING_IN_LIMITED_API) || defined(_PyLong_AsByteArray)
                 int one = 1; int is_little = (int)*(unsigned char *)&one;
                 unsigned char *bytes = (unsigned char *)&val;
-                int ret = _PyLong_AsByteArray((PyLongObject *)v,
-                                              bytes, sizeof(val),
-                                              is_little, !is_unsigned);
+                ret = _PyLong_AsByteArray((PyLongObject *)v,
+                                           bytes, sizeof(val),
+                                           is_little, !is_unsigned);
+#else
+                PyObject *stepval = NULL, *mask = NULL, *shift = NULL;
+                int bits, remaining_bits, is_negative = 0;
+                long idigit;
+                int chunk_size = (sizeof(long) < 8) ? 30 : 62;
+                if (unlikely(!PyLong_CheckExact(v))) {
+                    PyObject *tmp = v;
+                    v = PyNumber_Long(v);
+                    assert(PyLong_CheckExact(v));
+                    Py_DECREF(tmp);
+                    if (unlikely(!v)) return (size_t) -1;
+                }
+#if CYTHON_COMPILING_IN_LIMITED_API && PY_VERSION_HEX < 0x030B0000
+                if (Py_SIZE(x) == 0)
+                    return (size_t) 0;
+                is_negative = Py_SIZE(x) < 0;
+#else
+                {
+                    int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
+                    if (unlikely(result < 0))
+                        return (size_t) -1;
+                    is_negative = result == 1;
+                }
+#endif
+                if (is_unsigned && unlikely(is_negative)) {
+                    goto raise_neg_overflow;
+                } else if (is_negative) {
+                    stepval = PyNumber_Invert(v);
+                    if (unlikely(!stepval))
+                        return (size_t) -1;
+                } else {
+                    stepval = __Pyx_NewRef(v);
+                }
+                val = (size_t) 0;
+                mask = PyLong_FromLong((1L << chunk_size) - 1); if (unlikely(!mask)) goto done;
+                shift = PyLong_FromLong(chunk_size); if (unlikely(!shift)) goto done;
+                for (bits = 0; bits < (int) sizeof(size_t) * 8 - chunk_size; bits += chunk_size) {
+                    PyObject *tmp, *digit;
+                    digit = PyNumber_And(stepval, mask);
+                    if (unlikely(!digit)) goto done;
+                    idigit = PyLong_AsLong(digit);
+                    Py_DECREF(digit);
+                    if (unlikely(idigit < 0)) goto done;
+                    tmp = PyNumber_Rshift(stepval, shift);
+                    if (unlikely(!tmp)) goto done;
+                    Py_DECREF(stepval); stepval = tmp;
+                    val |= ((size_t) idigit) << bits;
+                    #if CYTHON_COMPILING_IN_LIMITED_API && PY_VERSION_HEX < 0x030B0000
+                    if (Py_SIZE(stepval) == 0)
+                        goto unpacking_done;
+                    #endif
+                }
+                idigit = PyLong_AsLong(stepval);
+                if (unlikely(idigit < 0)) goto done;
+                remaining_bits = ((int) sizeof(size_t) * 8) - bits - (is_unsigned ? 0 : 1);
+                if (unlikely(idigit >= (1L << remaining_bits)))
+                    goto raise_overflow;
+                val |= ((size_t) idigit) << bits;
+            #if CYTHON_COMPILING_IN_LIMITED_API && PY_VERSION_HEX < 0x030B0000
+            unpacking_done:
+            #endif
+                if (!is_unsigned) {
+                    if (unlikely(val & (((size_t) 1) << (sizeof(size_t) * 8 - 1))))
+                        goto raise_overflow;
+                    if (is_negative)
+                        val = ~val;
+                }
+                ret = 0;
+            done:
+                Py_XDECREF(shift);
+                Py_XDECREF(mask);
+                Py_XDECREF(stepval);
+#endif
                 Py_DECREF(v);
                 if (likely(!ret))
                     return val;
             }
-#endif
             return (size_t) -1;
         }
     } else {
         size_t val;
         PyObject *tmp = __Pyx_PyNumber_IntOrLong(x);
         if (!tmp) return (size_t) -1;
         val = __Pyx_PyInt_As_size_t(tmp);
@@ -7306,75 +8247,115 @@
     return (size_t) -1;
 raise_neg_overflow:
     PyErr_SetString(PyExc_OverflowError,
         "can't convert negative value to size_t");
     return (size_t) -1;
 }
 
-/* GetAttr */
-static CYTHON_INLINE PyObject *__Pyx_GetAttr(PyObject *o, PyObject *n) {
-#if CYTHON_USE_TYPE_SLOTS
-#if PY_MAJOR_VERSION >= 3
-    if (likely(PyUnicode_Check(n)))
-#else
-    if (likely(PyString_Check(n)))
+/* CIntToPy */
+static CYTHON_INLINE PyObject* __Pyx_PyInt_From_int(int value) {
+#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
+#pragma GCC diagnostic push
+#pragma GCC diagnostic ignored "-Wconversion"
+#endif
+    const int neg_one = (int) -1, const_zero = (int) 0;
+#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
+#pragma GCC diagnostic pop
 #endif
-        return __Pyx_PyObject_GetAttrStr(o, n);
+    const int is_unsigned = neg_one > const_zero;
+    if (is_unsigned) {
+        if (sizeof(int) < sizeof(long)) {
+            return PyInt_FromLong((long) value);
+        } else if (sizeof(int) <= sizeof(unsigned long)) {
+            return PyLong_FromUnsignedLong((unsigned long) value);
+#ifdef HAVE_LONG_LONG
+        } else if (sizeof(int) <= sizeof(unsigned PY_LONG_LONG)) {
+            return PyLong_FromUnsignedLongLong((unsigned PY_LONG_LONG) value);
+#endif
+        }
+    } else {
+        if (sizeof(int) <= sizeof(long)) {
+            return PyInt_FromLong((long) value);
+#ifdef HAVE_LONG_LONG
+        } else if (sizeof(int) <= sizeof(PY_LONG_LONG)) {
+            return PyLong_FromLongLong((PY_LONG_LONG) value);
 #endif
-    return PyObject_GetAttr(o, n);
+        }
+    }
+    {
+        int one = 1; int little = (int)*(unsigned char *)&one;
+        unsigned char *bytes = (unsigned char *)&value;
+        return _PyLong_FromByteArray(bytes, sizeof(int),
+                                     little, !is_unsigned);
+    }
 }
 
-/* Globals */
-static PyObject* __Pyx_Globals(void) {
-    Py_ssize_t i;
-    PyObject *names;
-    PyObject *globals = __pyx_d;
-    Py_INCREF(globals);
-    names = PyObject_Dir(__pyx_m);
-    if (!names)
-        goto bad;
-    for (i = PyList_GET_SIZE(names)-1; i >= 0; i--) {
-#if CYTHON_COMPILING_IN_PYPY
-        PyObject* name = PySequence_ITEM(names, i);
-        if (!name)
-            goto bad;
-#else
-        PyObject* name = PyList_GET_ITEM(names, i);
-#endif
-        if (!PyDict_Contains(globals, name)) {
-            PyObject* value = __Pyx_GetAttr(__pyx_m, name);
-            if (!value) {
-#if CYTHON_COMPILING_IN_PYPY
-                Py_DECREF(name);
+/* CIntToPy */
+static CYTHON_INLINE PyObject* __Pyx_PyInt_From_uint32_t(uint32_t value) {
+#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
+#pragma GCC diagnostic push
+#pragma GCC diagnostic ignored "-Wconversion"
+#endif
+    const uint32_t neg_one = (uint32_t) -1, const_zero = (uint32_t) 0;
+#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
+#pragma GCC diagnostic pop
 #endif
-                goto bad;
-            }
-            if (PyDict_SetItem(globals, name, value) < 0) {
-#if CYTHON_COMPILING_IN_PYPY
-                Py_DECREF(name);
+    const int is_unsigned = neg_one > const_zero;
+    if (is_unsigned) {
+        if (sizeof(uint32_t) < sizeof(long)) {
+            return PyInt_FromLong((long) value);
+        } else if (sizeof(uint32_t) <= sizeof(unsigned long)) {
+            return PyLong_FromUnsignedLong((unsigned long) value);
+#ifdef HAVE_LONG_LONG
+        } else if (sizeof(uint32_t) <= sizeof(unsigned PY_LONG_LONG)) {
+            return PyLong_FromUnsignedLongLong((unsigned PY_LONG_LONG) value);
 #endif
-                Py_DECREF(value);
-                goto bad;
-            }
         }
-#if CYTHON_COMPILING_IN_PYPY
-        Py_DECREF(name);
+    } else {
+        if (sizeof(uint32_t) <= sizeof(long)) {
+            return PyInt_FromLong((long) value);
+#ifdef HAVE_LONG_LONG
+        } else if (sizeof(uint32_t) <= sizeof(PY_LONG_LONG)) {
+            return PyLong_FromLongLong((PY_LONG_LONG) value);
 #endif
+        }
     }
-    Py_DECREF(names);
-    return globals;
-bad:
-    Py_XDECREF(names);
-    Py_XDECREF(globals);
-    return NULL;
+    {
+        int one = 1; int little = (int)*(unsigned char *)&one;
+        unsigned char *bytes = (unsigned char *)&value;
+        return _PyLong_FromByteArray(bytes, sizeof(uint32_t),
+                                     little, !is_unsigned);
+    }
+}
+
+/* FormatTypeName */
+#if CYTHON_COMPILING_IN_LIMITED_API
+static __Pyx_TypeName
+__Pyx_PyType_GetName(PyTypeObject* tp)
+{
+    PyObject *name = __Pyx_PyObject_GetAttrStr((PyObject *)tp,
+                                               __pyx_n_s_name);
+    if (unlikely(name == NULL) || unlikely(!PyUnicode_Check(name))) {
+        PyErr_Clear();
+        Py_XSETREF(name, __Pyx_NewRef(__pyx_n_s__22));
+    }
+    return name;
 }
+#endif
 
 /* CIntToPy */
 static CYTHON_INLINE PyObject* __Pyx_PyInt_From_long(long value) {
-    const long neg_one = (long) ((long) 0 - (long) 1), const_zero = (long) 0;
+#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
+#pragma GCC diagnostic push
+#pragma GCC diagnostic ignored "-Wconversion"
+#endif
+    const long neg_one = (long) -1, const_zero = (long) 0;
+#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
+#pragma GCC diagnostic pop
+#endif
     const int is_unsigned = neg_one > const_zero;
     if (is_unsigned) {
         if (sizeof(long) < sizeof(long)) {
             return PyInt_FromLong((long) value);
         } else if (sizeof(long) <= sizeof(unsigned long)) {
             return PyLong_FromUnsignedLong((unsigned long) value);
 #ifdef HAVE_LONG_LONG
@@ -7397,181 +8378,265 @@
         return _PyLong_FromByteArray(bytes, sizeof(long),
                                      little, !is_unsigned);
     }
 }
 
 /* CIntFromPy */
 static CYTHON_INLINE long __Pyx_PyInt_As_long(PyObject *x) {
-    const long neg_one = (long) ((long) 0 - (long) 1), const_zero = (long) 0;
+#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
+#pragma GCC diagnostic push
+#pragma GCC diagnostic ignored "-Wconversion"
+#endif
+    const long neg_one = (long) -1, const_zero = (long) 0;
+#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
+#pragma GCC diagnostic pop
+#endif
     const int is_unsigned = neg_one > const_zero;
 #if PY_MAJOR_VERSION < 3
     if (likely(PyInt_Check(x))) {
-        if (sizeof(long) < sizeof(long)) {
+        if ((sizeof(long) < sizeof(long))) {
             __PYX_VERIFY_RETURN_INT(long, long, PyInt_AS_LONG(x))
         } else {
             long val = PyInt_AS_LONG(x);
             if (is_unsigned && unlikely(val < 0)) {
                 goto raise_neg_overflow;
             }
             return (long) val;
         }
     } else
 #endif
     if (likely(PyLong_Check(x))) {
         if (is_unsigned) {
 #if CYTHON_USE_PYLONG_INTERNALS
-            const digit* digits = ((PyLongObject*)x)->ob_digit;
-            switch (Py_SIZE(x)) {
-                case  0: return (long) 0;
-                case  1: __PYX_VERIFY_RETURN_INT(long, digit, digits[0])
-                case 2:
-                    if (8 * sizeof(long) > 1 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 2 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(long, unsigned long, (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(long) >= 2 * PyLong_SHIFT) {
-                            return (long) (((((long)digits[1]) << PyLong_SHIFT) | (long)digits[0]));
+            if (unlikely(__Pyx_PyLong_IsNeg(x))) {
+                goto raise_neg_overflow;
+            } else if (__Pyx_PyLong_IsCompact(x)) {
+                __PYX_VERIFY_RETURN_INT(long, __Pyx_compact_upylong, __Pyx_PyLong_CompactValueUnsigned(x))
+            } else {
+                const digit* digits = __Pyx_PyLong_Digits(x);
+                assert(__Pyx_PyLong_DigitCount(x) > 1);
+                switch (__Pyx_PyLong_DigitCount(x)) {
+                    case 2:
+                        if ((8 * sizeof(long) > 1 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 2 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(long, unsigned long, (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(long) >= 2 * PyLong_SHIFT)) {
+                                return (long) (((((long)digits[1]) << PyLong_SHIFT) | (long)digits[0]));
+                            }
                         }
-                    }
-                    break;
-                case 3:
-                    if (8 * sizeof(long) > 2 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 3 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(long, unsigned long, (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(long) >= 3 * PyLong_SHIFT) {
-                            return (long) (((((((long)digits[2]) << PyLong_SHIFT) | (long)digits[1]) << PyLong_SHIFT) | (long)digits[0]));
+                        break;
+                    case 3:
+                        if ((8 * sizeof(long) > 2 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 3 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(long, unsigned long, (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(long) >= 3 * PyLong_SHIFT)) {
+                                return (long) (((((((long)digits[2]) << PyLong_SHIFT) | (long)digits[1]) << PyLong_SHIFT) | (long)digits[0]));
+                            }
                         }
-                    }
-                    break;
-                case 4:
-                    if (8 * sizeof(long) > 3 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 4 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(long, unsigned long, (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(long) >= 4 * PyLong_SHIFT) {
-                            return (long) (((((((((long)digits[3]) << PyLong_SHIFT) | (long)digits[2]) << PyLong_SHIFT) | (long)digits[1]) << PyLong_SHIFT) | (long)digits[0]));
+                        break;
+                    case 4:
+                        if ((8 * sizeof(long) > 3 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 4 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(long, unsigned long, (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(long) >= 4 * PyLong_SHIFT)) {
+                                return (long) (((((((((long)digits[3]) << PyLong_SHIFT) | (long)digits[2]) << PyLong_SHIFT) | (long)digits[1]) << PyLong_SHIFT) | (long)digits[0]));
+                            }
                         }
-                    }
-                    break;
+                        break;
+                }
             }
 #endif
-#if CYTHON_COMPILING_IN_CPYTHON
+#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX < 0x030C00A7
             if (unlikely(Py_SIZE(x) < 0)) {
                 goto raise_neg_overflow;
             }
 #else
             {
                 int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
                 if (unlikely(result < 0))
                     return (long) -1;
                 if (unlikely(result == 1))
                     goto raise_neg_overflow;
             }
 #endif
-            if (sizeof(long) <= sizeof(unsigned long)) {
+            if ((sizeof(long) <= sizeof(unsigned long))) {
                 __PYX_VERIFY_RETURN_INT_EXC(long, unsigned long, PyLong_AsUnsignedLong(x))
 #ifdef HAVE_LONG_LONG
-            } else if (sizeof(long) <= sizeof(unsigned PY_LONG_LONG)) {
+            } else if ((sizeof(long) <= sizeof(unsigned PY_LONG_LONG))) {
                 __PYX_VERIFY_RETURN_INT_EXC(long, unsigned PY_LONG_LONG, PyLong_AsUnsignedLongLong(x))
 #endif
             }
         } else {
 #if CYTHON_USE_PYLONG_INTERNALS
-            const digit* digits = ((PyLongObject*)x)->ob_digit;
-            switch (Py_SIZE(x)) {
-                case  0: return (long) 0;
-                case -1: __PYX_VERIFY_RETURN_INT(long, sdigit, (sdigit) (-(sdigit)digits[0]))
-                case  1: __PYX_VERIFY_RETURN_INT(long,  digit, +digits[0])
-                case -2:
-                    if (8 * sizeof(long) - 1 > 1 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 2 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(long, long, -(long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(long) - 1 > 2 * PyLong_SHIFT) {
-                            return (long) (((long)-1)*(((((long)digits[1]) << PyLong_SHIFT) | (long)digits[0])));
+            if (__Pyx_PyLong_IsCompact(x)) {
+                __PYX_VERIFY_RETURN_INT(long, __Pyx_compact_pylong, __Pyx_PyLong_CompactValue(x))
+            } else {
+                const digit* digits = __Pyx_PyLong_Digits(x);
+                assert(__Pyx_PyLong_DigitCount(x) > 1);
+                switch (__Pyx_PyLong_SignedDigitCount(x)) {
+                    case -2:
+                        if ((8 * sizeof(long) - 1 > 1 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 2 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(long, long, -(long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(long) - 1 > 2 * PyLong_SHIFT)) {
+                                return (long) (((long)-1)*(((((long)digits[1]) << PyLong_SHIFT) | (long)digits[0])));
+                            }
                         }
-                    }
-                    break;
-                case 2:
-                    if (8 * sizeof(long) > 1 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 2 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(long, unsigned long, (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(long) - 1 > 2 * PyLong_SHIFT) {
-                            return (long) ((((((long)digits[1]) << PyLong_SHIFT) | (long)digits[0])));
+                        break;
+                    case 2:
+                        if ((8 * sizeof(long) > 1 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 2 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(long, unsigned long, (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(long) - 1 > 2 * PyLong_SHIFT)) {
+                                return (long) ((((((long)digits[1]) << PyLong_SHIFT) | (long)digits[0])));
+                            }
                         }
-                    }
-                    break;
-                case -3:
-                    if (8 * sizeof(long) - 1 > 2 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 3 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(long, long, -(long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(long) - 1 > 3 * PyLong_SHIFT) {
-                            return (long) (((long)-1)*(((((((long)digits[2]) << PyLong_SHIFT) | (long)digits[1]) << PyLong_SHIFT) | (long)digits[0])));
+                        break;
+                    case -3:
+                        if ((8 * sizeof(long) - 1 > 2 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 3 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(long, long, -(long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(long) - 1 > 3 * PyLong_SHIFT)) {
+                                return (long) (((long)-1)*(((((((long)digits[2]) << PyLong_SHIFT) | (long)digits[1]) << PyLong_SHIFT) | (long)digits[0])));
+                            }
                         }
-                    }
-                    break;
-                case 3:
-                    if (8 * sizeof(long) > 2 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 3 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(long, unsigned long, (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(long) - 1 > 3 * PyLong_SHIFT) {
-                            return (long) ((((((((long)digits[2]) << PyLong_SHIFT) | (long)digits[1]) << PyLong_SHIFT) | (long)digits[0])));
+                        break;
+                    case 3:
+                        if ((8 * sizeof(long) > 2 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 3 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(long, unsigned long, (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(long) - 1 > 3 * PyLong_SHIFT)) {
+                                return (long) ((((((((long)digits[2]) << PyLong_SHIFT) | (long)digits[1]) << PyLong_SHIFT) | (long)digits[0])));
+                            }
                         }
-                    }
-                    break;
-                case -4:
-                    if (8 * sizeof(long) - 1 > 3 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 4 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(long, long, -(long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(long) - 1 > 4 * PyLong_SHIFT) {
-                            return (long) (((long)-1)*(((((((((long)digits[3]) << PyLong_SHIFT) | (long)digits[2]) << PyLong_SHIFT) | (long)digits[1]) << PyLong_SHIFT) | (long)digits[0])));
+                        break;
+                    case -4:
+                        if ((8 * sizeof(long) - 1 > 3 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 4 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(long, long, -(long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(long) - 1 > 4 * PyLong_SHIFT)) {
+                                return (long) (((long)-1)*(((((((((long)digits[3]) << PyLong_SHIFT) | (long)digits[2]) << PyLong_SHIFT) | (long)digits[1]) << PyLong_SHIFT) | (long)digits[0])));
+                            }
                         }
-                    }
-                    break;
-                case 4:
-                    if (8 * sizeof(long) > 3 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 4 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(long, unsigned long, (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(long) - 1 > 4 * PyLong_SHIFT) {
-                            return (long) ((((((((((long)digits[3]) << PyLong_SHIFT) | (long)digits[2]) << PyLong_SHIFT) | (long)digits[1]) << PyLong_SHIFT) | (long)digits[0])));
+                        break;
+                    case 4:
+                        if ((8 * sizeof(long) > 3 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 4 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(long, unsigned long, (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(long) - 1 > 4 * PyLong_SHIFT)) {
+                                return (long) ((((((((((long)digits[3]) << PyLong_SHIFT) | (long)digits[2]) << PyLong_SHIFT) | (long)digits[1]) << PyLong_SHIFT) | (long)digits[0])));
+                            }
                         }
-                    }
-                    break;
+                        break;
+                }
             }
 #endif
-            if (sizeof(long) <= sizeof(long)) {
+            if ((sizeof(long) <= sizeof(long))) {
                 __PYX_VERIFY_RETURN_INT_EXC(long, long, PyLong_AsLong(x))
 #ifdef HAVE_LONG_LONG
-            } else if (sizeof(long) <= sizeof(PY_LONG_LONG)) {
+            } else if ((sizeof(long) <= sizeof(PY_LONG_LONG))) {
                 __PYX_VERIFY_RETURN_INT_EXC(long, PY_LONG_LONG, PyLong_AsLongLong(x))
 #endif
             }
         }
         {
-#if CYTHON_COMPILING_IN_PYPY && !defined(_PyLong_AsByteArray)
-            PyErr_SetString(PyExc_RuntimeError,
-                            "_PyLong_AsByteArray() not available in PyPy, cannot convert large numbers");
-#else
             long val;
             PyObject *v = __Pyx_PyNumber_IntOrLong(x);
- #if PY_MAJOR_VERSION < 3
+#if PY_MAJOR_VERSION < 3
             if (likely(v) && !PyLong_Check(v)) {
                 PyObject *tmp = v;
                 v = PyNumber_Long(tmp);
                 Py_DECREF(tmp);
             }
- #endif
+#endif
             if (likely(v)) {
+                int ret = -1;
+#if !(CYTHON_COMPILING_IN_PYPY || CYTHON_COMPILING_IN_LIMITED_API) || defined(_PyLong_AsByteArray)
                 int one = 1; int is_little = (int)*(unsigned char *)&one;
                 unsigned char *bytes = (unsigned char *)&val;
-                int ret = _PyLong_AsByteArray((PyLongObject *)v,
-                                              bytes, sizeof(val),
-                                              is_little, !is_unsigned);
+                ret = _PyLong_AsByteArray((PyLongObject *)v,
+                                           bytes, sizeof(val),
+                                           is_little, !is_unsigned);
+#else
+                PyObject *stepval = NULL, *mask = NULL, *shift = NULL;
+                int bits, remaining_bits, is_negative = 0;
+                long idigit;
+                int chunk_size = (sizeof(long) < 8) ? 30 : 62;
+                if (unlikely(!PyLong_CheckExact(v))) {
+                    PyObject *tmp = v;
+                    v = PyNumber_Long(v);
+                    assert(PyLong_CheckExact(v));
+                    Py_DECREF(tmp);
+                    if (unlikely(!v)) return (long) -1;
+                }
+#if CYTHON_COMPILING_IN_LIMITED_API && PY_VERSION_HEX < 0x030B0000
+                if (Py_SIZE(x) == 0)
+                    return (long) 0;
+                is_negative = Py_SIZE(x) < 0;
+#else
+                {
+                    int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
+                    if (unlikely(result < 0))
+                        return (long) -1;
+                    is_negative = result == 1;
+                }
+#endif
+                if (is_unsigned && unlikely(is_negative)) {
+                    goto raise_neg_overflow;
+                } else if (is_negative) {
+                    stepval = PyNumber_Invert(v);
+                    if (unlikely(!stepval))
+                        return (long) -1;
+                } else {
+                    stepval = __Pyx_NewRef(v);
+                }
+                val = (long) 0;
+                mask = PyLong_FromLong((1L << chunk_size) - 1); if (unlikely(!mask)) goto done;
+                shift = PyLong_FromLong(chunk_size); if (unlikely(!shift)) goto done;
+                for (bits = 0; bits < (int) sizeof(long) * 8 - chunk_size; bits += chunk_size) {
+                    PyObject *tmp, *digit;
+                    digit = PyNumber_And(stepval, mask);
+                    if (unlikely(!digit)) goto done;
+                    idigit = PyLong_AsLong(digit);
+                    Py_DECREF(digit);
+                    if (unlikely(idigit < 0)) goto done;
+                    tmp = PyNumber_Rshift(stepval, shift);
+                    if (unlikely(!tmp)) goto done;
+                    Py_DECREF(stepval); stepval = tmp;
+                    val |= ((long) idigit) << bits;
+                    #if CYTHON_COMPILING_IN_LIMITED_API && PY_VERSION_HEX < 0x030B0000
+                    if (Py_SIZE(stepval) == 0)
+                        goto unpacking_done;
+                    #endif
+                }
+                idigit = PyLong_AsLong(stepval);
+                if (unlikely(idigit < 0)) goto done;
+                remaining_bits = ((int) sizeof(long) * 8) - bits - (is_unsigned ? 0 : 1);
+                if (unlikely(idigit >= (1L << remaining_bits)))
+                    goto raise_overflow;
+                val |= ((long) idigit) << bits;
+            #if CYTHON_COMPILING_IN_LIMITED_API && PY_VERSION_HEX < 0x030B0000
+            unpacking_done:
+            #endif
+                if (!is_unsigned) {
+                    if (unlikely(val & (((long) 1) << (sizeof(long) * 8 - 1))))
+                        goto raise_overflow;
+                    if (is_negative)
+                        val = ~val;
+                }
+                ret = 0;
+            done:
+                Py_XDECREF(shift);
+                Py_XDECREF(mask);
+                Py_XDECREF(stepval);
+#endif
                 Py_DECREF(v);
                 if (likely(!ret))
                     return val;
             }
-#endif
             return (long) -1;
         }
     } else {
         long val;
         PyObject *tmp = __Pyx_PyNumber_IntOrLong(x);
         if (!tmp) return (long) -1;
         val = __Pyx_PyInt_As_long(tmp);
@@ -7588,15 +8653,15 @@
     return (long) -1;
 }
 
 /* FastTypeChecks */
 #if CYTHON_COMPILING_IN_CPYTHON
 static int __Pyx_InBases(PyTypeObject *a, PyTypeObject *b) {
     while (a) {
-        a = a->tp_base;
+        a = __Pyx_PyType_GetSlot(a, tp_base, PyTypeObject*);
         if (a == b)
             return 1;
     }
     return b == &PyBaseObject_Type;
 }
 static CYTHON_INLINE int __Pyx_IsSubtype(PyTypeObject *a, PyTypeObject *b) {
     PyObject *mro;
@@ -7609,14 +8674,30 @@
             if (PyTuple_GET_ITEM(mro, i) == (PyObject *)b)
                 return 1;
         }
         return 0;
     }
     return __Pyx_InBases(a, b);
 }
+static CYTHON_INLINE int __Pyx_IsAnySubtype2(PyTypeObject *cls, PyTypeObject *a, PyTypeObject *b) {
+    PyObject *mro;
+    if (cls == a || cls == b) return 1;
+    mro = cls->tp_mro;
+    if (likely(mro)) {
+        Py_ssize_t i, n;
+        n = PyTuple_GET_SIZE(mro);
+        for (i = 0; i < n; i++) {
+            PyObject *base = PyTuple_GET_ITEM(mro, i);
+            if (base == (PyObject *)a || base == (PyObject *)b)
+                return 1;
+        }
+        return 0;
+    }
+    return __Pyx_InBases(cls, a) || __Pyx_InBases(cls, b);
+}
 #if PY_MAJOR_VERSION == 2
 static int __Pyx_inner_PyErr_GivenExceptionMatches2(PyObject *err, PyObject* exc_type1, PyObject* exc_type2) {
     PyObject *exception, *value, *tb;
     int res;
     __Pyx_PyThreadState_declare
     __Pyx_PyThreadState_assign
     __Pyx_ErrFetch(&exception, &value, &tb);
@@ -7633,19 +8714,19 @@
         }
     }
     __Pyx_ErrRestore(exception, value, tb);
     return res;
 }
 #else
 static CYTHON_INLINE int __Pyx_inner_PyErr_GivenExceptionMatches2(PyObject *err, PyObject* exc_type1, PyObject *exc_type2) {
-    int res = exc_type1 ? __Pyx_IsSubtype((PyTypeObject*)err, (PyTypeObject*)exc_type1) : 0;
-    if (!res) {
-        res = __Pyx_IsSubtype((PyTypeObject*)err, (PyTypeObject*)exc_type2);
+    if (exc_type1) {
+        return __Pyx_IsAnySubtype2((PyTypeObject*)err, (PyTypeObject*)exc_type1, (PyTypeObject*)exc_type2);
+    } else {
+        return __Pyx_IsSubtype((PyTypeObject*)err, (PyTypeObject*)exc_type2);
     }
-    return res;
 }
 #endif
 static int __Pyx_PyErr_GivenExceptionMatchesTuple(PyObject *exc_type, PyObject *tuple) {
     Py_ssize_t i, n;
     assert(PyExceptionClass_Check(exc_type));
     n = PyTuple_GET_SIZE(tuple);
 #if PY_MAJOR_VERSION >= 3
@@ -7686,56 +8767,88 @@
     }
     return (PyErr_GivenExceptionMatches(err, exc_type1) || PyErr_GivenExceptionMatches(err, exc_type2));
 }
 #endif
 
 /* CheckBinaryVersion */
 static int __Pyx_check_binary_version(void) {
-    char ctversion[4], rtversion[4];
-    PyOS_snprintf(ctversion, 4, "%d.%d", PY_MAJOR_VERSION, PY_MINOR_VERSION);
-    PyOS_snprintf(rtversion, 4, "%s", Py_GetVersion());
-    if (ctversion[0] != rtversion[0] || ctversion[2] != rtversion[2]) {
+    char ctversion[5];
+    int same=1, i, found_dot;
+    const char* rt_from_call = Py_GetVersion();
+    PyOS_snprintf(ctversion, 5, "%d.%d", PY_MAJOR_VERSION, PY_MINOR_VERSION);
+    found_dot = 0;
+    for (i = 0; i < 4; i++) {
+        if (!ctversion[i]) {
+            same = (rt_from_call[i] < '0' || rt_from_call[i] > '9');
+            break;
+        }
+        if (rt_from_call[i] != ctversion[i]) {
+            same = 0;
+            break;
+        }
+    }
+    if (!same) {
+        char rtversion[5] = {'\0'};
         char message[200];
+        for (i=0; i<4; ++i) {
+            if (rt_from_call[i] == '.') {
+                if (found_dot) break;
+                found_dot = 1;
+            } else if (rt_from_call[i] < '0' || rt_from_call[i] > '9') {
+                break;
+            }
+            rtversion[i] = rt_from_call[i];
+        }
         PyOS_snprintf(message, sizeof(message),
-                      "compiletime version %s of module '%.100s' "
+                      "compile time version %s of module '%.100s' "
                       "does not match runtime version %s",
                       ctversion, __Pyx_MODULE_NAME, rtversion);
         return PyErr_WarnEx(NULL, message, 1);
     }
     return 0;
 }
 
 /* InitStrings */
+#if PY_MAJOR_VERSION >= 3
+static int __Pyx_InitString(__Pyx_StringTabEntry t, PyObject **str) {
+    if (t.is_unicode | t.is_str) {
+        if (t.intern) {
+            *str = PyUnicode_InternFromString(t.s);
+        } else if (t.encoding) {
+            *str = PyUnicode_Decode(t.s, t.n - 1, t.encoding, NULL);
+        } else {
+            *str = PyUnicode_FromStringAndSize(t.s, t.n - 1);
+        }
+    } else {
+        *str = PyBytes_FromStringAndSize(t.s, t.n - 1);
+    }
+    if (!*str)
+        return -1;
+    if (PyObject_Hash(*str) == -1)
+        return -1;
+    return 0;
+}
+#endif
 static int __Pyx_InitStrings(__Pyx_StringTabEntry *t) {
     while (t->p) {
-        #if PY_MAJOR_VERSION < 3
+        #if PY_MAJOR_VERSION >= 3
+        __Pyx_InitString(*t, t->p);
+        #else
         if (t->is_unicode) {
             *t->p = PyUnicode_DecodeUTF8(t->s, t->n - 1, NULL);
         } else if (t->intern) {
             *t->p = PyString_InternFromString(t->s);
         } else {
             *t->p = PyString_FromStringAndSize(t->s, t->n - 1);
         }
-        #else
-        if (t->is_unicode | t->is_str) {
-            if (t->intern) {
-                *t->p = PyUnicode_InternFromString(t->s);
-            } else if (t->encoding) {
-                *t->p = PyUnicode_Decode(t->s, t->n - 1, t->encoding, NULL);
-            } else {
-                *t->p = PyUnicode_FromStringAndSize(t->s, t->n - 1);
-            }
-        } else {
-            *t->p = PyBytes_FromStringAndSize(t->s, t->n - 1);
-        }
-        #endif
         if (!*t->p)
             return -1;
         if (PyObject_Hash(*t->p) == -1)
             return -1;
+        #endif
         ++t;
     }
     return 0;
 }
 
 static CYTHON_INLINE PyObject* __Pyx_PyUnicode_FromString(const char* c_str) {
     return __Pyx_PyUnicode_FromStringAndSize(c_str, (Py_ssize_t)strlen(c_str));
@@ -7789,15 +8902,15 @@
 #if PY_MAJOR_VERSION < 3 && __PYX_DEFAULT_STRING_ENCODING_IS_ASCII
             __Pyx_sys_getdefaultencoding_not_ascii &&
 #endif
             PyUnicode_Check(o)) {
         return __Pyx_PyUnicode_AsStringAndSize(o, length);
     } else
 #endif
-#if (!CYTHON_COMPILING_IN_PYPY) || (defined(PyByteArray_AS_STRING) && defined(PyByteArray_GET_SIZE))
+#if (!CYTHON_COMPILING_IN_PYPY && !CYTHON_COMPILING_IN_LIMITED_API) || (defined(PyByteArray_AS_STRING) && defined(PyByteArray_GET_SIZE))
     if (PyByteArray_Check(o)) {
         *length = PyByteArray_GET_SIZE(o);
         return PyByteArray_AS_STRING(o);
     } else
 #endif
     {
         char* result;
@@ -7818,30 +8931,34 @@
     int retval;
     if (unlikely(!x)) return -1;
     retval = __Pyx_PyObject_IsTrue(x);
     Py_DECREF(x);
     return retval;
 }
 static PyObject* __Pyx_PyNumber_IntOrLongWrongResultType(PyObject* result, const char* type_name) {
+    __Pyx_TypeName result_type_name = __Pyx_PyType_GetName(Py_TYPE(result));
 #if PY_MAJOR_VERSION >= 3
     if (PyLong_Check(result)) {
         if (PyErr_WarnFormat(PyExc_DeprecationWarning, 1,
-                "__int__ returned non-int (type %.200s).  "
-                "The ability to return an instance of a strict subclass of int "
-                "is deprecated, and may be removed in a future version of Python.",
-                Py_TYPE(result)->tp_name)) {
+                "__int__ returned non-int (type " __Pyx_FMT_TYPENAME ").  "
+                "The ability to return an instance of a strict subclass of int is deprecated, "
+                "and may be removed in a future version of Python.",
+                result_type_name)) {
+            __Pyx_DECREF_TypeName(result_type_name);
             Py_DECREF(result);
             return NULL;
         }
+        __Pyx_DECREF_TypeName(result_type_name);
         return result;
     }
 #endif
     PyErr_Format(PyExc_TypeError,
-                 "__%.4s__ returned non-%.4s (type %.200s)",
-                 type_name, type_name, Py_TYPE(result)->tp_name);
+                 "__%.4s__ returned non-%.4s (type " __Pyx_FMT_TYPENAME ")",
+                 type_name, type_name, result_type_name);
+    __Pyx_DECREF_TypeName(result_type_name);
     Py_DECREF(result);
     return NULL;
 }
 static CYTHON_INLINE PyObject* __Pyx_PyNumber_IntOrLong(PyObject* x) {
 #if CYTHON_USE_TYPE_SLOTS
   PyNumberMethods *m;
 #endif
@@ -7899,21 +9016,19 @@
         return PyInt_AS_LONG(b);
     else
         return PyInt_AsSsize_t(b);
   }
 #endif
   if (likely(PyLong_CheckExact(b))) {
     #if CYTHON_USE_PYLONG_INTERNALS
-    const digit* digits = ((PyLongObject*)b)->ob_digit;
-    const Py_ssize_t size = Py_SIZE(b);
-    if (likely(__Pyx_sst_abs(size) <= 1)) {
-        ival = likely(size) ? digits[0] : 0;
-        if (size == -1) ival = -ival;
-        return ival;
+    if (likely(__Pyx_PyLong_IsCompact(b))) {
+        return __Pyx_PyLong_CompactValue(b);
     } else {
+      const digit* digits = __Pyx_PyLong_Digits(b);
+      const Py_ssize_t size = __Pyx_PyLong_SignedDigitCount(b);
       switch (size) {
          case 2:
            if (8 * sizeof(Py_ssize_t) > 2 * PyLong_SHIFT) {
              return (Py_ssize_t) (((((size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0]));
            }
            break;
          case -2:
@@ -7948,16 +9063,41 @@
   }
   x = PyNumber_Index(b);
   if (!x) return -1;
   ival = PyInt_AsSsize_t(x);
   Py_DECREF(x);
   return ival;
 }
+static CYTHON_INLINE Py_hash_t __Pyx_PyIndex_AsHash_t(PyObject* o) {
+  if (sizeof(Py_hash_t) == sizeof(Py_ssize_t)) {
+    return (Py_hash_t) __Pyx_PyIndex_AsSsize_t(o);
+#if PY_MAJOR_VERSION < 3
+  } else if (likely(PyInt_CheckExact(o))) {
+    return PyInt_AS_LONG(o);
+#endif
+  } else {
+    Py_ssize_t ival;
+    PyObject *x;
+    x = PyNumber_Index(o);
+    if (!x) return -1;
+    ival = PyInt_AsLong(x);
+    Py_DECREF(x);
+    return ival;
+  }
+}
 static CYTHON_INLINE PyObject * __Pyx_PyBool_FromLong(long b) {
   return b ? __Pyx_NewRef(Py_True) : __Pyx_NewRef(Py_False);
 }
 static CYTHON_INLINE PyObject * __Pyx_PyInt_FromSize_t(size_t ival) {
     return PyInt_FromSize_t(ival);
 }
 
 
+/* #### Code section: utility_code_pragmas_end ### */
+#ifdef _MSC_VER
+#pragma warning( pop )
+#endif
+
+
+
+/* #### Code section: end ### */
 #endif /* Py_PYTHON_H */
```

### Comparing `pyskynet-0.1.5/src/cy_src/skynet_py_mq.pyx` & `pyskynet-0.2.0/src/cy_src/skynet_py_mq.pyx`

 * *Files 2% similar despite different names*

```diff
@@ -1,8 +1,9 @@
 # cython: language_level=3
+# cython: legacy_implicit_noexcept=True
 
 from cpython.pycapsule cimport PyCapsule_New, PyCapsule_GetPointer, PyCapsule_SetPointer, PyCapsule_GetName
 from cpython.pycapsule cimport PyCapsule_CheckExact
 from cpython.unicode cimport PyUnicode_CheckExact, PyUnicode_AsUTF8String
 from cpython.bytes cimport PyBytes_CheckExact, PyBytes_AS_STRING
 from libc.string cimport memcpy, strcmp
 from cpython.ref cimport Py_XDECREF, PyObject
@@ -69,14 +70,15 @@
     if dstname == NULL:
         session = skynet_py_send(dst, type_id, session, ptr, size)
     else:
         session = skynet_py_sendname(dstname, type_id, session, ptr, size)
     if session < 0:
         if session == -2:
             raise Exception("package is too large:%s"%session)
+            return False
         else:
             return None
     else:
         return session
 
 # extern
 def tostring(capsule, size_t size):
```

### Comparing `pyskynet-0.1.5/src/cy_src/skynet_py_foreign_seri.c` & `pyskynet-0.2.0/src/cy_src/skynet_py_mq.c`

 * *Files 16% similar despite different names*

```diff
@@ -1,8 +1,8 @@
-/* Generated by Cython 0.29.21 */
+/* Generated by Cython 3.0.0 */
 
 /* BEGIN: Cython Metadata
 {
     "distutils": {
         "define_macros": [
             [
                 "NOUSE_JEMALLOC",
@@ -18,58 +18,73 @@
             ],
             [
                 "LUA_USE_LINUX",
                 null
             ]
         ],
         "depends": [
-            "/root/pyenv/lib/python3.6/site-packages/numpy/core/include/numpy/arrayobject.h",
-            "/root/pyenv/lib/python3.6/site-packages/numpy/core/include/numpy/ufuncobject.h",
-            "src/c_src/skynet_py_foreign_seri_ext.c",
-            "src/cy_src/skynet_py.pxd"
+            "3rd/numsky/src/skynet_foreign/skynet_foreign.h",
+            "skynet/3rd/lua/lua.h",
+            "skynet/skynet-src/skynet.h",
+            "src/cy_src/skynet_py.pxd",
+            "src/skynet_modify/skynet_py.h"
         ],
         "include_dirs": [
             "./skynet/skynet-src",
             "./skynet/3rd/lua",
             "./src",
             "./src/c_src",
             "./skynet/lualib-src",
             "3rd/numsky/src",
-            "/root/pyenv/lib/python3.6/site-packages/numpy/core/include"
+            "/root/pyenv37/lib/python3.7/site-packages/numpy/core/include"
         ],
         "libraries": [
             "pthread",
             "m",
             "readline",
             "dl"
         ],
-        "name": "pyskynet.skynet_py_foreign_seri",
+        "name": "pyskynet.skynet_py_mq",
         "sources": [
-            "src/cy_src/skynet_py_foreign_seri.pyx"
+            "src/cy_src/skynet_py_mq.pyx"
         ]
     },
-    "module_name": "pyskynet.skynet_py_foreign_seri"
+    "module_name": "pyskynet.skynet_py_mq"
 }
 END: Cython Metadata */
 
+#ifndef PY_SSIZE_T_CLEAN
 #define PY_SSIZE_T_CLEAN
+#endif /* PY_SSIZE_T_CLEAN */
+#if defined(CYTHON_LIMITED_API) && 0
+  #ifndef Py_LIMITED_API
+    #if CYTHON_LIMITED_API+0 > 0x03030000
+      #define Py_LIMITED_API CYTHON_LIMITED_API
+    #else
+      #define Py_LIMITED_API 0x03030000
+    #endif
+  #endif
+#endif
+
 #include "Python.h"
 #ifndef Py_PYTHON_H
     #error Python headers needed to compile C extensions, please install development version of Python.
-#elif PY_VERSION_HEX < 0x02060000 || (0x03000000 <= PY_VERSION_HEX && PY_VERSION_HEX < 0x03030000)
-    #error Cython requires Python 2.6+ or Python 3.3+.
+#elif PY_VERSION_HEX < 0x02070000 || (0x03000000 <= PY_VERSION_HEX && PY_VERSION_HEX < 0x03030000)
+    #error Cython requires Python 2.7+ or Python 3.3+.
 #else
-#define CYTHON_ABI "0_29_21"
-#define CYTHON_HEX_VERSION 0x001D15F0
+#define CYTHON_ABI "3_0_0"
+#define __PYX_ABI_MODULE_NAME "_cython_" CYTHON_ABI
+#define __PYX_TYPE_MODULE_PREFIX __PYX_ABI_MODULE_NAME "."
+#define CYTHON_HEX_VERSION 0x030000F0
 #define CYTHON_FUTURE_DIVISION 1
 #include <stddef.h>
 #ifndef offsetof
   #define offsetof(type, member) ( (size_t) & ((type*)0) -> member )
 #endif
-#if !defined(WIN32) && !defined(MS_WINDOWS)
+#if !defined(_WIN32) && !defined(WIN32) && !defined(MS_WINDOWS)
   #ifndef __stdcall
     #define __stdcall
   #endif
   #ifndef __cdecl
     #define __cdecl
   #endif
   #ifndef __fastcall
@@ -80,30 +95,34 @@
   #define DL_IMPORT(t) t
 #endif
 #ifndef DL_EXPORT
   #define DL_EXPORT(t) t
 #endif
 #define __PYX_COMMA ,
 #ifndef HAVE_LONG_LONG
-  #if PY_VERSION_HEX >= 0x02070000
-    #define HAVE_LONG_LONG
-  #endif
+  #define HAVE_LONG_LONG
 #endif
 #ifndef PY_LONG_LONG
   #define PY_LONG_LONG LONG_LONG
 #endif
 #ifndef Py_HUGE_VAL
   #define Py_HUGE_VAL HUGE_VAL
 #endif
-#ifdef PYPY_VERSION
-  #define CYTHON_COMPILING_IN_PYPY 1
-  #define CYTHON_COMPILING_IN_PYSTON 0
+#if defined(GRAALVM_PYTHON)
+  /* For very preliminary testing purposes. Most variables are set the same as PyPy.
+     The existence of this section does not imply that anything works or is even tested */
+  #define CYTHON_COMPILING_IN_PYPY 0
   #define CYTHON_COMPILING_IN_CPYTHON 0
+  #define CYTHON_COMPILING_IN_LIMITED_API 0
+  #define CYTHON_COMPILING_IN_GRAAL 1
+  #define CYTHON_COMPILING_IN_NOGIL 0
   #undef CYTHON_USE_TYPE_SLOTS
   #define CYTHON_USE_TYPE_SLOTS 0
+  #undef CYTHON_USE_TYPE_SPECS
+  #define CYTHON_USE_TYPE_SPECS 0
   #undef CYTHON_USE_PYTYPE_LOOKUP
   #define CYTHON_USE_PYTYPE_LOOKUP 0
   #if PY_VERSION_HEX < 0x03050000
     #undef CYTHON_USE_ASYNC_SLOTS
     #define CYTHON_USE_ASYNC_SLOTS 0
   #elif !defined(CYTHON_USE_ASYNC_SLOTS)
     #define CYTHON_USE_ASYNC_SLOTS 1
@@ -120,35 +139,167 @@
   #define CYTHON_AVOID_BORROWED_REFS 1
   #undef CYTHON_ASSUME_SAFE_MACROS
   #define CYTHON_ASSUME_SAFE_MACROS 0
   #undef CYTHON_UNPACK_METHODS
   #define CYTHON_UNPACK_METHODS 0
   #undef CYTHON_FAST_THREAD_STATE
   #define CYTHON_FAST_THREAD_STATE 0
+  #undef CYTHON_FAST_GIL
+  #define CYTHON_FAST_GIL 0
+  #undef CYTHON_METH_FASTCALL
+  #define CYTHON_METH_FASTCALL 0
   #undef CYTHON_FAST_PYCALL
   #define CYTHON_FAST_PYCALL 0
+  #ifndef CYTHON_PEP487_INIT_SUBCLASS
+    #define CYTHON_PEP487_INIT_SUBCLASS (PY_MAJOR_VERSION >= 3)
+  #endif
   #undef CYTHON_PEP489_MULTI_PHASE_INIT
-  #define CYTHON_PEP489_MULTI_PHASE_INIT 0
+  #define CYTHON_PEP489_MULTI_PHASE_INIT 1
+  #undef CYTHON_USE_MODULE_STATE
+  #define CYTHON_USE_MODULE_STATE 0
   #undef CYTHON_USE_TP_FINALIZE
   #define CYTHON_USE_TP_FINALIZE 0
   #undef CYTHON_USE_DICT_VERSIONS
   #define CYTHON_USE_DICT_VERSIONS 0
   #undef CYTHON_USE_EXC_INFO_STACK
   #define CYTHON_USE_EXC_INFO_STACK 0
-#elif defined(PYSTON_VERSION)
+  #ifndef CYTHON_UPDATE_DESCRIPTOR_DOC
+    #define CYTHON_UPDATE_DESCRIPTOR_DOC 0
+  #endif
+#elif defined(PYPY_VERSION)
+  #define CYTHON_COMPILING_IN_PYPY 1
+  #define CYTHON_COMPILING_IN_CPYTHON 0
+  #define CYTHON_COMPILING_IN_LIMITED_API 0
+  #define CYTHON_COMPILING_IN_GRAAL 0
+  #define CYTHON_COMPILING_IN_NOGIL 0
+  #undef CYTHON_USE_TYPE_SLOTS
+  #define CYTHON_USE_TYPE_SLOTS 0
+  #undef CYTHON_USE_TYPE_SPECS
+  #define CYTHON_USE_TYPE_SPECS 0
+  #undef CYTHON_USE_PYTYPE_LOOKUP
+  #define CYTHON_USE_PYTYPE_LOOKUP 0
+  #if PY_VERSION_HEX < 0x03050000
+    #undef CYTHON_USE_ASYNC_SLOTS
+    #define CYTHON_USE_ASYNC_SLOTS 0
+  #elif !defined(CYTHON_USE_ASYNC_SLOTS)
+    #define CYTHON_USE_ASYNC_SLOTS 1
+  #endif
+  #undef CYTHON_USE_PYLIST_INTERNALS
+  #define CYTHON_USE_PYLIST_INTERNALS 0
+  #undef CYTHON_USE_UNICODE_INTERNALS
+  #define CYTHON_USE_UNICODE_INTERNALS 0
+  #undef CYTHON_USE_UNICODE_WRITER
+  #define CYTHON_USE_UNICODE_WRITER 0
+  #undef CYTHON_USE_PYLONG_INTERNALS
+  #define CYTHON_USE_PYLONG_INTERNALS 0
+  #undef CYTHON_AVOID_BORROWED_REFS
+  #define CYTHON_AVOID_BORROWED_REFS 1
+  #undef CYTHON_ASSUME_SAFE_MACROS
+  #define CYTHON_ASSUME_SAFE_MACROS 0
+  #undef CYTHON_UNPACK_METHODS
+  #define CYTHON_UNPACK_METHODS 0
+  #undef CYTHON_FAST_THREAD_STATE
+  #define CYTHON_FAST_THREAD_STATE 0
+  #undef CYTHON_FAST_GIL
+  #define CYTHON_FAST_GIL 0
+  #undef CYTHON_METH_FASTCALL
+  #define CYTHON_METH_FASTCALL 0
+  #undef CYTHON_FAST_PYCALL
+  #define CYTHON_FAST_PYCALL 0
+  #ifndef CYTHON_PEP487_INIT_SUBCLASS
+    #define CYTHON_PEP487_INIT_SUBCLASS (PY_MAJOR_VERSION >= 3)
+  #endif
+  #if PY_VERSION_HEX < 0x03090000
+    #undef CYTHON_PEP489_MULTI_PHASE_INIT
+    #define CYTHON_PEP489_MULTI_PHASE_INIT 0
+  #elif !defined(CYTHON_PEP489_MULTI_PHASE_INIT)
+    #define CYTHON_PEP489_MULTI_PHASE_INIT 1
+  #endif
+  #undef CYTHON_USE_MODULE_STATE
+  #define CYTHON_USE_MODULE_STATE 0
+  #undef CYTHON_USE_TP_FINALIZE
+  #define CYTHON_USE_TP_FINALIZE (PY_VERSION_HEX >= 0x030400a1 && PYPY_VERSION_NUM >= 0x07030C00)
+  #undef CYTHON_USE_DICT_VERSIONS
+  #define CYTHON_USE_DICT_VERSIONS 0
+  #undef CYTHON_USE_EXC_INFO_STACK
+  #define CYTHON_USE_EXC_INFO_STACK 0
+  #ifndef CYTHON_UPDATE_DESCRIPTOR_DOC
+    #define CYTHON_UPDATE_DESCRIPTOR_DOC 0
+  #endif
+#elif defined(CYTHON_LIMITED_API)
   #define CYTHON_COMPILING_IN_PYPY 0
-  #define CYTHON_COMPILING_IN_PYSTON 1
   #define CYTHON_COMPILING_IN_CPYTHON 0
+  #define CYTHON_COMPILING_IN_LIMITED_API 1
+  #define CYTHON_COMPILING_IN_GRAAL 0
+  #define CYTHON_COMPILING_IN_NOGIL 0
+  #undef CYTHON_CLINE_IN_TRACEBACK
+  #define CYTHON_CLINE_IN_TRACEBACK 0
+  #undef CYTHON_USE_TYPE_SLOTS
+  #define CYTHON_USE_TYPE_SLOTS 0
+  #undef CYTHON_USE_TYPE_SPECS
+  #define CYTHON_USE_TYPE_SPECS 1
+  #undef CYTHON_USE_PYTYPE_LOOKUP
+  #define CYTHON_USE_PYTYPE_LOOKUP 0
+  #undef CYTHON_USE_ASYNC_SLOTS
+  #define CYTHON_USE_ASYNC_SLOTS 0
+  #undef CYTHON_USE_PYLIST_INTERNALS
+  #define CYTHON_USE_PYLIST_INTERNALS 0
+  #undef CYTHON_USE_UNICODE_INTERNALS
+  #define CYTHON_USE_UNICODE_INTERNALS 0
+  #ifndef CYTHON_USE_UNICODE_WRITER
+    #define CYTHON_USE_UNICODE_WRITER 0
+  #endif
+  #undef CYTHON_USE_PYLONG_INTERNALS
+  #define CYTHON_USE_PYLONG_INTERNALS 0
+  #ifndef CYTHON_AVOID_BORROWED_REFS
+    #define CYTHON_AVOID_BORROWED_REFS 0
+  #endif
+  #undef CYTHON_ASSUME_SAFE_MACROS
+  #define CYTHON_ASSUME_SAFE_MACROS 0
+  #undef CYTHON_UNPACK_METHODS
+  #define CYTHON_UNPACK_METHODS 0
+  #undef CYTHON_FAST_THREAD_STATE
+  #define CYTHON_FAST_THREAD_STATE 0
+  #undef CYTHON_FAST_GIL
+  #define CYTHON_FAST_GIL 0
+  #undef CYTHON_METH_FASTCALL
+  #define CYTHON_METH_FASTCALL 0
+  #undef CYTHON_FAST_PYCALL
+  #define CYTHON_FAST_PYCALL 0
+  #ifndef CYTHON_PEP487_INIT_SUBCLASS
+    #define CYTHON_PEP487_INIT_SUBCLASS 1
+  #endif
+  #undef CYTHON_PEP489_MULTI_PHASE_INIT
+  #define CYTHON_PEP489_MULTI_PHASE_INIT 0
+  #undef CYTHON_USE_MODULE_STATE
+  #define CYTHON_USE_MODULE_STATE 1
+  #ifndef CYTHON_USE_TP_FINALIZE
+    #define CYTHON_USE_TP_FINALIZE 1
+  #endif
+  #undef CYTHON_USE_DICT_VERSIONS
+  #define CYTHON_USE_DICT_VERSIONS 0
+  #undef CYTHON_USE_EXC_INFO_STACK
+  #define CYTHON_USE_EXC_INFO_STACK 0
+  #ifndef CYTHON_UPDATE_DESCRIPTOR_DOC
+    #define CYTHON_UPDATE_DESCRIPTOR_DOC 0
+  #endif
+#elif defined(PY_NOGIL)
+  #define CYTHON_COMPILING_IN_PYPY 0
+  #define CYTHON_COMPILING_IN_CPYTHON 0
+  #define CYTHON_COMPILING_IN_LIMITED_API 0
+  #define CYTHON_COMPILING_IN_GRAAL 0
+  #define CYTHON_COMPILING_IN_NOGIL 1
   #ifndef CYTHON_USE_TYPE_SLOTS
     #define CYTHON_USE_TYPE_SLOTS 1
   #endif
   #undef CYTHON_USE_PYTYPE_LOOKUP
   #define CYTHON_USE_PYTYPE_LOOKUP 0
-  #undef CYTHON_USE_ASYNC_SLOTS
-  #define CYTHON_USE_ASYNC_SLOTS 0
+  #ifndef CYTHON_USE_ASYNC_SLOTS
+    #define CYTHON_USE_ASYNC_SLOTS 1
+  #endif
   #undef CYTHON_USE_PYLIST_INTERNALS
   #define CYTHON_USE_PYLIST_INTERNALS 0
   #ifndef CYTHON_USE_UNICODE_INTERNALS
     #define CYTHON_USE_UNICODE_INTERNALS 1
   #endif
   #undef CYTHON_USE_UNICODE_WRITER
   #define CYTHON_USE_UNICODE_WRITER 0
@@ -163,54 +314,55 @@
   #ifndef CYTHON_UNPACK_METHODS
     #define CYTHON_UNPACK_METHODS 1
   #endif
   #undef CYTHON_FAST_THREAD_STATE
   #define CYTHON_FAST_THREAD_STATE 0
   #undef CYTHON_FAST_PYCALL
   #define CYTHON_FAST_PYCALL 0
-  #undef CYTHON_PEP489_MULTI_PHASE_INIT
-  #define CYTHON_PEP489_MULTI_PHASE_INIT 0
-  #undef CYTHON_USE_TP_FINALIZE
-  #define CYTHON_USE_TP_FINALIZE 0
+  #ifndef CYTHON_PEP489_MULTI_PHASE_INIT
+    #define CYTHON_PEP489_MULTI_PHASE_INIT 1
+  #endif
+  #ifndef CYTHON_USE_TP_FINALIZE
+    #define CYTHON_USE_TP_FINALIZE 1
+  #endif
   #undef CYTHON_USE_DICT_VERSIONS
   #define CYTHON_USE_DICT_VERSIONS 0
   #undef CYTHON_USE_EXC_INFO_STACK
   #define CYTHON_USE_EXC_INFO_STACK 0
 #else
   #define CYTHON_COMPILING_IN_PYPY 0
-  #define CYTHON_COMPILING_IN_PYSTON 0
   #define CYTHON_COMPILING_IN_CPYTHON 1
+  #define CYTHON_COMPILING_IN_LIMITED_API 0
+  #define CYTHON_COMPILING_IN_GRAAL 0
+  #define CYTHON_COMPILING_IN_NOGIL 0
   #ifndef CYTHON_USE_TYPE_SLOTS
     #define CYTHON_USE_TYPE_SLOTS 1
   #endif
-  #if PY_VERSION_HEX < 0x02070000
-    #undef CYTHON_USE_PYTYPE_LOOKUP
-    #define CYTHON_USE_PYTYPE_LOOKUP 0
-  #elif !defined(CYTHON_USE_PYTYPE_LOOKUP)
+  #ifndef CYTHON_USE_TYPE_SPECS
+    #define CYTHON_USE_TYPE_SPECS 0
+  #endif
+  #ifndef CYTHON_USE_PYTYPE_LOOKUP
     #define CYTHON_USE_PYTYPE_LOOKUP 1
   #endif
   #if PY_MAJOR_VERSION < 3
     #undef CYTHON_USE_ASYNC_SLOTS
     #define CYTHON_USE_ASYNC_SLOTS 0
   #elif !defined(CYTHON_USE_ASYNC_SLOTS)
     #define CYTHON_USE_ASYNC_SLOTS 1
   #endif
-  #if PY_VERSION_HEX < 0x02070000
-    #undef CYTHON_USE_PYLONG_INTERNALS
-    #define CYTHON_USE_PYLONG_INTERNALS 0
-  #elif !defined(CYTHON_USE_PYLONG_INTERNALS)
+  #ifndef CYTHON_USE_PYLONG_INTERNALS
     #define CYTHON_USE_PYLONG_INTERNALS 1
   #endif
   #ifndef CYTHON_USE_PYLIST_INTERNALS
     #define CYTHON_USE_PYLIST_INTERNALS 1
   #endif
   #ifndef CYTHON_USE_UNICODE_INTERNALS
     #define CYTHON_USE_UNICODE_INTERNALS 1
   #endif
-  #if PY_VERSION_HEX < 0x030300F0
+  #if PY_VERSION_HEX < 0x030300F0 || PY_VERSION_HEX >= 0x030B00A2
     #undef CYTHON_USE_UNICODE_WRITER
     #define CYTHON_USE_UNICODE_WRITER 0
   #elif !defined(CYTHON_USE_UNICODE_WRITER)
     #define CYTHON_USE_UNICODE_WRITER 1
   #endif
   #ifndef CYTHON_AVOID_BORROWED_REFS
     #define CYTHON_AVOID_BORROWED_REFS 0
@@ -220,35 +372,68 @@
   #endif
   #ifndef CYTHON_UNPACK_METHODS
     #define CYTHON_UNPACK_METHODS 1
   #endif
   #ifndef CYTHON_FAST_THREAD_STATE
     #define CYTHON_FAST_THREAD_STATE 1
   #endif
+  #ifndef CYTHON_FAST_GIL
+    #define CYTHON_FAST_GIL (PY_MAJOR_VERSION < 3 || PY_VERSION_HEX >= 0x03060000 && PY_VERSION_HEX < 0x030C00A6)
+  #endif
+  #ifndef CYTHON_METH_FASTCALL
+    #define CYTHON_METH_FASTCALL (PY_VERSION_HEX >= 0x030700A1)
+  #endif
   #ifndef CYTHON_FAST_PYCALL
     #define CYTHON_FAST_PYCALL 1
   #endif
-  #ifndef CYTHON_PEP489_MULTI_PHASE_INIT
-    #define CYTHON_PEP489_MULTI_PHASE_INIT (PY_VERSION_HEX >= 0x03050000)
-  #endif
-  #ifndef CYTHON_USE_TP_FINALIZE
-    #define CYTHON_USE_TP_FINALIZE (PY_VERSION_HEX >= 0x030400a1)
+  #ifndef CYTHON_PEP487_INIT_SUBCLASS
+    #define CYTHON_PEP487_INIT_SUBCLASS 1
   #endif
-  #ifndef CYTHON_USE_DICT_VERSIONS
-    #define CYTHON_USE_DICT_VERSIONS (PY_VERSION_HEX >= 0x030600B1)
+  #if PY_VERSION_HEX < 0x03050000
+    #undef CYTHON_PEP489_MULTI_PHASE_INIT
+    #define CYTHON_PEP489_MULTI_PHASE_INIT 0
+  #elif !defined(CYTHON_PEP489_MULTI_PHASE_INIT)
+    #define CYTHON_PEP489_MULTI_PHASE_INIT 1
+  #endif
+  #ifndef CYTHON_USE_MODULE_STATE
+    #define CYTHON_USE_MODULE_STATE 0
+  #endif
+  #if PY_VERSION_HEX < 0x030400a1
+    #undef CYTHON_USE_TP_FINALIZE
+    #define CYTHON_USE_TP_FINALIZE 0
+  #elif !defined(CYTHON_USE_TP_FINALIZE)
+    #define CYTHON_USE_TP_FINALIZE 1
+  #endif
+  #if PY_VERSION_HEX < 0x030600B1
+    #undef CYTHON_USE_DICT_VERSIONS
+    #define CYTHON_USE_DICT_VERSIONS 0
+  #elif !defined(CYTHON_USE_DICT_VERSIONS)
+    #define CYTHON_USE_DICT_VERSIONS  (PY_VERSION_HEX < 0x030C00A5)
+  #endif
+  #if PY_VERSION_HEX < 0x030700A3
+    #undef CYTHON_USE_EXC_INFO_STACK
+    #define CYTHON_USE_EXC_INFO_STACK 0
+  #elif !defined(CYTHON_USE_EXC_INFO_STACK)
+    #define CYTHON_USE_EXC_INFO_STACK 1
   #endif
-  #ifndef CYTHON_USE_EXC_INFO_STACK
-    #define CYTHON_USE_EXC_INFO_STACK (PY_VERSION_HEX >= 0x030700A3)
+  #ifndef CYTHON_UPDATE_DESCRIPTOR_DOC
+    #define CYTHON_UPDATE_DESCRIPTOR_DOC 1
   #endif
 #endif
 #if !defined(CYTHON_FAST_PYCCALL)
 #define CYTHON_FAST_PYCCALL  (CYTHON_FAST_PYCALL && PY_VERSION_HEX >= 0x030600B1)
 #endif
+#if !defined(CYTHON_VECTORCALL)
+#define CYTHON_VECTORCALL  (CYTHON_FAST_PYCCALL && PY_VERSION_HEX >= 0x030800B1)
+#endif
+#define CYTHON_BACKPORT_VECTORCALL (CYTHON_METH_FASTCALL && PY_VERSION_HEX < 0x030800B1)
 #if CYTHON_USE_PYLONG_INTERNALS
-  #include "longintrepr.h"
+  #if PY_MAJOR_VERSION < 3
+    #include "longintrepr.h"
+  #endif
   #undef SHIFT
   #undef BASE
   #undef MASK
   #ifdef SIZEOF_VOID_P
     enum { __pyx_check_sizeof_voidp = 1 / (int)(SIZEOF_VOID_P == sizeof(void*)) };
   #endif
 #endif
@@ -266,78 +451,128 @@
   #elif defined (__STDC_VERSION__) && __STDC_VERSION__ >= 199901L
     #define CYTHON_RESTRICT restrict
   #else
     #define CYTHON_RESTRICT
   #endif
 #endif
 #ifndef CYTHON_UNUSED
+  #if defined(__cplusplus)
+    /* for clang __has_cpp_attribute(maybe_unused) is true even before C++17
+     * but leads to warnings with -pedantic, since it is a C++17 feature */
+    #if ((defined(_MSVC_LANG) && _MSVC_LANG >= 201703L) || __cplusplus >= 201703L)
+      #if __has_cpp_attribute(maybe_unused)
+        #define CYTHON_UNUSED [[maybe_unused]]
+      #endif
+    #endif
+  #endif
+#endif
+#ifndef CYTHON_UNUSED
 # if defined(__GNUC__)
 #   if !(defined(__cplusplus)) || (__GNUC__ > 3 || (__GNUC__ == 3 && __GNUC_MINOR__ >= 4))
 #     define CYTHON_UNUSED __attribute__ ((__unused__))
 #   else
 #     define CYTHON_UNUSED
 #   endif
 # elif defined(__ICC) || (defined(__INTEL_COMPILER) && !defined(_MSC_VER))
 #   define CYTHON_UNUSED __attribute__ ((__unused__))
 # else
 #   define CYTHON_UNUSED
 # endif
 #endif
-#ifndef CYTHON_MAYBE_UNUSED_VAR
+#ifndef CYTHON_UNUSED_VAR
 #  if defined(__cplusplus)
-     template<class T> void CYTHON_MAYBE_UNUSED_VAR( const T& ) { }
+     template<class T> void CYTHON_UNUSED_VAR( const T& ) { }
 #  else
-#    define CYTHON_MAYBE_UNUSED_VAR(x) (void)(x)
+#    define CYTHON_UNUSED_VAR(x) (void)(x)
 #  endif
 #endif
+#ifndef CYTHON_MAYBE_UNUSED_VAR
+  #define CYTHON_MAYBE_UNUSED_VAR(x) CYTHON_UNUSED_VAR(x)
+#endif
 #ifndef CYTHON_NCP_UNUSED
 # if CYTHON_COMPILING_IN_CPYTHON
 #  define CYTHON_NCP_UNUSED
 # else
 #  define CYTHON_NCP_UNUSED CYTHON_UNUSED
 # endif
 #endif
 #define __Pyx_void_to_None(void_result) ((void)(void_result), Py_INCREF(Py_None), Py_None)
 #ifdef _MSC_VER
     #ifndef _MSC_STDINT_H_
         #if _MSC_VER < 1300
-           typedef unsigned char     uint8_t;
-           typedef unsigned int      uint32_t;
+            typedef unsigned char     uint8_t;
+            typedef unsigned short    uint16_t;
+            typedef unsigned int      uint32_t;
+        #else
+            typedef unsigned __int8   uint8_t;
+            typedef unsigned __int16  uint16_t;
+            typedef unsigned __int32  uint32_t;
+        #endif
+    #endif
+    #if _MSC_VER < 1300
+        #ifdef _WIN64
+            typedef unsigned long long  __pyx_uintptr_t;
         #else
-           typedef unsigned __int8   uint8_t;
-           typedef unsigned __int32  uint32_t;
+            typedef unsigned int        __pyx_uintptr_t;
+        #endif
+    #else
+        #ifdef _WIN64
+            typedef unsigned __int64    __pyx_uintptr_t;
+        #else
+            typedef unsigned __int32    __pyx_uintptr_t;
         #endif
     #endif
 #else
-   #include <stdint.h>
+    #include <stdint.h>
+    typedef uintptr_t  __pyx_uintptr_t;
 #endif
 #ifndef CYTHON_FALLTHROUGH
-  #if defined(__cplusplus) && __cplusplus >= 201103L
-    #if __has_cpp_attribute(fallthrough)
-      #define CYTHON_FALLTHROUGH [[fallthrough]]
-    #elif __has_cpp_attribute(clang::fallthrough)
-      #define CYTHON_FALLTHROUGH [[clang::fallthrough]]
-    #elif __has_cpp_attribute(gnu::fallthrough)
-      #define CYTHON_FALLTHROUGH [[gnu::fallthrough]]
+  #if defined(__cplusplus)
+    /* for clang __has_cpp_attribute(fallthrough) is true even before C++17
+     * but leads to warnings with -pedantic, since it is a C++17 feature */
+    #if ((defined(_MSVC_LANG) && _MSVC_LANG >= 201703L) || __cplusplus >= 201703L)
+      #if __has_cpp_attribute(fallthrough)
+        #define CYTHON_FALLTHROUGH [[fallthrough]]
+      #endif
+    #endif
+    #ifndef CYTHON_FALLTHROUGH
+      #if __has_cpp_attribute(clang::fallthrough)
+        #define CYTHON_FALLTHROUGH [[clang::fallthrough]]
+      #elif __has_cpp_attribute(gnu::fallthrough)
+        #define CYTHON_FALLTHROUGH [[gnu::fallthrough]]
+      #endif
     #endif
   #endif
   #ifndef CYTHON_FALLTHROUGH
     #if __has_attribute(fallthrough)
       #define CYTHON_FALLTHROUGH __attribute__((fallthrough))
     #else
       #define CYTHON_FALLTHROUGH
     #endif
   #endif
-  #if defined(__clang__ ) && defined(__apple_build_version__)
+  #if defined(__clang__) && defined(__apple_build_version__)
     #if __apple_build_version__ < 7000000
       #undef  CYTHON_FALLTHROUGH
       #define CYTHON_FALLTHROUGH
     #endif
   #endif
 #endif
+#ifdef __cplusplus
+  template <typename T>
+  struct __PYX_IS_UNSIGNED_IMPL {static const bool value = T(0) < T(-1);};
+  #define __PYX_IS_UNSIGNED(type) (__PYX_IS_UNSIGNED_IMPL<type>::value)
+#else
+  #define __PYX_IS_UNSIGNED(type) (((type)-1) > 0)
+#endif
+#if CYTHON_COMPILING_IN_PYPY == 1
+  #define __PYX_NEED_TP_PRINT_SLOT  (PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x030A0000)
+#else
+  #define __PYX_NEED_TP_PRINT_SLOT  (PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000)
+#endif
+#define __PYX_REINTERPRET_FUNCION(func_pointer, other_pointer) ((func_pointer)(void(*)(void))(other_pointer))
 
 #ifndef CYTHON_INLINE
   #if defined(__clang__)
     #define CYTHON_INLINE __inline__ __attribute__ ((__unused__))
   #elif defined(__GNUC__)
     #define CYTHON_INLINE __inline__
   #elif defined(_MSC_VER)
@@ -345,93 +580,225 @@
   #elif defined (__STDC_VERSION__) && __STDC_VERSION__ >= 199901L
     #define CYTHON_INLINE inline
   #else
     #define CYTHON_INLINE
   #endif
 #endif
 
-#if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX < 0x02070600 && !defined(Py_OptimizeFlag)
-  #define Py_OptimizeFlag 0
-#endif
 #define __PYX_BUILD_PY_SSIZE_T "n"
 #define CYTHON_FORMAT_SSIZE_T "z"
 #if PY_MAJOR_VERSION < 3
   #define __Pyx_BUILTIN_MODULE_NAME "__builtin__"
-  #define __Pyx_PyCode_New(a, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)\
-          PyCode_New(a+k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)
   #define __Pyx_DefaultClassType PyClass_Type
+  #define __Pyx_PyCode_New(a, p, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)\
+          PyCode_New(a+k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)
 #else
   #define __Pyx_BUILTIN_MODULE_NAME "builtins"
-#if PY_VERSION_HEX >= 0x030800A4 && PY_VERSION_HEX < 0x030800B2
-  #define __Pyx_PyCode_New(a, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)\
-          PyCode_New(a, 0, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)
+  #define __Pyx_DefaultClassType PyType_Type
+#if PY_VERSION_HEX >= 0x030B00A1
+    static CYTHON_INLINE PyCodeObject* __Pyx_PyCode_New(int a, int p, int k, int l, int s, int f,
+                                                    PyObject *code, PyObject *c, PyObject* n, PyObject *v,
+                                                    PyObject *fv, PyObject *cell, PyObject* fn,
+                                                    PyObject *name, int fline, PyObject *lnos) {
+        PyObject *kwds=NULL, *argcount=NULL, *posonlyargcount=NULL, *kwonlyargcount=NULL;
+        PyObject *nlocals=NULL, *stacksize=NULL, *flags=NULL, *replace=NULL, *empty=NULL;
+        const char *fn_cstr=NULL;
+        const char *name_cstr=NULL;
+        PyCodeObject *co=NULL, *result=NULL;
+        PyObject *type, *value, *traceback;
+        PyErr_Fetch(&type, &value, &traceback);
+        if (!(kwds=PyDict_New())) goto end;
+        if (!(argcount=PyLong_FromLong(a))) goto end;
+        if (PyDict_SetItemString(kwds, "co_argcount", argcount) != 0) goto end;
+        if (!(posonlyargcount=PyLong_FromLong(p))) goto end;
+        if (PyDict_SetItemString(kwds, "co_posonlyargcount", posonlyargcount) != 0) goto end;
+        if (!(kwonlyargcount=PyLong_FromLong(k))) goto end;
+        if (PyDict_SetItemString(kwds, "co_kwonlyargcount", kwonlyargcount) != 0) goto end;
+        if (!(nlocals=PyLong_FromLong(l))) goto end;
+        if (PyDict_SetItemString(kwds, "co_nlocals", nlocals) != 0) goto end;
+        if (!(stacksize=PyLong_FromLong(s))) goto end;
+        if (PyDict_SetItemString(kwds, "co_stacksize", stacksize) != 0) goto end;
+        if (!(flags=PyLong_FromLong(f))) goto end;
+        if (PyDict_SetItemString(kwds, "co_flags", flags) != 0) goto end;
+        if (PyDict_SetItemString(kwds, "co_code", code) != 0) goto end;
+        if (PyDict_SetItemString(kwds, "co_consts", c) != 0) goto end;
+        if (PyDict_SetItemString(kwds, "co_names", n) != 0) goto end;
+        if (PyDict_SetItemString(kwds, "co_varnames", v) != 0) goto end;
+        if (PyDict_SetItemString(kwds, "co_freevars", fv) != 0) goto end;
+        if (PyDict_SetItemString(kwds, "co_cellvars", cell) != 0) goto end;
+        if (PyDict_SetItemString(kwds, "co_linetable", lnos) != 0) goto end;
+        if (!(fn_cstr=PyUnicode_AsUTF8AndSize(fn, NULL))) goto end;
+        if (!(name_cstr=PyUnicode_AsUTF8AndSize(name, NULL))) goto end;
+        if (!(co = PyCode_NewEmpty(fn_cstr, name_cstr, fline))) goto end;
+        if (!(replace = PyObject_GetAttrString((PyObject*)co, "replace"))) goto end;
+        if (!(empty = PyTuple_New(0))) goto end;
+        result = (PyCodeObject*) PyObject_Call(replace, empty, kwds);
+    end:
+        Py_XDECREF((PyObject*) co);
+        Py_XDECREF(kwds);
+        Py_XDECREF(argcount);
+        Py_XDECREF(posonlyargcount);
+        Py_XDECREF(kwonlyargcount);
+        Py_XDECREF(nlocals);
+        Py_XDECREF(stacksize);
+        Py_XDECREF(replace);
+        Py_XDECREF(empty);
+        if (type) {
+            PyErr_Restore(type, value, traceback);
+        }
+        return result;
+    }
+#elif PY_VERSION_HEX >= 0x030800B2 && !CYTHON_COMPILING_IN_PYPY
+  #define __Pyx_PyCode_New(a, p, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)\
+          PyCode_NewWithPosOnlyArgs(a, p, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)
 #else
-  #define __Pyx_PyCode_New(a, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)\
+  #define __Pyx_PyCode_New(a, p, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)\
           PyCode_New(a, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)
 #endif
-  #define __Pyx_DefaultClassType PyType_Type
+#endif
+#if PY_VERSION_HEX >= 0x030900A4 || defined(Py_IS_TYPE)
+  #define __Pyx_IS_TYPE(ob, type) Py_IS_TYPE(ob, type)
+#else
+  #define __Pyx_IS_TYPE(ob, type) (((const PyObject*)ob)->ob_type == (type))
+#endif
+#if PY_VERSION_HEX >= 0x030A00B1 || defined(Py_Is)
+  #define __Pyx_Py_Is(x, y)  Py_Is(x, y)
+#else
+  #define __Pyx_Py_Is(x, y) ((x) == (y))
+#endif
+#if PY_VERSION_HEX >= 0x030A00B1 || defined(Py_IsNone)
+  #define __Pyx_Py_IsNone(ob) Py_IsNone(ob)
+#else
+  #define __Pyx_Py_IsNone(ob) __Pyx_Py_Is((ob), Py_None)
+#endif
+#if PY_VERSION_HEX >= 0x030A00B1 || defined(Py_IsTrue)
+  #define __Pyx_Py_IsTrue(ob) Py_IsTrue(ob)
+#else
+  #define __Pyx_Py_IsTrue(ob) __Pyx_Py_Is((ob), Py_True)
+#endif
+#if PY_VERSION_HEX >= 0x030A00B1 || defined(Py_IsFalse)
+  #define __Pyx_Py_IsFalse(ob) Py_IsFalse(ob)
+#else
+  #define __Pyx_Py_IsFalse(ob) __Pyx_Py_Is((ob), Py_False)
+#endif
+#define __Pyx_NoneAsNull(obj)  (__Pyx_Py_IsNone(obj) ? NULL : (obj))
+#if PY_VERSION_HEX >= 0x030900F0 && !CYTHON_COMPILING_IN_PYPY
+  #define __Pyx_PyObject_GC_IsFinalized(o) PyObject_GC_IsFinalized(o)
+#else
+  #define __Pyx_PyObject_GC_IsFinalized(o) _PyGC_FINALIZED(o)
+#endif
+#ifndef CO_COROUTINE
+  #define CO_COROUTINE 0x80
+#endif
+#ifndef CO_ASYNC_GENERATOR
+  #define CO_ASYNC_GENERATOR 0x200
 #endif
 #ifndef Py_TPFLAGS_CHECKTYPES
   #define Py_TPFLAGS_CHECKTYPES 0
 #endif
 #ifndef Py_TPFLAGS_HAVE_INDEX
   #define Py_TPFLAGS_HAVE_INDEX 0
 #endif
 #ifndef Py_TPFLAGS_HAVE_NEWBUFFER
   #define Py_TPFLAGS_HAVE_NEWBUFFER 0
 #endif
 #ifndef Py_TPFLAGS_HAVE_FINALIZE
   #define Py_TPFLAGS_HAVE_FINALIZE 0
 #endif
+#ifndef Py_TPFLAGS_SEQUENCE
+  #define Py_TPFLAGS_SEQUENCE 0
+#endif
+#ifndef Py_TPFLAGS_MAPPING
+  #define Py_TPFLAGS_MAPPING 0
+#endif
 #ifndef METH_STACKLESS
   #define METH_STACKLESS 0
 #endif
 #if PY_VERSION_HEX <= 0x030700A3 || !defined(METH_FASTCALL)
   #ifndef METH_FASTCALL
      #define METH_FASTCALL 0x80
   #endif
   typedef PyObject *(*__Pyx_PyCFunctionFast) (PyObject *self, PyObject *const *args, Py_ssize_t nargs);
   typedef PyObject *(*__Pyx_PyCFunctionFastWithKeywords) (PyObject *self, PyObject *const *args,
                                                           Py_ssize_t nargs, PyObject *kwnames);
 #else
   #define __Pyx_PyCFunctionFast _PyCFunctionFast
   #define __Pyx_PyCFunctionFastWithKeywords _PyCFunctionFastWithKeywords
 #endif
-#if CYTHON_FAST_PYCCALL
-#define __Pyx_PyFastCFunction_Check(func)\
-    ((PyCFunction_Check(func) && (METH_FASTCALL == (PyCFunction_GET_FLAGS(func) & ~(METH_CLASS | METH_STATIC | METH_COEXIST | METH_KEYWORDS | METH_STACKLESS)))))
+#if CYTHON_METH_FASTCALL
+  #define __Pyx_METH_FASTCALL METH_FASTCALL
+  #define __Pyx_PyCFunction_FastCall __Pyx_PyCFunctionFast
+  #define __Pyx_PyCFunction_FastCallWithKeywords __Pyx_PyCFunctionFastWithKeywords
+#else
+  #define __Pyx_METH_FASTCALL METH_VARARGS
+  #define __Pyx_PyCFunction_FastCall PyCFunction
+  #define __Pyx_PyCFunction_FastCallWithKeywords PyCFunctionWithKeywords
+#endif
+#if CYTHON_VECTORCALL
+  #define __pyx_vectorcallfunc vectorcallfunc
+  #define __Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET  PY_VECTORCALL_ARGUMENTS_OFFSET
+  #define __Pyx_PyVectorcall_NARGS(n)  PyVectorcall_NARGS((size_t)(n))
+#elif CYTHON_BACKPORT_VECTORCALL
+  typedef PyObject *(*__pyx_vectorcallfunc)(PyObject *callable, PyObject *const *args,
+                                            size_t nargsf, PyObject *kwnames);
+  #define __Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET  ((size_t)1 << (8 * sizeof(size_t) - 1))
+  #define __Pyx_PyVectorcall_NARGS(n)  ((Py_ssize_t)(((size_t)(n)) & ~__Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET))
+#else
+  #define __Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET  0
+  #define __Pyx_PyVectorcall_NARGS(n)  ((Py_ssize_t)(n))
+#endif
+#if PY_VERSION_HEX < 0x030900B1
+  #define __Pyx_PyType_FromModuleAndSpec(m, s, b)  ((void)m, PyType_FromSpecWithBases(s, b))
+  typedef PyObject *(*__Pyx_PyCMethod)(PyObject *, PyTypeObject *, PyObject *const *, size_t, PyObject *);
 #else
-#define __Pyx_PyFastCFunction_Check(func) 0
+  #define __Pyx_PyType_FromModuleAndSpec(m, s, b)  PyType_FromModuleAndSpec(m, s, b)
+  #define __Pyx_PyCMethod  PyCMethod
+#endif
+#ifndef METH_METHOD
+  #define METH_METHOD 0x200
 #endif
 #if CYTHON_COMPILING_IN_PYPY && !defined(PyObject_Malloc)
   #define PyObject_Malloc(s)   PyMem_Malloc(s)
   #define PyObject_Free(p)     PyMem_Free(p)
   #define PyObject_Realloc(p)  PyMem_Realloc(p)
 #endif
-#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX < 0x030400A1
-  #define PyMem_RawMalloc(n)           PyMem_Malloc(n)
-  #define PyMem_RawRealloc(p, n)       PyMem_Realloc(p, n)
-  #define PyMem_RawFree(p)             PyMem_Free(p)
-#endif
-#if CYTHON_COMPILING_IN_PYSTON
-  #define __Pyx_PyCode_HasFreeVars(co)  PyCode_HasFreeVars(co)
-  #define __Pyx_PyFrame_SetLineNumber(frame, lineno) PyFrame_SetLineNumber(frame, lineno)
+#if CYTHON_COMPILING_IN_LIMITED_API
+  #define __Pyx_PyCode_HasFreeVars(co)  (PyCode_GetNumFree(co) > 0)
+  #define __Pyx_PyFrame_SetLineNumber(frame, lineno)
 #else
   #define __Pyx_PyCode_HasFreeVars(co)  (PyCode_GetNumFree(co) > 0)
   #define __Pyx_PyFrame_SetLineNumber(frame, lineno)  (frame)->f_lineno = (lineno)
 #endif
-#if !CYTHON_FAST_THREAD_STATE || PY_VERSION_HEX < 0x02070000
+#if CYTHON_COMPILING_IN_LIMITED_API
+  #define __Pyx_PyThreadState_Current PyThreadState_Get()
+#elif !CYTHON_FAST_THREAD_STATE
   #define __Pyx_PyThreadState_Current PyThreadState_GET()
 #elif PY_VERSION_HEX >= 0x03060000
   #define __Pyx_PyThreadState_Current _PyThreadState_UncheckedGet()
 #elif PY_VERSION_HEX >= 0x03000000
   #define __Pyx_PyThreadState_Current PyThreadState_GET()
 #else
   #define __Pyx_PyThreadState_Current _PyThreadState_Current
 #endif
+#if CYTHON_COMPILING_IN_LIMITED_API
+static CYTHON_INLINE void *__Pyx_PyModule_GetState(PyObject *op)
+{
+    void *result;
+    result = PyModule_GetState(op);
+    if (!result)
+        Py_FatalError("Couldn't find the module state");
+    return result;
+}
+#endif
+#define __Pyx_PyObject_GetSlot(obj, name, func_ctype)  __Pyx_PyType_GetSlot(Py_TYPE(obj), name, func_ctype)
+#if CYTHON_COMPILING_IN_LIMITED_API
+  #define __Pyx_PyType_GetSlot(type, name, func_ctype)  ((func_ctype) PyType_GetSlot((type), Py_##name))
+#else
+  #define __Pyx_PyType_GetSlot(type, name, func_ctype)  ((type)->name)
+#endif
 #if PY_VERSION_HEX < 0x030700A2 && !defined(PyThread_tss_create) && !defined(Py_tss_NEEDS_INIT)
 #include "pythread.h"
 #define Py_tss_NEEDS_INIT 0
 typedef int Py_tss_t;
 static CYTHON_INLINE int PyThread_tss_create(Py_tss_t *key) {
   *key = PyThread_create_key();
   return 0;
@@ -454,78 +821,166 @@
 static CYTHON_INLINE int PyThread_tss_set(Py_tss_t *key, void *value) {
   return PyThread_set_key_value(*key, value);
 }
 static CYTHON_INLINE void * PyThread_tss_get(Py_tss_t *key) {
   return PyThread_get_key_value(*key);
 }
 #endif
+#if PY_MAJOR_VERSION < 3
+    #if CYTHON_COMPILING_IN_PYPY
+        #if PYPY_VERSION_NUM < 0x07030600
+            #if defined(__cplusplus) && __cplusplus >= 201402L
+                [[deprecated("`with nogil:` inside a nogil function will not release the GIL in PyPy2 < 7.3.6")]]
+            #elif defined(__GNUC__) || defined(__clang__)
+                __attribute__ ((__deprecated__("`with nogil:` inside a nogil function will not release the GIL in PyPy2 < 7.3.6")))
+            #elif defined(_MSC_VER)
+                __declspec(deprecated("`with nogil:` inside a nogil function will not release the GIL in PyPy2 < 7.3.6"))
+            #endif
+            static CYTHON_INLINE int PyGILState_Check(void) {
+                return 0;
+            }
+        #else  // PYPY_VERSION_NUM < 0x07030600
+        #endif  // PYPY_VERSION_NUM < 0x07030600
+    #else
+        static CYTHON_INLINE int PyGILState_Check(void) {
+            PyThreadState * tstate = _PyThreadState_Current;
+            return tstate && (tstate == PyGILState_GetThisThreadState());
+        }
+    #endif
+#endif
 #if CYTHON_COMPILING_IN_CPYTHON || defined(_PyDict_NewPresized)
 #define __Pyx_PyDict_NewPresized(n)  ((n <= 8) ? PyDict_New() : _PyDict_NewPresized(n))
 #else
 #define __Pyx_PyDict_NewPresized(n)  PyDict_New()
 #endif
 #if PY_MAJOR_VERSION >= 3 || CYTHON_FUTURE_DIVISION
   #define __Pyx_PyNumber_Divide(x,y)         PyNumber_TrueDivide(x,y)
   #define __Pyx_PyNumber_InPlaceDivide(x,y)  PyNumber_InPlaceTrueDivide(x,y)
 #else
   #define __Pyx_PyNumber_Divide(x,y)         PyNumber_Divide(x,y)
   #define __Pyx_PyNumber_InPlaceDivide(x,y)  PyNumber_InPlaceDivide(x,y)
 #endif
-#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x030500A1 && CYTHON_USE_UNICODE_INTERNALS
-#define __Pyx_PyDict_GetItemStr(dict, name)  _PyDict_GetItem_KnownHash(dict, name, ((PyASCIIObject *) name)->hash)
+#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX > 0x030600B4 && CYTHON_USE_UNICODE_INTERNALS
+#define __Pyx_PyDict_GetItemStrWithError(dict, name)  _PyDict_GetItem_KnownHash(dict, name, ((PyASCIIObject *) name)->hash)
+static CYTHON_INLINE PyObject * __Pyx_PyDict_GetItemStr(PyObject *dict, PyObject *name) {
+    PyObject *res = __Pyx_PyDict_GetItemStrWithError(dict, name);
+    if (res == NULL) PyErr_Clear();
+    return res;
+}
+#elif PY_MAJOR_VERSION >= 3 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07020000)
+#define __Pyx_PyDict_GetItemStrWithError  PyDict_GetItemWithError
+#define __Pyx_PyDict_GetItemStr           PyDict_GetItem
+#else
+static CYTHON_INLINE PyObject * __Pyx_PyDict_GetItemStrWithError(PyObject *dict, PyObject *name) {
+#if CYTHON_COMPILING_IN_PYPY
+    return PyDict_GetItem(dict, name);
 #else
-#define __Pyx_PyDict_GetItemStr(dict, name)  PyDict_GetItem(dict, name)
+    PyDictEntry *ep;
+    PyDictObject *mp = (PyDictObject*) dict;
+    long hash = ((PyStringObject *) name)->ob_shash;
+    assert(hash != -1);
+    ep = (mp->ma_lookup)(mp, name, hash);
+    if (ep == NULL) {
+        return NULL;
+    }
+    return ep->me_value;
 #endif
-#if PY_VERSION_HEX > 0x03030000 && defined(PyUnicode_KIND)
+}
+#define __Pyx_PyDict_GetItemStr           PyDict_GetItem
+#endif
+#if CYTHON_USE_TYPE_SLOTS
+  #define __Pyx_PyType_GetFlags(tp)   (((PyTypeObject *)tp)->tp_flags)
+  #define __Pyx_PyType_HasFeature(type, feature)  ((__Pyx_PyType_GetFlags(type) & (feature)) != 0)
+  #define __Pyx_PyObject_GetIterNextFunc(obj)  (Py_TYPE(obj)->tp_iternext)
+#else
+  #define __Pyx_PyType_GetFlags(tp)   (PyType_GetFlags((PyTypeObject *)tp))
+  #define __Pyx_PyType_HasFeature(type, feature)  PyType_HasFeature(type, feature)
+  #define __Pyx_PyObject_GetIterNextFunc(obj)  PyIter_Next
+#endif
+#if CYTHON_USE_TYPE_SPECS && PY_VERSION_HEX >= 0x03080000
+#define __Pyx_PyHeapTypeObject_GC_Del(obj)  {\
+    PyTypeObject *type = Py_TYPE(obj);\
+    assert(__Pyx_PyType_HasFeature(type, Py_TPFLAGS_HEAPTYPE));\
+    PyObject_GC_Del(obj);\
+    Py_DECREF(type);\
+}
+#else
+#define __Pyx_PyHeapTypeObject_GC_Del(obj)  PyObject_GC_Del(obj)
+#endif
+#if CYTHON_COMPILING_IN_LIMITED_API
   #define CYTHON_PEP393_ENABLED 1
-  #define __Pyx_PyUnicode_READY(op)       (likely(PyUnicode_IS_READY(op)) ?\
-                                              0 : _PyUnicode_Ready((PyObject *)(op)))
+  #define __Pyx_PyUnicode_READY(op)       (0)
+  #define __Pyx_PyUnicode_GET_LENGTH(u)   PyUnicode_GetLength(u)
+  #define __Pyx_PyUnicode_READ_CHAR(u, i) PyUnicode_ReadChar(u, i)
+  #define __Pyx_PyUnicode_MAX_CHAR_VALUE(u)   ((void)u, 1114111U)
+  #define __Pyx_PyUnicode_KIND(u)         ((void)u, (0))
+  #define __Pyx_PyUnicode_DATA(u)         ((void*)u)
+  #define __Pyx_PyUnicode_READ(k, d, i)   ((void)k, PyUnicode_ReadChar((PyObject*)(d), i))
+  #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != PyUnicode_GetLength(u))
+#elif PY_VERSION_HEX > 0x03030000 && defined(PyUnicode_KIND)
+  #define CYTHON_PEP393_ENABLED 1
+  #if PY_VERSION_HEX >= 0x030C0000
+    #define __Pyx_PyUnicode_READY(op)       (0)
+  #else
+    #define __Pyx_PyUnicode_READY(op)       (likely(PyUnicode_IS_READY(op)) ?\
+                                                0 : _PyUnicode_Ready((PyObject *)(op)))
+  #endif
   #define __Pyx_PyUnicode_GET_LENGTH(u)   PyUnicode_GET_LENGTH(u)
   #define __Pyx_PyUnicode_READ_CHAR(u, i) PyUnicode_READ_CHAR(u, i)
   #define __Pyx_PyUnicode_MAX_CHAR_VALUE(u)   PyUnicode_MAX_CHAR_VALUE(u)
-  #define __Pyx_PyUnicode_KIND(u)         PyUnicode_KIND(u)
+  #define __Pyx_PyUnicode_KIND(u)         ((int)PyUnicode_KIND(u))
   #define __Pyx_PyUnicode_DATA(u)         PyUnicode_DATA(u)
   #define __Pyx_PyUnicode_READ(k, d, i)   PyUnicode_READ(k, d, i)
-  #define __Pyx_PyUnicode_WRITE(k, d, i, ch)  PyUnicode_WRITE(k, d, i, ch)
-  #if defined(PyUnicode_IS_READY) && defined(PyUnicode_GET_SIZE)
-  #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != (likely(PyUnicode_IS_READY(u)) ? PyUnicode_GET_LENGTH(u) : PyUnicode_GET_SIZE(u)))
+  #define __Pyx_PyUnicode_WRITE(k, d, i, ch)  PyUnicode_WRITE(k, d, i, (Py_UCS4) ch)
+  #if PY_VERSION_HEX >= 0x030C0000
+    #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != PyUnicode_GET_LENGTH(u))
   #else
-  #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != PyUnicode_GET_LENGTH(u))
+    #if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x03090000
+    #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != (likely(PyUnicode_IS_READY(u)) ? PyUnicode_GET_LENGTH(u) : ((PyCompactUnicodeObject *)(u))->wstr_length))
+    #else
+    #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != (likely(PyUnicode_IS_READY(u)) ? PyUnicode_GET_LENGTH(u) : PyUnicode_GET_SIZE(u)))
+    #endif
   #endif
 #else
   #define CYTHON_PEP393_ENABLED 0
   #define PyUnicode_1BYTE_KIND  1
   #define PyUnicode_2BYTE_KIND  2
   #define PyUnicode_4BYTE_KIND  4
   #define __Pyx_PyUnicode_READY(op)       (0)
   #define __Pyx_PyUnicode_GET_LENGTH(u)   PyUnicode_GET_SIZE(u)
   #define __Pyx_PyUnicode_READ_CHAR(u, i) ((Py_UCS4)(PyUnicode_AS_UNICODE(u)[i]))
-  #define __Pyx_PyUnicode_MAX_CHAR_VALUE(u)   ((sizeof(Py_UNICODE) == 2) ? 65535 : 1114111)
-  #define __Pyx_PyUnicode_KIND(u)         (sizeof(Py_UNICODE))
+  #define __Pyx_PyUnicode_MAX_CHAR_VALUE(u)   ((sizeof(Py_UNICODE) == 2) ? 65535U : 1114111U)
+  #define __Pyx_PyUnicode_KIND(u)         ((int)sizeof(Py_UNICODE))
   #define __Pyx_PyUnicode_DATA(u)         ((void*)PyUnicode_AS_UNICODE(u))
   #define __Pyx_PyUnicode_READ(k, d, i)   ((void)(k), (Py_UCS4)(((Py_UNICODE*)d)[i]))
-  #define __Pyx_PyUnicode_WRITE(k, d, i, ch)  (((void)(k)), ((Py_UNICODE*)d)[i] = ch)
+  #define __Pyx_PyUnicode_WRITE(k, d, i, ch)  (((void)(k)), ((Py_UNICODE*)d)[i] = (Py_UNICODE) ch)
   #define __Pyx_PyUnicode_IS_TRUE(u)      (0 != PyUnicode_GET_SIZE(u))
 #endif
 #if CYTHON_COMPILING_IN_PYPY
   #define __Pyx_PyUnicode_Concat(a, b)      PyNumber_Add(a, b)
   #define __Pyx_PyUnicode_ConcatSafe(a, b)  PyNumber_Add(a, b)
 #else
   #define __Pyx_PyUnicode_Concat(a, b)      PyUnicode_Concat(a, b)
   #define __Pyx_PyUnicode_ConcatSafe(a, b)  ((unlikely((a) == Py_None) || unlikely((b) == Py_None)) ?\
       PyNumber_Add(a, b) : __Pyx_PyUnicode_Concat(a, b))
 #endif
-#if CYTHON_COMPILING_IN_PYPY && !defined(PyUnicode_Contains)
-  #define PyUnicode_Contains(u, s)  PySequence_Contains(u, s)
-#endif
-#if CYTHON_COMPILING_IN_PYPY && !defined(PyByteArray_Check)
-  #define PyByteArray_Check(obj)  PyObject_TypeCheck(obj, &PyByteArray_Type)
-#endif
-#if CYTHON_COMPILING_IN_PYPY && !defined(PyObject_Format)
-  #define PyObject_Format(obj, fmt)  PyObject_CallMethod(obj, "__format__", "O", fmt)
+#if CYTHON_COMPILING_IN_PYPY
+  #if !defined(PyUnicode_DecodeUnicodeEscape)
+    #define PyUnicode_DecodeUnicodeEscape(s, size, errors)  PyUnicode_Decode(s, size, "unicode_escape", errors)
+  #endif
+  #if !defined(PyUnicode_Contains) || (PY_MAJOR_VERSION == 2 && PYPY_VERSION_NUM < 0x07030500)
+    #undef PyUnicode_Contains
+    #define PyUnicode_Contains(u, s)  PySequence_Contains(u, s)
+  #endif
+  #if !defined(PyByteArray_Check)
+    #define PyByteArray_Check(obj)  PyObject_TypeCheck(obj, &PyByteArray_Type)
+  #endif
+  #if !defined(PyObject_Format)
+    #define PyObject_Format(obj, fmt)  PyObject_CallMethod(obj, "__format__", "O", fmt)
+  #endif
 #endif
 #define __Pyx_PyString_FormatSafe(a, b)   ((unlikely((a) == Py_None || (PyString_Check(b) && !PyString_CheckExact(b)))) ? PyNumber_Remainder(a, b) : __Pyx_PyString_Format(a, b))
 #define __Pyx_PyUnicode_FormatSafe(a, b)  ((unlikely((a) == Py_None || (PyUnicode_Check(b) && !PyUnicode_CheckExact(b)))) ? PyNumber_Remainder(a, b) : PyUnicode_Format(a, b))
 #if PY_MAJOR_VERSION >= 3
   #define __Pyx_PyString_Format(a, b)  PyUnicode_Format(a, b)
 #else
   #define __Pyx_PyString_Format(a, b)  PyString_Format(a, b)
@@ -546,16 +1001,22 @@
 #if PY_MAJOR_VERSION >= 3
   #define __Pyx_PyBaseString_Check(obj) PyUnicode_Check(obj)
   #define __Pyx_PyBaseString_CheckExact(obj) PyUnicode_CheckExact(obj)
 #else
   #define __Pyx_PyBaseString_Check(obj) (PyString_Check(obj) || PyUnicode_Check(obj))
   #define __Pyx_PyBaseString_CheckExact(obj) (PyString_CheckExact(obj) || PyUnicode_CheckExact(obj))
 #endif
+#if CYTHON_COMPILING_IN_CPYTHON
+  #define __Pyx_PySequence_ListKeepNew(obj)\
+    (likely(PyList_CheckExact(obj) && Py_REFCNT(obj) == 1) ? __Pyx_NewRef(obj) : PySequence_List(obj))
+#else
+  #define __Pyx_PySequence_ListKeepNew(obj)  PySequence_List(obj)
+#endif
 #ifndef PySet_CheckExact
-  #define PySet_CheckExact(obj)        (Py_TYPE(obj) == &PySet_Type)
+  #define PySet_CheckExact(obj)        __Pyx_IS_TYPE(obj, &PySet_Type)
 #endif
 #if PY_VERSION_HEX >= 0x030900A4
   #define __Pyx_SET_REFCNT(obj, refcnt) Py_SET_REFCNT(obj, refcnt)
   #define __Pyx_SET_SIZE(obj, size) Py_SET_SIZE(obj, size)
 #else
   #define __Pyx_SET_REFCNT(obj, refcnt) Py_REFCNT(obj) = (refcnt)
   #define __Pyx_SET_SIZE(obj, size) Py_SIZE(obj) = (size)
@@ -566,46 +1027,46 @@
   #define __Pyx_PySequence_SIZE(seq)  PySequence_Size(seq)
 #endif
 #if PY_MAJOR_VERSION >= 3
   #define PyIntObject                  PyLongObject
   #define PyInt_Type                   PyLong_Type
   #define PyInt_Check(op)              PyLong_Check(op)
   #define PyInt_CheckExact(op)         PyLong_CheckExact(op)
+  #define __Pyx_Py3Int_Check(op)       PyLong_Check(op)
+  #define __Pyx_Py3Int_CheckExact(op)  PyLong_CheckExact(op)
   #define PyInt_FromString             PyLong_FromString
   #define PyInt_FromUnicode            PyLong_FromUnicode
   #define PyInt_FromLong               PyLong_FromLong
   #define PyInt_FromSize_t             PyLong_FromSize_t
   #define PyInt_FromSsize_t            PyLong_FromSsize_t
   #define PyInt_AsLong                 PyLong_AsLong
   #define PyInt_AS_LONG                PyLong_AS_LONG
   #define PyInt_AsSsize_t              PyLong_AsSsize_t
   #define PyInt_AsUnsignedLongMask     PyLong_AsUnsignedLongMask
   #define PyInt_AsUnsignedLongLongMask PyLong_AsUnsignedLongLongMask
   #define PyNumber_Int                 PyNumber_Long
+#else
+  #define __Pyx_Py3Int_Check(op)       (PyLong_Check(op) || PyInt_Check(op))
+  #define __Pyx_Py3Int_CheckExact(op)  (PyLong_CheckExact(op) || PyInt_CheckExact(op))
 #endif
 #if PY_MAJOR_VERSION >= 3
   #define PyBoolObject                 PyLongObject
 #endif
 #if PY_MAJOR_VERSION >= 3 && CYTHON_COMPILING_IN_PYPY
   #ifndef PyUnicode_InternFromString
     #define PyUnicode_InternFromString(s) PyUnicode_FromString(s)
   #endif
 #endif
 #if PY_VERSION_HEX < 0x030200A4
   typedef long Py_hash_t;
   #define __Pyx_PyInt_FromHash_t PyInt_FromLong
-  #define __Pyx_PyInt_AsHash_t   PyInt_AsLong
+  #define __Pyx_PyInt_AsHash_t   __Pyx_PyIndex_AsHash_t
 #else
   #define __Pyx_PyInt_FromHash_t PyInt_FromSsize_t
-  #define __Pyx_PyInt_AsHash_t   PyInt_AsSsize_t
-#endif
-#if PY_MAJOR_VERSION >= 3
-  #define __Pyx_PyMethod_New(func, self, klass) ((self) ? ((void)(klass), PyMethod_New(func, self)) : __Pyx_NewRef(func))
-#else
-  #define __Pyx_PyMethod_New(func, self, klass) PyMethod_New(func, self, klass)
+  #define __Pyx_PyInt_AsHash_t   __Pyx_PyIndex_AsSsize_t
 #endif
 #if CYTHON_USE_ASYNC_SLOTS
   #if PY_VERSION_HEX >= 0x030500B1
     #define __Pyx_PyAsyncMethodsStruct PyAsyncMethods
     #define __Pyx_PyType_AsAsync(obj) (Py_TYPE(obj)->tp_as_async)
   #else
     #define __Pyx_PyType_AsAsync(obj) ((__Pyx_PyAsyncMethodsStruct*) (Py_TYPE(obj)->tp_reserved))
@@ -617,16 +1078,18 @@
     typedef struct {
         unaryfunc am_await;
         unaryfunc am_aiter;
         unaryfunc am_anext;
     } __Pyx_PyAsyncMethodsStruct;
 #endif
 
-#if defined(WIN32) || defined(MS_WINDOWS)
-  #define _USE_MATH_DEFINES
+#if defined(_WIN32) || defined(WIN32) || defined(MS_WINDOWS)
+  #if !defined(_USE_MATH_DEFINES)
+    #define _USE_MATH_DEFINES
+  #endif
 #endif
 #include <math.h>
 #ifdef NAN
 #define __PYX_NAN() ((float) NAN)
 #else
 static CYTHON_INLINE float __PYX_NAN() {
   float value;
@@ -641,37 +1104,40 @@
 #endif
 
 #define __PYX_MARK_ERR_POS(f_index, lineno) \
     { __pyx_filename = __pyx_f[f_index]; (void)__pyx_filename; __pyx_lineno = lineno; (void)__pyx_lineno; __pyx_clineno = __LINE__; (void)__pyx_clineno; }
 #define __PYX_ERR(f_index, lineno, Ln_error) \
     { __PYX_MARK_ERR_POS(f_index, lineno) goto Ln_error; }
 
-#ifndef __PYX_EXTERN_C
+#ifdef CYTHON_EXTERN_C
+    #undef __PYX_EXTERN_C
+    #define __PYX_EXTERN_C CYTHON_EXTERN_C
+#elif defined(__PYX_EXTERN_C)
+    #ifdef _MSC_VER
+    #pragma message ("Please do not define the '__PYX_EXTERN_C' macro externally. Use 'CYTHON_EXTERN_C' instead.")
+    #else
+    #warning Please do not define the '__PYX_EXTERN_C' macro externally. Use 'CYTHON_EXTERN_C' instead.
+    #endif
+#else
   #ifdef __cplusplus
     #define __PYX_EXTERN_C extern "C"
   #else
     #define __PYX_EXTERN_C extern
   #endif
 #endif
 
-#define __PYX_HAVE__pyskynet__skynet_py_foreign_seri
-#define __PYX_HAVE_API__pyskynet__skynet_py_foreign_seri
+#define __PYX_HAVE__pyskynet__skynet_py_mq
+#define __PYX_HAVE_API__pyskynet__skynet_py_mq
 /* Early includes */
 #include <string.h>
 #include <stdio.h>
-#include "numpy/arrayobject.h"
-#include "numpy/ufuncobject.h"
-
-    /* NumPy API declarations from "numpy/__init__.pxd" */
-    
 #include "lua.h"
 #include "skynet.h"
 #include "skynet_foreign/skynet_foreign.h"
 #include "skynet_modify/skynet_py.h"
-#include "skynet_py_foreign_seri_ext.c"
 #ifdef _OPENMP
 #include <omp.h>
 #endif /* _OPENMP */
 
 #if defined(PYREX_WITHOUT_ASSERTIONS) && !defined(CYTHON_WITHOUT_ASSERTIONS)
 #define CYTHON_WITHOUT_ASSERTIONS
 #endif
@@ -732,54 +1198,111 @@
 #endif
 #define __Pyx_PyBytes_AsWritableString(s)     ((char*) PyBytes_AS_STRING(s))
 #define __Pyx_PyBytes_AsWritableSString(s)    ((signed char*) PyBytes_AS_STRING(s))
 #define __Pyx_PyBytes_AsWritableUString(s)    ((unsigned char*) PyBytes_AS_STRING(s))
 #define __Pyx_PyBytes_AsString(s)     ((const char*) PyBytes_AS_STRING(s))
 #define __Pyx_PyBytes_AsSString(s)    ((const signed char*) PyBytes_AS_STRING(s))
 #define __Pyx_PyBytes_AsUString(s)    ((const unsigned char*) PyBytes_AS_STRING(s))
-#define __Pyx_PyObject_AsWritableString(s)    ((char*) __Pyx_PyObject_AsString(s))
-#define __Pyx_PyObject_AsWritableSString(s)    ((signed char*) __Pyx_PyObject_AsString(s))
-#define __Pyx_PyObject_AsWritableUString(s)    ((unsigned char*) __Pyx_PyObject_AsString(s))
+#define __Pyx_PyObject_AsWritableString(s)    ((char*)(__pyx_uintptr_t) __Pyx_PyObject_AsString(s))
+#define __Pyx_PyObject_AsWritableSString(s)    ((signed char*)(__pyx_uintptr_t) __Pyx_PyObject_AsString(s))
+#define __Pyx_PyObject_AsWritableUString(s)    ((unsigned char*)(__pyx_uintptr_t) __Pyx_PyObject_AsString(s))
 #define __Pyx_PyObject_AsSString(s)    ((const signed char*) __Pyx_PyObject_AsString(s))
 #define __Pyx_PyObject_AsUString(s)    ((const unsigned char*) __Pyx_PyObject_AsString(s))
 #define __Pyx_PyObject_FromCString(s)  __Pyx_PyObject_FromString((const char*)s)
 #define __Pyx_PyBytes_FromCString(s)   __Pyx_PyBytes_FromString((const char*)s)
 #define __Pyx_PyByteArray_FromCString(s)   __Pyx_PyByteArray_FromString((const char*)s)
 #define __Pyx_PyStr_FromCString(s)     __Pyx_PyStr_FromString((const char*)s)
 #define __Pyx_PyUnicode_FromCString(s) __Pyx_PyUnicode_FromString((const char*)s)
-static CYTHON_INLINE size_t __Pyx_Py_UNICODE_strlen(const Py_UNICODE *u) {
+#if CYTHON_COMPILING_IN_LIMITED_API
+static CYTHON_INLINE size_t __Pyx_Py_UNICODE_strlen(const wchar_t *u)
+{
+    const wchar_t *u_end = u;
+    while (*u_end++) ;
+    return (size_t)(u_end - u - 1);
+}
+#else
+static CYTHON_INLINE size_t __Pyx_Py_UNICODE_strlen(const Py_UNICODE *u)
+{
     const Py_UNICODE *u_end = u;
     while (*u_end++) ;
     return (size_t)(u_end - u - 1);
 }
+#endif
+#define __Pyx_PyUnicode_FromOrdinal(o)       PyUnicode_FromOrdinal((int)o)
 #define __Pyx_PyUnicode_FromUnicode(u)       PyUnicode_FromUnicode(u, __Pyx_Py_UNICODE_strlen(u))
 #define __Pyx_PyUnicode_FromUnicodeAndLength PyUnicode_FromUnicode
 #define __Pyx_PyUnicode_AsUnicode            PyUnicode_AsUnicode
 #define __Pyx_NewRef(obj) (Py_INCREF(obj), obj)
 #define __Pyx_Owned_Py_None(b) __Pyx_NewRef(Py_None)
 static CYTHON_INLINE PyObject * __Pyx_PyBool_FromLong(long b);
 static CYTHON_INLINE int __Pyx_PyObject_IsTrue(PyObject*);
 static CYTHON_INLINE int __Pyx_PyObject_IsTrueAndDecref(PyObject*);
 static CYTHON_INLINE PyObject* __Pyx_PyNumber_IntOrLong(PyObject* x);
 #define __Pyx_PySequence_Tuple(obj)\
     (likely(PyTuple_CheckExact(obj)) ? __Pyx_NewRef(obj) : PySequence_Tuple(obj))
 static CYTHON_INLINE Py_ssize_t __Pyx_PyIndex_AsSsize_t(PyObject*);
 static CYTHON_INLINE PyObject * __Pyx_PyInt_FromSize_t(size_t);
+static CYTHON_INLINE Py_hash_t __Pyx_PyIndex_AsHash_t(PyObject*);
 #if CYTHON_ASSUME_SAFE_MACROS
 #define __pyx_PyFloat_AsDouble(x) (PyFloat_CheckExact(x) ? PyFloat_AS_DOUBLE(x) : PyFloat_AsDouble(x))
 #else
 #define __pyx_PyFloat_AsDouble(x) PyFloat_AsDouble(x)
 #endif
 #define __pyx_PyFloat_AsFloat(x) ((float) __pyx_PyFloat_AsDouble(x))
 #if PY_MAJOR_VERSION >= 3
 #define __Pyx_PyNumber_Int(x) (PyLong_CheckExact(x) ? __Pyx_NewRef(x) : PyNumber_Long(x))
 #else
 #define __Pyx_PyNumber_Int(x) (PyInt_CheckExact(x) ? __Pyx_NewRef(x) : PyNumber_Int(x))
 #endif
-#define __Pyx_PyNumber_Float(x) (PyFloat_CheckExact(x) ? __Pyx_NewRef(x) : PyNumber_Float(x))
+#if CYTHON_USE_PYLONG_INTERNALS
+  #if PY_VERSION_HEX >= 0x030C00A7
+  #ifndef _PyLong_SIGN_MASK
+    #define _PyLong_SIGN_MASK 3
+  #endif
+  #ifndef _PyLong_NON_SIZE_BITS
+    #define _PyLong_NON_SIZE_BITS 3
+  #endif
+  #define __Pyx_PyLong_Sign(x)  (((PyLongObject*)x)->long_value.lv_tag & _PyLong_SIGN_MASK)
+  #define __Pyx_PyLong_IsNeg(x)  ((__Pyx_PyLong_Sign(x) & 2) != 0)
+  #define __Pyx_PyLong_IsNonNeg(x)  (!__Pyx_PyLong_IsNeg(x))
+  #define __Pyx_PyLong_IsZero(x)  (__Pyx_PyLong_Sign(x) & 1)
+  #define __Pyx_PyLong_IsPos(x)  (__Pyx_PyLong_Sign(x) == 0)
+  #define __Pyx_PyLong_CompactValueUnsigned(x)  (__Pyx_PyLong_Digits(x)[0])
+  #define __Pyx_PyLong_DigitCount(x)  ((Py_ssize_t) (((PyLongObject*)x)->long_value.lv_tag >> _PyLong_NON_SIZE_BITS))
+  #define __Pyx_PyLong_SignedDigitCount(x)\
+        ((1 - (Py_ssize_t) __Pyx_PyLong_Sign(x)) * __Pyx_PyLong_DigitCount(x))
+  #if defined(PyUnstable_Long_IsCompact) && defined(PyUnstable_Long_CompactValue)
+    #define __Pyx_PyLong_IsCompact(x)     PyUnstable_Long_IsCompact((PyLongObject*) x)
+    #define __Pyx_PyLong_CompactValue(x)  PyUnstable_Long_CompactValue((PyLongObject*) x)
+  #else
+    #define __Pyx_PyLong_IsCompact(x)     (((PyLongObject*)x)->long_value.lv_tag < (2 << _PyLong_NON_SIZE_BITS))
+    #define __Pyx_PyLong_CompactValue(x)  ((1 - (Py_ssize_t) __Pyx_PyLong_Sign(x)) * (Py_ssize_t) __Pyx_PyLong_Digits(x)[0])
+  #endif
+  typedef Py_ssize_t  __Pyx_compact_pylong;
+  typedef size_t  __Pyx_compact_upylong;
+  #else  // Py < 3.12
+  #define __Pyx_PyLong_IsNeg(x)  (Py_SIZE(x) < 0)
+  #define __Pyx_PyLong_IsNonNeg(x)  (Py_SIZE(x) >= 0)
+  #define __Pyx_PyLong_IsZero(x)  (Py_SIZE(x) == 0)
+  #define __Pyx_PyLong_IsPos(x)  (Py_SIZE(x) > 0)
+  #define __Pyx_PyLong_CompactValueUnsigned(x)  ((Py_SIZE(x) == 0) ? 0 : __Pyx_PyLong_Digits(x)[0])
+  #define __Pyx_PyLong_DigitCount(x)  __Pyx_sst_abs(Py_SIZE(x))
+  #define __Pyx_PyLong_SignedDigitCount(x)  Py_SIZE(x)
+  #define __Pyx_PyLong_IsCompact(x)  (Py_SIZE(x) == 0 || Py_SIZE(x) == 1 || Py_SIZE(x) == -1)
+  #define __Pyx_PyLong_CompactValue(x)\
+        ((Py_SIZE(x) == 0) ? (sdigit) 0 : ((Py_SIZE(x) < 0) ? -(sdigit)__Pyx_PyLong_Digits(x)[0] : (sdigit)__Pyx_PyLong_Digits(x)[0]))
+  typedef sdigit  __Pyx_compact_pylong;
+  typedef digit  __Pyx_compact_upylong;
+  #endif
+  #if PY_VERSION_HEX >= 0x030C00A5
+  #define __Pyx_PyLong_Digits(x)  (((PyLongObject*)x)->long_value.ob_digit)
+  #else
+  #define __Pyx_PyLong_Digits(x)  (((PyLongObject*)x)->ob_digit)
+  #endif
+#endif
 #if PY_MAJOR_VERSION < 3 && __PYX_DEFAULT_STRING_ENCODING_IS_ASCII
 static int __Pyx_sys_getdefaultencoding_not_ascii;
 static int __Pyx_init_sys_getdefaultencoding_params(void) {
     PyObject* sys;
     PyObject* default_encoding = NULL;
     PyObject* ascii_chars_u = NULL;
     PyObject* ascii_chars_b = NULL;
@@ -793,15 +1316,15 @@
     if (!default_encoding_c) goto bad;
     if (strcmp(default_encoding_c, "ascii") == 0) {
         __Pyx_sys_getdefaultencoding_not_ascii = 0;
     } else {
         char ascii_chars[128];
         int c;
         for (c = 0; c < 128; c++) {
-            ascii_chars[c] = c;
+            ascii_chars[c] = (char) c;
         }
         __Pyx_sys_getdefaultencoding_not_ascii = 1;
         ascii_chars_u = PyUnicode_DecodeASCII(ascii_chars, 128, NULL);
         if (!ascii_chars_u) goto bad;
         ascii_chars_b = PyUnicode_AsEncodedString(ascii_chars_u, default_encoding_c, NULL);
         if (!ascii_chars_b || !PyBytes_Check(ascii_chars_b) || memcmp(ascii_chars, PyBytes_AS_STRING(ascii_chars_b), 128) != 0) {
             PyErr_Format(
@@ -858,408 +1381,152 @@
   #define unlikely(x) __builtin_expect(!!(x), 0)
 #else /* !__GNUC__ or GCC < 2.95 */
   #define likely(x)   (x)
   #define unlikely(x) (x)
 #endif /* __GNUC__ */
 static CYTHON_INLINE void __Pyx_pretend_to_initialize(void* ptr) { (void)ptr; }
 
+#if !CYTHON_USE_MODULE_STATE
 static PyObject *__pyx_m = NULL;
-static PyObject *__pyx_d;
-static PyObject *__pyx_b;
-static PyObject *__pyx_cython_runtime = NULL;
-static PyObject *__pyx_empty_tuple;
-static PyObject *__pyx_empty_bytes;
-static PyObject *__pyx_empty_unicode;
+#endif
 static int __pyx_lineno;
 static int __pyx_clineno = 0;
-static const char * __pyx_cfilenm= __FILE__;
+static const char * __pyx_cfilenm = __FILE__;
 static const char *__pyx_filename;
 
-/* Header.proto */
-#if !defined(CYTHON_CCOMPLEX)
-  #if defined(__cplusplus)
-    #define CYTHON_CCOMPLEX 1
-  #elif defined(_Complex_I)
-    #define CYTHON_CCOMPLEX 1
-  #else
-    #define CYTHON_CCOMPLEX 0
-  #endif
-#endif
-#if CYTHON_CCOMPLEX
-  #ifdef __cplusplus
-    #include <complex>
-  #else
-    #include <complex.h>
-  #endif
-#endif
-#if CYTHON_CCOMPLEX && !defined(__cplusplus) && defined(__sun__) && defined(__GNUC__)
-  #undef _Complex_I
-  #define _Complex_I 1.0fj
-#endif
-
+/* #### Code section: filename_table ### */
 
 static const char *__pyx_f[] = {
-  "src/cy_src/skynet_py_foreign_seri.pyx",
-  "__init__.pxd",
+  "src/cy_src/skynet_py_mq.pyx",
   "type.pxd",
 };
-
-/* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":689
- * # in Cython to enable them only on the right systems.
- * 
- * ctypedef npy_int8       int8_t             # <<<<<<<<<<<<<<
- * ctypedef npy_int16      int16_t
- * ctypedef npy_int32      int32_t
- */
-typedef npy_int8 __pyx_t_5numpy_int8_t;
-
-/* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":690
- * 
- * ctypedef npy_int8       int8_t
- * ctypedef npy_int16      int16_t             # <<<<<<<<<<<<<<
- * ctypedef npy_int32      int32_t
- * ctypedef npy_int64      int64_t
- */
-typedef npy_int16 __pyx_t_5numpy_int16_t;
-
-/* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":691
- * ctypedef npy_int8       int8_t
- * ctypedef npy_int16      int16_t
- * ctypedef npy_int32      int32_t             # <<<<<<<<<<<<<<
- * ctypedef npy_int64      int64_t
- * #ctypedef npy_int96      int96_t
- */
-typedef npy_int32 __pyx_t_5numpy_int32_t;
-
-/* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":692
- * ctypedef npy_int16      int16_t
- * ctypedef npy_int32      int32_t
- * ctypedef npy_int64      int64_t             # <<<<<<<<<<<<<<
- * #ctypedef npy_int96      int96_t
- * #ctypedef npy_int128     int128_t
- */
-typedef npy_int64 __pyx_t_5numpy_int64_t;
-
-/* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":696
- * #ctypedef npy_int128     int128_t
- * 
- * ctypedef npy_uint8      uint8_t             # <<<<<<<<<<<<<<
- * ctypedef npy_uint16     uint16_t
- * ctypedef npy_uint32     uint32_t
- */
-typedef npy_uint8 __pyx_t_5numpy_uint8_t;
-
-/* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":697
- * 
- * ctypedef npy_uint8      uint8_t
- * ctypedef npy_uint16     uint16_t             # <<<<<<<<<<<<<<
- * ctypedef npy_uint32     uint32_t
- * ctypedef npy_uint64     uint64_t
- */
-typedef npy_uint16 __pyx_t_5numpy_uint16_t;
-
-/* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":698
- * ctypedef npy_uint8      uint8_t
- * ctypedef npy_uint16     uint16_t
- * ctypedef npy_uint32     uint32_t             # <<<<<<<<<<<<<<
- * ctypedef npy_uint64     uint64_t
- * #ctypedef npy_uint96     uint96_t
- */
-typedef npy_uint32 __pyx_t_5numpy_uint32_t;
-
-/* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":699
- * ctypedef npy_uint16     uint16_t
- * ctypedef npy_uint32     uint32_t
- * ctypedef npy_uint64     uint64_t             # <<<<<<<<<<<<<<
- * #ctypedef npy_uint96     uint96_t
- * #ctypedef npy_uint128    uint128_t
- */
-typedef npy_uint64 __pyx_t_5numpy_uint64_t;
-
-/* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":703
- * #ctypedef npy_uint128    uint128_t
- * 
- * ctypedef npy_float32    float32_t             # <<<<<<<<<<<<<<
- * ctypedef npy_float64    float64_t
- * #ctypedef npy_float80    float80_t
- */
-typedef npy_float32 __pyx_t_5numpy_float32_t;
-
-/* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":704
- * 
- * ctypedef npy_float32    float32_t
- * ctypedef npy_float64    float64_t             # <<<<<<<<<<<<<<
- * #ctypedef npy_float80    float80_t
- * #ctypedef npy_float128   float128_t
- */
-typedef npy_float64 __pyx_t_5numpy_float64_t;
-
-/* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":713
- * # The int types are mapped a bit surprising --
- * # numpy.int corresponds to 'l' and numpy.long to 'q'
- * ctypedef npy_long       int_t             # <<<<<<<<<<<<<<
- * ctypedef npy_longlong   long_t
- * ctypedef npy_longlong   longlong_t
- */
-typedef npy_long __pyx_t_5numpy_int_t;
-
-/* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":714
- * # numpy.int corresponds to 'l' and numpy.long to 'q'
- * ctypedef npy_long       int_t
- * ctypedef npy_longlong   long_t             # <<<<<<<<<<<<<<
- * ctypedef npy_longlong   longlong_t
- * 
- */
-typedef npy_longlong __pyx_t_5numpy_long_t;
-
-/* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":715
- * ctypedef npy_long       int_t
- * ctypedef npy_longlong   long_t
- * ctypedef npy_longlong   longlong_t             # <<<<<<<<<<<<<<
- * 
- * ctypedef npy_ulong      uint_t
- */
-typedef npy_longlong __pyx_t_5numpy_longlong_t;
-
-/* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":717
- * ctypedef npy_longlong   longlong_t
- * 
- * ctypedef npy_ulong      uint_t             # <<<<<<<<<<<<<<
- * ctypedef npy_ulonglong  ulong_t
- * ctypedef npy_ulonglong  ulonglong_t
- */
-typedef npy_ulong __pyx_t_5numpy_uint_t;
-
-/* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":718
- * 
- * ctypedef npy_ulong      uint_t
- * ctypedef npy_ulonglong  ulong_t             # <<<<<<<<<<<<<<
- * ctypedef npy_ulonglong  ulonglong_t
- * 
- */
-typedef npy_ulonglong __pyx_t_5numpy_ulong_t;
-
-/* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":719
- * ctypedef npy_ulong      uint_t
- * ctypedef npy_ulonglong  ulong_t
- * ctypedef npy_ulonglong  ulonglong_t             # <<<<<<<<<<<<<<
- * 
- * ctypedef npy_intp       intp_t
- */
-typedef npy_ulonglong __pyx_t_5numpy_ulonglong_t;
-
-/* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":721
- * ctypedef npy_ulonglong  ulonglong_t
- * 
- * ctypedef npy_intp       intp_t             # <<<<<<<<<<<<<<
- * ctypedef npy_uintp      uintp_t
- * 
- */
-typedef npy_intp __pyx_t_5numpy_intp_t;
-
-/* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":722
- * 
- * ctypedef npy_intp       intp_t
- * ctypedef npy_uintp      uintp_t             # <<<<<<<<<<<<<<
- * 
- * ctypedef npy_double     float_t
- */
-typedef npy_uintp __pyx_t_5numpy_uintp_t;
-
-/* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":724
- * ctypedef npy_uintp      uintp_t
- * 
- * ctypedef npy_double     float_t             # <<<<<<<<<<<<<<
- * ctypedef npy_double     double_t
- * ctypedef npy_longdouble longdouble_t
- */
-typedef npy_double __pyx_t_5numpy_float_t;
-
-/* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":725
- * 
- * ctypedef npy_double     float_t
- * ctypedef npy_double     double_t             # <<<<<<<<<<<<<<
- * ctypedef npy_longdouble longdouble_t
- * 
- */
-typedef npy_double __pyx_t_5numpy_double_t;
-
-/* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":726
- * ctypedef npy_double     float_t
- * ctypedef npy_double     double_t
- * ctypedef npy_longdouble longdouble_t             # <<<<<<<<<<<<<<
- * 
- * ctypedef npy_cfloat      cfloat_t
- */
-typedef npy_longdouble __pyx_t_5numpy_longdouble_t;
-/* Declarations.proto */
-#if CYTHON_CCOMPLEX
-  #ifdef __cplusplus
-    typedef ::std::complex< float > __pyx_t_float_complex;
-  #else
-    typedef float _Complex __pyx_t_float_complex;
-  #endif
-#else
-    typedef struct { float real, imag; } __pyx_t_float_complex;
-#endif
-static CYTHON_INLINE __pyx_t_float_complex __pyx_t_float_complex_from_parts(float, float);
-
-/* Declarations.proto */
-#if CYTHON_CCOMPLEX
-  #ifdef __cplusplus
-    typedef ::std::complex< double > __pyx_t_double_complex;
-  #else
-    typedef double _Complex __pyx_t_double_complex;
-  #endif
-#else
-    typedef struct { double real, imag; } __pyx_t_double_complex;
-#endif
-static CYTHON_INLINE __pyx_t_double_complex __pyx_t_double_complex_from_parts(double, double);
-
+/* #### Code section: utility_code_proto_before_types ### */
+/* #### Code section: numeric_typedefs ### */
+/* #### Code section: complex_type_declarations ### */
+/* #### Code section: type_declarations ### */
 
 /*--- Type declarations ---*/
-
-/* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":728
- * ctypedef npy_longdouble longdouble_t
- * 
- * ctypedef npy_cfloat      cfloat_t             # <<<<<<<<<<<<<<
- * ctypedef npy_cdouble     cdouble_t
- * ctypedef npy_clongdouble clongdouble_t
- */
-typedef npy_cfloat __pyx_t_5numpy_cfloat_t;
-
-/* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":729
- * 
- * ctypedef npy_cfloat      cfloat_t
- * ctypedef npy_cdouble     cdouble_t             # <<<<<<<<<<<<<<
- * ctypedef npy_clongdouble clongdouble_t
- * 
- */
-typedef npy_cdouble __pyx_t_5numpy_cdouble_t;
-
-/* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":730
- * ctypedef npy_cfloat      cfloat_t
- * ctypedef npy_cdouble     cdouble_t
- * ctypedef npy_clongdouble clongdouble_t             # <<<<<<<<<<<<<<
- * 
- * ctypedef npy_cdouble     complex_t
- */
-typedef npy_clongdouble __pyx_t_5numpy_clongdouble_t;
-
-/* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":732
- * ctypedef npy_clongdouble clongdouble_t
- * 
- * ctypedef npy_cdouble     complex_t             # <<<<<<<<<<<<<<
- * 
- * cdef inline object PyArray_MultiIterNew1(a):
- */
-typedef npy_cdouble __pyx_t_5numpy_complex_t;
+/* #### Code section: utility_code_proto ### */
 
 /* --- Runtime support code (head) --- */
 /* Refnanny.proto */
 #ifndef CYTHON_REFNANNY
   #define CYTHON_REFNANNY 0
 #endif
 #if CYTHON_REFNANNY
   typedef struct {
-    void (*INCREF)(void*, PyObject*, int);
-    void (*DECREF)(void*, PyObject*, int);
-    void (*GOTREF)(void*, PyObject*, int);
-    void (*GIVEREF)(void*, PyObject*, int);
-    void* (*SetupContext)(const char*, int, const char*);
+    void (*INCREF)(void*, PyObject*, Py_ssize_t);
+    void (*DECREF)(void*, PyObject*, Py_ssize_t);
+    void (*GOTREF)(void*, PyObject*, Py_ssize_t);
+    void (*GIVEREF)(void*, PyObject*, Py_ssize_t);
+    void* (*SetupContext)(const char*, Py_ssize_t, const char*);
     void (*FinishContext)(void**);
   } __Pyx_RefNannyAPIStruct;
   static __Pyx_RefNannyAPIStruct *__Pyx_RefNanny = NULL;
   static __Pyx_RefNannyAPIStruct *__Pyx_RefNannyImportAPI(const char *modname);
   #define __Pyx_RefNannyDeclarations void *__pyx_refnanny = NULL;
 #ifdef WITH_THREAD
   #define __Pyx_RefNannySetupContext(name, acquire_gil)\
           if (acquire_gil) {\
               PyGILState_STATE __pyx_gilstate_save = PyGILState_Ensure();\
-              __pyx_refnanny = __Pyx_RefNanny->SetupContext((name), __LINE__, __FILE__);\
+              __pyx_refnanny = __Pyx_RefNanny->SetupContext((name), (__LINE__), (__FILE__));\
               PyGILState_Release(__pyx_gilstate_save);\
           } else {\
-              __pyx_refnanny = __Pyx_RefNanny->SetupContext((name), __LINE__, __FILE__);\
+              __pyx_refnanny = __Pyx_RefNanny->SetupContext((name), (__LINE__), (__FILE__));\
+          }
+  #define __Pyx_RefNannyFinishContextNogil() {\
+              PyGILState_STATE __pyx_gilstate_save = PyGILState_Ensure();\
+              __Pyx_RefNannyFinishContext();\
+              PyGILState_Release(__pyx_gilstate_save);\
           }
 #else
   #define __Pyx_RefNannySetupContext(name, acquire_gil)\
-          __pyx_refnanny = __Pyx_RefNanny->SetupContext((name), __LINE__, __FILE__)
+          __pyx_refnanny = __Pyx_RefNanny->SetupContext((name), (__LINE__), (__FILE__))
+  #define __Pyx_RefNannyFinishContextNogil() __Pyx_RefNannyFinishContext()
 #endif
+  #define __Pyx_RefNannyFinishContextNogil() {\
+              PyGILState_STATE __pyx_gilstate_save = PyGILState_Ensure();\
+              __Pyx_RefNannyFinishContext();\
+              PyGILState_Release(__pyx_gilstate_save);\
+          }
   #define __Pyx_RefNannyFinishContext()\
           __Pyx_RefNanny->FinishContext(&__pyx_refnanny)
-  #define __Pyx_INCREF(r)  __Pyx_RefNanny->INCREF(__pyx_refnanny, (PyObject *)(r), __LINE__)
-  #define __Pyx_DECREF(r)  __Pyx_RefNanny->DECREF(__pyx_refnanny, (PyObject *)(r), __LINE__)
-  #define __Pyx_GOTREF(r)  __Pyx_RefNanny->GOTREF(__pyx_refnanny, (PyObject *)(r), __LINE__)
-  #define __Pyx_GIVEREF(r) __Pyx_RefNanny->GIVEREF(__pyx_refnanny, (PyObject *)(r), __LINE__)
-  #define __Pyx_XINCREF(r)  do { if((r) != NULL) {__Pyx_INCREF(r); }} while(0)
-  #define __Pyx_XDECREF(r)  do { if((r) != NULL) {__Pyx_DECREF(r); }} while(0)
-  #define __Pyx_XGOTREF(r)  do { if((r) != NULL) {__Pyx_GOTREF(r); }} while(0)
-  #define __Pyx_XGIVEREF(r) do { if((r) != NULL) {__Pyx_GIVEREF(r);}} while(0)
+  #define __Pyx_INCREF(r)  __Pyx_RefNanny->INCREF(__pyx_refnanny, (PyObject *)(r), (__LINE__))
+  #define __Pyx_DECREF(r)  __Pyx_RefNanny->DECREF(__pyx_refnanny, (PyObject *)(r), (__LINE__))
+  #define __Pyx_GOTREF(r)  __Pyx_RefNanny->GOTREF(__pyx_refnanny, (PyObject *)(r), (__LINE__))
+  #define __Pyx_GIVEREF(r) __Pyx_RefNanny->GIVEREF(__pyx_refnanny, (PyObject *)(r), (__LINE__))
+  #define __Pyx_XINCREF(r)  do { if((r) == NULL); else {__Pyx_INCREF(r); }} while(0)
+  #define __Pyx_XDECREF(r)  do { if((r) == NULL); else {__Pyx_DECREF(r); }} while(0)
+  #define __Pyx_XGOTREF(r)  do { if((r) == NULL); else {__Pyx_GOTREF(r); }} while(0)
+  #define __Pyx_XGIVEREF(r) do { if((r) == NULL); else {__Pyx_GIVEREF(r);}} while(0)
 #else
   #define __Pyx_RefNannyDeclarations
   #define __Pyx_RefNannySetupContext(name, acquire_gil)
+  #define __Pyx_RefNannyFinishContextNogil()
   #define __Pyx_RefNannyFinishContext()
   #define __Pyx_INCREF(r) Py_INCREF(r)
   #define __Pyx_DECREF(r) Py_DECREF(r)
   #define __Pyx_GOTREF(r)
   #define __Pyx_GIVEREF(r)
   #define __Pyx_XINCREF(r) Py_XINCREF(r)
   #define __Pyx_XDECREF(r) Py_XDECREF(r)
   #define __Pyx_XGOTREF(r)
   #define __Pyx_XGIVEREF(r)
 #endif
+#define __Pyx_Py_XDECREF_SET(r, v) do {\
+        PyObject *tmp = (PyObject *) r;\
+        r = v; Py_XDECREF(tmp);\
+    } while (0)
 #define __Pyx_XDECREF_SET(r, v) do {\
         PyObject *tmp = (PyObject *) r;\
         r = v; __Pyx_XDECREF(tmp);\
     } while (0)
 #define __Pyx_DECREF_SET(r, v) do {\
         PyObject *tmp = (PyObject *) r;\
         r = v; __Pyx_DECREF(tmp);\
     } while (0)
 #define __Pyx_CLEAR(r)    do { PyObject* tmp = ((PyObject*)(r)); r = NULL; __Pyx_DECREF(tmp);} while(0)
 #define __Pyx_XCLEAR(r)   do { if((r) != NULL) {PyObject* tmp = ((PyObject*)(r)); r = NULL; __Pyx_DECREF(tmp);}} while(0)
 
-/* PyObjectGetAttrStr.proto */
-#if CYTHON_USE_TYPE_SLOTS
-static CYTHON_INLINE PyObject* __Pyx_PyObject_GetAttrStr(PyObject* obj, PyObject* attr_name);
-#else
-#define __Pyx_PyObject_GetAttrStr(o,n) PyObject_GetAttr(o,n)
-#endif
-
-/* GetBuiltinName.proto */
-static PyObject *__Pyx_GetBuiltinName(PyObject *name);
-
-/* PyObjectCall.proto */
-#if CYTHON_COMPILING_IN_CPYTHON
-static CYTHON_INLINE PyObject* __Pyx_PyObject_Call(PyObject *func, PyObject *arg, PyObject *kw);
+/* PyErrExceptionMatches.proto */
+#if CYTHON_FAST_THREAD_STATE
+#define __Pyx_PyErr_ExceptionMatches(err) __Pyx_PyErr_ExceptionMatchesInState(__pyx_tstate, err)
+static CYTHON_INLINE int __Pyx_PyErr_ExceptionMatchesInState(PyThreadState* tstate, PyObject* err);
 #else
-#define __Pyx_PyObject_Call(func, arg, kw) PyObject_Call(func, arg, kw)
+#define __Pyx_PyErr_ExceptionMatches(err)  PyErr_ExceptionMatches(err)
 #endif
 
 /* PyThreadStateGet.proto */
 #if CYTHON_FAST_THREAD_STATE
 #define __Pyx_PyThreadState_declare  PyThreadState *__pyx_tstate;
 #define __Pyx_PyThreadState_assign  __pyx_tstate = __Pyx_PyThreadState_Current;
-#define __Pyx_PyErr_Occurred()  __pyx_tstate->curexc_type
+#if PY_VERSION_HEX >= 0x030C00A6
+#define __Pyx_PyErr_Occurred()  (__pyx_tstate->current_exception != NULL)
+#define __Pyx_PyErr_CurrentExceptionType()  (__pyx_tstate->current_exception ? (PyObject*) Py_TYPE(__pyx_tstate->current_exception) : (PyObject*) NULL)
+#else
+#define __Pyx_PyErr_Occurred()  (__pyx_tstate->curexc_type != NULL)
+#define __Pyx_PyErr_CurrentExceptionType()  (__pyx_tstate->curexc_type)
+#endif
 #else
 #define __Pyx_PyThreadState_declare
 #define __Pyx_PyThreadState_assign
-#define __Pyx_PyErr_Occurred()  PyErr_Occurred()
+#define __Pyx_PyErr_Occurred()  (PyErr_Occurred() != NULL)
+#define __Pyx_PyErr_CurrentExceptionType()  PyErr_Occurred()
 #endif
 
 /* PyErrFetchRestore.proto */
 #if CYTHON_FAST_THREAD_STATE
 #define __Pyx_PyErr_Clear() __Pyx_ErrRestore(NULL, NULL, NULL)
 #define __Pyx_ErrRestoreWithState(type, value, tb)  __Pyx_ErrRestoreInState(PyThreadState_GET(), type, value, tb)
 #define __Pyx_ErrFetchWithState(type, value, tb)    __Pyx_ErrFetchInState(PyThreadState_GET(), type, value, tb)
 #define __Pyx_ErrRestore(type, value, tb)  __Pyx_ErrRestoreInState(__pyx_tstate, type, value, tb)
 #define __Pyx_ErrFetch(type, value, tb)    __Pyx_ErrFetchInState(__pyx_tstate, type, value, tb)
 static CYTHON_INLINE void __Pyx_ErrRestoreInState(PyThreadState *tstate, PyObject *type, PyObject *value, PyObject *tb);
 static CYTHON_INLINE void __Pyx_ErrFetchInState(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb);
-#if CYTHON_COMPILING_IN_CPYTHON
+#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX < 0x030C00A6
 #define __Pyx_PyErr_SetNone(exc) (Py_INCREF(exc), __Pyx_ErrRestore((exc), NULL, NULL))
 #else
 #define __Pyx_PyErr_SetNone(exc) PyErr_SetNone(exc)
 #endif
 #else
 #define __Pyx_PyErr_Clear() PyErr_Clear()
 #define __Pyx_PyErr_SetNone(exc) PyErr_SetNone(exc)
@@ -1267,83 +1534,222 @@
 #define __Pyx_ErrFetchWithState(type, value, tb)  PyErr_Fetch(type, value, tb)
 #define __Pyx_ErrRestoreInState(tstate, type, value, tb)  PyErr_Restore(type, value, tb)
 #define __Pyx_ErrFetchInState(tstate, type, value, tb)  PyErr_Fetch(type, value, tb)
 #define __Pyx_ErrRestore(type, value, tb)  PyErr_Restore(type, value, tb)
 #define __Pyx_ErrFetch(type, value, tb)  PyErr_Fetch(type, value, tb)
 #endif
 
-/* RaiseException.proto */
-static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb, PyObject *cause);
+/* PyObjectGetAttrStr.proto */
+#if CYTHON_USE_TYPE_SLOTS
+static CYTHON_INLINE PyObject* __Pyx_PyObject_GetAttrStr(PyObject* obj, PyObject* attr_name);
+#else
+#define __Pyx_PyObject_GetAttrStr(o,n) PyObject_GetAttr(o,n)
+#endif
 
-/* ListAppend.proto */
-#if CYTHON_USE_PYLIST_INTERNALS && CYTHON_ASSUME_SAFE_MACROS
-static CYTHON_INLINE int __Pyx_PyList_Append(PyObject* list, PyObject* x) {
-    PyListObject* L = (PyListObject*) list;
-    Py_ssize_t len = Py_SIZE(list);
-    if (likely(L->allocated > len) & likely(len > (L->allocated >> 1))) {
-        Py_INCREF(x);
-        PyList_SET_ITEM(list, len, x);
-        __Pyx_SET_SIZE(list, len + 1);
-        return 0;
-    }
-    return PyList_Append(list, x);
-}
+/* PyObjectGetAttrStrNoError.proto */
+static CYTHON_INLINE PyObject* __Pyx_PyObject_GetAttrStrNoError(PyObject* obj, PyObject* attr_name);
+
+/* GetBuiltinName.proto */
+static PyObject *__Pyx_GetBuiltinName(PyObject *name);
+
+/* WriteUnraisableException.proto */
+static void __Pyx_WriteUnraisable(const char *name, int clineno,
+                                  int lineno, const char *filename,
+                                  int full_traceback, int nogil);
+
+/* TupleAndListFromArray.proto */
+#if CYTHON_COMPILING_IN_CPYTHON
+static CYTHON_INLINE PyObject* __Pyx_PyList_FromArray(PyObject *const *src, Py_ssize_t n);
+static CYTHON_INLINE PyObject* __Pyx_PyTuple_FromArray(PyObject *const *src, Py_ssize_t n);
+#endif
+
+/* IncludeStringH.proto */
+#include <string.h>
+
+/* BytesEquals.proto */
+static CYTHON_INLINE int __Pyx_PyBytes_Equals(PyObject* s1, PyObject* s2, int equals);
+
+/* UnicodeEquals.proto */
+static CYTHON_INLINE int __Pyx_PyUnicode_Equals(PyObject* s1, PyObject* s2, int equals);
+
+/* fastcall.proto */
+#define __Pyx_Arg_VARARGS(args, i) PyTuple_GET_ITEM(args, i)
+#define __Pyx_NumKwargs_VARARGS(kwds) PyDict_Size(kwds)
+#define __Pyx_KwValues_VARARGS(args, nargs) NULL
+#define __Pyx_GetKwValue_VARARGS(kw, kwvalues, s) __Pyx_PyDict_GetItemStrWithError(kw, s)
+#define __Pyx_KwargsAsDict_VARARGS(kw, kwvalues) PyDict_Copy(kw)
+#if CYTHON_METH_FASTCALL
+    #define __Pyx_Arg_FASTCALL(args, i) args[i]
+    #define __Pyx_NumKwargs_FASTCALL(kwds) PyTuple_GET_SIZE(kwds)
+    #define __Pyx_KwValues_FASTCALL(args, nargs) ((args) + (nargs))
+    static CYTHON_INLINE PyObject * __Pyx_GetKwValue_FASTCALL(PyObject *kwnames, PyObject *const *kwvalues, PyObject *s);
+    #define __Pyx_KwargsAsDict_FASTCALL(kw, kwvalues) _PyStack_AsDict(kwvalues, kw)
+#else
+    #define __Pyx_Arg_FASTCALL __Pyx_Arg_VARARGS
+    #define __Pyx_NumKwargs_FASTCALL __Pyx_NumKwargs_VARARGS
+    #define __Pyx_KwValues_FASTCALL __Pyx_KwValues_VARARGS
+    #define __Pyx_GetKwValue_FASTCALL __Pyx_GetKwValue_VARARGS
+    #define __Pyx_KwargsAsDict_FASTCALL __Pyx_KwargsAsDict_VARARGS
+#endif
+#if CYTHON_COMPILING_IN_CPYTHON
+#define __Pyx_ArgsSlice_VARARGS(args, start, stop) __Pyx_PyTuple_FromArray(&__Pyx_Arg_VARARGS(args, start), stop - start)
+#define __Pyx_ArgsSlice_FASTCALL(args, start, stop) __Pyx_PyTuple_FromArray(&__Pyx_Arg_FASTCALL(args, start), stop - start)
 #else
-#define __Pyx_PyList_Append(L,x) PyList_Append(L,x)
+#define __Pyx_ArgsSlice_VARARGS(args, start, stop) PyTuple_GetSlice(args, start, stop)
+#define __Pyx_ArgsSlice_FASTCALL(args, start, stop) PyTuple_GetSlice(args, start, stop)
 #endif
 
-/* PyCFunctionFastCall.proto */
-#if CYTHON_FAST_PYCCALL
-static CYTHON_INLINE PyObject *__Pyx_PyCFunction_FastCall(PyObject *func, PyObject **args, Py_ssize_t nargs);
+/* RaiseArgTupleInvalid.proto */
+static void __Pyx_RaiseArgtupleInvalid(const char* func_name, int exact,
+    Py_ssize_t num_min, Py_ssize_t num_max, Py_ssize_t num_found);
+
+/* RaiseDoubleKeywords.proto */
+static void __Pyx_RaiseDoubleKeywordsError(const char* func_name, PyObject* kw_name);
+
+/* ParseKeywords.proto */
+static int __Pyx_ParseOptionalKeywords(PyObject *kwds, PyObject *const *kwvalues,
+    PyObject **argnames[],
+    PyObject *kwds2, PyObject *values[], Py_ssize_t num_pos_args,
+    const char* function_name);
+
+/* AssertionsEnabled.proto */
+#define __Pyx_init_assertions_enabled()
+#if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX < 0x02070600 && !defined(Py_OptimizeFlag)
+  #define __pyx_assertions_enabled() (1)
+#elif PY_VERSION_HEX < 0x03080000  ||  CYTHON_COMPILING_IN_PYPY  ||  defined(Py_LIMITED_API)
+  #define __pyx_assertions_enabled() (!Py_OptimizeFlag)
+#elif CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x030900A6
+  static int __pyx_assertions_enabled_flag;
+  #define __pyx_assertions_enabled() (__pyx_assertions_enabled_flag)
+  #undef __Pyx_init_assertions_enabled
+  static void __Pyx_init_assertions_enabled(void) {
+    __pyx_assertions_enabled_flag = ! _PyInterpreterState_GetConfig(__Pyx_PyThreadState_Current->interp)->optimization_level;
+  }
 #else
-#define __Pyx_PyCFunction_FastCall(func, args, nargs)  (assert(0), NULL)
+  #define __pyx_assertions_enabled() (!Py_OptimizeFlag)
 #endif
 
+/* RaiseException.proto */
+static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb, PyObject *cause);
+
 /* PyFunctionFastCall.proto */
 #if CYTHON_FAST_PYCALL
+#if !CYTHON_VECTORCALL
 #define __Pyx_PyFunction_FastCall(func, args, nargs)\
     __Pyx_PyFunction_FastCallDict((func), (args), (nargs), NULL)
-#if 1 || PY_VERSION_HEX < 0x030600B1
 static PyObject *__Pyx_PyFunction_FastCallDict(PyObject *func, PyObject **args, Py_ssize_t nargs, PyObject *kwargs);
-#else
-#define __Pyx_PyFunction_FastCallDict(func, args, nargs, kwargs) _PyFunction_FastCallDict(func, args, nargs, kwargs)
 #endif
 #define __Pyx_BUILD_ASSERT_EXPR(cond)\
     (sizeof(char [1 - 2*!(cond)]) - 1)
 #ifndef Py_MEMBER_SIZE
 #define Py_MEMBER_SIZE(type, member) sizeof(((type *)0)->member)
 #endif
+#if !CYTHON_VECTORCALL
+#if PY_VERSION_HEX >= 0x03080000
+  #include "frameobject.h"
+#if PY_VERSION_HEX >= 0x030b00a6
+  #ifndef Py_BUILD_CORE
+    #define Py_BUILD_CORE 1
+  #endif
+  #include "internal/pycore_frame.h"
+#endif
+  #define __Pxy_PyFrame_Initialize_Offsets()
+  #define __Pyx_PyFrame_GetLocalsplus(frame)  ((frame)->f_localsplus)
+#else
   static size_t __pyx_pyframe_localsplus_offset = 0;
   #include "frameobject.h"
   #define __Pxy_PyFrame_Initialize_Offsets()\
     ((void)__Pyx_BUILD_ASSERT_EXPR(sizeof(PyFrameObject) == offsetof(PyFrameObject, f_localsplus) + Py_MEMBER_SIZE(PyFrameObject, f_localsplus)),\
      (void)(__pyx_pyframe_localsplus_offset = ((size_t)PyFrame_Type.tp_basicsize) - Py_MEMBER_SIZE(PyFrameObject, f_localsplus)))
   #define __Pyx_PyFrame_GetLocalsplus(frame)\
     (assert(__pyx_pyframe_localsplus_offset), (PyObject **)(((char *)(frame)) + __pyx_pyframe_localsplus_offset))
 #endif
+#endif
+#endif
 
-/* PyObjectCall2Args.proto */
-static CYTHON_UNUSED PyObject* __Pyx_PyObject_Call2Args(PyObject* function, PyObject* arg1, PyObject* arg2);
+/* PyObjectCall.proto */
+#if CYTHON_COMPILING_IN_CPYTHON
+static CYTHON_INLINE PyObject* __Pyx_PyObject_Call(PyObject *func, PyObject *arg, PyObject *kw);
+#else
+#define __Pyx_PyObject_Call(func, arg, kw) PyObject_Call(func, arg, kw)
+#endif
 
 /* PyObjectCallMethO.proto */
 #if CYTHON_COMPILING_IN_CPYTHON
 static CYTHON_INLINE PyObject* __Pyx_PyObject_CallMethO(PyObject *func, PyObject *arg);
 #endif
 
+/* PyObjectFastCall.proto */
+#define __Pyx_PyObject_FastCall(func, args, nargs)  __Pyx_PyObject_FastCallDict(func, args, (size_t)(nargs), NULL)
+static CYTHON_INLINE PyObject* __Pyx_PyObject_FastCallDict(PyObject *func, PyObject **args, size_t nargs, PyObject *kwargs);
+
 /* PyObjectCallOneArg.proto */
 static CYTHON_INLINE PyObject* __Pyx_PyObject_CallOneArg(PyObject *func, PyObject *arg);
 
-/* PyObjectGetMethod.proto */
-static int __Pyx_PyObject_GetMethod(PyObject *obj, PyObject *name, PyObject **method);
+/* PyDictVersioning.proto */
+#if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_TYPE_SLOTS
+#define __PYX_DICT_VERSION_INIT  ((PY_UINT64_T) -1)
+#define __PYX_GET_DICT_VERSION(dict)  (((PyDictObject*)(dict))->ma_version_tag)
+#define __PYX_UPDATE_DICT_CACHE(dict, value, cache_var, version_var)\
+    (version_var) = __PYX_GET_DICT_VERSION(dict);\
+    (cache_var) = (value);
+#define __PYX_PY_DICT_LOOKUP_IF_MODIFIED(VAR, DICT, LOOKUP) {\
+    static PY_UINT64_T __pyx_dict_version = 0;\
+    static PyObject *__pyx_dict_cached_value = NULL;\
+    if (likely(__PYX_GET_DICT_VERSION(DICT) == __pyx_dict_version)) {\
+        (VAR) = __pyx_dict_cached_value;\
+    } else {\
+        (VAR) = __pyx_dict_cached_value = (LOOKUP);\
+        __pyx_dict_version = __PYX_GET_DICT_VERSION(DICT);\
+    }\
+}
+static CYTHON_INLINE PY_UINT64_T __Pyx_get_tp_dict_version(PyObject *obj);
+static CYTHON_INLINE PY_UINT64_T __Pyx_get_object_dict_version(PyObject *obj);
+static CYTHON_INLINE int __Pyx_object_dict_version_matches(PyObject* obj, PY_UINT64_T tp_dict_version, PY_UINT64_T obj_dict_version);
+#else
+#define __PYX_GET_DICT_VERSION(dict)  (0)
+#define __PYX_UPDATE_DICT_CACHE(dict, value, cache_var, version_var)
+#define __PYX_PY_DICT_LOOKUP_IF_MODIFIED(VAR, DICT, LOOKUP)  (VAR) = (LOOKUP);
+#endif
 
-/* PyObjectCallMethod1.proto */
-static PyObject* __Pyx_PyObject_CallMethod1(PyObject* obj, PyObject* method_name, PyObject* arg);
+/* GetModuleGlobalName.proto */
+#if CYTHON_USE_DICT_VERSIONS
+#define __Pyx_GetModuleGlobalName(var, name)  do {\
+    static PY_UINT64_T __pyx_dict_version = 0;\
+    static PyObject *__pyx_dict_cached_value = NULL;\
+    (var) = (likely(__pyx_dict_version == __PYX_GET_DICT_VERSION(__pyx_d))) ?\
+        (likely(__pyx_dict_cached_value) ? __Pyx_NewRef(__pyx_dict_cached_value) : __Pyx_GetBuiltinName(name)) :\
+        __Pyx__GetModuleGlobalName(name, &__pyx_dict_version, &__pyx_dict_cached_value);\
+} while(0)
+#define __Pyx_GetModuleGlobalNameUncached(var, name)  do {\
+    PY_UINT64_T __pyx_dict_version;\
+    PyObject *__pyx_dict_cached_value;\
+    (var) = __Pyx__GetModuleGlobalName(name, &__pyx_dict_version, &__pyx_dict_cached_value);\
+} while(0)
+static PyObject *__Pyx__GetModuleGlobalName(PyObject *name, PY_UINT64_T *dict_version, PyObject **dict_cached_value);
+#else
+#define __Pyx_GetModuleGlobalName(var, name)  (var) = __Pyx__GetModuleGlobalName(name)
+#define __Pyx_GetModuleGlobalNameUncached(var, name)  (var) = __Pyx__GetModuleGlobalName(name)
+static CYTHON_INLINE PyObject *__Pyx__GetModuleGlobalName(PyObject *name);
+#endif
+
+/* PyObjectSetAttrStr.proto */
+#if CYTHON_USE_TYPE_SLOTS
+#define __Pyx_PyObject_DelAttrStr(o,n) __Pyx_PyObject_SetAttrStr(o, n, NULL)
+static CYTHON_INLINE int __Pyx_PyObject_SetAttrStr(PyObject* obj, PyObject* attr_name, PyObject* value);
+#else
+#define __Pyx_PyObject_DelAttrStr(o,n)   PyObject_DelAttr(o,n)
+#define __Pyx_PyObject_SetAttrStr(o,n,v) PyObject_SetAttr(o,n,v)
+#endif
 
-/* append.proto */
-static CYTHON_INLINE int __Pyx_PyObject_Append(PyObject* L, PyObject* x);
+/* PySequenceContains.proto */
+static CYTHON_INLINE int __Pyx_PySequence_ContainsTF(PyObject* item, PyObject* seq, int eq) {
+    int result = PySequence_Contains(seq, item);
+    return unlikely(result < 0) ? result : (result == (eq == Py_EQ));
+}
 
 /* GetItemInt.proto */
 #define __Pyx_GetItemInt(o, i, type, is_signed, to_py_func, is_list, wraparound, boundscheck)\
     (__Pyx_fits_Py_ssize_t(i, type, is_signed) ?\
     __Pyx_GetItemInt_Fast(o, (Py_ssize_t)i, is_list, wraparound, boundscheck) :\
     (is_list ? (PyErr_SetString(PyExc_IndexError, "list index out of range"), (PyObject*)NULL) :\
                __Pyx_GetItemInt_Generic(o, to_py_func(i))))
@@ -1359,75 +1765,222 @@
     (PyErr_SetString(PyExc_IndexError, "tuple index out of range"), (PyObject*)NULL))
 static CYTHON_INLINE PyObject *__Pyx_GetItemInt_Tuple_Fast(PyObject *o, Py_ssize_t i,
                                                               int wraparound, int boundscheck);
 static PyObject *__Pyx_GetItemInt_Generic(PyObject *o, PyObject* j);
 static CYTHON_INLINE PyObject *__Pyx_GetItemInt_Fast(PyObject *o, Py_ssize_t i,
                                                      int is_list, int wraparound, int boundscheck);
 
-/* PyObjectCallNoArg.proto */
-#if CYTHON_COMPILING_IN_CPYTHON
-static CYTHON_INLINE PyObject* __Pyx_PyObject_CallNoArg(PyObject *func);
+/* ObjectGetItem.proto */
+#if CYTHON_USE_TYPE_SLOTS
+static CYTHON_INLINE PyObject *__Pyx_PyObject_GetItem(PyObject *obj, PyObject *key);
 #else
-#define __Pyx_PyObject_CallNoArg(func) __Pyx_PyObject_Call(func, __pyx_empty_tuple, NULL)
+#define __Pyx_PyObject_GetItem(obj, key)  PyObject_GetItem(obj, key)
 #endif
 
-/* PyObjectCallMethod0.proto */
-static PyObject* __Pyx_PyObject_CallMethod0(PyObject* obj, PyObject* method_name);
+/* PyObjectFormatAndDecref.proto */
+static CYTHON_INLINE PyObject* __Pyx_PyObject_FormatSimpleAndDecref(PyObject* s, PyObject* f);
+static CYTHON_INLINE PyObject* __Pyx_PyObject_FormatAndDecref(PyObject* s, PyObject* f);
 
-/* pop.proto */
-static CYTHON_INLINE PyObject* __Pyx__PyObject_Pop(PyObject* L);
-#if CYTHON_USE_PYLIST_INTERNALS && CYTHON_ASSUME_SAFE_MACROS
-static CYTHON_INLINE PyObject* __Pyx_PyList_Pop(PyObject* L);
-#define __Pyx_PyObject_Pop(L) (likely(PyList_CheckExact(L)) ?\
-    __Pyx_PyList_Pop(L) : __Pyx__PyObject_Pop(L))
+/* JoinPyUnicode.proto */
+static PyObject* __Pyx_PyUnicode_Join(PyObject* value_tuple, Py_ssize_t value_count, Py_ssize_t result_ulength,
+                                      Py_UCS4 max_char);
+
+/* TypeImport.proto */
+#ifndef __PYX_HAVE_RT_ImportType_proto_3_0_0
+#define __PYX_HAVE_RT_ImportType_proto_3_0_0
+#if defined (__STDC_VERSION__) && __STDC_VERSION__ >= 201112L
+#include <stdalign.h>
+#endif
+#if (defined (__STDC_VERSION__) && __STDC_VERSION__ >= 201112L) || __cplusplus >= 201103L
+#define __PYX_GET_STRUCT_ALIGNMENT_3_0_0(s) alignof(s)
+#else
+#define __PYX_GET_STRUCT_ALIGNMENT_3_0_0(s) sizeof(void*)
+#endif
+enum __Pyx_ImportType_CheckSize_3_0_0 {
+   __Pyx_ImportType_CheckSize_Error_3_0_0 = 0,
+   __Pyx_ImportType_CheckSize_Warn_3_0_0 = 1,
+   __Pyx_ImportType_CheckSize_Ignore_3_0_0 = 2
+};
+static PyTypeObject *__Pyx_ImportType_3_0_0(PyObject* module, const char *module_name, const char *class_name, size_t size, size_t alignment, enum __Pyx_ImportType_CheckSize_3_0_0 check_size);
+#endif
+
+/* IncludeStructmemberH.proto */
+#include <structmember.h>
+
+/* FixUpExtensionType.proto */
+#if CYTHON_USE_TYPE_SPECS
+static int __Pyx_fix_up_extension_type_from_spec(PyType_Spec *spec, PyTypeObject *type);
+#endif
+
+/* FetchSharedCythonModule.proto */
+static PyObject *__Pyx_FetchSharedCythonABIModule(void);
+
+/* FetchCommonType.proto */
+#if !CYTHON_USE_TYPE_SPECS
+static PyTypeObject* __Pyx_FetchCommonType(PyTypeObject* type);
 #else
-#define __Pyx_PyList_Pop(L)  __Pyx__PyObject_Pop(L)
-#define __Pyx_PyObject_Pop(L)  __Pyx__PyObject_Pop(L)
+static PyTypeObject* __Pyx_FetchCommonTypeFromSpec(PyObject *module, PyType_Spec *spec, PyObject *bases);
 #endif
 
-/* UnpackUnboundCMethod.proto */
+/* PyMethodNew.proto */
+#if PY_MAJOR_VERSION >= 3
+static PyObject *__Pyx_PyMethod_New(PyObject *func, PyObject *self, PyObject *typ) {
+    CYTHON_UNUSED_VAR(typ);
+    if (!self)
+        return __Pyx_NewRef(func);
+    return PyMethod_New(func, self);
+}
+#else
+    #define __Pyx_PyMethod_New PyMethod_New
+#endif
+
+/* PyVectorcallFastCallDict.proto */
+#if CYTHON_METH_FASTCALL
+static CYTHON_INLINE PyObject *__Pyx_PyVectorcall_FastCallDict(PyObject *func, __pyx_vectorcallfunc vc, PyObject *const *args, size_t nargs, PyObject *kw);
+#endif
+
+/* CythonFunctionShared.proto */
+#define __Pyx_CyFunction_USED
+#define __Pyx_CYFUNCTION_STATICMETHOD  0x01
+#define __Pyx_CYFUNCTION_CLASSMETHOD   0x02
+#define __Pyx_CYFUNCTION_CCLASS        0x04
+#define __Pyx_CYFUNCTION_COROUTINE     0x08
+#define __Pyx_CyFunction_GetClosure(f)\
+    (((__pyx_CyFunctionObject *) (f))->func_closure)
+#if PY_VERSION_HEX < 0x030900B1
+  #define __Pyx_CyFunction_GetClassObj(f)\
+      (((__pyx_CyFunctionObject *) (f))->func_classobj)
+#else
+  #define __Pyx_CyFunction_GetClassObj(f)\
+      ((PyObject*) ((PyCMethodObject *) (f))->mm_class)
+#endif
+#define __Pyx_CyFunction_SetClassObj(f, classobj)\
+    __Pyx__CyFunction_SetClassObj((__pyx_CyFunctionObject *) (f), (classobj))
+#define __Pyx_CyFunction_Defaults(type, f)\
+    ((type *)(((__pyx_CyFunctionObject *) (f))->defaults))
+#define __Pyx_CyFunction_SetDefaultsGetter(f, g)\
+    ((__pyx_CyFunctionObject *) (f))->defaults_getter = (g)
 typedef struct {
-    PyObject *type;
-    PyObject **method_name;
-    PyCFunction func;
-    PyObject *method;
-    int flag;
-} __Pyx_CachedCFunction;
-
-/* CallUnboundCMethod0.proto */
-static PyObject* __Pyx__CallUnboundCMethod0(__Pyx_CachedCFunction* cfunc, PyObject* self);
-#if CYTHON_COMPILING_IN_CPYTHON
-#define __Pyx_CallUnboundCMethod0(cfunc, self)\
-    (likely((cfunc)->func) ?\
-        (likely((cfunc)->flag == METH_NOARGS) ?  (*((cfunc)->func))(self, NULL) :\
-         (PY_VERSION_HEX >= 0x030600B1 && likely((cfunc)->flag == METH_FASTCALL) ?\
-            (PY_VERSION_HEX >= 0x030700A0 ?\
-                (*(__Pyx_PyCFunctionFast)(void*)(PyCFunction)(cfunc)->func)(self, &__pyx_empty_tuple, 0) :\
-                (*(__Pyx_PyCFunctionFastWithKeywords)(void*)(PyCFunction)(cfunc)->func)(self, &__pyx_empty_tuple, 0, NULL)) :\
-          (PY_VERSION_HEX >= 0x030700A0 && (cfunc)->flag == (METH_FASTCALL | METH_KEYWORDS) ?\
-            (*(__Pyx_PyCFunctionFastWithKeywords)(void*)(PyCFunction)(cfunc)->func)(self, &__pyx_empty_tuple, 0, NULL) :\
-            (likely((cfunc)->flag == (METH_VARARGS | METH_KEYWORDS)) ?  ((*(PyCFunctionWithKeywords)(void*)(PyCFunction)(cfunc)->func)(self, __pyx_empty_tuple, NULL)) :\
-               ((cfunc)->flag == METH_VARARGS ?  (*((cfunc)->func))(self, __pyx_empty_tuple) :\
-               __Pyx__CallUnboundCMethod0(cfunc, self)))))) :\
-        __Pyx__CallUnboundCMethod0(cfunc, self))
+#if PY_VERSION_HEX < 0x030900B1
+    PyCFunctionObject func;
 #else
-#define __Pyx_CallUnboundCMethod0(cfunc, self)  __Pyx__CallUnboundCMethod0(cfunc, self)
+    PyCMethodObject func;
+#endif
+#if CYTHON_BACKPORT_VECTORCALL
+    __pyx_vectorcallfunc func_vectorcall;
 #endif
+#if PY_VERSION_HEX < 0x030500A0
+    PyObject *func_weakreflist;
+#endif
+    PyObject *func_dict;
+    PyObject *func_name;
+    PyObject *func_qualname;
+    PyObject *func_doc;
+    PyObject *func_globals;
+    PyObject *func_code;
+    PyObject *func_closure;
+#if PY_VERSION_HEX < 0x030900B1
+    PyObject *func_classobj;
+#endif
+    void *defaults;
+    int defaults_pyobjects;
+    size_t defaults_size;  // used by FusedFunction for copying defaults
+    int flags;
+    PyObject *defaults_tuple;
+    PyObject *defaults_kwdict;
+    PyObject *(*defaults_getter)(PyObject *);
+    PyObject *func_annotations;
+    PyObject *func_is_coroutine;
+} __pyx_CyFunctionObject;
+#define __Pyx_CyFunction_Check(obj)  __Pyx_TypeCheck(obj, __pyx_CyFunctionType)
+#define __Pyx_IsCyOrPyCFunction(obj)  __Pyx_TypeCheck2(obj, __pyx_CyFunctionType, &PyCFunction_Type)
+#define __Pyx_CyFunction_CheckExact(obj)  __Pyx_IS_TYPE(obj, __pyx_CyFunctionType)
+static PyObject *__Pyx_CyFunction_Init(__pyx_CyFunctionObject* op, PyMethodDef *ml,
+                                      int flags, PyObject* qualname,
+                                      PyObject *closure,
+                                      PyObject *module, PyObject *globals,
+                                      PyObject* code);
+static CYTHON_INLINE void __Pyx__CyFunction_SetClassObj(__pyx_CyFunctionObject* f, PyObject* classobj);
+static CYTHON_INLINE void *__Pyx_CyFunction_InitDefaults(PyObject *m,
+                                                         size_t size,
+                                                         int pyobjects);
+static CYTHON_INLINE void __Pyx_CyFunction_SetDefaultsTuple(PyObject *m,
+                                                            PyObject *tuple);
+static CYTHON_INLINE void __Pyx_CyFunction_SetDefaultsKwDict(PyObject *m,
+                                                             PyObject *dict);
+static CYTHON_INLINE void __Pyx_CyFunction_SetAnnotationsDict(PyObject *m,
+                                                              PyObject *dict);
+static int __pyx_CyFunction_init(PyObject *module);
+#if CYTHON_METH_FASTCALL
+static PyObject * __Pyx_CyFunction_Vectorcall_NOARGS(PyObject *func, PyObject *const *args, size_t nargsf, PyObject *kwnames);
+static PyObject * __Pyx_CyFunction_Vectorcall_O(PyObject *func, PyObject *const *args, size_t nargsf, PyObject *kwnames);
+static PyObject * __Pyx_CyFunction_Vectorcall_FASTCALL_KEYWORDS(PyObject *func, PyObject *const *args, size_t nargsf, PyObject *kwnames);
+static PyObject * __Pyx_CyFunction_Vectorcall_FASTCALL_KEYWORDS_METHOD(PyObject *func, PyObject *const *args, size_t nargsf, PyObject *kwnames);
+#if CYTHON_BACKPORT_VECTORCALL
+#define __Pyx_CyFunction_func_vectorcall(f) (((__pyx_CyFunctionObject*)f)->func_vectorcall)
+#else
+#define __Pyx_CyFunction_func_vectorcall(f) (((PyCFunctionObject*)f)->vectorcall)
+#endif
+#endif
+
+/* CythonFunction.proto */
+static PyObject *__Pyx_CyFunction_New(PyMethodDef *ml,
+                                      int flags, PyObject* qualname,
+                                      PyObject *closure,
+                                      PyObject *module, PyObject *globals,
+                                      PyObject* code);
 
-/* PyIntBinop.proto */
-#if !CYTHON_COMPILING_IN_PYPY
-static PyObject* __Pyx_PyInt_AddObjC(PyObject *op1, PyObject *op2, long intval, int inplace, int zerodivision_check);
+/* Py3UpdateBases.proto */
+static PyObject* __Pyx_PEP560_update_bases(PyObject *bases);
+
+/* CalculateMetaclass.proto */
+static PyObject *__Pyx_CalculateMetaclass(PyTypeObject *metaclass, PyObject *bases);
+
+/* SetNameInClass.proto */
+#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x030500A1
+#define __Pyx_SetNameInClass(ns, name, value)\
+    (likely(PyDict_CheckExact(ns)) ? _PyDict_SetItem_KnownHash(ns, name, value, ((PyASCIIObject *) name)->hash) : PyObject_SetItem(ns, name, value))
+#elif CYTHON_COMPILING_IN_CPYTHON
+#define __Pyx_SetNameInClass(ns, name, value)\
+    (likely(PyDict_CheckExact(ns)) ? PyDict_SetItem(ns, name, value) : PyObject_SetItem(ns, name, value))
 #else
-#define __Pyx_PyInt_AddObjC(op1, op2, intval, inplace, zerodivision_check)\
-    (inplace ? PyNumber_InPlaceAdd(op1, op2) : PyNumber_Add(op1, op2))
+#define __Pyx_SetNameInClass(ns, name, value)  PyObject_SetItem(ns, name, value)
 #endif
 
+/* PyObjectCall2Args.proto */
+static CYTHON_INLINE PyObject* __Pyx_PyObject_Call2Args(PyObject* function, PyObject* arg1, PyObject* arg2);
+
+/* PyObjectLookupSpecial.proto */
+#if CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
+#define __Pyx_PyObject_LookupSpecialNoError(obj, attr_name)  __Pyx__PyObject_LookupSpecial(obj, attr_name, 0)
+#define __Pyx_PyObject_LookupSpecial(obj, attr_name)  __Pyx__PyObject_LookupSpecial(obj, attr_name, 1)
+static CYTHON_INLINE PyObject* __Pyx__PyObject_LookupSpecial(PyObject* obj, PyObject* attr_name, int with_error);
+#else
+#define __Pyx_PyObject_LookupSpecialNoError(o,n) __Pyx_PyObject_GetAttrStrNoError(o,n)
+#define __Pyx_PyObject_LookupSpecial(o,n) __Pyx_PyObject_GetAttrStr(o,n)
+#endif
+
+/* Py3ClassCreate.proto */
+static PyObject *__Pyx_Py3MetaclassPrepare(PyObject *metaclass, PyObject *bases, PyObject *name, PyObject *qualname,
+                                           PyObject *mkw, PyObject *modname, PyObject *doc);
+static PyObject *__Pyx_Py3ClassCreate(PyObject *metaclass, PyObject *name, PyObject *bases, PyObject *dict,
+                                      PyObject *mkw, int calculate_metaclass, int allow_py2_metaclass);
+
+/* PyObjectCallNoArg.proto */
+static CYTHON_INLINE PyObject* __Pyx_PyObject_CallNoArg(PyObject *func);
+
 /* IterFinish.proto */
 static CYTHON_INLINE int __Pyx_IterFinish(void);
 
+/* PyObjectGetMethod.proto */
+static int __Pyx_PyObject_GetMethod(PyObject *obj, PyObject *name, PyObject **method);
+
+/* PyObjectCallMethod0.proto */
+static PyObject* __Pyx_PyObject_CallMethod0(PyObject* obj, PyObject* method_name);
+
 /* RaiseNeedMoreValuesToUnpack.proto */
 static CYTHON_INLINE void __Pyx_RaiseNeedMoreValuesError(Py_ssize_t index);
 
 /* RaiseTooManyValuesToUnpack.proto */
 static CYTHON_INLINE void __Pyx_RaiseTooManyValuesError(Py_ssize_t expected);
 
 /* UnpackItemEndCheck.proto */
@@ -1453,6110 +2006,3170 @@
 
 /* dict_iter.proto */
 static CYTHON_INLINE PyObject* __Pyx_dict_iterator(PyObject* dict, int is_dict, PyObject* method_name,
                                                    Py_ssize_t* p_orig_length, int* p_is_dict);
 static CYTHON_INLINE int __Pyx_dict_iter_next(PyObject* dict_or_iter, Py_ssize_t orig_length, Py_ssize_t* ppos,
                                               PyObject** pkey, PyObject** pvalue, PyObject** pitem, int is_dict);
 
-/* PyDictVersioning.proto */
-#if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_TYPE_SLOTS
-#define __PYX_DICT_VERSION_INIT  ((PY_UINT64_T) -1)
-#define __PYX_GET_DICT_VERSION(dict)  (((PyDictObject*)(dict))->ma_version_tag)
-#define __PYX_UPDATE_DICT_CACHE(dict, value, cache_var, version_var)\
-    (version_var) = __PYX_GET_DICT_VERSION(dict);\
-    (cache_var) = (value);
-#define __PYX_PY_DICT_LOOKUP_IF_MODIFIED(VAR, DICT, LOOKUP) {\
-    static PY_UINT64_T __pyx_dict_version = 0;\
-    static PyObject *__pyx_dict_cached_value = NULL;\
-    if (likely(__PYX_GET_DICT_VERSION(DICT) == __pyx_dict_version)) {\
-        (VAR) = __pyx_dict_cached_value;\
-    } else {\
-        (VAR) = __pyx_dict_cached_value = (LOOKUP);\
-        __pyx_dict_version = __PYX_GET_DICT_VERSION(DICT);\
-    }\
-}
-static CYTHON_INLINE PY_UINT64_T __Pyx_get_tp_dict_version(PyObject *obj);
-static CYTHON_INLINE PY_UINT64_T __Pyx_get_object_dict_version(PyObject *obj);
-static CYTHON_INLINE int __Pyx_object_dict_version_matches(PyObject* obj, PY_UINT64_T tp_dict_version, PY_UINT64_T obj_dict_version);
-#else
-#define __PYX_GET_DICT_VERSION(dict)  (0)
-#define __PYX_UPDATE_DICT_CACHE(dict, value, cache_var, version_var)
-#define __PYX_PY_DICT_LOOKUP_IF_MODIFIED(VAR, DICT, LOOKUP)  (VAR) = (LOOKUP);
-#endif
-
-/* GetModuleGlobalName.proto */
-#if CYTHON_USE_DICT_VERSIONS
-#define __Pyx_GetModuleGlobalName(var, name)  {\
-    static PY_UINT64_T __pyx_dict_version = 0;\
-    static PyObject *__pyx_dict_cached_value = NULL;\
-    (var) = (likely(__pyx_dict_version == __PYX_GET_DICT_VERSION(__pyx_d))) ?\
-        (likely(__pyx_dict_cached_value) ? __Pyx_NewRef(__pyx_dict_cached_value) : __Pyx_GetBuiltinName(name)) :\
-        __Pyx__GetModuleGlobalName(name, &__pyx_dict_version, &__pyx_dict_cached_value);\
-}
-#define __Pyx_GetModuleGlobalNameUncached(var, name)  {\
-    PY_UINT64_T __pyx_dict_version;\
-    PyObject *__pyx_dict_cached_value;\
-    (var) = __Pyx__GetModuleGlobalName(name, &__pyx_dict_version, &__pyx_dict_cached_value);\
-}
-static PyObject *__Pyx__GetModuleGlobalName(PyObject *name, PY_UINT64_T *dict_version, PyObject **dict_cached_value);
-#else
-#define __Pyx_GetModuleGlobalName(var, name)  (var) = __Pyx__GetModuleGlobalName(name)
-#define __Pyx_GetModuleGlobalNameUncached(var, name)  (var) = __Pyx__GetModuleGlobalName(name)
-static CYTHON_INLINE PyObject *__Pyx__GetModuleGlobalName(PyObject *name);
-#endif
-
-/* RaiseArgTupleInvalid.proto */
-static void __Pyx_RaiseArgtupleInvalid(const char* func_name, int exact,
-    Py_ssize_t num_min, Py_ssize_t num_max, Py_ssize_t num_found);
-
-/* RaiseDoubleKeywords.proto */
-static void __Pyx_RaiseDoubleKeywordsError(const char* func_name, PyObject* kw_name);
-
-/* ParseKeywords.proto */
-static int __Pyx_ParseOptionalKeywords(PyObject *kwds, PyObject **argnames[],\
-    PyObject *kwds2, PyObject *values[], Py_ssize_t num_pos_args,\
-    const char* function_name);
-
-/* KeywordStringCheck.proto */
-static int __Pyx_CheckKeywordStrings(PyObject *kwdict, const char* function_name, int kw_allowed);
-
-/* GetTopmostException.proto */
-#if CYTHON_USE_EXC_INFO_STACK
-static _PyErr_StackItem * __Pyx_PyErr_GetTopmostException(PyThreadState *tstate);
-#endif
-
-/* SaveResetException.proto */
-#if CYTHON_FAST_THREAD_STATE
-#define __Pyx_ExceptionSave(type, value, tb)  __Pyx__ExceptionSave(__pyx_tstate, type, value, tb)
-static CYTHON_INLINE void __Pyx__ExceptionSave(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb);
-#define __Pyx_ExceptionReset(type, value, tb)  __Pyx__ExceptionReset(__pyx_tstate, type, value, tb)
-static CYTHON_INLINE void __Pyx__ExceptionReset(PyThreadState *tstate, PyObject *type, PyObject *value, PyObject *tb);
-#else
-#define __Pyx_ExceptionSave(type, value, tb)   PyErr_GetExcInfo(type, value, tb)
-#define __Pyx_ExceptionReset(type, value, tb)  PyErr_SetExcInfo(type, value, tb)
-#endif
-
-/* PyErrExceptionMatches.proto */
-#if CYTHON_FAST_THREAD_STATE
-#define __Pyx_PyErr_ExceptionMatches(err) __Pyx_PyErr_ExceptionMatchesInState(__pyx_tstate, err)
-static CYTHON_INLINE int __Pyx_PyErr_ExceptionMatchesInState(PyThreadState* tstate, PyObject* err);
-#else
-#define __Pyx_PyErr_ExceptionMatches(err)  PyErr_ExceptionMatches(err)
-#endif
-
-/* GetException.proto */
-#if CYTHON_FAST_THREAD_STATE
-#define __Pyx_GetException(type, value, tb)  __Pyx__GetException(__pyx_tstate, type, value, tb)
-static int __Pyx__GetException(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb);
-#else
-static int __Pyx_GetException(PyObject **type, PyObject **value, PyObject **tb);
-#endif
-
-/* TypeImport.proto */
-#ifndef __PYX_HAVE_RT_ImportType_proto
-#define __PYX_HAVE_RT_ImportType_proto
-enum __Pyx_ImportType_CheckSize {
-   __Pyx_ImportType_CheckSize_Error = 0,
-   __Pyx_ImportType_CheckSize_Warn = 1,
-   __Pyx_ImportType_CheckSize_Ignore = 2
-};
-static PyTypeObject *__Pyx_ImportType(PyObject* module, const char *module_name, const char *class_name, size_t size, enum __Pyx_ImportType_CheckSize check_size);
-#endif
-
-/* Import.proto */
-static PyObject *__Pyx_Import(PyObject *name, PyObject *from_list, int level);
+/* SliceObject.proto */
+static CYTHON_INLINE PyObject* __Pyx_PyObject_GetSlice(
+        PyObject* obj, Py_ssize_t cstart, Py_ssize_t cstop,
+        PyObject** py_start, PyObject** py_stop, PyObject** py_slice,
+        int has_cstart, int has_cstop, int wraparound);
 
 /* CLineInTraceback.proto */
 #ifdef CYTHON_CLINE_IN_TRACEBACK
 #define __Pyx_CLineForTraceback(tstate, c_line)  (((CYTHON_CLINE_IN_TRACEBACK)) ? c_line : 0)
 #else
 static int __Pyx_CLineForTraceback(PyThreadState *tstate, int c_line);
 #endif
 
 /* CodeObjectCache.proto */
+#if !CYTHON_COMPILING_IN_LIMITED_API
 typedef struct {
     PyCodeObject* code_object;
     int code_line;
 } __Pyx_CodeObjectCacheEntry;
 struct __Pyx_CodeObjectCache {
     int count;
     int max_count;
     __Pyx_CodeObjectCacheEntry* entries;
 };
 static struct __Pyx_CodeObjectCache __pyx_code_cache = {0,0,NULL};
 static int __pyx_bisect_code_objects(__Pyx_CodeObjectCacheEntry* entries, int count, int code_line);
 static PyCodeObject *__pyx_find_code_object(int code_line);
 static void __pyx_insert_code_object(int code_line, PyCodeObject* code_object);
+#endif
 
 /* AddTraceback.proto */
 static void __Pyx_AddTraceback(const char *funcname, int c_line,
                                int py_line, const char *filename);
 
-/* CIntToPy.proto */
-static CYTHON_INLINE PyObject* __Pyx_PyInt_From_lua_Integer(lua_Integer value);
+/* GCCDiagnostics.proto */
+#if !defined(__INTEL_COMPILER) && defined(__GNUC__) && (__GNUC__ > 4 || (__GNUC__ == 4 && __GNUC_MINOR__ >= 6))
+#define __Pyx_HAS_GCC_DIAGNOSTIC
+#endif
+
+/* CIntFromPy.proto */
+static CYTHON_INLINE int __Pyx_PyInt_As_int(PyObject *);
+
+/* CIntFromPy.proto */
+static CYTHON_INLINE size_t __Pyx_PyInt_As_size_t(PyObject *);
 
 /* CIntToPy.proto */
-static CYTHON_INLINE PyObject* __Pyx_PyInt_From_long(long value);
+static CYTHON_INLINE PyObject* __Pyx_PyInt_From_uint32_t(uint32_t value);
 
 /* CIntToPy.proto */
 static CYTHON_INLINE PyObject* __Pyx_PyInt_From_int(int value);
 
-/* RealImag.proto */
-#if CYTHON_CCOMPLEX
-  #ifdef __cplusplus
-    #define __Pyx_CREAL(z) ((z).real())
-    #define __Pyx_CIMAG(z) ((z).imag())
-  #else
-    #define __Pyx_CREAL(z) (__real__(z))
-    #define __Pyx_CIMAG(z) (__imag__(z))
-  #endif
-#else
-    #define __Pyx_CREAL(z) ((z).real)
-    #define __Pyx_CIMAG(z) ((z).imag)
-#endif
-#if defined(__cplusplus) && CYTHON_CCOMPLEX\
-        && (defined(_WIN32) || defined(__clang__) || (defined(__GNUC__) && (__GNUC__ >= 5 || __GNUC__ == 4 && __GNUC_MINOR__ >= 4 )) || __cplusplus >= 201103)
-    #define __Pyx_SET_CREAL(z,x) ((z).real(x))
-    #define __Pyx_SET_CIMAG(z,y) ((z).imag(y))
-#else
-    #define __Pyx_SET_CREAL(z,x) __Pyx_CREAL(z) = (x)
-    #define __Pyx_SET_CIMAG(z,y) __Pyx_CIMAG(z) = (y)
-#endif
-
-/* Arithmetic.proto */
-#if CYTHON_CCOMPLEX
-    #define __Pyx_c_eq_float(a, b)   ((a)==(b))
-    #define __Pyx_c_sum_float(a, b)  ((a)+(b))
-    #define __Pyx_c_diff_float(a, b) ((a)-(b))
-    #define __Pyx_c_prod_float(a, b) ((a)*(b))
-    #define __Pyx_c_quot_float(a, b) ((a)/(b))
-    #define __Pyx_c_neg_float(a)     (-(a))
-  #ifdef __cplusplus
-    #define __Pyx_c_is_zero_float(z) ((z)==(float)0)
-    #define __Pyx_c_conj_float(z)    (::std::conj(z))
-    #if 1
-        #define __Pyx_c_abs_float(z)     (::std::abs(z))
-        #define __Pyx_c_pow_float(a, b)  (::std::pow(a, b))
-    #endif
-  #else
-    #define __Pyx_c_is_zero_float(z) ((z)==0)
-    #define __Pyx_c_conj_float(z)    (conjf(z))
-    #if 1
-        #define __Pyx_c_abs_float(z)     (cabsf(z))
-        #define __Pyx_c_pow_float(a, b)  (cpowf(a, b))
-    #endif
- #endif
-#else
-    static CYTHON_INLINE int __Pyx_c_eq_float(__pyx_t_float_complex, __pyx_t_float_complex);
-    static CYTHON_INLINE __pyx_t_float_complex __Pyx_c_sum_float(__pyx_t_float_complex, __pyx_t_float_complex);
-    static CYTHON_INLINE __pyx_t_float_complex __Pyx_c_diff_float(__pyx_t_float_complex, __pyx_t_float_complex);
-    static CYTHON_INLINE __pyx_t_float_complex __Pyx_c_prod_float(__pyx_t_float_complex, __pyx_t_float_complex);
-    static CYTHON_INLINE __pyx_t_float_complex __Pyx_c_quot_float(__pyx_t_float_complex, __pyx_t_float_complex);
-    static CYTHON_INLINE __pyx_t_float_complex __Pyx_c_neg_float(__pyx_t_float_complex);
-    static CYTHON_INLINE int __Pyx_c_is_zero_float(__pyx_t_float_complex);
-    static CYTHON_INLINE __pyx_t_float_complex __Pyx_c_conj_float(__pyx_t_float_complex);
-    #if 1
-        static CYTHON_INLINE float __Pyx_c_abs_float(__pyx_t_float_complex);
-        static CYTHON_INLINE __pyx_t_float_complex __Pyx_c_pow_float(__pyx_t_float_complex, __pyx_t_float_complex);
-    #endif
-#endif
-
-/* Arithmetic.proto */
-#if CYTHON_CCOMPLEX
-    #define __Pyx_c_eq_double(a, b)   ((a)==(b))
-    #define __Pyx_c_sum_double(a, b)  ((a)+(b))
-    #define __Pyx_c_diff_double(a, b) ((a)-(b))
-    #define __Pyx_c_prod_double(a, b) ((a)*(b))
-    #define __Pyx_c_quot_double(a, b) ((a)/(b))
-    #define __Pyx_c_neg_double(a)     (-(a))
-  #ifdef __cplusplus
-    #define __Pyx_c_is_zero_double(z) ((z)==(double)0)
-    #define __Pyx_c_conj_double(z)    (::std::conj(z))
-    #if 1
-        #define __Pyx_c_abs_double(z)     (::std::abs(z))
-        #define __Pyx_c_pow_double(a, b)  (::std::pow(a, b))
-    #endif
-  #else
-    #define __Pyx_c_is_zero_double(z) ((z)==0)
-    #define __Pyx_c_conj_double(z)    (conj(z))
-    #if 1
-        #define __Pyx_c_abs_double(z)     (cabs(z))
-        #define __Pyx_c_pow_double(a, b)  (cpow(a, b))
-    #endif
- #endif
-#else
-    static CYTHON_INLINE int __Pyx_c_eq_double(__pyx_t_double_complex, __pyx_t_double_complex);
-    static CYTHON_INLINE __pyx_t_double_complex __Pyx_c_sum_double(__pyx_t_double_complex, __pyx_t_double_complex);
-    static CYTHON_INLINE __pyx_t_double_complex __Pyx_c_diff_double(__pyx_t_double_complex, __pyx_t_double_complex);
-    static CYTHON_INLINE __pyx_t_double_complex __Pyx_c_prod_double(__pyx_t_double_complex, __pyx_t_double_complex);
-    static CYTHON_INLINE __pyx_t_double_complex __Pyx_c_quot_double(__pyx_t_double_complex, __pyx_t_double_complex);
-    static CYTHON_INLINE __pyx_t_double_complex __Pyx_c_neg_double(__pyx_t_double_complex);
-    static CYTHON_INLINE int __Pyx_c_is_zero_double(__pyx_t_double_complex);
-    static CYTHON_INLINE __pyx_t_double_complex __Pyx_c_conj_double(__pyx_t_double_complex);
-    #if 1
-        static CYTHON_INLINE double __Pyx_c_abs_double(__pyx_t_double_complex);
-        static CYTHON_INLINE __pyx_t_double_complex __Pyx_c_pow_double(__pyx_t_double_complex, __pyx_t_double_complex);
-    #endif
-#endif
+/* GetAttr.proto */
+static CYTHON_INLINE PyObject *__Pyx_GetAttr(PyObject *, PyObject *);
 
-/* CIntFromPy.proto */
-static CYTHON_INLINE size_t __Pyx_PyInt_As_size_t(PyObject *);
+/* Globals.proto */
+static PyObject* __Pyx_Globals(void);
 
-/* CIntFromPy.proto */
-static CYTHON_INLINE lua_Integer __Pyx_PyInt_As_lua_Integer(PyObject *);
+/* FormatTypeName.proto */
+#if CYTHON_COMPILING_IN_LIMITED_API
+typedef PyObject *__Pyx_TypeName;
+#define __Pyx_FMT_TYPENAME "%U"
+static __Pyx_TypeName __Pyx_PyType_GetName(PyTypeObject* tp);
+#define __Pyx_DECREF_TypeName(obj) Py_XDECREF(obj)
+#else
+typedef const char *__Pyx_TypeName;
+#define __Pyx_FMT_TYPENAME "%.200s"
+#define __Pyx_PyType_GetName(tp) ((tp)->tp_name)
+#define __Pyx_DECREF_TypeName(obj)
+#endif
 
-/* CIntFromPy.proto */
-static CYTHON_INLINE int __Pyx_PyInt_As_int(PyObject *);
+/* CIntToPy.proto */
+static CYTHON_INLINE PyObject* __Pyx_PyInt_From_long(long value);
 
 /* CIntFromPy.proto */
 static CYTHON_INLINE long __Pyx_PyInt_As_long(PyObject *);
 
 /* FastTypeChecks.proto */
 #if CYTHON_COMPILING_IN_CPYTHON
 #define __Pyx_TypeCheck(obj, type) __Pyx_IsSubtype(Py_TYPE(obj), (PyTypeObject *)type)
+#define __Pyx_TypeCheck2(obj, type1, type2) __Pyx_IsAnySubtype2(Py_TYPE(obj), (PyTypeObject *)type1, (PyTypeObject *)type2)
 static CYTHON_INLINE int __Pyx_IsSubtype(PyTypeObject *a, PyTypeObject *b);
+static CYTHON_INLINE int __Pyx_IsAnySubtype2(PyTypeObject *cls, PyTypeObject *a, PyTypeObject *b);
 static CYTHON_INLINE int __Pyx_PyErr_GivenExceptionMatches(PyObject *err, PyObject *type);
 static CYTHON_INLINE int __Pyx_PyErr_GivenExceptionMatches2(PyObject *err, PyObject *type1, PyObject *type2);
 #else
 #define __Pyx_TypeCheck(obj, type) PyObject_TypeCheck(obj, (PyTypeObject *)type)
+#define __Pyx_TypeCheck2(obj, type1, type2) (PyObject_TypeCheck(obj, (PyTypeObject *)type1) || PyObject_TypeCheck(obj, (PyTypeObject *)type2))
 #define __Pyx_PyErr_GivenExceptionMatches(err, type) PyErr_GivenExceptionMatches(err, type)
 #define __Pyx_PyErr_GivenExceptionMatches2(err, type1, type2) (PyErr_GivenExceptionMatches(err, type1) || PyErr_GivenExceptionMatches(err, type2))
 #endif
+#define __Pyx_PyErr_ExceptionMatches2(err1, err2)  __Pyx_PyErr_GivenExceptionMatches2(__Pyx_PyErr_CurrentExceptionType(), err1, err2)
 #define __Pyx_PyException_Check(obj) __Pyx_TypeCheck(obj, PyExc_Exception)
 
 /* CheckBinaryVersion.proto */
 static int __Pyx_check_binary_version(void);
 
 /* InitStrings.proto */
 static int __Pyx_InitStrings(__Pyx_StringTabEntry *t);
 
+/* #### Code section: module_declarations ### */
 
-/* Module declarations from 'libc.string' */
-
-/* Module declarations from 'cpython.pycapsule' */
-
-/* Module declarations from 'cpython.unicode' */
-
-/* Module declarations from 'libc.stdio' */
-
-/* Module declarations from '__builtin__' */
+/* Module declarations from "cpython.pycapsule" */
 
-/* Module declarations from 'cpython.type' */
-static PyTypeObject *__pyx_ptype_7cpython_4type_type = 0;
+/* Module declarations from "cpython.unicode" */
 
-/* Module declarations from 'cpython.buffer' */
+/* Module declarations from "libc.string" */
 
-/* Module declarations from 'cpython' */
+/* Module declarations from "libc.stdio" */
 
-/* Module declarations from 'cpython.object' */
+/* Module declarations from "__builtin__" */
 
-/* Module declarations from 'cpython.bytes' */
+/* Module declarations from "cpython.type" */
 
-/* Module declarations from 'cpython.memoryview' */
+/* Module declarations from "cpython" */
 
-/* Module declarations from 'cpython.bytearray' */
+/* Module declarations from "cpython.object" */
 
-/* Module declarations from 'cpython.ref' */
+/* Module declarations from "cpython.bytes" */
 
-/* Module declarations from 'cpython.mem' */
+/* Module declarations from "cpython.ref" */
 
-/* Module declarations from 'numpy' */
+/* Module declarations from "skynet_py" */
 
-/* Module declarations from 'numpy' */
-static PyTypeObject *__pyx_ptype_5numpy_dtype = 0;
-static PyTypeObject *__pyx_ptype_5numpy_flatiter = 0;
-static PyTypeObject *__pyx_ptype_5numpy_broadcast = 0;
-static PyTypeObject *__pyx_ptype_5numpy_ndarray = 0;
-static PyTypeObject *__pyx_ptype_5numpy_ufunc = 0;
-static CYTHON_INLINE int __pyx_f_5numpy_import_array(void); /*proto*/
+/* Module declarations from "pyskynet.skynet_py_mq" */
+static void __pyx_f_8pyskynet_12skynet_py_mq_free_pyptr(PyObject *); /*proto*/
+/* #### Code section: typeinfo ### */
+/* #### Code section: before_global_var ### */
+#define __Pyx_MODULE_NAME "pyskynet.skynet_py_mq"
+extern int __pyx_module_is_main_pyskynet__skynet_py_mq;
+int __pyx_module_is_main_pyskynet__skynet_py_mq = 0;
 
-/* Module declarations from 'skynet_py' */
-
-/* Module declarations from 'pyskynet.skynet_py_foreign_seri' */
-static double __pyx_f_8pyskynet_22skynet_py_foreign_seri_py_get_real(struct foreign_read_block *); /*proto*/
-static lua_Integer __pyx_f_8pyskynet_22skynet_py_foreign_seri_py_get_integer(struct foreign_read_block *, int); /*proto*/
-static void *__pyx_f_8pyskynet_22skynet_py_foreign_seri_py_get_pointer(struct foreign_read_block *); /*proto*/
-static char *__pyx_f_8pyskynet_22skynet_py_foreign_seri_py_get_string(struct foreign_read_block *, int, int, size_t *); /*proto*/
-static void __pyx_f_8pyskynet_22skynet_py_foreign_seri_py_push_value(PyObject *, struct foreign_read_block *, int, int, int); /*proto*/
-static void __pyx_f_8pyskynet_22skynet_py_foreign_seri_py_unpack_one(PyObject *, struct foreign_read_block *, int); /*proto*/
-static void __pyx_f_8pyskynet_22skynet_py_foreign_seri_py_unpack_table(PyObject *, struct foreign_read_block *, int); /*proto*/
-static void __pyx_f_8pyskynet_22skynet_py_foreign_seri_cunpack(PyObject *, char *, size_t, int); /*proto*/
-static PyObject *__pyx_f_8pyskynet_22skynet_py_foreign_seri_py_foreign_unpack(int, PyObject *, PyObject *); /*proto*/
-static void __pyx_f_8pyskynet_22skynet_py_foreign_seri_py_pack_list(struct foreign_write_block *, PyObject *, int); /*proto*/
-static void __pyx_f_8pyskynet_22skynet_py_foreign_seri_py_pack_dict(struct foreign_write_block *, PyObject *, int); /*proto*/
-static void __pyx_f_8pyskynet_22skynet_py_foreign_seri_py_pack_one(struct foreign_write_block *, PyObject *, int); /*proto*/
-static PyObject *__pyx_f_8pyskynet_22skynet_py_foreign_seri_py_foreign_pack(int, PyObject *); /*proto*/
-#define __Pyx_MODULE_NAME "pyskynet.skynet_py_foreign_seri"
-extern int __pyx_module_is_main_pyskynet__skynet_py_foreign_seri;
-int __pyx_module_is_main_pyskynet__skynet_py_foreign_seri = 0;
-
-/* Implementation of 'pyskynet.skynet_py_foreign_seri' */
-static PyObject *__pyx_builtin_range;
-static PyObject *__pyx_builtin_enumerate;
-static PyObject *__pyx_builtin_ImportError;
-static const char __pyx_k_np[] = "np";
-static const char __pyx_k_sz[] = "sz";
-static const char __pyx_k_pop[] = "pop";
+/* Implementation of "pyskynet.skynet_py_mq" */
+/* #### Code section: global_var ### */
+static PyObject *__pyx_builtin_object;
+static PyObject *__pyx_builtin_AssertionError;
+/* #### Code section: string_decls ### */
+static const char __pyx_k_b[] = "b";
+static const char __pyx_k_s[] = "s";
+static const char __pyx_k__2[] = "";
+static const char __pyx_k_id[] = "id";
+static const char __pyx_k__20[] = "?";
+static const char __pyx_k_doc[] = "__doc__";
+static const char __pyx_k_dst[] = "dst";
+static const char __pyx_k_key[] = "key";
+static const char __pyx_k_msg[] = "msg";
 static const char __pyx_k_ptr[] = "ptr";
-static const char __pyx_k_args[] = "args";
-static const char __pyx_k_char[] = "char";
-static const char __pyx_k_flat[] = "flat";
+static const char __pyx_k_ret[] = "ret";
+static const char __pyx_k_dict[] = "__dict__";
+static const char __pyx_k_init[] = "__init__";
 static const char __pyx_k_main[] = "__main__";
-static const char __pyx_k_name[] = "__name__";
-static const char __pyx_k_pack[] = "pack";
+static const char __pyx_k_name[] = "name";
+static const char __pyx_k_self[] = "self";
 static const char __pyx_k_size[] = "size";
 static const char __pyx_k_test[] = "__test__";
-static const char __pyx_k_dtype[] = "dtype";
+static const char __pyx_k_crecv[] = "crecv";
+static const char __pyx_k_csend[] = "csend";
 static const char __pyx_k_items[] = "items";
-static const char __pyx_k_numpy[] = "numpy";
-static const char __pyx_k_range[] = "range";
-static const char __pyx_k_trash[] = "trash";
-static const char __pyx_k_append[] = "append";
-static const char __pyx_k_import[] = "__import__";
-static const char __pyx_k_unpack[] = "unpack";
+static const char __pyx_k_lower[] = "lower";
+static const char __pyx_k_super[] = "super";
+static const char __pyx_k_decode[] = "decode";
+static const char __pyx_k_module[] = "__module__";
+static const char __pyx_k_name_2[] = "__name__";
+static const char __pyx_k_object[] = "object";
+static const char __pyx_k_py_dst[] = "py_dst";
+static const char __pyx_k_py_msg[] = "py_msg";
 static const char __pyx_k_capsule[] = "capsule";
-static const char __pyx_k_integer[] = "integer";
-static const char __pyx_k_luapack[] = "luapack";
+static const char __pyx_k_dstname[] = "dstname";
+static const char __pyx_k_prepare[] = "__prepare__";
+static const char __pyx_k_py_size[] = "py_size";
+static const char __pyx_k_session[] = "session";
 static const char __pyx_k_tobytes[] = "tobytes";
-static const char __pyx_k_floating[] = "floating";
-static const char __pyx_k_enumerate[] = "enumerate";
-static const char __pyx_k_luaunpack[] = "luaunpack";
-static const char __pyx_k_issubdtype[] = "issubdtype";
-static const char __pyx_k_remotepack[] = "remotepack";
-static const char __pyx_k_ImportError[] = "ImportError";
-static const char __pyx_k_remoteunpack[] = "remoteunpack";
-static const char __pyx_k_invalid_stream[] = "invalid stream";
-static const char __pyx_k_Unexcept_type_s[] = "Unexcept type %s ";
+static const char __pyx_k_type_id[] = "type_id";
+static const char __pyx_k_qualname[] = "__qualname__";
+static const char __pyx_k_set_name[] = "__set_name__";
+static const char __pyx_k_tostring[] = "tostring";
+static const char __pyx_k_PTYPEEnum[] = "PTYPEEnum";
+static const char __pyx_k_PTYPE_LUA[] = "PTYPE_LUA";
+static const char __pyx_k_metaclass[] = "__metaclass__";
+static const char __pyx_k_PTYPE_SNAX[] = "PTYPE_SNAX";
+static const char __pyx_k_PTYPE_TEXT[] = "PTYPE_TEXT";
+static const char __pyx_k_is_builtin[] = "is_builtin";
+static const char __pyx_k_py_session[] = "py_session";
+static const char __pyx_k_PTYPE_DEBUG[] = "PTYPE_DEBUG";
+static const char __pyx_k_PTYPE_ERROR[] = "PTYPE_ERROR";
+static const char __pyx_k_PTYPE_QUEUE[] = "PTYPE_QUEUE";
+static const char __pyx_k_PTYPE_TRACE[] = "PTYPE_TRACE";
+static const char __pyx_k_mro_entries[] = "__mro_entries__";
+static const char __pyx_k_PTYPE_CLIENT[] = "PTYPE_CLIENT";
+static const char __pyx_k_PTYPE_HARBOR[] = "PTYPE_HARBOR";
+static const char __pyx_k_PTYPE_SOCKET[] = "PTYPE_SOCKET";
+static const char __pyx_k_PTYPE_SYSTEM[] = "PTYPE_SYSTEM";
+static const char __pyx_k_SKYNET_PTYPE[] = "SKYNET_PTYPE";
+static const char __pyx_k_is_coroutine[] = "_is_coroutine";
+static const char __pyx_k_must_bind_id[] = " must bind id=";
+static const char __pyx_k_py_dst_bytes[] = "py_dst_bytes";
+static const char __pyx_k_py_msg_bytes[] = "py_msg_bytes";
+static const char __pyx_k_PTYPE_FOREIGN[] = "PTYPE_FOREIGN";
+static const char __pyx_k_class_getitem[] = "__class_getitem__";
+static const char __pyx_k_init_subclass[] = "__init_subclass__";
+static const char __pyx_k_AssertionError[] = "AssertionError";
+static const char __pyx_k_PTYPE_RESPONSE[] = "PTYPE_RESPONSE";
+static const char __pyx_k_must_bind_name[] = " must bind name=";
+static const char __pyx_k_PTYPE_MULTICAST[] = "PTYPE_MULTICAST";
+static const char __pyx_k_PTYPEEnum___init[] = "PTYPEEnum.__init__";
+static const char __pyx_k_PTYPE_TAG_DONTCOPY[] = "PTYPE_TAG_DONTCOPY";
+static const char __pyx_k_asyncio_coroutines[] = "asyncio.coroutines";
 static const char __pyx_k_cline_in_traceback[] = "cline_in_traceback";
-static const char __pyx_k_unexception_capsule[] = "unexception capsule";
-static const char __pyx_k_unexception_typechar_s[] = "unexception typechar %s";
-static const char __pyx_k_Unsupport_type_s_to_serialize[] = "Unsupport type %s to serialize";
-static const char __pyx_k_numpy_core_multiarray_failed_to[] = "numpy.core.multiarray failed to import";
-static const char __pyx_k_pyskynet_skynet_py_foreign_seri[] = "pyskynet.skynet_py_foreign_seri";
-static const char __pyx_k_capsule_unpack_failed_for_name_s[] = "capsule unpack failed for name = %s ";
-static const char __pyx_k_invalid_stream_for_value_type_ex[] = "invalid stream for value type exception";
-static const char __pyx_k_invalid_stream_when_unpacking_ar[] = "invalid stream when unpacking arr";
-static const char __pyx_k_numpy_core_umath_failed_to_impor[] = "numpy.core.umath failed to import";
-static const char __pyx_k_seri_wb_foreign_unexception_mode[] = "seri wb foreign unexception mode";
-static const char __pyx_k_serialize_can_t_pack_too_depth_t[] = "serialize can't pack too depth table";
-static const char __pyx_k_src_cy_src_skynet_py_foreign_ser[] = "src/cy_src/skynet_py_foreign_seri.pyx";
-static PyObject *__pyx_n_s_ImportError;
-static PyObject *__pyx_kp_u_Unexcept_type_s;
-static PyObject *__pyx_kp_u_Unsupport_type_s_to_serialize;
-static PyObject *__pyx_n_s_append;
-static PyObject *__pyx_n_s_args;
-static PyObject *__pyx_n_s_capsule;
-static PyObject *__pyx_kp_u_capsule_unpack_failed_for_name_s;
-static PyObject *__pyx_n_s_char;
-static PyObject *__pyx_n_s_cline_in_traceback;
-static PyObject *__pyx_n_s_dtype;
-static PyObject *__pyx_n_s_enumerate;
-static PyObject *__pyx_n_s_flat;
-static PyObject *__pyx_n_s_floating;
-static PyObject *__pyx_n_s_import;
-static PyObject *__pyx_n_s_integer;
-static PyObject *__pyx_kp_u_invalid_stream;
-static PyObject *__pyx_kp_u_invalid_stream_for_value_type_ex;
-static PyObject *__pyx_kp_u_invalid_stream_when_unpacking_ar;
-static PyObject *__pyx_n_s_issubdtype;
-static PyObject *__pyx_n_s_items;
-static PyObject *__pyx_n_s_luapack;
-static PyObject *__pyx_n_s_luaunpack;
-static PyObject *__pyx_n_s_main;
-static PyObject *__pyx_n_s_name;
-static PyObject *__pyx_n_s_np;
-static PyObject *__pyx_n_s_numpy;
-static PyObject *__pyx_kp_u_numpy_core_multiarray_failed_to;
-static PyObject *__pyx_kp_u_numpy_core_umath_failed_to_impor;
-static PyObject *__pyx_n_s_pack;
-static PyObject *__pyx_n_s_pop;
-static PyObject *__pyx_n_s_ptr;
-static PyObject *__pyx_n_s_pyskynet_skynet_py_foreign_seri;
-static PyObject *__pyx_n_s_range;
-static PyObject *__pyx_n_s_remotepack;
-static PyObject *__pyx_n_s_remoteunpack;
-static PyObject *__pyx_kp_u_seri_wb_foreign_unexception_mode;
-static PyObject *__pyx_kp_u_serialize_can_t_pack_too_depth_t;
-static PyObject *__pyx_n_s_size;
-static PyObject *__pyx_kp_s_src_cy_src_skynet_py_foreign_ser;
-static PyObject *__pyx_n_s_sz;
-static PyObject *__pyx_n_s_test;
-static PyObject *__pyx_n_s_tobytes;
-static PyObject *__pyx_n_s_trash;
-static PyObject *__pyx_kp_u_unexception_capsule;
-static PyObject *__pyx_kp_u_unexception_typechar_s;
-static PyObject *__pyx_n_s_unpack;
-static PyObject *__pyx_pf_8pyskynet_22skynet_py_foreign_seri_tobytes(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_capsule, size_t __pyx_v_size); /* proto */
-static PyObject *__pyx_pf_8pyskynet_22skynet_py_foreign_seri_2luapack(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_args); /* proto */
-static PyObject *__pyx_pf_8pyskynet_22skynet_py_foreign_seri_4luaunpack(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_capsule, PyObject *__pyx_v_size); /* proto */
-static PyObject *__pyx_pf_8pyskynet_22skynet_py_foreign_seri_6pack(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_args); /* proto */
-static PyObject *__pyx_pf_8pyskynet_22skynet_py_foreign_seri_8unpack(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_capsule, PyObject *__pyx_v_size); /* proto */
-static PyObject *__pyx_pf_8pyskynet_22skynet_py_foreign_seri_10remotepack(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_args); /* proto */
-static PyObject *__pyx_pf_8pyskynet_22skynet_py_foreign_seri_12remoteunpack(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_capsule, PyObject *__pyx_v_size); /* proto */
-static PyObject *__pyx_pf_8pyskynet_22skynet_py_foreign_seri_14trash(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_capsule, CYTHON_UNUSED size_t __pyx_v_sz); /* proto */
-static __Pyx_CachedCFunction __pyx_umethod_PyList_Type_pop = {0, &__pyx_n_s_pop, 0, 0, 0};
-static PyObject *__pyx_int_0;
-static PyObject *__pyx_int_1;
-static PyObject *__pyx_tuple_;
-static PyObject *__pyx_tuple__2;
-static PyObject *__pyx_tuple__3;
-static PyObject *__pyx_tuple__4;
-static PyObject *__pyx_tuple__5;
-static PyObject *__pyx_tuple__6;
-static PyObject *__pyx_tuple__7;
-static PyObject *__pyx_tuple__8;
-static PyObject *__pyx_tuple__9;
-static PyObject *__pyx_tuple__11;
-static PyObject *__pyx_tuple__13;
-static PyObject *__pyx_tuple__15;
-static PyObject *__pyx_tuple__17;
-static PyObject *__pyx_tuple__19;
-static PyObject *__pyx_tuple__21;
-static PyObject *__pyx_tuple__23;
-static PyObject *__pyx_codeobj__10;
-static PyObject *__pyx_codeobj__12;
-static PyObject *__pyx_codeobj__14;
-static PyObject *__pyx_codeobj__16;
-static PyObject *__pyx_codeobj__18;
-static PyObject *__pyx_codeobj__20;
-static PyObject *__pyx_codeobj__22;
-static PyObject *__pyx_codeobj__24;
-/* Late includes */
-
-/* "src/cy_src/skynet_py_foreign_seri.pyx":85
- * ########################
- * 
- * cdef double py_get_real(foreign_read_block* rb) except *:             # <<<<<<<<<<<<<<
- *     cdef double n_double
- *     cdef void * ptr
- */
-
-static double __pyx_f_8pyskynet_22skynet_py_foreign_seri_py_get_real(struct foreign_read_block *__pyx_v_rb) {
-  double __pyx_v_n_double;
-  void *__pyx_v_ptr;
-  double __pyx_r;
-  __Pyx_RefNannyDeclarations
-  int __pyx_t_1;
-  PyObject *__pyx_t_2 = NULL;
-  int __pyx_lineno = 0;
-  const char *__pyx_filename = NULL;
-  int __pyx_clineno = 0;
-  __Pyx_RefNannySetupContext("py_get_real", 0);
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":88
- *     cdef double n_double
- *     cdef void * ptr
- *     ptr = foreign_rb_read(rb, sizeof(n_double))             # <<<<<<<<<<<<<<
- *     if(ptr==NULL):
- *         raise Exception("invalid stream")
- */
-  __pyx_v_ptr = foreign_rb_read(__pyx_v_rb, (sizeof(__pyx_v_n_double)));
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":89
- *     cdef void * ptr
- *     ptr = foreign_rb_read(rb, sizeof(n_double))
- *     if(ptr==NULL):             # <<<<<<<<<<<<<<
- *         raise Exception("invalid stream")
- *     memcpy(&n_double, ptr, sizeof(n_double));
- */
-  __pyx_t_1 = ((__pyx_v_ptr == NULL) != 0);
-  if (unlikely(__pyx_t_1)) {
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":90
- *     ptr = foreign_rb_read(rb, sizeof(n_double))
- *     if(ptr==NULL):
- *         raise Exception("invalid stream")             # <<<<<<<<<<<<<<
- *     memcpy(&n_double, ptr, sizeof(n_double));
- *     return n_double
- */
-    __pyx_t_2 = __Pyx_PyObject_Call(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])), __pyx_tuple_, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 90, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_2);
-    __Pyx_Raise(__pyx_t_2, 0, 0, 0);
-    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __PYX_ERR(0, 90, __pyx_L1_error)
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":89
- *     cdef void * ptr
- *     ptr = foreign_rb_read(rb, sizeof(n_double))
- *     if(ptr==NULL):             # <<<<<<<<<<<<<<
- *         raise Exception("invalid stream")
- *     memcpy(&n_double, ptr, sizeof(n_double));
- */
-  }
+static const char __pyx_k_user_assert_id_name[] = "user_assert_id_name";
+static const char __pyx_k_PTYPE_FOREIGN_REMOTE[] = "PTYPE_FOREIGN_REMOTE";
+static const char __pyx_k_skynet_proto_type_id[] = "skynet proto type id=";
+static const char __pyx_k_pyskynet_skynet_py_mq[] = "pyskynet.skynet_py_mq";
+static const char __pyx_k_PTYPE_TAG_ALLOCSESSION[] = "PTYPE_TAG_ALLOCSESSION";
+static const char __pyx_k_package_is_too_large_s[] = "package is too large:%s";
+static const char __pyx_k_skynet_proto_type_name[] = "skynet proto type name=";
+static const char __pyx_k_SKYNET_PTYPE_id_to_name[] = "SKYNET_PTYPE_id_to_name";
+static const char __pyx_k_SKYNET_PTYPE_name_to_id[] = "SKYNET_PTYPE_name_to_id";
+static const char __pyx_k_src_cy_src_skynet_py_mq_pyx[] = "src/cy_src/skynet_py_mq.pyx";
+static const char __pyx_k_SKYNET_PTYPE_user_builtin_ids[] = "SKYNET_PTYPE_user_builtin_ids";
+static const char __pyx_k_capsule_unpack_failed_for_name_s[] = "capsule unpack failed for name = %s";
+static const char __pyx_k_skynet_proto_can_only_register_b[] = "skynet proto can only register builtin proto 'lua' or 'client' or 'socket' or 'text' or 'foreign' or 'foreign_remote', but get name=%s";
+static const char __pyx_k_skynet_proto_type_id_must_be_les[] = "skynet proto type id must be less than 256 but get id=%s";
+static const char __pyx_k_skynet_threads_has_not_been_star[] = "skynet threads has not been started yet, call 'pyskynet.start()' first.";
+static const char __pyx_k_type_s_unexcept_when_skynet_csen[] = "type:%s unexcept when skynet csend";
+/* #### Code section: decls ### */
+static PyObject *__pyx_pf_8pyskynet_12skynet_py_mq_crecv(CYTHON_UNUSED PyObject *__pyx_self); /* proto */
+static PyObject *__pyx_pf_8pyskynet_12skynet_py_mq_2csend(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_py_dst, int __pyx_v_type_id, PyObject *__pyx_v_py_session, PyObject *__pyx_v_py_msg, PyObject *__pyx_v_py_size); /* proto */
+static PyObject *__pyx_pf_8pyskynet_12skynet_py_mq_4tostring(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_capsule, size_t __pyx_v_size); /* proto */
+static PyObject *__pyx_pf_8pyskynet_12skynet_py_mq_6tobytes(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_capsule, size_t __pyx_v_size); /* proto */
+static PyObject *__pyx_pf_8pyskynet_12skynet_py_mq_9PTYPEEnum___init__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self); /* proto */
+static PyObject *__pyx_pf_8pyskynet_12skynet_py_mq_8user_assert_id_name(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_id, PyObject *__pyx_v_name); /* proto */
+/* #### Code section: late_includes ### */
+/* #### Code section: module_state ### */
+typedef struct {
+  PyObject *__pyx_d;
+  PyObject *__pyx_b;
+  PyObject *__pyx_cython_runtime;
+  PyObject *__pyx_empty_tuple;
+  PyObject *__pyx_empty_bytes;
+  PyObject *__pyx_empty_unicode;
+  #ifdef __Pyx_CyFunction_USED
+  PyTypeObject *__pyx_CyFunctionType;
+  #endif
+  #ifdef __Pyx_FusedFunction_USED
+  PyTypeObject *__pyx_FusedFunctionType;
+  #endif
+  #ifdef __Pyx_Generator_USED
+  PyTypeObject *__pyx_GeneratorType;
+  #endif
+  #ifdef __Pyx_IterableCoroutine_USED
+  PyTypeObject *__pyx_IterableCoroutineType;
+  #endif
+  #ifdef __Pyx_Coroutine_USED
+  PyTypeObject *__pyx_CoroutineAwaitType;
+  #endif
+  #ifdef __Pyx_Coroutine_USED
+  PyTypeObject *__pyx_CoroutineType;
+  #endif
+  #if CYTHON_USE_MODULE_STATE
+  #endif
+  #if CYTHON_USE_MODULE_STATE
+  #endif
+  #if CYTHON_USE_MODULE_STATE
+  #endif
+  #if CYTHON_USE_MODULE_STATE
+  #endif
+  #if CYTHON_USE_MODULE_STATE
+  #endif
+  #if CYTHON_USE_MODULE_STATE
+  #endif
+  PyTypeObject *__pyx_ptype_7cpython_4type_type;
+  #if CYTHON_USE_MODULE_STATE
+  #endif
+  #if CYTHON_USE_MODULE_STATE
+  #endif
+  #if CYTHON_USE_MODULE_STATE
+  #endif
+  #if CYTHON_USE_MODULE_STATE
+  #endif
+  #if CYTHON_USE_MODULE_STATE
+  #endif
+  #if CYTHON_USE_MODULE_STATE
+  #endif
+  PyObject *__pyx_n_s_AssertionError;
+  PyObject *__pyx_n_s_PTYPEEnum;
+  PyObject *__pyx_n_s_PTYPEEnum___init;
+  PyObject *__pyx_n_s_PTYPE_CLIENT;
+  PyObject *__pyx_n_s_PTYPE_DEBUG;
+  PyObject *__pyx_n_s_PTYPE_ERROR;
+  PyObject *__pyx_n_s_PTYPE_FOREIGN;
+  PyObject *__pyx_n_s_PTYPE_FOREIGN_REMOTE;
+  PyObject *__pyx_n_s_PTYPE_HARBOR;
+  PyObject *__pyx_n_s_PTYPE_LUA;
+  PyObject *__pyx_n_s_PTYPE_MULTICAST;
+  PyObject *__pyx_n_s_PTYPE_QUEUE;
+  PyObject *__pyx_n_s_PTYPE_RESPONSE;
+  PyObject *__pyx_n_s_PTYPE_SNAX;
+  PyObject *__pyx_n_s_PTYPE_SOCKET;
+  PyObject *__pyx_n_s_PTYPE_SYSTEM;
+  PyObject *__pyx_n_s_PTYPE_TAG_ALLOCSESSION;
+  PyObject *__pyx_n_s_PTYPE_TAG_DONTCOPY;
+  PyObject *__pyx_n_s_PTYPE_TEXT;
+  PyObject *__pyx_n_s_PTYPE_TRACE;
+  PyObject *__pyx_n_s_SKYNET_PTYPE;
+  PyObject *__pyx_n_s_SKYNET_PTYPE_id_to_name;
+  PyObject *__pyx_n_s_SKYNET_PTYPE_name_to_id;
+  PyObject *__pyx_n_s_SKYNET_PTYPE_user_builtin_ids;
+  PyObject *__pyx_kp_b__2;
+  PyObject *__pyx_n_s__20;
+  PyObject *__pyx_n_s_asyncio_coroutines;
+  PyObject *__pyx_n_s_b;
+  PyObject *__pyx_n_s_capsule;
+  PyObject *__pyx_kp_u_capsule_unpack_failed_for_name_s;
+  PyObject *__pyx_n_s_class_getitem;
+  PyObject *__pyx_n_s_cline_in_traceback;
+  PyObject *__pyx_n_s_crecv;
+  PyObject *__pyx_n_s_csend;
+  PyObject *__pyx_n_s_decode;
+  PyObject *__pyx_n_s_dict;
+  PyObject *__pyx_n_s_doc;
+  PyObject *__pyx_n_s_dst;
+  PyObject *__pyx_n_s_dstname;
+  PyObject *__pyx_n_s_id;
+  PyObject *__pyx_n_s_init;
+  PyObject *__pyx_n_s_init_subclass;
+  PyObject *__pyx_n_s_is_builtin;
+  PyObject *__pyx_n_s_is_coroutine;
+  PyObject *__pyx_n_s_items;
+  PyObject *__pyx_n_s_key;
+  PyObject *__pyx_n_s_lower;
+  PyObject *__pyx_n_s_main;
+  PyObject *__pyx_n_s_metaclass;
+  PyObject *__pyx_n_s_module;
+  PyObject *__pyx_n_s_mro_entries;
+  PyObject *__pyx_n_s_msg;
+  PyObject *__pyx_kp_u_must_bind_id;
+  PyObject *__pyx_kp_u_must_bind_name;
+  PyObject *__pyx_n_s_name;
+  PyObject *__pyx_n_s_name_2;
+  PyObject *__pyx_n_s_object;
+  PyObject *__pyx_kp_u_package_is_too_large_s;
+  PyObject *__pyx_n_s_prepare;
+  PyObject *__pyx_n_s_ptr;
+  PyObject *__pyx_n_s_py_dst;
+  PyObject *__pyx_n_s_py_dst_bytes;
+  PyObject *__pyx_n_s_py_msg;
+  PyObject *__pyx_n_s_py_msg_bytes;
+  PyObject *__pyx_n_s_py_session;
+  PyObject *__pyx_n_s_py_size;
+  PyObject *__pyx_n_s_pyskynet_skynet_py_mq;
+  PyObject *__pyx_n_s_qualname;
+  PyObject *__pyx_n_s_ret;
+  PyObject *__pyx_n_s_s;
+  PyObject *__pyx_n_s_self;
+  PyObject *__pyx_n_s_session;
+  PyObject *__pyx_n_s_set_name;
+  PyObject *__pyx_n_s_size;
+  PyObject *__pyx_kp_u_skynet_proto_can_only_register_b;
+  PyObject *__pyx_kp_u_skynet_proto_type_id;
+  PyObject *__pyx_kp_u_skynet_proto_type_id_must_be_les;
+  PyObject *__pyx_kp_u_skynet_proto_type_name;
+  PyObject *__pyx_kp_u_skynet_threads_has_not_been_star;
+  PyObject *__pyx_kp_s_src_cy_src_skynet_py_mq_pyx;
+  PyObject *__pyx_n_s_super;
+  PyObject *__pyx_n_s_test;
+  PyObject *__pyx_n_s_tobytes;
+  PyObject *__pyx_n_s_tostring;
+  PyObject *__pyx_n_s_type_id;
+  PyObject *__pyx_kp_u_type_s_unexcept_when_skynet_csen;
+  PyObject *__pyx_n_s_user_assert_id_name;
+  PyObject *__pyx_int_0;
+  PyObject *__pyx_int_6;
+  PyObject *__pyx_int_12;
+  PyObject *__pyx_int_255;
+  PyObject *__pyx_tuple_;
+  PyObject *__pyx_tuple__3;
+  PyObject *__pyx_tuple__4;
+  PyObject *__pyx_tuple__6;
+  PyObject *__pyx_tuple__8;
+  PyObject *__pyx_tuple__9;
+  PyObject *__pyx_slice__17;
+  PyObject *__pyx_tuple__11;
+  PyObject *__pyx_tuple__13;
+  PyObject *__pyx_tuple__14;
+  PyObject *__pyx_tuple__15;
+  PyObject *__pyx_tuple__18;
+  PyObject *__pyx_codeobj__5;
+  PyObject *__pyx_codeobj__7;
+  PyObject *__pyx_codeobj__10;
+  PyObject *__pyx_codeobj__12;
+  PyObject *__pyx_codeobj__16;
+  PyObject *__pyx_codeobj__19;
+} __pyx_mstate;
 
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":91
- *     if(ptr==NULL):
- *         raise Exception("invalid stream")
- *     memcpy(&n_double, ptr, sizeof(n_double));             # <<<<<<<<<<<<<<
- *     return n_double
- * 
- */
-  (void)(memcpy((&__pyx_v_n_double), __pyx_v_ptr, (sizeof(__pyx_v_n_double))));
+#if CYTHON_USE_MODULE_STATE
+#ifdef __cplusplus
+namespace {
+  extern struct PyModuleDef __pyx_moduledef;
+} /* anonymous namespace */
+#else
+static struct PyModuleDef __pyx_moduledef;
+#endif
 
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":92
- *         raise Exception("invalid stream")
- *     memcpy(&n_double, ptr, sizeof(n_double));
- *     return n_double             # <<<<<<<<<<<<<<
- * 
- * cdef lua_Integer py_get_integer(foreign_read_block* rb, int cookie) except *:
- */
-  __pyx_r = __pyx_v_n_double;
-  goto __pyx_L0;
+#define __pyx_mstate(o) ((__pyx_mstate *)__Pyx_PyModule_GetState(o))
 
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":85
- * ########################
- * 
- * cdef double py_get_real(foreign_read_block* rb) except *:             # <<<<<<<<<<<<<<
- *     cdef double n_double
- *     cdef void * ptr
- */
+#define __pyx_mstate_global (__pyx_mstate(PyState_FindModule(&__pyx_moduledef)))
 
-  /* function exit code */
-  __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_2);
-  __Pyx_AddTraceback("pyskynet.skynet_py_foreign_seri.py_get_real", __pyx_clineno, __pyx_lineno, __pyx_filename);
-  __pyx_r = -1;
-  __pyx_L0:;
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
+#define __pyx_m (PyState_FindModule(&__pyx_moduledef))
+#else
+static __pyx_mstate __pyx_mstate_global_static =
+#ifdef __cplusplus
+    {};
+#else
+    {0};
+#endif
+static __pyx_mstate *__pyx_mstate_global = &__pyx_mstate_global_static;
+#endif
+/* #### Code section: module_state_clear ### */
+#if CYTHON_USE_MODULE_STATE
+static int __pyx_m_clear(PyObject *m) {
+  __pyx_mstate *clear_module_state = __pyx_mstate(m);
+  if (!clear_module_state) return 0;
+  Py_CLEAR(clear_module_state->__pyx_d);
+  Py_CLEAR(clear_module_state->__pyx_b);
+  Py_CLEAR(clear_module_state->__pyx_cython_runtime);
+  Py_CLEAR(clear_module_state->__pyx_empty_tuple);
+  Py_CLEAR(clear_module_state->__pyx_empty_bytes);
+  Py_CLEAR(clear_module_state->__pyx_empty_unicode);
+  #ifdef __Pyx_CyFunction_USED
+  Py_CLEAR(clear_module_state->__pyx_CyFunctionType);
+  #endif
+  #ifdef __Pyx_FusedFunction_USED
+  Py_CLEAR(clear_module_state->__pyx_FusedFunctionType);
+  #endif
+  Py_CLEAR(clear_module_state->__pyx_ptype_7cpython_4type_type);
+  Py_CLEAR(clear_module_state->__pyx_n_s_AssertionError);
+  Py_CLEAR(clear_module_state->__pyx_n_s_PTYPEEnum);
+  Py_CLEAR(clear_module_state->__pyx_n_s_PTYPEEnum___init);
+  Py_CLEAR(clear_module_state->__pyx_n_s_PTYPE_CLIENT);
+  Py_CLEAR(clear_module_state->__pyx_n_s_PTYPE_DEBUG);
+  Py_CLEAR(clear_module_state->__pyx_n_s_PTYPE_ERROR);
+  Py_CLEAR(clear_module_state->__pyx_n_s_PTYPE_FOREIGN);
+  Py_CLEAR(clear_module_state->__pyx_n_s_PTYPE_FOREIGN_REMOTE);
+  Py_CLEAR(clear_module_state->__pyx_n_s_PTYPE_HARBOR);
+  Py_CLEAR(clear_module_state->__pyx_n_s_PTYPE_LUA);
+  Py_CLEAR(clear_module_state->__pyx_n_s_PTYPE_MULTICAST);
+  Py_CLEAR(clear_module_state->__pyx_n_s_PTYPE_QUEUE);
+  Py_CLEAR(clear_module_state->__pyx_n_s_PTYPE_RESPONSE);
+  Py_CLEAR(clear_module_state->__pyx_n_s_PTYPE_SNAX);
+  Py_CLEAR(clear_module_state->__pyx_n_s_PTYPE_SOCKET);
+  Py_CLEAR(clear_module_state->__pyx_n_s_PTYPE_SYSTEM);
+  Py_CLEAR(clear_module_state->__pyx_n_s_PTYPE_TAG_ALLOCSESSION);
+  Py_CLEAR(clear_module_state->__pyx_n_s_PTYPE_TAG_DONTCOPY);
+  Py_CLEAR(clear_module_state->__pyx_n_s_PTYPE_TEXT);
+  Py_CLEAR(clear_module_state->__pyx_n_s_PTYPE_TRACE);
+  Py_CLEAR(clear_module_state->__pyx_n_s_SKYNET_PTYPE);
+  Py_CLEAR(clear_module_state->__pyx_n_s_SKYNET_PTYPE_id_to_name);
+  Py_CLEAR(clear_module_state->__pyx_n_s_SKYNET_PTYPE_name_to_id);
+  Py_CLEAR(clear_module_state->__pyx_n_s_SKYNET_PTYPE_user_builtin_ids);
+  Py_CLEAR(clear_module_state->__pyx_kp_b__2);
+  Py_CLEAR(clear_module_state->__pyx_n_s__20);
+  Py_CLEAR(clear_module_state->__pyx_n_s_asyncio_coroutines);
+  Py_CLEAR(clear_module_state->__pyx_n_s_b);
+  Py_CLEAR(clear_module_state->__pyx_n_s_capsule);
+  Py_CLEAR(clear_module_state->__pyx_kp_u_capsule_unpack_failed_for_name_s);
+  Py_CLEAR(clear_module_state->__pyx_n_s_class_getitem);
+  Py_CLEAR(clear_module_state->__pyx_n_s_cline_in_traceback);
+  Py_CLEAR(clear_module_state->__pyx_n_s_crecv);
+  Py_CLEAR(clear_module_state->__pyx_n_s_csend);
+  Py_CLEAR(clear_module_state->__pyx_n_s_decode);
+  Py_CLEAR(clear_module_state->__pyx_n_s_dict);
+  Py_CLEAR(clear_module_state->__pyx_n_s_doc);
+  Py_CLEAR(clear_module_state->__pyx_n_s_dst);
+  Py_CLEAR(clear_module_state->__pyx_n_s_dstname);
+  Py_CLEAR(clear_module_state->__pyx_n_s_id);
+  Py_CLEAR(clear_module_state->__pyx_n_s_init);
+  Py_CLEAR(clear_module_state->__pyx_n_s_init_subclass);
+  Py_CLEAR(clear_module_state->__pyx_n_s_is_builtin);
+  Py_CLEAR(clear_module_state->__pyx_n_s_is_coroutine);
+  Py_CLEAR(clear_module_state->__pyx_n_s_items);
+  Py_CLEAR(clear_module_state->__pyx_n_s_key);
+  Py_CLEAR(clear_module_state->__pyx_n_s_lower);
+  Py_CLEAR(clear_module_state->__pyx_n_s_main);
+  Py_CLEAR(clear_module_state->__pyx_n_s_metaclass);
+  Py_CLEAR(clear_module_state->__pyx_n_s_module);
+  Py_CLEAR(clear_module_state->__pyx_n_s_mro_entries);
+  Py_CLEAR(clear_module_state->__pyx_n_s_msg);
+  Py_CLEAR(clear_module_state->__pyx_kp_u_must_bind_id);
+  Py_CLEAR(clear_module_state->__pyx_kp_u_must_bind_name);
+  Py_CLEAR(clear_module_state->__pyx_n_s_name);
+  Py_CLEAR(clear_module_state->__pyx_n_s_name_2);
+  Py_CLEAR(clear_module_state->__pyx_n_s_object);
+  Py_CLEAR(clear_module_state->__pyx_kp_u_package_is_too_large_s);
+  Py_CLEAR(clear_module_state->__pyx_n_s_prepare);
+  Py_CLEAR(clear_module_state->__pyx_n_s_ptr);
+  Py_CLEAR(clear_module_state->__pyx_n_s_py_dst);
+  Py_CLEAR(clear_module_state->__pyx_n_s_py_dst_bytes);
+  Py_CLEAR(clear_module_state->__pyx_n_s_py_msg);
+  Py_CLEAR(clear_module_state->__pyx_n_s_py_msg_bytes);
+  Py_CLEAR(clear_module_state->__pyx_n_s_py_session);
+  Py_CLEAR(clear_module_state->__pyx_n_s_py_size);
+  Py_CLEAR(clear_module_state->__pyx_n_s_pyskynet_skynet_py_mq);
+  Py_CLEAR(clear_module_state->__pyx_n_s_qualname);
+  Py_CLEAR(clear_module_state->__pyx_n_s_ret);
+  Py_CLEAR(clear_module_state->__pyx_n_s_s);
+  Py_CLEAR(clear_module_state->__pyx_n_s_self);
+  Py_CLEAR(clear_module_state->__pyx_n_s_session);
+  Py_CLEAR(clear_module_state->__pyx_n_s_set_name);
+  Py_CLEAR(clear_module_state->__pyx_n_s_size);
+  Py_CLEAR(clear_module_state->__pyx_kp_u_skynet_proto_can_only_register_b);
+  Py_CLEAR(clear_module_state->__pyx_kp_u_skynet_proto_type_id);
+  Py_CLEAR(clear_module_state->__pyx_kp_u_skynet_proto_type_id_must_be_les);
+  Py_CLEAR(clear_module_state->__pyx_kp_u_skynet_proto_type_name);
+  Py_CLEAR(clear_module_state->__pyx_kp_u_skynet_threads_has_not_been_star);
+  Py_CLEAR(clear_module_state->__pyx_kp_s_src_cy_src_skynet_py_mq_pyx);
+  Py_CLEAR(clear_module_state->__pyx_n_s_super);
+  Py_CLEAR(clear_module_state->__pyx_n_s_test);
+  Py_CLEAR(clear_module_state->__pyx_n_s_tobytes);
+  Py_CLEAR(clear_module_state->__pyx_n_s_tostring);
+  Py_CLEAR(clear_module_state->__pyx_n_s_type_id);
+  Py_CLEAR(clear_module_state->__pyx_kp_u_type_s_unexcept_when_skynet_csen);
+  Py_CLEAR(clear_module_state->__pyx_n_s_user_assert_id_name);
+  Py_CLEAR(clear_module_state->__pyx_int_0);
+  Py_CLEAR(clear_module_state->__pyx_int_6);
+  Py_CLEAR(clear_module_state->__pyx_int_12);
+  Py_CLEAR(clear_module_state->__pyx_int_255);
+  Py_CLEAR(clear_module_state->__pyx_tuple_);
+  Py_CLEAR(clear_module_state->__pyx_tuple__3);
+  Py_CLEAR(clear_module_state->__pyx_tuple__4);
+  Py_CLEAR(clear_module_state->__pyx_tuple__6);
+  Py_CLEAR(clear_module_state->__pyx_tuple__8);
+  Py_CLEAR(clear_module_state->__pyx_tuple__9);
+  Py_CLEAR(clear_module_state->__pyx_slice__17);
+  Py_CLEAR(clear_module_state->__pyx_tuple__11);
+  Py_CLEAR(clear_module_state->__pyx_tuple__13);
+  Py_CLEAR(clear_module_state->__pyx_tuple__14);
+  Py_CLEAR(clear_module_state->__pyx_tuple__15);
+  Py_CLEAR(clear_module_state->__pyx_tuple__18);
+  Py_CLEAR(clear_module_state->__pyx_codeobj__5);
+  Py_CLEAR(clear_module_state->__pyx_codeobj__7);
+  Py_CLEAR(clear_module_state->__pyx_codeobj__10);
+  Py_CLEAR(clear_module_state->__pyx_codeobj__12);
+  Py_CLEAR(clear_module_state->__pyx_codeobj__16);
+  Py_CLEAR(clear_module_state->__pyx_codeobj__19);
+  return 0;
 }
-
-/* "src/cy_src/skynet_py_foreign_seri.pyx":94
- *     return n_double
- * 
- * cdef lua_Integer py_get_integer(foreign_read_block* rb, int cookie) except *:             # <<<<<<<<<<<<<<
- *     cdef uint8_t n_uint8
- *     cdef uint16_t n_uint16
- */
-
-static lua_Integer __pyx_f_8pyskynet_22skynet_py_foreign_seri_py_get_integer(struct foreign_read_block *__pyx_v_rb, int __pyx_v_cookie) {
-  uint8_t __pyx_v_n_uint8;
-  uint16_t __pyx_v_n_uint16;
-  int32_t __pyx_v_n_int32;
-  int64_t __pyx_v_n_int64;
-  void *__pyx_v_ptr;
-  lua_Integer __pyx_r;
-  __Pyx_RefNannyDeclarations
-  int __pyx_t_1;
-  PyObject *__pyx_t_2 = NULL;
-  int __pyx_lineno = 0;
-  const char *__pyx_filename = NULL;
-  int __pyx_clineno = 0;
-  __Pyx_RefNannySetupContext("py_get_integer", 0);
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":100
- *     cdef int64_t n_int64
- *     cdef void * ptr
- *     if(cookie==TYPE_NUMBER_ZERO):             # <<<<<<<<<<<<<<
- *         return 0
- *     elif(cookie==TYPE_NUMBER_BYTE):
- */
-  switch (__pyx_v_cookie) {
-    case TYPE_NUMBER_ZERO:
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":101
- *     cdef void * ptr
- *     if(cookie==TYPE_NUMBER_ZERO):
- *         return 0             # <<<<<<<<<<<<<<
- *     elif(cookie==TYPE_NUMBER_BYTE):
- *         ptr = foreign_rb_read(rb, sizeof(n_uint8));
- */
-    __pyx_r = 0;
-    goto __pyx_L0;
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":100
- *     cdef int64_t n_int64
- *     cdef void * ptr
- *     if(cookie==TYPE_NUMBER_ZERO):             # <<<<<<<<<<<<<<
- *         return 0
- *     elif(cookie==TYPE_NUMBER_BYTE):
- */
-    break;
-    case TYPE_NUMBER_BYTE:
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":103
- *         return 0
- *     elif(cookie==TYPE_NUMBER_BYTE):
- *         ptr = foreign_rb_read(rb, sizeof(n_uint8));             # <<<<<<<<<<<<<<
- *         if (ptr == NULL):
- *             raise Exception("invalid stream")
- */
-    __pyx_v_ptr = foreign_rb_read(__pyx_v_rb, (sizeof(__pyx_v_n_uint8)));
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":104
- *     elif(cookie==TYPE_NUMBER_BYTE):
- *         ptr = foreign_rb_read(rb, sizeof(n_uint8));
- *         if (ptr == NULL):             # <<<<<<<<<<<<<<
- *             raise Exception("invalid stream")
- *         memcpy(&n_uint8, ptr, sizeof(n_uint8));
- */
-    __pyx_t_1 = ((__pyx_v_ptr == NULL) != 0);
-    if (unlikely(__pyx_t_1)) {
-
-      /* "src/cy_src/skynet_py_foreign_seri.pyx":105
- *         ptr = foreign_rb_read(rb, sizeof(n_uint8));
- *         if (ptr == NULL):
- *             raise Exception("invalid stream")             # <<<<<<<<<<<<<<
- *         memcpy(&n_uint8, ptr, sizeof(n_uint8));
- *         return n_uint8
- */
-      __pyx_t_2 = __Pyx_PyObject_Call(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])), __pyx_tuple_, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 105, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_2);
-      __Pyx_Raise(__pyx_t_2, 0, 0, 0);
-      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-      __PYX_ERR(0, 105, __pyx_L1_error)
-
-      /* "src/cy_src/skynet_py_foreign_seri.pyx":104
- *     elif(cookie==TYPE_NUMBER_BYTE):
- *         ptr = foreign_rb_read(rb, sizeof(n_uint8));
- *         if (ptr == NULL):             # <<<<<<<<<<<<<<
- *             raise Exception("invalid stream")
- *         memcpy(&n_uint8, ptr, sizeof(n_uint8));
- */
-    }
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":106
- *         if (ptr == NULL):
- *             raise Exception("invalid stream")
- *         memcpy(&n_uint8, ptr, sizeof(n_uint8));             # <<<<<<<<<<<<<<
- *         return n_uint8
- *     elif(cookie==TYPE_NUMBER_WORD):
- */
-    (void)(memcpy((&__pyx_v_n_uint8), __pyx_v_ptr, (sizeof(__pyx_v_n_uint8))));
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":107
- *             raise Exception("invalid stream")
- *         memcpy(&n_uint8, ptr, sizeof(n_uint8));
- *         return n_uint8             # <<<<<<<<<<<<<<
- *     elif(cookie==TYPE_NUMBER_WORD):
- *         ptr = foreign_rb_read(rb, sizeof(n_uint16));
- */
-    __pyx_r = __pyx_v_n_uint8;
-    goto __pyx_L0;
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":102
- *     if(cookie==TYPE_NUMBER_ZERO):
- *         return 0
- *     elif(cookie==TYPE_NUMBER_BYTE):             # <<<<<<<<<<<<<<
- *         ptr = foreign_rb_read(rb, sizeof(n_uint8));
- *         if (ptr == NULL):
- */
-    break;
-    case TYPE_NUMBER_WORD:
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":109
- *         return n_uint8
- *     elif(cookie==TYPE_NUMBER_WORD):
- *         ptr = foreign_rb_read(rb, sizeof(n_uint16));             # <<<<<<<<<<<<<<
- *         if(ptr == NULL):
- *             raise Exception("invalid stream")
- */
-    __pyx_v_ptr = foreign_rb_read(__pyx_v_rb, (sizeof(__pyx_v_n_uint16)));
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":110
- *     elif(cookie==TYPE_NUMBER_WORD):
- *         ptr = foreign_rb_read(rb, sizeof(n_uint16));
- *         if(ptr == NULL):             # <<<<<<<<<<<<<<
- *             raise Exception("invalid stream")
- *         memcpy(&n_uint16, ptr, sizeof(n_uint16));
- */
-    __pyx_t_1 = ((__pyx_v_ptr == NULL) != 0);
-    if (unlikely(__pyx_t_1)) {
-
-      /* "src/cy_src/skynet_py_foreign_seri.pyx":111
- *         ptr = foreign_rb_read(rb, sizeof(n_uint16));
- *         if(ptr == NULL):
- *             raise Exception("invalid stream")             # <<<<<<<<<<<<<<
- *         memcpy(&n_uint16, ptr, sizeof(n_uint16));
- *         return n_uint16
- */
-      __pyx_t_2 = __Pyx_PyObject_Call(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])), __pyx_tuple_, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 111, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_2);
-      __Pyx_Raise(__pyx_t_2, 0, 0, 0);
-      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-      __PYX_ERR(0, 111, __pyx_L1_error)
-
-      /* "src/cy_src/skynet_py_foreign_seri.pyx":110
- *     elif(cookie==TYPE_NUMBER_WORD):
- *         ptr = foreign_rb_read(rb, sizeof(n_uint16));
- *         if(ptr == NULL):             # <<<<<<<<<<<<<<
- *             raise Exception("invalid stream")
- *         memcpy(&n_uint16, ptr, sizeof(n_uint16));
- */
-    }
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":112
- *         if(ptr == NULL):
- *             raise Exception("invalid stream")
- *         memcpy(&n_uint16, ptr, sizeof(n_uint16));             # <<<<<<<<<<<<<<
- *         return n_uint16
- *     elif(cookie==TYPE_NUMBER_DWORD):
- */
-    (void)(memcpy((&__pyx_v_n_uint16), __pyx_v_ptr, (sizeof(__pyx_v_n_uint16))));
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":113
- *             raise Exception("invalid stream")
- *         memcpy(&n_uint16, ptr, sizeof(n_uint16));
- *         return n_uint16             # <<<<<<<<<<<<<<
- *     elif(cookie==TYPE_NUMBER_DWORD):
- *         ptr = foreign_rb_read(rb, sizeof(n_int32));
- */
-    __pyx_r = __pyx_v_n_uint16;
-    goto __pyx_L0;
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":108
- *         memcpy(&n_uint8, ptr, sizeof(n_uint8));
- *         return n_uint8
- *     elif(cookie==TYPE_NUMBER_WORD):             # <<<<<<<<<<<<<<
- *         ptr = foreign_rb_read(rb, sizeof(n_uint16));
- *         if(ptr == NULL):
- */
-    break;
-    case TYPE_NUMBER_DWORD:
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":115
- *         return n_uint16
- *     elif(cookie==TYPE_NUMBER_DWORD):
- *         ptr = foreign_rb_read(rb, sizeof(n_int32));             # <<<<<<<<<<<<<<
- *         if(ptr == NULL):
- *             raise Exception("invalid stream")
- */
-    __pyx_v_ptr = foreign_rb_read(__pyx_v_rb, (sizeof(__pyx_v_n_int32)));
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":116
- *     elif(cookie==TYPE_NUMBER_DWORD):
- *         ptr = foreign_rb_read(rb, sizeof(n_int32));
- *         if(ptr == NULL):             # <<<<<<<<<<<<<<
- *             raise Exception("invalid stream")
- *         memcpy(&n_int32, ptr, sizeof(n_int32));
- */
-    __pyx_t_1 = ((__pyx_v_ptr == NULL) != 0);
-    if (unlikely(__pyx_t_1)) {
-
-      /* "src/cy_src/skynet_py_foreign_seri.pyx":117
- *         ptr = foreign_rb_read(rb, sizeof(n_int32));
- *         if(ptr == NULL):
- *             raise Exception("invalid stream")             # <<<<<<<<<<<<<<
- *         memcpy(&n_int32, ptr, sizeof(n_int32));
- *         return n_int32
- */
-      __pyx_t_2 = __Pyx_PyObject_Call(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])), __pyx_tuple_, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 117, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_2);
-      __Pyx_Raise(__pyx_t_2, 0, 0, 0);
-      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-      __PYX_ERR(0, 117, __pyx_L1_error)
-
-      /* "src/cy_src/skynet_py_foreign_seri.pyx":116
- *     elif(cookie==TYPE_NUMBER_DWORD):
- *         ptr = foreign_rb_read(rb, sizeof(n_int32));
- *         if(ptr == NULL):             # <<<<<<<<<<<<<<
- *             raise Exception("invalid stream")
- *         memcpy(&n_int32, ptr, sizeof(n_int32));
- */
-    }
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":118
- *         if(ptr == NULL):
- *             raise Exception("invalid stream")
- *         memcpy(&n_int32, ptr, sizeof(n_int32));             # <<<<<<<<<<<<<<
- *         return n_int32
- *     elif(cookie==TYPE_NUMBER_QWORD):
- */
-    (void)(memcpy((&__pyx_v_n_int32), __pyx_v_ptr, (sizeof(__pyx_v_n_int32))));
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":119
- *             raise Exception("invalid stream")
- *         memcpy(&n_int32, ptr, sizeof(n_int32));
- *         return n_int32             # <<<<<<<<<<<<<<
- *     elif(cookie==TYPE_NUMBER_QWORD):
- *         ptr = foreign_rb_read(rb, sizeof(n_int64));
- */
-    __pyx_r = __pyx_v_n_int32;
-    goto __pyx_L0;
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":114
- *         memcpy(&n_uint16, ptr, sizeof(n_uint16));
- *         return n_uint16
- *     elif(cookie==TYPE_NUMBER_DWORD):             # <<<<<<<<<<<<<<
- *         ptr = foreign_rb_read(rb, sizeof(n_int32));
- *         if(ptr == NULL):
- */
-    break;
-    case TYPE_NUMBER_QWORD:
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":121
- *         return n_int32
- *     elif(cookie==TYPE_NUMBER_QWORD):
- *         ptr = foreign_rb_read(rb, sizeof(n_int64));             # <<<<<<<<<<<<<<
- *         if(ptr == NULL):
- *             raise Exception("invalid stream")
- */
-    __pyx_v_ptr = foreign_rb_read(__pyx_v_rb, (sizeof(__pyx_v_n_int64)));
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":122
- *     elif(cookie==TYPE_NUMBER_QWORD):
- *         ptr = foreign_rb_read(rb, sizeof(n_int64));
- *         if(ptr == NULL):             # <<<<<<<<<<<<<<
- *             raise Exception("invalid stream")
- *         memcpy(&n_int64, ptr, sizeof(n_int64));
- */
-    __pyx_t_1 = ((__pyx_v_ptr == NULL) != 0);
-    if (unlikely(__pyx_t_1)) {
-
-      /* "src/cy_src/skynet_py_foreign_seri.pyx":123
- *         ptr = foreign_rb_read(rb, sizeof(n_int64));
- *         if(ptr == NULL):
- *             raise Exception("invalid stream")             # <<<<<<<<<<<<<<
- *         memcpy(&n_int64, ptr, sizeof(n_int64));
- *         return n_int64
- */
-      __pyx_t_2 = __Pyx_PyObject_Call(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])), __pyx_tuple_, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 123, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_2);
-      __Pyx_Raise(__pyx_t_2, 0, 0, 0);
-      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-      __PYX_ERR(0, 123, __pyx_L1_error)
-
-      /* "src/cy_src/skynet_py_foreign_seri.pyx":122
- *     elif(cookie==TYPE_NUMBER_QWORD):
- *         ptr = foreign_rb_read(rb, sizeof(n_int64));
- *         if(ptr == NULL):             # <<<<<<<<<<<<<<
- *             raise Exception("invalid stream")
- *         memcpy(&n_int64, ptr, sizeof(n_int64));
- */
-    }
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":124
- *         if(ptr == NULL):
- *             raise Exception("invalid stream")
- *         memcpy(&n_int64, ptr, sizeof(n_int64));             # <<<<<<<<<<<<<<
- *         return n_int64
- *     else:
- */
-    (void)(memcpy((&__pyx_v_n_int64), __pyx_v_ptr, (sizeof(__pyx_v_n_int64))));
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":125
- *             raise Exception("invalid stream")
- *         memcpy(&n_int64, ptr, sizeof(n_int64));
- *         return n_int64             # <<<<<<<<<<<<<<
- *     else:
- *         raise Exception("invalid stream")
- */
-    __pyx_r = __pyx_v_n_int64;
-    goto __pyx_L0;
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":120
- *         memcpy(&n_int32, ptr, sizeof(n_int32));
- *         return n_int32
- *     elif(cookie==TYPE_NUMBER_QWORD):             # <<<<<<<<<<<<<<
- *         ptr = foreign_rb_read(rb, sizeof(n_int64));
- *         if(ptr == NULL):
- */
-    break;
-    default:
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":127
- *         return n_int64
- *     else:
- *         raise Exception("invalid stream")             # <<<<<<<<<<<<<<
- * 
- * #cdef skynet_foreign* py_get_foreign(foreign_read_block *rb) except NULL:
- */
-    __pyx_t_2 = __Pyx_PyObject_Call(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])), __pyx_tuple_, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 127, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_2);
-    __Pyx_Raise(__pyx_t_2, 0, 0, 0);
-    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __PYX_ERR(0, 127, __pyx_L1_error)
-    break;
-  }
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":94
- *     return n_double
- * 
- * cdef lua_Integer py_get_integer(foreign_read_block* rb, int cookie) except *:             # <<<<<<<<<<<<<<
- *     cdef uint8_t n_uint8
- *     cdef uint16_t n_uint16
- */
-
-  /* function exit code */
-  __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_2);
-  __Pyx_AddTraceback("pyskynet.skynet_py_foreign_seri.py_get_integer", __pyx_clineno, __pyx_lineno, __pyx_filename);
-  __pyx_r = -1;
-  __pyx_L0:;
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
+#endif
+/* #### Code section: module_state_traverse ### */
+#if CYTHON_USE_MODULE_STATE
+static int __pyx_m_traverse(PyObject *m, visitproc visit, void *arg) {
+  __pyx_mstate *traverse_module_state = __pyx_mstate(m);
+  if (!traverse_module_state) return 0;
+  Py_VISIT(traverse_module_state->__pyx_d);
+  Py_VISIT(traverse_module_state->__pyx_b);
+  Py_VISIT(traverse_module_state->__pyx_cython_runtime);
+  Py_VISIT(traverse_module_state->__pyx_empty_tuple);
+  Py_VISIT(traverse_module_state->__pyx_empty_bytes);
+  Py_VISIT(traverse_module_state->__pyx_empty_unicode);
+  #ifdef __Pyx_CyFunction_USED
+  Py_VISIT(traverse_module_state->__pyx_CyFunctionType);
+  #endif
+  #ifdef __Pyx_FusedFunction_USED
+  Py_VISIT(traverse_module_state->__pyx_FusedFunctionType);
+  #endif
+  Py_VISIT(traverse_module_state->__pyx_ptype_7cpython_4type_type);
+  Py_VISIT(traverse_module_state->__pyx_n_s_AssertionError);
+  Py_VISIT(traverse_module_state->__pyx_n_s_PTYPEEnum);
+  Py_VISIT(traverse_module_state->__pyx_n_s_PTYPEEnum___init);
+  Py_VISIT(traverse_module_state->__pyx_n_s_PTYPE_CLIENT);
+  Py_VISIT(traverse_module_state->__pyx_n_s_PTYPE_DEBUG);
+  Py_VISIT(traverse_module_state->__pyx_n_s_PTYPE_ERROR);
+  Py_VISIT(traverse_module_state->__pyx_n_s_PTYPE_FOREIGN);
+  Py_VISIT(traverse_module_state->__pyx_n_s_PTYPE_FOREIGN_REMOTE);
+  Py_VISIT(traverse_module_state->__pyx_n_s_PTYPE_HARBOR);
+  Py_VISIT(traverse_module_state->__pyx_n_s_PTYPE_LUA);
+  Py_VISIT(traverse_module_state->__pyx_n_s_PTYPE_MULTICAST);
+  Py_VISIT(traverse_module_state->__pyx_n_s_PTYPE_QUEUE);
+  Py_VISIT(traverse_module_state->__pyx_n_s_PTYPE_RESPONSE);
+  Py_VISIT(traverse_module_state->__pyx_n_s_PTYPE_SNAX);
+  Py_VISIT(traverse_module_state->__pyx_n_s_PTYPE_SOCKET);
+  Py_VISIT(traverse_module_state->__pyx_n_s_PTYPE_SYSTEM);
+  Py_VISIT(traverse_module_state->__pyx_n_s_PTYPE_TAG_ALLOCSESSION);
+  Py_VISIT(traverse_module_state->__pyx_n_s_PTYPE_TAG_DONTCOPY);
+  Py_VISIT(traverse_module_state->__pyx_n_s_PTYPE_TEXT);
+  Py_VISIT(traverse_module_state->__pyx_n_s_PTYPE_TRACE);
+  Py_VISIT(traverse_module_state->__pyx_n_s_SKYNET_PTYPE);
+  Py_VISIT(traverse_module_state->__pyx_n_s_SKYNET_PTYPE_id_to_name);
+  Py_VISIT(traverse_module_state->__pyx_n_s_SKYNET_PTYPE_name_to_id);
+  Py_VISIT(traverse_module_state->__pyx_n_s_SKYNET_PTYPE_user_builtin_ids);
+  Py_VISIT(traverse_module_state->__pyx_kp_b__2);
+  Py_VISIT(traverse_module_state->__pyx_n_s__20);
+  Py_VISIT(traverse_module_state->__pyx_n_s_asyncio_coroutines);
+  Py_VISIT(traverse_module_state->__pyx_n_s_b);
+  Py_VISIT(traverse_module_state->__pyx_n_s_capsule);
+  Py_VISIT(traverse_module_state->__pyx_kp_u_capsule_unpack_failed_for_name_s);
+  Py_VISIT(traverse_module_state->__pyx_n_s_class_getitem);
+  Py_VISIT(traverse_module_state->__pyx_n_s_cline_in_traceback);
+  Py_VISIT(traverse_module_state->__pyx_n_s_crecv);
+  Py_VISIT(traverse_module_state->__pyx_n_s_csend);
+  Py_VISIT(traverse_module_state->__pyx_n_s_decode);
+  Py_VISIT(traverse_module_state->__pyx_n_s_dict);
+  Py_VISIT(traverse_module_state->__pyx_n_s_doc);
+  Py_VISIT(traverse_module_state->__pyx_n_s_dst);
+  Py_VISIT(traverse_module_state->__pyx_n_s_dstname);
+  Py_VISIT(traverse_module_state->__pyx_n_s_id);
+  Py_VISIT(traverse_module_state->__pyx_n_s_init);
+  Py_VISIT(traverse_module_state->__pyx_n_s_init_subclass);
+  Py_VISIT(traverse_module_state->__pyx_n_s_is_builtin);
+  Py_VISIT(traverse_module_state->__pyx_n_s_is_coroutine);
+  Py_VISIT(traverse_module_state->__pyx_n_s_items);
+  Py_VISIT(traverse_module_state->__pyx_n_s_key);
+  Py_VISIT(traverse_module_state->__pyx_n_s_lower);
+  Py_VISIT(traverse_module_state->__pyx_n_s_main);
+  Py_VISIT(traverse_module_state->__pyx_n_s_metaclass);
+  Py_VISIT(traverse_module_state->__pyx_n_s_module);
+  Py_VISIT(traverse_module_state->__pyx_n_s_mro_entries);
+  Py_VISIT(traverse_module_state->__pyx_n_s_msg);
+  Py_VISIT(traverse_module_state->__pyx_kp_u_must_bind_id);
+  Py_VISIT(traverse_module_state->__pyx_kp_u_must_bind_name);
+  Py_VISIT(traverse_module_state->__pyx_n_s_name);
+  Py_VISIT(traverse_module_state->__pyx_n_s_name_2);
+  Py_VISIT(traverse_module_state->__pyx_n_s_object);
+  Py_VISIT(traverse_module_state->__pyx_kp_u_package_is_too_large_s);
+  Py_VISIT(traverse_module_state->__pyx_n_s_prepare);
+  Py_VISIT(traverse_module_state->__pyx_n_s_ptr);
+  Py_VISIT(traverse_module_state->__pyx_n_s_py_dst);
+  Py_VISIT(traverse_module_state->__pyx_n_s_py_dst_bytes);
+  Py_VISIT(traverse_module_state->__pyx_n_s_py_msg);
+  Py_VISIT(traverse_module_state->__pyx_n_s_py_msg_bytes);
+  Py_VISIT(traverse_module_state->__pyx_n_s_py_session);
+  Py_VISIT(traverse_module_state->__pyx_n_s_py_size);
+  Py_VISIT(traverse_module_state->__pyx_n_s_pyskynet_skynet_py_mq);
+  Py_VISIT(traverse_module_state->__pyx_n_s_qualname);
+  Py_VISIT(traverse_module_state->__pyx_n_s_ret);
+  Py_VISIT(traverse_module_state->__pyx_n_s_s);
+  Py_VISIT(traverse_module_state->__pyx_n_s_self);
+  Py_VISIT(traverse_module_state->__pyx_n_s_session);
+  Py_VISIT(traverse_module_state->__pyx_n_s_set_name);
+  Py_VISIT(traverse_module_state->__pyx_n_s_size);
+  Py_VISIT(traverse_module_state->__pyx_kp_u_skynet_proto_can_only_register_b);
+  Py_VISIT(traverse_module_state->__pyx_kp_u_skynet_proto_type_id);
+  Py_VISIT(traverse_module_state->__pyx_kp_u_skynet_proto_type_id_must_be_les);
+  Py_VISIT(traverse_module_state->__pyx_kp_u_skynet_proto_type_name);
+  Py_VISIT(traverse_module_state->__pyx_kp_u_skynet_threads_has_not_been_star);
+  Py_VISIT(traverse_module_state->__pyx_kp_s_src_cy_src_skynet_py_mq_pyx);
+  Py_VISIT(traverse_module_state->__pyx_n_s_super);
+  Py_VISIT(traverse_module_state->__pyx_n_s_test);
+  Py_VISIT(traverse_module_state->__pyx_n_s_tobytes);
+  Py_VISIT(traverse_module_state->__pyx_n_s_tostring);
+  Py_VISIT(traverse_module_state->__pyx_n_s_type_id);
+  Py_VISIT(traverse_module_state->__pyx_kp_u_type_s_unexcept_when_skynet_csen);
+  Py_VISIT(traverse_module_state->__pyx_n_s_user_assert_id_name);
+  Py_VISIT(traverse_module_state->__pyx_int_0);
+  Py_VISIT(traverse_module_state->__pyx_int_6);
+  Py_VISIT(traverse_module_state->__pyx_int_12);
+  Py_VISIT(traverse_module_state->__pyx_int_255);
+  Py_VISIT(traverse_module_state->__pyx_tuple_);
+  Py_VISIT(traverse_module_state->__pyx_tuple__3);
+  Py_VISIT(traverse_module_state->__pyx_tuple__4);
+  Py_VISIT(traverse_module_state->__pyx_tuple__6);
+  Py_VISIT(traverse_module_state->__pyx_tuple__8);
+  Py_VISIT(traverse_module_state->__pyx_tuple__9);
+  Py_VISIT(traverse_module_state->__pyx_slice__17);
+  Py_VISIT(traverse_module_state->__pyx_tuple__11);
+  Py_VISIT(traverse_module_state->__pyx_tuple__13);
+  Py_VISIT(traverse_module_state->__pyx_tuple__14);
+  Py_VISIT(traverse_module_state->__pyx_tuple__15);
+  Py_VISIT(traverse_module_state->__pyx_tuple__18);
+  Py_VISIT(traverse_module_state->__pyx_codeobj__5);
+  Py_VISIT(traverse_module_state->__pyx_codeobj__7);
+  Py_VISIT(traverse_module_state->__pyx_codeobj__10);
+  Py_VISIT(traverse_module_state->__pyx_codeobj__12);
+  Py_VISIT(traverse_module_state->__pyx_codeobj__16);
+  Py_VISIT(traverse_module_state->__pyx_codeobj__19);
+  return 0;
 }
+#endif
+/* #### Code section: module_state_defines ### */
+#define __pyx_d __pyx_mstate_global->__pyx_d
+#define __pyx_b __pyx_mstate_global->__pyx_b
+#define __pyx_cython_runtime __pyx_mstate_global->__pyx_cython_runtime
+#define __pyx_empty_tuple __pyx_mstate_global->__pyx_empty_tuple
+#define __pyx_empty_bytes __pyx_mstate_global->__pyx_empty_bytes
+#define __pyx_empty_unicode __pyx_mstate_global->__pyx_empty_unicode
+#ifdef __Pyx_CyFunction_USED
+#define __pyx_CyFunctionType __pyx_mstate_global->__pyx_CyFunctionType
+#endif
+#ifdef __Pyx_FusedFunction_USED
+#define __pyx_FusedFunctionType __pyx_mstate_global->__pyx_FusedFunctionType
+#endif
+#ifdef __Pyx_Generator_USED
+#define __pyx_GeneratorType __pyx_mstate_global->__pyx_GeneratorType
+#endif
+#ifdef __Pyx_IterableCoroutine_USED
+#define __pyx_IterableCoroutineType __pyx_mstate_global->__pyx_IterableCoroutineType
+#endif
+#ifdef __Pyx_Coroutine_USED
+#define __pyx_CoroutineAwaitType __pyx_mstate_global->__pyx_CoroutineAwaitType
+#endif
+#ifdef __Pyx_Coroutine_USED
+#define __pyx_CoroutineType __pyx_mstate_global->__pyx_CoroutineType
+#endif
+#if CYTHON_USE_MODULE_STATE
+#endif
+#if CYTHON_USE_MODULE_STATE
+#endif
+#if CYTHON_USE_MODULE_STATE
+#endif
+#if CYTHON_USE_MODULE_STATE
+#endif
+#if CYTHON_USE_MODULE_STATE
+#endif
+#if CYTHON_USE_MODULE_STATE
+#endif
+#define __pyx_ptype_7cpython_4type_type __pyx_mstate_global->__pyx_ptype_7cpython_4type_type
+#if CYTHON_USE_MODULE_STATE
+#endif
+#if CYTHON_USE_MODULE_STATE
+#endif
+#if CYTHON_USE_MODULE_STATE
+#endif
+#if CYTHON_USE_MODULE_STATE
+#endif
+#if CYTHON_USE_MODULE_STATE
+#endif
+#if CYTHON_USE_MODULE_STATE
+#endif
+#define __pyx_n_s_AssertionError __pyx_mstate_global->__pyx_n_s_AssertionError
+#define __pyx_n_s_PTYPEEnum __pyx_mstate_global->__pyx_n_s_PTYPEEnum
+#define __pyx_n_s_PTYPEEnum___init __pyx_mstate_global->__pyx_n_s_PTYPEEnum___init
+#define __pyx_n_s_PTYPE_CLIENT __pyx_mstate_global->__pyx_n_s_PTYPE_CLIENT
+#define __pyx_n_s_PTYPE_DEBUG __pyx_mstate_global->__pyx_n_s_PTYPE_DEBUG
+#define __pyx_n_s_PTYPE_ERROR __pyx_mstate_global->__pyx_n_s_PTYPE_ERROR
+#define __pyx_n_s_PTYPE_FOREIGN __pyx_mstate_global->__pyx_n_s_PTYPE_FOREIGN
+#define __pyx_n_s_PTYPE_FOREIGN_REMOTE __pyx_mstate_global->__pyx_n_s_PTYPE_FOREIGN_REMOTE
+#define __pyx_n_s_PTYPE_HARBOR __pyx_mstate_global->__pyx_n_s_PTYPE_HARBOR
+#define __pyx_n_s_PTYPE_LUA __pyx_mstate_global->__pyx_n_s_PTYPE_LUA
+#define __pyx_n_s_PTYPE_MULTICAST __pyx_mstate_global->__pyx_n_s_PTYPE_MULTICAST
+#define __pyx_n_s_PTYPE_QUEUE __pyx_mstate_global->__pyx_n_s_PTYPE_QUEUE
+#define __pyx_n_s_PTYPE_RESPONSE __pyx_mstate_global->__pyx_n_s_PTYPE_RESPONSE
+#define __pyx_n_s_PTYPE_SNAX __pyx_mstate_global->__pyx_n_s_PTYPE_SNAX
+#define __pyx_n_s_PTYPE_SOCKET __pyx_mstate_global->__pyx_n_s_PTYPE_SOCKET
+#define __pyx_n_s_PTYPE_SYSTEM __pyx_mstate_global->__pyx_n_s_PTYPE_SYSTEM
+#define __pyx_n_s_PTYPE_TAG_ALLOCSESSION __pyx_mstate_global->__pyx_n_s_PTYPE_TAG_ALLOCSESSION
+#define __pyx_n_s_PTYPE_TAG_DONTCOPY __pyx_mstate_global->__pyx_n_s_PTYPE_TAG_DONTCOPY
+#define __pyx_n_s_PTYPE_TEXT __pyx_mstate_global->__pyx_n_s_PTYPE_TEXT
+#define __pyx_n_s_PTYPE_TRACE __pyx_mstate_global->__pyx_n_s_PTYPE_TRACE
+#define __pyx_n_s_SKYNET_PTYPE __pyx_mstate_global->__pyx_n_s_SKYNET_PTYPE
+#define __pyx_n_s_SKYNET_PTYPE_id_to_name __pyx_mstate_global->__pyx_n_s_SKYNET_PTYPE_id_to_name
+#define __pyx_n_s_SKYNET_PTYPE_name_to_id __pyx_mstate_global->__pyx_n_s_SKYNET_PTYPE_name_to_id
+#define __pyx_n_s_SKYNET_PTYPE_user_builtin_ids __pyx_mstate_global->__pyx_n_s_SKYNET_PTYPE_user_builtin_ids
+#define __pyx_kp_b__2 __pyx_mstate_global->__pyx_kp_b__2
+#define __pyx_n_s__20 __pyx_mstate_global->__pyx_n_s__20
+#define __pyx_n_s_asyncio_coroutines __pyx_mstate_global->__pyx_n_s_asyncio_coroutines
+#define __pyx_n_s_b __pyx_mstate_global->__pyx_n_s_b
+#define __pyx_n_s_capsule __pyx_mstate_global->__pyx_n_s_capsule
+#define __pyx_kp_u_capsule_unpack_failed_for_name_s __pyx_mstate_global->__pyx_kp_u_capsule_unpack_failed_for_name_s
+#define __pyx_n_s_class_getitem __pyx_mstate_global->__pyx_n_s_class_getitem
+#define __pyx_n_s_cline_in_traceback __pyx_mstate_global->__pyx_n_s_cline_in_traceback
+#define __pyx_n_s_crecv __pyx_mstate_global->__pyx_n_s_crecv
+#define __pyx_n_s_csend __pyx_mstate_global->__pyx_n_s_csend
+#define __pyx_n_s_decode __pyx_mstate_global->__pyx_n_s_decode
+#define __pyx_n_s_dict __pyx_mstate_global->__pyx_n_s_dict
+#define __pyx_n_s_doc __pyx_mstate_global->__pyx_n_s_doc
+#define __pyx_n_s_dst __pyx_mstate_global->__pyx_n_s_dst
+#define __pyx_n_s_dstname __pyx_mstate_global->__pyx_n_s_dstname
+#define __pyx_n_s_id __pyx_mstate_global->__pyx_n_s_id
+#define __pyx_n_s_init __pyx_mstate_global->__pyx_n_s_init
+#define __pyx_n_s_init_subclass __pyx_mstate_global->__pyx_n_s_init_subclass
+#define __pyx_n_s_is_builtin __pyx_mstate_global->__pyx_n_s_is_builtin
+#define __pyx_n_s_is_coroutine __pyx_mstate_global->__pyx_n_s_is_coroutine
+#define __pyx_n_s_items __pyx_mstate_global->__pyx_n_s_items
+#define __pyx_n_s_key __pyx_mstate_global->__pyx_n_s_key
+#define __pyx_n_s_lower __pyx_mstate_global->__pyx_n_s_lower
+#define __pyx_n_s_main __pyx_mstate_global->__pyx_n_s_main
+#define __pyx_n_s_metaclass __pyx_mstate_global->__pyx_n_s_metaclass
+#define __pyx_n_s_module __pyx_mstate_global->__pyx_n_s_module
+#define __pyx_n_s_mro_entries __pyx_mstate_global->__pyx_n_s_mro_entries
+#define __pyx_n_s_msg __pyx_mstate_global->__pyx_n_s_msg
+#define __pyx_kp_u_must_bind_id __pyx_mstate_global->__pyx_kp_u_must_bind_id
+#define __pyx_kp_u_must_bind_name __pyx_mstate_global->__pyx_kp_u_must_bind_name
+#define __pyx_n_s_name __pyx_mstate_global->__pyx_n_s_name
+#define __pyx_n_s_name_2 __pyx_mstate_global->__pyx_n_s_name_2
+#define __pyx_n_s_object __pyx_mstate_global->__pyx_n_s_object
+#define __pyx_kp_u_package_is_too_large_s __pyx_mstate_global->__pyx_kp_u_package_is_too_large_s
+#define __pyx_n_s_prepare __pyx_mstate_global->__pyx_n_s_prepare
+#define __pyx_n_s_ptr __pyx_mstate_global->__pyx_n_s_ptr
+#define __pyx_n_s_py_dst __pyx_mstate_global->__pyx_n_s_py_dst
+#define __pyx_n_s_py_dst_bytes __pyx_mstate_global->__pyx_n_s_py_dst_bytes
+#define __pyx_n_s_py_msg __pyx_mstate_global->__pyx_n_s_py_msg
+#define __pyx_n_s_py_msg_bytes __pyx_mstate_global->__pyx_n_s_py_msg_bytes
+#define __pyx_n_s_py_session __pyx_mstate_global->__pyx_n_s_py_session
+#define __pyx_n_s_py_size __pyx_mstate_global->__pyx_n_s_py_size
+#define __pyx_n_s_pyskynet_skynet_py_mq __pyx_mstate_global->__pyx_n_s_pyskynet_skynet_py_mq
+#define __pyx_n_s_qualname __pyx_mstate_global->__pyx_n_s_qualname
+#define __pyx_n_s_ret __pyx_mstate_global->__pyx_n_s_ret
+#define __pyx_n_s_s __pyx_mstate_global->__pyx_n_s_s
+#define __pyx_n_s_self __pyx_mstate_global->__pyx_n_s_self
+#define __pyx_n_s_session __pyx_mstate_global->__pyx_n_s_session
+#define __pyx_n_s_set_name __pyx_mstate_global->__pyx_n_s_set_name
+#define __pyx_n_s_size __pyx_mstate_global->__pyx_n_s_size
+#define __pyx_kp_u_skynet_proto_can_only_register_b __pyx_mstate_global->__pyx_kp_u_skynet_proto_can_only_register_b
+#define __pyx_kp_u_skynet_proto_type_id __pyx_mstate_global->__pyx_kp_u_skynet_proto_type_id
+#define __pyx_kp_u_skynet_proto_type_id_must_be_les __pyx_mstate_global->__pyx_kp_u_skynet_proto_type_id_must_be_les
+#define __pyx_kp_u_skynet_proto_type_name __pyx_mstate_global->__pyx_kp_u_skynet_proto_type_name
+#define __pyx_kp_u_skynet_threads_has_not_been_star __pyx_mstate_global->__pyx_kp_u_skynet_threads_has_not_been_star
+#define __pyx_kp_s_src_cy_src_skynet_py_mq_pyx __pyx_mstate_global->__pyx_kp_s_src_cy_src_skynet_py_mq_pyx
+#define __pyx_n_s_super __pyx_mstate_global->__pyx_n_s_super
+#define __pyx_n_s_test __pyx_mstate_global->__pyx_n_s_test
+#define __pyx_n_s_tobytes __pyx_mstate_global->__pyx_n_s_tobytes
+#define __pyx_n_s_tostring __pyx_mstate_global->__pyx_n_s_tostring
+#define __pyx_n_s_type_id __pyx_mstate_global->__pyx_n_s_type_id
+#define __pyx_kp_u_type_s_unexcept_when_skynet_csen __pyx_mstate_global->__pyx_kp_u_type_s_unexcept_when_skynet_csen
+#define __pyx_n_s_user_assert_id_name __pyx_mstate_global->__pyx_n_s_user_assert_id_name
+#define __pyx_int_0 __pyx_mstate_global->__pyx_int_0
+#define __pyx_int_6 __pyx_mstate_global->__pyx_int_6
+#define __pyx_int_12 __pyx_mstate_global->__pyx_int_12
+#define __pyx_int_255 __pyx_mstate_global->__pyx_int_255
+#define __pyx_tuple_ __pyx_mstate_global->__pyx_tuple_
+#define __pyx_tuple__3 __pyx_mstate_global->__pyx_tuple__3
+#define __pyx_tuple__4 __pyx_mstate_global->__pyx_tuple__4
+#define __pyx_tuple__6 __pyx_mstate_global->__pyx_tuple__6
+#define __pyx_tuple__8 __pyx_mstate_global->__pyx_tuple__8
+#define __pyx_tuple__9 __pyx_mstate_global->__pyx_tuple__9
+#define __pyx_slice__17 __pyx_mstate_global->__pyx_slice__17
+#define __pyx_tuple__11 __pyx_mstate_global->__pyx_tuple__11
+#define __pyx_tuple__13 __pyx_mstate_global->__pyx_tuple__13
+#define __pyx_tuple__14 __pyx_mstate_global->__pyx_tuple__14
+#define __pyx_tuple__15 __pyx_mstate_global->__pyx_tuple__15
+#define __pyx_tuple__18 __pyx_mstate_global->__pyx_tuple__18
+#define __pyx_codeobj__5 __pyx_mstate_global->__pyx_codeobj__5
+#define __pyx_codeobj__7 __pyx_mstate_global->__pyx_codeobj__7
+#define __pyx_codeobj__10 __pyx_mstate_global->__pyx_codeobj__10
+#define __pyx_codeobj__12 __pyx_mstate_global->__pyx_codeobj__12
+#define __pyx_codeobj__16 __pyx_mstate_global->__pyx_codeobj__16
+#define __pyx_codeobj__19 __pyx_mstate_global->__pyx_codeobj__19
+/* #### Code section: module_code ### */
 
-/* "src/cy_src/skynet_py_foreign_seri.pyx":147
- * #    return userdata
- * 
- * cdef void* py_get_pointer(foreign_read_block *rb) except NULL:             # <<<<<<<<<<<<<<
- *     cdef void * userdata
- *     cdef void ** v = <void **>foreign_rb_read(rb,sizeof(userdata));
- */
-
-static void *__pyx_f_8pyskynet_22skynet_py_foreign_seri_py_get_pointer(struct foreign_read_block *__pyx_v_rb) {
-  void *__pyx_v_userdata;
-  void **__pyx_v_v;
-  void *__pyx_r;
-  __Pyx_RefNannyDeclarations
-  int __pyx_t_1;
-  PyObject *__pyx_t_2 = NULL;
-  int __pyx_lineno = 0;
-  const char *__pyx_filename = NULL;
-  int __pyx_clineno = 0;
-  __Pyx_RefNannySetupContext("py_get_pointer", 0);
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":149
- * cdef void* py_get_pointer(foreign_read_block *rb) except NULL:
- *     cdef void * userdata
- *     cdef void ** v = <void **>foreign_rb_read(rb,sizeof(userdata));             # <<<<<<<<<<<<<<
- *     if v == NULL:
- *         raise Exception("invalid stream")
- */
-  __pyx_v_v = ((void **)foreign_rb_read(__pyx_v_rb, (sizeof(__pyx_v_userdata))));
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":150
- *     cdef void * userdata
- *     cdef void ** v = <void **>foreign_rb_read(rb,sizeof(userdata));
- *     if v == NULL:             # <<<<<<<<<<<<<<
- *         raise Exception("invalid stream")
- *     memcpy(&userdata, v, sizeof(userdata));
- */
-  __pyx_t_1 = ((__pyx_v_v == NULL) != 0);
-  if (unlikely(__pyx_t_1)) {
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":151
- *     cdef void ** v = <void **>foreign_rb_read(rb,sizeof(userdata));
- *     if v == NULL:
- *         raise Exception("invalid stream")             # <<<<<<<<<<<<<<
- *     memcpy(&userdata, v, sizeof(userdata));
- *     return userdata
- */
-    __pyx_t_2 = __Pyx_PyObject_Call(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])), __pyx_tuple_, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 151, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_2);
-    __Pyx_Raise(__pyx_t_2, 0, 0, 0);
-    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __PYX_ERR(0, 151, __pyx_L1_error)
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":150
- *     cdef void * userdata
- *     cdef void ** v = <void **>foreign_rb_read(rb,sizeof(userdata));
- *     if v == NULL:             # <<<<<<<<<<<<<<
- *         raise Exception("invalid stream")
- *     memcpy(&userdata, v, sizeof(userdata));
- */
-  }
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":152
- *     if v == NULL:
- *         raise Exception("invalid stream")
- *     memcpy(&userdata, v, sizeof(userdata));             # <<<<<<<<<<<<<<
- *     return userdata
- * 
- */
-  (void)(memcpy((&__pyx_v_userdata), __pyx_v_v, (sizeof(__pyx_v_userdata))));
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":153
- *         raise Exception("invalid stream")
- *     memcpy(&userdata, v, sizeof(userdata));
- *     return userdata             # <<<<<<<<<<<<<<
- * 
- * cdef char * py_get_string(foreign_read_block *rb, int value_type, int cookie, size_t *out) except NULL:
- */
-  __pyx_r = __pyx_v_userdata;
-  goto __pyx_L0;
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":147
- * #    return userdata
+/* "src/cy_src/skynet_py_mq.pyx":14
  * 
- * cdef void* py_get_pointer(foreign_read_block *rb) except NULL:             # <<<<<<<<<<<<<<
- *     cdef void * userdata
- *     cdef void ** v = <void **>foreign_rb_read(rb,sizeof(userdata));
- */
-
-  /* function exit code */
-  __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_2);
-  __Pyx_AddTraceback("pyskynet.skynet_py_foreign_seri.py_get_pointer", __pyx_clineno, __pyx_lineno, __pyx_filename);
-  __pyx_r = NULL;
-  __pyx_L0:;
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-/* "src/cy_src/skynet_py_foreign_seri.pyx":155
- *     return userdata
  * 
- * cdef char * py_get_string(foreign_read_block *rb, int value_type, int cookie, size_t *out) except NULL:             # <<<<<<<<<<<<<<
- *     cdef char * p = NULL
- *     cdef uint16_t *plen2
+ * cdef void free_pyptr(object capsule):             # <<<<<<<<<<<<<<
+ *     cdef void *ptr = PyCapsule_GetPointer(capsule, "pyptr")
+ *     skynet_free(ptr)
  */
 
-static char *__pyx_f_8pyskynet_22skynet_py_foreign_seri_py_get_string(struct foreign_read_block *__pyx_v_rb, int __pyx_v_value_type, int __pyx_v_cookie, size_t *__pyx_v_out) {
-  char *__pyx_v_p;
-  uint16_t *__pyx_v_plen2;
-  uint32_t *__pyx_v_plen4;
-  char *__pyx_r;
+static void __pyx_f_8pyskynet_12skynet_py_mq_free_pyptr(PyObject *__pyx_v_capsule) {
+  void *__pyx_v_ptr;
   __Pyx_RefNannyDeclarations
-  int __pyx_t_1;
-  PyObject *__pyx_t_2 = NULL;
+  void *__pyx_t_1;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
-  __Pyx_RefNannySetupContext("py_get_string", 0);
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":156
- * 
- * cdef char * py_get_string(foreign_read_block *rb, int value_type, int cookie, size_t *out) except NULL:
- *     cdef char * p = NULL             # <<<<<<<<<<<<<<
- *     cdef uint16_t *plen2
- *     cdef uint32_t *plen4
- */
-  __pyx_v_p = NULL;
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":159
- *     cdef uint16_t *plen2
- *     cdef uint32_t *plen4
- *     if value_type==TYPE_SHORT_STRING:             # <<<<<<<<<<<<<<
- *         p = <char *>foreign_rb_read(rb, cookie)
- *         out[0] = cookie
- */
-  switch (__pyx_v_value_type) {
-    case TYPE_SHORT_STRING:
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":160
- *     cdef uint32_t *plen4
- *     if value_type==TYPE_SHORT_STRING:
- *         p = <char *>foreign_rb_read(rb, cookie)             # <<<<<<<<<<<<<<
- *         out[0] = cookie
- *     elif value_type==TYPE_LONG_STRING:
- */
-    __pyx_v_p = ((char *)foreign_rb_read(__pyx_v_rb, __pyx_v_cookie));
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":161
- *     if value_type==TYPE_SHORT_STRING:
- *         p = <char *>foreign_rb_read(rb, cookie)
- *         out[0] = cookie             # <<<<<<<<<<<<<<
- *     elif value_type==TYPE_LONG_STRING:
- *         if(cookie == 2):
- */
-    (__pyx_v_out[0]) = __pyx_v_cookie;
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":159
- *     cdef uint16_t *plen2
- *     cdef uint32_t *plen4
- *     if value_type==TYPE_SHORT_STRING:             # <<<<<<<<<<<<<<
- *         p = <char *>foreign_rb_read(rb, cookie)
- *         out[0] = cookie
- */
-    break;
-    case TYPE_LONG_STRING:
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":163
- *         out[0] = cookie
- *     elif value_type==TYPE_LONG_STRING:
- *         if(cookie == 2):             # <<<<<<<<<<<<<<
- *             plen2 = <uint16_t *>foreign_rb_read(rb, 2)
- *             if (plen2 == NULL):
- */
-    switch (__pyx_v_cookie) {
-      case 2:
-
-      /* "src/cy_src/skynet_py_foreign_seri.pyx":164
- *     elif value_type==TYPE_LONG_STRING:
- *         if(cookie == 2):
- *             plen2 = <uint16_t *>foreign_rb_read(rb, 2)             # <<<<<<<<<<<<<<
- *             if (plen2 == NULL):
- *                 raise Exception("invalid stream")
- */
-      __pyx_v_plen2 = ((uint16_t *)foreign_rb_read(__pyx_v_rb, 2));
-
-      /* "src/cy_src/skynet_py_foreign_seri.pyx":165
- *         if(cookie == 2):
- *             plen2 = <uint16_t *>foreign_rb_read(rb, 2)
- *             if (plen2 == NULL):             # <<<<<<<<<<<<<<
- *                 raise Exception("invalid stream")
- *             p = <char *>foreign_rb_read(rb, plen2[0])
- */
-      __pyx_t_1 = ((__pyx_v_plen2 == NULL) != 0);
-      if (unlikely(__pyx_t_1)) {
-
-        /* "src/cy_src/skynet_py_foreign_seri.pyx":166
- *             plen2 = <uint16_t *>foreign_rb_read(rb, 2)
- *             if (plen2 == NULL):
- *                 raise Exception("invalid stream")             # <<<<<<<<<<<<<<
- *             p = <char *>foreign_rb_read(rb, plen2[0])
- *             out[0] = plen2[0]
- */
-        __pyx_t_2 = __Pyx_PyObject_Call(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])), __pyx_tuple_, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 166, __pyx_L1_error)
-        __Pyx_GOTREF(__pyx_t_2);
-        __Pyx_Raise(__pyx_t_2, 0, 0, 0);
-        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-        __PYX_ERR(0, 166, __pyx_L1_error)
-
-        /* "src/cy_src/skynet_py_foreign_seri.pyx":165
- *         if(cookie == 2):
- *             plen2 = <uint16_t *>foreign_rb_read(rb, 2)
- *             if (plen2 == NULL):             # <<<<<<<<<<<<<<
- *                 raise Exception("invalid stream")
- *             p = <char *>foreign_rb_read(rb, plen2[0])
- */
-      }
-
-      /* "src/cy_src/skynet_py_foreign_seri.pyx":167
- *             if (plen2 == NULL):
- *                 raise Exception("invalid stream")
- *             p = <char *>foreign_rb_read(rb, plen2[0])             # <<<<<<<<<<<<<<
- *             out[0] = plen2[0]
- *         elif(cookie == 4):
- */
-      __pyx_v_p = ((char *)foreign_rb_read(__pyx_v_rb, (__pyx_v_plen2[0])));
-
-      /* "src/cy_src/skynet_py_foreign_seri.pyx":168
- *                 raise Exception("invalid stream")
- *             p = <char *>foreign_rb_read(rb, plen2[0])
- *             out[0] = plen2[0]             # <<<<<<<<<<<<<<
- *         elif(cookie == 4):
- *             plen4 = <uint32_t *>foreign_rb_read(rb, 4)
- */
-      (__pyx_v_out[0]) = (__pyx_v_plen2[0]);
-
-      /* "src/cy_src/skynet_py_foreign_seri.pyx":163
- *         out[0] = cookie
- *     elif value_type==TYPE_LONG_STRING:
- *         if(cookie == 2):             # <<<<<<<<<<<<<<
- *             plen2 = <uint16_t *>foreign_rb_read(rb, 2)
- *             if (plen2 == NULL):
- */
-      break;
-      case 4:
-
-      /* "src/cy_src/skynet_py_foreign_seri.pyx":170
- *             out[0] = plen2[0]
- *         elif(cookie == 4):
- *             plen4 = <uint32_t *>foreign_rb_read(rb, 4)             # <<<<<<<<<<<<<<
- *             if(plen4 == NULL):
- *                 raise Exception("invalid stream")
- */
-      __pyx_v_plen4 = ((uint32_t *)foreign_rb_read(__pyx_v_rb, 4));
-
-      /* "src/cy_src/skynet_py_foreign_seri.pyx":171
- *         elif(cookie == 4):
- *             plen4 = <uint32_t *>foreign_rb_read(rb, 4)
- *             if(plen4 == NULL):             # <<<<<<<<<<<<<<
- *                 raise Exception("invalid stream")
- *             p = <char *>foreign_rb_read(rb, plen4[0])
- */
-      __pyx_t_1 = ((__pyx_v_plen4 == NULL) != 0);
-      if (unlikely(__pyx_t_1)) {
-
-        /* "src/cy_src/skynet_py_foreign_seri.pyx":172
- *             plen4 = <uint32_t *>foreign_rb_read(rb, 4)
- *             if(plen4 == NULL):
- *                 raise Exception("invalid stream")             # <<<<<<<<<<<<<<
- *             p = <char *>foreign_rb_read(rb, plen4[0])
- *             out[0] = plen4[0]
- */
-        __pyx_t_2 = __Pyx_PyObject_Call(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])), __pyx_tuple_, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 172, __pyx_L1_error)
-        __Pyx_GOTREF(__pyx_t_2);
-        __Pyx_Raise(__pyx_t_2, 0, 0, 0);
-        __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-        __PYX_ERR(0, 172, __pyx_L1_error)
-
-        /* "src/cy_src/skynet_py_foreign_seri.pyx":171
- *         elif(cookie == 4):
- *             plen4 = <uint32_t *>foreign_rb_read(rb, 4)
- *             if(plen4 == NULL):             # <<<<<<<<<<<<<<
- *                 raise Exception("invalid stream")
- *             p = <char *>foreign_rb_read(rb, plen4[0])
- */
-      }
-
-      /* "src/cy_src/skynet_py_foreign_seri.pyx":173
- *             if(plen4 == NULL):
- *                 raise Exception("invalid stream")
- *             p = <char *>foreign_rb_read(rb, plen4[0])             # <<<<<<<<<<<<<<
- *             out[0] = plen4[0]
- *     return p
- */
-      __pyx_v_p = ((char *)foreign_rb_read(__pyx_v_rb, (__pyx_v_plen4[0])));
-
-      /* "src/cy_src/skynet_py_foreign_seri.pyx":174
- *                 raise Exception("invalid stream")
- *             p = <char *>foreign_rb_read(rb, plen4[0])
- *             out[0] = plen4[0]             # <<<<<<<<<<<<<<
- *     return p
- * 
- */
-      (__pyx_v_out[0]) = (__pyx_v_plen4[0]);
+  __Pyx_RefNannySetupContext("free_pyptr", 0);
 
-      /* "src/cy_src/skynet_py_foreign_seri.pyx":169
- *             p = <char *>foreign_rb_read(rb, plen2[0])
- *             out[0] = plen2[0]
- *         elif(cookie == 4):             # <<<<<<<<<<<<<<
- *             plen4 = <uint32_t *>foreign_rb_read(rb, 4)
- *             if(plen4 == NULL):
- */
-      break;
-      default: break;
-    }
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":162
- *         p = <char *>foreign_rb_read(rb, cookie)
- *         out[0] = cookie
- *     elif value_type==TYPE_LONG_STRING:             # <<<<<<<<<<<<<<
- *         if(cookie == 2):
- *             plen2 = <uint16_t *>foreign_rb_read(rb, 2)
- */
-    break;
-    default: break;
-  }
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":175
- *             p = <char *>foreign_rb_read(rb, plen4[0])
- *             out[0] = plen4[0]
- *     return p             # <<<<<<<<<<<<<<
- * 
- * cdef void py_push_value(l, foreign_read_block *rb, int value_type, int cookie, bint iskey) except *:
- */
-  __pyx_r = __pyx_v_p;
-  goto __pyx_L0;
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":155
- *     return userdata
+  /* "src/cy_src/skynet_py_mq.pyx":15
  * 
- * cdef char * py_get_string(foreign_read_block *rb, int value_type, int cookie, size_t *out) except NULL:             # <<<<<<<<<<<<<<
- *     cdef char * p = NULL
- *     cdef uint16_t *plen2
- */
-
-  /* function exit code */
-  __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_2);
-  __Pyx_AddTraceback("pyskynet.skynet_py_foreign_seri.py_get_string", __pyx_clineno, __pyx_lineno, __pyx_filename);
-  __pyx_r = NULL;
-  __pyx_L0:;
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-/* "src/cy_src/skynet_py_foreign_seri.pyx":177
- *     return p
+ * cdef void free_pyptr(object capsule):
+ *     cdef void *ptr = PyCapsule_GetPointer(capsule, "pyptr")             # <<<<<<<<<<<<<<
+ *     skynet_free(ptr)
  * 
- * cdef void py_push_value(l, foreign_read_block *rb, int value_type, int cookie, bint iskey) except *:             # <<<<<<<<<<<<<<
- *     cdef char * ptr = NULL
- *     cdef size_t length = 0
  */
+  __pyx_t_1 = PyCapsule_GetPointer(__pyx_v_capsule, ((char const *)"pyptr")); if (unlikely(__pyx_t_1 == ((void *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 15, __pyx_L1_error)
+  __pyx_v_ptr = __pyx_t_1;
 
-static void __pyx_f_8pyskynet_22skynet_py_foreign_seri_py_push_value(PyObject *__pyx_v_l, struct foreign_read_block *__pyx_v_rb, int __pyx_v_value_type, int __pyx_v_cookie, CYTHON_UNUSED int __pyx_v_iskey) {
-  char *__pyx_v_ptr;
-  size_t __pyx_v_length;
-  void *__pyx_v_lightuserdata;
-  CYTHON_UNUSED struct skynet_foreign *__pyx_v_foreign_obj;
-  PyObject *__pyx_v_arr = NULL;
-  __Pyx_RefNannyDeclarations
-  int __pyx_t_1;
-  PyObject *__pyx_t_2 = NULL;
-  int __pyx_t_3;
-  double __pyx_t_4;
-  lua_Integer __pyx_t_5;
-  char *__pyx_t_6;
-  void *__pyx_t_7;
-  int __pyx_t_8;
-  int __pyx_lineno = 0;
-  const char *__pyx_filename = NULL;
-  int __pyx_clineno = 0;
-  __Pyx_RefNannySetupContext("py_push_value", 0);
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":178
+  /* "src/cy_src/skynet_py_mq.pyx":16
+ * cdef void free_pyptr(object capsule):
+ *     cdef void *ptr = PyCapsule_GetPointer(capsule, "pyptr")
+ *     skynet_free(ptr)             # <<<<<<<<<<<<<<
  * 
- * cdef void py_push_value(l, foreign_read_block *rb, int value_type, int cookie, bint iskey) except *:
- *     cdef char * ptr = NULL             # <<<<<<<<<<<<<<
- *     cdef size_t length = 0
- *     cdef void * lightuserdata = NULL
- */
-  __pyx_v_ptr = NULL;
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":179
- * cdef void py_push_value(l, foreign_read_block *rb, int value_type, int cookie, bint iskey) except *:
- *     cdef char * ptr = NULL
- *     cdef size_t length = 0             # <<<<<<<<<<<<<<
- *     cdef void * lightuserdata = NULL
- *     cdef skynet_foreign * foreign_obj = NULL
- */
-  __pyx_v_length = 0;
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":180
- *     cdef char * ptr = NULL
- *     cdef size_t length = 0
- *     cdef void * lightuserdata = NULL             # <<<<<<<<<<<<<<
- *     cdef skynet_foreign * foreign_obj = NULL
- *     if value_type == TYPE_NIL:
- */
-  __pyx_v_lightuserdata = NULL;
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":181
- *     cdef size_t length = 0
- *     cdef void * lightuserdata = NULL
- *     cdef skynet_foreign * foreign_obj = NULL             # <<<<<<<<<<<<<<
- *     if value_type == TYPE_NIL:
- *         l.append(None)
- */
-  __pyx_v_foreign_obj = NULL;
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":182
- *     cdef void * lightuserdata = NULL
- *     cdef skynet_foreign * foreign_obj = NULL
- *     if value_type == TYPE_NIL:             # <<<<<<<<<<<<<<
- *         l.append(None)
- *     elif value_type == TYPE_BOOLEAN:
- */
-  switch (__pyx_v_value_type) {
-    case TYPE_NIL:
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":183
- *     cdef skynet_foreign * foreign_obj = NULL
- *     if value_type == TYPE_NIL:
- *         l.append(None)             # <<<<<<<<<<<<<<
- *     elif value_type == TYPE_BOOLEAN:
- *         l.append(cookie>0)
- */
-    __pyx_t_1 = __Pyx_PyObject_Append(__pyx_v_l, Py_None); if (unlikely(__pyx_t_1 == ((int)-1))) __PYX_ERR(0, 183, __pyx_L1_error)
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":182
- *     cdef void * lightuserdata = NULL
- *     cdef skynet_foreign * foreign_obj = NULL
- *     if value_type == TYPE_NIL:             # <<<<<<<<<<<<<<
- *         l.append(None)
- *     elif value_type == TYPE_BOOLEAN:
- */
-    break;
-    case TYPE_BOOLEAN:
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":185
- *         l.append(None)
- *     elif value_type == TYPE_BOOLEAN:
- *         l.append(cookie>0)             # <<<<<<<<<<<<<<
- *     elif value_type == TYPE_NUMBER:
- *         if (cookie == TYPE_NUMBER_REAL):
- */
-    __pyx_t_2 = __Pyx_PyBool_FromLong((__pyx_v_cookie > 0)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 185, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_1 = __Pyx_PyObject_Append(__pyx_v_l, __pyx_t_2); if (unlikely(__pyx_t_1 == ((int)-1))) __PYX_ERR(0, 185, __pyx_L1_error)
-    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":184
- *     if value_type == TYPE_NIL:
- *         l.append(None)
- *     elif value_type == TYPE_BOOLEAN:             # <<<<<<<<<<<<<<
- *         l.append(cookie>0)
- *     elif value_type == TYPE_NUMBER:
- */
-    break;
-    case TYPE_NUMBER:
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":187
- *         l.append(cookie>0)
- *     elif value_type == TYPE_NUMBER:
- *         if (cookie == TYPE_NUMBER_REAL):             # <<<<<<<<<<<<<<
- *             l.append(py_get_real(rb))
- *         else:
- */
-    __pyx_t_3 = ((__pyx_v_cookie == TYPE_NUMBER_REAL) != 0);
-    if (__pyx_t_3) {
-
-      /* "src/cy_src/skynet_py_foreign_seri.pyx":188
- *     elif value_type == TYPE_NUMBER:
- *         if (cookie == TYPE_NUMBER_REAL):
- *             l.append(py_get_real(rb))             # <<<<<<<<<<<<<<
- *         else:
- *             l.append(py_get_integer(rb, cookie))
- */
-      __pyx_t_4 = __pyx_f_8pyskynet_22skynet_py_foreign_seri_py_get_real(__pyx_v_rb); if (unlikely(__pyx_t_4 == ((double)-1) && PyErr_Occurred())) __PYX_ERR(0, 188, __pyx_L1_error)
-      __pyx_t_2 = PyFloat_FromDouble(__pyx_t_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 188, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_2);
-      __pyx_t_1 = __Pyx_PyObject_Append(__pyx_v_l, __pyx_t_2); if (unlikely(__pyx_t_1 == ((int)-1))) __PYX_ERR(0, 188, __pyx_L1_error)
-      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-
-      /* "src/cy_src/skynet_py_foreign_seri.pyx":187
- *         l.append(cookie>0)
- *     elif value_type == TYPE_NUMBER:
- *         if (cookie == TYPE_NUMBER_REAL):             # <<<<<<<<<<<<<<
- *             l.append(py_get_real(rb))
- *         else:
- */
-      goto __pyx_L3;
-    }
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":190
- *             l.append(py_get_real(rb))
- *         else:
- *             l.append(py_get_integer(rb, cookie))             # <<<<<<<<<<<<<<
- *     elif value_type==TYPE_SHORT_STRING:
- *         ptr = py_get_string(rb, value_type, cookie, &length)
- */
-    /*else*/ {
-      __pyx_t_5 = __pyx_f_8pyskynet_22skynet_py_foreign_seri_py_get_integer(__pyx_v_rb, __pyx_v_cookie); if (unlikely(__pyx_t_5 == ((lua_Integer)-1) && PyErr_Occurred())) __PYX_ERR(0, 190, __pyx_L1_error)
-      __pyx_t_2 = __Pyx_PyInt_From_lua_Integer(__pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 190, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_2);
-      __pyx_t_1 = __Pyx_PyObject_Append(__pyx_v_l, __pyx_t_2); if (unlikely(__pyx_t_1 == ((int)-1))) __PYX_ERR(0, 190, __pyx_L1_error)
-      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    }
-    __pyx_L3:;
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":186
- *     elif value_type == TYPE_BOOLEAN:
- *         l.append(cookie>0)
- *     elif value_type == TYPE_NUMBER:             # <<<<<<<<<<<<<<
- *         if (cookie == TYPE_NUMBER_REAL):
- *             l.append(py_get_real(rb))
- */
-    break;
-    case TYPE_SHORT_STRING:
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":192
- *             l.append(py_get_integer(rb, cookie))
- *     elif value_type==TYPE_SHORT_STRING:
- *         ptr = py_get_string(rb, value_type, cookie, &length)             # <<<<<<<<<<<<<<
- *         #if iskey:
- *             #l.append(PyUnicode_DecodeUTF8(ptr, length, NULL))
- */
-    __pyx_t_6 = __pyx_f_8pyskynet_22skynet_py_foreign_seri_py_get_string(__pyx_v_rb, __pyx_v_value_type, __pyx_v_cookie, (&__pyx_v_length)); if (unlikely(__pyx_t_6 == ((char *)NULL))) __PYX_ERR(0, 192, __pyx_L1_error)
-    __pyx_v_ptr = __pyx_t_6;
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":196
- *             #l.append(PyUnicode_DecodeUTF8(ptr, length, NULL))
- *         #else:
- *         l.append(PyBytes_FromStringAndSize(ptr, length))             # <<<<<<<<<<<<<<
- *     elif value_type==TYPE_LONG_STRING:
- *         ptr = py_get_string(rb, value_type, cookie, &length)
- */
-    __pyx_t_2 = PyBytes_FromStringAndSize(__pyx_v_ptr, __pyx_v_length); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 196, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_1 = __Pyx_PyObject_Append(__pyx_v_l, __pyx_t_2); if (unlikely(__pyx_t_1 == ((int)-1))) __PYX_ERR(0, 196, __pyx_L1_error)
-    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":191
- *         else:
- *             l.append(py_get_integer(rb, cookie))
- *     elif value_type==TYPE_SHORT_STRING:             # <<<<<<<<<<<<<<
- *         ptr = py_get_string(rb, value_type, cookie, &length)
- *         #if iskey:
- */
-    break;
-    case TYPE_LONG_STRING:
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":198
- *         l.append(PyBytes_FromStringAndSize(ptr, length))
- *     elif value_type==TYPE_LONG_STRING:
- *         ptr = py_get_string(rb, value_type, cookie, &length)             # <<<<<<<<<<<<<<
- *         #if iskey:
- *             #l.append(PyUnicode_DecodeUTF8(ptr, length, NULL))
- */
-    __pyx_t_6 = __pyx_f_8pyskynet_22skynet_py_foreign_seri_py_get_string(__pyx_v_rb, __pyx_v_value_type, __pyx_v_cookie, (&__pyx_v_length)); if (unlikely(__pyx_t_6 == ((char *)NULL))) __PYX_ERR(0, 198, __pyx_L1_error)
-    __pyx_v_ptr = __pyx_t_6;
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":202
- *             #l.append(PyUnicode_DecodeUTF8(ptr, length, NULL))
- *         #else:
- *         l.append(PyBytes_FromStringAndSize(ptr, length))             # <<<<<<<<<<<<<<
- *     elif value_type==TYPE_TABLE:
- *         py_unpack_table(l, rb, cookie)
- */
-    __pyx_t_2 = PyBytes_FromStringAndSize(__pyx_v_ptr, __pyx_v_length); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 202, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_1 = __Pyx_PyObject_Append(__pyx_v_l, __pyx_t_2); if (unlikely(__pyx_t_1 == ((int)-1))) __PYX_ERR(0, 202, __pyx_L1_error)
-    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":197
- *         #else:
- *         l.append(PyBytes_FromStringAndSize(ptr, length))
- *     elif value_type==TYPE_LONG_STRING:             # <<<<<<<<<<<<<<
- *         ptr = py_get_string(rb, value_type, cookie, &length)
- *         #if iskey:
- */
-    break;
-    case TYPE_TABLE:
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":204
- *         l.append(PyBytes_FromStringAndSize(ptr, length))
- *     elif value_type==TYPE_TABLE:
- *         py_unpack_table(l, rb, cookie)             # <<<<<<<<<<<<<<
- *     elif value_type==TYPE_USERDATA:
- *         lightuserdata = py_get_pointer(rb)
- */
-    __pyx_f_8pyskynet_22skynet_py_foreign_seri_py_unpack_table(__pyx_v_l, __pyx_v_rb, __pyx_v_cookie); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 204, __pyx_L1_error)
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":203
- *         #else:
- *         l.append(PyBytes_FromStringAndSize(ptr, length))
- *     elif value_type==TYPE_TABLE:             # <<<<<<<<<<<<<<
- *         py_unpack_table(l, rb, cookie)
- *     elif value_type==TYPE_USERDATA:
- */
-    break;
-    case TYPE_USERDATA:
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":206
- *         py_unpack_table(l, rb, cookie)
- *     elif value_type==TYPE_USERDATA:
- *         lightuserdata = py_get_pointer(rb)             # <<<<<<<<<<<<<<
- *         l.append(PyCapsule_New(lightuserdata, "cptr", NULL))
- *     elif value_type==TYPE_FOREIGN_USERDATA:
- */
-    __pyx_t_7 = __pyx_f_8pyskynet_22skynet_py_foreign_seri_py_get_pointer(__pyx_v_rb); if (unlikely(__pyx_t_7 == ((void *)NULL))) __PYX_ERR(0, 206, __pyx_L1_error)
-    __pyx_v_lightuserdata = __pyx_t_7;
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":207
- *     elif value_type==TYPE_USERDATA:
- *         lightuserdata = py_get_pointer(rb)
- *         l.append(PyCapsule_New(lightuserdata, "cptr", NULL))             # <<<<<<<<<<<<<<
- *     elif value_type==TYPE_FOREIGN_USERDATA:
- *         arr = unpack_PyArray(rb, cookie)
- */
-    __pyx_t_2 = PyCapsule_New(__pyx_v_lightuserdata, ((char *)"cptr"), NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 207, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_1 = __Pyx_PyObject_Append(__pyx_v_l, __pyx_t_2); if (unlikely(__pyx_t_1 == ((int)-1))) __PYX_ERR(0, 207, __pyx_L1_error)
-    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":205
- *     elif value_type==TYPE_TABLE:
- *         py_unpack_table(l, rb, cookie)
- *     elif value_type==TYPE_USERDATA:             # <<<<<<<<<<<<<<
- *         lightuserdata = py_get_pointer(rb)
- *         l.append(PyCapsule_New(lightuserdata, "cptr", NULL))
- */
-    break;
-    case TYPE_FOREIGN_USERDATA:
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":209
- *         l.append(PyCapsule_New(lightuserdata, "cptr", NULL))
- *     elif value_type==TYPE_FOREIGN_USERDATA:
- *         arr = unpack_PyArray(rb, cookie)             # <<<<<<<<<<<<<<
- *         if arr is None:
- *             raise Exception("invalid stream when unpacking arr")
- */
-    __pyx_t_2 = unpack_PyArray(__pyx_v_rb, __pyx_v_cookie); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 209, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_2);
-    __pyx_v_arr = __pyx_t_2;
-    __pyx_t_2 = 0;
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":210
- *     elif value_type==TYPE_FOREIGN_USERDATA:
- *         arr = unpack_PyArray(rb, cookie)
- *         if arr is None:             # <<<<<<<<<<<<<<
- *             raise Exception("invalid stream when unpacking arr")
- *         l.append(arr)
- */
-    __pyx_t_3 = (__pyx_v_arr == Py_None);
-    __pyx_t_8 = (__pyx_t_3 != 0);
-    if (unlikely(__pyx_t_8)) {
-
-      /* "src/cy_src/skynet_py_foreign_seri.pyx":211
- *         arr = unpack_PyArray(rb, cookie)
- *         if arr is None:
- *             raise Exception("invalid stream when unpacking arr")             # <<<<<<<<<<<<<<
- *         l.append(arr)
- *     else:
+ * def crecv():
  */
-      __pyx_t_2 = __Pyx_PyObject_Call(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])), __pyx_tuple__2, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 211, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_2);
-      __Pyx_Raise(__pyx_t_2, 0, 0, 0);
-      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-      __PYX_ERR(0, 211, __pyx_L1_error)
-
-      /* "src/cy_src/skynet_py_foreign_seri.pyx":210
- *     elif value_type==TYPE_FOREIGN_USERDATA:
- *         arr = unpack_PyArray(rb, cookie)
- *         if arr is None:             # <<<<<<<<<<<<<<
- *             raise Exception("invalid stream when unpacking arr")
- *         l.append(arr)
- */
-    }
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":212
- *         if arr is None:
- *             raise Exception("invalid stream when unpacking arr")
- *         l.append(arr)             # <<<<<<<<<<<<<<
- *     else:
- *         raise Exception("invalid stream for value type exception")
- */
-    __pyx_t_1 = __Pyx_PyObject_Append(__pyx_v_l, __pyx_v_arr); if (unlikely(__pyx_t_1 == ((int)-1))) __PYX_ERR(0, 212, __pyx_L1_error)
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":208
- *         lightuserdata = py_get_pointer(rb)
- *         l.append(PyCapsule_New(lightuserdata, "cptr", NULL))
- *     elif value_type==TYPE_FOREIGN_USERDATA:             # <<<<<<<<<<<<<<
- *         arr = unpack_PyArray(rb, cookie)
- *         if arr is None:
- */
-    break;
-    default:
+  skynet_free(__pyx_v_ptr);
 
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":214
- *         l.append(arr)
- *     else:
- *         raise Exception("invalid stream for value type exception")             # <<<<<<<<<<<<<<
+  /* "src/cy_src/skynet_py_mq.pyx":14
  * 
- * cdef void py_unpack_one(l, foreign_read_block *rb, bint iskey) except *:
- */
-    __pyx_t_2 = __Pyx_PyObject_Call(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])), __pyx_tuple__3, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 214, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_2);
-    __Pyx_Raise(__pyx_t_2, 0, 0, 0);
-    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __PYX_ERR(0, 214, __pyx_L1_error)
-    break;
-  }
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":177
- *     return p
  * 
- * cdef void py_push_value(l, foreign_read_block *rb, int value_type, int cookie, bint iskey) except *:             # <<<<<<<<<<<<<<
- *     cdef char * ptr = NULL
- *     cdef size_t length = 0
+ * cdef void free_pyptr(object capsule):             # <<<<<<<<<<<<<<
+ *     cdef void *ptr = PyCapsule_GetPointer(capsule, "pyptr")
+ *     skynet_free(ptr)
  */
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_2);
-  __Pyx_AddTraceback("pyskynet.skynet_py_foreign_seri.py_push_value", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_WriteUnraisable("pyskynet.skynet_py_mq.free_pyptr", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
   __pyx_L0:;
-  __Pyx_XDECREF(__pyx_v_arr);
   __Pyx_RefNannyFinishContext();
 }
 
-/* "src/cy_src/skynet_py_foreign_seri.pyx":216
- *         raise Exception("invalid stream for value type exception")
+/* "src/cy_src/skynet_py_mq.pyx":18
+ *     skynet_free(ptr)
  * 
- * cdef void py_unpack_one(l, foreign_read_block *rb, bint iskey) except *:             # <<<<<<<<<<<<<<
- *     cdef uint8_t value_type
- *     cdef uint8_t *value_ptr = <uint8_t*>foreign_rb_read(rb, sizeof(value_type));
+ * def crecv():             # <<<<<<<<<<<<<<
+ *     cdef SkynetPyMessage msg
+ *     cdef int ret = skynet_py_queue_pop(&msg)
  */
 
-static void __pyx_f_8pyskynet_22skynet_py_foreign_seri_py_unpack_one(PyObject *__pyx_v_l, struct foreign_read_block *__pyx_v_rb, int __pyx_v_iskey) {
-  uint8_t __pyx_v_value_type;
-  uint8_t *__pyx_v_value_ptr;
+/* Python wrapper */
+static PyObject *__pyx_pw_8pyskynet_12skynet_py_mq_1crecv(PyObject *__pyx_self, CYTHON_UNUSED PyObject *unused); /*proto*/
+static PyMethodDef __pyx_mdef_8pyskynet_12skynet_py_mq_1crecv = {"crecv", (PyCFunction)__pyx_pw_8pyskynet_12skynet_py_mq_1crecv, METH_NOARGS, 0};
+static PyObject *__pyx_pw_8pyskynet_12skynet_py_mq_1crecv(PyObject *__pyx_self, CYTHON_UNUSED PyObject *unused) {
+  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_VARARGS(__pyx_args, __pyx_nargs);
+  PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
-  int __pyx_t_1;
-  PyObject *__pyx_t_2 = NULL;
-  int __pyx_lineno = 0;
-  const char *__pyx_filename = NULL;
-  int __pyx_clineno = 0;
-  __Pyx_RefNannySetupContext("py_unpack_one", 0);
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":218
- * cdef void py_unpack_one(l, foreign_read_block *rb, bint iskey) except *:
- *     cdef uint8_t value_type
- *     cdef uint8_t *value_ptr = <uint8_t*>foreign_rb_read(rb, sizeof(value_type));             # <<<<<<<<<<<<<<
- *     if value_ptr == NULL:
- *         raise Exception("invalid stream")
- */
-  __pyx_v_value_ptr = ((uint8_t *)foreign_rb_read(__pyx_v_rb, (sizeof(__pyx_v_value_type))));
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":219
- *     cdef uint8_t value_type
- *     cdef uint8_t *value_ptr = <uint8_t*>foreign_rb_read(rb, sizeof(value_type));
- *     if value_ptr == NULL:             # <<<<<<<<<<<<<<
- *         raise Exception("invalid stream")
- *     value_type = value_ptr[0]
- */
-  __pyx_t_1 = ((__pyx_v_value_ptr == NULL) != 0);
-  if (unlikely(__pyx_t_1)) {
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":220
- *     cdef uint8_t *value_ptr = <uint8_t*>foreign_rb_read(rb, sizeof(value_type));
- *     if value_ptr == NULL:
- *         raise Exception("invalid stream")             # <<<<<<<<<<<<<<
- *     value_type = value_ptr[0]
- *     py_push_value(l, rb, value_type & 0x7, value_type>>3, iskey);
- */
-    __pyx_t_2 = __Pyx_PyObject_Call(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])), __pyx_tuple_, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 220, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_2);
-    __Pyx_Raise(__pyx_t_2, 0, 0, 0);
-    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __PYX_ERR(0, 220, __pyx_L1_error)
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":219
- *     cdef uint8_t value_type
- *     cdef uint8_t *value_ptr = <uint8_t*>foreign_rb_read(rb, sizeof(value_type));
- *     if value_ptr == NULL:             # <<<<<<<<<<<<<<
- *         raise Exception("invalid stream")
- *     value_type = value_ptr[0]
- */
-  }
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":221
- *     if value_ptr == NULL:
- *         raise Exception("invalid stream")
- *     value_type = value_ptr[0]             # <<<<<<<<<<<<<<
- *     py_push_value(l, rb, value_type & 0x7, value_type>>3, iskey);
- * 
- */
-  __pyx_v_value_type = (__pyx_v_value_ptr[0]);
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":222
- *         raise Exception("invalid stream")
- *     value_type = value_ptr[0]
- *     py_push_value(l, rb, value_type & 0x7, value_type>>3, iskey);             # <<<<<<<<<<<<<<
- * 
- * cdef void py_unpack_table(l, foreign_read_block *rb, int array_size) except *:
- */
-  __pyx_f_8pyskynet_22skynet_py_foreign_seri_py_push_value(__pyx_v_l, __pyx_v_rb, (__pyx_v_value_type & 0x7), (__pyx_v_value_type >> 3), __pyx_v_iskey); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 222, __pyx_L1_error)
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":216
- *         raise Exception("invalid stream for value type exception")
- * 
- * cdef void py_unpack_one(l, foreign_read_block *rb, bint iskey) except *:             # <<<<<<<<<<<<<<
- *     cdef uint8_t value_type
- *     cdef uint8_t *value_ptr = <uint8_t*>foreign_rb_read(rb, sizeof(value_type));
- */
+  __Pyx_RefNannySetupContext("crecv (wrapper)", 0);
+  __pyx_r = __pyx_pf_8pyskynet_12skynet_py_mq_crecv(__pyx_self);
 
   /* function exit code */
-  goto __pyx_L0;
-  __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_2);
-  __Pyx_AddTraceback("pyskynet.skynet_py_foreign_seri.py_unpack_one", __pyx_clineno, __pyx_lineno, __pyx_filename);
-  __pyx_L0:;
   __Pyx_RefNannyFinishContext();
+  return __pyx_r;
 }
 
-/* "src/cy_src/skynet_py_foreign_seri.pyx":224
- *     py_push_value(l, rb, value_type & 0x7, value_type>>3, iskey);
- * 
- * cdef void py_unpack_table(l, foreign_read_block *rb, int array_size) except *:             # <<<<<<<<<<<<<<
- *     cdef uint8_t value_type
- *     cdef uint8_t *value_ptr
- */
-
-static void __pyx_f_8pyskynet_22skynet_py_foreign_seri_py_unpack_table(PyObject *__pyx_v_l, struct foreign_read_block *__pyx_v_rb, int __pyx_v_array_size) {
-  uint8_t __pyx_v_value_type;
-  uint8_t *__pyx_v_value_ptr;
-  int __pyx_v_cookie;
-  PyObject *__pyx_v_next_l = NULL;
-  PyObject *__pyx_v_i = NULL;
-  PyObject *__pyx_v_next_t = NULL;
-  PyObject *__pyx_v_v = NULL;
+static PyObject *__pyx_pf_8pyskynet_12skynet_py_mq_crecv(CYTHON_UNUSED PyObject *__pyx_self) {
+  struct SkynetPyMessage __pyx_v_msg;
+  int __pyx_v_ret;
+  PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   int __pyx_t_1;
-  PyObject *__pyx_t_2 = NULL;
-  int __pyx_t_3;
-  lua_Integer __pyx_t_4;
+  int __pyx_t_2;
+  PyObject *__pyx_t_3 = NULL;
+  PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
-  Py_ssize_t __pyx_t_6;
-  PyObject *(*__pyx_t_7)(PyObject *);
-  int __pyx_t_8;
-  PyObject *__pyx_t_9 = NULL;
+  PyObject *__pyx_t_6 = NULL;
+  PyObject *__pyx_t_7 = NULL;
+  PyObject *__pyx_t_8 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
-  __Pyx_RefNannySetupContext("py_unpack_table", 0);
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":228
- *     cdef uint8_t *value_ptr
- *     cdef int cookie
- *     if array_size == MAX_COOKIE-1:             # <<<<<<<<<<<<<<
- *         value_ptr = <uint8_t *>foreign_rb_read(rb, sizeof(value_type))
- *         if value_ptr == NULL:
- */
-  __pyx_t_1 = ((__pyx_v_array_size == (MAX_COOKIE - 1)) != 0);
-  if (__pyx_t_1) {
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":229
- *     cdef int cookie
- *     if array_size == MAX_COOKIE-1:
- *         value_ptr = <uint8_t *>foreign_rb_read(rb, sizeof(value_type))             # <<<<<<<<<<<<<<
- *         if value_ptr == NULL:
- *             raise Exception("invalid stream")
- */
-    __pyx_v_value_ptr = ((uint8_t *)foreign_rb_read(__pyx_v_rb, (sizeof(__pyx_v_value_type))));
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":230
- *     if array_size == MAX_COOKIE-1:
- *         value_ptr = <uint8_t *>foreign_rb_read(rb, sizeof(value_type))
- *         if value_ptr == NULL:             # <<<<<<<<<<<<<<
- *             raise Exception("invalid stream")
- *         value_type=value_ptr[0]
- */
-    __pyx_t_1 = ((__pyx_v_value_ptr == NULL) != 0);
-    if (unlikely(__pyx_t_1)) {
-
-      /* "src/cy_src/skynet_py_foreign_seri.pyx":231
- *         value_ptr = <uint8_t *>foreign_rb_read(rb, sizeof(value_type))
- *         if value_ptr == NULL:
- *             raise Exception("invalid stream")             # <<<<<<<<<<<<<<
- *         value_type=value_ptr[0]
- *         cookie = value_type>>3
- */
-      __pyx_t_2 = __Pyx_PyObject_Call(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])), __pyx_tuple_, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 231, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_2);
-      __Pyx_Raise(__pyx_t_2, 0, 0, 0);
-      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-      __PYX_ERR(0, 231, __pyx_L1_error)
-
-      /* "src/cy_src/skynet_py_foreign_seri.pyx":230
- *     if array_size == MAX_COOKIE-1:
- *         value_ptr = <uint8_t *>foreign_rb_read(rb, sizeof(value_type))
- *         if value_ptr == NULL:             # <<<<<<<<<<<<<<
- *             raise Exception("invalid stream")
- *         value_type=value_ptr[0]
- */
-    }
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":232
- *         if value_ptr == NULL:
- *             raise Exception("invalid stream")
- *         value_type=value_ptr[0]             # <<<<<<<<<<<<<<
- *         cookie = value_type>>3
- *         if (value_type & 7) != TYPE_NUMBER or cookie == TYPE_NUMBER_REAL:
- */
-    __pyx_v_value_type = (__pyx_v_value_ptr[0]);
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":233
- *             raise Exception("invalid stream")
- *         value_type=value_ptr[0]
- *         cookie = value_type>>3             # <<<<<<<<<<<<<<
- *         if (value_type & 7) != TYPE_NUMBER or cookie == TYPE_NUMBER_REAL:
- *             raise Exception("invalid stream")
- */
-    __pyx_v_cookie = (__pyx_v_value_type >> 3);
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":234
- *         value_type=value_ptr[0]
- *         cookie = value_type>>3
- *         if (value_type & 7) != TYPE_NUMBER or cookie == TYPE_NUMBER_REAL:             # <<<<<<<<<<<<<<
- *             raise Exception("invalid stream")
- *         array_size = py_get_integer(rb, cookie)
- */
-    __pyx_t_3 = (((__pyx_v_value_type & 7) != TYPE_NUMBER) != 0);
-    if (!__pyx_t_3) {
-    } else {
-      __pyx_t_1 = __pyx_t_3;
-      goto __pyx_L6_bool_binop_done;
-    }
-    __pyx_t_3 = ((__pyx_v_cookie == TYPE_NUMBER_REAL) != 0);
-    __pyx_t_1 = __pyx_t_3;
-    __pyx_L6_bool_binop_done:;
-    if (unlikely(__pyx_t_1)) {
-
-      /* "src/cy_src/skynet_py_foreign_seri.pyx":235
- *         cookie = value_type>>3
- *         if (value_type & 7) != TYPE_NUMBER or cookie == TYPE_NUMBER_REAL:
- *             raise Exception("invalid stream")             # <<<<<<<<<<<<<<
- *         array_size = py_get_integer(rb, cookie)
- *     #l.append(t)
- */
-      __pyx_t_2 = __Pyx_PyObject_Call(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])), __pyx_tuple_, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 235, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_2);
-      __Pyx_Raise(__pyx_t_2, 0, 0, 0);
-      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-      __PYX_ERR(0, 235, __pyx_L1_error)
-
-      /* "src/cy_src/skynet_py_foreign_seri.pyx":234
- *         value_type=value_ptr[0]
- *         cookie = value_type>>3
- *         if (value_type & 7) != TYPE_NUMBER or cookie == TYPE_NUMBER_REAL:             # <<<<<<<<<<<<<<
- *             raise Exception("invalid stream")
- *         array_size = py_get_integer(rb, cookie)
- */
-    }
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":236
- *         if (value_type & 7) != TYPE_NUMBER or cookie == TYPE_NUMBER_REAL:
- *             raise Exception("invalid stream")
- *         array_size = py_get_integer(rb, cookie)             # <<<<<<<<<<<<<<
- *     #l.append(t)
- *     next_l = []
- */
-    __pyx_t_4 = __pyx_f_8pyskynet_22skynet_py_foreign_seri_py_get_integer(__pyx_v_rb, __pyx_v_cookie); if (unlikely(__pyx_t_4 == ((lua_Integer)-1) && PyErr_Occurred())) __PYX_ERR(0, 236, __pyx_L1_error)
-    __pyx_v_array_size = __pyx_t_4;
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":228
- *     cdef uint8_t *value_ptr
- *     cdef int cookie
- *     if array_size == MAX_COOKIE-1:             # <<<<<<<<<<<<<<
- *         value_ptr = <uint8_t *>foreign_rb_read(rb, sizeof(value_type))
- *         if value_ptr == NULL:
- */
-  }
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":238
- *         array_size = py_get_integer(rb, cookie)
- *     #l.append(t)
- *     next_l = []             # <<<<<<<<<<<<<<
- *     for i in range(1, array_size+1):
- *         py_unpack_one(next_l, rb, 0)
- */
-  __pyx_t_2 = PyList_New(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 238, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  __pyx_v_next_l = ((PyObject*)__pyx_t_2);
-  __pyx_t_2 = 0;
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":239
- *     #l.append(t)
- *     next_l = []
- *     for i in range(1, array_size+1):             # <<<<<<<<<<<<<<
- *         py_unpack_one(next_l, rb, 0)
- *     next_t = {}
- */
-  __pyx_t_2 = __Pyx_PyInt_From_long((__pyx_v_array_size + 1)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 239, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_5 = PyTuple_New(2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 239, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_INCREF(__pyx_int_1);
-  __Pyx_GIVEREF(__pyx_int_1);
-  PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_int_1);
-  __Pyx_GIVEREF(__pyx_t_2);
-  PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_2);
-  __pyx_t_2 = 0;
-  __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_range, __pyx_t_5, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 239, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (likely(PyList_CheckExact(__pyx_t_2)) || PyTuple_CheckExact(__pyx_t_2)) {
-    __pyx_t_5 = __pyx_t_2; __Pyx_INCREF(__pyx_t_5); __pyx_t_6 = 0;
-    __pyx_t_7 = NULL;
-  } else {
-    __pyx_t_6 = -1; __pyx_t_5 = PyObject_GetIter(__pyx_t_2); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 239, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_7 = Py_TYPE(__pyx_t_5)->tp_iternext; if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 239, __pyx_L1_error)
-  }
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  for (;;) {
-    if (likely(!__pyx_t_7)) {
-      if (likely(PyList_CheckExact(__pyx_t_5))) {
-        if (__pyx_t_6 >= PyList_GET_SIZE(__pyx_t_5)) break;
-        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_2 = PyList_GET_ITEM(__pyx_t_5, __pyx_t_6); __Pyx_INCREF(__pyx_t_2); __pyx_t_6++; if (unlikely(0 < 0)) __PYX_ERR(0, 239, __pyx_L1_error)
-        #else
-        __pyx_t_2 = PySequence_ITEM(__pyx_t_5, __pyx_t_6); __pyx_t_6++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 239, __pyx_L1_error)
-        __Pyx_GOTREF(__pyx_t_2);
-        #endif
-      } else {
-        if (__pyx_t_6 >= PyTuple_GET_SIZE(__pyx_t_5)) break;
-        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_2 = PyTuple_GET_ITEM(__pyx_t_5, __pyx_t_6); __Pyx_INCREF(__pyx_t_2); __pyx_t_6++; if (unlikely(0 < 0)) __PYX_ERR(0, 239, __pyx_L1_error)
-        #else
-        __pyx_t_2 = PySequence_ITEM(__pyx_t_5, __pyx_t_6); __pyx_t_6++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 239, __pyx_L1_error)
-        __Pyx_GOTREF(__pyx_t_2);
-        #endif
-      }
-    } else {
-      __pyx_t_2 = __pyx_t_7(__pyx_t_5);
-      if (unlikely(!__pyx_t_2)) {
-        PyObject* exc_type = PyErr_Occurred();
-        if (exc_type) {
-          if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-          else __PYX_ERR(0, 239, __pyx_L1_error)
-        }
-        break;
-      }
-      __Pyx_GOTREF(__pyx_t_2);
-    }
-    __Pyx_XDECREF_SET(__pyx_v_i, __pyx_t_2);
-    __pyx_t_2 = 0;
+  __Pyx_RefNannySetupContext("crecv", 0);
 
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":240
- *     next_l = []
- *     for i in range(1, array_size+1):
- *         py_unpack_one(next_l, rb, 0)             # <<<<<<<<<<<<<<
- *     next_t = {}
- *     while True:
- */
-    __pyx_f_8pyskynet_22skynet_py_foreign_seri_py_unpack_one(__pyx_v_next_l, __pyx_v_rb, 0); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 240, __pyx_L1_error)
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":239
- *     #l.append(t)
- *     next_l = []
- *     for i in range(1, array_size+1):             # <<<<<<<<<<<<<<
- *         py_unpack_one(next_l, rb, 0)
- *     next_t = {}
- */
-  }
-  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":241
- *     for i in range(1, array_size+1):
- *         py_unpack_one(next_l, rb, 0)
- *     next_t = {}             # <<<<<<<<<<<<<<
- *     while True:
- *         py_unpack_one(next_l, rb, 1)
- */
-  __pyx_t_5 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 241, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_5);
-  __pyx_v_next_t = ((PyObject*)__pyx_t_5);
-  __pyx_t_5 = 0;
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":242
- *         py_unpack_one(next_l, rb, 0)
- *     next_t = {}
- *     while True:             # <<<<<<<<<<<<<<
- *         py_unpack_one(next_l, rb, 1)
- *         if next_l[-1] is None:
+  /* "src/cy_src/skynet_py_mq.pyx":20
+ * def crecv():
+ *     cdef SkynetPyMessage msg
+ *     cdef int ret = skynet_py_queue_pop(&msg)             # <<<<<<<<<<<<<<
+ *     while ret == 0 and msg.type == PTYPE_DECREF_PYTHON:
+ *         Py_XDECREF(<PyObject*>msg.data)
+ */
+  __pyx_v_ret = skynet_py_queue_pop((&__pyx_v_msg));
+
+  /* "src/cy_src/skynet_py_mq.pyx":21
+ *     cdef SkynetPyMessage msg
+ *     cdef int ret = skynet_py_queue_pop(&msg)
+ *     while ret == 0 and msg.type == PTYPE_DECREF_PYTHON:             # <<<<<<<<<<<<<<
+ *         Py_XDECREF(<PyObject*>msg.data)
+ *         ret = skynet_py_queue_pop(&msg)
  */
   while (1) {
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":243
- *     next_t = {}
- *     while True:
- *         py_unpack_one(next_l, rb, 1)             # <<<<<<<<<<<<<<
- *         if next_l[-1] is None:
- *             next_l.pop()
- */
-    __pyx_f_8pyskynet_22skynet_py_foreign_seri_py_unpack_one(__pyx_v_next_l, __pyx_v_rb, 1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 243, __pyx_L1_error)
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":244
- *     while True:
- *         py_unpack_one(next_l, rb, 1)
- *         if next_l[-1] is None:             # <<<<<<<<<<<<<<
- *             next_l.pop()
- *             break
- */
-    __pyx_t_5 = __Pyx_GetItemInt_List(__pyx_v_next_l, -1L, long, 1, __Pyx_PyInt_From_long, 1, 1, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 244, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_1 = (__pyx_t_5 == Py_None);
-    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    __pyx_t_3 = (__pyx_t_1 != 0);
-    if (__pyx_t_3) {
-
-      /* "src/cy_src/skynet_py_foreign_seri.pyx":245
- *         py_unpack_one(next_l, rb, 1)
- *         if next_l[-1] is None:
- *             next_l.pop()             # <<<<<<<<<<<<<<
- *             break
- *         py_unpack_one(next_l, rb, 0)
- */
-      __pyx_t_5 = __Pyx_PyList_Pop(__pyx_v_next_l); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 245, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_5);
-      __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-
-      /* "src/cy_src/skynet_py_foreign_seri.pyx":246
- *         if next_l[-1] is None:
- *             next_l.pop()
- *             break             # <<<<<<<<<<<<<<
- *         py_unpack_one(next_l, rb, 0)
- *         next_t[next_l[-2]] = next_l[-1]
- */
-      goto __pyx_L11_break;
-
-      /* "src/cy_src/skynet_py_foreign_seri.pyx":244
- *     while True:
- *         py_unpack_one(next_l, rb, 1)
- *         if next_l[-1] is None:             # <<<<<<<<<<<<<<
- *             next_l.pop()
- *             break
- */
+    __pyx_t_2 = (__pyx_v_ret == 0);
+    if (__pyx_t_2) {
+    } else {
+      __pyx_t_1 = __pyx_t_2;
+      goto __pyx_L5_bool_binop_done;
     }
+    __pyx_t_2 = (__pyx_v_msg.type == PTYPE_DECREF_PYTHON);
+    __pyx_t_1 = __pyx_t_2;
+    __pyx_L5_bool_binop_done:;
+    if (!__pyx_t_1) break;
 
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":247
- *             next_l.pop()
- *             break
- *         py_unpack_one(next_l, rb, 0)             # <<<<<<<<<<<<<<
- *         next_t[next_l[-2]] = next_l[-1]
- *         next_l.pop()
- */
-    __pyx_f_8pyskynet_22skynet_py_foreign_seri_py_unpack_one(__pyx_v_next_l, __pyx_v_rb, 0); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 247, __pyx_L1_error)
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":248
- *             break
- *         py_unpack_one(next_l, rb, 0)
- *         next_t[next_l[-2]] = next_l[-1]             # <<<<<<<<<<<<<<
- *         next_l.pop()
- *         next_l.pop()
- */
-    __pyx_t_5 = __Pyx_GetItemInt_List(__pyx_v_next_l, -1L, long, 1, __Pyx_PyInt_From_long, 1, 1, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 248, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_2 = __Pyx_GetItemInt_List(__pyx_v_next_l, -2L, long, 1, __Pyx_PyInt_From_long, 1, 1, 1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 248, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_2);
-    if (unlikely(PyDict_SetItem(__pyx_v_next_t, __pyx_t_2, __pyx_t_5) < 0)) __PYX_ERR(0, 248, __pyx_L1_error)
-    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":249
- *         py_unpack_one(next_l, rb, 0)
- *         next_t[next_l[-2]] = next_l[-1]
- *         next_l.pop()             # <<<<<<<<<<<<<<
- *         next_l.pop()
- *     if not next_t:
- */
-    __pyx_t_5 = __Pyx_PyList_Pop(__pyx_v_next_l); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 249, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_5);
-    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":250
- *         next_t[next_l[-2]] = next_l[-1]
- *         next_l.pop()
- *         next_l.pop()             # <<<<<<<<<<<<<<
- *     if not next_t:
- *         l.append(next_l)
- */
-    __pyx_t_5 = __Pyx_PyList_Pop(__pyx_v_next_l); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 250, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_5);
-    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  }
-  __pyx_L11_break:;
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":251
- *         next_l.pop()
- *         next_l.pop()
- *     if not next_t:             # <<<<<<<<<<<<<<
- *         l.append(next_l)
+    /* "src/cy_src/skynet_py_mq.pyx":22
+ *     cdef int ret = skynet_py_queue_pop(&msg)
+ *     while ret == 0 and msg.type == PTYPE_DECREF_PYTHON:
+ *         Py_XDECREF(<PyObject*>msg.data)             # <<<<<<<<<<<<<<
+ *         ret = skynet_py_queue_pop(&msg)
+ *     if ret != 0:
+ */
+    Py_XDECREF(((PyObject *)__pyx_v_msg.data));
+
+    /* "src/cy_src/skynet_py_mq.pyx":23
+ *     while ret == 0 and msg.type == PTYPE_DECREF_PYTHON:
+ *         Py_XDECREF(<PyObject*>msg.data)
+ *         ret = skynet_py_queue_pop(&msg)             # <<<<<<<<<<<<<<
+ *     if ret != 0:
+ *         return None, None, None, None, None
+ */
+    __pyx_v_ret = skynet_py_queue_pop((&__pyx_v_msg));
+  }
+
+  /* "src/cy_src/skynet_py_mq.pyx":24
+ *         Py_XDECREF(<PyObject*>msg.data)
+ *         ret = skynet_py_queue_pop(&msg)
+ *     if ret != 0:             # <<<<<<<<<<<<<<
+ *         return None, None, None, None, None
  *     else:
  */
-  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_v_next_t); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 251, __pyx_L1_error)
-  __pyx_t_1 = ((!__pyx_t_3) != 0);
+  __pyx_t_1 = (__pyx_v_ret != 0);
   if (__pyx_t_1) {
 
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":252
- *         next_l.pop()
- *     if not next_t:
- *         l.append(next_l)             # <<<<<<<<<<<<<<
+    /* "src/cy_src/skynet_py_mq.pyx":25
+ *         ret = skynet_py_queue_pop(&msg)
+ *     if ret != 0:
+ *         return None, None, None, None, None             # <<<<<<<<<<<<<<
  *     else:
- *         for i, v in enumerate(next_l):
+ *         # TODO when msg.type is error , msg.data will be nil ?
  */
-    __pyx_t_8 = __Pyx_PyObject_Append(__pyx_v_l, __pyx_v_next_l); if (unlikely(__pyx_t_8 == ((int)-1))) __PYX_ERR(0, 252, __pyx_L1_error)
+    __Pyx_XDECREF(__pyx_r);
+    __Pyx_INCREF(__pyx_tuple_);
+    __pyx_r = __pyx_tuple_;
+    goto __pyx_L0;
 
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":251
- *         next_l.pop()
- *         next_l.pop()
- *     if not next_t:             # <<<<<<<<<<<<<<
- *         l.append(next_l)
+    /* "src/cy_src/skynet_py_mq.pyx":24
+ *         Py_XDECREF(<PyObject*>msg.data)
+ *         ret = skynet_py_queue_pop(&msg)
+ *     if ret != 0:             # <<<<<<<<<<<<<<
+ *         return None, None, None, None, None
  *     else:
  */
-    goto __pyx_L13;
   }
 
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":254
- *         l.append(next_l)
+  /* "src/cy_src/skynet_py_mq.pyx":28
  *     else:
- *         for i, v in enumerate(next_l):             # <<<<<<<<<<<<<<
- *             next_t[i + 1] = v
- *         l.append(next_t)
+ *         # TODO when msg.type is error , msg.data will be nil ?
+ *         if msg.data != NULL:             # <<<<<<<<<<<<<<
+ *             return msg.source, msg.type, msg.session, PyCapsule_New(msg.data, "pyptr", free_pyptr), msg.size
+ *         else:
  */
   /*else*/ {
-    __Pyx_INCREF(__pyx_int_0);
-    __pyx_t_5 = __pyx_int_0;
-    __pyx_t_2 = __pyx_v_next_l; __Pyx_INCREF(__pyx_t_2); __pyx_t_6 = 0;
-    for (;;) {
-      if (__pyx_t_6 >= PyList_GET_SIZE(__pyx_t_2)) break;
-      #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-      __pyx_t_9 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_6); __Pyx_INCREF(__pyx_t_9); __pyx_t_6++; if (unlikely(0 < 0)) __PYX_ERR(0, 254, __pyx_L1_error)
-      #else
-      __pyx_t_9 = PySequence_ITEM(__pyx_t_2, __pyx_t_6); __pyx_t_6++; if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 254, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_9);
-      #endif
-      __Pyx_XDECREF_SET(__pyx_v_v, __pyx_t_9);
-      __pyx_t_9 = 0;
-      __Pyx_INCREF(__pyx_t_5);
-      __Pyx_XDECREF_SET(__pyx_v_i, __pyx_t_5);
-      __pyx_t_9 = __Pyx_PyInt_AddObjC(__pyx_t_5, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 254, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_9);
-      __Pyx_DECREF(__pyx_t_5);
-      __pyx_t_5 = __pyx_t_9;
-      __pyx_t_9 = 0;
-
-      /* "src/cy_src/skynet_py_foreign_seri.pyx":255
- *     else:
- *         for i, v in enumerate(next_l):
- *             next_t[i + 1] = v             # <<<<<<<<<<<<<<
- *         l.append(next_t)
- * 
- */
-      __pyx_t_9 = __Pyx_PyInt_AddObjC(__pyx_v_i, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 255, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_9);
-      if (unlikely(PyDict_SetItem(__pyx_v_next_t, __pyx_t_9, __pyx_v_v) < 0)) __PYX_ERR(0, 255, __pyx_L1_error)
-      __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-
-      /* "src/cy_src/skynet_py_foreign_seri.pyx":254
- *         l.append(next_l)
- *     else:
- *         for i, v in enumerate(next_l):             # <<<<<<<<<<<<<<
- *             next_t[i + 1] = v
- *         l.append(next_t)
- */
-    }
-    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":256
- *         for i, v in enumerate(next_l):
- *             next_t[i + 1] = v
- *         l.append(next_t)             # <<<<<<<<<<<<<<
- * 
- * cdef void cunpack(l, char *msg, size_t size, int mode) except *:
- */
-    __pyx_t_8 = __Pyx_PyObject_Append(__pyx_v_l, __pyx_v_next_t); if (unlikely(__pyx_t_8 == ((int)-1))) __PYX_ERR(0, 256, __pyx_L1_error)
-  }
-  __pyx_L13:;
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":224
- *     py_push_value(l, rb, value_type & 0x7, value_type>>3, iskey);
- * 
- * cdef void py_unpack_table(l, foreign_read_block *rb, int array_size) except *:             # <<<<<<<<<<<<<<
- *     cdef uint8_t value_type
- *     cdef uint8_t *value_ptr
- */
-
-  /* function exit code */
-  goto __pyx_L0;
-  __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_2);
-  __Pyx_XDECREF(__pyx_t_5);
-  __Pyx_XDECREF(__pyx_t_9);
-  __Pyx_AddTraceback("pyskynet.skynet_py_foreign_seri.py_unpack_table", __pyx_clineno, __pyx_lineno, __pyx_filename);
-  __pyx_L0:;
-  __Pyx_XDECREF(__pyx_v_next_l);
-  __Pyx_XDECREF(__pyx_v_i);
-  __Pyx_XDECREF(__pyx_v_next_t);
-  __Pyx_XDECREF(__pyx_v_v);
-  __Pyx_RefNannyFinishContext();
-}
-
-/* "src/cy_src/skynet_py_foreign_seri.pyx":258
- *         l.append(next_t)
- * 
- * cdef void cunpack(l, char *msg, size_t size, int mode) except *:             # <<<<<<<<<<<<<<
- *     cdef foreign_read_block rb
- *     foreign_rball_init(&rb, msg, size, mode);
- */
-
-static void __pyx_f_8pyskynet_22skynet_py_foreign_seri_cunpack(PyObject *__pyx_v_l, char *__pyx_v_msg, size_t __pyx_v_size, int __pyx_v_mode) {
-  struct foreign_read_block __pyx_v_rb;
-  CYTHON_UNUSED int __pyx_v_i;
-  uint8_t __pyx_v_value_type;
-  uint8_t *__pyx_v_value_ptr;
-  __Pyx_RefNannyDeclarations
-  int __pyx_t_1;
-  int __pyx_lineno = 0;
-  const char *__pyx_filename = NULL;
-  int __pyx_clineno = 0;
-  __Pyx_RefNannySetupContext("cunpack", 0);
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":260
- * cdef void cunpack(l, char *msg, size_t size, int mode) except *:
- *     cdef foreign_read_block rb
- *     foreign_rball_init(&rb, msg, size, mode);             # <<<<<<<<<<<<<<
- *     cdef int i = 0
- *     cdef uint8_t value_type = 0
- */
-  foreign_rball_init((&__pyx_v_rb), __pyx_v_msg, __pyx_v_size, __pyx_v_mode);
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":261
- *     cdef foreign_read_block rb
- *     foreign_rball_init(&rb, msg, size, mode);
- *     cdef int i = 0             # <<<<<<<<<<<<<<
- *     cdef uint8_t value_type = 0
- *     cdef uint8_t *value_ptr = NULL
- */
-  __pyx_v_i = 0;
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":262
- *     foreign_rball_init(&rb, msg, size, mode);
- *     cdef int i = 0
- *     cdef uint8_t value_type = 0             # <<<<<<<<<<<<<<
- *     cdef uint8_t *value_ptr = NULL
- *     while True:
- */
-  __pyx_v_value_type = 0;
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":263
- *     cdef int i = 0
- *     cdef uint8_t value_type = 0
- *     cdef uint8_t *value_ptr = NULL             # <<<<<<<<<<<<<<
- *     while True:
- *         value_ptr = <uint8_t *>foreign_rb_read(&rb, sizeof(value_type))
- */
-  __pyx_v_value_ptr = NULL;
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":264
- *     cdef uint8_t value_type = 0
- *     cdef uint8_t *value_ptr = NULL
- *     while True:             # <<<<<<<<<<<<<<
- *         value_ptr = <uint8_t *>foreign_rb_read(&rb, sizeof(value_type))
- *         if value_ptr == NULL:
- */
-  while (1) {
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":265
- *     cdef uint8_t *value_ptr = NULL
- *     while True:
- *         value_ptr = <uint8_t *>foreign_rb_read(&rb, sizeof(value_type))             # <<<<<<<<<<<<<<
- *         if value_ptr == NULL:
- *             break
- */
-    __pyx_v_value_ptr = ((uint8_t *)foreign_rb_read((&__pyx_v_rb), (sizeof(__pyx_v_value_type))));
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":266
- *     while True:
- *         value_ptr = <uint8_t *>foreign_rb_read(&rb, sizeof(value_type))
- *         if value_ptr == NULL:             # <<<<<<<<<<<<<<
- *             break
- *         value_type = value_ptr[0]
- */
-    __pyx_t_1 = ((__pyx_v_value_ptr == NULL) != 0);
+    __pyx_t_1 = (__pyx_v_msg.data != NULL);
     if (__pyx_t_1) {
 
-      /* "src/cy_src/skynet_py_foreign_seri.pyx":267
- *         value_ptr = <uint8_t *>foreign_rb_read(&rb, sizeof(value_type))
- *         if value_ptr == NULL:
- *             break             # <<<<<<<<<<<<<<
- *         value_type = value_ptr[0]
- *         py_push_value(l, &rb, value_type & 0x7, value_type>>3, 0);
- */
-      goto __pyx_L4_break;
-
-      /* "src/cy_src/skynet_py_foreign_seri.pyx":266
- *     while True:
- *         value_ptr = <uint8_t *>foreign_rb_read(&rb, sizeof(value_type))
- *         if value_ptr == NULL:             # <<<<<<<<<<<<<<
- *             break
- *         value_type = value_ptr[0]
- */
-    }
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":268
- *         if value_ptr == NULL:
- *             break
- *         value_type = value_ptr[0]             # <<<<<<<<<<<<<<
- *         py_push_value(l, &rb, value_type & 0x7, value_type>>3, 0);
- * 
- */
-    __pyx_v_value_type = (__pyx_v_value_ptr[0]);
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":269
- *             break
- *         value_type = value_ptr[0]
- *         py_push_value(l, &rb, value_type & 0x7, value_type>>3, 0);             # <<<<<<<<<<<<<<
- * 
- * # extern
- */
-    __pyx_f_8pyskynet_22skynet_py_foreign_seri_py_push_value(__pyx_v_l, (&__pyx_v_rb), (__pyx_v_value_type & 0x7), (__pyx_v_value_type >> 3), 0); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 269, __pyx_L1_error)
-  }
-  __pyx_L4_break:;
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":258
- *         l.append(next_t)
- * 
- * cdef void cunpack(l, char *msg, size_t size, int mode) except *:             # <<<<<<<<<<<<<<
- *     cdef foreign_read_block rb
- *     foreign_rball_init(&rb, msg, size, mode);
- */
-
-  /* function exit code */
-  goto __pyx_L0;
-  __pyx_L1_error:;
-  __Pyx_AddTraceback("pyskynet.skynet_py_foreign_seri.cunpack", __pyx_clineno, __pyx_lineno, __pyx_filename);
-  __pyx_L0:;
-  __Pyx_RefNannyFinishContext();
-}
-
-/* "src/cy_src/skynet_py_foreign_seri.pyx":272
- * 
- * # extern
- * cdef py_foreign_unpack(int mode, capsule_or_bytes, py_sz):             # <<<<<<<<<<<<<<
- *     cdef const char *name
- *     cdef char *ptr
- */
-
-static PyObject *__pyx_f_8pyskynet_22skynet_py_foreign_seri_py_foreign_unpack(int __pyx_v_mode, PyObject *__pyx_v_capsule_or_bytes, PyObject *__pyx_v_py_sz) {
-  char const *__pyx_v_name;
-  char *__pyx_v_ptr;
-  size_t __pyx_v_sz;
-  PyObject *__pyx_v_l = NULL;
-  PyObject *__pyx_r = NULL;
-  __Pyx_RefNannyDeclarations
-  PyObject *__pyx_t_1 = NULL;
-  int __pyx_t_2;
-  char *__pyx_t_3;
-  void *__pyx_t_4;
-  size_t __pyx_t_5;
-  int __pyx_t_6;
-  PyObject *__pyx_t_7 = NULL;
-  int __pyx_lineno = 0;
-  const char *__pyx_filename = NULL;
-  int __pyx_clineno = 0;
-  __Pyx_RefNannySetupContext("py_foreign_unpack", 0);
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":276
- *     cdef char *ptr
- *     cdef size_t sz
- *     l = []             # <<<<<<<<<<<<<<
- *     if PyCapsule_CheckExact(capsule_or_bytes):
- *         name = PyCapsule_GetName(capsule_or_bytes)
- */
-  __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 276, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_v_l = ((PyObject*)__pyx_t_1);
-  __pyx_t_1 = 0;
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":277
- *     cdef size_t sz
- *     l = []
- *     if PyCapsule_CheckExact(capsule_or_bytes):             # <<<<<<<<<<<<<<
- *         name = PyCapsule_GetName(capsule_or_bytes)
- *         ptr = <char *>PyCapsule_GetPointer(capsule_or_bytes, name)
- */
-  __pyx_t_2 = (PyCapsule_CheckExact(__pyx_v_capsule_or_bytes) != 0);
-  if (__pyx_t_2) {
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":278
- *     l = []
- *     if PyCapsule_CheckExact(capsule_or_bytes):
- *         name = PyCapsule_GetName(capsule_or_bytes)             # <<<<<<<<<<<<<<
- *         ptr = <char *>PyCapsule_GetPointer(capsule_or_bytes, name)
- *         sz = py_sz
- */
-    __pyx_t_3 = PyCapsule_GetName(__pyx_v_capsule_or_bytes); if (unlikely(__pyx_t_3 == ((char *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 278, __pyx_L1_error)
-    __pyx_v_name = __pyx_t_3;
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":279
- *     if PyCapsule_CheckExact(capsule_or_bytes):
- *         name = PyCapsule_GetName(capsule_or_bytes)
- *         ptr = <char *>PyCapsule_GetPointer(capsule_or_bytes, name)             # <<<<<<<<<<<<<<
- *         sz = py_sz
- *         if strcmp(name, "cptr") == 0 or strcmp(name, "pyptr") == 0:
- */
-    __pyx_t_4 = PyCapsule_GetPointer(__pyx_v_capsule_or_bytes, __pyx_v_name); if (unlikely(__pyx_t_4 == ((void *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 279, __pyx_L1_error)
-    __pyx_v_ptr = ((char *)__pyx_t_4);
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":280
- *         name = PyCapsule_GetName(capsule_or_bytes)
- *         ptr = <char *>PyCapsule_GetPointer(capsule_or_bytes, name)
- *         sz = py_sz             # <<<<<<<<<<<<<<
- *         if strcmp(name, "cptr") == 0 or strcmp(name, "pyptr") == 0:
- *             cunpack(l, ptr, sz, mode)
- */
-    __pyx_t_5 = __Pyx_PyInt_As_size_t(__pyx_v_py_sz); if (unlikely((__pyx_t_5 == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 280, __pyx_L1_error)
-    __pyx_v_sz = __pyx_t_5;
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":281
- *         ptr = <char *>PyCapsule_GetPointer(capsule_or_bytes, name)
- *         sz = py_sz
- *         if strcmp(name, "cptr") == 0 or strcmp(name, "pyptr") == 0:             # <<<<<<<<<<<<<<
- *             cunpack(l, ptr, sz, mode)
- *             return tuple(l)
- */
-    __pyx_t_6 = ((strcmp(__pyx_v_name, ((char const *)"cptr")) == 0) != 0);
-    if (!__pyx_t_6) {
-    } else {
-      __pyx_t_2 = __pyx_t_6;
-      goto __pyx_L5_bool_binop_done;
-    }
-    __pyx_t_6 = ((strcmp(__pyx_v_name, ((char const *)"pyptr")) == 0) != 0);
-    __pyx_t_2 = __pyx_t_6;
-    __pyx_L5_bool_binop_done:;
-    if (likely(__pyx_t_2)) {
-
-      /* "src/cy_src/skynet_py_foreign_seri.pyx":282
- *         sz = py_sz
- *         if strcmp(name, "cptr") == 0 or strcmp(name, "pyptr") == 0:
- *             cunpack(l, ptr, sz, mode)             # <<<<<<<<<<<<<<
- *             return tuple(l)
- *         else:
- */
-      __pyx_f_8pyskynet_22skynet_py_foreign_seri_cunpack(__pyx_v_l, __pyx_v_ptr, __pyx_v_sz, __pyx_v_mode); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 282, __pyx_L1_error)
-
-      /* "src/cy_src/skynet_py_foreign_seri.pyx":283
- *         if strcmp(name, "cptr") == 0 or strcmp(name, "pyptr") == 0:
- *             cunpack(l, ptr, sz, mode)
- *             return tuple(l)             # <<<<<<<<<<<<<<
+      /* "src/cy_src/skynet_py_mq.pyx":29
+ *         # TODO when msg.type is error , msg.data will be nil ?
+ *         if msg.data != NULL:
+ *             return msg.source, msg.type, msg.session, PyCapsule_New(msg.data, "pyptr", free_pyptr), msg.size             # <<<<<<<<<<<<<<
  *         else:
- *             raise Exception("capsule unpack failed for name = %s " % PyBytes_FromString(name))
+ *             return msg.source, msg.type, msg.session, b"", 0
  */
       __Pyx_XDECREF(__pyx_r);
-      __pyx_t_1 = PyList_AsTuple(__pyx_v_l); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 283, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_1);
-      __pyx_r = __pyx_t_1;
-      __pyx_t_1 = 0;
+      __pyx_t_3 = __Pyx_PyInt_From_uint32_t(__pyx_v_msg.source); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 29, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_3);
+      __pyx_t_4 = __Pyx_PyInt_From_int(__pyx_v_msg.type); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 29, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_4);
+      __pyx_t_5 = __Pyx_PyInt_From_int(__pyx_v_msg.session); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 29, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_5);
+      __pyx_t_6 = PyCapsule_New(__pyx_v_msg.data, ((char const *)"pyptr"), __pyx_f_8pyskynet_12skynet_py_mq_free_pyptr); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 29, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_6);
+      __pyx_t_7 = __Pyx_PyInt_FromSize_t(__pyx_v_msg.size); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 29, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_7);
+      __pyx_t_8 = PyTuple_New(5); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 29, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_8);
+      __Pyx_GIVEREF(__pyx_t_3);
+      PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_3);
+      __Pyx_GIVEREF(__pyx_t_4);
+      PyTuple_SET_ITEM(__pyx_t_8, 1, __pyx_t_4);
+      __Pyx_GIVEREF(__pyx_t_5);
+      PyTuple_SET_ITEM(__pyx_t_8, 2, __pyx_t_5);
+      __Pyx_GIVEREF(__pyx_t_6);
+      PyTuple_SET_ITEM(__pyx_t_8, 3, __pyx_t_6);
+      __Pyx_GIVEREF(__pyx_t_7);
+      PyTuple_SET_ITEM(__pyx_t_8, 4, __pyx_t_7);
+      __pyx_t_3 = 0;
+      __pyx_t_4 = 0;
+      __pyx_t_5 = 0;
+      __pyx_t_6 = 0;
+      __pyx_t_7 = 0;
+      __pyx_r = __pyx_t_8;
+      __pyx_t_8 = 0;
       goto __pyx_L0;
 
-      /* "src/cy_src/skynet_py_foreign_seri.pyx":281
- *         ptr = <char *>PyCapsule_GetPointer(capsule_or_bytes, name)
- *         sz = py_sz
- *         if strcmp(name, "cptr") == 0 or strcmp(name, "pyptr") == 0:             # <<<<<<<<<<<<<<
- *             cunpack(l, ptr, sz, mode)
- *             return tuple(l)
+      /* "src/cy_src/skynet_py_mq.pyx":28
+ *     else:
+ *         # TODO when msg.type is error , msg.data will be nil ?
+ *         if msg.data != NULL:             # <<<<<<<<<<<<<<
+ *             return msg.source, msg.type, msg.session, PyCapsule_New(msg.data, "pyptr", free_pyptr), msg.size
+ *         else:
  */
     }
 
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":285
- *             return tuple(l)
+    /* "src/cy_src/skynet_py_mq.pyx":31
+ *             return msg.source, msg.type, msg.session, PyCapsule_New(msg.data, "pyptr", free_pyptr), msg.size
  *         else:
- *             raise Exception("capsule unpack failed for name = %s " % PyBytes_FromString(name))             # <<<<<<<<<<<<<<
- *     elif PyBytes_CheckExact(capsule_or_bytes):
- *         ptr = <char *>PyBytes_AS_STRING(capsule_or_bytes)
+ *             return msg.source, msg.type, msg.session, b"", 0             # <<<<<<<<<<<<<<
+ * 
+ * # see lsend in lua-skynet.c
  */
     /*else*/ {
-      __pyx_t_1 = PyBytes_FromString(__pyx_v_name); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 285, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_1);
-      __pyx_t_7 = PyUnicode_Format(__pyx_kp_u_capsule_unpack_failed_for_name_s, __pyx_t_1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 285, __pyx_L1_error)
+      __Pyx_XDECREF(__pyx_r);
+      __pyx_t_8 = __Pyx_PyInt_From_uint32_t(__pyx_v_msg.source); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 31, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_8);
+      __pyx_t_7 = __Pyx_PyInt_From_int(__pyx_v_msg.type); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 31, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_7);
-      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-      __pyx_t_1 = __Pyx_PyObject_CallOneArg(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])), __pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 285, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_1);
-      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-      __Pyx_Raise(__pyx_t_1, 0, 0, 0);
-      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-      __PYX_ERR(0, 285, __pyx_L1_error)
+      __pyx_t_6 = __Pyx_PyInt_From_int(__pyx_v_msg.session); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 31, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_6);
+      __pyx_t_5 = PyTuple_New(5); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 31, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_5);
+      __Pyx_GIVEREF(__pyx_t_8);
+      PyTuple_SET_ITEM(__pyx_t_5, 0, __pyx_t_8);
+      __Pyx_GIVEREF(__pyx_t_7);
+      PyTuple_SET_ITEM(__pyx_t_5, 1, __pyx_t_7);
+      __Pyx_GIVEREF(__pyx_t_6);
+      PyTuple_SET_ITEM(__pyx_t_5, 2, __pyx_t_6);
+      __Pyx_INCREF(__pyx_kp_b__2);
+      __Pyx_GIVEREF(__pyx_kp_b__2);
+      PyTuple_SET_ITEM(__pyx_t_5, 3, __pyx_kp_b__2);
+      __Pyx_INCREF(__pyx_int_0);
+      __Pyx_GIVEREF(__pyx_int_0);
+      PyTuple_SET_ITEM(__pyx_t_5, 4, __pyx_int_0);
+      __pyx_t_8 = 0;
+      __pyx_t_7 = 0;
+      __pyx_t_6 = 0;
+      __pyx_r = __pyx_t_5;
+      __pyx_t_5 = 0;
+      goto __pyx_L0;
     }
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":277
- *     cdef size_t sz
- *     l = []
- *     if PyCapsule_CheckExact(capsule_or_bytes):             # <<<<<<<<<<<<<<
- *         name = PyCapsule_GetName(capsule_or_bytes)
- *         ptr = <char *>PyCapsule_GetPointer(capsule_or_bytes, name)
- */
-  }
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":286
- *         else:
- *             raise Exception("capsule unpack failed for name = %s " % PyBytes_FromString(name))
- *     elif PyBytes_CheckExact(capsule_or_bytes):             # <<<<<<<<<<<<<<
- *         ptr = <char *>PyBytes_AS_STRING(capsule_or_bytes)
- *         sz = PyBytes_GET_SIZE(capsule_or_bytes)
- */
-  __pyx_t_2 = (PyBytes_CheckExact(__pyx_v_capsule_or_bytes) != 0);
-  if (likely(__pyx_t_2)) {
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":287
- *             raise Exception("capsule unpack failed for name = %s " % PyBytes_FromString(name))
- *     elif PyBytes_CheckExact(capsule_or_bytes):
- *         ptr = <char *>PyBytes_AS_STRING(capsule_or_bytes)             # <<<<<<<<<<<<<<
- *         sz = PyBytes_GET_SIZE(capsule_or_bytes)
- *         cunpack(l, ptr, sz, mode)
- */
-    __pyx_v_ptr = ((char *)PyBytes_AS_STRING(__pyx_v_capsule_or_bytes));
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":288
- *     elif PyBytes_CheckExact(capsule_or_bytes):
- *         ptr = <char *>PyBytes_AS_STRING(capsule_or_bytes)
- *         sz = PyBytes_GET_SIZE(capsule_or_bytes)             # <<<<<<<<<<<<<<
- *         cunpack(l, ptr, sz, mode)
- *         return tuple(l)
- */
-    __pyx_v_sz = PyBytes_GET_SIZE(__pyx_v_capsule_or_bytes);
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":289
- *         ptr = <char *>PyBytes_AS_STRING(capsule_or_bytes)
- *         sz = PyBytes_GET_SIZE(capsule_or_bytes)
- *         cunpack(l, ptr, sz, mode)             # <<<<<<<<<<<<<<
- *         return tuple(l)
- *     else:
- */
-    __pyx_f_8pyskynet_22skynet_py_foreign_seri_cunpack(__pyx_v_l, __pyx_v_ptr, __pyx_v_sz, __pyx_v_mode); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 289, __pyx_L1_error)
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":290
- *         sz = PyBytes_GET_SIZE(capsule_or_bytes)
- *         cunpack(l, ptr, sz, mode)
- *         return tuple(l)             # <<<<<<<<<<<<<<
- *     else:
- *         raise Exception("Unexcept type %s " % str(type(capsule_or_bytes)))
- */
-    __Pyx_XDECREF(__pyx_r);
-    __pyx_t_1 = PyList_AsTuple(__pyx_v_l); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 290, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_1);
-    __pyx_r = __pyx_t_1;
-    __pyx_t_1 = 0;
-    goto __pyx_L0;
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":286
- *         else:
- *             raise Exception("capsule unpack failed for name = %s " % PyBytes_FromString(name))
- *     elif PyBytes_CheckExact(capsule_or_bytes):             # <<<<<<<<<<<<<<
- *         ptr = <char *>PyBytes_AS_STRING(capsule_or_bytes)
- *         sz = PyBytes_GET_SIZE(capsule_or_bytes)
- */
-  }
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":292
- *         return tuple(l)
- *     else:
- *         raise Exception("Unexcept type %s " % str(type(capsule_or_bytes)))             # <<<<<<<<<<<<<<
- * 
- * ######################
- */
-  /*else*/ {
-    __pyx_t_1 = __Pyx_PyObject_CallOneArg(((PyObject *)(&PyUnicode_Type)), ((PyObject *)Py_TYPE(__pyx_v_capsule_or_bytes))); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 292, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_7 = PyUnicode_Format(__pyx_kp_u_Unexcept_type_s, __pyx_t_1); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 292, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_7);
-    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __pyx_t_1 = __Pyx_PyObject_CallOneArg(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])), __pyx_t_7); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 292, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_1);
-    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-    __Pyx_Raise(__pyx_t_1, 0, 0, 0);
-    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 292, __pyx_L1_error)
   }
 
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":272
+  /* "src/cy_src/skynet_py_mq.pyx":18
+ *     skynet_free(ptr)
  * 
- * # extern
- * cdef py_foreign_unpack(int mode, capsule_or_bytes, py_sz):             # <<<<<<<<<<<<<<
- *     cdef const char *name
- *     cdef char *ptr
+ * def crecv():             # <<<<<<<<<<<<<<
+ *     cdef SkynetPyMessage msg
+ *     cdef int ret = skynet_py_queue_pop(&msg)
  */
 
   /* function exit code */
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_XDECREF(__pyx_t_3);
+  __Pyx_XDECREF(__pyx_t_4);
+  __Pyx_XDECREF(__pyx_t_5);
+  __Pyx_XDECREF(__pyx_t_6);
   __Pyx_XDECREF(__pyx_t_7);
-  __Pyx_AddTraceback("pyskynet.skynet_py_foreign_seri.py_foreign_unpack", __pyx_clineno, __pyx_lineno, __pyx_filename);
-  __pyx_r = 0;
+  __Pyx_XDECREF(__pyx_t_8);
+  __Pyx_AddTraceback("pyskynet.skynet_py_mq.crecv", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = NULL;
   __pyx_L0:;
-  __Pyx_XDECREF(__pyx_v_l);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "src/cy_src/skynet_py_foreign_seri.pyx":297
- * # functions for pack #
- * ######################
- * cdef void py_pack_list(foreign_write_block* wb, list_obj, int depth) except *:             # <<<<<<<<<<<<<<
- *     cdef int array_size = len(list_obj)
- *     cdef uint8_t n
+/* "src/cy_src/skynet_py_mq.pyx":34
+ * 
+ * # see lsend in lua-skynet.c
+ * def csend(py_dst, int type_id, py_session, py_msg, py_size=None):             # <<<<<<<<<<<<<<
+ *     assert skynet_py_address() > 0, "skynet threads has not been started yet, call 'pyskynet.start()' first."
+ *     # 1. check dst
  */
 
-static void __pyx_f_8pyskynet_22skynet_py_foreign_seri_py_pack_list(struct foreign_write_block *__pyx_v_wb, PyObject *__pyx_v_list_obj, int __pyx_v_depth) {
-  int __pyx_v_array_size;
-  uint8_t __pyx_v_n;
-  PyObject *__pyx_v_v = NULL;
-  __Pyx_RefNannyDeclarations
-  Py_ssize_t __pyx_t_1;
-  int __pyx_t_2;
-  PyObject *__pyx_t_3 = NULL;
-  PyObject *(*__pyx_t_4)(PyObject *);
-  PyObject *__pyx_t_5 = NULL;
+/* Python wrapper */
+static PyObject *__pyx_pw_8pyskynet_12skynet_py_mq_3csend(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+); /*proto*/
+static PyMethodDef __pyx_mdef_8pyskynet_12skynet_py_mq_3csend = {"csend", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_8pyskynet_12skynet_py_mq_3csend, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_8pyskynet_12skynet_py_mq_3csend(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+) {
+  PyObject *__pyx_v_py_dst = 0;
+  int __pyx_v_type_id;
+  PyObject *__pyx_v_py_session = 0;
+  PyObject *__pyx_v_py_msg = 0;
+  PyObject *__pyx_v_py_size = 0;
+  #if !CYTHON_METH_FASTCALL
+  CYTHON_UNUSED const Py_ssize_t __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
+  #endif
+  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
-  __Pyx_RefNannySetupContext("py_pack_list", 0);
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":298
- * ######################
- * cdef void py_pack_list(foreign_write_block* wb, list_obj, int depth) except *:
- *     cdef int array_size = len(list_obj)             # <<<<<<<<<<<<<<
- *     cdef uint8_t n
- *     if array_size >= MAX_COOKIE - 1:
- */
-  __pyx_t_1 = PyObject_Length(__pyx_v_list_obj); if (unlikely(__pyx_t_1 == ((Py_ssize_t)-1))) __PYX_ERR(0, 298, __pyx_L1_error)
-  __pyx_v_array_size = __pyx_t_1;
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":300
- *     cdef int array_size = len(list_obj)
- *     cdef uint8_t n
- *     if array_size >= MAX_COOKIE - 1:             # <<<<<<<<<<<<<<
- *         n = COMBINE_TYPE(TYPE_TABLE, MAX_COOKIE - 1);
- *         foreign_wb_write(wb, &n, 1);
- */
-  __pyx_t_2 = ((__pyx_v_array_size >= (MAX_COOKIE - 1)) != 0);
-  if (__pyx_t_2) {
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":301
- *     cdef uint8_t n
- *     if array_size >= MAX_COOKIE - 1:
- *         n = COMBINE_TYPE(TYPE_TABLE, MAX_COOKIE - 1);             # <<<<<<<<<<<<<<
- *         foreign_wb_write(wb, &n, 1);
- *         wb_integer(wb_cast(wb), array_size)
- */
-    __pyx_v_n = COMBINE_TYPE(TYPE_TABLE, (MAX_COOKIE - 1));
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":302
- *     if array_size >= MAX_COOKIE - 1:
- *         n = COMBINE_TYPE(TYPE_TABLE, MAX_COOKIE - 1);
- *         foreign_wb_write(wb, &n, 1);             # <<<<<<<<<<<<<<
- *         wb_integer(wb_cast(wb), array_size)
- *     else:
- */
-    foreign_wb_write(__pyx_v_wb, (&__pyx_v_n), 1);
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":303
- *         n = COMBINE_TYPE(TYPE_TABLE, MAX_COOKIE - 1);
- *         foreign_wb_write(wb, &n, 1);
- *         wb_integer(wb_cast(wb), array_size)             # <<<<<<<<<<<<<<
- *     else:
- *         n = COMBINE_TYPE(TYPE_TABLE, array_size);
- */
-    wb_integer(wb_cast(__pyx_v_wb), __pyx_v_array_size);
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":300
- *     cdef int array_size = len(list_obj)
- *     cdef uint8_t n
- *     if array_size >= MAX_COOKIE - 1:             # <<<<<<<<<<<<<<
- *         n = COMBINE_TYPE(TYPE_TABLE, MAX_COOKIE - 1);
- *         foreign_wb_write(wb, &n, 1);
- */
-    goto __pyx_L3;
-  }
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":305
- *         wb_integer(wb_cast(wb), array_size)
- *     else:
- *         n = COMBINE_TYPE(TYPE_TABLE, array_size);             # <<<<<<<<<<<<<<
- *         foreign_wb_write(wb, &n, 1);
- *     for v in list_obj:
- */
-  /*else*/ {
-    __pyx_v_n = COMBINE_TYPE(TYPE_TABLE, __pyx_v_array_size);
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":306
- *     else:
- *         n = COMBINE_TYPE(TYPE_TABLE, array_size);
- *         foreign_wb_write(wb, &n, 1);             # <<<<<<<<<<<<<<
- *     for v in list_obj:
- *         py_pack_one(wb,v,depth)
- */
-    foreign_wb_write(__pyx_v_wb, (&__pyx_v_n), 1);
-  }
-  __pyx_L3:;
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":307
- *         n = COMBINE_TYPE(TYPE_TABLE, array_size);
- *         foreign_wb_write(wb, &n, 1);
- *     for v in list_obj:             # <<<<<<<<<<<<<<
- *         py_pack_one(wb,v,depth)
- *     wb_nil(wb_cast(wb))
- */
-  if (likely(PyList_CheckExact(__pyx_v_list_obj)) || PyTuple_CheckExact(__pyx_v_list_obj)) {
-    __pyx_t_3 = __pyx_v_list_obj; __Pyx_INCREF(__pyx_t_3); __pyx_t_1 = 0;
-    __pyx_t_4 = NULL;
-  } else {
-    __pyx_t_1 = -1; __pyx_t_3 = PyObject_GetIter(__pyx_v_list_obj); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 307, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_4 = Py_TYPE(__pyx_t_3)->tp_iternext; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 307, __pyx_L1_error)
-  }
-  for (;;) {
-    if (likely(!__pyx_t_4)) {
-      if (likely(PyList_CheckExact(__pyx_t_3))) {
-        if (__pyx_t_1 >= PyList_GET_SIZE(__pyx_t_3)) break;
-        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_5 = PyList_GET_ITEM(__pyx_t_3, __pyx_t_1); __Pyx_INCREF(__pyx_t_5); __pyx_t_1++; if (unlikely(0 < 0)) __PYX_ERR(0, 307, __pyx_L1_error)
-        #else
-        __pyx_t_5 = PySequence_ITEM(__pyx_t_3, __pyx_t_1); __pyx_t_1++; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 307, __pyx_L1_error)
-        __Pyx_GOTREF(__pyx_t_5);
-        #endif
-      } else {
-        if (__pyx_t_1 >= PyTuple_GET_SIZE(__pyx_t_3)) break;
-        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_5 = PyTuple_GET_ITEM(__pyx_t_3, __pyx_t_1); __Pyx_INCREF(__pyx_t_5); __pyx_t_1++; if (unlikely(0 < 0)) __PYX_ERR(0, 307, __pyx_L1_error)
-        #else
-        __pyx_t_5 = PySequence_ITEM(__pyx_t_3, __pyx_t_1); __pyx_t_1++; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 307, __pyx_L1_error)
-        __Pyx_GOTREF(__pyx_t_5);
-        #endif
+  PyObject *__pyx_r = 0;
+  __Pyx_RefNannyDeclarations
+  __Pyx_RefNannySetupContext("csend (wrapper)", 0);
+  {
+    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_py_dst,&__pyx_n_s_type_id,&__pyx_n_s_py_session,&__pyx_n_s_py_msg,&__pyx_n_s_py_size,0};
+    PyObject* values[5] = {0,0,0,0,0};
+    values[4] = ((PyObject *)((PyObject *)Py_None));
+    if (__pyx_kwds) {
+      Py_ssize_t kw_args;
+      switch (__pyx_nargs) {
+        case  5: values[4] = __Pyx_Arg_FASTCALL(__pyx_args, 4);
+        CYTHON_FALLTHROUGH;
+        case  4: values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
+        CYTHON_FALLTHROUGH;
+        case  3: values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
+        CYTHON_FALLTHROUGH;
+        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
+        CYTHON_FALLTHROUGH;
+        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+        CYTHON_FALLTHROUGH;
+        case  0: break;
+        default: goto __pyx_L5_argtuple_error;
       }
-    } else {
-      __pyx_t_5 = __pyx_t_4(__pyx_t_3);
-      if (unlikely(!__pyx_t_5)) {
-        PyObject* exc_type = PyErr_Occurred();
-        if (exc_type) {
-          if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-          else __PYX_ERR(0, 307, __pyx_L1_error)
+      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
+      switch (__pyx_nargs) {
+        case  0:
+        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_py_dst)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 34, __pyx_L3_error)
+        else goto __pyx_L5_argtuple_error;
+        CYTHON_FALLTHROUGH;
+        case  1:
+        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_type_id)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 34, __pyx_L3_error)
+        else {
+          __Pyx_RaiseArgtupleInvalid("csend", 0, 4, 5, 1); __PYX_ERR(0, 34, __pyx_L3_error)
+        }
+        CYTHON_FALLTHROUGH;
+        case  2:
+        if (likely((values[2] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_py_session)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 34, __pyx_L3_error)
+        else {
+          __Pyx_RaiseArgtupleInvalid("csend", 0, 4, 5, 2); __PYX_ERR(0, 34, __pyx_L3_error)
+        }
+        CYTHON_FALLTHROUGH;
+        case  3:
+        if (likely((values[3] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_py_msg)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 34, __pyx_L3_error)
+        else {
+          __Pyx_RaiseArgtupleInvalid("csend", 0, 4, 5, 3); __PYX_ERR(0, 34, __pyx_L3_error)
+        }
+        CYTHON_FALLTHROUGH;
+        case  4:
+        if (kw_args > 0) {
+          PyObject* value = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_py_size);
+          if (value) { values[4] = value; kw_args--; }
+          else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 34, __pyx_L3_error)
         }
+      }
+      if (unlikely(kw_args > 0)) {
+        const Py_ssize_t kwd_pos_args = __pyx_nargs;
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "csend") < 0)) __PYX_ERR(0, 34, __pyx_L3_error)
+      }
+    } else {
+      switch (__pyx_nargs) {
+        case  5: values[4] = __Pyx_Arg_FASTCALL(__pyx_args, 4);
+        CYTHON_FALLTHROUGH;
+        case  4: values[3] = __Pyx_Arg_FASTCALL(__pyx_args, 3);
+        values[2] = __Pyx_Arg_FASTCALL(__pyx_args, 2);
+        values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
+        values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
         break;
+        default: goto __pyx_L5_argtuple_error;
       }
-      __Pyx_GOTREF(__pyx_t_5);
     }
-    __Pyx_XDECREF_SET(__pyx_v_v, __pyx_t_5);
-    __pyx_t_5 = 0;
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":308
- *         foreign_wb_write(wb, &n, 1);
- *     for v in list_obj:
- *         py_pack_one(wb,v,depth)             # <<<<<<<<<<<<<<
- *     wb_nil(wb_cast(wb))
- * 
- */
-    __pyx_f_8pyskynet_22skynet_py_foreign_seri_py_pack_one(__pyx_v_wb, __pyx_v_v, __pyx_v_depth); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 308, __pyx_L1_error)
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":307
- *         n = COMBINE_TYPE(TYPE_TABLE, array_size);
- *         foreign_wb_write(wb, &n, 1);
- *     for v in list_obj:             # <<<<<<<<<<<<<<
- *         py_pack_one(wb,v,depth)
- *     wb_nil(wb_cast(wb))
- */
+    __pyx_v_py_dst = values[0];
+    __pyx_v_type_id = __Pyx_PyInt_As_int(values[1]); if (unlikely((__pyx_v_type_id == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 34, __pyx_L3_error)
+    __pyx_v_py_session = values[2];
+    __pyx_v_py_msg = values[3];
+    __pyx_v_py_size = values[4];
   }
-  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":309
- *     for v in list_obj:
- *         py_pack_one(wb,v,depth)
- *     wb_nil(wb_cast(wb))             # <<<<<<<<<<<<<<
- * 
- * cdef void py_pack_dict(foreign_write_block* wb, dict_obj, int depth) except *:
- */
-  wb_nil(wb_cast(__pyx_v_wb));
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":297
- * # functions for pack #
- * ######################
- * cdef void py_pack_list(foreign_write_block* wb, list_obj, int depth) except *:             # <<<<<<<<<<<<<<
- *     cdef int array_size = len(list_obj)
- *     cdef uint8_t n
- */
-
-  /* function exit code */
-  goto __pyx_L0;
-  __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_3);
-  __Pyx_XDECREF(__pyx_t_5);
-  __Pyx_AddTraceback("pyskynet.skynet_py_foreign_seri.py_pack_list", __pyx_clineno, __pyx_lineno, __pyx_filename);
-  __pyx_L0:;
-  __Pyx_XDECREF(__pyx_v_v);
+  goto __pyx_L4_argument_unpacking_done;
+  __pyx_L5_argtuple_error:;
+  __Pyx_RaiseArgtupleInvalid("csend", 0, 4, 5, __pyx_nargs); __PYX_ERR(0, 34, __pyx_L3_error)
+  __pyx_L3_error:;
+  __Pyx_AddTraceback("pyskynet.skynet_py_mq.csend", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
-}
-
-/* "src/cy_src/skynet_py_foreign_seri.pyx":311
- *     wb_nil(wb_cast(wb))
- * 
- * cdef void py_pack_dict(foreign_write_block* wb, dict_obj, int depth) except *:             # <<<<<<<<<<<<<<
- *     cdef uint8_t n = COMBINE_TYPE(TYPE_TABLE, 0);
- *     foreign_wb_write(wb, &n, 1);
- */
-
-static void __pyx_f_8pyskynet_22skynet_py_foreign_seri_py_pack_dict(struct foreign_write_block *__pyx_v_wb, PyObject *__pyx_v_dict_obj, int __pyx_v_depth) {
-  uint8_t __pyx_v_n;
-  PyObject *__pyx_v_k = NULL;
-  PyObject *__pyx_v_v = NULL;
-  __Pyx_RefNannyDeclarations
-  PyObject *__pyx_t_1 = NULL;
-  Py_ssize_t __pyx_t_2;
-  Py_ssize_t __pyx_t_3;
-  int __pyx_t_4;
-  PyObject *__pyx_t_5 = NULL;
-  PyObject *__pyx_t_6 = NULL;
-  int __pyx_t_7;
-  int __pyx_lineno = 0;
-  const char *__pyx_filename = NULL;
-  int __pyx_clineno = 0;
-  __Pyx_RefNannySetupContext("py_pack_dict", 0);
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":312
- * 
- * cdef void py_pack_dict(foreign_write_block* wb, dict_obj, int depth) except *:
- *     cdef uint8_t n = COMBINE_TYPE(TYPE_TABLE, 0);             # <<<<<<<<<<<<<<
- *     foreign_wb_write(wb, &n, 1);
- *     for k, v in dict_obj.items():
- */
-  __pyx_v_n = COMBINE_TYPE(TYPE_TABLE, 0);
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":313
- * cdef void py_pack_dict(foreign_write_block* wb, dict_obj, int depth) except *:
- *     cdef uint8_t n = COMBINE_TYPE(TYPE_TABLE, 0);
- *     foreign_wb_write(wb, &n, 1);             # <<<<<<<<<<<<<<
- *     for k, v in dict_obj.items():
- *         py_pack_one(wb,k,depth)
- */
-  foreign_wb_write(__pyx_v_wb, (&__pyx_v_n), 1);
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":314
- *     cdef uint8_t n = COMBINE_TYPE(TYPE_TABLE, 0);
- *     foreign_wb_write(wb, &n, 1);
- *     for k, v in dict_obj.items():             # <<<<<<<<<<<<<<
- *         py_pack_one(wb,k,depth)
- *         py_pack_one(wb,v,depth)
- */
-  __pyx_t_2 = 0;
-  if (unlikely(__pyx_v_dict_obj == Py_None)) {
-    PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "items");
-    __PYX_ERR(0, 314, __pyx_L1_error)
-  }
-  __pyx_t_5 = __Pyx_dict_iterator(__pyx_v_dict_obj, 0, __pyx_n_s_items, (&__pyx_t_3), (&__pyx_t_4)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 314, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_XDECREF(__pyx_t_1);
-  __pyx_t_1 = __pyx_t_5;
-  __pyx_t_5 = 0;
-  while (1) {
-    __pyx_t_7 = __Pyx_dict_iter_next(__pyx_t_1, __pyx_t_3, &__pyx_t_2, &__pyx_t_5, &__pyx_t_6, NULL, __pyx_t_4);
-    if (unlikely(__pyx_t_7 == 0)) break;
-    if (unlikely(__pyx_t_7 == -1)) __PYX_ERR(0, 314, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_5);
-    __Pyx_GOTREF(__pyx_t_6);
-    __Pyx_XDECREF_SET(__pyx_v_k, __pyx_t_5);
-    __pyx_t_5 = 0;
-    __Pyx_XDECREF_SET(__pyx_v_v, __pyx_t_6);
-    __pyx_t_6 = 0;
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":315
- *     foreign_wb_write(wb, &n, 1);
- *     for k, v in dict_obj.items():
- *         py_pack_one(wb,k,depth)             # <<<<<<<<<<<<<<
- *         py_pack_one(wb,v,depth)
- *     wb_nil(wb_cast(wb))
- */
-    __pyx_f_8pyskynet_22skynet_py_foreign_seri_py_pack_one(__pyx_v_wb, __pyx_v_k, __pyx_v_depth); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 315, __pyx_L1_error)
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":316
- *     for k, v in dict_obj.items():
- *         py_pack_one(wb,k,depth)
- *         py_pack_one(wb,v,depth)             # <<<<<<<<<<<<<<
- *     wb_nil(wb_cast(wb))
- * 
- */
-    __pyx_f_8pyskynet_22skynet_py_foreign_seri_py_pack_one(__pyx_v_wb, __pyx_v_v, __pyx_v_depth); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 316, __pyx_L1_error)
-  }
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":317
- *         py_pack_one(wb,k,depth)
- *         py_pack_one(wb,v,depth)
- *     wb_nil(wb_cast(wb))             # <<<<<<<<<<<<<<
- * 
- * cdef void py_pack_one(foreign_write_block* wb, py_arg, int depth) except *:
- */
-  wb_nil(wb_cast(__pyx_v_wb));
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":311
- *     wb_nil(wb_cast(wb))
- * 
- * cdef void py_pack_dict(foreign_write_block* wb, dict_obj, int depth) except *:             # <<<<<<<<<<<<<<
- *     cdef uint8_t n = COMBINE_TYPE(TYPE_TABLE, 0);
- *     foreign_wb_write(wb, &n, 1);
- */
+  return NULL;
+  __pyx_L4_argument_unpacking_done:;
+  __pyx_r = __pyx_pf_8pyskynet_12skynet_py_mq_2csend(__pyx_self, __pyx_v_py_dst, __pyx_v_type_id, __pyx_v_py_session, __pyx_v_py_msg, __pyx_v_py_size);
 
   /* function exit code */
-  goto __pyx_L0;
-  __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_XDECREF(__pyx_t_5);
-  __Pyx_XDECREF(__pyx_t_6);
-  __Pyx_AddTraceback("pyskynet.skynet_py_foreign_seri.py_pack_dict", __pyx_clineno, __pyx_lineno, __pyx_filename);
-  __pyx_L0:;
-  __Pyx_XDECREF(__pyx_v_k);
-  __Pyx_XDECREF(__pyx_v_v);
   __Pyx_RefNannyFinishContext();
+  return __pyx_r;
 }
 
-/* "src/cy_src/skynet_py_foreign_seri.pyx":319
- *     wb_nil(wb_cast(wb))
- * 
- * cdef void py_pack_one(foreign_write_block* wb, py_arg, int depth) except *:             # <<<<<<<<<<<<<<
- *     cdef int bytes_sz = 0
- *     cdef char *bytes_ptr = NULL
- */
-
-static void __pyx_f_8pyskynet_22skynet_py_foreign_seri_py_pack_one(struct foreign_write_block *__pyx_v_wb, PyObject *__pyx_v_py_arg, int __pyx_v_depth) {
-  int __pyx_v_bytes_sz;
-  char *__pyx_v_bytes_ptr;
-  char const *__pyx_v_name;
-  PyObject *__pyx_v_arr_iter = NULL;
-  PyTypeObject *__pyx_v_py_arg_type = NULL;
-  PyObject *__pyx_v_py_arg_bytes = NULL;
+static PyObject *__pyx_pf_8pyskynet_12skynet_py_mq_2csend(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_py_dst, int __pyx_v_type_id, PyObject *__pyx_v_py_session, PyObject *__pyx_v_py_msg, PyObject *__pyx_v_py_size) {
+  char *__pyx_v_dstname;
+  int __pyx_v_dst;
+  PyObject *__pyx_v_py_dst_bytes = 0;
+  int __pyx_v_session;
+  char *__pyx_v_ptr;
+  int __pyx_v_size;
+  CYTHON_UNUSED PyObject *__pyx_v_py_msg_bytes = 0;
+  PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   int __pyx_t_1;
-  PyObject *__pyx_t_2 = NULL;
-  int __pyx_t_3;
-  char *__pyx_t_4;
+  char *__pyx_t_2;
+  PyObject *__pyx_t_3 = NULL;
+  int __pyx_t_4;
   void *__pyx_t_5;
-  PyObject *__pyx_t_6 = NULL;
+  Py_ssize_t __pyx_t_6;
   PyObject *__pyx_t_7 = NULL;
-  PyObject *__pyx_t_8 = NULL;
-  int __pyx_t_9;
-  PyObject *__pyx_t_10 = NULL;
-  lua_Integer __pyx_t_11;
-  double __pyx_t_12;
-  Py_ssize_t __pyx_t_13;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
-  __Pyx_RefNannySetupContext("py_pack_one", 0);
+  __Pyx_RefNannySetupContext("csend", 0);
 
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":320
- * 
- * cdef void py_pack_one(foreign_write_block* wb, py_arg, int depth) except *:
- *     cdef int bytes_sz = 0             # <<<<<<<<<<<<<<
- *     cdef char *bytes_ptr = NULL
- *     cdef const char *name = NULL
- */
-  __pyx_v_bytes_sz = 0;
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":321
- * cdef void py_pack_one(foreign_write_block* wb, py_arg, int depth) except *:
- *     cdef int bytes_sz = 0
- *     cdef char *bytes_ptr = NULL             # <<<<<<<<<<<<<<
- *     cdef const char *name = NULL
- *     if depth > MAX_DEPTH:
- */
-  __pyx_v_bytes_ptr = NULL;
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":322
- *     cdef int bytes_sz = 0
- *     cdef char *bytes_ptr = NULL
- *     cdef const char *name = NULL             # <<<<<<<<<<<<<<
- *     if depth > MAX_DEPTH:
- *         raise Exception("serialize can't pack too depth table")
- */
-  __pyx_v_name = NULL;
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":323
- *     cdef char *bytes_ptr = NULL
- *     cdef const char *name = NULL
- *     if depth > MAX_DEPTH:             # <<<<<<<<<<<<<<
- *         raise Exception("serialize can't pack too depth table")
- *     if py_arg is None:
- */
-  __pyx_t_1 = ((__pyx_v_depth > MAX_DEPTH) != 0);
-  if (unlikely(__pyx_t_1)) {
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":324
- *     cdef const char *name = NULL
- *     if depth > MAX_DEPTH:
- *         raise Exception("serialize can't pack too depth table")             # <<<<<<<<<<<<<<
- *     if py_arg is None:
- *         wb_nil(wb_cast(wb))
- */
-    __pyx_t_2 = __Pyx_PyObject_Call(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])), __pyx_tuple__4, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 324, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_2);
-    __Pyx_Raise(__pyx_t_2, 0, 0, 0);
-    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __PYX_ERR(0, 324, __pyx_L1_error)
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":323
- *     cdef char *bytes_ptr = NULL
- *     cdef const char *name = NULL
- *     if depth > MAX_DEPTH:             # <<<<<<<<<<<<<<
- *         raise Exception("serialize can't pack too depth table")
- *     if py_arg is None:
- */
+  /* "src/cy_src/skynet_py_mq.pyx":35
+ * # see lsend in lua-skynet.c
+ * def csend(py_dst, int type_id, py_session, py_msg, py_size=None):
+ *     assert skynet_py_address() > 0, "skynet threads has not been started yet, call 'pyskynet.start()' first."             # <<<<<<<<<<<<<<
+ *     # 1. check dst
+ *     cdef char * dstname = NULL
+ */
+  #ifndef CYTHON_WITHOUT_ASSERTIONS
+  if (unlikely(__pyx_assertions_enabled())) {
+    __pyx_t_1 = (skynet_py_address() > 0);
+    if (unlikely(!__pyx_t_1)) {
+      __Pyx_Raise(__pyx_builtin_AssertionError, __pyx_kp_u_skynet_threads_has_not_been_star, 0, 0);
+      __PYX_ERR(0, 35, __pyx_L1_error)
+    }
   }
+  #else
+  if ((1)); else __PYX_ERR(0, 35, __pyx_L1_error)
+  #endif
 
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":325
- *     if depth > MAX_DEPTH:
- *         raise Exception("serialize can't pack too depth table")
- *     if py_arg is None:             # <<<<<<<<<<<<<<
- *         wb_nil(wb_cast(wb))
- *     elif PyCapsule_CheckExact(py_arg):
- */
-  __pyx_t_1 = (__pyx_v_py_arg == Py_None);
-  __pyx_t_3 = (__pyx_t_1 != 0);
-  if (__pyx_t_3) {
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":326
- *         raise Exception("serialize can't pack too depth table")
- *     if py_arg is None:
- *         wb_nil(wb_cast(wb))             # <<<<<<<<<<<<<<
- *     elif PyCapsule_CheckExact(py_arg):
- *         name = PyCapsule_GetName(py_arg)
- */
-    wb_nil(wb_cast(__pyx_v_wb));
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":325
- *     if depth > MAX_DEPTH:
- *         raise Exception("serialize can't pack too depth table")
- *     if py_arg is None:             # <<<<<<<<<<<<<<
- *         wb_nil(wb_cast(wb))
- *     elif PyCapsule_CheckExact(py_arg):
+  /* "src/cy_src/skynet_py_mq.pyx":37
+ *     assert skynet_py_address() > 0, "skynet threads has not been started yet, call 'pyskynet.start()' first."
+ *     # 1. check dst
+ *     cdef char * dstname = NULL             # <<<<<<<<<<<<<<
+ *     cdef int dst = 0
+ *     cdef bytes py_dst_bytes
+ */
+  __pyx_v_dstname = NULL;
+
+  /* "src/cy_src/skynet_py_mq.pyx":38
+ *     # 1. check dst
+ *     cdef char * dstname = NULL
+ *     cdef int dst = 0             # <<<<<<<<<<<<<<
+ *     cdef bytes py_dst_bytes
+ *     if PyBytes_CheckExact(py_dst):
+ */
+  __pyx_v_dst = 0;
+
+  /* "src/cy_src/skynet_py_mq.pyx":40
+ *     cdef int dst = 0
+ *     cdef bytes py_dst_bytes
+ *     if PyBytes_CheckExact(py_dst):             # <<<<<<<<<<<<<<
+ *         dstname = py_dst
+ *     elif PyUnicode_CheckExact(py_dst):
  */
-    goto __pyx_L4;
-  }
+  __pyx_t_1 = PyBytes_CheckExact(__pyx_v_py_dst);
+  if (__pyx_t_1) {
 
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":327
- *     if py_arg is None:
- *         wb_nil(wb_cast(wb))
- *     elif PyCapsule_CheckExact(py_arg):             # <<<<<<<<<<<<<<
- *         name = PyCapsule_GetName(py_arg)
- *         if strcmp(name, "cptr") == 0:
- */
-  __pyx_t_3 = (PyCapsule_CheckExact(__pyx_v_py_arg) != 0);
-  if (__pyx_t_3) {
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":328
- *         wb_nil(wb_cast(wb))
- *     elif PyCapsule_CheckExact(py_arg):
- *         name = PyCapsule_GetName(py_arg)             # <<<<<<<<<<<<<<
- *         if strcmp(name, "cptr") == 0:
- *             wb_pointer(wb_cast(wb), PyCapsule_GetPointer(py_arg, "cptr"))
- */
-    __pyx_t_4 = PyCapsule_GetName(__pyx_v_py_arg); if (unlikely(__pyx_t_4 == ((char *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 328, __pyx_L1_error)
-    __pyx_v_name = __pyx_t_4;
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":329
- *     elif PyCapsule_CheckExact(py_arg):
- *         name = PyCapsule_GetName(py_arg)
- *         if strcmp(name, "cptr") == 0:             # <<<<<<<<<<<<<<
- *             wb_pointer(wb_cast(wb), PyCapsule_GetPointer(py_arg, "cptr"))
- *         else:
+    /* "src/cy_src/skynet_py_mq.pyx":41
+ *     cdef bytes py_dst_bytes
+ *     if PyBytes_CheckExact(py_dst):
+ *         dstname = py_dst             # <<<<<<<<<<<<<<
+ *     elif PyUnicode_CheckExact(py_dst):
+ *         py_dst_bytes = PyUnicode_AsUTF8String(py_dst)
+ */
+    __pyx_t_2 = __Pyx_PyObject_AsWritableString(__pyx_v_py_dst); if (unlikely((!__pyx_t_2) && PyErr_Occurred())) __PYX_ERR(0, 41, __pyx_L1_error)
+    __pyx_v_dstname = __pyx_t_2;
+
+    /* "src/cy_src/skynet_py_mq.pyx":40
+ *     cdef int dst = 0
+ *     cdef bytes py_dst_bytes
+ *     if PyBytes_CheckExact(py_dst):             # <<<<<<<<<<<<<<
+ *         dstname = py_dst
+ *     elif PyUnicode_CheckExact(py_dst):
  */
-    __pyx_t_3 = ((strcmp(__pyx_v_name, ((char const *)"cptr")) == 0) != 0);
-    if (likely(__pyx_t_3)) {
+    goto __pyx_L3;
+  }
 
-      /* "src/cy_src/skynet_py_foreign_seri.pyx":330
- *         name = PyCapsule_GetName(py_arg)
- *         if strcmp(name, "cptr") == 0:
- *             wb_pointer(wb_cast(wb), PyCapsule_GetPointer(py_arg, "cptr"))             # <<<<<<<<<<<<<<
- *         else:
- *             raise Exception("unexception capsule")
+  /* "src/cy_src/skynet_py_mq.pyx":42
+ *     if PyBytes_CheckExact(py_dst):
+ *         dstname = py_dst
+ *     elif PyUnicode_CheckExact(py_dst):             # <<<<<<<<<<<<<<
+ *         py_dst_bytes = PyUnicode_AsUTF8String(py_dst)
+ *         dstname = py_dst_bytes
  */
-      __pyx_t_5 = PyCapsule_GetPointer(__pyx_v_py_arg, ((char *)"cptr")); if (unlikely(__pyx_t_5 == ((void *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 330, __pyx_L1_error)
-      wb_pointer(wb_cast(__pyx_v_wb), __pyx_t_5);
+  __pyx_t_1 = PyUnicode_CheckExact(__pyx_v_py_dst);
+  if (__pyx_t_1) {
 
-      /* "src/cy_src/skynet_py_foreign_seri.pyx":329
- *     elif PyCapsule_CheckExact(py_arg):
- *         name = PyCapsule_GetName(py_arg)
- *         if strcmp(name, "cptr") == 0:             # <<<<<<<<<<<<<<
- *             wb_pointer(wb_cast(wb), PyCapsule_GetPointer(py_arg, "cptr"))
- *         else:
+    /* "src/cy_src/skynet_py_mq.pyx":43
+ *         dstname = py_dst
+ *     elif PyUnicode_CheckExact(py_dst):
+ *         py_dst_bytes = PyUnicode_AsUTF8String(py_dst)             # <<<<<<<<<<<<<<
+ *         dstname = py_dst_bytes
+ *     else:
  */
-      goto __pyx_L5;
-    }
+    __pyx_t_3 = PyUnicode_AsUTF8String(__pyx_v_py_dst); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 43, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_3);
+    __pyx_v_py_dst_bytes = ((PyObject*)__pyx_t_3);
+    __pyx_t_3 = 0;
 
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":332
- *             wb_pointer(wb_cast(wb), PyCapsule_GetPointer(py_arg, "cptr"))
- *         else:
- *             raise Exception("unexception capsule")             # <<<<<<<<<<<<<<
- *     elif PyArray_CheckExact(py_arg):
- *         if not PyArray_foreign_check_typechar(py_arg):
+    /* "src/cy_src/skynet_py_mq.pyx":44
+ *     elif PyUnicode_CheckExact(py_dst):
+ *         py_dst_bytes = PyUnicode_AsUTF8String(py_dst)
+ *         dstname = py_dst_bytes             # <<<<<<<<<<<<<<
+ *     else:
+ *         dst = py_dst
  */
-    /*else*/ {
-      __pyx_t_2 = __Pyx_PyObject_Call(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])), __pyx_tuple__5, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 332, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_2);
-      __Pyx_Raise(__pyx_t_2, 0, 0, 0);
-      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-      __PYX_ERR(0, 332, __pyx_L1_error)
-    }
-    __pyx_L5:;
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":327
- *     if py_arg is None:
- *         wb_nil(wb_cast(wb))
- *     elif PyCapsule_CheckExact(py_arg):             # <<<<<<<<<<<<<<
- *         name = PyCapsule_GetName(py_arg)
- *         if strcmp(name, "cptr") == 0:
+    if (unlikely(__pyx_v_py_dst_bytes == Py_None)) {
+      PyErr_SetString(PyExc_TypeError, "expected bytes, NoneType found");
+      __PYX_ERR(0, 44, __pyx_L1_error)
+    }
+    __pyx_t_2 = __Pyx_PyBytes_AsWritableString(__pyx_v_py_dst_bytes); if (unlikely((!__pyx_t_2) && PyErr_Occurred())) __PYX_ERR(0, 44, __pyx_L1_error)
+    __pyx_v_dstname = __pyx_t_2;
+
+    /* "src/cy_src/skynet_py_mq.pyx":42
+ *     if PyBytes_CheckExact(py_dst):
+ *         dstname = py_dst
+ *     elif PyUnicode_CheckExact(py_dst):             # <<<<<<<<<<<<<<
+ *         py_dst_bytes = PyUnicode_AsUTF8String(py_dst)
+ *         dstname = py_dst_bytes
  */
-    goto __pyx_L4;
+    goto __pyx_L3;
   }
 
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":333
- *         else:
- *             raise Exception("unexception capsule")
- *     elif PyArray_CheckExact(py_arg):             # <<<<<<<<<<<<<<
- *         if not PyArray_foreign_check_typechar(py_arg):
- *             raise Exception("unexception typechar %s"%py_arg.dtype.char)
- */
-  __pyx_t_3 = (PyArray_CheckExact(__pyx_v_py_arg) != 0);
-  if (__pyx_t_3) {
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":334
- *             raise Exception("unexception capsule")
- *     elif PyArray_CheckExact(py_arg):
- *         if not PyArray_foreign_check_typechar(py_arg):             # <<<<<<<<<<<<<<
- *             raise Exception("unexception typechar %s"%py_arg.dtype.char)
- *         if wb.mode == MODE_FOREIGN:
- */
-    __pyx_t_3 = ((!(PyArray_foreign_check_typechar(__pyx_v_py_arg) != 0)) != 0);
-    if (unlikely(__pyx_t_3)) {
-
-      /* "src/cy_src/skynet_py_foreign_seri.pyx":335
- *     elif PyArray_CheckExact(py_arg):
- *         if not PyArray_foreign_check_typechar(py_arg):
- *             raise Exception("unexception typechar %s"%py_arg.dtype.char)             # <<<<<<<<<<<<<<
- *         if wb.mode == MODE_FOREIGN:
- *             wb_foreign_PyArray(wb, py_arg, None)
- */
-      __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_py_arg, __pyx_n_s_dtype); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 335, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_2);
-      __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_char); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 335, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_6);
-      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-      __pyx_t_2 = __Pyx_PyUnicode_FormatSafe(__pyx_kp_u_unexception_typechar_s, __pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 335, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_2);
-      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-      __pyx_t_6 = __Pyx_PyObject_CallOneArg(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])), __pyx_t_2); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 335, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_6);
-      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-      __Pyx_Raise(__pyx_t_6, 0, 0, 0);
-      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-      __PYX_ERR(0, 335, __pyx_L1_error)
-
-      /* "src/cy_src/skynet_py_foreign_seri.pyx":334
- *             raise Exception("unexception capsule")
- *     elif PyArray_CheckExact(py_arg):
- *         if not PyArray_foreign_check_typechar(py_arg):             # <<<<<<<<<<<<<<
- *             raise Exception("unexception typechar %s"%py_arg.dtype.char)
- *         if wb.mode == MODE_FOREIGN:
+  /* "src/cy_src/skynet_py_mq.pyx":46
+ *         dstname = py_dst_bytes
+ *     else:
+ *         dst = py_dst             # <<<<<<<<<<<<<<
+ *     # 2. check session
+ *     cdef int session = 0
  */
-    }
+  /*else*/ {
+    __pyx_t_4 = __Pyx_PyInt_As_int(__pyx_v_py_dst); if (unlikely((__pyx_t_4 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 46, __pyx_L1_error)
+    __pyx_v_dst = __pyx_t_4;
+  }
+  __pyx_L3:;
 
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":336
- *         if not PyArray_foreign_check_typechar(py_arg):
- *             raise Exception("unexception typechar %s"%py_arg.dtype.char)
- *         if wb.mode == MODE_FOREIGN:             # <<<<<<<<<<<<<<
- *             wb_foreign_PyArray(wb, py_arg, None)
- *         elif wb.mode == MODE_FOREIGN_REMOTE:
- */
-    switch (__pyx_v_wb->mode) {
-      case MODE_FOREIGN:
-
-      /* "src/cy_src/skynet_py_foreign_seri.pyx":337
- *             raise Exception("unexception typechar %s"%py_arg.dtype.char)
- *         if wb.mode == MODE_FOREIGN:
- *             wb_foreign_PyArray(wb, py_arg, None)             # <<<<<<<<<<<<<<
- *         elif wb.mode == MODE_FOREIGN_REMOTE:
- *             arr_iter = py_arg.flat
- */
-      wb_foreign_PyArray(__pyx_v_wb, __pyx_v_py_arg, Py_None);
-
-      /* "src/cy_src/skynet_py_foreign_seri.pyx":336
- *         if not PyArray_foreign_check_typechar(py_arg):
- *             raise Exception("unexception typechar %s"%py_arg.dtype.char)
- *         if wb.mode == MODE_FOREIGN:             # <<<<<<<<<<<<<<
- *             wb_foreign_PyArray(wb, py_arg, None)
- *         elif wb.mode == MODE_FOREIGN_REMOTE:
- */
-      break;
-      case MODE_FOREIGN_REMOTE:
-
-      /* "src/cy_src/skynet_py_foreign_seri.pyx":339
- *             wb_foreign_PyArray(wb, py_arg, None)
- *         elif wb.mode == MODE_FOREIGN_REMOTE:
- *             arr_iter = py_arg.flat             # <<<<<<<<<<<<<<
- *             wb_foreign_PyArray(wb, py_arg, arr_iter)
- *         else:
+  /* "src/cy_src/skynet_py_mq.pyx":48
+ *         dst = py_dst
+ *     # 2. check session
+ *     cdef int session = 0             # <<<<<<<<<<<<<<
+ *     if py_session is None:
+ *         type_id |= PTYPE_TAG_ALLOCSESSION
+ */
+  __pyx_v_session = 0;
+
+  /* "src/cy_src/skynet_py_mq.pyx":49
+ *     # 2. check session
+ *     cdef int session = 0
+ *     if py_session is None:             # <<<<<<<<<<<<<<
+ *         type_id |= PTYPE_TAG_ALLOCSESSION
+ *         session = 0
  */
-      __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_v_py_arg, __pyx_n_s_flat); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 339, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_6);
-      __pyx_v_arr_iter = __pyx_t_6;
-      __pyx_t_6 = 0;
+  __pyx_t_1 = (__pyx_v_py_session == Py_None);
+  if (__pyx_t_1) {
 
-      /* "src/cy_src/skynet_py_foreign_seri.pyx":340
- *         elif wb.mode == MODE_FOREIGN_REMOTE:
- *             arr_iter = py_arg.flat
- *             wb_foreign_PyArray(wb, py_arg, arr_iter)             # <<<<<<<<<<<<<<
- *         else:
- *             raise Exception("seri wb foreign unexception mode")
+    /* "src/cy_src/skynet_py_mq.pyx":50
+ *     cdef int session = 0
+ *     if py_session is None:
+ *         type_id |= PTYPE_TAG_ALLOCSESSION             # <<<<<<<<<<<<<<
+ *         session = 0
+ *     else:
  */
-      wb_foreign_PyArray(__pyx_v_wb, __pyx_v_py_arg, __pyx_v_arr_iter);
+    __pyx_v_type_id = (__pyx_v_type_id | PTYPE_TAG_ALLOCSESSION);
 
-      /* "src/cy_src/skynet_py_foreign_seri.pyx":338
- *         if wb.mode == MODE_FOREIGN:
- *             wb_foreign_PyArray(wb, py_arg, None)
- *         elif wb.mode == MODE_FOREIGN_REMOTE:             # <<<<<<<<<<<<<<
- *             arr_iter = py_arg.flat
- *             wb_foreign_PyArray(wb, py_arg, arr_iter)
+    /* "src/cy_src/skynet_py_mq.pyx":51
+ *     if py_session is None:
+ *         type_id |= PTYPE_TAG_ALLOCSESSION
+ *         session = 0             # <<<<<<<<<<<<<<
+ *     else:
+ *         session = py_session
  */
-      break;
-      default:
+    __pyx_v_session = 0;
 
-      /* "src/cy_src/skynet_py_foreign_seri.pyx":342
- *             wb_foreign_PyArray(wb, py_arg, arr_iter)
- *         else:
- *             raise Exception("seri wb foreign unexception mode")             # <<<<<<<<<<<<<<
- *     elif isinstance(py_arg, dict):
- *         py_pack_dict(wb, py_arg, depth+1)
+    /* "src/cy_src/skynet_py_mq.pyx":49
+ *     # 2. check session
+ *     cdef int session = 0
+ *     if py_session is None:             # <<<<<<<<<<<<<<
+ *         type_id |= PTYPE_TAG_ALLOCSESSION
+ *         session = 0
  */
-      __pyx_t_6 = __Pyx_PyObject_Call(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])), __pyx_tuple__6, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 342, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_6);
-      __Pyx_Raise(__pyx_t_6, 0, 0, 0);
-      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-      __PYX_ERR(0, 342, __pyx_L1_error)
-      break;
-    }
+    goto __pyx_L4;
+  }
 
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":333
- *         else:
- *             raise Exception("unexception capsule")
- *     elif PyArray_CheckExact(py_arg):             # <<<<<<<<<<<<<<
- *         if not PyArray_foreign_check_typechar(py_arg):
- *             raise Exception("unexception typechar %s"%py_arg.dtype.char)
+  /* "src/cy_src/skynet_py_mq.pyx":53
+ *         session = 0
+ *     else:
+ *         session = py_session             # <<<<<<<<<<<<<<
+ *     # 3. check ptr, size
+ *     cdef char * ptr = NULL
  */
-    goto __pyx_L4;
+  /*else*/ {
+    __pyx_t_4 = __Pyx_PyInt_As_int(__pyx_v_py_session); if (unlikely((__pyx_t_4 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 53, __pyx_L1_error)
+    __pyx_v_session = __pyx_t_4;
   }
+  __pyx_L4:;
 
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":343
- *         else:
- *             raise Exception("seri wb foreign unexception mode")
- *     elif isinstance(py_arg, dict):             # <<<<<<<<<<<<<<
- *         py_pack_dict(wb, py_arg, depth+1)
- *     elif isinstance(py_arg, list):
+  /* "src/cy_src/skynet_py_mq.pyx":55
+ *         session = py_session
+ *     # 3. check ptr, size
+ *     cdef char * ptr = NULL             # <<<<<<<<<<<<<<
+ *     cdef int size = 0
+ *     cdef bytes py_msg_bytes
  */
-  __pyx_t_3 = PyDict_Check(__pyx_v_py_arg); 
-  __pyx_t_1 = (__pyx_t_3 != 0);
-  if (__pyx_t_1) {
+  __pyx_v_ptr = NULL;
 
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":344
- *             raise Exception("seri wb foreign unexception mode")
- *     elif isinstance(py_arg, dict):
- *         py_pack_dict(wb, py_arg, depth+1)             # <<<<<<<<<<<<<<
- *     elif isinstance(py_arg, list):
- *         py_pack_list(wb, py_arg, depth+1)
+  /* "src/cy_src/skynet_py_mq.pyx":56
+ *     # 3. check ptr, size
+ *     cdef char * ptr = NULL
+ *     cdef int size = 0             # <<<<<<<<<<<<<<
+ *     cdef bytes py_msg_bytes
+ *     if PyCapsule_CheckExact(py_msg):
+ */
+  __pyx_v_size = 0;
+
+  /* "src/cy_src/skynet_py_mq.pyx":58
+ *     cdef int size = 0
+ *     cdef bytes py_msg_bytes
+ *     if PyCapsule_CheckExact(py_msg):             # <<<<<<<<<<<<<<
+ *         type_id |= PTYPE_TAG_DONTCOPY
+ *         ptr = <char *>PyCapsule_GetPointer(py_msg, "cptr")
  */
-    __pyx_f_8pyskynet_22skynet_py_foreign_seri_py_pack_dict(__pyx_v_wb, __pyx_v_py_arg, (__pyx_v_depth + 1)); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 344, __pyx_L1_error)
+  __pyx_t_1 = PyCapsule_CheckExact(__pyx_v_py_msg);
+  if (__pyx_t_1) {
 
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":343
- *         else:
- *             raise Exception("seri wb foreign unexception mode")
- *     elif isinstance(py_arg, dict):             # <<<<<<<<<<<<<<
- *         py_pack_dict(wb, py_arg, depth+1)
- *     elif isinstance(py_arg, list):
+    /* "src/cy_src/skynet_py_mq.pyx":59
+ *     cdef bytes py_msg_bytes
+ *     if PyCapsule_CheckExact(py_msg):
+ *         type_id |= PTYPE_TAG_DONTCOPY             # <<<<<<<<<<<<<<
+ *         ptr = <char *>PyCapsule_GetPointer(py_msg, "cptr")
+ *         size = py_size
+ */
+    __pyx_v_type_id = (__pyx_v_type_id | PTYPE_TAG_DONTCOPY);
+
+    /* "src/cy_src/skynet_py_mq.pyx":60
+ *     if PyCapsule_CheckExact(py_msg):
+ *         type_id |= PTYPE_TAG_DONTCOPY
+ *         ptr = <char *>PyCapsule_GetPointer(py_msg, "cptr")             # <<<<<<<<<<<<<<
+ *         size = py_size
+ *     elif PyBytes_CheckExact(py_msg):
+ */
+    __pyx_t_5 = PyCapsule_GetPointer(__pyx_v_py_msg, ((char const *)"cptr")); if (unlikely(__pyx_t_5 == ((void *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 60, __pyx_L1_error)
+    __pyx_v_ptr = ((char *)__pyx_t_5);
+
+    /* "src/cy_src/skynet_py_mq.pyx":61
+ *         type_id |= PTYPE_TAG_DONTCOPY
+ *         ptr = <char *>PyCapsule_GetPointer(py_msg, "cptr")
+ *         size = py_size             # <<<<<<<<<<<<<<
+ *     elif PyBytes_CheckExact(py_msg):
+ *         ptr = py_msg
+ */
+    __pyx_t_4 = __Pyx_PyInt_As_int(__pyx_v_py_size); if (unlikely((__pyx_t_4 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 61, __pyx_L1_error)
+    __pyx_v_size = __pyx_t_4;
+
+    /* "src/cy_src/skynet_py_mq.pyx":58
+ *     cdef int size = 0
+ *     cdef bytes py_msg_bytes
+ *     if PyCapsule_CheckExact(py_msg):             # <<<<<<<<<<<<<<
+ *         type_id |= PTYPE_TAG_DONTCOPY
+ *         ptr = <char *>PyCapsule_GetPointer(py_msg, "cptr")
+ */
+    goto __pyx_L5;
+  }
+
+  /* "src/cy_src/skynet_py_mq.pyx":62
+ *         ptr = <char *>PyCapsule_GetPointer(py_msg, "cptr")
+ *         size = py_size
+ *     elif PyBytes_CheckExact(py_msg):             # <<<<<<<<<<<<<<
+ *         ptr = py_msg
+ *         size = len(py_msg)
  */
-    goto __pyx_L4;
-  }
+  __pyx_t_1 = PyBytes_CheckExact(__pyx_v_py_msg);
+  if (__pyx_t_1) {
 
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":345
- *     elif isinstance(py_arg, dict):
- *         py_pack_dict(wb, py_arg, depth+1)
- *     elif isinstance(py_arg, list):             # <<<<<<<<<<<<<<
- *         py_pack_list(wb, py_arg, depth+1)
+    /* "src/cy_src/skynet_py_mq.pyx":63
+ *         size = py_size
+ *     elif PyBytes_CheckExact(py_msg):
+ *         ptr = py_msg             # <<<<<<<<<<<<<<
+ *         size = len(py_msg)
+ *     elif PyUnicode_CheckExact(py_msg):
+ */
+    __pyx_t_2 = __Pyx_PyObject_AsWritableString(__pyx_v_py_msg); if (unlikely((!__pyx_t_2) && PyErr_Occurred())) __PYX_ERR(0, 63, __pyx_L1_error)
+    __pyx_v_ptr = __pyx_t_2;
+
+    /* "src/cy_src/skynet_py_mq.pyx":64
+ *     elif PyBytes_CheckExact(py_msg):
+ *         ptr = py_msg
+ *         size = len(py_msg)             # <<<<<<<<<<<<<<
+ *     elif PyUnicode_CheckExact(py_msg):
+ *         py_msg_bytes = PyUnicode_AsUTF8String(py_msg)
+ */
+    __pyx_t_6 = PyObject_Length(__pyx_v_py_msg); if (unlikely(__pyx_t_6 == ((Py_ssize_t)-1))) __PYX_ERR(0, 64, __pyx_L1_error)
+    __pyx_v_size = __pyx_t_6;
+
+    /* "src/cy_src/skynet_py_mq.pyx":62
+ *         ptr = <char *>PyCapsule_GetPointer(py_msg, "cptr")
+ *         size = py_size
+ *     elif PyBytes_CheckExact(py_msg):             # <<<<<<<<<<<<<<
+ *         ptr = py_msg
+ *         size = len(py_msg)
+ */
+    goto __pyx_L5;
+  }
+
+  /* "src/cy_src/skynet_py_mq.pyx":65
+ *         ptr = py_msg
+ *         size = len(py_msg)
+ *     elif PyUnicode_CheckExact(py_msg):             # <<<<<<<<<<<<<<
+ *         py_msg_bytes = PyUnicode_AsUTF8String(py_msg)
  *     else:
  */
-  __pyx_t_1 = PyList_Check(__pyx_v_py_arg); 
-  __pyx_t_3 = (__pyx_t_1 != 0);
-  if (__pyx_t_3) {
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":346
- *         py_pack_dict(wb, py_arg, depth+1)
- *     elif isinstance(py_arg, list):
- *         py_pack_list(wb, py_arg, depth+1)             # <<<<<<<<<<<<<<
+  __pyx_t_1 = PyUnicode_CheckExact(__pyx_v_py_msg);
+  if (likely(__pyx_t_1)) {
+
+    /* "src/cy_src/skynet_py_mq.pyx":66
+ *         size = len(py_msg)
+ *     elif PyUnicode_CheckExact(py_msg):
+ *         py_msg_bytes = PyUnicode_AsUTF8String(py_msg)             # <<<<<<<<<<<<<<
  *     else:
- *         py_arg_type = type(py_arg)
+ *         raise Exception("type:%s unexcept when skynet csend"%type(py_msg))
  */
-    __pyx_f_8pyskynet_22skynet_py_foreign_seri_py_pack_list(__pyx_v_wb, __pyx_v_py_arg, (__pyx_v_depth + 1)); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 346, __pyx_L1_error)
+    __pyx_t_3 = PyUnicode_AsUTF8String(__pyx_v_py_msg); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 66, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_3);
+    __pyx_v_py_msg_bytes = ((PyObject*)__pyx_t_3);
+    __pyx_t_3 = 0;
 
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":345
- *     elif isinstance(py_arg, dict):
- *         py_pack_dict(wb, py_arg, depth+1)
- *     elif isinstance(py_arg, list):             # <<<<<<<<<<<<<<
- *         py_pack_list(wb, py_arg, depth+1)
+    /* "src/cy_src/skynet_py_mq.pyx":65
+ *         ptr = py_msg
+ *         size = len(py_msg)
+ *     elif PyUnicode_CheckExact(py_msg):             # <<<<<<<<<<<<<<
+ *         py_msg_bytes = PyUnicode_AsUTF8String(py_msg)
  *     else:
  */
-    goto __pyx_L4;
+    goto __pyx_L5;
   }
 
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":348
- *         py_pack_list(wb, py_arg, depth+1)
+  /* "src/cy_src/skynet_py_mq.pyx":68
+ *         py_msg_bytes = PyUnicode_AsUTF8String(py_msg)
  *     else:
- *         py_arg_type = type(py_arg)             # <<<<<<<<<<<<<<
- *         if py_arg_type == int or np.issubdtype(py_arg_type, np.integer):
- *             wb_integer(wb_cast(wb), py_arg)
+ *         raise Exception("type:%s unexcept when skynet csend"%type(py_msg))             # <<<<<<<<<<<<<<
+ * 
+ *     if dstname == NULL:
  */
   /*else*/ {
-    __Pyx_INCREF(((PyObject *)Py_TYPE(__pyx_v_py_arg)));
-    __pyx_v_py_arg_type = ((PyTypeObject*)((PyObject *)Py_TYPE(__pyx_v_py_arg)));
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":349
- *     else:
- *         py_arg_type = type(py_arg)
- *         if py_arg_type == int or np.issubdtype(py_arg_type, np.integer):             # <<<<<<<<<<<<<<
- *             wb_integer(wb_cast(wb), py_arg)
- *         elif py_arg_type == float or np.issubdtype(py_arg_type, np.floating):
- */
-    __pyx_t_6 = PyObject_RichCompare(((PyObject *)__pyx_v_py_arg_type), ((PyObject *)(&PyInt_Type)), Py_EQ); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 349, __pyx_L1_error)
-    __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 349, __pyx_L1_error)
-    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    if (!__pyx_t_1) {
-    } else {
-      __pyx_t_3 = __pyx_t_1;
-      goto __pyx_L8_bool_binop_done;
-    }
-    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 349, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_issubdtype); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 349, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyUnicode_FormatSafe(__pyx_kp_u_type_s_unexcept_when_skynet_csen, ((PyObject *)Py_TYPE(__pyx_v_py_msg))); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 68, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_3);
+    __pyx_t_7 = __Pyx_PyObject_CallOneArg(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])), __pyx_t_3); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 68, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
-    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_np); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 349, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_integer); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 349, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_8);
-    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __pyx_t_2 = NULL;
-    __pyx_t_9 = 0;
-    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_7))) {
-      __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_7);
-      if (likely(__pyx_t_2)) {
-        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
-        __Pyx_INCREF(__pyx_t_2);
-        __Pyx_INCREF(function);
-        __Pyx_DECREF_SET(__pyx_t_7, function);
-        __pyx_t_9 = 1;
-      }
-    }
-    #if CYTHON_FAST_PYCALL
-    if (PyFunction_Check(__pyx_t_7)) {
-      PyObject *__pyx_temp[3] = {__pyx_t_2, ((PyObject *)__pyx_v_py_arg_type), __pyx_t_8};
-      __pyx_t_6 = __Pyx_PyFunction_FastCall(__pyx_t_7, __pyx_temp+1-__pyx_t_9, 2+__pyx_t_9); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 349, __pyx_L1_error)
-      __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
-      __Pyx_GOTREF(__pyx_t_6);
-      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-    } else
-    #endif
-    #if CYTHON_FAST_PYCCALL
-    if (__Pyx_PyFastCFunction_Check(__pyx_t_7)) {
-      PyObject *__pyx_temp[3] = {__pyx_t_2, ((PyObject *)__pyx_v_py_arg_type), __pyx_t_8};
-      __pyx_t_6 = __Pyx_PyCFunction_FastCall(__pyx_t_7, __pyx_temp+1-__pyx_t_9, 2+__pyx_t_9); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 349, __pyx_L1_error)
-      __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
-      __Pyx_GOTREF(__pyx_t_6);
-      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-    } else
-    #endif
-    {
-      __pyx_t_10 = PyTuple_New(2+__pyx_t_9); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 349, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_10);
-      if (__pyx_t_2) {
-        __Pyx_GIVEREF(__pyx_t_2); PyTuple_SET_ITEM(__pyx_t_10, 0, __pyx_t_2); __pyx_t_2 = NULL;
-      }
-      __Pyx_INCREF(((PyObject *)__pyx_v_py_arg_type));
-      __Pyx_GIVEREF(((PyObject *)__pyx_v_py_arg_type));
-      PyTuple_SET_ITEM(__pyx_t_10, 0+__pyx_t_9, ((PyObject *)__pyx_v_py_arg_type));
-      __Pyx_GIVEREF(__pyx_t_8);
-      PyTuple_SET_ITEM(__pyx_t_10, 1+__pyx_t_9, __pyx_t_8);
-      __pyx_t_8 = 0;
-      __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_7, __pyx_t_10, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 349, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_6);
-      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-    }
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    __Pyx_Raise(__pyx_t_7, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-    __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 349, __pyx_L1_error)
-    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __pyx_t_3 = __pyx_t_1;
-    __pyx_L8_bool_binop_done:;
-    if (__pyx_t_3) {
-
-      /* "src/cy_src/skynet_py_foreign_seri.pyx":350
- *         py_arg_type = type(py_arg)
- *         if py_arg_type == int or np.issubdtype(py_arg_type, np.integer):
- *             wb_integer(wb_cast(wb), py_arg)             # <<<<<<<<<<<<<<
- *         elif py_arg_type == float or np.issubdtype(py_arg_type, np.floating):
- *             wb_real(wb_cast(wb), py_arg)
- */
-      __pyx_t_11 = __Pyx_PyInt_As_lua_Integer(__pyx_v_py_arg); if (unlikely((__pyx_t_11 == ((lua_Integer)-1)) && PyErr_Occurred())) __PYX_ERR(0, 350, __pyx_L1_error)
-      wb_integer(wb_cast(__pyx_v_wb), __pyx_t_11);
+    __PYX_ERR(0, 68, __pyx_L1_error)
+  }
+  __pyx_L5:;
 
-      /* "src/cy_src/skynet_py_foreign_seri.pyx":349
+  /* "src/cy_src/skynet_py_mq.pyx":70
+ *         raise Exception("type:%s unexcept when skynet csend"%type(py_msg))
+ * 
+ *     if dstname == NULL:             # <<<<<<<<<<<<<<
+ *         session = skynet_py_send(dst, type_id, session, ptr, size)
  *     else:
- *         py_arg_type = type(py_arg)
- *         if py_arg_type == int or np.issubdtype(py_arg_type, np.integer):             # <<<<<<<<<<<<<<
- *             wb_integer(wb_cast(wb), py_arg)
- *         elif py_arg_type == float or np.issubdtype(py_arg_type, np.floating):
- */
-      goto __pyx_L7;
-    }
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":351
- *         if py_arg_type == int or np.issubdtype(py_arg_type, np.integer):
- *             wb_integer(wb_cast(wb), py_arg)
- *         elif py_arg_type == float or np.issubdtype(py_arg_type, np.floating):             # <<<<<<<<<<<<<<
- *             wb_real(wb_cast(wb), py_arg)
- *         elif py_arg_type == bool:
- */
-    __pyx_t_6 = PyObject_RichCompare(((PyObject *)__pyx_v_py_arg_type), ((PyObject *)(&PyFloat_Type)), Py_EQ); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 351, __pyx_L1_error)
-    __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 351, __pyx_L1_error)
-    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    if (!__pyx_t_1) {
-    } else {
-      __pyx_t_3 = __pyx_t_1;
-      goto __pyx_L10_bool_binop_done;
-    }
-    __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 351, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_7);
-    __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_issubdtype); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 351, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_10);
-    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-    __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_np); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 351, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_7);
-    __pyx_t_8 = __Pyx_PyObject_GetAttrStr(__pyx_t_7, __pyx_n_s_floating); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 351, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_8);
-    __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-    __pyx_t_7 = NULL;
-    __pyx_t_9 = 0;
-    if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_10))) {
-      __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_10);
-      if (likely(__pyx_t_7)) {
-        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_10);
-        __Pyx_INCREF(__pyx_t_7);
-        __Pyx_INCREF(function);
-        __Pyx_DECREF_SET(__pyx_t_10, function);
-        __pyx_t_9 = 1;
-      }
-    }
-    #if CYTHON_FAST_PYCALL
-    if (PyFunction_Check(__pyx_t_10)) {
-      PyObject *__pyx_temp[3] = {__pyx_t_7, ((PyObject *)__pyx_v_py_arg_type), __pyx_t_8};
-      __pyx_t_6 = __Pyx_PyFunction_FastCall(__pyx_t_10, __pyx_temp+1-__pyx_t_9, 2+__pyx_t_9); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 351, __pyx_L1_error)
-      __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
-      __Pyx_GOTREF(__pyx_t_6);
-      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-    } else
-    #endif
-    #if CYTHON_FAST_PYCCALL
-    if (__Pyx_PyFastCFunction_Check(__pyx_t_10)) {
-      PyObject *__pyx_temp[3] = {__pyx_t_7, ((PyObject *)__pyx_v_py_arg_type), __pyx_t_8};
-      __pyx_t_6 = __Pyx_PyCFunction_FastCall(__pyx_t_10, __pyx_temp+1-__pyx_t_9, 2+__pyx_t_9); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 351, __pyx_L1_error)
-      __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
-      __Pyx_GOTREF(__pyx_t_6);
-      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-    } else
-    #endif
-    {
-      __pyx_t_2 = PyTuple_New(2+__pyx_t_9); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 351, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_2);
-      if (__pyx_t_7) {
-        __Pyx_GIVEREF(__pyx_t_7); PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_7); __pyx_t_7 = NULL;
-      }
-      __Pyx_INCREF(((PyObject *)__pyx_v_py_arg_type));
-      __Pyx_GIVEREF(((PyObject *)__pyx_v_py_arg_type));
-      PyTuple_SET_ITEM(__pyx_t_2, 0+__pyx_t_9, ((PyObject *)__pyx_v_py_arg_type));
-      __Pyx_GIVEREF(__pyx_t_8);
-      PyTuple_SET_ITEM(__pyx_t_2, 1+__pyx_t_9, __pyx_t_8);
-      __pyx_t_8 = 0;
-      __pyx_t_6 = __Pyx_PyObject_Call(__pyx_t_10, __pyx_t_2, NULL); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 351, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_6);
-      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    }
-    __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-    __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 351, __pyx_L1_error)
-    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    __pyx_t_3 = __pyx_t_1;
-    __pyx_L10_bool_binop_done:;
-    if (__pyx_t_3) {
-
-      /* "src/cy_src/skynet_py_foreign_seri.pyx":352
- *             wb_integer(wb_cast(wb), py_arg)
- *         elif py_arg_type == float or np.issubdtype(py_arg_type, np.floating):
- *             wb_real(wb_cast(wb), py_arg)             # <<<<<<<<<<<<<<
- *         elif py_arg_type == bool:
- *             wb_boolean(wb_cast(wb), py_arg)
- */
-      __pyx_t_12 = __pyx_PyFloat_AsDouble(__pyx_v_py_arg); if (unlikely((__pyx_t_12 == (double)-1) && PyErr_Occurred())) __PYX_ERR(0, 352, __pyx_L1_error)
-      wb_real(wb_cast(__pyx_v_wb), __pyx_t_12);
-
-      /* "src/cy_src/skynet_py_foreign_seri.pyx":351
- *         if py_arg_type == int or np.issubdtype(py_arg_type, np.integer):
- *             wb_integer(wb_cast(wb), py_arg)
- *         elif py_arg_type == float or np.issubdtype(py_arg_type, np.floating):             # <<<<<<<<<<<<<<
- *             wb_real(wb_cast(wb), py_arg)
- *         elif py_arg_type == bool:
- */
-      goto __pyx_L7;
-    }
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":353
- *         elif py_arg_type == float or np.issubdtype(py_arg_type, np.floating):
- *             wb_real(wb_cast(wb), py_arg)
- *         elif py_arg_type == bool:             # <<<<<<<<<<<<<<
- *             wb_boolean(wb_cast(wb), py_arg)
- *         elif py_arg_type == bytes:
- */
-    __pyx_t_6 = PyObject_RichCompare(((PyObject *)__pyx_v_py_arg_type), ((PyObject*)&PyBool_Type), Py_EQ); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 353, __pyx_L1_error)
-    __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 353, __pyx_L1_error)
-    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    if (__pyx_t_3) {
-
-      /* "src/cy_src/skynet_py_foreign_seri.pyx":354
- *             wb_real(wb_cast(wb), py_arg)
- *         elif py_arg_type == bool:
- *             wb_boolean(wb_cast(wb), py_arg)             # <<<<<<<<<<<<<<
- *         elif py_arg_type == bytes:
- *             bytes_sz = len(py_arg)
- */
-      __pyx_t_9 = __Pyx_PyInt_As_int(__pyx_v_py_arg); if (unlikely((__pyx_t_9 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 354, __pyx_L1_error)
-      wb_boolean(wb_cast(__pyx_v_wb), __pyx_t_9);
-
-      /* "src/cy_src/skynet_py_foreign_seri.pyx":353
- *         elif py_arg_type == float or np.issubdtype(py_arg_type, np.floating):
- *             wb_real(wb_cast(wb), py_arg)
- *         elif py_arg_type == bool:             # <<<<<<<<<<<<<<
- *             wb_boolean(wb_cast(wb), py_arg)
- *         elif py_arg_type == bytes:
- */
-      goto __pyx_L7;
-    }
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":355
- *         elif py_arg_type == bool:
- *             wb_boolean(wb_cast(wb), py_arg)
- *         elif py_arg_type == bytes:             # <<<<<<<<<<<<<<
- *             bytes_sz = len(py_arg)
- *             bytes_ptr = py_arg
- */
-    __pyx_t_6 = PyObject_RichCompare(((PyObject *)__pyx_v_py_arg_type), ((PyObject *)(&PyBytes_Type)), Py_EQ); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 355, __pyx_L1_error)
-    __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 355, __pyx_L1_error)
-    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    if (__pyx_t_3) {
-
-      /* "src/cy_src/skynet_py_foreign_seri.pyx":356
- *             wb_boolean(wb_cast(wb), py_arg)
- *         elif py_arg_type == bytes:
- *             bytes_sz = len(py_arg)             # <<<<<<<<<<<<<<
- *             bytes_ptr = py_arg
- *             wb_string(wb_cast(wb), bytes_ptr, bytes_sz)
- */
-      __pyx_t_13 = PyObject_Length(__pyx_v_py_arg); if (unlikely(__pyx_t_13 == ((Py_ssize_t)-1))) __PYX_ERR(0, 356, __pyx_L1_error)
-      __pyx_v_bytes_sz = __pyx_t_13;
-
-      /* "src/cy_src/skynet_py_foreign_seri.pyx":357
- *         elif py_arg_type == bytes:
- *             bytes_sz = len(py_arg)
- *             bytes_ptr = py_arg             # <<<<<<<<<<<<<<
- *             wb_string(wb_cast(wb), bytes_ptr, bytes_sz)
- *         elif py_arg_type == bytearray:
- */
-      __pyx_t_4 = __Pyx_PyObject_AsWritableString(__pyx_v_py_arg); if (unlikely((!__pyx_t_4) && PyErr_Occurred())) __PYX_ERR(0, 357, __pyx_L1_error)
-      __pyx_v_bytes_ptr = __pyx_t_4;
-
-      /* "src/cy_src/skynet_py_foreign_seri.pyx":358
- *             bytes_sz = len(py_arg)
- *             bytes_ptr = py_arg
- *             wb_string(wb_cast(wb), bytes_ptr, bytes_sz)             # <<<<<<<<<<<<<<
- *         elif py_arg_type == bytearray:
- *             bytes_sz = len(py_arg)
- */
-      wb_string(wb_cast(__pyx_v_wb), __pyx_v_bytes_ptr, __pyx_v_bytes_sz);
-
-      /* "src/cy_src/skynet_py_foreign_seri.pyx":355
- *         elif py_arg_type == bool:
- *             wb_boolean(wb_cast(wb), py_arg)
- *         elif py_arg_type == bytes:             # <<<<<<<<<<<<<<
- *             bytes_sz = len(py_arg)
- *             bytes_ptr = py_arg
- */
-      goto __pyx_L7;
-    }
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":359
- *             bytes_ptr = py_arg
- *             wb_string(wb_cast(wb), bytes_ptr, bytes_sz)
- *         elif py_arg_type == bytearray:             # <<<<<<<<<<<<<<
- *             bytes_sz = len(py_arg)
- *             bytes_ptr = PyByteArray_AS_STRING(py_arg)
- */
-    __pyx_t_6 = PyObject_RichCompare(((PyObject *)__pyx_v_py_arg_type), ((PyObject *)(&PyByteArray_Type)), Py_EQ); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 359, __pyx_L1_error)
-    __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 359, __pyx_L1_error)
-    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    if (__pyx_t_3) {
-
-      /* "src/cy_src/skynet_py_foreign_seri.pyx":360
- *             wb_string(wb_cast(wb), bytes_ptr, bytes_sz)
- *         elif py_arg_type == bytearray:
- *             bytes_sz = len(py_arg)             # <<<<<<<<<<<<<<
- *             bytes_ptr = PyByteArray_AS_STRING(py_arg)
- *             wb_string(wb_cast(wb), bytes_ptr, bytes_sz)
- */
-      __pyx_t_13 = PyObject_Length(__pyx_v_py_arg); if (unlikely(__pyx_t_13 == ((Py_ssize_t)-1))) __PYX_ERR(0, 360, __pyx_L1_error)
-      __pyx_v_bytes_sz = __pyx_t_13;
-
-      /* "src/cy_src/skynet_py_foreign_seri.pyx":361
- *         elif py_arg_type == bytearray:
- *             bytes_sz = len(py_arg)
- *             bytes_ptr = PyByteArray_AS_STRING(py_arg)             # <<<<<<<<<<<<<<
- *             wb_string(wb_cast(wb), bytes_ptr, bytes_sz)
- *         elif py_arg_type == str:
- */
-      __pyx_v_bytes_ptr = PyByteArray_AS_STRING(__pyx_v_py_arg);
-
-      /* "src/cy_src/skynet_py_foreign_seri.pyx":362
- *             bytes_sz = len(py_arg)
- *             bytes_ptr = PyByteArray_AS_STRING(py_arg)
- *             wb_string(wb_cast(wb), bytes_ptr, bytes_sz)             # <<<<<<<<<<<<<<
- *         elif py_arg_type == str:
- *             py_arg_bytes = PyUnicode_AsUTF8String(py_arg)
- */
-      wb_string(wb_cast(__pyx_v_wb), __pyx_v_bytes_ptr, __pyx_v_bytes_sz);
-
-      /* "src/cy_src/skynet_py_foreign_seri.pyx":359
- *             bytes_ptr = py_arg
- *             wb_string(wb_cast(wb), bytes_ptr, bytes_sz)
- *         elif py_arg_type == bytearray:             # <<<<<<<<<<<<<<
- *             bytes_sz = len(py_arg)
- *             bytes_ptr = PyByteArray_AS_STRING(py_arg)
- */
-      goto __pyx_L7;
-    }
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":363
- *             bytes_ptr = PyByteArray_AS_STRING(py_arg)
- *             wb_string(wb_cast(wb), bytes_ptr, bytes_sz)
- *         elif py_arg_type == str:             # <<<<<<<<<<<<<<
- *             py_arg_bytes = PyUnicode_AsUTF8String(py_arg)
- *             bytes_sz = len(py_arg_bytes)
- */
-    __pyx_t_6 = PyObject_RichCompare(((PyObject *)__pyx_v_py_arg_type), ((PyObject *)(&PyUnicode_Type)), Py_EQ); __Pyx_XGOTREF(__pyx_t_6); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 363, __pyx_L1_error)
-    __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_6); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 363, __pyx_L1_error)
-    __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-    if (likely(__pyx_t_3)) {
-
-      /* "src/cy_src/skynet_py_foreign_seri.pyx":364
- *             wb_string(wb_cast(wb), bytes_ptr, bytes_sz)
- *         elif py_arg_type == str:
- *             py_arg_bytes = PyUnicode_AsUTF8String(py_arg)             # <<<<<<<<<<<<<<
- *             bytes_sz = len(py_arg_bytes)
- *             bytes_ptr = py_arg_bytes
- */
-      __pyx_t_6 = PyUnicode_AsUTF8String(__pyx_v_py_arg); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 364, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_6);
-      __pyx_v_py_arg_bytes = ((PyObject*)__pyx_t_6);
-      __pyx_t_6 = 0;
-
-      /* "src/cy_src/skynet_py_foreign_seri.pyx":365
- *         elif py_arg_type == str:
- *             py_arg_bytes = PyUnicode_AsUTF8String(py_arg)
- *             bytes_sz = len(py_arg_bytes)             # <<<<<<<<<<<<<<
- *             bytes_ptr = py_arg_bytes
- *             wb_string(wb_cast(wb), bytes_ptr, bytes_sz)
- */
-      if (unlikely(__pyx_v_py_arg_bytes == Py_None)) {
-        PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-        __PYX_ERR(0, 365, __pyx_L1_error)
-      }
-      __pyx_t_13 = PyBytes_GET_SIZE(__pyx_v_py_arg_bytes); if (unlikely(__pyx_t_13 == ((Py_ssize_t)-1))) __PYX_ERR(0, 365, __pyx_L1_error)
-      __pyx_v_bytes_sz = __pyx_t_13;
-
-      /* "src/cy_src/skynet_py_foreign_seri.pyx":366
- *             py_arg_bytes = PyUnicode_AsUTF8String(py_arg)
- *             bytes_sz = len(py_arg_bytes)
- *             bytes_ptr = py_arg_bytes             # <<<<<<<<<<<<<<
- *             wb_string(wb_cast(wb), bytes_ptr, bytes_sz)
- *         else:
- */
-      if (unlikely(__pyx_v_py_arg_bytes == Py_None)) {
-        PyErr_SetString(PyExc_TypeError, "expected bytes, NoneType found");
-        __PYX_ERR(0, 366, __pyx_L1_error)
-      }
-      __pyx_t_4 = __Pyx_PyBytes_AsWritableString(__pyx_v_py_arg_bytes); if (unlikely((!__pyx_t_4) && PyErr_Occurred())) __PYX_ERR(0, 366, __pyx_L1_error)
-      __pyx_v_bytes_ptr = __pyx_t_4;
-
-      /* "src/cy_src/skynet_py_foreign_seri.pyx":367
- *             bytes_sz = len(py_arg_bytes)
- *             bytes_ptr = py_arg_bytes
- *             wb_string(wb_cast(wb), bytes_ptr, bytes_sz)             # <<<<<<<<<<<<<<
- *         else:
- *             raise Exception("Unsupport type %s to serialize"%str(py_arg_type))
- */
-      wb_string(wb_cast(__pyx_v_wb), __pyx_v_bytes_ptr, __pyx_v_bytes_sz);
-
-      /* "src/cy_src/skynet_py_foreign_seri.pyx":363
- *             bytes_ptr = PyByteArray_AS_STRING(py_arg)
- *             wb_string(wb_cast(wb), bytes_ptr, bytes_sz)
- *         elif py_arg_type == str:             # <<<<<<<<<<<<<<
- *             py_arg_bytes = PyUnicode_AsUTF8String(py_arg)
- *             bytes_sz = len(py_arg_bytes)
  */
-      goto __pyx_L7;
-    }
+  __pyx_t_1 = (__pyx_v_dstname == NULL);
+  if (__pyx_t_1) {
 
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":369
- *             wb_string(wb_cast(wb), bytes_ptr, bytes_sz)
- *         else:
- *             raise Exception("Unsupport type %s to serialize"%str(py_arg_type))             # <<<<<<<<<<<<<<
+    /* "src/cy_src/skynet_py_mq.pyx":71
  * 
- * cdef py_foreign_pack(int mode, argtuple):
+ *     if dstname == NULL:
+ *         session = skynet_py_send(dst, type_id, session, ptr, size)             # <<<<<<<<<<<<<<
+ *     else:
+ *         session = skynet_py_sendname(dstname, type_id, session, ptr, size)
  */
-    /*else*/ {
-      __pyx_t_6 = __Pyx_PyObject_CallOneArg(((PyObject *)(&PyUnicode_Type)), ((PyObject *)__pyx_v_py_arg_type)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 369, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_6);
-      __pyx_t_10 = PyUnicode_Format(__pyx_kp_u_Unsupport_type_s_to_serialize, __pyx_t_6); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 369, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_10);
-      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-      __pyx_t_6 = __Pyx_PyObject_CallOneArg(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])), __pyx_t_10); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 369, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_6);
-      __Pyx_DECREF(__pyx_t_10); __pyx_t_10 = 0;
-      __Pyx_Raise(__pyx_t_6, 0, 0, 0);
-      __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
-      __PYX_ERR(0, 369, __pyx_L1_error)
-    }
-    __pyx_L7:;
-  }
-  __pyx_L4:;
+    __pyx_v_session = skynet_py_send(__pyx_v_dst, __pyx_v_type_id, __pyx_v_session, __pyx_v_ptr, __pyx_v_size);
 
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":319
- *     wb_nil(wb_cast(wb))
+    /* "src/cy_src/skynet_py_mq.pyx":70
+ *         raise Exception("type:%s unexcept when skynet csend"%type(py_msg))
  * 
- * cdef void py_pack_one(foreign_write_block* wb, py_arg, int depth) except *:             # <<<<<<<<<<<<<<
- *     cdef int bytes_sz = 0
- *     cdef char *bytes_ptr = NULL
+ *     if dstname == NULL:             # <<<<<<<<<<<<<<
+ *         session = skynet_py_send(dst, type_id, session, ptr, size)
+ *     else:
  */
-
-  /* function exit code */
-  goto __pyx_L0;
-  __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_2);
-  __Pyx_XDECREF(__pyx_t_6);
-  __Pyx_XDECREF(__pyx_t_7);
-  __Pyx_XDECREF(__pyx_t_8);
-  __Pyx_XDECREF(__pyx_t_10);
-  __Pyx_AddTraceback("pyskynet.skynet_py_foreign_seri.py_pack_one", __pyx_clineno, __pyx_lineno, __pyx_filename);
-  __pyx_L0:;
-  __Pyx_XDECREF(__pyx_v_arr_iter);
-  __Pyx_XDECREF(__pyx_v_py_arg_type);
-  __Pyx_XDECREF(__pyx_v_py_arg_bytes);
-  __Pyx_RefNannyFinishContext();
-}
-
-/* "src/cy_src/skynet_py_foreign_seri.pyx":371
- *             raise Exception("Unsupport type %s to serialize"%str(py_arg_type))
- * 
- * cdef py_foreign_pack(int mode, argtuple):             # <<<<<<<<<<<<<<
- *     cdef block temp
- *     temp.next = NULL
- */
-
-static PyObject *__pyx_f_8pyskynet_22skynet_py_foreign_seri_py_foreign_pack(int __pyx_v_mode, PyObject *__pyx_v_argtuple) {
-  struct block __pyx_v_temp;
-  struct foreign_write_block __pyx_v_wb;
-  PyObject *__pyx_v_one = NULL;
-  struct block *__pyx_v_b;
-  int __pyx_v_length;
-  uint8_t *__pyx_v_buffer;
-  uint8_t *__pyx_v_ptr;
-  int __pyx_v_sz;
-  PyObject *__pyx_r = NULL;
-  __Pyx_RefNannyDeclarations
-  PyObject *__pyx_t_1 = NULL;
-  Py_ssize_t __pyx_t_2;
-  PyObject *(*__pyx_t_3)(PyObject *);
-  PyObject *__pyx_t_4 = NULL;
-  int __pyx_t_5;
-  int __pyx_t_6;
-  struct block *__pyx_t_7;
-  PyObject *__pyx_t_8 = NULL;
-  int __pyx_lineno = 0;
-  const char *__pyx_filename = NULL;
-  int __pyx_clineno = 0;
-  __Pyx_RefNannySetupContext("py_foreign_pack", 0);
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":373
- * cdef py_foreign_pack(int mode, argtuple):
- *     cdef block temp
- *     temp.next = NULL             # <<<<<<<<<<<<<<
- *     cdef foreign_write_block wb
- *     foreign_wb_init(&wb, &temp, mode)
- */
-  __pyx_v_temp.next = NULL;
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":375
- *     temp.next = NULL
- *     cdef foreign_write_block wb
- *     foreign_wb_init(&wb, &temp, mode)             # <<<<<<<<<<<<<<
- *     for one in argtuple:
- *         py_pack_one(&wb, one, 0)
- */
-  foreign_wb_init((&__pyx_v_wb), (&__pyx_v_temp), __pyx_v_mode);
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":376
- *     cdef foreign_write_block wb
- *     foreign_wb_init(&wb, &temp, mode)
- *     for one in argtuple:             # <<<<<<<<<<<<<<
- *         py_pack_one(&wb, one, 0)
- *     # seri
- */
-  if (likely(PyList_CheckExact(__pyx_v_argtuple)) || PyTuple_CheckExact(__pyx_v_argtuple)) {
-    __pyx_t_1 = __pyx_v_argtuple; __Pyx_INCREF(__pyx_t_1); __pyx_t_2 = 0;
-    __pyx_t_3 = NULL;
-  } else {
-    __pyx_t_2 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_v_argtuple); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 376, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_3 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 376, __pyx_L1_error)
+    goto __pyx_L6;
   }
-  for (;;) {
-    if (likely(!__pyx_t_3)) {
-      if (likely(PyList_CheckExact(__pyx_t_1))) {
-        if (__pyx_t_2 >= PyList_GET_SIZE(__pyx_t_1)) break;
-        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_4 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 376, __pyx_L1_error)
-        #else
-        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 376, __pyx_L1_error)
-        __Pyx_GOTREF(__pyx_t_4);
-        #endif
-      } else {
-        if (__pyx_t_2 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
-        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 376, __pyx_L1_error)
-        #else
-        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 376, __pyx_L1_error)
-        __Pyx_GOTREF(__pyx_t_4);
-        #endif
-      }
-    } else {
-      __pyx_t_4 = __pyx_t_3(__pyx_t_1);
-      if (unlikely(!__pyx_t_4)) {
-        PyObject* exc_type = PyErr_Occurred();
-        if (exc_type) {
-          if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-          else __PYX_ERR(0, 376, __pyx_L1_error)
-        }
-        break;
-      }
-      __Pyx_GOTREF(__pyx_t_4);
-    }
-    __Pyx_XDECREF_SET(__pyx_v_one, __pyx_t_4);
-    __pyx_t_4 = 0;
 
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":377
- *     foreign_wb_init(&wb, &temp, mode)
- *     for one in argtuple:
- *         py_pack_one(&wb, one, 0)             # <<<<<<<<<<<<<<
- *     # seri
- *     cdef block *b = &temp
- */
-    __pyx_f_8pyskynet_22skynet_py_foreign_seri_py_pack_one((&__pyx_v_wb), __pyx_v_one, 0); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 377, __pyx_L1_error)
-
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":376
- *     cdef foreign_write_block wb
- *     foreign_wb_init(&wb, &temp, mode)
- *     for one in argtuple:             # <<<<<<<<<<<<<<
- *         py_pack_one(&wb, one, 0)
- *     # seri
+  /* "src/cy_src/skynet_py_mq.pyx":73
+ *         session = skynet_py_send(dst, type_id, session, ptr, size)
+ *     else:
+ *         session = skynet_py_sendname(dstname, type_id, session, ptr, size)             # <<<<<<<<<<<<<<
+ *     if session < 0:
+ *         if session == -2:
  */
+  /*else*/ {
+    __pyx_v_session = skynet_py_sendname(__pyx_v_dstname, __pyx_v_type_id, __pyx_v_session, __pyx_v_ptr, __pyx_v_size);
   }
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":379
- *         py_pack_one(&wb, one, 0)
- *     # seri
- *     cdef block *b = &temp             # <<<<<<<<<<<<<<
- *     cdef int length = wb.wb.len
- *     cdef uint8_t* buffer = <uint8_t*> skynet_malloc(length)
- */
-  __pyx_v_b = (&__pyx_v_temp);
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":380
- *     # seri
- *     cdef block *b = &temp
- *     cdef int length = wb.wb.len             # <<<<<<<<<<<<<<
- *     cdef uint8_t* buffer = <uint8_t*> skynet_malloc(length)
- *     cdef uint8_t* ptr = buffer
- */
-  __pyx_t_5 = __pyx_v_wb.wb.len;
-  __pyx_v_length = __pyx_t_5;
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":381
- *     cdef block *b = &temp
- *     cdef int length = wb.wb.len
- *     cdef uint8_t* buffer = <uint8_t*> skynet_malloc(length)             # <<<<<<<<<<<<<<
- *     cdef uint8_t* ptr = buffer
- *     cdef int sz = length
- */
-  __pyx_v_buffer = ((uint8_t *)skynet_malloc(__pyx_v_length));
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":382
- *     cdef int length = wb.wb.len
- *     cdef uint8_t* buffer = <uint8_t*> skynet_malloc(length)
- *     cdef uint8_t* ptr = buffer             # <<<<<<<<<<<<<<
- *     cdef int sz = length
- *     while(length > 0):
- */
-  __pyx_v_ptr = __pyx_v_buffer;
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":383
- *     cdef uint8_t* buffer = <uint8_t*> skynet_malloc(length)
- *     cdef uint8_t* ptr = buffer
- *     cdef int sz = length             # <<<<<<<<<<<<<<
- *     while(length > 0):
- *         if length >= BLOCK_SIZE:
- */
-  __pyx_v_sz = __pyx_v_length;
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":384
- *     cdef uint8_t* ptr = buffer
- *     cdef int sz = length
- *     while(length > 0):             # <<<<<<<<<<<<<<
- *         if length >= BLOCK_SIZE:
- *             memcpy(ptr, b.buffer, BLOCK_SIZE)
- */
-  while (1) {
-    __pyx_t_6 = ((__pyx_v_length > 0) != 0);
-    if (!__pyx_t_6) break;
+  __pyx_L6:;
 
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":385
- *     cdef int sz = length
- *     while(length > 0):
- *         if length >= BLOCK_SIZE:             # <<<<<<<<<<<<<<
- *             memcpy(ptr, b.buffer, BLOCK_SIZE)
- *             ptr += BLOCK_SIZE
+  /* "src/cy_src/skynet_py_mq.pyx":74
+ *     else:
+ *         session = skynet_py_sendname(dstname, type_id, session, ptr, size)
+ *     if session < 0:             # <<<<<<<<<<<<<<
+ *         if session == -2:
+ *             raise Exception("package is too large:%s"%session)
  */
-    __pyx_t_6 = ((__pyx_v_length >= 0x80) != 0);
-    if (__pyx_t_6) {
+  __pyx_t_1 = (__pyx_v_session < 0);
+  if (__pyx_t_1) {
 
-      /* "src/cy_src/skynet_py_foreign_seri.pyx":386
- *     while(length > 0):
- *         if length >= BLOCK_SIZE:
- *             memcpy(ptr, b.buffer, BLOCK_SIZE)             # <<<<<<<<<<<<<<
- *             ptr += BLOCK_SIZE
- *             length -= BLOCK_SIZE
- */
-      (void)(memcpy(__pyx_v_ptr, __pyx_v_b->buffer, 0x80));
-
-      /* "src/cy_src/skynet_py_foreign_seri.pyx":387
- *         if length >= BLOCK_SIZE:
- *             memcpy(ptr, b.buffer, BLOCK_SIZE)
- *             ptr += BLOCK_SIZE             # <<<<<<<<<<<<<<
- *             length -= BLOCK_SIZE
- *             b = b.next
- */
-      __pyx_v_ptr = (__pyx_v_ptr + 0x80);
-
-      /* "src/cy_src/skynet_py_foreign_seri.pyx":388
- *             memcpy(ptr, b.buffer, BLOCK_SIZE)
- *             ptr += BLOCK_SIZE
- *             length -= BLOCK_SIZE             # <<<<<<<<<<<<<<
- *             b = b.next
- *         else:
+    /* "src/cy_src/skynet_py_mq.pyx":75
+ *         session = skynet_py_sendname(dstname, type_id, session, ptr, size)
+ *     if session < 0:
+ *         if session == -2:             # <<<<<<<<<<<<<<
+ *             raise Exception("package is too large:%s"%session)
+ *             return False
  */
-      __pyx_v_length = (__pyx_v_length - 0x80);
+    __pyx_t_1 = (__pyx_v_session == -2L);
+    if (unlikely(__pyx_t_1)) {
 
-      /* "src/cy_src/skynet_py_foreign_seri.pyx":389
- *             ptr += BLOCK_SIZE
- *             length -= BLOCK_SIZE
- *             b = b.next             # <<<<<<<<<<<<<<
+      /* "src/cy_src/skynet_py_mq.pyx":76
+ *     if session < 0:
+ *         if session == -2:
+ *             raise Exception("package is too large:%s"%session)             # <<<<<<<<<<<<<<
+ *             return False
  *         else:
- *             memcpy(ptr, b.buffer, length)
  */
-      __pyx_t_7 = __pyx_v_b->next;
-      __pyx_v_b = __pyx_t_7;
+      __pyx_t_7 = __Pyx_PyInt_From_int(__pyx_v_session); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 76, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_7);
+      __pyx_t_3 = PyUnicode_Format(__pyx_kp_u_package_is_too_large_s, __pyx_t_7); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 76, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_3);
+      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
+      __pyx_t_7 = __Pyx_PyObject_CallOneArg(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])), __pyx_t_3); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 76, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_7);
+      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+      __Pyx_Raise(__pyx_t_7, 0, 0, 0);
+      __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
+      __PYX_ERR(0, 76, __pyx_L1_error)
 
-      /* "src/cy_src/skynet_py_foreign_seri.pyx":385
- *     cdef int sz = length
- *     while(length > 0):
- *         if length >= BLOCK_SIZE:             # <<<<<<<<<<<<<<
- *             memcpy(ptr, b.buffer, BLOCK_SIZE)
- *             ptr += BLOCK_SIZE
+      /* "src/cy_src/skynet_py_mq.pyx":75
+ *         session = skynet_py_sendname(dstname, type_id, session, ptr, size)
+ *     if session < 0:
+ *         if session == -2:             # <<<<<<<<<<<<<<
+ *             raise Exception("package is too large:%s"%session)
+ *             return False
  */
-      goto __pyx_L7;
     }
 
-    /* "src/cy_src/skynet_py_foreign_seri.pyx":391
- *             b = b.next
+    /* "src/cy_src/skynet_py_mq.pyx":79
+ *             return False
  *         else:
- *             memcpy(ptr, b.buffer, length)             # <<<<<<<<<<<<<<
- *             break
- *     wb_free(wb_cast(&wb))
+ *             return None             # <<<<<<<<<<<<<<
+ *     else:
+ *         return session
  */
     /*else*/ {
-      (void)(memcpy(__pyx_v_ptr, __pyx_v_b->buffer, __pyx_v_length));
-
-      /* "src/cy_src/skynet_py_foreign_seri.pyx":392
- *         else:
- *             memcpy(ptr, b.buffer, length)
- *             break             # <<<<<<<<<<<<<<
- *     wb_free(wb_cast(&wb))
- *     return PyCapsule_New(buffer, "cptr", NULL), sz
- */
-      goto __pyx_L6_break;
+      __Pyx_XDECREF(__pyx_r);
+      __pyx_r = Py_None; __Pyx_INCREF(Py_None);
+      goto __pyx_L0;
     }
-    __pyx_L7:;
-  }
-  __pyx_L6_break:;
 
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":393
- *             memcpy(ptr, b.buffer, length)
- *             break
- *     wb_free(wb_cast(&wb))             # <<<<<<<<<<<<<<
- *     return PyCapsule_New(buffer, "cptr", NULL), sz
- * 
+    /* "src/cy_src/skynet_py_mq.pyx":74
+ *     else:
+ *         session = skynet_py_sendname(dstname, type_id, session, ptr, size)
+ *     if session < 0:             # <<<<<<<<<<<<<<
+ *         if session == -2:
+ *             raise Exception("package is too large:%s"%session)
  */
-  wb_free(wb_cast((&__pyx_v_wb)));
+  }
 
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":394
- *             break
- *     wb_free(wb_cast(&wb))
- *     return PyCapsule_New(buffer, "cptr", NULL), sz             # <<<<<<<<<<<<<<
+  /* "src/cy_src/skynet_py_mq.pyx":81
+ *             return None
+ *     else:
+ *         return session             # <<<<<<<<<<<<<<
  * 
- * #########################
+ * # extern
  */
-  __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = PyCapsule_New(__pyx_v_buffer, ((char *)"cptr"), NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 394, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_4 = __Pyx_PyInt_From_int(__pyx_v_sz); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 394, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_8 = PyTuple_New(2); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 394, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_8);
-  __Pyx_GIVEREF(__pyx_t_1);
-  PyTuple_SET_ITEM(__pyx_t_8, 0, __pyx_t_1);
-  __Pyx_GIVEREF(__pyx_t_4);
-  PyTuple_SET_ITEM(__pyx_t_8, 1, __pyx_t_4);
-  __pyx_t_1 = 0;
-  __pyx_t_4 = 0;
-  __pyx_r = __pyx_t_8;
-  __pyx_t_8 = 0;
-  goto __pyx_L0;
+  /*else*/ {
+    __Pyx_XDECREF(__pyx_r);
+    __pyx_t_7 = __Pyx_PyInt_From_int(__pyx_v_session); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 81, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_7);
+    __pyx_r = __pyx_t_7;
+    __pyx_t_7 = 0;
+    goto __pyx_L0;
+  }
 
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":371
- *             raise Exception("Unsupport type %s to serialize"%str(py_arg_type))
+  /* "src/cy_src/skynet_py_mq.pyx":34
  * 
- * cdef py_foreign_pack(int mode, argtuple):             # <<<<<<<<<<<<<<
- *     cdef block temp
- *     temp.next = NULL
+ * # see lsend in lua-skynet.c
+ * def csend(py_dst, int type_id, py_session, py_msg, py_size=None):             # <<<<<<<<<<<<<<
+ *     assert skynet_py_address() > 0, "skynet threads has not been started yet, call 'pyskynet.start()' first."
+ *     # 1. check dst
  */
 
   /* function exit code */
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_XDECREF(__pyx_t_4);
-  __Pyx_XDECREF(__pyx_t_8);
-  __Pyx_AddTraceback("pyskynet.skynet_py_foreign_seri.py_foreign_pack", __pyx_clineno, __pyx_lineno, __pyx_filename);
-  __pyx_r = 0;
+  __Pyx_XDECREF(__pyx_t_3);
+  __Pyx_XDECREF(__pyx_t_7);
+  __Pyx_AddTraceback("pyskynet.skynet_py_mq.csend", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = NULL;
   __pyx_L0:;
-  __Pyx_XDECREF(__pyx_v_one);
+  __Pyx_XDECREF(__pyx_v_py_dst_bytes);
+  __Pyx_XDECREF(__pyx_v_py_msg_bytes);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "src/cy_src/skynet_py_foreign_seri.pyx":400
- * #########################
+/* "src/cy_src/skynet_py_mq.pyx":84
  * 
- * def tobytes(capsule, size_t size):             # <<<<<<<<<<<<<<
- *     cdef char *ptr = <char *>PyCapsule_GetPointer(capsule, PyCapsule_GetName(capsule))
- *     return ptr[:size]
+ * # extern
+ * def tostring(capsule, size_t size):             # <<<<<<<<<<<<<<
+ *     b = tobytes(capsule, size)
+ *     return b.decode()
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_8pyskynet_22skynet_py_foreign_seri_1tobytes(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_mdef_8pyskynet_22skynet_py_foreign_seri_1tobytes = {"tobytes", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_8pyskynet_22skynet_py_foreign_seri_1tobytes, METH_VARARGS|METH_KEYWORDS, 0};
-static PyObject *__pyx_pw_8pyskynet_22skynet_py_foreign_seri_1tobytes(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_pw_8pyskynet_12skynet_py_mq_5tostring(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+); /*proto*/
+static PyMethodDef __pyx_mdef_8pyskynet_12skynet_py_mq_5tostring = {"tostring", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_8pyskynet_12skynet_py_mq_5tostring, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_8pyskynet_12skynet_py_mq_5tostring(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+) {
   PyObject *__pyx_v_capsule = 0;
   size_t __pyx_v_size;
+  #if !CYTHON_METH_FASTCALL
+  CYTHON_UNUSED const Py_ssize_t __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
+  #endif
+  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
-  __Pyx_RefNannySetupContext("tobytes (wrapper)", 0);
+  __Pyx_RefNannySetupContext("tostring (wrapper)", 0);
   {
-    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_capsule,&__pyx_n_s_size,0};
+    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_capsule,&__pyx_n_s_size,0};
     PyObject* values[2] = {0,0};
-    if (unlikely(__pyx_kwds)) {
+    if (__pyx_kwds) {
       Py_ssize_t kw_args;
-      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
-      switch (pos_args) {
-        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
+      switch (__pyx_nargs) {
+        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
         CYTHON_FALLTHROUGH;
-        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
+        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
         CYTHON_FALLTHROUGH;
         case  0: break;
         default: goto __pyx_L5_argtuple_error;
       }
-      kw_args = PyDict_Size(__pyx_kwds);
-      switch (pos_args) {
+      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
+      switch (__pyx_nargs) {
         case  0:
-        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_capsule)) != 0)) kw_args--;
+        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_capsule)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 84, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
-        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_size)) != 0)) kw_args--;
+        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_size)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 84, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("tobytes", 1, 2, 2, 1); __PYX_ERR(0, 400, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("tostring", 1, 2, 2, 1); __PYX_ERR(0, 84, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "tobytes") < 0)) __PYX_ERR(0, 400, __pyx_L3_error)
+        const Py_ssize_t kwd_pos_args = __pyx_nargs;
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "tostring") < 0)) __PYX_ERR(0, 84, __pyx_L3_error)
       }
-    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
+    } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
-      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
-      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
+      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+      values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
     }
     __pyx_v_capsule = values[0];
-    __pyx_v_size = __Pyx_PyInt_As_size_t(values[1]); if (unlikely((__pyx_v_size == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 400, __pyx_L3_error)
+    __pyx_v_size = __Pyx_PyInt_As_size_t(values[1]); if (unlikely((__pyx_v_size == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 84, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("tobytes", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 400, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("tostring", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 84, __pyx_L3_error)
   __pyx_L3_error:;
-  __Pyx_AddTraceback("pyskynet.skynet_py_foreign_seri.tobytes", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("pyskynet.skynet_py_mq.tostring", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_8pyskynet_22skynet_py_foreign_seri_tobytes(__pyx_self, __pyx_v_capsule, __pyx_v_size);
+  __pyx_r = __pyx_pf_8pyskynet_12skynet_py_mq_4tostring(__pyx_self, __pyx_v_capsule, __pyx_v_size);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8pyskynet_22skynet_py_foreign_seri_tobytes(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_capsule, size_t __pyx_v_size) {
-  char *__pyx_v_ptr;
+static PyObject *__pyx_pf_8pyskynet_12skynet_py_mq_4tostring(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_capsule, size_t __pyx_v_size) {
+  PyObject *__pyx_v_b = NULL;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
-  char *__pyx_t_1;
-  void *__pyx_t_2;
+  PyObject *__pyx_t_1 = NULL;
+  PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
+  PyObject *__pyx_t_4 = NULL;
+  int __pyx_t_5;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
-  __Pyx_RefNannySetupContext("tobytes", 0);
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":401
- * 
- * def tobytes(capsule, size_t size):
- *     cdef char *ptr = <char *>PyCapsule_GetPointer(capsule, PyCapsule_GetName(capsule))             # <<<<<<<<<<<<<<
- *     return ptr[:size]
- * 
- */
-  __pyx_t_1 = PyCapsule_GetName(__pyx_v_capsule); if (unlikely(__pyx_t_1 == ((char *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 401, __pyx_L1_error)
-  __pyx_t_2 = PyCapsule_GetPointer(__pyx_v_capsule, __pyx_t_1); if (unlikely(__pyx_t_2 == ((void *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 401, __pyx_L1_error)
-  __pyx_v_ptr = ((char *)__pyx_t_2);
+  __Pyx_RefNannySetupContext("tostring", 0);
 
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":402
- * def tobytes(capsule, size_t size):
- *     cdef char *ptr = <char *>PyCapsule_GetPointer(capsule, PyCapsule_GetName(capsule))
- *     return ptr[:size]             # <<<<<<<<<<<<<<
+  /* "src/cy_src/skynet_py_mq.pyx":85
+ * # extern
+ * def tostring(capsule, size_t size):
+ *     b = tobytes(capsule, size)             # <<<<<<<<<<<<<<
+ *     return b.decode()
  * 
- * def luapack(*args):
  */
-  __Pyx_XDECREF(__pyx_r);
-  __pyx_t_3 = __Pyx_PyBytes_FromStringAndSize(__pyx_v_ptr + 0, __pyx_v_size - 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 402, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_tobytes); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 85, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_3 = __Pyx_PyInt_FromSize_t(__pyx_v_size); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 85, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_r = __pyx_t_3;
-  __pyx_t_3 = 0;
-  goto __pyx_L0;
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":400
- * #########################
- * 
- * def tobytes(capsule, size_t size):             # <<<<<<<<<<<<<<
- *     cdef char *ptr = <char *>PyCapsule_GetPointer(capsule, PyCapsule_GetName(capsule))
- *     return ptr[:size]
- */
-
-  /* function exit code */
-  __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_3);
-  __Pyx_AddTraceback("pyskynet.skynet_py_foreign_seri.tobytes", __pyx_clineno, __pyx_lineno, __pyx_filename);
-  __pyx_r = NULL;
-  __pyx_L0:;
-  __Pyx_XGIVEREF(__pyx_r);
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-/* "src/cy_src/skynet_py_foreign_seri.pyx":404
- *     return ptr[:size]
- * 
- * def luapack(*args):             # <<<<<<<<<<<<<<
- *     return py_foreign_pack(MODE_LUA, args)
- * 
- */
-
-/* Python wrapper */
-static PyObject *__pyx_pw_8pyskynet_22skynet_py_foreign_seri_3luapack(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_mdef_8pyskynet_22skynet_py_foreign_seri_3luapack = {"luapack", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_8pyskynet_22skynet_py_foreign_seri_3luapack, METH_VARARGS|METH_KEYWORDS, 0};
-static PyObject *__pyx_pw_8pyskynet_22skynet_py_foreign_seri_3luapack(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
-  PyObject *__pyx_v_args = 0;
-  PyObject *__pyx_r = 0;
-  __Pyx_RefNannyDeclarations
-  __Pyx_RefNannySetupContext("luapack (wrapper)", 0);
-  if (unlikely(__pyx_kwds) && unlikely(PyDict_Size(__pyx_kwds) > 0) && unlikely(!__Pyx_CheckKeywordStrings(__pyx_kwds, "luapack", 0))) return NULL;
-  __Pyx_INCREF(__pyx_args);
-  __pyx_v_args = __pyx_args;
-  __pyx_r = __pyx_pf_8pyskynet_22skynet_py_foreign_seri_2luapack(__pyx_self, __pyx_v_args);
-
-  /* function exit code */
-  __Pyx_XDECREF(__pyx_v_args);
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-static PyObject *__pyx_pf_8pyskynet_22skynet_py_foreign_seri_2luapack(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_args) {
-  PyObject *__pyx_r = NULL;
-  __Pyx_RefNannyDeclarations
-  PyObject *__pyx_t_1 = NULL;
-  int __pyx_lineno = 0;
-  const char *__pyx_filename = NULL;
-  int __pyx_clineno = 0;
-  __Pyx_RefNannySetupContext("luapack", 0);
+  __pyx_t_4 = NULL;
+  __pyx_t_5 = 0;
+  if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_2))) {
+    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_2);
+    if (likely(__pyx_t_4)) {
+      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
+      __Pyx_INCREF(__pyx_t_4);
+      __Pyx_INCREF(function);
+      __Pyx_DECREF_SET(__pyx_t_2, function);
+      __pyx_t_5 = 1;
+    }
+  }
+  {
+    PyObject *__pyx_callargs[3] = {__pyx_t_4, __pyx_v_capsule, __pyx_t_3};
+    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_5, 2+__pyx_t_5);
+    __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 85, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_1);
+    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  }
+  __pyx_v_b = __pyx_t_1;
+  __pyx_t_1 = 0;
 
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":405
- * 
- * def luapack(*args):
- *     return py_foreign_pack(MODE_LUA, args)             # <<<<<<<<<<<<<<
+  /* "src/cy_src/skynet_py_mq.pyx":86
+ * def tostring(capsule, size_t size):
+ *     b = tobytes(capsule, size)
+ *     return b.decode()             # <<<<<<<<<<<<<<
  * 
- * def luaunpack(capsule, size=None):
+ * # extern
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __pyx_f_8pyskynet_22skynet_py_foreign_seri_py_foreign_pack(MODE_LUA, __pyx_v_args); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 405, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_v_b, __pyx_n_s_decode); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 86, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_3 = NULL;
+  __pyx_t_5 = 0;
+  if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
+    __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
+    if (likely(__pyx_t_3)) {
+      PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
+      __Pyx_INCREF(__pyx_t_3);
+      __Pyx_INCREF(function);
+      __Pyx_DECREF_SET(__pyx_t_2, function);
+      __pyx_t_5 = 1;
+    }
+  }
+  {
+    PyObject *__pyx_callargs[1] = {__pyx_t_3, };
+    __pyx_t_1 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_5, 0+__pyx_t_5);
+    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
+    if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 86, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_1);
+    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  }
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":404
- *     return ptr[:size]
- * 
- * def luapack(*args):             # <<<<<<<<<<<<<<
- *     return py_foreign_pack(MODE_LUA, args)
+  /* "src/cy_src/skynet_py_mq.pyx":84
  * 
+ * # extern
+ * def tostring(capsule, size_t size):             # <<<<<<<<<<<<<<
+ *     b = tobytes(capsule, size)
+ *     return b.decode()
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_AddTraceback("pyskynet.skynet_py_foreign_seri.luapack", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_XDECREF(__pyx_t_3);
+  __Pyx_XDECREF(__pyx_t_4);
+  __Pyx_AddTraceback("pyskynet.skynet_py_mq.tostring", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
+  __Pyx_XDECREF(__pyx_v_b);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "src/cy_src/skynet_py_foreign_seri.pyx":407
- *     return py_foreign_pack(MODE_LUA, args)
- * 
- * def luaunpack(capsule, size=None):             # <<<<<<<<<<<<<<
- *     return py_foreign_unpack(MODE_LUA, capsule, size)
+/* "src/cy_src/skynet_py_mq.pyx":89
  * 
+ * # extern
+ * def tobytes(capsule, size_t size):             # <<<<<<<<<<<<<<
+ *     cdef char *name = PyCapsule_GetName(capsule)
+ *     cdef char *ptr = <char *>PyCapsule_GetPointer(capsule, name)
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_8pyskynet_22skynet_py_foreign_seri_5luaunpack(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_mdef_8pyskynet_22skynet_py_foreign_seri_5luaunpack = {"luaunpack", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_8pyskynet_22skynet_py_foreign_seri_5luaunpack, METH_VARARGS|METH_KEYWORDS, 0};
-static PyObject *__pyx_pw_8pyskynet_22skynet_py_foreign_seri_5luaunpack(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
+static PyObject *__pyx_pw_8pyskynet_12skynet_py_mq_7tobytes(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+); /*proto*/
+static PyMethodDef __pyx_mdef_8pyskynet_12skynet_py_mq_7tobytes = {"tobytes", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_8pyskynet_12skynet_py_mq_7tobytes, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_8pyskynet_12skynet_py_mq_7tobytes(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+) {
   PyObject *__pyx_v_capsule = 0;
-  PyObject *__pyx_v_size = 0;
+  size_t __pyx_v_size;
+  #if !CYTHON_METH_FASTCALL
+  CYTHON_UNUSED const Py_ssize_t __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
+  #endif
+  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
-  __Pyx_RefNannySetupContext("luaunpack (wrapper)", 0);
+  __Pyx_RefNannySetupContext("tobytes (wrapper)", 0);
   {
-    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_capsule,&__pyx_n_s_size,0};
+    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_capsule,&__pyx_n_s_size,0};
     PyObject* values[2] = {0,0};
-    values[1] = ((PyObject *)Py_None);
-    if (unlikely(__pyx_kwds)) {
+    if (__pyx_kwds) {
       Py_ssize_t kw_args;
-      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
-      switch (pos_args) {
-        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
+      switch (__pyx_nargs) {
+        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
         CYTHON_FALLTHROUGH;
-        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
+        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
         CYTHON_FALLTHROUGH;
         case  0: break;
         default: goto __pyx_L5_argtuple_error;
       }
-      kw_args = PyDict_Size(__pyx_kwds);
-      switch (pos_args) {
+      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
+      switch (__pyx_nargs) {
         case  0:
-        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_capsule)) != 0)) kw_args--;
+        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_capsule)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 89, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
-        if (kw_args > 0) {
-          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_size);
-          if (value) { values[1] = value; kw_args--; }
+        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_size)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 89, __pyx_L3_error)
+        else {
+          __Pyx_RaiseArgtupleInvalid("tobytes", 1, 2, 2, 1); __PYX_ERR(0, 89, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "luaunpack") < 0)) __PYX_ERR(0, 407, __pyx_L3_error)
+        const Py_ssize_t kwd_pos_args = __pyx_nargs;
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "tobytes") < 0)) __PYX_ERR(0, 89, __pyx_L3_error)
       }
+    } else if (unlikely(__pyx_nargs != 2)) {
+      goto __pyx_L5_argtuple_error;
     } else {
-      switch (PyTuple_GET_SIZE(__pyx_args)) {
-        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
-        CYTHON_FALLTHROUGH;
-        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
-        break;
-        default: goto __pyx_L5_argtuple_error;
-      }
+      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+      values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
     }
     __pyx_v_capsule = values[0];
-    __pyx_v_size = values[1];
+    __pyx_v_size = __Pyx_PyInt_As_size_t(values[1]); if (unlikely((__pyx_v_size == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 89, __pyx_L3_error)
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("luaunpack", 0, 1, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 407, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("tobytes", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 89, __pyx_L3_error)
   __pyx_L3_error:;
-  __Pyx_AddTraceback("pyskynet.skynet_py_foreign_seri.luaunpack", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("pyskynet.skynet_py_mq.tobytes", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_8pyskynet_22skynet_py_foreign_seri_4luaunpack(__pyx_self, __pyx_v_capsule, __pyx_v_size);
+  __pyx_r = __pyx_pf_8pyskynet_12skynet_py_mq_6tobytes(__pyx_self, __pyx_v_capsule, __pyx_v_size);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8pyskynet_22skynet_py_foreign_seri_4luaunpack(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_capsule, PyObject *__pyx_v_size) {
+static PyObject *__pyx_pf_8pyskynet_12skynet_py_mq_6tobytes(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_capsule, size_t __pyx_v_size) {
+  char *__pyx_v_name;
+  char *__pyx_v_ptr;
+  PyObject *__pyx_v_s = 0;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
-  PyObject *__pyx_t_1 = NULL;
+  char const *__pyx_t_1;
+  void *__pyx_t_2;
+  int __pyx_t_3;
+  int __pyx_t_4;
+  PyObject *__pyx_t_5 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
-  __Pyx_RefNannySetupContext("luaunpack", 0);
+  __Pyx_RefNannySetupContext("tobytes", 0);
 
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":408
- * 
- * def luaunpack(capsule, size=None):
- *     return py_foreign_unpack(MODE_LUA, capsule, size)             # <<<<<<<<<<<<<<
- * 
- * def pack(*args):
+  /* "src/cy_src/skynet_py_mq.pyx":90
+ * # extern
+ * def tobytes(capsule, size_t size):
+ *     cdef char *name = PyCapsule_GetName(capsule)             # <<<<<<<<<<<<<<
+ *     cdef char *ptr = <char *>PyCapsule_GetPointer(capsule, name)
+ *     cdef bytes s
  */
-  __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __pyx_f_8pyskynet_22skynet_py_foreign_seri_py_foreign_unpack(MODE_LUA, __pyx_v_capsule, __pyx_v_size); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 408, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_r = __pyx_t_1;
-  __pyx_t_1 = 0;
-  goto __pyx_L0;
+  __pyx_t_1 = PyCapsule_GetName(__pyx_v_capsule); if (unlikely(__pyx_t_1 == ((char const *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 90, __pyx_L1_error)
+  __pyx_v_name = __pyx_t_1;
 
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":407
- *     return py_foreign_pack(MODE_LUA, args)
- * 
- * def luaunpack(capsule, size=None):             # <<<<<<<<<<<<<<
- *     return py_foreign_unpack(MODE_LUA, capsule, size)
- * 
+  /* "src/cy_src/skynet_py_mq.pyx":91
+ * def tobytes(capsule, size_t size):
+ *     cdef char *name = PyCapsule_GetName(capsule)
+ *     cdef char *ptr = <char *>PyCapsule_GetPointer(capsule, name)             # <<<<<<<<<<<<<<
+ *     cdef bytes s
+ *     if strcmp(name, "cptr") == 0 or strcmp(name, "pyptr") == 0:
  */
+  __pyx_t_2 = PyCapsule_GetPointer(__pyx_v_capsule, __pyx_v_name); if (unlikely(__pyx_t_2 == ((void *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 91, __pyx_L1_error)
+  __pyx_v_ptr = ((char *)__pyx_t_2);
 
-  /* function exit code */
-  __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_AddTraceback("pyskynet.skynet_py_foreign_seri.luaunpack", __pyx_clineno, __pyx_lineno, __pyx_filename);
-  __pyx_r = NULL;
-  __pyx_L0:;
-  __Pyx_XGIVEREF(__pyx_r);
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-/* "src/cy_src/skynet_py_foreign_seri.pyx":410
- *     return py_foreign_unpack(MODE_LUA, capsule, size)
- * 
- * def pack(*args):             # <<<<<<<<<<<<<<
- *     return py_foreign_pack(MODE_FOREIGN, args)
- * 
+  /* "src/cy_src/skynet_py_mq.pyx":93
+ *     cdef char *ptr = <char *>PyCapsule_GetPointer(capsule, name)
+ *     cdef bytes s
+ *     if strcmp(name, "cptr") == 0 or strcmp(name, "pyptr") == 0:             # <<<<<<<<<<<<<<
+ *         s = ptr[:size]
+ *         return s
  */
+  __pyx_t_4 = (strcmp(__pyx_v_name, ((char const *)"cptr")) == 0);
+  if (!__pyx_t_4) {
+  } else {
+    __pyx_t_3 = __pyx_t_4;
+    goto __pyx_L4_bool_binop_done;
+  }
+  __pyx_t_4 = (strcmp(__pyx_v_name, ((char const *)"pyptr")) == 0);
+  __pyx_t_3 = __pyx_t_4;
+  __pyx_L4_bool_binop_done:;
+  if (likely(__pyx_t_3)) {
+
+    /* "src/cy_src/skynet_py_mq.pyx":94
+ *     cdef bytes s
+ *     if strcmp(name, "cptr") == 0 or strcmp(name, "pyptr") == 0:
+ *         s = ptr[:size]             # <<<<<<<<<<<<<<
+ *         return s
+ *     else:
+ */
+    __pyx_t_5 = __Pyx_PyBytes_FromStringAndSize(__pyx_v_ptr + 0, __pyx_v_size - 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 94, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_5);
+    __pyx_v_s = ((PyObject*)__pyx_t_5);
+    __pyx_t_5 = 0;
 
-/* Python wrapper */
-static PyObject *__pyx_pw_8pyskynet_22skynet_py_foreign_seri_7pack(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_mdef_8pyskynet_22skynet_py_foreign_seri_7pack = {"pack", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_8pyskynet_22skynet_py_foreign_seri_7pack, METH_VARARGS|METH_KEYWORDS, 0};
-static PyObject *__pyx_pw_8pyskynet_22skynet_py_foreign_seri_7pack(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
-  PyObject *__pyx_v_args = 0;
-  PyObject *__pyx_r = 0;
-  __Pyx_RefNannyDeclarations
-  __Pyx_RefNannySetupContext("pack (wrapper)", 0);
-  if (unlikely(__pyx_kwds) && unlikely(PyDict_Size(__pyx_kwds) > 0) && unlikely(!__Pyx_CheckKeywordStrings(__pyx_kwds, "pack", 0))) return NULL;
-  __Pyx_INCREF(__pyx_args);
-  __pyx_v_args = __pyx_args;
-  __pyx_r = __pyx_pf_8pyskynet_22skynet_py_foreign_seri_6pack(__pyx_self, __pyx_v_args);
-
-  /* function exit code */
-  __Pyx_XDECREF(__pyx_v_args);
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
+    /* "src/cy_src/skynet_py_mq.pyx":95
+ *     if strcmp(name, "cptr") == 0 or strcmp(name, "pyptr") == 0:
+ *         s = ptr[:size]
+ *         return s             # <<<<<<<<<<<<<<
+ *     else:
+ *         raise Exception("capsule unpack failed for name = %s")
+ */
+    __Pyx_XDECREF(__pyx_r);
+    __Pyx_INCREF(__pyx_v_s);
+    __pyx_r = __pyx_v_s;
+    goto __pyx_L0;
 
-static PyObject *__pyx_pf_8pyskynet_22skynet_py_foreign_seri_6pack(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_args) {
-  PyObject *__pyx_r = NULL;
-  __Pyx_RefNannyDeclarations
-  PyObject *__pyx_t_1 = NULL;
-  int __pyx_lineno = 0;
-  const char *__pyx_filename = NULL;
-  int __pyx_clineno = 0;
-  __Pyx_RefNannySetupContext("pack", 0);
+    /* "src/cy_src/skynet_py_mq.pyx":93
+ *     cdef char *ptr = <char *>PyCapsule_GetPointer(capsule, name)
+ *     cdef bytes s
+ *     if strcmp(name, "cptr") == 0 or strcmp(name, "pyptr") == 0:             # <<<<<<<<<<<<<<
+ *         s = ptr[:size]
+ *         return s
+ */
+  }
 
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":411
- * 
- * def pack(*args):
- *     return py_foreign_pack(MODE_FOREIGN, args)             # <<<<<<<<<<<<<<
+  /* "src/cy_src/skynet_py_mq.pyx":97
+ *         return s
+ *     else:
+ *         raise Exception("capsule unpack failed for name = %s")             # <<<<<<<<<<<<<<
  * 
- * def unpack(capsule, size=None):
+ * class PTYPEEnum(object):
  */
-  __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __pyx_f_8pyskynet_22skynet_py_foreign_seri_py_foreign_pack(MODE_FOREIGN, __pyx_v_args); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 411, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_r = __pyx_t_1;
-  __pyx_t_1 = 0;
-  goto __pyx_L0;
+  /*else*/ {
+    __pyx_t_5 = __Pyx_PyObject_Call(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])), __pyx_tuple__3, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 97, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_5);
+    __Pyx_Raise(__pyx_t_5, 0, 0, 0);
+    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+    __PYX_ERR(0, 97, __pyx_L1_error)
+  }
 
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":410
- *     return py_foreign_unpack(MODE_LUA, capsule, size)
- * 
- * def pack(*args):             # <<<<<<<<<<<<<<
- *     return py_foreign_pack(MODE_FOREIGN, args)
+  /* "src/cy_src/skynet_py_mq.pyx":89
  * 
+ * # extern
+ * def tobytes(capsule, size_t size):             # <<<<<<<<<<<<<<
+ *     cdef char *name = PyCapsule_GetName(capsule)
+ *     cdef char *ptr = <char *>PyCapsule_GetPointer(capsule, name)
  */
 
   /* function exit code */
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_AddTraceback("pyskynet.skynet_py_foreign_seri.pack", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_XDECREF(__pyx_t_5);
+  __Pyx_AddTraceback("pyskynet.skynet_py_mq.tobytes", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
+  __Pyx_XDECREF(__pyx_v_s);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "src/cy_src/skynet_py_foreign_seri.pyx":413
- *     return py_foreign_pack(MODE_FOREIGN, args)
- * 
- * def unpack(capsule, size=None):             # <<<<<<<<<<<<<<
- *     return py_foreign_unpack(MODE_FOREIGN, capsule, size)
+/* "src/cy_src/skynet_py_mq.pyx":100
  * 
+ * class PTYPEEnum(object):
+ *     def __init__(self):             # <<<<<<<<<<<<<<
+ *         self.PTYPE_TEXT=PTYPE_TEXT
+ *         self.PTYPE_RESPONSE=PTYPE_RESPONSE
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_8pyskynet_22skynet_py_foreign_seri_9unpack(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_mdef_8pyskynet_22skynet_py_foreign_seri_9unpack = {"unpack", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_8pyskynet_22skynet_py_foreign_seri_9unpack, METH_VARARGS|METH_KEYWORDS, 0};
-static PyObject *__pyx_pw_8pyskynet_22skynet_py_foreign_seri_9unpack(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
-  PyObject *__pyx_v_capsule = 0;
-  PyObject *__pyx_v_size = 0;
+static PyObject *__pyx_pw_8pyskynet_12skynet_py_mq_9PTYPEEnum_1__init__(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+); /*proto*/
+static PyMethodDef __pyx_mdef_8pyskynet_12skynet_py_mq_9PTYPEEnum_1__init__ = {"__init__", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_8pyskynet_12skynet_py_mq_9PTYPEEnum_1__init__, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_8pyskynet_12skynet_py_mq_9PTYPEEnum_1__init__(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+) {
+  PyObject *__pyx_v_self = 0;
+  #if !CYTHON_METH_FASTCALL
+  CYTHON_UNUSED const Py_ssize_t __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
+  #endif
+  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
-  __Pyx_RefNannySetupContext("unpack (wrapper)", 0);
+  __Pyx_RefNannySetupContext("__init__ (wrapper)", 0);
   {
-    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_capsule,&__pyx_n_s_size,0};
-    PyObject* values[2] = {0,0};
-    values[1] = ((PyObject *)Py_None);
-    if (unlikely(__pyx_kwds)) {
+    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_self,0};
+    PyObject* values[1] = {0};
+    if (__pyx_kwds) {
       Py_ssize_t kw_args;
-      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
-      switch (pos_args) {
-        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
-        CYTHON_FALLTHROUGH;
-        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
+      switch (__pyx_nargs) {
+        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
         CYTHON_FALLTHROUGH;
         case  0: break;
         default: goto __pyx_L5_argtuple_error;
       }
-      kw_args = PyDict_Size(__pyx_kwds);
-      switch (pos_args) {
+      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
+      switch (__pyx_nargs) {
         case  0:
-        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_capsule)) != 0)) kw_args--;
+        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_self)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 100, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
-        CYTHON_FALLTHROUGH;
-        case  1:
-        if (kw_args > 0) {
-          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_size);
-          if (value) { values[1] = value; kw_args--; }
-        }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "unpack") < 0)) __PYX_ERR(0, 413, __pyx_L3_error)
+        const Py_ssize_t kwd_pos_args = __pyx_nargs;
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "__init__") < 0)) __PYX_ERR(0, 100, __pyx_L3_error)
       }
+    } else if (unlikely(__pyx_nargs != 1)) {
+      goto __pyx_L5_argtuple_error;
     } else {
-      switch (PyTuple_GET_SIZE(__pyx_args)) {
-        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
-        CYTHON_FALLTHROUGH;
-        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
-        break;
-        default: goto __pyx_L5_argtuple_error;
-      }
+      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
     }
-    __pyx_v_capsule = values[0];
-    __pyx_v_size = values[1];
+    __pyx_v_self = values[0];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("unpack", 0, 1, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 413, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("__init__", 1, 1, 1, __pyx_nargs); __PYX_ERR(0, 100, __pyx_L3_error)
   __pyx_L3_error:;
-  __Pyx_AddTraceback("pyskynet.skynet_py_foreign_seri.unpack", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("pyskynet.skynet_py_mq.PTYPEEnum.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_8pyskynet_22skynet_py_foreign_seri_8unpack(__pyx_self, __pyx_v_capsule, __pyx_v_size);
+  __pyx_r = __pyx_pf_8pyskynet_12skynet_py_mq_9PTYPEEnum___init__(__pyx_self, __pyx_v_self);
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-static PyObject *__pyx_pf_8pyskynet_22skynet_py_foreign_seri_8unpack(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_capsule, PyObject *__pyx_v_size) {
+static PyObject *__pyx_pf_8pyskynet_12skynet_py_mq_9PTYPEEnum___init__(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_self) {
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
-  __Pyx_RefNannySetupContext("unpack", 0);
+  __Pyx_RefNannySetupContext("__init__", 0);
 
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":414
- * 
- * def unpack(capsule, size=None):
- *     return py_foreign_unpack(MODE_FOREIGN, capsule, size)             # <<<<<<<<<<<<<<
- * 
- * def remotepack(*args):
+  /* "src/cy_src/skynet_py_mq.pyx":101
+ * class PTYPEEnum(object):
+ *     def __init__(self):
+ *         self.PTYPE_TEXT=PTYPE_TEXT             # <<<<<<<<<<<<<<
+ *         self.PTYPE_RESPONSE=PTYPE_RESPONSE
+ *         self.PTYPE_MULTICAST=PTYPE_MULTICAST
  */
-  __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __pyx_f_8pyskynet_22skynet_py_foreign_seri_py_foreign_unpack(MODE_FOREIGN, __pyx_v_capsule, __pyx_v_size); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 414, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_int(PTYPE_TEXT); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 101, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_r = __pyx_t_1;
-  __pyx_t_1 = 0;
-  goto __pyx_L0;
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_PTYPE_TEXT, __pyx_t_1) < 0) __PYX_ERR(0, 101, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":413
- *     return py_foreign_pack(MODE_FOREIGN, args)
- * 
- * def unpack(capsule, size=None):             # <<<<<<<<<<<<<<
- *     return py_foreign_unpack(MODE_FOREIGN, capsule, size)
- * 
+  /* "src/cy_src/skynet_py_mq.pyx":102
+ *     def __init__(self):
+ *         self.PTYPE_TEXT=PTYPE_TEXT
+ *         self.PTYPE_RESPONSE=PTYPE_RESPONSE             # <<<<<<<<<<<<<<
+ *         self.PTYPE_MULTICAST=PTYPE_MULTICAST
+ *         self.PTYPE_CLIENT=PTYPE_CLIENT
  */
+  __pyx_t_1 = __Pyx_PyInt_From_int(PTYPE_RESPONSE); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 102, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_PTYPE_RESPONSE, __pyx_t_1) < 0) __PYX_ERR(0, 102, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* function exit code */
-  __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_AddTraceback("pyskynet.skynet_py_foreign_seri.unpack", __pyx_clineno, __pyx_lineno, __pyx_filename);
-  __pyx_r = NULL;
-  __pyx_L0:;
-  __Pyx_XGIVEREF(__pyx_r);
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
+  /* "src/cy_src/skynet_py_mq.pyx":103
+ *         self.PTYPE_TEXT=PTYPE_TEXT
+ *         self.PTYPE_RESPONSE=PTYPE_RESPONSE
+ *         self.PTYPE_MULTICAST=PTYPE_MULTICAST             # <<<<<<<<<<<<<<
+ *         self.PTYPE_CLIENT=PTYPE_CLIENT
+ *         self.PTYPE_SYSTEM=PTYPE_SYSTEM
+ */
+  __pyx_t_1 = __Pyx_PyInt_From_int(PTYPE_MULTICAST); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 103, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_PTYPE_MULTICAST, __pyx_t_1) < 0) __PYX_ERR(0, 103, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-/* "src/cy_src/skynet_py_foreign_seri.pyx":416
- *     return py_foreign_unpack(MODE_FOREIGN, capsule, size)
- * 
- * def remotepack(*args):             # <<<<<<<<<<<<<<
- *     return py_foreign_pack(MODE_FOREIGN_REMOTE, args)
- * 
+  /* "src/cy_src/skynet_py_mq.pyx":104
+ *         self.PTYPE_RESPONSE=PTYPE_RESPONSE
+ *         self.PTYPE_MULTICAST=PTYPE_MULTICAST
+ *         self.PTYPE_CLIENT=PTYPE_CLIENT             # <<<<<<<<<<<<<<
+ *         self.PTYPE_SYSTEM=PTYPE_SYSTEM
+ *         self.PTYPE_HARBOR=PTYPE_HARBOR
  */
+  __pyx_t_1 = __Pyx_PyInt_From_int(PTYPE_CLIENT); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 104, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_PTYPE_CLIENT, __pyx_t_1) < 0) __PYX_ERR(0, 104, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-/* Python wrapper */
-static PyObject *__pyx_pw_8pyskynet_22skynet_py_foreign_seri_11remotepack(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_mdef_8pyskynet_22skynet_py_foreign_seri_11remotepack = {"remotepack", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_8pyskynet_22skynet_py_foreign_seri_11remotepack, METH_VARARGS|METH_KEYWORDS, 0};
-static PyObject *__pyx_pw_8pyskynet_22skynet_py_foreign_seri_11remotepack(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
-  PyObject *__pyx_v_args = 0;
-  PyObject *__pyx_r = 0;
-  __Pyx_RefNannyDeclarations
-  __Pyx_RefNannySetupContext("remotepack (wrapper)", 0);
-  if (unlikely(__pyx_kwds) && unlikely(PyDict_Size(__pyx_kwds) > 0) && unlikely(!__Pyx_CheckKeywordStrings(__pyx_kwds, "remotepack", 0))) return NULL;
-  __Pyx_INCREF(__pyx_args);
-  __pyx_v_args = __pyx_args;
-  __pyx_r = __pyx_pf_8pyskynet_22skynet_py_foreign_seri_10remotepack(__pyx_self, __pyx_v_args);
+  /* "src/cy_src/skynet_py_mq.pyx":105
+ *         self.PTYPE_MULTICAST=PTYPE_MULTICAST
+ *         self.PTYPE_CLIENT=PTYPE_CLIENT
+ *         self.PTYPE_SYSTEM=PTYPE_SYSTEM             # <<<<<<<<<<<<<<
+ *         self.PTYPE_HARBOR=PTYPE_HARBOR
+ *         self.PTYPE_SOCKET=PTYPE_SOCKET
+ */
+  __pyx_t_1 = __Pyx_PyInt_From_int(PTYPE_SYSTEM); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 105, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_PTYPE_SYSTEM, __pyx_t_1) < 0) __PYX_ERR(0, 105, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* function exit code */
-  __Pyx_XDECREF(__pyx_v_args);
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
+  /* "src/cy_src/skynet_py_mq.pyx":106
+ *         self.PTYPE_CLIENT=PTYPE_CLIENT
+ *         self.PTYPE_SYSTEM=PTYPE_SYSTEM
+ *         self.PTYPE_HARBOR=PTYPE_HARBOR             # <<<<<<<<<<<<<<
+ *         self.PTYPE_SOCKET=PTYPE_SOCKET
+ *         self.PTYPE_ERROR=PTYPE_ERROR
+ */
+  __pyx_t_1 = __Pyx_PyInt_From_int(PTYPE_HARBOR); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 106, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_PTYPE_HARBOR, __pyx_t_1) < 0) __PYX_ERR(0, 106, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-static PyObject *__pyx_pf_8pyskynet_22skynet_py_foreign_seri_10remotepack(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_args) {
-  PyObject *__pyx_r = NULL;
-  __Pyx_RefNannyDeclarations
-  PyObject *__pyx_t_1 = NULL;
-  int __pyx_lineno = 0;
-  const char *__pyx_filename = NULL;
-  int __pyx_clineno = 0;
-  __Pyx_RefNannySetupContext("remotepack", 0);
+  /* "src/cy_src/skynet_py_mq.pyx":107
+ *         self.PTYPE_SYSTEM=PTYPE_SYSTEM
+ *         self.PTYPE_HARBOR=PTYPE_HARBOR
+ *         self.PTYPE_SOCKET=PTYPE_SOCKET             # <<<<<<<<<<<<<<
+ *         self.PTYPE_ERROR=PTYPE_ERROR
+ *         self.PTYPE_QUEUE=PTYPE_RESERVED_QUEUE
+ */
+  __pyx_t_1 = __Pyx_PyInt_From_int(PTYPE_SOCKET); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 107, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_PTYPE_SOCKET, __pyx_t_1) < 0) __PYX_ERR(0, 107, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":417
- * 
- * def remotepack(*args):
- *     return py_foreign_pack(MODE_FOREIGN_REMOTE, args)             # <<<<<<<<<<<<<<
- * 
- * def remoteunpack(capsule, size=None):
+  /* "src/cy_src/skynet_py_mq.pyx":108
+ *         self.PTYPE_HARBOR=PTYPE_HARBOR
+ *         self.PTYPE_SOCKET=PTYPE_SOCKET
+ *         self.PTYPE_ERROR=PTYPE_ERROR             # <<<<<<<<<<<<<<
+ *         self.PTYPE_QUEUE=PTYPE_RESERVED_QUEUE
+ *         self.PTYPE_DEBUG=PTYPE_RESERVED_DEBUG
  */
-  __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __pyx_f_8pyskynet_22skynet_py_foreign_seri_py_foreign_pack(MODE_FOREIGN_REMOTE, __pyx_v_args); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 417, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_int(PTYPE_ERROR); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 108, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_r = __pyx_t_1;
-  __pyx_t_1 = 0;
-  goto __pyx_L0;
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_PTYPE_ERROR, __pyx_t_1) < 0) __PYX_ERR(0, 108, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":416
- *     return py_foreign_unpack(MODE_FOREIGN, capsule, size)
- * 
- * def remotepack(*args):             # <<<<<<<<<<<<<<
- *     return py_foreign_pack(MODE_FOREIGN_REMOTE, args)
- * 
+  /* "src/cy_src/skynet_py_mq.pyx":109
+ *         self.PTYPE_SOCKET=PTYPE_SOCKET
+ *         self.PTYPE_ERROR=PTYPE_ERROR
+ *         self.PTYPE_QUEUE=PTYPE_RESERVED_QUEUE             # <<<<<<<<<<<<<<
+ *         self.PTYPE_DEBUG=PTYPE_RESERVED_DEBUG
+ *         self.PTYPE_LUA=PTYPE_RESERVED_LUA
  */
+  __pyx_t_1 = __Pyx_PyInt_From_int(PTYPE_RESERVED_QUEUE); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 109, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_PTYPE_QUEUE, __pyx_t_1) < 0) __PYX_ERR(0, 109, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* function exit code */
-  __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_AddTraceback("pyskynet.skynet_py_foreign_seri.remotepack", __pyx_clineno, __pyx_lineno, __pyx_filename);
-  __pyx_r = NULL;
-  __pyx_L0:;
-  __Pyx_XGIVEREF(__pyx_r);
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
+  /* "src/cy_src/skynet_py_mq.pyx":110
+ *         self.PTYPE_ERROR=PTYPE_ERROR
+ *         self.PTYPE_QUEUE=PTYPE_RESERVED_QUEUE
+ *         self.PTYPE_DEBUG=PTYPE_RESERVED_DEBUG             # <<<<<<<<<<<<<<
+ *         self.PTYPE_LUA=PTYPE_RESERVED_LUA
+ *         self.PTYPE_SNAX=PTYPE_RESERVED_SNAX
+ */
+  __pyx_t_1 = __Pyx_PyInt_From_int(PTYPE_RESERVED_DEBUG); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 110, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_PTYPE_DEBUG, __pyx_t_1) < 0) __PYX_ERR(0, 110, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-/* "src/cy_src/skynet_py_foreign_seri.pyx":419
- *     return py_foreign_pack(MODE_FOREIGN_REMOTE, args)
- * 
- * def remoteunpack(capsule, size=None):             # <<<<<<<<<<<<<<
- *     return py_foreign_unpack(MODE_FOREIGN_REMOTE, capsule, size)
- * 
+  /* "src/cy_src/skynet_py_mq.pyx":111
+ *         self.PTYPE_QUEUE=PTYPE_RESERVED_QUEUE
+ *         self.PTYPE_DEBUG=PTYPE_RESERVED_DEBUG
+ *         self.PTYPE_LUA=PTYPE_RESERVED_LUA             # <<<<<<<<<<<<<<
+ *         self.PTYPE_SNAX=PTYPE_RESERVED_SNAX
+ *         self.PTYPE_TRACE=12 # TRACE defined in skynet.lua
  */
+  __pyx_t_1 = __Pyx_PyInt_From_int(PTYPE_RESERVED_LUA); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 111, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_PTYPE_LUA, __pyx_t_1) < 0) __PYX_ERR(0, 111, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-/* Python wrapper */
-static PyObject *__pyx_pw_8pyskynet_22skynet_py_foreign_seri_13remoteunpack(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_mdef_8pyskynet_22skynet_py_foreign_seri_13remoteunpack = {"remoteunpack", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_8pyskynet_22skynet_py_foreign_seri_13remoteunpack, METH_VARARGS|METH_KEYWORDS, 0};
-static PyObject *__pyx_pw_8pyskynet_22skynet_py_foreign_seri_13remoteunpack(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
-  PyObject *__pyx_v_capsule = 0;
-  PyObject *__pyx_v_size = 0;
-  int __pyx_lineno = 0;
-  const char *__pyx_filename = NULL;
-  int __pyx_clineno = 0;
-  PyObject *__pyx_r = 0;
-  __Pyx_RefNannyDeclarations
-  __Pyx_RefNannySetupContext("remoteunpack (wrapper)", 0);
-  {
-    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_capsule,&__pyx_n_s_size,0};
-    PyObject* values[2] = {0,0};
-    values[1] = ((PyObject *)Py_None);
-    if (unlikely(__pyx_kwds)) {
-      Py_ssize_t kw_args;
-      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
-      switch (pos_args) {
-        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
-        CYTHON_FALLTHROUGH;
-        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
-        CYTHON_FALLTHROUGH;
-        case  0: break;
-        default: goto __pyx_L5_argtuple_error;
-      }
-      kw_args = PyDict_Size(__pyx_kwds);
-      switch (pos_args) {
-        case  0:
-        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_capsule)) != 0)) kw_args--;
-        else goto __pyx_L5_argtuple_error;
-        CYTHON_FALLTHROUGH;
-        case  1:
-        if (kw_args > 0) {
-          PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_size);
-          if (value) { values[1] = value; kw_args--; }
-        }
-      }
-      if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "remoteunpack") < 0)) __PYX_ERR(0, 419, __pyx_L3_error)
-      }
-    } else {
-      switch (PyTuple_GET_SIZE(__pyx_args)) {
-        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
-        CYTHON_FALLTHROUGH;
-        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
-        break;
-        default: goto __pyx_L5_argtuple_error;
-      }
-    }
-    __pyx_v_capsule = values[0];
-    __pyx_v_size = values[1];
-  }
-  goto __pyx_L4_argument_unpacking_done;
-  __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("remoteunpack", 0, 1, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 419, __pyx_L3_error)
-  __pyx_L3_error:;
-  __Pyx_AddTraceback("pyskynet.skynet_py_foreign_seri.remoteunpack", __pyx_clineno, __pyx_lineno, __pyx_filename);
-  __Pyx_RefNannyFinishContext();
-  return NULL;
-  __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_8pyskynet_22skynet_py_foreign_seri_12remoteunpack(__pyx_self, __pyx_v_capsule, __pyx_v_size);
+  /* "src/cy_src/skynet_py_mq.pyx":112
+ *         self.PTYPE_DEBUG=PTYPE_RESERVED_DEBUG
+ *         self.PTYPE_LUA=PTYPE_RESERVED_LUA
+ *         self.PTYPE_SNAX=PTYPE_RESERVED_SNAX             # <<<<<<<<<<<<<<
+ *         self.PTYPE_TRACE=12 # TRACE defined in skynet.lua
+ *         self.PTYPE_FOREIGN=PTYPE_FOREIGN
+ */
+  __pyx_t_1 = __Pyx_PyInt_From_int(PTYPE_RESERVED_SNAX); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 112, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_PTYPE_SNAX, __pyx_t_1) < 0) __PYX_ERR(0, 112, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* function exit code */
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
+  /* "src/cy_src/skynet_py_mq.pyx":113
+ *         self.PTYPE_LUA=PTYPE_RESERVED_LUA
+ *         self.PTYPE_SNAX=PTYPE_RESERVED_SNAX
+ *         self.PTYPE_TRACE=12 # TRACE defined in skynet.lua             # <<<<<<<<<<<<<<
+ *         self.PTYPE_FOREIGN=PTYPE_FOREIGN
+ *         self.PTYPE_FOREIGN_REMOTE=PTYPE_FOREIGN_REMOTE
+ */
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_PTYPE_TRACE, __pyx_int_12) < 0) __PYX_ERR(0, 113, __pyx_L1_error)
+
+  /* "src/cy_src/skynet_py_mq.pyx":114
+ *         self.PTYPE_SNAX=PTYPE_RESERVED_SNAX
+ *         self.PTYPE_TRACE=12 # TRACE defined in skynet.lua
+ *         self.PTYPE_FOREIGN=PTYPE_FOREIGN             # <<<<<<<<<<<<<<
+ *         self.PTYPE_FOREIGN_REMOTE=PTYPE_FOREIGN_REMOTE
+ *         self.PTYPE_TAG_ALLOCSESSION=PTYPE_TAG_ALLOCSESSION
+ */
+  __pyx_t_1 = __Pyx_PyInt_From_int(PTYPE_FOREIGN); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 114, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_PTYPE_FOREIGN, __pyx_t_1) < 0) __PYX_ERR(0, 114, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-static PyObject *__pyx_pf_8pyskynet_22skynet_py_foreign_seri_12remoteunpack(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_capsule, PyObject *__pyx_v_size) {
-  PyObject *__pyx_r = NULL;
-  __Pyx_RefNannyDeclarations
-  PyObject *__pyx_t_1 = NULL;
-  int __pyx_lineno = 0;
-  const char *__pyx_filename = NULL;
-  int __pyx_clineno = 0;
-  __Pyx_RefNannySetupContext("remoteunpack", 0);
+  /* "src/cy_src/skynet_py_mq.pyx":115
+ *         self.PTYPE_TRACE=12 # TRACE defined in skynet.lua
+ *         self.PTYPE_FOREIGN=PTYPE_FOREIGN
+ *         self.PTYPE_FOREIGN_REMOTE=PTYPE_FOREIGN_REMOTE             # <<<<<<<<<<<<<<
+ *         self.PTYPE_TAG_ALLOCSESSION=PTYPE_TAG_ALLOCSESSION
+ *         self.PTYPE_TAG_DONTCOPY=PTYPE_TAG_DONTCOPY
+ */
+  __pyx_t_1 = __Pyx_PyInt_From_int(PTYPE_FOREIGN_REMOTE); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 115, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_PTYPE_FOREIGN_REMOTE, __pyx_t_1) < 0) __PYX_ERR(0, 115, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":420
+  /* "src/cy_src/skynet_py_mq.pyx":116
+ *         self.PTYPE_FOREIGN=PTYPE_FOREIGN
+ *         self.PTYPE_FOREIGN_REMOTE=PTYPE_FOREIGN_REMOTE
+ *         self.PTYPE_TAG_ALLOCSESSION=PTYPE_TAG_ALLOCSESSION             # <<<<<<<<<<<<<<
+ *         self.PTYPE_TAG_DONTCOPY=PTYPE_TAG_DONTCOPY
  * 
- * def remoteunpack(capsule, size=None):
- *     return py_foreign_unpack(MODE_FOREIGN_REMOTE, capsule, size)             # <<<<<<<<<<<<<<
- * 
- * def trash(capsule, size_t sz):
  */
-  __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __pyx_f_8pyskynet_22skynet_py_foreign_seri_py_foreign_unpack(MODE_FOREIGN_REMOTE, __pyx_v_capsule, __pyx_v_size); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 420, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyInt_From_int(PTYPE_TAG_ALLOCSESSION); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 116, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_r = __pyx_t_1;
-  __pyx_t_1 = 0;
-  goto __pyx_L0;
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_PTYPE_TAG_ALLOCSESSION, __pyx_t_1) < 0) __PYX_ERR(0, 116, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":419
- *     return py_foreign_pack(MODE_FOREIGN_REMOTE, args)
+  /* "src/cy_src/skynet_py_mq.pyx":117
+ *         self.PTYPE_FOREIGN_REMOTE=PTYPE_FOREIGN_REMOTE
+ *         self.PTYPE_TAG_ALLOCSESSION=PTYPE_TAG_ALLOCSESSION
+ *         self.PTYPE_TAG_DONTCOPY=PTYPE_TAG_DONTCOPY             # <<<<<<<<<<<<<<
  * 
- * def remoteunpack(capsule, size=None):             # <<<<<<<<<<<<<<
- *     return py_foreign_unpack(MODE_FOREIGN_REMOTE, capsule, size)
  * 
  */
+  __pyx_t_1 = __Pyx_PyInt_From_int(PTYPE_TAG_DONTCOPY); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 117, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_1);
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_PTYPE_TAG_DONTCOPY, __pyx_t_1) < 0) __PYX_ERR(0, 117, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+
+  /* "src/cy_src/skynet_py_mq.pyx":100
+ * 
+ * class PTYPEEnum(object):
+ *     def __init__(self):             # <<<<<<<<<<<<<<
+ *         self.PTYPE_TEXT=PTYPE_TEXT
+ *         self.PTYPE_RESPONSE=PTYPE_RESPONSE
+ */
 
   /* function exit code */
+  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
+  goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_AddTraceback("pyskynet.skynet_py_foreign_seri.remoteunpack", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("pyskynet.skynet_py_mq.PTYPEEnum.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "src/cy_src/skynet_py_foreign_seri.pyx":422
- *     return py_foreign_unpack(MODE_FOREIGN_REMOTE, capsule, size)
+/* "src/cy_src/skynet_py_mq.pyx":132
  * 
- * def trash(capsule, size_t sz):             # <<<<<<<<<<<<<<
- *     cdef void *ptr = PyCapsule_GetPointer(capsule, "cptr")
- *     skynet_free(ptr)
+ * SKYNET_PTYPE_user_builtin_ids = [SKYNET_PTYPE.PTYPE_LUA, SKYNET_PTYPE.PTYPE_CLIENT, SKYNET_PTYPE.PTYPE_SOCKET, SKYNET_PTYPE.PTYPE_TEXT, SKYNET_PTYPE.PTYPE_FOREIGN, SKYNET_PTYPE.PTYPE_FOREIGN_REMOTE]
+ * def user_assert_id_name(id, name):             # <<<<<<<<<<<<<<
+ *     is_builtin = False
+ *     if name in SKYNET_PTYPE_name_to_id:
  */
 
 /* Python wrapper */
-static PyObject *__pyx_pw_8pyskynet_22skynet_py_foreign_seri_15trash(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static PyMethodDef __pyx_mdef_8pyskynet_22skynet_py_foreign_seri_15trash = {"trash", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_8pyskynet_22skynet_py_foreign_seri_15trash, METH_VARARGS|METH_KEYWORDS, 0};
-static PyObject *__pyx_pw_8pyskynet_22skynet_py_foreign_seri_15trash(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
-  PyObject *__pyx_v_capsule = 0;
-  CYTHON_UNUSED size_t __pyx_v_sz;
+static PyObject *__pyx_pw_8pyskynet_12skynet_py_mq_9user_assert_id_name(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+); /*proto*/
+static PyMethodDef __pyx_mdef_8pyskynet_12skynet_py_mq_9user_assert_id_name = {"user_assert_id_name", (PyCFunction)(void*)(__Pyx_PyCFunction_FastCallWithKeywords)__pyx_pw_8pyskynet_12skynet_py_mq_9user_assert_id_name, __Pyx_METH_FASTCALL|METH_KEYWORDS, 0};
+static PyObject *__pyx_pw_8pyskynet_12skynet_py_mq_9user_assert_id_name(PyObject *__pyx_self, 
+#if CYTHON_METH_FASTCALL
+PyObject *const *__pyx_args, Py_ssize_t __pyx_nargs, PyObject *__pyx_kwds
+#else
+PyObject *__pyx_args, PyObject *__pyx_kwds
+#endif
+) {
+  PyObject *__pyx_v_id = 0;
+  PyObject *__pyx_v_name = 0;
+  #if !CYTHON_METH_FASTCALL
+  CYTHON_UNUSED const Py_ssize_t __pyx_nargs = PyTuple_GET_SIZE(__pyx_args);
+  #endif
+  CYTHON_UNUSED PyObject *const *__pyx_kwvalues = __Pyx_KwValues_FASTCALL(__pyx_args, __pyx_nargs);
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
-  __Pyx_RefNannySetupContext("trash (wrapper)", 0);
+  __Pyx_RefNannySetupContext("user_assert_id_name (wrapper)", 0);
   {
-    static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_capsule,&__pyx_n_s_sz,0};
+    PyObject **__pyx_pyargnames[] = {&__pyx_n_s_id,&__pyx_n_s_name,0};
     PyObject* values[2] = {0,0};
-    if (unlikely(__pyx_kwds)) {
+    if (__pyx_kwds) {
       Py_ssize_t kw_args;
-      const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
-      switch (pos_args) {
-        case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
+      switch (__pyx_nargs) {
+        case  2: values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
         CYTHON_FALLTHROUGH;
-        case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
+        case  1: values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
         CYTHON_FALLTHROUGH;
         case  0: break;
         default: goto __pyx_L5_argtuple_error;
       }
-      kw_args = PyDict_Size(__pyx_kwds);
-      switch (pos_args) {
+      kw_args = __Pyx_NumKwargs_FASTCALL(__pyx_kwds);
+      switch (__pyx_nargs) {
         case  0:
-        if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_capsule)) != 0)) kw_args--;
+        if (likely((values[0] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_id)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 132, __pyx_L3_error)
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
-        if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_sz)) != 0)) kw_args--;
+        if (likely((values[1] = __Pyx_GetKwValue_FASTCALL(__pyx_kwds, __pyx_kwvalues, __pyx_n_s_name)) != 0)) kw_args--;
+        else if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 132, __pyx_L3_error)
         else {
-          __Pyx_RaiseArgtupleInvalid("trash", 1, 2, 2, 1); __PYX_ERR(0, 422, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("user_assert_id_name", 1, 2, 2, 1); __PYX_ERR(0, 132, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "trash") < 0)) __PYX_ERR(0, 422, __pyx_L3_error)
+        const Py_ssize_t kwd_pos_args = __pyx_nargs;
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_kwvalues, __pyx_pyargnames, 0, values + 0, kwd_pos_args, "user_assert_id_name") < 0)) __PYX_ERR(0, 132, __pyx_L3_error)
       }
-    } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
+    } else if (unlikely(__pyx_nargs != 2)) {
       goto __pyx_L5_argtuple_error;
     } else {
-      values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
-      values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
+      values[0] = __Pyx_Arg_FASTCALL(__pyx_args, 0);
+      values[1] = __Pyx_Arg_FASTCALL(__pyx_args, 1);
     }
-    __pyx_v_capsule = values[0];
-    __pyx_v_sz = __Pyx_PyInt_As_size_t(values[1]); if (unlikely((__pyx_v_sz == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 422, __pyx_L3_error)
+    __pyx_v_id = values[0];
+    __pyx_v_name = values[1];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("trash", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 422, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("user_assert_id_name", 1, 2, 2, __pyx_nargs); __PYX_ERR(0, 132, __pyx_L3_error)
   __pyx_L3_error:;
-  __Pyx_AddTraceback("pyskynet.skynet_py_foreign_seri.trash", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __Pyx_AddTraceback("pyskynet.skynet_py_mq.user_assert_id_name", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  __pyx_r = __pyx_pf_8pyskynet_22skynet_py_foreign_seri_14trash(__pyx_self, __pyx_v_capsule, __pyx_v_sz);
-
-  /* function exit code */
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-static PyObject *__pyx_pf_8pyskynet_22skynet_py_foreign_seri_14trash(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_capsule, CYTHON_UNUSED size_t __pyx_v_sz) {
-  void *__pyx_v_ptr;
-  PyObject *__pyx_r = NULL;
-  __Pyx_RefNannyDeclarations
-  void *__pyx_t_1;
-  int __pyx_lineno = 0;
-  const char *__pyx_filename = NULL;
-  int __pyx_clineno = 0;
-  __Pyx_RefNannySetupContext("trash", 0);
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":423
- * 
- * def trash(capsule, size_t sz):
- *     cdef void *ptr = PyCapsule_GetPointer(capsule, "cptr")             # <<<<<<<<<<<<<<
- *     skynet_free(ptr)
- */
-  __pyx_t_1 = PyCapsule_GetPointer(__pyx_v_capsule, ((char *)"cptr")); if (unlikely(__pyx_t_1 == ((void *)NULL) && PyErr_Occurred())) __PYX_ERR(0, 423, __pyx_L1_error)
-  __pyx_v_ptr = __pyx_t_1;
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":424
- * def trash(capsule, size_t sz):
- *     cdef void *ptr = PyCapsule_GetPointer(capsule, "cptr")
- *     skynet_free(ptr)             # <<<<<<<<<<<<<<
- */
-  skynet_free(__pyx_v_ptr);
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":422
- *     return py_foreign_unpack(MODE_FOREIGN_REMOTE, capsule, size)
- * 
- * def trash(capsule, size_t sz):             # <<<<<<<<<<<<<<
- *     cdef void *ptr = PyCapsule_GetPointer(capsule, "cptr")
- *     skynet_free(ptr)
- */
-
-  /* function exit code */
-  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
-  goto __pyx_L0;
-  __pyx_L1_error:;
-  __Pyx_AddTraceback("pyskynet.skynet_py_foreign_seri.trash", __pyx_clineno, __pyx_lineno, __pyx_filename);
-  __pyx_r = NULL;
-  __pyx_L0:;
-  __Pyx_XGIVEREF(__pyx_r);
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-/* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":734
- * ctypedef npy_cdouble     complex_t
- * 
- * cdef inline object PyArray_MultiIterNew1(a):             # <<<<<<<<<<<<<<
- *     return PyArray_MultiIterNew(1, <void*>a)
- * 
- */
-
-static CYTHON_INLINE PyObject *__pyx_f_5numpy_PyArray_MultiIterNew1(PyObject *__pyx_v_a) {
-  PyObject *__pyx_r = NULL;
-  __Pyx_RefNannyDeclarations
-  PyObject *__pyx_t_1 = NULL;
-  int __pyx_lineno = 0;
-  const char *__pyx_filename = NULL;
-  int __pyx_clineno = 0;
-  __Pyx_RefNannySetupContext("PyArray_MultiIterNew1", 0);
-
-  /* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":735
- * 
- * cdef inline object PyArray_MultiIterNew1(a):
- *     return PyArray_MultiIterNew(1, <void*>a)             # <<<<<<<<<<<<<<
- * 
- * cdef inline object PyArray_MultiIterNew2(a, b):
- */
-  __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = PyArray_MultiIterNew(1, ((void *)__pyx_v_a)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 735, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_r = __pyx_t_1;
-  __pyx_t_1 = 0;
-  goto __pyx_L0;
-
-  /* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":734
- * ctypedef npy_cdouble     complex_t
- * 
- * cdef inline object PyArray_MultiIterNew1(a):             # <<<<<<<<<<<<<<
- *     return PyArray_MultiIterNew(1, <void*>a)
- * 
- */
-
-  /* function exit code */
-  __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_AddTraceback("numpy.PyArray_MultiIterNew1", __pyx_clineno, __pyx_lineno, __pyx_filename);
-  __pyx_r = 0;
-  __pyx_L0:;
-  __Pyx_XGIVEREF(__pyx_r);
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-/* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":737
- *     return PyArray_MultiIterNew(1, <void*>a)
- * 
- * cdef inline object PyArray_MultiIterNew2(a, b):             # <<<<<<<<<<<<<<
- *     return PyArray_MultiIterNew(2, <void*>a, <void*>b)
- * 
- */
-
-static CYTHON_INLINE PyObject *__pyx_f_5numpy_PyArray_MultiIterNew2(PyObject *__pyx_v_a, PyObject *__pyx_v_b) {
-  PyObject *__pyx_r = NULL;
-  __Pyx_RefNannyDeclarations
-  PyObject *__pyx_t_1 = NULL;
-  int __pyx_lineno = 0;
-  const char *__pyx_filename = NULL;
-  int __pyx_clineno = 0;
-  __Pyx_RefNannySetupContext("PyArray_MultiIterNew2", 0);
-
-  /* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":738
- * 
- * cdef inline object PyArray_MultiIterNew2(a, b):
- *     return PyArray_MultiIterNew(2, <void*>a, <void*>b)             # <<<<<<<<<<<<<<
- * 
- * cdef inline object PyArray_MultiIterNew3(a, b, c):
- */
-  __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = PyArray_MultiIterNew(2, ((void *)__pyx_v_a), ((void *)__pyx_v_b)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 738, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_r = __pyx_t_1;
-  __pyx_t_1 = 0;
-  goto __pyx_L0;
-
-  /* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":737
- *     return PyArray_MultiIterNew(1, <void*>a)
- * 
- * cdef inline object PyArray_MultiIterNew2(a, b):             # <<<<<<<<<<<<<<
- *     return PyArray_MultiIterNew(2, <void*>a, <void*>b)
- * 
- */
-
-  /* function exit code */
-  __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_AddTraceback("numpy.PyArray_MultiIterNew2", __pyx_clineno, __pyx_lineno, __pyx_filename);
-  __pyx_r = 0;
-  __pyx_L0:;
-  __Pyx_XGIVEREF(__pyx_r);
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-/* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":740
- *     return PyArray_MultiIterNew(2, <void*>a, <void*>b)
- * 
- * cdef inline object PyArray_MultiIterNew3(a, b, c):             # <<<<<<<<<<<<<<
- *     return PyArray_MultiIterNew(3, <void*>a, <void*>b, <void*> c)
- * 
- */
-
-static CYTHON_INLINE PyObject *__pyx_f_5numpy_PyArray_MultiIterNew3(PyObject *__pyx_v_a, PyObject *__pyx_v_b, PyObject *__pyx_v_c) {
-  PyObject *__pyx_r = NULL;
-  __Pyx_RefNannyDeclarations
-  PyObject *__pyx_t_1 = NULL;
-  int __pyx_lineno = 0;
-  const char *__pyx_filename = NULL;
-  int __pyx_clineno = 0;
-  __Pyx_RefNannySetupContext("PyArray_MultiIterNew3", 0);
-
-  /* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":741
- * 
- * cdef inline object PyArray_MultiIterNew3(a, b, c):
- *     return PyArray_MultiIterNew(3, <void*>a, <void*>b, <void*> c)             # <<<<<<<<<<<<<<
- * 
- * cdef inline object PyArray_MultiIterNew4(a, b, c, d):
- */
-  __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = PyArray_MultiIterNew(3, ((void *)__pyx_v_a), ((void *)__pyx_v_b), ((void *)__pyx_v_c)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 741, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_r = __pyx_t_1;
-  __pyx_t_1 = 0;
-  goto __pyx_L0;
-
-  /* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":740
- *     return PyArray_MultiIterNew(2, <void*>a, <void*>b)
- * 
- * cdef inline object PyArray_MultiIterNew3(a, b, c):             # <<<<<<<<<<<<<<
- *     return PyArray_MultiIterNew(3, <void*>a, <void*>b, <void*> c)
- * 
- */
-
-  /* function exit code */
-  __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_AddTraceback("numpy.PyArray_MultiIterNew3", __pyx_clineno, __pyx_lineno, __pyx_filename);
-  __pyx_r = 0;
-  __pyx_L0:;
-  __Pyx_XGIVEREF(__pyx_r);
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-/* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":743
- *     return PyArray_MultiIterNew(3, <void*>a, <void*>b, <void*> c)
- * 
- * cdef inline object PyArray_MultiIterNew4(a, b, c, d):             # <<<<<<<<<<<<<<
- *     return PyArray_MultiIterNew(4, <void*>a, <void*>b, <void*>c, <void*> d)
- * 
- */
-
-static CYTHON_INLINE PyObject *__pyx_f_5numpy_PyArray_MultiIterNew4(PyObject *__pyx_v_a, PyObject *__pyx_v_b, PyObject *__pyx_v_c, PyObject *__pyx_v_d) {
-  PyObject *__pyx_r = NULL;
-  __Pyx_RefNannyDeclarations
-  PyObject *__pyx_t_1 = NULL;
-  int __pyx_lineno = 0;
-  const char *__pyx_filename = NULL;
-  int __pyx_clineno = 0;
-  __Pyx_RefNannySetupContext("PyArray_MultiIterNew4", 0);
-
-  /* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":744
- * 
- * cdef inline object PyArray_MultiIterNew4(a, b, c, d):
- *     return PyArray_MultiIterNew(4, <void*>a, <void*>b, <void*>c, <void*> d)             # <<<<<<<<<<<<<<
- * 
- * cdef inline object PyArray_MultiIterNew5(a, b, c, d, e):
- */
-  __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = PyArray_MultiIterNew(4, ((void *)__pyx_v_a), ((void *)__pyx_v_b), ((void *)__pyx_v_c), ((void *)__pyx_v_d)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 744, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_r = __pyx_t_1;
-  __pyx_t_1 = 0;
-  goto __pyx_L0;
-
-  /* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":743
- *     return PyArray_MultiIterNew(3, <void*>a, <void*>b, <void*> c)
- * 
- * cdef inline object PyArray_MultiIterNew4(a, b, c, d):             # <<<<<<<<<<<<<<
- *     return PyArray_MultiIterNew(4, <void*>a, <void*>b, <void*>c, <void*> d)
- * 
- */
+  __pyx_r = __pyx_pf_8pyskynet_12skynet_py_mq_8user_assert_id_name(__pyx_self, __pyx_v_id, __pyx_v_name);
 
   /* function exit code */
-  __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_AddTraceback("numpy.PyArray_MultiIterNew4", __pyx_clineno, __pyx_lineno, __pyx_filename);
-  __pyx_r = 0;
-  __pyx_L0:;
-  __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":746
- *     return PyArray_MultiIterNew(4, <void*>a, <void*>b, <void*>c, <void*> d)
- * 
- * cdef inline object PyArray_MultiIterNew5(a, b, c, d, e):             # <<<<<<<<<<<<<<
- *     return PyArray_MultiIterNew(5, <void*>a, <void*>b, <void*>c, <void*> d, <void*> e)
- * 
- */
-
-static CYTHON_INLINE PyObject *__pyx_f_5numpy_PyArray_MultiIterNew5(PyObject *__pyx_v_a, PyObject *__pyx_v_b, PyObject *__pyx_v_c, PyObject *__pyx_v_d, PyObject *__pyx_v_e) {
+static PyObject *__pyx_pf_8pyskynet_12skynet_py_mq_8user_assert_id_name(CYTHON_UNUSED PyObject *__pyx_self, PyObject *__pyx_v_id, PyObject *__pyx_v_name) {
+  int __pyx_v_is_builtin;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
+  int __pyx_t_2;
+  PyObject *__pyx_t_3 = NULL;
+  Py_ssize_t __pyx_t_4;
+  Py_UCS4 __pyx_t_5;
+  int __pyx_t_6;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
-  __Pyx_RefNannySetupContext("PyArray_MultiIterNew5", 0);
+  __Pyx_RefNannySetupContext("user_assert_id_name", 0);
 
-  /* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":747
- * 
- * cdef inline object PyArray_MultiIterNew5(a, b, c, d, e):
- *     return PyArray_MultiIterNew(5, <void*>a, <void*>b, <void*>c, <void*> d, <void*> e)             # <<<<<<<<<<<<<<
- * 
- * cdef inline tuple PyDataType_SHAPE(dtype d):
+  /* "src/cy_src/skynet_py_mq.pyx":133
+ * SKYNET_PTYPE_user_builtin_ids = [SKYNET_PTYPE.PTYPE_LUA, SKYNET_PTYPE.PTYPE_CLIENT, SKYNET_PTYPE.PTYPE_SOCKET, SKYNET_PTYPE.PTYPE_TEXT, SKYNET_PTYPE.PTYPE_FOREIGN, SKYNET_PTYPE.PTYPE_FOREIGN_REMOTE]
+ * def user_assert_id_name(id, name):
+ *     is_builtin = False             # <<<<<<<<<<<<<<
+ *     if name in SKYNET_PTYPE_name_to_id:
+ *         assert id == SKYNET_PTYPE_name_to_id[name], "skynet proto type name=%s must bind id=%s" % (name, id)
+ */
+  __pyx_v_is_builtin = 0;
+
+  /* "src/cy_src/skynet_py_mq.pyx":134
+ * def user_assert_id_name(id, name):
+ *     is_builtin = False
+ *     if name in SKYNET_PTYPE_name_to_id:             # <<<<<<<<<<<<<<
+ *         assert id == SKYNET_PTYPE_name_to_id[name], "skynet proto type name=%s must bind id=%s" % (name, id)
+ *         is_builtin = True
  */
-  __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = PyArray_MultiIterNew(5, ((void *)__pyx_v_a), ((void *)__pyx_v_b), ((void *)__pyx_v_c), ((void *)__pyx_v_d), ((void *)__pyx_v_e)); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 747, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_SKYNET_PTYPE_name_to_id); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 134, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_r = __pyx_t_1;
-  __pyx_t_1 = 0;
-  goto __pyx_L0;
-
-  /* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":746
- *     return PyArray_MultiIterNew(4, <void*>a, <void*>b, <void*>c, <void*> d)
- * 
- * cdef inline object PyArray_MultiIterNew5(a, b, c, d, e):             # <<<<<<<<<<<<<<
- *     return PyArray_MultiIterNew(5, <void*>a, <void*>b, <void*>c, <void*> d, <void*> e)
- * 
- */
-
-  /* function exit code */
-  __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_AddTraceback("numpy.PyArray_MultiIterNew5", __pyx_clineno, __pyx_lineno, __pyx_filename);
-  __pyx_r = 0;
-  __pyx_L0:;
-  __Pyx_XGIVEREF(__pyx_r);
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-/* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":749
- *     return PyArray_MultiIterNew(5, <void*>a, <void*>b, <void*>c, <void*> d, <void*> e)
- * 
- * cdef inline tuple PyDataType_SHAPE(dtype d):             # <<<<<<<<<<<<<<
- *     if PyDataType_HASSUBARRAY(d):
- *         return <tuple>d.subarray.shape
- */
-
-static CYTHON_INLINE PyObject *__pyx_f_5numpy_PyDataType_SHAPE(PyArray_Descr *__pyx_v_d) {
-  PyObject *__pyx_r = NULL;
-  __Pyx_RefNannyDeclarations
-  int __pyx_t_1;
-  __Pyx_RefNannySetupContext("PyDataType_SHAPE", 0);
-
-  /* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":750
- * 
- * cdef inline tuple PyDataType_SHAPE(dtype d):
- *     if PyDataType_HASSUBARRAY(d):             # <<<<<<<<<<<<<<
- *         return <tuple>d.subarray.shape
- *     else:
- */
-  __pyx_t_1 = (PyDataType_HASSUBARRAY(__pyx_v_d) != 0);
-  if (__pyx_t_1) {
-
-    /* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":751
- * cdef inline tuple PyDataType_SHAPE(dtype d):
- *     if PyDataType_HASSUBARRAY(d):
- *         return <tuple>d.subarray.shape             # <<<<<<<<<<<<<<
- *     else:
- *         return ()
- */
-    __Pyx_XDECREF(__pyx_r);
-    __Pyx_INCREF(((PyObject*)__pyx_v_d->subarray->shape));
-    __pyx_r = ((PyObject*)__pyx_v_d->subarray->shape);
-    goto __pyx_L0;
+  __pyx_t_2 = (__Pyx_PySequence_ContainsTF(__pyx_v_name, __pyx_t_1, Py_EQ)); if (unlikely((__pyx_t_2 < 0))) __PYX_ERR(0, 134, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  if (__pyx_t_2) {
 
-    /* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":750
- * 
- * cdef inline tuple PyDataType_SHAPE(dtype d):
- *     if PyDataType_HASSUBARRAY(d):             # <<<<<<<<<<<<<<
- *         return <tuple>d.subarray.shape
- *     else:
- */
-  }
+    /* "src/cy_src/skynet_py_mq.pyx":135
+ *     is_builtin = False
+ *     if name in SKYNET_PTYPE_name_to_id:
+ *         assert id == SKYNET_PTYPE_name_to_id[name], "skynet proto type name=%s must bind id=%s" % (name, id)             # <<<<<<<<<<<<<<
+ *         is_builtin = True
+ *     if id in SKYNET_PTYPE_id_to_name:
+ */
+    #ifndef CYTHON_WITHOUT_ASSERTIONS
+    if (unlikely(__pyx_assertions_enabled())) {
+      __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_SKYNET_PTYPE_name_to_id); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 135, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_1);
+      __pyx_t_3 = __Pyx_PyObject_GetItem(__pyx_t_1, __pyx_v_name); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 135, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_3);
+      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+      __pyx_t_1 = PyObject_RichCompare(__pyx_v_id, __pyx_t_3, Py_EQ); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 135, __pyx_L1_error)
+      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+      __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely((__pyx_t_2 < 0))) __PYX_ERR(0, 135, __pyx_L1_error)
+      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+      if (unlikely(!__pyx_t_2)) {
+        __pyx_t_1 = PyTuple_New(4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 135, __pyx_L1_error)
+        __Pyx_GOTREF(__pyx_t_1);
+        __pyx_t_4 = 0;
+        __pyx_t_5 = 127;
+        __Pyx_INCREF(__pyx_kp_u_skynet_proto_type_name);
+        __pyx_t_4 += 23;
+        __Pyx_GIVEREF(__pyx_kp_u_skynet_proto_type_name);
+        PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_u_skynet_proto_type_name);
+        __pyx_t_3 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Unicode(__pyx_v_name), __pyx_empty_unicode); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 135, __pyx_L1_error)
+        __Pyx_GOTREF(__pyx_t_3);
+        __pyx_t_5 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_3) > __pyx_t_5) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_3) : __pyx_t_5;
+        __pyx_t_4 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_3);
+        __Pyx_GIVEREF(__pyx_t_3);
+        PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_3);
+        __pyx_t_3 = 0;
+        __Pyx_INCREF(__pyx_kp_u_must_bind_id);
+        __pyx_t_4 += 14;
+        __Pyx_GIVEREF(__pyx_kp_u_must_bind_id);
+        PyTuple_SET_ITEM(__pyx_t_1, 2, __pyx_kp_u_must_bind_id);
+        __pyx_t_3 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Unicode(__pyx_v_id), __pyx_empty_unicode); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 135, __pyx_L1_error)
+        __Pyx_GOTREF(__pyx_t_3);
+        __pyx_t_5 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_3) > __pyx_t_5) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_3) : __pyx_t_5;
+        __pyx_t_4 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_3);
+        __Pyx_GIVEREF(__pyx_t_3);
+        PyTuple_SET_ITEM(__pyx_t_1, 3, __pyx_t_3);
+        __pyx_t_3 = 0;
+        __pyx_t_3 = __Pyx_PyUnicode_Join(__pyx_t_1, 4, __pyx_t_4, __pyx_t_5); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 135, __pyx_L1_error)
+        __Pyx_GOTREF(__pyx_t_3);
+        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+        __Pyx_Raise(__pyx_builtin_AssertionError, __pyx_t_3, 0, 0);
+        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+        __PYX_ERR(0, 135, __pyx_L1_error)
+      }
+    }
+    #else
+    if ((1)); else __PYX_ERR(0, 135, __pyx_L1_error)
+    #endif
 
-  /* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":753
- *         return <tuple>d.subarray.shape
- *     else:
- *         return ()             # <<<<<<<<<<<<<<
- * 
- * 
+    /* "src/cy_src/skynet_py_mq.pyx":136
+ *     if name in SKYNET_PTYPE_name_to_id:
+ *         assert id == SKYNET_PTYPE_name_to_id[name], "skynet proto type name=%s must bind id=%s" % (name, id)
+ *         is_builtin = True             # <<<<<<<<<<<<<<
+ *     if id in SKYNET_PTYPE_id_to_name:
+ *         assert name == SKYNET_PTYPE_id_to_name[id], "skynet proto type id=%s must bind name=%s" % (id, name)
+ */
+    __pyx_v_is_builtin = 1;
+
+    /* "src/cy_src/skynet_py_mq.pyx":134
+ * def user_assert_id_name(id, name):
+ *     is_builtin = False
+ *     if name in SKYNET_PTYPE_name_to_id:             # <<<<<<<<<<<<<<
+ *         assert id == SKYNET_PTYPE_name_to_id[name], "skynet proto type name=%s must bind id=%s" % (name, id)
+ *         is_builtin = True
  */
-  /*else*/ {
-    __Pyx_XDECREF(__pyx_r);
-    __Pyx_INCREF(__pyx_empty_tuple);
-    __pyx_r = __pyx_empty_tuple;
-    goto __pyx_L0;
   }
 
-  /* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":749
- *     return PyArray_MultiIterNew(5, <void*>a, <void*>b, <void*>c, <void*> d, <void*> e)
- * 
- * cdef inline tuple PyDataType_SHAPE(dtype d):             # <<<<<<<<<<<<<<
- *     if PyDataType_HASSUBARRAY(d):
- *         return <tuple>d.subarray.shape
- */
-
-  /* function exit code */
-  __pyx_L0:;
-  __Pyx_XGIVEREF(__pyx_r);
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-/* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":868
- *     int _import_umath() except -1
- * 
- * cdef inline void set_array_base(ndarray arr, object base):             # <<<<<<<<<<<<<<
- *     Py_INCREF(base) # important to do this before stealing the reference below!
- *     PyArray_SetBaseObject(arr, base)
- */
-
-static CYTHON_INLINE void __pyx_f_5numpy_set_array_base(PyArrayObject *__pyx_v_arr, PyObject *__pyx_v_base) {
-  __Pyx_RefNannyDeclarations
-  __Pyx_RefNannySetupContext("set_array_base", 0);
-
-  /* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":869
- * 
- * cdef inline void set_array_base(ndarray arr, object base):
- *     Py_INCREF(base) # important to do this before stealing the reference below!             # <<<<<<<<<<<<<<
- *     PyArray_SetBaseObject(arr, base)
- * 
- */
-  Py_INCREF(__pyx_v_base);
-
-  /* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":870
- * cdef inline void set_array_base(ndarray arr, object base):
- *     Py_INCREF(base) # important to do this before stealing the reference below!
- *     PyArray_SetBaseObject(arr, base)             # <<<<<<<<<<<<<<
- * 
- * cdef inline object get_array_base(ndarray arr):
+  /* "src/cy_src/skynet_py_mq.pyx":137
+ *         assert id == SKYNET_PTYPE_name_to_id[name], "skynet proto type name=%s must bind id=%s" % (name, id)
+ *         is_builtin = True
+ *     if id in SKYNET_PTYPE_id_to_name:             # <<<<<<<<<<<<<<
+ *         assert name == SKYNET_PTYPE_id_to_name[id], "skynet proto type id=%s must bind name=%s" % (id, name)
+ *         is_builtin = True
  */
-  (void)(PyArray_SetBaseObject(__pyx_v_arr, __pyx_v_base));
-
-  /* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":868
- *     int _import_umath() except -1
- * 
- * cdef inline void set_array_base(ndarray arr, object base):             # <<<<<<<<<<<<<<
- *     Py_INCREF(base) # important to do this before stealing the reference below!
- *     PyArray_SetBaseObject(arr, base)
- */
-
-  /* function exit code */
-  __Pyx_RefNannyFinishContext();
-}
-
-/* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":872
- *     PyArray_SetBaseObject(arr, base)
- * 
- * cdef inline object get_array_base(ndarray arr):             # <<<<<<<<<<<<<<
- *     base = PyArray_BASE(arr)
- *     if base is NULL:
- */
-
-static CYTHON_INLINE PyObject *__pyx_f_5numpy_get_array_base(PyArrayObject *__pyx_v_arr) {
-  PyObject *__pyx_v_base;
-  PyObject *__pyx_r = NULL;
-  __Pyx_RefNannyDeclarations
-  int __pyx_t_1;
-  __Pyx_RefNannySetupContext("get_array_base", 0);
-
-  /* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":873
- * 
- * cdef inline object get_array_base(ndarray arr):
- *     base = PyArray_BASE(arr)             # <<<<<<<<<<<<<<
- *     if base is NULL:
- *         return None
- */
-  __pyx_v_base = PyArray_BASE(__pyx_v_arr);
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_SKYNET_PTYPE_id_to_name); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 137, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  __pyx_t_2 = (__Pyx_PySequence_ContainsTF(__pyx_v_id, __pyx_t_3, Py_EQ)); if (unlikely((__pyx_t_2 < 0))) __PYX_ERR(0, 137, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  if (__pyx_t_2) {
 
-  /* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":874
- * cdef inline object get_array_base(ndarray arr):
- *     base = PyArray_BASE(arr)
- *     if base is NULL:             # <<<<<<<<<<<<<<
- *         return None
- *     return <object>base
- */
-  __pyx_t_1 = ((__pyx_v_base == NULL) != 0);
-  if (__pyx_t_1) {
+    /* "src/cy_src/skynet_py_mq.pyx":138
+ *         is_builtin = True
+ *     if id in SKYNET_PTYPE_id_to_name:
+ *         assert name == SKYNET_PTYPE_id_to_name[id], "skynet proto type id=%s must bind name=%s" % (id, name)             # <<<<<<<<<<<<<<
+ *         is_builtin = True
+ *     if is_builtin:
+ */
+    #ifndef CYTHON_WITHOUT_ASSERTIONS
+    if (unlikely(__pyx_assertions_enabled())) {
+      __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_SKYNET_PTYPE_id_to_name); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 138, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_3);
+      __pyx_t_1 = __Pyx_PyObject_GetItem(__pyx_t_3, __pyx_v_id); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 138, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_1);
+      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+      __pyx_t_3 = PyObject_RichCompare(__pyx_v_name, __pyx_t_1, Py_EQ); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 138, __pyx_L1_error)
+      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+      __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely((__pyx_t_2 < 0))) __PYX_ERR(0, 138, __pyx_L1_error)
+      __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+      if (unlikely(!__pyx_t_2)) {
+        __pyx_t_3 = PyTuple_New(4); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 138, __pyx_L1_error)
+        __Pyx_GOTREF(__pyx_t_3);
+        __pyx_t_4 = 0;
+        __pyx_t_5 = 127;
+        __Pyx_INCREF(__pyx_kp_u_skynet_proto_type_id);
+        __pyx_t_4 += 21;
+        __Pyx_GIVEREF(__pyx_kp_u_skynet_proto_type_id);
+        PyTuple_SET_ITEM(__pyx_t_3, 0, __pyx_kp_u_skynet_proto_type_id);
+        __pyx_t_1 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Unicode(__pyx_v_id), __pyx_empty_unicode); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 138, __pyx_L1_error)
+        __Pyx_GOTREF(__pyx_t_1);
+        __pyx_t_5 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_1) > __pyx_t_5) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_1) : __pyx_t_5;
+        __pyx_t_4 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_1);
+        __Pyx_GIVEREF(__pyx_t_1);
+        PyTuple_SET_ITEM(__pyx_t_3, 1, __pyx_t_1);
+        __pyx_t_1 = 0;
+        __Pyx_INCREF(__pyx_kp_u_must_bind_name);
+        __pyx_t_4 += 16;
+        __Pyx_GIVEREF(__pyx_kp_u_must_bind_name);
+        PyTuple_SET_ITEM(__pyx_t_3, 2, __pyx_kp_u_must_bind_name);
+        __pyx_t_1 = __Pyx_PyObject_FormatSimpleAndDecref(PyObject_Unicode(__pyx_v_name), __pyx_empty_unicode); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 138, __pyx_L1_error)
+        __Pyx_GOTREF(__pyx_t_1);
+        __pyx_t_5 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_1) > __pyx_t_5) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_1) : __pyx_t_5;
+        __pyx_t_4 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_1);
+        __Pyx_GIVEREF(__pyx_t_1);
+        PyTuple_SET_ITEM(__pyx_t_3, 3, __pyx_t_1);
+        __pyx_t_1 = 0;
+        __pyx_t_1 = __Pyx_PyUnicode_Join(__pyx_t_3, 4, __pyx_t_4, __pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 138, __pyx_L1_error)
+        __Pyx_GOTREF(__pyx_t_1);
+        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+        __Pyx_Raise(__pyx_builtin_AssertionError, __pyx_t_1, 0, 0);
+        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+        __PYX_ERR(0, 138, __pyx_L1_error)
+      }
+    }
+    #else
+    if ((1)); else __PYX_ERR(0, 138, __pyx_L1_error)
+    #endif
 
-    /* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":875
- *     base = PyArray_BASE(arr)
- *     if base is NULL:
- *         return None             # <<<<<<<<<<<<<<
- *     return <object>base
- * 
+    /* "src/cy_src/skynet_py_mq.pyx":139
+ *     if id in SKYNET_PTYPE_id_to_name:
+ *         assert name == SKYNET_PTYPE_id_to_name[id], "skynet proto type id=%s must bind name=%s" % (id, name)
+ *         is_builtin = True             # <<<<<<<<<<<<<<
+ *     if is_builtin:
+ *         assert id in SKYNET_PTYPE_user_builtin_ids, "skynet proto can only register builtin proto 'lua' or 'client' or 'socket' or 'text' or 'foreign' or 'foreign_remote', but get name=%s" % name
  */
-    __Pyx_XDECREF(__pyx_r);
-    __pyx_r = Py_None; __Pyx_INCREF(Py_None);
-    goto __pyx_L0;
+    __pyx_v_is_builtin = 1;
 
-    /* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":874
- * cdef inline object get_array_base(ndarray arr):
- *     base = PyArray_BASE(arr)
- *     if base is NULL:             # <<<<<<<<<<<<<<
- *         return None
- *     return <object>base
+    /* "src/cy_src/skynet_py_mq.pyx":137
+ *         assert id == SKYNET_PTYPE_name_to_id[name], "skynet proto type name=%s must bind id=%s" % (name, id)
+ *         is_builtin = True
+ *     if id in SKYNET_PTYPE_id_to_name:             # <<<<<<<<<<<<<<
+ *         assert name == SKYNET_PTYPE_id_to_name[id], "skynet proto type id=%s must bind name=%s" % (id, name)
+ *         is_builtin = True
  */
   }
 
-  /* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":876
- *     if base is NULL:
- *         return None
- *     return <object>base             # <<<<<<<<<<<<<<
+  /* "src/cy_src/skynet_py_mq.pyx":140
+ *         assert name == SKYNET_PTYPE_id_to_name[id], "skynet proto type id=%s must bind name=%s" % (id, name)
+ *         is_builtin = True
+ *     if is_builtin:             # <<<<<<<<<<<<<<
+ *         assert id in SKYNET_PTYPE_user_builtin_ids, "skynet proto can only register builtin proto 'lua' or 'client' or 'socket' or 'text' or 'foreign' or 'foreign_remote', but get name=%s" % name
  * 
- * # Versions of the import_* functions which are more suitable for
  */
-  __Pyx_XDECREF(__pyx_r);
-  __Pyx_INCREF(((PyObject *)__pyx_v_base));
-  __pyx_r = ((PyObject *)__pyx_v_base);
-  goto __pyx_L0;
+  if (__pyx_v_is_builtin) {
 
-  /* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":872
- *     PyArray_SetBaseObject(arr, base)
+    /* "src/cy_src/skynet_py_mq.pyx":141
+ *         is_builtin = True
+ *     if is_builtin:
+ *         assert id in SKYNET_PTYPE_user_builtin_ids, "skynet proto can only register builtin proto 'lua' or 'client' or 'socket' or 'text' or 'foreign' or 'foreign_remote', but get name=%s" % name             # <<<<<<<<<<<<<<
  * 
- * cdef inline object get_array_base(ndarray arr):             # <<<<<<<<<<<<<<
- *     base = PyArray_BASE(arr)
- *     if base is NULL:
- */
-
-  /* function exit code */
-  __pyx_L0:;
-  __Pyx_XGIVEREF(__pyx_r);
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-/* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":880
- * # Versions of the import_* functions which are more suitable for
- * # Cython code.
- * cdef inline int import_array() except -1:             # <<<<<<<<<<<<<<
- *     try:
- *         __pyx_import_array()
- */
-
-static CYTHON_INLINE int __pyx_f_5numpy_import_array(void) {
-  int __pyx_r;
-  __Pyx_RefNannyDeclarations
-  PyObject *__pyx_t_1 = NULL;
-  PyObject *__pyx_t_2 = NULL;
-  PyObject *__pyx_t_3 = NULL;
-  int __pyx_t_4;
-  PyObject *__pyx_t_5 = NULL;
-  PyObject *__pyx_t_6 = NULL;
-  PyObject *__pyx_t_7 = NULL;
-  PyObject *__pyx_t_8 = NULL;
-  int __pyx_lineno = 0;
-  const char *__pyx_filename = NULL;
-  int __pyx_clineno = 0;
-  __Pyx_RefNannySetupContext("import_array", 0);
-
-  /* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":881
- * # Cython code.
- * cdef inline int import_array() except -1:
- *     try:             # <<<<<<<<<<<<<<
- *         __pyx_import_array()
- *     except Exception:
- */
-  {
-    __Pyx_PyThreadState_declare
-    __Pyx_PyThreadState_assign
-    __Pyx_ExceptionSave(&__pyx_t_1, &__pyx_t_2, &__pyx_t_3);
-    __Pyx_XGOTREF(__pyx_t_1);
-    __Pyx_XGOTREF(__pyx_t_2);
-    __Pyx_XGOTREF(__pyx_t_3);
-    /*try:*/ {
-
-      /* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":882
- * cdef inline int import_array() except -1:
- *     try:
- *         __pyx_import_array()             # <<<<<<<<<<<<<<
- *     except Exception:
- *         raise ImportError("numpy.core.multiarray failed to import")
- */
-      __pyx_t_4 = _import_array(); if (unlikely(__pyx_t_4 == ((int)-1))) __PYX_ERR(1, 882, __pyx_L3_error)
-
-      /* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":881
- * # Cython code.
- * cdef inline int import_array() except -1:
- *     try:             # <<<<<<<<<<<<<<
- *         __pyx_import_array()
- *     except Exception:
+ *     assert 0 <= id and id <= 255, "skynet proto type id must be less than 256 but get id=%s" % id
  */
+    #ifndef CYTHON_WITHOUT_ASSERTIONS
+    if (unlikely(__pyx_assertions_enabled())) {
+      __Pyx_GetModuleGlobalName(__pyx_t_1, __pyx_n_s_SKYNET_PTYPE_user_builtin_ids); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 141, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_1);
+      __pyx_t_2 = (__Pyx_PySequence_ContainsTF(__pyx_v_id, __pyx_t_1, Py_EQ)); if (unlikely((__pyx_t_2 < 0))) __PYX_ERR(0, 141, __pyx_L1_error)
+      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+      if (unlikely(!__pyx_t_2)) {
+        __pyx_t_1 = __Pyx_PyUnicode_FormatSafe(__pyx_kp_u_skynet_proto_can_only_register_b, __pyx_v_name); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 141, __pyx_L1_error)
+        __Pyx_GOTREF(__pyx_t_1);
+        __Pyx_Raise(__pyx_builtin_AssertionError, __pyx_t_1, 0, 0);
+        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+        __PYX_ERR(0, 141, __pyx_L1_error)
+      }
     }
-    __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-    goto __pyx_L8_try_end;
-    __pyx_L3_error:;
-
-    /* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":883
- *     try:
- *         __pyx_import_array()
- *     except Exception:             # <<<<<<<<<<<<<<
- *         raise ImportError("numpy.core.multiarray failed to import")
- * 
- */
-    __pyx_t_4 = __Pyx_PyErr_ExceptionMatches(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])));
-    if (__pyx_t_4) {
-      __Pyx_AddTraceback("numpy.import_array", __pyx_clineno, __pyx_lineno, __pyx_filename);
-      if (__Pyx_GetException(&__pyx_t_5, &__pyx_t_6, &__pyx_t_7) < 0) __PYX_ERR(1, 883, __pyx_L5_except_error)
-      __Pyx_GOTREF(__pyx_t_5);
-      __Pyx_GOTREF(__pyx_t_6);
-      __Pyx_GOTREF(__pyx_t_7);
-
-      /* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":884
- *         __pyx_import_array()
- *     except Exception:
- *         raise ImportError("numpy.core.multiarray failed to import")             # <<<<<<<<<<<<<<
- * 
- * cdef inline int import_umath() except -1:
- */
-      __pyx_t_8 = __Pyx_PyObject_Call(__pyx_builtin_ImportError, __pyx_tuple__7, NULL); if (unlikely(!__pyx_t_8)) __PYX_ERR(1, 884, __pyx_L5_except_error)
-      __Pyx_GOTREF(__pyx_t_8);
-      __Pyx_Raise(__pyx_t_8, 0, 0, 0);
-      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-      __PYX_ERR(1, 884, __pyx_L5_except_error)
-    }
-    goto __pyx_L5_except_error;
-    __pyx_L5_except_error:;
-
-    /* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":881
- * # Cython code.
- * cdef inline int import_array() except -1:
- *     try:             # <<<<<<<<<<<<<<
- *         __pyx_import_array()
- *     except Exception:
- */
-    __Pyx_XGIVEREF(__pyx_t_1);
-    __Pyx_XGIVEREF(__pyx_t_2);
-    __Pyx_XGIVEREF(__pyx_t_3);
-    __Pyx_ExceptionReset(__pyx_t_1, __pyx_t_2, __pyx_t_3);
-    goto __pyx_L1_error;
-    __pyx_L8_try_end:;
-  }
-
-  /* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":880
- * # Versions of the import_* functions which are more suitable for
- * # Cython code.
- * cdef inline int import_array() except -1:             # <<<<<<<<<<<<<<
- *     try:
- *         __pyx_import_array()
- */
-
-  /* function exit code */
-  __pyx_r = 0;
-  goto __pyx_L0;
-  __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_5);
-  __Pyx_XDECREF(__pyx_t_6);
-  __Pyx_XDECREF(__pyx_t_7);
-  __Pyx_XDECREF(__pyx_t_8);
-  __Pyx_AddTraceback("numpy.import_array", __pyx_clineno, __pyx_lineno, __pyx_filename);
-  __pyx_r = -1;
-  __pyx_L0:;
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
+    #else
+    if ((1)); else __PYX_ERR(0, 141, __pyx_L1_error)
+    #endif
 
-/* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":886
- *         raise ImportError("numpy.core.multiarray failed to import")
+    /* "src/cy_src/skynet_py_mq.pyx":140
+ *         assert name == SKYNET_PTYPE_id_to_name[id], "skynet proto type id=%s must bind name=%s" % (id, name)
+ *         is_builtin = True
+ *     if is_builtin:             # <<<<<<<<<<<<<<
+ *         assert id in SKYNET_PTYPE_user_builtin_ids, "skynet proto can only register builtin proto 'lua' or 'client' or 'socket' or 'text' or 'foreign' or 'foreign_remote', but get name=%s" % name
  * 
- * cdef inline int import_umath() except -1:             # <<<<<<<<<<<<<<
- *     try:
- *         _import_umath()
  */
+  }
 
-static CYTHON_INLINE int __pyx_f_5numpy_import_umath(void) {
-  int __pyx_r;
-  __Pyx_RefNannyDeclarations
-  PyObject *__pyx_t_1 = NULL;
-  PyObject *__pyx_t_2 = NULL;
-  PyObject *__pyx_t_3 = NULL;
-  int __pyx_t_4;
-  PyObject *__pyx_t_5 = NULL;
-  PyObject *__pyx_t_6 = NULL;
-  PyObject *__pyx_t_7 = NULL;
-  PyObject *__pyx_t_8 = NULL;
-  int __pyx_lineno = 0;
-  const char *__pyx_filename = NULL;
-  int __pyx_clineno = 0;
-  __Pyx_RefNannySetupContext("import_umath", 0);
-
-  /* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":887
+  /* "src/cy_src/skynet_py_mq.pyx":143
+ *         assert id in SKYNET_PTYPE_user_builtin_ids, "skynet proto can only register builtin proto 'lua' or 'client' or 'socket' or 'text' or 'foreign' or 'foreign_remote', but get name=%s" % name
  * 
- * cdef inline int import_umath() except -1:
- *     try:             # <<<<<<<<<<<<<<
- *         _import_umath()
- *     except Exception:
- */
-  {
-    __Pyx_PyThreadState_declare
-    __Pyx_PyThreadState_assign
-    __Pyx_ExceptionSave(&__pyx_t_1, &__pyx_t_2, &__pyx_t_3);
-    __Pyx_XGOTREF(__pyx_t_1);
-    __Pyx_XGOTREF(__pyx_t_2);
-    __Pyx_XGOTREF(__pyx_t_3);
-    /*try:*/ {
-
-      /* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":888
- * cdef inline int import_umath() except -1:
- *     try:
- *         _import_umath()             # <<<<<<<<<<<<<<
- *     except Exception:
- *         raise ImportError("numpy.core.umath failed to import")
- */
-      __pyx_t_4 = _import_umath(); if (unlikely(__pyx_t_4 == ((int)-1))) __PYX_ERR(1, 888, __pyx_L3_error)
-
-      /* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":887
- * 
- * cdef inline int import_umath() except -1:
- *     try:             # <<<<<<<<<<<<<<
- *         _import_umath()
- *     except Exception:
+ *     assert 0 <= id and id <= 255, "skynet proto type id must be less than 256 but get id=%s" % id             # <<<<<<<<<<<<<<
  */
+  #ifndef CYTHON_WITHOUT_ASSERTIONS
+  if (unlikely(__pyx_assertions_enabled())) {
+    __pyx_t_1 = PyObject_RichCompare(__pyx_int_0, __pyx_v_id, Py_LE); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 143, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely((__pyx_t_6 < 0))) __PYX_ERR(0, 143, __pyx_L1_error)
+    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+    if (__pyx_t_6) {
+    } else {
+      __pyx_t_2 = __pyx_t_6;
+      goto __pyx_L6_bool_binop_done;
     }
-    __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-    goto __pyx_L8_try_end;
-    __pyx_L3_error:;
-
-    /* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":889
- *     try:
- *         _import_umath()
- *     except Exception:             # <<<<<<<<<<<<<<
- *         raise ImportError("numpy.core.umath failed to import")
- * 
- */
-    __pyx_t_4 = __Pyx_PyErr_ExceptionMatches(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])));
-    if (__pyx_t_4) {
-      __Pyx_AddTraceback("numpy.import_umath", __pyx_clineno, __pyx_lineno, __pyx_filename);
-      if (__Pyx_GetException(&__pyx_t_5, &__pyx_t_6, &__pyx_t_7) < 0) __PYX_ERR(1, 889, __pyx_L5_except_error)
-      __Pyx_GOTREF(__pyx_t_5);
-      __Pyx_GOTREF(__pyx_t_6);
-      __Pyx_GOTREF(__pyx_t_7);
-
-      /* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":890
- *         _import_umath()
- *     except Exception:
- *         raise ImportError("numpy.core.umath failed to import")             # <<<<<<<<<<<<<<
- * 
- * cdef inline int import_ufunc() except -1:
- */
-      __pyx_t_8 = __Pyx_PyObject_Call(__pyx_builtin_ImportError, __pyx_tuple__8, NULL); if (unlikely(!__pyx_t_8)) __PYX_ERR(1, 890, __pyx_L5_except_error)
-      __Pyx_GOTREF(__pyx_t_8);
-      __Pyx_Raise(__pyx_t_8, 0, 0, 0);
-      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-      __PYX_ERR(1, 890, __pyx_L5_except_error)
-    }
-    goto __pyx_L5_except_error;
-    __pyx_L5_except_error:;
-
-    /* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":887
- * 
- * cdef inline int import_umath() except -1:
- *     try:             # <<<<<<<<<<<<<<
- *         _import_umath()
- *     except Exception:
- */
-    __Pyx_XGIVEREF(__pyx_t_1);
-    __Pyx_XGIVEREF(__pyx_t_2);
-    __Pyx_XGIVEREF(__pyx_t_3);
-    __Pyx_ExceptionReset(__pyx_t_1, __pyx_t_2, __pyx_t_3);
-    goto __pyx_L1_error;
-    __pyx_L8_try_end:;
-  }
-
-  /* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":886
- *         raise ImportError("numpy.core.multiarray failed to import")
- * 
- * cdef inline int import_umath() except -1:             # <<<<<<<<<<<<<<
- *     try:
- *         _import_umath()
- */
-
-  /* function exit code */
-  __pyx_r = 0;
-  goto __pyx_L0;
-  __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_5);
-  __Pyx_XDECREF(__pyx_t_6);
-  __Pyx_XDECREF(__pyx_t_7);
-  __Pyx_XDECREF(__pyx_t_8);
-  __Pyx_AddTraceback("numpy.import_umath", __pyx_clineno, __pyx_lineno, __pyx_filename);
-  __pyx_r = -1;
-  __pyx_L0:;
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-/* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":892
- *         raise ImportError("numpy.core.umath failed to import")
- * 
- * cdef inline int import_ufunc() except -1:             # <<<<<<<<<<<<<<
- *     try:
- *         _import_umath()
- */
-
-static CYTHON_INLINE int __pyx_f_5numpy_import_ufunc(void) {
-  int __pyx_r;
-  __Pyx_RefNannyDeclarations
-  PyObject *__pyx_t_1 = NULL;
-  PyObject *__pyx_t_2 = NULL;
-  PyObject *__pyx_t_3 = NULL;
-  int __pyx_t_4;
-  PyObject *__pyx_t_5 = NULL;
-  PyObject *__pyx_t_6 = NULL;
-  PyObject *__pyx_t_7 = NULL;
-  PyObject *__pyx_t_8 = NULL;
-  int __pyx_lineno = 0;
-  const char *__pyx_filename = NULL;
-  int __pyx_clineno = 0;
-  __Pyx_RefNannySetupContext("import_ufunc", 0);
-
-  /* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":893
- * 
- * cdef inline int import_ufunc() except -1:
- *     try:             # <<<<<<<<<<<<<<
- *         _import_umath()
- *     except Exception:
- */
-  {
-    __Pyx_PyThreadState_declare
-    __Pyx_PyThreadState_assign
-    __Pyx_ExceptionSave(&__pyx_t_1, &__pyx_t_2, &__pyx_t_3);
-    __Pyx_XGOTREF(__pyx_t_1);
-    __Pyx_XGOTREF(__pyx_t_2);
-    __Pyx_XGOTREF(__pyx_t_3);
-    /*try:*/ {
-
-      /* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":894
- * cdef inline int import_ufunc() except -1:
- *     try:
- *         _import_umath()             # <<<<<<<<<<<<<<
- *     except Exception:
- *         raise ImportError("numpy.core.umath failed to import")
- */
-      __pyx_t_4 = _import_umath(); if (unlikely(__pyx_t_4 == ((int)-1))) __PYX_ERR(1, 894, __pyx_L3_error)
-
-      /* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":893
- * 
- * cdef inline int import_ufunc() except -1:
- *     try:             # <<<<<<<<<<<<<<
- *         _import_umath()
- *     except Exception:
- */
+    __pyx_t_1 = PyObject_RichCompare(__pyx_v_id, __pyx_int_255, Py_LE); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 143, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely((__pyx_t_6 < 0))) __PYX_ERR(0, 143, __pyx_L1_error)
+    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+    __pyx_t_2 = __pyx_t_6;
+    __pyx_L6_bool_binop_done:;
+    if (unlikely(!__pyx_t_2)) {
+      __pyx_t_1 = __Pyx_PyUnicode_FormatSafe(__pyx_kp_u_skynet_proto_type_id_must_be_les, __pyx_v_id); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 143, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_1);
+      __Pyx_Raise(__pyx_builtin_AssertionError, __pyx_t_1, 0, 0);
+      __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+      __PYX_ERR(0, 143, __pyx_L1_error)
     }
-    __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-    goto __pyx_L8_try_end;
-    __pyx_L3_error:;
-
-    /* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":895
- *     try:
- *         _import_umath()
- *     except Exception:             # <<<<<<<<<<<<<<
- *         raise ImportError("numpy.core.umath failed to import")
- * 
- */
-    __pyx_t_4 = __Pyx_PyErr_ExceptionMatches(((PyObject *)(&((PyTypeObject*)PyExc_Exception)[0])));
-    if (__pyx_t_4) {
-      __Pyx_AddTraceback("numpy.import_ufunc", __pyx_clineno, __pyx_lineno, __pyx_filename);
-      if (__Pyx_GetException(&__pyx_t_5, &__pyx_t_6, &__pyx_t_7) < 0) __PYX_ERR(1, 895, __pyx_L5_except_error)
-      __Pyx_GOTREF(__pyx_t_5);
-      __Pyx_GOTREF(__pyx_t_6);
-      __Pyx_GOTREF(__pyx_t_7);
+  }
+  #else
+  if ((1)); else __PYX_ERR(0, 143, __pyx_L1_error)
+  #endif
 
-      /* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":896
- *         _import_umath()
- *     except Exception:
- *         raise ImportError("numpy.core.umath failed to import")             # <<<<<<<<<<<<<<
+  /* "src/cy_src/skynet_py_mq.pyx":132
  * 
- * cdef extern from *:
- */
-      __pyx_t_8 = __Pyx_PyObject_Call(__pyx_builtin_ImportError, __pyx_tuple__8, NULL); if (unlikely(!__pyx_t_8)) __PYX_ERR(1, 896, __pyx_L5_except_error)
-      __Pyx_GOTREF(__pyx_t_8);
-      __Pyx_Raise(__pyx_t_8, 0, 0, 0);
-      __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-      __PYX_ERR(1, 896, __pyx_L5_except_error)
-    }
-    goto __pyx_L5_except_error;
-    __pyx_L5_except_error:;
-
-    /* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":893
- * 
- * cdef inline int import_ufunc() except -1:
- *     try:             # <<<<<<<<<<<<<<
- *         _import_umath()
- *     except Exception:
- */
-    __Pyx_XGIVEREF(__pyx_t_1);
-    __Pyx_XGIVEREF(__pyx_t_2);
-    __Pyx_XGIVEREF(__pyx_t_3);
-    __Pyx_ExceptionReset(__pyx_t_1, __pyx_t_2, __pyx_t_3);
-    goto __pyx_L1_error;
-    __pyx_L8_try_end:;
-  }
-
-  /* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":892
- *         raise ImportError("numpy.core.umath failed to import")
- * 
- * cdef inline int import_ufunc() except -1:             # <<<<<<<<<<<<<<
- *     try:
- *         _import_umath()
+ * SKYNET_PTYPE_user_builtin_ids = [SKYNET_PTYPE.PTYPE_LUA, SKYNET_PTYPE.PTYPE_CLIENT, SKYNET_PTYPE.PTYPE_SOCKET, SKYNET_PTYPE.PTYPE_TEXT, SKYNET_PTYPE.PTYPE_FOREIGN, SKYNET_PTYPE.PTYPE_FOREIGN_REMOTE]
+ * def user_assert_id_name(id, name):             # <<<<<<<<<<<<<<
+ *     is_builtin = False
+ *     if name in SKYNET_PTYPE_name_to_id:
  */
 
   /* function exit code */
-  __pyx_r = 0;
+  __pyx_r = Py_None; __Pyx_INCREF(Py_None);
   goto __pyx_L0;
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_5);
-  __Pyx_XDECREF(__pyx_t_6);
-  __Pyx_XDECREF(__pyx_t_7);
-  __Pyx_XDECREF(__pyx_t_8);
-  __Pyx_AddTraceback("numpy.import_ufunc", __pyx_clineno, __pyx_lineno, __pyx_filename);
-  __pyx_r = -1;
+  __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_XDECREF(__pyx_t_3);
+  __Pyx_AddTraceback("pyskynet.skynet_py_mq.user_assert_id_name", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = NULL;
   __pyx_L0:;
+  __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 static PyMethodDef __pyx_methods[] = {
   {0, 0, 0, 0}
 };
-
-#if PY_MAJOR_VERSION >= 3
-#if CYTHON_PEP489_MULTI_PHASE_INIT
-static PyObject* __pyx_pymod_create(PyObject *spec, PyModuleDef *def); /*proto*/
-static int __pyx_pymod_exec_skynet_py_foreign_seri(PyObject* module); /*proto*/
-static PyModuleDef_Slot __pyx_moduledef_slots[] = {
-  {Py_mod_create, (void*)__pyx_pymod_create},
-  {Py_mod_exec, (void*)__pyx_pymod_exec_skynet_py_foreign_seri},
-  {0, NULL}
-};
-#endif
-
-static struct PyModuleDef __pyx_moduledef = {
-    PyModuleDef_HEAD_INIT,
-    "skynet_py_foreign_seri",
-    0, /* m_doc */
-  #if CYTHON_PEP489_MULTI_PHASE_INIT
-    0, /* m_size */
-  #else
-    -1, /* m_size */
-  #endif
-    __pyx_methods /* m_methods */,
-  #if CYTHON_PEP489_MULTI_PHASE_INIT
-    __pyx_moduledef_slots, /* m_slots */
-  #else
-    NULL, /* m_reload */
-  #endif
-    NULL, /* m_traverse */
-    NULL, /* m_clear */
-    NULL /* m_free */
-};
-#endif
 #ifndef CYTHON_SMALL_CODE
 #if defined(__clang__)
     #define CYTHON_SMALL_CODE
 #elif defined(__GNUC__) && (__GNUC__ > 4 || (__GNUC__ == 4 && __GNUC_MINOR__ >= 3))
     #define CYTHON_SMALL_CODE __attribute__((cold))
 #else
     #define CYTHON_SMALL_CODE
 #endif
 #endif
+/* #### Code section: pystring_table ### */
 
-static __Pyx_StringTabEntry __pyx_string_tab[] = {
-  {&__pyx_n_s_ImportError, __pyx_k_ImportError, sizeof(__pyx_k_ImportError), 0, 0, 1, 1},
-  {&__pyx_kp_u_Unexcept_type_s, __pyx_k_Unexcept_type_s, sizeof(__pyx_k_Unexcept_type_s), 0, 1, 0, 0},
-  {&__pyx_kp_u_Unsupport_type_s_to_serialize, __pyx_k_Unsupport_type_s_to_serialize, sizeof(__pyx_k_Unsupport_type_s_to_serialize), 0, 1, 0, 0},
-  {&__pyx_n_s_append, __pyx_k_append, sizeof(__pyx_k_append), 0, 0, 1, 1},
-  {&__pyx_n_s_args, __pyx_k_args, sizeof(__pyx_k_args), 0, 0, 1, 1},
-  {&__pyx_n_s_capsule, __pyx_k_capsule, sizeof(__pyx_k_capsule), 0, 0, 1, 1},
-  {&__pyx_kp_u_capsule_unpack_failed_for_name_s, __pyx_k_capsule_unpack_failed_for_name_s, sizeof(__pyx_k_capsule_unpack_failed_for_name_s), 0, 1, 0, 0},
-  {&__pyx_n_s_char, __pyx_k_char, sizeof(__pyx_k_char), 0, 0, 1, 1},
-  {&__pyx_n_s_cline_in_traceback, __pyx_k_cline_in_traceback, sizeof(__pyx_k_cline_in_traceback), 0, 0, 1, 1},
-  {&__pyx_n_s_dtype, __pyx_k_dtype, sizeof(__pyx_k_dtype), 0, 0, 1, 1},
-  {&__pyx_n_s_enumerate, __pyx_k_enumerate, sizeof(__pyx_k_enumerate), 0, 0, 1, 1},
-  {&__pyx_n_s_flat, __pyx_k_flat, sizeof(__pyx_k_flat), 0, 0, 1, 1},
-  {&__pyx_n_s_floating, __pyx_k_floating, sizeof(__pyx_k_floating), 0, 0, 1, 1},
-  {&__pyx_n_s_import, __pyx_k_import, sizeof(__pyx_k_import), 0, 0, 1, 1},
-  {&__pyx_n_s_integer, __pyx_k_integer, sizeof(__pyx_k_integer), 0, 0, 1, 1},
-  {&__pyx_kp_u_invalid_stream, __pyx_k_invalid_stream, sizeof(__pyx_k_invalid_stream), 0, 1, 0, 0},
-  {&__pyx_kp_u_invalid_stream_for_value_type_ex, __pyx_k_invalid_stream_for_value_type_ex, sizeof(__pyx_k_invalid_stream_for_value_type_ex), 0, 1, 0, 0},
-  {&__pyx_kp_u_invalid_stream_when_unpacking_ar, __pyx_k_invalid_stream_when_unpacking_ar, sizeof(__pyx_k_invalid_stream_when_unpacking_ar), 0, 1, 0, 0},
-  {&__pyx_n_s_issubdtype, __pyx_k_issubdtype, sizeof(__pyx_k_issubdtype), 0, 0, 1, 1},
-  {&__pyx_n_s_items, __pyx_k_items, sizeof(__pyx_k_items), 0, 0, 1, 1},
-  {&__pyx_n_s_luapack, __pyx_k_luapack, sizeof(__pyx_k_luapack), 0, 0, 1, 1},
-  {&__pyx_n_s_luaunpack, __pyx_k_luaunpack, sizeof(__pyx_k_luaunpack), 0, 0, 1, 1},
-  {&__pyx_n_s_main, __pyx_k_main, sizeof(__pyx_k_main), 0, 0, 1, 1},
-  {&__pyx_n_s_name, __pyx_k_name, sizeof(__pyx_k_name), 0, 0, 1, 1},
-  {&__pyx_n_s_np, __pyx_k_np, sizeof(__pyx_k_np), 0, 0, 1, 1},
-  {&__pyx_n_s_numpy, __pyx_k_numpy, sizeof(__pyx_k_numpy), 0, 0, 1, 1},
-  {&__pyx_kp_u_numpy_core_multiarray_failed_to, __pyx_k_numpy_core_multiarray_failed_to, sizeof(__pyx_k_numpy_core_multiarray_failed_to), 0, 1, 0, 0},
-  {&__pyx_kp_u_numpy_core_umath_failed_to_impor, __pyx_k_numpy_core_umath_failed_to_impor, sizeof(__pyx_k_numpy_core_umath_failed_to_impor), 0, 1, 0, 0},
-  {&__pyx_n_s_pack, __pyx_k_pack, sizeof(__pyx_k_pack), 0, 0, 1, 1},
-  {&__pyx_n_s_pop, __pyx_k_pop, sizeof(__pyx_k_pop), 0, 0, 1, 1},
-  {&__pyx_n_s_ptr, __pyx_k_ptr, sizeof(__pyx_k_ptr), 0, 0, 1, 1},
-  {&__pyx_n_s_pyskynet_skynet_py_foreign_seri, __pyx_k_pyskynet_skynet_py_foreign_seri, sizeof(__pyx_k_pyskynet_skynet_py_foreign_seri), 0, 0, 1, 1},
-  {&__pyx_n_s_range, __pyx_k_range, sizeof(__pyx_k_range), 0, 0, 1, 1},
-  {&__pyx_n_s_remotepack, __pyx_k_remotepack, sizeof(__pyx_k_remotepack), 0, 0, 1, 1},
-  {&__pyx_n_s_remoteunpack, __pyx_k_remoteunpack, sizeof(__pyx_k_remoteunpack), 0, 0, 1, 1},
-  {&__pyx_kp_u_seri_wb_foreign_unexception_mode, __pyx_k_seri_wb_foreign_unexception_mode, sizeof(__pyx_k_seri_wb_foreign_unexception_mode), 0, 1, 0, 0},
-  {&__pyx_kp_u_serialize_can_t_pack_too_depth_t, __pyx_k_serialize_can_t_pack_too_depth_t, sizeof(__pyx_k_serialize_can_t_pack_too_depth_t), 0, 1, 0, 0},
-  {&__pyx_n_s_size, __pyx_k_size, sizeof(__pyx_k_size), 0, 0, 1, 1},
-  {&__pyx_kp_s_src_cy_src_skynet_py_foreign_ser, __pyx_k_src_cy_src_skynet_py_foreign_ser, sizeof(__pyx_k_src_cy_src_skynet_py_foreign_ser), 0, 0, 1, 0},
-  {&__pyx_n_s_sz, __pyx_k_sz, sizeof(__pyx_k_sz), 0, 0, 1, 1},
-  {&__pyx_n_s_test, __pyx_k_test, sizeof(__pyx_k_test), 0, 0, 1, 1},
-  {&__pyx_n_s_tobytes, __pyx_k_tobytes, sizeof(__pyx_k_tobytes), 0, 0, 1, 1},
-  {&__pyx_n_s_trash, __pyx_k_trash, sizeof(__pyx_k_trash), 0, 0, 1, 1},
-  {&__pyx_kp_u_unexception_capsule, __pyx_k_unexception_capsule, sizeof(__pyx_k_unexception_capsule), 0, 1, 0, 0},
-  {&__pyx_kp_u_unexception_typechar_s, __pyx_k_unexception_typechar_s, sizeof(__pyx_k_unexception_typechar_s), 0, 1, 0, 0},
-  {&__pyx_n_s_unpack, __pyx_k_unpack, sizeof(__pyx_k_unpack), 0, 0, 1, 1},
-  {0, 0, 0, 0, 0, 0, 0}
-};
+static int __Pyx_CreateStringTabAndInitStrings(void) {
+  __Pyx_StringTabEntry __pyx_string_tab[] = {
+    {&__pyx_n_s_AssertionError, __pyx_k_AssertionError, sizeof(__pyx_k_AssertionError), 0, 0, 1, 1},
+    {&__pyx_n_s_PTYPEEnum, __pyx_k_PTYPEEnum, sizeof(__pyx_k_PTYPEEnum), 0, 0, 1, 1},
+    {&__pyx_n_s_PTYPEEnum___init, __pyx_k_PTYPEEnum___init, sizeof(__pyx_k_PTYPEEnum___init), 0, 0, 1, 1},
+    {&__pyx_n_s_PTYPE_CLIENT, __pyx_k_PTYPE_CLIENT, sizeof(__pyx_k_PTYPE_CLIENT), 0, 0, 1, 1},
+    {&__pyx_n_s_PTYPE_DEBUG, __pyx_k_PTYPE_DEBUG, sizeof(__pyx_k_PTYPE_DEBUG), 0, 0, 1, 1},
+    {&__pyx_n_s_PTYPE_ERROR, __pyx_k_PTYPE_ERROR, sizeof(__pyx_k_PTYPE_ERROR), 0, 0, 1, 1},
+    {&__pyx_n_s_PTYPE_FOREIGN, __pyx_k_PTYPE_FOREIGN, sizeof(__pyx_k_PTYPE_FOREIGN), 0, 0, 1, 1},
+    {&__pyx_n_s_PTYPE_FOREIGN_REMOTE, __pyx_k_PTYPE_FOREIGN_REMOTE, sizeof(__pyx_k_PTYPE_FOREIGN_REMOTE), 0, 0, 1, 1},
+    {&__pyx_n_s_PTYPE_HARBOR, __pyx_k_PTYPE_HARBOR, sizeof(__pyx_k_PTYPE_HARBOR), 0, 0, 1, 1},
+    {&__pyx_n_s_PTYPE_LUA, __pyx_k_PTYPE_LUA, sizeof(__pyx_k_PTYPE_LUA), 0, 0, 1, 1},
+    {&__pyx_n_s_PTYPE_MULTICAST, __pyx_k_PTYPE_MULTICAST, sizeof(__pyx_k_PTYPE_MULTICAST), 0, 0, 1, 1},
+    {&__pyx_n_s_PTYPE_QUEUE, __pyx_k_PTYPE_QUEUE, sizeof(__pyx_k_PTYPE_QUEUE), 0, 0, 1, 1},
+    {&__pyx_n_s_PTYPE_RESPONSE, __pyx_k_PTYPE_RESPONSE, sizeof(__pyx_k_PTYPE_RESPONSE), 0, 0, 1, 1},
+    {&__pyx_n_s_PTYPE_SNAX, __pyx_k_PTYPE_SNAX, sizeof(__pyx_k_PTYPE_SNAX), 0, 0, 1, 1},
+    {&__pyx_n_s_PTYPE_SOCKET, __pyx_k_PTYPE_SOCKET, sizeof(__pyx_k_PTYPE_SOCKET), 0, 0, 1, 1},
+    {&__pyx_n_s_PTYPE_SYSTEM, __pyx_k_PTYPE_SYSTEM, sizeof(__pyx_k_PTYPE_SYSTEM), 0, 0, 1, 1},
+    {&__pyx_n_s_PTYPE_TAG_ALLOCSESSION, __pyx_k_PTYPE_TAG_ALLOCSESSION, sizeof(__pyx_k_PTYPE_TAG_ALLOCSESSION), 0, 0, 1, 1},
+    {&__pyx_n_s_PTYPE_TAG_DONTCOPY, __pyx_k_PTYPE_TAG_DONTCOPY, sizeof(__pyx_k_PTYPE_TAG_DONTCOPY), 0, 0, 1, 1},
+    {&__pyx_n_s_PTYPE_TEXT, __pyx_k_PTYPE_TEXT, sizeof(__pyx_k_PTYPE_TEXT), 0, 0, 1, 1},
+    {&__pyx_n_s_PTYPE_TRACE, __pyx_k_PTYPE_TRACE, sizeof(__pyx_k_PTYPE_TRACE), 0, 0, 1, 1},
+    {&__pyx_n_s_SKYNET_PTYPE, __pyx_k_SKYNET_PTYPE, sizeof(__pyx_k_SKYNET_PTYPE), 0, 0, 1, 1},
+    {&__pyx_n_s_SKYNET_PTYPE_id_to_name, __pyx_k_SKYNET_PTYPE_id_to_name, sizeof(__pyx_k_SKYNET_PTYPE_id_to_name), 0, 0, 1, 1},
+    {&__pyx_n_s_SKYNET_PTYPE_name_to_id, __pyx_k_SKYNET_PTYPE_name_to_id, sizeof(__pyx_k_SKYNET_PTYPE_name_to_id), 0, 0, 1, 1},
+    {&__pyx_n_s_SKYNET_PTYPE_user_builtin_ids, __pyx_k_SKYNET_PTYPE_user_builtin_ids, sizeof(__pyx_k_SKYNET_PTYPE_user_builtin_ids), 0, 0, 1, 1},
+    {&__pyx_kp_b__2, __pyx_k__2, sizeof(__pyx_k__2), 0, 0, 0, 0},
+    {&__pyx_n_s__20, __pyx_k__20, sizeof(__pyx_k__20), 0, 0, 1, 1},
+    {&__pyx_n_s_asyncio_coroutines, __pyx_k_asyncio_coroutines, sizeof(__pyx_k_asyncio_coroutines), 0, 0, 1, 1},
+    {&__pyx_n_s_b, __pyx_k_b, sizeof(__pyx_k_b), 0, 0, 1, 1},
+    {&__pyx_n_s_capsule, __pyx_k_capsule, sizeof(__pyx_k_capsule), 0, 0, 1, 1},
+    {&__pyx_kp_u_capsule_unpack_failed_for_name_s, __pyx_k_capsule_unpack_failed_for_name_s, sizeof(__pyx_k_capsule_unpack_failed_for_name_s), 0, 1, 0, 0},
+    {&__pyx_n_s_class_getitem, __pyx_k_class_getitem, sizeof(__pyx_k_class_getitem), 0, 0, 1, 1},
+    {&__pyx_n_s_cline_in_traceback, __pyx_k_cline_in_traceback, sizeof(__pyx_k_cline_in_traceback), 0, 0, 1, 1},
+    {&__pyx_n_s_crecv, __pyx_k_crecv, sizeof(__pyx_k_crecv), 0, 0, 1, 1},
+    {&__pyx_n_s_csend, __pyx_k_csend, sizeof(__pyx_k_csend), 0, 0, 1, 1},
+    {&__pyx_n_s_decode, __pyx_k_decode, sizeof(__pyx_k_decode), 0, 0, 1, 1},
+    {&__pyx_n_s_dict, __pyx_k_dict, sizeof(__pyx_k_dict), 0, 0, 1, 1},
+    {&__pyx_n_s_doc, __pyx_k_doc, sizeof(__pyx_k_doc), 0, 0, 1, 1},
+    {&__pyx_n_s_dst, __pyx_k_dst, sizeof(__pyx_k_dst), 0, 0, 1, 1},
+    {&__pyx_n_s_dstname, __pyx_k_dstname, sizeof(__pyx_k_dstname), 0, 0, 1, 1},
+    {&__pyx_n_s_id, __pyx_k_id, sizeof(__pyx_k_id), 0, 0, 1, 1},
+    {&__pyx_n_s_init, __pyx_k_init, sizeof(__pyx_k_init), 0, 0, 1, 1},
+    {&__pyx_n_s_init_subclass, __pyx_k_init_subclass, sizeof(__pyx_k_init_subclass), 0, 0, 1, 1},
+    {&__pyx_n_s_is_builtin, __pyx_k_is_builtin, sizeof(__pyx_k_is_builtin), 0, 0, 1, 1},
+    {&__pyx_n_s_is_coroutine, __pyx_k_is_coroutine, sizeof(__pyx_k_is_coroutine), 0, 0, 1, 1},
+    {&__pyx_n_s_items, __pyx_k_items, sizeof(__pyx_k_items), 0, 0, 1, 1},
+    {&__pyx_n_s_key, __pyx_k_key, sizeof(__pyx_k_key), 0, 0, 1, 1},
+    {&__pyx_n_s_lower, __pyx_k_lower, sizeof(__pyx_k_lower), 0, 0, 1, 1},
+    {&__pyx_n_s_main, __pyx_k_main, sizeof(__pyx_k_main), 0, 0, 1, 1},
+    {&__pyx_n_s_metaclass, __pyx_k_metaclass, sizeof(__pyx_k_metaclass), 0, 0, 1, 1},
+    {&__pyx_n_s_module, __pyx_k_module, sizeof(__pyx_k_module), 0, 0, 1, 1},
+    {&__pyx_n_s_mro_entries, __pyx_k_mro_entries, sizeof(__pyx_k_mro_entries), 0, 0, 1, 1},
+    {&__pyx_n_s_msg, __pyx_k_msg, sizeof(__pyx_k_msg), 0, 0, 1, 1},
+    {&__pyx_kp_u_must_bind_id, __pyx_k_must_bind_id, sizeof(__pyx_k_must_bind_id), 0, 1, 0, 0},
+    {&__pyx_kp_u_must_bind_name, __pyx_k_must_bind_name, sizeof(__pyx_k_must_bind_name), 0, 1, 0, 0},
+    {&__pyx_n_s_name, __pyx_k_name, sizeof(__pyx_k_name), 0, 0, 1, 1},
+    {&__pyx_n_s_name_2, __pyx_k_name_2, sizeof(__pyx_k_name_2), 0, 0, 1, 1},
+    {&__pyx_n_s_object, __pyx_k_object, sizeof(__pyx_k_object), 0, 0, 1, 1},
+    {&__pyx_kp_u_package_is_too_large_s, __pyx_k_package_is_too_large_s, sizeof(__pyx_k_package_is_too_large_s), 0, 1, 0, 0},
+    {&__pyx_n_s_prepare, __pyx_k_prepare, sizeof(__pyx_k_prepare), 0, 0, 1, 1},
+    {&__pyx_n_s_ptr, __pyx_k_ptr, sizeof(__pyx_k_ptr), 0, 0, 1, 1},
+    {&__pyx_n_s_py_dst, __pyx_k_py_dst, sizeof(__pyx_k_py_dst), 0, 0, 1, 1},
+    {&__pyx_n_s_py_dst_bytes, __pyx_k_py_dst_bytes, sizeof(__pyx_k_py_dst_bytes), 0, 0, 1, 1},
+    {&__pyx_n_s_py_msg, __pyx_k_py_msg, sizeof(__pyx_k_py_msg), 0, 0, 1, 1},
+    {&__pyx_n_s_py_msg_bytes, __pyx_k_py_msg_bytes, sizeof(__pyx_k_py_msg_bytes), 0, 0, 1, 1},
+    {&__pyx_n_s_py_session, __pyx_k_py_session, sizeof(__pyx_k_py_session), 0, 0, 1, 1},
+    {&__pyx_n_s_py_size, __pyx_k_py_size, sizeof(__pyx_k_py_size), 0, 0, 1, 1},
+    {&__pyx_n_s_pyskynet_skynet_py_mq, __pyx_k_pyskynet_skynet_py_mq, sizeof(__pyx_k_pyskynet_skynet_py_mq), 0, 0, 1, 1},
+    {&__pyx_n_s_qualname, __pyx_k_qualname, sizeof(__pyx_k_qualname), 0, 0, 1, 1},
+    {&__pyx_n_s_ret, __pyx_k_ret, sizeof(__pyx_k_ret), 0, 0, 1, 1},
+    {&__pyx_n_s_s, __pyx_k_s, sizeof(__pyx_k_s), 0, 0, 1, 1},
+    {&__pyx_n_s_self, __pyx_k_self, sizeof(__pyx_k_self), 0, 0, 1, 1},
+    {&__pyx_n_s_session, __pyx_k_session, sizeof(__pyx_k_session), 0, 0, 1, 1},
+    {&__pyx_n_s_set_name, __pyx_k_set_name, sizeof(__pyx_k_set_name), 0, 0, 1, 1},
+    {&__pyx_n_s_size, __pyx_k_size, sizeof(__pyx_k_size), 0, 0, 1, 1},
+    {&__pyx_kp_u_skynet_proto_can_only_register_b, __pyx_k_skynet_proto_can_only_register_b, sizeof(__pyx_k_skynet_proto_can_only_register_b), 0, 1, 0, 0},
+    {&__pyx_kp_u_skynet_proto_type_id, __pyx_k_skynet_proto_type_id, sizeof(__pyx_k_skynet_proto_type_id), 0, 1, 0, 0},
+    {&__pyx_kp_u_skynet_proto_type_id_must_be_les, __pyx_k_skynet_proto_type_id_must_be_les, sizeof(__pyx_k_skynet_proto_type_id_must_be_les), 0, 1, 0, 0},
+    {&__pyx_kp_u_skynet_proto_type_name, __pyx_k_skynet_proto_type_name, sizeof(__pyx_k_skynet_proto_type_name), 0, 1, 0, 0},
+    {&__pyx_kp_u_skynet_threads_has_not_been_star, __pyx_k_skynet_threads_has_not_been_star, sizeof(__pyx_k_skynet_threads_has_not_been_star), 0, 1, 0, 0},
+    {&__pyx_kp_s_src_cy_src_skynet_py_mq_pyx, __pyx_k_src_cy_src_skynet_py_mq_pyx, sizeof(__pyx_k_src_cy_src_skynet_py_mq_pyx), 0, 0, 1, 0},
+    {&__pyx_n_s_super, __pyx_k_super, sizeof(__pyx_k_super), 0, 0, 1, 1},
+    {&__pyx_n_s_test, __pyx_k_test, sizeof(__pyx_k_test), 0, 0, 1, 1},
+    {&__pyx_n_s_tobytes, __pyx_k_tobytes, sizeof(__pyx_k_tobytes), 0, 0, 1, 1},
+    {&__pyx_n_s_tostring, __pyx_k_tostring, sizeof(__pyx_k_tostring), 0, 0, 1, 1},
+    {&__pyx_n_s_type_id, __pyx_k_type_id, sizeof(__pyx_k_type_id), 0, 0, 1, 1},
+    {&__pyx_kp_u_type_s_unexcept_when_skynet_csen, __pyx_k_type_s_unexcept_when_skynet_csen, sizeof(__pyx_k_type_s_unexcept_when_skynet_csen), 0, 1, 0, 0},
+    {&__pyx_n_s_user_assert_id_name, __pyx_k_user_assert_id_name, sizeof(__pyx_k_user_assert_id_name), 0, 0, 1, 1},
+    {0, 0, 0, 0, 0, 0, 0}
+  };
+  return __Pyx_InitStrings(__pyx_string_tab);
+}
+/* #### Code section: cached_builtins ### */
 static CYTHON_SMALL_CODE int __Pyx_InitCachedBuiltins(void) {
-  __pyx_builtin_range = __Pyx_GetBuiltinName(__pyx_n_s_range); if (!__pyx_builtin_range) __PYX_ERR(0, 239, __pyx_L1_error)
-  __pyx_builtin_enumerate = __Pyx_GetBuiltinName(__pyx_n_s_enumerate); if (!__pyx_builtin_enumerate) __PYX_ERR(0, 254, __pyx_L1_error)
-  __pyx_builtin_ImportError = __Pyx_GetBuiltinName(__pyx_n_s_ImportError); if (!__pyx_builtin_ImportError) __PYX_ERR(1, 884, __pyx_L1_error)
+  __pyx_builtin_object = __Pyx_GetBuiltinName(__pyx_n_s_object); if (!__pyx_builtin_object) __PYX_ERR(0, 99, __pyx_L1_error)
+  __pyx_builtin_AssertionError = __Pyx_GetBuiltinName(__pyx_n_s_AssertionError); if (!__pyx_builtin_AssertionError) __PYX_ERR(0, 35, __pyx_L1_error)
   return 0;
   __pyx_L1_error:;
   return -1;
 }
+/* #### Code section: cached_constants ### */
 
 static CYTHON_SMALL_CODE int __Pyx_InitCachedConstants(void) {
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__Pyx_InitCachedConstants", 0);
 
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":90
- *     ptr = foreign_rb_read(rb, sizeof(n_double))
- *     if(ptr==NULL):
- *         raise Exception("invalid stream")             # <<<<<<<<<<<<<<
- *     memcpy(&n_double, ptr, sizeof(n_double));
- *     return n_double
+  /* "src/cy_src/skynet_py_mq.pyx":25
+ *         ret = skynet_py_queue_pop(&msg)
+ *     if ret != 0:
+ *         return None, None, None, None, None             # <<<<<<<<<<<<<<
+ *     else:
+ *         # TODO when msg.type is error , msg.data will be nil ?
  */
-  __pyx_tuple_ = PyTuple_Pack(1, __pyx_kp_u_invalid_stream); if (unlikely(!__pyx_tuple_)) __PYX_ERR(0, 90, __pyx_L1_error)
+  __pyx_tuple_ = PyTuple_Pack(5, Py_None, Py_None, Py_None, Py_None, Py_None); if (unlikely(!__pyx_tuple_)) __PYX_ERR(0, 25, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple_);
   __Pyx_GIVEREF(__pyx_tuple_);
 
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":211
- *         arr = unpack_PyArray(rb, cookie)
- *         if arr is None:
- *             raise Exception("invalid stream when unpacking arr")             # <<<<<<<<<<<<<<
- *         l.append(arr)
+  /* "src/cy_src/skynet_py_mq.pyx":97
+ *         return s
  *     else:
- */
-  __pyx_tuple__2 = PyTuple_Pack(1, __pyx_kp_u_invalid_stream_when_unpacking_ar); if (unlikely(!__pyx_tuple__2)) __PYX_ERR(0, 211, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__2);
-  __Pyx_GIVEREF(__pyx_tuple__2);
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":214
- *         l.append(arr)
- *     else:
- *         raise Exception("invalid stream for value type exception")             # <<<<<<<<<<<<<<
+ *         raise Exception("capsule unpack failed for name = %s")             # <<<<<<<<<<<<<<
  * 
- * cdef void py_unpack_one(l, foreign_read_block *rb, bint iskey) except *:
+ * class PTYPEEnum(object):
  */
-  __pyx_tuple__3 = PyTuple_Pack(1, __pyx_kp_u_invalid_stream_for_value_type_ex); if (unlikely(!__pyx_tuple__3)) __PYX_ERR(0, 214, __pyx_L1_error)
+  __pyx_tuple__3 = PyTuple_Pack(1, __pyx_kp_u_capsule_unpack_failed_for_name_s); if (unlikely(!__pyx_tuple__3)) __PYX_ERR(0, 97, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__3);
   __Pyx_GIVEREF(__pyx_tuple__3);
 
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":324
- *     cdef const char *name = NULL
- *     if depth > MAX_DEPTH:
- *         raise Exception("serialize can't pack too depth table")             # <<<<<<<<<<<<<<
- *     if py_arg is None:
- *         wb_nil(wb_cast(wb))
+  /* "src/cy_src/skynet_py_mq.pyx":18
+ *     skynet_free(ptr)
+ * 
+ * def crecv():             # <<<<<<<<<<<<<<
+ *     cdef SkynetPyMessage msg
+ *     cdef int ret = skynet_py_queue_pop(&msg)
  */
-  __pyx_tuple__4 = PyTuple_Pack(1, __pyx_kp_u_serialize_can_t_pack_too_depth_t); if (unlikely(!__pyx_tuple__4)) __PYX_ERR(0, 324, __pyx_L1_error)
+  __pyx_tuple__4 = PyTuple_Pack(2, __pyx_n_s_msg, __pyx_n_s_ret); if (unlikely(!__pyx_tuple__4)) __PYX_ERR(0, 18, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__4);
   __Pyx_GIVEREF(__pyx_tuple__4);
+  __pyx_codeobj__5 = (PyObject*)__Pyx_PyCode_New(0, 0, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__4, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_cy_src_skynet_py_mq_pyx, __pyx_n_s_crecv, 18, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__5)) __PYX_ERR(0, 18, __pyx_L1_error)
 
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":332
- *             wb_pointer(wb_cast(wb), PyCapsule_GetPointer(py_arg, "cptr"))
- *         else:
- *             raise Exception("unexception capsule")             # <<<<<<<<<<<<<<
- *     elif PyArray_CheckExact(py_arg):
- *         if not PyArray_foreign_check_typechar(py_arg):
- */
-  __pyx_tuple__5 = PyTuple_Pack(1, __pyx_kp_u_unexception_capsule); if (unlikely(!__pyx_tuple__5)) __PYX_ERR(0, 332, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__5);
-  __Pyx_GIVEREF(__pyx_tuple__5);
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":342
- *             wb_foreign_PyArray(wb, py_arg, arr_iter)
- *         else:
- *             raise Exception("seri wb foreign unexception mode")             # <<<<<<<<<<<<<<
- *     elif isinstance(py_arg, dict):
- *         py_pack_dict(wb, py_arg, depth+1)
+  /* "src/cy_src/skynet_py_mq.pyx":34
+ * 
+ * # see lsend in lua-skynet.c
+ * def csend(py_dst, int type_id, py_session, py_msg, py_size=None):             # <<<<<<<<<<<<<<
+ *     assert skynet_py_address() > 0, "skynet threads has not been started yet, call 'pyskynet.start()' first."
+ *     # 1. check dst
  */
-  __pyx_tuple__6 = PyTuple_Pack(1, __pyx_kp_u_seri_wb_foreign_unexception_mode); if (unlikely(!__pyx_tuple__6)) __PYX_ERR(0, 342, __pyx_L1_error)
+  __pyx_tuple__6 = PyTuple_Pack(12, __pyx_n_s_py_dst, __pyx_n_s_type_id, __pyx_n_s_py_session, __pyx_n_s_py_msg, __pyx_n_s_py_size, __pyx_n_s_dstname, __pyx_n_s_dst, __pyx_n_s_py_dst_bytes, __pyx_n_s_session, __pyx_n_s_ptr, __pyx_n_s_size, __pyx_n_s_py_msg_bytes); if (unlikely(!__pyx_tuple__6)) __PYX_ERR(0, 34, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__6);
   __Pyx_GIVEREF(__pyx_tuple__6);
-
-  /* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":884
- *         __pyx_import_array()
- *     except Exception:
- *         raise ImportError("numpy.core.multiarray failed to import")             # <<<<<<<<<<<<<<
- * 
- * cdef inline int import_umath() except -1:
- */
-  __pyx_tuple__7 = PyTuple_Pack(1, __pyx_kp_u_numpy_core_multiarray_failed_to); if (unlikely(!__pyx_tuple__7)) __PYX_ERR(1, 884, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__7);
-  __Pyx_GIVEREF(__pyx_tuple__7);
-
-  /* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":890
- *         _import_umath()
- *     except Exception:
- *         raise ImportError("numpy.core.umath failed to import")             # <<<<<<<<<<<<<<
- * 
- * cdef inline int import_ufunc() except -1:
- */
-  __pyx_tuple__8 = PyTuple_Pack(1, __pyx_kp_u_numpy_core_umath_failed_to_impor); if (unlikely(!__pyx_tuple__8)) __PYX_ERR(1, 890, __pyx_L1_error)
+  __pyx_codeobj__7 = (PyObject*)__Pyx_PyCode_New(5, 0, 0, 12, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__6, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_cy_src_skynet_py_mq_pyx, __pyx_n_s_csend, 34, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__7)) __PYX_ERR(0, 34, __pyx_L1_error)
+  __pyx_tuple__8 = PyTuple_Pack(1, ((PyObject *)Py_None)); if (unlikely(!__pyx_tuple__8)) __PYX_ERR(0, 34, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__8);
   __Pyx_GIVEREF(__pyx_tuple__8);
 
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":400
- * #########################
+  /* "src/cy_src/skynet_py_mq.pyx":84
  * 
- * def tobytes(capsule, size_t size):             # <<<<<<<<<<<<<<
- *     cdef char *ptr = <char *>PyCapsule_GetPointer(capsule, PyCapsule_GetName(capsule))
- *     return ptr[:size]
+ * # extern
+ * def tostring(capsule, size_t size):             # <<<<<<<<<<<<<<
+ *     b = tobytes(capsule, size)
+ *     return b.decode()
  */
-  __pyx_tuple__9 = PyTuple_Pack(3, __pyx_n_s_capsule, __pyx_n_s_size, __pyx_n_s_ptr); if (unlikely(!__pyx_tuple__9)) __PYX_ERR(0, 400, __pyx_L1_error)
+  __pyx_tuple__9 = PyTuple_Pack(3, __pyx_n_s_capsule, __pyx_n_s_size, __pyx_n_s_b); if (unlikely(!__pyx_tuple__9)) __PYX_ERR(0, 84, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__9);
   __Pyx_GIVEREF(__pyx_tuple__9);
-  __pyx_codeobj__10 = (PyObject*)__Pyx_PyCode_New(2, 0, 3, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__9, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_cy_src_skynet_py_foreign_ser, __pyx_n_s_tobytes, 400, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__10)) __PYX_ERR(0, 400, __pyx_L1_error)
+  __pyx_codeobj__10 = (PyObject*)__Pyx_PyCode_New(2, 0, 0, 3, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__9, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_cy_src_skynet_py_mq_pyx, __pyx_n_s_tostring, 84, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__10)) __PYX_ERR(0, 84, __pyx_L1_error)
 
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":404
- *     return ptr[:size]
- * 
- * def luapack(*args):             # <<<<<<<<<<<<<<
- *     return py_foreign_pack(MODE_LUA, args)
+  /* "src/cy_src/skynet_py_mq.pyx":89
  * 
+ * # extern
+ * def tobytes(capsule, size_t size):             # <<<<<<<<<<<<<<
+ *     cdef char *name = PyCapsule_GetName(capsule)
+ *     cdef char *ptr = <char *>PyCapsule_GetPointer(capsule, name)
  */
-  __pyx_tuple__11 = PyTuple_Pack(1, __pyx_n_s_args); if (unlikely(!__pyx_tuple__11)) __PYX_ERR(0, 404, __pyx_L1_error)
+  __pyx_tuple__11 = PyTuple_Pack(5, __pyx_n_s_capsule, __pyx_n_s_size, __pyx_n_s_name, __pyx_n_s_ptr, __pyx_n_s_s); if (unlikely(!__pyx_tuple__11)) __PYX_ERR(0, 89, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__11);
   __Pyx_GIVEREF(__pyx_tuple__11);
-  __pyx_codeobj__12 = (PyObject*)__Pyx_PyCode_New(0, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS|CO_VARARGS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__11, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_cy_src_skynet_py_foreign_ser, __pyx_n_s_luapack, 404, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__12)) __PYX_ERR(0, 404, __pyx_L1_error)
+  __pyx_codeobj__12 = (PyObject*)__Pyx_PyCode_New(2, 0, 0, 5, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__11, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_cy_src_skynet_py_mq_pyx, __pyx_n_s_tobytes, 89, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__12)) __PYX_ERR(0, 89, __pyx_L1_error)
 
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":407
- *     return py_foreign_pack(MODE_LUA, args)
- * 
- * def luaunpack(capsule, size=None):             # <<<<<<<<<<<<<<
- *     return py_foreign_unpack(MODE_LUA, capsule, size)
+  /* "src/cy_src/skynet_py_mq.pyx":99
+ *         raise Exception("capsule unpack failed for name = %s")
  * 
+ * class PTYPEEnum(object):             # <<<<<<<<<<<<<<
+ *     def __init__(self):
+ *         self.PTYPE_TEXT=PTYPE_TEXT
  */
-  __pyx_tuple__13 = PyTuple_Pack(2, __pyx_n_s_capsule, __pyx_n_s_size); if (unlikely(!__pyx_tuple__13)) __PYX_ERR(0, 407, __pyx_L1_error)
+  __pyx_tuple__13 = PyTuple_Pack(1, __pyx_builtin_object); if (unlikely(!__pyx_tuple__13)) __PYX_ERR(0, 99, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__13);
   __Pyx_GIVEREF(__pyx_tuple__13);
-  __pyx_codeobj__14 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__13, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_cy_src_skynet_py_foreign_ser, __pyx_n_s_luaunpack, 407, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__14)) __PYX_ERR(0, 407, __pyx_L1_error)
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":410
- *     return py_foreign_unpack(MODE_LUA, capsule, size)
- * 
- * def pack(*args):             # <<<<<<<<<<<<<<
- *     return py_foreign_pack(MODE_FOREIGN, args)
- * 
+  __pyx_tuple__14 = PyTuple_Pack(1, __pyx_builtin_object); if (unlikely(!__pyx_tuple__14)) __PYX_ERR(0, 99, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__14);
+  __Pyx_GIVEREF(__pyx_tuple__14);
+
+  /* "src/cy_src/skynet_py_mq.pyx":100
+ * 
+ * class PTYPEEnum(object):
+ *     def __init__(self):             # <<<<<<<<<<<<<<
+ *         self.PTYPE_TEXT=PTYPE_TEXT
+ *         self.PTYPE_RESPONSE=PTYPE_RESPONSE
  */
-  __pyx_tuple__15 = PyTuple_Pack(1, __pyx_n_s_args); if (unlikely(!__pyx_tuple__15)) __PYX_ERR(0, 410, __pyx_L1_error)
+  __pyx_tuple__15 = PyTuple_Pack(1, __pyx_n_s_self); if (unlikely(!__pyx_tuple__15)) __PYX_ERR(0, 100, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_tuple__15);
   __Pyx_GIVEREF(__pyx_tuple__15);
-  __pyx_codeobj__16 = (PyObject*)__Pyx_PyCode_New(0, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS|CO_VARARGS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__15, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_cy_src_skynet_py_foreign_ser, __pyx_n_s_pack, 410, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__16)) __PYX_ERR(0, 410, __pyx_L1_error)
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":413
- *     return py_foreign_pack(MODE_FOREIGN, args)
- * 
- * def unpack(capsule, size=None):             # <<<<<<<<<<<<<<
- *     return py_foreign_unpack(MODE_FOREIGN, capsule, size)
- * 
- */
-  __pyx_tuple__17 = PyTuple_Pack(2, __pyx_n_s_capsule, __pyx_n_s_size); if (unlikely(!__pyx_tuple__17)) __PYX_ERR(0, 413, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__17);
-  __Pyx_GIVEREF(__pyx_tuple__17);
-  __pyx_codeobj__18 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__17, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_cy_src_skynet_py_foreign_ser, __pyx_n_s_unpack, 413, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__18)) __PYX_ERR(0, 413, __pyx_L1_error)
+  __pyx_codeobj__16 = (PyObject*)__Pyx_PyCode_New(1, 0, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__15, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_cy_src_skynet_py_mq_pyx, __pyx_n_s_init, 100, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__16)) __PYX_ERR(0, 100, __pyx_L1_error)
 
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":416
- *     return py_foreign_unpack(MODE_FOREIGN, capsule, size)
+  /* "src/cy_src/skynet_py_mq.pyx":125
  * 
- * def remotepack(*args):             # <<<<<<<<<<<<<<
- *     return py_foreign_pack(MODE_FOREIGN_REMOTE, args)
- * 
- */
-  __pyx_tuple__19 = PyTuple_Pack(1, __pyx_n_s_args); if (unlikely(!__pyx_tuple__19)) __PYX_ERR(0, 416, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__19);
-  __Pyx_GIVEREF(__pyx_tuple__19);
-  __pyx_codeobj__20 = (PyObject*)__Pyx_PyCode_New(0, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS|CO_VARARGS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__19, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_cy_src_skynet_py_foreign_ser, __pyx_n_s_remotepack, 416, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__20)) __PYX_ERR(0, 416, __pyx_L1_error)
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":419
- *     return py_foreign_pack(MODE_FOREIGN_REMOTE, args)
- * 
- * def remoteunpack(capsule, size=None):             # <<<<<<<<<<<<<<
- *     return py_foreign_unpack(MODE_FOREIGN_REMOTE, capsule, size)
- * 
- */
-  __pyx_tuple__21 = PyTuple_Pack(2, __pyx_n_s_capsule, __pyx_n_s_size); if (unlikely(!__pyx_tuple__21)) __PYX_ERR(0, 419, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__21);
-  __Pyx_GIVEREF(__pyx_tuple__21);
-  __pyx_codeobj__22 = (PyObject*)__Pyx_PyCode_New(2, 0, 2, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__21, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_cy_src_skynet_py_foreign_ser, __pyx_n_s_remoteunpack, 419, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__22)) __PYX_ERR(0, 419, __pyx_L1_error)
-
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":422
- *     return py_foreign_unpack(MODE_FOREIGN_REMOTE, capsule, size)
- * 
- * def trash(capsule, size_t sz):             # <<<<<<<<<<<<<<
- *     cdef void *ptr = PyCapsule_GetPointer(capsule, "cptr")
- *     skynet_free(ptr)
- */
-  __pyx_tuple__23 = PyTuple_Pack(3, __pyx_n_s_capsule, __pyx_n_s_sz, __pyx_n_s_ptr); if (unlikely(!__pyx_tuple__23)) __PYX_ERR(0, 422, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__23);
-  __Pyx_GIVEREF(__pyx_tuple__23);
-  __pyx_codeobj__24 = (PyObject*)__Pyx_PyCode_New(2, 0, 3, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__23, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_cy_src_skynet_py_foreign_ser, __pyx_n_s_trash, 422, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__24)) __PYX_ERR(0, 422, __pyx_L1_error)
+ * for key, id in SKYNET_PTYPE.__dict__.items():
+ *     name = key[6:].lower()             # <<<<<<<<<<<<<<
+ *     SKYNET_PTYPE_id_to_name[id] = name
+ *     SKYNET_PTYPE_name_to_id[name] = id
+ */
+  __pyx_slice__17 = PySlice_New(__pyx_int_6, Py_None, Py_None); if (unlikely(!__pyx_slice__17)) __PYX_ERR(0, 125, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_slice__17);
+  __Pyx_GIVEREF(__pyx_slice__17);
+
+  /* "src/cy_src/skynet_py_mq.pyx":132
+ * 
+ * SKYNET_PTYPE_user_builtin_ids = [SKYNET_PTYPE.PTYPE_LUA, SKYNET_PTYPE.PTYPE_CLIENT, SKYNET_PTYPE.PTYPE_SOCKET, SKYNET_PTYPE.PTYPE_TEXT, SKYNET_PTYPE.PTYPE_FOREIGN, SKYNET_PTYPE.PTYPE_FOREIGN_REMOTE]
+ * def user_assert_id_name(id, name):             # <<<<<<<<<<<<<<
+ *     is_builtin = False
+ *     if name in SKYNET_PTYPE_name_to_id:
+ */
+  __pyx_tuple__18 = PyTuple_Pack(3, __pyx_n_s_id, __pyx_n_s_name, __pyx_n_s_is_builtin); if (unlikely(!__pyx_tuple__18)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__18);
+  __Pyx_GIVEREF(__pyx_tuple__18);
+  __pyx_codeobj__19 = (PyObject*)__Pyx_PyCode_New(2, 0, 0, 3, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__18, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_src_cy_src_skynet_py_mq_pyx, __pyx_n_s_user_assert_id_name, 132, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__19)) __PYX_ERR(0, 132, __pyx_L1_error)
   __Pyx_RefNannyFinishContext();
   return 0;
   __pyx_L1_error:;
   __Pyx_RefNannyFinishContext();
   return -1;
 }
+/* #### Code section: init_constants ### */
 
-static CYTHON_SMALL_CODE int __Pyx_InitGlobals(void) {
-  __pyx_umethod_PyList_Type_pop.type = (PyObject*)&PyList_Type;
-  if (__Pyx_InitStrings(__pyx_string_tab) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
+static CYTHON_SMALL_CODE int __Pyx_InitConstants(void) {
+  if (__Pyx_CreateStringTabAndInitStrings() < 0) __PYX_ERR(0, 1, __pyx_L1_error);
   __pyx_int_0 = PyInt_FromLong(0); if (unlikely(!__pyx_int_0)) __PYX_ERR(0, 1, __pyx_L1_error)
-  __pyx_int_1 = PyInt_FromLong(1); if (unlikely(!__pyx_int_1)) __PYX_ERR(0, 1, __pyx_L1_error)
+  __pyx_int_6 = PyInt_FromLong(6); if (unlikely(!__pyx_int_6)) __PYX_ERR(0, 1, __pyx_L1_error)
+  __pyx_int_12 = PyInt_FromLong(12); if (unlikely(!__pyx_int_12)) __PYX_ERR(0, 1, __pyx_L1_error)
+  __pyx_int_255 = PyInt_FromLong(255); if (unlikely(!__pyx_int_255)) __PYX_ERR(0, 1, __pyx_L1_error)
+  return 0;
+  __pyx_L1_error:;
+  return -1;
+}
+/* #### Code section: init_globals ### */
+
+static CYTHON_SMALL_CODE int __Pyx_InitGlobals(void) {
+  /* AssertionsEnabled.init */
+  __Pyx_init_assertions_enabled();
+
+if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 1, __pyx_L1_error)
+
   return 0;
   __pyx_L1_error:;
   return -1;
 }
+/* #### Code section: init_module ### */
 
 static CYTHON_SMALL_CODE int __Pyx_modinit_global_init_code(void); /*proto*/
 static CYTHON_SMALL_CODE int __Pyx_modinit_variable_export_code(void); /*proto*/
 static CYTHON_SMALL_CODE int __Pyx_modinit_function_export_code(void); /*proto*/
 static CYTHON_SMALL_CODE int __Pyx_modinit_type_init_code(void); /*proto*/
 static CYTHON_SMALL_CODE int __Pyx_modinit_type_import_code(void); /*proto*/
 static CYTHON_SMALL_CODE int __Pyx_modinit_variable_import_code(void); /*proto*/
@@ -7598,37 +5211,25 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__Pyx_modinit_type_import_code", 0);
   /*--- Type import code ---*/
-  __pyx_t_1 = PyImport_ImportModule(__Pyx_BUILTIN_MODULE_NAME); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 9, __pyx_L1_error)
+  __pyx_t_1 = PyImport_ImportModule(__Pyx_BUILTIN_MODULE_NAME); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 9, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_ptype_7cpython_4type_type = __Pyx_ImportType(__pyx_t_1, __Pyx_BUILTIN_MODULE_NAME, "type", 
+  __pyx_ptype_7cpython_4type_type = __Pyx_ImportType_3_0_0(__pyx_t_1, __Pyx_BUILTIN_MODULE_NAME, "type", 
   #if defined(PYPY_VERSION_NUM) && PYPY_VERSION_NUM < 0x050B0000
-  sizeof(PyTypeObject),
+  sizeof(PyTypeObject), __PYX_GET_STRUCT_ALIGNMENT_3_0_0(PyTypeObject),
+  #elif CYTHON_COMPILING_IN_LIMITED_API
+  sizeof(PyTypeObject), __PYX_GET_STRUCT_ALIGNMENT_3_0_0(PyTypeObject),
   #else
-  sizeof(PyHeapTypeObject),
+  sizeof(PyHeapTypeObject), __PYX_GET_STRUCT_ALIGNMENT_3_0_0(PyHeapTypeObject),
   #endif
-  __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_7cpython_4type_type) __PYX_ERR(2, 9, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = PyImport_ImportModule("numpy"); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 199, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  __pyx_ptype_5numpy_dtype = __Pyx_ImportType(__pyx_t_1, "numpy", "dtype", sizeof(PyArray_Descr), __Pyx_ImportType_CheckSize_Ignore);
-   if (!__pyx_ptype_5numpy_dtype) __PYX_ERR(1, 199, __pyx_L1_error)
-  __pyx_ptype_5numpy_flatiter = __Pyx_ImportType(__pyx_t_1, "numpy", "flatiter", sizeof(PyArrayIterObject), __Pyx_ImportType_CheckSize_Ignore);
-   if (!__pyx_ptype_5numpy_flatiter) __PYX_ERR(1, 222, __pyx_L1_error)
-  __pyx_ptype_5numpy_broadcast = __Pyx_ImportType(__pyx_t_1, "numpy", "broadcast", sizeof(PyArrayMultiIterObject), __Pyx_ImportType_CheckSize_Ignore);
-   if (!__pyx_ptype_5numpy_broadcast) __PYX_ERR(1, 226, __pyx_L1_error)
-  __pyx_ptype_5numpy_ndarray = __Pyx_ImportType(__pyx_t_1, "numpy", "ndarray", sizeof(PyArrayObject), __Pyx_ImportType_CheckSize_Ignore);
-   if (!__pyx_ptype_5numpy_ndarray) __PYX_ERR(1, 238, __pyx_L1_error)
-  __pyx_ptype_5numpy_ufunc = __Pyx_ImportType(__pyx_t_1, "numpy", "ufunc", sizeof(PyUFuncObject), __Pyx_ImportType_CheckSize_Ignore);
-   if (!__pyx_ptype_5numpy_ufunc) __PYX_ERR(1, 764, __pyx_L1_error)
+  __Pyx_ImportType_CheckSize_Warn_3_0_0); if (!__pyx_ptype_7cpython_4type_type) __PYX_ERR(1, 9, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_RefNannyFinishContext();
   return 0;
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
   __Pyx_RefNannyFinishContext();
   return -1;
@@ -7647,14 +5248,63 @@
   __Pyx_RefNannySetupContext("__Pyx_modinit_function_import_code", 0);
   /*--- Function import code ---*/
   __Pyx_RefNannyFinishContext();
   return 0;
 }
 
 
+#if PY_MAJOR_VERSION >= 3
+#if CYTHON_PEP489_MULTI_PHASE_INIT
+static PyObject* __pyx_pymod_create(PyObject *spec, PyModuleDef *def); /*proto*/
+static int __pyx_pymod_exec_skynet_py_mq(PyObject* module); /*proto*/
+static PyModuleDef_Slot __pyx_moduledef_slots[] = {
+  {Py_mod_create, (void*)__pyx_pymod_create},
+  {Py_mod_exec, (void*)__pyx_pymod_exec_skynet_py_mq},
+  {0, NULL}
+};
+#endif
+
+#ifdef __cplusplus
+namespace {
+  struct PyModuleDef __pyx_moduledef =
+  #else
+  static struct PyModuleDef __pyx_moduledef =
+  #endif
+  {
+      PyModuleDef_HEAD_INIT,
+      "skynet_py_mq",
+      0, /* m_doc */
+    #if CYTHON_PEP489_MULTI_PHASE_INIT
+      0, /* m_size */
+    #elif CYTHON_USE_MODULE_STATE
+      sizeof(__pyx_mstate), /* m_size */
+    #else
+      -1, /* m_size */
+    #endif
+      __pyx_methods /* m_methods */,
+    #if CYTHON_PEP489_MULTI_PHASE_INIT
+      __pyx_moduledef_slots, /* m_slots */
+    #else
+      NULL, /* m_reload */
+    #endif
+    #if CYTHON_USE_MODULE_STATE
+      __pyx_m_traverse, /* m_traverse */
+      __pyx_m_clear, /* m_clear */
+      NULL /* m_free */
+    #else
+      NULL, /* m_traverse */
+      NULL, /* m_clear */
+      NULL /* m_free */
+    #endif
+  };
+  #ifdef __cplusplus
+} /* anonymous namespace */
+#endif
+#endif
+
 #ifndef CYTHON_NO_PYINIT_EXPORT
 #define __Pyx_PyMODINIT_FUNC PyMODINIT_FUNC
 #elif PY_MAJOR_VERSION < 3
 #ifdef __cplusplus
 #define __Pyx_PyMODINIT_FUNC extern "C" void
 #else
 #define __Pyx_PyMODINIT_FUNC void
@@ -7665,19 +5315,19 @@
 #else
 #define __Pyx_PyMODINIT_FUNC PyObject *
 #endif
 #endif
 
 
 #if PY_MAJOR_VERSION < 3
-__Pyx_PyMODINIT_FUNC initskynet_py_foreign_seri(void) CYTHON_SMALL_CODE; /*proto*/
-__Pyx_PyMODINIT_FUNC initskynet_py_foreign_seri(void)
+__Pyx_PyMODINIT_FUNC initskynet_py_mq(void) CYTHON_SMALL_CODE; /*proto*/
+__Pyx_PyMODINIT_FUNC initskynet_py_mq(void)
 #else
-__Pyx_PyMODINIT_FUNC PyInit_skynet_py_foreign_seri(void) CYTHON_SMALL_CODE; /*proto*/
-__Pyx_PyMODINIT_FUNC PyInit_skynet_py_foreign_seri(void)
+__Pyx_PyMODINIT_FUNC PyInit_skynet_py_mq(void) CYTHON_SMALL_CODE; /*proto*/
+__Pyx_PyMODINIT_FUNC PyInit_skynet_py_mq(void)
 #if CYTHON_PEP489_MULTI_PHASE_INIT
 {
   return PyModuleDef_Init(&__pyx_moduledef);
 }
 static CYTHON_SMALL_CODE int __Pyx_check_single_interpreter(void) {
     #if PY_VERSION_HEX >= 0x030700A1
     static PY_INT64_T main_interpreter_id = -1;
@@ -7697,324 +5347,601 @@
         PyErr_SetString(
             PyExc_ImportError,
             "Interpreter change detected - this module can only be loaded into one interpreter per process.");
         return -1;
     }
     return 0;
 }
-static CYTHON_SMALL_CODE int __Pyx_copy_spec_to_module(PyObject *spec, PyObject *moddict, const char* from_name, const char* to_name, int allow_none) {
+#if CYTHON_COMPILING_IN_LIMITED_API
+static CYTHON_SMALL_CODE int __Pyx_copy_spec_to_module(PyObject *spec, PyObject *module, const char* from_name, const char* to_name, int allow_none)
+#else
+static CYTHON_SMALL_CODE int __Pyx_copy_spec_to_module(PyObject *spec, PyObject *moddict, const char* from_name, const char* to_name, int allow_none)
+#endif
+{
     PyObject *value = PyObject_GetAttrString(spec, from_name);
     int result = 0;
     if (likely(value)) {
         if (allow_none || value != Py_None) {
+#if CYTHON_COMPILING_IN_LIMITED_API
+            result = PyModule_AddObject(module, to_name, value);
+#else
             result = PyDict_SetItemString(moddict, to_name, value);
+#endif
         }
         Py_DECREF(value);
     } else if (PyErr_ExceptionMatches(PyExc_AttributeError)) {
         PyErr_Clear();
     } else {
         result = -1;
     }
     return result;
 }
-static CYTHON_SMALL_CODE PyObject* __pyx_pymod_create(PyObject *spec, CYTHON_UNUSED PyModuleDef *def) {
+static CYTHON_SMALL_CODE PyObject* __pyx_pymod_create(PyObject *spec, PyModuleDef *def) {
     PyObject *module = NULL, *moddict, *modname;
+    CYTHON_UNUSED_VAR(def);
     if (__Pyx_check_single_interpreter())
         return NULL;
     if (__pyx_m)
         return __Pyx_NewRef(__pyx_m);
     modname = PyObject_GetAttrString(spec, "name");
     if (unlikely(!modname)) goto bad;
     module = PyModule_NewObject(modname);
     Py_DECREF(modname);
     if (unlikely(!module)) goto bad;
+#if CYTHON_COMPILING_IN_LIMITED_API
+    moddict = module;
+#else
     moddict = PyModule_GetDict(module);
     if (unlikely(!moddict)) goto bad;
+#endif
     if (unlikely(__Pyx_copy_spec_to_module(spec, moddict, "loader", "__loader__", 1) < 0)) goto bad;
     if (unlikely(__Pyx_copy_spec_to_module(spec, moddict, "origin", "__file__", 1) < 0)) goto bad;
     if (unlikely(__Pyx_copy_spec_to_module(spec, moddict, "parent", "__package__", 1) < 0)) goto bad;
     if (unlikely(__Pyx_copy_spec_to_module(spec, moddict, "submodule_search_locations", "__path__", 0) < 0)) goto bad;
     return module;
 bad:
     Py_XDECREF(module);
     return NULL;
 }
 
 
-static CYTHON_SMALL_CODE int __pyx_pymod_exec_skynet_py_foreign_seri(PyObject *__pyx_pyinit_module)
+static CYTHON_SMALL_CODE int __pyx_pymod_exec_skynet_py_mq(PyObject *__pyx_pyinit_module)
 #endif
 #endif
 {
+  int stringtab_initialized = 0;
+  #if CYTHON_USE_MODULE_STATE
+  int pystate_addmodule_run = 0;
+  #endif
   PyObject *__pyx_t_1 = NULL;
-  int __pyx_t_2;
+  PyObject *__pyx_t_2 = NULL;
+  PyObject *__pyx_t_3 = NULL;
+  PyObject *__pyx_t_4 = NULL;
+  PyObject *__pyx_t_5 = NULL;
+  Py_ssize_t __pyx_t_6;
+  Py_ssize_t __pyx_t_7;
+  int __pyx_t_8;
+  int __pyx_t_9;
+  PyObject *__pyx_t_10 = NULL;
+  PyObject *__pyx_t_11 = NULL;
+  PyObject *__pyx_t_12 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannyDeclarations
   #if CYTHON_PEP489_MULTI_PHASE_INIT
   if (__pyx_m) {
     if (__pyx_m == __pyx_pyinit_module) return 0;
-    PyErr_SetString(PyExc_RuntimeError, "Module 'skynet_py_foreign_seri' has already been imported. Re-initialisation is not supported.");
+    PyErr_SetString(PyExc_RuntimeError, "Module 'skynet_py_mq' has already been imported. Re-initialisation is not supported.");
     return -1;
   }
   #elif PY_MAJOR_VERSION >= 3
   if (__pyx_m) return __Pyx_NewRef(__pyx_m);
   #endif
+  /*--- Module creation code ---*/
+  #if CYTHON_PEP489_MULTI_PHASE_INIT
+  __pyx_m = __pyx_pyinit_module;
+  Py_INCREF(__pyx_m);
+  #else
+  #if PY_MAJOR_VERSION < 3
+  __pyx_m = Py_InitModule4("skynet_py_mq", __pyx_methods, 0, 0, PYTHON_API_VERSION); Py_XINCREF(__pyx_m);
+  if (unlikely(!__pyx_m)) __PYX_ERR(0, 1, __pyx_L1_error)
+  #elif CYTHON_USE_MODULE_STATE
+  __pyx_t_1 = PyModule_Create(&__pyx_moduledef); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1, __pyx_L1_error)
+  {
+    int add_module_result = PyState_AddModule(__pyx_t_1, &__pyx_moduledef);
+    __pyx_t_1 = 0; /* transfer ownership from __pyx_t_1 to skynet_py_mq pseudovariable */
+    if (unlikely((add_module_result < 0))) __PYX_ERR(0, 1, __pyx_L1_error)
+    pystate_addmodule_run = 1;
+  }
+  #else
+  __pyx_m = PyModule_Create(&__pyx_moduledef);
+  if (unlikely(!__pyx_m)) __PYX_ERR(0, 1, __pyx_L1_error)
+  #endif
+  #endif
+  CYTHON_UNUSED_VAR(__pyx_t_1);
+  __pyx_d = PyModule_GetDict(__pyx_m); if (unlikely(!__pyx_d)) __PYX_ERR(0, 1, __pyx_L1_error)
+  Py_INCREF(__pyx_d);
+  __pyx_b = PyImport_AddModule(__Pyx_BUILTIN_MODULE_NAME); if (unlikely(!__pyx_b)) __PYX_ERR(0, 1, __pyx_L1_error)
+  Py_INCREF(__pyx_b);
+  __pyx_cython_runtime = PyImport_AddModule((char *) "cython_runtime"); if (unlikely(!__pyx_cython_runtime)) __PYX_ERR(0, 1, __pyx_L1_error)
+  Py_INCREF(__pyx_cython_runtime);
+  if (PyObject_SetAttrString(__pyx_m, "__builtins__", __pyx_b) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   #if CYTHON_REFNANNY
 __Pyx_RefNanny = __Pyx_RefNannyImportAPI("refnanny");
 if (!__Pyx_RefNanny) {
   PyErr_Clear();
   __Pyx_RefNanny = __Pyx_RefNannyImportAPI("Cython.Runtime.refnanny");
   if (!__Pyx_RefNanny)
       Py_FatalError("failed to import 'refnanny' module");
 }
 #endif
-  __Pyx_RefNannySetupContext("__Pyx_PyMODINIT_FUNC PyInit_skynet_py_foreign_seri(void)", 0);
+  __Pyx_RefNannySetupContext("__Pyx_PyMODINIT_FUNC PyInit_skynet_py_mq(void)", 0);
   if (__Pyx_check_binary_version() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   #ifdef __Pxy_PyFrame_Initialize_Offsets
   __Pxy_PyFrame_Initialize_Offsets();
   #endif
   __pyx_empty_tuple = PyTuple_New(0); if (unlikely(!__pyx_empty_tuple)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_empty_bytes = PyBytes_FromStringAndSize("", 0); if (unlikely(!__pyx_empty_bytes)) __PYX_ERR(0, 1, __pyx_L1_error)
   __pyx_empty_unicode = PyUnicode_FromStringAndSize("", 0); if (unlikely(!__pyx_empty_unicode)) __PYX_ERR(0, 1, __pyx_L1_error)
   #ifdef __Pyx_CyFunction_USED
-  if (__pyx_CyFunction_init() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
+  if (__pyx_CyFunction_init(__pyx_m) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   #endif
   #ifdef __Pyx_FusedFunction_USED
-  if (__pyx_FusedFunction_init() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
+  if (__pyx_FusedFunction_init(__pyx_m) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   #endif
   #ifdef __Pyx_Coroutine_USED
-  if (__pyx_Coroutine_init() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
+  if (__pyx_Coroutine_init(__pyx_m) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   #endif
   #ifdef __Pyx_Generator_USED
-  if (__pyx_Generator_init() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
+  if (__pyx_Generator_init(__pyx_m) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   #endif
   #ifdef __Pyx_AsyncGen_USED
-  if (__pyx_AsyncGen_init() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
+  if (__pyx_AsyncGen_init(__pyx_m) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   #endif
   #ifdef __Pyx_StopAsyncIteration_USED
-  if (__pyx_StopAsyncIteration_init() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
+  if (__pyx_StopAsyncIteration_init(__pyx_m) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   #endif
   /*--- Library function declarations ---*/
   /*--- Threads initialization code ---*/
-  #if defined(__PYX_FORCE_INIT_THREADS) && __PYX_FORCE_INIT_THREADS
-  #ifdef WITH_THREAD /* Python build with threading support? */
+  #if defined(WITH_THREAD) && PY_VERSION_HEX < 0x030700F0 && defined(__PYX_FORCE_INIT_THREADS) && __PYX_FORCE_INIT_THREADS
   PyEval_InitThreads();
   #endif
-  #endif
-  /*--- Module creation code ---*/
-  #if CYTHON_PEP489_MULTI_PHASE_INIT
-  __pyx_m = __pyx_pyinit_module;
-  Py_INCREF(__pyx_m);
-  #else
-  #if PY_MAJOR_VERSION < 3
-  __pyx_m = Py_InitModule4("skynet_py_foreign_seri", __pyx_methods, 0, 0, PYTHON_API_VERSION); Py_XINCREF(__pyx_m);
-  #else
-  __pyx_m = PyModule_Create(&__pyx_moduledef);
-  #endif
-  if (unlikely(!__pyx_m)) __PYX_ERR(0, 1, __pyx_L1_error)
-  #endif
-  __pyx_d = PyModule_GetDict(__pyx_m); if (unlikely(!__pyx_d)) __PYX_ERR(0, 1, __pyx_L1_error)
-  Py_INCREF(__pyx_d);
-  __pyx_b = PyImport_AddModule(__Pyx_BUILTIN_MODULE_NAME); if (unlikely(!__pyx_b)) __PYX_ERR(0, 1, __pyx_L1_error)
-  Py_INCREF(__pyx_b);
-  __pyx_cython_runtime = PyImport_AddModule((char *) "cython_runtime"); if (unlikely(!__pyx_cython_runtime)) __PYX_ERR(0, 1, __pyx_L1_error)
-  Py_INCREF(__pyx_cython_runtime);
-  if (PyObject_SetAttrString(__pyx_m, "__builtins__", __pyx_b) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
   /*--- Initialize various global constants etc. ---*/
+  if (__Pyx_InitConstants() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
+  stringtab_initialized = 1;
   if (__Pyx_InitGlobals() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   #if PY_MAJOR_VERSION < 3 && (__PYX_DEFAULT_STRING_ENCODING_IS_ASCII || __PYX_DEFAULT_STRING_ENCODING_IS_DEFAULT)
   if (__Pyx_init_sys_getdefaultencoding_params() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   #endif
-  if (__pyx_module_is_main_pyskynet__skynet_py_foreign_seri) {
-    if (PyObject_SetAttr(__pyx_m, __pyx_n_s_name, __pyx_n_s_main) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
+  if (__pyx_module_is_main_pyskynet__skynet_py_mq) {
+    if (PyObject_SetAttr(__pyx_m, __pyx_n_s_name_2, __pyx_n_s_main) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   }
   #if PY_MAJOR_VERSION >= 3
   {
     PyObject *modules = PyImport_GetModuleDict(); if (unlikely(!modules)) __PYX_ERR(0, 1, __pyx_L1_error)
-    if (!PyDict_GetItemString(modules, "pyskynet.skynet_py_foreign_seri")) {
-      if (unlikely(PyDict_SetItemString(modules, "pyskynet.skynet_py_foreign_seri", __pyx_m) < 0)) __PYX_ERR(0, 1, __pyx_L1_error)
+    if (!PyDict_GetItemString(modules, "pyskynet.skynet_py_mq")) {
+      if (unlikely((PyDict_SetItemString(modules, "pyskynet.skynet_py_mq", __pyx_m) < 0))) __PYX_ERR(0, 1, __pyx_L1_error)
     }
   }
   #endif
   /*--- Builtin init code ---*/
   if (__Pyx_InitCachedBuiltins() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   /*--- Constants init code ---*/
   if (__Pyx_InitCachedConstants() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   /*--- Global type/function init code ---*/
   (void)__Pyx_modinit_global_init_code();
   (void)__Pyx_modinit_variable_export_code();
   (void)__Pyx_modinit_function_export_code();
   (void)__Pyx_modinit_type_init_code();
-  if (unlikely(__Pyx_modinit_type_import_code() < 0)) __PYX_ERR(0, 1, __pyx_L1_error)
+  if (unlikely((__Pyx_modinit_type_import_code() < 0))) __PYX_ERR(0, 1, __pyx_L1_error)
   (void)__Pyx_modinit_variable_import_code();
   (void)__Pyx_modinit_function_import_code();
   /*--- Execution code ---*/
   #if defined(__Pyx_Generator_USED) || defined(__Pyx_Coroutine_USED)
   if (__Pyx_patch_abc() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   #endif
 
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":13
- * from cpython.bytearray cimport PyByteArray_AS_STRING
- * from numpy cimport PyArray_CheckExact
- * import numpy as np             # <<<<<<<<<<<<<<
- * cimport numpy as cnp
- * cnp.import_array()
+  /* "src/cy_src/skynet_py_mq.pyx":18
+ *     skynet_free(ptr)
+ * 
+ * def crecv():             # <<<<<<<<<<<<<<
+ *     cdef SkynetPyMessage msg
+ *     cdef int ret = skynet_py_queue_pop(&msg)
  */
-  __pyx_t_1 = __Pyx_Import(__pyx_n_s_numpy, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 13, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_np, __pyx_t_1) < 0) __PYX_ERR(0, 13, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_8pyskynet_12skynet_py_mq_1crecv, 0, __pyx_n_s_crecv, NULL, __pyx_n_s_pyskynet_skynet_py_mq, __pyx_d, ((PyObject *)__pyx_codeobj__5)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 18, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_crecv, __pyx_t_2) < 0) __PYX_ERR(0, 18, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":15
- * import numpy as np
- * cimport numpy as cnp
- * cnp.import_array()             # <<<<<<<<<<<<<<
+  /* "src/cy_src/skynet_py_mq.pyx":34
  * 
- * from skynet_py cimport *
+ * # see lsend in lua-skynet.c
+ * def csend(py_dst, int type_id, py_session, py_msg, py_size=None):             # <<<<<<<<<<<<<<
+ *     assert skynet_py_address() > 0, "skynet threads has not been started yet, call 'pyskynet.start()' first."
+ *     # 1. check dst
  */
-  __pyx_t_2 = __pyx_f_5numpy_import_array(); if (unlikely(__pyx_t_2 == ((int)-1))) __PYX_ERR(0, 15, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_8pyskynet_12skynet_py_mq_3csend, 0, __pyx_n_s_csend, NULL, __pyx_n_s_pyskynet_skynet_py_mq, __pyx_d, ((PyObject *)__pyx_codeobj__7)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 34, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_2, __pyx_tuple__8);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_csend, __pyx_t_2) < 0) __PYX_ERR(0, 34, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+
+  /* "src/cy_src/skynet_py_mq.pyx":84
+ * 
+ * # extern
+ * def tostring(capsule, size_t size):             # <<<<<<<<<<<<<<
+ *     b = tobytes(capsule, size)
+ *     return b.decode()
+ */
+  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_8pyskynet_12skynet_py_mq_5tostring, 0, __pyx_n_s_tostring, NULL, __pyx_n_s_pyskynet_skynet_py_mq, __pyx_d, ((PyObject *)__pyx_codeobj__10)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 84, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_tostring, __pyx_t_2) < 0) __PYX_ERR(0, 84, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":400
- * #########################
+  /* "src/cy_src/skynet_py_mq.pyx":89
  * 
+ * # extern
  * def tobytes(capsule, size_t size):             # <<<<<<<<<<<<<<
- *     cdef char *ptr = <char *>PyCapsule_GetPointer(capsule, PyCapsule_GetName(capsule))
- *     return ptr[:size]
+ *     cdef char *name = PyCapsule_GetName(capsule)
+ *     cdef char *ptr = <char *>PyCapsule_GetPointer(capsule, name)
  */
-  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_8pyskynet_22skynet_py_foreign_seri_1tobytes, NULL, __pyx_n_s_pyskynet_skynet_py_foreign_seri); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 400, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_tobytes, __pyx_t_1) < 0) __PYX_ERR(0, 400, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_8pyskynet_12skynet_py_mq_7tobytes, 0, __pyx_n_s_tobytes, NULL, __pyx_n_s_pyskynet_skynet_py_mq, __pyx_d, ((PyObject *)__pyx_codeobj__12)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 89, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_tobytes, __pyx_t_2) < 0) __PYX_ERR(0, 89, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+
+  /* "src/cy_src/skynet_py_mq.pyx":99
+ *         raise Exception("capsule unpack failed for name = %s")
+ * 
+ * class PTYPEEnum(object):             # <<<<<<<<<<<<<<
+ *     def __init__(self):
+ *         self.PTYPE_TEXT=PTYPE_TEXT
+ */
+  __pyx_t_2 = __Pyx_PEP560_update_bases(__pyx_tuple__14); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 99, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_3 = __Pyx_CalculateMetaclass(NULL, __pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 99, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  __pyx_t_4 = __Pyx_Py3MetaclassPrepare(__pyx_t_3, __pyx_t_2, __pyx_n_s_PTYPEEnum, __pyx_n_s_PTYPEEnum, (PyObject *) NULL, __pyx_n_s_pyskynet_skynet_py_mq, (PyObject *) NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 99, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_4);
+  if (__pyx_t_2 != __pyx_tuple__14) {
+    if (unlikely((PyDict_SetItemString(__pyx_t_4, "__orig_bases__", __pyx_tuple__14) < 0))) __PYX_ERR(0, 99, __pyx_L1_error)
+  }
 
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":404
- *     return ptr[:size]
+  /* "src/cy_src/skynet_py_mq.pyx":100
  * 
- * def luapack(*args):             # <<<<<<<<<<<<<<
- *     return py_foreign_pack(MODE_LUA, args)
+ * class PTYPEEnum(object):
+ *     def __init__(self):             # <<<<<<<<<<<<<<
+ *         self.PTYPE_TEXT=PTYPE_TEXT
+ *         self.PTYPE_RESPONSE=PTYPE_RESPONSE
+ */
+  __pyx_t_5 = __Pyx_CyFunction_New(&__pyx_mdef_8pyskynet_12skynet_py_mq_9PTYPEEnum_1__init__, 0, __pyx_n_s_PTYPEEnum___init, NULL, __pyx_n_s_pyskynet_skynet_py_mq, __pyx_d, ((PyObject *)__pyx_codeobj__16)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 100, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_5);
+  if (__Pyx_SetNameInClass(__pyx_t_4, __pyx_n_s_init, __pyx_t_5) < 0) __PYX_ERR(0, 100, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+
+  /* "src/cy_src/skynet_py_mq.pyx":99
+ *         raise Exception("capsule unpack failed for name = %s")
  * 
+ * class PTYPEEnum(object):             # <<<<<<<<<<<<<<
+ *     def __init__(self):
+ *         self.PTYPE_TEXT=PTYPE_TEXT
  */
-  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_8pyskynet_22skynet_py_foreign_seri_3luapack, NULL, __pyx_n_s_pyskynet_skynet_py_foreign_seri); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 404, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_luapack, __pyx_t_1) < 0) __PYX_ERR(0, 404, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_5 = __Pyx_Py3ClassCreate(__pyx_t_3, __pyx_n_s_PTYPEEnum, __pyx_t_2, __pyx_t_4, NULL, 0, 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 99, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_5);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_PTYPEEnum, __pyx_t_5) < 0) __PYX_ERR(0, 99, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":407
- *     return py_foreign_pack(MODE_LUA, args)
+  /* "src/cy_src/skynet_py_mq.pyx":120
  * 
- * def luaunpack(capsule, size=None):             # <<<<<<<<<<<<<<
- *     return py_foreign_unpack(MODE_LUA, capsule, size)
  * 
+ * SKYNET_PTYPE_id_to_name = {}             # <<<<<<<<<<<<<<
+ * SKYNET_PTYPE_name_to_id = {}
+ * SKYNET_PTYPE = PTYPEEnum()
  */
-  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_8pyskynet_22skynet_py_foreign_seri_5luaunpack, NULL, __pyx_n_s_pyskynet_skynet_py_foreign_seri); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 407, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_luaunpack, __pyx_t_1) < 0) __PYX_ERR(0, 407, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 120, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_SKYNET_PTYPE_id_to_name, __pyx_t_2) < 0) __PYX_ERR(0, 120, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":410
- *     return py_foreign_unpack(MODE_LUA, capsule, size)
+  /* "src/cy_src/skynet_py_mq.pyx":121
  * 
- * def pack(*args):             # <<<<<<<<<<<<<<
- *     return py_foreign_pack(MODE_FOREIGN, args)
+ * SKYNET_PTYPE_id_to_name = {}
+ * SKYNET_PTYPE_name_to_id = {}             # <<<<<<<<<<<<<<
+ * SKYNET_PTYPE = PTYPEEnum()
  * 
  */
-  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_8pyskynet_22skynet_py_foreign_seri_7pack, NULL, __pyx_n_s_pyskynet_skynet_py_foreign_seri); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 410, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_pack, __pyx_t_1) < 0) __PYX_ERR(0, 410, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_2 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 121, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_SKYNET_PTYPE_name_to_id, __pyx_t_2) < 0) __PYX_ERR(0, 121, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":413
- *     return py_foreign_pack(MODE_FOREIGN, args)
+  /* "src/cy_src/skynet_py_mq.pyx":122
+ * SKYNET_PTYPE_id_to_name = {}
+ * SKYNET_PTYPE_name_to_id = {}
+ * SKYNET_PTYPE = PTYPEEnum()             # <<<<<<<<<<<<<<
  * 
- * def unpack(capsule, size=None):             # <<<<<<<<<<<<<<
- *     return py_foreign_unpack(MODE_FOREIGN, capsule, size)
+ * for key, id in SKYNET_PTYPE.__dict__.items():
+ */
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_PTYPEEnum); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 122, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_3 = __Pyx_PyObject_CallNoArg(__pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 122, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_SKYNET_PTYPE, __pyx_t_3) < 0) __PYX_ERR(0, 122, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+
+  /* "src/cy_src/skynet_py_mq.pyx":124
+ * SKYNET_PTYPE = PTYPEEnum()
  * 
+ * for key, id in SKYNET_PTYPE.__dict__.items():             # <<<<<<<<<<<<<<
+ *     name = key[6:].lower()
+ *     SKYNET_PTYPE_id_to_name[id] = name
  */
-  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_8pyskynet_22skynet_py_foreign_seri_9unpack, NULL, __pyx_n_s_pyskynet_skynet_py_foreign_seri); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 413, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_unpack, __pyx_t_1) < 0) __PYX_ERR(0, 413, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_6 = 0;
+  __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_SKYNET_PTYPE); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 124, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_dict); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 124, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_4);
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  if (unlikely(__pyx_t_4 == Py_None)) {
+    PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "items");
+    __PYX_ERR(0, 124, __pyx_L1_error)
+  }
+  __pyx_t_2 = __Pyx_dict_iterator(__pyx_t_4, 0, __pyx_n_s_items, (&__pyx_t_7), (&__pyx_t_8)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 124, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+  __Pyx_XDECREF(__pyx_t_3);
+  __pyx_t_3 = __pyx_t_2;
+  __pyx_t_2 = 0;
+  while (1) {
+    __pyx_t_9 = __Pyx_dict_iter_next(__pyx_t_3, __pyx_t_7, &__pyx_t_6, &__pyx_t_2, &__pyx_t_4, NULL, __pyx_t_8);
+    if (unlikely(__pyx_t_9 == 0)) break;
+    if (unlikely(__pyx_t_9 == -1)) __PYX_ERR(0, 124, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_2);
+    __Pyx_GOTREF(__pyx_t_4);
+    if (PyDict_SetItem(__pyx_d, __pyx_n_s_key, __pyx_t_2) < 0) __PYX_ERR(0, 124, __pyx_L1_error)
+    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+    if (PyDict_SetItem(__pyx_d, __pyx_n_s_id, __pyx_t_4) < 0) __PYX_ERR(0, 124, __pyx_L1_error)
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":416
- *     return py_foreign_unpack(MODE_FOREIGN, capsule, size)
+    /* "src/cy_src/skynet_py_mq.pyx":125
  * 
- * def remotepack(*args):             # <<<<<<<<<<<<<<
- *     return py_foreign_pack(MODE_FOREIGN_REMOTE, args)
+ * for key, id in SKYNET_PTYPE.__dict__.items():
+ *     name = key[6:].lower()             # <<<<<<<<<<<<<<
+ *     SKYNET_PTYPE_id_to_name[id] = name
+ *     SKYNET_PTYPE_name_to_id[name] = id
+ */
+    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_key); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 125, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_2);
+    __pyx_t_5 = __Pyx_PyObject_GetSlice(__pyx_t_2, 6, 0, NULL, NULL, &__pyx_slice__17, 1, 0, 1); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 125, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_5);
+    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+    __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_lower); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 125, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_2);
+    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+    __pyx_t_5 = NULL;
+    __pyx_t_9 = 0;
+    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
+      __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_2);
+      if (likely(__pyx_t_5)) {
+        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
+        __Pyx_INCREF(__pyx_t_5);
+        __Pyx_INCREF(function);
+        __Pyx_DECREF_SET(__pyx_t_2, function);
+        __pyx_t_9 = 1;
+      }
+    }
+    {
+      PyObject *__pyx_callargs[1] = {__pyx_t_5, };
+      __pyx_t_4 = __Pyx_PyObject_FastCall(__pyx_t_2, __pyx_callargs+1-__pyx_t_9, 0+__pyx_t_9);
+      __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
+      if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 125, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_4);
+      __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+    }
+    if (PyDict_SetItem(__pyx_d, __pyx_n_s_name, __pyx_t_4) < 0) __PYX_ERR(0, 125, __pyx_L1_error)
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+
+    /* "src/cy_src/skynet_py_mq.pyx":126
+ * for key, id in SKYNET_PTYPE.__dict__.items():
+ *     name = key[6:].lower()
+ *     SKYNET_PTYPE_id_to_name[id] = name             # <<<<<<<<<<<<<<
+ *     SKYNET_PTYPE_name_to_id[name] = id
+ *     locals()[key] = id
+ */
+    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_name); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 126, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_SKYNET_PTYPE_id_to_name); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 126, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_2);
+    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_id); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 126, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_5);
+    if (unlikely((PyObject_SetItem(__pyx_t_2, __pyx_t_5, __pyx_t_4) < 0))) __PYX_ERR(0, 126, __pyx_L1_error)
+    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+
+    /* "src/cy_src/skynet_py_mq.pyx":127
+ *     name = key[6:].lower()
+ *     SKYNET_PTYPE_id_to_name[id] = name
+ *     SKYNET_PTYPE_name_to_id[name] = id             # <<<<<<<<<<<<<<
+ *     locals()[key] = id
  * 
  */
-  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_8pyskynet_22skynet_py_foreign_seri_11remotepack, NULL, __pyx_n_s_pyskynet_skynet_py_foreign_seri); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 416, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_remotepack, __pyx_t_1) < 0) __PYX_ERR(0, 416, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_id); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 127, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_SKYNET_PTYPE_name_to_id); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 127, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_5);
+    __Pyx_GetModuleGlobalName(__pyx_t_2, __pyx_n_s_name); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 127, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_2);
+    if (unlikely((PyObject_SetItem(__pyx_t_5, __pyx_t_2, __pyx_t_4) < 0))) __PYX_ERR(0, 127, __pyx_L1_error)
+    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":419
- *     return py_foreign_pack(MODE_FOREIGN_REMOTE, args)
+    /* "src/cy_src/skynet_py_mq.pyx":128
+ *     SKYNET_PTYPE_id_to_name[id] = name
+ *     SKYNET_PTYPE_name_to_id[name] = id
+ *     locals()[key] = id             # <<<<<<<<<<<<<<
  * 
- * def remoteunpack(capsule, size=None):             # <<<<<<<<<<<<<<
- *     return py_foreign_unpack(MODE_FOREIGN_REMOTE, capsule, size)
  * 
  */
-  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_8pyskynet_22skynet_py_foreign_seri_13remoteunpack, NULL, __pyx_n_s_pyskynet_skynet_py_foreign_seri); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 419, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_remoteunpack, __pyx_t_1) < 0) __PYX_ERR(0, 419, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+    __Pyx_GetModuleGlobalName(__pyx_t_4, __pyx_n_s_id); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 128, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __pyx_t_2 = __Pyx_Globals(); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 128, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_2);
+    __Pyx_GetModuleGlobalName(__pyx_t_5, __pyx_n_s_key); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 128, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_5);
+    if (unlikely((PyDict_SetItem(__pyx_t_2, __pyx_t_5, __pyx_t_4) < 0))) __PYX_ERR(0, 128, __pyx_L1_error)
+    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+    __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+  }
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":422
- *     return py_foreign_unpack(MODE_FOREIGN_REMOTE, capsule, size)
+  /* "src/cy_src/skynet_py_mq.pyx":131
  * 
- * def trash(capsule, size_t sz):             # <<<<<<<<<<<<<<
- *     cdef void *ptr = PyCapsule_GetPointer(capsule, "cptr")
- *     skynet_free(ptr)
+ * 
+ * SKYNET_PTYPE_user_builtin_ids = [SKYNET_PTYPE.PTYPE_LUA, SKYNET_PTYPE.PTYPE_CLIENT, SKYNET_PTYPE.PTYPE_SOCKET, SKYNET_PTYPE.PTYPE_TEXT, SKYNET_PTYPE.PTYPE_FOREIGN, SKYNET_PTYPE.PTYPE_FOREIGN_REMOTE]             # <<<<<<<<<<<<<<
+ * def user_assert_id_name(id, name):
+ *     is_builtin = False
  */
-  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_8pyskynet_22skynet_py_foreign_seri_15trash, NULL, __pyx_n_s_pyskynet_skynet_py_foreign_seri); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 422, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_trash, __pyx_t_1) < 0) __PYX_ERR(0, 422, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_SKYNET_PTYPE); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 131, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_PTYPE_LUA); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 131, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_4);
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_SKYNET_PTYPE); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 131, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_PTYPE_CLIENT); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 131, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_5);
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_SKYNET_PTYPE); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 131, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_PTYPE_SOCKET); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 131, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_SKYNET_PTYPE); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 131, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  __pyx_t_10 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_PTYPE_TEXT); if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 131, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_10);
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_SKYNET_PTYPE); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 131, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  __pyx_t_11 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_PTYPE_FOREIGN); if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 131, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_11);
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __Pyx_GetModuleGlobalName(__pyx_t_3, __pyx_n_s_SKYNET_PTYPE); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 131, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  __pyx_t_12 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_PTYPE_FOREIGN_REMOTE); if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 131, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_12);
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+  __pyx_t_3 = PyList_New(6); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 131, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  __Pyx_GIVEREF(__pyx_t_4);
+  PyList_SET_ITEM(__pyx_t_3, 0, __pyx_t_4);
+  __Pyx_GIVEREF(__pyx_t_5);
+  PyList_SET_ITEM(__pyx_t_3, 1, __pyx_t_5);
+  __Pyx_GIVEREF(__pyx_t_2);
+  PyList_SET_ITEM(__pyx_t_3, 2, __pyx_t_2);
+  __Pyx_GIVEREF(__pyx_t_10);
+  PyList_SET_ITEM(__pyx_t_3, 3, __pyx_t_10);
+  __Pyx_GIVEREF(__pyx_t_11);
+  PyList_SET_ITEM(__pyx_t_3, 4, __pyx_t_11);
+  __Pyx_GIVEREF(__pyx_t_12);
+  PyList_SET_ITEM(__pyx_t_3, 5, __pyx_t_12);
+  __pyx_t_4 = 0;
+  __pyx_t_5 = 0;
+  __pyx_t_2 = 0;
+  __pyx_t_10 = 0;
+  __pyx_t_11 = 0;
+  __pyx_t_12 = 0;
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_SKYNET_PTYPE_user_builtin_ids, __pyx_t_3) < 0) __PYX_ERR(0, 131, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "src/cy_src/skynet_py_foreign_seri.pyx":1
- * # cython: language_level=3             # <<<<<<<<<<<<<<
+  /* "src/cy_src/skynet_py_mq.pyx":132
  * 
- * from libc.string cimport memcpy, strcmp
+ * SKYNET_PTYPE_user_builtin_ids = [SKYNET_PTYPE.PTYPE_LUA, SKYNET_PTYPE.PTYPE_CLIENT, SKYNET_PTYPE.PTYPE_SOCKET, SKYNET_PTYPE.PTYPE_TEXT, SKYNET_PTYPE.PTYPE_FOREIGN, SKYNET_PTYPE.PTYPE_FOREIGN_REMOTE]
+ * def user_assert_id_name(id, name):             # <<<<<<<<<<<<<<
+ *     is_builtin = False
+ *     if name in SKYNET_PTYPE_name_to_id:
  */
-  __pyx_t_1 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_test, __pyx_t_1) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+  __pyx_t_3 = __Pyx_CyFunction_New(&__pyx_mdef_8pyskynet_12skynet_py_mq_9user_assert_id_name, 0, __pyx_n_s_user_assert_id_name, NULL, __pyx_n_s_pyskynet_skynet_py_mq, __pyx_d, ((PyObject *)__pyx_codeobj__19)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 132, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_user_assert_id_name, __pyx_t_3) < 0) __PYX_ERR(0, 132, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "../../pyenv/lib/python3.6/site-packages/numpy/__init__.pxd":892
- *         raise ImportError("numpy.core.umath failed to import")
+  /* "src/cy_src/skynet_py_mq.pyx":1
+ * # cython: language_level=3             # <<<<<<<<<<<<<<
+ * # cython: legacy_implicit_noexcept=True
  * 
- * cdef inline int import_ufunc() except -1:             # <<<<<<<<<<<<<<
- *     try:
- *         _import_umath()
  */
+  __pyx_t_3 = __Pyx_PyDict_NewPresized(0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_3);
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_test, __pyx_t_3) < 0) __PYX_ERR(0, 1, __pyx_L1_error)
+  __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
   /*--- Wrapped vars code ---*/
 
   goto __pyx_L0;
   __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_1);
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_XDECREF(__pyx_t_3);
+  __Pyx_XDECREF(__pyx_t_4);
+  __Pyx_XDECREF(__pyx_t_5);
+  __Pyx_XDECREF(__pyx_t_10);
+  __Pyx_XDECREF(__pyx_t_11);
+  __Pyx_XDECREF(__pyx_t_12);
   if (__pyx_m) {
-    if (__pyx_d) {
-      __Pyx_AddTraceback("init pyskynet.skynet_py_foreign_seri", __pyx_clineno, __pyx_lineno, __pyx_filename);
+    if (__pyx_d && stringtab_initialized) {
+      __Pyx_AddTraceback("init pyskynet.skynet_py_mq", __pyx_clineno, __pyx_lineno, __pyx_filename);
     }
+    #if !CYTHON_USE_MODULE_STATE
     Py_CLEAR(__pyx_m);
+    #else
+    Py_DECREF(__pyx_m);
+    if (pystate_addmodule_run) {
+      PyObject *tp, *value, *tb;
+      PyErr_Fetch(&tp, &value, &tb);
+      PyState_RemoveModule(&__pyx_moduledef);
+      PyErr_Restore(tp, value, tb);
+    }
+    #endif
   } else if (!PyErr_Occurred()) {
-    PyErr_SetString(PyExc_ImportError, "init pyskynet.skynet_py_foreign_seri");
+    PyErr_SetString(PyExc_ImportError, "init pyskynet.skynet_py_mq");
   }
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   #if CYTHON_PEP489_MULTI_PHASE_INIT
   return (__pyx_m != NULL) ? 0 : -1;
   #elif PY_MAJOR_VERSION >= 3
   return __pyx_m;
   #else
   return;
   #endif
 }
+/* #### Code section: cleanup_globals ### */
+/* #### Code section: cleanup_module ### */
+/* #### Code section: main_method ### */
+/* #### Code section: utility_code_pragmas ### */
+#ifdef _MSC_VER
+#pragma warning( push )
+/* Warning 4127: conditional expression is constant
+ * Cython uses constant conditional expressions to allow in inline functions to be optimized at
+ * compile-time, so this warning is not useful
+ */
+#pragma warning( disable : 4127 )
+#endif
+
+
+
+/* #### Code section: utility_code_def ### */
 
 /* --- Runtime support code --- */
 /* Refnanny */
 #if CYTHON_REFNANNY
 static __Pyx_RefNannyAPIStruct *__Pyx_RefNannyImportAPI(const char *modname) {
     PyObject *m = NULL, *p = NULL;
     void *r = NULL;
@@ -8026,91 +5953,576 @@
 end:
     Py_XDECREF(p);
     Py_XDECREF(m);
     return (__Pyx_RefNannyAPIStruct *)r;
 }
 #endif
 
+/* PyErrExceptionMatches */
+#if CYTHON_FAST_THREAD_STATE
+static int __Pyx_PyErr_ExceptionMatchesTuple(PyObject *exc_type, PyObject *tuple) {
+    Py_ssize_t i, n;
+    n = PyTuple_GET_SIZE(tuple);
+#if PY_MAJOR_VERSION >= 3
+    for (i=0; i<n; i++) {
+        if (exc_type == PyTuple_GET_ITEM(tuple, i)) return 1;
+    }
+#endif
+    for (i=0; i<n; i++) {
+        if (__Pyx_PyErr_GivenExceptionMatches(exc_type, PyTuple_GET_ITEM(tuple, i))) return 1;
+    }
+    return 0;
+}
+static CYTHON_INLINE int __Pyx_PyErr_ExceptionMatchesInState(PyThreadState* tstate, PyObject* err) {
+    int result;
+    PyObject *exc_type;
+#if PY_VERSION_HEX >= 0x030C00A6
+    PyObject *current_exception = tstate->current_exception;
+    if (unlikely(!current_exception)) return 0;
+    exc_type = (PyObject*) Py_TYPE(current_exception);
+    if (exc_type == err) return 1;
+#else
+    exc_type = tstate->curexc_type;
+    if (exc_type == err) return 1;
+    if (unlikely(!exc_type)) return 0;
+#endif
+    #if CYTHON_AVOID_BORROWED_REFS
+    Py_INCREF(exc_type);
+    #endif
+    if (unlikely(PyTuple_Check(err))) {
+        result = __Pyx_PyErr_ExceptionMatchesTuple(exc_type, err);
+    } else {
+        result = __Pyx_PyErr_GivenExceptionMatches(exc_type, err);
+    }
+    #if CYTHON_AVOID_BORROWED_REFS
+    Py_DECREF(exc_type);
+    #endif
+    return result;
+}
+#endif
+
+/* PyErrFetchRestore */
+#if CYTHON_FAST_THREAD_STATE
+static CYTHON_INLINE void __Pyx_ErrRestoreInState(PyThreadState *tstate, PyObject *type, PyObject *value, PyObject *tb) {
+#if PY_VERSION_HEX >= 0x030C00A6
+    PyObject *tmp_value;
+    assert(type == NULL || (value != NULL && type == (PyObject*) Py_TYPE(value)));
+    if (value) {
+        #if CYTHON_COMPILING_IN_CPYTHON
+        if (unlikely(((PyBaseExceptionObject*) value)->traceback != tb))
+        #endif
+            PyException_SetTraceback(value, tb);
+    }
+    tmp_value = tstate->current_exception;
+    tstate->current_exception = value;
+    Py_XDECREF(tmp_value);
+#else
+    PyObject *tmp_type, *tmp_value, *tmp_tb;
+    tmp_type = tstate->curexc_type;
+    tmp_value = tstate->curexc_value;
+    tmp_tb = tstate->curexc_traceback;
+    tstate->curexc_type = type;
+    tstate->curexc_value = value;
+    tstate->curexc_traceback = tb;
+    Py_XDECREF(tmp_type);
+    Py_XDECREF(tmp_value);
+    Py_XDECREF(tmp_tb);
+#endif
+}
+static CYTHON_INLINE void __Pyx_ErrFetchInState(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb) {
+#if PY_VERSION_HEX >= 0x030C00A6
+    PyObject* exc_value;
+    exc_value = tstate->current_exception;
+    tstate->current_exception = 0;
+    *value = exc_value;
+    *type = NULL;
+    *tb = NULL;
+    if (exc_value) {
+        *type = (PyObject*) Py_TYPE(exc_value);
+        Py_INCREF(*type);
+        #if CYTHON_COMPILING_IN_CPYTHON
+        *tb = ((PyBaseExceptionObject*) exc_value)->traceback;
+        Py_XINCREF(*tb);
+        #else
+        *tb = PyException_GetTraceback(exc_value);
+        #endif
+    }
+#else
+    *type = tstate->curexc_type;
+    *value = tstate->curexc_value;
+    *tb = tstate->curexc_traceback;
+    tstate->curexc_type = 0;
+    tstate->curexc_value = 0;
+    tstate->curexc_traceback = 0;
+#endif
+}
+#endif
+
 /* PyObjectGetAttrStr */
 #if CYTHON_USE_TYPE_SLOTS
 static CYTHON_INLINE PyObject* __Pyx_PyObject_GetAttrStr(PyObject* obj, PyObject* attr_name) {
     PyTypeObject* tp = Py_TYPE(obj);
     if (likely(tp->tp_getattro))
         return tp->tp_getattro(obj, attr_name);
 #if PY_MAJOR_VERSION < 3
     if (likely(tp->tp_getattr))
         return tp->tp_getattr(obj, PyString_AS_STRING(attr_name));
 #endif
     return PyObject_GetAttr(obj, attr_name);
 }
 #endif
 
+/* PyObjectGetAttrStrNoError */
+static void __Pyx_PyObject_GetAttrStr_ClearAttributeError(void) {
+    __Pyx_PyThreadState_declare
+    __Pyx_PyThreadState_assign
+    if (likely(__Pyx_PyErr_ExceptionMatches(PyExc_AttributeError)))
+        __Pyx_PyErr_Clear();
+}
+static CYTHON_INLINE PyObject* __Pyx_PyObject_GetAttrStrNoError(PyObject* obj, PyObject* attr_name) {
+    PyObject *result;
+#if CYTHON_COMPILING_IN_CPYTHON && CYTHON_USE_TYPE_SLOTS && PY_VERSION_HEX >= 0x030700B1
+    PyTypeObject* tp = Py_TYPE(obj);
+    if (likely(tp->tp_getattro == PyObject_GenericGetAttr)) {
+        return _PyObject_GenericGetAttrWithDict(obj, attr_name, NULL, 1);
+    }
+#endif
+    result = __Pyx_PyObject_GetAttrStr(obj, attr_name);
+    if (unlikely(!result)) {
+        __Pyx_PyObject_GetAttrStr_ClearAttributeError();
+    }
+    return result;
+}
+
 /* GetBuiltinName */
 static PyObject *__Pyx_GetBuiltinName(PyObject *name) {
-    PyObject* result = __Pyx_PyObject_GetAttrStr(__pyx_b, name);
-    if (unlikely(!result)) {
+    PyObject* result = __Pyx_PyObject_GetAttrStrNoError(__pyx_b, name);
+    if (unlikely(!result) && !PyErr_Occurred()) {
         PyErr_Format(PyExc_NameError,
 #if PY_MAJOR_VERSION >= 3
             "name '%U' is not defined", name);
 #else
             "name '%.200s' is not defined", PyString_AS_STRING(name));
 #endif
     }
     return result;
 }
 
-/* PyObjectCall */
+/* WriteUnraisableException */
+static void __Pyx_WriteUnraisable(const char *name, int clineno,
+                                  int lineno, const char *filename,
+                                  int full_traceback, int nogil) {
+    PyObject *old_exc, *old_val, *old_tb;
+    PyObject *ctx;
+    __Pyx_PyThreadState_declare
+#ifdef WITH_THREAD
+    PyGILState_STATE state;
+    if (nogil)
+        state = PyGILState_Ensure();
+    else state = (PyGILState_STATE)0;
+#endif
+    CYTHON_UNUSED_VAR(clineno);
+    CYTHON_UNUSED_VAR(lineno);
+    CYTHON_UNUSED_VAR(filename);
+    CYTHON_MAYBE_UNUSED_VAR(nogil);
+    __Pyx_PyThreadState_assign
+    __Pyx_ErrFetch(&old_exc, &old_val, &old_tb);
+    if (full_traceback) {
+        Py_XINCREF(old_exc);
+        Py_XINCREF(old_val);
+        Py_XINCREF(old_tb);
+        __Pyx_ErrRestore(old_exc, old_val, old_tb);
+        PyErr_PrintEx(1);
+    }
+    #if PY_MAJOR_VERSION < 3
+    ctx = PyString_FromString(name);
+    #else
+    ctx = PyUnicode_FromString(name);
+    #endif
+    __Pyx_ErrRestore(old_exc, old_val, old_tb);
+    if (!ctx) {
+        PyErr_WriteUnraisable(Py_None);
+    } else {
+        PyErr_WriteUnraisable(ctx);
+        Py_DECREF(ctx);
+    }
+#ifdef WITH_THREAD
+    if (nogil)
+        PyGILState_Release(state);
+#endif
+}
+
+/* TupleAndListFromArray */
 #if CYTHON_COMPILING_IN_CPYTHON
-static CYTHON_INLINE PyObject* __Pyx_PyObject_Call(PyObject *func, PyObject *arg, PyObject *kw) {
-    PyObject *result;
-    ternaryfunc call = func->ob_type->tp_call;
-    if (unlikely(!call))
-        return PyObject_Call(func, arg, kw);
-    if (unlikely(Py_EnterRecursiveCall((char*)" while calling a Python object")))
-        return NULL;
-    result = (*call)(func, arg, kw);
-    Py_LeaveRecursiveCall();
-    if (unlikely(!result) && unlikely(!PyErr_Occurred())) {
-        PyErr_SetString(
-            PyExc_SystemError,
-            "NULL result without error in PyObject_Call");
+static CYTHON_INLINE void __Pyx_copy_object_array(PyObject *const *CYTHON_RESTRICT src, PyObject** CYTHON_RESTRICT dest, Py_ssize_t length) {
+    PyObject *v;
+    Py_ssize_t i;
+    for (i = 0; i < length; i++) {
+        v = dest[i] = src[i];
+        Py_INCREF(v);
     }
-    return result;
+}
+static CYTHON_INLINE PyObject *
+__Pyx_PyTuple_FromArray(PyObject *const *src, Py_ssize_t n)
+{
+    PyObject *res;
+    if (n <= 0) {
+        Py_INCREF(__pyx_empty_tuple);
+        return __pyx_empty_tuple;
+    }
+    res = PyTuple_New(n);
+    if (unlikely(res == NULL)) return NULL;
+    __Pyx_copy_object_array(src, ((PyTupleObject*)res)->ob_item, n);
+    return res;
+}
+static CYTHON_INLINE PyObject *
+__Pyx_PyList_FromArray(PyObject *const *src, Py_ssize_t n)
+{
+    PyObject *res;
+    if (n <= 0) {
+        return PyList_New(0);
+    }
+    res = PyList_New(n);
+    if (unlikely(res == NULL)) return NULL;
+    __Pyx_copy_object_array(src, ((PyListObject*)res)->ob_item, n);
+    return res;
 }
 #endif
 
-/* PyErrFetchRestore */
-#if CYTHON_FAST_THREAD_STATE
-static CYTHON_INLINE void __Pyx_ErrRestoreInState(PyThreadState *tstate, PyObject *type, PyObject *value, PyObject *tb) {
-    PyObject *tmp_type, *tmp_value, *tmp_tb;
-    tmp_type = tstate->curexc_type;
-    tmp_value = tstate->curexc_value;
-    tmp_tb = tstate->curexc_traceback;
-    tstate->curexc_type = type;
-    tstate->curexc_value = value;
-    tstate->curexc_traceback = tb;
-    Py_XDECREF(tmp_type);
-    Py_XDECREF(tmp_value);
-    Py_XDECREF(tmp_tb);
+/* BytesEquals */
+static CYTHON_INLINE int __Pyx_PyBytes_Equals(PyObject* s1, PyObject* s2, int equals) {
+#if CYTHON_COMPILING_IN_PYPY || CYTHON_COMPILING_IN_LIMITED_API
+    return PyObject_RichCompareBool(s1, s2, equals);
+#else
+    if (s1 == s2) {
+        return (equals == Py_EQ);
+    } else if (PyBytes_CheckExact(s1) & PyBytes_CheckExact(s2)) {
+        const char *ps1, *ps2;
+        Py_ssize_t length = PyBytes_GET_SIZE(s1);
+        if (length != PyBytes_GET_SIZE(s2))
+            return (equals == Py_NE);
+        ps1 = PyBytes_AS_STRING(s1);
+        ps2 = PyBytes_AS_STRING(s2);
+        if (ps1[0] != ps2[0]) {
+            return (equals == Py_NE);
+        } else if (length == 1) {
+            return (equals == Py_EQ);
+        } else {
+            int result;
+#if CYTHON_USE_UNICODE_INTERNALS && (PY_VERSION_HEX < 0x030B0000)
+            Py_hash_t hash1, hash2;
+            hash1 = ((PyBytesObject*)s1)->ob_shash;
+            hash2 = ((PyBytesObject*)s2)->ob_shash;
+            if (hash1 != hash2 && hash1 != -1 && hash2 != -1) {
+                return (equals == Py_NE);
+            }
+#endif
+            result = memcmp(ps1, ps2, (size_t)length);
+            return (equals == Py_EQ) ? (result == 0) : (result != 0);
+        }
+    } else if ((s1 == Py_None) & PyBytes_CheckExact(s2)) {
+        return (equals == Py_NE);
+    } else if ((s2 == Py_None) & PyBytes_CheckExact(s1)) {
+        return (equals == Py_NE);
+    } else {
+        int result;
+        PyObject* py_result = PyObject_RichCompare(s1, s2, equals);
+        if (!py_result)
+            return -1;
+        result = __Pyx_PyObject_IsTrue(py_result);
+        Py_DECREF(py_result);
+        return result;
+    }
+#endif
 }
-static CYTHON_INLINE void __Pyx_ErrFetchInState(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb) {
-    *type = tstate->curexc_type;
-    *value = tstate->curexc_value;
-    *tb = tstate->curexc_traceback;
-    tstate->curexc_type = 0;
-    tstate->curexc_value = 0;
-    tstate->curexc_traceback = 0;
+
+/* UnicodeEquals */
+static CYTHON_INLINE int __Pyx_PyUnicode_Equals(PyObject* s1, PyObject* s2, int equals) {
+#if CYTHON_COMPILING_IN_PYPY || CYTHON_COMPILING_IN_LIMITED_API
+    return PyObject_RichCompareBool(s1, s2, equals);
+#else
+#if PY_MAJOR_VERSION < 3
+    PyObject* owned_ref = NULL;
+#endif
+    int s1_is_unicode, s2_is_unicode;
+    if (s1 == s2) {
+        goto return_eq;
+    }
+    s1_is_unicode = PyUnicode_CheckExact(s1);
+    s2_is_unicode = PyUnicode_CheckExact(s2);
+#if PY_MAJOR_VERSION < 3
+    if ((s1_is_unicode & (!s2_is_unicode)) && PyString_CheckExact(s2)) {
+        owned_ref = PyUnicode_FromObject(s2);
+        if (unlikely(!owned_ref))
+            return -1;
+        s2 = owned_ref;
+        s2_is_unicode = 1;
+    } else if ((s2_is_unicode & (!s1_is_unicode)) && PyString_CheckExact(s1)) {
+        owned_ref = PyUnicode_FromObject(s1);
+        if (unlikely(!owned_ref))
+            return -1;
+        s1 = owned_ref;
+        s1_is_unicode = 1;
+    } else if (((!s2_is_unicode) & (!s1_is_unicode))) {
+        return __Pyx_PyBytes_Equals(s1, s2, equals);
+    }
+#endif
+    if (s1_is_unicode & s2_is_unicode) {
+        Py_ssize_t length;
+        int kind;
+        void *data1, *data2;
+        if (unlikely(__Pyx_PyUnicode_READY(s1) < 0) || unlikely(__Pyx_PyUnicode_READY(s2) < 0))
+            return -1;
+        length = __Pyx_PyUnicode_GET_LENGTH(s1);
+        if (length != __Pyx_PyUnicode_GET_LENGTH(s2)) {
+            goto return_ne;
+        }
+#if CYTHON_USE_UNICODE_INTERNALS
+        {
+            Py_hash_t hash1, hash2;
+        #if CYTHON_PEP393_ENABLED
+            hash1 = ((PyASCIIObject*)s1)->hash;
+            hash2 = ((PyASCIIObject*)s2)->hash;
+        #else
+            hash1 = ((PyUnicodeObject*)s1)->hash;
+            hash2 = ((PyUnicodeObject*)s2)->hash;
+        #endif
+            if (hash1 != hash2 && hash1 != -1 && hash2 != -1) {
+                goto return_ne;
+            }
+        }
+#endif
+        kind = __Pyx_PyUnicode_KIND(s1);
+        if (kind != __Pyx_PyUnicode_KIND(s2)) {
+            goto return_ne;
+        }
+        data1 = __Pyx_PyUnicode_DATA(s1);
+        data2 = __Pyx_PyUnicode_DATA(s2);
+        if (__Pyx_PyUnicode_READ(kind, data1, 0) != __Pyx_PyUnicode_READ(kind, data2, 0)) {
+            goto return_ne;
+        } else if (length == 1) {
+            goto return_eq;
+        } else {
+            int result = memcmp(data1, data2, (size_t)(length * kind));
+            #if PY_MAJOR_VERSION < 3
+            Py_XDECREF(owned_ref);
+            #endif
+            return (equals == Py_EQ) ? (result == 0) : (result != 0);
+        }
+    } else if ((s1 == Py_None) & s2_is_unicode) {
+        goto return_ne;
+    } else if ((s2 == Py_None) & s1_is_unicode) {
+        goto return_ne;
+    } else {
+        int result;
+        PyObject* py_result = PyObject_RichCompare(s1, s2, equals);
+        #if PY_MAJOR_VERSION < 3
+        Py_XDECREF(owned_ref);
+        #endif
+        if (!py_result)
+            return -1;
+        result = __Pyx_PyObject_IsTrue(py_result);
+        Py_DECREF(py_result);
+        return result;
+    }
+return_eq:
+    #if PY_MAJOR_VERSION < 3
+    Py_XDECREF(owned_ref);
+    #endif
+    return (equals == Py_EQ);
+return_ne:
+    #if PY_MAJOR_VERSION < 3
+    Py_XDECREF(owned_ref);
+    #endif
+    return (equals == Py_NE);
+#endif
+}
+
+/* fastcall */
+#if CYTHON_METH_FASTCALL
+static CYTHON_INLINE PyObject * __Pyx_GetKwValue_FASTCALL(PyObject *kwnames, PyObject *const *kwvalues, PyObject *s)
+{
+    Py_ssize_t i, n = PyTuple_GET_SIZE(kwnames);
+    for (i = 0; i < n; i++)
+    {
+        if (s == PyTuple_GET_ITEM(kwnames, i)) return kwvalues[i];
+    }
+    for (i = 0; i < n; i++)
+    {
+        int eq = __Pyx_PyUnicode_Equals(s, PyTuple_GET_ITEM(kwnames, i), Py_EQ);
+        if (unlikely(eq != 0)) {
+            if (unlikely(eq < 0)) return NULL;  // error
+            return kwvalues[i];
+        }
+    }
+    return NULL;  // not found (no exception set)
 }
 #endif
 
+/* RaiseArgTupleInvalid */
+static void __Pyx_RaiseArgtupleInvalid(
+    const char* func_name,
+    int exact,
+    Py_ssize_t num_min,
+    Py_ssize_t num_max,
+    Py_ssize_t num_found)
+{
+    Py_ssize_t num_expected;
+    const char *more_or_less;
+    if (num_found < num_min) {
+        num_expected = num_min;
+        more_or_less = "at least";
+    } else {
+        num_expected = num_max;
+        more_or_less = "at most";
+    }
+    if (exact) {
+        more_or_less = "exactly";
+    }
+    PyErr_Format(PyExc_TypeError,
+                 "%.200s() takes %.8s %" CYTHON_FORMAT_SSIZE_T "d positional argument%.1s (%" CYTHON_FORMAT_SSIZE_T "d given)",
+                 func_name, more_or_less, num_expected,
+                 (num_expected == 1) ? "" : "s", num_found);
+}
+
+/* RaiseDoubleKeywords */
+static void __Pyx_RaiseDoubleKeywordsError(
+    const char* func_name,
+    PyObject* kw_name)
+{
+    PyErr_Format(PyExc_TypeError,
+        #if PY_MAJOR_VERSION >= 3
+        "%s() got multiple values for keyword argument '%U'", func_name, kw_name);
+        #else
+        "%s() got multiple values for keyword argument '%s'", func_name,
+        PyString_AsString(kw_name));
+        #endif
+}
+
+/* ParseKeywords */
+static int __Pyx_ParseOptionalKeywords(
+    PyObject *kwds,
+    PyObject *const *kwvalues,
+    PyObject **argnames[],
+    PyObject *kwds2,
+    PyObject *values[],
+    Py_ssize_t num_pos_args,
+    const char* function_name)
+{
+    PyObject *key = 0, *value = 0;
+    Py_ssize_t pos = 0;
+    PyObject*** name;
+    PyObject*** first_kw_arg = argnames + num_pos_args;
+    int kwds_is_tuple = CYTHON_METH_FASTCALL && likely(PyTuple_Check(kwds));
+    while (1) {
+        if (kwds_is_tuple) {
+            if (pos >= PyTuple_GET_SIZE(kwds)) break;
+            key = PyTuple_GET_ITEM(kwds, pos);
+            value = kwvalues[pos];
+            pos++;
+        }
+        else
+        {
+            if (!PyDict_Next(kwds, &pos, &key, &value)) break;
+        }
+        name = first_kw_arg;
+        while (*name && (**name != key)) name++;
+        if (*name) {
+            values[name-argnames] = value;
+            continue;
+        }
+        name = first_kw_arg;
+        #if PY_MAJOR_VERSION < 3
+        if (likely(PyString_Check(key))) {
+            while (*name) {
+                if ((CYTHON_COMPILING_IN_PYPY || PyString_GET_SIZE(**name) == PyString_GET_SIZE(key))
+                        && _PyString_Eq(**name, key)) {
+                    values[name-argnames] = value;
+                    break;
+                }
+                name++;
+            }
+            if (*name) continue;
+            else {
+                PyObject*** argname = argnames;
+                while (argname != first_kw_arg) {
+                    if ((**argname == key) || (
+                            (CYTHON_COMPILING_IN_PYPY || PyString_GET_SIZE(**argname) == PyString_GET_SIZE(key))
+                             && _PyString_Eq(**argname, key))) {
+                        goto arg_passed_twice;
+                    }
+                    argname++;
+                }
+            }
+        } else
+        #endif
+        if (likely(PyUnicode_Check(key))) {
+            while (*name) {
+                int cmp = (
+                #if !CYTHON_COMPILING_IN_PYPY && PY_MAJOR_VERSION >= 3
+                    (__Pyx_PyUnicode_GET_LENGTH(**name) != __Pyx_PyUnicode_GET_LENGTH(key)) ? 1 :
+                #endif
+                    PyUnicode_Compare(**name, key)
+                );
+                if (cmp < 0 && unlikely(PyErr_Occurred())) goto bad;
+                if (cmp == 0) {
+                    values[name-argnames] = value;
+                    break;
+                }
+                name++;
+            }
+            if (*name) continue;
+            else {
+                PyObject*** argname = argnames;
+                while (argname != first_kw_arg) {
+                    int cmp = (**argname == key) ? 0 :
+                    #if !CYTHON_COMPILING_IN_PYPY && PY_MAJOR_VERSION >= 3
+                        (__Pyx_PyUnicode_GET_LENGTH(**argname) != __Pyx_PyUnicode_GET_LENGTH(key)) ? 1 :
+                    #endif
+                        PyUnicode_Compare(**argname, key);
+                    if (cmp < 0 && unlikely(PyErr_Occurred())) goto bad;
+                    if (cmp == 0) goto arg_passed_twice;
+                    argname++;
+                }
+            }
+        } else
+            goto invalid_keyword_type;
+        if (kwds2) {
+            if (unlikely(PyDict_SetItem(kwds2, key, value))) goto bad;
+        } else {
+            goto invalid_keyword;
+        }
+    }
+    return 0;
+arg_passed_twice:
+    __Pyx_RaiseDoubleKeywordsError(function_name, key);
+    goto bad;
+invalid_keyword_type:
+    PyErr_Format(PyExc_TypeError,
+        "%.200s() keywords must be strings", function_name);
+    goto bad;
+invalid_keyword:
+    #if PY_MAJOR_VERSION < 3
+    PyErr_Format(PyExc_TypeError,
+        "%.200s() got an unexpected keyword argument '%.200s'",
+        function_name, PyString_AsString(key));
+    #else
+    PyErr_Format(PyExc_TypeError,
+        "%s() got an unexpected keyword argument '%U'",
+        function_name, key);
+    #endif
+bad:
+    return -1;
+}
+
 /* RaiseException */
 #if PY_MAJOR_VERSION < 3
-static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb,
-                        CYTHON_UNUSED PyObject *cause) {
+static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb, PyObject *cause) {
     __Pyx_PyThreadState_declare
+    CYTHON_UNUSED_VAR(cause);
     Py_XINCREF(type);
     if (!value || value == Py_None)
         value = NULL;
     else
         Py_INCREF(value);
     if (!tb || tb == Py_None)
         tb = NULL;
@@ -8235,61 +6647,40 @@
                             "BaseException");
             goto bad;
         }
         PyException_SetCause(value, fixed_cause);
     }
     PyErr_SetObject(type, value);
     if (tb) {
-#if CYTHON_COMPILING_IN_PYPY
-        PyObject *tmp_type, *tmp_value, *tmp_tb;
-        PyErr_Fetch(&tmp_type, &tmp_value, &tmp_tb);
-        Py_INCREF(tb);
-        PyErr_Restore(tmp_type, tmp_value, tb);
-        Py_XDECREF(tmp_tb);
-#else
+      #if PY_VERSION_HEX >= 0x030C00A6
+        PyException_SetTraceback(value, tb);
+      #elif CYTHON_FAST_THREAD_STATE
         PyThreadState *tstate = __Pyx_PyThreadState_Current;
         PyObject* tmp_tb = tstate->curexc_traceback;
         if (tb != tmp_tb) {
             Py_INCREF(tb);
             tstate->curexc_traceback = tb;
             Py_XDECREF(tmp_tb);
         }
+#else
+        PyObject *tmp_type, *tmp_value, *tmp_tb;
+        PyErr_Fetch(&tmp_type, &tmp_value, &tmp_tb);
+        Py_INCREF(tb);
+        PyErr_Restore(tmp_type, tmp_value, tb);
+        Py_XDECREF(tmp_tb);
 #endif
     }
 bad:
     Py_XDECREF(owned_instance);
     return;
 }
 #endif
 
-/* PyCFunctionFastCall */
-#if CYTHON_FAST_PYCCALL
-static CYTHON_INLINE PyObject * __Pyx_PyCFunction_FastCall(PyObject *func_obj, PyObject **args, Py_ssize_t nargs) {
-    PyCFunctionObject *func = (PyCFunctionObject*)func_obj;
-    PyCFunction meth = PyCFunction_GET_FUNCTION(func);
-    PyObject *self = PyCFunction_GET_SELF(func);
-    int flags = PyCFunction_GET_FLAGS(func);
-    assert(PyCFunction_Check(func));
-    assert(METH_FASTCALL == (flags & ~(METH_CLASS | METH_STATIC | METH_COEXIST | METH_KEYWORDS | METH_STACKLESS)));
-    assert(nargs >= 0);
-    assert(nargs == 0 || args != NULL);
-    /* _PyCFunction_FastCallDict() must not be called with an exception set,
-       because it may clear it (directly or indirectly) and so the
-       caller loses its exception */
-    assert(!PyErr_Occurred());
-    if ((PY_VERSION_HEX < 0x030700A0) || unlikely(flags & METH_KEYWORDS)) {
-        return (*((__Pyx_PyCFunctionFastWithKeywords)(void*)meth)) (self, args, nargs, NULL);
-    } else {
-        return (*((__Pyx_PyCFunctionFast)(void*)meth)) (self, args, nargs);
-    }
-}
-#endif
-
 /* PyFunctionFastCall */
-#if CYTHON_FAST_PYCALL
+#if CYTHON_FAST_PYCALL && !CYTHON_VECTORCALL
 static PyObject* __Pyx_PyFunction_FastCallNoKw(PyCodeObject *co, PyObject **args, Py_ssize_t na,
                                                PyObject *globals) {
     PyFrameObject *f;
     PyThreadState *tstate = __Pyx_PyThreadState_Current;
     PyObject **fastlocals;
     Py_ssize_t i;
     PyObject *result;
@@ -8310,15 +6701,14 @@
     }
     result = PyEval_EvalFrameEx(f,0);
     ++tstate->recursion_depth;
     Py_DECREF(f);
     --tstate->recursion_depth;
     return result;
 }
-#if 1 || PY_VERSION_HEX < 0x030600B1
 static PyObject *__Pyx_PyFunction_FastCallDict(PyObject *func, PyObject **args, Py_ssize_t nargs, PyObject *kwargs) {
     PyCodeObject *co = (PyCodeObject *)PyFunction_GET_CODE(func);
     PyObject *globals = PyFunction_GET_GLOBALS(func);
     PyObject *argdefs = PyFunction_GET_DEFAULTS(func);
     PyObject *closure;
 #if PY_MAJOR_VERSION >= 3
     PyObject *kwdefs;
@@ -8326,15 +6716,15 @@
     PyObject *kwtuple, **k;
     PyObject **d;
     Py_ssize_t nd;
     Py_ssize_t nk;
     PyObject *result;
     assert(kwargs == NULL || PyDict_Check(kwargs));
     nk = kwargs ? PyDict_Size(kwargs) : 0;
-    if (Py_EnterRecursiveCall((char*)" while calling a Python object")) {
+    if (unlikely(Py_EnterRecursiveCall((char*)" while calling a Python object"))) {
         return NULL;
     }
     if (
 #if PY_MAJOR_VERSION >= 3
             co->co_kwonlyargcount == 0 &&
 #endif
             likely(kwargs == NULL || nk == 0) &&
@@ -8397,44 +6787,34 @@
 #endif
     Py_XDECREF(kwtuple);
 done:
     Py_LeaveRecursiveCall();
     return result;
 }
 #endif
-#endif
 
-/* PyObjectCall2Args */
-static CYTHON_UNUSED PyObject* __Pyx_PyObject_Call2Args(PyObject* function, PyObject* arg1, PyObject* arg2) {
-    PyObject *args, *result = NULL;
-    #if CYTHON_FAST_PYCALL
-    if (PyFunction_Check(function)) {
-        PyObject *args[2] = {arg1, arg2};
-        return __Pyx_PyFunction_FastCall(function, args, 2);
-    }
-    #endif
-    #if CYTHON_FAST_PYCCALL
-    if (__Pyx_PyFastCFunction_Check(function)) {
-        PyObject *args[2] = {arg1, arg2};
-        return __Pyx_PyCFunction_FastCall(function, args, 2);
+/* PyObjectCall */
+#if CYTHON_COMPILING_IN_CPYTHON
+static CYTHON_INLINE PyObject* __Pyx_PyObject_Call(PyObject *func, PyObject *arg, PyObject *kw) {
+    PyObject *result;
+    ternaryfunc call = Py_TYPE(func)->tp_call;
+    if (unlikely(!call))
+        return PyObject_Call(func, arg, kw);
+    if (unlikely(Py_EnterRecursiveCall((char*)" while calling a Python object")))
+        return NULL;
+    result = (*call)(func, arg, kw);
+    Py_LeaveRecursiveCall();
+    if (unlikely(!result) && unlikely(!PyErr_Occurred())) {
+        PyErr_SetString(
+            PyExc_SystemError,
+            "NULL result without error in PyObject_Call");
     }
-    #endif
-    args = PyTuple_New(2);
-    if (unlikely(!args)) goto done;
-    Py_INCREF(arg1);
-    PyTuple_SET_ITEM(args, 0, arg1);
-    Py_INCREF(arg2);
-    PyTuple_SET_ITEM(args, 1, arg2);
-    Py_INCREF(function);
-    result = __Pyx_PyObject_Call(function, args, NULL);
-    Py_DECREF(args);
-    Py_DECREF(function);
-done:
     return result;
 }
+#endif
 
 /* PyObjectCallMethO */
 #if CYTHON_COMPILING_IN_CPYTHON
 static CYTHON_INLINE PyObject* __Pyx_PyObject_CallMethO(PyObject *func, PyObject *arg) {
     PyObject *self, *result;
     PyCFunction cfunc;
     cfunc = PyCFunction_GET_FUNCTION(func);
@@ -8448,185 +6828,184 @@
             PyExc_SystemError,
             "NULL result without error in PyObject_Call");
     }
     return result;
 }
 #endif
 
-/* PyObjectCallOneArg */
-#if CYTHON_COMPILING_IN_CPYTHON
-static PyObject* __Pyx__PyObject_CallOneArg(PyObject *func, PyObject *arg) {
+/* PyObjectFastCall */
+static PyObject* __Pyx_PyObject_FastCall_fallback(PyObject *func, PyObject **args, size_t nargs, PyObject *kwargs) {
+    PyObject *argstuple;
     PyObject *result;
-    PyObject *args = PyTuple_New(1);
-    if (unlikely(!args)) return NULL;
-    Py_INCREF(arg);
-    PyTuple_SET_ITEM(args, 0, arg);
-    result = __Pyx_PyObject_Call(func, args, NULL);
-    Py_DECREF(args);
+    size_t i;
+    argstuple = PyTuple_New((Py_ssize_t)nargs);
+    if (unlikely(!argstuple)) return NULL;
+    for (i = 0; i < nargs; i++) {
+        Py_INCREF(args[i]);
+        PyTuple_SET_ITEM(argstuple, (Py_ssize_t)i, args[i]);
+    }
+    result = __Pyx_PyObject_Call(func, argstuple, kwargs);
+    Py_DECREF(argstuple);
     return result;
 }
-static CYTHON_INLINE PyObject* __Pyx_PyObject_CallOneArg(PyObject *func, PyObject *arg) {
-#if CYTHON_FAST_PYCALL
-    if (PyFunction_Check(func)) {
-        return __Pyx_PyFunction_FastCall(func, &arg, 1);
-    }
+static CYTHON_INLINE PyObject* __Pyx_PyObject_FastCallDict(PyObject *func, PyObject **args, size_t _nargs, PyObject *kwargs) {
+    Py_ssize_t nargs = __Pyx_PyVectorcall_NARGS(_nargs);
+#if CYTHON_COMPILING_IN_CPYTHON
+    if (nargs == 0 && kwargs == NULL) {
+#if defined(__Pyx_CyFunction_USED) && defined(NDEBUG)
+        if (__Pyx_IsCyOrPyCFunction(func))
+#else
+        if (PyCFunction_Check(func))
 #endif
-    if (likely(PyCFunction_Check(func))) {
-        if (likely(PyCFunction_GET_FLAGS(func) & METH_O)) {
-            return __Pyx_PyObject_CallMethO(func, arg);
-#if CYTHON_FAST_PYCCALL
-        } else if (PyCFunction_GET_FLAGS(func) & METH_FASTCALL) {
-            return __Pyx_PyCFunction_FastCall(func, &arg, 1);
+        {
+            if (likely(PyCFunction_GET_FLAGS(func) & METH_NOARGS)) {
+                return __Pyx_PyObject_CallMethO(func, NULL);
+            }
+        }
+    }
+    else if (nargs == 1 && kwargs == NULL) {
+        if (PyCFunction_Check(func))
+        {
+            if (likely(PyCFunction_GET_FLAGS(func) & METH_O)) {
+                return __Pyx_PyObject_CallMethO(func, args[0]);
+            }
+        }
+    }
 #endif
+    #if PY_VERSION_HEX < 0x030800B1
+    #if CYTHON_FAST_PYCCALL
+    if (PyCFunction_Check(func)) {
+        if (kwargs) {
+            return _PyCFunction_FastCallDict(func, args, nargs, kwargs);
+        } else {
+            return _PyCFunction_FastCallKeywords(func, args, nargs, NULL);
         }
     }
-    return __Pyx__PyObject_CallOneArg(func, arg);
+    #if PY_VERSION_HEX >= 0x030700A1
+    if (!kwargs && __Pyx_IS_TYPE(func, &PyMethodDescr_Type)) {
+        return _PyMethodDescr_FastCallKeywords(func, args, nargs, NULL);
+    }
+    #endif
+    #endif
+    #if CYTHON_FAST_PYCALL
+    if (PyFunction_Check(func)) {
+        return __Pyx_PyFunction_FastCallDict(func, args, nargs, kwargs);
+    }
+    #endif
+    #endif
+    #if CYTHON_VECTORCALL
+    vectorcallfunc f = _PyVectorcall_Function(func);
+    if (f) {
+        return f(func, args, (size_t)nargs, kwargs);
+    }
+    #elif defined(__Pyx_CyFunction_USED) && CYTHON_BACKPORT_VECTORCALL
+    if (__Pyx_CyFunction_CheckExact(func)) {
+        __pyx_vectorcallfunc f = __Pyx_CyFunction_func_vectorcall(func);
+        if (f) return f(func, args, (size_t)nargs, kwargs);
+    }
+    #endif
+    if (nargs == 0) {
+        return __Pyx_PyObject_Call(func, __pyx_empty_tuple, kwargs);
+    }
+    return __Pyx_PyObject_FastCall_fallback(func, args, (size_t)nargs, kwargs);
 }
-#else
+
+/* PyObjectCallOneArg */
 static CYTHON_INLINE PyObject* __Pyx_PyObject_CallOneArg(PyObject *func, PyObject *arg) {
-    PyObject *result;
-    PyObject *args = PyTuple_Pack(1, arg);
-    if (unlikely(!args)) return NULL;
-    result = __Pyx_PyObject_Call(func, args, NULL);
-    Py_DECREF(args);
-    return result;
+    PyObject *args[2] = {NULL, arg};
+    return __Pyx_PyObject_FastCall(func, args+1, 1 | __Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET);
 }
-#endif
 
-/* PyObjectGetMethod */
-static int __Pyx_PyObject_GetMethod(PyObject *obj, PyObject *name, PyObject **method) {
-    PyObject *attr;
-#if CYTHON_UNPACK_METHODS && CYTHON_COMPILING_IN_CPYTHON && CYTHON_USE_PYTYPE_LOOKUP
-    PyTypeObject *tp = Py_TYPE(obj);
-    PyObject *descr;
-    descrgetfunc f = NULL;
-    PyObject **dictptr, *dict;
-    int meth_found = 0;
-    assert (*method == NULL);
-    if (unlikely(tp->tp_getattro != PyObject_GenericGetAttr)) {
-        attr = __Pyx_PyObject_GetAttrStr(obj, name);
-        goto try_unpack;
+/* PyDictVersioning */
+#if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_TYPE_SLOTS
+static CYTHON_INLINE PY_UINT64_T __Pyx_get_tp_dict_version(PyObject *obj) {
+    PyObject *dict = Py_TYPE(obj)->tp_dict;
+    return likely(dict) ? __PYX_GET_DICT_VERSION(dict) : 0;
+}
+static CYTHON_INLINE PY_UINT64_T __Pyx_get_object_dict_version(PyObject *obj) {
+    PyObject **dictptr = NULL;
+    Py_ssize_t offset = Py_TYPE(obj)->tp_dictoffset;
+    if (offset) {
+#if CYTHON_COMPILING_IN_CPYTHON
+        dictptr = (likely(offset > 0)) ? (PyObject **) ((char *)obj + offset) : _PyObject_GetDictPtr(obj);
+#else
+        dictptr = _PyObject_GetDictPtr(obj);
+#endif
     }
-    if (unlikely(tp->tp_dict == NULL) && unlikely(PyType_Ready(tp) < 0)) {
+    return (dictptr && *dictptr) ? __PYX_GET_DICT_VERSION(*dictptr) : 0;
+}
+static CYTHON_INLINE int __Pyx_object_dict_version_matches(PyObject* obj, PY_UINT64_T tp_dict_version, PY_UINT64_T obj_dict_version) {
+    PyObject *dict = Py_TYPE(obj)->tp_dict;
+    if (unlikely(!dict) || unlikely(tp_dict_version != __PYX_GET_DICT_VERSION(dict)))
         return 0;
-    }
-    descr = _PyType_Lookup(tp, name);
-    if (likely(descr != NULL)) {
-        Py_INCREF(descr);
-#if PY_MAJOR_VERSION >= 3
-        #ifdef __Pyx_CyFunction_USED
-        if (likely(PyFunction_Check(descr) || (Py_TYPE(descr) == &PyMethodDescr_Type) || __Pyx_CyFunction_Check(descr)))
-        #else
-        if (likely(PyFunction_Check(descr) || (Py_TYPE(descr) == &PyMethodDescr_Type)))
-        #endif
+    return obj_dict_version == __Pyx_get_object_dict_version(obj);
+}
+#endif
+
+/* GetModuleGlobalName */
+#if CYTHON_USE_DICT_VERSIONS
+static PyObject *__Pyx__GetModuleGlobalName(PyObject *name, PY_UINT64_T *dict_version, PyObject **dict_cached_value)
 #else
-        #ifdef __Pyx_CyFunction_USED
-        if (likely(PyFunction_Check(descr) || __Pyx_CyFunction_Check(descr)))
-        #else
-        if (likely(PyFunction_Check(descr)))
-        #endif
+static CYTHON_INLINE PyObject *__Pyx__GetModuleGlobalName(PyObject *name)
 #endif
-        {
-            meth_found = 1;
-        } else {
-            f = Py_TYPE(descr)->tp_descr_get;
-            if (f != NULL && PyDescr_IsData(descr)) {
-                attr = f(descr, obj, (PyObject *)Py_TYPE(obj));
-                Py_DECREF(descr);
-                goto try_unpack;
-            }
-        }
-    }
-    dictptr = _PyObject_GetDictPtr(obj);
-    if (dictptr != NULL && (dict = *dictptr) != NULL) {
-        Py_INCREF(dict);
-        attr = __Pyx_PyDict_GetItemStr(dict, name);
-        if (attr != NULL) {
-            Py_INCREF(attr);
-            Py_DECREF(dict);
-            Py_XDECREF(descr);
-            goto try_unpack;
-        }
-        Py_DECREF(dict);
-    }
-    if (meth_found) {
-        *method = descr;
-        return 1;
+{
+    PyObject *result;
+#if !CYTHON_AVOID_BORROWED_REFS
+#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x030500A1
+    result = _PyDict_GetItem_KnownHash(__pyx_d, name, ((PyASCIIObject *) name)->hash);
+    __PYX_UPDATE_DICT_CACHE(__pyx_d, result, *dict_cached_value, *dict_version)
+    if (likely(result)) {
+        return __Pyx_NewRef(result);
+    } else if (unlikely(PyErr_Occurred())) {
+        return NULL;
     }
-    if (f != NULL) {
-        attr = f(descr, obj, (PyObject *)Py_TYPE(obj));
-        Py_DECREF(descr);
-        goto try_unpack;
+#elif CYTHON_COMPILING_IN_LIMITED_API
+    if (unlikely(!__pyx_m)) {
+        return NULL;
     }
-    if (descr != NULL) {
-        *method = descr;
-        return 0;
+    result = PyObject_GetAttr(__pyx_m, name);
+    if (likely(result)) {
+        return result;
     }
-    PyErr_Format(PyExc_AttributeError,
-#if PY_MAJOR_VERSION >= 3
-                 "'%.50s' object has no attribute '%U'",
-                 tp->tp_name, name);
 #else
-                 "'%.50s' object has no attribute '%.400s'",
-                 tp->tp_name, PyString_AS_STRING(name));
+    result = PyDict_GetItem(__pyx_d, name);
+    __PYX_UPDATE_DICT_CACHE(__pyx_d, result, *dict_cached_value, *dict_version)
+    if (likely(result)) {
+        return __Pyx_NewRef(result);
+    }
 #endif
-    return 0;
 #else
-    attr = __Pyx_PyObject_GetAttrStr(obj, name);
-    goto try_unpack;
-#endif
-try_unpack:
-#if CYTHON_UNPACK_METHODS
-    if (likely(attr) && PyMethod_Check(attr) && likely(PyMethod_GET_SELF(attr) == obj)) {
-        PyObject *function = PyMethod_GET_FUNCTION(attr);
-        Py_INCREF(function);
-        Py_DECREF(attr);
-        *method = function;
-        return 1;
+    result = PyObject_GetItem(__pyx_d, name);
+    __PYX_UPDATE_DICT_CACHE(__pyx_d, result, *dict_cached_value, *dict_version)
+    if (likely(result)) {
+        return __Pyx_NewRef(result);
     }
+    PyErr_Clear();
 #endif
-    *method = attr;
-    return 0;
-}
-
-/* PyObjectCallMethod1 */
-static PyObject* __Pyx__PyObject_CallMethod1(PyObject* method, PyObject* arg) {
-    PyObject *result = __Pyx_PyObject_CallOneArg(method, arg);
-    Py_DECREF(method);
-    return result;
-}
-static PyObject* __Pyx_PyObject_CallMethod1(PyObject* obj, PyObject* method_name, PyObject* arg) {
-    PyObject *method = NULL, *result;
-    int is_method = __Pyx_PyObject_GetMethod(obj, method_name, &method);
-    if (likely(is_method)) {
-        result = __Pyx_PyObject_Call2Args(method, obj, arg);
-        Py_DECREF(method);
-        return result;
-    }
-    if (unlikely(!method)) return NULL;
-    return __Pyx__PyObject_CallMethod1(method, arg);
+    return __Pyx_GetBuiltinName(name);
 }
 
-/* append */
-static CYTHON_INLINE int __Pyx_PyObject_Append(PyObject* L, PyObject* x) {
-    if (likely(PyList_CheckExact(L))) {
-        if (unlikely(__Pyx_PyList_Append(L, x) < 0)) return -1;
-    } else {
-        PyObject* retval = __Pyx_PyObject_CallMethod1(L, __pyx_n_s_append, x);
-        if (unlikely(!retval))
-            return -1;
-        Py_DECREF(retval);
-    }
-    return 0;
+/* PyObjectSetAttrStr */
+#if CYTHON_USE_TYPE_SLOTS
+static CYTHON_INLINE int __Pyx_PyObject_SetAttrStr(PyObject* obj, PyObject* attr_name, PyObject* value) {
+    PyTypeObject* tp = Py_TYPE(obj);
+    if (likely(tp->tp_setattro))
+        return tp->tp_setattro(obj, attr_name, value);
+#if PY_MAJOR_VERSION < 3
+    if (likely(tp->tp_setattr))
+        return tp->tp_setattr(obj, PyString_AS_STRING(attr_name), value);
+#endif
+    return PyObject_SetAttr(obj, attr_name, value);
 }
+#endif
 
 /* GetItemInt */
 static PyObject *__Pyx_GetItemInt_Generic(PyObject *o, PyObject* j) {
     PyObject *r;
-    if (!j) return NULL;
+    if (unlikely(!j)) return NULL;
     r = PyObject_GetItem(o, j);
     Py_DECREF(j);
     return r;
 }
 static CYTHON_INLINE PyObject *__Pyx_GetItemInt_List_Fast(PyObject *o, Py_ssize_t i,
                                                               CYTHON_NCP_UNUSED int wraparound,
                                                               CYTHON_NCP_UNUSED int boundscheck) {
@@ -8679,288 +7058,1860 @@
         Py_ssize_t n = ((!wraparound) | likely(i >= 0)) ? i : i + PyTuple_GET_SIZE(o);
         if ((!boundscheck) || likely(__Pyx_is_valid_index(n, PyTuple_GET_SIZE(o)))) {
             PyObject *r = PyTuple_GET_ITEM(o, n);
             Py_INCREF(r);
             return r;
         }
     } else {
-        PySequenceMethods *m = Py_TYPE(o)->tp_as_sequence;
-        if (likely(m && m->sq_item)) {
-            if (wraparound && unlikely(i < 0) && likely(m->sq_length)) {
-                Py_ssize_t l = m->sq_length(o);
+        PyMappingMethods *mm = Py_TYPE(o)->tp_as_mapping;
+        PySequenceMethods *sm = Py_TYPE(o)->tp_as_sequence;
+        if (mm && mm->mp_subscript) {
+            PyObject *r, *key = PyInt_FromSsize_t(i);
+            if (unlikely(!key)) return NULL;
+            r = mm->mp_subscript(o, key);
+            Py_DECREF(key);
+            return r;
+        }
+        if (likely(sm && sm->sq_item)) {
+            if (wraparound && unlikely(i < 0) && likely(sm->sq_length)) {
+                Py_ssize_t l = sm->sq_length(o);
                 if (likely(l >= 0)) {
                     i += l;
                 } else {
                     if (!PyErr_ExceptionMatches(PyExc_OverflowError))
                         return NULL;
                     PyErr_Clear();
                 }
             }
-            return m->sq_item(o, i);
+            return sm->sq_item(o, i);
         }
     }
 #else
     if (is_list || PySequence_Check(o)) {
         return PySequence_GetItem(o, i);
     }
 #endif
     return __Pyx_GetItemInt_Generic(o, PyInt_FromSsize_t(i));
 }
 
-/* PyObjectCallNoArg */
-#if CYTHON_COMPILING_IN_CPYTHON
-static CYTHON_INLINE PyObject* __Pyx_PyObject_CallNoArg(PyObject *func) {
-#if CYTHON_FAST_PYCALL
-    if (PyFunction_Check(func)) {
-        return __Pyx_PyFunction_FastCall(func, NULL, 0);
+/* ObjectGetItem */
+#if CYTHON_USE_TYPE_SLOTS
+static PyObject *__Pyx_PyObject_GetIndex(PyObject *obj, PyObject *index) {
+    PyObject *runerr = NULL;
+    Py_ssize_t key_value;
+    key_value = __Pyx_PyIndex_AsSsize_t(index);
+    if (likely(key_value != -1 || !(runerr = PyErr_Occurred()))) {
+        return __Pyx_GetItemInt_Fast(obj, key_value, 0, 1, 1);
+    }
+    if (PyErr_GivenExceptionMatches(runerr, PyExc_OverflowError)) {
+        __Pyx_TypeName index_type_name = __Pyx_PyType_GetName(Py_TYPE(index));
+        PyErr_Clear();
+        PyErr_Format(PyExc_IndexError,
+            "cannot fit '" __Pyx_FMT_TYPENAME "' into an index-sized integer", index_type_name);
+        __Pyx_DECREF_TypeName(index_type_name);
+    }
+    return NULL;
+}
+static PyObject *__Pyx_PyObject_GetItem_Slow(PyObject *obj, PyObject *key) {
+    __Pyx_TypeName obj_type_name;
+    if (likely(PyType_Check(obj))) {
+        PyObject *meth = __Pyx_PyObject_GetAttrStrNoError(obj, __pyx_n_s_class_getitem);
+        if (meth) {
+            PyObject *result = __Pyx_PyObject_CallOneArg(meth, key);
+            Py_DECREF(meth);
+            return result;
+        }
+    }
+    obj_type_name = __Pyx_PyType_GetName(Py_TYPE(obj));
+    PyErr_Format(PyExc_TypeError,
+        "'" __Pyx_FMT_TYPENAME "' object is not subscriptable", obj_type_name);
+    __Pyx_DECREF_TypeName(obj_type_name);
+    return NULL;
+}
+static PyObject *__Pyx_PyObject_GetItem(PyObject *obj, PyObject *key) {
+    PyTypeObject *tp = Py_TYPE(obj);
+    PyMappingMethods *mm = tp->tp_as_mapping;
+    PySequenceMethods *sm = tp->tp_as_sequence;
+    if (likely(mm && mm->mp_subscript)) {
+        return mm->mp_subscript(obj, key);
+    }
+    if (likely(sm && sm->sq_item)) {
+        return __Pyx_PyObject_GetIndex(obj, key);
     }
+    return __Pyx_PyObject_GetItem_Slow(obj, key);
+}
 #endif
-#ifdef __Pyx_CyFunction_USED
-    if (likely(PyCFunction_Check(func) || __Pyx_CyFunction_Check(func)))
+
+/* PyObjectFormatAndDecref */
+static CYTHON_INLINE PyObject* __Pyx_PyObject_FormatSimpleAndDecref(PyObject* s, PyObject* f) {
+    if (unlikely(!s)) return NULL;
+    if (likely(PyUnicode_CheckExact(s))) return s;
+    #if PY_MAJOR_VERSION < 3
+    if (likely(PyString_CheckExact(s))) {
+        PyObject *result = PyUnicode_FromEncodedObject(s, NULL, "strict");
+        Py_DECREF(s);
+        return result;
+    }
+    #endif
+    return __Pyx_PyObject_FormatAndDecref(s, f);
+}
+static CYTHON_INLINE PyObject* __Pyx_PyObject_FormatAndDecref(PyObject* s, PyObject* f) {
+    PyObject *result = PyObject_Format(s, f);
+    Py_DECREF(s);
+    return result;
+}
+
+/* JoinPyUnicode */
+static PyObject* __Pyx_PyUnicode_Join(PyObject* value_tuple, Py_ssize_t value_count, Py_ssize_t result_ulength,
+                                      Py_UCS4 max_char) {
+#if CYTHON_USE_UNICODE_INTERNALS && CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
+    PyObject *result_uval;
+    int result_ukind, kind_shift;
+    Py_ssize_t i, char_pos;
+    void *result_udata;
+    CYTHON_MAYBE_UNUSED_VAR(max_char);
+#if CYTHON_PEP393_ENABLED
+    result_uval = PyUnicode_New(result_ulength, max_char);
+    if (unlikely(!result_uval)) return NULL;
+    result_ukind = (max_char <= 255) ? PyUnicode_1BYTE_KIND : (max_char <= 65535) ? PyUnicode_2BYTE_KIND : PyUnicode_4BYTE_KIND;
+    kind_shift = (result_ukind == PyUnicode_4BYTE_KIND) ? 2 : result_ukind - 1;
+    result_udata = PyUnicode_DATA(result_uval);
+#else
+    result_uval = PyUnicode_FromUnicode(NULL, result_ulength);
+    if (unlikely(!result_uval)) return NULL;
+    result_ukind = sizeof(Py_UNICODE);
+    kind_shift = (result_ukind == 4) ? 2 : result_ukind - 1;
+    result_udata = PyUnicode_AS_UNICODE(result_uval);
+#endif
+    assert(kind_shift == 2 || kind_shift == 1 || kind_shift == 0);
+    char_pos = 0;
+    for (i=0; i < value_count; i++) {
+        int ukind;
+        Py_ssize_t ulength;
+        void *udata;
+        PyObject *uval = PyTuple_GET_ITEM(value_tuple, i);
+        if (unlikely(__Pyx_PyUnicode_READY(uval)))
+            goto bad;
+        ulength = __Pyx_PyUnicode_GET_LENGTH(uval);
+        if (unlikely(!ulength))
+            continue;
+        if (unlikely((PY_SSIZE_T_MAX >> kind_shift) - ulength < char_pos))
+            goto overflow;
+        ukind = __Pyx_PyUnicode_KIND(uval);
+        udata = __Pyx_PyUnicode_DATA(uval);
+        if (!CYTHON_PEP393_ENABLED || ukind == result_ukind) {
+            memcpy((char *)result_udata + (char_pos << kind_shift), udata, (size_t) (ulength << kind_shift));
+        } else {
+            #if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x030300F0 || defined(_PyUnicode_FastCopyCharacters)
+            _PyUnicode_FastCopyCharacters(result_uval, char_pos, uval, 0, ulength);
+            #else
+            Py_ssize_t j;
+            for (j=0; j < ulength; j++) {
+                Py_UCS4 uchar = __Pyx_PyUnicode_READ(ukind, udata, j);
+                __Pyx_PyUnicode_WRITE(result_ukind, result_udata, char_pos+j, uchar);
+            }
+            #endif
+        }
+        char_pos += ulength;
+    }
+    return result_uval;
+overflow:
+    PyErr_SetString(PyExc_OverflowError, "join() result is too long for a Python string");
+bad:
+    Py_DECREF(result_uval);
+    return NULL;
 #else
-    if (likely(PyCFunction_Check(func)))
+    CYTHON_UNUSED_VAR(max_char);
+    CYTHON_UNUSED_VAR(result_ulength);
+    CYTHON_UNUSED_VAR(value_count);
+    return PyUnicode_Join(__pyx_empty_unicode, value_tuple);
 #endif
-    {
-        if (likely(PyCFunction_GET_FLAGS(func) & METH_NOARGS)) {
-            return __Pyx_PyObject_CallMethO(func, NULL);
+}
+
+/* TypeImport */
+#ifndef __PYX_HAVE_RT_ImportType_3_0_0
+#define __PYX_HAVE_RT_ImportType_3_0_0
+static PyTypeObject *__Pyx_ImportType_3_0_0(PyObject *module, const char *module_name, const char *class_name,
+    size_t size, size_t alignment, enum __Pyx_ImportType_CheckSize_3_0_0 check_size)
+{
+    PyObject *result = 0;
+    char warning[200];
+    Py_ssize_t basicsize;
+    Py_ssize_t itemsize;
+#if CYTHON_COMPILING_IN_LIMITED_API
+    PyObject *py_basicsize;
+    PyObject *py_itemsize;
+#endif
+    result = PyObject_GetAttrString(module, class_name);
+    if (!result)
+        goto bad;
+    if (!PyType_Check(result)) {
+        PyErr_Format(PyExc_TypeError,
+            "%.200s.%.200s is not a type object",
+            module_name, class_name);
+        goto bad;
+    }
+#if !CYTHON_COMPILING_IN_LIMITED_API
+    basicsize = ((PyTypeObject *)result)->tp_basicsize;
+    itemsize = ((PyTypeObject *)result)->tp_itemsize;
+#else
+    py_basicsize = PyObject_GetAttrString(result, "__basicsize__");
+    if (!py_basicsize)
+        goto bad;
+    basicsize = PyLong_AsSsize_t(py_basicsize);
+    Py_DECREF(py_basicsize);
+    py_basicsize = 0;
+    if (basicsize == (Py_ssize_t)-1 && PyErr_Occurred())
+        goto bad;
+    py_itemsize = PyObject_GetAttrString(result, "__itemsize__");
+    if (!py_itemsize)
+        goto bad;
+    itemsize = PyLong_AsSsize_t(py_itemsize);
+    Py_DECREF(py_itemsize);
+    py_itemsize = 0;
+    if (itemsize == (Py_ssize_t)-1 && PyErr_Occurred())
+        goto bad;
+#endif
+    if (itemsize) {
+        if (size % alignment) {
+            alignment = size % alignment;
+        }
+        if (itemsize < (Py_ssize_t)alignment)
+            itemsize = (Py_ssize_t)alignment;
+    }
+    if ((size_t)(basicsize + itemsize) < size) {
+        PyErr_Format(PyExc_ValueError,
+            "%.200s.%.200s size changed, may indicate binary incompatibility. "
+            "Expected %zd from C header, got %zd from PyObject",
+            module_name, class_name, size, basicsize+itemsize);
+        goto bad;
+    }
+    if (check_size == __Pyx_ImportType_CheckSize_Error_3_0_0 &&
+            ((size_t)basicsize > size || (size_t)(basicsize + itemsize) < size)) {
+        PyErr_Format(PyExc_ValueError,
+            "%.200s.%.200s size changed, may indicate binary incompatibility. "
+            "Expected %zd from C header, got %zd-%zd from PyObject",
+            module_name, class_name, size, basicsize, basicsize+itemsize);
+        goto bad;
+    }
+    else if (check_size == __Pyx_ImportType_CheckSize_Warn_3_0_0 && (size_t)basicsize > size) {
+        PyOS_snprintf(warning, sizeof(warning),
+            "%s.%s size changed, may indicate binary incompatibility. "
+            "Expected %zd from C header, got %zd from PyObject",
+            module_name, class_name, size, basicsize);
+        if (PyErr_WarnEx(NULL, warning, 0) < 0) goto bad;
+    }
+    return (PyTypeObject *)result;
+bad:
+    Py_XDECREF(result);
+    return NULL;
+}
+#endif
+
+/* FixUpExtensionType */
+#if CYTHON_USE_TYPE_SPECS
+static int __Pyx_fix_up_extension_type_from_spec(PyType_Spec *spec, PyTypeObject *type) {
+#if PY_VERSION_HEX > 0x030900B1 || CYTHON_COMPILING_IN_LIMITED_API
+    CYTHON_UNUSED_VAR(spec);
+    CYTHON_UNUSED_VAR(type);
+#else
+    const PyType_Slot *slot = spec->slots;
+    while (slot && slot->slot && slot->slot != Py_tp_members)
+        slot++;
+    if (slot && slot->slot == Py_tp_members) {
+        int changed = 0;
+#if !(PY_VERSION_HEX <= 0x030900b1 && CYTHON_COMPILING_IN_CPYTHON)
+        const
+#endif
+            PyMemberDef *memb = (PyMemberDef*) slot->pfunc;
+        while (memb && memb->name) {
+            if (memb->name[0] == '_' && memb->name[1] == '_') {
+#if PY_VERSION_HEX < 0x030900b1
+                if (strcmp(memb->name, "__weaklistoffset__") == 0) {
+                    assert(memb->type == T_PYSSIZET);
+                    assert(memb->flags == READONLY);
+                    type->tp_weaklistoffset = memb->offset;
+                    changed = 1;
+                }
+                else if (strcmp(memb->name, "__dictoffset__") == 0) {
+                    assert(memb->type == T_PYSSIZET);
+                    assert(memb->flags == READONLY);
+                    type->tp_dictoffset = memb->offset;
+                    changed = 1;
+                }
+#if CYTHON_METH_FASTCALL
+                else if (strcmp(memb->name, "__vectorcalloffset__") == 0) {
+                    assert(memb->type == T_PYSSIZET);
+                    assert(memb->flags == READONLY);
+#if PY_VERSION_HEX >= 0x030800b4
+                    type->tp_vectorcall_offset = memb->offset;
+#else
+                    type->tp_print = (printfunc) memb->offset;
+#endif
+                    changed = 1;
+                }
+#endif
+#else
+                if ((0));
+#endif
+#if PY_VERSION_HEX <= 0x030900b1 && CYTHON_COMPILING_IN_CPYTHON
+                else if (strcmp(memb->name, "__module__") == 0) {
+                    PyObject *descr;
+                    assert(memb->type == T_OBJECT);
+                    assert(memb->flags == 0 || memb->flags == READONLY);
+                    descr = PyDescr_NewMember(type, memb);
+                    if (unlikely(!descr))
+                        return -1;
+                    if (unlikely(PyDict_SetItem(type->tp_dict, PyDescr_NAME(descr), descr) < 0)) {
+                        Py_DECREF(descr);
+                        return -1;
+                    }
+                    Py_DECREF(descr);
+                    changed = 1;
+                }
+#endif
+            }
+            memb++;
         }
+        if (changed)
+            PyType_Modified(type);
     }
-    return __Pyx_PyObject_Call(func, __pyx_empty_tuple, NULL);
+#endif
+    return 0;
 }
 #endif
 
-/* PyObjectCallMethod0 */
-static PyObject* __Pyx_PyObject_CallMethod0(PyObject* obj, PyObject* method_name) {
-    PyObject *method = NULL, *result = NULL;
-    int is_method = __Pyx_PyObject_GetMethod(obj, method_name, &method);
-    if (likely(is_method)) {
-        result = __Pyx_PyObject_CallOneArg(method, obj);
-        Py_DECREF(method);
-        return result;
+/* FetchSharedCythonModule */
+static PyObject *__Pyx_FetchSharedCythonABIModule(void) {
+    PyObject *abi_module = PyImport_AddModule((char*) __PYX_ABI_MODULE_NAME);
+    if (unlikely(!abi_module)) return NULL;
+    Py_INCREF(abi_module);
+    return abi_module;
+}
+
+/* FetchCommonType */
+static int __Pyx_VerifyCachedType(PyObject *cached_type,
+                               const char *name,
+                               Py_ssize_t basicsize,
+                               Py_ssize_t expected_basicsize) {
+    if (!PyType_Check(cached_type)) {
+        PyErr_Format(PyExc_TypeError,
+            "Shared Cython type %.200s is not a type object", name);
+        return -1;
     }
-    if (unlikely(!method)) goto bad;
-    result = __Pyx_PyObject_CallNoArg(method);
-    Py_DECREF(method);
+    if (basicsize != expected_basicsize) {
+        PyErr_Format(PyExc_TypeError,
+            "Shared Cython type %.200s has the wrong size, try recompiling",
+            name);
+        return -1;
+    }
+    return 0;
+}
+#if !CYTHON_USE_TYPE_SPECS
+static PyTypeObject* __Pyx_FetchCommonType(PyTypeObject* type) {
+    PyObject* abi_module;
+    const char* object_name;
+    PyTypeObject *cached_type = NULL;
+    abi_module = __Pyx_FetchSharedCythonABIModule();
+    if (!abi_module) return NULL;
+    object_name = strrchr(type->tp_name, '.');
+    object_name = object_name ? object_name+1 : type->tp_name;
+    cached_type = (PyTypeObject*) PyObject_GetAttrString(abi_module, object_name);
+    if (cached_type) {
+        if (__Pyx_VerifyCachedType(
+              (PyObject *)cached_type,
+              object_name,
+              cached_type->tp_basicsize,
+              type->tp_basicsize) < 0) {
+            goto bad;
+        }
+        goto done;
+    }
+    if (!PyErr_ExceptionMatches(PyExc_AttributeError)) goto bad;
+    PyErr_Clear();
+    if (PyType_Ready(type) < 0) goto bad;
+    if (PyObject_SetAttrString(abi_module, object_name, (PyObject *)type) < 0)
+        goto bad;
+    Py_INCREF(type);
+    cached_type = type;
+done:
+    Py_DECREF(abi_module);
+    return cached_type;
 bad:
-    return result;
+    Py_XDECREF(cached_type);
+    cached_type = NULL;
+    goto done;
+}
+#else
+static PyTypeObject *__Pyx_FetchCommonTypeFromSpec(PyObject *module, PyType_Spec *spec, PyObject *bases) {
+    PyObject *abi_module, *cached_type = NULL;
+    const char* object_name = strrchr(spec->name, '.');
+    object_name = object_name ? object_name+1 : spec->name;
+    abi_module = __Pyx_FetchSharedCythonABIModule();
+    if (!abi_module) return NULL;
+    cached_type = PyObject_GetAttrString(abi_module, object_name);
+    if (cached_type) {
+        Py_ssize_t basicsize;
+#if CYTHON_COMPILING_IN_LIMITED_API
+        PyObject *py_basicsize;
+        py_basicsize = PyObject_GetAttrString(cached_type, "__basicsize__");
+        if (unlikely(!py_basicsize)) goto bad;
+        basicsize = PyLong_AsSsize_t(py_basicsize);
+        Py_DECREF(py_basicsize);
+        py_basicsize = 0;
+        if (unlikely(basicsize == (Py_ssize_t)-1) && PyErr_Occurred()) goto bad;
+#else
+        basicsize = likely(PyType_Check(cached_type)) ? ((PyTypeObject*) cached_type)->tp_basicsize : -1;
+#endif
+        if (__Pyx_VerifyCachedType(
+              cached_type,
+              object_name,
+              basicsize,
+              spec->basicsize) < 0) {
+            goto bad;
+        }
+        goto done;
+    }
+    if (!PyErr_ExceptionMatches(PyExc_AttributeError)) goto bad;
+    PyErr_Clear();
+    CYTHON_UNUSED_VAR(module);
+    cached_type = __Pyx_PyType_FromModuleAndSpec(abi_module, spec, bases);
+    if (unlikely(!cached_type)) goto bad;
+    if (unlikely(__Pyx_fix_up_extension_type_from_spec(spec, (PyTypeObject *) cached_type) < 0)) goto bad;
+    if (PyObject_SetAttrString(abi_module, object_name, cached_type) < 0) goto bad;
+done:
+    Py_DECREF(abi_module);
+    assert(cached_type == NULL || PyType_Check(cached_type));
+    return (PyTypeObject *) cached_type;
+bad:
+    Py_XDECREF(cached_type);
+    cached_type = NULL;
+    goto done;
+}
+#endif
+
+/* PyVectorcallFastCallDict */
+#if CYTHON_METH_FASTCALL
+static PyObject *__Pyx_PyVectorcall_FastCallDict_kw(PyObject *func, __pyx_vectorcallfunc vc, PyObject *const *args, size_t nargs, PyObject *kw)
+{
+    PyObject *res = NULL;
+    PyObject *kwnames;
+    PyObject **newargs;
+    PyObject **kwvalues;
+    Py_ssize_t i, pos;
+    size_t j;
+    PyObject *key, *value;
+    unsigned long keys_are_strings;
+    Py_ssize_t nkw = PyDict_GET_SIZE(kw);
+    newargs = (PyObject **)PyMem_Malloc((nargs + (size_t)nkw) * sizeof(args[0]));
+    if (unlikely(newargs == NULL)) {
+        PyErr_NoMemory();
+        return NULL;
+    }
+    for (j = 0; j < nargs; j++) newargs[j] = args[j];
+    kwnames = PyTuple_New(nkw);
+    if (unlikely(kwnames == NULL)) {
+        PyMem_Free(newargs);
+        return NULL;
+    }
+    kwvalues = newargs + nargs;
+    pos = i = 0;
+    keys_are_strings = Py_TPFLAGS_UNICODE_SUBCLASS;
+    while (PyDict_Next(kw, &pos, &key, &value)) {
+        keys_are_strings &= Py_TYPE(key)->tp_flags;
+        Py_INCREF(key);
+        Py_INCREF(value);
+        PyTuple_SET_ITEM(kwnames, i, key);
+        kwvalues[i] = value;
+        i++;
+    }
+    if (unlikely(!keys_are_strings)) {
+        PyErr_SetString(PyExc_TypeError, "keywords must be strings");
+        goto cleanup;
+    }
+    res = vc(func, newargs, nargs, kwnames);
+cleanup:
+    Py_DECREF(kwnames);
+    for (i = 0; i < nkw; i++)
+        Py_DECREF(kwvalues[i]);
+    PyMem_Free(newargs);
+    return res;
 }
+static CYTHON_INLINE PyObject *__Pyx_PyVectorcall_FastCallDict(PyObject *func, __pyx_vectorcallfunc vc, PyObject *const *args, size_t nargs, PyObject *kw)
+{
+    if (likely(kw == NULL) || PyDict_GET_SIZE(kw) == 0) {
+        return vc(func, args, nargs, NULL);
+    }
+    return __Pyx_PyVectorcall_FastCallDict_kw(func, vc, args, nargs, kw);
+}
+#endif
 
-/* UnpackUnboundCMethod */
-static int __Pyx_TryUnpackUnboundCMethod(__Pyx_CachedCFunction* target) {
-    PyObject *method;
-    method = __Pyx_PyObject_GetAttrStr(target->type, *target->method_name);
-    if (unlikely(!method))
+/* CythonFunctionShared */
+static CYTHON_INLINE void __Pyx__CyFunction_SetClassObj(__pyx_CyFunctionObject* f, PyObject* classobj) {
+#if PY_VERSION_HEX < 0x030900B1
+    __Pyx_Py_XDECREF_SET(
+        __Pyx_CyFunction_GetClassObj(f),
+            ((classobj) ? __Pyx_NewRef(classobj) : NULL));
+#else
+    __Pyx_Py_XDECREF_SET(
+        ((PyCMethodObject *) (f))->mm_class,
+        (PyTypeObject*)((classobj) ? __Pyx_NewRef(classobj) : NULL));
+#endif
+}
+static PyObject *
+__Pyx_CyFunction_get_doc(__pyx_CyFunctionObject *op, void *closure)
+{
+    CYTHON_UNUSED_VAR(closure);
+    if (unlikely(op->func_doc == NULL)) {
+        if (((PyCFunctionObject*)op)->m_ml->ml_doc) {
+#if PY_MAJOR_VERSION >= 3
+            op->func_doc = PyUnicode_FromString(((PyCFunctionObject*)op)->m_ml->ml_doc);
+#else
+            op->func_doc = PyString_FromString(((PyCFunctionObject*)op)->m_ml->ml_doc);
+#endif
+            if (unlikely(op->func_doc == NULL))
+                return NULL;
+        } else {
+            Py_INCREF(Py_None);
+            return Py_None;
+        }
+    }
+    Py_INCREF(op->func_doc);
+    return op->func_doc;
+}
+static int
+__Pyx_CyFunction_set_doc(__pyx_CyFunctionObject *op, PyObject *value, void *context)
+{
+    CYTHON_UNUSED_VAR(context);
+    if (value == NULL) {
+        value = Py_None;
+    }
+    Py_INCREF(value);
+    __Pyx_Py_XDECREF_SET(op->func_doc, value);
+    return 0;
+}
+static PyObject *
+__Pyx_CyFunction_get_name(__pyx_CyFunctionObject *op, void *context)
+{
+    CYTHON_UNUSED_VAR(context);
+    if (unlikely(op->func_name == NULL)) {
+#if PY_MAJOR_VERSION >= 3
+        op->func_name = PyUnicode_InternFromString(((PyCFunctionObject*)op)->m_ml->ml_name);
+#else
+        op->func_name = PyString_InternFromString(((PyCFunctionObject*)op)->m_ml->ml_name);
+#endif
+        if (unlikely(op->func_name == NULL))
+            return NULL;
+    }
+    Py_INCREF(op->func_name);
+    return op->func_name;
+}
+static int
+__Pyx_CyFunction_set_name(__pyx_CyFunctionObject *op, PyObject *value, void *context)
+{
+    CYTHON_UNUSED_VAR(context);
+#if PY_MAJOR_VERSION >= 3
+    if (unlikely(value == NULL || !PyUnicode_Check(value)))
+#else
+    if (unlikely(value == NULL || !PyString_Check(value)))
+#endif
+    {
+        PyErr_SetString(PyExc_TypeError,
+                        "__name__ must be set to a string object");
         return -1;
-    target->method = method;
-#if CYTHON_COMPILING_IN_CPYTHON
-    #if PY_MAJOR_VERSION >= 3
-    if (likely(__Pyx_TypeCheck(method, &PyMethodDescr_Type)))
-    #endif
+    }
+    Py_INCREF(value);
+    __Pyx_Py_XDECREF_SET(op->func_name, value);
+    return 0;
+}
+static PyObject *
+__Pyx_CyFunction_get_qualname(__pyx_CyFunctionObject *op, void *context)
+{
+    CYTHON_UNUSED_VAR(context);
+    Py_INCREF(op->func_qualname);
+    return op->func_qualname;
+}
+static int
+__Pyx_CyFunction_set_qualname(__pyx_CyFunctionObject *op, PyObject *value, void *context)
+{
+    CYTHON_UNUSED_VAR(context);
+#if PY_MAJOR_VERSION >= 3
+    if (unlikely(value == NULL || !PyUnicode_Check(value)))
+#else
+    if (unlikely(value == NULL || !PyString_Check(value)))
+#endif
     {
-        PyMethodDescrObject *descr = (PyMethodDescrObject*) method;
-        target->func = descr->d_method->ml_meth;
-        target->flag = descr->d_method->ml_flags & ~(METH_CLASS | METH_STATIC | METH_COEXIST | METH_STACKLESS);
+        PyErr_SetString(PyExc_TypeError,
+                        "__qualname__ must be set to a string object");
+        return -1;
+    }
+    Py_INCREF(value);
+    __Pyx_Py_XDECREF_SET(op->func_qualname, value);
+    return 0;
+}
+static PyObject *
+__Pyx_CyFunction_get_dict(__pyx_CyFunctionObject *op, void *context)
+{
+    CYTHON_UNUSED_VAR(context);
+    if (unlikely(op->func_dict == NULL)) {
+        op->func_dict = PyDict_New();
+        if (unlikely(op->func_dict == NULL))
+            return NULL;
+    }
+    Py_INCREF(op->func_dict);
+    return op->func_dict;
+}
+static int
+__Pyx_CyFunction_set_dict(__pyx_CyFunctionObject *op, PyObject *value, void *context)
+{
+    CYTHON_UNUSED_VAR(context);
+    if (unlikely(value == NULL)) {
+        PyErr_SetString(PyExc_TypeError,
+               "function's dictionary may not be deleted");
+        return -1;
+    }
+    if (unlikely(!PyDict_Check(value))) {
+        PyErr_SetString(PyExc_TypeError,
+               "setting function's dictionary to a non-dict");
+        return -1;
+    }
+    Py_INCREF(value);
+    __Pyx_Py_XDECREF_SET(op->func_dict, value);
+    return 0;
+}
+static PyObject *
+__Pyx_CyFunction_get_globals(__pyx_CyFunctionObject *op, void *context)
+{
+    CYTHON_UNUSED_VAR(context);
+    Py_INCREF(op->func_globals);
+    return op->func_globals;
+}
+static PyObject *
+__Pyx_CyFunction_get_closure(__pyx_CyFunctionObject *op, void *context)
+{
+    CYTHON_UNUSED_VAR(op);
+    CYTHON_UNUSED_VAR(context);
+    Py_INCREF(Py_None);
+    return Py_None;
+}
+static PyObject *
+__Pyx_CyFunction_get_code(__pyx_CyFunctionObject *op, void *context)
+{
+    PyObject* result = (op->func_code) ? op->func_code : Py_None;
+    CYTHON_UNUSED_VAR(context);
+    Py_INCREF(result);
+    return result;
+}
+static int
+__Pyx_CyFunction_init_defaults(__pyx_CyFunctionObject *op) {
+    int result = 0;
+    PyObject *res = op->defaults_getter((PyObject *) op);
+    if (unlikely(!res))
+        return -1;
+    #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
+    op->defaults_tuple = PyTuple_GET_ITEM(res, 0);
+    Py_INCREF(op->defaults_tuple);
+    op->defaults_kwdict = PyTuple_GET_ITEM(res, 1);
+    Py_INCREF(op->defaults_kwdict);
+    #else
+    op->defaults_tuple = PySequence_ITEM(res, 0);
+    if (unlikely(!op->defaults_tuple)) result = -1;
+    else {
+        op->defaults_kwdict = PySequence_ITEM(res, 1);
+        if (unlikely(!op->defaults_kwdict)) result = -1;
+    }
+    #endif
+    Py_DECREF(res);
+    return result;
+}
+static int
+__Pyx_CyFunction_set_defaults(__pyx_CyFunctionObject *op, PyObject* value, void *context) {
+    CYTHON_UNUSED_VAR(context);
+    if (!value) {
+        value = Py_None;
+    } else if (unlikely(value != Py_None && !PyTuple_Check(value))) {
+        PyErr_SetString(PyExc_TypeError,
+                        "__defaults__ must be set to a tuple object");
+        return -1;
+    }
+    PyErr_WarnEx(PyExc_RuntimeWarning, "changes to cyfunction.__defaults__ will not "
+                 "currently affect the values used in function calls", 1);
+    Py_INCREF(value);
+    __Pyx_Py_XDECREF_SET(op->defaults_tuple, value);
+    return 0;
+}
+static PyObject *
+__Pyx_CyFunction_get_defaults(__pyx_CyFunctionObject *op, void *context) {
+    PyObject* result = op->defaults_tuple;
+    CYTHON_UNUSED_VAR(context);
+    if (unlikely(!result)) {
+        if (op->defaults_getter) {
+            if (unlikely(__Pyx_CyFunction_init_defaults(op) < 0)) return NULL;
+            result = op->defaults_tuple;
+        } else {
+            result = Py_None;
+        }
+    }
+    Py_INCREF(result);
+    return result;
+}
+static int
+__Pyx_CyFunction_set_kwdefaults(__pyx_CyFunctionObject *op, PyObject* value, void *context) {
+    CYTHON_UNUSED_VAR(context);
+    if (!value) {
+        value = Py_None;
+    } else if (unlikely(value != Py_None && !PyDict_Check(value))) {
+        PyErr_SetString(PyExc_TypeError,
+                        "__kwdefaults__ must be set to a dict object");
+        return -1;
+    }
+    PyErr_WarnEx(PyExc_RuntimeWarning, "changes to cyfunction.__kwdefaults__ will not "
+                 "currently affect the values used in function calls", 1);
+    Py_INCREF(value);
+    __Pyx_Py_XDECREF_SET(op->defaults_kwdict, value);
+    return 0;
+}
+static PyObject *
+__Pyx_CyFunction_get_kwdefaults(__pyx_CyFunctionObject *op, void *context) {
+    PyObject* result = op->defaults_kwdict;
+    CYTHON_UNUSED_VAR(context);
+    if (unlikely(!result)) {
+        if (op->defaults_getter) {
+            if (unlikely(__Pyx_CyFunction_init_defaults(op) < 0)) return NULL;
+            result = op->defaults_kwdict;
+        } else {
+            result = Py_None;
+        }
+    }
+    Py_INCREF(result);
+    return result;
+}
+static int
+__Pyx_CyFunction_set_annotations(__pyx_CyFunctionObject *op, PyObject* value, void *context) {
+    CYTHON_UNUSED_VAR(context);
+    if (!value || value == Py_None) {
+        value = NULL;
+    } else if (unlikely(!PyDict_Check(value))) {
+        PyErr_SetString(PyExc_TypeError,
+                        "__annotations__ must be set to a dict object");
+        return -1;
+    }
+    Py_XINCREF(value);
+    __Pyx_Py_XDECREF_SET(op->func_annotations, value);
+    return 0;
+}
+static PyObject *
+__Pyx_CyFunction_get_annotations(__pyx_CyFunctionObject *op, void *context) {
+    PyObject* result = op->func_annotations;
+    CYTHON_UNUSED_VAR(context);
+    if (unlikely(!result)) {
+        result = PyDict_New();
+        if (unlikely(!result)) return NULL;
+        op->func_annotations = result;
+    }
+    Py_INCREF(result);
+    return result;
+}
+static PyObject *
+__Pyx_CyFunction_get_is_coroutine(__pyx_CyFunctionObject *op, void *context) {
+    int is_coroutine;
+    CYTHON_UNUSED_VAR(context);
+    if (op->func_is_coroutine) {
+        return __Pyx_NewRef(op->func_is_coroutine);
+    }
+    is_coroutine = op->flags & __Pyx_CYFUNCTION_COROUTINE;
+#if PY_VERSION_HEX >= 0x03050000
+    if (is_coroutine) {
+        PyObject *module, *fromlist, *marker = __pyx_n_s_is_coroutine;
+        fromlist = PyList_New(1);
+        if (unlikely(!fromlist)) return NULL;
+        Py_INCREF(marker);
+        PyList_SET_ITEM(fromlist, 0, marker);
+        module = PyImport_ImportModuleLevelObject(__pyx_n_s_asyncio_coroutines, NULL, NULL, fromlist, 0);
+        Py_DECREF(fromlist);
+        if (unlikely(!module)) goto ignore;
+        op->func_is_coroutine = __Pyx_PyObject_GetAttrStr(module, marker);
+        Py_DECREF(module);
+        if (likely(op->func_is_coroutine)) {
+            return __Pyx_NewRef(op->func_is_coroutine);
+        }
+ignore:
+        PyErr_Clear();
+    }
+#endif
+    op->func_is_coroutine = __Pyx_PyBool_FromLong(is_coroutine);
+    return __Pyx_NewRef(op->func_is_coroutine);
+}
+static PyGetSetDef __pyx_CyFunction_getsets[] = {
+    {(char *) "func_doc", (getter)__Pyx_CyFunction_get_doc, (setter)__Pyx_CyFunction_set_doc, 0, 0},
+    {(char *) "__doc__",  (getter)__Pyx_CyFunction_get_doc, (setter)__Pyx_CyFunction_set_doc, 0, 0},
+    {(char *) "func_name", (getter)__Pyx_CyFunction_get_name, (setter)__Pyx_CyFunction_set_name, 0, 0},
+    {(char *) "__name__", (getter)__Pyx_CyFunction_get_name, (setter)__Pyx_CyFunction_set_name, 0, 0},
+    {(char *) "__qualname__", (getter)__Pyx_CyFunction_get_qualname, (setter)__Pyx_CyFunction_set_qualname, 0, 0},
+    {(char *) "func_dict", (getter)__Pyx_CyFunction_get_dict, (setter)__Pyx_CyFunction_set_dict, 0, 0},
+    {(char *) "__dict__", (getter)__Pyx_CyFunction_get_dict, (setter)__Pyx_CyFunction_set_dict, 0, 0},
+    {(char *) "func_globals", (getter)__Pyx_CyFunction_get_globals, 0, 0, 0},
+    {(char *) "__globals__", (getter)__Pyx_CyFunction_get_globals, 0, 0, 0},
+    {(char *) "func_closure", (getter)__Pyx_CyFunction_get_closure, 0, 0, 0},
+    {(char *) "__closure__", (getter)__Pyx_CyFunction_get_closure, 0, 0, 0},
+    {(char *) "func_code", (getter)__Pyx_CyFunction_get_code, 0, 0, 0},
+    {(char *) "__code__", (getter)__Pyx_CyFunction_get_code, 0, 0, 0},
+    {(char *) "func_defaults", (getter)__Pyx_CyFunction_get_defaults, (setter)__Pyx_CyFunction_set_defaults, 0, 0},
+    {(char *) "__defaults__", (getter)__Pyx_CyFunction_get_defaults, (setter)__Pyx_CyFunction_set_defaults, 0, 0},
+    {(char *) "__kwdefaults__", (getter)__Pyx_CyFunction_get_kwdefaults, (setter)__Pyx_CyFunction_set_kwdefaults, 0, 0},
+    {(char *) "__annotations__", (getter)__Pyx_CyFunction_get_annotations, (setter)__Pyx_CyFunction_set_annotations, 0, 0},
+    {(char *) "_is_coroutine", (getter)__Pyx_CyFunction_get_is_coroutine, 0, 0, 0},
+    {0, 0, 0, 0, 0}
+};
+static PyMemberDef __pyx_CyFunction_members[] = {
+    {(char *) "__module__", T_OBJECT, offsetof(PyCFunctionObject, m_module), 0, 0},
+#if CYTHON_USE_TYPE_SPECS
+    {(char *) "__dictoffset__", T_PYSSIZET, offsetof(__pyx_CyFunctionObject, func_dict), READONLY, 0},
+#if CYTHON_METH_FASTCALL
+#if CYTHON_BACKPORT_VECTORCALL
+    {(char *) "__vectorcalloffset__", T_PYSSIZET, offsetof(__pyx_CyFunctionObject, func_vectorcall), READONLY, 0},
+#else
+    {(char *) "__vectorcalloffset__", T_PYSSIZET, offsetof(PyCFunctionObject, vectorcall), READONLY, 0},
+#endif
+#endif
+#if PY_VERSION_HEX < 0x030500A0
+    {(char *) "__weaklistoffset__", T_PYSSIZET, offsetof(__pyx_CyFunctionObject, func_weakreflist), READONLY, 0},
+#else
+    {(char *) "__weaklistoffset__", T_PYSSIZET, offsetof(PyCFunctionObject, m_weakreflist), READONLY, 0},
+#endif
+#endif
+    {0, 0, 0,  0, 0}
+};
+static PyObject *
+__Pyx_CyFunction_reduce(__pyx_CyFunctionObject *m, PyObject *args)
+{
+    CYTHON_UNUSED_VAR(args);
+#if PY_MAJOR_VERSION >= 3
+    Py_INCREF(m->func_qualname);
+    return m->func_qualname;
+#else
+    return PyString_FromString(((PyCFunctionObject*)m)->m_ml->ml_name);
+#endif
+}
+static PyMethodDef __pyx_CyFunction_methods[] = {
+    {"__reduce__", (PyCFunction)__Pyx_CyFunction_reduce, METH_VARARGS, 0},
+    {0, 0, 0, 0}
+};
+#if PY_VERSION_HEX < 0x030500A0
+#define __Pyx_CyFunction_weakreflist(cyfunc) ((cyfunc)->func_weakreflist)
+#else
+#define __Pyx_CyFunction_weakreflist(cyfunc) (((PyCFunctionObject*)cyfunc)->m_weakreflist)
+#endif
+static PyObject *__Pyx_CyFunction_Init(__pyx_CyFunctionObject *op, PyMethodDef *ml, int flags, PyObject* qualname,
+                                       PyObject *closure, PyObject *module, PyObject* globals, PyObject* code) {
+    PyCFunctionObject *cf = (PyCFunctionObject*) op;
+    if (unlikely(op == NULL))
+        return NULL;
+    op->flags = flags;
+    __Pyx_CyFunction_weakreflist(op) = NULL;
+    cf->m_ml = ml;
+    cf->m_self = (PyObject *) op;
+    Py_XINCREF(closure);
+    op->func_closure = closure;
+    Py_XINCREF(module);
+    cf->m_module = module;
+    op->func_dict = NULL;
+    op->func_name = NULL;
+    Py_INCREF(qualname);
+    op->func_qualname = qualname;
+    op->func_doc = NULL;
+#if PY_VERSION_HEX < 0x030900B1
+    op->func_classobj = NULL;
+#else
+    ((PyCMethodObject*)op)->mm_class = NULL;
+#endif
+    op->func_globals = globals;
+    Py_INCREF(op->func_globals);
+    Py_XINCREF(code);
+    op->func_code = code;
+    op->defaults_pyobjects = 0;
+    op->defaults_size = 0;
+    op->defaults = NULL;
+    op->defaults_tuple = NULL;
+    op->defaults_kwdict = NULL;
+    op->defaults_getter = NULL;
+    op->func_annotations = NULL;
+    op->func_is_coroutine = NULL;
+#if CYTHON_METH_FASTCALL
+    switch (ml->ml_flags & (METH_VARARGS | METH_FASTCALL | METH_NOARGS | METH_O | METH_KEYWORDS | METH_METHOD)) {
+    case METH_NOARGS:
+        __Pyx_CyFunction_func_vectorcall(op) = __Pyx_CyFunction_Vectorcall_NOARGS;
+        break;
+    case METH_O:
+        __Pyx_CyFunction_func_vectorcall(op) = __Pyx_CyFunction_Vectorcall_O;
+        break;
+    case METH_METHOD | METH_FASTCALL | METH_KEYWORDS:
+        __Pyx_CyFunction_func_vectorcall(op) = __Pyx_CyFunction_Vectorcall_FASTCALL_KEYWORDS_METHOD;
+        break;
+    case METH_FASTCALL | METH_KEYWORDS:
+        __Pyx_CyFunction_func_vectorcall(op) = __Pyx_CyFunction_Vectorcall_FASTCALL_KEYWORDS;
+        break;
+    case METH_VARARGS | METH_KEYWORDS:
+        __Pyx_CyFunction_func_vectorcall(op) = NULL;
+        break;
+    default:
+        PyErr_SetString(PyExc_SystemError, "Bad call flags for CyFunction");
+        Py_DECREF(op);
+        return NULL;
     }
 #endif
+    return (PyObject *) op;
+}
+static int
+__Pyx_CyFunction_clear(__pyx_CyFunctionObject *m)
+{
+    Py_CLEAR(m->func_closure);
+    Py_CLEAR(((PyCFunctionObject*)m)->m_module);
+    Py_CLEAR(m->func_dict);
+    Py_CLEAR(m->func_name);
+    Py_CLEAR(m->func_qualname);
+    Py_CLEAR(m->func_doc);
+    Py_CLEAR(m->func_globals);
+    Py_CLEAR(m->func_code);
+#if PY_VERSION_HEX < 0x030900B1
+    Py_CLEAR(__Pyx_CyFunction_GetClassObj(m));
+#else
+    {
+        PyObject *cls = (PyObject*) ((PyCMethodObject *) (m))->mm_class;
+        ((PyCMethodObject *) (m))->mm_class = NULL;
+        Py_XDECREF(cls);
+    }
+#endif
+    Py_CLEAR(m->defaults_tuple);
+    Py_CLEAR(m->defaults_kwdict);
+    Py_CLEAR(m->func_annotations);
+    Py_CLEAR(m->func_is_coroutine);
+    if (m->defaults) {
+        PyObject **pydefaults = __Pyx_CyFunction_Defaults(PyObject *, m);
+        int i;
+        for (i = 0; i < m->defaults_pyobjects; i++)
+            Py_XDECREF(pydefaults[i]);
+        PyObject_Free(m->defaults);
+        m->defaults = NULL;
+    }
     return 0;
 }
-
-/* CallUnboundCMethod0 */
-static PyObject* __Pyx__CallUnboundCMethod0(__Pyx_CachedCFunction* cfunc, PyObject* self) {
-    PyObject *args, *result = NULL;
-    if (unlikely(!cfunc->method) && unlikely(__Pyx_TryUnpackUnboundCMethod(cfunc) < 0)) return NULL;
+static void __Pyx__CyFunction_dealloc(__pyx_CyFunctionObject *m)
+{
+    if (__Pyx_CyFunction_weakreflist(m) != NULL)
+        PyObject_ClearWeakRefs((PyObject *) m);
+    __Pyx_CyFunction_clear(m);
+    __Pyx_PyHeapTypeObject_GC_Del(m);
+}
+static void __Pyx_CyFunction_dealloc(__pyx_CyFunctionObject *m)
+{
+    PyObject_GC_UnTrack(m);
+    __Pyx__CyFunction_dealloc(m);
+}
+static int __Pyx_CyFunction_traverse(__pyx_CyFunctionObject *m, visitproc visit, void *arg)
+{
+    Py_VISIT(m->func_closure);
+    Py_VISIT(((PyCFunctionObject*)m)->m_module);
+    Py_VISIT(m->func_dict);
+    Py_VISIT(m->func_name);
+    Py_VISIT(m->func_qualname);
+    Py_VISIT(m->func_doc);
+    Py_VISIT(m->func_globals);
+    Py_VISIT(m->func_code);
+    Py_VISIT(__Pyx_CyFunction_GetClassObj(m));
+    Py_VISIT(m->defaults_tuple);
+    Py_VISIT(m->defaults_kwdict);
+    Py_VISIT(m->func_is_coroutine);
+    if (m->defaults) {
+        PyObject **pydefaults = __Pyx_CyFunction_Defaults(PyObject *, m);
+        int i;
+        for (i = 0; i < m->defaults_pyobjects; i++)
+            Py_VISIT(pydefaults[i]);
+    }
+    return 0;
+}
+static PyObject*
+__Pyx_CyFunction_repr(__pyx_CyFunctionObject *op)
+{
+#if PY_MAJOR_VERSION >= 3
+    return PyUnicode_FromFormat("<cyfunction %U at %p>",
+                                op->func_qualname, (void *)op);
+#else
+    return PyString_FromFormat("<cyfunction %s at %p>",
+                               PyString_AsString(op->func_qualname), (void *)op);
+#endif
+}
+static PyObject * __Pyx_CyFunction_CallMethod(PyObject *func, PyObject *self, PyObject *arg, PyObject *kw) {
+    PyCFunctionObject* f = (PyCFunctionObject*)func;
+    PyCFunction meth = f->m_ml->ml_meth;
+    Py_ssize_t size;
+    switch (f->m_ml->ml_flags & (METH_VARARGS | METH_KEYWORDS | METH_NOARGS | METH_O)) {
+    case METH_VARARGS:
+        if (likely(kw == NULL || PyDict_Size(kw) == 0))
+            return (*meth)(self, arg);
+        break;
+    case METH_VARARGS | METH_KEYWORDS:
+        return (*(PyCFunctionWithKeywords)(void*)meth)(self, arg, kw);
+    case METH_NOARGS:
+        if (likely(kw == NULL || PyDict_Size(kw) == 0)) {
+            size = PyTuple_GET_SIZE(arg);
+            if (likely(size == 0))
+                return (*meth)(self, NULL);
+            PyErr_Format(PyExc_TypeError,
+                "%.200s() takes no arguments (%" CYTHON_FORMAT_SSIZE_T "d given)",
+                f->m_ml->ml_name, size);
+            return NULL;
+        }
+        break;
+    case METH_O:
+        if (likely(kw == NULL || PyDict_Size(kw) == 0)) {
+            size = PyTuple_GET_SIZE(arg);
+            if (likely(size == 1)) {
+                PyObject *result, *arg0;
+                #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
+                arg0 = PyTuple_GET_ITEM(arg, 0);
+                #else
+                arg0 = PySequence_ITEM(arg, 0); if (unlikely(!arg0)) return NULL;
+                #endif
+                result = (*meth)(self, arg0);
+                #if !(CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS)
+                Py_DECREF(arg0);
+                #endif
+                return result;
+            }
+            PyErr_Format(PyExc_TypeError,
+                "%.200s() takes exactly one argument (%" CYTHON_FORMAT_SSIZE_T "d given)",
+                f->m_ml->ml_name, size);
+            return NULL;
+        }
+        break;
+    default:
+        PyErr_SetString(PyExc_SystemError, "Bad call flags for CyFunction");
+        return NULL;
+    }
+    PyErr_Format(PyExc_TypeError, "%.200s() takes no keyword arguments",
+                 f->m_ml->ml_name);
+    return NULL;
+}
+static CYTHON_INLINE PyObject *__Pyx_CyFunction_Call(PyObject *func, PyObject *arg, PyObject *kw) {
+    return __Pyx_CyFunction_CallMethod(func, ((PyCFunctionObject*)func)->m_self, arg, kw);
+}
+static PyObject *__Pyx_CyFunction_CallAsMethod(PyObject *func, PyObject *args, PyObject *kw) {
+    PyObject *result;
+    __pyx_CyFunctionObject *cyfunc = (__pyx_CyFunctionObject *) func;
+#if CYTHON_METH_FASTCALL
+     __pyx_vectorcallfunc vc = __Pyx_CyFunction_func_vectorcall(cyfunc);
+    if (vc) {
 #if CYTHON_ASSUME_SAFE_MACROS
-    args = PyTuple_New(1);
-    if (unlikely(!args)) goto bad;
-    Py_INCREF(self);
-    PyTuple_SET_ITEM(args, 0, self);
+        return __Pyx_PyVectorcall_FastCallDict(func, vc, &PyTuple_GET_ITEM(args, 0), (size_t)PyTuple_GET_SIZE(args), kw);
 #else
-    args = PyTuple_Pack(1, self);
-    if (unlikely(!args)) goto bad;
+        (void) &__Pyx_PyVectorcall_FastCallDict;
+        return PyVectorcall_Call(func, args, kw);
 #endif
-    result = __Pyx_PyObject_Call(cfunc->method, args, NULL);
-    Py_DECREF(args);
-bad:
+    }
+#endif
+    if ((cyfunc->flags & __Pyx_CYFUNCTION_CCLASS) && !(cyfunc->flags & __Pyx_CYFUNCTION_STATICMETHOD)) {
+        Py_ssize_t argc;
+        PyObject *new_args;
+        PyObject *self;
+        argc = PyTuple_GET_SIZE(args);
+        new_args = PyTuple_GetSlice(args, 1, argc);
+        if (unlikely(!new_args))
+            return NULL;
+        self = PyTuple_GetItem(args, 0);
+        if (unlikely(!self)) {
+            Py_DECREF(new_args);
+#if PY_MAJOR_VERSION > 2
+            PyErr_Format(PyExc_TypeError,
+                         "unbound method %.200S() needs an argument",
+                         cyfunc->func_qualname);
+#else
+            PyErr_SetString(PyExc_TypeError,
+                            "unbound method needs an argument");
+#endif
+            return NULL;
+        }
+        result = __Pyx_CyFunction_CallMethod(func, self, new_args, kw);
+        Py_DECREF(new_args);
+    } else {
+        result = __Pyx_CyFunction_Call(func, args, kw);
+    }
     return result;
 }
-
-/* pop */
-static CYTHON_INLINE PyObject* __Pyx__PyObject_Pop(PyObject* L) {
-    if (Py_TYPE(L) == &PySet_Type) {
-        return PySet_Pop(L);
+#if CYTHON_METH_FASTCALL
+static CYTHON_INLINE int __Pyx_CyFunction_Vectorcall_CheckArgs(__pyx_CyFunctionObject *cyfunc, Py_ssize_t nargs, PyObject *kwnames)
+{
+    int ret = 0;
+    if ((cyfunc->flags & __Pyx_CYFUNCTION_CCLASS) && !(cyfunc->flags & __Pyx_CYFUNCTION_STATICMETHOD)) {
+        if (unlikely(nargs < 1)) {
+            PyErr_Format(PyExc_TypeError, "%.200s() needs an argument",
+                         ((PyCFunctionObject*)cyfunc)->m_ml->ml_name);
+            return -1;
+        }
+        ret = 1;
+    }
+    if (unlikely(kwnames) && unlikely(PyTuple_GET_SIZE(kwnames))) {
+        PyErr_Format(PyExc_TypeError,
+                     "%.200s() takes no keyword arguments", ((PyCFunctionObject*)cyfunc)->m_ml->ml_name);
+        return -1;
+    }
+    return ret;
+}
+static PyObject * __Pyx_CyFunction_Vectorcall_NOARGS(PyObject *func, PyObject *const *args, size_t nargsf, PyObject *kwnames)
+{
+    __pyx_CyFunctionObject *cyfunc = (__pyx_CyFunctionObject *)func;
+    PyMethodDef* def = ((PyCFunctionObject*)cyfunc)->m_ml;
+#if CYTHON_BACKPORT_VECTORCALL
+    Py_ssize_t nargs = (Py_ssize_t)nargsf;
+#else
+    Py_ssize_t nargs = PyVectorcall_NARGS(nargsf);
+#endif
+    PyObject *self;
+    switch (__Pyx_CyFunction_Vectorcall_CheckArgs(cyfunc, nargs, kwnames)) {
+    case 1:
+        self = args[0];
+        args += 1;
+        nargs -= 1;
+        break;
+    case 0:
+        self = ((PyCFunctionObject*)cyfunc)->m_self;
+        break;
+    default:
+        return NULL;
+    }
+    if (unlikely(nargs != 0)) {
+        PyErr_Format(PyExc_TypeError,
+            "%.200s() takes no arguments (%" CYTHON_FORMAT_SSIZE_T "d given)",
+            def->ml_name, nargs);
+        return NULL;
+    }
+    return def->ml_meth(self, NULL);
+}
+static PyObject * __Pyx_CyFunction_Vectorcall_O(PyObject *func, PyObject *const *args, size_t nargsf, PyObject *kwnames)
+{
+    __pyx_CyFunctionObject *cyfunc = (__pyx_CyFunctionObject *)func;
+    PyMethodDef* def = ((PyCFunctionObject*)cyfunc)->m_ml;
+#if CYTHON_BACKPORT_VECTORCALL
+    Py_ssize_t nargs = (Py_ssize_t)nargsf;
+#else
+    Py_ssize_t nargs = PyVectorcall_NARGS(nargsf);
+#endif
+    PyObject *self;
+    switch (__Pyx_CyFunction_Vectorcall_CheckArgs(cyfunc, nargs, kwnames)) {
+    case 1:
+        self = args[0];
+        args += 1;
+        nargs -= 1;
+        break;
+    case 0:
+        self = ((PyCFunctionObject*)cyfunc)->m_self;
+        break;
+    default:
+        return NULL;
+    }
+    if (unlikely(nargs != 1)) {
+        PyErr_Format(PyExc_TypeError,
+            "%.200s() takes exactly one argument (%" CYTHON_FORMAT_SSIZE_T "d given)",
+            def->ml_name, nargs);
+        return NULL;
+    }
+    return def->ml_meth(self, args[0]);
+}
+static PyObject * __Pyx_CyFunction_Vectorcall_FASTCALL_KEYWORDS(PyObject *func, PyObject *const *args, size_t nargsf, PyObject *kwnames)
+{
+    __pyx_CyFunctionObject *cyfunc = (__pyx_CyFunctionObject *)func;
+    PyMethodDef* def = ((PyCFunctionObject*)cyfunc)->m_ml;
+#if CYTHON_BACKPORT_VECTORCALL
+    Py_ssize_t nargs = (Py_ssize_t)nargsf;
+#else
+    Py_ssize_t nargs = PyVectorcall_NARGS(nargsf);
+#endif
+    PyObject *self;
+    switch (__Pyx_CyFunction_Vectorcall_CheckArgs(cyfunc, nargs, NULL)) {
+    case 1:
+        self = args[0];
+        args += 1;
+        nargs -= 1;
+        break;
+    case 0:
+        self = ((PyCFunctionObject*)cyfunc)->m_self;
+        break;
+    default:
+        return NULL;
     }
-    return __Pyx_PyObject_CallMethod0(L, __pyx_n_s_pop);
+    return ((_PyCFunctionFastWithKeywords)(void(*)(void))def->ml_meth)(self, args, nargs, kwnames);
 }
-#if CYTHON_USE_PYLIST_INTERNALS && CYTHON_ASSUME_SAFE_MACROS
-static CYTHON_INLINE PyObject* __Pyx_PyList_Pop(PyObject* L) {
-    if (likely(PyList_GET_SIZE(L) > (((PyListObject*)L)->allocated >> 1))) {
-        __Pyx_SET_SIZE(L, Py_SIZE(L) - 1);
-        return PyList_GET_ITEM(L, PyList_GET_SIZE(L));
+static PyObject * __Pyx_CyFunction_Vectorcall_FASTCALL_KEYWORDS_METHOD(PyObject *func, PyObject *const *args, size_t nargsf, PyObject *kwnames)
+{
+    __pyx_CyFunctionObject *cyfunc = (__pyx_CyFunctionObject *)func;
+    PyMethodDef* def = ((PyCFunctionObject*)cyfunc)->m_ml;
+    PyTypeObject *cls = (PyTypeObject *) __Pyx_CyFunction_GetClassObj(cyfunc);
+#if CYTHON_BACKPORT_VECTORCALL
+    Py_ssize_t nargs = (Py_ssize_t)nargsf;
+#else
+    Py_ssize_t nargs = PyVectorcall_NARGS(nargsf);
+#endif
+    PyObject *self;
+    switch (__Pyx_CyFunction_Vectorcall_CheckArgs(cyfunc, nargs, NULL)) {
+    case 1:
+        self = args[0];
+        args += 1;
+        nargs -= 1;
+        break;
+    case 0:
+        self = ((PyCFunctionObject*)cyfunc)->m_self;
+        break;
+    default:
+        return NULL;
     }
-    return __Pyx_CallUnboundCMethod0(&__pyx_umethod_PyList_Type_pop, L);
+    return ((__Pyx_PyCMethod)(void(*)(void))def->ml_meth)(self, cls, args, (size_t)nargs, kwnames);
 }
 #endif
+#if CYTHON_USE_TYPE_SPECS
+static PyType_Slot __pyx_CyFunctionType_slots[] = {
+    {Py_tp_dealloc, (void *)__Pyx_CyFunction_dealloc},
+    {Py_tp_repr, (void *)__Pyx_CyFunction_repr},
+    {Py_tp_call, (void *)__Pyx_CyFunction_CallAsMethod},
+    {Py_tp_traverse, (void *)__Pyx_CyFunction_traverse},
+    {Py_tp_clear, (void *)__Pyx_CyFunction_clear},
+    {Py_tp_methods, (void *)__pyx_CyFunction_methods},
+    {Py_tp_members, (void *)__pyx_CyFunction_members},
+    {Py_tp_getset, (void *)__pyx_CyFunction_getsets},
+    {Py_tp_descr_get, (void *)__Pyx_PyMethod_New},
+    {0, 0},
+};
+static PyType_Spec __pyx_CyFunctionType_spec = {
+    __PYX_TYPE_MODULE_PREFIX "cython_function_or_method",
+    sizeof(__pyx_CyFunctionObject),
+    0,
+#ifdef Py_TPFLAGS_METHOD_DESCRIPTOR
+    Py_TPFLAGS_METHOD_DESCRIPTOR |
+#endif
+#if (defined(_Py_TPFLAGS_HAVE_VECTORCALL) && CYTHON_METH_FASTCALL)
+    _Py_TPFLAGS_HAVE_VECTORCALL |
+#endif
+    Py_TPFLAGS_DEFAULT | Py_TPFLAGS_HAVE_GC | Py_TPFLAGS_BASETYPE,
+    __pyx_CyFunctionType_slots
+};
+#else
+static PyTypeObject __pyx_CyFunctionType_type = {
+    PyVarObject_HEAD_INIT(0, 0)
+    __PYX_TYPE_MODULE_PREFIX "cython_function_or_method",
+    sizeof(__pyx_CyFunctionObject),
+    0,
+    (destructor) __Pyx_CyFunction_dealloc,
+#if !CYTHON_METH_FASTCALL
+    0,
+#elif CYTHON_BACKPORT_VECTORCALL
+    (printfunc)offsetof(__pyx_CyFunctionObject, func_vectorcall),
+#else
+    offsetof(PyCFunctionObject, vectorcall),
+#endif
+    0,
+    0,
+#if PY_MAJOR_VERSION < 3
+    0,
+#else
+    0,
+#endif
+    (reprfunc) __Pyx_CyFunction_repr,
+    0,
+    0,
+    0,
+    0,
+    __Pyx_CyFunction_CallAsMethod,
+    0,
+    0,
+    0,
+    0,
+#ifdef Py_TPFLAGS_METHOD_DESCRIPTOR
+    Py_TPFLAGS_METHOD_DESCRIPTOR |
+#endif
+#ifdef _Py_TPFLAGS_HAVE_VECTORCALL
+    _Py_TPFLAGS_HAVE_VECTORCALL |
+#endif
+    Py_TPFLAGS_DEFAULT | Py_TPFLAGS_HAVE_GC | Py_TPFLAGS_BASETYPE,
+    0,
+    (traverseproc) __Pyx_CyFunction_traverse,
+    (inquiry) __Pyx_CyFunction_clear,
+    0,
+#if PY_VERSION_HEX < 0x030500A0
+    offsetof(__pyx_CyFunctionObject, func_weakreflist),
+#else
+    offsetof(PyCFunctionObject, m_weakreflist),
+#endif
+    0,
+    0,
+    __pyx_CyFunction_methods,
+    __pyx_CyFunction_members,
+    __pyx_CyFunction_getsets,
+    0,
+    0,
+    __Pyx_PyMethod_New,
+    0,
+    offsetof(__pyx_CyFunctionObject, func_dict),
+    0,
+    0,
+    0,
+    0,
+    0,
+    0,
+    0,
+    0,
+    0,
+    0,
+    0,
+    0,
+#if PY_VERSION_HEX >= 0x030400a1
+    0,
+#endif
+#if PY_VERSION_HEX >= 0x030800b1 && (!CYTHON_COMPILING_IN_PYPY || PYPY_VERSION_NUM >= 0x07030800)
+    0,
+#endif
+#if __PYX_NEED_TP_PRINT_SLOT
+    0,
+#endif
+#if PY_VERSION_HEX >= 0x030C0000
+    0,
+#endif
+#if CYTHON_COMPILING_IN_PYPY && PY_VERSION_HEX >= 0x03090000 && PY_VERSION_HEX < 0x030a0000
+    0,
+#endif
+};
+#endif
+static int __pyx_CyFunction_init(PyObject *module) {
+#if CYTHON_USE_TYPE_SPECS
+    __pyx_CyFunctionType = __Pyx_FetchCommonTypeFromSpec(module, &__pyx_CyFunctionType_spec, NULL);
+#else
+    CYTHON_UNUSED_VAR(module);
+    __pyx_CyFunctionType = __Pyx_FetchCommonType(&__pyx_CyFunctionType_type);
+#endif
+    if (unlikely(__pyx_CyFunctionType == NULL)) {
+        return -1;
+    }
+    return 0;
+}
+static CYTHON_INLINE void *__Pyx_CyFunction_InitDefaults(PyObject *func, size_t size, int pyobjects) {
+    __pyx_CyFunctionObject *m = (__pyx_CyFunctionObject *) func;
+    m->defaults = PyObject_Malloc(size);
+    if (unlikely(!m->defaults))
+        return PyErr_NoMemory();
+    memset(m->defaults, 0, size);
+    m->defaults_pyobjects = pyobjects;
+    m->defaults_size = size;
+    return m->defaults;
+}
+static CYTHON_INLINE void __Pyx_CyFunction_SetDefaultsTuple(PyObject *func, PyObject *tuple) {
+    __pyx_CyFunctionObject *m = (__pyx_CyFunctionObject *) func;
+    m->defaults_tuple = tuple;
+    Py_INCREF(tuple);
+}
+static CYTHON_INLINE void __Pyx_CyFunction_SetDefaultsKwDict(PyObject *func, PyObject *dict) {
+    __pyx_CyFunctionObject *m = (__pyx_CyFunctionObject *) func;
+    m->defaults_kwdict = dict;
+    Py_INCREF(dict);
+}
+static CYTHON_INLINE void __Pyx_CyFunction_SetAnnotationsDict(PyObject *func, PyObject *dict) {
+    __pyx_CyFunctionObject *m = (__pyx_CyFunctionObject *) func;
+    m->func_annotations = dict;
+    Py_INCREF(dict);
+}
+
+/* CythonFunction */
+static PyObject *__Pyx_CyFunction_New(PyMethodDef *ml, int flags, PyObject* qualname,
+                                      PyObject *closure, PyObject *module, PyObject* globals, PyObject* code) {
+    PyObject *op = __Pyx_CyFunction_Init(
+        PyObject_GC_New(__pyx_CyFunctionObject, __pyx_CyFunctionType),
+        ml, flags, qualname, closure, module, globals, code
+    );
+    if (likely(op)) {
+        PyObject_GC_Track(op);
+    }
+    return op;
+}
 
-/* PyIntBinop */
-#if !CYTHON_COMPILING_IN_PYPY
-static PyObject* __Pyx_PyInt_AddObjC(PyObject *op1, PyObject *op2, CYTHON_UNUSED long intval, int inplace, int zerodivision_check) {
-    (void)inplace;
-    (void)zerodivision_check;
-    #if PY_MAJOR_VERSION < 3
-    if (likely(PyInt_CheckExact(op1))) {
-        const long b = intval;
-        long x;
-        long a = PyInt_AS_LONG(op1);
-            x = (long)((unsigned long)a + b);
-            if (likely((x^a) >= 0 || (x^b) >= 0))
-                return PyInt_FromLong(x);
-            return PyLong_Type.tp_as_number->nb_add(op1, op2);
+/* Py3UpdateBases */
+static PyObject*
+__Pyx_PEP560_update_bases(PyObject *bases)
+{
+    Py_ssize_t i, j, size_bases;
+    PyObject *base, *meth, *new_base, *result, *new_bases = NULL;
+    size_bases = PyTuple_GET_SIZE(bases);
+    for (i = 0; i < size_bases; i++) {
+        base  = PyTuple_GET_ITEM(bases, i);
+        if (PyType_Check(base)) {
+            if (new_bases) {
+                if (PyList_Append(new_bases, base) < 0) {
+                    goto error;
+                }
+            }
+            continue;
+        }
+        meth = __Pyx_PyObject_GetAttrStrNoError(base, __pyx_n_s_mro_entries);
+        if (!meth && PyErr_Occurred()) {
+            goto error;
+        }
+        if (!meth) {
+            if (new_bases) {
+                if (PyList_Append(new_bases, base) < 0) {
+                    goto error;
+                }
+            }
+            continue;
+        }
+        new_base = __Pyx_PyObject_CallOneArg(meth, bases);
+        Py_DECREF(meth);
+        if (!new_base) {
+            goto error;
+        }
+        if (!PyTuple_Check(new_base)) {
+            PyErr_SetString(PyExc_TypeError,
+                            "__mro_entries__ must return a tuple");
+            Py_DECREF(new_base);
+            goto error;
+        }
+        if (!new_bases) {
+            if (!(new_bases = PyList_New(i))) {
+                goto error;
+            }
+            for (j = 0; j < i; j++) {
+                base = PyTuple_GET_ITEM(bases, j);
+                PyList_SET_ITEM(new_bases, j, base);
+                Py_INCREF(base);
+            }
+        }
+        j = PyList_GET_SIZE(new_bases);
+        if (PyList_SetSlice(new_bases, j, j, new_base) < 0) {
+            goto error;
+        }
+        Py_DECREF(new_base);
     }
-    #endif
-    #if CYTHON_USE_PYLONG_INTERNALS
-    if (likely(PyLong_CheckExact(op1))) {
-        const long b = intval;
-        long a, x;
-#ifdef HAVE_LONG_LONG
-        const PY_LONG_LONG llb = intval;
-        PY_LONG_LONG lla, llx;
+    if (!new_bases) {
+        Py_INCREF(bases);
+        return bases;
+    }
+    result = PyList_AsTuple(new_bases);
+    Py_DECREF(new_bases);
+    return result;
+error:
+    Py_XDECREF(new_bases);
+    return NULL;
+}
+
+/* CalculateMetaclass */
+static PyObject *__Pyx_CalculateMetaclass(PyTypeObject *metaclass, PyObject *bases) {
+    Py_ssize_t i, nbases = PyTuple_GET_SIZE(bases);
+    for (i=0; i < nbases; i++) {
+        PyTypeObject *tmptype;
+        PyObject *tmp = PyTuple_GET_ITEM(bases, i);
+        tmptype = Py_TYPE(tmp);
+#if PY_MAJOR_VERSION < 3
+        if (tmptype == &PyClass_Type)
+            continue;
 #endif
-        const digit* digits = ((PyLongObject*)op1)->ob_digit;
-        const Py_ssize_t size = Py_SIZE(op1);
-        if (likely(__Pyx_sst_abs(size) <= 1)) {
-            a = likely(size) ? digits[0] : 0;
-            if (size == -1) a = -a;
-        } else {
-            switch (size) {
-                case -2:
-                    if (8 * sizeof(long) - 1 > 2 * PyLong_SHIFT) {
-                        a = -(long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
-                        break;
-#ifdef HAVE_LONG_LONG
-                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 2 * PyLong_SHIFT) {
-                        lla = -(PY_LONG_LONG) (((((unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
-                        goto long_long;
+        if (!metaclass) {
+            metaclass = tmptype;
+            continue;
+        }
+        if (PyType_IsSubtype(metaclass, tmptype))
+            continue;
+        if (PyType_IsSubtype(tmptype, metaclass)) {
+            metaclass = tmptype;
+            continue;
+        }
+        PyErr_SetString(PyExc_TypeError,
+                        "metaclass conflict: "
+                        "the metaclass of a derived class "
+                        "must be a (non-strict) subclass "
+                        "of the metaclasses of all its bases");
+        return NULL;
+    }
+    if (!metaclass) {
+#if PY_MAJOR_VERSION < 3
+        metaclass = &PyClass_Type;
+#else
+        metaclass = &PyType_Type;
 #endif
-                    }
-                    CYTHON_FALLTHROUGH;
-                case 2:
-                    if (8 * sizeof(long) - 1 > 2 * PyLong_SHIFT) {
-                        a = (long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
-                        break;
-#ifdef HAVE_LONG_LONG
-                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 2 * PyLong_SHIFT) {
-                        lla = (PY_LONG_LONG) (((((unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
-                        goto long_long;
+    }
+    Py_INCREF((PyObject*) metaclass);
+    return (PyObject*) metaclass;
+}
+
+/* PyObjectCall2Args */
+static CYTHON_INLINE PyObject* __Pyx_PyObject_Call2Args(PyObject* function, PyObject* arg1, PyObject* arg2) {
+    PyObject *args[3] = {NULL, arg1, arg2};
+    return __Pyx_PyObject_FastCall(function, args+1, 2 | __Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET);
+}
+
+/* PyObjectLookupSpecial */
+#if CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
+static CYTHON_INLINE PyObject* __Pyx__PyObject_LookupSpecial(PyObject* obj, PyObject* attr_name, int with_error) {
+    PyObject *res;
+    PyTypeObject *tp = Py_TYPE(obj);
+#if PY_MAJOR_VERSION < 3
+    if (unlikely(PyInstance_Check(obj)))
+        return with_error ? __Pyx_PyObject_GetAttrStr(obj, attr_name) : __Pyx_PyObject_GetAttrStrNoError(obj, attr_name);
 #endif
-                    }
-                    CYTHON_FALLTHROUGH;
-                case -3:
-                    if (8 * sizeof(long) - 1 > 3 * PyLong_SHIFT) {
-                        a = -(long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
-                        break;
-#ifdef HAVE_LONG_LONG
-                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 3 * PyLong_SHIFT) {
-                        lla = -(PY_LONG_LONG) (((((((unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
-                        goto long_long;
+    res = _PyType_Lookup(tp, attr_name);
+    if (likely(res)) {
+        descrgetfunc f = Py_TYPE(res)->tp_descr_get;
+        if (!f) {
+            Py_INCREF(res);
+        } else {
+            res = f(res, obj, (PyObject *)tp);
+        }
+    } else if (with_error) {
+        PyErr_SetObject(PyExc_AttributeError, attr_name);
+    }
+    return res;
+}
 #endif
-                    }
-                    CYTHON_FALLTHROUGH;
-                case 3:
-                    if (8 * sizeof(long) - 1 > 3 * PyLong_SHIFT) {
-                        a = (long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
-                        break;
-#ifdef HAVE_LONG_LONG
-                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 3 * PyLong_SHIFT) {
-                        lla = (PY_LONG_LONG) (((((((unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
-                        goto long_long;
+
+/* Py3ClassCreate */
+static PyObject *__Pyx_Py3MetaclassPrepare(PyObject *metaclass, PyObject *bases, PyObject *name,
+                                           PyObject *qualname, PyObject *mkw, PyObject *modname, PyObject *doc) {
+    PyObject *ns;
+    if (metaclass) {
+        PyObject *prep = __Pyx_PyObject_GetAttrStrNoError(metaclass, __pyx_n_s_prepare);
+        if (prep) {
+            PyObject *pargs[3] = {NULL, name, bases};
+            ns = __Pyx_PyObject_FastCallDict(prep, pargs+1, 2 | __Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET, mkw);
+            Py_DECREF(prep);
+        } else {
+            if (unlikely(PyErr_Occurred()))
+                return NULL;
+            ns = PyDict_New();
+        }
+    } else {
+        ns = PyDict_New();
+    }
+    if (unlikely(!ns))
+        return NULL;
+    if (unlikely(PyObject_SetItem(ns, __pyx_n_s_module, modname) < 0)) goto bad;
+#if PY_VERSION_HEX >= 0x03030000
+    if (unlikely(PyObject_SetItem(ns, __pyx_n_s_qualname, qualname) < 0)) goto bad;
+#else
+    CYTHON_MAYBE_UNUSED_VAR(qualname);
 #endif
-                    }
-                    CYTHON_FALLTHROUGH;
-                case -4:
-                    if (8 * sizeof(long) - 1 > 4 * PyLong_SHIFT) {
-                        a = -(long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
-                        break;
-#ifdef HAVE_LONG_LONG
-                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 4 * PyLong_SHIFT) {
-                        lla = -(PY_LONG_LONG) (((((((((unsigned PY_LONG_LONG)digits[3]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
-                        goto long_long;
+    if (unlikely(doc && PyObject_SetItem(ns, __pyx_n_s_doc, doc) < 0)) goto bad;
+    return ns;
+bad:
+    Py_DECREF(ns);
+    return NULL;
+}
+#if PY_VERSION_HEX < 0x030600A4 && CYTHON_PEP487_INIT_SUBCLASS
+static int __Pyx_SetNamesPEP487(PyObject *type_obj) {
+    PyTypeObject *type = (PyTypeObject*) type_obj;
+    PyObject *names_to_set, *key, *value, *set_name, *tmp;
+    Py_ssize_t i = 0;
+#if CYTHON_USE_TYPE_SLOTS
+    names_to_set = PyDict_Copy(type->tp_dict);
+#else
+    {
+        PyObject *d = PyObject_GetAttr(type_obj, __pyx_n_s_dict);
+        names_to_set = NULL;
+        if (likely(d)) {
+            PyObject *names_to_set = PyDict_New();
+            int ret = likely(names_to_set) ? PyDict_Update(names_to_set, d) : -1;
+            Py_DECREF(d);
+            if (unlikely(ret < 0))
+                Py_CLEAR(names_to_set);
+        }
+    }
 #endif
-                    }
-                    CYTHON_FALLTHROUGH;
-                case 4:
-                    if (8 * sizeof(long) - 1 > 4 * PyLong_SHIFT) {
-                        a = (long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0]));
-                        break;
-#ifdef HAVE_LONG_LONG
-                    } else if (8 * sizeof(PY_LONG_LONG) - 1 > 4 * PyLong_SHIFT) {
-                        lla = (PY_LONG_LONG) (((((((((unsigned PY_LONG_LONG)digits[3]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[2]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[1]) << PyLong_SHIFT) | (unsigned PY_LONG_LONG)digits[0]));
-                        goto long_long;
+    if (unlikely(names_to_set == NULL))
+        goto bad;
+    while (PyDict_Next(names_to_set, &i, &key, &value)) {
+        set_name = __Pyx_PyObject_LookupSpecialNoError(value, __pyx_n_s_set_name);
+        if (unlikely(set_name != NULL)) {
+            tmp = __Pyx_PyObject_Call2Args(set_name, type_obj, key);
+            Py_DECREF(set_name);
+            if (unlikely(tmp == NULL)) {
+                __Pyx_TypeName value_type_name =
+                    __Pyx_PyType_GetName(Py_TYPE(value));
+                __Pyx_TypeName type_name = __Pyx_PyType_GetName(type);
+                PyErr_Format(PyExc_RuntimeError,
+#if PY_MAJOR_VERSION >= 3
+                    "Error calling __set_name__ on '" __Pyx_FMT_TYPENAME "' instance %R " "in '" __Pyx_FMT_TYPENAME "'",
+                    value_type_name, key, type_name);
+#else
+                    "Error calling __set_name__ on '" __Pyx_FMT_TYPENAME "' instance %.100s in '" __Pyx_FMT_TYPENAME "'",
+                    value_type_name,
+                    PyString_Check(key) ? PyString_AS_STRING(key) : "?",
+                    type_name);
 #endif
-                    }
-                    CYTHON_FALLTHROUGH;
-                default: return PyLong_Type.tp_as_number->nb_add(op1, op2);
+                goto bad;
+            } else {
+                Py_DECREF(tmp);
             }
         }
-                x = a + b;
-            return PyLong_FromLong(x);
-#ifdef HAVE_LONG_LONG
-        long_long:
-                llx = lla + llb;
-            return PyLong_FromLongLong(llx);
-#endif
-        
-        
+        else if (unlikely(PyErr_Occurred())) {
+            goto bad;
+        }
     }
-    #endif
-    if (PyFloat_CheckExact(op1)) {
-        const long b = intval;
-        double a = PyFloat_AS_DOUBLE(op1);
-            double result;
-            PyFPE_START_PROTECT("add", return NULL)
-            result = ((double)a) + (double)b;
-            PyFPE_END_PROTECT(result)
-            return PyFloat_FromDouble(result);
+    Py_DECREF(names_to_set);
+    return 0;
+bad:
+    Py_XDECREF(names_to_set);
+    return -1;
+}
+static PyObject *__Pyx_InitSubclassPEP487(PyObject *type_obj, PyObject *mkw) {
+#if CYTHON_USE_TYPE_SLOTS && CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
+    PyTypeObject *type = (PyTypeObject*) type_obj;
+    PyObject *mro = type->tp_mro;
+    Py_ssize_t i, nbases;
+    if (unlikely(!mro)) goto done;
+    (void) &__Pyx_GetBuiltinName;
+    Py_INCREF(mro);
+    nbases = PyTuple_GET_SIZE(mro);
+    assert(PyTuple_GET_ITEM(mro, 0) == type_obj);
+    for (i = 1; i < nbases-1; i++) {
+        PyObject *base, *dict, *meth;
+        base = PyTuple_GET_ITEM(mro, i);
+        dict = ((PyTypeObject *)base)->tp_dict;
+        meth = __Pyx_PyDict_GetItemStrWithError(dict, __pyx_n_s_init_subclass);
+        if (unlikely(meth)) {
+            descrgetfunc f = Py_TYPE(meth)->tp_descr_get;
+            PyObject *res;
+            Py_INCREF(meth);
+            if (likely(f)) {
+                res = f(meth, NULL, type_obj);
+                Py_DECREF(meth);
+                if (unlikely(!res)) goto bad;
+                meth = res;
+            }
+            res = __Pyx_PyObject_FastCallDict(meth, NULL, 0, mkw);
+            Py_DECREF(meth);
+            if (unlikely(!res)) goto bad;
+            Py_DECREF(res);
+            goto done;
+        } else if (unlikely(PyErr_Occurred())) {
+            goto bad;
+        }
     }
-    return (inplace ? PyNumber_InPlaceAdd : PyNumber_Add)(op1, op2);
+done:
+    Py_XDECREF(mro);
+    return type_obj;
+bad:
+    Py_XDECREF(mro);
+    Py_DECREF(type_obj);
+    return NULL;
+#else
+    PyObject *super_type, *super, *func, *res;
+#if CYTHON_COMPILING_IN_PYPY && !defined(PySuper_Type)
+    super_type = __Pyx_GetBuiltinName(__pyx_n_s_super);
+#else
+    super_type = (PyObject*) &PySuper_Type;
+    (void) &__Pyx_GetBuiltinName;
+#endif
+    super = likely(super_type) ? __Pyx_PyObject_Call2Args(super_type, type_obj, type_obj) : NULL;
+#if CYTHON_COMPILING_IN_PYPY && !defined(PySuper_Type)
+    Py_XDECREF(super_type);
+#endif
+    if (unlikely(!super)) {
+        Py_CLEAR(type_obj);
+        goto done;
+    }
+    func = __Pyx_PyObject_GetAttrStrNoError(super, __pyx_n_s_init_subclass);
+    Py_DECREF(super);
+    if (likely(!func)) {
+        if (unlikely(PyErr_Occurred()))
+            Py_CLEAR(type_obj);
+        goto done;
+    }
+    res = __Pyx_PyObject_FastCallDict(func, NULL, 0, mkw);
+    Py_DECREF(func);
+    if (unlikely(!res))
+        Py_CLEAR(type_obj);
+    Py_XDECREF(res);
+done:
+    return type_obj;
+#endif
 }
 #endif
+static PyObject *__Pyx_Py3ClassCreate(PyObject *metaclass, PyObject *name, PyObject *bases,
+                                      PyObject *dict, PyObject *mkw,
+                                      int calculate_metaclass, int allow_py2_metaclass) {
+    PyObject *result;
+    PyObject *owned_metaclass = NULL;
+    PyObject *margs[4] = {NULL, name, bases, dict};
+    if (allow_py2_metaclass) {
+        owned_metaclass = PyObject_GetItem(dict, __pyx_n_s_metaclass);
+        if (owned_metaclass) {
+            metaclass = owned_metaclass;
+        } else if (likely(PyErr_ExceptionMatches(PyExc_KeyError))) {
+            PyErr_Clear();
+        } else {
+            return NULL;
+        }
+    }
+    if (calculate_metaclass && (!metaclass || PyType_Check(metaclass))) {
+        metaclass = __Pyx_CalculateMetaclass((PyTypeObject*) metaclass, bases);
+        Py_XDECREF(owned_metaclass);
+        if (unlikely(!metaclass))
+            return NULL;
+        owned_metaclass = metaclass;
+    }
+    result = __Pyx_PyObject_FastCallDict(metaclass, margs+1, 3 | __Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET,
+#if PY_VERSION_HEX < 0x030600A4
+        (metaclass == (PyObject*)&PyType_Type) ? NULL : mkw
+#else
+        mkw
+#endif
+    );
+    Py_XDECREF(owned_metaclass);
+#if PY_VERSION_HEX < 0x030600A4 && CYTHON_PEP487_INIT_SUBCLASS
+    if (likely(result) && likely(PyType_Check(result))) {
+        if (unlikely(__Pyx_SetNamesPEP487(result) < 0)) {
+            Py_CLEAR(result);
+        } else {
+            result = __Pyx_InitSubclassPEP487(result, mkw);
+        }
+    }
+#else
+    (void) &__Pyx_GetBuiltinName;
+#endif
+    return result;
+}
+
+/* PyObjectCallNoArg */
+static CYTHON_INLINE PyObject* __Pyx_PyObject_CallNoArg(PyObject *func) {
+    PyObject *arg = NULL;
+    return __Pyx_PyObject_FastCall(func, (&arg)+1, 0 | __Pyx_PY_VECTORCALL_ARGUMENTS_OFFSET);
+}
 
 /* IterFinish */
 static CYTHON_INLINE int __Pyx_IterFinish(void) {
-#if CYTHON_FAST_THREAD_STATE
-    PyThreadState *tstate = __Pyx_PyThreadState_Current;
-    PyObject* exc_type = tstate->curexc_type;
+    __Pyx_PyThreadState_declare
+    __Pyx_PyThreadState_assign
+    PyObject* exc_type = __Pyx_PyErr_CurrentExceptionType();
     if (unlikely(exc_type)) {
-        if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) {
-            PyObject *exc_value, *exc_tb;
-            exc_value = tstate->curexc_value;
-            exc_tb = tstate->curexc_traceback;
-            tstate->curexc_type = 0;
-            tstate->curexc_value = 0;
-            tstate->curexc_traceback = 0;
-            Py_DECREF(exc_type);
-            Py_XDECREF(exc_value);
-            Py_XDECREF(exc_tb);
-            return 0;
-        } else {
+        if (unlikely(!__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration)))
             return -1;
-        }
+        __Pyx_PyErr_Clear();
+        return 0;
     }
     return 0;
+}
+
+/* PyObjectGetMethod */
+static int __Pyx_PyObject_GetMethod(PyObject *obj, PyObject *name, PyObject **method) {
+    PyObject *attr;
+#if CYTHON_UNPACK_METHODS && CYTHON_COMPILING_IN_CPYTHON && CYTHON_USE_PYTYPE_LOOKUP
+    __Pyx_TypeName type_name;
+    PyTypeObject *tp = Py_TYPE(obj);
+    PyObject *descr;
+    descrgetfunc f = NULL;
+    PyObject **dictptr, *dict;
+    int meth_found = 0;
+    assert (*method == NULL);
+    if (unlikely(tp->tp_getattro != PyObject_GenericGetAttr)) {
+        attr = __Pyx_PyObject_GetAttrStr(obj, name);
+        goto try_unpack;
+    }
+    if (unlikely(tp->tp_dict == NULL) && unlikely(PyType_Ready(tp) < 0)) {
+        return 0;
+    }
+    descr = _PyType_Lookup(tp, name);
+    if (likely(descr != NULL)) {
+        Py_INCREF(descr);
+#if defined(Py_TPFLAGS_METHOD_DESCRIPTOR) && Py_TPFLAGS_METHOD_DESCRIPTOR
+        if (__Pyx_PyType_HasFeature(Py_TYPE(descr), Py_TPFLAGS_METHOD_DESCRIPTOR))
+#elif PY_MAJOR_VERSION >= 3
+        #ifdef __Pyx_CyFunction_USED
+        if (likely(PyFunction_Check(descr) || __Pyx_IS_TYPE(descr, &PyMethodDescr_Type) || __Pyx_CyFunction_Check(descr)))
+        #else
+        if (likely(PyFunction_Check(descr) || __Pyx_IS_TYPE(descr, &PyMethodDescr_Type)))
+        #endif
 #else
-    if (unlikely(PyErr_Occurred())) {
-        if (likely(PyErr_ExceptionMatches(PyExc_StopIteration))) {
-            PyErr_Clear();
-            return 0;
+        #ifdef __Pyx_CyFunction_USED
+        if (likely(PyFunction_Check(descr) || __Pyx_CyFunction_Check(descr)))
+        #else
+        if (likely(PyFunction_Check(descr)))
+        #endif
+#endif
+        {
+            meth_found = 1;
         } else {
-            return -1;
+            f = Py_TYPE(descr)->tp_descr_get;
+            if (f != NULL && PyDescr_IsData(descr)) {
+                attr = f(descr, obj, (PyObject *)Py_TYPE(obj));
+                Py_DECREF(descr);
+                goto try_unpack;
+            }
         }
     }
+    dictptr = _PyObject_GetDictPtr(obj);
+    if (dictptr != NULL && (dict = *dictptr) != NULL) {
+        Py_INCREF(dict);
+        attr = __Pyx_PyDict_GetItemStr(dict, name);
+        if (attr != NULL) {
+            Py_INCREF(attr);
+            Py_DECREF(dict);
+            Py_XDECREF(descr);
+            goto try_unpack;
+        }
+        Py_DECREF(dict);
+    }
+    if (meth_found) {
+        *method = descr;
+        return 1;
+    }
+    if (f != NULL) {
+        attr = f(descr, obj, (PyObject *)Py_TYPE(obj));
+        Py_DECREF(descr);
+        goto try_unpack;
+    }
+    if (likely(descr != NULL)) {
+        *method = descr;
+        return 0;
+    }
+    type_name = __Pyx_PyType_GetName(tp);
+    PyErr_Format(PyExc_AttributeError,
+#if PY_MAJOR_VERSION >= 3
+                 "'" __Pyx_FMT_TYPENAME "' object has no attribute '%U'",
+                 type_name, name);
+#else
+                 "'" __Pyx_FMT_TYPENAME "' object has no attribute '%.400s'",
+                 type_name, PyString_AS_STRING(name));
+#endif
+    __Pyx_DECREF_TypeName(type_name);
     return 0;
+#else
+    attr = __Pyx_PyObject_GetAttrStr(obj, name);
+    goto try_unpack;
+#endif
+try_unpack:
+#if CYTHON_UNPACK_METHODS
+    if (likely(attr) && PyMethod_Check(attr) && likely(PyMethod_GET_SELF(attr) == obj)) {
+        PyObject *function = PyMethod_GET_FUNCTION(attr);
+        Py_INCREF(function);
+        Py_DECREF(attr);
+        *method = function;
+        return 1;
+    }
 #endif
+    *method = attr;
+    return 0;
+}
+
+/* PyObjectCallMethod0 */
+static PyObject* __Pyx_PyObject_CallMethod0(PyObject* obj, PyObject* method_name) {
+    PyObject *method = NULL, *result = NULL;
+    int is_method = __Pyx_PyObject_GetMethod(obj, method_name, &method);
+    if (likely(is_method)) {
+        result = __Pyx_PyObject_CallOneArg(method, obj);
+        Py_DECREF(method);
+        return result;
+    }
+    if (unlikely(!method)) goto bad;
+    result = __Pyx_PyObject_CallNoArg(method);
+    Py_DECREF(method);
+bad:
+    return result;
 }
 
 /* RaiseNeedMoreValuesToUnpack */
 static CYTHON_INLINE void __Pyx_RaiseNeedMoreValuesError(Py_ssize_t index) {
     PyErr_Format(PyExc_ValueError,
                  "need more than %" CYTHON_FORMAT_SSIZE_T "d value%.1s to unpack",
                  index, (index == 1) ? "" : "s");
@@ -8974,18 +8925,16 @@
 
 /* UnpackItemEndCheck */
 static int __Pyx_IternextUnpackEndCheck(PyObject *retval, Py_ssize_t expected) {
     if (unlikely(retval)) {
         Py_DECREF(retval);
         __Pyx_RaiseTooManyValuesError(expected);
         return -1;
-    } else {
-        return __Pyx_IterFinish();
     }
-    return 0;
+    return __Pyx_IterFinish();
 }
 
 /* RaiseNoneIterError */
 static CYTHON_INLINE void __Pyx_RaiseNoneNotIterableError(void) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
 }
 
@@ -9029,15 +8978,15 @@
                                        int has_known_size, int decref_tuple) {
     Py_ssize_t index;
     PyObject *value1 = NULL, *value2 = NULL, *iter = NULL;
     iternextfunc iternext;
     iter = PyObject_GetIter(tuple);
     if (unlikely(!iter)) goto bad;
     if (decref_tuple) { Py_DECREF(tuple); tuple = NULL; }
-    iternext = Py_TYPE(iter)->tp_iternext;
+    iternext = __Pyx_PyObject_GetIterNextFunc(iter);
     value1 = iternext(iter); if (unlikely(!value1)) { index = 0; goto unpacking_failed; }
     value2 = iternext(iter); if (unlikely(!value2)) { index = 1; goto unpacking_failed; }
     if (!has_known_size && unlikely(__Pyx_IternextUnpackEndCheck(iternext(iter), 2))) goto bad;
     Py_DECREF(iter);
     *pvalue1 = value1;
     *pvalue2 = value2;
     return 0;
@@ -9161,581 +9110,163 @@
         *pkey = next_item;
     } else {
         *pvalue = next_item;
     }
     return 1;
 }
 
-/* PyDictVersioning */
-#if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_TYPE_SLOTS
-static CYTHON_INLINE PY_UINT64_T __Pyx_get_tp_dict_version(PyObject *obj) {
-    PyObject *dict = Py_TYPE(obj)->tp_dict;
-    return likely(dict) ? __PYX_GET_DICT_VERSION(dict) : 0;
-}
-static CYTHON_INLINE PY_UINT64_T __Pyx_get_object_dict_version(PyObject *obj) {
-    PyObject **dictptr = NULL;
-    Py_ssize_t offset = Py_TYPE(obj)->tp_dictoffset;
-    if (offset) {
-#if CYTHON_COMPILING_IN_CPYTHON
-        dictptr = (likely(offset > 0)) ? (PyObject **) ((char *)obj + offset) : _PyObject_GetDictPtr(obj);
-#else
-        dictptr = _PyObject_GetDictPtr(obj);
-#endif
-    }
-    return (dictptr && *dictptr) ? __PYX_GET_DICT_VERSION(*dictptr) : 0;
-}
-static CYTHON_INLINE int __Pyx_object_dict_version_matches(PyObject* obj, PY_UINT64_T tp_dict_version, PY_UINT64_T obj_dict_version) {
-    PyObject *dict = Py_TYPE(obj)->tp_dict;
-    if (unlikely(!dict) || unlikely(tp_dict_version != __PYX_GET_DICT_VERSION(dict)))
-        return 0;
-    return obj_dict_version == __Pyx_get_object_dict_version(obj);
-}
-#endif
-
-/* GetModuleGlobalName */
-#if CYTHON_USE_DICT_VERSIONS
-static PyObject *__Pyx__GetModuleGlobalName(PyObject *name, PY_UINT64_T *dict_version, PyObject **dict_cached_value)
-#else
-static CYTHON_INLINE PyObject *__Pyx__GetModuleGlobalName(PyObject *name)
-#endif
-{
-    PyObject *result;
-#if !CYTHON_AVOID_BORROWED_REFS
-#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX >= 0x030500A1
-    result = _PyDict_GetItem_KnownHash(__pyx_d, name, ((PyASCIIObject *) name)->hash);
-    __PYX_UPDATE_DICT_CACHE(__pyx_d, result, *dict_cached_value, *dict_version)
-    if (likely(result)) {
-        return __Pyx_NewRef(result);
-    } else if (unlikely(PyErr_Occurred())) {
-        return NULL;
-    }
-#else
-    result = PyDict_GetItem(__pyx_d, name);
-    __PYX_UPDATE_DICT_CACHE(__pyx_d, result, *dict_cached_value, *dict_version)
-    if (likely(result)) {
-        return __Pyx_NewRef(result);
-    }
-#endif
-#else
-    result = PyObject_GetItem(__pyx_d, name);
-    __PYX_UPDATE_DICT_CACHE(__pyx_d, result, *dict_cached_value, *dict_version)
-    if (likely(result)) {
-        return __Pyx_NewRef(result);
-    }
-    PyErr_Clear();
-#endif
-    return __Pyx_GetBuiltinName(name);
-}
-
-/* RaiseArgTupleInvalid */
-static void __Pyx_RaiseArgtupleInvalid(
-    const char* func_name,
-    int exact,
-    Py_ssize_t num_min,
-    Py_ssize_t num_max,
-    Py_ssize_t num_found)
-{
-    Py_ssize_t num_expected;
-    const char *more_or_less;
-    if (num_found < num_min) {
-        num_expected = num_min;
-        more_or_less = "at least";
-    } else {
-        num_expected = num_max;
-        more_or_less = "at most";
-    }
-    if (exact) {
-        more_or_less = "exactly";
-    }
-    PyErr_Format(PyExc_TypeError,
-                 "%.200s() takes %.8s %" CYTHON_FORMAT_SSIZE_T "d positional argument%.1s (%" CYTHON_FORMAT_SSIZE_T "d given)",
-                 func_name, more_or_less, num_expected,
-                 (num_expected == 1) ? "" : "s", num_found);
-}
-
-/* RaiseDoubleKeywords */
-static void __Pyx_RaiseDoubleKeywordsError(
-    const char* func_name,
-    PyObject* kw_name)
-{
-    PyErr_Format(PyExc_TypeError,
-        #if PY_MAJOR_VERSION >= 3
-        "%s() got multiple values for keyword argument '%U'", func_name, kw_name);
-        #else
-        "%s() got multiple values for keyword argument '%s'", func_name,
-        PyString_AsString(kw_name));
-        #endif
-}
-
-/* ParseKeywords */
-static int __Pyx_ParseOptionalKeywords(
-    PyObject *kwds,
-    PyObject **argnames[],
-    PyObject *kwds2,
-    PyObject *values[],
-    Py_ssize_t num_pos_args,
-    const char* function_name)
-{
-    PyObject *key = 0, *value = 0;
-    Py_ssize_t pos = 0;
-    PyObject*** name;
-    PyObject*** first_kw_arg = argnames + num_pos_args;
-    while (PyDict_Next(kwds, &pos, &key, &value)) {
-        name = first_kw_arg;
-        while (*name && (**name != key)) name++;
-        if (*name) {
-            values[name-argnames] = value;
-            continue;
+/* SliceObject */
+static CYTHON_INLINE PyObject* __Pyx_PyObject_GetSlice(PyObject* obj,
+        Py_ssize_t cstart, Py_ssize_t cstop,
+        PyObject** _py_start, PyObject** _py_stop, PyObject** _py_slice,
+        int has_cstart, int has_cstop, int wraparound) {
+    __Pyx_TypeName obj_type_name;
+#if CYTHON_USE_TYPE_SLOTS
+    PyMappingMethods* mp;
+#if PY_MAJOR_VERSION < 3
+    PySequenceMethods* ms = Py_TYPE(obj)->tp_as_sequence;
+    if (likely(ms && ms->sq_slice)) {
+        if (!has_cstart) {
+            if (_py_start && (*_py_start != Py_None)) {
+                cstart = __Pyx_PyIndex_AsSsize_t(*_py_start);
+                if ((cstart == (Py_ssize_t)-1) && PyErr_Occurred()) goto bad;
+            } else
+                cstart = 0;
         }
-        name = first_kw_arg;
-        #if PY_MAJOR_VERSION < 3
-        if (likely(PyString_Check(key))) {
-            while (*name) {
-                if ((CYTHON_COMPILING_IN_PYPY || PyString_GET_SIZE(**name) == PyString_GET_SIZE(key))
-                        && _PyString_Eq(**name, key)) {
-                    values[name-argnames] = value;
-                    break;
-                }
-                name++;
-            }
-            if (*name) continue;
-            else {
-                PyObject*** argname = argnames;
-                while (argname != first_kw_arg) {
-                    if ((**argname == key) || (
-                            (CYTHON_COMPILING_IN_PYPY || PyString_GET_SIZE(**argname) == PyString_GET_SIZE(key))
-                             && _PyString_Eq(**argname, key))) {
-                        goto arg_passed_twice;
-                    }
-                    argname++;
-                }
-            }
-        } else
-        #endif
-        if (likely(PyUnicode_Check(key))) {
-            while (*name) {
-                int cmp = (**name == key) ? 0 :
-                #if !CYTHON_COMPILING_IN_PYPY && PY_MAJOR_VERSION >= 3
-                    (__Pyx_PyUnicode_GET_LENGTH(**name) != __Pyx_PyUnicode_GET_LENGTH(key)) ? 1 :
-                #endif
-                    PyUnicode_Compare(**name, key);
-                if (cmp < 0 && unlikely(PyErr_Occurred())) goto bad;
-                if (cmp == 0) {
-                    values[name-argnames] = value;
-                    break;
+        if (!has_cstop) {
+            if (_py_stop && (*_py_stop != Py_None)) {
+                cstop = __Pyx_PyIndex_AsSsize_t(*_py_stop);
+                if ((cstop == (Py_ssize_t)-1) && PyErr_Occurred()) goto bad;
+            } else
+                cstop = PY_SSIZE_T_MAX;
+        }
+        if (wraparound && unlikely((cstart < 0) | (cstop < 0)) && likely(ms->sq_length)) {
+            Py_ssize_t l = ms->sq_length(obj);
+            if (likely(l >= 0)) {
+                if (cstop < 0) {
+                    cstop += l;
+                    if (cstop < 0) cstop = 0;
                 }
-                name++;
-            }
-            if (*name) continue;
-            else {
-                PyObject*** argname = argnames;
-                while (argname != first_kw_arg) {
-                    int cmp = (**argname == key) ? 0 :
-                    #if !CYTHON_COMPILING_IN_PYPY && PY_MAJOR_VERSION >= 3
-                        (__Pyx_PyUnicode_GET_LENGTH(**argname) != __Pyx_PyUnicode_GET_LENGTH(key)) ? 1 :
-                    #endif
-                        PyUnicode_Compare(**argname, key);
-                    if (cmp < 0 && unlikely(PyErr_Occurred())) goto bad;
-                    if (cmp == 0) goto arg_passed_twice;
-                    argname++;
+                if (cstart < 0) {
+                    cstart += l;
+                    if (cstart < 0) cstart = 0;
                 }
+            } else {
+                if (!PyErr_ExceptionMatches(PyExc_OverflowError))
+                    goto bad;
+                PyErr_Clear();
             }
-        } else
-            goto invalid_keyword_type;
-        if (kwds2) {
-            if (unlikely(PyDict_SetItem(kwds2, key, value))) goto bad;
-        } else {
-            goto invalid_keyword;
         }
+        return ms->sq_slice(obj, cstart, cstop);
     }
-    return 0;
-arg_passed_twice:
-    __Pyx_RaiseDoubleKeywordsError(function_name, key);
-    goto bad;
-invalid_keyword_type:
-    PyErr_Format(PyExc_TypeError,
-        "%.200s() keywords must be strings", function_name);
-    goto bad;
-invalid_keyword:
-    PyErr_Format(PyExc_TypeError,
-    #if PY_MAJOR_VERSION < 3
-        "%.200s() got an unexpected keyword argument '%.200s'",
-        function_name, PyString_AsString(key));
-    #else
-        "%s() got an unexpected keyword argument '%U'",
-        function_name, key);
-    #endif
-bad:
-    return -1;
-}
-
-/* KeywordStringCheck */
-static int __Pyx_CheckKeywordStrings(
-    PyObject *kwdict,
-    const char* function_name,
-    int kw_allowed)
-{
-    PyObject* key = 0;
-    Py_ssize_t pos = 0;
-#if CYTHON_COMPILING_IN_PYPY
-    if (!kw_allowed && PyDict_Next(kwdict, &pos, &key, 0))
-        goto invalid_keyword;
-    return 1;
-#else
-    while (PyDict_Next(kwdict, &pos, &key, 0)) {
-        #if PY_MAJOR_VERSION < 3
-        if (unlikely(!PyString_Check(key)))
-        #endif
-            if (unlikely(!PyUnicode_Check(key)))
-                goto invalid_keyword_type;
-    }
-    if ((!kw_allowed) && unlikely(key))
-        goto invalid_keyword;
-    return 1;
-invalid_keyword_type:
-    PyErr_Format(PyExc_TypeError,
-        "%.200s() keywords must be strings", function_name);
-    return 0;
-#endif
-invalid_keyword:
-    PyErr_Format(PyExc_TypeError,
-    #if PY_MAJOR_VERSION < 3
-        "%.200s() got an unexpected keyword argument '%.200s'",
-        function_name, PyString_AsString(key));
-    #else
-        "%s() got an unexpected keyword argument '%U'",
-        function_name, key);
-    #endif
-    return 0;
-}
-
-/* GetTopmostException */
-#if CYTHON_USE_EXC_INFO_STACK
-static _PyErr_StackItem *
-__Pyx_PyErr_GetTopmostException(PyThreadState *tstate)
-{
-    _PyErr_StackItem *exc_info = tstate->exc_info;
-    while ((exc_info->exc_type == NULL || exc_info->exc_type == Py_None) &&
-           exc_info->previous_item != NULL)
-    {
-        exc_info = exc_info->previous_item;
-    }
-    return exc_info;
-}
-#endif
-
-/* SaveResetException */
-#if CYTHON_FAST_THREAD_STATE
-static CYTHON_INLINE void __Pyx__ExceptionSave(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb) {
-    #if CYTHON_USE_EXC_INFO_STACK
-    _PyErr_StackItem *exc_info = __Pyx_PyErr_GetTopmostException(tstate);
-    *type = exc_info->exc_type;
-    *value = exc_info->exc_value;
-    *tb = exc_info->exc_traceback;
-    #else
-    *type = tstate->exc_type;
-    *value = tstate->exc_value;
-    *tb = tstate->exc_traceback;
-    #endif
-    Py_XINCREF(*type);
-    Py_XINCREF(*value);
-    Py_XINCREF(*tb);
-}
-static CYTHON_INLINE void __Pyx__ExceptionReset(PyThreadState *tstate, PyObject *type, PyObject *value, PyObject *tb) {
-    PyObject *tmp_type, *tmp_value, *tmp_tb;
-    #if CYTHON_USE_EXC_INFO_STACK
-    _PyErr_StackItem *exc_info = tstate->exc_info;
-    tmp_type = exc_info->exc_type;
-    tmp_value = exc_info->exc_value;
-    tmp_tb = exc_info->exc_traceback;
-    exc_info->exc_type = type;
-    exc_info->exc_value = value;
-    exc_info->exc_traceback = tb;
-    #else
-    tmp_type = tstate->exc_type;
-    tmp_value = tstate->exc_value;
-    tmp_tb = tstate->exc_traceback;
-    tstate->exc_type = type;
-    tstate->exc_value = value;
-    tstate->exc_traceback = tb;
-    #endif
-    Py_XDECREF(tmp_type);
-    Py_XDECREF(tmp_value);
-    Py_XDECREF(tmp_tb);
-}
-#endif
-
-/* PyErrExceptionMatches */
-#if CYTHON_FAST_THREAD_STATE
-static int __Pyx_PyErr_ExceptionMatchesTuple(PyObject *exc_type, PyObject *tuple) {
-    Py_ssize_t i, n;
-    n = PyTuple_GET_SIZE(tuple);
-#if PY_MAJOR_VERSION >= 3
-    for (i=0; i<n; i++) {
-        if (exc_type == PyTuple_GET_ITEM(tuple, i)) return 1;
-    }
-#endif
-    for (i=0; i<n; i++) {
-        if (__Pyx_PyErr_GivenExceptionMatches(exc_type, PyTuple_GET_ITEM(tuple, i))) return 1;
-    }
-    return 0;
-}
-static CYTHON_INLINE int __Pyx_PyErr_ExceptionMatchesInState(PyThreadState* tstate, PyObject* err) {
-    PyObject *exc_type = tstate->curexc_type;
-    if (exc_type == err) return 1;
-    if (unlikely(!exc_type)) return 0;
-    if (unlikely(PyTuple_Check(err)))
-        return __Pyx_PyErr_ExceptionMatchesTuple(exc_type, err);
-    return __Pyx_PyErr_GivenExceptionMatches(exc_type, err);
-}
-#endif
-
-/* GetException */
-#if CYTHON_FAST_THREAD_STATE
-static int __Pyx__GetException(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb)
-#else
-static int __Pyx_GetException(PyObject **type, PyObject **value, PyObject **tb)
-#endif
-{
-    PyObject *local_type, *local_value, *local_tb;
-#if CYTHON_FAST_THREAD_STATE
-    PyObject *tmp_type, *tmp_value, *tmp_tb;
-    local_type = tstate->curexc_type;
-    local_value = tstate->curexc_value;
-    local_tb = tstate->curexc_traceback;
-    tstate->curexc_type = 0;
-    tstate->curexc_value = 0;
-    tstate->curexc_traceback = 0;
-#else
-    PyErr_Fetch(&local_type, &local_value, &local_tb);
-#endif
-    PyErr_NormalizeException(&local_type, &local_value, &local_tb);
-#if CYTHON_FAST_THREAD_STATE
-    if (unlikely(tstate->curexc_type))
-#else
-    if (unlikely(PyErr_Occurred()))
-#endif
-        goto bad;
-    #if PY_MAJOR_VERSION >= 3
-    if (local_tb) {
-        if (unlikely(PyException_SetTraceback(local_value, local_tb) < 0))
-            goto bad;
-    }
-    #endif
-    Py_XINCREF(local_tb);
-    Py_XINCREF(local_type);
-    Py_XINCREF(local_value);
-    *type = local_type;
-    *value = local_value;
-    *tb = local_tb;
-#if CYTHON_FAST_THREAD_STATE
-    #if CYTHON_USE_EXC_INFO_STACK
-    {
-        _PyErr_StackItem *exc_info = tstate->exc_info;
-        tmp_type = exc_info->exc_type;
-        tmp_value = exc_info->exc_value;
-        tmp_tb = exc_info->exc_traceback;
-        exc_info->exc_type = local_type;
-        exc_info->exc_value = local_value;
-        exc_info->exc_traceback = local_tb;
-    }
-    #else
-    tmp_type = tstate->exc_type;
-    tmp_value = tstate->exc_value;
-    tmp_tb = tstate->exc_traceback;
-    tstate->exc_type = local_type;
-    tstate->exc_value = local_value;
-    tstate->exc_traceback = local_tb;
-    #endif
-    Py_XDECREF(tmp_type);
-    Py_XDECREF(tmp_value);
-    Py_XDECREF(tmp_tb);
 #else
-    PyErr_SetExcInfo(local_type, local_value, local_tb);
-#endif
-    return 0;
-bad:
-    *type = 0;
-    *value = 0;
-    *tb = 0;
-    Py_XDECREF(local_type);
-    Py_XDECREF(local_value);
-    Py_XDECREF(local_tb);
-    return -1;
-}
-
-/* TypeImport */
-#ifndef __PYX_HAVE_RT_ImportType
-#define __PYX_HAVE_RT_ImportType
-static PyTypeObject *__Pyx_ImportType(PyObject *module, const char *module_name, const char *class_name,
-    size_t size, enum __Pyx_ImportType_CheckSize check_size)
-{
-    PyObject *result = 0;
-    char warning[200];
-    Py_ssize_t basicsize;
-#ifdef Py_LIMITED_API
-    PyObject *py_basicsize;
+    CYTHON_UNUSED_VAR(wraparound);
 #endif
-    result = PyObject_GetAttrString(module, class_name);
-    if (!result)
-        goto bad;
-    if (!PyType_Check(result)) {
-        PyErr_Format(PyExc_TypeError,
-            "%.200s.%.200s is not a type object",
-            module_name, class_name);
-        goto bad;
-    }
-#ifndef Py_LIMITED_API
-    basicsize = ((PyTypeObject *)result)->tp_basicsize;
+    mp = Py_TYPE(obj)->tp_as_mapping;
+    if (likely(mp && mp->mp_subscript))
 #else
-    py_basicsize = PyObject_GetAttrString(result, "__basicsize__");
-    if (!py_basicsize)
-        goto bad;
-    basicsize = PyLong_AsSsize_t(py_basicsize);
-    Py_DECREF(py_basicsize);
-    py_basicsize = 0;
-    if (basicsize == (Py_ssize_t)-1 && PyErr_Occurred())
-        goto bad;
-#endif
-    if ((size_t)basicsize < size) {
-        PyErr_Format(PyExc_ValueError,
-            "%.200s.%.200s size changed, may indicate binary incompatibility. "
-            "Expected %zd from C header, got %zd from PyObject",
-            module_name, class_name, size, basicsize);
-        goto bad;
-    }
-    if (check_size == __Pyx_ImportType_CheckSize_Error && (size_t)basicsize != size) {
-        PyErr_Format(PyExc_ValueError,
-            "%.200s.%.200s size changed, may indicate binary incompatibility. "
-            "Expected %zd from C header, got %zd from PyObject",
-            module_name, class_name, size, basicsize);
-        goto bad;
-    }
-    else if (check_size == __Pyx_ImportType_CheckSize_Warn && (size_t)basicsize > size) {
-        PyOS_snprintf(warning, sizeof(warning),
-            "%s.%s size changed, may indicate binary incompatibility. "
-            "Expected %zd from C header, got %zd from PyObject",
-            module_name, class_name, size, basicsize);
-        if (PyErr_WarnEx(NULL, warning, 0) < 0) goto bad;
-    }
-    return (PyTypeObject *)result;
-bad:
-    Py_XDECREF(result);
-    return NULL;
-}
+    CYTHON_UNUSED_VAR(wraparound);
 #endif
-
-/* Import */
-static PyObject *__Pyx_Import(PyObject *name, PyObject *from_list, int level) {
-    PyObject *empty_list = 0;
-    PyObject *module = 0;
-    PyObject *global_dict = 0;
-    PyObject *empty_dict = 0;
-    PyObject *list;
-    #if PY_MAJOR_VERSION < 3
-    PyObject *py_import;
-    py_import = __Pyx_PyObject_GetAttrStr(__pyx_b, __pyx_n_s_import);
-    if (!py_import)
-        goto bad;
-    #endif
-    if (from_list)
-        list = from_list;
-    else {
-        empty_list = PyList_New(0);
-        if (!empty_list)
-            goto bad;
-        list = empty_list;
-    }
-    global_dict = PyModule_GetDict(__pyx_m);
-    if (!global_dict)
-        goto bad;
-    empty_dict = PyDict_New();
-    if (!empty_dict)
-        goto bad;
     {
-        #if PY_MAJOR_VERSION >= 3
-        if (level == -1) {
-            if ((1) && (strchr(__Pyx_MODULE_NAME, '.'))) {
-                module = PyImport_ImportModuleLevelObject(
-                    name, global_dict, empty_dict, list, 1);
-                if (!module) {
-                    if (!PyErr_ExceptionMatches(PyExc_ImportError))
+        PyObject* result;
+        PyObject *py_slice, *py_start, *py_stop;
+        if (_py_slice) {
+            py_slice = *_py_slice;
+        } else {
+            PyObject* owned_start = NULL;
+            PyObject* owned_stop = NULL;
+            if (_py_start) {
+                py_start = *_py_start;
+            } else {
+                if (has_cstart) {
+                    owned_start = py_start = PyInt_FromSsize_t(cstart);
+                    if (unlikely(!py_start)) goto bad;
+                } else
+                    py_start = Py_None;
+            }
+            if (_py_stop) {
+                py_stop = *_py_stop;
+            } else {
+                if (has_cstop) {
+                    owned_stop = py_stop = PyInt_FromSsize_t(cstop);
+                    if (unlikely(!py_stop)) {
+                        Py_XDECREF(owned_start);
                         goto bad;
-                    PyErr_Clear();
-                }
+                    }
+                } else
+                    py_stop = Py_None;
             }
-            level = 0;
+            py_slice = PySlice_New(py_start, py_stop, Py_None);
+            Py_XDECREF(owned_start);
+            Py_XDECREF(owned_stop);
+            if (unlikely(!py_slice)) goto bad;
         }
-        #endif
-        if (!module) {
-            #if PY_MAJOR_VERSION < 3
-            PyObject *py_level = PyInt_FromLong(level);
-            if (!py_level)
-                goto bad;
-            module = PyObject_CallFunctionObjArgs(py_import,
-                name, global_dict, empty_dict, list, py_level, (PyObject *)NULL);
-            Py_DECREF(py_level);
-            #else
-            module = PyImport_ImportModuleLevelObject(
-                name, global_dict, empty_dict, list, level);
-            #endif
+#if CYTHON_USE_TYPE_SLOTS
+        result = mp->mp_subscript(obj, py_slice);
+#else
+        result = PyObject_GetItem(obj, py_slice);
+#endif
+        if (!_py_slice) {
+            Py_DECREF(py_slice);
         }
+        return result;
     }
+    obj_type_name = __Pyx_PyType_GetName(Py_TYPE(obj));
+    PyErr_Format(PyExc_TypeError,
+        "'" __Pyx_FMT_TYPENAME "' object is unsliceable", obj_type_name);
+    __Pyx_DECREF_TypeName(obj_type_name);
 bad:
-    #if PY_MAJOR_VERSION < 3
-    Py_XDECREF(py_import);
-    #endif
-    Py_XDECREF(empty_list);
-    Py_XDECREF(empty_dict);
-    return module;
+    return NULL;
 }
 
 /* CLineInTraceback */
 #ifndef CYTHON_CLINE_IN_TRACEBACK
-static int __Pyx_CLineForTraceback(CYTHON_NCP_UNUSED PyThreadState *tstate, int c_line) {
+static int __Pyx_CLineForTraceback(PyThreadState *tstate, int c_line) {
     PyObject *use_cline;
     PyObject *ptype, *pvalue, *ptraceback;
 #if CYTHON_COMPILING_IN_CPYTHON
     PyObject **cython_runtime_dict;
 #endif
+    CYTHON_MAYBE_UNUSED_VAR(tstate);
     if (unlikely(!__pyx_cython_runtime)) {
         return c_line;
     }
     __Pyx_ErrFetchInState(tstate, &ptype, &pvalue, &ptraceback);
 #if CYTHON_COMPILING_IN_CPYTHON
     cython_runtime_dict = _PyObject_GetDictPtr(__pyx_cython_runtime);
     if (likely(cython_runtime_dict)) {
         __PYX_PY_DICT_LOOKUP_IF_MODIFIED(
             use_cline, *cython_runtime_dict,
             __Pyx_PyDict_GetItemStr(*cython_runtime_dict, __pyx_n_s_cline_in_traceback))
     } else
 #endif
     {
-      PyObject *use_cline_obj = __Pyx_PyObject_GetAttrStr(__pyx_cython_runtime, __pyx_n_s_cline_in_traceback);
+      PyObject *use_cline_obj = __Pyx_PyObject_GetAttrStrNoError(__pyx_cython_runtime, __pyx_n_s_cline_in_traceback);
       if (use_cline_obj) {
         use_cline = PyObject_Not(use_cline_obj) ? Py_False : Py_True;
         Py_DECREF(use_cline_obj);
       } else {
         PyErr_Clear();
         use_cline = NULL;
       }
     }
     if (!use_cline) {
         c_line = 0;
-        PyObject_SetAttr(__pyx_cython_runtime, __pyx_n_s_cline_in_traceback, Py_False);
+        (void) PyObject_SetAttr(__pyx_cython_runtime, __pyx_n_s_cline_in_traceback, Py_False);
     }
     else if (use_cline == Py_False || (use_cline != Py_True && PyObject_Not(use_cline) != 0)) {
         c_line = 0;
     }
     __Pyx_ErrRestoreInState(tstate, ptype, pvalue, ptraceback);
     return c_line;
 }
 #endif
 
 /* CodeObjectCache */
+#if !CYTHON_COMPILING_IN_LIMITED_API
 static int __pyx_bisect_code_objects(__Pyx_CodeObjectCacheEntry* entries, int count, int code_line) {
     int start = 0, mid = 0, end = count - 1;
     if (end >= 0 && code_line > entries[end].code_line) {
         return count;
     }
     while (start < end) {
         mid = start + (end - start) / 2;
@@ -9806,84 +9337,118 @@
         entries[i] = entries[i-1];
     }
     entries[pos].code_line = code_line;
     entries[pos].code_object = code_object;
     __pyx_code_cache.count++;
     Py_INCREF(code_object);
 }
+#endif
 
 /* AddTraceback */
 #include "compile.h"
 #include "frameobject.h"
 #include "traceback.h"
+#if PY_VERSION_HEX >= 0x030b00a6
+  #ifndef Py_BUILD_CORE
+    #define Py_BUILD_CORE 1
+  #endif
+  #include "internal/pycore_frame.h"
+#endif
+#if CYTHON_COMPILING_IN_LIMITED_API
+static void __Pyx_AddTraceback(const char *funcname, int c_line,
+                               int py_line, const char *filename) {
+    if (c_line) {
+        (void) __pyx_cfilenm;
+        (void) __Pyx_CLineForTraceback(__Pyx_PyThreadState_Current, c_line);
+    }
+    _PyTraceback_Add(funcname, filename, py_line);
+}
+#else
 static PyCodeObject* __Pyx_CreateCodeObjectForTraceback(
             const char *funcname, int c_line,
             int py_line, const char *filename) {
-    PyCodeObject *py_code = 0;
-    PyObject *py_srcfile = 0;
-    PyObject *py_funcname = 0;
+    PyCodeObject *py_code = NULL;
+    PyObject *py_funcname = NULL;
     #if PY_MAJOR_VERSION < 3
+    PyObject *py_srcfile = NULL;
     py_srcfile = PyString_FromString(filename);
-    #else
-    py_srcfile = PyUnicode_FromString(filename);
-    #endif
     if (!py_srcfile) goto bad;
+    #endif
     if (c_line) {
         #if PY_MAJOR_VERSION < 3
         py_funcname = PyString_FromFormat( "%s (%s:%d)", funcname, __pyx_cfilenm, c_line);
+        if (!py_funcname) goto bad;
         #else
         py_funcname = PyUnicode_FromFormat( "%s (%s:%d)", funcname, __pyx_cfilenm, c_line);
+        if (!py_funcname) goto bad;
+        funcname = PyUnicode_AsUTF8(py_funcname);
+        if (!funcname) goto bad;
         #endif
     }
     else {
         #if PY_MAJOR_VERSION < 3
         py_funcname = PyString_FromString(funcname);
-        #else
-        py_funcname = PyUnicode_FromString(funcname);
+        if (!py_funcname) goto bad;
         #endif
     }
-    if (!py_funcname) goto bad;
+    #if PY_MAJOR_VERSION < 3
     py_code = __Pyx_PyCode_New(
         0,
         0,
         0,
         0,
         0,
+        0,
         __pyx_empty_bytes, /*PyObject *code,*/
         __pyx_empty_tuple, /*PyObject *consts,*/
         __pyx_empty_tuple, /*PyObject *names,*/
         __pyx_empty_tuple, /*PyObject *varnames,*/
         __pyx_empty_tuple, /*PyObject *freevars,*/
         __pyx_empty_tuple, /*PyObject *cellvars,*/
         py_srcfile,   /*PyObject *filename,*/
         py_funcname,  /*PyObject *name,*/
         py_line,
         __pyx_empty_bytes  /*PyObject *lnotab*/
     );
     Py_DECREF(py_srcfile);
-    Py_DECREF(py_funcname);
+    #else
+    py_code = PyCode_NewEmpty(filename, funcname, py_line);
+    #endif
+    Py_XDECREF(py_funcname);  // XDECREF since it's only set on Py3 if cline
     return py_code;
 bad:
-    Py_XDECREF(py_srcfile);
     Py_XDECREF(py_funcname);
+    #if PY_MAJOR_VERSION < 3
+    Py_XDECREF(py_srcfile);
+    #endif
     return NULL;
 }
 static void __Pyx_AddTraceback(const char *funcname, int c_line,
                                int py_line, const char *filename) {
     PyCodeObject *py_code = 0;
     PyFrameObject *py_frame = 0;
     PyThreadState *tstate = __Pyx_PyThreadState_Current;
+    PyObject *ptype, *pvalue, *ptraceback;
     if (c_line) {
         c_line = __Pyx_CLineForTraceback(tstate, c_line);
     }
     py_code = __pyx_find_code_object(c_line ? -c_line : py_line);
     if (!py_code) {
+        __Pyx_ErrFetchInState(tstate, &ptype, &pvalue, &ptraceback);
         py_code = __Pyx_CreateCodeObjectForTraceback(
             funcname, c_line, py_line, filename);
-        if (!py_code) goto bad;
+        if (!py_code) {
+            /* If the code object creation fails, then we should clear the
+               fetched exception references and propagate the new exception */
+            Py_XDECREF(ptype);
+            Py_XDECREF(pvalue);
+            Py_XDECREF(ptraceback);
+            goto bad;
+        }
+        __Pyx_ErrRestoreInState(tstate, ptype, pvalue, ptraceback);
         __pyx_insert_code_object(c_line ? -c_line : py_line, py_code);
     }
     py_frame = PyFrame_New(
         tstate,            /*PyThreadState *tstate,*/
         py_code,           /*PyCodeObject *code,*/
         __pyx_d,    /*PyObject *globals,*/
         0                  /*PyObject *locals*/
@@ -9891,14 +9456,15 @@
     if (!py_frame) goto bad;
     __Pyx_PyFrame_SetLineNumber(py_frame, py_line);
     PyTraceBack_Here(py_frame);
 bad:
     Py_XDECREF(py_code);
     Py_XDECREF(py_frame);
 }
+#endif
 
 /* CIntFromPyVerify */
 #define __PYX_VERIFY_RETURN_INT(target_type, func_type, func_value)\
     __PYX__VERIFY_RETURN_INT(target_type, func_type, func_value, 0)
 #define __PYX_VERIFY_RETURN_INT_EXC(target_type, func_type, func_value)\
     __PYX__VERIFY_RETURN_INT(target_type, func_type, func_value, 1)
 #define __PYX__VERIFY_RETURN_INT(target_type, func_type, func_value, exc)\
@@ -9914,1151 +9480,960 @@
                 else\
                     goto raise_overflow;\
             }\
         }\
         return (target_type) value;\
     }
 
-/* CIntToPy */
-static CYTHON_INLINE PyObject* __Pyx_PyInt_From_lua_Integer(lua_Integer value) {
-    const lua_Integer neg_one = (lua_Integer) ((lua_Integer) 0 - (lua_Integer) 1), const_zero = (lua_Integer) 0;
-    const int is_unsigned = neg_one > const_zero;
-    if (is_unsigned) {
-        if (sizeof(lua_Integer) < sizeof(long)) {
-            return PyInt_FromLong((long) value);
-        } else if (sizeof(lua_Integer) <= sizeof(unsigned long)) {
-            return PyLong_FromUnsignedLong((unsigned long) value);
-#ifdef HAVE_LONG_LONG
-        } else if (sizeof(lua_Integer) <= sizeof(unsigned PY_LONG_LONG)) {
-            return PyLong_FromUnsignedLongLong((unsigned PY_LONG_LONG) value);
-#endif
-        }
-    } else {
-        if (sizeof(lua_Integer) <= sizeof(long)) {
-            return PyInt_FromLong((long) value);
-#ifdef HAVE_LONG_LONG
-        } else if (sizeof(lua_Integer) <= sizeof(PY_LONG_LONG)) {
-            return PyLong_FromLongLong((PY_LONG_LONG) value);
-#endif
-        }
-    }
-    {
-        int one = 1; int little = (int)*(unsigned char *)&one;
-        unsigned char *bytes = (unsigned char *)&value;
-        return _PyLong_FromByteArray(bytes, sizeof(lua_Integer),
-                                     little, !is_unsigned);
-    }
-}
-
-/* CIntToPy */
-static CYTHON_INLINE PyObject* __Pyx_PyInt_From_long(long value) {
-    const long neg_one = (long) ((long) 0 - (long) 1), const_zero = (long) 0;
-    const int is_unsigned = neg_one > const_zero;
-    if (is_unsigned) {
-        if (sizeof(long) < sizeof(long)) {
-            return PyInt_FromLong((long) value);
-        } else if (sizeof(long) <= sizeof(unsigned long)) {
-            return PyLong_FromUnsignedLong((unsigned long) value);
-#ifdef HAVE_LONG_LONG
-        } else if (sizeof(long) <= sizeof(unsigned PY_LONG_LONG)) {
-            return PyLong_FromUnsignedLongLong((unsigned PY_LONG_LONG) value);
-#endif
-        }
-    } else {
-        if (sizeof(long) <= sizeof(long)) {
-            return PyInt_FromLong((long) value);
-#ifdef HAVE_LONG_LONG
-        } else if (sizeof(long) <= sizeof(PY_LONG_LONG)) {
-            return PyLong_FromLongLong((PY_LONG_LONG) value);
-#endif
-        }
-    }
-    {
-        int one = 1; int little = (int)*(unsigned char *)&one;
-        unsigned char *bytes = (unsigned char *)&value;
-        return _PyLong_FromByteArray(bytes, sizeof(long),
-                                     little, !is_unsigned);
-    }
-}
-
-/* CIntToPy */
-static CYTHON_INLINE PyObject* __Pyx_PyInt_From_int(int value) {
-    const int neg_one = (int) ((int) 0 - (int) 1), const_zero = (int) 0;
-    const int is_unsigned = neg_one > const_zero;
-    if (is_unsigned) {
-        if (sizeof(int) < sizeof(long)) {
-            return PyInt_FromLong((long) value);
-        } else if (sizeof(int) <= sizeof(unsigned long)) {
-            return PyLong_FromUnsignedLong((unsigned long) value);
-#ifdef HAVE_LONG_LONG
-        } else if (sizeof(int) <= sizeof(unsigned PY_LONG_LONG)) {
-            return PyLong_FromUnsignedLongLong((unsigned PY_LONG_LONG) value);
-#endif
-        }
-    } else {
-        if (sizeof(int) <= sizeof(long)) {
-            return PyInt_FromLong((long) value);
-#ifdef HAVE_LONG_LONG
-        } else if (sizeof(int) <= sizeof(PY_LONG_LONG)) {
-            return PyLong_FromLongLong((PY_LONG_LONG) value);
-#endif
-        }
-    }
-    {
-        int one = 1; int little = (int)*(unsigned char *)&one;
-        unsigned char *bytes = (unsigned char *)&value;
-        return _PyLong_FromByteArray(bytes, sizeof(int),
-                                     little, !is_unsigned);
-    }
-}
-
-/* Declarations */
-#if CYTHON_CCOMPLEX
-  #ifdef __cplusplus
-    static CYTHON_INLINE __pyx_t_float_complex __pyx_t_float_complex_from_parts(float x, float y) {
-      return ::std::complex< float >(x, y);
-    }
-  #else
-    static CYTHON_INLINE __pyx_t_float_complex __pyx_t_float_complex_from_parts(float x, float y) {
-      return x + y*(__pyx_t_float_complex)_Complex_I;
-    }
-  #endif
-#else
-    static CYTHON_INLINE __pyx_t_float_complex __pyx_t_float_complex_from_parts(float x, float y) {
-      __pyx_t_float_complex z;
-      z.real = x;
-      z.imag = y;
-      return z;
-    }
-#endif
-
-/* Arithmetic */
-#if CYTHON_CCOMPLEX
-#else
-    static CYTHON_INLINE int __Pyx_c_eq_float(__pyx_t_float_complex a, __pyx_t_float_complex b) {
-       return (a.real == b.real) && (a.imag == b.imag);
-    }
-    static CYTHON_INLINE __pyx_t_float_complex __Pyx_c_sum_float(__pyx_t_float_complex a, __pyx_t_float_complex b) {
-        __pyx_t_float_complex z;
-        z.real = a.real + b.real;
-        z.imag = a.imag + b.imag;
-        return z;
-    }
-    static CYTHON_INLINE __pyx_t_float_complex __Pyx_c_diff_float(__pyx_t_float_complex a, __pyx_t_float_complex b) {
-        __pyx_t_float_complex z;
-        z.real = a.real - b.real;
-        z.imag = a.imag - b.imag;
-        return z;
-    }
-    static CYTHON_INLINE __pyx_t_float_complex __Pyx_c_prod_float(__pyx_t_float_complex a, __pyx_t_float_complex b) {
-        __pyx_t_float_complex z;
-        z.real = a.real * b.real - a.imag * b.imag;
-        z.imag = a.real * b.imag + a.imag * b.real;
-        return z;
-    }
-    #if 1
-    static CYTHON_INLINE __pyx_t_float_complex __Pyx_c_quot_float(__pyx_t_float_complex a, __pyx_t_float_complex b) {
-        if (b.imag == 0) {
-            return __pyx_t_float_complex_from_parts(a.real / b.real, a.imag / b.real);
-        } else if (fabsf(b.real) >= fabsf(b.imag)) {
-            if (b.real == 0 && b.imag == 0) {
-                return __pyx_t_float_complex_from_parts(a.real / b.real, a.imag / b.imag);
-            } else {
-                float r = b.imag / b.real;
-                float s = (float)(1.0) / (b.real + b.imag * r);
-                return __pyx_t_float_complex_from_parts(
-                    (a.real + a.imag * r) * s, (a.imag - a.real * r) * s);
-            }
-        } else {
-            float r = b.real / b.imag;
-            float s = (float)(1.0) / (b.imag + b.real * r);
-            return __pyx_t_float_complex_from_parts(
-                (a.real * r + a.imag) * s, (a.imag * r - a.real) * s);
-        }
-    }
-    #else
-    static CYTHON_INLINE __pyx_t_float_complex __Pyx_c_quot_float(__pyx_t_float_complex a, __pyx_t_float_complex b) {
-        if (b.imag == 0) {
-            return __pyx_t_float_complex_from_parts(a.real / b.real, a.imag / b.real);
-        } else {
-            float denom = b.real * b.real + b.imag * b.imag;
-            return __pyx_t_float_complex_from_parts(
-                (a.real * b.real + a.imag * b.imag) / denom,
-                (a.imag * b.real - a.real * b.imag) / denom);
-        }
-    }
-    #endif
-    static CYTHON_INLINE __pyx_t_float_complex __Pyx_c_neg_float(__pyx_t_float_complex a) {
-        __pyx_t_float_complex z;
-        z.real = -a.real;
-        z.imag = -a.imag;
-        return z;
-    }
-    static CYTHON_INLINE int __Pyx_c_is_zero_float(__pyx_t_float_complex a) {
-       return (a.real == 0) && (a.imag == 0);
-    }
-    static CYTHON_INLINE __pyx_t_float_complex __Pyx_c_conj_float(__pyx_t_float_complex a) {
-        __pyx_t_float_complex z;
-        z.real =  a.real;
-        z.imag = -a.imag;
-        return z;
-    }
-    #if 1
-        static CYTHON_INLINE float __Pyx_c_abs_float(__pyx_t_float_complex z) {
-          #if !defined(HAVE_HYPOT) || defined(_MSC_VER)
-            return sqrtf(z.real*z.real + z.imag*z.imag);
-          #else
-            return hypotf(z.real, z.imag);
-          #endif
-        }
-        static CYTHON_INLINE __pyx_t_float_complex __Pyx_c_pow_float(__pyx_t_float_complex a, __pyx_t_float_complex b) {
-            __pyx_t_float_complex z;
-            float r, lnr, theta, z_r, z_theta;
-            if (b.imag == 0 && b.real == (int)b.real) {
-                if (b.real < 0) {
-                    float denom = a.real * a.real + a.imag * a.imag;
-                    a.real = a.real / denom;
-                    a.imag = -a.imag / denom;
-                    b.real = -b.real;
-                }
-                switch ((int)b.real) {
-                    case 0:
-                        z.real = 1;
-                        z.imag = 0;
-                        return z;
-                    case 1:
-                        return a;
-                    case 2:
-                        return __Pyx_c_prod_float(a, a);
-                    case 3:
-                        z = __Pyx_c_prod_float(a, a);
-                        return __Pyx_c_prod_float(z, a);
-                    case 4:
-                        z = __Pyx_c_prod_float(a, a);
-                        return __Pyx_c_prod_float(z, z);
-                }
-            }
-            if (a.imag == 0) {
-                if (a.real == 0) {
-                    return a;
-                } else if (b.imag == 0) {
-                    z.real = powf(a.real, b.real);
-                    z.imag = 0;
-                    return z;
-                } else if (a.real > 0) {
-                    r = a.real;
-                    theta = 0;
-                } else {
-                    r = -a.real;
-                    theta = atan2f(0.0, -1.0);
-                }
-            } else {
-                r = __Pyx_c_abs_float(a);
-                theta = atan2f(a.imag, a.real);
-            }
-            lnr = logf(r);
-            z_r = expf(lnr * b.real - theta * b.imag);
-            z_theta = theta * b.real + lnr * b.imag;
-            z.real = z_r * cosf(z_theta);
-            z.imag = z_r * sinf(z_theta);
-            return z;
-        }
-    #endif
-#endif
-
-/* Declarations */
-#if CYTHON_CCOMPLEX
-  #ifdef __cplusplus
-    static CYTHON_INLINE __pyx_t_double_complex __pyx_t_double_complex_from_parts(double x, double y) {
-      return ::std::complex< double >(x, y);
-    }
-  #else
-    static CYTHON_INLINE __pyx_t_double_complex __pyx_t_double_complex_from_parts(double x, double y) {
-      return x + y*(__pyx_t_double_complex)_Complex_I;
-    }
-  #endif
-#else
-    static CYTHON_INLINE __pyx_t_double_complex __pyx_t_double_complex_from_parts(double x, double y) {
-      __pyx_t_double_complex z;
-      z.real = x;
-      z.imag = y;
-      return z;
-    }
-#endif
-
-/* Arithmetic */
-#if CYTHON_CCOMPLEX
-#else
-    static CYTHON_INLINE int __Pyx_c_eq_double(__pyx_t_double_complex a, __pyx_t_double_complex b) {
-       return (a.real == b.real) && (a.imag == b.imag);
-    }
-    static CYTHON_INLINE __pyx_t_double_complex __Pyx_c_sum_double(__pyx_t_double_complex a, __pyx_t_double_complex b) {
-        __pyx_t_double_complex z;
-        z.real = a.real + b.real;
-        z.imag = a.imag + b.imag;
-        return z;
-    }
-    static CYTHON_INLINE __pyx_t_double_complex __Pyx_c_diff_double(__pyx_t_double_complex a, __pyx_t_double_complex b) {
-        __pyx_t_double_complex z;
-        z.real = a.real - b.real;
-        z.imag = a.imag - b.imag;
-        return z;
-    }
-    static CYTHON_INLINE __pyx_t_double_complex __Pyx_c_prod_double(__pyx_t_double_complex a, __pyx_t_double_complex b) {
-        __pyx_t_double_complex z;
-        z.real = a.real * b.real - a.imag * b.imag;
-        z.imag = a.real * b.imag + a.imag * b.real;
-        return z;
-    }
-    #if 1
-    static CYTHON_INLINE __pyx_t_double_complex __Pyx_c_quot_double(__pyx_t_double_complex a, __pyx_t_double_complex b) {
-        if (b.imag == 0) {
-            return __pyx_t_double_complex_from_parts(a.real / b.real, a.imag / b.real);
-        } else if (fabs(b.real) >= fabs(b.imag)) {
-            if (b.real == 0 && b.imag == 0) {
-                return __pyx_t_double_complex_from_parts(a.real / b.real, a.imag / b.imag);
-            } else {
-                double r = b.imag / b.real;
-                double s = (double)(1.0) / (b.real + b.imag * r);
-                return __pyx_t_double_complex_from_parts(
-                    (a.real + a.imag * r) * s, (a.imag - a.real * r) * s);
-            }
-        } else {
-            double r = b.real / b.imag;
-            double s = (double)(1.0) / (b.imag + b.real * r);
-            return __pyx_t_double_complex_from_parts(
-                (a.real * r + a.imag) * s, (a.imag * r - a.real) * s);
-        }
-    }
-    #else
-    static CYTHON_INLINE __pyx_t_double_complex __Pyx_c_quot_double(__pyx_t_double_complex a, __pyx_t_double_complex b) {
-        if (b.imag == 0) {
-            return __pyx_t_double_complex_from_parts(a.real / b.real, a.imag / b.real);
-        } else {
-            double denom = b.real * b.real + b.imag * b.imag;
-            return __pyx_t_double_complex_from_parts(
-                (a.real * b.real + a.imag * b.imag) / denom,
-                (a.imag * b.real - a.real * b.imag) / denom);
-        }
-    }
-    #endif
-    static CYTHON_INLINE __pyx_t_double_complex __Pyx_c_neg_double(__pyx_t_double_complex a) {
-        __pyx_t_double_complex z;
-        z.real = -a.real;
-        z.imag = -a.imag;
-        return z;
-    }
-    static CYTHON_INLINE int __Pyx_c_is_zero_double(__pyx_t_double_complex a) {
-       return (a.real == 0) && (a.imag == 0);
-    }
-    static CYTHON_INLINE __pyx_t_double_complex __Pyx_c_conj_double(__pyx_t_double_complex a) {
-        __pyx_t_double_complex z;
-        z.real =  a.real;
-        z.imag = -a.imag;
-        return z;
-    }
-    #if 1
-        static CYTHON_INLINE double __Pyx_c_abs_double(__pyx_t_double_complex z) {
-          #if !defined(HAVE_HYPOT) || defined(_MSC_VER)
-            return sqrt(z.real*z.real + z.imag*z.imag);
-          #else
-            return hypot(z.real, z.imag);
-          #endif
-        }
-        static CYTHON_INLINE __pyx_t_double_complex __Pyx_c_pow_double(__pyx_t_double_complex a, __pyx_t_double_complex b) {
-            __pyx_t_double_complex z;
-            double r, lnr, theta, z_r, z_theta;
-            if (b.imag == 0 && b.real == (int)b.real) {
-                if (b.real < 0) {
-                    double denom = a.real * a.real + a.imag * a.imag;
-                    a.real = a.real / denom;
-                    a.imag = -a.imag / denom;
-                    b.real = -b.real;
-                }
-                switch ((int)b.real) {
-                    case 0:
-                        z.real = 1;
-                        z.imag = 0;
-                        return z;
-                    case 1:
-                        return a;
-                    case 2:
-                        return __Pyx_c_prod_double(a, a);
-                    case 3:
-                        z = __Pyx_c_prod_double(a, a);
-                        return __Pyx_c_prod_double(z, a);
-                    case 4:
-                        z = __Pyx_c_prod_double(a, a);
-                        return __Pyx_c_prod_double(z, z);
-                }
-            }
-            if (a.imag == 0) {
-                if (a.real == 0) {
-                    return a;
-                } else if (b.imag == 0) {
-                    z.real = pow(a.real, b.real);
-                    z.imag = 0;
-                    return z;
-                } else if (a.real > 0) {
-                    r = a.real;
-                    theta = 0;
-                } else {
-                    r = -a.real;
-                    theta = atan2(0.0, -1.0);
-                }
-            } else {
-                r = __Pyx_c_abs_double(a);
-                theta = atan2(a.imag, a.real);
-            }
-            lnr = log(r);
-            z_r = exp(lnr * b.real - theta * b.imag);
-            z_theta = theta * b.real + lnr * b.imag;
-            z.real = z_r * cos(z_theta);
-            z.imag = z_r * sin(z_theta);
-            return z;
-        }
-    #endif
-#endif
-
 /* CIntFromPy */
-static CYTHON_INLINE size_t __Pyx_PyInt_As_size_t(PyObject *x) {
-    const size_t neg_one = (size_t) ((size_t) 0 - (size_t) 1), const_zero = (size_t) 0;
+static CYTHON_INLINE int __Pyx_PyInt_As_int(PyObject *x) {
+#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
+#pragma GCC diagnostic push
+#pragma GCC diagnostic ignored "-Wconversion"
+#endif
+    const int neg_one = (int) -1, const_zero = (int) 0;
+#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
+#pragma GCC diagnostic pop
+#endif
     const int is_unsigned = neg_one > const_zero;
 #if PY_MAJOR_VERSION < 3
     if (likely(PyInt_Check(x))) {
-        if (sizeof(size_t) < sizeof(long)) {
-            __PYX_VERIFY_RETURN_INT(size_t, long, PyInt_AS_LONG(x))
+        if ((sizeof(int) < sizeof(long))) {
+            __PYX_VERIFY_RETURN_INT(int, long, PyInt_AS_LONG(x))
         } else {
             long val = PyInt_AS_LONG(x);
             if (is_unsigned && unlikely(val < 0)) {
                 goto raise_neg_overflow;
             }
-            return (size_t) val;
+            return (int) val;
         }
     } else
 #endif
     if (likely(PyLong_Check(x))) {
         if (is_unsigned) {
 #if CYTHON_USE_PYLONG_INTERNALS
-            const digit* digits = ((PyLongObject*)x)->ob_digit;
-            switch (Py_SIZE(x)) {
-                case  0: return (size_t) 0;
-                case  1: __PYX_VERIFY_RETURN_INT(size_t, digit, digits[0])
-                case 2:
-                    if (8 * sizeof(size_t) > 1 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 2 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(size_t, unsigned long, (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(size_t) >= 2 * PyLong_SHIFT) {
-                            return (size_t) (((((size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0]));
+            if (unlikely(__Pyx_PyLong_IsNeg(x))) {
+                goto raise_neg_overflow;
+            } else if (__Pyx_PyLong_IsCompact(x)) {
+                __PYX_VERIFY_RETURN_INT(int, __Pyx_compact_upylong, __Pyx_PyLong_CompactValueUnsigned(x))
+            } else {
+                const digit* digits = __Pyx_PyLong_Digits(x);
+                assert(__Pyx_PyLong_DigitCount(x) > 1);
+                switch (__Pyx_PyLong_DigitCount(x)) {
+                    case 2:
+                        if ((8 * sizeof(int) > 1 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 2 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(int, unsigned long, (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(int) >= 2 * PyLong_SHIFT)) {
+                                return (int) (((((int)digits[1]) << PyLong_SHIFT) | (int)digits[0]));
+                            }
                         }
-                    }
-                    break;
-                case 3:
-                    if (8 * sizeof(size_t) > 2 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 3 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(size_t, unsigned long, (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(size_t) >= 3 * PyLong_SHIFT) {
-                            return (size_t) (((((((size_t)digits[2]) << PyLong_SHIFT) | (size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0]));
+                        break;
+                    case 3:
+                        if ((8 * sizeof(int) > 2 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 3 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(int, unsigned long, (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(int) >= 3 * PyLong_SHIFT)) {
+                                return (int) (((((((int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0]));
+                            }
                         }
-                    }
-                    break;
-                case 4:
-                    if (8 * sizeof(size_t) > 3 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 4 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(size_t, unsigned long, (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(size_t) >= 4 * PyLong_SHIFT) {
-                            return (size_t) (((((((((size_t)digits[3]) << PyLong_SHIFT) | (size_t)digits[2]) << PyLong_SHIFT) | (size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0]));
+                        break;
+                    case 4:
+                        if ((8 * sizeof(int) > 3 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 4 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(int, unsigned long, (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(int) >= 4 * PyLong_SHIFT)) {
+                                return (int) (((((((((int)digits[3]) << PyLong_SHIFT) | (int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0]));
+                            }
                         }
-                    }
-                    break;
+                        break;
+                }
             }
 #endif
-#if CYTHON_COMPILING_IN_CPYTHON
+#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX < 0x030C00A7
             if (unlikely(Py_SIZE(x) < 0)) {
                 goto raise_neg_overflow;
             }
 #else
             {
                 int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
                 if (unlikely(result < 0))
-                    return (size_t) -1;
+                    return (int) -1;
                 if (unlikely(result == 1))
                     goto raise_neg_overflow;
             }
 #endif
-            if (sizeof(size_t) <= sizeof(unsigned long)) {
-                __PYX_VERIFY_RETURN_INT_EXC(size_t, unsigned long, PyLong_AsUnsignedLong(x))
+            if ((sizeof(int) <= sizeof(unsigned long))) {
+                __PYX_VERIFY_RETURN_INT_EXC(int, unsigned long, PyLong_AsUnsignedLong(x))
 #ifdef HAVE_LONG_LONG
-            } else if (sizeof(size_t) <= sizeof(unsigned PY_LONG_LONG)) {
-                __PYX_VERIFY_RETURN_INT_EXC(size_t, unsigned PY_LONG_LONG, PyLong_AsUnsignedLongLong(x))
+            } else if ((sizeof(int) <= sizeof(unsigned PY_LONG_LONG))) {
+                __PYX_VERIFY_RETURN_INT_EXC(int, unsigned PY_LONG_LONG, PyLong_AsUnsignedLongLong(x))
 #endif
             }
         } else {
 #if CYTHON_USE_PYLONG_INTERNALS
-            const digit* digits = ((PyLongObject*)x)->ob_digit;
-            switch (Py_SIZE(x)) {
-                case  0: return (size_t) 0;
-                case -1: __PYX_VERIFY_RETURN_INT(size_t, sdigit, (sdigit) (-(sdigit)digits[0]))
-                case  1: __PYX_VERIFY_RETURN_INT(size_t,  digit, +digits[0])
-                case -2:
-                    if (8 * sizeof(size_t) - 1 > 1 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 2 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(size_t, long, -(long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(size_t) - 1 > 2 * PyLong_SHIFT) {
-                            return (size_t) (((size_t)-1)*(((((size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0])));
+            if (__Pyx_PyLong_IsCompact(x)) {
+                __PYX_VERIFY_RETURN_INT(int, __Pyx_compact_pylong, __Pyx_PyLong_CompactValue(x))
+            } else {
+                const digit* digits = __Pyx_PyLong_Digits(x);
+                assert(__Pyx_PyLong_DigitCount(x) > 1);
+                switch (__Pyx_PyLong_SignedDigitCount(x)) {
+                    case -2:
+                        if ((8 * sizeof(int) - 1 > 1 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 2 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(int, long, -(long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(int) - 1 > 2 * PyLong_SHIFT)) {
+                                return (int) (((int)-1)*(((((int)digits[1]) << PyLong_SHIFT) | (int)digits[0])));
+                            }
                         }
-                    }
-                    break;
-                case 2:
-                    if (8 * sizeof(size_t) > 1 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 2 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(size_t, unsigned long, (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(size_t) - 1 > 2 * PyLong_SHIFT) {
-                            return (size_t) ((((((size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0])));
+                        break;
+                    case 2:
+                        if ((8 * sizeof(int) > 1 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 2 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(int, unsigned long, (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(int) - 1 > 2 * PyLong_SHIFT)) {
+                                return (int) ((((((int)digits[1]) << PyLong_SHIFT) | (int)digits[0])));
+                            }
                         }
-                    }
-                    break;
-                case -3:
-                    if (8 * sizeof(size_t) - 1 > 2 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 3 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(size_t, long, -(long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(size_t) - 1 > 3 * PyLong_SHIFT) {
-                            return (size_t) (((size_t)-1)*(((((((size_t)digits[2]) << PyLong_SHIFT) | (size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0])));
+                        break;
+                    case -3:
+                        if ((8 * sizeof(int) - 1 > 2 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 3 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(int, long, -(long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(int) - 1 > 3 * PyLong_SHIFT)) {
+                                return (int) (((int)-1)*(((((((int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0])));
+                            }
                         }
-                    }
-                    break;
-                case 3:
-                    if (8 * sizeof(size_t) > 2 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 3 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(size_t, unsigned long, (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(size_t) - 1 > 3 * PyLong_SHIFT) {
-                            return (size_t) ((((((((size_t)digits[2]) << PyLong_SHIFT) | (size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0])));
+                        break;
+                    case 3:
+                        if ((8 * sizeof(int) > 2 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 3 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(int, unsigned long, (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(int) - 1 > 3 * PyLong_SHIFT)) {
+                                return (int) ((((((((int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0])));
+                            }
                         }
-                    }
-                    break;
-                case -4:
-                    if (8 * sizeof(size_t) - 1 > 3 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 4 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(size_t, long, -(long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(size_t) - 1 > 4 * PyLong_SHIFT) {
-                            return (size_t) (((size_t)-1)*(((((((((size_t)digits[3]) << PyLong_SHIFT) | (size_t)digits[2]) << PyLong_SHIFT) | (size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0])));
+                        break;
+                    case -4:
+                        if ((8 * sizeof(int) - 1 > 3 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 4 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(int, long, -(long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(int) - 1 > 4 * PyLong_SHIFT)) {
+                                return (int) (((int)-1)*(((((((((int)digits[3]) << PyLong_SHIFT) | (int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0])));
+                            }
                         }
-                    }
-                    break;
-                case 4:
-                    if (8 * sizeof(size_t) > 3 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 4 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(size_t, unsigned long, (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(size_t) - 1 > 4 * PyLong_SHIFT) {
-                            return (size_t) ((((((((((size_t)digits[3]) << PyLong_SHIFT) | (size_t)digits[2]) << PyLong_SHIFT) | (size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0])));
+                        break;
+                    case 4:
+                        if ((8 * sizeof(int) > 3 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 4 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(int, unsigned long, (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(int) - 1 > 4 * PyLong_SHIFT)) {
+                                return (int) ((((((((((int)digits[3]) << PyLong_SHIFT) | (int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0])));
+                            }
                         }
-                    }
-                    break;
+                        break;
+                }
             }
 #endif
-            if (sizeof(size_t) <= sizeof(long)) {
-                __PYX_VERIFY_RETURN_INT_EXC(size_t, long, PyLong_AsLong(x))
+            if ((sizeof(int) <= sizeof(long))) {
+                __PYX_VERIFY_RETURN_INT_EXC(int, long, PyLong_AsLong(x))
 #ifdef HAVE_LONG_LONG
-            } else if (sizeof(size_t) <= sizeof(PY_LONG_LONG)) {
-                __PYX_VERIFY_RETURN_INT_EXC(size_t, PY_LONG_LONG, PyLong_AsLongLong(x))
+            } else if ((sizeof(int) <= sizeof(PY_LONG_LONG))) {
+                __PYX_VERIFY_RETURN_INT_EXC(int, PY_LONG_LONG, PyLong_AsLongLong(x))
 #endif
             }
         }
         {
-#if CYTHON_COMPILING_IN_PYPY && !defined(_PyLong_AsByteArray)
-            PyErr_SetString(PyExc_RuntimeError,
-                            "_PyLong_AsByteArray() not available in PyPy, cannot convert large numbers");
-#else
-            size_t val;
+            int val;
             PyObject *v = __Pyx_PyNumber_IntOrLong(x);
- #if PY_MAJOR_VERSION < 3
+#if PY_MAJOR_VERSION < 3
             if (likely(v) && !PyLong_Check(v)) {
                 PyObject *tmp = v;
                 v = PyNumber_Long(tmp);
                 Py_DECREF(tmp);
             }
- #endif
+#endif
             if (likely(v)) {
+                int ret = -1;
+#if !(CYTHON_COMPILING_IN_PYPY || CYTHON_COMPILING_IN_LIMITED_API) || defined(_PyLong_AsByteArray)
                 int one = 1; int is_little = (int)*(unsigned char *)&one;
                 unsigned char *bytes = (unsigned char *)&val;
-                int ret = _PyLong_AsByteArray((PyLongObject *)v,
-                                              bytes, sizeof(val),
-                                              is_little, !is_unsigned);
+                ret = _PyLong_AsByteArray((PyLongObject *)v,
+                                           bytes, sizeof(val),
+                                           is_little, !is_unsigned);
+#else
+                PyObject *stepval = NULL, *mask = NULL, *shift = NULL;
+                int bits, remaining_bits, is_negative = 0;
+                long idigit;
+                int chunk_size = (sizeof(long) < 8) ? 30 : 62;
+                if (unlikely(!PyLong_CheckExact(v))) {
+                    PyObject *tmp = v;
+                    v = PyNumber_Long(v);
+                    assert(PyLong_CheckExact(v));
+                    Py_DECREF(tmp);
+                    if (unlikely(!v)) return (int) -1;
+                }
+#if CYTHON_COMPILING_IN_LIMITED_API && PY_VERSION_HEX < 0x030B0000
+                if (Py_SIZE(x) == 0)
+                    return (int) 0;
+                is_negative = Py_SIZE(x) < 0;
+#else
+                {
+                    int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
+                    if (unlikely(result < 0))
+                        return (int) -1;
+                    is_negative = result == 1;
+                }
+#endif
+                if (is_unsigned && unlikely(is_negative)) {
+                    goto raise_neg_overflow;
+                } else if (is_negative) {
+                    stepval = PyNumber_Invert(v);
+                    if (unlikely(!stepval))
+                        return (int) -1;
+                } else {
+                    stepval = __Pyx_NewRef(v);
+                }
+                val = (int) 0;
+                mask = PyLong_FromLong((1L << chunk_size) - 1); if (unlikely(!mask)) goto done;
+                shift = PyLong_FromLong(chunk_size); if (unlikely(!shift)) goto done;
+                for (bits = 0; bits < (int) sizeof(int) * 8 - chunk_size; bits += chunk_size) {
+                    PyObject *tmp, *digit;
+                    digit = PyNumber_And(stepval, mask);
+                    if (unlikely(!digit)) goto done;
+                    idigit = PyLong_AsLong(digit);
+                    Py_DECREF(digit);
+                    if (unlikely(idigit < 0)) goto done;
+                    tmp = PyNumber_Rshift(stepval, shift);
+                    if (unlikely(!tmp)) goto done;
+                    Py_DECREF(stepval); stepval = tmp;
+                    val |= ((int) idigit) << bits;
+                    #if CYTHON_COMPILING_IN_LIMITED_API && PY_VERSION_HEX < 0x030B0000
+                    if (Py_SIZE(stepval) == 0)
+                        goto unpacking_done;
+                    #endif
+                }
+                idigit = PyLong_AsLong(stepval);
+                if (unlikely(idigit < 0)) goto done;
+                remaining_bits = ((int) sizeof(int) * 8) - bits - (is_unsigned ? 0 : 1);
+                if (unlikely(idigit >= (1L << remaining_bits)))
+                    goto raise_overflow;
+                val |= ((int) idigit) << bits;
+            #if CYTHON_COMPILING_IN_LIMITED_API && PY_VERSION_HEX < 0x030B0000
+            unpacking_done:
+            #endif
+                if (!is_unsigned) {
+                    if (unlikely(val & (((int) 1) << (sizeof(int) * 8 - 1))))
+                        goto raise_overflow;
+                    if (is_negative)
+                        val = ~val;
+                }
+                ret = 0;
+            done:
+                Py_XDECREF(shift);
+                Py_XDECREF(mask);
+                Py_XDECREF(stepval);
+#endif
                 Py_DECREF(v);
                 if (likely(!ret))
                     return val;
             }
-#endif
-            return (size_t) -1;
+            return (int) -1;
         }
     } else {
-        size_t val;
+        int val;
         PyObject *tmp = __Pyx_PyNumber_IntOrLong(x);
-        if (!tmp) return (size_t) -1;
-        val = __Pyx_PyInt_As_size_t(tmp);
+        if (!tmp) return (int) -1;
+        val = __Pyx_PyInt_As_int(tmp);
         Py_DECREF(tmp);
         return val;
     }
 raise_overflow:
     PyErr_SetString(PyExc_OverflowError,
-        "value too large to convert to size_t");
-    return (size_t) -1;
+        "value too large to convert to int");
+    return (int) -1;
 raise_neg_overflow:
     PyErr_SetString(PyExc_OverflowError,
-        "can't convert negative value to size_t");
-    return (size_t) -1;
+        "can't convert negative value to int");
+    return (int) -1;
 }
 
 /* CIntFromPy */
-static CYTHON_INLINE lua_Integer __Pyx_PyInt_As_lua_Integer(PyObject *x) {
-    const lua_Integer neg_one = (lua_Integer) ((lua_Integer) 0 - (lua_Integer) 1), const_zero = (lua_Integer) 0;
+static CYTHON_INLINE size_t __Pyx_PyInt_As_size_t(PyObject *x) {
+#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
+#pragma GCC diagnostic push
+#pragma GCC diagnostic ignored "-Wconversion"
+#endif
+    const size_t neg_one = (size_t) -1, const_zero = (size_t) 0;
+#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
+#pragma GCC diagnostic pop
+#endif
     const int is_unsigned = neg_one > const_zero;
 #if PY_MAJOR_VERSION < 3
     if (likely(PyInt_Check(x))) {
-        if (sizeof(lua_Integer) < sizeof(long)) {
-            __PYX_VERIFY_RETURN_INT(lua_Integer, long, PyInt_AS_LONG(x))
+        if ((sizeof(size_t) < sizeof(long))) {
+            __PYX_VERIFY_RETURN_INT(size_t, long, PyInt_AS_LONG(x))
         } else {
             long val = PyInt_AS_LONG(x);
             if (is_unsigned && unlikely(val < 0)) {
                 goto raise_neg_overflow;
             }
-            return (lua_Integer) val;
+            return (size_t) val;
         }
     } else
 #endif
     if (likely(PyLong_Check(x))) {
         if (is_unsigned) {
 #if CYTHON_USE_PYLONG_INTERNALS
-            const digit* digits = ((PyLongObject*)x)->ob_digit;
-            switch (Py_SIZE(x)) {
-                case  0: return (lua_Integer) 0;
-                case  1: __PYX_VERIFY_RETURN_INT(lua_Integer, digit, digits[0])
-                case 2:
-                    if (8 * sizeof(lua_Integer) > 1 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 2 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(lua_Integer, unsigned long, (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(lua_Integer) >= 2 * PyLong_SHIFT) {
-                            return (lua_Integer) (((((lua_Integer)digits[1]) << PyLong_SHIFT) | (lua_Integer)digits[0]));
+            if (unlikely(__Pyx_PyLong_IsNeg(x))) {
+                goto raise_neg_overflow;
+            } else if (__Pyx_PyLong_IsCompact(x)) {
+                __PYX_VERIFY_RETURN_INT(size_t, __Pyx_compact_upylong, __Pyx_PyLong_CompactValueUnsigned(x))
+            } else {
+                const digit* digits = __Pyx_PyLong_Digits(x);
+                assert(__Pyx_PyLong_DigitCount(x) > 1);
+                switch (__Pyx_PyLong_DigitCount(x)) {
+                    case 2:
+                        if ((8 * sizeof(size_t) > 1 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 2 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(size_t, unsigned long, (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(size_t) >= 2 * PyLong_SHIFT)) {
+                                return (size_t) (((((size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0]));
+                            }
                         }
-                    }
-                    break;
-                case 3:
-                    if (8 * sizeof(lua_Integer) > 2 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 3 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(lua_Integer, unsigned long, (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(lua_Integer) >= 3 * PyLong_SHIFT) {
-                            return (lua_Integer) (((((((lua_Integer)digits[2]) << PyLong_SHIFT) | (lua_Integer)digits[1]) << PyLong_SHIFT) | (lua_Integer)digits[0]));
+                        break;
+                    case 3:
+                        if ((8 * sizeof(size_t) > 2 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 3 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(size_t, unsigned long, (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(size_t) >= 3 * PyLong_SHIFT)) {
+                                return (size_t) (((((((size_t)digits[2]) << PyLong_SHIFT) | (size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0]));
+                            }
                         }
-                    }
-                    break;
-                case 4:
-                    if (8 * sizeof(lua_Integer) > 3 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 4 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(lua_Integer, unsigned long, (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(lua_Integer) >= 4 * PyLong_SHIFT) {
-                            return (lua_Integer) (((((((((lua_Integer)digits[3]) << PyLong_SHIFT) | (lua_Integer)digits[2]) << PyLong_SHIFT) | (lua_Integer)digits[1]) << PyLong_SHIFT) | (lua_Integer)digits[0]));
+                        break;
+                    case 4:
+                        if ((8 * sizeof(size_t) > 3 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 4 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(size_t, unsigned long, (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(size_t) >= 4 * PyLong_SHIFT)) {
+                                return (size_t) (((((((((size_t)digits[3]) << PyLong_SHIFT) | (size_t)digits[2]) << PyLong_SHIFT) | (size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0]));
+                            }
                         }
-                    }
-                    break;
+                        break;
+                }
             }
 #endif
-#if CYTHON_COMPILING_IN_CPYTHON
+#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX < 0x030C00A7
             if (unlikely(Py_SIZE(x) < 0)) {
                 goto raise_neg_overflow;
             }
 #else
             {
                 int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
                 if (unlikely(result < 0))
-                    return (lua_Integer) -1;
+                    return (size_t) -1;
                 if (unlikely(result == 1))
                     goto raise_neg_overflow;
             }
 #endif
-            if (sizeof(lua_Integer) <= sizeof(unsigned long)) {
-                __PYX_VERIFY_RETURN_INT_EXC(lua_Integer, unsigned long, PyLong_AsUnsignedLong(x))
+            if ((sizeof(size_t) <= sizeof(unsigned long))) {
+                __PYX_VERIFY_RETURN_INT_EXC(size_t, unsigned long, PyLong_AsUnsignedLong(x))
 #ifdef HAVE_LONG_LONG
-            } else if (sizeof(lua_Integer) <= sizeof(unsigned PY_LONG_LONG)) {
-                __PYX_VERIFY_RETURN_INT_EXC(lua_Integer, unsigned PY_LONG_LONG, PyLong_AsUnsignedLongLong(x))
+            } else if ((sizeof(size_t) <= sizeof(unsigned PY_LONG_LONG))) {
+                __PYX_VERIFY_RETURN_INT_EXC(size_t, unsigned PY_LONG_LONG, PyLong_AsUnsignedLongLong(x))
 #endif
             }
         } else {
 #if CYTHON_USE_PYLONG_INTERNALS
-            const digit* digits = ((PyLongObject*)x)->ob_digit;
-            switch (Py_SIZE(x)) {
-                case  0: return (lua_Integer) 0;
-                case -1: __PYX_VERIFY_RETURN_INT(lua_Integer, sdigit, (sdigit) (-(sdigit)digits[0]))
-                case  1: __PYX_VERIFY_RETURN_INT(lua_Integer,  digit, +digits[0])
-                case -2:
-                    if (8 * sizeof(lua_Integer) - 1 > 1 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 2 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(lua_Integer, long, -(long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(lua_Integer) - 1 > 2 * PyLong_SHIFT) {
-                            return (lua_Integer) (((lua_Integer)-1)*(((((lua_Integer)digits[1]) << PyLong_SHIFT) | (lua_Integer)digits[0])));
+            if (__Pyx_PyLong_IsCompact(x)) {
+                __PYX_VERIFY_RETURN_INT(size_t, __Pyx_compact_pylong, __Pyx_PyLong_CompactValue(x))
+            } else {
+                const digit* digits = __Pyx_PyLong_Digits(x);
+                assert(__Pyx_PyLong_DigitCount(x) > 1);
+                switch (__Pyx_PyLong_SignedDigitCount(x)) {
+                    case -2:
+                        if ((8 * sizeof(size_t) - 1 > 1 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 2 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(size_t, long, -(long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(size_t) - 1 > 2 * PyLong_SHIFT)) {
+                                return (size_t) (((size_t)-1)*(((((size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0])));
+                            }
                         }
-                    }
-                    break;
-                case 2:
-                    if (8 * sizeof(lua_Integer) > 1 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 2 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(lua_Integer, unsigned long, (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(lua_Integer) - 1 > 2 * PyLong_SHIFT) {
-                            return (lua_Integer) ((((((lua_Integer)digits[1]) << PyLong_SHIFT) | (lua_Integer)digits[0])));
+                        break;
+                    case 2:
+                        if ((8 * sizeof(size_t) > 1 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 2 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(size_t, unsigned long, (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(size_t) - 1 > 2 * PyLong_SHIFT)) {
+                                return (size_t) ((((((size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0])));
+                            }
                         }
-                    }
-                    break;
-                case -3:
-                    if (8 * sizeof(lua_Integer) - 1 > 2 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 3 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(lua_Integer, long, -(long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(lua_Integer) - 1 > 3 * PyLong_SHIFT) {
-                            return (lua_Integer) (((lua_Integer)-1)*(((((((lua_Integer)digits[2]) << PyLong_SHIFT) | (lua_Integer)digits[1]) << PyLong_SHIFT) | (lua_Integer)digits[0])));
+                        break;
+                    case -3:
+                        if ((8 * sizeof(size_t) - 1 > 2 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 3 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(size_t, long, -(long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(size_t) - 1 > 3 * PyLong_SHIFT)) {
+                                return (size_t) (((size_t)-1)*(((((((size_t)digits[2]) << PyLong_SHIFT) | (size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0])));
+                            }
                         }
-                    }
-                    break;
-                case 3:
-                    if (8 * sizeof(lua_Integer) > 2 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 3 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(lua_Integer, unsigned long, (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(lua_Integer) - 1 > 3 * PyLong_SHIFT) {
-                            return (lua_Integer) ((((((((lua_Integer)digits[2]) << PyLong_SHIFT) | (lua_Integer)digits[1]) << PyLong_SHIFT) | (lua_Integer)digits[0])));
+                        break;
+                    case 3:
+                        if ((8 * sizeof(size_t) > 2 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 3 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(size_t, unsigned long, (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(size_t) - 1 > 3 * PyLong_SHIFT)) {
+                                return (size_t) ((((((((size_t)digits[2]) << PyLong_SHIFT) | (size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0])));
+                            }
                         }
-                    }
-                    break;
-                case -4:
-                    if (8 * sizeof(lua_Integer) - 1 > 3 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 4 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(lua_Integer, long, -(long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(lua_Integer) - 1 > 4 * PyLong_SHIFT) {
-                            return (lua_Integer) (((lua_Integer)-1)*(((((((((lua_Integer)digits[3]) << PyLong_SHIFT) | (lua_Integer)digits[2]) << PyLong_SHIFT) | (lua_Integer)digits[1]) << PyLong_SHIFT) | (lua_Integer)digits[0])));
+                        break;
+                    case -4:
+                        if ((8 * sizeof(size_t) - 1 > 3 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 4 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(size_t, long, -(long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(size_t) - 1 > 4 * PyLong_SHIFT)) {
+                                return (size_t) (((size_t)-1)*(((((((((size_t)digits[3]) << PyLong_SHIFT) | (size_t)digits[2]) << PyLong_SHIFT) | (size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0])));
+                            }
                         }
-                    }
-                    break;
-                case 4:
-                    if (8 * sizeof(lua_Integer) > 3 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 4 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(lua_Integer, unsigned long, (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(lua_Integer) - 1 > 4 * PyLong_SHIFT) {
-                            return (lua_Integer) ((((((((((lua_Integer)digits[3]) << PyLong_SHIFT) | (lua_Integer)digits[2]) << PyLong_SHIFT) | (lua_Integer)digits[1]) << PyLong_SHIFT) | (lua_Integer)digits[0])));
+                        break;
+                    case 4:
+                        if ((8 * sizeof(size_t) > 3 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 4 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(size_t, unsigned long, (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(size_t) - 1 > 4 * PyLong_SHIFT)) {
+                                return (size_t) ((((((((((size_t)digits[3]) << PyLong_SHIFT) | (size_t)digits[2]) << PyLong_SHIFT) | (size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0])));
+                            }
                         }
-                    }
-                    break;
+                        break;
+                }
             }
 #endif
-            if (sizeof(lua_Integer) <= sizeof(long)) {
-                __PYX_VERIFY_RETURN_INT_EXC(lua_Integer, long, PyLong_AsLong(x))
+            if ((sizeof(size_t) <= sizeof(long))) {
+                __PYX_VERIFY_RETURN_INT_EXC(size_t, long, PyLong_AsLong(x))
 #ifdef HAVE_LONG_LONG
-            } else if (sizeof(lua_Integer) <= sizeof(PY_LONG_LONG)) {
-                __PYX_VERIFY_RETURN_INT_EXC(lua_Integer, PY_LONG_LONG, PyLong_AsLongLong(x))
+            } else if ((sizeof(size_t) <= sizeof(PY_LONG_LONG))) {
+                __PYX_VERIFY_RETURN_INT_EXC(size_t, PY_LONG_LONG, PyLong_AsLongLong(x))
 #endif
             }
         }
         {
-#if CYTHON_COMPILING_IN_PYPY && !defined(_PyLong_AsByteArray)
-            PyErr_SetString(PyExc_RuntimeError,
-                            "_PyLong_AsByteArray() not available in PyPy, cannot convert large numbers");
-#else
-            lua_Integer val;
+            size_t val;
             PyObject *v = __Pyx_PyNumber_IntOrLong(x);
- #if PY_MAJOR_VERSION < 3
+#if PY_MAJOR_VERSION < 3
             if (likely(v) && !PyLong_Check(v)) {
                 PyObject *tmp = v;
                 v = PyNumber_Long(tmp);
                 Py_DECREF(tmp);
             }
- #endif
+#endif
             if (likely(v)) {
+                int ret = -1;
+#if !(CYTHON_COMPILING_IN_PYPY || CYTHON_COMPILING_IN_LIMITED_API) || defined(_PyLong_AsByteArray)
                 int one = 1; int is_little = (int)*(unsigned char *)&one;
                 unsigned char *bytes = (unsigned char *)&val;
-                int ret = _PyLong_AsByteArray((PyLongObject *)v,
-                                              bytes, sizeof(val),
-                                              is_little, !is_unsigned);
+                ret = _PyLong_AsByteArray((PyLongObject *)v,
+                                           bytes, sizeof(val),
+                                           is_little, !is_unsigned);
+#else
+                PyObject *stepval = NULL, *mask = NULL, *shift = NULL;
+                int bits, remaining_bits, is_negative = 0;
+                long idigit;
+                int chunk_size = (sizeof(long) < 8) ? 30 : 62;
+                if (unlikely(!PyLong_CheckExact(v))) {
+                    PyObject *tmp = v;
+                    v = PyNumber_Long(v);
+                    assert(PyLong_CheckExact(v));
+                    Py_DECREF(tmp);
+                    if (unlikely(!v)) return (size_t) -1;
+                }
+#if CYTHON_COMPILING_IN_LIMITED_API && PY_VERSION_HEX < 0x030B0000
+                if (Py_SIZE(x) == 0)
+                    return (size_t) 0;
+                is_negative = Py_SIZE(x) < 0;
+#else
+                {
+                    int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
+                    if (unlikely(result < 0))
+                        return (size_t) -1;
+                    is_negative = result == 1;
+                }
+#endif
+                if (is_unsigned && unlikely(is_negative)) {
+                    goto raise_neg_overflow;
+                } else if (is_negative) {
+                    stepval = PyNumber_Invert(v);
+                    if (unlikely(!stepval))
+                        return (size_t) -1;
+                } else {
+                    stepval = __Pyx_NewRef(v);
+                }
+                val = (size_t) 0;
+                mask = PyLong_FromLong((1L << chunk_size) - 1); if (unlikely(!mask)) goto done;
+                shift = PyLong_FromLong(chunk_size); if (unlikely(!shift)) goto done;
+                for (bits = 0; bits < (int) sizeof(size_t) * 8 - chunk_size; bits += chunk_size) {
+                    PyObject *tmp, *digit;
+                    digit = PyNumber_And(stepval, mask);
+                    if (unlikely(!digit)) goto done;
+                    idigit = PyLong_AsLong(digit);
+                    Py_DECREF(digit);
+                    if (unlikely(idigit < 0)) goto done;
+                    tmp = PyNumber_Rshift(stepval, shift);
+                    if (unlikely(!tmp)) goto done;
+                    Py_DECREF(stepval); stepval = tmp;
+                    val |= ((size_t) idigit) << bits;
+                    #if CYTHON_COMPILING_IN_LIMITED_API && PY_VERSION_HEX < 0x030B0000
+                    if (Py_SIZE(stepval) == 0)
+                        goto unpacking_done;
+                    #endif
+                }
+                idigit = PyLong_AsLong(stepval);
+                if (unlikely(idigit < 0)) goto done;
+                remaining_bits = ((int) sizeof(size_t) * 8) - bits - (is_unsigned ? 0 : 1);
+                if (unlikely(idigit >= (1L << remaining_bits)))
+                    goto raise_overflow;
+                val |= ((size_t) idigit) << bits;
+            #if CYTHON_COMPILING_IN_LIMITED_API && PY_VERSION_HEX < 0x030B0000
+            unpacking_done:
+            #endif
+                if (!is_unsigned) {
+                    if (unlikely(val & (((size_t) 1) << (sizeof(size_t) * 8 - 1))))
+                        goto raise_overflow;
+                    if (is_negative)
+                        val = ~val;
+                }
+                ret = 0;
+            done:
+                Py_XDECREF(shift);
+                Py_XDECREF(mask);
+                Py_XDECREF(stepval);
+#endif
                 Py_DECREF(v);
                 if (likely(!ret))
                     return val;
             }
-#endif
-            return (lua_Integer) -1;
+            return (size_t) -1;
         }
     } else {
-        lua_Integer val;
+        size_t val;
         PyObject *tmp = __Pyx_PyNumber_IntOrLong(x);
-        if (!tmp) return (lua_Integer) -1;
-        val = __Pyx_PyInt_As_lua_Integer(tmp);
+        if (!tmp) return (size_t) -1;
+        val = __Pyx_PyInt_As_size_t(tmp);
         Py_DECREF(tmp);
         return val;
     }
 raise_overflow:
     PyErr_SetString(PyExc_OverflowError,
-        "value too large to convert to lua_Integer");
-    return (lua_Integer) -1;
+        "value too large to convert to size_t");
+    return (size_t) -1;
 raise_neg_overflow:
     PyErr_SetString(PyExc_OverflowError,
-        "can't convert negative value to lua_Integer");
-    return (lua_Integer) -1;
+        "can't convert negative value to size_t");
+    return (size_t) -1;
 }
 
-/* CIntFromPy */
-static CYTHON_INLINE int __Pyx_PyInt_As_int(PyObject *x) {
-    const int neg_one = (int) ((int) 0 - (int) 1), const_zero = (int) 0;
+/* CIntToPy */
+static CYTHON_INLINE PyObject* __Pyx_PyInt_From_uint32_t(uint32_t value) {
+#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
+#pragma GCC diagnostic push
+#pragma GCC diagnostic ignored "-Wconversion"
+#endif
+    const uint32_t neg_one = (uint32_t) -1, const_zero = (uint32_t) 0;
+#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
+#pragma GCC diagnostic pop
+#endif
     const int is_unsigned = neg_one > const_zero;
-#if PY_MAJOR_VERSION < 3
-    if (likely(PyInt_Check(x))) {
-        if (sizeof(int) < sizeof(long)) {
-            __PYX_VERIFY_RETURN_INT(int, long, PyInt_AS_LONG(x))
-        } else {
-            long val = PyInt_AS_LONG(x);
-            if (is_unsigned && unlikely(val < 0)) {
-                goto raise_neg_overflow;
-            }
-            return (int) val;
-        }
-    } else
+    if (is_unsigned) {
+        if (sizeof(uint32_t) < sizeof(long)) {
+            return PyInt_FromLong((long) value);
+        } else if (sizeof(uint32_t) <= sizeof(unsigned long)) {
+            return PyLong_FromUnsignedLong((unsigned long) value);
+#ifdef HAVE_LONG_LONG
+        } else if (sizeof(uint32_t) <= sizeof(unsigned PY_LONG_LONG)) {
+            return PyLong_FromUnsignedLongLong((unsigned PY_LONG_LONG) value);
 #endif
-    if (likely(PyLong_Check(x))) {
-        if (is_unsigned) {
-#if CYTHON_USE_PYLONG_INTERNALS
-            const digit* digits = ((PyLongObject*)x)->ob_digit;
-            switch (Py_SIZE(x)) {
-                case  0: return (int) 0;
-                case  1: __PYX_VERIFY_RETURN_INT(int, digit, digits[0])
-                case 2:
-                    if (8 * sizeof(int) > 1 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 2 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(int, unsigned long, (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(int) >= 2 * PyLong_SHIFT) {
-                            return (int) (((((int)digits[1]) << PyLong_SHIFT) | (int)digits[0]));
-                        }
-                    }
-                    break;
-                case 3:
-                    if (8 * sizeof(int) > 2 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 3 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(int, unsigned long, (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(int) >= 3 * PyLong_SHIFT) {
-                            return (int) (((((((int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0]));
-                        }
-                    }
-                    break;
-                case 4:
-                    if (8 * sizeof(int) > 3 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 4 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(int, unsigned long, (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(int) >= 4 * PyLong_SHIFT) {
-                            return (int) (((((((((int)digits[3]) << PyLong_SHIFT) | (int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0]));
-                        }
-                    }
-                    break;
-            }
+        }
+    } else {
+        if (sizeof(uint32_t) <= sizeof(long)) {
+            return PyInt_FromLong((long) value);
+#ifdef HAVE_LONG_LONG
+        } else if (sizeof(uint32_t) <= sizeof(PY_LONG_LONG)) {
+            return PyLong_FromLongLong((PY_LONG_LONG) value);
 #endif
-#if CYTHON_COMPILING_IN_CPYTHON
-            if (unlikely(Py_SIZE(x) < 0)) {
-                goto raise_neg_overflow;
-            }
-#else
-            {
-                int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
-                if (unlikely(result < 0))
-                    return (int) -1;
-                if (unlikely(result == 1))
-                    goto raise_neg_overflow;
-            }
+        }
+    }
+    {
+        int one = 1; int little = (int)*(unsigned char *)&one;
+        unsigned char *bytes = (unsigned char *)&value;
+        return _PyLong_FromByteArray(bytes, sizeof(uint32_t),
+                                     little, !is_unsigned);
+    }
+}
+
+/* CIntToPy */
+static CYTHON_INLINE PyObject* __Pyx_PyInt_From_int(int value) {
+#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
+#pragma GCC diagnostic push
+#pragma GCC diagnostic ignored "-Wconversion"
+#endif
+    const int neg_one = (int) -1, const_zero = (int) 0;
+#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
+#pragma GCC diagnostic pop
 #endif
-            if (sizeof(int) <= sizeof(unsigned long)) {
-                __PYX_VERIFY_RETURN_INT_EXC(int, unsigned long, PyLong_AsUnsignedLong(x))
+    const int is_unsigned = neg_one > const_zero;
+    if (is_unsigned) {
+        if (sizeof(int) < sizeof(long)) {
+            return PyInt_FromLong((long) value);
+        } else if (sizeof(int) <= sizeof(unsigned long)) {
+            return PyLong_FromUnsignedLong((unsigned long) value);
 #ifdef HAVE_LONG_LONG
-            } else if (sizeof(int) <= sizeof(unsigned PY_LONG_LONG)) {
-                __PYX_VERIFY_RETURN_INT_EXC(int, unsigned PY_LONG_LONG, PyLong_AsUnsignedLongLong(x))
-#endif
-            }
-        } else {
-#if CYTHON_USE_PYLONG_INTERNALS
-            const digit* digits = ((PyLongObject*)x)->ob_digit;
-            switch (Py_SIZE(x)) {
-                case  0: return (int) 0;
-                case -1: __PYX_VERIFY_RETURN_INT(int, sdigit, (sdigit) (-(sdigit)digits[0]))
-                case  1: __PYX_VERIFY_RETURN_INT(int,  digit, +digits[0])
-                case -2:
-                    if (8 * sizeof(int) - 1 > 1 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 2 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(int, long, -(long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(int) - 1 > 2 * PyLong_SHIFT) {
-                            return (int) (((int)-1)*(((((int)digits[1]) << PyLong_SHIFT) | (int)digits[0])));
-                        }
-                    }
-                    break;
-                case 2:
-                    if (8 * sizeof(int) > 1 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 2 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(int, unsigned long, (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(int) - 1 > 2 * PyLong_SHIFT) {
-                            return (int) ((((((int)digits[1]) << PyLong_SHIFT) | (int)digits[0])));
-                        }
-                    }
-                    break;
-                case -3:
-                    if (8 * sizeof(int) - 1 > 2 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 3 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(int, long, -(long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(int) - 1 > 3 * PyLong_SHIFT) {
-                            return (int) (((int)-1)*(((((((int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0])));
-                        }
-                    }
-                    break;
-                case 3:
-                    if (8 * sizeof(int) > 2 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 3 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(int, unsigned long, (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(int) - 1 > 3 * PyLong_SHIFT) {
-                            return (int) ((((((((int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0])));
-                        }
-                    }
-                    break;
-                case -4:
-                    if (8 * sizeof(int) - 1 > 3 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 4 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(int, long, -(long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(int) - 1 > 4 * PyLong_SHIFT) {
-                            return (int) (((int)-1)*(((((((((int)digits[3]) << PyLong_SHIFT) | (int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0])));
-                        }
-                    }
-                    break;
-                case 4:
-                    if (8 * sizeof(int) > 3 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 4 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(int, unsigned long, (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(int) - 1 > 4 * PyLong_SHIFT) {
-                            return (int) ((((((((((int)digits[3]) << PyLong_SHIFT) | (int)digits[2]) << PyLong_SHIFT) | (int)digits[1]) << PyLong_SHIFT) | (int)digits[0])));
-                        }
-                    }
-                    break;
-            }
+        } else if (sizeof(int) <= sizeof(unsigned PY_LONG_LONG)) {
+            return PyLong_FromUnsignedLongLong((unsigned PY_LONG_LONG) value);
 #endif
-            if (sizeof(int) <= sizeof(long)) {
-                __PYX_VERIFY_RETURN_INT_EXC(int, long, PyLong_AsLong(x))
+        }
+    } else {
+        if (sizeof(int) <= sizeof(long)) {
+            return PyInt_FromLong((long) value);
 #ifdef HAVE_LONG_LONG
-            } else if (sizeof(int) <= sizeof(PY_LONG_LONG)) {
-                __PYX_VERIFY_RETURN_INT_EXC(int, PY_LONG_LONG, PyLong_AsLongLong(x))
+        } else if (sizeof(int) <= sizeof(PY_LONG_LONG)) {
+            return PyLong_FromLongLong((PY_LONG_LONG) value);
 #endif
-            }
         }
-        {
-#if CYTHON_COMPILING_IN_PYPY && !defined(_PyLong_AsByteArray)
-            PyErr_SetString(PyExc_RuntimeError,
-                            "_PyLong_AsByteArray() not available in PyPy, cannot convert large numbers");
+    }
+    {
+        int one = 1; int little = (int)*(unsigned char *)&one;
+        unsigned char *bytes = (unsigned char *)&value;
+        return _PyLong_FromByteArray(bytes, sizeof(int),
+                                     little, !is_unsigned);
+    }
+}
+
+/* GetAttr */
+static CYTHON_INLINE PyObject *__Pyx_GetAttr(PyObject *o, PyObject *n) {
+#if CYTHON_USE_TYPE_SLOTS
+#if PY_MAJOR_VERSION >= 3
+    if (likely(PyUnicode_Check(n)))
 #else
-            int val;
-            PyObject *v = __Pyx_PyNumber_IntOrLong(x);
- #if PY_MAJOR_VERSION < 3
-            if (likely(v) && !PyLong_Check(v)) {
-                PyObject *tmp = v;
-                v = PyNumber_Long(tmp);
-                Py_DECREF(tmp);
-            }
- #endif
-            if (likely(v)) {
-                int one = 1; int is_little = (int)*(unsigned char *)&one;
-                unsigned char *bytes = (unsigned char *)&val;
-                int ret = _PyLong_AsByteArray((PyLongObject *)v,
-                                              bytes, sizeof(val),
-                                              is_little, !is_unsigned);
-                Py_DECREF(v);
-                if (likely(!ret))
-                    return val;
-            }
+    if (likely(PyString_Check(n)))
+#endif
+        return __Pyx_PyObject_GetAttrStr(o, n);
+#endif
+    return PyObject_GetAttr(o, n);
+}
+
+/* Globals */
+static PyObject* __Pyx_Globals(void) {
+    return __Pyx_NewRef(__pyx_d);
+}
+
+/* FormatTypeName */
+#if CYTHON_COMPILING_IN_LIMITED_API
+static __Pyx_TypeName
+__Pyx_PyType_GetName(PyTypeObject* tp)
+{
+    PyObject *name = __Pyx_PyObject_GetAttrStr((PyObject *)tp,
+                                               __pyx_n_s_name_2);
+    if (unlikely(name == NULL) || unlikely(!PyUnicode_Check(name))) {
+        PyErr_Clear();
+        Py_XSETREF(name, __Pyx_NewRef(__pyx_n_s__20));
+    }
+    return name;
+}
+#endif
+
+/* CIntToPy */
+static CYTHON_INLINE PyObject* __Pyx_PyInt_From_long(long value) {
+#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
+#pragma GCC diagnostic push
+#pragma GCC diagnostic ignored "-Wconversion"
+#endif
+    const long neg_one = (long) -1, const_zero = (long) 0;
+#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
+#pragma GCC diagnostic pop
+#endif
+    const int is_unsigned = neg_one > const_zero;
+    if (is_unsigned) {
+        if (sizeof(long) < sizeof(long)) {
+            return PyInt_FromLong((long) value);
+        } else if (sizeof(long) <= sizeof(unsigned long)) {
+            return PyLong_FromUnsignedLong((unsigned long) value);
+#ifdef HAVE_LONG_LONG
+        } else if (sizeof(long) <= sizeof(unsigned PY_LONG_LONG)) {
+            return PyLong_FromUnsignedLongLong((unsigned PY_LONG_LONG) value);
 #endif
-            return (int) -1;
         }
     } else {
-        int val;
-        PyObject *tmp = __Pyx_PyNumber_IntOrLong(x);
-        if (!tmp) return (int) -1;
-        val = __Pyx_PyInt_As_int(tmp);
-        Py_DECREF(tmp);
-        return val;
+        if (sizeof(long) <= sizeof(long)) {
+            return PyInt_FromLong((long) value);
+#ifdef HAVE_LONG_LONG
+        } else if (sizeof(long) <= sizeof(PY_LONG_LONG)) {
+            return PyLong_FromLongLong((PY_LONG_LONG) value);
+#endif
+        }
+    }
+    {
+        int one = 1; int little = (int)*(unsigned char *)&one;
+        unsigned char *bytes = (unsigned char *)&value;
+        return _PyLong_FromByteArray(bytes, sizeof(long),
+                                     little, !is_unsigned);
     }
-raise_overflow:
-    PyErr_SetString(PyExc_OverflowError,
-        "value too large to convert to int");
-    return (int) -1;
-raise_neg_overflow:
-    PyErr_SetString(PyExc_OverflowError,
-        "can't convert negative value to int");
-    return (int) -1;
 }
 
 /* CIntFromPy */
 static CYTHON_INLINE long __Pyx_PyInt_As_long(PyObject *x) {
-    const long neg_one = (long) ((long) 0 - (long) 1), const_zero = (long) 0;
+#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
+#pragma GCC diagnostic push
+#pragma GCC diagnostic ignored "-Wconversion"
+#endif
+    const long neg_one = (long) -1, const_zero = (long) 0;
+#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
+#pragma GCC diagnostic pop
+#endif
     const int is_unsigned = neg_one > const_zero;
 #if PY_MAJOR_VERSION < 3
     if (likely(PyInt_Check(x))) {
-        if (sizeof(long) < sizeof(long)) {
+        if ((sizeof(long) < sizeof(long))) {
             __PYX_VERIFY_RETURN_INT(long, long, PyInt_AS_LONG(x))
         } else {
             long val = PyInt_AS_LONG(x);
             if (is_unsigned && unlikely(val < 0)) {
                 goto raise_neg_overflow;
             }
             return (long) val;
         }
     } else
 #endif
     if (likely(PyLong_Check(x))) {
         if (is_unsigned) {
 #if CYTHON_USE_PYLONG_INTERNALS
-            const digit* digits = ((PyLongObject*)x)->ob_digit;
-            switch (Py_SIZE(x)) {
-                case  0: return (long) 0;
-                case  1: __PYX_VERIFY_RETURN_INT(long, digit, digits[0])
-                case 2:
-                    if (8 * sizeof(long) > 1 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 2 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(long, unsigned long, (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(long) >= 2 * PyLong_SHIFT) {
-                            return (long) (((((long)digits[1]) << PyLong_SHIFT) | (long)digits[0]));
+            if (unlikely(__Pyx_PyLong_IsNeg(x))) {
+                goto raise_neg_overflow;
+            } else if (__Pyx_PyLong_IsCompact(x)) {
+                __PYX_VERIFY_RETURN_INT(long, __Pyx_compact_upylong, __Pyx_PyLong_CompactValueUnsigned(x))
+            } else {
+                const digit* digits = __Pyx_PyLong_Digits(x);
+                assert(__Pyx_PyLong_DigitCount(x) > 1);
+                switch (__Pyx_PyLong_DigitCount(x)) {
+                    case 2:
+                        if ((8 * sizeof(long) > 1 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 2 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(long, unsigned long, (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(long) >= 2 * PyLong_SHIFT)) {
+                                return (long) (((((long)digits[1]) << PyLong_SHIFT) | (long)digits[0]));
+                            }
                         }
-                    }
-                    break;
-                case 3:
-                    if (8 * sizeof(long) > 2 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 3 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(long, unsigned long, (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(long) >= 3 * PyLong_SHIFT) {
-                            return (long) (((((((long)digits[2]) << PyLong_SHIFT) | (long)digits[1]) << PyLong_SHIFT) | (long)digits[0]));
+                        break;
+                    case 3:
+                        if ((8 * sizeof(long) > 2 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 3 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(long, unsigned long, (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(long) >= 3 * PyLong_SHIFT)) {
+                                return (long) (((((((long)digits[2]) << PyLong_SHIFT) | (long)digits[1]) << PyLong_SHIFT) | (long)digits[0]));
+                            }
                         }
-                    }
-                    break;
-                case 4:
-                    if (8 * sizeof(long) > 3 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 4 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(long, unsigned long, (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(long) >= 4 * PyLong_SHIFT) {
-                            return (long) (((((((((long)digits[3]) << PyLong_SHIFT) | (long)digits[2]) << PyLong_SHIFT) | (long)digits[1]) << PyLong_SHIFT) | (long)digits[0]));
+                        break;
+                    case 4:
+                        if ((8 * sizeof(long) > 3 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 4 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(long, unsigned long, (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(long) >= 4 * PyLong_SHIFT)) {
+                                return (long) (((((((((long)digits[3]) << PyLong_SHIFT) | (long)digits[2]) << PyLong_SHIFT) | (long)digits[1]) << PyLong_SHIFT) | (long)digits[0]));
+                            }
                         }
-                    }
-                    break;
+                        break;
+                }
             }
 #endif
-#if CYTHON_COMPILING_IN_CPYTHON
+#if CYTHON_COMPILING_IN_CPYTHON && PY_VERSION_HEX < 0x030C00A7
             if (unlikely(Py_SIZE(x) < 0)) {
                 goto raise_neg_overflow;
             }
 #else
             {
                 int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
                 if (unlikely(result < 0))
                     return (long) -1;
                 if (unlikely(result == 1))
                     goto raise_neg_overflow;
             }
 #endif
-            if (sizeof(long) <= sizeof(unsigned long)) {
+            if ((sizeof(long) <= sizeof(unsigned long))) {
                 __PYX_VERIFY_RETURN_INT_EXC(long, unsigned long, PyLong_AsUnsignedLong(x))
 #ifdef HAVE_LONG_LONG
-            } else if (sizeof(long) <= sizeof(unsigned PY_LONG_LONG)) {
+            } else if ((sizeof(long) <= sizeof(unsigned PY_LONG_LONG))) {
                 __PYX_VERIFY_RETURN_INT_EXC(long, unsigned PY_LONG_LONG, PyLong_AsUnsignedLongLong(x))
 #endif
             }
         } else {
 #if CYTHON_USE_PYLONG_INTERNALS
-            const digit* digits = ((PyLongObject*)x)->ob_digit;
-            switch (Py_SIZE(x)) {
-                case  0: return (long) 0;
-                case -1: __PYX_VERIFY_RETURN_INT(long, sdigit, (sdigit) (-(sdigit)digits[0]))
-                case  1: __PYX_VERIFY_RETURN_INT(long,  digit, +digits[0])
-                case -2:
-                    if (8 * sizeof(long) - 1 > 1 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 2 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(long, long, -(long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(long) - 1 > 2 * PyLong_SHIFT) {
-                            return (long) (((long)-1)*(((((long)digits[1]) << PyLong_SHIFT) | (long)digits[0])));
+            if (__Pyx_PyLong_IsCompact(x)) {
+                __PYX_VERIFY_RETURN_INT(long, __Pyx_compact_pylong, __Pyx_PyLong_CompactValue(x))
+            } else {
+                const digit* digits = __Pyx_PyLong_Digits(x);
+                assert(__Pyx_PyLong_DigitCount(x) > 1);
+                switch (__Pyx_PyLong_SignedDigitCount(x)) {
+                    case -2:
+                        if ((8 * sizeof(long) - 1 > 1 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 2 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(long, long, -(long) (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(long) - 1 > 2 * PyLong_SHIFT)) {
+                                return (long) (((long)-1)*(((((long)digits[1]) << PyLong_SHIFT) | (long)digits[0])));
+                            }
                         }
-                    }
-                    break;
-                case 2:
-                    if (8 * sizeof(long) > 1 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 2 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(long, unsigned long, (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(long) - 1 > 2 * PyLong_SHIFT) {
-                            return (long) ((((((long)digits[1]) << PyLong_SHIFT) | (long)digits[0])));
+                        break;
+                    case 2:
+                        if ((8 * sizeof(long) > 1 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 2 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(long, unsigned long, (((((unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(long) - 1 > 2 * PyLong_SHIFT)) {
+                                return (long) ((((((long)digits[1]) << PyLong_SHIFT) | (long)digits[0])));
+                            }
                         }
-                    }
-                    break;
-                case -3:
-                    if (8 * sizeof(long) - 1 > 2 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 3 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(long, long, -(long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(long) - 1 > 3 * PyLong_SHIFT) {
-                            return (long) (((long)-1)*(((((((long)digits[2]) << PyLong_SHIFT) | (long)digits[1]) << PyLong_SHIFT) | (long)digits[0])));
+                        break;
+                    case -3:
+                        if ((8 * sizeof(long) - 1 > 2 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 3 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(long, long, -(long) (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(long) - 1 > 3 * PyLong_SHIFT)) {
+                                return (long) (((long)-1)*(((((((long)digits[2]) << PyLong_SHIFT) | (long)digits[1]) << PyLong_SHIFT) | (long)digits[0])));
+                            }
                         }
-                    }
-                    break;
-                case 3:
-                    if (8 * sizeof(long) > 2 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 3 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(long, unsigned long, (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(long) - 1 > 3 * PyLong_SHIFT) {
-                            return (long) ((((((((long)digits[2]) << PyLong_SHIFT) | (long)digits[1]) << PyLong_SHIFT) | (long)digits[0])));
+                        break;
+                    case 3:
+                        if ((8 * sizeof(long) > 2 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 3 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(long, unsigned long, (((((((unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(long) - 1 > 3 * PyLong_SHIFT)) {
+                                return (long) ((((((((long)digits[2]) << PyLong_SHIFT) | (long)digits[1]) << PyLong_SHIFT) | (long)digits[0])));
+                            }
                         }
-                    }
-                    break;
-                case -4:
-                    if (8 * sizeof(long) - 1 > 3 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 4 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(long, long, -(long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(long) - 1 > 4 * PyLong_SHIFT) {
-                            return (long) (((long)-1)*(((((((((long)digits[3]) << PyLong_SHIFT) | (long)digits[2]) << PyLong_SHIFT) | (long)digits[1]) << PyLong_SHIFT) | (long)digits[0])));
+                        break;
+                    case -4:
+                        if ((8 * sizeof(long) - 1 > 3 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 4 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(long, long, -(long) (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(long) - 1 > 4 * PyLong_SHIFT)) {
+                                return (long) (((long)-1)*(((((((((long)digits[3]) << PyLong_SHIFT) | (long)digits[2]) << PyLong_SHIFT) | (long)digits[1]) << PyLong_SHIFT) | (long)digits[0])));
+                            }
                         }
-                    }
-                    break;
-                case 4:
-                    if (8 * sizeof(long) > 3 * PyLong_SHIFT) {
-                        if (8 * sizeof(unsigned long) > 4 * PyLong_SHIFT) {
-                            __PYX_VERIFY_RETURN_INT(long, unsigned long, (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
-                        } else if (8 * sizeof(long) - 1 > 4 * PyLong_SHIFT) {
-                            return (long) ((((((((((long)digits[3]) << PyLong_SHIFT) | (long)digits[2]) << PyLong_SHIFT) | (long)digits[1]) << PyLong_SHIFT) | (long)digits[0])));
+                        break;
+                    case 4:
+                        if ((8 * sizeof(long) > 3 * PyLong_SHIFT)) {
+                            if ((8 * sizeof(unsigned long) > 4 * PyLong_SHIFT)) {
+                                __PYX_VERIFY_RETURN_INT(long, unsigned long, (((((((((unsigned long)digits[3]) << PyLong_SHIFT) | (unsigned long)digits[2]) << PyLong_SHIFT) | (unsigned long)digits[1]) << PyLong_SHIFT) | (unsigned long)digits[0])))
+                            } else if ((8 * sizeof(long) - 1 > 4 * PyLong_SHIFT)) {
+                                return (long) ((((((((((long)digits[3]) << PyLong_SHIFT) | (long)digits[2]) << PyLong_SHIFT) | (long)digits[1]) << PyLong_SHIFT) | (long)digits[0])));
+                            }
                         }
-                    }
-                    break;
+                        break;
+                }
             }
 #endif
-            if (sizeof(long) <= sizeof(long)) {
+            if ((sizeof(long) <= sizeof(long))) {
                 __PYX_VERIFY_RETURN_INT_EXC(long, long, PyLong_AsLong(x))
 #ifdef HAVE_LONG_LONG
-            } else if (sizeof(long) <= sizeof(PY_LONG_LONG)) {
+            } else if ((sizeof(long) <= sizeof(PY_LONG_LONG))) {
                 __PYX_VERIFY_RETURN_INT_EXC(long, PY_LONG_LONG, PyLong_AsLongLong(x))
 #endif
             }
         }
         {
-#if CYTHON_COMPILING_IN_PYPY && !defined(_PyLong_AsByteArray)
-            PyErr_SetString(PyExc_RuntimeError,
-                            "_PyLong_AsByteArray() not available in PyPy, cannot convert large numbers");
-#else
             long val;
             PyObject *v = __Pyx_PyNumber_IntOrLong(x);
- #if PY_MAJOR_VERSION < 3
+#if PY_MAJOR_VERSION < 3
             if (likely(v) && !PyLong_Check(v)) {
                 PyObject *tmp = v;
                 v = PyNumber_Long(tmp);
                 Py_DECREF(tmp);
             }
- #endif
+#endif
             if (likely(v)) {
+                int ret = -1;
+#if !(CYTHON_COMPILING_IN_PYPY || CYTHON_COMPILING_IN_LIMITED_API) || defined(_PyLong_AsByteArray)
                 int one = 1; int is_little = (int)*(unsigned char *)&one;
                 unsigned char *bytes = (unsigned char *)&val;
-                int ret = _PyLong_AsByteArray((PyLongObject *)v,
-                                              bytes, sizeof(val),
-                                              is_little, !is_unsigned);
+                ret = _PyLong_AsByteArray((PyLongObject *)v,
+                                           bytes, sizeof(val),
+                                           is_little, !is_unsigned);
+#else
+                PyObject *stepval = NULL, *mask = NULL, *shift = NULL;
+                int bits, remaining_bits, is_negative = 0;
+                long idigit;
+                int chunk_size = (sizeof(long) < 8) ? 30 : 62;
+                if (unlikely(!PyLong_CheckExact(v))) {
+                    PyObject *tmp = v;
+                    v = PyNumber_Long(v);
+                    assert(PyLong_CheckExact(v));
+                    Py_DECREF(tmp);
+                    if (unlikely(!v)) return (long) -1;
+                }
+#if CYTHON_COMPILING_IN_LIMITED_API && PY_VERSION_HEX < 0x030B0000
+                if (Py_SIZE(x) == 0)
+                    return (long) 0;
+                is_negative = Py_SIZE(x) < 0;
+#else
+                {
+                    int result = PyObject_RichCompareBool(x, Py_False, Py_LT);
+                    if (unlikely(result < 0))
+                        return (long) -1;
+                    is_negative = result == 1;
+                }
+#endif
+                if (is_unsigned && unlikely(is_negative)) {
+                    goto raise_neg_overflow;
+                } else if (is_negative) {
+                    stepval = PyNumber_Invert(v);
+                    if (unlikely(!stepval))
+                        return (long) -1;
+                } else {
+                    stepval = __Pyx_NewRef(v);
+                }
+                val = (long) 0;
+                mask = PyLong_FromLong((1L << chunk_size) - 1); if (unlikely(!mask)) goto done;
+                shift = PyLong_FromLong(chunk_size); if (unlikely(!shift)) goto done;
+                for (bits = 0; bits < (int) sizeof(long) * 8 - chunk_size; bits += chunk_size) {
+                    PyObject *tmp, *digit;
+                    digit = PyNumber_And(stepval, mask);
+                    if (unlikely(!digit)) goto done;
+                    idigit = PyLong_AsLong(digit);
+                    Py_DECREF(digit);
+                    if (unlikely(idigit < 0)) goto done;
+                    tmp = PyNumber_Rshift(stepval, shift);
+                    if (unlikely(!tmp)) goto done;
+                    Py_DECREF(stepval); stepval = tmp;
+                    val |= ((long) idigit) << bits;
+                    #if CYTHON_COMPILING_IN_LIMITED_API && PY_VERSION_HEX < 0x030B0000
+                    if (Py_SIZE(stepval) == 0)
+                        goto unpacking_done;
+                    #endif
+                }
+                idigit = PyLong_AsLong(stepval);
+                if (unlikely(idigit < 0)) goto done;
+                remaining_bits = ((int) sizeof(long) * 8) - bits - (is_unsigned ? 0 : 1);
+                if (unlikely(idigit >= (1L << remaining_bits)))
+                    goto raise_overflow;
+                val |= ((long) idigit) << bits;
+            #if CYTHON_COMPILING_IN_LIMITED_API && PY_VERSION_HEX < 0x030B0000
+            unpacking_done:
+            #endif
+                if (!is_unsigned) {
+                    if (unlikely(val & (((long) 1) << (sizeof(long) * 8 - 1))))
+                        goto raise_overflow;
+                    if (is_negative)
+                        val = ~val;
+                }
+                ret = 0;
+            done:
+                Py_XDECREF(shift);
+                Py_XDECREF(mask);
+                Py_XDECREF(stepval);
+#endif
                 Py_DECREF(v);
                 if (likely(!ret))
                     return val;
             }
-#endif
             return (long) -1;
         }
     } else {
         long val;
         PyObject *tmp = __Pyx_PyNumber_IntOrLong(x);
         if (!tmp) return (long) -1;
         val = __Pyx_PyInt_As_long(tmp);
@@ -11075,15 +10450,15 @@
     return (long) -1;
 }
 
 /* FastTypeChecks */
 #if CYTHON_COMPILING_IN_CPYTHON
 static int __Pyx_InBases(PyTypeObject *a, PyTypeObject *b) {
     while (a) {
-        a = a->tp_base;
+        a = __Pyx_PyType_GetSlot(a, tp_base, PyTypeObject*);
         if (a == b)
             return 1;
     }
     return b == &PyBaseObject_Type;
 }
 static CYTHON_INLINE int __Pyx_IsSubtype(PyTypeObject *a, PyTypeObject *b) {
     PyObject *mro;
@@ -11096,14 +10471,30 @@
             if (PyTuple_GET_ITEM(mro, i) == (PyObject *)b)
                 return 1;
         }
         return 0;
     }
     return __Pyx_InBases(a, b);
 }
+static CYTHON_INLINE int __Pyx_IsAnySubtype2(PyTypeObject *cls, PyTypeObject *a, PyTypeObject *b) {
+    PyObject *mro;
+    if (cls == a || cls == b) return 1;
+    mro = cls->tp_mro;
+    if (likely(mro)) {
+        Py_ssize_t i, n;
+        n = PyTuple_GET_SIZE(mro);
+        for (i = 0; i < n; i++) {
+            PyObject *base = PyTuple_GET_ITEM(mro, i);
+            if (base == (PyObject *)a || base == (PyObject *)b)
+                return 1;
+        }
+        return 0;
+    }
+    return __Pyx_InBases(cls, a) || __Pyx_InBases(cls, b);
+}
 #if PY_MAJOR_VERSION == 2
 static int __Pyx_inner_PyErr_GivenExceptionMatches2(PyObject *err, PyObject* exc_type1, PyObject* exc_type2) {
     PyObject *exception, *value, *tb;
     int res;
     __Pyx_PyThreadState_declare
     __Pyx_PyThreadState_assign
     __Pyx_ErrFetch(&exception, &value, &tb);
@@ -11120,19 +10511,19 @@
         }
     }
     __Pyx_ErrRestore(exception, value, tb);
     return res;
 }
 #else
 static CYTHON_INLINE int __Pyx_inner_PyErr_GivenExceptionMatches2(PyObject *err, PyObject* exc_type1, PyObject *exc_type2) {
-    int res = exc_type1 ? __Pyx_IsSubtype((PyTypeObject*)err, (PyTypeObject*)exc_type1) : 0;
-    if (!res) {
-        res = __Pyx_IsSubtype((PyTypeObject*)err, (PyTypeObject*)exc_type2);
+    if (exc_type1) {
+        return __Pyx_IsAnySubtype2((PyTypeObject*)err, (PyTypeObject*)exc_type1, (PyTypeObject*)exc_type2);
+    } else {
+        return __Pyx_IsSubtype((PyTypeObject*)err, (PyTypeObject*)exc_type2);
     }
-    return res;
 }
 #endif
 static int __Pyx_PyErr_GivenExceptionMatchesTuple(PyObject *exc_type, PyObject *tuple) {
     Py_ssize_t i, n;
     assert(PyExceptionClass_Check(exc_type));
     n = PyTuple_GET_SIZE(tuple);
 #if PY_MAJOR_VERSION >= 3
@@ -11173,56 +10564,88 @@
     }
     return (PyErr_GivenExceptionMatches(err, exc_type1) || PyErr_GivenExceptionMatches(err, exc_type2));
 }
 #endif
 
 /* CheckBinaryVersion */
 static int __Pyx_check_binary_version(void) {
-    char ctversion[4], rtversion[4];
-    PyOS_snprintf(ctversion, 4, "%d.%d", PY_MAJOR_VERSION, PY_MINOR_VERSION);
-    PyOS_snprintf(rtversion, 4, "%s", Py_GetVersion());
-    if (ctversion[0] != rtversion[0] || ctversion[2] != rtversion[2]) {
+    char ctversion[5];
+    int same=1, i, found_dot;
+    const char* rt_from_call = Py_GetVersion();
+    PyOS_snprintf(ctversion, 5, "%d.%d", PY_MAJOR_VERSION, PY_MINOR_VERSION);
+    found_dot = 0;
+    for (i = 0; i < 4; i++) {
+        if (!ctversion[i]) {
+            same = (rt_from_call[i] < '0' || rt_from_call[i] > '9');
+            break;
+        }
+        if (rt_from_call[i] != ctversion[i]) {
+            same = 0;
+            break;
+        }
+    }
+    if (!same) {
+        char rtversion[5] = {'\0'};
         char message[200];
+        for (i=0; i<4; ++i) {
+            if (rt_from_call[i] == '.') {
+                if (found_dot) break;
+                found_dot = 1;
+            } else if (rt_from_call[i] < '0' || rt_from_call[i] > '9') {
+                break;
+            }
+            rtversion[i] = rt_from_call[i];
+        }
         PyOS_snprintf(message, sizeof(message),
-                      "compiletime version %s of module '%.100s' "
+                      "compile time version %s of module '%.100s' "
                       "does not match runtime version %s",
                       ctversion, __Pyx_MODULE_NAME, rtversion);
         return PyErr_WarnEx(NULL, message, 1);
     }
     return 0;
 }
 
 /* InitStrings */
+#if PY_MAJOR_VERSION >= 3
+static int __Pyx_InitString(__Pyx_StringTabEntry t, PyObject **str) {
+    if (t.is_unicode | t.is_str) {
+        if (t.intern) {
+            *str = PyUnicode_InternFromString(t.s);
+        } else if (t.encoding) {
+            *str = PyUnicode_Decode(t.s, t.n - 1, t.encoding, NULL);
+        } else {
+            *str = PyUnicode_FromStringAndSize(t.s, t.n - 1);
+        }
+    } else {
+        *str = PyBytes_FromStringAndSize(t.s, t.n - 1);
+    }
+    if (!*str)
+        return -1;
+    if (PyObject_Hash(*str) == -1)
+        return -1;
+    return 0;
+}
+#endif
 static int __Pyx_InitStrings(__Pyx_StringTabEntry *t) {
     while (t->p) {
-        #if PY_MAJOR_VERSION < 3
+        #if PY_MAJOR_VERSION >= 3
+        __Pyx_InitString(*t, t->p);
+        #else
         if (t->is_unicode) {
             *t->p = PyUnicode_DecodeUTF8(t->s, t->n - 1, NULL);
         } else if (t->intern) {
             *t->p = PyString_InternFromString(t->s);
         } else {
             *t->p = PyString_FromStringAndSize(t->s, t->n - 1);
         }
-        #else
-        if (t->is_unicode | t->is_str) {
-            if (t->intern) {
-                *t->p = PyUnicode_InternFromString(t->s);
-            } else if (t->encoding) {
-                *t->p = PyUnicode_Decode(t->s, t->n - 1, t->encoding, NULL);
-            } else {
-                *t->p = PyUnicode_FromStringAndSize(t->s, t->n - 1);
-            }
-        } else {
-            *t->p = PyBytes_FromStringAndSize(t->s, t->n - 1);
-        }
-        #endif
         if (!*t->p)
             return -1;
         if (PyObject_Hash(*t->p) == -1)
             return -1;
+        #endif
         ++t;
     }
     return 0;
 }
 
 static CYTHON_INLINE PyObject* __Pyx_PyUnicode_FromString(const char* c_str) {
     return __Pyx_PyUnicode_FromStringAndSize(c_str, (Py_ssize_t)strlen(c_str));
@@ -11276,15 +10699,15 @@
 #if PY_MAJOR_VERSION < 3 && __PYX_DEFAULT_STRING_ENCODING_IS_ASCII
             __Pyx_sys_getdefaultencoding_not_ascii &&
 #endif
             PyUnicode_Check(o)) {
         return __Pyx_PyUnicode_AsStringAndSize(o, length);
     } else
 #endif
-#if (!CYTHON_COMPILING_IN_PYPY) || (defined(PyByteArray_AS_STRING) && defined(PyByteArray_GET_SIZE))
+#if (!CYTHON_COMPILING_IN_PYPY && !CYTHON_COMPILING_IN_LIMITED_API) || (defined(PyByteArray_AS_STRING) && defined(PyByteArray_GET_SIZE))
     if (PyByteArray_Check(o)) {
         *length = PyByteArray_GET_SIZE(o);
         return PyByteArray_AS_STRING(o);
     } else
 #endif
     {
         char* result;
@@ -11305,30 +10728,34 @@
     int retval;
     if (unlikely(!x)) return -1;
     retval = __Pyx_PyObject_IsTrue(x);
     Py_DECREF(x);
     return retval;
 }
 static PyObject* __Pyx_PyNumber_IntOrLongWrongResultType(PyObject* result, const char* type_name) {
+    __Pyx_TypeName result_type_name = __Pyx_PyType_GetName(Py_TYPE(result));
 #if PY_MAJOR_VERSION >= 3
     if (PyLong_Check(result)) {
         if (PyErr_WarnFormat(PyExc_DeprecationWarning, 1,
-                "__int__ returned non-int (type %.200s).  "
-                "The ability to return an instance of a strict subclass of int "
-                "is deprecated, and may be removed in a future version of Python.",
-                Py_TYPE(result)->tp_name)) {
+                "__int__ returned non-int (type " __Pyx_FMT_TYPENAME ").  "
+                "The ability to return an instance of a strict subclass of int is deprecated, "
+                "and may be removed in a future version of Python.",
+                result_type_name)) {
+            __Pyx_DECREF_TypeName(result_type_name);
             Py_DECREF(result);
             return NULL;
         }
+        __Pyx_DECREF_TypeName(result_type_name);
         return result;
     }
 #endif
     PyErr_Format(PyExc_TypeError,
-                 "__%.4s__ returned non-%.4s (type %.200s)",
-                 type_name, type_name, Py_TYPE(result)->tp_name);
+                 "__%.4s__ returned non-%.4s (type " __Pyx_FMT_TYPENAME ")",
+                 type_name, type_name, result_type_name);
+    __Pyx_DECREF_TypeName(result_type_name);
     Py_DECREF(result);
     return NULL;
 }
 static CYTHON_INLINE PyObject* __Pyx_PyNumber_IntOrLong(PyObject* x) {
 #if CYTHON_USE_TYPE_SLOTS
   PyNumberMethods *m;
 #endif
@@ -11386,21 +10813,19 @@
         return PyInt_AS_LONG(b);
     else
         return PyInt_AsSsize_t(b);
   }
 #endif
   if (likely(PyLong_CheckExact(b))) {
     #if CYTHON_USE_PYLONG_INTERNALS
-    const digit* digits = ((PyLongObject*)b)->ob_digit;
-    const Py_ssize_t size = Py_SIZE(b);
-    if (likely(__Pyx_sst_abs(size) <= 1)) {
-        ival = likely(size) ? digits[0] : 0;
-        if (size == -1) ival = -ival;
-        return ival;
+    if (likely(__Pyx_PyLong_IsCompact(b))) {
+        return __Pyx_PyLong_CompactValue(b);
     } else {
+      const digit* digits = __Pyx_PyLong_Digits(b);
+      const Py_ssize_t size = __Pyx_PyLong_SignedDigitCount(b);
       switch (size) {
          case 2:
            if (8 * sizeof(Py_ssize_t) > 2 * PyLong_SHIFT) {
              return (Py_ssize_t) (((((size_t)digits[1]) << PyLong_SHIFT) | (size_t)digits[0]));
            }
            break;
          case -2:
@@ -11435,16 +10860,41 @@
   }
   x = PyNumber_Index(b);
   if (!x) return -1;
   ival = PyInt_AsSsize_t(x);
   Py_DECREF(x);
   return ival;
 }
+static CYTHON_INLINE Py_hash_t __Pyx_PyIndex_AsHash_t(PyObject* o) {
+  if (sizeof(Py_hash_t) == sizeof(Py_ssize_t)) {
+    return (Py_hash_t) __Pyx_PyIndex_AsSsize_t(o);
+#if PY_MAJOR_VERSION < 3
+  } else if (likely(PyInt_CheckExact(o))) {
+    return PyInt_AS_LONG(o);
+#endif
+  } else {
+    Py_ssize_t ival;
+    PyObject *x;
+    x = PyNumber_Index(o);
+    if (!x) return -1;
+    ival = PyInt_AsLong(x);
+    Py_DECREF(x);
+    return ival;
+  }
+}
 static CYTHON_INLINE PyObject * __Pyx_PyBool_FromLong(long b) {
   return b ? __Pyx_NewRef(Py_True) : __Pyx_NewRef(Py_False);
 }
 static CYTHON_INLINE PyObject * __Pyx_PyInt_FromSize_t(size_t ival) {
     return PyInt_FromSize_t(ival);
 }
 
 
+/* #### Code section: utility_code_pragmas_end ### */
+#ifdef _MSC_VER
+#pragma warning( pop )
+#endif
+
+
+
+/* #### Code section: end ### */
 #endif /* Py_PYTHON_H */
```

### Comparing `pyskynet-0.1.5/src/cy_src/skynet_py_foreign_seri.pyx` & `pyskynet-0.2.0/src/cy_src/skynet_py_foreign_seri.pyx`

 * *Files 23% similar despite different names*

```diff
@@ -20,43 +20,39 @@
 
 cdef extern from "skynet_py_foreign_seri_ext.c": #from "lua-foreign_seri.c":
     cdef enum:
         MODE_LUA
         MODE_FOREIGN
         MODE_FOREIGN_REMOTE
 
-    cdef struct block:
-        block* next
-        char *buffer
     # for read
+    uint8_t COMBINE_TYPE(uint8_t, uint8_t)
     cdef struct read_block:
-        pass
-    cdef struct foreign_read_block:
         int mode
-    void foreign_rball_init(foreign_read_block* rb, char* buffer, int size, int mode)
-    read_block* rb_cast(foreign_read_block* rb)
-    void* foreign_rb_read(foreign_read_block* rb, int sz)
-    uint8_t COMBINE_TYPE(uint8_t, uint8_t)
+    void rb_init(read_block* rb, char* buffer, int size, int mode)
+    void* rb_read(read_block* rb, int sz)
+    bint rb_get_integer(read_block *rb, int cookie, lua_Integer *pout) except 0
+    bint rb_get_real(read_block *rb, double *pout) except 0
+    bint rb_get_pointer(read_block *rb, void **pout) except 0
+    char *rb_get_string(read_block *rb, uint8_t ahead, size_t *psize) except NULL
 
     # for write
     cdef struct write_block:
-        int len
-    cdef struct foreign_write_block:
-        write_block wb
+        char *buffer
+        int64_t len
         int mode
-    void foreign_wb_init(foreign_write_block* wb, block* b, int mode)
-    write_block* wb_cast(foreign_write_block* wb);
+    void wb_init(write_block* wb, int mode)
+    void wb_write(write_block *wb, const void *data, int sz)
     void wb_free(write_block *wb)
     void wb_nil(write_block* wb)
-    void wb_integer(write_block* wb, lua_Integer v)
-    void wb_real(write_block* wb, double v)
     void wb_boolean(write_block* wb, int v)
-    void wb_pointer(write_block *wb, void *v)
-    void wb_string(write_block *wb, const char *ptr, int sz)
-    void foreign_wb_write(foreign_write_block *wb, const void *buf, int sz)
+    void wb_put_integer(write_block* wb, lua_Integer v)
+    void wb_put_real(write_block* wb, double v)
+    void wb_put_pointer(write_block *wb, void *v)
+    void wb_put_string(write_block *wb, const char *ptr, int sz)
     cdef enum:
         TYPE_NIL
         TYPE_BOOLEAN
         TYPE_NUMBER
         TYPE_NUMBER_ZERO
         TYPE_NUMBER_BYTE
         TYPE_NUMBER_WORD
@@ -71,331 +67,208 @@
         TYPE_FOREIGN_USERDATA
     cdef enum:
         MAX_COOKIE
         MAX_DEPTH
 
     # deal for PyArray & PyMemoryView
     bint PyArray_foreign_check_typechar(object py_obj)
-    void wb_foreign_PyArray(foreign_write_block *wb, object arr, object arr_iter)
-    object unpack_PyArray(foreign_read_block *wb, int cookie)
+    void wb_put_PyArray(write_block *wb, object arr, object arr_iter)
+    object rb_get_PyArray(read_block *wb, int cookie)
 
 ########################
 # functions for unpack #
 ########################
 
-cdef double py_get_real(foreign_read_block* rb) except *:
-    cdef double n_double
-    cdef void * ptr
-    ptr = foreign_rb_read(rb, sizeof(n_double))
-    if(ptr==NULL):
-        raise Exception("invalid stream")
-    memcpy(&n_double, ptr, sizeof(n_double));
-    return n_double
-
-cdef lua_Integer py_get_integer(foreign_read_block* rb, int cookie) except *:
-    cdef uint8_t n_uint8
-    cdef uint16_t n_uint16
-    cdef int32_t n_int32
-    cdef int64_t n_int64
-    cdef void * ptr
-    if(cookie==TYPE_NUMBER_ZERO):
-        return 0
-    elif(cookie==TYPE_NUMBER_BYTE):
-        ptr = foreign_rb_read(rb, sizeof(n_uint8));
-        if (ptr == NULL):
-            raise Exception("invalid stream")
-        memcpy(&n_uint8, ptr, sizeof(n_uint8));
-        return n_uint8
-    elif(cookie==TYPE_NUMBER_WORD):
-        ptr = foreign_rb_read(rb, sizeof(n_uint16));
-        if(ptr == NULL):
-            raise Exception("invalid stream")
-        memcpy(&n_uint16, ptr, sizeof(n_uint16));
-        return n_uint16
-    elif(cookie==TYPE_NUMBER_DWORD):
-        ptr = foreign_rb_read(rb, sizeof(n_int32));
-        if(ptr == NULL):
-            raise Exception("invalid stream")
-        memcpy(&n_int32, ptr, sizeof(n_int32));
-        return n_int32
-    elif(cookie==TYPE_NUMBER_QWORD):
-        ptr = foreign_rb_read(rb, sizeof(n_int64));
-        if(ptr == NULL):
-            raise Exception("invalid stream")
-        memcpy(&n_int64, ptr, sizeof(n_int64));
-        return n_int64
-    else:
-        raise Exception("invalid stream")
-
-#cdef skynet_foreign* py_get_foreign(foreign_read_block *rb) except NULL:
-#    cdef skynet_foreign* userdata = NULL
-#    cdef void * buffer = NULL
-#    cdef void ** v
-#    cdef int32_t * psize
-#    if rb.mode == MODE_FOREIGN:
-#        v = <void **>foreign_rb_read(rb,sizeof(userdata));
-#        if v == NULL:
-#            raise Exception("invalid stream")
-#        memcpy(&userdata, v, sizeof(userdata));
-#    elif rb.mode == MODE_FOREIGN_REMOTE:
-#        userdata = skynet_foreign_deserialize(rb, <void *(*)(void*, int)>foreign_rb_read);
-#        if userdata == NULL:
-#            raise Exception("invalid stream")
-#    else:
-#        raise Exception("unexcept mode for TYPE_FOREIGN_USERDATA")
-#    return userdata
-
-cdef void* py_get_pointer(foreign_read_block *rb) except NULL:
-    cdef void * userdata
-    cdef void ** v = <void **>foreign_rb_read(rb,sizeof(userdata));
-    if v == NULL:
-        raise Exception("invalid stream")
-    memcpy(&userdata, v, sizeof(userdata));
-    return userdata
-
-cdef char * py_get_string(foreign_read_block *rb, int value_type, int cookie, size_t *out) except NULL:
-    cdef char * p = NULL
-    cdef uint16_t *plen2
-    cdef uint32_t *plen4
-    if value_type==TYPE_SHORT_STRING:
-        p = <char *>foreign_rb_read(rb, cookie)
-        out[0] = cookie
-    elif value_type==TYPE_LONG_STRING:
-        if(cookie == 2):
-            plen2 = <uint16_t *>foreign_rb_read(rb, 2)
-            if (plen2 == NULL):
-                raise Exception("invalid stream")
-            p = <char *>foreign_rb_read(rb, plen2[0])
-            out[0] = plen2[0]
-        elif(cookie == 4):
-            plen4 = <uint32_t *>foreign_rb_read(rb, 4)
-            if(plen4 == NULL):
-                raise Exception("invalid stream")
-            p = <char *>foreign_rb_read(rb, plen4[0])
-            out[0] = plen4[0]
-    return p
-
-cdef void py_push_value(l, foreign_read_block *rb, int value_type, int cookie, bint iskey) except *:
-    cdef char * ptr = NULL
-    cdef size_t length = 0
+cdef uint8_t* pyrb_unpack_one(l, read_block *rb, bint in_table) except *:
+    cdef uint8_t *aheadptr = <uint8_t*>rb_read(rb, 1)
+    cdef uint8_t ahead
+    cdef int value_type
+    cdef int cookie
+    cdef char * strptr = NULL
+    cdef size_t strlength = 0
     cdef void * lightuserdata = NULL
     cdef skynet_foreign * foreign_obj = NULL
+    cdef lua_Integer intvalue;
+    cdef double doublevalue;
+    if aheadptr == NULL:
+        if in_table:
+            raise Exception("invalid stream")
+        return NULL
+    ahead = aheadptr[0]
+    value_type = ahead & 7
+    cookie = ahead >> 3
     if value_type == TYPE_NIL:
         l.append(None)
     elif value_type == TYPE_BOOLEAN:
         l.append(cookie>0)
     elif value_type == TYPE_NUMBER:
         if (cookie == TYPE_NUMBER_REAL):
-            l.append(py_get_real(rb))
+            rb_get_real(rb, &doublevalue)
+            l.append(doublevalue)
         else:
-            l.append(py_get_integer(rb, cookie))
-    elif value_type==TYPE_SHORT_STRING:
-        ptr = py_get_string(rb, value_type, cookie, &length)
-        #if iskey:
-            #l.append(PyUnicode_DecodeUTF8(ptr, length, NULL))
-        #else:
-        l.append(PyBytes_FromStringAndSize(ptr, length))
-    elif value_type==TYPE_LONG_STRING:
-        ptr = py_get_string(rb, value_type, cookie, &length)
-        #if iskey:
-            #l.append(PyUnicode_DecodeUTF8(ptr, length, NULL))
-        #else:
-        l.append(PyBytes_FromStringAndSize(ptr, length))
+            rb_get_integer(rb, cookie, &intvalue)
+            l.append(intvalue)
+    elif value_type==TYPE_SHORT_STRING or value_type == TYPE_LONG_STRING:
+        strptr = rb_get_string(rb, ahead, &strlength)
+        l.append(PyBytes_FromStringAndSize(strptr, strlength))
     elif value_type==TYPE_TABLE:
-        py_unpack_table(l, rb, cookie)
+        pyrb_unpack_table(l, rb, cookie)
     elif value_type==TYPE_USERDATA:
-        lightuserdata = py_get_pointer(rb)
+        rb_get_pointer(rb, &lightuserdata)
         l.append(PyCapsule_New(lightuserdata, "cptr", NULL))
     elif value_type==TYPE_FOREIGN_USERDATA:
-        arr = unpack_PyArray(rb, cookie)
+        arr = rb_get_PyArray(rb, cookie)
         if arr is None:
             raise Exception("invalid stream when unpacking arr")
         l.append(arr)
     else:
         raise Exception("invalid stream for value type exception")
+    return aheadptr
 
-cdef void py_unpack_one(l, foreign_read_block *rb, bint iskey) except *:
-    cdef uint8_t value_type
-    cdef uint8_t *value_ptr = <uint8_t*>foreign_rb_read(rb, sizeof(value_type));
-    if value_ptr == NULL:
-        raise Exception("invalid stream")
-    value_type = value_ptr[0]
-    py_push_value(l, rb, value_type & 0x7, value_type>>3, iskey);
-
-cdef void py_unpack_table(l, foreign_read_block *rb, int array_size) except *:
+cdef void pyrb_unpack_table(l, read_block *rb, lua_Integer array_size) except *:
     cdef uint8_t value_type
     cdef uint8_t *value_ptr
     cdef int cookie
     if array_size == MAX_COOKIE-1:
-        value_ptr = <uint8_t *>foreign_rb_read(rb, sizeof(value_type))
+        value_ptr = <uint8_t *>rb_read(rb, sizeof(value_type))
         if value_ptr == NULL:
             raise Exception("invalid stream")
         value_type=value_ptr[0]
         cookie = value_type>>3
         if (value_type & 7) != TYPE_NUMBER or cookie == TYPE_NUMBER_REAL:
             raise Exception("invalid stream")
-        array_size = py_get_integer(rb, cookie)
+        rb_get_integer(rb, cookie, &array_size)
     #l.append(t)
     next_l = []
     for i in range(1, array_size+1):
-        py_unpack_one(next_l, rb, 0)
+        pyrb_unpack_one(next_l, rb, 1)
     next_t = {}
     while True:
-        py_unpack_one(next_l, rb, 1)
+        pyrb_unpack_one(next_l, rb, 1)
         if next_l[-1] is None:
             next_l.pop()
             break
-        py_unpack_one(next_l, rb, 0)
+        pyrb_unpack_one(next_l, rb, 1)
         next_t[next_l[-2]] = next_l[-1]
         next_l.pop()
         next_l.pop()
     if not next_t:
         l.append(next_l)
     else:
         for i, v in enumerate(next_l):
             next_t[i + 1] = v
         l.append(next_t)
 
-cdef void cunpack(l, char *msg, size_t size, int mode) except *:
-    cdef foreign_read_block rb
-    foreign_rball_init(&rb, msg, size, mode);
-    cdef int i = 0
-    cdef uint8_t value_type = 0
-    cdef uint8_t *value_ptr = NULL
-    while True:
-        value_ptr = <uint8_t *>foreign_rb_read(&rb, sizeof(value_type))
-        if value_ptr == NULL:
-            break
-        value_type = value_ptr[0]
-        py_push_value(l, &rb, value_type & 0x7, value_type>>3, 0);
-
 # extern
 cdef py_foreign_unpack(int mode, capsule_or_bytes, py_sz):
     cdef const char *name
     cdef char *ptr
     cdef size_t sz
+    cdef read_block rb
     l = []
     if PyCapsule_CheckExact(capsule_or_bytes):
         name = PyCapsule_GetName(capsule_or_bytes)
         ptr = <char *>PyCapsule_GetPointer(capsule_or_bytes, name)
         sz = py_sz
-        if strcmp(name, "cptr") == 0 or strcmp(name, "pyptr") == 0:
-            cunpack(l, ptr, sz, mode)
-            return tuple(l)
-        else:
+        if strcmp(name, "cptr") != 0 and strcmp(name, "pyptr") != 0:
             raise Exception("capsule unpack failed for name = %s " % PyBytes_FromString(name))
     elif PyBytes_CheckExact(capsule_or_bytes):
         ptr = <char *>PyBytes_AS_STRING(capsule_or_bytes)
         sz = PyBytes_GET_SIZE(capsule_or_bytes)
-        cunpack(l, ptr, sz, mode)
-        return tuple(l)
     else:
         raise Exception("Unexcept type %s " % str(type(capsule_or_bytes)))
+    rb_init(&rb, ptr, sz, mode);
+    while True:
+        if pyrb_unpack_one(l, &rb, 0) == NULL:
+            break
+    return tuple(l)
 
 ######################
 # functions for pack #
 ######################
-cdef void py_pack_list(foreign_write_block* wb, list_obj, int depth) except *:
+cdef void py_pack_list(write_block* wb, list_obj, int depth) except *:
     cdef int array_size = len(list_obj)
     cdef uint8_t n
     if array_size >= MAX_COOKIE - 1:
         n = COMBINE_TYPE(TYPE_TABLE, MAX_COOKIE - 1);
-        foreign_wb_write(wb, &n, 1);
-        wb_integer(wb_cast(wb), array_size)
+        wb_write(wb, &n, 1);
+        wb_put_integer(wb, array_size)
     else:
         n = COMBINE_TYPE(TYPE_TABLE, array_size);
-        foreign_wb_write(wb, &n, 1);
+        wb_write(wb, &n, 1);
     for v in list_obj:
         py_pack_one(wb,v,depth)
-    wb_nil(wb_cast(wb))
+    wb_nil(wb)
 
-cdef void py_pack_dict(foreign_write_block* wb, dict_obj, int depth) except *:
+cdef void py_pack_dict(write_block* wb, dict_obj, int depth) except *:
     cdef uint8_t n = COMBINE_TYPE(TYPE_TABLE, 0);
-    foreign_wb_write(wb, &n, 1);
+    wb_write(wb, &n, 1);
     for k, v in dict_obj.items():
         py_pack_one(wb,k,depth)
         py_pack_one(wb,v,depth)
-    wb_nil(wb_cast(wb))
+    wb_nil(wb)
 
-cdef void py_pack_one(foreign_write_block* wb, py_arg, int depth) except *:
+cdef void py_pack_one(write_block* wb, py_arg, int depth) except *:
     cdef int bytes_sz = 0
     cdef char *bytes_ptr = NULL
     cdef const char *name = NULL
     if depth > MAX_DEPTH:
         raise Exception("serialize can't pack too depth table")
     if py_arg is None:
-        wb_nil(wb_cast(wb))
+        wb_nil(wb)
     elif PyCapsule_CheckExact(py_arg):
         name = PyCapsule_GetName(py_arg)
         if strcmp(name, "cptr") == 0:
-            wb_pointer(wb_cast(wb), PyCapsule_GetPointer(py_arg, "cptr"))
+            wb_put_pointer(wb, PyCapsule_GetPointer(py_arg, "cptr"))
         else:
             raise Exception("unexception capsule")
     elif PyArray_CheckExact(py_arg):
         if not PyArray_foreign_check_typechar(py_arg):
             raise Exception("unexception typechar %s"%py_arg.dtype.char)
         if wb.mode == MODE_FOREIGN:
-            wb_foreign_PyArray(wb, py_arg, None)
+            wb_put_PyArray(wb, py_arg, None)
         elif wb.mode == MODE_FOREIGN_REMOTE:
             arr_iter = py_arg.flat
-            wb_foreign_PyArray(wb, py_arg, arr_iter)
+            wb_put_PyArray(wb, py_arg, arr_iter)
         else:
             raise Exception("seri wb foreign unexception mode")
     elif isinstance(py_arg, dict):
         py_pack_dict(wb, py_arg, depth+1)
     elif isinstance(py_arg, list):
         py_pack_list(wb, py_arg, depth+1)
     else:
         py_arg_type = type(py_arg)
         if py_arg_type == int or np.issubdtype(py_arg_type, np.integer):
-            wb_integer(wb_cast(wb), py_arg)
+            wb_put_integer(wb, py_arg)
         elif py_arg_type == float or np.issubdtype(py_arg_type, np.floating):
-            wb_real(wb_cast(wb), py_arg)
+            wb_put_real(wb, py_arg)
         elif py_arg_type == bool:
-            wb_boolean(wb_cast(wb), py_arg)
+            wb_boolean(wb, py_arg)
         elif py_arg_type == bytes:
             bytes_sz = len(py_arg)
             bytes_ptr = py_arg
-            wb_string(wb_cast(wb), bytes_ptr, bytes_sz)
+            wb_put_string(wb, bytes_ptr, bytes_sz)
         elif py_arg_type == bytearray:
             bytes_sz = len(py_arg)
             bytes_ptr = PyByteArray_AS_STRING(py_arg)
-            wb_string(wb_cast(wb), bytes_ptr, bytes_sz)
+            wb_put_string(wb, bytes_ptr, bytes_sz)
         elif py_arg_type == str:
             py_arg_bytes = PyUnicode_AsUTF8String(py_arg)
             bytes_sz = len(py_arg_bytes)
             bytes_ptr = py_arg_bytes
-            wb_string(wb_cast(wb), bytes_ptr, bytes_sz)
+            wb_put_string(wb, bytes_ptr, bytes_sz)
         else:
             raise Exception("Unsupport type %s to serialize"%str(py_arg_type))
 
 cdef py_foreign_pack(int mode, argtuple):
-    cdef block temp
-    temp.next = NULL
-    cdef foreign_write_block wb
-    foreign_wb_init(&wb, &temp, mode)
+    cdef write_block wb
+    wb_init(&wb, mode)
     for one in argtuple:
         py_pack_one(&wb, one, 0)
-    # seri
-    cdef block *b = &temp
-    cdef int length = wb.wb.len
-    cdef uint8_t* buffer = <uint8_t*> skynet_malloc(length)
-    cdef uint8_t* ptr = buffer
-    cdef int sz = length
-    while(length > 0):
-        if length >= BLOCK_SIZE:
-            memcpy(ptr, b.buffer, BLOCK_SIZE)
-            ptr += BLOCK_SIZE
-            length -= BLOCK_SIZE
-            b = b.next
-        else:
-            memcpy(ptr, b.buffer, length)
-            break
-    wb_free(wb_cast(&wb))
-    return PyCapsule_New(buffer, "cptr", NULL), sz
+    return PyCapsule_New(wb.buffer, "cptr", NULL), wb.len
 
 #########################
 # outside pack & unpack #
 #########################
 
 def tobytes(capsule, size_t size):
     cdef char *ptr = <char *>PyCapsule_GetPointer(capsule, PyCapsule_GetName(capsule))
```

### Comparing `pyskynet-0.1.5/src/c_src/service_pyholder.c` & `pyskynet-0.2.0/src/c_src/service_pyholder.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/src/c_src/lua-tflite.cpp` & `pyskynet-0.2.0/src/c_src/lua-tflite.cpp`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/src/c_src/lua-unqlite.cpp` & `pyskynet-0.2.0/src/c_src/lua-unqlite.cpp`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/setup.py` & `pyskynet-0.2.0/setup.py`

 * *Files 2% similar despite different names*

```diff
@@ -35,26 +35,27 @@
             extra_objects=[])
         return [ext_ltls]
 
 def create_cython_extensions():
     ext_main = Extension('pyskynet.skynet_py_main',
         include_dirs=INCLUDE_DIRS,
         sources=['src/cy_src/skynet_py_main.pyx'] +
-                list_path(SKYNET_SRC_PATH, ".c", ["skynet_main.c", "skynet_start.c", "skynet_env.c"]) +
+                list_path(SKYNET_SRC_PATH, ".c", ["skynet_main.c", "skynet_start.c", "skynet_env.c", "skynet_server.c"]) +
                 list_path("src/skynet_modify", ".c") +
                 list_path("3rd/numsky/src/skynet_foreign/", ".c") +
                 list_path(LUA_PATH, ".c", ["lua.c", "luac.c"]),
         depends=['src/cy_src/skynet_py.pxd'],
         define_macros=MACROS,
         libraries=LIBRARIES,
         extra_objects=[])
 
     ext_seri = Extension('pyskynet.skynet_py_foreign_seri',
         include_dirs=INCLUDE_DIRS,
-        sources=['src/cy_src/skynet_py_foreign_seri.pyx'],
+        sources=['src/cy_src/skynet_py_foreign_seri.pyx'] +
+                list_path('3rd/numsky/src/foreign_seri/', '.c', ["lua-foreign_seri.c"]),
         depends=['src/cy_src/skynet_py.pxd'],
         define_macros=MACROS,
         libraries=LIBRARIES)
 
     ext_mq = Extension('pyskynet.skynet_py_mq',
         include_dirs=INCLUDE_DIRS,
         sources=['src/cy_src/skynet_py_mq.pyx'],
@@ -147,23 +148,24 @@
         return result.group(1)
 
 def main():
     setup(
             name="pyskynet",
             version=get_version(),
             author="cz",
-            author_email="chenze.3057@bytedance.com",
+            author_email="drinkwithwater@gmail.com",
             license='MIT',
             description="PySkynet is a library for using skynet in python.",
             ext_modules=[], # setted in build_with_numpy_cython
             cmdclass={"build_ext": build_ext_rename, "build": build_with_numpy_cython, "install":InstallCommand, "develop":DevelopCommand},
             packages=["pyskynet", "skynet"],
             package_data={
                 "pyskynet": ["service/*",
                             "lualib/*",
+                            "thlua_loader.lua",
                             "lualib/*/*"],
                 "skynet": ["service/*",
                           "cservice/*",
                           "luaclib/*",
                           "lualib/*",
                           "lualib/*/*",
                           "lualib/*/*/*"],
```

### Comparing `pyskynet-0.1.5/skynet/lualib-src/lua-skynet.c` & `pyskynet-0.2.0/skynet/lualib-src/lua-skynet.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/lualib-src/lua-clientsocket.c` & `pyskynet-0.2.0/skynet/lualib-src/lua-clientsocket.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/lualib-src/lua-mongo.c` & `pyskynet-0.2.0/skynet/lualib-src/lua-mongo.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/lualib-src/lua-sharetable.c` & `pyskynet-0.2.0/skynet/lualib-src/lua-sharetable.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/lualib-src/lua-memory.c` & `pyskynet-0.2.0/skynet/lualib-src/lua-memory.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/lualib-src/lua-netpack.c` & `pyskynet-0.2.0/skynet/lualib-src/lua-netpack.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/lualib-src/lua-cluster.c` & `pyskynet-0.2.0/skynet/lualib-src/lua-cluster.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/lualib-src/ltls.c` & `pyskynet-0.2.0/skynet/lualib-src/ltls.c`

 * *Files 2% similar despite different names*

```diff
@@ -354,14 +354,18 @@
     const char* method = luaL_optstring(L, 1, "nil");
     struct ssl_ctx* ctx_p = _check_sslctx(L, 2);
     lua_pushvalue(L, 2);
     lua_setiuservalue(L, -2, 1); // set ssl_ctx associated to tls_context
 
     if(strcmp(method, "client") == 0) {
         _init_client_context(L, tls_p, ctx_p);
+        if (!lua_isnoneornil(L, 3)) {
+            const char* hostname = luaL_checkstring(L, 3);
+            SSL_set_tlsext_host_name(tls_p->ssl, hostname);
+        }
     }else if(strcmp(method, "server") == 0) {
         _init_server_context(L, tls_p, ctx_p);
     } else {
         luaL_error(L, "invalid method:%s e.g[server, client]", method);
     }
 
     if(luaL_newmetatable(L, "_TLS_CONTEXT_METATABLE_")) {
```

### Comparing `pyskynet-0.1.5/skynet/lualib-src/lua-debugchannel.c` & `pyskynet-0.2.0/skynet/lualib-src/lua-debugchannel.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/lualib-src/lua-seri.c` & `pyskynet-0.2.0/3rd/numsky/src/foreign_seri/lua-foreign_seri.c`

 * *Files 27% similar despite different names*

```diff
@@ -1,563 +1,339 @@
-/*
-	modify from https://github.com/cloudwu/lua-serialize
- */
-
-#define LUA_LIB
-
-#include "skynet_malloc.h"
-
-#include <lua.h>
-#include <lauxlib.h>
-#include <stdlib.h>
-#include <stdint.h>
-#include <assert.h>
-#include <string.h>
-
-#define TYPE_NIL 0
-#define TYPE_BOOLEAN 1
-// hibits 0 false 1 true
-#define TYPE_NUMBER 2
-// hibits 0 : 0 , 1: byte, 2:word, 4: dword, 6: qword, 8 : double
-#define TYPE_NUMBER_ZERO 0
-#define TYPE_NUMBER_BYTE 1
-#define TYPE_NUMBER_WORD 2
-#define TYPE_NUMBER_DWORD 4
-#define TYPE_NUMBER_QWORD 6
-#define TYPE_NUMBER_REAL 8
-
-#define TYPE_USERDATA 3
-#define TYPE_SHORT_STRING 4
-// hibits 0~31 : len
-#define TYPE_LONG_STRING 5
-#define TYPE_TABLE 6
-
-#define MAX_COOKIE 32
-#define COMBINE_TYPE(t,v) ((t) | (v) << 3)
-
-#define BLOCK_SIZE 128
-#define MAX_DEPTH 32
-
-struct block {
-	struct block * next;
-	char buffer[BLOCK_SIZE];
-};
 
-struct write_block {
-	struct block * head;
-	struct block * current;
-	int len;
-	int ptr;
-};
+#include "foreign_seri/seri.h"
+#include "foreign_seri/write_block.h"
+#include "foreign_seri/read_block.h"
+
+/*************
+ * unpack apis *
+ *************/
 
-struct read_block {
-	char * buffer;
-	int len;
-	int ptr;
-};
+inline void invalid_stream_line(lua_State *L, struct read_block *rb, int line) {
+	int len = rb->len;
+	luaL_error(L, "Invalid serialize stream %d (line:%d)", len, line);
+}
 
-inline static struct block *
-blk_alloc(void) {
-	struct block *b = skynet_malloc(sizeof(struct block));
-	b->next = NULL;
-	return b;
-}
-
-inline static void
-wb_push(struct write_block *b, const void *buf, int sz) {
-	const char * buffer = buf;
-	if (b->ptr == BLOCK_SIZE) {
-_again:
-		b->current = b->current->next = blk_alloc();
-		b->ptr = 0;
-	}
-	if (b->ptr <= BLOCK_SIZE - sz) {
-		memcpy(b->current->buffer + b->ptr, buffer, sz);
-		b->ptr+=sz;
-		b->len+=sz;
-	} else {
-		int copy = BLOCK_SIZE - b->ptr;
-		memcpy(b->current->buffer + b->ptr, buffer, copy);
-		buffer += copy;
-		b->len += copy;
-		sz -= copy;
-		goto _again;
+#define invalid_stream(L,rb) invalid_stream_line(L,rb,__LINE__)
+
+static uint8_t* lrb_unpack_one(lua_State *L, struct read_block *rb, bool in_table);
+
+static void lrb_unpack_table(lua_State *L, struct read_block *rb, lua_Integer array_size) {
+	if (array_size == MAX_COOKIE-1) {
+		uint8_t *t = (uint8_t *)rb_read(rb, 1);
+		if (t==NULL) {
+			invalid_stream(L,rb);
+		}
+		uint8_t type = *t;
+		int cookie = type >> 3;
+		if ((type & 7) != TYPE_NUMBER || cookie == TYPE_NUMBER_REAL) {
+			invalid_stream(L,rb);
+		}
+		if(!rb_get_integer(rb, cookie, &array_size)) {
+			invalid_stream(L, rb);
+		}
+	}
+	luaL_checkstack(L,LUA_MINSTACK,NULL);
+	lua_createtable(L,array_size,0);
+	int i;
+	for (i=1;i<=array_size;i++) {
+		lrb_unpack_one(L,rb, true);
+		lua_rawseti(L,-2,i);
+	}
+	for (;;) {
+		lrb_unpack_one(L,rb, true);
+		if (lua_isnil(L,-1)) {
+			lua_pop(L,1);
+			return;
+		}
+		lrb_unpack_one(L,rb, true);
+		lua_rawset(L,-3);
 	}
 }
 
-static void
-wb_init(struct write_block *wb , struct block *b) {
-	wb->head = b;
-	assert(b->next == NULL);
-	wb->len = 0;
-	wb->current = wb->head;
-	wb->ptr = 0;
-}
-
-static void
-wb_free(struct write_block *wb) {
-	struct block *blk = wb->head;
-	blk = blk->next;	// the first block is on stack
-	while (blk) {
-		struct block * next = blk->next;
-		skynet_free(blk);
-		blk = next;
-	}
-	wb->head = NULL;
-	wb->current = NULL;
-	wb->ptr = 0;
-	wb->len = 0;
-}
-
-static void
-rball_init(struct read_block * rb, char * buffer, int size) {
-	rb->buffer = buffer;
-	rb->len = size;
-	rb->ptr = 0;
-}
-
-static void *
-rb_read(struct read_block *rb, int sz) {
-	if (rb->len < sz) {
+static uint8_t* lrb_unpack_one(lua_State *L, struct read_block *rb, bool in_table) {
+	uint8_t *aheadptr = (uint8_t*)rb_read(rb, 1);
+	if (aheadptr==NULL) {
+		if(in_table) {
+			invalid_stream(L, rb);
+		}
 		return NULL;
 	}
-
-	int ptr = rb->ptr;
-	rb->ptr += sz;
-	rb->len -= sz;
-	return rb->buffer + ptr;
-}
-
-static inline void
-wb_nil(struct write_block *wb) {
-	uint8_t n = TYPE_NIL;
-	wb_push(wb, &n, 1);
-}
-
-static inline void
-wb_boolean(struct write_block *wb, int boolean) {
-	uint8_t n = COMBINE_TYPE(TYPE_BOOLEAN , boolean ? 1 : 0);
-	wb_push(wb, &n, 1);
-}
-
-static inline void
-wb_integer(struct write_block *wb, lua_Integer v) {
-	int type = TYPE_NUMBER;
-	if (v == 0) {
-		uint8_t n = COMBINE_TYPE(type , TYPE_NUMBER_ZERO);
-		wb_push(wb, &n, 1);
-	} else if (v != (int32_t)v) {
-		uint8_t n = COMBINE_TYPE(type , TYPE_NUMBER_QWORD);
-		int64_t v64 = v;
-		wb_push(wb, &n, 1);
-		wb_push(wb, &v64, sizeof(v64));
-	} else if (v < 0) {
-		int32_t v32 = (int32_t)v;
-		uint8_t n = COMBINE_TYPE(type , TYPE_NUMBER_DWORD);
-		wb_push(wb, &n, 1);
-		wb_push(wb, &v32, sizeof(v32));
-	} else if (v<0x100) {
-		uint8_t n = COMBINE_TYPE(type , TYPE_NUMBER_BYTE);
-		wb_push(wb, &n, 1);
-		uint8_t byte = (uint8_t)v;
-		wb_push(wb, &byte, sizeof(byte));
-	} else if (v<0x10000) {
-		uint8_t n = COMBINE_TYPE(type , TYPE_NUMBER_WORD);
-		wb_push(wb, &n, 1);
-		uint16_t word = (uint16_t)v;
-		wb_push(wb, &word, sizeof(word));
-	} else {
-		uint8_t n = COMBINE_TYPE(type , TYPE_NUMBER_DWORD);
-		wb_push(wb, &n, 1);
-		uint32_t v32 = (uint32_t)v;
-		wb_push(wb, &v32, sizeof(v32));
-	}
+	uint8_t ahead = *aheadptr;
+	int type = ahead & 0x7;
+	int cookie = ahead >> 3;
+	switch(type) {
+        case TYPE_FOREIGN_USERDATA: {
+            struct numsky_ndarray *arr = rb_get_nsarr(rb, cookie);
+			if(arr==NULL) {
+				invalid_stream(L, rb);
+			} else {
+				*(struct numsky_ndarray**)(lua_newuserdata(L, sizeof(struct numsky_ndarray*))) = arr;
+				luaL_getmetatable(L, NS_ARR_METANAME);
+				if(lua_isnil(L, -1)) {
+					luaL_error(L, "require 'numsky' before use foreign seri");
+				}
+				lua_setmetatable(L, -2);
+			}
+            break;
+        }
+		case TYPE_NIL:
+			lua_pushnil(L);
+			break;
+		case TYPE_BOOLEAN:
+			lua_pushboolean(L,cookie);
+			break;
+		case TYPE_NUMBER:
+			if (cookie == TYPE_NUMBER_REAL) {
+				double value;
+				if(rb_get_real(rb, &value)) {
+					lua_pushnumber(L, value);
+				} else {
+					invalid_stream(L, rb);
+				}
+			} else {
+				lua_Integer value;
+				if(rb_get_integer(rb, cookie, &value)) {
+					lua_pushinteger(L, value);
+				} else {
+					invalid_stream(L, rb);
+				}
+			}
+			break;
+		case TYPE_USERDATA: {
+			void *value;
+			if(rb_get_pointer(rb, &value)) {
+				lua_pushlightuserdata(L, value);
+			} else {
+				invalid_stream(L, rb);
+			}
+			break;
+		}
+		case TYPE_SHORT_STRING:
+		case TYPE_LONG_STRING: {
+			size_t sz;
+			char *p = rb_get_string(rb, ahead, &sz);
+			if(p!=NULL) {
+				lua_pushlstring(L, p, sz);
+			} else {
+				invalid_stream(L, rb);
+			}
+			break;
+		}
+		case TYPE_TABLE: {
+			lrb_unpack_table(L,rb,cookie);
+			break;
+		}
+		default: {
+			invalid_stream(L,rb);
+			break;
+		}
+    }
+	return aheadptr;
 }
 
-static inline void
-wb_real(struct write_block *wb, double v) {
-	uint8_t n = COMBINE_TYPE(TYPE_NUMBER , TYPE_NUMBER_REAL);
-	wb_push(wb, &n, 1);
-	wb_push(wb, &v, sizeof(v));
-}
-
-static inline void
-wb_pointer(struct write_block *wb, void *v) {
-	uint8_t n = TYPE_USERDATA;
-	wb_push(wb, &n, 1);
-	wb_push(wb, &v, sizeof(v));
-}
-
-static inline void
-wb_string(struct write_block *wb, const char *str, int len) {
-	if (len < MAX_COOKIE) {
-		uint8_t n = COMBINE_TYPE(TYPE_SHORT_STRING, len);
-		wb_push(wb, &n, 1);
-		if (len > 0) {
-			wb_push(wb, str, len);
-		}
-	} else {
-		uint8_t n;
-		if (len < 0x10000) {
-			n = COMBINE_TYPE(TYPE_LONG_STRING, 2);
-			wb_push(wb, &n, 1);
-			uint16_t x = (uint16_t) len;
-			wb_push(wb, &x, 2);
-		} else {
-			n = COMBINE_TYPE(TYPE_LONG_STRING, 4);
-			wb_push(wb, &n, 1);
-			uint32_t x = (uint32_t) len;
-			wb_push(wb, &x, 4);
+inline static void foreign_wb_uint(struct write_block* wb, npy_intp v) {
+	static const int B = 128;
+	uint8_t data = v | B;
+	while (v >= B) {
+		data = v | B;
+		wb_write(wb, &data, 1);
+		v >>= 7;
+	}
+	data = (uint8_t)v;
+	wb_write(wb, &data, 1);
+}
+
+/*************
+ * pack apis *
+ *************/
+
+static void wb_put_nsarr(struct write_block *wb, struct numsky_ndarray* arr_obj) {
+	// 1. nd & type
+	uint8_t n = COMBINE_TYPE(TYPE_FOREIGN_USERDATA, arr_obj->nd);
+	wb_write(wb, &n, 1);
+	struct numsky_dtype *dtype = arr_obj->dtype;
+	// 2. typechar
+	wb_write(wb, &(dtype->typechar), 1);
+	// 3. dimension
+	for(int i=0;i<arr_obj->nd;i++) {
+		foreign_wb_uint(wb, arr_obj->dimensions[i]);
+	}
+	if (wb->mode == MODE_FOREIGN) {
+		// 4. strides
+		wb_write(wb, arr_obj->strides, sizeof(npy_intp)*arr_obj->nd);
+		// 5. data
+		skynet_foreign_incref(arr_obj->foreign_base);
+		wb_write(wb, &(arr_obj->foreign_base), sizeof(arr_obj->foreign_base));
+		wb_write(wb, &(arr_obj->dataptr), sizeof(arr_obj->dataptr));
+	} else if(wb->mode == MODE_FOREIGN_REMOTE){
+		// 4. data
+		struct numsky_nditer * iter = numsky_nditer_create(arr_obj);
+		for(int i=0;i<iter->ao->count;numsky_nditer_next(iter), i++) {
+			wb_write(wb, iter->dataptr, dtype->elsize);
 		}
-		wb_push(wb, str, len);
+		numsky_nditer_destroy(iter);
 	}
 }
 
-static void pack_one(lua_State *L, struct write_block *b, int index, int depth);
+static void lwb_pack_one(lua_State *L, struct write_block *b, int index, int depth);
 
-static int
-wb_table_array(lua_State *L, struct write_block * wb, int index, int depth) {
+static int lwb_table_array(lua_State *L, struct write_block * wb, int index, int depth) {
 	int array_size = lua_rawlen(L,index);
 	if (array_size >= MAX_COOKIE-1) {
 		uint8_t n = COMBINE_TYPE(TYPE_TABLE, MAX_COOKIE-1);
-		wb_push(wb, &n, 1);
-		wb_integer(wb, array_size);
+		wb_write(wb, &n, 1);
+		wb_put_integer(wb, array_size);
 	} else {
 		uint8_t n = COMBINE_TYPE(TYPE_TABLE, array_size);
-		wb_push(wb, &n, 1);
+		wb_write(wb, &n, 1);
 	}
 
 	int i;
 	for (i=1;i<=array_size;i++) {
 		lua_rawgeti(L,index,i);
-		pack_one(L, wb, -1, depth);
+		lwb_pack_one(L, wb, -1, depth);
 		lua_pop(L,1);
 	}
 
 	return array_size;
 }
 
-static void
-wb_table_hash(lua_State *L, struct write_block * wb, int index, int depth, int array_size) {
+static void lwb_table_hash(lua_State *L, struct write_block * wb, int index, int depth, int array_size) {
 	lua_pushnil(L);
 	while (lua_next(L, index) != 0) {
 		if (lua_type(L,-2) == LUA_TNUMBER) {
 			if (lua_isinteger(L, -2)) {
 				lua_Integer x = lua_tointeger(L,-2);
 				if (x>0 && x<=array_size) {
 					lua_pop(L,1);
 					continue;
 				}
 			}
 		}
-		pack_one(L,wb,-2,depth);
-		pack_one(L,wb,-1,depth);
+		lwb_pack_one(L,wb,-2,depth);
+		lwb_pack_one(L,wb,-1,depth);
 		lua_pop(L, 1);
 	}
 	wb_nil(wb);
 }
 
-static void
-wb_table_metapairs(lua_State *L, struct write_block *wb, int index, int depth) {
+static void lwb_table_metapairs(lua_State *L, struct write_block *wb, int index, int depth) {
 	uint8_t n = COMBINE_TYPE(TYPE_TABLE, 0);
-	wb_push(wb, &n, 1);
+	wb_write(wb, &n, 1);
 	lua_pushvalue(L, index);
 	lua_call(L, 1, 3);
 	for(;;) {
 		lua_pushvalue(L, -2);
 		lua_pushvalue(L, -2);
 		lua_copy(L, -5, -3);
 		lua_call(L, 2, 2);
 		int type = lua_type(L, -2);
 		if (type == LUA_TNIL) {
 			lua_pop(L, 4);
 			break;
 		}
-		pack_one(L, wb, -2, depth);
-		pack_one(L, wb, -1, depth);
+		lwb_pack_one(L, wb, -2, depth);
+		lwb_pack_one(L, wb, -1, depth);
 		lua_pop(L, 1);
 	}
 	wb_nil(wb);
 }
 
-static void
-wb_table(lua_State *L, struct write_block *wb, int index, int depth) {
+static void lwb_table(lua_State *L, struct write_block *wb, int index, int depth) {
 	luaL_checkstack(L, LUA_MINSTACK, NULL);
 	if (index < 0) {
 		index = lua_gettop(L) + index + 1;
 	}
 	if (luaL_getmetafield(L, index, "__pairs") != LUA_TNIL) {
-		wb_table_metapairs(L, wb, index, depth);
+		lwb_table_metapairs(L, wb, index, depth);
 	} else {
-		int array_size = wb_table_array(L, wb, index, depth);
-		wb_table_hash(L, wb, index, depth, array_size);
+		int array_size = lwb_table_array(L, wb, index, depth);
+		lwb_table_hash(L, wb, index, depth, array_size);
 	}
 }
 
-static void
-pack_one(lua_State *L, struct write_block *b, int index, int depth) {
+static void lwb_pack_one(lua_State *L, struct write_block *wb, int index, int depth) {
 	if (depth > MAX_DEPTH) {
-		wb_free(b);
+		wb_free(wb);
 		luaL_error(L, "serialize can't pack too depth table");
 	}
 	int type = lua_type(L,index);
 	switch(type) {
 	case LUA_TNIL:
-		wb_nil(b);
+		wb_nil(wb);
 		break;
 	case LUA_TNUMBER: {
 		if (lua_isinteger(L, index)) {
 			lua_Integer x = lua_tointeger(L,index);
-			wb_integer(b, x);
+			wb_put_integer(wb, x);
 		} else {
 			lua_Number n = lua_tonumber(L,index);
-			wb_real(b,n);
+			wb_put_real(wb,n);
 		}
 		break;
 	}
-	case LUA_TBOOLEAN: 
-		wb_boolean(b, lua_toboolean(L,index));
+	case LUA_TBOOLEAN:
+		wb_boolean(wb, lua_toboolean(L,index));
 		break;
 	case LUA_TSTRING: {
 		size_t sz = 0;
 		const char *str = lua_tolstring(L,index,&sz);
-		wb_string(b, str, (int)sz);
+		wb_put_string(wb, str, (int)sz);
 		break;
 	}
 	case LUA_TLIGHTUSERDATA:
-		wb_pointer(b, lua_touserdata(L,index));
+		wb_put_pointer(wb, lua_touserdata(L,index));
 		break;
 	case LUA_TTABLE: {
 		if (index < 0) {
 			index = lua_gettop(L) + index + 1;
 		}
-		wb_table(L, b, index, depth+1);
+		lwb_table(L, wb, index, depth+1);
 		break;
 	}
-	default:
-		wb_free(b);
-		luaL_error(L, "Unsupport type %s to serialize", lua_typename(L, type));
-	}
-}
-
-static void
-pack_from(lua_State *L, struct write_block *b, int from) {
-	int n = lua_gettop(L) - from;
-	int i;
-	for (i=1;i<=n;i++) {
-		pack_one(L, b , from + i, 0);
-	}
-}
-
-static inline void
-invalid_stream_line(lua_State *L, struct read_block *rb, int line) {
-	int len = rb->len;
-	luaL_error(L, "Invalid serialize stream %d (line:%d)", len, line);
-}
-
-#define invalid_stream(L,rb) invalid_stream_line(L,rb,__LINE__)
-
-static lua_Integer
-get_integer(lua_State *L, struct read_block *rb, int cookie) {
-	switch (cookie) {
-	case TYPE_NUMBER_ZERO:
-		return 0;
-	case TYPE_NUMBER_BYTE: {
-		uint8_t n;
-		uint8_t * pn = rb_read(rb,sizeof(n));
-		if (pn == NULL)
-			invalid_stream(L,rb);
-		n = *pn;
-		return n;
-	}
-	case TYPE_NUMBER_WORD: {
-		uint16_t n;
-		uint16_t * pn = rb_read(rb,sizeof(n));
-		if (pn == NULL)
-			invalid_stream(L,rb);
-		memcpy(&n, pn, sizeof(n));
-		return n;
-	}
-	case TYPE_NUMBER_DWORD: {
-		int32_t n;
-		int32_t * pn = rb_read(rb,sizeof(n));
-		if (pn == NULL)
-			invalid_stream(L,rb);
-		memcpy(&n, pn, sizeof(n));
-		return n;
-	}
-	case TYPE_NUMBER_QWORD: {
-		int64_t n;
-		int64_t * pn = rb_read(rb,sizeof(n));
-		if (pn == NULL)
-			invalid_stream(L,rb);
-		memcpy(&n, pn, sizeof(n));
-		return n;
-	}
-	default:
-		invalid_stream(L,rb);
-		return 0;
-	}
-}
-
-static double
-get_real(lua_State *L, struct read_block *rb) {
-	double n;
-	double * pn = rb_read(rb,sizeof(n));
-	if (pn == NULL)
-		invalid_stream(L,rb);
-	memcpy(&n, pn, sizeof(n));
-	return n;
-}
-
-static void *
-get_pointer(lua_State *L, struct read_block *rb) {
-	void * userdata = 0;
-	void ** v = (void **)rb_read(rb,sizeof(userdata));
-	if (v == NULL) {
-		invalid_stream(L,rb);
-	}
-	memcpy(&userdata, v, sizeof(userdata));
-	return userdata;
-}
-
-static void
-get_buffer(lua_State *L, struct read_block *rb, int len) {
-	char * p = rb_read(rb,len);
-	if (p == NULL) {
-		invalid_stream(L,rb);
-	}
-	lua_pushlstring(L,p,len);
-}
-
-static void unpack_one(lua_State *L, struct read_block *rb);
-
-static void
-unpack_table(lua_State *L, struct read_block *rb, int array_size) {
-	if (array_size == MAX_COOKIE-1) {
-		uint8_t type;
-		uint8_t *t = rb_read(rb, sizeof(type));
-		if (t==NULL) {
-			invalid_stream(L,rb);
-		}
-		type = *t;
-		int cookie = type >> 3;
-		if ((type & 7) != TYPE_NUMBER || cookie == TYPE_NUMBER_REAL) {
-			invalid_stream(L,rb);
-		}
-		array_size = get_integer(L,rb,cookie);
-	}
-	luaL_checkstack(L,LUA_MINSTACK,NULL);
-	lua_createtable(L,array_size,0);
-	int i;
-	for (i=1;i<=array_size;i++) {
-		unpack_one(L,rb);
-		lua_rawseti(L,-2,i);
-	}
-	for (;;) {
-		unpack_one(L,rb);
-		if (lua_isnil(L,-1)) {
-			lua_pop(L,1);
-			return;
-		}
-		unpack_one(L,rb);
-		lua_rawset(L,-3);
-	}
-}
-
-static void
-push_value(lua_State *L, struct read_block *rb, int type, int cookie) {
-	switch(type) {
-	case TYPE_NIL:
-		lua_pushnil(L);
-		break;
-	case TYPE_BOOLEAN:
-		lua_pushboolean(L,cookie);
-		break;
-	case TYPE_NUMBER:
-		if (cookie == TYPE_NUMBER_REAL) {
-			lua_pushnumber(L,get_real(L,rb));
-		} else {
-			lua_pushinteger(L, get_integer(L, rb, cookie));
-		}
-		break;
-	case TYPE_USERDATA:
-		lua_pushlightuserdata(L,get_pointer(L,rb));
-		break;
-	case TYPE_SHORT_STRING:
-		get_buffer(L,rb,cookie);
-		break;
-	case TYPE_LONG_STRING: {
-		if (cookie == 2) {
-			uint16_t *plen = rb_read(rb, 2);
-			if (plen == NULL) {
-				invalid_stream(L,rb);
+	case LUA_TUSERDATA: {
+		struct numsky_ndarray* arr = *(struct numsky_ndarray**) (luaL_checkudata(L, index, NS_ARR_METANAME));
+		if(arr->nd >= MAX_COOKIE) {
+			wb_free(wb);
+			luaL_error(L, "numsky.ndarray's nd must be <= 31");
+		}
+		if (wb->mode==MODE_FOREIGN) {
+			if(arr->foreign_base == NULL) {
+				wb_free(wb);
+				luaL_error(L, "foreign -base can't be null");
+				return ;
 			}
-			uint16_t n;
-			memcpy(&n, plen, sizeof(n));
-			get_buffer(L,rb,n);
+			wb_put_nsarr(wb, arr);
+		} else if (wb->mode == MODE_FOREIGN_REMOTE) {
+			wb_put_nsarr(wb, arr);
 		} else {
-			if (cookie != 4) {
-				invalid_stream(L,rb);
-			}
-			uint32_t *plen = rb_read(rb, 4);
-			if (plen == NULL) {
-				invalid_stream(L,rb);
-			}
-			uint32_t n;
-			memcpy(&n, plen, sizeof(n));
-			get_buffer(L,rb,n);
+			wb_free(wb);
+			luaL_error(L, "[ERROR]wb_nsarr exception");
 		}
 		break;
 	}
-	case TYPE_TABLE: {
-		unpack_table(L,rb,cookie);
-		break;
-	}
-	default: {
-		invalid_stream(L,rb);
-		break;
-	}
+	default:
+		wb_free(wb);
+		luaL_error(L, "Unsupport type %s to serialize", lua_typename(L, type));
 	}
 }
 
-static void
-unpack_one(lua_State *L, struct read_block *rb) {
-	uint8_t type;
-	uint8_t *t = rb_read(rb, sizeof(type));
-	if (t==NULL) {
-		invalid_stream(L, rb);
-	}
-	type = *t;
-	push_value(L, rb, type & 0x7, type>>3);
-}
-
-static void
-seri(lua_State *L, struct block *b, int len) {
-	uint8_t * buffer = skynet_malloc(len);
-	uint8_t * ptr = buffer;
-	int sz = len;
-	while(len>0) {
-		if (len >= BLOCK_SIZE) {
-			memcpy(ptr, b->buffer, BLOCK_SIZE);
-			ptr += BLOCK_SIZE;
-			len -= BLOCK_SIZE;
-			b = b->next;
-		} else {
-			memcpy(ptr, b->buffer, len);
-			break;
-		}
+static int lmode_pack(lua_State *L, int mode) {
+	struct write_block wb;
+	wb_init(&wb, mode);
+	int n = lua_gettop(L);
+	for(int i=1;i<=n;i++) {
+		lwb_pack_one(L, &wb , i, 0);
 	}
-	
-	lua_pushlightuserdata(L, buffer);
-	lua_pushinteger(L, sz);
+	lua_pushlightuserdata(L, wb.buffer);
+	lua_pushinteger(L, wb.len);
+    return 2;
 }
 
-int
-luaseri_unpack(lua_State *L) {
+static int lmode_unpack(lua_State *L, int mode){
 	if (lua_isnoneornil(L,1)) {
 		return 0;
 	}
 	void * buffer;
 	int len;
 	if (lua_type(L,1) == LUA_TSTRING) {
 		size_t sz;
@@ -572,41 +348,103 @@
 	}
 	if (buffer == NULL) {
 		return luaL_error(L, "deserialize null pointer");
 	}
 
 	lua_settop(L,1);
 	struct read_block rb;
-	rball_init(&rb, buffer, len);
+	rb_init(&rb, (char*)buffer, len, mode);
 
-	int i;
-	for (i=0;;i++) {
+	for (int i=0;;i++) {
 		if (i%8==7) {
 			luaL_checkstack(L,LUA_MINSTACK,NULL);
 		}
-		uint8_t type = 0;
-		uint8_t *t = rb_read(&rb, sizeof(type));
-		if (t==NULL)
+		if(lrb_unpack_one(L, &rb, false) == NULL) {
 			break;
-		type = *t;
-		push_value(L, &rb, type & 0x7, type>>3);
+		}
 	}
 
 	// Need not free buffer
 
 	return lua_gettop(L) - 1;
 }
 
-LUAMOD_API int
-luaseri_pack(lua_State *L) {
-	struct block temp;
-	temp.next = NULL;
-	struct write_block wb;
-	wb_init(&wb, &temp);
-	pack_from(L,&wb,0);
-	assert(wb.head == &temp);
-	seri(L, &temp, wb.len);
+static int lluapack(lua_State *L) {
+	return lmode_pack(L, MODE_LUA);
+}
+
+static int lluaunpack(lua_State *L) {
+	return lmode_unpack(L, MODE_LUA);
+}
+
+static int lpack(lua_State *L) {
+	return lmode_pack(L, MODE_FOREIGN);
+}
+
+static int lunpack(lua_State *L) {
+	return lmode_unpack(L, MODE_FOREIGN);
+}
+
+static int lremotepack(lua_State *L) {
+	return lmode_pack(L, MODE_FOREIGN_REMOTE);
+}
+
+static int lremoteunpack(lua_State *L) {
+	return lmode_unpack(L, MODE_FOREIGN_REMOTE);
+}
+
+static int ltostring(lua_State *L) {
+	int t = lua_type(L,1);
+	switch (t) {
+	case LUA_TSTRING: {
+		lua_settop(L, 1);
+		return 1;
+	}
+	case LUA_TLIGHTUSERDATA: {
+		char * msg = (char*)lua_touserdata(L,1);
+		int sz = luaL_checkinteger(L,2);
+		lua_pushlstring(L,msg,sz);
+		return 1;
+	}
+	default:
+		return 0;
+	}
+}
+
+static int ltrash(lua_State *L) {
+	int t = lua_type(L,1);
+	switch (t) {
+	case LUA_TSTRING: {
+		break;
+	}
+	case LUA_TLIGHTUSERDATA: {
+		void * msg = lua_touserdata(L,1);
+		luaL_checkinteger(L,2);
+		skynet_free(msg);
+		break;
+	}
+	default:
+		luaL_error(L, "skynet.trash invalid param %s", lua_typename(L,t));
+	}
+
+	return 0;
+}
+
+static const struct luaL_Reg l_methods[] = {
+    { "luapack" , lluapack },
+    { "luaunpack", lluaunpack },
+    { "pack", lpack },
+    { "unpack" , lunpack },
+    { "remotepack", lremotepack },
+    { "remoteunpack", lremoteunpack },
+    { "tostring", ltostring },
+    { "trash", ltrash },
+    { NULL,  NULL },
+};
 
-	wb_free(&wb);
+LUA_API int
+luaopen_pyskynet_foreign_seri(lua_State *L) {
+	luaL_checkversion(L);
 
-	return 2;
+	luaL_newlib(L, l_methods);
+    return 1;
 }
```

### Comparing `pyskynet-0.1.5/skynet/lualib-src/lsha1.c` & `pyskynet-0.2.0/skynet/lualib-src/lsha1.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/lualib-src/lua-socket.c` & `pyskynet-0.2.0/skynet/lualib-src/lua-socket.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/lualib-src/lua-bson.c` & `pyskynet-0.2.0/skynet/lualib-src/lua-bson.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/lualib-src/lua-stm.c` & `pyskynet-0.2.0/skynet/lualib-src/lua-stm.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/lualib-src/lua-multicast.c` & `pyskynet-0.2.0/skynet/lualib-src/lua-multicast.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/lualib-src/lua-datasheet.c` & `pyskynet-0.2.0/skynet/lualib-src/lua-datasheet.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/lualib-src/sproto/msvcint.h` & `pyskynet-0.2.0/skynet/lualib-src/sproto/msvcint.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/lualib-src/sproto/README.md` & `pyskynet-0.2.0/skynet/lualib-src/sproto/README.md`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/lualib-src/sproto/sproto.c` & `pyskynet-0.2.0/skynet/lualib-src/sproto/sproto.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/lualib-src/sproto/sproto.h` & `pyskynet-0.2.0/skynet/lualib-src/sproto/sproto.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/lualib-src/sproto/lsproto.c` & `pyskynet-0.2.0/skynet/lualib-src/sproto/lsproto.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/lualib-src/lua-sharedata.c` & `pyskynet-0.2.0/skynet/lualib-src/lua-sharedata.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/lualib-src/lua-crypt.c` & `pyskynet-0.2.0/skynet/lualib-src/lua-crypt.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/service-src/databuffer.h` & `pyskynet-0.2.0/skynet/service-src/databuffer.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/service-src/service_logger.c` & `pyskynet-0.2.0/skynet/service-src/service_logger.c`

 * *Files 5% similar despite different names*

```diff
@@ -36,15 +36,15 @@
 
 static int
 timestring(struct logger *inst, char tmp[SIZETIMEFMT]) {
 	uint64_t now = skynet_now();
 	time_t ti = now/100 + inst->starttime;
 	struct tm info;
 	(void)localtime_r(&ti,&info);
-	strftime(tmp, SIZETIMEFMT, "%D %T", &info);
+	strftime(tmp, SIZETIMEFMT, "%d/%m/%y %H:%M:%S", &info);
 	return now % 100;
 }
 
 static int
 logger_cb(struct skynet_context * context, void *ud, int type, int session, uint32_t source, const void * msg, size_t sz) {
 	struct logger * inst = ud;
 	switch (type) {
```

### Comparing `pyskynet-0.1.5/skynet/service-src/hashid.h` & `pyskynet-0.2.0/skynet/service-src/hashid.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/service-src/service_gate.c` & `pyskynet-0.2.0/skynet/service-src/service_gate.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/service-src/service_snlua.c` & `pyskynet-0.2.0/skynet/service-src/service_snlua.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/service-src/service_harbor.c` & `pyskynet-0.2.0/skynet/service-src/service_harbor.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lua/linit.c` & `pyskynet-0.2.0/skynet/3rd/lua/linit.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lua/ltablib.c` & `pyskynet-0.2.0/skynet/3rd/lua/ltablib.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lua/ljumptab.h` & `pyskynet-0.2.0/skynet/3rd/lua/ljumptab.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lua/llex.h` & `pyskynet-0.2.0/skynet/3rd/lua/llex.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lua/lcorolib.c` & `pyskynet-0.2.0/skynet/3rd/lua/lcorolib.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lua/lauxlib.h` & `pyskynet-0.2.0/skynet/3rd/lua/lauxlib.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lua/lualib.h` & `pyskynet-0.2.0/skynet/3rd/lua/lualib.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lua/lapi.c` & `pyskynet-0.2.0/skynet/3rd/lua/lapi.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lua/lstring.h` & `pyskynet-0.2.0/skynet/3rd/lua/lstring.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lua/lvm.h` & `pyskynet-0.2.0/skynet/3rd/lua/lvm.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lua/luac` & `pyskynet-0.2.0/skynet/3rd/lua/luac`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lua/lstate.c` & `pyskynet-0.2.0/skynet/3rd/lua/lstate.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lua/ldo.h` & `pyskynet-0.2.0/skynet/3rd/lua/ldo.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lua/lctype.c` & `pyskynet-0.2.0/skynet/3rd/lua/lctype.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lua/lstrlib.c` & `pyskynet-0.2.0/skynet/3rd/lua/lstrlib.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lua/lfunc.c` & `pyskynet-0.2.0/skynet/3rd/lua/lfunc.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lua/lzio.c` & `pyskynet-0.2.0/skynet/3rd/lua/lzio.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lua/ltm.c` & `pyskynet-0.2.0/skynet/3rd/lua/ltm.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lua/lcode.c` & `pyskynet-0.2.0/skynet/3rd/lua/lcode.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lua/lua` & `pyskynet-0.2.0/skynet/3rd/lua/lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lua/lua.h` & `pyskynet-0.2.0/skynet/3rd/lua/lua.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lua/llimits.h` & `pyskynet-0.2.0/skynet/3rd/lua/llimits.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lua/lgc.c` & `pyskynet-0.2.0/skynet/3rd/lua/lgc.c`

 * *Files 0% similar despite different names*

```diff
@@ -76,31 +76,31 @@
 
 
 /* make an object black (coming from any color) */
 #define set2black(x)  \
   (x->marked = cast_byte((x->marked & ~WHITEBITS) | bitmask(BLACKBIT)))
 
 
-#define valiswhite(x)   (iscollectable(x) && iswhite(gcvalue(x)))
+#define valiswhite(x)   (iscollectable(x) && ispurewhite(gcvalue(x)))
 
-#define keyiswhite(n)   (keyiscollectable(n) && iswhite(gckey(n)))
+#define keyiswhite(n)   (keyiscollectable(n) && ispurewhite(gckey(n)))
 
 
 /*
 ** Protected access to objects in values
 */
 #define gcvalueN(o)     (iscollectable(o) ? gcvalue(o) : NULL)
 
 
 #define markvalue(g,o) { checkliveness(g->mainthread,o); \
   if (valiswhite(o)) reallymarkobject(g,gcvalue(o)); }
 
 #define markkey(g, n)	{ if keyiswhite(n) reallymarkobject(g,gckey(n)); }
 
-#define markobject(g,t)	{ if (iswhite(t)) reallymarkobject(g, obj2gco(t)); }
+#define markobject(g,t)	{ if (ispurewhite(t)) reallymarkobject(g, obj2gco(t)); }
 
 /*
 ** mark an object that can be NULL (either because it is really optional,
 ** or it was stripped as debug info, or inside an uncompleted structure)
 */
 #define markobjectN(g,t)	{ if (t) markobject(g,t); }
 
@@ -184,15 +184,15 @@
 */
 static int iscleared (global_State *g, const GCObject *o) {
   if (o == NULL) return 0;  /* non-collectable value */
   else if (novariant(o->tt) == LUA_TSTRING) {
     markobject(g, o);  /* strings are 'values', so are never weak */
     return 0;
   }
-  else return iswhite(o);
+  else return ispurewhite(o);
 }
 
 
 /*
 ** Barrier that moves collector forward, that is, marks the white object
 ** 'v' being pointed by the black object 'o'.  In the generational
 ** mode, 'v' must also become old, if 'o' is old; however, it cannot
@@ -285,16 +285,14 @@
 ** by the thread or by 'remarkupvals'.  Other objects are added to the
 ** gray list to be visited (and turned black) later.  Both userdata and
 ** upvalues can call this function recursively, but this recursion goes
 ** for at most two levels: An upvalue cannot refer to another upvalue
 ** (only closures can), and a userdata's metatable must be a table.
 */
 static void reallymarkobject (global_State *g, GCObject *o) {
-  if (isshared(o))
-    return;
   switch (o->tt) {
     case LUA_VSHRSTR:
     case LUA_VLNGSTR: {
       set2black(o);  /* nothing to visit */
       break;
     }
     case LUA_VUPVAL: {
```

### Comparing `pyskynet-0.1.5/skynet/3rd/lua/lapi.h` & `pyskynet-0.2.0/skynet/3rd/lua/lapi.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lua/lvm.c` & `pyskynet-0.2.0/skynet/3rd/lua/lvm.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lua/lmem.c` & `pyskynet-0.2.0/skynet/3rd/lua/lmem.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lua/ltable.h` & `pyskynet-0.2.0/skynet/3rd/lua/ltable.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lua/lundump.h` & `pyskynet-0.2.0/skynet/3rd/lua/lundump.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lua/lopcodes.h` & `pyskynet-0.2.0/skynet/3rd/lua/lopcodes.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lua/ltable.c` & `pyskynet-0.2.0/skynet/3rd/lua/ltable.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lua/loslib.c` & `pyskynet-0.2.0/skynet/3rd/lua/loslib.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lua/loadlib.c` & `pyskynet-0.2.0/skynet/3rd/lua/loadlib.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lua/lparser.h` & `pyskynet-0.2.0/skynet/3rd/lua/lparser.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lua/lbaselib.c` & `pyskynet-0.2.0/skynet/3rd/lua/lbaselib.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lua/lctype.h` & `pyskynet-0.2.0/skynet/3rd/lua/lctype.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lua/liolib.c` & `pyskynet-0.2.0/skynet/3rd/lua/liolib.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lua/ldebug.h` & `pyskynet-0.2.0/skynet/3rd/lua/ldebug.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lua/lopnames.h` & `pyskynet-0.2.0/skynet/3rd/lua/lopnames.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lua/lundump.c` & `pyskynet-0.2.0/skynet/3rd/lua/lundump.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lua/lstring.c` & `pyskynet-0.2.0/skynet/3rd/lua/lstring.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lua/lzio.h` & `pyskynet-0.2.0/skynet/3rd/lua/lzio.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lua/ldump.c` & `pyskynet-0.2.0/skynet/3rd/lua/ldump.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lua/lprefix.h` & `pyskynet-0.2.0/skynet/3rd/lua/lprefix.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lua/ldblib.c` & `pyskynet-0.2.0/skynet/3rd/lua/ldblib.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lua/luaconf.h` & `pyskynet-0.2.0/skynet/3rd/lua/luaconf.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lua/lauxlib.c` & `pyskynet-0.2.0/skynet/3rd/lua/lauxlib.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lua/lmem.h` & `pyskynet-0.2.0/skynet/3rd/lua/lmem.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lua/ltm.h` & `pyskynet-0.2.0/skynet/3rd/lua/ltm.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lua/llex.c` & `pyskynet-0.2.0/skynet/3rd/lua/llex.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lua/lstate.h` & `pyskynet-0.2.0/skynet/3rd/lua/lstate.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lua/lua.c` & `pyskynet-0.2.0/skynet/3rd/lua/lua.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lua/liblua.a` & `pyskynet-0.2.0/skynet/3rd/lua/liblua.a`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lua/lobject.c` & `pyskynet-0.2.0/skynet/3rd/lua/lobject.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lua/lcode.h` & `pyskynet-0.2.0/skynet/3rd/lua/lcode.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lua/ldo.c` & `pyskynet-0.2.0/skynet/3rd/lua/ldo.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lua/lmathlib.c` & `pyskynet-0.2.0/skynet/3rd/lua/lmathlib.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lua/lfunc.h` & `pyskynet-0.2.0/skynet/3rd/lua/lfunc.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lua/lobject.h` & `pyskynet-0.2.0/skynet/3rd/lua/lobject.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lua/lgc.h` & `pyskynet-0.2.0/skynet/3rd/lua/lgc.h`

 * *Files 2% similar despite different names*

```diff
@@ -116,14 +116,15 @@
 
 #define getage(o)	((o)->marked & AGEBITS)
 #define setage(o,a)  ((o)->marked = cast_byte(((o)->marked & (~AGEBITS)) | a))
 #define isold(o)	(getage(o) > G_SURVIVAL)
 
 #define isshared(x)     (getage(x) == G_SHARED)
 #define makeshared(x)   setage(x, G_SHARED)
+#define ispurewhite(x)  (iswhite(x) && !isshared(x))
 
 #define changeage(o,f,t)  \
 	check_exp(getage(o) == (f), (o)->marked ^= ((f)^(t)))
 
 
 /* Default Values for GC parameters */
 #define LUAI_GENMAJORMUL         100
@@ -163,23 +164,23 @@
 	  condchangemem(L,pre,pos); }
 
 /* more often than not, 'pre'/'pos' are empty */
 #define luaC_checkGC(L)		luaC_condGC(L,(void)0,(void)0)
 
 
 #define luaC_barrier(L,p,v) (  \
-	(iscollectable(v) && isblack(p) && iswhite(gcvalue(v)) && !isshared(gcvalue(v))) ?  \
+	(iscollectable(v) && isblack(p) && ispurewhite(gcvalue(v))) ?  \
 	luaC_barrier_(L,obj2gco(p),gcvalue(v)) : cast_void(0))
 
 #define luaC_barrierback(L,p,v) (  \
-	(iscollectable(v) && isblack(p) && iswhite(gcvalue(v)) && !isshared(gcvalue(v))) ? \
+	(iscollectable(v) && isblack(p) && ispurewhite(gcvalue(v))) ? \
 	luaC_barrierback_(L,p) : cast_void(0))
 
 #define luaC_objbarrier(L,p,o) (  \
-	(isblack(p) && iswhite(o) && !isshared(o)) ? \
+	(isblack(p) && ispurewhite(o)) ? \
 	luaC_barrier_(L,obj2gco(p),obj2gco(o)) : cast_void(0))
 
 LUAI_FUNC void luaC_fix (lua_State *L, GCObject *o);
 LUAI_FUNC void luaC_freeallobjects (lua_State *L);
 LUAI_FUNC void luaC_step (lua_State *L);
 LUAI_FUNC void luaC_runtilstate (lua_State *L, int statesmask);
 LUAI_FUNC void luaC_fullgc (lua_State *L, int isemergency);
```

### Comparing `pyskynet-0.1.5/skynet/3rd/lua/lparser.c` & `pyskynet-0.2.0/skynet/3rd/lua/lparser.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lua/ldebug.c` & `pyskynet-0.2.0/skynet/3rd/lua/ldebug.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lua/lutf8lib.c` & `pyskynet-0.2.0/skynet/3rd/lua/lutf8lib.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lua/Makefile` & `pyskynet-0.2.0/skynet/3rd/lua/Makefile`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lua/luac.c` & `pyskynet-0.2.0/skynet/3rd/lua/luac.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lua/lopcodes.c` & `pyskynet-0.2.0/skynet/3rd/lua/lopcodes.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lua-md5/md5.c` & `pyskynet-0.2.0/skynet/3rd/lua-md5/md5.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lua-md5/md5lib.c` & `pyskynet-0.2.0/skynet/3rd/lua-md5/md5lib.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lua-md5/compat-5.2.c` & `pyskynet-0.2.0/skynet/3rd/lua-md5/compat-5.2.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lpeg/lptypes.h` & `pyskynet-0.2.0/skynet/3rd/lpeg/lptypes.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lpeg/lpeg-128.gif` & `pyskynet-0.2.0/skynet/3rd/lpeg/lpeg-128.gif`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lpeg/lpvm.h` & `pyskynet-0.2.0/skynet/3rd/lpeg/lpvm.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lpeg/lpcode.h` & `pyskynet-0.2.0/skynet/3rd/lpeg/lpcode.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lpeg/lpcode.c` & `pyskynet-0.2.0/skynet/3rd/lpeg/lpcode.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lpeg/HISTORY` & `pyskynet-0.2.0/skynet/3rd/lpeg/HISTORY`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lpeg/re.html` & `pyskynet-0.2.0/skynet/3rd/lpeg/re.html`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lpeg/lpcap.c` & `pyskynet-0.2.0/skynet/3rd/lpeg/lpcap.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lpeg/lpeg.html` & `pyskynet-0.2.0/skynet/3rd/lpeg/lpeg.html`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lpeg/lpprint.c` & `pyskynet-0.2.0/skynet/3rd/lpeg/lpprint.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lpeg/lptree.h` & `pyskynet-0.2.0/skynet/3rd/lpeg/lptree.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lpeg/lpvm.c` & `pyskynet-0.2.0/skynet/3rd/lpeg/lpvm.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lpeg/test.lua` & `pyskynet-0.2.0/skynet/3rd/lpeg/test.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lpeg/lpprint.h` & `pyskynet-0.2.0/skynet/3rd/lpeg/lpprint.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lpeg/lpcap.h` & `pyskynet-0.2.0/skynet/3rd/lpeg/lpcap.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lpeg/re.lua` & `pyskynet-0.2.0/skynet/3rd/lpeg/re.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lpeg/lptree.c` & `pyskynet-0.2.0/skynet/3rd/lpeg/lptree.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/3rd/lpeg/makefile` & `pyskynet-0.2.0/skynet/3rd/lpeg/makefile`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/lualib/sproto.lua` & `pyskynet-0.2.0/skynet/lualib/sproto.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/lualib/http/httpd.lua` & `pyskynet-0.2.0/skynet/lualib/http/httpd.lua`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,9 @@
 local internal = require "http.internal"
 
-local table = table
 local string = string
 local type = type
 
 local httpd = {}
 
 local http_status_msg = {
 	[100] = "Continue",
```

### Comparing `pyskynet-0.1.5/skynet/lualib/http/tlshelper.lua` & `pyskynet-0.2.0/skynet/lualib/http/tlshelper.lua`

 * *Files 9% similar despite different names*

```diff
@@ -73,24 +73,23 @@
     return function (s)
         local ds = tls_ctx:write(s)
         return writefunc(ds)
     end
 end
 
 function tlshelper.readallfunc(fd, tls_ctx)
-    local readfunc = socket.readfunc(fd)
     return function ()
         local ds = socket.readall(fd)
         local s = tls_ctx:read(ds)
         return s
     end
 end
 
 function tlshelper.newctx()
     return c.newctx()
 end
 
-function tlshelper.newtls(method, ssl_ctx)
-    return c.newtls(method, ssl_ctx)
+function tlshelper.newtls(method, ssl_ctx, hostname)
+    return c.newtls(method, ssl_ctx, hostname)
 end
 
 return tlshelper
```

### Comparing `pyskynet-0.1.5/skynet/lualib/http/sockethelper.lua` & `pyskynet-0.2.0/skynet/lualib/http/sockethelper.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/lualib/http/websocket.lua` & `pyskynet-0.2.0/skynet/lualib/http/websocket.lua`

 * *Files 2% similar despite different names*

```diff
@@ -41,14 +41,15 @@
     end
 
     local recvheader = {}
     local code, body = internal.request(self, "GET", host, url, recvheader, request_header)
     if code ~= 101 then
         error(string.format("websocket handshake error: code[%s] info:%s", code, body))
     end
+	assert(body == "")	-- todo: M.read may need handle it
 
     if not recvheader["upgrade"] or recvheader["upgrade"]:lower() ~= "websocket" then
         error("websocket handshake upgrade must websocket")
     end
 
     if not recvheader["connection"] or recvheader["connection"]:lower() ~= "upgrade" then
         error("websocket handshake connection must upgrade")
@@ -298,36 +299,34 @@
             end
         end
     end
 end
 
 
 local SSLCTX_CLIENT = nil
-local function _new_client_ws(socket_id, protocol)
+local function _new_client_ws(socket_id, protocol, hostname)
     local obj
     if protocol == "ws" then
         obj = {
-            websocket = true,
             close = function ()
                 socket.close(socket_id)
             end,
             read = sockethelper.readfunc(socket_id),
             write = sockethelper.writefunc(socket_id),
             readall = function ()
                 return socket.readall(socket_id)
             end,
         }
     elseif protocol == "wss" then
         local tls = require "http.tlshelper"
         SSLCTX_CLIENT = SSLCTX_CLIENT or tls.newctx()
-        local tls_ctx = tls.newtls("client", SSLCTX_CLIENT)
+        local tls_ctx = tls.newtls("client", SSLCTX_CLIENT, hostname)
         local init = tls.init_requestfunc(socket_id, tls_ctx)
         init()
         obj = {
-            websocket = true,
             close = function ()
                 socket.close(socket_id)
                 tls.closefunc(tls_ctx)()
             end,
             read = tls.readfunc(socket_id, tls_ctx),
             write = tls.writefunc(socket_id, tls_ctx),
             readall = tls.readallfunc(socket_id, tls_ctx),
@@ -431,25 +430,29 @@
 function M.connect(url, header, timeout)
     local protocol, host, uri = string.match(url, "^(wss?)://([^/]+)(.*)$")
     if protocol ~= "wss" and protocol ~= "ws" then
         error(string.format("invalid protocol: %s", protocol))
     end
 
     assert(host)
-    local host_name, host_port = string.match(host, "^([^:]+):?(%d*)$")
-    assert(host_name and host_port)
+    local host_addr, host_port = string.match(host, "^([^:]+):?(%d*)$")
+    assert(host_addr and host_port)
     if host_port == "" then
         host_port = protocol == "ws" and 80 or 443
     end
+    local hostname
+    if not host_addr:match(".*%d+$") then
+        hostname = host_addr
+    end
 
     uri = uri == "" and "/" or uri
-    local socket_id = sockethelper.connect(host_name, host_port, timeout)
-    local ws_obj = _new_client_ws(socket_id, protocol)
+    local socket_id = sockethelper.connect(host_addr, host_port, timeout)
+    local ws_obj = _new_client_ws(socket_id, protocol, hostname)
     ws_obj.addr = host
-    write_handshake(ws_obj, host_name, uri, header)
+    write_handshake(ws_obj, host_addr, uri, header)
     return socket_id
 end
 
 
 function M.read(id)
     local ws_obj = assert(ws_pool[id])
     local recv_buf
```

### Comparing `pyskynet-0.1.5/skynet/lualib/skynet.lua` & `pyskynet-0.2.0/skynet/lualib/skynet.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/lualib/snax/hotfix.lua` & `pyskynet-0.2.0/skynet/lualib/snax/hotfix.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/lualib/snax/msgserver.lua` & `pyskynet-0.2.0/skynet/lualib/snax/msgserver.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/lualib/snax/gateserver.lua` & `pyskynet-0.2.0/skynet/lualib/snax/gateserver.lua`

 * *Files 1% similar despite different names*

```diff
@@ -106,15 +106,15 @@
 		else
 			socket = nil
 		end
 	end
 
 	function MSG.error(fd, msg)
 		if fd == socket then
-			skynet.error("gateserver accpet error:",msg)
+			skynet.error("gateserver accept error:",msg)
 		else
 			socketdriver.shutdown(fd)
 			if handler.error then
 				handler.error(fd, msg)
 			end
 		end
 	end
```

### Comparing `pyskynet-0.1.5/skynet/lualib/snax/loginserver.lua` & `pyskynet-0.2.0/skynet/lualib/snax/loginserver.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/lualib/snax/interface.lua` & `pyskynet-0.2.0/skynet/lualib/snax/interface.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/lualib/loader.lua` & `pyskynet-0.2.0/skynet/lualib/loader.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/lualib/md5.lua` & `pyskynet-0.2.0/skynet/lualib/md5.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/lualib/sprotoloader.lua` & `pyskynet-0.2.0/skynet/lualib/sprotoloader.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/lualib/sprotoparser.lua` & `pyskynet-0.2.0/skynet/lualib/sprotoparser.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/lualib/skynet/manager.lua` & `pyskynet-0.2.0/skynet/lualib/skynet/manager.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/lualib/skynet/sharedata/corelib.lua` & `pyskynet-0.2.0/skynet/lualib/skynet/sharedata/corelib.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/lualib/skynet/multicast.lua` & `pyskynet-0.2.0/skynet/lualib/skynet/multicast.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/lualib/skynet/cluster.lua` & `pyskynet-0.2.0/skynet/lualib/skynet/cluster.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/lualib/skynet/sharedata.lua` & `pyskynet-0.2.0/skynet/lualib/skynet/sharedata.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/lualib/skynet/require.lua` & `pyskynet-0.2.0/skynet/lualib/skynet/require.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/lualib/skynet/queue.lua` & `pyskynet-0.2.0/skynet/lualib/skynet/queue.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/lualib/skynet/remotedebug.lua` & `pyskynet-0.2.0/skynet/lualib/skynet/remotedebug.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/lualib/skynet/harbor.lua` & `pyskynet-0.2.0/skynet/lualib/skynet/harbor.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/lualib/skynet/debug.lua` & `pyskynet-0.2.0/skynet/lualib/skynet/debug.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/lualib/skynet/coroutine.lua` & `pyskynet-0.2.0/skynet/lualib/skynet/coroutine.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/lualib/skynet/socket.lua` & `pyskynet-0.2.0/skynet/lualib/skynet/socket.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/lualib/skynet/mqueue.lua` & `pyskynet-0.2.0/skynet/lualib/skynet/mqueue.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/lualib/skynet/dns.lua` & `pyskynet-0.2.0/skynet/lualib/skynet/dns.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/lualib/skynet/sharetable.lua` & `pyskynet-0.2.0/skynet/lualib/skynet/sharetable.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/lualib/skynet/service.lua` & `pyskynet-0.2.0/skynet/lualib/skynet/service.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/lualib/skynet/datasheet/init.lua` & `pyskynet-0.2.0/skynet/lualib/skynet/datasheet/init.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/lualib/skynet/datasheet/dump.lua` & `pyskynet-0.2.0/skynet/lualib/skynet/datasheet/dump.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/lualib/skynet/datasheet/builder.lua` & `pyskynet-0.2.0/skynet/lualib/skynet/datasheet/builder.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/lualib/skynet/socketchannel.lua` & `pyskynet-0.2.0/skynet/lualib/skynet/socketchannel.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/lualib/skynet/sharemap.lua` & `pyskynet-0.2.0/skynet/lualib/skynet/sharemap.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/lualib/skynet/db/redis.lua` & `pyskynet-0.2.0/skynet/lualib/skynet/db/redis.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/lualib/skynet/db/mongo.lua` & `pyskynet-0.2.0/skynet/lualib/skynet/db/mongo.lua`

 * *Files 2% similar despite different names*

```diff
@@ -361,14 +361,26 @@
 		docs[i]	= bson_encode(docs[i])
 	end
 	local sock = self.connection.__sock
 	local pack = driver.insert(0, self.full_name, docs)
 	sock:request(pack)
 end
 
+function mongo_collection:safe_batch_insert(docs)
+	for i = 1, #docs do
+		if docs[i]._id == nil then
+			docs[i]._id = bson.objectid()
+		end
+		docs[i] = bson_encode(docs[i])
+	end
+
+	local r = self.database:runCommand("insert", self.name, "documents", docs)
+	return werror(r)
+end
+
 function mongo_collection:update(selector,update,upsert,multi)
 	local flags	= (upsert and 1	or 0) +	(multi and 2 or	0)
 	local sock = self.connection.__sock
 	local pack = driver.update(self.full_name, flags, bson_encode(selector), bson_encode(update))
 	sock:request(pack)
 end
```

### Comparing `pyskynet-0.1.5/skynet/lualib/skynet/db/mysql.lua` & `pyskynet-0.2.0/skynet/lualib/skynet/db/mysql.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/lualib/skynet/snax.lua` & `pyskynet-0.2.0/skynet/lualib/skynet/snax.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/lualib/skynet/injectcode.lua` & `pyskynet-0.2.0/skynet/lualib/skynet/injectcode.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/lualib/skynet/inject.lua` & `pyskynet-0.2.0/skynet/lualib/skynet/inject.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/service/service_mgr.lua` & `pyskynet-0.2.0/skynet/service/service_mgr.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/service/service_provider.lua` & `pyskynet-0.2.0/skynet/service/service_provider.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/service/snaxd.lua` & `pyskynet-0.2.0/skynet/service/snaxd.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/service/debug_console.lua` & `pyskynet-0.2.0/skynet/service/debug_console.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/service/console.lua` & `pyskynet-0.2.0/skynet/service/console.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/service/cdummy.lua` & `pyskynet-0.2.0/skynet/service/cdummy.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/service/debug_agent.lua` & `pyskynet-0.2.0/skynet/service/debug_agent.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/service/clusterproxy.lua` & `pyskynet-0.2.0/skynet/service/clusterproxy.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/service/sharedatad.lua` & `pyskynet-0.2.0/skynet/service/sharedatad.lua`

 * *Files 1% similar despite different names*

```diff
@@ -10,15 +10,15 @@
 local objmap = {}
 local collect_tick = 10
 
 local function newobj(name, tbl)
 	assert(pool[name] == nil)
 	local cobj = sharedata.host.new(tbl)
 	sharedata.host.incref(cobj)
-	local v = { value = tbl , obj = cobj, watch = {} }
+	local v = {obj = cobj, watch = {} }
 	objmap[cobj] = v
 	pool[name] = v
 	pool_count[name] = { n = 0, threshold = 16 }
 end
 
 local function collect1min()
 	if collect_tick > 1 then
```

### Comparing `pyskynet-0.1.5/skynet/service/clusteragent.lua` & `pyskynet-0.2.0/skynet/service/clusteragent.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/service/cslave.lua` & `pyskynet-0.2.0/skynet/service/cslave.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/service/bootstrap.lua` & `pyskynet-0.2.0/skynet/service/bootstrap.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/service/cmaster.lua` & `pyskynet-0.2.0/skynet/service/cmaster.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/service/dbg.lua` & `pyskynet-0.2.0/skynet/service/dbg.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/service/launcher.lua` & `pyskynet-0.2.0/skynet/service/launcher.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/service/multicastd.lua` & `pyskynet-0.2.0/skynet/service/multicastd.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/service/clusterd.lua` & `pyskynet-0.2.0/skynet/service/clusterd.lua`

 * *Files 3% similar despite different names*

```diff
@@ -11,17 +11,23 @@
 
 local connecting = {}
 
 local function open_channel(t, key)
 	local ct = connecting[key]
 	if ct then
 		local co = coroutine.running()
-		table.insert(ct, co)
-		skynet.wait(co)
-		return assert(ct.channel)
+		local channel
+		while ct do
+			table.insert(ct, co)
+			skynet.wait(co)
+			channel = ct.channel
+			ct = connecting[key]
+			-- reload again if ct ~= nil
+		end
+		return assert(node_address[key] and channel)
 	end
 	ct = {}
 	connecting[key] = ct
 	local address = node_address[key]
 	if address == nil and not config.nowaiting then
 		local co = coroutine.running()
 		assert(ct.namequery == nil)
@@ -49,16 +55,25 @@
 
 		if succ then
 			t[key] = c
 			ct.channel = c
 		else
 			err = string.format("changenode [%s] (%s:%s) failed", key, host, port)
 		end
+	elseif address == false then
+		c = node_sender[key]
+		if c == nil then
+			-- no sender, always succ
+			succ = true
+		else
+			-- trun off the sender
+			succ, err = pcall(skynet.call, c, "lua", "changenode", false)
+		end
 	else
-		err = string.format("cluster node [%s] is %s.", key,  address == false and "down" or "absent")
+		err = string.format("cluster node [%s] is absent.", key)
 	end
 	connecting[key] = nil
 	for _, co in ipairs(ct) do
 		skynet.wakeup(co)
 	end
 	if node_address[key] ~= address then
 		return open_channel(t,key)
```

### Comparing `pyskynet-0.1.5/skynet/service/clustersender.lua` & `pyskynet-0.2.0/skynet/service/clustersender.lua`

 * *Files 6% similar despite different names*

```diff
@@ -55,16 +55,21 @@
 local function read_response(sock)
 	local sz = socket.header(sock:read(2))
 	local msg = sock:read(sz)
 	return cluster.unpackresponse(msg)	-- session, ok, data, padding
 end
 
 function command.changenode(host, port)
-	channel:changehost(host, tonumber(port))
-	channel:connect(true)
+	if not host then
+		skynet.error(string.format("Close cluster sender %s:%d", channel.__host, channel.__port))
+		channel:close()
+	else
+		channel:changehost(host, tonumber(port))
+		channel:connect(true)
+	end
 	skynet.ret(skynet.pack(nil))
 end
 
 skynet.start(function()
 	channel = sc.channel {
 			host = init_host,
 			port = tonumber(init_port),
```

### Comparing `pyskynet-0.1.5/skynet/service/gate.lua` & `pyskynet-0.2.0/skynet/service/gate.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/service/datacenterd.lua` & `pyskynet-0.2.0/skynet/service/datacenterd.lua`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/skynet-src/skynet_server.h` & `pyskynet-0.2.0/skynet/skynet-src/skynet_server.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/skynet-src/skynet_handle.c` & `pyskynet-0.2.0/skynet/skynet-src/skynet_handle.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/skynet-src/malloc_hook.h` & `pyskynet-0.2.0/skynet/skynet-src/malloc_hook.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/skynet-src/socket_info.h` & `pyskynet-0.2.0/skynet/skynet-src/socket_info.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/skynet-src/socket_epoll.h` & `pyskynet-0.2.0/skynet/skynet-src/socket_epoll.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/skynet-src/skynet_monitor.c` & `pyskynet-0.2.0/skynet/skynet-src/skynet_monitor.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/skynet-src/skynet_env.c` & `pyskynet-0.2.0/skynet/skynet-src/skynet_env.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/skynet-src/socket_kqueue.h` & `pyskynet-0.2.0/skynet/skynet-src/socket_kqueue.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/skynet-src/skynet_handle.h` & `pyskynet-0.2.0/skynet/skynet-src/skynet_handle.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/skynet-src/skynet_main.c` & `pyskynet-0.2.0/skynet/skynet-src/skynet_main.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/skynet-src/skynet_socket.h` & `pyskynet-0.2.0/skynet/skynet-src/skynet_socket.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/skynet-src/skynet_socket.c` & `pyskynet-0.2.0/skynet/skynet-src/skynet_socket.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/skynet-src/skynet_malloc.h` & `pyskynet-0.2.0/skynet/skynet-src/skynet_malloc.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/skynet-src/socket_poll.h` & `pyskynet-0.2.0/skynet/skynet-src/socket_poll.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/skynet-src/skynet_error.c` & `pyskynet-0.2.0/skynet/skynet-src/skynet_error.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/skynet-src/skynet_module.c` & `pyskynet-0.2.0/skynet/skynet-src/skynet_module.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/skynet-src/skynet_server.c` & `pyskynet-0.2.0/skynet/skynet-src/skynet_server.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/skynet-src/socket_server.h` & `pyskynet-0.2.0/skynet/skynet-src/socket_server.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/skynet-src/atomic.h` & `pyskynet-0.2.0/skynet/skynet-src/atomic.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/skynet-src/skynet_module.h` & `pyskynet-0.2.0/skynet/skynet-src/skynet_module.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/skynet-src/skynet_harbor.h` & `pyskynet-0.2.0/skynet/skynet-src/skynet_harbor.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/skynet-src/rwlock.h` & `pyskynet-0.2.0/skynet/skynet-src/rwlock.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/skynet-src/socket_server.c` & `pyskynet-0.2.0/skynet/skynet-src/socket_server.c`

 * *Files 1% similar despite different names*

```diff
@@ -63,19 +63,20 @@
 
 struct write_buffer {
 	struct write_buffer * next;
 	const void *buffer;
 	char *ptr;
 	size_t sz;
 	bool userobject;
-	uint8_t udp_address[UDP_ADDRESS_SIZE];
 };
 
-#define SIZEOF_TCPBUFFER (offsetof(struct write_buffer, udp_address[0]))
-#define SIZEOF_UDPBUFFER (sizeof(struct write_buffer))
+struct write_buffer_udp {
+	struct write_buffer buffer;
+	uint8_t udp_address[UDP_ADDRESS_SIZE];
+};
 
 struct wb_list {
 	struct write_buffer * head;
 	struct write_buffer * tail;
 };
 
 struct socket_stat {
@@ -773,16 +774,17 @@
 	write_buffer_free(ss,tmp);
 }
 
 static int
 send_list_udp(struct socket_server *ss, struct socket *s, struct wb_list *list, struct socket_message *result) {
 	while (list->head) {
 		struct write_buffer * tmp = list->head;
+		struct write_buffer_udp * udp = (struct write_buffer_udp *)tmp;
 		union sockaddr_all sa;
-		socklen_t sasz = udp_socket_address(s, tmp->udp_address, &sa);
+		socklen_t sasz = udp_socket_address(s, udp->udp_address, &sa);
 		if (sasz == 0) {
 			skynet_error(NULL, "socket-server : udp (%d) type mismatch.", s->id);
 			drop_udp(ss, s, list, tmp);
 			return -1;
 		}
 		int err = sendto(s->fd, tmp->ptr, tmp->sz, 0, &sa.s, sasz);
 		if (err < 0) {
@@ -916,15 +918,15 @@
 
 static int
 send_buffer(struct socket_server *ss, struct socket *s, struct socket_lock *l, struct socket_message *result) {
 	if (!socket_trylock(l))
 		return -1;	// blocked by direct write, send later.
 	if (s->dw_buffer) {
 		// add direct write buffer before high.head
-		struct write_buffer * buf = MALLOC(SIZEOF_TCPBUFFER);
+		struct write_buffer * buf = MALLOC(sizeof(*buf));
 		struct send_object so;
 		buf->userobject = send_object_init(ss, &so, (void *)s->dw_buffer, s->dw_size);
 		buf->ptr = (char*)so.buffer+s->dw_offset;
 		buf->sz = so.sz - s->dw_offset;
 		buf->buffer = (void *)s->dw_buffer;
 		s->wb_size+=buf->sz;
 		if (s->high.head == NULL) {
@@ -961,28 +963,28 @@
 	}
 	return buf;
 }
 
 static inline void
 append_sendbuffer_udp(struct socket_server *ss, struct socket *s, int priority, struct request_send * request, const uint8_t udp_address[UDP_ADDRESS_SIZE]) {
 	struct wb_list *wl = (priority == PRIORITY_HIGH) ? &s->high : &s->low;
-	struct write_buffer *buf = append_sendbuffer_(ss, wl, request, SIZEOF_UDPBUFFER);
+	struct write_buffer_udp *buf = (struct write_buffer_udp *)append_sendbuffer_(ss, wl, request, sizeof(*buf));
 	memcpy(buf->udp_address, udp_address, UDP_ADDRESS_SIZE);
-	s->wb_size += buf->sz;
+	s->wb_size += buf->buffer.sz;
 }
 
 static inline void
 append_sendbuffer(struct socket_server *ss, struct socket *s, struct request_send * request) {
-	struct write_buffer *buf = append_sendbuffer_(ss, &s->high, request, SIZEOF_TCPBUFFER);
+	struct write_buffer *buf = append_sendbuffer_(ss, &s->high, request, sizeof(*buf));
 	s->wb_size += buf->sz;
 }
 
 static inline void
 append_sendbuffer_low(struct socket_server *ss,struct socket *s, struct request_send * request) {
-	struct write_buffer *buf = append_sendbuffer_(ss, &s->low, request, SIZEOF_TCPBUFFER);
+	struct write_buffer *buf = append_sendbuffer_(ss, &s->low, request, sizeof(*buf));
 	s->wb_size += buf->sz;
 }
 
 static int
 trigger_write(struct socket_server *ss, struct request_send * request, struct socket_message *result) {
 	int id = request->id;
 	struct socket * s = &ss->slot[HASH_ID(id)];
@@ -1745,16 +1747,17 @@
 	}
 }
 
 static void
 send_request(struct socket_server *ss, struct request_package *request, char type, int len) {
 	request->header[6] = (uint8_t)type;
 	request->header[7] = (uint8_t)len;
+	const char * req = (const char *)request + offsetof(struct request_package, header[6]);
 	for (;;) {
-		ssize_t n = write(ss->sendctrl_fd, &request->header[6], len+2);
+		ssize_t n = write(ss->sendctrl_fd, req, len+2);
 		if (n<0) {
 			if (errno != EINTR) {
 				skynet_error(NULL, "socket-server : send ctrl command error %s.", strerror(errno));
 			}
 			continue;
 		}
 		assert(n == len+2);
@@ -1842,16 +1845,14 @@
 			}
 			// write failed, put buffer into s->dw_* , and let socket thread send it. see send_buffer()
 			s->dw_buffer = clone_buffer(buf, &s->dw_size);
 			s->dw_offset = n;
 
 			socket_unlock(&l);
 
-			inc_sending_ref(s, id);
-
 			struct request_package request;
 			request.u.send.id = id;
 			request.u.send.sz = 0;
 			request.u.send.buffer = NULL;
 
 			// let socket thread enable write event
 			send_request(ss, &request, 'W', sizeof(request.u.send));
```

### Comparing `pyskynet-0.1.5/skynet/skynet-src/skynet_mq.h` & `pyskynet-0.2.0/skynet/skynet-src/skynet_mq.h`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/skynet-src/skynet_harbor.c` & `pyskynet-0.2.0/skynet/skynet-src/skynet_harbor.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/skynet-src/skynet_daemon.c` & `pyskynet-0.2.0/skynet/skynet-src/skynet_daemon.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/skynet-src/malloc_hook.c` & `pyskynet-0.2.0/skynet/skynet-src/malloc_hook.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/skynet-src/skynet_start.c` & `pyskynet-0.2.0/skynet/skynet-src/skynet_start.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/skynet-src/skynet_mq.c` & `pyskynet-0.2.0/skynet/skynet-src/skynet_mq.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/skynet-src/spinlock.h` & `pyskynet-0.2.0/skynet/skynet-src/spinlock.h`

 * *Files 19% similar despite different names*

```diff
@@ -11,24 +11,14 @@
 #ifdef __STDC_NO_ATOMICS__
 
 #define atomic_flag_ int
 #define ATOMIC_FLAG_INIT_ 0
 #define atomic_flag_test_and_set_(ptr) __sync_lock_test_and_set(ptr, 1)
 #define atomic_flag_clear_(ptr) __sync_lock_release(ptr)
 
-#else
-
-#include <stdatomic.h>
-#define atomic_flag_ atomic_flag
-#define ATOMIC_FLAG_INIT_ ATOMIC_FLAG_INIT
-#define atomic_flag_test_and_set_ atomic_flag_test_and_set
-#define atomic_flag_clear_ atomic_flag_clear
-
-#endif
-
 struct spinlock {
 	atomic_flag_ lock;
 };
 
 static inline void
 spinlock_init(struct spinlock *lock) {
 	atomic_flag_ v = ATOMIC_FLAG_INIT_;
@@ -51,14 +41,65 @@
 }
 
 static inline void
 spinlock_destroy(struct spinlock *lock) {
 	(void) lock;
 }
 
+#else  // __STDC_NO_ATOMICS__
+
+#include <stdatomic.h>
+#define atomic_test_and_set_(ptr) atomic_exchange_explicit(ptr, 1, memory_order_acquire)
+#define atomic_clear_(ptr) atomic_store_explicit(ptr, 0, memory_order_release);
+#define atomic_load_relaxed_(ptr) atomic_load_explicit(ptr, memory_order_relaxed)
+
+#if defined(__x86_64__)
+#include <immintrin.h> // For _mm_pause
+#define atomic_pause_() _mm_pause()
+#else
+#define atomic_pause_() ((void)0)
+#endif
+
+struct spinlock {
+	atomic_int lock;
+};
+
+static inline void
+spinlock_init(struct spinlock *lock) {
+	atomic_init(&lock->lock, 0);
+}
+
+static inline void
+spinlock_lock(struct spinlock *lock) {
+	for (;;) {
+		if (!atomic_test_and_set_(&lock->lock))
+			return;
+		while (atomic_load_relaxed_(&lock->lock))
+			atomic_pause_();
+	}
+}
+
+static inline int
+spinlock_trylock(struct spinlock *lock) {
+	return !atomic_load_relaxed_(&lock->lock) &&
+		!atomic_test_and_set_(&lock->lock);
+}
+
+static inline void
+spinlock_unlock(struct spinlock *lock) {
+	atomic_clear_(&lock->lock);
+}
+
+static inline void
+spinlock_destroy(struct spinlock *lock) {
+	(void) lock;
+}
+
+#endif  // __STDC_NO_ATOMICS__
+
 #else
 
 #include <pthread.h>
 
 // we use mutex instead of spinlock for some reason
 // you can also replace to pthread_spinlock
```

### Comparing `pyskynet-0.1.5/skynet/skynet-src/skynet_log.c` & `pyskynet-0.2.0/skynet/skynet-src/skynet_log.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/skynet-src/skynet_timer.c` & `pyskynet-0.2.0/skynet/skynet-src/skynet_timer.c`

 * *Files identical despite different names*

### Comparing `pyskynet-0.1.5/skynet/skynet-src/skynet.h` & `pyskynet-0.2.0/skynet/skynet-src/skynet.h`

 * *Files identical despite different names*

